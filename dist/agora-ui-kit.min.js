(()=>{var rct=Object.create;var NV=Object.defineProperty;var ict=Object.getOwnPropertyDescriptor;var oct=Object.getOwnPropertyNames;var sct=Object.getPrototypeOf,act=Object.prototype.hasOwnProperty;var oI=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),cct=(e,r)=>{for(var i in r)NV(e,i,{get:r[i],enumerable:!0})},OV=(e,r,i,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of oct(r))!act.call(e,s)&&s!==i&&NV(e,s,{get:()=>r[s],enumerable:!(o=ict(r,s))||o.enumerable});return e},tR=(e,r,i)=>(OV(e,r,"default"),i&&OV(i,r,"default")),lN=(e,r,i)=>(i=e!=null?rct(sct(e)):{},OV(r||!e||!e.__esModule?NV(i,"default",{value:e,enumerable:!0}):i,e));var GH=oI(t_=>{"use strict";var aP=Symbol.for("react.element"),uct=Symbol.for("react.portal"),lct=Symbol.for("react.fragment"),dct=Symbol.for("react.strict_mode"),hct=Symbol.for("react.profiler"),pct=Symbol.for("react.provider"),fct=Symbol.for("react.context"),mct=Symbol.for("react.forward_ref"),Ect=Symbol.for("react.suspense"),_ct=Symbol.for("react.memo"),gct=Symbol.for("react.lazy"),kH=Symbol.iterator;function vct(e){return e===null||typeof e!="object"?null:(e=kH&&e[kH]||e["@@iterator"],typeof e=="function"?e:null)}var LH={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},MH=Object.assign,UH={};function dN(e,r,i){this.props=e,this.context=r,this.refs=UH,this.updater=i||LH}dN.prototype.isReactComponent={};dN.prototype.setState=function(e,r){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,r,"setState")};dN.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function xH(){}xH.prototype=dN.prototype;function PV(e,r,i){this.props=e,this.context=r,this.refs=UH,this.updater=i||LH}var DV=PV.prototype=new xH;DV.constructor=PV;MH(DV,dN.prototype);DV.isPureReactComponent=!0;var PH=Array.isArray,jH=Object.prototype.hasOwnProperty,LV={current:null},VH={key:!0,ref:!0,__self:!0,__source:!0};function FH(e,r,i){var o,s={},l=null,d=null;if(r!=null)for(o in r.ref!==void 0&&(d=r.ref),r.key!==void 0&&(l=""+r.key),r)jH.call(r,o)&&!VH.hasOwnProperty(o)&&(s[o]=r[o]);var h=arguments.length-2;if(h===1)s.children=i;else if(1<h){for(var p=Array(h),f=0;f<h;f++)p[f]=arguments[f+2];s.children=p}if(e&&e.defaultProps)for(o in h=e.defaultProps,h)s[o]===void 0&&(s[o]=h[o]);return{$$typeof:aP,type:e,key:l,ref:d,props:s,_owner:LV.current}}function yct(e,r){return{$$typeof:aP,type:e.type,key:r,ref:e.ref,props:e.props,_owner:e._owner}}function MV(e){return typeof e=="object"&&e!==null&&e.$$typeof===aP}function Sct(e){var r={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(i){return r[i]})}var DH=/\/+/g;function kV(e,r){return typeof e=="object"&&e!==null&&e.key!=null?Sct(""+e.key):r.toString(36)}function $L(e,r,i,o,s){var l=typeof e;(l==="undefined"||l==="boolean")&&(e=null);var d=!1;if(e===null)d=!0;else switch(l){case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case aP:case uct:d=!0}}if(d)return d=e,s=s(d),e=o===""?"."+kV(d,0):o,PH(s)?(i="",e!=null&&(i=e.replace(DH,"$&/")+"/"),$L(s,r,i,"",function(f){return f})):s!=null&&(MV(s)&&(s=yct(s,i+(!s.key||d&&d.key===s.key?"":(""+s.key).replace(DH,"$&/")+"/")+e)),r.push(s)),1;if(d=0,o=o===""?".":o+":",PH(e))for(var h=0;h<e.length;h++){l=e[h];var p=o+kV(l,h);d+=$L(l,r,i,p,s)}else if(p=vct(e),typeof p=="function")for(e=p.call(e),h=0;!(l=e.next()).done;)l=l.value,p=o+kV(l,h++),d+=$L(l,r,i,p,s);else if(l==="object")throw r=String(e),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return d}function ZL(e,r,i){if(e==null)return e;var o=[],s=0;return $L(e,o,"","",function(l){return r.call(i,l,s++)}),o}function Tct(e){if(e._status===-1){var r=e._result;r=r(),r.then(function(i){(e._status===0||e._status===-1)&&(e._status=1,e._result=i)},function(i){(e._status===0||e._status===-1)&&(e._status=2,e._result=i)}),e._status===-1&&(e._status=0,e._result=r)}if(e._status===1)return e._result.default;throw e._result}var iS={current:null},t2={transition:null},bct={ReactCurrentDispatcher:iS,ReactCurrentBatchConfig:t2,ReactCurrentOwner:LV};function BH(){throw Error("act(...) is not supported in production builds of React.")}t_.Children={map:ZL,forEach:function(e,r,i){ZL(e,function(){r.apply(this,arguments)},i)},count:function(e){var r=0;return ZL(e,function(){r++}),r},toArray:function(e){return ZL(e,function(r){return r})||[]},only:function(e){if(!MV(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};t_.Component=dN;t_.Fragment=lct;t_.Profiler=hct;t_.PureComponent=PV;t_.StrictMode=dct;t_.Suspense=Ect;t_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bct;t_.act=BH;t_.cloneElement=function(e,r,i){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var o=MH({},e.props),s=e.key,l=e.ref,d=e._owner;if(r!=null){if(r.ref!==void 0&&(l=r.ref,d=LV.current),r.key!==void 0&&(s=""+r.key),e.type&&e.type.defaultProps)var h=e.type.defaultProps;for(p in r)jH.call(r,p)&&!VH.hasOwnProperty(p)&&(o[p]=r[p]===void 0&&h!==void 0?h[p]:r[p])}var p=arguments.length-2;if(p===1)o.children=i;else if(1<p){h=Array(p);for(var f=0;f<p;f++)h[f]=arguments[f+2];o.children=h}return{$$typeof:aP,type:e.type,key:s,ref:l,props:o,_owner:d}};t_.createContext=function(e){return e={$$typeof:fct,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:pct,_context:e},e.Consumer=e};t_.createElement=FH;t_.createFactory=function(e){var r=FH.bind(null,e);return r.type=e,r};t_.createRef=function(){return{current:null}};t_.forwardRef=function(e){return{$$typeof:mct,render:e}};t_.isValidElement=MV;t_.lazy=function(e){return{$$typeof:gct,_payload:{_status:-1,_result:e},_init:Tct}};t_.memo=function(e,r){return{$$typeof:_ct,type:e,compare:r===void 0?null:r}};t_.startTransition=function(e){var r=t2.transition;t2.transition={};try{e()}finally{t2.transition=r}};t_.unstable_act=BH;t_.useCallback=function(e,r){return iS.current.useCallback(e,r)};t_.useContext=function(e){return iS.current.useContext(e)};t_.useDebugValue=function(){};t_.useDeferredValue=function(e){return iS.current.useDeferredValue(e)};t_.useEffect=function(e,r){return iS.current.useEffect(e,r)};t_.useId=function(){return iS.current.useId()};t_.useImperativeHandle=function(e,r,i){return iS.current.useImperativeHandle(e,r,i)};t_.useInsertionEffect=function(e,r){return iS.current.useInsertionEffect(e,r)};t_.useLayoutEffect=function(e,r){return iS.current.useLayoutEffect(e,r)};t_.useMemo=function(e,r){return iS.current.useMemo(e,r)};t_.useReducer=function(e,r,i){return iS.current.useReducer(e,r,i)};t_.useRef=function(e){return iS.current.useRef(e)};t_.useState=function(e){return iS.current.useState(e)};t_.useSyncExternalStore=function(e,r,i){return iS.current.useSyncExternalStore(e,r,i)};t_.useTransition=function(){return iS.current.useTransition()};t_.version="18.3.1"});var cP=oI((vCt,qH)=>{"use strict";qH.exports=GH()});var $H=oI(U_=>{"use strict";function VV(e,r){var i=e.length;e.push(r);t:for(;0<i;){var o=i-1>>>1,s=e[o];if(0<e2(s,r))e[o]=r,e[i]=s,i=o;else break t}}function DT(e){return e.length===0?null:e[0]}function r2(e){if(e.length===0)return null;var r=e[0],i=e.pop();if(i!==r){e[0]=i;t:for(var o=0,s=e.length,l=s>>>1;o<l;){var d=2*(o+1)-1,h=e[d],p=d+1,f=e[p];if(0>e2(h,i))p<s&&0>e2(f,h)?(e[o]=f,e[p]=i,o=p):(e[o]=h,e[d]=i,o=d);else if(p<s&&0>e2(f,i))e[o]=f,e[p]=i,o=p;else break t}}return r}function e2(e,r){var i=e.sortIndex-r.sortIndex;return i!==0?i:e.id-r.id}typeof performance=="object"&&typeof performance.now=="function"?(WH=performance,U_.unstable_now=function(){return WH.now()}):(UV=Date,HH=UV.now(),U_.unstable_now=function(){return UV.now()-HH});var WH,UV,HH,eR=[],sI=[],Rct=1,eT=null,Y0=3,i2=!1,cO=!1,lP=!1,YH=typeof setTimeout=="function"?setTimeout:null,JH=typeof clearTimeout=="function"?clearTimeout:null,KH=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function FV(e){for(var r=DT(sI);r!==null;){if(r.callback===null)r2(sI);else if(r.startTime<=e)r2(sI),r.sortIndex=r.expirationTime,VV(eR,r);else break;r=DT(sI)}}function BV(e){if(lP=!1,FV(e),!cO)if(DT(eR)!==null)cO=!0,qV(GV);else{var r=DT(sI);r!==null&&WV(BV,r.startTime-e)}}function GV(e,r){cO=!1,lP&&(lP=!1,JH(dP),dP=-1),i2=!0;var i=Y0;try{for(FV(r),eT=DT(eR);eT!==null&&(!(eT.expirationTime>r)||e&&!ZH());){var o=eT.callback;if(typeof o=="function"){eT.callback=null,Y0=eT.priorityLevel;var s=o(eT.expirationTime<=r);r=U_.unstable_now(),typeof s=="function"?eT.callback=s:eT===DT(eR)&&r2(eR),FV(r)}else r2(eR);eT=DT(eR)}if(eT!==null)var l=!0;else{var d=DT(sI);d!==null&&WV(BV,d.startTime-r),l=!1}return l}finally{eT=null,Y0=i,i2=!1}}var o2=!1,n2=null,dP=-1,XH=5,QH=-1;function ZH(){return!(U_.unstable_now()-QH<XH)}function xV(){if(n2!==null){var e=U_.unstable_now();QH=e;var r=!0;try{r=n2(!0,e)}finally{r?uP():(o2=!1,n2=null)}}else o2=!1}var uP;typeof KH=="function"?uP=function(){KH(xV)}:typeof MessageChannel<"u"?(jV=new MessageChannel,zH=jV.port2,jV.port1.onmessage=xV,uP=function(){zH.postMessage(null)}):uP=function(){YH(xV,0)};var jV,zH;function qV(e){n2=e,o2||(o2=!0,uP())}function WV(e,r){dP=YH(function(){e(U_.unstable_now())},r)}U_.unstable_IdlePriority=5;U_.unstable_ImmediatePriority=1;U_.unstable_LowPriority=4;U_.unstable_NormalPriority=3;U_.unstable_Profiling=null;U_.unstable_UserBlockingPriority=2;U_.unstable_cancelCallback=function(e){e.callback=null};U_.unstable_continueExecution=function(){cO||i2||(cO=!0,qV(GV))};U_.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):XH=0<e?Math.floor(1e3/e):5};U_.unstable_getCurrentPriorityLevel=function(){return Y0};U_.unstable_getFirstCallbackNode=function(){return DT(eR)};U_.unstable_next=function(e){switch(Y0){case 1:case 2:case 3:var r=3;break;default:r=Y0}var i=Y0;Y0=r;try{return e()}finally{Y0=i}};U_.unstable_pauseExecution=function(){};U_.unstable_requestPaint=function(){};U_.unstable_runWithPriority=function(e,r){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=Y0;Y0=e;try{return r()}finally{Y0=i}};U_.unstable_scheduleCallback=function(e,r,i){var o=U_.unstable_now();switch(typeof i=="object"&&i!==null?(i=i.delay,i=typeof i=="number"&&0<i?o+i:o):i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return s=i+s,e={id:Rct++,callback:r,priorityLevel:e,startTime:i,expirationTime:s,sortIndex:-1},i>o?(e.sortIndex=i,VV(sI,e),DT(eR)===null&&e===DT(sI)&&(lP?(JH(dP),dP=-1):lP=!0,WV(BV,i-o))):(e.sortIndex=s,VV(eR,e),cO||i2||(cO=!0,qV(GV))),e};U_.unstable_shouldYield=ZH;U_.unstable_wrapCallback=function(e){var r=Y0;return function(){var i=Y0;Y0=r;try{return e.apply(this,arguments)}finally{Y0=i}}}});var eK=oI((SCt,tK)=>{"use strict";tK.exports=$H()});var i9=oI(jS=>{"use strict";var wct=cP(),US=eK();function lE(e){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)r+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var aY=new Set,DP={};function SO(e,r){PN(e,r),PN(e+"Capture",r)}function PN(e,r){for(DP[e]=r,e=0;e<r.length;e++)aY.add(r[e])}var jR=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),pF=Object.prototype.hasOwnProperty,Ict=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,nK={},rK={};function Cct(e){return pF.call(rK,e)?!0:pF.call(nK,e)?!1:Ict.test(e)?rK[e]=!0:(nK[e]=!0,!1)}function Act(e,r,i,o){if(i!==null&&i.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return o?!1:i!==null?!i.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Oct(e,r,i,o){if(r===null||typeof r>"u"||Act(e,r,i,o))return!0;if(o)return!1;if(i!==null)switch(i.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function aS(e,r,i,o,s,l,d){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=o,this.attributeNamespace=s,this.mustUseProperty=i,this.propertyName=e,this.type=r,this.sanitizeURL=l,this.removeEmptyString=d}var G0={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){G0[e]=new aS(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var r=e[0];G0[r]=new aS(r,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){G0[e]=new aS(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){G0[e]=new aS(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){G0[e]=new aS(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){G0[e]=new aS(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){G0[e]=new aS(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){G0[e]=new aS(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){G0[e]=new aS(e,5,!1,e.toLowerCase(),null,!1,!1)});var i4=/[\-:]([a-z])/g;function o4(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var r=e.replace(i4,o4);G0[r]=new aS(r,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var r=e.replace(i4,o4);G0[r]=new aS(r,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var r=e.replace(i4,o4);G0[r]=new aS(r,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){G0[e]=new aS(e,1,!1,e.toLowerCase(),null,!1,!1)});G0.xlinkHref=new aS("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){G0[e]=new aS(e,1,!1,e.toLowerCase(),null,!0,!0)});function s4(e,r,i,o){var s=G0.hasOwnProperty(r)?G0[r]:null;(s!==null?s.type!==0:o||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(Oct(r,i,s,o)&&(i=null),o||s===null?Cct(r)&&(i===null?e.removeAttribute(r):e.setAttribute(r,""+i)):s.mustUseProperty?e[s.propertyName]=i===null?s.type===3?!1:"":i:(r=s.attributeName,o=s.attributeNamespace,i===null?e.removeAttribute(r):(s=s.type,i=s===3||s===4&&i===!0?"":""+i,o?e.setAttributeNS(o,r,i):e.setAttribute(r,i))))}var GR=wct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,s2=Symbol.for("react.element"),fN=Symbol.for("react.portal"),mN=Symbol.for("react.fragment"),a4=Symbol.for("react.strict_mode"),fF=Symbol.for("react.profiler"),cY=Symbol.for("react.provider"),uY=Symbol.for("react.context"),c4=Symbol.for("react.forward_ref"),mF=Symbol.for("react.suspense"),EF=Symbol.for("react.suspense_list"),u4=Symbol.for("react.memo"),cI=Symbol.for("react.lazy");Symbol.for("react.scope");Symbol.for("react.debug_trace_mode");var lY=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden");Symbol.for("react.cache");Symbol.for("react.tracing_marker");var iK=Symbol.iterator;function hP(e){return e===null||typeof e!="object"?null:(e=iK&&e[iK]||e["@@iterator"],typeof e=="function"?e:null)}var Z_=Object.assign,HV;function yP(e){if(HV===void 0)try{throw Error()}catch(i){var r=i.stack.trim().match(/\n( *(at )?)/);HV=r&&r[1]||""}return`
`+HV+e}var KV=!1;function zV(e,r){if(!e||KV)return"";KV=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(f){var o=f}Reflect.construct(e,[],r)}else{try{r.call()}catch(f){o=f}e.call(r.prototype)}else{try{throw Error()}catch(f){o=f}e()}}catch(f){if(f&&o&&typeof f.stack=="string"){for(var s=f.stack.split(`
`),l=o.stack.split(`
`),d=s.length-1,h=l.length-1;1<=d&&0<=h&&s[d]!==l[h];)h--;for(;1<=d&&0<=h;d--,h--)if(s[d]!==l[h]){if(d!==1||h!==1)do if(d--,h--,0>h||s[d]!==l[h]){var p=`
`+s[d].replace(" at new "," at ");return e.displayName&&p.includes("<anonymous>")&&(p=p.replace("<anonymous>",e.displayName)),p}while(1<=d&&0<=h);break}}}finally{KV=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?yP(e):""}function Nct(e){switch(e.tag){case 5:return yP(e.type);case 16:return yP("Lazy");case 13:return yP("Suspense");case 19:return yP("SuspenseList");case 0:case 2:case 15:return e=zV(e.type,!1),e;case 11:return e=zV(e.type.render,!1),e;case 1:return e=zV(e.type,!0),e;default:return""}}function _F(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case mN:return"Fragment";case fN:return"Portal";case fF:return"Profiler";case a4:return"StrictMode";case mF:return"Suspense";case EF:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case uY:return(e.displayName||"Context")+".Consumer";case cY:return(e._context.displayName||"Context")+".Provider";case c4:var r=e.render;return e=e.displayName,e||(e=r.displayName||r.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case u4:return r=e.displayName||null,r!==null?r:_F(e.type)||"Memo";case cI:r=e._payload,e=e._init;try{return _F(e(r))}catch{}}return null}function kct(e){var r=e.type;switch(e.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=r.render,e=e.displayName||e.name||"",r.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _F(r);case 8:return r===a4?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function TI(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function dY(e){var r=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Pct(e){var r=dY(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,r),o=""+e[r];if(!e.hasOwnProperty(r)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var s=i.get,l=i.set;return Object.defineProperty(e,r,{configurable:!0,get:function(){return s.call(this)},set:function(d){o=""+d,l.call(this,d)}}),Object.defineProperty(e,r,{enumerable:i.enumerable}),{getValue:function(){return o},setValue:function(d){o=""+d},stopTracking:function(){e._valueTracker=null,delete e[r]}}}}function a2(e){e._valueTracker||(e._valueTracker=Pct(e))}function hY(e){if(!e)return!1;var r=e._valueTracker;if(!r)return!0;var i=r.getValue(),o="";return e&&(o=dY(e)?e.checked?"true":"false":e.value),e=o,e!==i?(r.setValue(e),!0):!1}function M2(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function gF(e,r){var i=r.checked;return Z_({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??e._wrapperState.initialChecked})}function oK(e,r){var i=r.defaultValue==null?"":r.defaultValue,o=r.checked!=null?r.checked:r.defaultChecked;i=TI(r.value!=null?r.value:i),e._wrapperState={initialChecked:o,initialValue:i,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function pY(e,r){r=r.checked,r!=null&&s4(e,"checked",r,!1)}function vF(e,r){pY(e,r);var i=TI(r.value),o=r.type;if(i!=null)o==="number"?(i===0&&e.value===""||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if(o==="submit"||o==="reset"){e.removeAttribute("value");return}r.hasOwnProperty("value")?yF(e,r.type,i):r.hasOwnProperty("defaultValue")&&yF(e,r.type,TI(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(e.defaultChecked=!!r.defaultChecked)}function sK(e,r,i){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var o=r.type;if(!(o!=="submit"&&o!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+e._wrapperState.initialValue,i||r===e.value||(e.value=r),e.defaultValue=r}i=e.name,i!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,i!==""&&(e.name=i)}function yF(e,r,i){(r!=="number"||M2(e.ownerDocument)!==e)&&(i==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var SP=Array.isArray;function IN(e,r,i,o){if(e=e.options,r){r={};for(var s=0;s<i.length;s++)r["$"+i[s]]=!0;for(i=0;i<e.length;i++)s=r.hasOwnProperty("$"+e[i].value),e[i].selected!==s&&(e[i].selected=s),s&&o&&(e[i].defaultSelected=!0)}else{for(i=""+TI(i),r=null,s=0;s<e.length;s++){if(e[s].value===i){e[s].selected=!0,o&&(e[s].defaultSelected=!0);return}r!==null||e[s].disabled||(r=e[s])}r!==null&&(r.selected=!0)}}function SF(e,r){if(r.dangerouslySetInnerHTML!=null)throw Error(lE(91));return Z_({},r,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function aK(e,r){var i=r.value;if(i==null){if(i=r.children,r=r.defaultValue,i!=null){if(r!=null)throw Error(lE(92));if(SP(i)){if(1<i.length)throw Error(lE(93));i=i[0]}r=i}r==null&&(r=""),i=r}e._wrapperState={initialValue:TI(i)}}function fY(e,r){var i=TI(r.value),o=TI(r.defaultValue);i!=null&&(i=""+i,i!==e.value&&(e.value=i),r.defaultValue==null&&e.defaultValue!==i&&(e.defaultValue=i)),o!=null&&(e.defaultValue=""+o)}function cK(e){var r=e.textContent;r===e._wrapperState.initialValue&&r!==""&&r!==null&&(e.value=r)}function mY(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function TF(e,r){return e==null||e==="http://www.w3.org/1999/xhtml"?mY(r):e==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var c2,EY=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,i,o,s){MSApp.execUnsafeLocalFunction(function(){return e(r,i,o,s)})}:e}(function(e,r){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=r;else{for(c2=c2||document.createElement("div"),c2.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=c2.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;r.firstChild;)e.appendChild(r.firstChild)}});function LP(e,r){if(r){var i=e.firstChild;if(i&&i===e.lastChild&&i.nodeType===3){i.nodeValue=r;return}}e.textContent=r}var RP={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Dct=["Webkit","ms","Moz","O"];Object.keys(RP).forEach(function(e){Dct.forEach(function(r){r=r+e.charAt(0).toUpperCase()+e.substring(1),RP[r]=RP[e]})});function _Y(e,r,i){return r==null||typeof r=="boolean"||r===""?"":i||typeof r!="number"||r===0||RP.hasOwnProperty(e)&&RP[e]?(""+r).trim():r+"px"}function gY(e,r){e=e.style;for(var i in r)if(r.hasOwnProperty(i)){var o=i.indexOf("--")===0,s=_Y(i,r[i],o);i==="float"&&(i="cssFloat"),o?e.setProperty(i,s):e[i]=s}}var Lct=Z_({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function bF(e,r){if(r){if(Lct[e]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(lE(137,e));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(lE(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(lE(61))}if(r.style!=null&&typeof r.style!="object")throw Error(lE(62))}}function RF(e,r){if(e.indexOf("-")===-1)return typeof r.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wF=null;function l4(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var IF=null,CN=null,AN=null;function uK(e){if(e=ZP(e)){if(typeof IF!="function")throw Error(lE(280));var r=e.stateNode;r&&(r=uM(r),IF(e.stateNode,e.type,r))}}function vY(e){CN?AN?AN.push(e):AN=[e]:CN=e}function yY(){if(CN){var e=CN,r=AN;if(AN=CN=null,uK(e),r)for(e=0;e<r.length;e++)uK(r[e])}}function SY(e,r){return e(r)}function TY(){}var YV=!1;function bY(e,r,i){if(YV)return e(r,i);YV=!0;try{return SY(e,r,i)}finally{YV=!1,(CN!==null||AN!==null)&&(TY(),yY())}}function MP(e,r){var i=e.stateNode;if(i===null)return null;var o=uM(i);if(o===null)return null;i=o[r];t:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break t;default:e=!1}if(e)return null;if(i&&typeof i!="function")throw Error(lE(231,r,typeof i));return i}var CF=!1;if(jR)try{hN={},Object.defineProperty(hN,"passive",{get:function(){CF=!0}}),window.addEventListener("test",hN,hN),window.removeEventListener("test",hN,hN)}catch{CF=!1}var hN;function Mct(e,r,i,o,s,l,d,h,p){var f=Array.prototype.slice.call(arguments,3);try{r.apply(i,f)}catch(_){this.onError(_)}}var wP=!1,U2=null,x2=!1,AF=null,Uct={onError:function(e){wP=!0,U2=e}};function xct(e,r,i,o,s,l,d,h,p){wP=!1,U2=null,Mct.apply(Uct,arguments)}function jct(e,r,i,o,s,l,d,h,p){if(xct.apply(this,arguments),wP){if(wP){var f=U2;wP=!1,U2=null}else throw Error(lE(198));x2||(x2=!0,AF=f)}}function TO(e){var r=e,i=e;if(e.alternate)for(;r.return;)r=r.return;else{e=r;do r=e,r.flags&4098&&(i=r.return),e=r.return;while(e)}return r.tag===3?i:null}function RY(e){if(e.tag===13){var r=e.memoizedState;if(r===null&&(e=e.alternate,e!==null&&(r=e.memoizedState)),r!==null)return r.dehydrated}return null}function lK(e){if(TO(e)!==e)throw Error(lE(188))}function Vct(e){var r=e.alternate;if(!r){if(r=TO(e),r===null)throw Error(lE(188));return r!==e?null:e}for(var i=e,o=r;;){var s=i.return;if(s===null)break;var l=s.alternate;if(l===null){if(o=s.return,o!==null){i=o;continue}break}if(s.child===l.child){for(l=s.child;l;){if(l===i)return lK(s),e;if(l===o)return lK(s),r;l=l.sibling}throw Error(lE(188))}if(i.return!==o.return)i=s,o=l;else{for(var d=!1,h=s.child;h;){if(h===i){d=!0,i=s,o=l;break}if(h===o){d=!0,o=s,i=l;break}h=h.sibling}if(!d){for(h=l.child;h;){if(h===i){d=!0,i=l,o=s;break}if(h===o){d=!0,o=l,i=s;break}h=h.sibling}if(!d)throw Error(lE(189))}}if(i.alternate!==o)throw Error(lE(190))}if(i.tag!==3)throw Error(lE(188));return i.stateNode.current===i?e:r}function wY(e){return e=Vct(e),e!==null?IY(e):null}function IY(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var r=IY(e);if(r!==null)return r;e=e.sibling}return null}var CY=US.unstable_scheduleCallback,dK=US.unstable_cancelCallback,Fct=US.unstable_shouldYield,Bct=US.unstable_requestPaint,d0=US.unstable_now,Gct=US.unstable_getCurrentPriorityLevel,d4=US.unstable_ImmediatePriority,AY=US.unstable_UserBlockingPriority,j2=US.unstable_NormalPriority,qct=US.unstable_LowPriority,OY=US.unstable_IdlePriority,oM=null,oR=null;function Wct(e){if(oR&&typeof oR.onCommitFiberRoot=="function")try{oR.onCommitFiberRoot(oM,e,void 0,(e.current.flags&128)===128)}catch{}}var jT=Math.clz32?Math.clz32:zct,Hct=Math.log,Kct=Math.LN2;function zct(e){return e>>>=0,e===0?32:31-(Hct(e)/Kct|0)|0}var u2=64,l2=4194304;function TP(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function V2(e,r){var i=e.pendingLanes;if(i===0)return 0;var o=0,s=e.suspendedLanes,l=e.pingedLanes,d=i&268435455;if(d!==0){var h=d&~s;h!==0?o=TP(h):(l&=d,l!==0&&(o=TP(l)))}else d=i&~s,d!==0?o=TP(d):l!==0&&(o=TP(l));if(o===0)return 0;if(r!==0&&r!==o&&!(r&s)&&(s=o&-o,l=r&-r,s>=l||s===16&&(l&4194240)!==0))return r;if(o&4&&(o|=i&16),r=e.entangledLanes,r!==0)for(e=e.entanglements,r&=o;0<r;)i=31-jT(r),s=1<<i,o|=e[i],r&=~s;return o}function Yct(e,r){switch(e){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jct(e,r){for(var i=e.suspendedLanes,o=e.pingedLanes,s=e.expirationTimes,l=e.pendingLanes;0<l;){var d=31-jT(l),h=1<<d,p=s[d];p===-1?(!(h&i)||h&o)&&(s[d]=Yct(h,r)):p<=r&&(e.expiredLanes|=h),l&=~h}}function OF(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function NY(){var e=u2;return u2<<=1,!(u2&4194240)&&(u2=64),e}function JV(e){for(var r=[],i=0;31>i;i++)r.push(e);return r}function XP(e,r,i){e.pendingLanes|=r,r!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,r=31-jT(r),e[r]=i}function Xct(e,r){var i=e.pendingLanes&~r;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=r,e.mutableReadLanes&=r,e.entangledLanes&=r,r=e.entanglements;var o=e.eventTimes;for(e=e.expirationTimes;0<i;){var s=31-jT(i),l=1<<s;r[s]=0,o[s]=-1,e[s]=-1,i&=~l}}function h4(e,r){var i=e.entangledLanes|=r;for(e=e.entanglements;i;){var o=31-jT(i),s=1<<o;s&r|e[o]&r&&(e[o]|=r),i&=~s}}var T_=0;function kY(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var PY,p4,DY,LY,MY,NF=!1,d2=[],fI=null,mI=null,EI=null,UP=new Map,xP=new Map,lI=[],Qct="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hK(e,r){switch(e){case"focusin":case"focusout":fI=null;break;case"dragenter":case"dragleave":mI=null;break;case"mouseover":case"mouseout":EI=null;break;case"pointerover":case"pointerout":UP.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":xP.delete(r.pointerId)}}function pP(e,r,i,o,s,l){return e===null||e.nativeEvent!==l?(e={blockedOn:r,domEventName:i,eventSystemFlags:o,nativeEvent:l,targetContainers:[s]},r!==null&&(r=ZP(r),r!==null&&p4(r)),e):(e.eventSystemFlags|=o,r=e.targetContainers,s!==null&&r.indexOf(s)===-1&&r.push(s),e)}function Zct(e,r,i,o,s){switch(r){case"focusin":return fI=pP(fI,e,r,i,o,s),!0;case"dragenter":return mI=pP(mI,e,r,i,o,s),!0;case"mouseover":return EI=pP(EI,e,r,i,o,s),!0;case"pointerover":var l=s.pointerId;return UP.set(l,pP(UP.get(l)||null,e,r,i,o,s)),!0;case"gotpointercapture":return l=s.pointerId,xP.set(l,pP(xP.get(l)||null,e,r,i,o,s)),!0}return!1}function UY(e){var r=dO(e.target);if(r!==null){var i=TO(r);if(i!==null){if(r=i.tag,r===13){if(r=RY(i),r!==null){e.blockedOn=r,MY(e.priority,function(){DY(i)});return}}else if(r===3&&i.stateNode.current.memoizedState.isDehydrated){e.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}e.blockedOn=null}function w2(e){if(e.blockedOn!==null)return!1;for(var r=e.targetContainers;0<r.length;){var i=kF(e.domEventName,e.eventSystemFlags,r[0],e.nativeEvent);if(i===null){i=e.nativeEvent;var o=new i.constructor(i.type,i);wF=o,i.target.dispatchEvent(o),wF=null}else return r=ZP(i),r!==null&&p4(r),e.blockedOn=i,!1;r.shift()}return!0}function pK(e,r,i){w2(e)&&i.delete(r)}function $ct(){NF=!1,fI!==null&&w2(fI)&&(fI=null),mI!==null&&w2(mI)&&(mI=null),EI!==null&&w2(EI)&&(EI=null),UP.forEach(pK),xP.forEach(pK)}function fP(e,r){e.blockedOn===r&&(e.blockedOn=null,NF||(NF=!0,US.unstable_scheduleCallback(US.unstable_NormalPriority,$ct)))}function jP(e){function r(s){return fP(s,e)}if(0<d2.length){fP(d2[0],e);for(var i=1;i<d2.length;i++){var o=d2[i];o.blockedOn===e&&(o.blockedOn=null)}}for(fI!==null&&fP(fI,e),mI!==null&&fP(mI,e),EI!==null&&fP(EI,e),UP.forEach(r),xP.forEach(r),i=0;i<lI.length;i++)o=lI[i],o.blockedOn===e&&(o.blockedOn=null);for(;0<lI.length&&(i=lI[0],i.blockedOn===null);)UY(i),i.blockedOn===null&&lI.shift()}var ON=GR.ReactCurrentBatchConfig,F2=!0;function tut(e,r,i,o){var s=T_,l=ON.transition;ON.transition=null;try{T_=1,f4(e,r,i,o)}finally{T_=s,ON.transition=l}}function eut(e,r,i,o){var s=T_,l=ON.transition;ON.transition=null;try{T_=4,f4(e,r,i,o)}finally{T_=s,ON.transition=l}}function f4(e,r,i,o){if(F2){var s=kF(e,r,i,o);if(s===null)nF(e,r,o,B2,i),hK(e,o);else if(Zct(s,e,r,i,o))o.stopPropagation();else if(hK(e,o),r&4&&-1<Qct.indexOf(e)){for(;s!==null;){var l=ZP(s);if(l!==null&&PY(l),l=kF(e,r,i,o),l===null&&nF(e,r,o,B2,i),l===s)break;s=l}s!==null&&o.stopPropagation()}else nF(e,r,o,null,i)}}var B2=null;function kF(e,r,i,o){if(B2=null,e=l4(o),e=dO(e),e!==null)if(r=TO(e),r===null)e=null;else if(i=r.tag,i===13){if(e=RY(r),e!==null)return e;e=null}else if(i===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;e=null}else r!==e&&(e=null);return B2=e,null}function xY(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Gct()){case d4:return 1;case AY:return 4;case j2:case qct:return 16;case OY:return 536870912;default:return 16}default:return 16}}var hI=null,m4=null,I2=null;function jY(){if(I2)return I2;var e,r=m4,i=r.length,o,s="value"in hI?hI.value:hI.textContent,l=s.length;for(e=0;e<i&&r[e]===s[e];e++);var d=i-e;for(o=1;o<=d&&r[i-o]===s[l-o];o++);return I2=s.slice(e,1<o?1-o:void 0)}function C2(e){var r=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&r===13&&(e=13)):e=r,e===10&&(e=13),32<=e||e===13?e:0}function h2(){return!0}function fK(){return!1}function xS(e){function r(i,o,s,l,d){this._reactName=i,this._targetInst=s,this.type=o,this.nativeEvent=l,this.target=d,this.currentTarget=null;for(var h in e)e.hasOwnProperty(h)&&(i=e[h],this[h]=i?i(l):l[h]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?h2:fK,this.isPropagationStopped=fK,this}return Z_(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=h2)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=h2)},persist:function(){},isPersistent:h2}),r}var VN={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},E4=xS(VN),QP=Z_({},VN,{view:0,detail:0}),nut=xS(QP),XV,QV,mP,sM=Z_({},QP,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_4,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==mP&&(mP&&e.type==="mousemove"?(XV=e.screenX-mP.screenX,QV=e.screenY-mP.screenY):QV=XV=0,mP=e),XV)},movementY:function(e){return"movementY"in e?e.movementY:QV}}),mK=xS(sM),rut=Z_({},sM,{dataTransfer:0}),iut=xS(rut),out=Z_({},QP,{relatedTarget:0}),ZV=xS(out),sut=Z_({},VN,{animationName:0,elapsedTime:0,pseudoElement:0}),aut=xS(sut),cut=Z_({},VN,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),uut=xS(cut),lut=Z_({},VN,{data:0}),EK=xS(lut),dut={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hut={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},put={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fut(e){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(e):(e=put[e])?!!r[e]:!1}function _4(){return fut}var mut=Z_({},QP,{key:function(e){if(e.key){var r=dut[e.key]||e.key;if(r!=="Unidentified")return r}return e.type==="keypress"?(e=C2(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?hut[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_4,charCode:function(e){return e.type==="keypress"?C2(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?C2(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Eut=xS(mut),_ut=Z_({},sM,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_K=xS(_ut),gut=Z_({},QP,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_4}),vut=xS(gut),yut=Z_({},VN,{propertyName:0,elapsedTime:0,pseudoElement:0}),Sut=xS(yut),Tut=Z_({},sM,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),but=xS(Tut),Rut=[9,13,27,32],g4=jR&&"CompositionEvent"in window,IP=null;jR&&"documentMode"in document&&(IP=document.documentMode);var wut=jR&&"TextEvent"in window&&!IP,VY=jR&&(!g4||IP&&8<IP&&11>=IP),gK=" ",vK=!1;function FY(e,r){switch(e){case"keyup":return Rut.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function BY(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var EN=!1;function Iut(e,r){switch(e){case"compositionend":return BY(r);case"keypress":return r.which!==32?null:(vK=!0,gK);case"textInput":return e=r.data,e===gK&&vK?null:e;default:return null}}function Cut(e,r){if(EN)return e==="compositionend"||!g4&&FY(e,r)?(e=jY(),I2=m4=hI=null,EN=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return VY&&r.locale!=="ko"?null:r.data;default:return null}}var Aut={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yK(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r==="input"?!!Aut[e.type]:r==="textarea"}function GY(e,r,i,o){vY(o),r=G2(r,"onChange"),0<r.length&&(i=new E4("onChange","change",null,i,o),e.push({event:i,listeners:r}))}var CP=null,VP=null;function Out(e){$Y(e,0)}function aM(e){var r=vN(e);if(hY(r))return e}function Nut(e,r){if(e==="change")return r}var qY=!1;jR&&(jR?(f2="oninput"in document,f2||($V=document.createElement("div"),$V.setAttribute("oninput","return;"),f2=typeof $V.oninput=="function"),p2=f2):p2=!1,qY=p2&&(!document.documentMode||9<document.documentMode));var p2,f2,$V;function SK(){CP&&(CP.detachEvent("onpropertychange",WY),VP=CP=null)}function WY(e){if(e.propertyName==="value"&&aM(VP)){var r=[];GY(r,VP,e,l4(e)),bY(Out,r)}}function kut(e,r,i){e==="focusin"?(SK(),CP=r,VP=i,CP.attachEvent("onpropertychange",WY)):e==="focusout"&&SK()}function Put(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return aM(VP)}function Dut(e,r){if(e==="click")return aM(r)}function Lut(e,r){if(e==="input"||e==="change")return aM(r)}function Mut(e,r){return e===r&&(e!==0||1/e===1/r)||e!==e&&r!==r}var FT=typeof Object.is=="function"?Object.is:Mut;function FP(e,r){if(FT(e,r))return!0;if(typeof e!="object"||e===null||typeof r!="object"||r===null)return!1;var i=Object.keys(e),o=Object.keys(r);if(i.length!==o.length)return!1;for(o=0;o<i.length;o++){var s=i[o];if(!pF.call(r,s)||!FT(e[s],r[s]))return!1}return!0}function TK(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function bK(e,r){var i=TK(e);e=0;for(var o;i;){if(i.nodeType===3){if(o=e+i.textContent.length,e<=r&&o>=r)return{node:i,offset:r-e};e=o}t:{for(;i;){if(i.nextSibling){i=i.nextSibling;break t}i=i.parentNode}i=void 0}i=TK(i)}}function HY(e,r){return e&&r?e===r?!0:e&&e.nodeType===3?!1:r&&r.nodeType===3?HY(e,r.parentNode):"contains"in e?e.contains(r):e.compareDocumentPosition?!!(e.compareDocumentPosition(r)&16):!1:!1}function KY(){for(var e=window,r=M2();r instanceof e.HTMLIFrameElement;){try{var i=typeof r.contentWindow.location.href=="string"}catch{i=!1}if(i)e=r.contentWindow;else break;r=M2(e.document)}return r}function v4(e){var r=e&&e.nodeName&&e.nodeName.toLowerCase();return r&&(r==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||r==="textarea"||e.contentEditable==="true")}function Uut(e){var r=KY(),i=e.focusedElem,o=e.selectionRange;if(r!==i&&i&&i.ownerDocument&&HY(i.ownerDocument.documentElement,i)){if(o!==null&&v4(i)){if(r=o.start,e=o.end,e===void 0&&(e=r),"selectionStart"in i)i.selectionStart=r,i.selectionEnd=Math.min(e,i.value.length);else if(e=(r=i.ownerDocument||document)&&r.defaultView||window,e.getSelection){e=e.getSelection();var s=i.textContent.length,l=Math.min(o.start,s);o=o.end===void 0?l:Math.min(o.end,s),!e.extend&&l>o&&(s=o,o=l,l=s),s=bK(i,l);var d=bK(i,o);s&&d&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==d.node||e.focusOffset!==d.offset)&&(r=r.createRange(),r.setStart(s.node,s.offset),e.removeAllRanges(),l>o?(e.addRange(r),e.extend(d.node,d.offset)):(r.setEnd(d.node,d.offset),e.addRange(r)))}}for(r=[],e=i;e=e.parentNode;)e.nodeType===1&&r.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<r.length;i++)e=r[i],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var xut=jR&&"documentMode"in document&&11>=document.documentMode,_N=null,PF=null,AP=null,DF=!1;function RK(e,r,i){var o=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;DF||_N==null||_N!==M2(o)||(o=_N,"selectionStart"in o&&v4(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),AP&&FP(AP,o)||(AP=o,o=G2(PF,"onSelect"),0<o.length&&(r=new E4("onSelect","select",null,r,i),e.push({event:r,listeners:o}),r.target=_N)))}function m2(e,r){var i={};return i[e.toLowerCase()]=r.toLowerCase(),i["Webkit"+e]="webkit"+r,i["Moz"+e]="moz"+r,i}var gN={animationend:m2("Animation","AnimationEnd"),animationiteration:m2("Animation","AnimationIteration"),animationstart:m2("Animation","AnimationStart"),transitionend:m2("Transition","TransitionEnd")},tF={},zY={};jR&&(zY=document.createElement("div").style,"AnimationEvent"in window||(delete gN.animationend.animation,delete gN.animationiteration.animation,delete gN.animationstart.animation),"TransitionEvent"in window||delete gN.transitionend.transition);function cM(e){if(tF[e])return tF[e];if(!gN[e])return e;var r=gN[e],i;for(i in r)if(r.hasOwnProperty(i)&&i in zY)return tF[e]=r[i];return e}var YY=cM("animationend"),JY=cM("animationiteration"),XY=cM("animationstart"),QY=cM("transitionend"),ZY=new Map,wK="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function RI(e,r){ZY.set(e,r),SO(r,[e])}for(E2=0;E2<wK.length;E2++)_2=wK[E2],IK=_2.toLowerCase(),CK=_2[0].toUpperCase()+_2.slice(1),RI(IK,"on"+CK);var _2,IK,CK,E2;RI(YY,"onAnimationEnd");RI(JY,"onAnimationIteration");RI(XY,"onAnimationStart");RI("dblclick","onDoubleClick");RI("focusin","onFocus");RI("focusout","onBlur");RI(QY,"onTransitionEnd");PN("onMouseEnter",["mouseout","mouseover"]);PN("onMouseLeave",["mouseout","mouseover"]);PN("onPointerEnter",["pointerout","pointerover"]);PN("onPointerLeave",["pointerout","pointerover"]);SO("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));SO("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));SO("onBeforeInput",["compositionend","keypress","textInput","paste"]);SO("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));SO("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));SO("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bP="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jut=new Set("cancel close invalid load scroll toggle".split(" ").concat(bP));function AK(e,r,i){var o=e.type||"unknown-event";e.currentTarget=i,jct(o,r,void 0,e),e.currentTarget=null}function $Y(e,r){r=(r&4)!==0;for(var i=0;i<e.length;i++){var o=e[i],s=o.event;o=o.listeners;t:{var l=void 0;if(r)for(var d=o.length-1;0<=d;d--){var h=o[d],p=h.instance,f=h.currentTarget;if(h=h.listener,p!==l&&s.isPropagationStopped())break t;AK(s,h,f),l=p}else for(d=0;d<o.length;d++){if(h=o[d],p=h.instance,f=h.currentTarget,h=h.listener,p!==l&&s.isPropagationStopped())break t;AK(s,h,f),l=p}}}if(x2)throw e=AF,x2=!1,AF=null,e}function F_(e,r){var i=r[jF];i===void 0&&(i=r[jF]=new Set);var o=e+"__bubble";i.has(o)||(t7(r,e,2,!1),i.add(o))}function eF(e,r,i){var o=0;r&&(o|=4),t7(i,e,o,r)}var g2="_reactListening"+Math.random().toString(36).slice(2);function BP(e){if(!e[g2]){e[g2]=!0,aY.forEach(function(i){i!=="selectionchange"&&(jut.has(i)||eF(i,!1,e),eF(i,!0,e))});var r=e.nodeType===9?e:e.ownerDocument;r===null||r[g2]||(r[g2]=!0,eF("selectionchange",!1,r))}}function t7(e,r,i,o){switch(xY(r)){case 1:var s=tut;break;case 4:s=eut;break;default:s=f4}i=s.bind(null,r,i,e),s=void 0,!CF||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(s=!0),o?s!==void 0?e.addEventListener(r,i,{capture:!0,passive:s}):e.addEventListener(r,i,!0):s!==void 0?e.addEventListener(r,i,{passive:s}):e.addEventListener(r,i,!1)}function nF(e,r,i,o,s){var l=o;if(!(r&1)&&!(r&2)&&o!==null)t:for(;;){if(o===null)return;var d=o.tag;if(d===3||d===4){var h=o.stateNode.containerInfo;if(h===s||h.nodeType===8&&h.parentNode===s)break;if(d===4)for(d=o.return;d!==null;){var p=d.tag;if((p===3||p===4)&&(p=d.stateNode.containerInfo,p===s||p.nodeType===8&&p.parentNode===s))return;d=d.return}for(;h!==null;){if(d=dO(h),d===null)return;if(p=d.tag,p===5||p===6){o=l=d;continue t}h=h.parentNode}}o=o.return}bY(function(){var f=l,_=l4(i),g=[];t:{var b=ZY.get(e);if(b!==void 0){var C=E4,k=e;switch(e){case"keypress":if(C2(i)===0)break t;case"keydown":case"keyup":C=Eut;break;case"focusin":k="focus",C=ZV;break;case"focusout":k="blur",C=ZV;break;case"beforeblur":case"afterblur":C=ZV;break;case"click":if(i.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":C=mK;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":C=iut;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":C=vut;break;case YY:case JY:case XY:C=aut;break;case QY:C=Sut;break;case"scroll":C=nut;break;case"wheel":C=but;break;case"copy":case"cut":case"paste":C=uut;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":C=_K}var A=(r&4)!==0,P=!A&&e==="scroll",x=A?b!==null?b+"Capture":null:b;A=[];for(var j=f,z;j!==null;){z=j;var _t=z.stateNode;if(z.tag===5&&_t!==null&&(z=_t,x!==null&&(_t=MP(j,x),_t!=null&&A.push(GP(j,_t,z)))),P)break;j=j.return}0<A.length&&(b=new C(b,k,null,i,_),g.push({event:b,listeners:A}))}}if(!(r&7)){t:{if(b=e==="mouseover"||e==="pointerover",C=e==="mouseout"||e==="pointerout",b&&i!==wF&&(k=i.relatedTarget||i.fromElement)&&(dO(k)||k[VR]))break t;if((C||b)&&(b=_.window===_?_:(b=_.ownerDocument)?b.defaultView||b.parentWindow:window,C?(k=i.relatedTarget||i.toElement,C=f,k=k?dO(k):null,k!==null&&(P=TO(k),k!==P||k.tag!==5&&k.tag!==6)&&(k=null)):(C=null,k=f),C!==k)){if(A=mK,_t="onMouseLeave",x="onMouseEnter",j="mouse",(e==="pointerout"||e==="pointerover")&&(A=_K,_t="onPointerLeave",x="onPointerEnter",j="pointer"),P=C==null?b:vN(C),z=k==null?b:vN(k),b=new A(_t,j+"leave",C,i,_),b.target=P,b.relatedTarget=z,_t=null,dO(_)===f&&(A=new A(x,j+"enter",k,i,_),A.target=z,A.relatedTarget=P,_t=A),P=_t,C&&k)e:{for(A=C,x=k,j=0,z=A;z;z=pN(z))j++;for(z=0,_t=x;_t;_t=pN(_t))z++;for(;0<j-z;)A=pN(A),j--;for(;0<z-j;)x=pN(x),z--;for(;j--;){if(A===x||x!==null&&A===x.alternate)break e;A=pN(A),x=pN(x)}A=null}else A=null;C!==null&&OK(g,b,C,A,!1),k!==null&&P!==null&&OK(g,P,k,A,!0)}}t:{if(b=f?vN(f):window,C=b.nodeName&&b.nodeName.toLowerCase(),C==="select"||C==="input"&&b.type==="file")var ue=Nut;else if(yK(b))if(qY)ue=Lut;else{ue=Put;var _n=kut}else(C=b.nodeName)&&C.toLowerCase()==="input"&&(b.type==="checkbox"||b.type==="radio")&&(ue=Dut);if(ue&&(ue=ue(e,f))){GY(g,ue,i,_);break t}_n&&_n(e,b,f),e==="focusout"&&(_n=b._wrapperState)&&_n.controlled&&b.type==="number"&&yF(b,"number",b.value)}switch(_n=f?vN(f):window,e){case"focusin":(yK(_n)||_n.contentEditable==="true")&&(_N=_n,PF=f,AP=null);break;case"focusout":AP=PF=_N=null;break;case"mousedown":DF=!0;break;case"contextmenu":case"mouseup":case"dragend":DF=!1,RK(g,i,_);break;case"selectionchange":if(xut)break;case"keydown":case"keyup":RK(g,i,_)}var Ei;if(g4)t:{switch(e){case"compositionstart":var _s="onCompositionStart";break t;case"compositionend":_s="onCompositionEnd";break t;case"compositionupdate":_s="onCompositionUpdate";break t}_s=void 0}else EN?FY(e,i)&&(_s="onCompositionEnd"):e==="keydown"&&i.keyCode===229&&(_s="onCompositionStart");_s&&(VY&&i.locale!=="ko"&&(EN||_s!=="onCompositionStart"?_s==="onCompositionEnd"&&EN&&(Ei=jY()):(hI=_,m4="value"in hI?hI.value:hI.textContent,EN=!0)),_n=G2(f,_s),0<_n.length&&(_s=new EK(_s,e,null,i,_),g.push({event:_s,listeners:_n}),Ei?_s.data=Ei:(Ei=BY(i),Ei!==null&&(_s.data=Ei)))),(Ei=wut?Iut(e,i):Cut(e,i))&&(f=G2(f,"onBeforeInput"),0<f.length&&(_=new EK("onBeforeInput","beforeinput",null,i,_),g.push({event:_,listeners:f}),_.data=Ei))}$Y(g,r)})}function GP(e,r,i){return{instance:e,listener:r,currentTarget:i}}function G2(e,r){for(var i=r+"Capture",o=[];e!==null;){var s=e,l=s.stateNode;s.tag===5&&l!==null&&(s=l,l=MP(e,i),l!=null&&o.unshift(GP(e,l,s)),l=MP(e,r),l!=null&&o.push(GP(e,l,s))),e=e.return}return o}function pN(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function OK(e,r,i,o,s){for(var l=r._reactName,d=[];i!==null&&i!==o;){var h=i,p=h.alternate,f=h.stateNode;if(p!==null&&p===o)break;h.tag===5&&f!==null&&(h=f,s?(p=MP(i,l),p!=null&&d.unshift(GP(i,p,h))):s||(p=MP(i,l),p!=null&&d.push(GP(i,p,h)))),i=i.return}d.length!==0&&e.push({event:r,listeners:d})}var Vut=/\r\n?/g,Fut=/\u0000|\uFFFD/g;function NK(e){return(typeof e=="string"?e:""+e).replace(Vut,`
`).replace(Fut,"")}function v2(e,r,i){if(r=NK(r),NK(e)!==r&&i)throw Error(lE(425))}function q2(){}var LF=null,MF=null;function UF(e,r){return e==="textarea"||e==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var xF=typeof setTimeout=="function"?setTimeout:void 0,But=typeof clearTimeout=="function"?clearTimeout:void 0,kK=typeof Promise=="function"?Promise:void 0,Gut=typeof queueMicrotask=="function"?queueMicrotask:typeof kK<"u"?function(e){return kK.resolve(null).then(e).catch(qut)}:xF;function qut(e){setTimeout(function(){throw e})}function rF(e,r){var i=r,o=0;do{var s=i.nextSibling;if(e.removeChild(i),s&&s.nodeType===8)if(i=s.data,i==="/$"){if(o===0){e.removeChild(s),jP(r);return}o--}else i!=="$"&&i!=="$?"&&i!=="$!"||o++;i=s}while(i);jP(r)}function _I(e){for(;e!=null;e=e.nextSibling){var r=e.nodeType;if(r===1||r===3)break;if(r===8){if(r=e.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return e}function PK(e){e=e.previousSibling;for(var r=0;e;){if(e.nodeType===8){var i=e.data;if(i==="$"||i==="$!"||i==="$?"){if(r===0)return e;r--}else i==="/$"&&r++}e=e.previousSibling}return null}var FN=Math.random().toString(36).slice(2),iR="__reactFiber$"+FN,qP="__reactProps$"+FN,VR="__reactContainer$"+FN,jF="__reactEvents$"+FN,Wut="__reactListeners$"+FN,Hut="__reactHandles$"+FN;function dO(e){var r=e[iR];if(r)return r;for(var i=e.parentNode;i;){if(r=i[VR]||i[iR]){if(i=r.alternate,r.child!==null||i!==null&&i.child!==null)for(e=PK(e);e!==null;){if(i=e[iR])return i;e=PK(e)}return r}e=i,i=e.parentNode}return null}function ZP(e){return e=e[iR]||e[VR],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function vN(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(lE(33))}function uM(e){return e[qP]||null}var VF=[],yN=-1;function wI(e){return{current:e}}function B_(e){0>yN||(e.current=VF[yN],VF[yN]=null,yN--)}function x_(e,r){yN++,VF[yN]=e.current,e.current=r}var bI={},Z0=wI(bI),_S=wI(!1),EO=bI;function DN(e,r){var i=e.type.contextTypes;if(!i)return bI;var o=e.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===r)return o.__reactInternalMemoizedMaskedChildContext;var s={},l;for(l in i)s[l]=r[l];return o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=s),s}function gS(e){return e=e.childContextTypes,e!=null}function W2(){B_(_S),B_(Z0)}function DK(e,r,i){if(Z0.current!==bI)throw Error(lE(168));x_(Z0,r),x_(_S,i)}function e7(e,r,i){var o=e.stateNode;if(r=r.childContextTypes,typeof o.getChildContext!="function")return i;o=o.getChildContext();for(var s in o)if(!(s in r))throw Error(lE(108,kct(e)||"Unknown",s));return Z_({},i,o)}function H2(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||bI,EO=Z0.current,x_(Z0,e),x_(_S,_S.current),!0}function LK(e,r,i){var o=e.stateNode;if(!o)throw Error(lE(169));i?(e=e7(e,r,EO),o.__reactInternalMemoizedMergedChildContext=e,B_(_S),B_(Z0),x_(Z0,e)):B_(_S),x_(_S,i)}var LR=null,lM=!1,iF=!1;function n7(e){LR===null?LR=[e]:LR.push(e)}function Kut(e){lM=!0,n7(e)}function II(){if(!iF&&LR!==null){iF=!0;var e=0,r=T_;try{var i=LR;for(T_=1;e<i.length;e++){var o=i[e];do o=o(!0);while(o!==null)}LR=null,lM=!1}catch(s){throw LR!==null&&(LR=LR.slice(e+1)),CY(d4,II),s}finally{T_=r,iF=!1}}return null}var SN=[],TN=0,K2=null,z2=0,nT=[],rT=0,_O=null,MR=1,UR="";function uO(e,r){SN[TN++]=z2,SN[TN++]=K2,K2=e,z2=r}function r7(e,r,i){nT[rT++]=MR,nT[rT++]=UR,nT[rT++]=_O,_O=e;var o=MR;e=UR;var s=32-jT(o)-1;o&=~(1<<s),i+=1;var l=32-jT(r)+s;if(30<l){var d=s-s%5;l=(o&(1<<d)-1).toString(32),o>>=d,s-=d,MR=1<<32-jT(r)+s|i<<s|o,UR=l+e}else MR=1<<l|i<<s|o,UR=e}function y4(e){e.return!==null&&(uO(e,1),r7(e,1,0))}function S4(e){for(;e===K2;)K2=SN[--TN],SN[TN]=null,z2=SN[--TN],SN[TN]=null;for(;e===_O;)_O=nT[--rT],nT[rT]=null,UR=nT[--rT],nT[rT]=null,MR=nT[--rT],nT[rT]=null}var MS=null,LS=null,z_=!1,xT=null;function i7(e,r){var i=iT(5,null,null,0);i.elementType="DELETED",i.stateNode=r,i.return=e,r=e.deletions,r===null?(e.deletions=[i],e.flags|=16):r.push(i)}function MK(e,r){switch(e.tag){case 5:var i=e.type;return r=r.nodeType!==1||i.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(e.stateNode=r,MS=e,LS=_I(r.firstChild),!0):!1;case 6:return r=e.pendingProps===""||r.nodeType!==3?null:r,r!==null?(e.stateNode=r,MS=e,LS=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(i=_O!==null?{id:MR,overflow:UR}:null,e.memoizedState={dehydrated:r,treeContext:i,retryLane:1073741824},i=iT(18,null,null,0),i.stateNode=r,i.return=e,e.child=i,MS=e,LS=null,!0):!1;default:return!1}}function FF(e){return(e.mode&1)!==0&&(e.flags&128)===0}function BF(e){if(z_){var r=LS;if(r){var i=r;if(!MK(e,r)){if(FF(e))throw Error(lE(418));r=_I(i.nextSibling);var o=MS;r&&MK(e,r)?i7(o,i):(e.flags=e.flags&-4097|2,z_=!1,MS=e)}}else{if(FF(e))throw Error(lE(418));e.flags=e.flags&-4097|2,z_=!1,MS=e}}}function UK(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;MS=e}function y2(e){if(e!==MS)return!1;if(!z_)return UK(e),z_=!0,!1;var r;if((r=e.tag!==3)&&!(r=e.tag!==5)&&(r=e.type,r=r!=="head"&&r!=="body"&&!UF(e.type,e.memoizedProps)),r&&(r=LS)){if(FF(e))throw o7(),Error(lE(418));for(;r;)i7(e,r),r=_I(r.nextSibling)}if(UK(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(lE(317));t:{for(e=e.nextSibling,r=0;e;){if(e.nodeType===8){var i=e.data;if(i==="/$"){if(r===0){LS=_I(e.nextSibling);break t}r--}else i!=="$"&&i!=="$!"&&i!=="$?"||r++}e=e.nextSibling}LS=null}}else LS=MS?_I(e.stateNode.nextSibling):null;return!0}function o7(){for(var e=LS;e;)e=_I(e.nextSibling)}function LN(){LS=MS=null,z_=!1}function T4(e){xT===null?xT=[e]:xT.push(e)}var zut=GR.ReactCurrentBatchConfig;function EP(e,r,i){if(e=i.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(lE(309));var o=i.stateNode}if(!o)throw Error(lE(147,e));var s=o,l=""+e;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===l?r.ref:(r=function(d){var h=s.refs;d===null?delete h[l]:h[l]=d},r._stringRef=l,r)}if(typeof e!="string")throw Error(lE(284));if(!i._owner)throw Error(lE(290,e))}return e}function S2(e,r){throw e=Object.prototype.toString.call(r),Error(lE(31,e==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":e))}function xK(e){var r=e._init;return r(e._payload)}function s7(e){function r(x,j){if(e){var z=x.deletions;z===null?(x.deletions=[j],x.flags|=16):z.push(j)}}function i(x,j){if(!e)return null;for(;j!==null;)r(x,j),j=j.sibling;return null}function o(x,j){for(x=new Map;j!==null;)j.key!==null?x.set(j.key,j):x.set(j.index,j),j=j.sibling;return x}function s(x,j){return x=SI(x,j),x.index=0,x.sibling=null,x}function l(x,j,z){return x.index=z,e?(z=x.alternate,z!==null?(z=z.index,z<j?(x.flags|=2,j):z):(x.flags|=2,j)):(x.flags|=1048576,j)}function d(x){return e&&x.alternate===null&&(x.flags|=2),x}function h(x,j,z,_t){return j===null||j.tag!==6?(j=dF(z,x.mode,_t),j.return=x,j):(j=s(j,z),j.return=x,j)}function p(x,j,z,_t){var ue=z.type;return ue===mN?_(x,j,z.props.children,_t,z.key):j!==null&&(j.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===cI&&xK(ue)===j.type)?(_t=s(j,z.props),_t.ref=EP(x,j,z),_t.return=x,_t):(_t=L2(z.type,z.key,z.props,null,x.mode,_t),_t.ref=EP(x,j,z),_t.return=x,_t)}function f(x,j,z,_t){return j===null||j.tag!==4||j.stateNode.containerInfo!==z.containerInfo||j.stateNode.implementation!==z.implementation?(j=hF(z,x.mode,_t),j.return=x,j):(j=s(j,z.children||[]),j.return=x,j)}function _(x,j,z,_t,ue){return j===null||j.tag!==7?(j=mO(z,x.mode,_t,ue),j.return=x,j):(j=s(j,z),j.return=x,j)}function g(x,j,z){if(typeof j=="string"&&j!==""||typeof j=="number")return j=dF(""+j,x.mode,z),j.return=x,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case s2:return z=L2(j.type,j.key,j.props,null,x.mode,z),z.ref=EP(x,null,j),z.return=x,z;case fN:return j=hF(j,x.mode,z),j.return=x,j;case cI:var _t=j._init;return g(x,_t(j._payload),z)}if(SP(j)||hP(j))return j=mO(j,x.mode,z,null),j.return=x,j;S2(x,j)}return null}function b(x,j,z,_t){var ue=j!==null?j.key:null;if(typeof z=="string"&&z!==""||typeof z=="number")return ue!==null?null:h(x,j,""+z,_t);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case s2:return z.key===ue?p(x,j,z,_t):null;case fN:return z.key===ue?f(x,j,z,_t):null;case cI:return ue=z._init,b(x,j,ue(z._payload),_t)}if(SP(z)||hP(z))return ue!==null?null:_(x,j,z,_t,null);S2(x,z)}return null}function C(x,j,z,_t,ue){if(typeof _t=="string"&&_t!==""||typeof _t=="number")return x=x.get(z)||null,h(j,x,""+_t,ue);if(typeof _t=="object"&&_t!==null){switch(_t.$$typeof){case s2:return x=x.get(_t.key===null?z:_t.key)||null,p(j,x,_t,ue);case fN:return x=x.get(_t.key===null?z:_t.key)||null,f(j,x,_t,ue);case cI:var _n=_t._init;return C(x,j,z,_n(_t._payload),ue)}if(SP(_t)||hP(_t))return x=x.get(z)||null,_(j,x,_t,ue,null);S2(j,_t)}return null}function k(x,j,z,_t){for(var ue=null,_n=null,Ei=j,_s=j=0,kc=null;Ei!==null&&_s<z.length;_s++){Ei.index>_s?(kc=Ei,Ei=null):kc=Ei.sibling;var _i=b(x,Ei,z[_s],_t);if(_i===null){Ei===null&&(Ei=kc);break}e&&Ei&&_i.alternate===null&&r(x,Ei),j=l(_i,j,_s),_n===null?ue=_i:_n.sibling=_i,_n=_i,Ei=kc}if(_s===z.length)return i(x,Ei),z_&&uO(x,_s),ue;if(Ei===null){for(;_s<z.length;_s++)Ei=g(x,z[_s],_t),Ei!==null&&(j=l(Ei,j,_s),_n===null?ue=Ei:_n.sibling=Ei,_n=Ei);return z_&&uO(x,_s),ue}for(Ei=o(x,Ei);_s<z.length;_s++)kc=C(Ei,x,_s,z[_s],_t),kc!==null&&(e&&kc.alternate!==null&&Ei.delete(kc.key===null?_s:kc.key),j=l(kc,j,_s),_n===null?ue=kc:_n.sibling=kc,_n=kc);return e&&Ei.forEach(function(_h){return r(x,_h)}),z_&&uO(x,_s),ue}function A(x,j,z,_t){var ue=hP(z);if(typeof ue!="function")throw Error(lE(150));if(z=ue.call(z),z==null)throw Error(lE(151));for(var _n=ue=null,Ei=j,_s=j=0,kc=null,_i=z.next();Ei!==null&&!_i.done;_s++,_i=z.next()){Ei.index>_s?(kc=Ei,Ei=null):kc=Ei.sibling;var _h=b(x,Ei,_i.value,_t);if(_h===null){Ei===null&&(Ei=kc);break}e&&Ei&&_h.alternate===null&&r(x,Ei),j=l(_h,j,_s),_n===null?ue=_h:_n.sibling=_h,_n=_h,Ei=kc}if(_i.done)return i(x,Ei),z_&&uO(x,_s),ue;if(Ei===null){for(;!_i.done;_s++,_i=z.next())_i=g(x,_i.value,_t),_i!==null&&(j=l(_i,j,_s),_n===null?ue=_i:_n.sibling=_i,_n=_i);return z_&&uO(x,_s),ue}for(Ei=o(x,Ei);!_i.done;_s++,_i=z.next())_i=C(Ei,x,_s,_i.value,_t),_i!==null&&(e&&_i.alternate!==null&&Ei.delete(_i.key===null?_s:_i.key),j=l(_i,j,_s),_n===null?ue=_i:_n.sibling=_i,_n=_i);return e&&Ei.forEach(function(_p){return r(x,_p)}),z_&&uO(x,_s),ue}function P(x,j,z,_t){if(typeof z=="object"&&z!==null&&z.type===mN&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case s2:t:{for(var ue=z.key,_n=j;_n!==null;){if(_n.key===ue){if(ue=z.type,ue===mN){if(_n.tag===7){i(x,_n.sibling),j=s(_n,z.props.children),j.return=x,x=j;break t}}else if(_n.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===cI&&xK(ue)===_n.type){i(x,_n.sibling),j=s(_n,z.props),j.ref=EP(x,_n,z),j.return=x,x=j;break t}i(x,_n);break}else r(x,_n);_n=_n.sibling}z.type===mN?(j=mO(z.props.children,x.mode,_t,z.key),j.return=x,x=j):(_t=L2(z.type,z.key,z.props,null,x.mode,_t),_t.ref=EP(x,j,z),_t.return=x,x=_t)}return d(x);case fN:t:{for(_n=z.key;j!==null;){if(j.key===_n)if(j.tag===4&&j.stateNode.containerInfo===z.containerInfo&&j.stateNode.implementation===z.implementation){i(x,j.sibling),j=s(j,z.children||[]),j.return=x,x=j;break t}else{i(x,j);break}else r(x,j);j=j.sibling}j=hF(z,x.mode,_t),j.return=x,x=j}return d(x);case cI:return _n=z._init,P(x,j,_n(z._payload),_t)}if(SP(z))return k(x,j,z,_t);if(hP(z))return A(x,j,z,_t);S2(x,z)}return typeof z=="string"&&z!==""||typeof z=="number"?(z=""+z,j!==null&&j.tag===6?(i(x,j.sibling),j=s(j,z),j.return=x,x=j):(i(x,j),j=dF(z,x.mode,_t),j.return=x,x=j),d(x)):i(x,j)}return P}var MN=s7(!0),a7=s7(!1),Y2=wI(null),J2=null,bN=null,b4=null;function R4(){b4=bN=J2=null}function w4(e){var r=Y2.current;B_(Y2),e._currentValue=r}function GF(e,r,i){for(;e!==null;){var o=e.alternate;if((e.childLanes&r)!==r?(e.childLanes|=r,o!==null&&(o.childLanes|=r)):o!==null&&(o.childLanes&r)!==r&&(o.childLanes|=r),e===i)break;e=e.return}}function NN(e,r){J2=e,b4=bN=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&r&&(ES=!0),e.firstContext=null)}function sT(e){var r=e._currentValue;if(b4!==e)if(e={context:e,memoizedValue:r,next:null},bN===null){if(J2===null)throw Error(lE(308));bN=e,J2.dependencies={lanes:0,firstContext:e}}else bN=bN.next=e;return r}var hO=null;function I4(e){hO===null?hO=[e]:hO.push(e)}function c7(e,r,i,o){var s=r.interleaved;return s===null?(i.next=i,I4(r)):(i.next=s.next,s.next=i),r.interleaved=i,FR(e,o)}function FR(e,r){e.lanes|=r;var i=e.alternate;for(i!==null&&(i.lanes|=r),i=e,e=e.return;e!==null;)e.childLanes|=r,i=e.alternate,i!==null&&(i.childLanes|=r),i=e,e=e.return;return i.tag===3?i.stateNode:null}var uI=!1;function C4(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function u7(e,r){e=e.updateQueue,r.updateQueue===e&&(r.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function xR(e,r){return{eventTime:e,lane:r,tag:0,payload:null,callback:null,next:null}}function gI(e,r,i){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,u_&2){var s=o.pending;return s===null?r.next=r:(r.next=s.next,s.next=r),o.pending=r,FR(e,i)}return s=o.interleaved,s===null?(r.next=r,I4(o)):(r.next=s.next,s.next=r),o.interleaved=r,FR(e,i)}function A2(e,r,i){if(r=r.updateQueue,r!==null&&(r=r.shared,(i&4194240)!==0)){var o=r.lanes;o&=e.pendingLanes,i|=o,r.lanes=i,h4(e,i)}}function jK(e,r){var i=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,i===o)){var s=null,l=null;if(i=i.firstBaseUpdate,i!==null){do{var d={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};l===null?s=l=d:l=l.next=d,i=i.next}while(i!==null);l===null?s=l=r:l=l.next=r}else s=l=r;i={baseState:o.baseState,firstBaseUpdate:s,lastBaseUpdate:l,shared:o.shared,effects:o.effects},e.updateQueue=i;return}e=i.lastBaseUpdate,e===null?i.firstBaseUpdate=r:e.next=r,i.lastBaseUpdate=r}function X2(e,r,i,o){var s=e.updateQueue;uI=!1;var l=s.firstBaseUpdate,d=s.lastBaseUpdate,h=s.shared.pending;if(h!==null){s.shared.pending=null;var p=h,f=p.next;p.next=null,d===null?l=f:d.next=f,d=p;var _=e.alternate;_!==null&&(_=_.updateQueue,h=_.lastBaseUpdate,h!==d&&(h===null?_.firstBaseUpdate=f:h.next=f,_.lastBaseUpdate=p))}if(l!==null){var g=s.baseState;d=0,_=f=p=null,h=l;do{var b=h.lane,C=h.eventTime;if((o&b)===b){_!==null&&(_=_.next={eventTime:C,lane:0,tag:h.tag,payload:h.payload,callback:h.callback,next:null});t:{var k=e,A=h;switch(b=r,C=i,A.tag){case 1:if(k=A.payload,typeof k=="function"){g=k.call(C,g,b);break t}g=k;break t;case 3:k.flags=k.flags&-65537|128;case 0:if(k=A.payload,b=typeof k=="function"?k.call(C,g,b):k,b==null)break t;g=Z_({},g,b);break t;case 2:uI=!0}}h.callback!==null&&h.lane!==0&&(e.flags|=64,b=s.effects,b===null?s.effects=[h]:b.push(h))}else C={eventTime:C,lane:b,tag:h.tag,payload:h.payload,callback:h.callback,next:null},_===null?(f=_=C,p=g):_=_.next=C,d|=b;if(h=h.next,h===null){if(h=s.shared.pending,h===null)break;b=h,h=b.next,b.next=null,s.lastBaseUpdate=b,s.shared.pending=null}}while(!0);if(_===null&&(p=g),s.baseState=p,s.firstBaseUpdate=f,s.lastBaseUpdate=_,r=s.shared.interleaved,r!==null){s=r;do d|=s.lane,s=s.next;while(s!==r)}else l===null&&(s.shared.lanes=0);vO|=d,e.lanes=d,e.memoizedState=g}}function VK(e,r,i){if(e=r.effects,r.effects=null,e!==null)for(r=0;r<e.length;r++){var o=e[r],s=o.callback;if(s!==null){if(o.callback=null,o=i,typeof s!="function")throw Error(lE(191,s));s.call(o)}}}var $P={},sR=wI($P),WP=wI($P),HP=wI($P);function pO(e){if(e===$P)throw Error(lE(174));return e}function A4(e,r){switch(x_(HP,r),x_(WP,e),x_(sR,$P),e=r.nodeType,e){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:TF(null,"");break;default:e=e===8?r.parentNode:r,r=e.namespaceURI||null,e=e.tagName,r=TF(r,e)}B_(sR),x_(sR,r)}function UN(){B_(sR),B_(WP),B_(HP)}function l7(e){pO(HP.current);var r=pO(sR.current),i=TF(r,e.type);r!==i&&(x_(WP,e),x_(sR,i))}function O4(e){WP.current===e&&(B_(sR),B_(WP))}var X_=wI(0);function Q2(e){for(var r=e;r!==null;){if(r.tag===13){var i=r.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var oF=[];function N4(){for(var e=0;e<oF.length;e++)oF[e]._workInProgressVersionPrimary=null;oF.length=0}var O2=GR.ReactCurrentDispatcher,sF=GR.ReactCurrentBatchConfig,gO=0,Q_=null,S0=null,O0=null,Z2=!1,OP=!1,KP=0,Yut=0;function J0(){throw Error(lE(321))}function k4(e,r){if(r===null)return!1;for(var i=0;i<r.length&&i<e.length;i++)if(!FT(e[i],r[i]))return!1;return!0}function P4(e,r,i,o,s,l){if(gO=l,Q_=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,O2.current=e===null||e.memoizedState===null?Zut:$ut,e=i(o,s),OP){l=0;do{if(OP=!1,KP=0,25<=l)throw Error(lE(301));l+=1,O0=S0=null,r.updateQueue=null,O2.current=tlt,e=i(o,s)}while(OP)}if(O2.current=$2,r=S0!==null&&S0.next!==null,gO=0,O0=S0=Q_=null,Z2=!1,r)throw Error(lE(300));return e}function D4(){var e=KP!==0;return KP=0,e}function rR(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O0===null?Q_.memoizedState=O0=e:O0=O0.next=e,O0}function aT(){if(S0===null){var e=Q_.alternate;e=e!==null?e.memoizedState:null}else e=S0.next;var r=O0===null?Q_.memoizedState:O0.next;if(r!==null)O0=r,S0=e;else{if(e===null)throw Error(lE(310));S0=e,e={memoizedState:S0.memoizedState,baseState:S0.baseState,baseQueue:S0.baseQueue,queue:S0.queue,next:null},O0===null?Q_.memoizedState=O0=e:O0=O0.next=e}return O0}function zP(e,r){return typeof r=="function"?r(e):r}function aF(e){var r=aT(),i=r.queue;if(i===null)throw Error(lE(311));i.lastRenderedReducer=e;var o=S0,s=o.baseQueue,l=i.pending;if(l!==null){if(s!==null){var d=s.next;s.next=l.next,l.next=d}o.baseQueue=s=l,i.pending=null}if(s!==null){l=s.next,o=o.baseState;var h=d=null,p=null,f=l;do{var _=f.lane;if((gO&_)===_)p!==null&&(p=p.next={lane:0,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null}),o=f.hasEagerState?f.eagerState:e(o,f.action);else{var g={lane:_,action:f.action,hasEagerState:f.hasEagerState,eagerState:f.eagerState,next:null};p===null?(h=p=g,d=o):p=p.next=g,Q_.lanes|=_,vO|=_}f=f.next}while(f!==null&&f!==l);p===null?d=o:p.next=h,FT(o,r.memoizedState)||(ES=!0),r.memoizedState=o,r.baseState=d,r.baseQueue=p,i.lastRenderedState=o}if(e=i.interleaved,e!==null){s=e;do l=s.lane,Q_.lanes|=l,vO|=l,s=s.next;while(s!==e)}else s===null&&(i.lanes=0);return[r.memoizedState,i.dispatch]}function cF(e){var r=aT(),i=r.queue;if(i===null)throw Error(lE(311));i.lastRenderedReducer=e;var o=i.dispatch,s=i.pending,l=r.memoizedState;if(s!==null){i.pending=null;var d=s=s.next;do l=e(l,d.action),d=d.next;while(d!==s);FT(l,r.memoizedState)||(ES=!0),r.memoizedState=l,r.baseQueue===null&&(r.baseState=l),i.lastRenderedState=l}return[l,o]}function d7(){}function h7(e,r){var i=Q_,o=aT(),s=r(),l=!FT(o.memoizedState,s);if(l&&(o.memoizedState=s,ES=!0),o=o.queue,L4(m7.bind(null,i,o,e),[e]),o.getSnapshot!==r||l||O0!==null&&O0.memoizedState.tag&1){if(i.flags|=2048,YP(9,f7.bind(null,i,o,s,r),void 0,null),N0===null)throw Error(lE(349));gO&30||p7(i,r,s)}return s}function p7(e,r,i){e.flags|=16384,e={getSnapshot:r,value:i},r=Q_.updateQueue,r===null?(r={lastEffect:null,stores:null},Q_.updateQueue=r,r.stores=[e]):(i=r.stores,i===null?r.stores=[e]:i.push(e))}function f7(e,r,i,o){r.value=i,r.getSnapshot=o,E7(r)&&_7(e)}function m7(e,r,i){return i(function(){E7(r)&&_7(e)})}function E7(e){var r=e.getSnapshot;e=e.value;try{var i=r();return!FT(e,i)}catch{return!0}}function _7(e){var r=FR(e,1);r!==null&&VT(r,e,1,-1)}function FK(e){var r=rR();return typeof e=="function"&&(e=e()),r.memoizedState=r.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:zP,lastRenderedState:e},r.queue=e,e=e.dispatch=Qut.bind(null,Q_,e),[r.memoizedState,e]}function YP(e,r,i,o){return e={tag:e,create:r,destroy:i,deps:o,next:null},r=Q_.updateQueue,r===null?(r={lastEffect:null,stores:null},Q_.updateQueue=r,r.lastEffect=e.next=e):(i=r.lastEffect,i===null?r.lastEffect=e.next=e:(o=i.next,i.next=e,e.next=o,r.lastEffect=e)),e}function g7(){return aT().memoizedState}function N2(e,r,i,o){var s=rR();Q_.flags|=e,s.memoizedState=YP(1|r,i,void 0,o===void 0?null:o)}function dM(e,r,i,o){var s=aT();o=o===void 0?null:o;var l=void 0;if(S0!==null){var d=S0.memoizedState;if(l=d.destroy,o!==null&&k4(o,d.deps)){s.memoizedState=YP(r,i,l,o);return}}Q_.flags|=e,s.memoizedState=YP(1|r,i,l,o)}function BK(e,r){return N2(8390656,8,e,r)}function L4(e,r){return dM(2048,8,e,r)}function v7(e,r){return dM(4,2,e,r)}function y7(e,r){return dM(4,4,e,r)}function S7(e,r){if(typeof r=="function")return e=e(),r(e),function(){r(null)};if(r!=null)return e=e(),r.current=e,function(){r.current=null}}function T7(e,r,i){return i=i!=null?i.concat([e]):null,dM(4,4,S7.bind(null,r,e),i)}function M4(){}function b7(e,r){var i=aT();r=r===void 0?null:r;var o=i.memoizedState;return o!==null&&r!==null&&k4(r,o[1])?o[0]:(i.memoizedState=[e,r],e)}function R7(e,r){var i=aT();r=r===void 0?null:r;var o=i.memoizedState;return o!==null&&r!==null&&k4(r,o[1])?o[0]:(e=e(),i.memoizedState=[e,r],e)}function w7(e,r,i){return gO&21?(FT(i,r)||(i=NY(),Q_.lanes|=i,vO|=i,e.baseState=!0),r):(e.baseState&&(e.baseState=!1,ES=!0),e.memoizedState=i)}function Jut(e,r){var i=T_;T_=i!==0&&4>i?i:4,e(!0);var o=sF.transition;sF.transition={};try{e(!1),r()}finally{T_=i,sF.transition=o}}function I7(){return aT().memoizedState}function Xut(e,r,i){var o=yI(e);if(i={lane:o,action:i,hasEagerState:!1,eagerState:null,next:null},C7(e))A7(r,i);else if(i=c7(e,r,i,o),i!==null){var s=sS();VT(i,e,o,s),O7(i,r,o)}}function Qut(e,r,i){var o=yI(e),s={lane:o,action:i,hasEagerState:!1,eagerState:null,next:null};if(C7(e))A7(r,s);else{var l=e.alternate;if(e.lanes===0&&(l===null||l.lanes===0)&&(l=r.lastRenderedReducer,l!==null))try{var d=r.lastRenderedState,h=l(d,i);if(s.hasEagerState=!0,s.eagerState=h,FT(h,d)){var p=r.interleaved;p===null?(s.next=s,I4(r)):(s.next=p.next,p.next=s),r.interleaved=s;return}}catch{}finally{}i=c7(e,r,s,o),i!==null&&(s=sS(),VT(i,e,o,s),O7(i,r,o))}}function C7(e){var r=e.alternate;return e===Q_||r!==null&&r===Q_}function A7(e,r){OP=Z2=!0;var i=e.pending;i===null?r.next=r:(r.next=i.next,i.next=r),e.pending=r}function O7(e,r,i){if(i&4194240){var o=r.lanes;o&=e.pendingLanes,i|=o,r.lanes=i,h4(e,i)}}var $2={readContext:sT,useCallback:J0,useContext:J0,useEffect:J0,useImperativeHandle:J0,useInsertionEffect:J0,useLayoutEffect:J0,useMemo:J0,useReducer:J0,useRef:J0,useState:J0,useDebugValue:J0,useDeferredValue:J0,useTransition:J0,useMutableSource:J0,useSyncExternalStore:J0,useId:J0,unstable_isNewReconciler:!1},Zut={readContext:sT,useCallback:function(e,r){return rR().memoizedState=[e,r===void 0?null:r],e},useContext:sT,useEffect:BK,useImperativeHandle:function(e,r,i){return i=i!=null?i.concat([e]):null,N2(4194308,4,S7.bind(null,r,e),i)},useLayoutEffect:function(e,r){return N2(4194308,4,e,r)},useInsertionEffect:function(e,r){return N2(4,2,e,r)},useMemo:function(e,r){var i=rR();return r=r===void 0?null:r,e=e(),i.memoizedState=[e,r],e},useReducer:function(e,r,i){var o=rR();return r=i!==void 0?i(r):r,o.memoizedState=o.baseState=r,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r},o.queue=e,e=e.dispatch=Xut.bind(null,Q_,e),[o.memoizedState,e]},useRef:function(e){var r=rR();return e={current:e},r.memoizedState=e},useState:FK,useDebugValue:M4,useDeferredValue:function(e){return rR().memoizedState=e},useTransition:function(){var e=FK(!1),r=e[0];return e=Jut.bind(null,e[1]),rR().memoizedState=e,[r,e]},useMutableSource:function(){},useSyncExternalStore:function(e,r,i){var o=Q_,s=rR();if(z_){if(i===void 0)throw Error(lE(407));i=i()}else{if(i=r(),N0===null)throw Error(lE(349));gO&30||p7(o,r,i)}s.memoizedState=i;var l={value:i,getSnapshot:r};return s.queue=l,BK(m7.bind(null,o,l,e),[e]),o.flags|=2048,YP(9,f7.bind(null,o,l,i,r),void 0,null),i},useId:function(){var e=rR(),r=N0.identifierPrefix;if(z_){var i=UR,o=MR;i=(o&~(1<<32-jT(o)-1)).toString(32)+i,r=":"+r+"R"+i,i=KP++,0<i&&(r+="H"+i.toString(32)),r+=":"}else i=Yut++,r=":"+r+"r"+i.toString(32)+":";return e.memoizedState=r},unstable_isNewReconciler:!1},$ut={readContext:sT,useCallback:b7,useContext:sT,useEffect:L4,useImperativeHandle:T7,useInsertionEffect:v7,useLayoutEffect:y7,useMemo:R7,useReducer:aF,useRef:g7,useState:function(){return aF(zP)},useDebugValue:M4,useDeferredValue:function(e){var r=aT();return w7(r,S0.memoizedState,e)},useTransition:function(){var e=aF(zP)[0],r=aT().memoizedState;return[e,r]},useMutableSource:d7,useSyncExternalStore:h7,useId:I7,unstable_isNewReconciler:!1},tlt={readContext:sT,useCallback:b7,useContext:sT,useEffect:L4,useImperativeHandle:T7,useInsertionEffect:v7,useLayoutEffect:y7,useMemo:R7,useReducer:cF,useRef:g7,useState:function(){return cF(zP)},useDebugValue:M4,useDeferredValue:function(e){var r=aT();return S0===null?r.memoizedState=e:w7(r,S0.memoizedState,e)},useTransition:function(){var e=cF(zP)[0],r=aT().memoizedState;return[e,r]},useMutableSource:d7,useSyncExternalStore:h7,useId:I7,unstable_isNewReconciler:!1};function MT(e,r){if(e&&e.defaultProps){r=Z_({},r),e=e.defaultProps;for(var i in e)r[i]===void 0&&(r[i]=e[i]);return r}return r}function qF(e,r,i,o){r=e.memoizedState,i=i(o,r),i=i==null?r:Z_({},r,i),e.memoizedState=i,e.lanes===0&&(e.updateQueue.baseState=i)}var hM={isMounted:function(e){return(e=e._reactInternals)?TO(e)===e:!1},enqueueSetState:function(e,r,i){e=e._reactInternals;var o=sS(),s=yI(e),l=xR(o,s);l.payload=r,i!=null&&(l.callback=i),r=gI(e,l,s),r!==null&&(VT(r,e,s,o),A2(r,e,s))},enqueueReplaceState:function(e,r,i){e=e._reactInternals;var o=sS(),s=yI(e),l=xR(o,s);l.tag=1,l.payload=r,i!=null&&(l.callback=i),r=gI(e,l,s),r!==null&&(VT(r,e,s,o),A2(r,e,s))},enqueueForceUpdate:function(e,r){e=e._reactInternals;var i=sS(),o=yI(e),s=xR(i,o);s.tag=2,r!=null&&(s.callback=r),r=gI(e,s,o),r!==null&&(VT(r,e,o,i),A2(r,e,o))}};function GK(e,r,i,o,s,l,d){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,l,d):r.prototype&&r.prototype.isPureReactComponent?!FP(i,o)||!FP(s,l):!0}function N7(e,r,i){var o=!1,s=bI,l=r.contextType;return typeof l=="object"&&l!==null?l=sT(l):(s=gS(r)?EO:Z0.current,o=r.contextTypes,l=(o=o!=null)?DN(e,s):bI),r=new r(i,l),e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=hM,e.stateNode=r,r._reactInternals=e,o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=l),r}function qK(e,r,i,o){e=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(i,o),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(i,o),r.state!==e&&hM.enqueueReplaceState(r,r.state,null)}function WF(e,r,i,o){var s=e.stateNode;s.props=i,s.state=e.memoizedState,s.refs={},C4(e);var l=r.contextType;typeof l=="object"&&l!==null?s.context=sT(l):(l=gS(r)?EO:Z0.current,s.context=DN(e,l)),s.state=e.memoizedState,l=r.getDerivedStateFromProps,typeof l=="function"&&(qF(e,r,l,i),s.state=e.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(r=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),r!==s.state&&hM.enqueueReplaceState(s,s.state,null),X2(e,i,s,o),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function xN(e,r){try{var i="",o=r;do i+=Nct(o),o=o.return;while(o);var s=i}catch(l){s=`
Error generating stack: `+l.message+`
`+l.stack}return{value:e,source:r,stack:s,digest:null}}function uF(e,r,i){return{value:e,source:null,stack:i??null,digest:r??null}}function HF(e,r){try{console.error(r.value)}catch(i){setTimeout(function(){throw i})}}var elt=typeof WeakMap=="function"?WeakMap:Map;function k7(e,r,i){i=xR(-1,i),i.tag=3,i.payload={element:null};var o=r.value;return i.callback=function(){eM||(eM=!0,t4=o),HF(e,r)},i}function P7(e,r,i){i=xR(-1,i),i.tag=3;var o=e.type.getDerivedStateFromError;if(typeof o=="function"){var s=r.value;i.payload=function(){return o(s)},i.callback=function(){HF(e,r)}}var l=e.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(i.callback=function(){HF(e,r),typeof o!="function"&&(vI===null?vI=new Set([this]):vI.add(this));var d=r.stack;this.componentDidCatch(r.value,{componentStack:d!==null?d:""})}),i}function WK(e,r,i){var o=e.pingCache;if(o===null){o=e.pingCache=new elt;var s=new Set;o.set(r,s)}else s=o.get(r),s===void 0&&(s=new Set,o.set(r,s));s.has(i)||(s.add(i),e=mlt.bind(null,e,r,i),r.then(e,e))}function HK(e){do{var r;if((r=e.tag===13)&&(r=e.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return e;e=e.return}while(e!==null);return null}function KK(e,r,i,o,s){return e.mode&1?(e.flags|=65536,e.lanes=s,e):(e===r?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(r=xR(-1,1),r.tag=2,gI(i,r,1))),i.lanes|=1),e)}var nlt=GR.ReactCurrentOwner,ES=!1;function oS(e,r,i,o){r.child=e===null?a7(r,null,i,o):MN(r,e.child,i,o)}function zK(e,r,i,o,s){i=i.render;var l=r.ref;return NN(r,s),o=P4(e,r,i,o,l,s),i=D4(),e!==null&&!ES?(r.updateQueue=e.updateQueue,r.flags&=-2053,e.lanes&=~s,BR(e,r,s)):(z_&&i&&y4(r),r.flags|=1,oS(e,r,o,s),r.child)}function YK(e,r,i,o,s){if(e===null){var l=i.type;return typeof l=="function"&&!q4(l)&&l.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(r.tag=15,r.type=l,D7(e,r,l,o,s)):(e=L2(i.type,null,o,r,r.mode,s),e.ref=r.ref,e.return=r,r.child=e)}if(l=e.child,!(e.lanes&s)){var d=l.memoizedProps;if(i=i.compare,i=i!==null?i:FP,i(d,o)&&e.ref===r.ref)return BR(e,r,s)}return r.flags|=1,e=SI(l,o),e.ref=r.ref,e.return=r,r.child=e}function D7(e,r,i,o,s){if(e!==null){var l=e.memoizedProps;if(FP(l,o)&&e.ref===r.ref)if(ES=!1,r.pendingProps=o=l,(e.lanes&s)!==0)e.flags&131072&&(ES=!0);else return r.lanes=e.lanes,BR(e,r,s)}return KF(e,r,i,o,s)}function L7(e,r,i){var o=r.pendingProps,s=o.children,l=e!==null?e.memoizedState:null;if(o.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},x_(wN,DS),DS|=i;else{if(!(i&1073741824))return e=l!==null?l.baseLanes|i:i,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:e,cachePool:null,transitions:null},r.updateQueue=null,x_(wN,DS),DS|=e,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=l!==null?l.baseLanes:i,x_(wN,DS),DS|=o}else l!==null?(o=l.baseLanes|i,r.memoizedState=null):o=i,x_(wN,DS),DS|=o;return oS(e,r,s,i),r.child}function M7(e,r){var i=r.ref;(e===null&&i!==null||e!==null&&e.ref!==i)&&(r.flags|=512,r.flags|=2097152)}function KF(e,r,i,o,s){var l=gS(i)?EO:Z0.current;return l=DN(r,l),NN(r,s),i=P4(e,r,i,o,l,s),o=D4(),e!==null&&!ES?(r.updateQueue=e.updateQueue,r.flags&=-2053,e.lanes&=~s,BR(e,r,s)):(z_&&o&&y4(r),r.flags|=1,oS(e,r,i,s),r.child)}function JK(e,r,i,o,s){if(gS(i)){var l=!0;H2(r)}else l=!1;if(NN(r,s),r.stateNode===null)k2(e,r),N7(r,i,o),WF(r,i,o,s),o=!0;else if(e===null){var d=r.stateNode,h=r.memoizedProps;d.props=h;var p=d.context,f=i.contextType;typeof f=="object"&&f!==null?f=sT(f):(f=gS(i)?EO:Z0.current,f=DN(r,f));var _=i.getDerivedStateFromProps,g=typeof _=="function"||typeof d.getSnapshotBeforeUpdate=="function";g||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==o||p!==f)&&qK(r,d,o,f),uI=!1;var b=r.memoizedState;d.state=b,X2(r,o,d,s),p=r.memoizedState,h!==o||b!==p||_S.current||uI?(typeof _=="function"&&(qF(r,i,_,o),p=r.memoizedState),(h=uI||GK(r,i,h,o,b,p,f))?(g||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(r.flags|=4194308)):(typeof d.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=o,r.memoizedState=p),d.props=o,d.state=p,d.context=f,o=h):(typeof d.componentDidMount=="function"&&(r.flags|=4194308),o=!1)}else{d=r.stateNode,u7(e,r),h=r.memoizedProps,f=r.type===r.elementType?h:MT(r.type,h),d.props=f,g=r.pendingProps,b=d.context,p=i.contextType,typeof p=="object"&&p!==null?p=sT(p):(p=gS(i)?EO:Z0.current,p=DN(r,p));var C=i.getDerivedStateFromProps;(_=typeof C=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==g||b!==p)&&qK(r,d,o,p),uI=!1,b=r.memoizedState,d.state=b,X2(r,o,d,s);var k=r.memoizedState;h!==g||b!==k||_S.current||uI?(typeof C=="function"&&(qF(r,i,C,o),k=r.memoizedState),(f=uI||GK(r,i,f,o,b,k,p)||!1)?(_||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(o,k,p),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(o,k,p)),typeof d.componentDidUpdate=="function"&&(r.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof d.componentDidUpdate!="function"||h===e.memoizedProps&&b===e.memoizedState||(r.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&b===e.memoizedState||(r.flags|=1024),r.memoizedProps=o,r.memoizedState=k),d.props=o,d.state=k,d.context=p,o=f):(typeof d.componentDidUpdate!="function"||h===e.memoizedProps&&b===e.memoizedState||(r.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&b===e.memoizedState||(r.flags|=1024),o=!1)}return zF(e,r,i,o,l,s)}function zF(e,r,i,o,s,l){M7(e,r);var d=(r.flags&128)!==0;if(!o&&!d)return s&&LK(r,i,!1),BR(e,r,l);o=r.stateNode,nlt.current=r;var h=d&&typeof i.getDerivedStateFromError!="function"?null:o.render();return r.flags|=1,e!==null&&d?(r.child=MN(r,e.child,null,l),r.child=MN(r,null,h,l)):oS(e,r,h,l),r.memoizedState=o.state,s&&LK(r,i,!0),r.child}function U7(e){var r=e.stateNode;r.pendingContext?DK(e,r.pendingContext,r.pendingContext!==r.context):r.context&&DK(e,r.context,!1),A4(e,r.containerInfo)}function XK(e,r,i,o,s){return LN(),T4(s),r.flags|=256,oS(e,r,i,o),r.child}var YF={dehydrated:null,treeContext:null,retryLane:0};function JF(e){return{baseLanes:e,cachePool:null,transitions:null}}function x7(e,r,i){var o=r.pendingProps,s=X_.current,l=!1,d=(r.flags&128)!==0,h;if((h=d)||(h=e!==null&&e.memoizedState===null?!1:(s&2)!==0),h?(l=!0,r.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),x_(X_,s&1),e===null)return BF(r),e=r.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(r.mode&1?e.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(d=o.children,e=o.fallback,l?(o=r.mode,l=r.child,d={mode:"hidden",children:d},!(o&1)&&l!==null?(l.childLanes=0,l.pendingProps=d):l=mM(d,o,0,null),e=mO(e,o,i,null),l.return=r,e.return=r,l.sibling=e,r.child=l,r.child.memoizedState=JF(i),r.memoizedState=YF,e):U4(r,d));if(s=e.memoizedState,s!==null&&(h=s.dehydrated,h!==null))return rlt(e,r,d,o,h,s,i);if(l){l=o.fallback,d=r.mode,s=e.child,h=s.sibling;var p={mode:"hidden",children:o.children};return!(d&1)&&r.child!==s?(o=r.child,o.childLanes=0,o.pendingProps=p,r.deletions=null):(o=SI(s,p),o.subtreeFlags=s.subtreeFlags&14680064),h!==null?l=SI(h,l):(l=mO(l,d,i,null),l.flags|=2),l.return=r,o.return=r,o.sibling=l,r.child=o,o=l,l=r.child,d=e.child.memoizedState,d=d===null?JF(i):{baseLanes:d.baseLanes|i,cachePool:null,transitions:d.transitions},l.memoizedState=d,l.childLanes=e.childLanes&~i,r.memoizedState=YF,o}return l=e.child,e=l.sibling,o=SI(l,{mode:"visible",children:o.children}),!(r.mode&1)&&(o.lanes=i),o.return=r,o.sibling=null,e!==null&&(i=r.deletions,i===null?(r.deletions=[e],r.flags|=16):i.push(e)),r.child=o,r.memoizedState=null,o}function U4(e,r){return r=mM({mode:"visible",children:r},e.mode,0,null),r.return=e,e.child=r}function T2(e,r,i,o){return o!==null&&T4(o),MN(r,e.child,null,i),e=U4(r,r.pendingProps.children),e.flags|=2,r.memoizedState=null,e}function rlt(e,r,i,o,s,l,d){if(i)return r.flags&256?(r.flags&=-257,o=uF(Error(lE(422))),T2(e,r,d,o)):r.memoizedState!==null?(r.child=e.child,r.flags|=128,null):(l=o.fallback,s=r.mode,o=mM({mode:"visible",children:o.children},s,0,null),l=mO(l,s,d,null),l.flags|=2,o.return=r,l.return=r,o.sibling=l,r.child=o,r.mode&1&&MN(r,e.child,null,d),r.child.memoizedState=JF(d),r.memoizedState=YF,l);if(!(r.mode&1))return T2(e,r,d,null);if(s.data==="$!"){if(o=s.nextSibling&&s.nextSibling.dataset,o)var h=o.dgst;return o=h,l=Error(lE(419)),o=uF(l,o,void 0),T2(e,r,d,o)}if(h=(d&e.childLanes)!==0,ES||h){if(o=N0,o!==null){switch(d&-d){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(o.suspendedLanes|d)?0:s,s!==0&&s!==l.retryLane&&(l.retryLane=s,FR(e,s),VT(o,e,s,-1))}return G4(),o=uF(Error(lE(421))),T2(e,r,d,o)}return s.data==="$?"?(r.flags|=128,r.child=e.child,r=Elt.bind(null,e),s._reactRetry=r,null):(e=l.treeContext,LS=_I(s.nextSibling),MS=r,z_=!0,xT=null,e!==null&&(nT[rT++]=MR,nT[rT++]=UR,nT[rT++]=_O,MR=e.id,UR=e.overflow,_O=r),r=U4(r,o.children),r.flags|=4096,r)}function QK(e,r,i){e.lanes|=r;var o=e.alternate;o!==null&&(o.lanes|=r),GF(e.return,r,i)}function lF(e,r,i,o,s){var l=e.memoizedState;l===null?e.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:o,tail:i,tailMode:s}:(l.isBackwards=r,l.rendering=null,l.renderingStartTime=0,l.last=o,l.tail=i,l.tailMode=s)}function j7(e,r,i){var o=r.pendingProps,s=o.revealOrder,l=o.tail;if(oS(e,r,o.children,i),o=X_.current,o&2)o=o&1|2,r.flags|=128;else{if(e!==null&&e.flags&128)t:for(e=r.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&QK(e,i,r);else if(e.tag===19)QK(e,i,r);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===r)break t;for(;e.sibling===null;){if(e.return===null||e.return===r)break t;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}if(x_(X_,o),!(r.mode&1))r.memoizedState=null;else switch(s){case"forwards":for(i=r.child,s=null;i!==null;)e=i.alternate,e!==null&&Q2(e)===null&&(s=i),i=i.sibling;i=s,i===null?(s=r.child,r.child=null):(s=i.sibling,i.sibling=null),lF(r,!1,s,i,l);break;case"backwards":for(i=null,s=r.child,r.child=null;s!==null;){if(e=s.alternate,e!==null&&Q2(e)===null){r.child=s;break}e=s.sibling,s.sibling=i,i=s,s=e}lF(r,!0,i,null,l);break;case"together":lF(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function k2(e,r){!(r.mode&1)&&e!==null&&(e.alternate=null,r.alternate=null,r.flags|=2)}function BR(e,r,i){if(e!==null&&(r.dependencies=e.dependencies),vO|=r.lanes,!(i&r.childLanes))return null;if(e!==null&&r.child!==e.child)throw Error(lE(153));if(r.child!==null){for(e=r.child,i=SI(e,e.pendingProps),r.child=i,i.return=r;e.sibling!==null;)e=e.sibling,i=i.sibling=SI(e,e.pendingProps),i.return=r;i.sibling=null}return r.child}function ilt(e,r,i){switch(r.tag){case 3:U7(r),LN();break;case 5:l7(r);break;case 1:gS(r.type)&&H2(r);break;case 4:A4(r,r.stateNode.containerInfo);break;case 10:var o=r.type._context,s=r.memoizedProps.value;x_(Y2,o._currentValue),o._currentValue=s;break;case 13:if(o=r.memoizedState,o!==null)return o.dehydrated!==null?(x_(X_,X_.current&1),r.flags|=128,null):i&r.child.childLanes?x7(e,r,i):(x_(X_,X_.current&1),e=BR(e,r,i),e!==null?e.sibling:null);x_(X_,X_.current&1);break;case 19:if(o=(i&r.childLanes)!==0,e.flags&128){if(o)return j7(e,r,i);r.flags|=128}if(s=r.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),x_(X_,X_.current),o)break;return null;case 22:case 23:return r.lanes=0,L7(e,r,i)}return BR(e,r,i)}var V7,XF,F7,B7;V7=function(e,r){for(var i=r.child;i!==null;){if(i.tag===5||i.tag===6)e.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break;for(;i.sibling===null;){if(i.return===null||i.return===r)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};XF=function(){};F7=function(e,r,i,o){var s=e.memoizedProps;if(s!==o){e=r.stateNode,pO(sR.current);var l=null;switch(i){case"input":s=gF(e,s),o=gF(e,o),l=[];break;case"select":s=Z_({},s,{value:void 0}),o=Z_({},o,{value:void 0}),l=[];break;case"textarea":s=SF(e,s),o=SF(e,o),l=[];break;default:typeof s.onClick!="function"&&typeof o.onClick=="function"&&(e.onclick=q2)}bF(i,o);var d;i=null;for(f in s)if(!o.hasOwnProperty(f)&&s.hasOwnProperty(f)&&s[f]!=null)if(f==="style"){var h=s[f];for(d in h)h.hasOwnProperty(d)&&(i||(i={}),i[d]="")}else f!=="dangerouslySetInnerHTML"&&f!=="children"&&f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&f!=="autoFocus"&&(DP.hasOwnProperty(f)?l||(l=[]):(l=l||[]).push(f,null));for(f in o){var p=o[f];if(h=s?.[f],o.hasOwnProperty(f)&&p!==h&&(p!=null||h!=null))if(f==="style")if(h){for(d in h)!h.hasOwnProperty(d)||p&&p.hasOwnProperty(d)||(i||(i={}),i[d]="");for(d in p)p.hasOwnProperty(d)&&h[d]!==p[d]&&(i||(i={}),i[d]=p[d])}else i||(l||(l=[]),l.push(f,i)),i=p;else f==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,h=h?h.__html:void 0,p!=null&&h!==p&&(l=l||[]).push(f,p)):f==="children"?typeof p!="string"&&typeof p!="number"||(l=l||[]).push(f,""+p):f!=="suppressContentEditableWarning"&&f!=="suppressHydrationWarning"&&(DP.hasOwnProperty(f)?(p!=null&&f==="onScroll"&&F_("scroll",e),l||h===p||(l=[])):(l=l||[]).push(f,p))}i&&(l=l||[]).push("style",i);var f=l;(r.updateQueue=f)&&(r.flags|=4)}};B7=function(e,r,i,o){i!==o&&(r.flags|=4)};function _P(e,r){if(!z_)switch(e.tailMode){case"hidden":r=e.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?r||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function X0(e){var r=e.alternate!==null&&e.alternate.child===e.child,i=0,o=0;if(r)for(var s=e.child;s!==null;)i|=s.lanes|s.childLanes,o|=s.subtreeFlags&14680064,o|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)i|=s.lanes|s.childLanes,o|=s.subtreeFlags,o|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=o,e.childLanes=i,r}function olt(e,r,i){var o=r.pendingProps;switch(S4(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return X0(r),null;case 1:return gS(r.type)&&W2(),X0(r),null;case 3:return o=r.stateNode,UN(),B_(_S),B_(Z0),N4(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(e===null||e.child===null)&&(y2(r)?r.flags|=4:e===null||e.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,xT!==null&&(r4(xT),xT=null))),XF(e,r),X0(r),null;case 5:O4(r);var s=pO(HP.current);if(i=r.type,e!==null&&r.stateNode!=null)F7(e,r,i,o,s),e.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!o){if(r.stateNode===null)throw Error(lE(166));return X0(r),null}if(e=pO(sR.current),y2(r)){o=r.stateNode,i=r.type;var l=r.memoizedProps;switch(o[iR]=r,o[qP]=l,e=(r.mode&1)!==0,i){case"dialog":F_("cancel",o),F_("close",o);break;case"iframe":case"object":case"embed":F_("load",o);break;case"video":case"audio":for(s=0;s<bP.length;s++)F_(bP[s],o);break;case"source":F_("error",o);break;case"img":case"image":case"link":F_("error",o),F_("load",o);break;case"details":F_("toggle",o);break;case"input":oK(o,l),F_("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!l.multiple},F_("invalid",o);break;case"textarea":aK(o,l),F_("invalid",o)}bF(i,l),s=null;for(var d in l)if(l.hasOwnProperty(d)){var h=l[d];d==="children"?typeof h=="string"?o.textContent!==h&&(l.suppressHydrationWarning!==!0&&v2(o.textContent,h,e),s=["children",h]):typeof h=="number"&&o.textContent!==""+h&&(l.suppressHydrationWarning!==!0&&v2(o.textContent,h,e),s=["children",""+h]):DP.hasOwnProperty(d)&&h!=null&&d==="onScroll"&&F_("scroll",o)}switch(i){case"input":a2(o),sK(o,l,!0);break;case"textarea":a2(o),cK(o);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(o.onclick=q2)}o=s,r.updateQueue=o,o!==null&&(r.flags|=4)}else{d=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=mY(i)),e==="http://www.w3.org/1999/xhtml"?i==="script"?(e=d.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof o.is=="string"?e=d.createElement(i,{is:o.is}):(e=d.createElement(i),i==="select"&&(d=e,o.multiple?d.multiple=!0:o.size&&(d.size=o.size))):e=d.createElementNS(e,i),e[iR]=r,e[qP]=o,V7(e,r,!1,!1),r.stateNode=e;t:{switch(d=RF(i,o),i){case"dialog":F_("cancel",e),F_("close",e),s=o;break;case"iframe":case"object":case"embed":F_("load",e),s=o;break;case"video":case"audio":for(s=0;s<bP.length;s++)F_(bP[s],e);s=o;break;case"source":F_("error",e),s=o;break;case"img":case"image":case"link":F_("error",e),F_("load",e),s=o;break;case"details":F_("toggle",e),s=o;break;case"input":oK(e,o),s=gF(e,o),F_("invalid",e);break;case"option":s=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},s=Z_({},o,{value:void 0}),F_("invalid",e);break;case"textarea":aK(e,o),s=SF(e,o),F_("invalid",e);break;default:s=o}bF(i,s),h=s;for(l in h)if(h.hasOwnProperty(l)){var p=h[l];l==="style"?gY(e,p):l==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,p!=null&&EY(e,p)):l==="children"?typeof p=="string"?(i!=="textarea"||p!=="")&&LP(e,p):typeof p=="number"&&LP(e,""+p):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(DP.hasOwnProperty(l)?p!=null&&l==="onScroll"&&F_("scroll",e):p!=null&&s4(e,l,p,d))}switch(i){case"input":a2(e),sK(e,o,!1);break;case"textarea":a2(e),cK(e);break;case"option":o.value!=null&&e.setAttribute("value",""+TI(o.value));break;case"select":e.multiple=!!o.multiple,l=o.value,l!=null?IN(e,!!o.multiple,l,!1):o.defaultValue!=null&&IN(e,!!o.multiple,o.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=q2)}switch(i){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break t;case"img":o=!0;break t;default:o=!1}}o&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return X0(r),null;case 6:if(e&&r.stateNode!=null)B7(e,r,e.memoizedProps,o);else{if(typeof o!="string"&&r.stateNode===null)throw Error(lE(166));if(i=pO(HP.current),pO(sR.current),y2(r)){if(o=r.stateNode,i=r.memoizedProps,o[iR]=r,(l=o.nodeValue!==i)&&(e=MS,e!==null))switch(e.tag){case 3:v2(o.nodeValue,i,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&v2(o.nodeValue,i,(e.mode&1)!==0)}l&&(r.flags|=4)}else o=(i.nodeType===9?i:i.ownerDocument).createTextNode(o),o[iR]=r,r.stateNode=o}return X0(r),null;case 13:if(B_(X_),o=r.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(z_&&LS!==null&&r.mode&1&&!(r.flags&128))o7(),LN(),r.flags|=98560,l=!1;else if(l=y2(r),o!==null&&o.dehydrated!==null){if(e===null){if(!l)throw Error(lE(318));if(l=r.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(lE(317));l[iR]=r}else LN(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;X0(r),l=!1}else xT!==null&&(r4(xT),xT=null),l=!0;if(!l)return r.flags&65536?r:null}return r.flags&128?(r.lanes=i,r):(o=o!==null,o!==(e!==null&&e.memoizedState!==null)&&o&&(r.child.flags|=8192,r.mode&1&&(e===null||X_.current&1?T0===0&&(T0=3):G4())),r.updateQueue!==null&&(r.flags|=4),X0(r),null);case 4:return UN(),XF(e,r),e===null&&BP(r.stateNode.containerInfo),X0(r),null;case 10:return w4(r.type._context),X0(r),null;case 17:return gS(r.type)&&W2(),X0(r),null;case 19:if(B_(X_),l=r.memoizedState,l===null)return X0(r),null;if(o=(r.flags&128)!==0,d=l.rendering,d===null)if(o)_P(l,!1);else{if(T0!==0||e!==null&&e.flags&128)for(e=r.child;e!==null;){if(d=Q2(e),d!==null){for(r.flags|=128,_P(l,!1),o=d.updateQueue,o!==null&&(r.updateQueue=o,r.flags|=4),r.subtreeFlags=0,o=i,i=r.child;i!==null;)l=i,e=o,l.flags&=14680066,d=l.alternate,d===null?(l.childLanes=0,l.lanes=e,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=d.childLanes,l.lanes=d.lanes,l.child=d.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=d.memoizedProps,l.memoizedState=d.memoizedState,l.updateQueue=d.updateQueue,l.type=d.type,e=d.dependencies,l.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return x_(X_,X_.current&1|2),r.child}e=e.sibling}l.tail!==null&&d0()>jN&&(r.flags|=128,o=!0,_P(l,!1),r.lanes=4194304)}else{if(!o)if(e=Q2(d),e!==null){if(r.flags|=128,o=!0,i=e.updateQueue,i!==null&&(r.updateQueue=i,r.flags|=4),_P(l,!0),l.tail===null&&l.tailMode==="hidden"&&!d.alternate&&!z_)return X0(r),null}else 2*d0()-l.renderingStartTime>jN&&i!==1073741824&&(r.flags|=128,o=!0,_P(l,!1),r.lanes=4194304);l.isBackwards?(d.sibling=r.child,r.child=d):(i=l.last,i!==null?i.sibling=d:r.child=d,l.last=d)}return l.tail!==null?(r=l.tail,l.rendering=r,l.tail=r.sibling,l.renderingStartTime=d0(),r.sibling=null,i=X_.current,x_(X_,o?i&1|2:i&1),r):(X0(r),null);case 22:case 23:return B4(),o=r.memoizedState!==null,e!==null&&e.memoizedState!==null!==o&&(r.flags|=8192),o&&r.mode&1?DS&1073741824&&(X0(r),r.subtreeFlags&6&&(r.flags|=8192)):X0(r),null;case 24:return null;case 25:return null}throw Error(lE(156,r.tag))}function slt(e,r){switch(S4(r),r.tag){case 1:return gS(r.type)&&W2(),e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 3:return UN(),B_(_S),B_(Z0),N4(),e=r.flags,e&65536&&!(e&128)?(r.flags=e&-65537|128,r):null;case 5:return O4(r),null;case 13:if(B_(X_),e=r.memoizedState,e!==null&&e.dehydrated!==null){if(r.alternate===null)throw Error(lE(340));LN()}return e=r.flags,e&65536?(r.flags=e&-65537|128,r):null;case 19:return B_(X_),null;case 4:return UN(),null;case 10:return w4(r.type._context),null;case 22:case 23:return B4(),null;case 24:return null;default:return null}}var b2=!1,Q0=!1,alt=typeof WeakSet=="function"?WeakSet:Set,vE=null;function RN(e,r){var i=e.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(o){e0(e,r,o)}else i.current=null}function QF(e,r,i){try{i()}catch(o){e0(e,r,o)}}var ZK=!1;function clt(e,r){if(LF=F2,e=KY(),v4(e)){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else t:{i=(i=e.ownerDocument)&&i.defaultView||window;var o=i.getSelection&&i.getSelection();if(o&&o.rangeCount!==0){i=o.anchorNode;var s=o.anchorOffset,l=o.focusNode;o=o.focusOffset;try{i.nodeType,l.nodeType}catch{i=null;break t}var d=0,h=-1,p=-1,f=0,_=0,g=e,b=null;e:for(;;){for(var C;g!==i||s!==0&&g.nodeType!==3||(h=d+s),g!==l||o!==0&&g.nodeType!==3||(p=d+o),g.nodeType===3&&(d+=g.nodeValue.length),(C=g.firstChild)!==null;)b=g,g=C;for(;;){if(g===e)break e;if(b===i&&++f===s&&(h=d),b===l&&++_===o&&(p=d),(C=g.nextSibling)!==null)break;g=b,b=g.parentNode}g=C}i=h===-1||p===-1?null:{start:h,end:p}}else i=null}i=i||{start:0,end:0}}else i=null;for(MF={focusedElem:e,selectionRange:i},F2=!1,vE=r;vE!==null;)if(r=vE,e=r.child,(r.subtreeFlags&1028)!==0&&e!==null)e.return=r,vE=e;else for(;vE!==null;){r=vE;try{var k=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var A=k.memoizedProps,P=k.memoizedState,x=r.stateNode,j=x.getSnapshotBeforeUpdate(r.elementType===r.type?A:MT(r.type,A),P);x.__reactInternalSnapshotBeforeUpdate=j}break;case 3:var z=r.stateNode.containerInfo;z.nodeType===1?z.textContent="":z.nodeType===9&&z.documentElement&&z.removeChild(z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(lE(163))}}catch(_t){e0(r,r.return,_t)}if(e=r.sibling,e!==null){e.return=r.return,vE=e;break}vE=r.return}return k=ZK,ZK=!1,k}function NP(e,r,i){var o=r.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var s=o=o.next;do{if((s.tag&e)===e){var l=s.destroy;s.destroy=void 0,l!==void 0&&QF(r,i,l)}s=s.next}while(s!==o)}}function pM(e,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&e)===e){var o=i.create;i.destroy=o()}i=i.next}while(i!==r)}}function ZF(e){var r=e.ref;if(r!==null){var i=e.stateNode;switch(e.tag){case 5:e=i;break;default:e=i}typeof r=="function"?r(e):r.current=e}}function G7(e){var r=e.alternate;r!==null&&(e.alternate=null,G7(r)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(r=e.stateNode,r!==null&&(delete r[iR],delete r[qP],delete r[jF],delete r[Wut],delete r[Hut])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function q7(e){return e.tag===5||e.tag===3||e.tag===4}function $K(e){t:for(;;){for(;e.sibling===null;){if(e.return===null||q7(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue t;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function $F(e,r,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,r?i.nodeType===8?i.parentNode.insertBefore(e,r):i.insertBefore(e,r):(i.nodeType===8?(r=i.parentNode,r.insertBefore(e,i)):(r=i,r.appendChild(e)),i=i._reactRootContainer,i!=null||r.onclick!==null||(r.onclick=q2));else if(o!==4&&(e=e.child,e!==null))for($F(e,r,i),e=e.sibling;e!==null;)$F(e,r,i),e=e.sibling}function _B(e,r,i){var o=e.tag;if(o===5||o===6)e=e.stateNode,r?i.insertBefore(e,r):i.appendChild(e);else if(o!==4&&(e=e.child,e!==null))for(_B(e,r,i),e=e.sibling;e!==null;)_B(e,r,i),e=e.sibling}var F0=null,UT=!1;function aI(e,r,i){for(i=i.child;i!==null;)W7(e,r,i),i=i.sibling}function W7(e,r,i){if(oR&&typeof oR.onCommitFiberUnmount=="function")try{oR.onCommitFiberUnmount(oM,i)}catch{}switch(i.tag){case 5:Q0||RN(i,r);case 6:var o=F0,s=UT;F0=null,aI(e,r,i),F0=o,UT=s,F0!==null&&(UT?(e=F0,i=i.stateNode,e.nodeType===8?e.parentNode.removeChild(i):e.removeChild(i)):F0.removeChild(i.stateNode));break;case 18:F0!==null&&(UT?(e=F0,i=i.stateNode,e.nodeType===8?rF(e.parentNode,i):e.nodeType===1&&rF(e,i),jP(e)):rF(F0,i.stateNode));break;case 4:o=F0,s=UT,F0=i.stateNode.containerInfo,UT=!0,aI(e,r,i),F0=o,UT=s;break;case 0:case 11:case 14:case 15:if(!Q0&&(o=i.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){s=o=o.next;do{var l=s,d=l.destroy;l=l.tag,d!==void 0&&(l&2||l&4)&&QF(i,r,d),s=s.next}while(s!==o)}aI(e,r,i);break;case 1:if(!Q0&&(RN(i,r),o=i.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=i.memoizedProps,o.state=i.memoizedState,o.componentWillUnmount()}catch(h){e0(i,r,h)}aI(e,r,i);break;case 21:aI(e,r,i);break;case 22:i.mode&1?(Q0=(o=Q0)||i.memoizedState!==null,aI(e,r,i),Q0=o):aI(e,r,i);break;default:aI(e,r,i)}}function _z(e){var r=e.updateQueue;if(r!==null){e.updateQueue=null;var i=e.stateNode;i===null&&(i=e.stateNode=new alt),r.forEach(function(o){var s=_lt.bind(null,e,o);i.has(o)||(i.add(o),o.then(s,s))})}}function LT(e,r){var i=r.deletions;if(i!==null)for(var o=0;o<i.length;o++){var s=i[o];try{var l=e,d=r,h=d;t:for(;h!==null;){switch(h.tag){case 5:F0=h.stateNode,UT=!1;break t;case 3:F0=h.stateNode.containerInfo,UT=!0;break t;case 4:F0=h.stateNode.containerInfo,UT=!0;break t}h=h.return}if(F0===null)throw Error(lE(160));W7(l,d,s),F0=null,UT=!1;var p=s.alternate;p!==null&&(p.return=null),s.return=null}catch(f){e0(s,r,f)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)H7(r,e),r=r.sibling}function H7(e,r){var i=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(LT(r,e),nR(e),o&4){try{NP(3,e,e.return),pM(3,e)}catch(A){e0(e,e.return,A)}try{NP(5,e,e.return)}catch(A){e0(e,e.return,A)}}break;case 1:LT(r,e),nR(e),o&512&&i!==null&&RN(i,i.return);break;case 5:if(LT(r,e),nR(e),o&512&&i!==null&&RN(i,i.return),e.flags&32){var s=e.stateNode;try{LP(s,"")}catch(A){e0(e,e.return,A)}}if(o&4&&(s=e.stateNode,s!=null)){var l=e.memoizedProps,d=i!==null?i.memoizedProps:l,h=e.type,p=e.updateQueue;if(e.updateQueue=null,p!==null)try{h==="input"&&l.type==="radio"&&l.name!=null&&pY(s,l),RF(h,d);var f=RF(h,l);for(d=0;d<p.length;d+=2){var _=p[d],g=p[d+1];_==="style"?gY(s,g):_==="dangerouslySetInnerHTML"?EY(s,g):_==="children"?LP(s,g):s4(s,_,g,f)}switch(h){case"input":vF(s,l);break;case"textarea":fY(s,l);break;case"select":var b=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!l.multiple;var C=l.value;C!=null?IN(s,!!l.multiple,C,!1):b!==!!l.multiple&&(l.defaultValue!=null?IN(s,!!l.multiple,l.defaultValue,!0):IN(s,!!l.multiple,l.multiple?[]:"",!1))}s[qP]=l}catch(A){e0(e,e.return,A)}}break;case 6:if(LT(r,e),nR(e),o&4){if(e.stateNode===null)throw Error(lE(162));s=e.stateNode,l=e.memoizedProps;try{s.nodeValue=l}catch(A){e0(e,e.return,A)}}break;case 3:if(LT(r,e),nR(e),o&4&&i!==null&&i.memoizedState.isDehydrated)try{jP(r.containerInfo)}catch(A){e0(e,e.return,A)}break;case 4:LT(r,e),nR(e);break;case 13:LT(r,e),nR(e),s=e.child,s.flags&8192&&(l=s.memoizedState!==null,s.stateNode.isHidden=l,!l||s.alternate!==null&&s.alternate.memoizedState!==null||(V4=d0())),o&4&&_z(e);break;case 22:if(_=i!==null&&i.memoizedState!==null,e.mode&1?(Q0=(f=Q0)||_,LT(r,e),Q0=f):LT(r,e),nR(e),o&8192){if(f=e.memoizedState!==null,(e.stateNode.isHidden=f)&&!_&&e.mode&1)for(vE=e,_=e.child;_!==null;){for(g=vE=_;vE!==null;){switch(b=vE,C=b.child,b.tag){case 0:case 11:case 14:case 15:NP(4,b,b.return);break;case 1:RN(b,b.return);var k=b.stateNode;if(typeof k.componentWillUnmount=="function"){o=b,i=b.return;try{r=o,k.props=r.memoizedProps,k.state=r.memoizedState,k.componentWillUnmount()}catch(A){e0(o,i,A)}}break;case 5:RN(b,b.return);break;case 22:if(b.memoizedState!==null){eY(g);continue}}C!==null?(C.return=b,vE=C):eY(g)}_=_.sibling}t:for(_=null,g=e;;){if(g.tag===5){if(_===null){_=g;try{s=g.stateNode,f?(l=s.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(h=g.stateNode,p=g.memoizedProps.style,d=p!=null&&p.hasOwnProperty("display")?p.display:null,h.style.display=_Y("display",d))}catch(A){e0(e,e.return,A)}}}else if(g.tag===6){if(_===null)try{g.stateNode.nodeValue=f?"":g.memoizedProps}catch(A){e0(e,e.return,A)}}else if((g.tag!==22&&g.tag!==23||g.memoizedState===null||g===e)&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===e)break t;for(;g.sibling===null;){if(g.return===null||g.return===e)break t;_===g&&(_=null),g=g.return}_===g&&(_=null),g.sibling.return=g.return,g=g.sibling}}break;case 19:LT(r,e),nR(e),o&4&&_z(e);break;case 21:break;default:LT(r,e),nR(e)}}function nR(e){var r=e.flags;if(r&2){try{t:{for(var i=e.return;i!==null;){if(q7(i)){var o=i;break t}i=i.return}throw Error(lE(160))}switch(o.tag){case 5:var s=o.stateNode;o.flags&32&&(LP(s,""),o.flags&=-33);var l=$K(e);_B(e,l,s);break;case 3:case 4:var d=o.stateNode.containerInfo,h=$K(e);$F(e,h,d);break;default:throw Error(lE(161))}}catch(p){e0(e,e.return,p)}e.flags&=-3}r&4096&&(e.flags&=-4097)}function ult(e,r,i){vE=e,K7(e,r,i)}function K7(e,r,i){for(var o=(e.mode&1)!==0;vE!==null;){var s=vE,l=s.child;if(s.tag===22&&o){var d=s.memoizedState!==null||b2;if(!d){var h=s.alternate,p=h!==null&&h.memoizedState!==null||Q0;h=b2;var f=Q0;if(b2=d,(Q0=p)&&!f)for(vE=s;vE!==null;)d=vE,p=d.child,d.tag===22&&d.memoizedState!==null?nY(s):p!==null?(p.return=d,vE=p):nY(s);for(;l!==null;)vE=l,K7(l,r,i),l=l.sibling;vE=s,b2=h,Q0=f}tY(e,r,i)}else s.subtreeFlags&8772&&l!==null?(l.return=s,vE=l):tY(e,r,i)}}function tY(e){for(;vE!==null;){var r=vE;if(r.flags&8772){var i=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:Q0||pM(5,r);break;case 1:var o=r.stateNode;if(r.flags&4&&!Q0)if(i===null)o.componentDidMount();else{var s=r.elementType===r.type?i.memoizedProps:MT(r.type,i.memoizedProps);o.componentDidUpdate(s,i.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var l=r.updateQueue;l!==null&&VK(r,l,o);break;case 3:var d=r.updateQueue;if(d!==null){if(i=null,r.child!==null)switch(r.child.tag){case 5:i=r.child.stateNode;break;case 1:i=r.child.stateNode}VK(r,d,i)}break;case 5:var h=r.stateNode;if(i===null&&r.flags&4){i=h;var p=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":p.autoFocus&&i.focus();break;case"img":p.src&&(i.src=p.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var f=r.alternate;if(f!==null){var _=f.memoizedState;if(_!==null){var g=_.dehydrated;g!==null&&jP(g)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(lE(163))}Q0||r.flags&512&&ZF(r)}catch(b){e0(r,r.return,b)}}if(r===e){vE=null;break}if(i=r.sibling,i!==null){i.return=r.return,vE=i;break}vE=r.return}}function eY(e){for(;vE!==null;){var r=vE;if(r===e){vE=null;break}var i=r.sibling;if(i!==null){i.return=r.return,vE=i;break}vE=r.return}}function nY(e){for(;vE!==null;){var r=vE;try{switch(r.tag){case 0:case 11:case 15:var i=r.return;try{pM(4,r)}catch(p){e0(r,i,p)}break;case 1:var o=r.stateNode;if(typeof o.componentDidMount=="function"){var s=r.return;try{o.componentDidMount()}catch(p){e0(r,s,p)}}var l=r.return;try{ZF(r)}catch(p){e0(r,l,p)}break;case 5:var d=r.return;try{ZF(r)}catch(p){e0(r,d,p)}}}catch(p){e0(r,r.return,p)}if(r===e){vE=null;break}var h=r.sibling;if(h!==null){h.return=r.return,vE=h;break}vE=r.return}}var llt=Math.ceil,tM=GR.ReactCurrentDispatcher,x4=GR.ReactCurrentOwner,oT=GR.ReactCurrentBatchConfig,u_=0,N0=null,E0=null,B0=0,DS=0,wN=wI(0),T0=0,JP=null,vO=0,fM=0,j4=0,kP=null,mS=null,V4=0,jN=1/0,DR=null,eM=!1,t4=null,vI=null,R2=!1,pI=null,nM=0,PP=0,e4=null,P2=-1,D2=0;function sS(){return u_&6?d0():P2!==-1?P2:P2=d0()}function yI(e){return e.mode&1?u_&2&&B0!==0?B0&-B0:zut.transition!==null?(D2===0&&(D2=NY()),D2):(e=T_,e!==0||(e=window.event,e=e===void 0?16:xY(e.type)),e):1}function VT(e,r,i,o){if(50<PP)throw PP=0,e4=null,Error(lE(185));XP(e,i,o),(!(u_&2)||e!==N0)&&(e===N0&&(!(u_&2)&&(fM|=i),T0===4&&dI(e,B0)),vS(e,o),i===1&&u_===0&&!(r.mode&1)&&(jN=d0()+500,lM&&II()))}function vS(e,r){var i=e.callbackNode;Jct(e,r);var o=V2(e,e===N0?B0:0);if(o===0)i!==null&&dK(i),e.callbackNode=null,e.callbackPriority=0;else if(r=o&-o,e.callbackPriority!==r){if(i!=null&&dK(i),r===1)e.tag===0?Kut(rY.bind(null,e)):n7(rY.bind(null,e)),Gut(function(){!(u_&6)&&II()}),i=null;else{switch(kY(o)){case 1:i=d4;break;case 4:i=AY;break;case 16:i=j2;break;case 536870912:i=OY;break;default:i=j2}i=t9(i,z7.bind(null,e))}e.callbackPriority=r,e.callbackNode=i}}function z7(e,r){if(P2=-1,D2=0,u_&6)throw Error(lE(327));var i=e.callbackNode;if(kN()&&e.callbackNode!==i)return null;var o=V2(e,e===N0?B0:0);if(o===0)return null;if(o&30||o&e.expiredLanes||r)r=rM(e,o);else{r=o;var s=u_;u_|=2;var l=J7();(N0!==e||B0!==r)&&(DR=null,jN=d0()+500,fO(e,r));do try{plt();break}catch(h){Y7(e,h)}while(!0);R4(),tM.current=l,u_=s,E0!==null?r=0:(N0=null,B0=0,r=T0)}if(r!==0){if(r===2&&(s=OF(e),s!==0&&(o=s,r=n4(e,s))),r===1)throw i=JP,fO(e,0),dI(e,o),vS(e,d0()),i;if(r===6)dI(e,o);else{if(s=e.current.alternate,!(o&30)&&!dlt(s)&&(r=rM(e,o),r===2&&(l=OF(e),l!==0&&(o=l,r=n4(e,l))),r===1))throw i=JP,fO(e,0),dI(e,o),vS(e,d0()),i;switch(e.finishedWork=s,e.finishedLanes=o,r){case 0:case 1:throw Error(lE(345));case 2:lO(e,mS,DR);break;case 3:if(dI(e,o),(o&130023424)===o&&(r=V4+500-d0(),10<r)){if(V2(e,0)!==0)break;if(s=e.suspendedLanes,(s&o)!==o){sS(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=xF(lO.bind(null,e,mS,DR),r);break}lO(e,mS,DR);break;case 4:if(dI(e,o),(o&4194240)===o)break;for(r=e.eventTimes,s=-1;0<o;){var d=31-jT(o);l=1<<d,d=r[d],d>s&&(s=d),o&=~l}if(o=s,o=d0()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*llt(o/1960))-o,10<o){e.timeoutHandle=xF(lO.bind(null,e,mS,DR),o);break}lO(e,mS,DR);break;case 5:lO(e,mS,DR);break;default:throw Error(lE(329))}}}return vS(e,d0()),e.callbackNode===i?z7.bind(null,e):null}function n4(e,r){var i=kP;return e.current.memoizedState.isDehydrated&&(fO(e,r).flags|=256),e=rM(e,r),e!==2&&(r=mS,mS=i,r!==null&&r4(r)),e}function r4(e){mS===null?mS=e:mS.push.apply(mS,e)}function dlt(e){for(var r=e;;){if(r.flags&16384){var i=r.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var o=0;o<i.length;o++){var s=i[o],l=s.getSnapshot;s=s.value;try{if(!FT(l(),s))return!1}catch{return!1}}}if(i=r.child,r.subtreeFlags&16384&&i!==null)i.return=r,r=i;else{if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function dI(e,r){for(r&=~j4,r&=~fM,e.suspendedLanes|=r,e.pingedLanes&=~r,e=e.expirationTimes;0<r;){var i=31-jT(r),o=1<<i;e[i]=-1,r&=~o}}function rY(e){if(u_&6)throw Error(lE(327));kN();var r=V2(e,0);if(!(r&1))return vS(e,d0()),null;var i=rM(e,r);if(e.tag!==0&&i===2){var o=OF(e);o!==0&&(r=o,i=n4(e,o))}if(i===1)throw i=JP,fO(e,0),dI(e,r),vS(e,d0()),i;if(i===6)throw Error(lE(345));return e.finishedWork=e.current.alternate,e.finishedLanes=r,lO(e,mS,DR),vS(e,d0()),null}function F4(e,r){var i=u_;u_|=1;try{return e(r)}finally{u_=i,u_===0&&(jN=d0()+500,lM&&II())}}function yO(e){pI!==null&&pI.tag===0&&!(u_&6)&&kN();var r=u_;u_|=1;var i=oT.transition,o=T_;try{if(oT.transition=null,T_=1,e)return e()}finally{T_=o,oT.transition=i,u_=r,!(u_&6)&&II()}}function B4(){DS=wN.current,B_(wN)}function fO(e,r){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(i!==-1&&(e.timeoutHandle=-1,But(i)),E0!==null)for(i=E0.return;i!==null;){var o=i;switch(S4(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&W2();break;case 3:UN(),B_(_S),B_(Z0),N4();break;case 5:O4(o);break;case 4:UN();break;case 13:B_(X_);break;case 19:B_(X_);break;case 10:w4(o.type._context);break;case 22:case 23:B4()}i=i.return}if(N0=e,E0=e=SI(e.current,null),B0=DS=r,T0=0,JP=null,j4=fM=vO=0,mS=kP=null,hO!==null){for(r=0;r<hO.length;r++)if(i=hO[r],o=i.interleaved,o!==null){i.interleaved=null;var s=o.next,l=i.pending;if(l!==null){var d=l.next;l.next=s,o.next=d}i.pending=o}hO=null}return e}function Y7(e,r){do{var i=E0;try{if(R4(),O2.current=$2,Z2){for(var o=Q_.memoizedState;o!==null;){var s=o.queue;s!==null&&(s.pending=null),o=o.next}Z2=!1}if(gO=0,O0=S0=Q_=null,OP=!1,KP=0,x4.current=null,i===null||i.return===null){T0=1,JP=r,E0=null;break}t:{var l=e,d=i.return,h=i,p=r;if(r=B0,h.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){var f=p,_=h,g=_.tag;if(!(_.mode&1)&&(g===0||g===11||g===15)){var b=_.alternate;b?(_.updateQueue=b.updateQueue,_.memoizedState=b.memoizedState,_.lanes=b.lanes):(_.updateQueue=null,_.memoizedState=null)}var C=HK(d);if(C!==null){C.flags&=-257,KK(C,d,h,l,r),C.mode&1&&WK(l,f,r),r=C,p=f;var k=r.updateQueue;if(k===null){var A=new Set;A.add(p),r.updateQueue=A}else k.add(p);break t}else{if(!(r&1)){WK(l,f,r),G4();break t}p=Error(lE(426))}}else if(z_&&h.mode&1){var P=HK(d);if(P!==null){!(P.flags&65536)&&(P.flags|=256),KK(P,d,h,l,r),T4(xN(p,h));break t}}l=p=xN(p,h),T0!==4&&(T0=2),kP===null?kP=[l]:kP.push(l),l=d;do{switch(l.tag){case 3:l.flags|=65536,r&=-r,l.lanes|=r;var x=k7(l,p,r);jK(l,x);break t;case 1:h=p;var j=l.type,z=l.stateNode;if(!(l.flags&128)&&(typeof j.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&(vI===null||!vI.has(z)))){l.flags|=65536,r&=-r,l.lanes|=r;var _t=P7(l,h,r);jK(l,_t);break t}}l=l.return}while(l!==null)}Q7(i)}catch(ue){r=ue,E0===i&&i!==null&&(E0=i=i.return);continue}break}while(!0)}function J7(){var e=tM.current;return tM.current=$2,e===null?$2:e}function G4(){(T0===0||T0===3||T0===2)&&(T0=4),N0===null||!(vO&268435455)&&!(fM&268435455)||dI(N0,B0)}function rM(e,r){var i=u_;u_|=2;var o=J7();(N0!==e||B0!==r)&&(DR=null,fO(e,r));do try{hlt();break}catch(s){Y7(e,s)}while(!0);if(R4(),u_=i,tM.current=o,E0!==null)throw Error(lE(261));return N0=null,B0=0,T0}function hlt(){for(;E0!==null;)X7(E0)}function plt(){for(;E0!==null&&!Fct();)X7(E0)}function X7(e){var r=$7(e.alternate,e,DS);e.memoizedProps=e.pendingProps,r===null?Q7(e):E0=r,x4.current=null}function Q7(e){var r=e;do{var i=r.alternate;if(e=r.return,r.flags&32768){if(i=slt(i,r),i!==null){i.flags&=32767,E0=i;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{T0=6,E0=null;return}}else if(i=olt(i,r,DS),i!==null){E0=i;return}if(r=r.sibling,r!==null){E0=r;return}E0=r=e}while(r!==null);T0===0&&(T0=5)}function lO(e,r,i){var o=T_,s=oT.transition;try{oT.transition=null,T_=1,flt(e,r,i,o)}finally{oT.transition=s,T_=o}return null}function flt(e,r,i,o){do kN();while(pI!==null);if(u_&6)throw Error(lE(327));i=e.finishedWork;var s=e.finishedLanes;if(i===null)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(lE(177));e.callbackNode=null,e.callbackPriority=0;var l=i.lanes|i.childLanes;if(Xct(e,l),e===N0&&(E0=N0=null,B0=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||R2||(R2=!0,t9(j2,function(){return kN(),null})),l=(i.flags&15990)!==0,i.subtreeFlags&15990||l){l=oT.transition,oT.transition=null;var d=T_;T_=1;var h=u_;u_|=4,x4.current=null,clt(e,i),H7(i,e),Uut(MF),F2=!!LF,MF=LF=null,e.current=i,ult(i,e,s),Bct(),u_=h,T_=d,oT.transition=l}else e.current=i;if(R2&&(R2=!1,pI=e,nM=s),l=e.pendingLanes,l===0&&(vI=null),Wct(i.stateNode,o),vS(e,d0()),r!==null)for(o=e.onRecoverableError,i=0;i<r.length;i++)s=r[i],o(s.value,{componentStack:s.stack,digest:s.digest});if(eM)throw eM=!1,e=t4,t4=null,e;return nM&1&&e.tag!==0&&kN(),l=e.pendingLanes,l&1?e===e4?PP++:(PP=0,e4=e):PP=0,II(),null}function kN(){if(pI!==null){var e=kY(nM),r=oT.transition,i=T_;try{if(oT.transition=null,T_=16>e?16:e,pI===null)var o=!1;else{if(e=pI,pI=null,nM=0,u_&6)throw Error(lE(331));var s=u_;for(u_|=4,vE=e.current;vE!==null;){var l=vE,d=l.child;if(vE.flags&16){var h=l.deletions;if(h!==null){for(var p=0;p<h.length;p++){var f=h[p];for(vE=f;vE!==null;){var _=vE;switch(_.tag){case 0:case 11:case 15:NP(8,_,l)}var g=_.child;if(g!==null)g.return=_,vE=g;else for(;vE!==null;){_=vE;var b=_.sibling,C=_.return;if(G7(_),_===f){vE=null;break}if(b!==null){b.return=C,vE=b;break}vE=C}}}var k=l.alternate;if(k!==null){var A=k.child;if(A!==null){k.child=null;do{var P=A.sibling;A.sibling=null,A=P}while(A!==null)}}vE=l}}if(l.subtreeFlags&2064&&d!==null)d.return=l,vE=d;else t:for(;vE!==null;){if(l=vE,l.flags&2048)switch(l.tag){case 0:case 11:case 15:NP(9,l,l.return)}var x=l.sibling;if(x!==null){x.return=l.return,vE=x;break t}vE=l.return}}var j=e.current;for(vE=j;vE!==null;){d=vE;var z=d.child;if(d.subtreeFlags&2064&&z!==null)z.return=d,vE=z;else t:for(d=j;vE!==null;){if(h=vE,h.flags&2048)try{switch(h.tag){case 0:case 11:case 15:pM(9,h)}}catch(ue){e0(h,h.return,ue)}if(h===d){vE=null;break t}var _t=h.sibling;if(_t!==null){_t.return=h.return,vE=_t;break t}vE=h.return}}if(u_=s,II(),oR&&typeof oR.onPostCommitFiberRoot=="function")try{oR.onPostCommitFiberRoot(oM,e)}catch{}o=!0}return o}finally{T_=i,oT.transition=r}}return!1}function iY(e,r,i){r=xN(i,r),r=k7(e,r,1),e=gI(e,r,1),r=sS(),e!==null&&(XP(e,1,r),vS(e,r))}function e0(e,r,i){if(e.tag===3)iY(e,e,i);else for(;r!==null;){if(r.tag===3){iY(r,e,i);break}else if(r.tag===1){var o=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(vI===null||!vI.has(o))){e=xN(i,e),e=P7(r,e,1),r=gI(r,e,1),e=sS(),r!==null&&(XP(r,1,e),vS(r,e));break}}r=r.return}}function mlt(e,r,i){var o=e.pingCache;o!==null&&o.delete(r),r=sS(),e.pingedLanes|=e.suspendedLanes&i,N0===e&&(B0&i)===i&&(T0===4||T0===3&&(B0&130023424)===B0&&500>d0()-V4?fO(e,0):j4|=i),vS(e,r)}function Z7(e,r){r===0&&(e.mode&1?(r=l2,l2<<=1,!(l2&130023424)&&(l2=4194304)):r=1);var i=sS();e=FR(e,r),e!==null&&(XP(e,r,i),vS(e,i))}function Elt(e){var r=e.memoizedState,i=0;r!==null&&(i=r.retryLane),Z7(e,i)}function _lt(e,r){var i=0;switch(e.tag){case 13:var o=e.stateNode,s=e.memoizedState;s!==null&&(i=s.retryLane);break;case 19:o=e.stateNode;break;default:throw Error(lE(314))}o!==null&&o.delete(r),Z7(e,i)}var $7;$7=function(e,r,i){if(e!==null)if(e.memoizedProps!==r.pendingProps||_S.current)ES=!0;else{if(!(e.lanes&i)&&!(r.flags&128))return ES=!1,ilt(e,r,i);ES=!!(e.flags&131072)}else ES=!1,z_&&r.flags&1048576&&r7(r,z2,r.index);switch(r.lanes=0,r.tag){case 2:var o=r.type;k2(e,r),e=r.pendingProps;var s=DN(r,Z0.current);NN(r,i),s=P4(null,r,o,e,s,i);var l=D4();return r.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,gS(o)?(l=!0,H2(r)):l=!1,r.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,C4(r),s.updater=hM,r.stateNode=s,s._reactInternals=r,WF(r,o,e,i),r=zF(null,r,o,!0,l,i)):(r.tag=0,z_&&l&&y4(r),oS(null,r,s,i),r=r.child),r;case 16:o=r.elementType;t:{switch(k2(e,r),e=r.pendingProps,s=o._init,o=s(o._payload),r.type=o,s=r.tag=vlt(o),e=MT(o,e),s){case 0:r=KF(null,r,o,e,i);break t;case 1:r=JK(null,r,o,e,i);break t;case 11:r=zK(null,r,o,e,i);break t;case 14:r=YK(null,r,o,MT(o.type,e),i);break t}throw Error(lE(306,o,""))}return r;case 0:return o=r.type,s=r.pendingProps,s=r.elementType===o?s:MT(o,s),KF(e,r,o,s,i);case 1:return o=r.type,s=r.pendingProps,s=r.elementType===o?s:MT(o,s),JK(e,r,o,s,i);case 3:t:{if(U7(r),e===null)throw Error(lE(387));o=r.pendingProps,l=r.memoizedState,s=l.element,u7(e,r),X2(r,o,null,i);var d=r.memoizedState;if(o=d.element,l.isDehydrated)if(l={element:o,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},r.updateQueue.baseState=l,r.memoizedState=l,r.flags&256){s=xN(Error(lE(423)),r),r=XK(e,r,o,i,s);break t}else if(o!==s){s=xN(Error(lE(424)),r),r=XK(e,r,o,i,s);break t}else for(LS=_I(r.stateNode.containerInfo.firstChild),MS=r,z_=!0,xT=null,i=a7(r,null,o,i),r.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(LN(),o===s){r=BR(e,r,i);break t}oS(e,r,o,i)}r=r.child}return r;case 5:return l7(r),e===null&&BF(r),o=r.type,s=r.pendingProps,l=e!==null?e.memoizedProps:null,d=s.children,UF(o,s)?d=null:l!==null&&UF(o,l)&&(r.flags|=32),M7(e,r),oS(e,r,d,i),r.child;case 6:return e===null&&BF(r),null;case 13:return x7(e,r,i);case 4:return A4(r,r.stateNode.containerInfo),o=r.pendingProps,e===null?r.child=MN(r,null,o,i):oS(e,r,o,i),r.child;case 11:return o=r.type,s=r.pendingProps,s=r.elementType===o?s:MT(o,s),zK(e,r,o,s,i);case 7:return oS(e,r,r.pendingProps,i),r.child;case 8:return oS(e,r,r.pendingProps.children,i),r.child;case 12:return oS(e,r,r.pendingProps.children,i),r.child;case 10:t:{if(o=r.type._context,s=r.pendingProps,l=r.memoizedProps,d=s.value,x_(Y2,o._currentValue),o._currentValue=d,l!==null)if(FT(l.value,d)){if(l.children===s.children&&!_S.current){r=BR(e,r,i);break t}}else for(l=r.child,l!==null&&(l.return=r);l!==null;){var h=l.dependencies;if(h!==null){d=l.child;for(var p=h.firstContext;p!==null;){if(p.context===o){if(l.tag===1){p=xR(-1,i&-i),p.tag=2;var f=l.updateQueue;if(f!==null){f=f.shared;var _=f.pending;_===null?p.next=p:(p.next=_.next,_.next=p),f.pending=p}}l.lanes|=i,p=l.alternate,p!==null&&(p.lanes|=i),GF(l.return,i,r),h.lanes|=i;break}p=p.next}}else if(l.tag===10)d=l.type===r.type?null:l.child;else if(l.tag===18){if(d=l.return,d===null)throw Error(lE(341));d.lanes|=i,h=d.alternate,h!==null&&(h.lanes|=i),GF(d,i,r),d=l.sibling}else d=l.child;if(d!==null)d.return=l;else for(d=l;d!==null;){if(d===r){d=null;break}if(l=d.sibling,l!==null){l.return=d.return,d=l;break}d=d.return}l=d}oS(e,r,s.children,i),r=r.child}return r;case 9:return s=r.type,o=r.pendingProps.children,NN(r,i),s=sT(s),o=o(s),r.flags|=1,oS(e,r,o,i),r.child;case 14:return o=r.type,s=MT(o,r.pendingProps),s=MT(o.type,s),YK(e,r,o,s,i);case 15:return D7(e,r,r.type,r.pendingProps,i);case 17:return o=r.type,s=r.pendingProps,s=r.elementType===o?s:MT(o,s),k2(e,r),r.tag=1,gS(o)?(e=!0,H2(r)):e=!1,NN(r,i),N7(r,o,s),WF(r,o,s,i),zF(null,r,o,!0,e,i);case 19:return j7(e,r,i);case 22:return L7(e,r,i)}throw Error(lE(156,r.tag))};function t9(e,r){return CY(e,r)}function glt(e,r,i,o){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function iT(e,r,i,o){return new glt(e,r,i,o)}function q4(e){return e=e.prototype,!(!e||!e.isReactComponent)}function vlt(e){if(typeof e=="function")return q4(e)?1:0;if(e!=null){if(e=e.$$typeof,e===c4)return 11;if(e===u4)return 14}return 2}function SI(e,r){var i=e.alternate;return i===null?(i=iT(e.tag,r,e.key,e.mode),i.elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=r,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=e.flags&14680064,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,r=e.dependencies,i.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function L2(e,r,i,o,s,l){var d=2;if(o=e,typeof e=="function")q4(e)&&(d=1);else if(typeof e=="string")d=5;else t:switch(e){case mN:return mO(i.children,s,l,r);case a4:d=8,s|=8;break;case fF:return e=iT(12,i,r,s|2),e.elementType=fF,e.lanes=l,e;case mF:return e=iT(13,i,r,s),e.elementType=mF,e.lanes=l,e;case EF:return e=iT(19,i,r,s),e.elementType=EF,e.lanes=l,e;case lY:return mM(i,s,l,r);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case cY:d=10;break t;case uY:d=9;break t;case c4:d=11;break t;case u4:d=14;break t;case cI:d=16,o=null;break t}throw Error(lE(130,e==null?e:typeof e,""))}return r=iT(d,i,r,s),r.elementType=e,r.type=o,r.lanes=l,r}function mO(e,r,i,o){return e=iT(7,e,o,r),e.lanes=i,e}function mM(e,r,i,o){return e=iT(22,e,o,r),e.elementType=lY,e.lanes=i,e.stateNode={isHidden:!1},e}function dF(e,r,i){return e=iT(6,e,null,r),e.lanes=i,e}function hF(e,r,i){return r=iT(4,e.children!==null?e.children:[],e.key,r),r.lanes=i,r.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},r}function ylt(e,r,i,o,s){this.tag=r,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=JV(0),this.expirationTimes=JV(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=JV(0),this.identifierPrefix=o,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function W4(e,r,i,o,s,l,d,h,p){return e=new ylt(e,r,i,h,p),r===1?(r=1,l===!0&&(r|=8)):r=0,l=iT(3,null,null,r),e.current=l,l.stateNode=e,l.memoizedState={element:o,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},C4(l),e}function Slt(e,r,i){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fN,key:o==null?null:""+o,children:e,containerInfo:r,implementation:i}}function e9(e){if(!e)return bI;e=e._reactInternals;t:{if(TO(e)!==e||e.tag!==1)throw Error(lE(170));var r=e;do{switch(r.tag){case 3:r=r.stateNode.context;break t;case 1:if(gS(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break t}}r=r.return}while(r!==null);throw Error(lE(171))}if(e.tag===1){var i=e.type;if(gS(i))return e7(e,i,r)}return r}function n9(e,r,i,o,s,l,d,h,p){return e=W4(i,o,!0,e,s,l,d,h,p),e.context=e9(null),i=e.current,o=sS(),s=yI(i),l=xR(o,s),l.callback=r??null,gI(i,l,s),e.current.lanes=s,XP(e,s,o),vS(e,o),e}function EM(e,r,i,o){var s=r.current,l=sS(),d=yI(s);return i=e9(i),r.context===null?r.context=i:r.pendingContext=i,r=xR(l,d),r.payload={element:e},o=o===void 0?null:o,o!==null&&(r.callback=o),e=gI(s,r,d),e!==null&&(VT(e,s,d,l),A2(e,s,d)),d}function iM(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function oY(e,r){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var i=e.retryLane;e.retryLane=i!==0&&i<r?i:r}}function H4(e,r){oY(e,r),(e=e.alternate)&&oY(e,r)}function Tlt(){return null}var r9=typeof reportError=="function"?reportError:function(e){console.error(e)};function K4(e){this._internalRoot=e}_M.prototype.render=K4.prototype.render=function(e){var r=this._internalRoot;if(r===null)throw Error(lE(409));EM(e,r,null,null)};_M.prototype.unmount=K4.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var r=e.containerInfo;yO(function(){EM(null,e,null,null)}),r[VR]=null}};function _M(e){this._internalRoot=e}_M.prototype.unstable_scheduleHydration=function(e){if(e){var r=LY();e={blockedOn:null,target:e,priority:r};for(var i=0;i<lI.length&&r!==0&&r<lI[i].priority;i++);lI.splice(i,0,e),i===0&&UY(e)}};function z4(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function gM(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function sY(){}function blt(e,r,i,o,s){if(s){if(typeof o=="function"){var l=o;o=function(){var f=iM(d);l.call(f)}}var d=n9(r,o,e,0,null,!1,!1,"",sY);return e._reactRootContainer=d,e[VR]=d.current,BP(e.nodeType===8?e.parentNode:e),yO(),d}for(;s=e.lastChild;)e.removeChild(s);if(typeof o=="function"){var h=o;o=function(){var f=iM(p);h.call(f)}}var p=W4(e,0,!1,null,null,!1,!1,"",sY);return e._reactRootContainer=p,e[VR]=p.current,BP(e.nodeType===8?e.parentNode:e),yO(function(){EM(r,p,i,o)}),p}function vM(e,r,i,o,s){var l=i._reactRootContainer;if(l){var d=l;if(typeof s=="function"){var h=s;s=function(){var p=iM(d);h.call(p)}}EM(r,d,e,s)}else d=blt(i,r,e,s,o);return iM(d)}PY=function(e){switch(e.tag){case 3:var r=e.stateNode;if(r.current.memoizedState.isDehydrated){var i=TP(r.pendingLanes);i!==0&&(h4(r,i|1),vS(r,d0()),!(u_&6)&&(jN=d0()+500,II()))}break;case 13:yO(function(){var o=FR(e,1);if(o!==null){var s=sS();VT(o,e,1,s)}}),H4(e,1)}};p4=function(e){if(e.tag===13){var r=FR(e,134217728);if(r!==null){var i=sS();VT(r,e,134217728,i)}H4(e,134217728)}};DY=function(e){if(e.tag===13){var r=yI(e),i=FR(e,r);if(i!==null){var o=sS();VT(i,e,r,o)}H4(e,r)}};LY=function(){return T_};MY=function(e,r){var i=T_;try{return T_=e,r()}finally{T_=i}};IF=function(e,r,i){switch(r){case"input":if(vF(e,i),r=i.name,i.type==="radio"&&r!=null){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<i.length;r++){var o=i[r];if(o!==e&&o.form===e.form){var s=uM(o);if(!s)throw Error(lE(90));hY(o),vF(o,s)}}}break;case"textarea":fY(e,i);break;case"select":r=i.value,r!=null&&IN(e,!!i.multiple,r,!1)}};SY=F4;TY=yO;var Rlt={usingClientEntryPoint:!1,Events:[ZP,vN,uM,vY,yY,F4]},gP={findFiberByHostInstance:dO,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},wlt={bundleType:gP.bundleType,version:gP.version,rendererPackageName:gP.rendererPackageName,rendererConfig:gP.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:GR.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=wY(e),e===null?null:e.stateNode},findFiberByHostInstance:gP.findFiberByHostInstance||Tlt,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(vP=__REACT_DEVTOOLS_GLOBAL_HOOK__,!vP.isDisabled&&vP.supportsFiber))try{oM=vP.inject(wlt),oR=vP}catch{}var vP;jS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rlt;jS.createPortal=function(e,r){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!z4(r))throw Error(lE(200));return Slt(e,r,null,i)};jS.createRoot=function(e,r){if(!z4(e))throw Error(lE(299));var i=!1,o="",s=r9;return r!=null&&(r.unstable_strictMode===!0&&(i=!0),r.identifierPrefix!==void 0&&(o=r.identifierPrefix),r.onRecoverableError!==void 0&&(s=r.onRecoverableError)),r=W4(e,1,!1,null,null,i,!1,o,s),e[VR]=r.current,BP(e.nodeType===8?e.parentNode:e),new K4(r)};jS.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var r=e._reactInternals;if(r===void 0)throw typeof e.render=="function"?Error(lE(188)):(e=Object.keys(e).join(","),Error(lE(268,e)));return e=wY(r),e=e===null?null:e.stateNode,e};jS.flushSync=function(e){return yO(e)};jS.hydrate=function(e,r,i){if(!gM(r))throw Error(lE(200));return vM(null,e,r,!0,i)};jS.hydrateRoot=function(e,r,i){if(!z4(e))throw Error(lE(405));var o=i!=null&&i.hydratedSources||null,s=!1,l="",d=r9;if(i!=null&&(i.unstable_strictMode===!0&&(s=!0),i.identifierPrefix!==void 0&&(l=i.identifierPrefix),i.onRecoverableError!==void 0&&(d=i.onRecoverableError)),r=n9(r,null,e,1,i??null,s,!1,l,d),e[VR]=r.current,BP(e),o)for(e=0;e<o.length;e++)i=o[e],s=i._getVersion,s=s(i._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[i,s]:r.mutableSourceEagerHydrationData.push(i,s);return new _M(r)};jS.render=function(e,r,i){if(!gM(r))throw Error(lE(200));return vM(null,e,r,!1,i)};jS.unmountComponentAtNode=function(e){if(!gM(e))throw Error(lE(40));return e._reactRootContainer?(yO(function(){vM(null,null,e,!1,function(){e._reactRootContainer=null,e[VR]=null})}),!0):!1};jS.unstable_batchedUpdates=F4;jS.unstable_renderSubtreeIntoContainer=function(e,r,i,o){if(!gM(i))throw Error(lE(200));if(e==null||e._reactInternals===void 0)throw Error(lE(38));return vM(e,r,i,!1,o)};jS.version="18.3.1-next-f1338f8080-20240426"});var a9=oI((bCt,s9)=>{"use strict";function o9(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o9)}catch(e){console.error(e)}}o9(),s9.exports=i9()});var u9=oI(Y4=>{"use strict";var c9=a9();Y4.createRoot=c9.createRoot,Y4.hydrateRoot=c9.hydrateRoot;var RCt});var TH=oI((exports,module)=>{"use strict";(function(e,r){typeof exports=="object"&&typeof module<"u"?module.exports=r():typeof define=="function"&&define.amd?define(r):(e=typeof globalThis<"u"?globalThis:e||self).AgoraRTM=r()})(exports,function(){function be(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function ua(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?be(Object(i),!0).forEach(function(o){m(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):be(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function X(e){return(X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(e)}function sl(e,r,i,o,s,l,d){try{var h=e[l](d),p=h.value}catch(f){return void i(f)}h.done?r(p):Promise.resolve(p).then(o,s)}function J(e){return function(){var r=this,i=arguments;return new Promise(function(o,s){function l(p){sl(h,o,s,l,d,"next",p)}function d(p){sl(h,o,s,l,d,"throw",p)}var h=e.apply(r,i);l(void 0)})}}function W(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function tl(e,r){for(var i=0;i<r.length;i++){var o=r[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ha(e,r,i){return r&&tl(e.prototype,r),i&&tl(e,i),e}function m(e,r,i){return r in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function la(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&df(e,r)}function wd(e){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)})(e)}function df(e,r){return(df=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i})(e,r)}function ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Sh(e,r,i){return(Sh=ul()?Reflect.construct:function(o,s,l){var d=[null];return d.push.apply(d,s),o=new(Function.bind.apply(o,d)),l&&df(o,l.prototype),o}).apply(null,arguments)}function ef(e){var r=typeof Map=="function"?new Map:void 0;return(ef=function(i){function o(){return Sh(i,arguments,wd(this).constructor)}if(i===null||Function.toString.call(i).indexOf("[native code]")===-1)return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(r!==void 0){if(r.has(i))return r.get(i);r.set(i,o)}return o.prototype=Object.create(i.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),df(o,i)})(e)}function ff(e,r){if(e==null)return{};if(e==null)var i={};else{i={};var o,s=Object.keys(e);for(o=0;o<s.length;o++){var l=s[o];0<=r.indexOf(l)||(i[l]=e[l])}}if(Object.getOwnPropertySymbols)for(o=Object.getOwnPropertySymbols(e),l=0;l<o.length;l++)s=o[l],0<=r.indexOf(s)||Object.prototype.propertyIsEnumerable.call(e,s)&&(i[s]=e[s]);return i}function n(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ma(e){var r=ul();return function(){var i=wd(e);if(r){var o=wd(this).constructor;i=Reflect.construct(i,arguments,o)}else i=i.apply(this,arguments);return i=!i||typeof i!="object"&&typeof i!="function"?n(this):i}}function Th(e,r,i){return(Th=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(o,s,l){for(;!Object.prototype.hasOwnProperty.call(o,s)&&(o=wd(o))!==null;);if(o)return(s=Object.getOwnPropertyDescriptor(o,s)).get?s.get.call(l):s.value})(e,r,i||e)}function ra(e,r){var i=Array.isArray(e)?e:void 0;if(!i)if((i=e&&(typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"]))==null)i=void 0;else{var o,s=[],l=!0,d=!1;try{for(i=i.call(e);!(l=(o=i.next()).done)&&(s.push(o.value),!r||s.length!==r);l=!0);}catch(p){d=!0;var h=p}finally{try{l||i.return==null||i.return()}finally{if(d)throw h}}i=s}if(!(e=i||vl(e,r)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return e}function G(e){var r=Array.isArray(e)?Uh(e):void 0;if(r||(r=typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null?Array.from(e):void 0),!(e=r||vl(e)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return e}function vl(e,r){if(e){if(typeof e=="string")return Uh(e,r);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Uh(e,r)}}function Uh(e,r){(r==null||r>e.length)&&(r=e.length);for(var i=0,o=Array(r);i<r;i++)o[i]=e[i];return o}function fa(e,r,i,o,s){var l={};return Object.keys(o).forEach(function(d){l[d]=o[d]}),l.enumerable=!!l.enumerable,l.configurable=!!l.configurable,("value"in l||l.initializer)&&(l.writable=!0),l=i.slice().reverse().reduce(function(d,h){return h(e,r,d)||d},l),s&&l.initializer!==void 0&&(l.value=l.initializer?l.initializer.call(s):void 0,l.initializer=void 0),l.initializer===void 0&&(Object.defineProperty(e,r,l),l=null),l}function $a(e){var r={exports:{}};return e(r,r.exports),r.exports}function wl(e,r){var i,o=3>arguments.length?e:arguments[2];return va(e)===o?e[r]:(i=Fb.f(e,r))?Q(i,"value")?i.value:i.get===void 0?void 0:i.get.call(o):ha(i=Vb(e))?wl(i,r,o):void 0}function rs(e){var r=e.charCodeAt(0)<<24,i=0|ss(~r),o=0,s=0|e.length,l="";if(5>i&&s>=i){for(r=r<<i>>>24+i,o=1;o<i;o=o+1|0)r=r<<6|63&e.charCodeAt(o);65535>=r?l+=xd(r):1114111>=r?l+=xd(55296+((r=r-65536|0)>>10)|0,56320+(1023&r)|0):o=0}for(;o<s;o=o+1|0)l+="\uFFFD";return l}function xl(){}function ts(e){var r=0|e.charCodeAt(0);if(55296<=r&&56319>=r){var i=0|e.charCodeAt(1);if(!(i==i&&56320<=i&&57343>=i))return xd(239,191,189);if(65535<(r=(r-55296<<10)+i-56320+65536|0))return xd(240|r>>>18,128|r>>>12&63,128|r>>>6&63,128|63&r)}return 127>=r?e:2047>=r?xd(192|r>>>6,128|63&r):xd(224|r>>>12,128|r>>>6&63,128|63&r)}function yl(){}function ea(){ea.init.call(this)}function ng(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+X(e))}function zl(e,r,i,o){ng(i);var s=e._events;if(s===void 0)s=e._events=Object.create(null),e._eventsCount=0;else{s.newListener!==void 0&&(e.emit("newListener",r,i.listener?i.listener:i),s=e._events);var l=s[r]}return l===void 0?(s[r]=i,++e._eventsCount):(typeof l=="function"?l=s[r]=o?[i,l]:[l,i]:o?l.unshift(i):l.push(i),0<(i=e._maxListeners===void 0?ea.defaultMaxListeners:e._maxListeners)&&l.length>i&&!l.warned&&(l.warned=!0,(i=Error("Possible EventEmitter memory leak detected. "+l.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",i.emitter=e,i.type=r,i.count=l.length,console&&console.warn&&console.warn(i))),e}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(e,r,i){return e={fired:!1,wrapFn:void 0,target:e,type:r,listener:i},(r=us.bind(e)).listener=i,e.wrapFn=r}function Bl(e,r,i){if((e=e._events)===void 0)return[];if((r=e[r])===void 0)return[];if(typeof r=="function")return i?[r.listener||r]:[r];if(i)for(i=Array(r.length),e=0;e<i.length;++e)i[e]=r[e].listener||r[e];else i=Cl(r,r.length);return i}function Dl(e){var r=this._events;if(r!==void 0){if(typeof(e=r[e])=="function")return 1;if(e!==void 0)return e.length}return 0}function Cl(e,r){for(var i=Array(r),o=0;o<r;++o)i[o]=e[o];return i}function vs(e,r,i){typeof e.on=="function"&&El(e,"error",r,i)}function El(e,r,i,o){if(typeof e.on=="function")o.once?e.once(r,i):e.on(r,i);else{if(typeof e.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(e));e.addEventListener(r,function s(l){o.once&&e.removeEventListener(r,s),i(l)})}}function ws(e){return e?G(e):xs(function(){return[]},function(r,i){return r.push(i),r})}function Fl(e,r){var i,o,s,l;return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:i=Gl(e)([Hl,Hl,function(h,p){return p}])[2],o=0;case 2:if(!(o<r.length)){d.next=17;break}if(s=r[o],!((l=i(Vh,s))instanceof og)){d.next=11;break}if((l=Wh(l.deref()))===Vh){d.next=10;break}return d.next=10,l;case 10:return d.abrupt("return");case 11:if(l===Vh){d.next=14;break}return d.next=14,l;case 14:o++,d.next=2;break;case 17:case"end":return d.stop()}},ys)}function pg(e,r){return r!=null&&typeof r[Symbol.iterator]=="function"?Fl(pg(e),r):function(i){var o=i[2];return zs(i,function(s,l){return o(s,e(l))})}}function Ac(e){return Object.prototype.toString.call(e).slice(8,-1)}function yd(e){return Ac(e)==="Object"&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Il(e){var r;return(r=Ac(e)==="Boolean"||Ac(e)==="Null"||Ac(e)==="Undefined")||(r=Ac(e)==="Number"&&!isNaN(e)),r||Ac(e)==="String"||Ac(e)==="Symbol"}function zd(e){var r=-1,i=e==null?0:e.length;for(this.clear();++r<i;){var o=e[r];this.set(o[0],o[1])}}function ce(e){var r=-1,i=e==null?0:e.length;for(this.clear();++r<i;){var o=e[r];this.set(o[0],o[1])}}function de(e){var r=-1,i=e==null?0:e.length;for(this.clear();++r<i;){var o=e[r];this.set(o[0],o[1])}}function gf(e){var r=-1,i=e==null?0:e.length;for(this.__data__=new qg;++r<i;)this.add(e[r])}function ee(e){this.size=(this.__data__=new rg(e)).size}function fe(e,r,i,o,s,l){var d,h=1&r,p=2&r,f=4&r;if(i&&(d=s?i(e,o,s,l):i(e)),d!==void 0)return d;if(!lb(e))return e;if(o=Va(e)){if(d=As(e),!h)return Xh(e,d)}else{var _=hf(e),g=_=="[object Function]"||_=="[object GeneratorFunction]";if(jf(e))return Jl(e,h);if(_=="[object Object]"||_=="[object Arguments]"||g&&!s){if(d=p||g?{}:Kl(e),!h)return p?Bs(e,Cs(d,e)):Ds(e,Es(d,e))}else{if(!wa[_])return s?e:{};d=Fs(e,_,h)}}if(l||(l=new ge),s=l.get(e))return s;l.set(e,d),Gs(e)?e.forEach(function(C){d.add(fe(C,r,i,C,e,l))}):Hs(e)&&e.forEach(function(C,k){d.set(k,fe(C,r,i,k,e,l))}),p=f?p?Ll:Yh:p?kf:Ad;var b=o?void 0:p(e);return Is(b||e,function(C,k){b&&(C=e[k=C]),Ml(d,k,fe(C,r,i,k,e,l))}),d}function Zh(e,r){if(typeof e!="function"||r!=null&&typeof r!="function")throw new TypeError("Expected a function");var i=function o(){var s=arguments,l=r?r.apply(this,s):s[0],d=o.cache;return d.has(l)?d.get(l):(s=e.apply(this,s),o.cache=d.set(l,s)||d,s)};return i.cache=new(Zh.Cache||qg),i}function Nl(e){if(typeof e=="string")return e;if(Va(e))return he(e,Nl)+"";if(ie(e))return Ol?Ol.call(e):"";var r=e+"";return r=="0"&&1/e==-Js?"-0":r}function $h(e,r,i,o,s){var l=-1,d=e.length;for(i||(i=Ks),s||(s=[]);++l<d;){var h=e[l];0<r&&i(h)?1<r?$h(h,r-1,i,o,s):ai(s,h):o||(s[s.length]=h)}return s}function je(e,r,i,o,s){if(e===r)r=!0;else if(e==null||r==null||!gc(e)&&!gc(r))r=e!=e&&r!=r;else t:{var l=Va(e),d=Va(r),h=l?"[object Array]":hf(e),p=d?"[object Array]":hf(r),f=(h=h=="[object Arguments]"?"[object Object]":h)=="[object Object]";if(d=(p=p=="[object Arguments]"?"[object Object]":p)=="[object Object]",(p=h==p)&&jf(e)){if(!jf(r)){r=!1;break t}l=!0,f=!1}if(p&&!f)s||(s=new ge),r=l||bi(e)?Pl(e,r,i,o,je,s):Ls(e,r,h,i,o,je,s);else{if(!(1&i)&&(l=f&&Ql.call(e,"__wrapped__"),h=d&&Ql.call(r,"__wrapped__"),l||h)){e=l?e.value():e,r=h?r.value():r,s||(s=new ge),r=je(e,r,i,o,s);break t}if(p)e:if(s||(s=new ge),l=1&i,h=Yh(e),d=h.length,p=Yh(r).length,d==p||l){for(p=d;p--;){var _=h[p];if(!(l?_ in r:Ms.call(r,_))){r=!1;break e}}if(f=s.get(e),_=s.get(r),f&&_)r=f==r&&_==e;else{f=!0,s.set(e,r),s.set(r,e);for(var g=l;++p<d;){var b=e[_=h[p]],C=r[_];if(o)var k=l?o(C,b,_,r,e,s):o(b,C,_,e,r,s);if(k===void 0?b!==C&&!je(b,C,i,o,s):!k){f=!1;break}g||(g=_=="constructor")}f&&!g&&(i=e.constructor)!=(o=r.constructor)&&"constructor"in e&&"constructor"in r&&!(typeof i=="function"&&i instanceof i&&typeof o=="function"&&o instanceof o)&&(f=!1),s.delete(e),s.delete(r),r=f}}else r=!1;else r=!1}}return r}function xa(e,r,i){this.low=0|e,this.high=0|r,this.unsigned=!!i}function mb(e){return(e&&e.__isLong__)===!0}function Bd(e,r){var i;if(r){if((r=0<=(e>>>=0)&&256>e)&&(i=Rl[e]))return i;i=ya(e,0>(0|e)?-1:0,!0),r&&(Rl[e]=i)}else{if((r=-128<=(e|=0)&&128>e)&&(i=Sl[e]))return i;i=ya(e,0>e?-1:0,!1),r&&(Sl[e]=i)}return i}function Gb(e,r){if(isNaN(e))return r?Cd:Hb;if(r){if(0>e)return Cd;if(e>=Tl)return Ul}else{if(e<=-Vl)return nb;if(e+1>=Vl)return Wl}return 0>e?Gb(-e,r).neg():ya(e%ke|0,e/ke|0,r)}function ya(e,r,i){return new xa(e,r,i)}function ci(e,r,i){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return Hb;if(typeof r=="number"?(i=r,r=!1):r=!!r,2>(i=i||10)||36<i)throw RangeError("radix");var o;if(0<(o=e.indexOf("-")))throw Error("interior hyphen");if(o===0)return ci(e.substring(1),r,i).neg();o=Gb(sg(i,8));for(var s=Hb,l=0;l<e.length;l+=8){var d=Math.min(8,e.length-l),h=parseInt(e.substring(l,l+d),i);8>d?(d=Gb(sg(i,d)),s=s.mul(d).add(Gb(h))):s=(s=s.mul(o)).add(Gb(h))}return s.unsigned=r,s}function Wb(e,r){return typeof e=="number"?Gb(e,r):typeof e=="string"?ci(e,r):ya(e.low,e.high,typeof r=="boolean"?r:e.unsigned)}function O(e,r){function i(){this.constructor=e}di(e,r),e.prototype=r===null?Object.create(r):(i.prototype=r.prototype,new i)}function le(e){return typeof e=="function"}function me(e){setTimeout(function(){throw e},0)}function ei(e){return e!==null&&X(e)==="object"}function Xl(e){return e.reduce(function(r,i){return r.concat(i instanceof lf?i.errors:i)},[])}function fi(e){for(;e;){var r=e.destination,i=e.isStopped;if(e.closed||i)return!1;e=r&&r instanceof ia?r:null}return!0}function Yc(e){return e}function gi(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Yl(e)}function Yl(e){return e.length===0?Yc:e.length===1?e[0]:function(r){return e.reduce(function(i,o){return o(i)},r)}}function Zl(e){if(e||(e=Ib.Promise||Promise),!e)throw Error("no Promise impl found");return e}function $l(){return function(e){return e.lift(new Ns(e))}}function mf(e){return e?Os(e):vb}function Os(e){return new Y(function(r){return e.schedule(function(){return r.complete()})})}function Zc(e){return e&&typeof e.schedule=="function"}function hi(e,r){return new Y(function(i){var o=new Oa,s=0;return o.add(r.schedule(function(){s===e.length?i.complete():(i.next(e[s++]),i.closed||o.add(this.schedule()))})),o})}function nf(e,r){return r?hi(e,r):new Y(am(e))}function bb(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Zc(r=e[e.length-1])?(e.pop(),hi(e,r)):nf(e)}function Z(e,r){return new Y(r?function(i){return r.schedule(Ps,0,{error:e,subscriber:i})}:function(i){return i.error(e)})}function Ps(e){e.subscriber.error(e.error)}function Qs(e,r){return r===void 0&&(r=0),function(i){return i.lift(new Rs(e,r))}}function bm(e){return e in ii&&(delete ii[e],!0)}function hc(){}function ba(e,r){return function(i){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new Ss(e,r))}}function cm(e,r,i){if(r){if(!Zc(r))return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return cm(e,i).apply(void 0,o).pipe(ba(function(l){return Jb(l)?r.apply(void 0,l):r(l)}))};i=r}return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var l,d=this,h={context:d,subject:l,callbackFunc:e,scheduler:i};return new Y(function(p){if(i)return i.schedule(Ts,0,{args:o,subscriber:p,params:h});if(!l){l=new of;try{e.apply(d,o.concat([function(){for(var f=[],_=0;_<arguments.length;_++)f[_]=arguments[_];l.next(1>=f.length?f[0]:f),l.complete()}]))}catch(f){fi(l)?l.error(f):console.warn(f)}}return l.subscribe(p)})}}function Ts(e){var r=this,i=e.args,o=e.subscriber,s=e.params;e=s.callbackFunc;var l=s.context,d=s.scheduler,h=s.subject;if(!h){h=s.subject=new of,s=function(){for(var p=[],f=0;f<arguments.length;f++)p[f]=arguments[f];r.add(d.schedule(Us,0,{value:1>=p.length?p[0]:p,subject:h}))};try{e.apply(l,i.concat([s]))}catch(p){h.error(p)}}this.add(h.subscribe(o))}function Us(e){var r=e.subject;r.next(e.value),r.complete()}function dm(e,r,i){if(r){if(!Zc(r))return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];return dm(e,i).apply(void 0,o).pipe(ba(function(l){return Jb(l)?r.apply(void 0,l):r(l)}))};i=r}return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var l={subject:void 0,args:o,callbackFunc:e,scheduler:i,context:this};return new Y(function(d){var h=l.context,p=l.subject;if(i)return i.schedule(Vs,0,{params:l,subscriber:d,context:h});if(!p){p=l.subject=new of;try{e.apply(h,o.concat([function(){for(var f=[],_=0;_<arguments.length;_++)f[_]=arguments[_];(_=f.shift())?p.error(_):(p.next(1>=f.length?f[0]:f),p.complete())}]))}catch(f){fi(p)?p.error(f):console.warn(f)}}return p.subscribe(d)})}}function Vs(e){var r=this,i=e.params,o=e.subscriber;e=e.context;var s=i.callbackFunc,l=i.args,d=i.scheduler,h=i.subject;if(!h){h=i.subject=new of,i=function(){for(var p=[],f=0;f<arguments.length;f++)p[f]=arguments[f];(f=p.shift())?r.add(d.schedule(em,0,{err:f,subject:h})):r.add(d.schedule(Ws,0,{value:1>=p.length?p[0]:p,subject:h}))};try{s.apply(e,l.concat([i]))}catch(p){this.add(d.schedule(em,0,{err:p,subject:h}))}}this.add(h.subscribe(o))}function Ws(e){var r=e.subject;r.next(e.value),r.complete()}function em(e){e.subject.error(e.err)}function fm(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}function ji(e,r,i,o,s){if(s===void 0&&(s=new Xs(e,i,o)),!s.closed)return r instanceof Y?r.subscribe(s):pf(r)(s)}function Ys(e,r){return new Y(function(i){var o=new Oa;return o.add(r.schedule(function(){var s=e[ne]();o.add(s.subscribe({next:function(l){o.add(r.schedule(function(){return i.next(l)}))},error:function(l){o.add(r.schedule(function(){return i.error(l)}))},complete:function(){o.add(r.schedule(function(){return i.complete()}))}}))})),o})}function Zs(e,r){return new Y(function(i){var o=new Oa;return o.add(r.schedule(function(){return e.then(function(s){o.add(r.schedule(function(){i.next(s),o.add(r.schedule(function(){return i.complete()}))}))},function(s){o.add(r.schedule(function(){return i.error(s)}))})})),o})}function $s(e,r){if(!e)throw Error("Iterable cannot be null");return new Y(function(i){var o,s=new Oa;return s.add(function(){o&&typeof o.return=="function"&&o.return()}),s.add(r.schedule(function(){o=e[$c](),s.add(r.schedule(function(){if(!i.closed){try{var l=o.next(),d=l.value,h=l.done}catch(p){return void i.error(p)}h?i.complete():(i.next(d),this.schedule())}}))})),s})}function gm(e,r){if(e!=null){if(e&&typeof e[ne]=="function")return Ys(e,r);if(fm(e))return Zs(e,r);if(hm(e))return hi(e,r);if(e&&typeof e[$c]=="function"||typeof e=="string")return $s(e,r)}throw new TypeError((e!==null&&X(e)||e)+" is not observable")}function Kb(e,r){return r?gm(e,r):e instanceof Y?e:new Y(pf(e))}function ic(e,r){if(!r.closed){if(e instanceof Y)return e.subscribe(r);try{var i=pf(e)(r)}catch(o){r.error(o)}return i}}function cb(e,r,i){return i===void 0&&(i=Number.POSITIVE_INFINITY),typeof r=="function"?function(o){return o.pipe(cb(function(s,l){return Kb(e(s,l)).pipe(ba(function(d,h){return r(s,d,l,h)}))},i))}:(typeof r=="number"&&(i=r),function(o){return o.lift(new at(e,i))})}function tg(e){return e===void 0&&(e=Number.POSITIVE_INFINITY),cb(Yc,e)}function im(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return tg(1)(bb.apply(void 0,e))}function ad(e){return new Y(function(r){try{var i=e()}catch(o){return void r.error(o)}return(i?Kb(i):mf()).subscribe(r)})}function jm(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length===1){var i=e[0];if(Jb(i))return ug(i,null);if(ei(i)&&Object.getPrototypeOf(i)===Object.prototype)return ug((e=Object.keys(i)).map(function(s){return i[s]}),e)}if(typeof e[e.length-1]=="function"){var o=e.pop();return ug(e=e.length===1&&Jb(e[0])?e[0]:e,null).pipe(ba(function(s){return o.apply(void 0,s)}))}return ug(e,null)}function ug(e,r){return new Y(function(i){var o=e.length;if(o===0)i.complete();else for(var s=Array(o),l=0,d=0,h=function(f){var _=Kb(e[f]),g=!1;i.add(_.subscribe({next:function(b){g||(g=!0,d++),s[f]=b},error:function(b){return i.error(b)},complete:function(){++l!==o&&g||(d===o&&i.next(r?r.reduce(function(b,C,k){return b[C]=s[k],b},{}):s),i.complete())}}))},p=0;p<o;p++)h(p)})}function gb(e,r,i,o){return le(i)&&(o=i,i=void 0),o?gb(e,r,i).pipe(ba(function(s){return Jb(s)?o.apply(void 0,s):o(s)})):new Y(function(s){km(e,r,function(l){1<arguments.length?s.next(Array.prototype.slice.call(arguments)):s.next(l)},s,i)})}function km(e,r,i,o,s){if(e&&typeof e.addEventListener=="function"&&typeof e.removeEventListener=="function"){e.addEventListener(r,i,s);var l=function(){return e.removeEventListener(r,i,s)}}else if(e&&typeof e.on=="function"&&typeof e.off=="function")e.on(r,i),l=function(){return e.off(r,i)};else if(e&&typeof e.addListener=="function"&&typeof e.removeListener=="function")e.addListener(r,i),l=function(){return e.removeListener(r,i)};else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var d=0,h=e.length;d<h;d++)km(e[d],r,i,o,s)}o.add(l)}function lm(e,r,i){return i?lm(e,r).pipe(ba(function(o){return Jb(o)?i.apply(void 0,o):i(o)})):new Y(function(o){var s=function(){for(var d=[],h=0;h<arguments.length;h++)d[h]=arguments[h];return o.next(d.length===1?d[0]:d)};try{var l=e(s)}catch(d){return void o.error(d)}if(le(r))return function(){return r(s,l)}})}function bt(e){var r=e.subscriber,i=e.condition;if(!r.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(l){return void r.error(l)}else e.needIterate=!0;if(i){var o=void 0;try{o=i(e.state)}catch(l){return void r.error(l)}if(!o)return void r.complete();if(r.closed)return}try{var s=e.resultSelector(e.state)}catch(l){return void r.error(l)}if(!r.closed&&(r.next(s),!r.closed))return this.schedule(e)}}function ki(e){return!Jb(e)&&0<=e-parseFloat(e)+1}function mm(e,r){return e===void 0&&(e=0),r===void 0&&(r=bd),(!ki(e)||0>e)&&(e=0),r&&typeof r.schedule=="function"||(r=bd),new Y(function(i){return i.add(r.schedule(ct,e,{subscriber:i,counter:0,period:e})),i})}function ct(e){var r=e.subscriber,i=e.counter;e=e.period,r.next(i),this.schedule({subscriber:r,counter:i+1,period:e},e)}function Xb(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];r=Number.POSITIVE_INFINITY;var i=null,o=e[e.length-1];return Zc(o)?(i=e.pop(),1<e.length&&typeof e[e.length-1]=="number"&&(r=e.pop())):typeof o=="number"&&(r=e.pop()),i===null&&e.length===1&&e[0]instanceof Y?e[0]:tg(r)(nf(e,i))}function li(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length===0)return vb;var i=e[0],o=e.slice(1);return e.length===1&&Jb(i)?li.apply(void 0,i):new Y(function(s){var l=function(){return s.add(li.apply(void 0,o).subscribe(s))};return Kb(i).subscribe({next:function(d){s.next(d)},error:l,complete:l})})}function dt(e){var r=e.keys,i=e.index,o=e.subscriber,s=e.subscription;if(e=e.obj,!o.closed)if(i<r.length){var l=r[i];o.next([l,e[l]]),s.add(this.schedule({keys:r,index:i+1,subscriber:o,subscription:s,obj:e}))}else o.complete()}function et(e,r){function i(){return!i.pred.apply(i.thisArg,arguments)}return i.pred=e,i.thisArg=r,i}function wb(e,r){return function(i){return i.lift(new ft(e,r))}}function Ca(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length===1){if(!Jb(e[0]))return e[0];e=e[0]}return nf(e,void 0).lift(new gt)}function ht(e){var r=e.start,i=e.index,o=e.subscriber;i>=e.count?o.complete():(o.next(r),o.closed||(e.index=i+1,e.start=r+1,this.schedule(e)))}function Bc(e,r,i){e===void 0&&(e=0);var o=-1;return ki(r)?o=1>Number(r)?1:Number(r):Zc(r)&&(i=r),Zc(i)||(i=bd),new Y(function(s){var l=ki(e)?e:+e-i.now();return i.schedule(it,l,{index:0,period:o,subscriber:s})})}function it(e){var r=e.index,i=e.period,o=e.subscriber;if(o.next(r),!o.closed){if(i===-1)return o.complete();e.index=r+1,this.schedule(e,i)}}function mi(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return typeof(r=e[e.length-1])=="function"&&e.pop(),nf(e,void 0).lift(new jt(r))}function Ga(e){return function(r){var i=new kt(e);return r=r.lift(i),i.caught=r}}function ni(e,r){return cb(e,r,1)}function nm(e){return e===void 0&&(e=null),function(r){return r.lift(new lt(e))}}function cd(e,r){r===void 0&&(r=bd);var i=e instanceof Date&&!isNaN(+e)?+e-r.now():Math.abs(e);return function(o){return o.lift(new mt(i,r))}}function om(e,r){return function(i){return i.lift(new nt(e,r))}}function Dd(e){return e===void 0&&(e=ot),function(r){return r.lift(new pt(e))}}function ot(){return new vg}function Ka(e){return function(r){return e===0?mf():r.lift(new qt(e))}}function pm(e,r){return r?function(i){return i.pipe(pm(function(o,s){return Kb(e(o,s)).pipe(ba(function(l,d){return r(o,l,s,d)}))}))}:function(i){return i.lift(new rt(e))}}function wg(e){return function(r){return r.lift(new st(e))}}function aa(e,r){var i=2<=arguments.length;return function(o){return o.pipe(e?wb(function(s,l){return e(s,l,o)}):Yc,Ka(1),i?nm(r):Dd(function(){return new vg}))}}function tt(){return function(e){return e.lift(new ut)}}function qm(e){return function(r){return e===0?mf():r.lift(new vt(e))}}function qf(e){return function(r){return r.lift(new wt(e))}}function xg(e,r){var i=!1;return 2<=arguments.length&&(i=!0),function(o){return o.lift(new xt(e,r,i))}}function rm(e,r){return 2<=arguments.length?function(i){return gi(xg(e,r),qm(1),nm(r))(i)}:function(i){return gi(xg(function(o,s,l){return e(o,s,l+1)}),qm(1))(i)}}function yt(e,r){return function(i){var o=typeof e=="function"?e:function(){return e};if(typeof r=="function")return i.lift(new zt(o,r));var s=Object.create(i,At);return s.source=i,s.subjectFactory=o,s}}function oe(e){return function(r){return r.lift(new Bt(e,r))}}function Ct(){return new Pa}function pe(){return function(e){return $l()(yt(Ct)(e))}}function sm(e,r,i){var o=e&&X(e)==="object"?e:{bufferSize:e,windowTime:r,refCount:!1,scheduler:i};return function(s){return s.lift(Dt(o))}}function Dt(e){var r,i,o=e.bufferSize,s=o===void 0?Number.POSITIVE_INFINITY:o,l=(o=e.windowTime)===void 0?Number.POSITIVE_INFINITY:o,d=e.refCount,h=e.scheduler,p=0,f=!1,_=!1;return function(g){if(p++,!r||f){f=!1;var b=(r=new qe(s,l,h)).subscribe(this);i=g.subscribe({next:function(C){r.next(C)},error:function(C){f=!0,r.error(C)},complete:function(){_=!0,i=void 0,r.complete()}}),_&&(i=void 0)}else b=r.subscribe(this);this.add(function(){p--,b.unsubscribe(),b=void 0,i&&!_&&d&&p===0&&(i.unsubscribe(),r=i=void 0)})}}function Cc(e,r){return typeof r=="function"?function(i){return i.pipe(Cc(function(o,s){return Kb(e(o,s)).pipe(ba(function(l,d){return r(o,l,s,d)}))}))}:function(i){return i.lift(new Et(e))}}function ob(e){return function(r){return r.lift(new Ft(e))}}function Gt(e,r){return r===void 0&&(r=!1),function(i){return i.lift(new Ht(e,r))}}function ca(e,r,i){return function(o){return o.lift(new It(e,r,i))}}function Jt(e,r,i){return r===void 0&&(r=bd),i===void 0&&(i=Kt),function(o){return o.lift(new Lt(e,r,i.leading,i.trailing))}}function Mt(e){e.subscriber.clearThrottle()}function Nt(e,r,i){return i===void 0&&(i=bd),function(o){var s=e instanceof Date&&!isNaN(+e),l=s?+e-i.now():Math.abs(e);return o.lift(new Ot(l,s,r,i))}}function hb(e,r){return r===void 0&&(r=bd),Nt(e,Z(new pb),r)}function Pt(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return function(i){var o;return typeof e[e.length-1]=="function"&&(o=e.pop()),i.lift(new Qt(e,o))}}function tm(e,r,i,o,s){e!==r&&um(r,function(l,d){if(s||(s=new ge),lb(l)){l=s;var h=oi(e,d),p=oi(r,d),f=l.get(p);if(f)pi(e,d,f);else{var _=(f=o?o(h,p,d+"",e,r,l):void 0)===void 0;if(_){var g=Va(p),b=!g&&jf(p),C=!g&&!b&&bi(p);f=p,g||b||C?Va(h)?f=h:gc(h)&&Ed(h)?f=Xh(h):b?(_=!1,f=Jl(p,!0)):C?(_=!1,f=vm(p,!0)):f=[]:wm(p)||rf(p)?(f=h,rf(h)?f=re(h,kf(h)):lb(h)&&!qi(h)||(f=Kl(p))):_=!1}_&&(l.set(p,f),tm(f,p,i,o,l),l.delete(p)),pi(e,d,f)}}else(h=o?o(oi(e,d),l,d+"",e,r,s):void 0)===void 0&&(h=l),pi(e,d,h)},kf)}function Rt(e){var r=1,i=ri;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?r=1>=arguments.length?void 0:arguments[1]:i=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(r=1>=arguments.length?void 0:arguments[1],i=2>=arguments.length?void 0:arguments[2]);var o=r||1;return function(s){return s.pipe(xg(function(l,d){var h=i.now(),p=h-e;if((l=l.filter(function(g){return g.until>p})).length>=o){var f=l[l.length-1],_=l[0].until+e*Math.floor(l.length/o);l.push({delay:f.until<h?_-h:_-f.until,until:_,value:d})}else l.push({delay:0,until:h,value:d});return l},[]),ba(function(l){return l[l.length-1]}),ni(function(l){var d=bb(l.value);return l.delay?d.pipe(cd(l.delay,i)):d}))}}function St(e,r){var i=(r=r===void 0?{protocols:xm,makeWebSocket:ym}:r).protocols,o=i===void 0?xm:i,s=(r=r.makeWebSocket)===void 0?ym:r;return new Y(function(l){var d,h=new Pa,p=s(e,o),f=!1,_=!1,g=function(b){if(d)throw f=!0,b=Error("Web socket message factory function called more than once"),l.error(b),b;return d=b.subscribe(function(C){p.send(C)}),h};return p.onopen=function(){_?(f=!0,p.close()):l.next(g)},p.onmessage=function(b){h.next(b.data)},p.onerror=function(b){f=!0,l.error(Error(b.message))},p.onclose=function(b){f||(f=!0,_?(l.complete(),h.complete()):l.error(Error(b.code===1e3?"Normal closure":b.reason)))},function(){_=!0,d&&d.unsubscribe(),f||(f=!0,p.close())}})}function yg(){this._listeners={}}function zm(e){return typeof Float32Array<"u"?function(){function r(p,f,_){l[0]=p,f[_]=d[0],f[_+1]=d[1],f[_+2]=d[2],f[_+3]=d[3]}function i(p,f,_){l[0]=p,f[_]=d[3],f[_+1]=d[2],f[_+2]=d[1],f[_+3]=d[0]}function o(p,f){return d[0]=p[f],d[1]=p[f+1],d[2]=p[f+2],d[3]=p[f+3],l[0]}function s(p,f){return d[3]=p[f],d[2]=p[f+1],d[1]=p[f+2],d[0]=p[f+3],l[0]}var l=new Float32Array([-0]),d=new Uint8Array(l.buffer),h=d[3]===128;e.writeFloatLE=h?r:i,e.writeFloatBE=h?i:r,e.readFloatLE=h?o:s,e.readFloatBE=h?s:o}():function(){function r(o,s,l,d){var h=0>s?1:0;if(h&&(s=-s),s===0)o(0<1/s?0:2147483648,l,d);else if(isNaN(s))o(2143289344,l,d);else if(34028234663852886e22<s)o((h<<31|2139095040)>>>0,l,d);else if(11754943508222875e-54>s)o((h<<31|Math.round(s/1401298464324817e-60))>>>0,l,d);else{var p=Math.floor(Math.log(s)/Math.LN2);o((h<<31|p+127<<23|8388607&Math.round(s*Math.pow(2,-p)*8388608))>>>0,l,d)}}function i(o,s,l){return l=o(s,l),o=2*(l>>31)+1,s=l>>>23&255,l&=8388607,s===255?l?NaN:1/0*o:s===0?1401298464324817e-60*o*l:o*Math.pow(2,s-150)*(l+8388608)}e.writeFloatLE=r.bind(null,Am),e.writeFloatBE=r.bind(null,Bm),e.readFloatLE=i.bind(null,Cm),e.readFloatBE=i.bind(null,Dm)}(),typeof Float64Array<"u"?function(){function r(p,f,_){l[0]=p,f[_]=d[0],f[_+1]=d[1],f[_+2]=d[2],f[_+3]=d[3],f[_+4]=d[4],f[_+5]=d[5],f[_+6]=d[6],f[_+7]=d[7]}function i(p,f,_){l[0]=p,f[_]=d[7],f[_+1]=d[6],f[_+2]=d[5],f[_+3]=d[4],f[_+4]=d[3],f[_+5]=d[2],f[_+6]=d[1],f[_+7]=d[0]}function o(p,f){return d[0]=p[f],d[1]=p[f+1],d[2]=p[f+2],d[3]=p[f+3],d[4]=p[f+4],d[5]=p[f+5],d[6]=p[f+6],d[7]=p[f+7],l[0]}function s(p,f){return d[7]=p[f],d[6]=p[f+1],d[5]=p[f+2],d[4]=p[f+3],d[3]=p[f+4],d[2]=p[f+5],d[1]=p[f+6],d[0]=p[f+7],l[0]}var l=new Float64Array([-0]),d=new Uint8Array(l.buffer),h=d[7]===128;e.writeDoubleLE=h?r:i,e.writeDoubleBE=h?i:r,e.readDoubleLE=h?o:s,e.readDoubleBE=h?s:o}():function(){function r(o,s,l,d,h,p){var f=0>d?1:0;if(f&&(d=-d),d===0)o(0,h,p+s),o(0<1/d?0:2147483648,h,p+l);else if(isNaN(d))o(0,h,p+s),o(2146959360,h,p+l);else if(17976931348623157e292<d)o(0,h,p+s),o((f<<31|2146435072)>>>0,h,p+l);else if(22250738585072014e-324>d)o((d/=5e-324)>>>0,h,p+s),o((f<<31|d/4294967296)>>>0,h,p+l);else{var _=Math.floor(Math.log(d)/Math.LN2);_===1024&&(_=1023),o(4503599627370496*(d*=Math.pow(2,-_))>>>0,h,p+s),o((f<<31|_+1023<<20|1048576*d&1048575)>>>0,h,p+l)}}function i(o,s,l,d,h){return s=o(d,h+s),d=o(d,h+l),o=2*(d>>31)+1,s=4294967296*(1048575&d)+s,(l=d>>>20&2047)===2047?s?NaN:1/0*o:l===0?5e-324*o*s:o*Math.pow(2,l-1075)*(s+4503599627370496)}e.writeDoubleLE=r.bind(null,Am,0,4),e.writeDoubleBE=r.bind(null,Bm,4,0),e.readDoubleLE=i.bind(null,Cm,0,4),e.readDoubleBE=i.bind(null,Dm,4,0)}(),e}function Am(e,r,i){r[i]=255&e,r[i+1]=e>>>8&255,r[i+2]=e>>>16&255,r[i+3]=e>>>24}function Bm(e,r,i){r[i]=e>>>24,r[i+1]=e>>>16&255,r[i+2]=e>>>8&255,r[i+3]=255&e}function Cm(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24)>>>0}function Dm(e,r){return(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])>>>0}function Wa(e,r){this.lo=e>>>0,this.hi=r>>>0}function sf(e,r,i){this.fn=e,this.len=r,this.next=void 0,this.val=i}function si(){}function Tt(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(e,r,i){r[i]=255&e}function ui(e,r){this.len=e,this.next=void 0,this.val=r}function vi(e,r,i){for(;e.hi;)r[i++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)r[i++]=127&e.lo|128,e.lo>>>=7;r[i++]=e.lo}function wi(e,r,i){r[i]=255&e,r[i+1]=e>>>8&255,r[i+2]=e>>>16&255,r[i+3]=e>>>24}function jc(){xi.call(this)}function Ut(e,r,i){40>e.length?V.utf8.write(e,r,i):r.utf8Write?r.utf8Write(e,i):r.write(e,i)}function Yb(e,r){return RangeError("index out of range: "+e.pos+" + "+(r||1)+" > "+e.len)}function La(e){this.buf=e,this.pos=0,this.len=e.length}function yi(){var e=new Em(0,0),r=0;if(!(4<this.len-this.pos)){for(;3>r;++r){if(this.pos>=this.len)throw Yb(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*r)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*r)>>>0,e}for(;4>r;++r)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*r)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(r=0,4<this.len-this.pos){for(;5>r;++r)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>r;++r){if(this.pos>=this.len)throw Yb(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function zg(e,r){return(e[r-4]|e[r-3]<<8|e[r-2]<<16|e[r-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(e){zi.call(this,e)}function tf(e,r,i){if(typeof e!="function")throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!r,this.responseDelimited=!!i}function za(e){return typeof e=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&e!=="null"}function Gm(e){try{var r=e.split(".").map(function(o){return Number(o)})}catch{return!1}if(r.length!==4||r[0]===0)return!1;for(e=0;e<r.length;e++){var i=r[e];if(!Number.isInteger(i)||0>i||255<i)return!1}return!0}function Hm(e,r){if(!Array.isArray(r)||r.length===0||32<r.length||r.some(function(i){return i.length===0||32<i.length}))throw new I("arguments is not valid",Ja);if(!za(e))throw new I("ID is invalid",Ja)}function uf(e){var r=e.attributes,i=e.attrSizeMap,o=e.maxAttrsCount,s=e.maxAttrValueSize;if(e=e.maxTotalSize,!yd(r))throw new I("attributes must be an object",Ja);if(Object.keys(r).length>o)throw new ib("Exceed the limit of ".concat(o," attributes"),se);if(Object.keys(r).length===0)throw new I("The attributes is an empty object",Ja);var l=0,d=0;for(r=Object.entries(r);d<r.length;d++){var h=ra(r[d],2),p=h[1];h=new Blob([h[0]]).size;var f=new Blob([p]).size;if(h===0||32<h)throw new I("Invalid attribute key",Ja);if(f>s)throw new ib("Invalid attribute value, over the limit of ".concat(s," bytes"),se);if(typeof p!="string"||p.length===0)throw new I("Invalid attribute value",Ja);l+=h,l+=f}if(l>e)throw new ib("The attributes size overflow",se);if(i!==void 0){if(Object.keys(i).length>o)throw new ib("Exceed the limit of ".concat(o," attributes"),se);for(l=o=0,i=Object.entries(i);l<i.length;l++){if(d=(r=ra(i[l],2))[1],(r=new Blob([r[0]]).size)===0)throw new I("Invalid attribute key",Ja);if(d>s)throw new ib("Invalid attribute value, over the limit of ".concat(s," bytes"),se);o+=r,o+=d}if(o>e)throw new ib("The attributes size overflow",se)}}function Ag(e,r){return Math.floor(Math.random()*(Math.floor(r)-Math.ceil(e)+1))+e}function Bg(){var e=Ag(0,4294967295),r=Ag(1,4294967295);return new U(e,r,!0)}function Xa(e){return e.toString().padEnd(32,"0")}function Im(e,r){return new TypeError("Unexpected ".concat(e,": ").concat(r))}function Jm(e,r){return e=e.split(".").map(function(i){return Number(i)}),r=r.split(".").map(function(i){return Number(i)}),Math.sqrt(1e3*Math.pow(e[0]-r[0],2)+100*Math.pow(e[1]-r[1],2)+10*Math.pow(e[2]-r[2],2)+1*Math.pow(e[3]-r[3],2))}function Km(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}function Ai(e,r){r="".concat(e).concat(r||"");var i=Lm.get(r)||1;return Lm.set(r,i+1),"".concat(e).concat(i)}function Mm(e,r){var i=typeof r=="number"?r:r!==void 0&&typeof r!="string"?r.code:void 0;return r=typeof r!="number"&&typeof r!="string"&&r!==void 0&&r.serverCode!==void 0?r.serverCode:void 0,i="".concat(i!==void 0?" Error Code ".concat(i):"").concat(r!==void 0?", server Code ".concat(r):""),e=typeof e=="string"&&e?Cg(e):Array.isArray(e)&&typeof e[0]=="string"&&e[0]?Cg(Nm.apply(void 0,[e[0]].concat(G(e.slice(1))))):"","".concat(i===""?"":"".concat(i," - ")).concat(e)}function Om(e){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark(function e(r){return w.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(o){setTimeout(function(){o()},r)}));case 1:case"end":return i.stop()}},e)}))).apply(this,arguments)}function Pm(e){return e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"}function Dg(e){var r=255&e,i=e>>8&255,o=e>>16&255;return"".concat(e>>24&255,".").concat(o,".").concat(i,".").concat(r)}function te(e,r,i){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark(function e(r,i,o){var s,l,d,h,p,f,_,g,b,C,k,A,P,x,j,z,_t,ue,_n,Ei,_s,kc,_i,_h,_p,Qm;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:if(s=i.body,l=i.headers,d=l===void 0?{}:l,h=i.timeout,p=h===void 0?1e4:h,f=i.signal,_=i.withCredentials,g=_!==void 0&&_,b=(o||{}).useBinaryResponse,C=b!==void 0&&b,(k=new XMLHttpRequest).open("POST",r,!0),k.responseType=C?"arraybuffer":"text",k.withCredentials=g,k.timeout=p,A=s instanceof FormData,P=s instanceof Uint8Array,!(1<(x=Object.keys(d).filter(function(ga){return ga.toLowerCase()==="content-type"})).length)){_o.next=14;break}throw new RangeError("multiple content-type");case 14:x.length===0&&(P?d["Content-Type"]="application/octet-stream":A||(d["Content-Type"]="application/json"));case 15:if("setRequestHeader"in k){_o.next=46;break}return k.abort(),_o.next=19,fetch(r,{body:A||P?s:JSON.stringify(s),cache:"no-cache",credentials:g?"include":"same-origin",headers:d,method:"POST",mode:"cors",referrer:"no-referrer",signal:f});case 19:if(j=_o.sent,!(200<=(z=j.status)&&300>z||z===304)){_o.next=31;break}if(!C){_o.next=27;break}return _o.next=25,j.arrayBuffer();case 25:return _t=_o.sent,_o.abrupt("return",{status:z,responseData:_t});case 27:return _o.next=29,j.text();case 29:return ue=_o.sent,_o.abrupt("return",{status:z,responseText:ue});case 31:return _n=new da(["Post XHR failure, status %d",z]),_o.prev=32,_o.next=35,j.text();case 35:throw Ei=_o.sent,_n.statusCode=z,_n.message=Ei||"Request failed, status ".concat(z),_n;case 41:throw _o.prev=41,_o.t0=_o.catch(32),_n.statusCode=z,_n.message="Request failed, status ".concat(z),_n;case 46:if(Object.keys(d).length!==0)for(_s=0,kc=Object.entries(d);_s<kc.length;_s++)_i=ra(kc[_s],2),_h=_i[0],_p=_i[1],k.setRequestHeader(_h,_p);return f!==void 0&&(Qm=function ga(){k.abort(),f.removeEventListener("abort",ga)},f.addEventListener("abort",Qm)),A||P?k.send(s):k.send(JSON.stringify(s)),_o.abrupt("return",new Promise(function(ga,vf){k.onload=function(){var Fi=k.status;if(200<=Fi&&300>Fi||Fi===304)ga(C?{status:Fi,responseData:k.response}:{status:Fi,responseText:k.responseText});else{var Gi=new da(["Post XHR failure, status %d",Fi]);Gi.statusCode=Fi,Gi.message=k.response||"Request failed, status ".concat(k.status),vf(Gi)}},k.ontimeout=function(Fi){vf(new db(["XHR request timed out after %d ms",p],{originalError:Fi}))},k.onerror=function(){var Fi=new da(["Post XHR failure, status %d",k.status]);Fi.statusCode=k.status,Fi.message=k.response||"Request failed, status ".concat(k.status),vf(Fi)},k.onabort=function(){try{vf(new DOMException("The request aborted.","AbortError"))}catch{var Fi=Error("The request aborted.");Fi.name="AbortError",vf(Fi)}}}));case 50:case"end":return _o.stop()}},e,null,[[32,41]])}))).apply(this,arguments)}function Rm(e){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark(function e(r){var i;return w.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return(i=new Image).src=r,o.abrupt("return",new Promise(function(s,l){i.onload=function(){s({width:i.width,height:i.height})},i.onerror=l}));case 3:case"end":return o.stop()}},e)}))).apply(this,arguments)}function Xt(e,r){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark(function e(r,i){var o,s,l,d,h,p,f,_,g,b;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(o=r.thumbnailHeight,s=o===void 0?0:o,l=r.thumbnailWidth,d=l===void 0?0:l,h=r.width,p=h===void 0?0:h,f=r.height,_=f===void 0?0:f,g=r.thumbnail,b=[],typeof s=="number"&&typeof d=="number"&&typeof p=="number"&&typeof _=="number"){C.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=p&&0>=_&&b.push(Rm(Sm(i)).then(function(k){p=k.width,_=k.height})),0>=d&&0>=s&&g!==void 0&&b.push(Ji(g).then(function(){var k=J(w.mark(function A(P){var x;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,Rm(Sm(P));case 2:x=j.sent,d=x.width,s=x.height;case 5:case"end":return j.stop()}},A)}));return function(A){return k.apply(this,arguments)}}())),C.next=9,Promise.all(b).catch(function(){});case 9:return C.abrupt("return",{width:p,height:_,thumbnailWidth:d,thumbnailHeight:s});case 10:case"end":return C.stop()}},e)}))).apply(this,arguments)}function Tm(e,r){if(!yd(e))throw new I("message object is not a plain object",r);if(e.messageType===void 0)if(e.rawMessage instanceof Uint8Array){if(e.messageType="RAW",e.text!==void 0)throw new I("Raw messages cannot have text property. Use description instead",r)}else{if(typeof e.text!="string")throw new I("messageType is undefined",r);if(e.messageType="TEXT",e.rawMessage!==void 0)throw new I("Text messages cannot have rawMessage property",r)}}function Gg(e){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark(function e(r){var i,o,s,l,d,h,p,f,_,g,b,C,k,A,P,x,j,z,_t,ue,_n;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:if(i=r.message,o=r.peerId,s=r.toPeer,l=r.session,d=r.errorCodes,h=r.diff,p=r.logger,f=r.options,l!==void 0){Ei.next=3;break}throw new K("The client is not logged in. Cannot do the operation",d.NOT_LOGGED_IN);case 3:if(_=!1,i.messageType!=="TEXT"||!i.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!s){Ei.next=11;break}if(g=i.text.split("_"),b=ra(g,3),C=b[0],k=b[1],b[2]!==void 0&&za(k)&&C==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){Ei.next=10;break}throw new I("Message is not valid",ve);case 10:_=!0;case 11:if(A=Date.now(),P=l.messageSentTimes.length-1,!((x=l.messageSentTimes[P])&&x+3e3<A)){Ei.next=18;break}l.messageSentTimes=[A],Ei.next=29;break;case 18:j=P;case 19:if(!(0<=j)){Ei.next=28;break}if(!(l.messageSentTimes[j]+3e3<A)){Ei.next=23;break}return l.messageSentTimes=l.messageSentTimes.slice(j+1,P+1),Ei.abrupt("break",28);case 23:if(!(180<=P-j+1)){Ei.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",d.TOO_OFTEN);case 25:j--,Ei.next=19;break;case 28:l.messageSentTimes.push(A);case 29:Ei.t0=i.messageType,Ei.next=Ei.t0==="TEXT"?32:Ei.t0==="RAW"?37:Ei.t0==="FILE"||Ei.t0==="IMAGE"?39:40;break;case 32:if(!_){Ei.next=36;break}return z=i.text.split("_"),_t=ra(z,3),ue=_t[1],_n=_t[2],p.info("[rtm-API] EndCall message send api is called"),Ei.abrupt("return",l.sendInvitationMessage({peerId:o,type:"CallCancel",extra:_n,channelId:ue,callId:"0"}));case 36:return Ei.abrupt("return",l.sendTextMessage(i.text,o,s,f,1e4-h));case 37:return i.description===void 0&&(i.description=""),Ei.abrupt("return",l.sendRawMessage(i.rawMessage,i.description,o,s,f,1e4-h));case 39:return Ei.abrupt("return",l.sendMediaMessage(i.messageType,i,o,s,f,1e4-h));case 40:throw new I("Invalid message type",ve);case 41:case"end":return Ei.stop()}},e)}))).apply(this,arguments)}function Yt(e){var r=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],i=e.replace(/(https?:\/\/)?(www.)?/i,"");return r||(i=i.split(".").slice(e.length-2).join(".")),i.indexOf("/")!==-1?i.split("/")[0]:i}function oa(e){if(typeof e!="string")return"[Sensitive Info]";var r=Math.floor(.7*e.length),i=e.length;return Um(e,r,i,"*".repeat(i-r))}function Vm(e,r,i){function o(s){if(e===void 0)return e;if(Il(s))return s;if(Array.isArray(s))return s.map(o);var l={},d=0;for(s=Hg(s);d<s.length;d++){var h=ra(s[d],2),p=h[0];if(typeof(h=h[1])=="string"&&i.includes(p)){l[p]=typeof h=="string"?oa(h):"[Sensitive Info]";break}r.includes(p)?l[p]="[Hidden Info]":l[p]=h==null?h:i.includes(p)?"[Sensitive Info]":o(h)}return l}return Array.isArray(e)?e.map(o):o(e)}function Wm(e){return Object.getOwnPropertyNames(e).forEach(function(r){X(r=e[r])=="object"&&r!==null&&Wm(r)}),Object.freeze(e)}function pa(e){return new TextDecoder("utf-8").decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function Ig(e){return new TextEncoder().encode(e).length}function Xm(){for(var e=0,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];for(r=0;r<i.length;r++)e+=i[r].length;for(e=new Uint8Array(e),o=r=0;o<i.length;o++){var s=i[o];e.set(s,r),r+=s.length}return e}function we(e,r,i){var o=e.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e=o?.[1],o=o?.[2]){var s;for(o=o.substr(1).split("&"),s=0;s<o.length;s++)if(o[s].split("=")[0]==r){o[s]=r+"="+encodeURIComponent(i);break}return s==o.length&&o.push(r+"="+encodeURIComponent(i)),e+"?"+o.join("&")}return e+"?"+r+"="+encodeURIComponent(i)}function Ji(e){return new Promise(function(r,i){var o=new FileReader;o.onloadend=function(){var s=o.result||new ArrayBuffer(0);r(s)},o.onerror=i,o.readAsArrayBuffer(e)})}function Zt(e,r){e=e=[e],typeof(r=r||{})=="string"&&(r={type:r});try{var i=new Blob(e,r)}catch(s){if(s.name!=="TypeError")throw s;i=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder);for(var o=0;o<e.length;o+=1)i.append(e[o]);i=i.getBlob(r.type)}return i}function Um(e,r,i,o){return typeof e!="string"?"[Sensitive Info]":e.substring(0,r)+o+e.substring(i)}function Ym(e){var r=[];return function i(o){if(o===null||X(o)!=="object")return o;if(r.indexOf(o)!==-1)return"[Circular]";if(r.push(o),typeof o.toJSON=="function")try{var s=i(o.toJSON());return r.pop(),s}catch(l){return"[Throws: "+(l?l.message:"?")+"]"}return Array.isArray(o)?(s=o.map(i),r.pop(),s):(s=Object.keys(o).reduce(function(l,d){t:{if($t.call(o,d))try{var h=o[d];break t}catch(p){h="[Throws: "+(p?p.message:"?")+"]";break t}h=o[d]}return l[d]=i(h),l},{}),r.pop(),s)}(e)}function au(e){if(!(100<(e=String(e)).length)&&(e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e))){var r=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}}function Jg(e,r,i,o){return Math.round(e/i)+" "+o+(r>=1.5*i?"s":"")}function bu(e){var r=e.areas,i=e.excludedArea;if(r.length===1&&r[0]===F.GLOBAL&&i===F.CHINA)return xe([F.OVERSEA]);if(r.includes(F.GLOBAL)){if(e=xf(Kg).filter(function(l){return l!==F.GLOBAL&&l!==F.OVERSEA}),i in yf){r=yf[i];var o=[].concat(G(r??[]),[i]);return xe(e.filter(function(l){return!o.includes(l)}))}if(Zm(i)){var s=cu(i);return xe(e.filter(function(l){return l!==i&&l!==s}))}}if(Zm(i)||i in yf)return xe(r);throw new I("Invalid excludedArea area config")}function Ma(e,r,i){i===void 0&&(i=Object.getOwnPropertyDescriptor(e,r));var o=i.value;return i.value=function(){for(var s=this,l=arguments.length,d=Array(l),h=0;h<l;h++)d[h]=arguments[h];this.invokeTracker.apply(this,["%s: ".concat(0<d.length?"%s with args: ".concat(d.map(function(){return"%o"})):"%s"),this.name,r].concat(G(d.map(ye))));try{var p=o.apply(this,d)}catch(_){throw this.logError.apply(this,["".concat(_.code!==void 0?"Error Code ".concat(_.code,": "):"","%s failed").concat(0<d.length?" with args: ".concat(d.map(function(){return"%o"})):""),r].concat(G(d.map(ye)))),_.originalError&&this.logError(_.originalError),this.errorTracker(_),_}var f=Date.now();return J(w.mark(function _(){var g,b;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.prev=0,C.next=3,p;case 3:g=C.sent,C.next=12;break;case 6:return C.prev=6,C.t0=C.catch(0),s.logError.apply(s,["".concat(C.t0.code!==void 0?"Error Code ".concat(C.t0.code,": "):"","%s failed").concat(0<d.length?" with args: ".concat(d.map(function(){return"%o"})):""),r].concat(G(d.map(ye)))),C.t0.originalError&&s.logError(C.t0.originalError),s.errorTracker(C.t0),C.abrupt("return");case 12:g!==p?g===void 0?s.resultTracker("%s promise resolves after %dms",r,Date.now()-f):s.resultTracker("%s promise resolves after %dms, result is %o",r,Date.now()-f,ye(g)):Ac(g)!=="Object"||yd(g)?s.resultTracker("%s result is %o",r,ye(g)):s.resultTracker("%s result is %s",r,g.name||((b=g.constructor)===null||b===void 0?void 0:b.name));case 13:case"end":return C.stop()}},_,null,[[0,6]])}))(),p},i}function Nb(e,r,i){i===void 0&&(i=Object.getOwnPropertyDescriptor(e,r));var o=i.value;return i.value=function(){for(var s=this,l=arguments.length,d=Array(l),h=0;h<l;h++)d[h]=arguments[h];this.invokeTracker.apply(this,["%s: ".concat(0<d.length?"%s with args: ".concat(d.map(function(){return"%o"})):"%s"),this.name,r].concat(d));try{var p=o.apply(this,d)}catch(_){throw this.logError.apply(this,["".concat(_.code!==void 0?"Error Code ".concat(_.code,": "):"","%s failed").concat(0<d.length?" with args: ".concat(d.map(function(){return"%o"})):""),r].concat(d)),_.originalError&&this.logError(_.originalError),this.errorTracker(_),_}var f=Date.now();return J(w.mark(function _(){var g,b;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.prev=0,C.next=3,p;case 3:g=C.sent,C.next=12;break;case 6:return C.prev=6,C.t0=C.catch(0),s.logError.apply(s,["".concat(C.t0.code!==void 0?"Error Code ".concat(C.t0.code,": "):"","%s failed").concat(0<d.length?" with args: ".concat(d.map(function(){return"%o"})):""),r].concat(d)),C.t0.originalError&&s.logError(C.t0.originalError),s.errorTracker(C.t0),C.abrupt("return");case 12:g!==p?g===void 0?s.resultTracker("%s promise resolves after %dms",r,Date.now()-f):s.resultTracker("%s promise resolves after %dms, result is %o",r,Date.now()-f,g):Ac(g)!=="Object"||yd(g)?s.resultTracker("%s result is %o",r,g):s.resultTracker("%s result is %s",r,g.name||((b=g.constructor)===null||b===void 0?void 0:b.name));case 13:case"end":return C.stop()}},_,null,[[0,6]])}))(),p},i}function du(e,r){var i="".concat(e,"Uri");if(typeof(i=Li[i])!="number"||i===0)throw new TypeError("Got Unknown URI Name");return r=new(e=$m[e])(r),r=e.encode(r).finish(),new eu({uri:i,data:r})}function an(e,r){return"".concat(e.split(".").join("-"),".edge.").concat(r?"sd-rtn.com":"agora.io")}function eb(e,r,i){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark(function e(r,i,o){var s,l;return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:d.next=2;break;case 2:return s=fu[r].encode(i).finish(),l=function(){var h=J(w.mark(function p(f){var _,g,b,C=arguments;return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!(3<(g=1<C.length&&C[1]!==void 0?C[1]:0))){k.next=3;break}return k.abrupt("return");case 3:return b=we(b=o?"https://".concat((_=M?.PROXY_NGINX[0])!==null&&_!==void 0?_:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(f,"&p=6443&d=events/proto-raw"):"https://".concat(f,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),b=we(b,"id",gu[r].toString()),k.next=8,te(b,{body:s,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(A){return l(f,g+1)});case 8:case"end":return k.stop()}},p)}));return function(p){return h.apply(this,arguments)}}(),d.prev=4,d.next=7,l(M?.EVENT_REPORT_DOMAIN[0]||"webcollector-rtm.agora.io");case 7:d.next=13;break;case 9:return d.prev=9,d.t0=d.catch(4),d.next=13,l(M&&bn(1<M?.EVENT_REPORT_DOMAIN.length?M?.EVENT_REPORT_DOMAIN.slice(1):M?.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return d.stop()}},e,null,[[4,9]])}))).apply(this,arguments)}function fb(e){return e===void 0?U.fromNumber(0):U.fromNumber(Date.now()-e)}function hu(e){return btoa(String.fromCharCode.apply({},e.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map(function(r){return parseInt(r,16)}))).replace(/={1,2}$/,"")}function Lg(e,r){return U.fromValue(e).eq(r)}function Mg(e,r){var i=r===void 0?e.val:r,o=e.isBoolean;r=e.isNumber;var s=e.oneof,l=e.len;if([o,r,s].filter(function(d){return!d}).length!==2)throw new TypeError("invalid field type");if(i!==void 0&&(e=!1,s!==void 0&&(s=Ni(s),iu(s,Lg).length===s.length&&ju(s,function(d){return Lg(i,d)})!==void 0&&(e=!0)),o=o!==void 0&&(i===0||i===1)&&l===1,r=r!==void 0&&i.toString(2).length<=l,!(e||o||r)))throw Error("invalid field value")}function cn(e){return function(){var r=e();if(!r)throw new K("Client is not logged in. Cannot do the operation");return r}}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ng=function(e){return e&&e.Math==Math&&e},y=Ng(typeof globalThis=="object"&&globalThis)||Ng(typeof window=="object"&&window)||Ng(typeof self=="object"&&self)||Ng(typeof Ya=="object"&&Ya)||function(){return this}()||Function("return this")(),R=function(e){try{return!!e()}catch{return!0}},ka=!R(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(e){return!!(e=en(this,e))&&e.enumerable}:dn,dd=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},ku={}.toString,Zb=function(e){return ku.call(e).slice(8,-1)},lu="".split,Af=R(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return Zb(e)=="String"?lu.call(e,""):Object(e)}:Object,jb=function(e){if(e==null)throw TypeError("Can't call method on "+e);return e},qb=function(e){return Af(jb(e))},ha=function(e){return typeof e=="object"?e!==null:typeof e=="function"},lc=function(e,r){if(!ha(e))return e;var i,o;if(r&&typeof(i=e.toString)=="function"&&!ha(o=i.call(e))||typeof(i=e.valueOf)=="function"&&!ha(o=i.call(e))||!r&&typeof(i=e.toString)=="function"&&!ha(o=i.call(e)))return o;throw TypeError("Can't convert object to primitive value")},Qa=function(e){return Object(jb(e))},mu={}.hasOwnProperty,Q=function(e,r){return mu.call(Qa(e),r)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R(function(){return Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(e,r){if(e=qb(e),r=lc(r,!0),fn)try{return gn(e,r)}catch{}if(Q(e,r))return dd(!zf.call(e,r),e[r])}},va=function(e){if(!ha(e))throw TypeError(String(e)+" is not an object");return e},hn=Object.defineProperty,Ra={f:ka?hn:function(e,r,i){if(va(e),r=lc(r,!0),va(i),fn)try{return hn(e,r,i)}catch{}if("get"in i||"set"in i)throw TypeError("Accessors not supported");return"value"in i&&(e[r]=i.value),e}},Na=ka?function(e,r,i){return Ra.f(e,r,dd(1,i))}:function(e,r,i){return e[r]=i,e},Oi=function(e,r){try{Na(y,e,r)}catch{y[e]=r}return r},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;typeof ed.inspectSource!="function"&&(ed.inspectSource=function(e){return nu.call(e)});var Pi=ed.inspectSource,jn=y.WeakMap,ou=typeof jn=="function"&&/native code/.test(Pi(jn)),fd=$a(function(e){(e.exports=function(r,i){return ed[r]||(ed[r]=i!==void 0?i:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"\xA9 2021 Denis Pushkarev (zloirock.ru)"})}),pu=0,qu=Math.random(),Ae=function(e){return"Symbol("+String(e===void 0?"":e)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(e){return kn[e]||(kn[e]=Ae(e))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(e,r){if(ln.call(Gd,e))throw new TypeError("Object already initialized");return r.facade=e,tu.call(Gd,e,r),r},Qg=function(e){return su.call(Gd,e)||{}},Ri=function(e){return ln.call(Gd,e)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(e,r){if(Q(e,Ce))throw new TypeError("Object already initialized");return r.facade=e,Na(e,Ce,r),r},Qg=function(e){return Q(e,Ce)?e[Ce]:{}},Ri=function(e){return Q(e,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(e){return Ri(e)?Qg(e):Qi(e,{})},getterFor:function(e){return function(r){var i;if(!ha(r)||(i=Qg(r)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return i}}},Ta=$a(function(e){var r=Za.get,i=Za.enforce,o=String(String).split("String");(e.exports=function(s,l,d,h){var p=!!h&&!!h.unsafe,f=!!h&&!!h.enumerable;if(h=!!h&&!!h.noTargetGet,typeof d=="function"){typeof l!="string"||Q(d,"name")||Na(d,"name",l);var _=i(d);_.source||(_.source=o.join(typeof l=="string"?l:""))}s===y?f?s[l]=d:Oi(l,d):(p?!h&&s[l]&&(f=!0):delete s[l],f?s[l]=d:Na(s,l,d))})(Function.prototype,"toString",function(){return typeof this=="function"&&r(this).source||Pi(this)})}),mn=function(e){return typeof e=="function"?e:void 0},mc=function(e,r){return 2>arguments.length?mn(y[e])||mn(y[e]):y[e]&&y[e][r]||y[e]&&y[e][r]},uu=Math.ceil,vu=Math.floor,$b=function(e){return isNaN(e=+e)?0:(0<e?vu:uu)(e)},wu=Math.min,ta=function(e){return 0<e?wu($b(e),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(e,r){return 0>(e=$b(e))?xu(e+r,0):yu(e,r)},nn=function(e){return function(r,i,o){r=qb(r);var s=ta(r.length);if(o=xb(o,s),e&&i!=i){for(;s>o;)if((i=r[o++])!=i)return!0}else for(;s>o;o++)if((e||o in r)&&r[o]===i)return e||o||0;return!e&&-1}},on=nn(!0),Si=nn(!1),pn=function(e,r){e=qb(e);var i,o=0,s=[];for(i in e)!Q(Be,i)&&Q(e,i)&&s.push(i);for(;r.length>o;)Q(e,i=r[o++])&&(~Si(s,i)||s.push(i));return s},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(e){return pn(e,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(e){var r=Hd.f(va(e)),i=Bf.f;return i?r.concat(i(e)):r},rn=function(e,r){for(var i=qn(r),o=Ra.f,s=Fb.f,l=0;l<i.length;l++){var d=i[l];Q(e,d)||o(e,d,s(r,d))}},Au=/#|\.prototype\./,nc=function(e,r){return(e=Bu[Cu(e)])==Du||e!=Eu&&(typeof r=="function"?R(r):!!r)},Cu=nc.normalize=function(e){return String(e).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(e,r){var i,o,s,l=e.target,d=e.global,h=e.stat;if(o=d?y:h?y[l]||Oi(l,{}):(y[l]||{}).prototype)for(s in r){var p=r[s],f=e.noTargetGet?(i=Fu(o,s))&&i.value:o[s];if(!(i=nc(d?s:l+(h?".":"#")+s,e.forced))&&f!==void 0){if(typeof p==typeof f)continue;rn(p,f)}(e.sham||f&&f.sham)&&Na(p,"sham",!0);try{Ta(o,s,p,e)}catch{}}},yb=function(e){if(typeof e!="function")throw TypeError(String(e)+" is not a function");return e},Id=function(e,r,i){if(yb(e),r===void 0)return e;switch(i){case 0:return function(){return e.call(r)};case 1:return function(o){return e.call(r,o)};case 2:return function(o,s){return e.call(r,o,s)};case 3:return function(o,s,l){return e.call(r,o,s,l)}}return function(){return e.apply(r,arguments)}},gd=Array.isArray||function(e){return Zb(e)=="Array"},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R(function(){return!String(Symbol())||!Symbol.sham&&id&&41>id}),vn=oc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(e){return Q(Cf,e)&&(oc||typeof Cf[e]=="string")||(oc&&Q(Df,e)?Cf[e]=Df[e]:Cf[e]=Gu("Symbol."+e)),Cf[e]},Hu=qa("species"),Sg=function(e,r){if(gd(e)){var i=e.constructor;typeof i!="function"||i!==Array&&!gd(i.prototype)?ha(i)&&(i=i[Hu])===null&&(i=void 0):i=void 0}return new(i===void 0?Array:i)(r===0?0:r)},wn=[].push,jd=function(e){var r=e==1,i=e==2,o=e==3,s=e==4,l=e==6,d=e==7,h=e==5||l;return function(p,f,_,g){var b=Qa(p),C=Af(b);f=Id(f,_,3),_=ta(C.length);var k,A=0;for(g=g||Sg,p=r?g(p,_):i||d?g(p,0):void 0;_>A;A++)if((h||A in C)&&(k=f(g=C[A],A,b),e))if(r)p[A]=k;else if(k)switch(e){case 3:return!0;case 5:return g;case 6:return A;case 2:wn.call(p,g)}else switch(e){case 4:return!1;case 7:wn.call(p,g)}return l?-1:o||s?s:p}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6);jd(7);var Ku=qa("species"),Ef=function(e){return 51<=id||!R(function(){var r=[];return(r.constructor={})[Ku]=function(){return{foo:1}},r[e](Boolean).foo!==1})},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(e){return yn(this,e,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(e){return pn(e,Rg)},Mu=R(function(){Dc(1)});N({target:"Object",stat:!0,forced:Mu},{keys:function(e){return Dc(Qa(e))}});var Ee=function(e,r){var i=[][e];return!!i&&R(function(){i.call(null,r||function(){throw 1},1)})},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(e){return Nu.call(qb(this),e===void 0?",":e)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(e){return xn(this,e,1<arguments.length?arguments[1]:void 0)}});var Ui=function(e){var r=e.return;if(r!==void 0)return va(r.call(e)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(e){return e!==void 0&&(Fe.Array===e||Su[Ru]===e)},Ge=function(e,r,i){(r=lc(r))in e?Ra.f(e,r,dd(0,i)):e[r]=i},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi=String(Bn)==="[object z]",Uu=qa("toStringTag"),Vu=Zb(function(){return arguments}())=="Arguments",Ff=Wi?Zb:function(e){var r;if(e===void 0)var i="Undefined";else{if(e===null)var o="Null";else{t:{var s=e=Object(e);try{o=s[Uu];break t}catch{}o=void 0}o=typeof(i=o)=="string"?i:Vu?Zb(e):(r=Zb(e))=="Object"&&typeof e.callee=="function"?"Arguments":r}i=o}return i},Wu=qa("iterator"),Xi=function(e){if(e!=null)return e[Wu]||e["@@iterator"]||Fe[Ff(e)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,function(){throw 2})}catch(e){}var Tg=function(e,r){if(!r&&!Dn)return!1;var i=!1;try{(r={})[Cn]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch{}return i},Yu=!Tg(function(e){Array.from(e)});N({target:"Array",stat:!0,forced:Yu},{from:function(e){var r,i=Qa(e),o=typeof this=="function"?this:Array,s=arguments.length,l=1<s?arguments[1]:void 0,d=l!==void 0,h=Xi(i),p=0;if(d&&(l=Id(l,2<s?arguments[2]:void 0,2)),h==null||o==Array&&Vi(h)){var f=ta(i.length);for(o=new o(f);f>p;p++)h=d?l(i[p],p):i[p],Ge(o,p,h)}else for(s=(i=h.call(i)).next,o=new o;!(r=s.call(i)).done;p++){if(d){h=i;var _=l;r=[r.value,p];try{f=_(va(r)[0],r[1])}catch(g){throw Ui(h),g}}else f=r.value;Ge(o,p,h=f)}return o.length=p,o}});var Fn=function(e){return function(r,i){r=String(jb(r)),i=$b(i);var o,s=r.length;if(0>i||i>=s)return e?"":void 0;var l=r.charCodeAt(i);return 55296>l||56319<l||i+1===s||56320>(o=r.charCodeAt(i+1))||57343<o?e?r.charAt(i):l:e?r.slice(i,i+2):o-56320+(l-55296<<10)+65536}};Fn(!1);var Gn=Fn(!0),Hn=!R(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(e){return e=Qa(e),Q(e,In)?e[In]:typeof e.constructor=="function"&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(Kd==null||R(function(){var e={};return Kd[Yi].call(e)!==e}))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(e,r){va(e);for(var i,o=Dc(r),s=o.length,l=0;s>l;)Ra.f(e,i=o[l++],r[i]);return e},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch{}if(aj){var e=aj;e.write("<script><\/script>"),e.close(),e=e.parentWindow.Object}else(e=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),e=e.F;for(Wg=e,e=Rg.length;e--;)delete Wg.prototype[Rg[e]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(e,r){if(e!==null){$i.prototype=va(e);var i=new $i;$i.prototype=null,i[Mn]=e}else i=Wg();return r===void 0?i:av(i,r)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(e,r,i){e&&!Q(e=i?e:e.prototype,Nn)&&bv(e,Nn,{configurable:!0,value:r})},cv=function(){return this},dv=function(e,r,i){return r+=" Iterator",e.prototype=ac(Ug,{next:dd(1,i)}),Ec(e,r,!1),Fe[r]=cv,e},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,r={};try{var i=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;i.call(r,[]),e=r instanceof Array}catch{}return function(o,s){if(va(o),!ha(s)&&s!==null)throw TypeError("Can't set "+String(s)+" as a prototype");return e?i.call(o,s):o.__proto__=s,o}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(e,r,i,o,s,l,d){dv(i,r,o),o=function(A){if(A===s&&b)return b;if(!Vg&&A in _)return _[A];switch(A){case"keys":case"values":case"entries":return function(){return new i(this,A)}}return function(){return new i(this)}};var h,p=r+" Iterator",f=!1,_=e.prototype,g=_[Gf]||_["@@iterator"]||s&&_[s],b=!Vg&&g||o(s),C=r=="Array"&&_.entries||g;if(C&&(e=Vb(C.call(new e)),Ug!==Object.prototype&&e.next&&(Vb(e)!==Ug&&(Ua?Ua(e,Ug):typeof e[Gf]!="function"&&Na(e,Gf,ev)),Ec(e,p,!0))),s=="values"&&g&&g.name!=="values"&&(f=!0,b=function(){return g.call(this)}),_[Gf]!==b&&Na(_,Gf,b),Fe[r]=b,s){var k={values:o("values"),keys:l?b:o("keys"),entries:o("entries")};if(d)for(h in k)!Vg&&!f&&h in _||Ta(_,h,k[h]);else N({target:r,proto:!0,forced:Vg||f},k)}return k},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",function(e){fv(this,{type:"String Iterator",string:String(e),index:0})},function(){var e=gv(this),r=e.string,i=e.index;return i>=r.length?{value:void 0,done:!0}:(r=Gn(r,i),e.index+=r.length,{value:r,done:!1})});var cj=qa("unscopables"),dj=Array.prototype;dj[cj]==null&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(e){dj[cj][e]=!0},On=!0;"find"in[]&&Array(1).find(function(){On=!1}),N({target:"Array",proto:!0,forced:On},{find:function(e){return zn(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(e){var r=String(jb(this)),i="";if(0>(e=$b(e))||e==1/0)throw RangeError("Wrong number of repetitions");for(;0<e;(e>>>=1)&&(r+=r))1&e&&(i+=r);return i};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(e,r,i){for(var o in r)Ta(e,o,r[o],i);return e},Qn=qa("species"),If=function(e){e=mc(e);var r=Ra.f;ka&&e&&!e[Qn]&&r(e,Qn,{configurable:!0,get:function(){return this}})},Gc=function(e,r,i){if(!(e instanceof r))throw TypeError("Incorrect "+(i?i+" ":"")+"invocation");return e},Jf=function(e,r){this.stopped=e,this.result=r},Xg=function(e,r,i){var o,s=!(!i||!i.AS_ENTRIES),l=!(!i||!i.IS_ITERATOR),d=!(!i||!i.INTERRUPTED),h=Id(r,i&&i.that,1+s+d),p=function(_){return f&&Ui(f),new Jf(!0,_)};if(r=function(_){return s?(va(_),d?h(_[0],_[1],p):h(_[0],_[1])):d?h(_,p):h(_)},l)var f=e;else{if(typeof(l=Xi(e))!="function")throw TypeError("Target is not iterable");if(Vi(l)){for(l=0,i=ta(e.length);i>l;l++)if((o=r(e[l]))&&o instanceof Jf)return o;return new Jf(!1)}f=l.call(e)}for(e=f.next;!(l=e.call(f)).done;){try{o=r(l.value)}catch(_){throw Ui(f),_}if(typeof o=="object"&&o&&o instanceof Jf)return o}return new Jf(!1)},iv=qa("species"),kd=function(e,r){var i;return(e=va(e).constructor)===void 0||(i=va(e)[iv])==null?r:yb(i)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc=Zb(y.process)=="process",Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(e){if(Kf.hasOwnProperty(e)){var r=Kf[e];delete Kf[e],r()}},ij=function(e){return function(){hj(e)}},Un=function(e){hj(e.data)},Vn=function(e){y.postMessage(e+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(e){for(var r=[],i=1;arguments.length>i;)r.push(arguments[i++]);return Kf[++gj]=function(){(typeof e=="function"?e:Function(e)).apply(void 0,r)},Lf(gj),gj},Sn=function(e){delete Kf[e]},Hc)var Lf=function(e){jv.nextTick(ij(e))};else if(fj&&fj.now)Lf=function(e){fj.now(ij(e))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&typeof postMessage=="function"&&!y.importScripts&&Yg&&Yg.protocol!=="file:"&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(e){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(e)}}:function(e){setTimeout(ij(e),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var e;for(Hc&&(e=$n.domain)&&e.exit();Md;){var r=Md.fn;Md=Md.next;try{r()}catch(i){throw Md?$g():Mf=void 0,i}}Mf=void 0,e&&e.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(e){e={fn:e,next:void 0},Mf&&(Mf.next=e),Md||(Md=e,$g()),Mf=e},nv=function(e){var r,i;this.promise=new e(function(o,s){if(r!==void 0||i!==void 0)throw TypeError("Bad Promise constructor");r=o,i=s}),this.resolve=yb(r),this.reject=yb(i)},lj={f:function(e){return new nv(e)}},mj=function(e,r){return va(e),ha(r)&&r.constructor===e?r:((0,(e=lj.f(e)).resolve)(r),e.promise)},ov=function(e,r){var i=y.console;i&&i.error&&(arguments.length===1?i.error(e):i.error(e,r))},nj=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},pv=typeof window=="object",qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io=typeof PromiseRejectionEvent=="function",jo=!1,Nf=nc("Promise",function(){var e=Pi(zb)!==String(zb);if(!e&&id===66)return!0;if(51<=id&&/native code/.test(zb))return!1;var r=new zb(function(o){o(1)}),i=function(o){o(function(){},function(){})};return(r.constructor={})[qv]=i,!(jo=r.then(function(){})instanceof i)||!e&&pv&&!io}),vv=Nf||!Tg(function(e){zb.all(e).catch(function(){})}),ko=function(e){var r;return!(!ha(e)||typeof(r=e.then)!="function")&&r},qj=function(e,r){if(!e.notified){e.notified=!0;var i=e.reactions;fo(function(){for(var o=e.value,s=e.state==1,l=0;i.length>l;){var d,h=i[l++],p=s?h.ok:h.fail,f=h.resolve,_=h.reject,g=h.domain;try{if(p){if(s||(e.rejection===2&&wv(e),e.rejection=1),p===!0)var b=o;else if(g&&g.enter(),b=p(o),g){g.exit();var C=!0}b===h.promise?_(ho("Promise-chain cycle")):(d=ko(b))?d.call(b,f,_):f(b)}else _(o)}catch(k){g&&!C&&g.exit(),_(k)}}e.reactions=[],e.notified=!1,r&&!e.rejection&&xv(e)})}},lo=function(e,r,i){var o;if(uv){var s=oj.createEvent("Event");s.promise=r,s.reason=i,s.initEvent(e,!1,!0),y.dispatchEvent(s)}else s={promise:r,reason:i};!io&&(o=y["on"+e])?o(s):e==="unhandledrejection"&&ov("Unhandled promise rejection",i)},xv=function(e){jj.call(y,function(){var r=e.facade,i=e.value;if(e.rejection!==1&&!e.parent){var o=nj(function(){Hc?pj.emit("unhandledRejection",i,r):lo("unhandledrejection",r,i)});if(e.rejection=Hc||e.rejection!==1&&!e.parent?2:1,o.error)throw o.value}})},wv=function(e){jj.call(y,function(){var r=e.facade;Hc?pj.emit("rejectionHandled",r):lo("rejectionhandled",r,e.value)})},Ie=function(e,r,i){return function(o){e(r,o,i)}},Je=function(e,r,i){e.done||(e.done=!0,i&&(e=i),e.value=r,e.state=2,qj(e,!0))},rj=function(e,r,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===r)throw ho("Promise can't be resolved itself");var o=ko(r);o?fo(function(){var s={done:!1};try{o.call(r,Ie(rj,s,e),Ie(Je,s,e))}catch(l){Je(s,l,e)}}):(e.value=r,e.state=1,qj(e,!1))}catch(s){Je({done:!1},s,e)}}};if(Nf){zb=function(e){Gc(this,zb,"Promise"),yb(e),sj.call(this);var r=go(this);try{e(Ie(rj,r),Ie(Je,r))}catch(i){Je(r,i)}},bh=zb.prototype;var sj=function(e){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(e,r){var i=sv(this),o=He(kd(this,zb));return o.ok=typeof e!="function"||e,o.fail=typeof r=="function"&&r,o.domain=Hc?pj.domain:void 0,i.parent=!0,i.reactions.push(o),i.state!=0&&qj(i,!1),o.promise},catch:function(e){return this.then(void 0,e)}});var yv=function(){var e=new sj,r=go(e);this.promise=e,this.resolve=Ie(rj,r),this.reject=Ie(Je,r)};if(lj.f=He=function(e){return e===zb||e===zv?new yv(e):tv(e)},typeof Fc=="function"&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",function(e,r){var i=this;return new zb(function(o,s){Av.call(i,o,s)}).then(e,r)},{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch{}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(e){var r=He(this);return r.reject.call(void 0,e),r.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(e){return mj(this,e)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(e){var r=this,i=He(r),o=i.resolve,s=i.reject,l=nj(function(){var d=yb(r.resolve),h=[],p=0,f=1;Xg(e,function(_){var g=p++,b=!1;h.push(void 0),f++,d.call(r,_).then(function(C){b||(b=!0,h[g]=C,--f||o(h))},s)}),--f||o(h)});return l.error&&s(l.value),i.promise},race:function(e){var r=this,i=He(r),o=i.reject,s=nj(function(){var l=yb(r.resolve);Xg(e,function(d){l.call(r,d).then(i.resolve,o)})});return s.error&&o(s.value),i.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(e){return no?mo.apply(this,arguments)||0:Si(this,e,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var e=va(this),r="";return e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.sticky&&(r+="y"),r},pc=R(function(){var e=RegExp("a","y");return e.lastIndex=2,e.exec("abcd")!=null}),Cv=R(function(){var e=RegExp("^r","gy");return e.lastIndex=2,e.exec("str")!=null}),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),c.lastIndex!==0||a.lastIndex!==0),po=pc||Cv,vj=/()??/.exec("")[1]!==void 0,c,a;(uj||vj||po)&&(oo=function(e){var r,i=po&&this.sticky,o=tj.call(this),s=this.source,l=0,d=e;if(i){(o=o.replace("y","")).indexOf("g")===-1&&(o+="g"),d=String(e).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&e[this.lastIndex-1]!==`
`)&&(s="(?: "+s+")",d=" "+d,l++);var h=new RegExp("^(?:"+s+")",o)}if(vj&&(h=new RegExp("^"+s+"$(?!\\s)",o)),uj)var p=this.lastIndex;var f=ch.call(i?h:this,d);return i?f?(f.input=f.input.slice(l),f[0]=f[0].slice(l),f.index=this.lastIndex,this.lastIndex+=f[0].length):this.lastIndex=0:uj&&f&&(this.lastIndex=this.global?f.index+f[0].length:p),vj&&f&&1<f.length&&Dv.call(f[0],h,function(){for(r=1;r<arguments.length-2;r++)arguments[r]===void 0&&(f[r]=void 0)}),f});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R(function(){var e=/./;return e.exec=function(){var r=[];return r.groups={a:"7"},r},"".replace(e,"$<a>")!=="7"}),qo="a".replace(/./,"$0")==="$0",ro=qa("replace"),so=!!/./[ro]&&/./[ro]("a","$0")==="",Gv=!R(function(){var e=/(?:)/,r=e.exec;return e.exec=function(){return r.apply(this,arguments)},(e="ab".split(e)).length!==2||e[0]!=="a"||e[1]!=="b"}),dh=function(e,r,i,o){var s=qa(e),l=!R(function(){var f={};return f[s]=function(){return 7},""[e](f)!=7}),d=l&&!R(function(){var f=!1,_=/a/;return e==="split"&&((_={constructor:{}}).constructor[Ev]=function(){return _},_.flags="",_[s]=/./[s]),_.exec=function(){return f=!0,null},_[s](""),!f});if(!l||!d||e==="replace"&&(!Fv||!qo||so)||e==="split"&&!Gv){var h=/./[s],p=(i=i(s,""[e],function(f,_,g,b,C){var k=_.exec;return k===Of||k===wj.exec?l&&!C?{done:!0,value:h.call(_,g,b)}:{done:!0,value:f.call(g,_,b)}:{done:!1}},{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,e,i[0]),Ta(wj,s,r==2?function(f,_){return p.call(f,this,_)}:function(f){return p.call(f,this)})}o&&Na(wj[s],"sham",!0)},xj=function(e,r,i){return r+(i?Gn(e,r).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(e,r,i,o,s,l){var d=i+e.length,h=o.length,p=Kv;return s!==void 0&&(s=Qa(s),p=Jv),Iv.call(l,p,function(f,_){switch(_.charAt(0)){case"$":return"$";case"&":return e;case"`":return r.slice(0,i);case"'":return r.slice(d);case"<":f=s[_.slice(1,-1)];break;default:var g=+_;if(g===0)return f;if(g>h)return(g=Hv(g/10))===0?f:g<=h?o[g-1]===void 0?_.charAt(1):o[g-1]+_.charAt(1):f;f=o[g-1]}return f===void 0?"":f})},Ke=function(e,r){var i=e.exec;if(typeof i=="function"){if(typeof(e=i.call(e,r))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return e}if(Zb(e)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(e,r)},Mv=Math.max,Nv=Math.min,Ov=function(e){return e===void 0?e:String(e)};dh("replace",2,function(e,r,i,o){var s=o.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,l=o.REPLACE_KEEPS_$0,d=s?"$":"$0";return[function(h,p){var f=jb(this),_=h?.[e];return _!==void 0?_.call(h,f,p):r.call(String(f),h,p)},function(h,p){if(!s&&l||typeof p=="string"&&p.indexOf(d)===-1){var f=i(r,h,this,p);if(f.done)return f.value}var _=va(h);h=String(this),(f=typeof p=="function")||(p=String(p));var g=_.global;if(g){var b=_.unicode;_.lastIndex=0}for(var C=[];;){var k=Ke(_,h);if(k===null||(C.push(k),!g))break;String(k[0])===""&&(_.lastIndex=xj(h,ta(_.lastIndex),b))}for(b="",g=_=0;g<C.length;g++){k=C[g];for(var A=String(k[0]),P=Mv(Nv($b(k.index),h.length),0),x=[],j=1;j<k.length;j++)x.push(Ov(k[j]));k=k.groups,f?(x=[A].concat(x,P,h),k!==void 0&&x.push(k),k=String(p.apply(void 0,x))):k=Lv(A,h,P,x,k,p),P>=_&&(b+=h.slice(_,P)+k,_=P+A.length)}return b+h.slice(_)}]});var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(e,r){var i=qb(this),o=ta(i.length);if(e=xb(e,o),r=xb(r===void 0?o:r,o),gd(i)){var s=i.constructor;if(typeof s!="function"||s!==Array&&!gd(s.prototype)?ha(s)&&(s=s[Qv])===null&&(s=void 0):s=void 0,s===Array||s===void 0)return Rv.call(i,e,r)}for(s=new(s===void 0?Array:s)(Sv(r-e,0)),o=0;e<r;e++,o++)e in i&&Ge(s,o,i[e]);return s.length=o,s}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",function(e,r){Tv(this,{type:"Array Iterator",target:qb(e),index:0,kind:r})},function(){var e=Uv(this),r=e.target,i=e.kind,o=e.index++;return!r||o>=r.length?(e.target=void 0,{value:void 0,done:!0}):i=="keys"?{value:o,done:!1}:i=="values"?{value:r[o],done:!1}:{value:[o,r[o]],done:!1}},"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to=typeof ArrayBuffer<"u"&&typeof DataView<"u",Le=function(e){if(e===void 0)return 0;e=$b(e);var r=ta(e);if(e!==r)throw RangeError("Wrong length or index");return r},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(e){var r=Qa(this),i=ta(r.length),o=arguments.length,s=xb(1<o?arguments[1]:void 0,i);for(i=(o=2<o?arguments[2]:void 0)===void 0?i:xb(o,i);i>s;)r[s++]=e;return r},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(e,r,i){var o,s=Array(i),l=(1<<(i=8*i-r-1))-1,d=l>>1,h=r===23?Ic(2,-24)-Ic(2,-77):0,p=0>e||e===0&&0>1/e?1:0,f=0;if((e=Vv(e))!=e||e===1/0){e=e!=e?1:0;var _=l}else _=Wv(Xv(e)/Yv),1>e*(o=Ic(2,-_))&&(_--,o*=2),2<=(e=1<=_+d?e+h/o:e+h*Ic(2,1-d))*o&&(_++,o/=2),_+d>=l?(e=0,_=l):1<=_+d?(e=(e*o-1)*Ic(2,r),_+=d):(e=e*Ic(2,d-1)*Ic(2,r),_=0);for(;8<=r;s[f++]=255&e,e/=256,r-=8);for(_=_<<r|e,i+=r;0<i;s[f++]=255&_,_/=256,i-=8);return s[--f]|=128*p,s},xo=function(e,r){var i=e.length,o=8*i-r-1,s=(1<<o)-1,l=s>>1;o-=7,--i;var d=e[i--],h=127&d;for(d>>=7;0<o;h=256*h+e[i],i--,o-=8);var p=h&(1<<-o)-1;for(h>>=-o,o+=r;0<o;p=256*p+e[i],i--,o-=8);if(h===0)h=1-l;else{if(h===s)return p?NaN:d?-1/0:1/0;p+=Ic(2,r),h-=l}return(d?-1:1)*p*Ic(2,h-r)},yo=function(e){return[255&e]},zo=function(e){return[255&e,e>>8&255]},Ao=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Bo=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},aw=function(e){return wo(e,23,4)},bw=function(e){return wo(e,52,8)},gh=function(e,r){$v(e.prototype,r,{get:function(){return Me(this)[r]}})},md=function(e,r,i,o){i=Le(i);var s=Me(e);if(i+r>s.byteLength)throw fh("Wrong index");return e=Me(s.buffer).bytes,i+=s.byteOffset,r=e.slice(i,i+r),o?r:r.reverse()},nd=function(e,r,i,o,s,l){i=Le(i);var d=Me(e);if(i+r>d.byteLength)throw fh("Wrong index");for(e=Me(d.buffer).bytes,i+=d.byteOffset,o=o(+s),s=0;s<r;s++)e[i+s]=o[l?s:r-s-1]};if(to){if(!R(function(){bc(1)})||!R(function(){new bc(-1)})||R(function(){return new bc,new bc(1.5),new bc(NaN),bc.name!="ArrayBuffer"})){Ab=function(e){return Gc(this,Ab),new bc(Le(e))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(e,r){Eo.call(this,e,r<<24>>24)},setUint8:function(e,r){Eo.call(this,e,r<<24>>24)}},{unsafe:!0})}else Ab=function(e){Gc(this,Ab,"ArrayBuffer"),e=Le(e),uo(this,{bytes:yj.call(Array(e),0),byteLength:e}),ka||(this.byteLength=e)},cc=function(e,r,i){Gc(this,cc,"DataView"),Gc(e,Ab,"DataView");var o=Me(e).byteLength;if(0>(r=$b(r))||r>o)throw fh("Wrong offset");if(r+(i=i===void 0?o-r:ta(i))>o)throw fh("Wrong length");uo(this,{buffer:e,byteLength:i,byteOffset:r}),ka||(this.buffer=e,this.byteLength=i,this.byteOffset=r)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(e){return md(this,1,e)[0]<<24>>24},getUint8:function(e){return md(this,1,e)[0]},getInt16:function(e){var r=md(this,2,e,1<arguments.length?arguments[1]:void 0);return(r[1]<<8|r[0])<<16>>16},getUint16:function(e){var r=md(this,2,e,1<arguments.length?arguments[1]:void 0);return r[1]<<8|r[0]},getInt32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return xo(md(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return xo(md(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,r){nd(this,1,e,yo,r)},setUint8:function(e,r){nd(this,1,e,yo,r)},setInt16:function(e,r){nd(this,2,e,zo,r,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,r){nd(this,2,e,zo,r,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,r){nd(this,4,e,Ao,r,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,r){nd(this,4,e,Ao,r,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,r){nd(this,4,e,aw,r,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,r){nd(this,8,e,bw,r,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R(function(){return!new Aj(2).slice(1,void 0).byteLength});N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(e,r){if(Go!==void 0&&r===void 0)return Go.call(va(this),e);var i=va(this).byteLength;e=xb(e,i),r=xb(r===void 0?i:r,i),i=new(kd(this,Aj))(ta(r-e));for(var o=new Fo(this),s=new Fo(i),l=0;e<r;)s.setUint8(l++,o.getUint8(e++));return i}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&Ff(y.opera)!=="Opera",Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(e){return!!ha(e)&&(e=Ff(e),Q(rc,e)||Q(fw,e))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||typeof qc!="function"||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(e){if(jh(e))return e;throw TypeError("Target is not a typed array")},Ne=function(e){if(Ua){if(Ko.call(qc,e))return e}else for(var r in rc)if(Q(rc,Bb)){var i=y[r];if(i&&(e===i||Ko.call(i,e)))return e}throw TypeError("Target is not a typed array constructor")},Aa=function(e,r,i){if(ka){if(i)for(var o in rc){var s=y[o];if(s&&Q(s.prototype,e))try{delete s.prototype[e]}catch{}}dc[e]&&!i||Ta(dc,e,i?r:Jc&&Bj[e]||r)}},Oo=function(e,r,i){var o,s;if(ka){if(Ua){if(i){for(o in rc)if((s=y[o])&&Q(s,e))try{delete s[e]}catch{}}if(qc[e]&&!i)return;try{return Ta(qc,e,i?r:Jc&&qc[e]||r)}catch{}}for(o in rc)!(s=y[o])||s[e]&&!i||Ta(s,e,r)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R(function(){Od(1)})||!R(function(){new Od(-1)})||!Tg(function(e){new Od,new Od(null),new Od(1.5),new Od(e)},!0)||R(function(){return new Od(new gw(2),1,void 0).length!==1}),kh=function(e,r){if(0>(e=$b(e)))throw RangeError("The argument can't be less than 0");if(e%r)throw RangeError("Wrong offset");return e},Ej=function(e){var r=Qa(e),i=arguments.length,o=1<i?arguments[1]:void 0,s=o!==void 0,l=Xi(r);if(l!=null&&!Vi(l)){var d=l.call(r),h=d.next;for(r=[];!(l=h.call(d)).done;)r.push(l.value)}for(s&&2<i&&(o=Id(o,arguments[2],2)),l=ta(r.length),d=new(Ne(this))(l),i=0;l>i;i++)d[i]=s?o(r[i],i):r[i];return d},lh=function(e,r,i){var o,s;return Ua&&typeof(o=r.constructor)=="function"&&o!==i&&ha(s=o.prototype)&&s!==i.prototype&&Ua(e,s),e},Sf=$a(function(e){var r=Hd.f,i=Za.get,o=Za.set,s=Ra.f,l=Fb.f,d=Math.round,h=y.RangeError,p=Pf.ArrayBuffer,f=Pf.DataView,_=function(P,x){var j=0,z=x.length;for(P=new(Ne(P))(z);z>j;)P[j]=x[j++];return P},g=function(P,x){s(P,x,{get:function(){return i(this)[x]}})},b=function(P){var x;return P instanceof p||(x=Ff(P))=="ArrayBuffer"||x=="SharedArrayBuffer"},C=function(P,x){return jh(P)&&typeof x!="symbol"&&x in P&&String(+x)==String(x)},k=function(P,x){return C(P,x=lc(x,!0))?dd(2,P[x]):l(P,x)},A=function(P,x,j){return!(C(P,x=lc(x,!0))&&ha(j)&&Q(j,"value"))||Q(j,"get")||Q(j,"set")||j.configurable||Q(j,"writable")&&!j.writable||Q(j,"enumerable")&&!j.enumerable?s(P,x,j):(P[x]=j.value,P)};ka?(Qf||(Fb.f=k,Ra.f=A,g(Rf,"buffer"),g(Rf,"byteOffset"),g(Rf,"byteLength"),g(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:k,defineProperty:A}),e.exports=function(P,x,j){var z=P.match(/\d+$/)[0]/8,_t=P+(j?"Clamped":"")+"Array",ue="get"+P,_n="set"+P,Ei=y[_t],_s=Ei;P=_s&&_s.prototype;var kc={},_i=function(_h,_p){s(_h,_p,{get:function(){var Qm=i(this);return Qm.view[ue](_p*z+Qm.byteOffset,!0)},set:function(Qm){var _o=i(this);j&&(Qm=0>(Qm=d(Qm))?0:255<Qm?255:255&Qm),_o.view[_n](_p*z+_o.byteOffset,Qm,!0)},enumerable:!0})};Qf?Dj&&(_s=x(function(_h,_p,Qm,_o){return Gc(_h,_s,_t),lh(ha(_p)?b(_p)?_o!==void 0?new Ei(_p,kh(Qm,z),_o):Qm!==void 0?new Ei(_p,kh(Qm,z)):new Ei(_p):jh(_p)?_(_s,_p):Ej.call(_s,_p):new Ei(Le(_p)),_h,_s)}),Ua&&Ua(_s,Po),Jd(r(Ei),function(_h){_h in _s||Na(_s,_h,Ei[_h])}),_s.prototype=P):(_s=x(function(_h,_p,Qm,_o){Gc(_h,_s,_t);var ga=0,vf=0;if(ha(_p)){if(!b(_p))return jh(_p)?_(_s,_p):Ej.call(_s,_p);var Fi=_p;if(vf=kh(Qm,z),_p=_p.byteLength,_o===void 0){if(_p%z||0>(_o=_p-vf))throw h("Wrong length")}else if((_o=ta(_o)*z)+vf>_p)throw h("Wrong length");_p=_o/z}else _p=Le(_p),Fi=new p(_o=_p*z);for(o(_h,{buffer:Fi,byteOffset:vf,byteLength:_o,length:_p,view:new f(Fi)});ga<_p;)_i(_h,ga++)}),Ua&&Ua(_s,Po),P=_s.prototype=ac(Rf)),P.constructor!==_s&&Na(P,"constructor",_s),No&&Na(P,No,_t),kc[_t]=_s,N({global:!0,forced:_s!=Ei,sham:!Qf},kc),"BYTES_PER_ELEMENT"in _s||Na(_s,"BYTES_PER_ELEMENT",z),"BYTES_PER_ELEMENT"in P||Na(P,"BYTES_PER_ELEMENT",z),If(_t)}):e.exports=function(){}});Sf("Uint8",function(e){return function(r,i,o){return e(this,r,i,o)}});var hw=Math.min,iw=[].copyWithin||function(e,r){var i=Qa(this),o=ta(i.length),s=xb(e,o),l=xb(r,o),d=2<arguments.length?arguments[2]:void 0;for(o=hw((d===void 0?o:xb(d,o))-l,o-s),d=1,l<s&&s<l+o&&(d=-1,l+=o-1,s+=o-1);0<o--;)l in i?i[s]=i[l]:delete i[s],s+=d,l+=d;return i};Aa("copyWithin",function(e,r){return iw.call(Da(this),e,r,2<arguments.length?arguments[2]:void 0)}),Aa("every",function(e){return Ju(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("fill",function(e){return yj.apply(Da(this),arguments)}),Aa("filter",function(e){var r=yn(Da(this),e,1<arguments.length?arguments[1]:void 0),i=kd(this,this.constructor),o=0,s=r.length;for(i=new(Ne(i))(s);s>o;)i[o]=r[o++];return i}),Aa("find",function(e){return zn(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("findIndex",function(e){return An(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("forEach",function(e){Jd(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("includes",function(e){return on(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("indexOf",function(e){return Si(Da(this),e,1<arguments.length?arguments[1]:void 0)});var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&(Fj.name=="values"||Fj.name==null),To=function(){return jw.call(Da(this))};Aa("entries",function(){return lw.call(Da(this))}),Aa("keys",function(){return kw.call(Da(this))}),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",function(e){return mw.apply(Da(this),arguments)});var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(e){if(Uo)return Gj.apply(this,arguments)||0;var r=qb(this),i=ta(r.length),o=i-1;for(1<arguments.length&&(o=nw(o,$b(arguments[1]))),0>o&&(o=i+o);0<=o;o--)if(o in r&&r[o]===e)return o||0;return-1}:Gj;Aa("lastIndexOf",function(e){return pw.apply(Da(this),arguments)}),Aa("map",function(e){return xn(Da(this),e,1<arguments.length?arguments[1]:void 0,function(r,i){return new(Ne(kd(r,r.constructor)))(i)})});var Vo=function(e){return function(r,i,o,s){yb(i),r=Qa(r);var l=Af(r),d=ta(r.length),h=e?d-1:0,p=e?-1:1;if(2>o)for(;;){if(h in l){s=l[h],h+=p;break}if(h+=p,e?0>h:d<=h)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=h:d>h;h+=p)h in l&&(s=i(s,l[h],h,r));return s}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",function(e){return Wo(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)}),Aa("reduceRight",function(e){return qw(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)});var rw=Math.floor;Aa("reverse",function(){for(var e,r=Da(this).length,i=rw(r/2),o=0;o<i;)e=this[o],this[o++]=this[--r],this[r]=e;return this});var sw=R(function(){new Int8Array(1).set({})});Aa("set",function(e){Da(this);var r=kh(1<arguments.length?arguments[1]:void 0,1),i=this.length,o=Qa(e),s=ta(o.length),l=0;if(s+r>i)throw RangeError("Wrong length");for(;l<s;)this[r+l]=o[l++]},sw);var tw=[].slice,uw=R(function(){new Int8Array(1).slice()});Aa("slice",function(e,r){e=tw.call(Da(this),e,r);var i=kd(this,this.constructor);r=0;var o=e.length;for(i=new(Ne(i))(o);o>r;)i[r]=e[r++];return i},uw),Aa("some",function(e){return Iu(Da(this),e,1<arguments.length?arguments[1]:void 0)});var vw=[].sort;Aa("sort",function(e){return vw.call(Da(this),e)}),Aa("subarray",function(e,r){var i=Da(this),o=i.length;return e=xb(e,o),new(kd(i,i.constructor))(i.buffer,i.byteOffset+e*i.BYTES_PER_ELEMENT,ta((r===void 0?o:xb(r,o))-e))});var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R(function(){Xo.call(new mh(1))}),yw=R(function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()})||!R(function(){mh.prototype.toLocaleString.call([1,2])});Aa("toLocaleString",function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)},yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R(function(){nh.call({})})&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch{return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R(function(){return ap.call({source:"a",flags:"b"})!="/a/b"}),Fw=ap.name!="toString";(Ew||Fw)&&Ta(RegExp.prototype,"toString",function(){var e=va(this),r=String(e.source),i=e.flags;return"/"+r+"/"+(e=String(i===void 0&&e instanceof RegExp&&!("flags"in $o)?tj.call(e):i))},{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(e,r){var i,o,s=Qa(this),l=ta(s.length),d=xb(e,l),h=arguments.length;if(h===0?h=i=0:h===1?(h=0,i=l-d):(h-=2,i=Iw(Hw($b(r),0),l-d)),9007199254740991<l+h-i)throw TypeError("Maximum allowed length exceeded");var p=Sg(s,i);for(o=0;o<i;o++){var f=d+o;f in s&&Ge(p,o,s[f])}if(p.length=i,h<i){for(o=d;o<l-i;o++){var _=o+h;(f=o+i)in s?s[_]=s[f]:delete s[_]}for(o=l;o>l-i+h;o--)delete s[o-1]}else if(h>i)for(o=l-i;o>d;o--)_=o+h-1,(f=o+i-1)in s?s[_]=s[f]:delete s[_];for(o=0;o<h;o++)s[o+d]=arguments[o+2];return s.length=l-i+h,p}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch{Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh]){for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch{Kc[Oe]=ld[Oe]}}}}var dp=Object.is||function(e,r){return e===r?e!==0||1/e==1/r:e!=e&&r!=r};dh("search",1,function(e,r,i){return[function(o){var s=jb(this),l=o?.[e];return l!==void 0?l.call(o,s):new RegExp(o)[e](String(s))},function(o){var s=i(r,o,this);if(s.done)return s.value;o=va(o);var l=String(this);return s=o.lastIndex,dp(s,0)||(o.lastIndex=0),l=Ke(o,l),dp(o.lastIndex,s)||(o.lastIndex=s),l===null?-1:l.index}]}),$a(function(e){(function(r,i){e.exports?e.exports=i(r):i(r)})(typeof self<"u"?self:Ya,function(r){function i(_i){return btoa(_i).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function o(_i){return _i=(_i+="===").slice(0,-_i.length%4),atob(_i.replace(/-/g,"+").replace(/_/g,"/"))}function s(_i){for(var _h=new Uint8Array(_i.length),_p=0;_p<_i.length;_p++)_h[_p]=_i.charCodeAt(_p);return _h}function l(_i){return _i instanceof ArrayBuffer&&(_i=new Uint8Array(_i)),String.fromCharCode.apply(String,_i)}function d(_i){var _h={name:(_i.name||_i||"").toUpperCase().replace("V","v")};switch(_h.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":_i.length&&(_h.length=_i.length);break;case"HMAC":_i.hash&&(_h.hash=d(_i.hash)),_i.length&&(_h.length=_i.length);break;case"RSAES-PKCS1-v1_5":_i.publicExponent&&(_h.publicExponent=new Uint8Array(_i.publicExponent)),_i.modulusLength&&(_h.modulusLength=_i.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":_i.hash&&(_h.hash=d(_i.hash)),_i.publicExponent&&(_h.publicExponent=new Uint8Array(_i.publicExponent)),_i.modulusLength&&(_h.modulusLength=_i.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return _h}function h(_i){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[_i.name][(_i.hash||{}).name||_i.length||""]}function p(_i){(_i instanceof ArrayBuffer||_i instanceof Uint8Array)&&(_i=JSON.parse(decodeURIComponent(escape(l(_i)))));var _h={kty:_i.kty,alg:_i.alg,ext:_i.ext||_i.extractable};switch(_h.kty){case"oct":_h.k=_i.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(_p){_p in _i&&(_h[_p]=_i[_p])});break;default:throw new TypeError("Unsupported key type")}return _h}function f(_i){return _i=p(_i),ue&&(_i.extractable=_i.ext,delete _i.ext),s(unescape(encodeURIComponent(JSON.stringify(_i)))).buffer}function _(_i){var _h=g(_i),_p=!1;switch(2<_h.length&&(_p=!0,_h.shift()),_i={ext:!0},_h[0][0]){case"1.2.840.113549.1.1.1":var Qm="n e d p q dp dq qi".split(" ");for(_h=g(_h[1]),_p&&_h.shift(),_p=0;_p<_h.length;_p++)_h[_p][0]||(_h[_p]=_h[_p].subarray(1)),_i[Qm[_p]]=i(l(_h[_p]));_i.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return _i}function g(_i,_h){if(_i instanceof ArrayBuffer&&(_i=new Uint8Array(_i)),_h||(_h={pos:0,end:_i.length}),2>_h.end-_h.pos||_h.end>_i.length)throw new RangeError("Malformed DER");var _p=_i[_h.pos++],Qm=_i[_h.pos++];if(128<=Qm){if(Qm&=127,_h.end-_h.pos<Qm)throw new RangeError("Malformed DER");for(var _o=0;Qm--;)_o<<=8,_o|=_i[_h.pos++];Qm=_o}if(_h.end-_h.pos<Qm)throw new RangeError("Malformed DER");switch(_p){case 2:_p=_i.subarray(_h.pos,_h.pos+=Qm);break;case 3:if(_i[_h.pos++])throw Error("Unsupported bit string");Qm--;case 4:_p=new Uint8Array(_i.subarray(_h.pos,_h.pos+=Qm)).buffer;break;case 5:_p=null;break;case 6:if(!((_i=btoa(l(_i.subarray(_h.pos,_h.pos+=Qm))))in Ei))throw Error("Unsupported OBJECT ID "+_i);_p=Ei[_i];break;case 48:for(_p=[],Qm=_h.pos+Qm;_h.pos<Qm;)_p.push(g(_i,_h));break;default:throw Error("Unsupported DER tag 0x"+_p.toString(16))}return _p}function b(_i,_h){_h||(_h=[]);var _p=_h.length+2;if(_h.push(0,0),_i instanceof Uint8Array)for(var Qm=2,_o=_i.length,ga=0;ga<_o;ga++)_h.push(_i[ga]);else if(_i instanceof ArrayBuffer)for(Qm=4,_o=_i.byteLength,_i=new Uint8Array(_i),ga=0;ga<_o;ga++)_h.push(_i[ga]);else if(_i===null)Qm=5,_o=0;else if(typeof _i=="string"&&_i in _s)for(Qm=6,_o=(_i=s(atob(_s[_i]))).length,ga=0;ga<_o;ga++)_h.push(_i[ga]);else if(_i instanceof Array){for(ga=0;ga<_i.length;ga++)b(_i[ga],_h);Qm=48,_o=_h.length-_p}else{if(!(X(_i)==="object"&&_i.tag===3&&_i.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+_i);for(Qm=3,_o=(_i=new Uint8Array(_i.value)).byteLength,_h.push(0),ga=0;ga<_o;ga++)_h.push(_i[ga]);_o++}if(128<=_o){for(ga=_o,_o=4,_h.splice(_p,0,ga>>24&255,ga>>16&255,ga>>8&255,255&ga);1<_o&&!(ga>>24);)ga<<=8,_o--;4>_o&&_h.splice(_p,4-_o),_o|=128}return _h.splice(_p-2,2,Qm,_o),_h}function C(_i,_h,_p,Qm){Object.defineProperties(this,{_key:{value:_i},type:{value:_i.type,enumerable:!0},extractable:{value:_p===void 0?_i.extractable:_p,enumerable:!0},algorithm:{value:_h===void 0?_i.algorithm:_h,enumerable:!0},usages:{value:Qm===void 0?_i.usages:Qm,enumerable:!0}})}function k(_i){return _i==="verify"||_i==="encrypt"||_i==="wrapKey"}function A(_i){return _i==="sign"||_i==="decrypt"||_i==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var P=r.crypto||r.msCrypto;if(P){var x=P.subtle||P.webkitSubtle;if(x){var j=r.Crypto||P.constructor||Object,z=r.SubtleCrypto||x.constructor||Object;r.CryptoKey||r.Key;var _t=-1<r.navigator.userAgent.indexOf("Edge/"),ue=!!r.msCrypto&&!_t,_n=!P.subtle&&!!P.webkitSubtle;if(ue||_n){var Ei={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},_s={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(_i){var _h=x[_i];x[_i]=function(_p,Qm,_o){var ga=[].slice.call(arguments);switch(_i){case"generateKey":var vf=d(_p),Fi=Qm,Gi=_o;break;case"importKey":vf=d(_o),Fi=ga[3],Gi=ga[4],_p==="jwk"&&((Qm=p(Qm)).alg||(Qm.alg=h(vf)),Qm.key_ops||(Qm.key_ops=Qm.kty!=="oct"?"d"in Qm?Gi.filter(A):Gi.filter(k):Gi.slice()),ga[1]=f(Qm));break;case"unwrapKey":vf=ga[4],Fi=ga[5],Gi=ga[6],ga[2]=_o._key}if(_i==="generateKey"&&vf.name==="HMAC"&&vf.hash)return vf.length=vf.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[vf.hash.name],x.importKey("raw",P.getRandomValues(new Uint8Array(vf.length+7>>3)),vf,Fi,Gi);if(_n&&_i==="generateKey"&&vf.name==="RSASSA-PKCS1-v1_5"&&(!vf.modulusLength||2048<=vf.modulusLength))return(_p=d(_p)).name="RSAES-PKCS1-v1_5",delete _p.hash,x.generateKey(_p,!0,["encrypt","decrypt"]).then(function(Di){return Promise.all([x.exportKey("jwk",Di.publicKey),x.exportKey("jwk",Di.privateKey)])}).then(function(Di){return Di[0].alg=Di[1].alg=h(vf),Di[0].key_ops=Gi.filter(k),Di[1].key_ops=Gi.filter(A),Promise.all([x.importKey("jwk",Di[0],vf,!0,Di[0].key_ops),x.importKey("jwk",Di[1],vf,Fi,Di[1].key_ops)])}).then(function(Di){return{publicKey:Di[0],privateKey:Di[1]}});if((_n||ue&&(vf.hash||{}).name==="SHA-1")&&_i==="importKey"&&_p==="jwk"&&vf.name==="HMAC"&&Qm.kty==="oct")return x.importKey("raw",s(o(Qm.k)),_o,ga[3],ga[4]);if(_n&&_i==="importKey"&&(_p==="spki"||_p==="pkcs8"))return x.importKey("jwk",_(Qm),_o,ga[3],ga[4]);if(ue&&_i==="unwrapKey")return x.decrypt(ga[3],_o,Qm).then(function(Di){return x.importKey(_p,Di,ga[4],ga[5],ga[6])});try{var _d=_h.apply(x,ga)}catch(Di){return Promise.reject(Di)}return ue&&(_d=new Promise(function(Di,H){_d.onabort=_d.onerror=function(Wt){H(Wt)},_d.oncomplete=function(Wt){Di(Wt.target.result)}})),_d=_d.then(function(Di){return vf.name!=="HMAC"||vf.length||(vf.length=8*Di.algorithm.length),vf.name.search("RSA")==0&&(vf.modulusLength||(vf.modulusLength=(Di.publicKey||Di).algorithm.modulusLength),vf.publicExponent||(vf.publicExponent=(Di.publicKey||Di).algorithm.publicExponent)),Di.publicKey&&Di.privateKey?{publicKey:new C(Di.publicKey,vf,Fi,Gi.filter(k)),privateKey:new C(Di.privateKey,vf,Fi,Gi.filter(A))}:new C(Di,vf,Fi,Gi)})}}),["exportKey","wrapKey"].forEach(function(_i){var _h=x[_i];x[_i]=function(_p,Qm,_o){var ga=[].slice.call(arguments);switch(_i){case"exportKey":ga[1]=Qm._key;break;case"wrapKey":ga[1]=Qm._key,ga[2]=_o._key}if((_n||ue&&(Qm.algorithm.hash||{}).name==="SHA-1")&&_i==="exportKey"&&_p==="jwk"&&Qm.algorithm.name==="HMAC"&&(ga[0]="raw"),!_n||_i!=="exportKey"||_p!=="spki"&&_p!=="pkcs8"||(ga[0]="jwk"),ue&&_i==="wrapKey")return x.exportKey(_p,Qm).then(function(Fi){return _p==="jwk"&&(Fi=s(unescape(encodeURIComponent(JSON.stringify(p(Fi)))))),x.encrypt(ga[3],_o,Fi)});try{var vf=_h.apply(x,ga)}catch(Fi){return Promise.reject(Fi)}return ue&&(vf=new Promise(function(Fi,Gi){vf.onabort=vf.onerror=function(_d){Gi(_d)},vf.oncomplete=function(_d){Fi(_d.target.result)}})),_i==="exportKey"&&_p==="jwk"&&(vf=vf.then(function(Fi){return(_n||ue&&(Qm.algorithm.hash||{}).name==="SHA-1")&&Qm.algorithm.name==="HMAC"?{kty:"oct",alg:h(Qm.algorithm),key_ops:Qm.usages.slice(),ext:!0,k:i(l(Fi))}:((Fi=p(Fi)).alg||(Fi.alg=h(Qm.algorithm)),Fi.key_ops||(Fi.key_ops=Qm.type==="public"?Qm.usages.filter(k):Qm.type==="private"?Qm.usages.filter(A):Qm.usages.slice()),Fi)})),!_n||_i!=="exportKey"||_p!=="spki"&&_p!=="pkcs8"||(vf=vf.then(function(Fi){var Gi=[["",null]],_d=!1;switch((Fi=p(Fi)).kty){case"RSA":for(var Di="n e d p q dp dq qi".split(" "),H=[],Wt=0;Wt<Di.length&&Di[Wt]in Fi;Wt++){var _e=H[Wt]=s(o(Fi[Di[Wt]]));128&_e[0]&&(H[Wt]=new Uint8Array(_e.length+1),H[Wt].set(_e,1))}2<H.length&&(_d=!0,H.unshift(new Uint8Array([0]))),Gi[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return Gi.push(new Uint8Array(b(H)).buffer),_d?Gi.unshift(new Uint8Array([0])):Gi[1]={tag:3,value:Gi[1]},new Uint8Array(b(Gi)).buffer})),vf}}),["encrypt","decrypt","sign","verify"].forEach(function(_i){var _h=x[_i];x[_i]=function(_p,Qm,_o,ga){if(ue&&(!_o.byteLength||ga&&!ga.byteLength))throw Error("Empty input is not allowed");var vf=[].slice.call(arguments),Fi=d(_p);if(!ue||_i!=="sign"&&_i!=="verify"||_p!=="RSASSA-PKCS1-v1_5"&&_p!=="HMAC"||(vf[0]={name:_p}),ue&&Qm.algorithm.hash&&(vf[0].hash=vf[0].hash||Qm.algorithm.hash),ue&&_i==="decrypt"&&Fi.name==="AES-GCM"){var Gi=_p.tagLength>>3;vf[2]=(_o.buffer||_o).slice(0,_o.byteLength-Gi),_p.tag=(_o.buffer||_o).slice(_o.byteLength-Gi)}ue&&Fi.name==="AES-GCM"&&vf[0].tagLength===void 0&&(vf[0].tagLength=128),vf[1]=Qm._key;try{var _d=_h.apply(x,vf)}catch(Di){return Promise.reject(Di)}return ue&&(_d=new Promise(function(Di,H){_d.onabort=_d.onerror=function(Wt){H(Wt)},_d.oncomplete=function(Wt){if(Wt=Wt.target.result,_i==="encrypt"&&Wt instanceof AesGcmEncryptResult){var _e=Wt.ciphertext,_f=Wt.tag;(Wt=new Uint8Array(_e.byteLength+_f.byteLength)).set(new Uint8Array(_e),0),Wt.set(new Uint8Array(_f),_e.byteLength),Wt=Wt.buffer}Di(Wt)}})),_d}}),ue){var kc=x.digest;x.digest=function(_i,_h){if(!_h.byteLength)throw Error("Empty input is not allowed");try{var _p=kc.call(x,_i,_h)}catch(Qm){return Promise.reject(Qm)}return _p=new Promise(function(Qm,_o){_p.onabort=_p.onerror=function(ga){_o(ga)},_p.oncomplete=function(ga){Qm(ga.target.result)}})},r.crypto=Object.create(P,{getRandomValues:{value:function(_i){return P.getRandomValues(_i)}},subtle:{value:x}}),r.CryptoKey=C}_n&&(P.subtle=x,r.Crypto=j,r.SubtleCrypto=z,r.CryptoKey=C)}}}})});var Jw=qa("match"),Lj=function(e){var r;return ha(e)&&((r=e[Jw])!==void 0?!!r:Zb(e)=="RegExp")},Kw=[].push,Lw=Math.min;dh("split",2,function(e,r,i){var o="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(s,l){var d=String(jb(this));if((l=l===void 0?4294967295:l>>>0)===0)return[];if(s===void 0)return[d];if(!Lj(s))return r.call(d,s,l);var h,p,f,_=[],g=0;for(s=new RegExp(s.source,(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(s.sticky?"y":"")+"g");(h=Of.call(s,d))&&!((p=s.lastIndex)>g&&(_.push(d.slice(g,h.index)),1<h.length&&h.index<d.length&&Kw.apply(_,h.slice(1)),f=h[0].length,g=p,_.length>=l));)s.lastIndex===h.index&&s.lastIndex++;return g===d.length?(f||!s.test(""))&&_.push(""):_.push(d.slice(g)),_.length>l?_.slice(0,l):_}:"0".split(void 0,0).length?function(s,l){return s===void 0&&l===0?[]:r.call(this,s,l)}:r;return[function(s,l){var d=jb(this),h=s?.[e];return h!==void 0?h.call(s,d,l):o.call(String(d),s,l)},function(s,l){var d=i(o,s,this,l,o!==r);if(d.done)return d.value;var h=va(s);s=String(this);var p=kd(h,RegExp);if(d=h.unicode,h=new p(pc?"^(?:"+h.source+")":h,(h.ignoreCase?"i":"")+(h.multiline?"m":"")+(h.unicode?"u":"")+(pc?"g":"y")),(l=l===void 0?4294967295:l>>>0)===0)return[];if(s.length===0)return Ke(h,s)===null?[s]:[];var f=0,_=0;for(p=[];_<s.length;){h.lastIndex=pc?0:_;var g,b=Ke(h,pc?s.slice(_):s);if(b===null||(g=Lw(ta(h.lastIndex+(pc?_:0)),s.length))===f)_=xj(s,_,d);else{if(p.push(s.slice(f,_)),p.length===l)return p;for(f=1;f<=b.length-1;f++)if(p.push(b[f]),p.length===l)return p;_=f=g}}return p.push(s.slice(f)),p}]},pc),function(e){e.console||(e.console={}),e=e.console;for(var r,i=function(){},o=["memory"],s="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");r=o.pop();)e[r]||(e[r]={});for(;r=s.pop();)e[r]||(e[r]=i)}(typeof window>"u"?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R(function(){Vb(1)});N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(e){return Vb(Qa(e))}});var ep=[].slice,Mj={},Nw=Function.bind||function(e){var r=yb(this),i=ep.call(arguments,1),o=function(){var s=i.concat(ep.call(arguments));if(this instanceof o){var l=s.length;if(!(l in Mj)){for(var d=[],h=0;h<l;h++)d[h]="a["+h+"]";Mj[l]=Function("C,a","return new C("+d.join(",")+")")}s=Mj[l](r,s)}else s=r.apply(e,s);return s};return ha(r.prototype)&&(o.prototype=r.prototype),o},Nj=mc("Reflect","construct"),fp=R(function(){function e(){}return!(Nj(function(){},[],e)instanceof e)}),gp=!R(function(){Nj(function(){})}),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(e,r){yb(e),va(r);var i=3>arguments.length?e:yb(arguments[2]);if(gp&&!fp)return Nj(e,r,i);if(e==i){switch(r.length){case 0:return new e;case 1:return new e(r[0]);case 2:return new e(r[0],r[1]);case 3:return new e(r[0],r[1],r[2]);case 4:return new e(r[0],r[1],r[2],r[3])}return(i=[null]).push.apply(i,r),new(Nw.apply(e,i))}i=i.prototype,i=ac(ha(i)?i:Object.prototype);var o=Function.apply.call(e,i,r);return ha(o)?o:i}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R(function(){ip(1)});N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(e,r){return ip(qb(e),r)}});var jp=Hd.f,Pw={}.toString,kp=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(e){if(kp&&Pw.call(e)=="[object Window]")try{var r=jp(e)}catch{r=kp.slice()}else r=jp(qb(e));return r},lp={f:qa},Qw=Ra.f,ph=function(e){var r=y.Symbol||(y.Symbol={});Q(r,e)||Qw(r,e,{value:lp.f(e)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R(function(){return ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a!=7})?function(e,r,i){var o=op(Ob,r);o&&delete Ob[r],od(e,r,i),o&&e!==Ob&&od(Ob,r,o)}:od,Uj=function(e,r){var i=Lc[e]=ac(sb.prototype);return Rw(i,{type:"Symbol",tag:e,description:r}),ka||(i.description=r),i},Vj=vn?function(e){return typeof e=="symbol"}:function(e){return Object(e)instanceof sb},qh=function(e,r,i){return e===Ob&&qh(Uf,r,i),va(e),r=lc(r,!0),va(i),Q(Lc,r)?(i.enumerable?(Q(e,rb)&&e[rb][r]&&(e[rb][r]=!1),i=ac(i,{enumerable:dd(0,!1)})):(Q(e,rb)||od(e,rb,dd(1,{})),e[rb][r]=!0),Tj(e,r,i)):od(e,r,i)},qp=function(e,r){va(e);var i=qb(r);return r=Dc(i).concat(Wj(i)),Jd(r,function(o){ka&&!Xj.call(i,o)||qh(e,o,i[o])}),e},Xj=function(e){e=lc(e,!0);var r=Sw.call(this,e);return!(this===Ob&&Q(Lc,e)&&!Q(Uf,e))&&(!(r||!Q(this,e)||!Q(Lc,e)||Q(this,rb)&&this[rb][e])||r)},rp=function(e,r){if(e=qb(e),r=lc(r,!0),e!==Ob||!Q(Lc,r)||Q(Uf,r)){var i=op(e,r);return!i||!Q(Lc,r)||Q(e,rb)&&e[rb][r]||(i.enumerable=!0),i}},sp=function(e){e=pp(qb(e));var r=[];return Jd(e,function(i){Q(Lc,i)||Q(Be,i)||r.push(i)}),r},Wj=function(e){var r=e===Ob;e=pp(r?Uf:qb(e));var i=[];return Jd(e,function(o){!Q(Lc,o)||r&&!Q(Ob,o)||i.push(Lc[o])}),i};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,r=Ae(e),i=function(o){this===Ob&&i.call(Uf,o),Q(this,rb)&&Q(this[rb],r)&&(this[rb][r]=!1),Tj(this,r,dd(1,o))};return ka&&Sj&&Tj(Ob,r,{configurable:!0,set:i}),Uj(r,e)},Ta(sb.prototype,"toString",function(){return np(this).tag}),Ta(sb,"withoutSetter",function(e){return Uj(Ae(e),e)}),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(e){return Uj(qa(e),e)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),function(e){ph(e)}),N({target:"Symbol",stat:!0,forced:!oc},{for:function(e){if(e=String(e),Q(Pj,e))return Pj[e];var r=sb(e);return Pj[e]=r,Qj[r]=e,r},keyFor:function(e){if(!Vj(e))throw TypeError(e+" is not a symbol");if(Q(Qj,e))return Qj[e]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(e,r){return r===void 0?ac(e):qp(ac(e),r)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R(function(){Bf.f(1)})},{getOwnPropertySymbols:function(e){return Bf.f(Qa(e))}}),Tf){var Uw=!oc||R(function(){var e=sb();return Tf([e])!="[null]"||Tf({a:e})!="{}"||Tf(Object(e))!="{}"});N({target:"JSON",stat:!0,forced:Uw},{stringify:function(e,r,i){for(var o,s=[e],l=1;arguments.length>l;)s.push(arguments[l++]);if(o=r,(ha(r)||e!==void 0)&&!Vj(e))return gd(r)||(r=function(d,h){if(typeof o=="function"&&(h=o.call(this,d,h)),!Vj(h))return h}),s[1]=r,Tf.apply(null,s)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&typeof Mc=="function"&&(!("description"in Mc.prototype)||Mc().description!==void 0)){var tp={},Vf=function(){var e=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),r=this instanceof Vf?new Mc(e):e===void 0?Mc():Mc(e);return e===""&&(tp[r]=!0),r};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw=String(Mc("test"))=="Symbol(test)",Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var e=ha(this)?this.valueOf():this,r=Ww.call(e);return Q(tp,e)?"":(e=Xw?r.slice(7,-1):r.replace(Yw,"$1"))===""?void 0:e}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function e(b,C){if(!(b instanceof C))throw new TypeError("Cannot call a class as a function")}function r(b,C){for(var k=0;k<C.length;k++){var A=C[k];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(b,A.key,A)}}function i(b,C,k){return C&&r(b.prototype,C),k&&r(b,k),b}function o(b,C){if(typeof C!="function"&&C!==null)throw new TypeError("Super expression must either be null or a function");b.prototype=Object.create(C&&C.prototype,{constructor:{value:b,writable:!0,configurable:!0}}),C&&l(b,C)}function s(b){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(C){return C.__proto__||Object.getPrototypeOf(C)})(b)}function l(b,C){return(l=Object.setPrototypeOf||function(k,A){return k.__proto__=A,k})(b,C)}function d(b){if(b===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b}function h(b){var C=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var k=s(b);if(C){var A=s(this).constructor;k=Reflect.construct(k,arguments,A)}else k=k.apply(this,arguments);return k=!k||X(k)!=="object"&&typeof k!="function"?d(this):k}}function p(b,C,k){return(p=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(A,P,x){for(;!Object.prototype.hasOwnProperty.call(A,P)&&(A=s(A))!==null;);if(A)return(P=Object.getOwnPropertyDescriptor(A,P)).get?P.get.call(x):P.value})(b,C,k||b)}var f=function(){function b(){e(this,b),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return i(b,[{key:"addEventListener",value:function(C,k,A){C in this.listeners||(this.listeners[C]=[]),this.listeners[C].push({callback:k,options:A})}},{key:"removeEventListener",value:function(C,k){if(C in this.listeners){for(var A=0,P=(C=this.listeners[C]).length;A<P;A++)if(C[A].callback===k){C.splice(A,1);break}}}},{key:"dispatchEvent",value:function(C){if(C.type in this.listeners){for(var k=this.listeners[C.type].slice(),A=0,P=k.length;A<P;A++){var x=k[A];try{x.callback.call(this,C)}catch(j){Promise.resolve().then(function(){throw j})}x.options&&x.options.once&&this.removeEventListener(C.type,x.callback)}return!C.defaultPrevented}}}]),b}(),_=function(b){function C(){e(this,C);var A=k.call(this);return A.listeners||f.call(d(A)),Object.defineProperty(d(A),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(d(A),"onabort",{value:null,writable:!0,configurable:!0}),A}o(C,b);var k=h(C);return i(C,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(A){A.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,A)),p(s(C.prototype),"dispatchEvent",this).call(this,A)}}]),C}(f),g=function(){function b(){e(this,b),Object.defineProperty(this,"signal",{value:new _,writable:!0,configurable:!0})}return i(b,[{key:"abort",value:function(){try{var C=new Event("abort")}catch{typeof document<"u"?document.createEvent?(C=document.createEvent("Event")).initEvent("abort",!1,!1):(C=document.createEventObject()).type="abort":C={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(C)}},{key:"toString",value:function(){return"[object AbortController]"}}]),b}();typeof Symbol<"u"&&Symbol.toStringTag&&(g.prototype[Symbol.toStringTag]="AbortController",_.prototype[Symbol.toStringTag]="AbortSignal"),function(b){if(b.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var C=!0}else C=typeof b.Request=="function"&&!b.Request.prototype.hasOwnProperty("signal")||!b.AbortController;C&&(b.AbortController=g,b.AbortSignal=_)}(typeof self<"u"?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-Zw($w(e+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(e){return 31-bx(e>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(e){if(e=e&&e.buffer||e,up.call(e)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var r="",i=0,o=0|(e=Zj?new ak(e):e).length;i<o;i=i+32768|0)r+=xd.apply(0,e[Zj?"slice":"subarray"](i,i+32768|0));return r.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(e){for(var r=0|(e=e===void 0?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,i=new ak(r),o=0;o<r;o=o+1|0)i[o]=e.charCodeAt(o);return i},window.TextEncoder||(window.TextEncoder=yl),function(e){var r,i,o,s,l,d,h,p,f,_,g;(function(b){b.LOGIN="LOGIN",b.LOGIN_SUCCESS="LOGIN_SUCCESS",b.LOGIN_FAILURE="LOGIN_FAILURE",b.LOGIN_TIMEOUT="LOGIN_TIMEOUT",b.INTERRUPTED="INTERRUPTED",b.LOGOUT="LOGOUT",b.BANNED_BY_SERVER="BANNED_BY_SERVER",b.REMOTE_LOGIN="REMOTE_LOGIN"})(r||(r={})),e.ConnectionChangeReason=r,function(b){b.DISCONNECTED="DISCONNECTED",b.CONNECTING="CONNECTING",b.CONNECTED="CONNECTED",b.RECONNECTING="RECONNECTING",b.ABORTED="ABORTED"}(i||(i={})),e.ConnectionState=i,function(b){b.IDLE="IDLE",b.SENT_TO_REMOTE="SENT_TO_REMOTE",b.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",b.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",b.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",b.CANCELED="CANCELED",b.FAILURE="FAILURE"}(o||(o={})),e.LocalInvitationState=o,function(b){b.INVITATION_RECEIVED="INVITATION_RECEIVED",b.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",b.REFUSED="REFUSED",b.ACCEPTED="ACCEPTED",b.CANCELED="CANCELED",b.FAILURE="FAILURE"}(s||(s={})),e.RemoteInvitationState=s,function(b){b.UNKNOWN="UNKNOWN",b.PEER_NO_RESPONSE="PEER_NO_RESPONSE",b.INVITATION_EXPIRE="INVITATION_EXPIRE",b.PEER_OFFLINE="PEER_OFFLINE",b.NOT_LOGGEDIN="NOT_LOGGEDIN"}(l||(l={})),e.LocalInvitationFailureReason=l,function(b){b.UNKNOWN="UNKNOWN",b.PEER_OFFLINE="PEER_OFFLINE",b.ACCEPT_FAILURE="ACCEPT_FAILURE",b.INVITATION_EXPIRE="INVITATION_EXPIRE"}(d||(d={})),e.RemoteInvitationFailureReason=d,function(b){b.ONLINE="ONLINE",b.UNREACHABLE="UNREACHABLE",b.OFFLINE="OFFLINE"}(h||(h={})),e.PeerOnlineState=h,(p||(p={})).ONLINE_STATUS="ONLINE_STATUS",e.PeerSubscriptionOption=p,function(b){b.TEXT="TEXT",b.RAW="RAW",b.IMAGE="IMAGE",b.FILE="FILE"}(f||(f={})),e.MessageType=f,function(b){b.CN="CN",b.NA="NA",b.EU="EU",b.AS="AS",b.JP="JP",b.IN="IN",b.GLOB="GLOB",b.OC="OC",b.SA="SA",b.AF="AF",b.OVS="OVS"}(_||(_={})),e.LegacyAreaCode=_,function(b){b.GLOBAL="GLOBAL",b.INDIA="INDIA",b.JAPAN="JAPAN",b.ASIA="ASIA",b.EUROPE="EUROPE",b.CHINA="CHINA",b.NORTH_AMERICA="NORTH_AMERICA"}(g||(g={})),e.AreaCode=g}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(e){return on(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(e){if(Lj(e))throw TypeError("The method doesn't accept regular expressions");return e},ex=qa("match"),dk=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[ex]=!1,"/./"[e](r)}catch{}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(e){return!!~String(jb(this)).indexOf(ck(e),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(e){return Jd(this,e,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch{rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a(function(e){e=function(r){function i(_o,ga,vf){return Object.defineProperty(_o,ga,{value:vf,enumerable:!0,configurable:!0,writable:!0}),_o[ga]}function o(_o,ga,vf,Fi){return ga=Object.create((ga&&ga.prototype instanceof l?ga:l).prototype),Fi=new C(Fi||[]),ga._invoke=function(Gi,_d,Di){var H=Ei;return function(Wt,_e){if(H===kc)throw Error("Generator is already running");if(H===_i){if(Wt==="throw")throw _e;return A()}for(Di.method=Wt,Di.arg=_e;;){if((Wt=Di.delegate)&&(Wt=_(Wt,Di))){if(Wt===_h)continue;return Wt}if(Di.method==="next")Di.sent=Di._sent=Di.arg;else if(Di.method==="throw"){if(H===Ei)throw H=_i,Di.arg;Di.dispatchException(Di.arg)}else Di.method==="return"&&Di.abrupt("return",Di.arg);if(H=kc,(Wt=s(Gi,_d,Di)).type==="normal"){if(H=Di.done?_i:_s,Wt.arg===_h)continue;return{value:Wt.arg,done:Di.done}}Wt.type==="throw"&&(H=_i,Di.method="throw",Di.arg=Wt.arg)}}}(_o,vf,Fi),ga}function s(_o,ga,vf){try{return{type:"normal",arg:_o.call(ga,vf)}}catch(Fi){return{type:"throw",arg:Fi}}}function l(){}function d(){}function h(){}function p(_o){["next","throw","return"].forEach(function(ga){i(_o,ga,function(vf){return this._invoke(ga,vf)})})}function f(_o,ga){function vf(Gi,_d,Di,H){if((Gi=s(_o[Gi],_o,_d)).type!=="throw"){var Wt=Gi.arg;return(Gi=Wt.value)&&X(Gi)==="object"&&j.call(Gi,"__await")?ga.resolve(Gi.__await).then(function(_e){vf("next",_e,Di,H)},function(_e){vf("throw",_e,Di,H)}):ga.resolve(Gi).then(function(_e){Wt.value=_e,Di(Wt)},function(_e){return vf("throw",_e,Di,H)})}H(Gi.arg)}var Fi;this._invoke=function(Gi,_d){function Di(){return new ga(function(H,Wt){vf(Gi,_d,H,Wt)})}return Fi=Fi?Fi.then(Di,Di):Di()}}function _(_o,ga){var vf=_o.iterator[ga.method];if(vf===P){if(ga.delegate=null,ga.method==="throw"){if(_o.iterator.return&&(ga.method="return",ga.arg=P,_(_o,ga),ga.method==="throw"))return _h;ga.method="throw",ga.arg=new TypeError("The iterator does not provide a 'throw' method")}return _h}return(vf=s(vf,_o.iterator,ga.arg)).type==="throw"?(ga.method="throw",ga.arg=vf.arg,ga.delegate=null,_h):(vf=vf.arg)?vf.done?(ga[_o.resultName]=vf.value,ga.next=_o.nextLoc,ga.method!=="return"&&(ga.method="next",ga.arg=P),ga.delegate=null,_h):vf:(ga.method="throw",ga.arg=new TypeError("iterator result is not an object"),ga.delegate=null,_h)}function g(_o){var ga={tryLoc:_o[0]};1 in _o&&(ga.catchLoc=_o[1]),2 in _o&&(ga.finallyLoc=_o[2],ga.afterLoc=_o[3]),this.tryEntries.push(ga)}function b(_o){var ga=_o.completion||{};ga.type="normal",delete ga.arg,_o.completion=ga}function C(_o){this.tryEntries=[{tryLoc:"root"}],_o.forEach(g,this),this.reset(!0)}function k(_o){if(_o){var ga=_o[_t];if(ga)return ga.call(_o);if(typeof _o.next=="function")return _o;if(!isNaN(_o.length)){var vf=-1;return(ga=function Fi(){for(;++vf<_o.length;)if(j.call(_o,vf))return Fi.value=_o[vf],Fi.done=!1,Fi;return Fi.value=P,Fi.done=!0,Fi}).next=ga}}return{next:A}}function A(){return{value:P,done:!0}}var P,x=Object.prototype,j=x.hasOwnProperty,z=typeof Symbol=="function"?Symbol:{},_t=z.iterator||"@@iterator",ue=z.asyncIterator||"@@asyncIterator",_n=z.toStringTag||"@@toStringTag";try{i({},"")}catch{i=function(ga,vf,Fi){return ga[vf]=Fi}}r.wrap=o;var Ei="suspendedStart",_s="suspendedYield",kc="executing",_i="completed",_h={};i(z={},_t,function(){return this});var _p=Object.getPrototypeOf;(_p=_p&&_p(_p(k([]))))&&_p!==x&&j.call(_p,_t)&&(z=_p);var Qm=h.prototype=l.prototype=Object.create(z);return d.prototype=h,i(Qm,"constructor",h),i(h,"constructor",d),d.displayName=i(h,_n,"GeneratorFunction"),r.isGeneratorFunction=function(_o){return!!(_o=typeof _o=="function"&&_o.constructor)&&(_o===d||(_o.displayName||_o.name)==="GeneratorFunction")},r.mark=function(_o){return Object.setPrototypeOf?Object.setPrototypeOf(_o,h):(_o.__proto__=h,i(_o,_n,"GeneratorFunction")),_o.prototype=Object.create(Qm),_o},r.awrap=function(_o){return{__await:_o}},p(f.prototype),i(f.prototype,ue,function(){return this}),r.AsyncIterator=f,r.async=function(_o,ga,vf,Fi,Gi){Gi===void 0&&(Gi=Promise);var _d=new f(o(_o,ga,vf,Fi),Gi);return r.isGeneratorFunction(ga)?_d:_d.next().then(function(Di){return Di.done?Di.value:_d.next()})},p(Qm),i(Qm,_n,"Generator"),i(Qm,_t,function(){return this}),i(Qm,"toString",function(){return"[object Generator]"}),r.keys=function(_o){var ga,vf=[];for(ga in _o)vf.push(ga);return vf.reverse(),function Fi(){for(;vf.length;){var Gi=vf.pop();if(Gi in _o)return Fi.value=Gi,Fi.done=!1,Fi}return Fi.done=!0,Fi}},r.values=k,C.prototype={constructor:C,reset:function(_o){if(this.next=this.prev=0,this.sent=this._sent=P,this.done=!1,this.delegate=null,this.method="next",this.arg=P,this.tryEntries.forEach(b),!_o)for(var ga in this)ga.charAt(0)==="t"&&j.call(this,ga)&&!isNaN(+ga.slice(1))&&(this[ga]=P)},stop:function(){this.done=!0;var _o=this.tryEntries[0].completion;if(_o.type==="throw")throw _o.arg;return this.rval},dispatchException:function(_o){function ga(Wt,_e){return _d.type="throw",_d.arg=_o,vf.next=Wt,_e&&(vf.method="next",vf.arg=P),!!_e}if(this.done)throw _o;for(var vf=this,Fi=this.tryEntries.length-1;0<=Fi;--Fi){var Gi=this.tryEntries[Fi],_d=Gi.completion;if(Gi.tryLoc==="root")return ga("end");if(Gi.tryLoc<=this.prev){var Di=j.call(Gi,"catchLoc"),H=j.call(Gi,"finallyLoc");if(Di&&H){if(this.prev<Gi.catchLoc)return ga(Gi.catchLoc,!0);if(this.prev<Gi.finallyLoc)return ga(Gi.finallyLoc)}else if(Di){if(this.prev<Gi.catchLoc)return ga(Gi.catchLoc,!0)}else{if(!H)throw Error("try statement without catch or finally");if(this.prev<Gi.finallyLoc)return ga(Gi.finallyLoc)}}}},abrupt:function(_o,ga){for(var vf=this.tryEntries.length-1;0<=vf;--vf){var Fi=this.tryEntries[vf];if(Fi.tryLoc<=this.prev&&j.call(Fi,"finallyLoc")&&this.prev<Fi.finallyLoc){var Gi=Fi;break}}return Gi&&(_o==="break"||_o==="continue")&&Gi.tryLoc<=ga&&ga<=Gi.finallyLoc&&(Gi=null),(vf=Gi?Gi.completion:{}).type=_o,vf.arg=ga,Gi?(this.method="next",this.next=Gi.finallyLoc,_h):this.complete(vf)},complete:function(_o,ga){if(_o.type==="throw")throw _o.arg;return _o.type==="break"||_o.type==="continue"?this.next=_o.arg:_o.type==="return"?(this.rval=this.arg=_o.arg,this.method="return",this.next="end"):_o.type==="normal"&&ga&&(this.next=ga),_h},finish:function(_o){for(var ga=this.tryEntries.length-1;0<=ga;--ga){var vf=this.tryEntries[ga];if(vf.finallyLoc===_o)return this.complete(vf.completion,vf.afterLoc),b(vf),_h}},catch:function(_o){for(var ga=this.tryEntries.length-1;0<=ga;--ga){var vf=this.tryEntries[ga];if(vf.tryLoc===_o){if((_o=vf.completion).type==="throw"){var Fi=_o.arg;b(vf)}return Fi}}throw Error("illegal catch attempt")},delegateYield:function(_o,ga,vf){return this.delegate={iterator:k(_o),resultName:ga,nextLoc:vf},this.method==="next"&&(this.arg=P),_h}},r}(e.exports);try{regeneratorRuntime=e}catch{(typeof globalThis>"u"?"undefined":X(globalThis))==="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}),yp=!R(function(){return Object.isExtensible(Object.preventExtensions({}))}),fk=$a(function(e){var r=Ra.f,i=Ae("meta"),o=0,s=Object.isExtensible||function(){return!0},l=function(h){r(h,i,{value:{objectID:"O"+ ++o,weakData:{}}})},d=e.exports={REQUIRED:!1,fastKey:function(h,p){if(!ha(h))return typeof h=="symbol"?h:(typeof h=="string"?"S":"P")+h;if(!Q(h,i)){if(!s(h))return"F";if(!p)return"E";l(h)}return h[i].objectID},getWeakData:function(h,p){if(!Q(h,i)){if(!s(h))return!0;if(!p)return!1;l(h)}return h[i].weakData},onFreeze:function(h){return yp&&d.REQUIRED&&s(h)&&!Q(h,i)&&l(h),h}};Be[i]=!0}),zp=function(e,r,i){var o=e.indexOf("Map")!==-1,s=e.indexOf("Weak")!==-1,l=o?"set":"add",d=y[e],h=d&&d.prototype,p=d,f={},_=function(P){var x=h[P];Ta(h,P,P=="add"?function(j){return x.call(this,j===0?0:j),this}:P=="delete"?function(j){return!(s&&!ha(j))&&x.call(this,j===0?0:j)}:P=="get"?function(j){return s&&!ha(j)?void 0:x.call(this,j===0?0:j)}:P=="has"?function(j){return!(s&&!ha(j))&&x.call(this,j===0?0:j)}:function(j,z){return x.call(this,j===0?0:j,z),this})};if(nc(e,typeof d!="function"||!(s||h.forEach&&!R(function(){new d().entries().next()}))))p=i.getConstructor(r,e,o,l),fk.REQUIRED=!0;else if(nc(e,!0)){var g=new p,b=g[l](s?{}:-0,1)!=g,C=R(function(){g.has(1)}),k=Tg(function(P){new d(P)}),A=!s&&R(function(){for(var P=new d,x=5;x--;)P[l](x,x);return!P.has(-0)});k||((p=r(function(P,x){return Gc(P,p,e),P=lh(new d,P,p),x!=null&&Xg(x,P[l],{that:P,AS_ENTRIES:o}),P})).prototype=h,h.constructor=p),(C||A)&&(_("delete"),_("has"),o&&_("get")),(A||b)&&_(l),s&&h.clear&&delete h.clear}return f[e]=p,N({global:!0,forced:p!=d},f),Ec(p,e),s||i.setStrong(p,e,o),p},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(e,r,i,o){var s=e(function(p,f){Gc(p,s,r),Bp(p,{type:r,index:ac(null),first:void 0,last:void 0,size:0}),ka||(p.size=0),f!=null&&Xg(f,p[o],{that:p,AS_ENTRIES:i})}),l=gk(r),d=function(p,f,_){var g,b=l(p),C=h(p,f);return C?C.value=_:(b.last=C={index:g=Ap(f,!0),key:f,value:_,previous:f=b.last,next:void 0,removed:!1},b.first||(b.first=C),f&&(f.next=C),ka?b.size++:p.size++,g!=="F"&&(b.index[g]=C)),p},h=function(p,f){p=l(p);var _=Ap(f);if(_!=="F")return p.index[_];for(p=p.first;p;p=p.next)if(p.key==f)return p};return Hf(s.prototype,{clear:function(){for(var p=l(this),f=p.index,_=p.first;_;)_.removed=!0,_.previous&&(_.previous=_.previous.next=void 0),delete f[_.index],_=_.next;p.first=p.last=void 0,ka?p.size=0:this.size=0},delete:function(p){var f=l(this);if(p=h(this,p)){var _=p.next,g=p.previous;delete f.index[p.index],p.removed=!0,g&&(g.next=_),_&&(_.previous=g),f.first==p&&(f.first=_),f.last==p&&(f.last=g),ka?f.size--:this.size--}return!!p},forEach:function(p){for(var f,_=l(this),g=Id(p,1<arguments.length?arguments[1]:void 0,3);f=f?f.next:_.first;)for(g(f.value,f.key,this);f&&f.removed;)f=f.previous},has:function(p){return!!h(this,p)}}),Hf(s.prototype,i?{get:function(p){return(p=h(this,p))&&p.value},set:function(p,f){return d(this,p===0?0:p,f)}}:{add:function(p){return d(this,p=p===0?0:p,p)}}),ka&&gx(s.prototype,"size",{get:function(){return l(this).size}}),s},setStrong:function(e,r,i){var o=r+" Iterator",s=gk(r),l=gk(o);bj(e,r,function(d,h){Bp(this,{type:o,target:d,state:s(d),kind:h,last:void 0})},function(){for(var d=l(this),h=d.kind,p=d.last;p&&p.removed;)p=p.previous;return d.target&&(d.last=p=p?p.next:d.state.first)?h=="keys"?{value:p.key,done:!1}:h=="values"?{value:p.value,done:!1}:{value:[p.key,p.value],done:!1}:(d.target=void 0,{value:void 0,done:!0})},i?"entries":"values",!i,!0),If(r)}};zp("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(e){return function(r){return r=String(jb(r)),1&e&&(r=r.replace(hx,"")),2&e&&(r=r.replace(ix,"")),r}};hk(1),hk(2);var ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=sh(`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF08`)!==8||sh(`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF0x16`)!==22?function(e,r){return e=ik(String(e)),sh(e,r>>>0||(jx.test(e)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx=Zb(ac(th))=="Number",Ep=function(e){var r,i=lc(e,!1);if(typeof i=="string"&&2<i.length){if((e=(i=ik(i)).charCodeAt(0))===43||e===45){if((e=i.charCodeAt(2))===88||e===120)return NaN}else if(e===48){switch(i.charCodeAt(1)){case 66:case 98:e=2;var o=49;break;case 79:case 111:e=8,o=55;break;default:return+i}var s=(i=i.slice(2)).length;for(r=0;r<s;r++){var l=i.charCodeAt(r);if(48>l||l>o)return NaN}return parseInt(i,e)}}return+i};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(e){var r=1>arguments.length?0:e,i=this;return i instanceof Pd&&(nx?R(function(){th.valueOf.call(i)}):Zb(i)!="Number")?lh(new pd(Ep(r)),i,Pd):Ep(r)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R(function(){var e=[];return e[Gp]=!1,e.concat()[0]!==e}),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(e){var r,i=Qa(this),o=Sg(i,0),s=0,l=-1;for(r=arguments.length;l<r;l++){var d=l===-1?i:arguments[l],h=d;if(ha(h)){var p=h[Gp];h=p!==void 0?!!p:gd(h)}else h=!1;if(h){if(9007199254740991<s+(p=ta(d.length)))throw TypeError("Maximum allowed index exceeded");for(h=0;h<p;h++,s++)h in d&&Ge(o,s,d[h])}else{if(9007199254740991<=s)throw TypeError("Maximum allowed index exceeded");Ge(o,s++,d)}}return o.length=s,o}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R(function(){kk(function(){})});N({target:"Reflect",stat:!0,forced:rx},{apply:function(e,r,i){return yb(e),va(i),kk?kk(e,r,i):qx.call(e,r,i)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R(function(){return!Object.getOwnPropertyNames(1)});N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe=(typeof Reflect>"u"?"undefined":X(Reflect))==="object"?Reflect:null,Hp=Pe&&typeof Pe.apply=="function"?Pe.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},ux=Pe&&typeof Pe.ownKeys=="function"?Pe.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},Ip=Number.isNaN||function(e){return e!=e};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(e){if(typeof e!="number"||0>e||Ip(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Jp=e}}),ea.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(e){if(typeof e!="number"||0>e||Ip(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ea.prototype.getMaxListeners=function(){return this._maxListeners===void 0?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);i=e==="error";var o=this._events;if(o!==void 0)i=i&&o.error===void 0;else if(!i)return!1;if(i){var s;throw 0<r.length&&(s=r[0]),s instanceof Error?s:((r=Error("Unhandled error."+(s?" ("+s.message+")":""))).context=s,r)}if((i=o[e])===void 0)return!1;if(typeof i=="function")Hp(i,this,r);else for(o=Cl(i,s=i.length),i=0;i<s;++i)Hp(o[i],this,r);return!0},ea.prototype.addListener=function(e,r){return zl(this,e,r,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(e,r){return zl(this,e,r,!0)},ea.prototype.once=function(e,r){return ng(r),this.on(e,Al(this,e,r)),this},ea.prototype.prependOnceListener=function(e,r){return ng(r),this.prependListener(e,Al(this,e,r)),this},ea.prototype.removeListener=function(e,r){var i;ng(r);var o=this._events;if(o===void 0)return this;var s=o[e];if(s===void 0)return this;if(s===r||s.listener===r)--this._eventsCount==0?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,s.listener||r));else if(typeof s!="function"){var l=-1;for(i=s.length-1;0<=i;i--)if(s[i]===r||s[i].listener===r){var d=s[i].listener;l=i;break}if(0>l)return this;if(l===0)s.shift();else{for(;l+1<s.length;l++)s[l]=s[l+1];s.pop()}s.length===1&&(o[e]=s[0]),o.removeListener!==void 0&&this.emit("removeListener",e,d||r)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(e){var r=this._events;if(r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var i=Object.keys(r);for(r=0;r<i.length;++r){var o=i[r];o!=="removeListener"&&this.removeAllListeners(o)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(i=r[e])=="function")this.removeListener(e,i);else if(i!==void 0)for(r=i.length-1;0<=r;r--)this.removeListener(e,i[r]);return this},ea.prototype.listeners=function(e){return Bl(this,e,!0)},ea.prototype.rawListeners=function(e){return Bl(this,e,!1)},ea.listenerCount=function(e,r){return typeof e.listenerCount=="function"?e.listenerCount(r):Dl.call(e,r)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(e,r){return new Promise(function(i,o){function s(d){e.removeListener(r,l),o(d)}function l(){typeof e.removeListener=="function"&&e.removeListener("error",s),i([].slice.call(arguments))}El(e,r,l,{once:!0}),r!=="error"&&vs(e,s,{once:!0})})};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R(function(){if(ka&&Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},i=Symbol();return e[i]=7,"abcdefghijklmnopqrst".split("").forEach(function(o){r[o]=o}),Qe({},e)[i]!=7||Dc(Qe({},r)).join("")!="abcdefghijklmnopqrst"})?function(e,r){for(var i=Qa(e),o=arguments.length,s=1,l=Bf.f,d=zf;o>s;)for(var h,p=Af(arguments[s++]),f=l?Dc(p).concat(l(p)):Dc(p),_=f.length,g=0;_>g;)h=f[g++],(!ka||d.call(p,h))&&(i[h]=p[h]);return i}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(e){return vx(e)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R(function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||sc(Wf,"i")!="/a/i"}))){for(var Oc=function(e,r){var i,o=this instanceof Oc,s=Lj(e),l=r===void 0;return!o&&s&&e.constructor===Oc&&l||(nk?s&&!l&&(e=e.source):e instanceof Oc&&(l&&(r=tj.call(e)),e=e.source),pc&&(i=!!r&&-1<r.indexOf("y"))&&(r=r.replace(/y/g,"")),e=lh(nk?new sc(e,r):sc(e,r),o?this:lk,Oc),pc&&i&&(zx(e).sticky=!0)),e},Bx=function(e){e in Oc||xx(Oc,e,{configurable:!0,get:function(){return sc[e]},set:function(r){sc[e]=r}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",function(e){return function(r,i,o){return e(this,r,i,o)}}),Sf("Float64",function(e){return function(r,i,o){return e(this,r,i,o)}}),Sf("Uint32",function(e){return function(r,i,o){return e(this,r,i,o)}}),Sf("Uint16",function(e){return function(r,i,o){return e(this,r,i,o)}});var ok=function(e,r){return e===r?0:e==null?r==null?0:-1:r==null?e==null?0:1:typeof e.compare=="function"?e.compare(r):typeof r.compare=="function"?-r.compare(e):e<r?-1:e>r?1:0},pk=[],Op=pk.sort,Cx=R(function(){pk.sort(void 0)}),Dx=R(function(){pk.sort(null)}),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(e){return e===void 0?Op.call(Qa(this)):Op.call(Qa(this),yb(e))}});var Pp=Object.getPrototypeOf({}),Xf=function(e,r){var i;return e===r||(e==null?e==r:X(e.equiv)==="function"?e.equiv(r):r==null?e==r:X(r.equiv)==="function"?r.equiv(e):X(e)!=="string"&&X(r)!=="string"&&((i=Object.getPrototypeOf(e))!=null&&i!==Pp||(i=Object.getPrototypeOf(r))!=null&&i!==Pp?X(e)!=="function"&&e.length!==void 0&&X(r)!=="function"&&r.length!==void 0?Gx(e,r):e instanceof Set&&r instanceof Set?Hx(e,r):e instanceof Map&&r instanceof Map?Ix(e,r):e instanceof Date&&r instanceof Date?e.getTime()===r.getTime():e instanceof RegExp&&r instanceof RegExp?e.toString()===r.toString():e!=e&&r!=r:Fx(e,r)))},Gx=function(e,r){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf,o=e.length;if(o===r.length)for(;0<=--o&&i(e[o],r[o]););return 0>o},Hx=function(e,r){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return e.size===r.size&&i(G(e.keys()).sort(),G(r.keys()).sort())},Ix=function(e,r){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return e.size===r.size&&i(G(e).sort(),G(r).sort())},Fx=function(e,r){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var o in e)if(!r.hasOwnProperty(o)||!i(e[o],r[o]))return!1;return!0},Qp=function(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(i){return i!==void 0?": "+i:""};return function(i){function o(l){return W(this,o),s.call(this,e(l)+r(l))}la(o,i);var s=ma(o);return o}(ef(Error))},Jx=Qp(function(){return"illegal argument(s)"}),vh=function(e){throw new Jx(e)},qk=Qp(function(){return"index out of bounds"}),Rp=1/4294967295,Kx=function(){function e(){W(this,e)}return Ha(e,[{key:"float",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*Rp*r}},{key:"norm",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*Rp-.5)*r}},{key:"minmax",value:function(r,i){return this.float()*(i-r)+r}}]),e}(),rk=Math.random,Lx=new(function(e){function r(){return W(this,r),i.apply(this,arguments)}la(r,e);var i=ma(r);return Ha(r,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return rk()*o}},{key:"norm",value:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(rk()-.5)*o}}]),r}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R(function(){sk(1)});N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(e){return sk&&ha(e)?sk(Mx(e)):e}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(e){return Wo(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(e){return e!=null&&typeof e.xform=="function"?e.xform():e},og=function(){function e(r){W(this,e),this.value=r}return Ha(e,[{key:"deref",value:function(){return this.value}}]),e}(),Wh=function(e){return e instanceof og?e.deref():e},xs=function(e,r){return[e,function(i){return i},r]},Qx=w.mark(function(e,r){var i,o,s,l,d,h;return w.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:i=Gl(e)(ws()),o=i[1],s=i[2],l=0;case 4:if(!(l<r.length)){p.next=15;break}if(d=r[l],!((h=s([],d))instanceof og)){p.next=10;break}return p.delegateYield(Wh(o(h.deref())),"t0",9);case 9:return p.abrupt("return");case 10:if(!h.length){p.next=12;break}return p.delegateYield(h,"t1",12);case 12:l++,p.next=4;break;case 15:return p.delegateYield(Wh(o([])),"t2",16);case 16:case"end":return p.stop()}},Qx)}),ys=w.mark(Fl),zs=function(e,r){return[e[0],e[1],r]},Sp=!0;"findIndex"in[]&&Array(1).findIndex(function(){Sp=!1}),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(e){return An(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function e(r){W(this,e),this._length=0,r&&this.into(r)}return Ha(e,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e(this)}},{key:"empty",value:function(){return new e}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var r,i=this.head;i;)r=i.next,delete i.value,delete i.prev,delete i.next,i=r;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(r){var i=this._length;if(i<r._length)return-1;if(i>r._length)return 1;if(i===0)return 0;i=this.head,r=r.head;for(var o=0;i&&o==0;)o=ok(i.value,r.value),i=i.next,r=r.next;return o}},{key:"equiv",value:function(r){if(!(r instanceof e||r!=null&&typeof r!="function"&&r.length!==void 0)||this._length!==r.length)return!1;if(!this._length||this===r)return!0;for(var i=this.head,o=0;o<r.length;o++){if(!Xf(i.value,r[o]))return!1;i=i.next}return!0}},{key:Symbol.iterator,value:w.mark(function r(){var i;return w.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:i=this.head;case 1:if(!i){o.next=7;break}return o.next=4,i.value;case 4:i=i.next,o.next=1;break;case 7:case"end":return o.stop()}},r,this)})},{key:"seq",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(r>=i||0>r)){r=this.nthCell(r);var o=this.nthCell(i-1);return i=function s(l){return{first:function(){return l.value},next:function(){return l!==o&&l.next?s(l.next):void 0}}},r?i(r):void 0}}},{key:"cycle",value:w.mark(function r(){return w.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.delegateYield(this,"t0",2);case 2:i.next=0;break;case 4:case"end":return i.stop()}},r,this)})},{key:"$reduce",value:function(r,i){for(var o=this.head;o&&!(i instanceof og);)i=r(i,o.value),o=o.next;return i}},{key:"drop",value:function(){var r=this.head;if(r)return(this.head=r.next)?delete this.head.prev:delete this.tail,this._length--,r.value}},{key:"cons",value:function(r){return r={value:r,next:this.head},this.head?this.head.prev=r:this.tail=r,this.head=r,this._length++,this}},{key:"insertBefore",value:function(r,i){return r||vh("cell is undefined"),i={value:i,next:r,prev:r.prev},r.prev?r.prev.next=i:this.head=i,r.prev=i,this._length++,this}},{key:"insertAfter",value:function(r,i){return r||vh("cell is undefined"),i={value:i,next:r.next,prev:r},r.next?r.next.prev=i:this.tail=i,r.next=i,this._length++,this}},{key:"insertBeforeNth",value:function(r,i){if(0>r&&(r+=this._length),0>=r)return this.cons(i);if(0>r||r>=this._length)throw new qk(r);return this.insertBefore(this.nthCellUnsafe(r),i)}},{key:"insertAfterNth",value:function(r,i){if(0>r&&(r+=this._length),r>=this._length-1)return this.push(i);if(0>r||r>=this._length)throw new qk(r);return this.insertAfter(this.nthCellUnsafe(r),i)}},{key:"insertSorted",value:function(r,i){i=i||ok;for(var o=this.head;o;){if(0>=i(r,o.value))return this.insertBefore(o,r);o=o.next}return this.push(r)}},{key:"find",value:function(r){for(var i=this.head;i;){if(i.value===r)return i;i=i.next}}},{key:"findWith",value:function(r){for(var i=this.head;i;){if(r(i.value))return i;i=i.next}}},{key:"concat",value:function(){for(var r=this.copy(),i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];for(i=0;i<o.length;i++)r.into(o[i]);return r}},{key:"into",value:function(r){for(var i=0;i<r.length;i++)this.push(r[i])}},{key:"slice",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;r=0>r?r+this._length:r,i=0>i?i+this._length:i,(0>r||0>i)&&vh("invalid indices: ${from} / ${to}");for(var o=new e,s=this.nthCell(r);s&&++r<=i;)o.push(s.value),s=s.next;return o}},{key:"splice",value:function(r){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,o=2<arguments.length?arguments[2]:void 0;if(typeof r=="number"){if(0>r&&(r+=this._length),0>r||r>=this._length)throw new qk(r);var s=this.nthCellUnsafe(r)}else s=r;var l=new e;if(0<i)for(;s&&0<i--;)this.remove(s),l.push(s.value),s=s.next;else s&&(s=s.next);if(o)if(s)for(i=0;i<o.length;i++)this.insertBefore(s,o[i]);else for(s=0;s<o.length;s++)this.push(o[s]);return l}},{key:"remove",value:function(r){return r.prev?r.prev.next=r.next:this.head=r.next,r.next?r.next.prev=r.prev:this.tail=r.prev,this._length--,this}},{key:"swap",value:function(r,i){if(r!==i){var o=r.value;r.value=i.value,i.value=o}return this}},{key:"push",value:function(r){return this.tail?(r={value:r,prev:this.tail},this.tail=this.tail.next=r,this._length++,this):this.cons(r)}},{key:"pop",value:function(){var r=this.tail;if(r)return(this.tail=r.prev)?delete this.tail.next:delete this.head,this._length--,r.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(r){return this.head?(this.head.value=r,this):this.cons(r)}},{key:"setTail",value:function(r){return this.tail?(this.tail.value=r,this):this.push(r)}},{key:"setNth",value:function(r,i){var o=this.nthCell(r);return!o&&vh("index out of bounds: ".concat(r)),o.value=i,this}},{key:"nth",value:function(r,i){return(r=this.nthCell(r))?r.value:i}},{key:"nthCell",value:function(r){if(0>r&&(r+=this._length),!(0>r||r>=this._length))return this.nthCellUnsafe(r)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var r=this.peek();return this.pop(),this.cons(r)}}},{key:"map",value:function(r){for(var i=new e,o=this.head;o;)i.push(r(o.value)),o=o.next;return i}},{key:"filter",value:function(r){for(var i=new e,o=this.head;o;)r(o.value)&&i.push(o.value),o=o.next;return i}},{key:"reduce",value:function(r,i){for(var o=this.head;o;)i=r(i,o.value),o=o.next;return i}},{key:"shuffle",value:function(r){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:Lx;if(2>this._length)return this;for(r=r??Math.ceil(1.5*Math.log2(this._length));0<r;r--)for(var o=this.head;o;){var s=o.next;.5>i.float()?this.asHead(o):this.asTail(o),o=s}return this}},{key:"sort",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:ok;if(!this._length)return this;for(var i=1;;){var o=this.head;this.tail=this.head=void 0;for(var s=0;o;){s++;for(var l=o,d=0,h=0;h<i&&(d++,l=l.next);h++);for(h=i;0<d||0<h&&l;){if(d===0){var p=l;l=l.next,h--}else l&&h!==0?0>=r(o.value,l.value)?(p=o,o=o.next,d--):(p=l,l=l.next,h--):(p=o,o=o.next,d--);this.tail?this.tail.next=p:this.head=p,p.prev=this.tail,this.tail=p}o=l}if(this.tail.next=void 0,1>=s)return this;i*=2}}},{key:"reverse",value:function(){for(var r=this.head,i=this.tail,o=(this._length>>>1)+(1&this._length);r&&i&&0<o;){var s=r.value;r.value=i.value,i.value=s,r=r.next,i=i.prev,o--}return this}},{key:"asHead",value:function(r){return r===this.head||(this.remove(r),this.head.prev=r,r.next=this.head,r.prev=void 0,this.head=r,this._length++),this}},{key:"asTail",value:function(r){return r===this.tail||(this.remove(r),this.tail.next=r,r.prev=this.tail,r.next=void 0,this.tail=r,this._length++),this}},{key:"toString",value:function(){for(var r=[],i=this.head;i;)r.push(String(i.value)),i=i.next;return r.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(r){if(r<=this._length>>1)var i=this.head,o="next";else i=this.tail,o="prev",r=this._length-r-1;for(;0<r--&&i;)i=i[o];return i}}]),e}(),tc=function(){function e(r,i){W(this,e),i=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},i),this.map=i.map(),this.items=new Rx,this._size=0,this.opts=i,r&&this.into(r)}return Ha(e,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg(function(r){return[r.k,r]},this.items)}},{key:"keys",value:function(){return pg(function(r){return r.k},this.items)}},{key:"values",value:function(){return pg(function(r){return r.v},this.items)}},{key:"copy",value:function(){var r=this.empty();r.items=this.items.copy();for(var i=r.items.head;i;)r.map.set(i.value.k,i),i=i.next;return r}},{key:"empty",value:function(){return new e(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var r=this.opts.release;if(r){for(var i;i=this.items.drop();)r(i.k,i.v);return!0}return this.items.release()}},{key:"has",value:function(r){return this.map.has(r)}},{key:"get",value:function(r,i){return(r=this.map.get(r))?this.resetEntry(r):i}},{key:"set",value:function(r,i){var o=this.opts.ksize(r)+this.opts.vsize(i),s=this.map.get(r);return this._size+=Math.max(0,o-(s?s.value.s:0)),this.ensureSize()&&this.doSetEntry(s,r,i,o),i}},{key:"into",value:function(r){for(var i=0;i<r.length;i++){var o=r[i];this.set(o[0],o[1])}return this}},{key:"getSet",value:function(r,i){var o=this,s=this.map.get(r);return s?Promise.resolve(this.resetEntry(s)):i().then(function(l){return o.set(r,l)})}},{key:"delete",value:function(r){return!!(r=this.map.get(r))&&(this.removeEntry(r),!0)}},{key:"resetEntry",value:function(r){return this.items.asTail(r),r.value.v}},{key:"ensureSize",value:function(){for(var r=this.opts.release,i=this.opts.maxsize,o=this.opts.maxlen;this._size>i||this.length>=o;){var s=this.items.drop();if(!s)return!1;this.map.delete(s.k),r&&r(s.k,s.v),this._size-=s.s}return!0}},{key:"removeEntry",value:function(r){var i=r.value;this.map.delete(i.k),this.items.remove(r),this.opts.release&&this.opts.release(i.k,i.v),this._size-=i.s}},{key:"doSetEntry",value:function(r,i,o,s){r?(r.value.v=o,r.value.s=s,this.items.asTail(r)):(this.items.push({k:i,v:o,s}),this.map.set(i,this.items.tail))}}]),e}(),Sx=function(e){function r(o,s){return W(this,r),s=Object.assign({ttl:36e5},s),i.call(this,o,s)}la(r,e);var i=ma(r);return Ha(r,[{key:"empty",value:function(){return new r(null,this.opts)}},{key:"has",value:function(o){return this.get(o)!==void 0}},{key:"get",value:function(o,s){if(o=this.map.get(o)){if(o.value.t>=Date.now())return this.resetEntry(o);this.removeEntry(o)}return s}},{key:"set",value:function(o,s){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,d=this.opts.ksize(o)+this.opts.vsize(s),h=this.map.get(o);return this._size+=Math.max(0,d-(h?h.value.s:0)),this.ensureSize()&&(l=Date.now()+l,h?(h.value.v=s,h.value.s=d,h.value.t=l,this.items.asTail(h)):(this.items.push({k:o,v:s,s:d,t:l}),this.map.set(o,this.items.tail))),s}},{key:"getSet",value:function(o,s){var l=this,d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,h=this.get(o);return h?Promise.resolve(h):s().then(function(p){return l.set(o,p,d)})}},{key:"prune",value:function(){for(var o=Date.now(),s=this.items.head;s;)s.value.t<o&&this.removeEntry(s),s=s.next}},{key:"ensureSize",value:function(){for(var o=this.opts.maxsize,s=this.opts.maxlen,l=Date.now(),d=this.items.head;d&&(this._size>o||this.length>=s);)d.value.t<l&&this.removeEntry(d),d=d.next;return Th(wd(r.prototype),"ensureSize",this).call(this)}}]),r}(tc),Tp=X(Ya)=="object"&&Ya&&Ya.Object===Object&&Ya,Tx=(typeof self>"u"?"undefined":X(self))=="object"&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(e){if(e==null)e=e===void 0?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(e)){var r=Ux.call(e,Yf),i=e[Yf];try{e[Yf]=void 0;var o=!0}catch{}var s=Vx.call(e);o&&(r?e[Yf]=i:delete e[Yf]),e=s}else e=Wx.call(e);return e},lb=function(e){var r=X(e);return e!=null&&(r=="object"||r=="function")},qi=function(e){return!!lb(e)&&((e=Qd(e))=="[object Function]"||e=="[object GeneratorFunction]"||e=="[object AsyncFunction]"||e=="[object Proxy]")},tk=Cb["__core-js_shared__"],Wp=function(){var e=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Xx=Function.prototype.toString,Rd=function(e){if(e!=null){try{return Xx.call(e)}catch{}return e+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(e,r){return e=e?.[r],!lb(e)||Wp&&Wp in e||!(qi(e)?Zx:Yx).test(Rd(e))?void 0:e},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},zd.prototype.get=function(e){var r=this.__data__;return Zf?(e=r[e])==="__lodash_hash_undefined__"?void 0:e:$x.call(r,e)?r[e]:void 0},zd.prototype.has=function(e){var r=this.__data__;return Zf?r[e]!==void 0:ay.call(r,e)},zd.prototype.set=function(e,r){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Zf&&r===void 0?"__lodash_hash_undefined__":r,this};var $f=function(e,r){return e===r||e!=e&&r!=r},wh=function(e,r){for(var i=e.length;i--;)if($f(e[i][0],r))return i;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(e){var r=this.__data__;return!(0>(e=wh(r,e)))&&(e==r.length-1?r.pop():by.call(r,e,1),--this.size,!0)},ce.prototype.get=function(e){var r=this.__data__;return 0>(e=wh(r,e))?void 0:r[e][1]},ce.prototype.has=function(e){return-1<wh(this.__data__,e)},ce.prototype.set=function(e,r){var i=this.__data__,o=wh(i,e);return 0>o?(++this.size,i.push([e,r])):i[o][1]=r,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(e,r){e=e.__data__;var i=X(r);return(i=="string"||i=="number"||i=="symbol"||i=="boolean"?r!=="__proto__":r===null)?e[typeof r=="string"?"string":"hash"]:e.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(e){return e=xh(this,e).delete(e),this.size-=e?1:0,e},de.prototype.get=function(e){return xh(this,e).get(e)},de.prototype.has=function(e){return xh(this,e).has(e)},de.prototype.set=function(e,r){var i=xh(this,e),o=i.size;return i.set(e,r),this.size+=i.size==o?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},gf.prototype.has=function(e){return this.__data__.has(e)};var Xp=function(e,r,i,o){var s=e.length;for(i+=o?1:-1;o?i--:++i<s;)if(r(e[i],i,e))return i;return-1},cy=function(e){return e!=e},dy=function(e,r){var i;if(i=!(e==null||!e.length)){if(r==r)t:{i=-1;for(var o=e.length;++i<o;)if(e[i]===r){e=i;break t}e=-1}else e=Xp(e,cy,0);i=-1<e}return i},ey=function(e,r,i){for(var o=-1,s=e==null?0:e.length;++o<s;)if(i(r,e[o]))return!0;return!1},fy=function(e,r){return e.has(r)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(e){var r=-1,i=Array(e.size);return e.forEach(function(o){i[++r]=o}),i},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(e){return new Re(e)}:gy,vk=function(e,r,i){var o=-1,s=dy,l=e.length,d=!0,h=[],p=h;if(i)d=!1,s=ey;else if(200<=l){if(s=r?null:iy(e))return uk(s);d=!1,s=fy,p=new gf}else p=r?[]:h;t:for(;++o<l;){var f=e[o],_=r?r(f):f;if(f=i||f!==0?f:0,d&&_==_){for(var g=p.length;g--;)if(p[g]===_)continue t;r&&p.push(_),h.push(f)}else s(p,_,i)||(p!==h&&p.push(_),h.push(f))}return h},Yp=function(e){for(var r=-1,i=e==null?0:e.length,o={};++r<i;){var s=e[r];o[s[0]]=s[1]}return o},he=function(e,r){for(var i=-1,o=e==null?0:e.length,s=Array(o);++i<o;)s[i]=r(e[i],i,e);return s};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(e){var r=this.__data__;return e=r.delete(e),this.size=r.size,e},ee.prototype.get=function(e){return this.__data__.get(e)},ee.prototype.has=function(e){return this.__data__.has(e)},ee.prototype.set=function(e,r){var i=this.__data__;if(i instanceof rg){var o=i.__data__;if(!ag||199>o.length)return o.push([e,r]),this.size=++i.size,this;i=this.__data__=new qg(o)}return i.set(e,r),this.size=i.size,this};var ge=ee,Is=function(e,r){for(var i=-1,o=e==null?0:e.length;++i<o&&r(e[i],i,e)!==!1;);return e},yh=function(){try{var e=Sd(Object,"defineProperty");return e({},"",{}),e}catch{}}(),bg=function(e,r,i){r=="__proto__"&&yh?yh(e,r,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[r]=i},jy=Object.prototype.hasOwnProperty,Ml=function(e,r,i){var o=e[r];jy.call(e,r)&&$f(o,i)&&(i!==void 0||r in e)||bg(e,r,i)},re=function(e,r,i,o){var s=!i;i||(i={});for(var l=-1,d=r.length;++l<d;){var h=r[l],p=o?o(i[h],e[h],h,i,e):void 0;p===void 0&&(p=e[h]),s?bg(i,h,p):Ml(i,h,p)}return i},gc=function(e){return e!=null&&X(e)=="object"},Zp=function(e){return gc(e)&&Qd(e)=="[object Arguments]"},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(e){return gc(e)&&ky.call(e,"callee")&&!ly.call(e,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a(function(e,r){var i=(r=r&&!r.nodeType&&r)&&e&&!e.nodeType&&e;r=i&&i.exports===r?Cb.Buffer:void 0,e.exports=(r?r.isBuffer:void 0)||my}),ny=/^(?:0|[1-9]\d*)$/,wk=function(e,r){var i=X(e);return!!(r=r??9007199254740991)&&(i=="number"||i!="symbol"&&ny.test(e))&&-1<e&&e%1==0&&e<r},xk=function(e){return typeof e=="number"&&-1<e&&e%1==0&&9007199254740991>=e},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(e){return gc(e)&&xk(e.length)&&!!Ea[Qd(e)]},zh=function(e){return function(r){return e(r)}},Se=$a(function(e,r){var i=r&&!r.nodeType&&r;i=(r=i&&e&&!e.nodeType&&e)&&r.exports===i&&Tp.process;t:{try{var o=r&&r.require&&r.require("util").types;if(o){var s=o;break t}s=i&&i.binding&&i.binding("util");break t}catch{}s=void 0}e.exports=s}),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(e,r){var i=Va(e),o=!i&&rf(e),s=!i&&!o&&jf(e),l=!i&&!o&&!s&&bi(e);if(i=i||o||s||l){o=e.length;for(var d=String,h=-1,p=Array(o);++h<o;)p[h]=d(h);o=p}else o=[];for(var f in d=o.length,e)!r&&!py.call(e,f)||i&&(f=="length"||s&&(f=="offset"||f=="parent")||l&&(f=="buffer"||f=="byteLength"||f=="byteOffset")||wk(f,d))||o.push(f);return o},qy=Object.prototype,yk=function(e){var r=e&&e.constructor;return e===(typeof r=="function"&&r.prototype||qy)},cq=function(e,r){return function(i){return e(r(i))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(e){return e!=null&&xk(e.length)&&!qi(e)},Ad=function(e){if(Ed(e))e=bq(e);else if(yk(e)){var r,i=[];for(r in Object(e))sy.call(e,r)&&r!="constructor"&&i.push(r);e=i}else e=ry(e);return e},Es=function(e,r){return e&&re(r,Ad(r),e)},ty=Object.prototype.hasOwnProperty,kf=function(e){if(Ed(e))e=bq(e,!0);else if(lb(e)){var r=yk(e),i=[];for(o in e)(o!="constructor"||!r&&ty.call(e,o))&&i.push(o);e=i}else{var o=[];if(e!=null)for(r in Object(e))o.push(r);e=o}return e},Cs=function(e,r){return e&&re(r,kf(r),e)},Jl=$a(function(e,r){var i=(r=r&&!r.nodeType&&r)&&e&&!e.nodeType&&e,o=(r=i&&i.exports===r?Cb.Buffer:void 0)?r.allocUnsafe:void 0;e.exports=function(s,l){return l?s.slice():(l=s.length,l=o?o(l):new s.constructor(l),s.copy(l),l)}}),Xh=function(e,r){var i=-1,o=e.length;for(r||(r=Array(o));++i<o;)r[i]=e[i];return r},uy=function(e,r){for(var i=-1,o=e==null?0:e.length,s=0,l=[];++i<o;){var d=e[i];r(d,i,e)&&(l[s++]=d)}return l},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(e){return e==null?[]:(e=Object(e),uy(eq(e),function(r){return vy.call(e,r)}))}:dq,Ds=function(e,r){return re(e,zk(e),r)},ai=function(e,r){for(var i=-1,o=r.length,s=e.length;++i<o;)e[s+i]=r[i];return e},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(e){for(var r=[];e;)ai(r,zk(e)),e=Ak(e);return r}:dq,Bs=function(e,r){return re(e,fq(e),r)},gq=function(e,r,i){return r=r(e),Va(e)?r:ai(r,i(e))},Yh=function(e){return gq(e,Ad,zk)},Ll=function(e){return gq(e,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&Td(new Bk(new ArrayBuffer(1)))!="[object DataView]"||ag&&Td(new ag)!="[object Map]"||Ck&&Td(Ck.resolve())!="[object Promise]"||Re&&Td(new Re)!="[object Set]"||Dk&&Td(new Dk)!="[object WeakMap]")&&(Td=function(e){var r=Qd(e);if(e=(e=r=="[object Object]"?e.constructor:void 0)?Rd(e):"")switch(e){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return r});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(e){var r=e.length,i=new e.constructor(r);return r&&typeof e[0]=="string"&&By.call(e,"index")&&(i.index=e.index,i.input=e.input),i},Ah=Cb.Uint8Array,Ek=function(e){var r=new e.constructor(e.byteLength);return new Ah(r).set(new Ah(e)),r},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(e,r){return r=r?Ek(e.buffer):e.buffer,new e.constructor(r,e.byteOffset,e.length)},Fs=function(e,r,i){var o=e.constructor;switch(r){case"[object ArrayBuffer]":return Ek(e);case"[object Boolean]":case"[object Date]":return new o(+e);case"[object DataView]":return r=i?Ek(e.buffer):e.buffer,new e.constructor(r,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(e,i);case"[object Map]":return new o;case"[object Number]":case"[object String]":return new o(e);case"[object RegExp]":return(r=new e.constructor(e.source,Cy.exec(e))).lastIndex=e.lastIndex,r;case"[object Set]":return new o;case"[object Symbol]":return iq?Object(iq.call(e)):{}}},jq=Object.create,Dy=function(){function e(){}return function(r){return lb(r)?jq?jq(r):(e.prototype=r,r=new e,e.prototype=void 0,r):{}}}(),Kl=function(e){return typeof e.constructor!="function"||yk(e)?{}:Dy(Ak(e))},Ey=function(e){return gc(e)&&hf(e)=="[object Map]"},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(e){return gc(e)&&hf(e)=="[object Set]"},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(e){return X(e)=="symbol"||gc(e)&&Qd(e)=="[object Symbol]"},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(e,r){if(Va(e))return!1;var i=X(e);return!(i!="number"&&i!="symbol"&&i!="boolean"&&e!=null&&!ie(e))||Hy.test(e)||!Gy.test(e)||r!=null&&e in Object(r)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(e){var r=(e=Zh(e,function(i){return r.size===500&&r.clear(),i})).cache;return e}(function(e){var r=[];return e.charCodeAt(0)===46&&r.push(""),e.replace(Iy,function(i,o,s,l){r.push(s?l.replace(Jy,"$1"):o||i)}),r}),Js=1/0,mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(e,r){return Va(e)?e:Fk(e,r)?[e]:Ky(e==null?"":Nl(e))},Ly=1/0,cg=function(e){if(typeof e=="string"||ie(e))return e;var r=e+"";return r=="0"&&1/e==-Ly?"-0":r},Ch=function(e,r){for(var i=0,o=(r=Bh(r,e)).length;e!=null&&i<o;)e=e[cg(r[i++])];return i&&i==o?e:void 0},My=function(e,r){if(!(2>(r=Bh(r,e)).length)){var i=r,o=0,s=-1,l=-1,d=i.length;for(0>o&&(o=-o>d?0:d+o),0>(s=s>d?d:s)&&(s+=d),d=o>s?0:s-o>>>0,o>>>=0,s=Array(d);++l<d;)s[l]=i[l+o];e=Ch(e,s)}return(i=e==null)||(i=r==null?0:r.length,i=delete e[cg(i?r[i-1]:void 0)]),i},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(e){return!(!gc(e)||Qd(e)!="[object Object]")&&((e=Ak(e))===null||typeof(e=Ny.call(e,"constructor")&&e.constructor)=="function"&&e instanceof e&&nq.call(e)==Oy)},Py=function(e){return wm(e)?void 0:e},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(e){return Va(e)||rf(e)||!!(oq&&e&&e[oq])},Qy=function(e){return e!=null&&e.length?$h(e,1):[]},Ry=function(e,r,i){switch(i.length){case 0:return e.call(r);case 1:return e.call(r,i[0]);case 2:return e.call(r,i[0],i[1]);case 3:return e.call(r,i[0],i[1],i[2])}return e.apply(r,i)},pq=Math.max,qq=function(e,r,i){return r=pq(r===void 0?e.length-1:r,0),function(){for(var o=arguments,s=-1,l=pq(o.length-r,0),d=Array(l);++s<l;)d[s]=o[r+s];for(s=-1,l=Array(r+1);++s<r;)l[s]=o[s];return l[r]=i(d),Ry(e,this,l)}},Sy=function(e){return function(){return e}},Dh=function(e){return e},Ty=Date.now,rq=function(e){var r=0,i=0;return function(){var o=Ty(),s=16-(o-i);if(i=o,0<s){if(800<=++r)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}(yh?function(e,r){return yh(e,"toString",{configurable:!0,enumerable:!1,value:Sy(r),writable:!0})}:Dh),Gk=function(e){return rq(qq(e,void 0,Qy),e+"")}(function(e,r){var i={};if(e==null)return i;var o=!1;r=he(r,function(l){return l=Bh(l,e),o||(o=1<l.length),l}),re(e,Ll(e),i),o&&(i=fe(i,7,Py));for(var s=r.length;s--;)My(i,r[s]);return i}),Uy=function(e,r,i,o){for(var s=-1,l=e==null?0:e.length;++s<l;){var d=e[s];r(o,d,i(d),e)}return o},um=function(e,r,i){for(var o=-1,s=Object(e),l=(i=i(e)).length;l--;){var d=i[++o];if(r(s[d],d,s)===!1)break}return e},sq=function(e,r){return e&&um(e,r,Ad)},Hk=function(e,r){return function(i,o){if(i==null)return i;if(!Ed(i))return e(i,o);for(var s=i.length,l=-1,d=Object(i);++l<s&&o(d[l],l,d)!==!1;);return i}}(sq),Vy=function(e,r,i,o){return Hk(e,function(s,l,d){r(o,s,i(s),d)}),o},tq=function(e,r){for(var i=-1,o=e==null?0:e.length;++i<o;)if(r(e[i],i,e))return!0;return!1},Pl=function(e,r,i,o,s,l){var d=1&i,h=e.length,p=r.length;if(h!=p&&!(d&&p>h))return!1;p=l.get(e);var f=l.get(r);if(p&&f)return p==r&&f==e;p=-1,f=!0;var _=2&i?new gf:void 0;for(l.set(e,r),l.set(r,e);++p<h;){var g=e[p],b=r[p];if(o)var C=d?o(b,g,p,r,e,l):o(g,b,p,e,r,l);if(C!==void 0){if(C)continue;f=!1;break}if(_){if(!tq(r,function(k,A){if(!_.has(A)&&(g===k||s(g,k,i,o,l)))return _.push(A)})){f=!1;break}}else if(g!==b&&!s(g,b,i,o,l)){f=!1;break}}return l.delete(e),l.delete(r),f},Wy=function(e){var r=-1,i=Array(e.size);return e.forEach(function(o,s){i[++r]=[s,o]}),i},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(e,r,i,o,s,l,d){switch(i){case"[object DataView]":if(e.byteLength!=r.byteLength||e.byteOffset!=r.byteOffset)break;e=e.buffer,r=r.buffer;case"[object ArrayBuffer]":if(e.byteLength!=r.byteLength||!l(new Ah(e),new Ah(r)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+e,+r);case"[object Error]":return e.name==r.name&&e.message==r.message;case"[object RegExp]":case"[object String]":return e==r+"";case"[object Map]":var h=Wy;case"[object Set]":if(h||(h=uk),e.size!=r.size&&!(1&o))break;return(i=d.get(e))?i==r:(o|=2,d.set(e,r),r=Pl(h(e),h(r),o,s,l,d),d.delete(e),r);case"[object Symbol]":if(Ik)return Ik.call(e)==Ik.call(r)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(e,r,i,o){var s=i.length,l=s,d=!o;if(e==null)return!l;for(e=Object(e);s--;){var h=i[s];if(d&&h[2]?h[1]!==e[h[0]]:!(h[0]in e))return!1}for(;++s<l;){var p=(h=i[s])[0],f=e[p],_=h[1];if(d&&h[2]){if(f===void 0&&!(p in e))return!1}else{if(h=new ge,o)var g=o(f,_,p,e,r,h);if(g===void 0?!je(_,f,3,o,h):!g)return!1}}return!0},Yy=function(e){for(var r=Ad(e),i=r.length;i--;){var o=r[i],s=e[o];r[i]=[o,s,s==s&&!lb(s)]}return r},vq=function(e,r){return function(i){return i!=null&&i[e]===r&&(r!==void 0||e in Object(i))}},Zy=function(e){var r=Yy(e);return r.length==1&&r[0][2]?vq(r[0][0],r[0][1]):function(i){return i===e||Xy(i,e,r)}},$y=function(e,r){return Fk(e)&&r==r&&!lb(r)?vq(cg(e),r):function(i){var o=i==null?void 0:Ch(i,e);if((o=o===void 0?void 0:o)===void 0&&o===r){if(o=i!=null){for(var s=-1,l=(o=Bh(o=e,i)).length,d=!1;++s<l;){var h=cg(o[s]);if(!(d=i!=null&&i!=null&&h in Object(i)))break;i=i[h]}d||++s!=l?o=d:o=!!(l=i==null?0:i.length)&&xk(l)&&wk(h,l)&&(Va(i)||rf(i))}h=o}else h=je(r,o,3);return h}},az=function(e){return function(r){return r?.[e]}},bz=function(e){return function(r){return Ch(r,e)}},Te=function(e){return typeof e=="function"?e:e==null?Dh:X(e)=="object"?Va(e)?$y(e[0],e[1]):Zy(e):Fk(e)?az(cg(e)):bz(e)},Jk=function(e,r){return function(i,o){var s={};return(Va(i)?Uy:Vy)(i,e,Te(o),s)}}(function(e,r,i){bg(e,i,r)}),uc=function(e,r){var i={};return r=Te(r),sq(e,function(o,s,l){bg(i,s,r(o,s,l))}),i};N({target:"String",proto:!0,forced:R(function(){var e="".sub('"');return e!==e.toLowerCase()||3<e.split('"').length})},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(e){if(2>(e=e||10)||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var r=Gb(e),i=this.div(r);return r=i.mul(r).sub(this),i.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}i=Gb(sg(e,6),this.unsigned),r=this;for(var o="";;){var s=r.div(i),l=(r.sub(s.mul(i)).toInt()>>>0).toString(e);if((r=s).isZero())return l+o;for(;6>l.length;)l="0"+l;o=""+l+o}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,r=31;0<r&&!(e&1<<r);r--);return this.high!=0?r+33:r+1},D.isZero=function(){return this.high===0&&this.low===0},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return(1&this.low)==1},D.isEven=function(){return(1&this.low)==0},D.equals=function(e){return mb(e)||(e=Wb(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},D.eq=D.equals,D.notEquals=function(e){return!this.eq(e)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(e){return 0>this.comp(e)},D.lt=D.lessThan,D.lessThanOrEqual=function(e){return 0>=this.comp(e)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(e){return 0<this.comp(e)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(e){return 0<=this.comp(e)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(e){if(mb(e)||(e=Wb(e)),this.eq(e))return 0;var r=this.isNegative(),i=e.isNegative();return r&&!i?-1:!r&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(e){mb(e)||(e=Wb(e));var r=this.high>>>16,i=65535&this.high,o=this.low>>>16,s=e.high>>>16,l=65535&e.high,d=e.low>>>16;return o=(d=((e=(65535&this.low)+(65535&e.low))>>>16)+(o+d))>>>16,ya((65535&d)<<16|65535&e,(r=((o+=i+l)>>>16)+(r+s)&65535)<<16|65535&o,this.unsigned)},D.subtract=function(e){return mb(e)||(e=Wb(e)),this.add(e.neg())},D.sub=D.subtract,D.multiply=function(e){if(this.isZero())return Hb;if(mb(e)||(e=Wb(e)),Qb){var r=Qb.mul(this.low,this.high,e.low,e.high);return ya(r,Qb.get_high(),this.unsigned)}if(e.isZero())return Hb;if(this.eq(nb))return e.isOdd()?nb:Hb;if(e.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(wq)&&e.lt(wq))return Gb(this.toNumber()*e.toNumber(),this.unsigned);r=this.high>>>16;var i=65535&this.high,o=this.low>>>16,s=65535&this.low,l=e.high>>>16,d=65535&e.high,h=e.low>>>16,p=s*(e=65535&e.low),f=(p>>>16)+o*e,_=f>>>16;_+=(f=(65535&f)+s*h)>>>16;var g=(_+=i*e)>>>16;return ya((65535&f)<<16|65535&p,(g=(g+=(_=(65535&_)+o*h)>>>16)+((_=(65535&_)+s*d)>>>16)+(r*e+i*h+o*d+s*l)&65535)<<16|65535&_,this.unsigned)},D.mul=D.multiply,D.divide=function(e){if(mb(e)||(e=Wb(e)),e.isZero())throw Error("division by zero");if(Qb)return this.unsigned||this.high!==-2147483648||e.low!==-1||e.high!==-1?ya(e=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Cd;if(e.gt(this.shru(1)))return xq;var r=Cd}else{if(this.eq(nb)){if(e.eq(Ue)||e.eq(Kk))return nb;if(e.eq(nb))return Ue;var i=this.shr(1).div(e).shl(1);if(i.eq(Hb))return e.isNegative()?Ue:Kk;var o=this.sub(e.mul(i));return i.add(o.div(e))}if(e.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=Hb}for(o=this;o.gte(e);){i=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));var s=Math.ceil(Math.log(i)/Math.LN2);s=48>=s?1:sg(2,s-48);for(var l=Gb(i),d=l.mul(e);d.isNegative()||d.gt(o);)d=(l=Gb(i-=s,this.unsigned)).mul(e);l.isZero()&&(l=Ue),r=r.add(l),o=o.sub(d)}return r},D.div=D.divide,D.modulo=function(e){return mb(e)||(e=Wb(e)),Qb?ya(e=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(e){return mb(e)||(e=Wb(e)),ya(this.low&e.low,this.high&e.high,this.unsigned)},D.or=function(e){return mb(e)||(e=Wb(e)),ya(this.low|e.low,this.high|e.high,this.unsigned)},D.xor=function(e){return mb(e)||(e=Wb(e)),ya(this.low^e.low,this.high^e.high,this.unsigned)},D.shiftLeft=function(e){return mb(e)&&(e=e.toInt()),(e&=63)==0?this:32>e?ya(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ya(0,this.low<<e-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(e){return mb(e)&&(e=e.toInt()),(e&=63)==0?this:32>e?ya(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ya(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(e){if(mb(e)&&(e=e.toInt()),(e&=63)===0)return this;var r=this.high;return 32>e?ya(this.low>>>e|r<<32-e,r>>>e,this.unsigned):ya(e===32?r:r>>>e-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var e=this.high,r=this.low;return[255&r,r>>>8&255,r>>>16&255,r>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},D.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,r>>>24,r>>>16&255,r>>>8&255,255&r]},xa.fromBytes=function(e,r,i){return i?xa.fromBytesLE(e,r):xa.fromBytesBE(e,r)},xa.fromBytesLE=function(e,r){return new xa(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)},xa.fromBytesBE=function(e,r){return new xa(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)};var di=function(e,r){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var s in o)o.hasOwnProperty(s)&&(i[s]=o[s])})(e,r)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=e},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(e){},error:function(e){if(Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)},complete:function(){}},Jb=Array.isArray||function(e){return e&&typeof e.length=="number"},lf=function(){function e(r){return Error.call(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(i,o){return o+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r,this}return e.prototype=Object.create(Error.prototype),e}(),Oa=function(){function e(r){this.closed=!1,this._subscriptions=this._parentOrParents=null,r&&(this._ctorUnsubscribe=!0,this._unsubscribe=r)}return e.prototype.unsubscribe=function(){if(!this.closed){var r=this._parentOrParents,i=this._ctorUnsubscribe,o=this._unsubscribe,s=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,r instanceof e)r.remove(this);else if(r!==null)for(var l=0;l<r.length;++l)r[l].remove(this);if(le(o)){i&&(this._unsubscribe=void 0);try{o.call(this)}catch(h){var d=h instanceof lf?Xl(h.errors):[h]}}if(Jb(s)){for(l=-1,r=s.length;++l<r;)if(ei(i=s[l]))try{i.unsubscribe()}catch(h){d=d||[],h instanceof lf?d=d.concat(Xl(h.errors)):d.push(h)}}if(d)throw new lf(d)}},e.prototype.add=function(r){var i=r;if(!r)return e.EMPTY;switch(X(r)){case"function":i=new e(r);case"object":if(i===this||i.closed||typeof i.unsubscribe!="function")return i;if(this.closed)return i.unsubscribe(),i;i instanceof e||(r=i,(i=new e)._subscriptions=[r]);break;default:throw Error("unrecognized teardown "+r+" added to Subscription.")}if((r=i._parentOrParents)===null)i._parentOrParents=this;else if(r instanceof e){if(r===this)return i;i._parentOrParents=[r,this]}else{if(r.indexOf(this)!==-1)return i;r.push(this)}return(r=this._subscriptions)===null?this._subscriptions=[i]:r.push(i),i},e.prototype.remove=function(r){var i=this._subscriptions;i&&(r=i.indexOf(r))!==-1&&i.splice(r,1)},e.EMPTY=function(r){return r.closed=!0,r}(new e),e}(),Fh=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(e){function r(i,o,s){var l=e.call(this)||this;switch(l.syncErrorValue=null,l.syncErrorThrown=!1,l.syncErrorThrowable=!1,l.isStopped=!1,arguments.length){case 0:l.destination=Eh;break;case 1:if(!i){l.destination=Eh;break}if(X(i)==="object"){i instanceof r?(l.syncErrorThrowable=i.syncErrorThrowable,l.destination=i,i.add(l)):(l.syncErrorThrowable=!0,l.destination=new yq(l,i));break}default:l.syncErrorThrowable=!0,l.destination=new yq(l,i,o,s)}return l}return O(r,e),r.prototype[Fh]=function(){return this},r.create=function(i,o,s){return(i=new r(i,o,s)).syncErrorThrowable=!1,i},r.prototype.next=function(i){this.isStopped||this._next(i)},r.prototype.error=function(i){this.isStopped||(this.isStopped=!0,this._error(i))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},r.prototype._next=function(i){this.destination.next(i)},r.prototype._error=function(i){this.destination.error(i),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var i=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=i,this},r}(Oa),yq=function(e){function r(i,o,s,l){var d=e.call(this)||this;if(d._parentSubscriber=i,i=d,le(o))var h=o;else o&&(h=o.next,s=o.error,l=o.complete,o!==Eh&&(le((i=Object.create(o)).unsubscribe)&&d.add(i.unsubscribe.bind(i)),i.unsubscribe=d.unsubscribe.bind(d)));return d._context=i,d._next=h,d._error=s,d._complete=l,d}return O(r,e),r.prototype.next=function(i){if(!this.isStopped&&this._next){var o=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable?this.__tryOrSetError(o,this._next,i)&&this.unsubscribe():this.__tryOrUnsub(this._next,i)}},r.prototype.error=function(i){if(!this.isStopped){var o=this._parentSubscriber,s=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)s&&o.syncErrorThrowable?this.__tryOrSetError(o,this._error,i):this.__tryOrUnsub(this._error,i),this.unsubscribe();else if(o.syncErrorThrowable)s?(o.syncErrorValue=i,o.syncErrorThrown=!0):me(i),this.unsubscribe();else{if(this.unsubscribe(),s)throw i;me(i)}}},r.prototype.complete=function(){var i=this;if(!this.isStopped){var o=this._parentSubscriber;if(this._complete){var s=function(){return i._complete.call(i._context)};Ib.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable?this.__tryOrSetError(o,s):this.__tryOrUnsub(s)}this.unsubscribe()}},r.prototype.__tryOrUnsub=function(i,o){try{i.call(this._context,o)}catch(s){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw s;me(s)}},r.prototype.__tryOrSetError=function(i,o,s){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{o.call(this._context,s)}catch(l){return Ib.useDeprecatedSynchronousErrorHandling?(i.syncErrorValue=l,i.syncErrorThrown=!0):me(l),!0}return!1},r.prototype._unsubscribe=function(){var i=this._parentSubscriber;this._parentSubscriber=this._context=null,i.unsubscribe()},r}(ia),ne=typeof Symbol=="function"&&Symbol.observable||"@@observable",Y=function(){function e(r){this._isScalar=!1,r&&(this._subscribe=r)}return e.prototype.lift=function(r){var i=new e;return i.source=this,i.operator=r,i},e.prototype.subscribe=function(r,i,o){var s=this.operator;t:{if(r){if(r instanceof ia)break t;if(r[Fh]){r=r[Fh]();break t}}r=r||i||o?new ia(r,i,o):new ia(Eh)}if(s?r.add(s.call(r,this.source)):r.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),Ib.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},e.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(i){Ib.useDeprecatedSynchronousErrorHandling&&(r.syncErrorThrown=!0,r.syncErrorValue=i),fi(r)?r.error(i):console.warn(i)}},e.prototype.forEach=function(r,i){var o=this;return new(i=Zl(i))(function(s,l){var d=o.subscribe(function(h){try{r(h)}catch(p){l(p),d&&d.unsubscribe()}},l,s)})},e.prototype._subscribe=function(r){var i=this.source;return i&&i.subscribe(r)},e.prototype[ne]=function(){return this},e.prototype.pipe=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return r.length===0?this:Yl(r)(this)},e.prototype.toPromise=function(r){var i=this;return new(r=Zl(r))(function(o,s){var l;i.subscribe(function(d){return l=d},function(d){return s(d)},function(){return o(l)})})},e.create=function(r){return new e(r)},e}(),qd=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),zq=function(e){function r(i,o){var s=e.call(this)||this;return s.subject=i,s.subscriber=o,s.closed=!1,s}return O(r,e),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var i=this.subject,o=i.observers;this.subject=null,!o||o.length===0||i.isStopped||i.closed||(i=o.indexOf(this.subscriber))!==-1&&o.splice(i,1)}},r}(Oa),Aq=function(e){function r(i){var o=e.call(this,i)||this;return o.destination=i,o}return O(r,e),r}(ia),Pa=function(e){function r(){var i=e.call(this)||this;return i.observers=[],i.closed=!1,i.isStopped=!1,i.hasError=!1,i.thrownError=null,i}return O(r,e),r.prototype[Fh]=function(){return new Aq(this)},r.prototype.lift=function(i){var o=new Bq(this,this);return o.operator=i,o},r.prototype.next=function(i){if(this.closed)throw new qd;if(!this.isStopped){var o=this.observers,s=o.length;o=o.slice();for(var l=0;l<s;l++)o[l].next(i)}},r.prototype.error=function(i){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=i,this.isStopped=!0;var o=this.observers,s=o.length;o=o.slice();for(var l=0;l<s;l++)o[l].error(i);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var i=this.observers,o=i.length;i=i.slice();for(var s=0;s<o;s++)i[s].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},r.prototype._trySubscribe=function(i){if(this.closed)throw new qd;return e.prototype._trySubscribe.call(this,i)},r.prototype._subscribe=function(i){if(this.closed)throw new qd;return this.hasError?(i.error(this.thrownError),Oa.EMPTY):this.isStopped?(i.complete(),Oa.EMPTY):(this.observers.push(i),new zq(this,i))},r.prototype.asObservable=function(){var i=new Y;return i.source=this,i},r.create=function(i,o){return new Bq(i,o)},r}(Y),Bq=function(e){function r(i,o){var s=e.call(this)||this;return s.destination=i,s.source=o,s}return O(r,e),r.prototype.next=function(i){var o=this.destination;o&&o.next&&o.next(i)},r.prototype.error=function(i){var o=this.destination;o&&o.error&&this.destination.error(i)},r.prototype.complete=function(){var i=this.destination;i&&i.complete&&this.destination.complete()},r.prototype._subscribe=function(i){return this.source?this.source.subscribe(i):Oa.EMPTY},r}(Pa),Ns=function(){function e(r){this.connectable=r}return e.prototype.call=function(r,i){var o=this.connectable;return o._refCount++,r=new cz(r,o),i=i.subscribe(r),r.closed||(r.connection=o.connect()),i},e}(),cz=function(e){function r(i,o){return(i=e.call(this,i)||this).connectable=o,i}return O(r,e),r.prototype._unsubscribe=function(){var i=this.connectable;if(i){this.connectable=null;var o=i._refCount;0>=o?this.connection=null:(i._refCount=o-1,1<o?this.connection=null:(o=this.connection,i=i._connection,this.connection=null,!i||o&&i!==o||i.unsubscribe()))}else this.connection=null},r}(ia),Cq=function(e){function r(i,o){var s=e.call(this)||this;return s.source=i,s.subjectFactory=o,s._refCount=0,s._isComplete=!1,s}return O(r,e),r.prototype._subscribe=function(i){return this.getSubject().subscribe(i)},r.prototype.getSubject=function(){var i=this._subject;return i&&!i.isStopped||(this._subject=this.subjectFactory()),this._subject},r.prototype.connect=function(){var i=this._connection;return i||(this._isComplete=!1,(i=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),i.closed&&(this._connection=null,i=Oa.EMPTY)),i},r.prototype.refCount=function(){return $l()(this)},r}(Y),At=function(){var e=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),dz=function(e){function r(i,o){return(i=e.call(this,i)||this).connectable=o,i}return O(r,e),r.prototype._error=function(i){this._unsubscribe(),e.prototype._error.call(this,i)},r.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){var i=this.connectable;if(i){this.connectable=null;var o=i._connection;i._refCount=0,i._subject=null,i._connection=null,o&&o.unsubscribe()}},r}(Aq);(function(e){function r(i,o){return(i=e.call(this,i)||this).connectable=o,i}O(r,e),r.prototype._unsubscribe=function(){var i=this.connectable;if(i){this.connectable=null;var o=i._refCount;0>=o?this.connection=null:(i._refCount=o-1,1<o?this.connection=null:(o=this.connection,i=i._connection,this.connection=null,!i||o&&i!==o||i.unsubscribe()))}else this.connection=null}})(ia),function(e){function r(i,o,s,l,d){return(i=e.call(this,i)||this).keySelector=o,i.elementSelector=s,i.durationSelector=l,i.subjectSelector=d,i.groups=null,i.attemptedToUnsubscribe=!1,i.count=0,i}O(r,e),r.prototype._next=function(i){try{var o=this.keySelector(i)}catch(s){return void this.error(s)}this._group(i,o)},r.prototype._group=function(i,o){var s=this.groups;s||(s=this.groups=new Map);var l=s.get(o);if(this.elementSelector)try{var d=this.elementSelector(i)}catch(h){this.error(h)}else d=i;if(!l&&(l=this.subjectSelector?this.subjectSelector():new Pa,s.set(o,l),i=new Mk(o,l,this),this.destination.next(i),this.durationSelector)){i=void 0;try{i=this.durationSelector(new Mk(o,l))}catch(h){return void this.error(h)}this.add(i.subscribe(new ez(o,l,this)))}l.closed||l.next(d)},r.prototype._error=function(i){var o=this.groups;o&&(o.forEach(function(s,l){s.error(i)}),o.clear()),this.destination.error(i)},r.prototype._complete=function(){var i=this.groups;i&&(i.forEach(function(o,s){o.complete()}),i.clear()),this.destination.complete()},r.prototype.removeGroup=function(i){this.groups.delete(i)},r.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&e.prototype.unsubscribe.call(this))}}(ia);var ez=function(e){function r(i,o,s){var l=e.call(this,o)||this;return l.key=i,l.group=o,l.parent=s,l}return O(r,e),r.prototype._next=function(i){this.complete()},r.prototype._unsubscribe=function(){var i=this.parent,o=this.key;this.key=this.parent=null,i&&i.removeGroup(o)},r}(ia),Mk=function(e){function r(i,o,s){var l=e.call(this)||this;return l.key=i,l.groupSubject=o,l.refCountSubscription=s,l}return O(r,e),r.prototype._subscribe=function(i){var o=new Oa,s=this.refCountSubscription,l=this.groupSubject;return s&&!s.closed&&o.add(new fz(s)),o.add(l.subscribe(i)),o},r}(Y),fz=function(e){function r(i){var o=e.call(this)||this;return o.parent=i,i.count++,o}return O(r,e),r.prototype.unsubscribe=function(){var i=this.parent;i.closed||this.closed||(e.prototype.unsubscribe.call(this),--i.count,i.count===0&&i.attemptedToUnsubscribe&&i.unsubscribe())},r}(Oa),gz=function(e){function r(i){var o=e.call(this)||this;return o._value=i,o}return O(r,e),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(i){var o=e.prototype._subscribe.call(this,i);return o&&!o.closed&&i.next(this._value),o},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},r.prototype.next=function(i){e.prototype.next.call(this,this._value=i)},r}(Pa),dg=function(e){function r(i,o){var s=e.call(this,i,o)||this;return s.scheduler=i,s.work=o,s.pending=!1,s}return O(r,e),r.prototype.schedule=function(i,o){if(o===void 0&&(o=0),this.closed)return this;this.state=i,i=this.id;var s=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(s,i,o)),this.pending=!0,this.delay=o,this.id=this.id||this.requestAsyncId(s,this.id,o),this},r.prototype.requestAsyncId=function(i,o,s){return s===void 0&&(s=0),setInterval(i.flush.bind(i,this),s)},r.prototype.recycleAsyncId=function(i,o,s){if(s===void 0&&(s=0),s!==null&&this.delay===s&&this.pending===!1)return o;clearInterval(o)},r.prototype.execute=function(i,o){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(i=this._execute(i,o))?i:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},r.prototype._execute=function(i,o){o=!1;var s=void 0;try{this.work(i)}catch(l){o=!0,s=!!l&&l||Error(l)}if(o)return this.unsubscribe(),s},r.prototype._unsubscribe=function(){var i=this.id,o=this.scheduler,s=o.actions,l=s.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,l!==-1&&s.splice(l,1),i!=null&&(this.id=this.recycleAsyncId(o,i,null)),this.delay=null},r}(function(e){function r(i,o){return e.call(this)||this}return O(r,e),r.prototype.schedule=function(i,o){return this},r}(Oa)),hz=function(e){function r(i,o){var s=e.call(this,i,o)||this;return s.scheduler=i,s.work=o,s}return O(r,e),r.prototype.schedule=function(i,o){return o===void 0&&(o=0),0<o?e.prototype.schedule.call(this,i,o):(this.delay=o,this.state=i,this.scheduler.flush(this),this)},r.prototype.execute=function(i,o){return 0<o||this.closed?e.prototype.execute.call(this,i,o):this._execute(i,o)},r.prototype.requestAsyncId=function(i,o,s){return s===void 0&&(s=0),s!==null&&0<s||s===null&&0<this.delay?e.prototype.requestAsyncId.call(this,i,o,s):i.flush(this)},r}(dg),Nk=function(){function e(r,i){i===void 0&&(i=e.now),this.SchedulerAction=r,this.now=i}return e.prototype.schedule=function(r,i,o){return i===void 0&&(i=0),new this.SchedulerAction(this,r).schedule(o,i)},e.now=function(){return Date.now()},e}(),eg=function(e){function r(i,o){o===void 0&&(o=Nk.now);var s=e.call(this,i,function(){return r.delegate&&r.delegate!==s?r.delegate.now():o()})||this;return s.actions=[],s.active=!1,s.scheduled=void 0,s}return O(r,e),r.prototype.schedule=function(i,o,s){return o===void 0&&(o=0),r.delegate&&r.delegate!==this?r.delegate.schedule(i,o,s):e.prototype.schedule.call(this,i,o,s)},r.prototype.flush=function(i){var o=this.actions;if(this.active)o.push(i);else{var s;this.active=!0;do if(s=i.execute(i.state,i.delay))break;while(i=o.shift());if(this.active=!1,s){for(;i=o.shift();)i.unsubscribe();throw s}}},r}(Nk),fg=new(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r}(eg))(hz),vb=new Y(function(e){return e.complete()}),am=function(e){return function(r){for(var i=0,o=e.length;i<o&&!r.closed;i++)r.next(e[i]);r.complete()}},Ok;(function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"})(Ok||(Ok={}));var Ve=function(){function e(r,i,o){this.kind=r,this.value=i,this.error=o,this.hasValue=r==="N"}return e.prototype.observe=function(r){switch(this.kind){case"N":return r.next&&r.next(this.value);case"E":return r.error&&r.error(this.error);case"C":return r.complete&&r.complete()}},e.prototype.do=function(r,i,o){switch(this.kind){case"N":return r&&r(this.value);case"E":return i&&i(this.error);case"C":return o&&o()}},e.prototype.accept=function(r,i,o){return r&&typeof r.next=="function"?this.observe(r):this.do(r,i,o)},e.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},e.createNext=function(r){return r!==void 0?new e("N",r):e.undefinedValueNotification},e.createError=function(r){return new e("E",void 0,r)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Rs=function(){function e(r,i){i===void 0&&(i=0),this.scheduler=r,this.delay=i}return e.prototype.call=function(r,i){return i.subscribe(new Dq(r,this.scheduler,this.delay))},e}(),Dq=function(e){function r(i,o,s){return s===void 0&&(s=0),(i=e.call(this,i)||this).scheduler=o,i.delay=s,i}return O(r,e),r.dispatch=function(i){i.notification.observe(i.destination),this.unsubscribe()},r.prototype.scheduleMessage=function(i){this.destination.add(this.scheduler.schedule(r.dispatch,this.delay,new iz(i,this.destination)))},r.prototype._next=function(i){this.scheduleMessage(Ve.createNext(i))},r.prototype._error=function(i){this.scheduleMessage(Ve.createError(i)),this.unsubscribe()},r.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},r}(ia),iz=function(e,r){this.notification=e,this.destination=r},qe=function(e){function r(i,o,s){i===void 0&&(i=Number.POSITIVE_INFINITY),o===void 0&&(o=Number.POSITIVE_INFINITY);var l=e.call(this)||this;return l.scheduler=s,l._events=[],l._infiniteTimeWindow=!1,l._bufferSize=1>i?1:i,l._windowTime=1>o?1:o,o===Number.POSITIVE_INFINITY?(l._infiniteTimeWindow=!0,l.next=l.nextInfiniteTimeWindow):l.next=l.nextTimeWindow,l}return O(r,e),r.prototype.nextInfiniteTimeWindow=function(i){if(!this.isStopped){var o=this._events;o.push(i),o.length>this._bufferSize&&o.shift()}e.prototype.next.call(this,i)},r.prototype.nextTimeWindow=function(i){this.isStopped||(this._events.push(new jz(this._getNow(),i)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,i)},r.prototype._subscribe=function(i){var o=this._infiniteTimeWindow,s=o?this._events:this._trimBufferThenGetEvents(),l=this.scheduler,d=s.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var h=Oa.EMPTY;else this.observers.push(i),h=new zq(this,i);if(l&&i.add(i=new Dq(i,l)),o)for(o=0;o<d&&!i.closed;o++)i.next(s[o]);else for(o=0;o<d&&!i.closed;o++)i.next(s[o].value);return this.hasError?i.error(this.thrownError):this.isStopped&&i.complete(),h},r.prototype._getNow=function(){return(this.scheduler||fg).now()},r.prototype._trimBufferThenGetEvents=function(){for(var i=this._getNow(),o=this._bufferSize,s=this._windowTime,l=this._events,d=l.length,h=0;h<d&&!(i-l[h].time<s);)h++;return d>o&&(h=Math.max(h,d-o)),0<h&&l.splice(0,h),l},r}(Pa),jz=function(e,r){this.time=e,this.value=r},of=function(e){function r(){var i=e!==null&&e.apply(this,arguments)||this;return i.value=null,i.hasNext=!1,i.hasCompleted=!1,i}return O(r,e),r.prototype._subscribe=function(i){return this.hasError?(i.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(i.next(this.value),i.complete(),Oa.EMPTY):e.prototype._subscribe.call(this,i)},r.prototype.next=function(i){this.hasCompleted||(this.value=i,this.hasNext=!0)},r.prototype.error=function(i){this.hasCompleted||e.prototype.error.call(this,i)},r.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},r}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(e){var r=kz++;return ii[r]=!0,lz.then(function(){return bm(r)&&e()}),r},clearImmediate:function(e){bm(e)}},mz=function(e){function r(i,o){var s=e.call(this,i,o)||this;return s.scheduler=i,s.work=o,s}return O(r,e),r.prototype.requestAsyncId=function(i,o,s){return s===void 0&&(s=0),s!==null&&0<s?e.prototype.requestAsyncId.call(this,i,o,s):(i.actions.push(this),i.scheduled||(i.scheduled=Eq.setImmediate(i.flush.bind(i,null))))},r.prototype.recycleAsyncId=function(i,o,s){if(s===void 0&&(s=0),s!==null&&0<s||s===null&&0<this.delay)return e.prototype.recycleAsyncId.call(this,i,o,s);i.actions.length===0&&(Eq.clearImmediate(o),i.scheduled=void 0)},r}(dg),ri=new(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.flush=function(i){this.active=!0,this.scheduled=void 0;var o,s=this.actions,l=-1,d=s.length;i=i||s.shift();do if(o=i.execute(i.state,i.delay))break;while(++l<d&&(i=s.shift()));if(this.active=!1,o){for(;++l<d&&(i=s.shift());)i.unsubscribe();throw o}},r}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(e){function r(i,o){var s=e.call(this,i,o)||this;return s.scheduler=i,s.work=o,s}return O(r,e),r.prototype.requestAsyncId=function(i,o,s){return s===void 0&&(s=0),s!==null&&0<s?e.prototype.requestAsyncId.call(this,i,o,s):(i.actions.push(this),i.scheduled||(i.scheduled=requestAnimationFrame(function(){return i.flush(null)})))},r.prototype.recycleAsyncId=function(i,o,s){if(s===void 0&&(s=0),s!==null&&0<s||s===null&&0<this.delay)return e.prototype.recycleAsyncId.call(this,i,o,s);i.actions.length===0&&(cancelAnimationFrame(o),i.scheduled=void 0)},r}(dg),Fq=new(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.flush=function(i){this.active=!0,this.scheduled=void 0;var o,s=this.actions,l=-1,d=s.length;i=i||s.shift();do if(o=i.execute(i.state,i.delay))break;while(++l<d&&(i=s.shift()));if(this.active=!1,o){for(;++l<d&&(i=s.shift());)i.unsubscribe();throw o}},r}(eg))(oz),pz=function(e){function r(i,o){i===void 0&&(i=Gq),o===void 0&&(o=Number.POSITIVE_INFINITY);var s=e.call(this,i,function(){return s.frame})||this;return s.maxFrames=o,s.frame=0,s.index=-1,s}return O(r,e),r.prototype.flush=function(){for(var i,o,s=this.actions,l=this.maxFrames;(o=s[0])&&o.delay<=l&&(s.shift(),this.frame=o.delay,!(i=o.execute(o.state,o.delay))););if(i){for(;o=s.shift();)o.unsubscribe();throw i}},r.frameTimeFactor=10,r}(eg),Gq=function(e){function r(i,o,s){s===void 0&&(s=i.index+=1);var l=e.call(this,i,o)||this;return l.scheduler=i,l.work=o,l.index=s,l.active=!0,l.index=i.index=s,l}return O(r,e),r.prototype.schedule=function(i,o){if(o===void 0&&(o=0),!this.id)return e.prototype.schedule.call(this,i,o);this.active=!1;var s=new r(this.scheduler,this.work);return this.add(s),s.schedule(i,o)},r.prototype.requestAsyncId=function(i,o,s){return s===void 0&&(s=0),this.delay=i.frame+s,(i=i.actions).push(this),i.sort(r.sortActions),!0},r.prototype.recycleAsyncId=function(i,o,s){},r.prototype._execute=function(i,o){if(this.active===!0)return e.prototype._execute.call(this,i,o)},r.sortActions=function(i,o){return i.delay===o.delay?i.index===o.index?0:i.index>o.index?1:-1:i.delay>o.delay?1:-1},r}(dg),Qk=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),vg=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),pb=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),Ss=function(){function e(r,i){this.project=r,this.thisArg=i}return e.prototype.call=function(r,i){return i.subscribe(new qz(r,this.project,this.thisArg))},e}(),qz=function(e){function r(i,o,s){return(i=e.call(this,i)||this).project=o,i.count=0,i.thisArg=s||i,i}return O(r,e),r.prototype._next=function(i){try{var o=this.project.call(this.thisArg,i,this.count++)}catch(s){return void this.destination.error(s)}this.destination.next(o)},r}(ia),Rk=function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.notifyNext=function(i,o,s,l,d){this.destination.next(o)},r.prototype.notifyError=function(i,o){this.destination.error(i)},r.prototype.notifyComplete=function(i){this.destination.complete()},r}(ia),Xs=function(e){function r(i,o,s){var l=e.call(this)||this;return l.parent=i,l.outerValue=o,l.outerIndex=s,l.index=0,l}return O(r,e),r.prototype._next=function(i){this.parent.notifyNext(this.outerValue,i,this.outerIndex,this.index++,this)},r.prototype._error=function(i){this.parent.notifyError(i,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(ia),rz=function(e){return function(r){return e.then(function(i){r.closed||(r.next(i),r.complete())},function(i){return r.error(i)}).then(null,me),r}},$c=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(e){return function(r){for(var i=e[$c]();;){var o=void 0;try{o=i.next()}catch(s){return r.error(s),r}if(o.done){r.complete();break}if(r.next(o.value),r.closed)break}return typeof i.return=="function"&&r.add(function(){i.return&&i.return()}),r}},tz=function(e){return function(r){var i=e[ne]();if(typeof i.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return i.subscribe(r)}},hm=function(e){return e&&typeof e.length=="number"&&typeof e!="function"},pf=function(e){if(e&&typeof e[ne]=="function")return tz(e);if(hm(e))return am(e);if(fm(e))return rz(e);if(e&&typeof e[$c]=="function")return sz(e);throw e=ei(e)?"an invalid object":"'"+e+"'",new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function e(r){this.resultSelector=r}return e.prototype.call=function(r,i){return i.subscribe(new uz(r,this.resultSelector))},e}(),uz=function(e){function r(i,o){return(i=e.call(this,i)||this).resultSelector=o,i.active=0,i.values=[],i.observables=[],i}return O(r,e),r.prototype._next=function(i){this.values.push(Hq),this.observables.push(i)},r.prototype._complete=function(){var i=this.observables,o=i.length;if(o===0)this.destination.complete();else{this.toRespond=this.active=o;for(var s=0;s<o;s++)this.add(ji(this,i[s],void 0,s))}},r.prototype.notifyComplete=function(i){--this.active==0&&this.destination.complete()},r.prototype.notifyNext=function(i,o,s){var l=(i=this.values)[s];l=this.toRespond?l===Hq?--this.toRespond:this.toRespond:0,i[s]=o,l===0&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))},r.prototype._tryResultSelector=function(i){try{var o=this.resultSelector.apply(this,i)}catch(s){return void this.destination.error(s)}this.destination.next(o)},r}(Rk),vc=function(e){function r(i){var o=e.call(this)||this;return o.parent=i,o}return O(r,e),r.prototype._next=function(i){this.parent.notifyNext(i)},r.prototype._error=function(i){this.parent.notifyError(i),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(ia);(function(e){function r(i,o,s){var l=e.call(this)||this;return l.parent=i,l.outerValue=o,l.outerIndex=s,l}O(r,e),r.prototype._next=function(i){this.parent.notifyNext(this.outerValue,i,this.outerIndex,this)},r.prototype._error=function(i){this.parent.notifyError(i),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(ia);var wc=function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.notifyNext=function(i){this.destination.next(i)},r.prototype.notifyError=function(i){this.destination.error(i)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(ia);(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}O(r,e),r.prototype.notifyNext=function(i,o,s,l){this.destination.next(o)},r.prototype.notifyError=function(i){this.destination.error(i)},r.prototype.notifyComplete=function(i){this.destination.complete()}})(ia);var at=function(){function e(r,i){i===void 0&&(i=Number.POSITIVE_INFINITY),this.project=r,this.concurrent=i}return e.prototype.call=function(r,i){return i.subscribe(new wz(r,this.project,this.concurrent))},e}(),wz=function(e){function r(i,o,s){return s===void 0&&(s=Number.POSITIVE_INFINITY),(i=e.call(this,i)||this).project=o,i.concurrent=s,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return O(r,e),r.prototype._next=function(i){this.active<this.concurrent?this._tryNext(i):this.buffer.push(i)},r.prototype._tryNext=function(i){var o=this.index++;try{var s=this.project(i,o)}catch(l){return void this.destination.error(l)}this.active++,this._innerSub(s)},r.prototype._innerSub=function(i){var o=new vc(this),s=this.destination;s.add(o),(i=ic(i,o))!==o&&s.add(i)},r.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},r.prototype.notifyNext=function(i){this.destination.next(i)},r.prototype.notifyComplete=function(){var i=this.buffer;this.active--,0<i.length?this._next(i.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},r}(wc),Sk=y.parseFloat,Iq=1/Sk(`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF-0`)!=-1/0?function(e){e=ik(String(e));var r=Sk(e);return r===0&&e.charAt(0)=="-"?-0:r}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function e(r,i){this.predicate=r,this.thisArg=i}return e.prototype.call=function(r,i){return i.subscribe(new xz(r,this.predicate,this.thisArg))},e}(),xz=function(e){function r(i,o,s){return(i=e.call(this,i)||this).predicate=o,i.thisArg=s,i.count=0,i}return O(r,e),r.prototype._next=function(i){try{var o=this.predicate.call(this.thisArg,i,this.count++)}catch(s){return void this.destination.error(s)}o&&this.destination.next(i)},r}(ia),gt=function(){function e(){}return e.prototype.call=function(r,i){return i.subscribe(new yz(r))},e}(),yz=function(e){function r(i){return(i=e.call(this,i)||this).hasFirst=!1,i.observables=[],i.subscriptions=[],i}return O(r,e),r.prototype._next=function(i){this.observables.push(i)},r.prototype._complete=function(){var i=this.observables,o=i.length;if(o===0)this.destination.complete();else{for(var s=0;s<o&&!this.hasFirst;s++){var l=ji(this,i[s],void 0,s);this.subscriptions&&this.subscriptions.push(l),this.add(l)}this.observables=null}},r.prototype.notifyNext=function(i,o,s){if(!this.hasFirst){for(this.hasFirst=!0,i=0;i<this.subscriptions.length;i++)if(i!==s){var l=this.subscriptions[i];l.unsubscribe(),this.remove(l)}this.subscriptions=null}this.destination.next(o)},r}(Rk),jt=function(){function e(r){this.resultSelector=r}return e.prototype.call=function(r,i){return i.subscribe(new zz(r,this.resultSelector))},e}(),zz=function(e){function r(i,o,s){return(i=e.call(this,i)||this).resultSelector=o,i.iterators=[],i.active=0,i.resultSelector=typeof o=="function"?o:void 0,i}return O(r,e),r.prototype._next=function(i){var o=this.iterators;Jb(i)?o.push(new Az(i)):typeof i[$c]=="function"?o.push(new Bz(i[$c]())):o.push(new Cz(this.destination,this,i))},r.prototype._complete=function(){var i=this.iterators,o=i.length;if(this.unsubscribe(),o===0)this.destination.complete();else{this.active=o;for(var s=0;s<o;s++){var l=i[s];l.stillUnsubscribed?this.destination.add(l.subscribe()):this.active--}}},r.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},r.prototype.checkIterators=function(){for(var i=this.iterators,o=i.length,s=this.destination,l=0;l<o;l++){var d=i[l];if(typeof d.hasValue=="function"&&!d.hasValue())return}var h=!1,p=[];for(l=0;l<o;l++){var f=(d=i[l]).next();if(d.hasCompleted()&&(h=!0),f.done)return void s.complete();p.push(f.value)}this.resultSelector?this._tryresultSelector(p):s.next(p),h&&s.complete()},r.prototype._tryresultSelector=function(i){try{var o=this.resultSelector.apply(this,i)}catch(s){return void this.destination.error(s)}this.destination.next(o)},r}(ia),Bz=function(){function e(r){this.iterator=r,this.nextResult=r.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var r=this.nextResult;return this.nextResult=this.iterator.next(),r},e.prototype.hasCompleted=function(){var r=this.nextResult;return!(!r||!r.done)},e}(),Az=function(){function e(r){this.array=r,this.length=this.index=0,this.length=r.length}return e.prototype[$c]=function(){return this},e.prototype.next=function(r){r=this.index++;var i=this.array;return r<this.length?{value:i[r],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),Cz=function(e){function r(i,o,s){return(i=e.call(this,i)||this).parent=o,i.observable=s,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return O(r,e),r.prototype[$c]=function(){return this},r.prototype.next=function(){var i=this.buffer;return i.length===0&&this.isComplete?{value:null,done:!0}:{value:i.shift(),done:!1}},r.prototype.hasValue=function(){return 0<this.buffer.length},r.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},r.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},r.prototype.notifyNext=function(i){this.buffer.push(i),this.parent.checkIterators()},r.prototype.subscribe=function(){return ic(this.observable,new vc(this))},r}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(e){return!!e&&(e instanceof Y||typeof e.lift=="function"&&typeof e.subscribe=="function")},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=r=void 0;return Zc(e[e.length-1])&&(i=e.pop()),typeof e[e.length-1]=="function"&&(r=e.pop()),e.length===1&&Jb(e[0])&&(e=e[0]),nf(e,i).lift(new vz(r))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(e,r,i,o,s){if(arguments.length==1){var l=e.initialState;r=e.condition,i=e.iterate;var d=e.resultSelector||Yc;s=e.scheduler}else o===void 0||Zc(o)?(l=e,d=Yc,s=o):(l=e,d=o);return new Y(function(h){var p=l;if(s)return s.schedule(bt,0,{subscriber:h,iterate:i,condition:r,resultSelector:d,state:p});for(;;){if(r){var f=void 0;try{f=r(p)}catch(_){h.error(_);break}if(!f){h.complete();break}}f=void 0;try{f=d(p)}catch(_){h.error(_);break}if(h.next(f),h.closed)break;try{p=i(p)}catch(_){h.error(_);break}}})},iif:function(e,r,i){return r===void 0&&(r=vb),i===void 0&&(i=vb),ad(function(){return e()?r:i})},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(e,r){return new Y(r?function(i){var o=Object.keys(e),s=new Oa;return s.add(r.schedule(dt,0,{keys:o,index:0,subscriber:i,subscription:s,obj:e})),s}:function(i){for(var o=Object.keys(e),s=0;s<o.length&&!i.closed;s++){var l=o[s];e.hasOwnProperty(l)&&i.next([l,e[l]])}i.complete()})},partition:function(e,r,i){return[wb(r,i)(new Y(pf(e))),wb(et(r,i))(new Y(pf(e)))]},race:Ca,range:function(e,r,i){return e===void 0&&(e=0),new Y(function(o){r===void 0&&(r=e,e=0);var s=0,l=e;if(i)return i.schedule(ht,0,{index:s,count:r,start:e,subscriber:o});for(;;){if(s++>=r){o.complete();break}if(o.next(l++),o.closed)break}})},throwError:Z,timer:Bc,using:function(e,r){return new Y(function(i){try{var o=e()}catch(d){return void i.error(d)}try{var s=r(o)}catch(d){return void i.error(d)}var l=(s?Kb(s):vb).subscribe(i);return function(){l.unsubscribe(),o&&o.unsubscribe()}})},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function e(r){this.selector=r}return e.prototype.call=function(r,i){return i.subscribe(new Ez(r,this.selector,this.caught))},e}(),Ez=function(e){function r(i,o,s){return(i=e.call(this,i)||this).selector=o,i.caught=s,i}return O(r,e),r.prototype.error=function(i){if(!this.isStopped){var o=void 0;try{o=this.selector(i,this.caught)}catch(s){return void e.prototype.error.call(this,s)}this._unsubscribeAndRecycle(),i=new vc(this),this.add(i),(o=ic(o,i))!==i&&this.add(o)}},r}(wc),lt=function(){function e(r){this.defaultValue=r}return e.prototype.call=function(r,i){return i.subscribe(new Fz(r,this.defaultValue))},e}(),Fz=function(e){function r(i,o){return(i=e.call(this,i)||this).defaultValue=o,i.isEmpty=!0,i}return O(r,e),r.prototype._next=function(i){this.isEmpty=!1,this.destination.next(i)},r.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},r}(ia),mt=function(){function e(r,i){this.delay=r,this.scheduler=i}return e.prototype.call=function(r,i){return i.subscribe(new Gz(r,this.delay,this.scheduler))},e}(),Gz=function(e){function r(i,o,s){return(i=e.call(this,i)||this).delay=o,i.scheduler=s,i.queue=[],i.active=!1,i.errored=!1,i}return O(r,e),r.dispatch=function(i){for(var o=i.source,s=o.queue,l=i.scheduler,d=i.destination;0<s.length&&0>=s[0].time-l.now();)s.shift().notification.observe(d);0<s.length?(o=Math.max(0,s[0].time-l.now()),this.schedule(i,o)):(this.unsubscribe(),o.active=!1)},r.prototype._schedule=function(i){this.active=!0,this.destination.add(i.schedule(r.dispatch,this.delay,{source:this,destination:this.destination,scheduler:i}))},r.prototype.scheduleNotification=function(i){if(this.errored!==!0){var o=this.scheduler;i=new Hz(o.now()+this.delay,i),this.queue.push(i),this.active===!1&&this._schedule(o)}},r.prototype._next=function(i){this.scheduleNotification(Ve.createNext(i))},r.prototype._error=function(i){this.errored=!0,this.queue=[],this.destination.error(i),this.unsubscribe()},r.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},r}(ia),Hz=function(e,r){this.time=e,this.notification=r},nt=function(){function e(r,i){this.keySelector=r,this.flushes=i}return e.prototype.call=function(r,i){return i.subscribe(new Iz(r,this.keySelector,this.flushes))},e}(),Iz=function(e){function r(i,o,s){return(i=e.call(this,i)||this).keySelector=o,i.values=new Set,s&&i.add(ic(s,new vc(i))),i}return O(r,e),r.prototype.notifyNext=function(){this.values.clear()},r.prototype.notifyError=function(i){this._error(i)},r.prototype._next=function(i){this.keySelector?this._useKeySelector(i):this._finalizeNext(i,i)},r.prototype._useKeySelector=function(i){var o=this.destination;try{var s=this.keySelector(i)}catch(l){return void o.error(l)}this._finalizeNext(s,i)},r.prototype._finalizeNext=function(i,o){var s=this.values;s.has(i)||(s.add(i),this.destination.next(o))},r}(wc),pt=function(){function e(r){this.errorFactory=r}return e.prototype.call=function(r,i){return i.subscribe(new Jz(r,this.errorFactory))},e}(),Jz=function(e){function r(i,o){return(i=e.call(this,i)||this).errorFactory=o,i.hasValue=!1,i}return O(r,e),r.prototype._next=function(i){this.hasValue=!0,this.destination.next(i)},r.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var i=void 0;try{i=this.errorFactory()}catch(o){i=o}this.destination.error(i)},r}(ia),qt=function(){function e(r){if(this.total=r,0>this.total)throw new Qk}return e.prototype.call=function(r,i){return i.subscribe(new Kz(r,this.total))},e}(),Kz=function(e){function r(i,o){return(i=e.call(this,i)||this).total=o,i.count=0,i}return O(r,e),r.prototype._next=function(i){var o=this.total,s=++this.count;s<=o&&(this.destination.next(i),s===o&&(this.destination.complete(),this.unsubscribe()))},r}(ia),rt=function(){function e(r){this.project=r}return e.prototype.call=function(r,i){return i.subscribe(new Lz(r,this.project))},e}(),Lz=function(e){function r(i,o){return(i=e.call(this,i)||this).project=o,i.hasSubscription=!1,i.hasCompleted=!1,i.index=0,i}return O(r,e),r.prototype._next=function(i){this.hasSubscription||this.tryNext(i)},r.prototype.tryNext=function(i){var o=this.index++;try{var s=this.project(i,o)}catch(l){return void this.destination.error(l)}this.hasSubscription=!0,this._innerSub(s)},r.prototype._innerSub=function(i){var o=new vc(this),s=this.destination;s.add(o),(i=ic(i,o))!==o&&s.add(i)},r.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},r.prototype.notifyNext=function(i){this.destination.next(i)},r.prototype.notifyError=function(i){this.destination.error(i)},r.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},r}(wc),st=function(){function e(r){this.callback=r}return e.prototype.call=function(r,i){return i.subscribe(new Mz(r,this.callback))},e}(),Mz=function(e){function r(i,o){return(i=e.call(this,i)||this).add(new Oa(o)),i}return O(r,e),r}(ia),ut=function(){function e(){}return e.prototype.call=function(r,i){return i.subscribe(new Nz(r))},e}(),Nz=function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype._next=function(i){},r}(ia),vt=function(){function e(r){if(this.total=r,0>this.total)throw new Qk}return e.prototype.call=function(r,i){return i.subscribe(new Oz(r,this.total))},e}(),Oz=function(e){function r(i,o){return(i=e.call(this,i)||this).total=o,i.ring=[],i.count=0,i}return O(r,e),r.prototype._next=function(i){var o=this.ring,s=this.total,l=this.count++;o.length<s?o.push(i):o[l%s]=i},r.prototype._complete=function(){var i=this.destination,o=this.count;if(0<o)for(var s=this.count>=this.total?this.total:this.count,l=this.ring,d=0;d<s;d++){var h=o++%s;i.next(l[h])}i.complete()},r}(ia),wt=function(){function e(r){this.value=r}return e.prototype.call=function(r,i){return i.subscribe(new Pz(r,this.value))},e}(),Pz=function(e){function r(i,o){return(i=e.call(this,i)||this).value=o,i}return O(r,e),r.prototype._next=function(i){this.destination.next(this.value)},r}(ia),xt=function(){function e(r,i,o){o===void 0&&(o=!1),this.accumulator=r,this.seed=i,this.hasSeed=o}return e.prototype.call=function(r,i){return i.subscribe(new Qz(r,this.accumulator,this.seed,this.hasSeed))},e}(),Qz=function(e){function r(i,o,s,l){return(i=e.call(this,i)||this).accumulator=o,i._seed=s,i.hasSeed=l,i.index=0,i}return O(r,e),Object.defineProperty(r.prototype,"seed",{get:function(){return this._seed},set:function(i){this.hasSeed=!0,this._seed=i},enumerable:!0,configurable:!0}),r.prototype._next=function(i){if(this.hasSeed)return this._tryNext(i);this.seed=i,this.destination.next(i)},r.prototype._tryNext=function(i){var o=this.index++;try{var s=this.accumulator(this.seed,i,o)}catch(l){this.destination.error(l)}this.seed=s,this.destination.next(s)},r}(ia),zt=function(){function e(r,i){this.subjectFactory=r,this.selector=i}return e.prototype.call=function(r,i){var o=this.selector,s=this.subjectFactory();return(r=o(s).subscribe(r)).add(i.subscribe(s)),r},e}(),Bt=function(){function e(r,i){this.notifier=r,this.source=i}return e.prototype.call=function(r,i){return i.subscribe(new Rz(r,this.notifier,this.source))},e}(),Rz=function(e){function r(i,o,s){return(i=e.call(this,i)||this).notifier=o,i.source=s,i}return O(r,e),r.prototype.error=function(i){if(!this.isStopped){var o=this.errors,s=this.retries,l=this.retriesSubscription;if(s)this.retriesSubscription=this.errors=void 0;else{o=new Pa;try{s=(0,this.notifier)(o)}catch(d){return e.prototype.error.call(this,d)}l=ic(s,new vc(this))}this._unsubscribeAndRecycle(),this.errors=o,this.retries=s,this.retriesSubscription=l,o.next(i)}},r.prototype._unsubscribe=function(){var i=this.errors,o=this.retriesSubscription;i&&(i.unsubscribe(),this.errors=void 0),o&&(o.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},r.prototype.notifyNext=function(){var i=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=i,this.source.subscribe(this)},r}(wc),Et=function(){function e(r){this.project=r}return e.prototype.call=function(r,i){return i.subscribe(new Sz(r,this.project))},e}(),Sz=function(e){function r(i,o){return(i=e.call(this,i)||this).project=o,i.index=0,i}return O(r,e),r.prototype._next=function(i){var o=this.index++;try{var s=this.project(i,o)}catch(l){return void this.destination.error(l)}this._innerSub(s)},r.prototype._innerSub=function(i){var o=this.innerSubscription;o&&o.unsubscribe(),o=new vc(this);var s=this.destination;s.add(o),this.innerSubscription=ic(i,o),this.innerSubscription!==o&&s.add(this.innerSubscription)},r.prototype._complete=function(){var i=this.innerSubscription;i&&!i.closed||e.prototype._complete.call(this),this.unsubscribe()},r.prototype._unsubscribe=function(){this.innerSubscription=void 0},r.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},r.prototype.notifyNext=function(i){this.destination.next(i)},r}(wc),Ft=function(){function e(r){this.notifier=r}return e.prototype.call=function(r,i){r=new Tz(r);var o=ic(this.notifier,new vc(r));return o&&!r.seenValue?(r.add(o),i.subscribe(r)):r},e}(),Tz=function(e){function r(i){return(i=e.call(this,i)||this).seenValue=!1,i}return O(r,e),r.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},r.prototype.notifyComplete=function(){},r}(wc),Ht=function(){function e(r,i){this.predicate=r,this.inclusive=i}return e.prototype.call=function(r,i){return i.subscribe(new Uz(r,this.predicate,this.inclusive))},e}(),Uz=function(e){function r(i,o,s){return(i=e.call(this,i)||this).predicate=o,i.inclusive=s,i.index=0,i}return O(r,e),r.prototype._next=function(i){var o=this.destination;try{var s=this.predicate(i,this.index++)}catch(l){return void o.error(l)}this.nextOrComplete(i,s)},r.prototype.nextOrComplete=function(i,o){var s=this.destination;o?s.next(i):(this.inclusive&&s.next(i),s.complete())},r}(ia),It=function(){function e(r,i,o){this.nextOrObserver=r,this.error=i,this.complete=o}return e.prototype.call=function(r,i){return i.subscribe(new Vz(r,this.nextOrObserver,this.error,this.complete))},e}(),Vz=function(e){function r(i,o,s,l){return(i=e.call(this,i)||this)._tapNext=hc,i._tapError=hc,i._tapComplete=hc,i._tapError=s||hc,i._tapComplete=l||hc,le(o)?(i._context=i,i._tapNext=o):o&&(i._context=o,i._tapNext=o.next||hc,i._tapError=o.error||hc,i._tapComplete=o.complete||hc),i}return O(r,e),r.prototype._next=function(i){try{this._tapNext.call(this._context,i)}catch(o){return void this.destination.error(o)}this.destination.next(i)},r.prototype._error=function(i){try{this._tapError.call(this._context,i)}catch(o){return void this.destination.error(o)}this.destination.error(i)},r.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(i){return void this.destination.error(i)}return this.destination.complete()},r}(ia),Kt={leading:!0,trailing:!1};(function(e){function r(i,o,s,l){var d=e.call(this,i)||this;return d.destination=i,d.durationSelector=o,d._leading=s,d._trailing=l,d._hasValue=!1,d}O(r,e),r.prototype._next=function(i){this._hasValue=!0,this._sendValue=i,this._throttled||(this._leading?this.send():this.throttle(i))},r.prototype.send=function(){var i=this._sendValue;this._hasValue&&(this.destination.next(i),this.throttle(i)),this._hasValue=!1,this._sendValue=void 0},r.prototype.throttle=function(i){(i=this.tryDurationSelector(i))&&this.add(this._throttled=ic(i,new vc(this)))},r.prototype.tryDurationSelector=function(i){try{return this.durationSelector(i)}catch(o){return this.destination.error(o),null}},r.prototype.throttlingDone=function(){var i=this._throttled,o=this._trailing;i&&i.unsubscribe(),this._throttled=void 0,o&&this.send()},r.prototype.notifyNext=function(){this.throttlingDone()},r.prototype.notifyComplete=function(){this.throttlingDone()}})(wc);for(var Lt=function(){function e(r,i,o,s){this.duration=r,this.scheduler=i,this.leading=o,this.trailing=s}return e.prototype.call=function(r,i){return i.subscribe(new Wz(r,this.duration,this.scheduler,this.leading,this.trailing))},e}(),Wz=function(e){function r(i,o,s,l,d){return(i=e.call(this,i)||this).duration=o,i.scheduler=s,i.leading=l,i.trailing=d,i._hasTrailingValue=!1,i._trailingValue=null,i}return O(r,e),r.prototype._next=function(i){this.throttled?this.trailing&&(this._trailingValue=i,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(i):this.trailing&&(this._trailingValue=i,this._hasTrailingValue=!0))},r.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},r.prototype.clearThrottle=function(){var i=this.throttled;i&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),i.unsubscribe(),this.remove(i),this.throttled=null)},r}(ia),Ot=function(){function e(r,i,o,s){this.waitFor=r,this.absoluteTimeout=i,this.withObservable=o,this.scheduler=s}return e.prototype.call=function(r,i){return i.subscribe(new Xz(r,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Xz=function(e){function r(i,o,s,l,d){return(i=e.call(this,i)||this).absoluteTimeout=o,i.waitFor=s,i.withObservable=l,i.scheduler=d,i.scheduleTimeout(),i}return O(r,e),r.dispatchTimeout=function(i){var o=i.withObservable;i._unsubscribeAndRecycle(),i.add(ic(o,new vc(i)))},r.prototype.scheduleTimeout=function(){var i=this.action;i?this.action=i.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(r.dispatchTimeout,this.waitFor,this))},r.prototype._next=function(i){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,i)},r.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},r}(wc),Qt=function(){function e(r,i){this.observables=r,this.project=i}return e.prototype.call=function(r,i){return i.subscribe(new Yz(r,this.observables,this.project))},e}(),Yz=function(e){function r(i,o,s){(i=e.call(this,i)||this).observables=o,i.project=s,i.toRespond=[],s=o.length,i.values=Array(s);for(var l=0;l<s;l++)i.toRespond.push(l);for(l=0;l<s;l++)i.add(ji(i,o[l],void 0,l));return i}return O(r,e),r.prototype.notifyNext=function(i,o,s){this.values[s]=o,0<(i=this.toRespond).length&&(s=i.indexOf(s))!==-1&&i.splice(s,1)},r.prototype.notifyComplete=function(){},r.prototype._next=function(i){this.toRespond.length===0&&(i=[i].concat(this.values),this.project?this._tryProject(i):this.destination.next(i))},r.prototype._tryProject=function(i){try{var o=this.project.apply(this,i)}catch(s){return void this.destination.error(s)}this.destination.next(o)},r}(Rk),Jq=$a(function(e){var r=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(r){var i=new Uint8Array(16);e.exports=function(){return r(i),i}}else{var o=Array(16);e.exports=function(){for(var s,l=0;16>l;l++)!(3&l)&&(s=4294967296*Math.random()),o[l]=s>>>((3&l)<<3)&255;return o}}}),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(e,r){return r=r||0,[ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]]].join("")},Ud=function(e,r,i){if(i=r&&i||0,typeof e=="string"&&(r=e==="binary"?Array(16):null,e=null),(e=(e=e||{}).random||(e.rng||Jq)())[6]=15&e[6]|64,e[8]=63&e[8]|128,r)for(var o=0;16>o;++o)r[i+o]=e[o];return r||Kq(e)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;(function(e){e[e.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e[e.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e[e.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e[e.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e[e.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(Pc||(Pc={})),function(e){e[e.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e[e.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e[e.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e[e.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e[e.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e[e.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(e){e[e.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(e){e[e.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(e){e[e.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e[e.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e[e.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e[e.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e[e.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e[e.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(e){e[e.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e[e.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e[e.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e[e.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e[e.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(e){e[e.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e[e.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e[e.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e[e.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e[e.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e[e.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e[e.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(e){e[e.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e[e.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e[e.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e[e.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(e){e[e.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e[e.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e[e.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e[e.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e[e.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e[e.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e[e.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e[e.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e[e.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e[e.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e[e.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(e){e[e.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(e){e[e.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e[e.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e[e.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e[e.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e[e.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e[e.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e[e.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(e){e[e.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(e){e[e.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e[e.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e[e.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e[e.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e[e.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e[e.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e[e.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e[e.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(e){e[e.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(e){e[e.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e[e.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e[e.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e[e.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(e){e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(e){e[e.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",e[e.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",e[e.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",e[e.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",e[e.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(e){e[e.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",e[e.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",e[e.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",e[e.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",e[e.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(e,r){var i;return Hk(e,function(o,s,l){return!(i=r(o,s,l))}),!!i},Mh=function(e,r,i){if(!lb(i))return!1;var o=X(r);return!!(o=="number"?Ed(i)&&wk(r,i.length):o=="string"&&r in i)&&$f(i[r],e)},dl=function(e,r,i){var o=Va(e)?tq:DA;return i&&Mh(e,r,i)&&(r=void 0),o(e,Te(r))},EA=function(e,r){var i=-1,o=Ed(e)?Array(e.length):[];return Hk(e,function(s,l,d){o[++i]=r(s,l,d)}),o},FA=function(e,r){var i=e.length;for(e.sort(r);i--;)e[i]=e[i].value;return e},GA=function(e,r,i){r=r.length?he(r,function(s){return Va(s)?function(l){return Ch(l,s.length===1?s[0]:s)}:s}):[Dh];var o=-1;return r=he(r,zh(Te)),e=EA(e,function(s,l,d){return{criteria:he(r,function(h){return h(s)}),index:++o,value:s}}),FA(e,function(s,l){t:{for(var d=-1,h=s.criteria,p=l.criteria,f=h.length,_=i.length;++d<f;){e:{var g=h[d],b=p[d];if(g!==b){var C=g!==void 0,k=g===null,A=g==g,P=ie(g),x=b!==void 0,j=b===null,z=b==b,_t=ie(b);if(!j&&!_t&&!P&&g>b||P&&x&&z&&!j&&!_t||k&&x&&z||!C&&z||!A){g=1;break e}if(!k&&!P&&!_t&&g<b||_t&&C&&A&&!k&&!P||j&&C&&A||!x&&A||!z){g=-1;break e}}g=0}if(g){s=d>=_?g:g*(i[d]=="desc"?-1:1);break t}}s=s.index-l.index}return s})},jr=function(e,r){return rq(qq(e,r,Dh),e+"")},kr=jr(function(e,r){if(e==null)return[];var i=r.length;return 1<i&&Mh(e,r[0],r[1])?r=[]:2<i&&Mh(r[0],r[1],r[2])&&(r=[r[0]]),GA(e,$h(r,1),[])}),lr=function(e){if(e.__esModule)return e;var r=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(i){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:function(){return e[i]}})}),r}(Dz),mr=$a(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var i=[],o=function(s,l){return new WebSocket(s,l)};r.normalClosureMessage="Normal closure",r.default=function(s,l){var d=(l=l===void 0?{protocols:i,makeWebSocket:o}:l).protocols,h=d===void 0?i:d,p=(l=l.makeWebSocket)===void 0?o:l;return new lr.Observable(function(f){var _,g=new lr.Subject,b=p(s,h),C=!1,k=!1,A=function(P){if(_)throw C=!0,P=Error("Web socket message factory function called more than once"),f.error(P),P;return _=P.subscribe(function(x){b.send(x)}),g};return b.onopen=function(){k?(C=!0,b.close()):f.next(A)},b.onmessage=function(P){g.next(P.data)},b.onerror=function(P){C=!0,f.error(Error(P.message))},b.onclose=function(P){C||(C=!0,k?(f.complete(),g.complete()):f.error(Error(P.code===1e3?r.normalClosureMessage:P.reason)))},function(){k=!0,_&&_.unsubscribe(),C||(C=!0,b.close())}})}});(function(e){e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default})(mr);var pi=function(e,r,i){(i===void 0||$f(e[r],i))&&(i!==void 0||r in e)||bg(e,r,i)},oi=function(e,r){if((r!=="constructor"||typeof e[r]!="function")&&r!="__proto__")return e[r]},HA=function(e){return jr(function(r,i){var o=-1,s=i.length,l=1<s?i[s-1]:void 0,d=2<s?i[2]:void 0;for(l=3<e.length&&typeof l=="function"?(s--,l):void 0,d&&Mh(i[0],i[1],d)&&(l=3>s?void 0:l,s=1),r=Object(r);++o<s;)(d=i[o])&&e(r,d,o,l);return r})}(function(e,r,i,o){tm(e,r,i,o)}),IA=Math.floor,JA=Math.random,nr=function(e,r){return e+IA(JA()*(r-e+1))},or=function(e){var r=e.length;return r?e[nr(0,r-1)]:void 0},KA=function(e,r){return he(r,function(i){return e[i]})},Ni=function(e){return e==null?[]:KA(e,Ad(e))},LA=function(e){return or(Ni(e))},bn=function(e){return(Va(e)?or:LA)(e)},xm=[],ym=function(e,r){return new WebSocket(e,r)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(e){return!ha(e)&&isFinite(e)&&MA(e)===e}}),Oo("from",Ej,Dj);var NA=function(e,r){for(var i=Array(arguments.length-1),o=0,s=2,l=!0;s<arguments.length;)i[o++]=arguments[s++];return new Promise(function(d,h){i[o]=function(p){if(l)if(l=!1,p)h(p);else{for(var f=Array(arguments.length-1),_=0;_<f.length;)f[_++]=arguments[_];d.apply(null,f)}};try{e.apply(r||null,i)}catch(p){l&&(l=!1,h(p))}})},OA=$a(function(e,r){r.length=function(s){var l=s.length;if(!l)return 0;for(var d=0;1<--l%4&&s.charAt(l)==="=";)++d;return Math.ceil(3*s.length)/4-d};var i=Array(64),o=Array(123);for(e=0;64>e;)o[i[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;r.encode=function(s,l,d){for(var h,p=null,f=[],_=0,g=0;l<d;){var b=s[l++];switch(g){case 0:f[_++]=i[b>>2],h=(3&b)<<4,g=1;break;case 1:f[_++]=i[h|b>>4],h=(15&b)<<2,g=2;break;case 2:f[_++]=i[h|b>>6],f[_++]=i[63&b],g=0}8191<_&&((p||(p=[])).push(String.fromCharCode.apply(String,f)),_=0)}return g&&(f[_++]=i[h],f[_++]=61,g===1&&(f[_++]=61)),p?(_&&p.push(String.fromCharCode.apply(String,f.slice(0,_))),p.join("")):String.fromCharCode.apply(String,f.slice(0,_))},r.decode=function(s,l,d){for(var h,p=d,f=0,_=0;_<s.length;){var g=s.charCodeAt(_++);if(g===61&&1<f)break;if((g=o[g])===void 0)throw Error("invalid encoding");switch(f){case 0:h=g,f=1;break;case 1:l[d++]=h<<2|(48&g)>>4,h=g,f=2;break;case 2:l[d++]=(15&h)<<4|(60&g)>>2,h=g,f=3;break;case 3:l[d++]=(3&h)<<6|g,f=0}}if(f===1)throw Error("invalid encoding");return d-p},r.test=function(s){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(s)}});yg.prototype.on=function(e,r,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:r,ctx:i||this}),this},yg.prototype.off=function(e,r){if(e===void 0)this._listeners={};else if(r===void 0)this._listeners[e]=[];else{e=this._listeners[e];for(var i=0;i<e.length;)e[i].fn===r?e.splice(i,1):++i}return this},yg.prototype.emit=function(e){var r=this._listeners[e];if(r){for(var i=[],o=1;o<arguments.length;)i.push(arguments[o++]);for(o=0;o<r.length;)r[o].fn.apply(r[o++].ctx,i)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(e){}return null},RA=$a(function(e,r){r.length=function(i){for(var o,s=0,l=0;l<i.length;++l)128>(o=i.charCodeAt(l))?s+=1:2048>o?s+=2:(64512&o)==55296&&(64512&i.charCodeAt(l+1))==56320?(++l,s+=4):s+=3;return s},r.read=function(i,o,s){if(1>s-o)return"";for(var l,d=null,h=[],p=0;o<s;)128>(l=i[o++])?h[p++]=l:191<l&&224>l?h[p++]=(31&l)<<6|63&i[o++]:239<l&&365>l?(l=((7&l)<<18|(63&i[o++])<<12|(63&i[o++])<<6|63&i[o++])-65536,h[p++]=55296+(l>>10),h[p++]=56320+(1023&l)):h[p++]=(15&l)<<12|(63&i[o++])<<6|63&i[o++],8191<p&&((d||(d=[])).push(String.fromCharCode.apply(String,h)),p=0);return d?(p&&d.push(String.fromCharCode.apply(String,h.slice(0,p))),d.join("")):String.fromCharCode.apply(String,h.slice(0,p))},r.write=function(i,o,s){for(var l,d,h=s,p=0;p<i.length;++p)128>(l=i.charCodeAt(p))?o[s++]=l:(2048>l?o[s++]=l>>6|192:((64512&l)==55296&&(64512&(d=i.charCodeAt(p+1)))==56320?(l=65536+((1023&l)<<10)+(1023&d),++p,o[s++]=l>>18|240,o[s++]=l>>12&63|128):o[s++]=l>>12|224,o[s++]=l>>6&63|128),o[s++]=63&l|128);return s-h}}),SA=function(e,r,i){var o=i||8192,s=o>>>1,l=null,d=o;return function(h){return 1>h||h>s?e(h):(d+h>o&&(l=e(o),d=0),h=r.call(l,d,d+=h),7&d&&(d=1+(7|d)),h)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(e){if(e===0)return Xd;var r=0>e;r&&(e=-e);var i=e>>>0;return e=(e-i)/4294967296>>>0,r&&(e=~e>>>0,i=~i>>>0,4294967295<++i&&(i=0,4294967295<++e&&(e=0))),new Wa(i,e)},Wa.from=function(e){if(typeof e=="number")return Wa.fromNumber(e);if(V.isString(e)){if(!V.Long)return Wa.fromNumber(parseInt(e,10));e=V.Long.fromString(e)}return e.low||e.high?new Wa(e.low>>>0,e.high>>>0):Xd},Wa.prototype.toNumber=function(e){if(!e&&this.hi>>>31){e=1+~this.lo>>>0;var r=~this.hi>>>0;return e||(r=r+1>>>0),-(e+4294967296*r)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(e){return V.Long?new V.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var td=String.prototype.charCodeAt;Wa.fromHash=function(e){return e===TA?Xd:new Wa((td.call(e,0)|td.call(e,1)<<8|td.call(e,2)<<16|td.call(e,3)<<24)>>>0,(td.call(e,4)|td.call(e,5)<<8|td.call(e,6)<<16|td.call(e,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},Wa.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},Wa.prototype.length=function(){var e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?r===0?16384>e?128>e?1:2:2097152>e?3:4:16384>r?128>r?5:6:2097152>r?7:8:128>i?9:10};var V=$a(function(e,r){function i(s,l,d){for(var h=Object.keys(l),p=0;p<h.length;++p)s[h[p]]!==void 0&&d||(s[h[p]]=l[h[p]]);return s}function o(s){function l(d,h){if(!(this instanceof l))return new l(d,h);Object.defineProperty(this,"message",{get:function(){return d}}),Error.captureStackTrace?Error.captureStackTrace(this,l):Object.defineProperty(this,"stack",{value:Error().stack||""}),h&&i(this,h)}return(l.prototype=Object.create(Error.prototype)).constructor=l,Object.defineProperty(l.prototype,"name",{get:function(){return s}}),l.prototype.toString=function(){return this.name+": "+this.message},l}r.asPromise=NA,r.base64=OA,r.EventEmitter=yg,r.float=PA,r.inquire=QA,r.utf8=RA,r.pool=SA,r.LongBits=Wa,r.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),r.global=r.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(s){return typeof s=="number"&&isFinite(s)&&Math.floor(s)===s},r.isString=function(s){return typeof s=="string"||s instanceof String},r.isObject=function(s){return s&&X(s)==="object"},r.isset=r.isSet=function(s,l){var d=s[l];return!(d==null||!s.hasOwnProperty(l))&&(X(d)!=="object"||0<(Array.isArray(d)?d.length:Object.keys(d).length))},r.Buffer=function(){try{var s=r.inquire("buffer").Buffer;return s.prototype.utf8Write?s:null}catch{return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(s){return typeof s=="number"?r.Buffer?r._Buffer_allocUnsafe(s):new r.Array(s):r.Buffer?r._Buffer_from(s):typeof Uint8Array>"u"?s:new Uint8Array(s)},r.Array=typeof Uint8Array<"u"?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(s){return s?r.LongBits.from(s).toHash():r.LongBits.zeroHash},r.longFromHash=function(s,l){return s=r.LongBits.fromHash(s),r.Long?r.Long.fromBits(s.lo,s.hi,l):s.toNumber(!!l)},r.merge=i,r.lcFirst=function(s){return s.charAt(0).toLowerCase()+s.substring(1)},r.newError=o,r.ProtocolError=o("ProtocolError"),r.oneOfGetter=function(s){for(var l={},d=0;d<s.length;++d)l[s[d]]=1;return function(){for(var h=Object.keys(this),p=h.length-1;-1<p;--p)if(l[h[p]]===1&&this[h[p]]!==void 0&&this[h[p]]!==null)return h[p]}},r.oneOfSetter=function(s){return function(l){for(var d=0;d<s.length;++d)s[d]!==l&&delete this[s[d]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var s=r.Buffer;s?(r._Buffer_from=s.from!==Uint8Array.from&&s.from||function(l,d){return new s(l,d)},r._Buffer_allocUnsafe=s.allocUnsafe||function(l){return new s(l)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(e){return new V.Array(e)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(e,r,i){return this.tail=this.tail.next=new sf(e,r,i),this.len+=r,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(e,r,i){for(;127<e;)r[i++]=127&e|128,e>>>=7;r[i]=e},ja.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new ui(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},ja.prototype.int32=function(e){return 0>e?this._push(vi,10,Nh.fromNumber(e)):this.uint32(e)},ja.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ja.prototype.uint64=function(e){return e=Nh.from(e),this._push(vi,e.length(),e)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(e){return e=Nh.from(e).zzEncode(),this._push(vi,e.length(),e)},ja.prototype.bool=function(e){return this._push(ti,1,e?1:0)},ja.prototype.fixed32=function(e){return this._push(wi,4,e>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(e){return e=Nh.from(e),this._push(wi,4,e.lo)._push(wi,4,e.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(e){return this._push(V.float.writeFloatLE,4,e)},ja.prototype.double=function(e){return this._push(V.float.writeDoubleLE,8,e)};var UA=V.Array.prototype.set?function(e,r,i){r.set(e,i)}:function(e,r,i){for(var o=0;o<e.length;++o)r[i+o]=e[o]};ja.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(ti,1,0);if(V.isString(e)){var i=ja.alloc(r=pr.length(e));pr.decode(e,i,0),e=i}return this.uint32(r)._push(UA,r,e)},ja.prototype.string=function(e){var r=qr.length(e);return r?this.uint32(r)._push(qr.write,r,e):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var e=this.head,r=this.tail,i=this.len;return this.reset().uint32(i),i&&(this.tail.next=e.next,this.tail=r,this.len+=i),this},ja.prototype.finish=function(){for(var e=this.head.next,r=this.constructor.alloc(this.len),i=0;e;)e.fn(e.val,r,i),i+=e.len,e=e.next;return r},ja._configure=function(e){el=e,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&V.Buffer.prototype.set.name==="set"?function(e,r,i){r.set(e,i)}:function(e,r,i){if(e.copy)e.copy(r,i,0,e.length);else for(var o=0;o<e.length;)r[i++]=e[o++]}},jc.prototype.bytes=function(e){V.isString(e)&&(e=V._Buffer_from(e,"base64"));var r=e.length>>>0;return this.uint32(r),r&&this._push(jc.writeBytesBuffer,r,e),this},jc.prototype.string=function(e){var r=V.Buffer.byteLength(e);return this.uint32(r),r&&this._push(Ut,r,e),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new La(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new La(e);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(e){return(La.create=function(r){return V.Buffer.isBuffer(r)?new fl(r):sr(r)})(e)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return e}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},La.prototype.bool=function(){return this.uint32()!==0},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var e=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var e=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},La.prototype.bytes=function(){var e=this.uint32(),r=this.pos,i=this.pos+e;if(i>this.len)throw Yb(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(r,i):r===i?new this.buf.constructor(0):this._slice.call(this.buf,r,i)},La.prototype.string=function(){var e=this.bytes();return VA.read(e,0,e.length)},La.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Yb(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Yb(this);while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=7&this.uint32())!=4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},La._configure=function(e){fl=e,La.create=tr(),fl._configure();var r=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[r](!1)},uint64:function(){return yi.call(this)[r](!0)},sint64:function(){return yi.call(this).zzDecode()[r](!1)},fixed64:function(){return Fm.call(this)[r](!0)},sfixed64:function(){return Fm.call(this)[r](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function e(r,i,o,s,l){if(!s)throw TypeError("request must be specified");var d=this;if(!l)return V.asPromise(e,d,r,i,o,s);if(d.rpcImpl)try{return d.rpcImpl(r,i[d.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(h,p){if(h)return d.emit("error",h,r),l(h);if(p!==null){if(!(p instanceof o))try{p=o[d.responseDelimited?"decodeDelimited":"decode"](p)}catch(f){return d.emit("error",f,r),l(f)}return d.emit("data",p,r),l(null,p)}d.end(!0)})}catch(h){d.emit("error",h,r),setTimeout(function(){l(h)},0)}else setTimeout(function(){l(Error("already ended"))},0)},tf.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a(function(e,r){r.Service=tf}),XA={},fc=$a(function(e,r){function i(){o.util._configure(),o.Writer._configure(o.BufferWriter),o.Reader._configure(o.BufferReader)}var o=r;o.build="minimal",o.Writer=xi,o.BufferWriter=jc,o.Reader=zi,o.BufferReader=Fd,o.util=V,o.rpc=WA,o.roots=XA,o.configure=i,i()});fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var e={},r=Object.create(e);return r[e[0]="Unknown"]=0,r[e[1]="PingUri"]=1,r[e[2]="PongUri"]=2,r[e[11]="UserJoinUri"]=11,r[e[12]="UserRespUri"]=12,r[e[21]="UserQuitUri"]=21,r[e[22]="UserDropUri"]=22,r[e[31]="GroupEnterUri"]=31,r[e[32]="GroupLeaveUri"]=32,r[e[33]="GroupReplyUri"]=33,r[e[36]="GroupEnterNoticeUri"]=36,r[e[37]="GroupLeaveNoticeUri"]=37,r[e[38]="GroupEventNoticeUri"]=38,r[e[39]="GroupCountNoticeUri"]=39,r[e[41]="UserStatusListUri"]=41,r[e[42]="UserStatusResultUri"]=42,r[e[51]="GroupStatusListUri"]=51,r[e[52]="GroupStatusResultUri"]=52,r[e[55]="GroupAllUsersListUri"]=55,r[e[56]="GroupAllUsersResultUri"]=56,r[e[100]="MessageUri"]=100,r[e[101]="AckUri"]=101,r[e[115]="FileUploadIndexGetUri"]=115,r[e[116]="FileUploadIndexRetUri"]=116,r[e[117]="FileUploadIndexSetUri"]=117,r[e[118]="FileUploadIndexFinUri"]=118,r[e[119]="FileUploadIndexErrUri"]=119,r[e[125]="FileDownloadIndexGetUri"]=125,r[e[126]="FileDownloadIndexRetUri"]=126,r[e[127]="FileDownloadIndexErrUri"]=127,r[e[201]="UserJoinNoticeUri"]=201,r[e[202]="UserQuitNoticeUri"]=202,r[e[203]="UserWaitNoticeUri"]=203,r[e[301]="UserAttributeGetUri"]=301,r[e[302]="UserAttributeRetUri"]=302,r[e[303]="UserAttributeSetUri"]=303,r[e[304]="UserAttributeModUri"]=304,r[e[305]="UserAttributeDelUri"]=305,r[e[307]="UserAttributeRspUri"]=307,r[e[308]="UserAttributeErrUri"]=308,r[e[311]="UserAttributeKeysGetUri"]=311,r[e[312]="UserAttributeKeysRetUri"]=312,r[e[351]="GroupAttributeGetUri"]=351,r[e[352]="GroupAttributeRetUri"]=352,r[e[353]="GroupAttributeSetUri"]=353,r[e[354]="GroupAttributeModUri"]=354,r[e[355]="GroupAttributeDelUri"]=355,r[e[356]="GroupAttributeAltUri"]=356,r[e[357]="GroupAttributeRspUri"]=357,r[e[358]="GroupAttributeErrUri"]=358,r[e[361]="GroupAttributeKeysGetUri"]=361,r[e[362]="GroupAttributeKeysRetUri"]=362,r[e[401]="SubscribeUserStatusUri"]=401,r[e[402]="UnsubscribeUserStatusUri"]=402,r[e[499]="SubscribeResponseUri"]=499,r}(),Oh=t.Wrapper=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.uri=0,e.prototype.data=q.newBuffer([]),e.encode=function(r,i){return i||(i=L.create()),r.uri!=null&&Object.hasOwnProperty.call(r,"uri")&&i.uint32(8).int32(r.uri),r.data!=null&&Object.hasOwnProperty.call(r,"data")&&i.uint32(18).bytes(r.data),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.Wrapper;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.uri=r.int32();break;case 2:o.data=r.bytes();break;default:r.skipType(7&s)}}return o},e}(),ZA=t.Ping=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&i.uint32(16).uint64(r.ms),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.Ping;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.ms=r.uint64();break;default:r.skipType(7&s)}}return o},e}(),$A=t.Pong=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&i.uint32(16).uint64(r.ms),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.Pong;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.ms=r.uint64();break;default:r.skipType(7&s)}}return o},e}(),aB=t.UserJoin=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.opt!=null&&Object.hasOwnProperty.call(r,"opt")&&i.uint32(16).uint64(r.opt),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(24).uint64(r.instance),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(34).string(r.account),r.ticket!=null&&Object.hasOwnProperty.call(r,"ticket")&&i.uint32(42).string(r.ticket),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserJoin;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.opt=r.uint64();break;case 3:o.instance=r.uint64();break;case 4:o.account=r.string();break;case 5:o.ticket=r.string();break;default:r.skipType(7&s)}}return o},e}(),bB=t.UserResp=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(24).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserResp;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.code=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),cB=t.UserQuit=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.encode=function(r,i){return i||(i=L.create()),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserQuit;r.pos<i;){var s=r.uint32();r.skipType(7&s)}return o},e}(),dB=t.UserDrop=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(8).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserDrop;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.code=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),eB=t.GroupEnter=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupEnter;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;default:r.skipType(7&s)}}return o},e}(),fB=t.GroupLeave=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.account="",e.encode=function(r,i){return i||(i=L.create()),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(10).string(r.account),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupLeave;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.account=r.string();break;default:r.skipType(7&s)}}return o},e}(),gB=t.GroupReply=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(24).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupReply;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.code=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),ur=t.GroupLeaveNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&i.uint32(18).string(r.user),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(26).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(32).uint64(r.instance),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&i.uint32(40).uint32(r.size),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupLeaveNotice;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.user=r.string();break;case 3:o.group=r.string();break;case 4:o.instance=r.uint64();break;case 5:o.size=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),vr=t.GroupEnterNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&i.uint32(18).string(r.user),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(26).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(32).uint64(r.instance),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&i.uint32(40).uint32(r.size),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupEnterNotice;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.user=r.string();break;case 3:o.group=r.string();break;case 4:o.instance=r.uint64();break;case 5:o.size=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),wr=t.Message=function(){function e(r){if(this.MiscMap={},r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=q.newBuffer([]),e.prototype.MiscMap=q.emptyObject,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,i){if(i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.dialogue!=null&&Object.hasOwnProperty.call(r,"dialogue")&&i.uint32(16).uint64(r.dialogue),r.sequence!=null&&Object.hasOwnProperty.call(r,"sequence")&&i.uint32(24).uint64(r.sequence),r.options!=null&&Object.hasOwnProperty.call(r,"options")&&i.uint32(32).uint64(r.options),r.src!=null&&Object.hasOwnProperty.call(r,"src")&&i.uint32(42).string(r.src),r.dst!=null&&Object.hasOwnProperty.call(r,"dst")&&i.uint32(50).string(r.dst),r.payload!=null&&Object.hasOwnProperty.call(r,"payload")&&i.uint32(58).bytes(r.payload),r.MiscMap!=null&&Object.hasOwnProperty.call(r,"MiscMap"))for(var o=Object.keys(r.MiscMap),s=0;s<o.length;++s)i.uint32(66).fork().uint32(10).string(o[s]).uint32(18).bytes(r.MiscMap[o[s]]).ldelim();return r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&i.uint32(72).uint64(r.ms),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o,s,l=new t.Message;r.pos<i;)switch(o=r.uint32(),o>>>3){case 1:l.instance=r.uint64();break;case 2:l.dialogue=r.uint64();break;case 3:l.sequence=r.uint64();break;case 4:l.options=r.uint64();break;case 5:l.src=r.string();break;case 6:l.dst=r.string();break;case 7:l.payload=r.bytes();break;case 8:l.MiscMap===q.emptyObject&&(l.MiscMap={});var d=r.uint32()+r.pos;for(o="",s=[];r.pos<d;){var h=r.uint32();switch(h>>>3){case 1:o=r.string();break;case 2:s=r.bytes();break;default:r.skipType(7&h)}}l.MiscMap[o]=s;break;case 9:l.ms=r.uint64();break;default:r.skipType(7&o)}return l},e}(),xr=t.Ack=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.dialogue!=null&&Object.hasOwnProperty.call(r,"dialogue")&&i.uint32(16).uint64(r.dialogue),r.sequence!=null&&Object.hasOwnProperty.call(r,"sequence")&&i.uint32(24).uint64(r.sequence),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(32).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.Ack;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.instance=r.uint64();break;case 2:o.dialogue=r.uint64();break;case 3:o.sequence=r.uint64();break;case 4:o.code=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),hB=t.FileUploadIndexGet=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.hash!=null&&Object.hasOwnProperty.call(r,"hash")&&i.uint32(18).bytes(r.hash),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&i.uint32(24).uint32(r.size),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileUploadIndexGet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.hash=r.bytes();break;case 3:o.size=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),iB=t.FileUploadIndexRet=function(){function e(r){if(this.servers=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&i.uint32(16).uint32(r.unit),r.servers!=null&&r.servers.length){i.uint32(26).fork();for(var o=0;o<r.servers.length;++o)i.uint32(r.servers[o]);i.ldelim()}return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileUploadIndexRet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.unit=r.uint32();break;case 3:if(o.servers&&o.servers.length||(o.servers=[]),(7&s)==2)for(s=r.uint32()+r.pos;r.pos<s;)o.servers.push(r.uint32());else o.servers.push(r.uint32());break;default:r.skipType(7&s)}}return o},e}(),jB=t.FileUploadIndexSet=function(){function e(r){if(this.servers=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.hash!=null&&Object.hasOwnProperty.call(r,"hash")&&i.uint32(18).bytes(r.hash),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&i.uint32(24).uint32(r.unit),r.servers!=null&&r.servers.length){i.uint32(34).fork();for(var o=0;o<r.servers.length;++o)i.uint32(r.servers[o]);i.ldelim()}return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileUploadIndexSet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.hash=r.bytes();break;case 3:o.unit=r.uint32();break;case 4:if(o.servers&&o.servers.length||(o.servers=[]),(7&s)==2)for(s=r.uint32()+r.pos;r.pos<s;)o.servers.push(r.uint32());else o.servers.push(r.uint32());break;default:r.skipType(7&s)}}return o},e}(),kB=t.FileUploadIndexFin=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.unit=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.zone!=null&&Object.hasOwnProperty.call(r,"zone")&&i.uint32(16).uint32(r.zone),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&i.uint32(24).uint32(r.unit),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileUploadIndexFin;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.zone=r.uint32();break;case 3:o.unit=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),lB=t.FileUploadIndexErr=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(16).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileUploadIndexErr;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.code=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),mB=t.FileDownloadIndexGet=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.prototype.unit=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.zone!=null&&Object.hasOwnProperty.call(r,"zone")&&i.uint32(16).uint32(r.zone),r.hash!=null&&Object.hasOwnProperty.call(r,"hash")&&i.uint32(26).bytes(r.hash),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&i.uint32(32).uint32(r.size),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&i.uint32(40).uint32(r.unit),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileDownloadIndexGet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.zone=r.uint32();break;case 3:o.hash=r.bytes();break;case 4:o.size=r.uint32();break;case 5:o.unit=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),nB=t.FileDownloadIndexRet=function(){function e(r){if(this.servers=[],this.backups=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.zone=0,e.prototype.servers=q.emptyArray,e.prototype.backups=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&i.uint32(16).uint32(r.unit),r.zone!=null&&Object.hasOwnProperty.call(r,"zone")&&i.uint32(24).uint32(r.zone),r.servers!=null&&r.servers.length){i.uint32(34).fork();for(var o=0;o<r.servers.length;++o)i.uint32(r.servers[o]);i.ldelim()}if(r.backups!=null&&r.backups.length){for(i.uint32(42).fork(),o=0;o<r.backups.length;++o)i.uint32(r.backups[o]);i.ldelim()}return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileDownloadIndexRet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.unit=r.uint32();break;case 3:o.zone=r.uint32();break;case 4:if(o.servers&&o.servers.length||(o.servers=[]),(7&s)==2)for(s=r.uint32()+r.pos;r.pos<s;)o.servers.push(r.uint32());else o.servers.push(r.uint32());break;case 5:if(o.backups&&o.backups.length||(o.backups=[]),(7&s)==2)for(s=r.uint32()+r.pos;r.pos<s;)o.backups.push(r.uint32());else o.backups.push(r.uint32());break;default:r.skipType(7&s)}}return o},e}(),oB=t.FileDownloadIndexErr=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(16).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.FileDownloadIndexErr;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.code=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),pB=t.GroupAllUsersList=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.pageSize!=null&&Object.hasOwnProperty.call(r,"pageSize")&&i.uint32(24).uint32(r.pageSize),r.pageNumber!=null&&Object.hasOwnProperty.call(r,"pageNumber")&&i.uint32(32).uint32(r.pageNumber),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAllUsersList;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.pageSize=r.uint32();break;case 4:o.pageNumber=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),qB=t.GroupAllUsersResult=function(){function e(r){if(this.memberInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.totalSize!=null&&Object.hasOwnProperty.call(r,"totalSize")&&i.uint32(24).uint32(r.totalSize),r.pageSize!=null&&Object.hasOwnProperty.call(r,"pageSize")&&i.uint32(32).uint32(r.pageSize),r.pageNumber!=null&&Object.hasOwnProperty.call(r,"pageNumber")&&i.uint32(40).uint32(r.pageNumber),r.memberInfos!=null&&r.memberInfos.length)for(var o=0;o<r.memberInfos.length;++o)t.GroupAllUsersResult.MemberInfo.encode(r.memberInfos[o],i.uint32(50).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAllUsersResult;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.totalSize=r.uint32();break;case 4:o.pageSize=r.uint32();break;case 5:o.pageNumber=r.uint32();break;case 6:o.memberInfos&&o.memberInfos.length||(o.memberInfos=[]),o.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return o},e.MemberInfo=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.account="",r.prototype.ts=0,r.encode=function(i,o){return o||(o=L.create()),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&o.uint32(10).string(i.account),i.ts!=null&&Object.hasOwnProperty.call(i,"ts")&&o.uint32(16).uint32(i.ts),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var s=new t.GroupAllUsersResult.MemberInfo;i.pos<o;){var l=i.uint32();switch(l>>>3){case 1:s.account=i.string();break;case 2:s.ts=i.uint32();break;default:i.skipType(7&l)}}return s},r}(),e}(),rB=t.UserStatusList=function(){function e(r){if(this.users=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var o=0;o<r.users.length;++o)i.uint32(18).string(r.users[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserStatusList;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.users&&o.users.length||(o.users=[]),o.users.push(r.string());break;default:r.skipType(7&s)}}return o},e}(),sB=t.UserStatusResult=function(){function e(r){if(this.userInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.userInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.userInfos!=null&&r.userInfos.length)for(var o=0;o<r.userInfos.length;++o)t.UserStatusResult.UserStatusInfo.encode(r.userInfos[o],i.uint32(18).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserStatusResult;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.userInfos&&o.userInfos.length||(o.userInfos=[]),o.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return o},e.UserStatusInfo=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.account="",r.prototype.ts=0,r.encode=function(i,o){return o||(o=L.create()),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&o.uint32(10).string(i.account),i.ts!=null&&Object.hasOwnProperty.call(i,"ts")&&o.uint32(16).uint32(i.ts),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var s=new t.UserStatusResult.UserStatusInfo;i.pos<o;){var l=i.uint32();switch(l>>>3){case 1:s.account=i.string();break;case 2:s.ts=i.uint32();break;default:i.skipType(7&l)}}return s},r}(),e}(),tB=t.UserAttributeGet=function(){function e(r){if(this.attributes=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.attributes!=null&&r.attributes.length)for(var o=0;o<r.attributes.length;++o)i.uint32(26).string(r.attributes[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeGet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.attributes&&o.attributes.length||(o.attributes=[]),o.attributes.push(r.string());break;default:r.skipType(7&s)}}return o},e}(),uB=t.UserAttributeRet=function(){function e(r){if(this.attributeInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.attributeInfos!=null&&r.attributeInfos.length)for(var o=0;o<r.attributeInfos.length;++o)t.UserAttributeRet.AttributeInfo.encode(r.attributeInfos[o],i.uint32(18).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeRet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.attributeInfos&&o.attributeInfos.length||(o.attributeInfos=[]),o.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return o},e.AttributeInfo=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.key="",r.prototype.value="",r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var s=new t.UserAttributeRet.AttributeInfo;i.pos<o;){var l=i.uint32();switch(l>>>3){case 1:s.key=i.string();break;case 2:s.value=i.string();break;default:i.skipType(7&l)}}return s},r}(),e}(),vB=t.UserAttributeSet=function(){function e(r){if(this.attributeInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.attributeInfos!=null&&r.attributeInfos.length)for(var o=0;o<r.attributeInfos.length;++o)t.UserAttributeSet.AttributeInfo.encode(r.attributeInfos[o],i.uint32(26).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeSet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.attributeInfos&&o.attributeInfos.length||(o.attributeInfos=[]),o.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return o},e.AttributeInfo=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.key="",r.prototype.value="",r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var s=new t.UserAttributeSet.AttributeInfo;i.pos<o;){var l=i.uint32();switch(l>>>3){case 1:s.key=i.string();break;case 2:s.value=i.string();break;default:i.skipType(7&l)}}return s},r}(),e}(),wB=t.UserAttributeMod=function(){function e(r){if(this.attributeInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.attributeInfos!=null&&r.attributeInfos.length)for(var o=0;o<r.attributeInfos.length;++o)t.UserAttributeMod.AttributeInfo.encode(r.attributeInfos[o],i.uint32(26).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeMod;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.attributeInfos&&o.attributeInfos.length||(o.attributeInfos=[]),o.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return o},e.AttributeInfo=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.key="",r.prototype.value="",r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var s=new t.UserAttributeMod.AttributeInfo;i.pos<o;){var l=i.uint32();switch(l>>>3){case 1:s.key=i.string();break;case 2:s.value=i.string();break;default:i.skipType(7&l)}}return s},r}(),e}(),xB=t.UserAttributeDel=function(){function e(r){if(this.attributes=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),r.attributes!=null&&r.attributes.length)for(var o=0;o<r.attributes.length;++o)i.uint32(26).string(r.attributes[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeDel;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;case 3:o.attributes&&o.attributes.length||(o.attributes=[]),o.attributes.push(r.string());break;default:r.skipType(7&s)}}return o},e}(),yB=t.UserAttributeErr=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(16).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeErr;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.code=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),zB=t.UserAttributeKeysGet=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&i.uint32(18).string(r.account),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeKeysGet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.account=r.string();break;default:r.skipType(7&s)}}return o},e}(),AB=t.UserAttributeKeysRet=function(){function e(r){if(this.keys=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.keys!=null&&r.keys.length)for(var o=0;o<r.keys.length;++o)i.uint32(18).string(r.keys[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeKeysRet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.keys&&o.keys.length||(o.keys=[]),o.keys.push(r.string());break;default:r.skipType(7&s)}}return o},e}(),BB=t.UserAttributeRsp=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserAttributeRsp;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;default:r.skipType(7&s)}}return o},e}(),CB=t.GroupStatusList=function(){function e(r){if(this.groups=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groups=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.groups!=null&&r.groups.length)for(var o=0;o<r.groups.length;++o)i.uint32(18).string(r.groups[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupStatusList;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.groups&&o.groups.length||(o.groups=[]),o.groups.push(r.string());break;default:r.skipType(7&s)}}return o},e}(),DB=t.GroupStatusResult=function(){function e(r){if(this.groupInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.groupInfos!=null&&r.groupInfos.length)for(var o=0;o<r.groupInfos.length;++o)t.GroupStatusResult.GroupInfo.encode(r.groupInfos[o],i.uint32(18).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupStatusResult;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.groupInfos&&o.groupInfos.length||(o.groupInfos=[]),o.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return o},e.GroupInfo=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.group="",r.prototype.memberCount=0,r.encode=function(i,o){return o||(o=L.create()),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&o.uint32(10).string(i.group),i.memberCount!=null&&Object.hasOwnProperty.call(i,"memberCount")&&o.uint32(16).uint32(i.memberCount),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var s=new t.GroupStatusResult.GroupInfo;i.pos<o;){var l=i.uint32();switch(l>>>3){case 1:s.group=i.string();break;case 2:s.memberCount=i.uint32();break;default:i.skipType(7&l)}}return s},r}(),e}(),EB=t.GroupCountNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(r,i){return i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(16).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(26).string(r.group),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&i.uint32(32).uint32(r.size),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupCountNotice;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.instance=r.uint64();break;case 2:o.seq=r.uint64();break;case 3:o.group=r.string();break;case 4:o.size=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),FB=t.GroupAttributeGet=function(){function e(r){if(this.attributes=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.attributes!=null&&r.attributes.length)for(var o=0;o<r.attributes.length;++o)i.uint32(26).string(r.attributes[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeGet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.attributes&&o.attributes.length||(o.attributes=[]),o.attributes.push(r.string());break;default:r.skipType(7&s)}}return o},e}(),GB=t.GroupAttributeRet=function(){function e(r){if(this.attributeMaps=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.attributeMaps!=null&&r.attributeMaps.length)for(var o=0;o<r.attributeMaps.length;++o)t.GroupAttributeRet.AttributeMap.encode(r.attributeMaps[o],i.uint32(18).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeRet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.attributeMaps&&o.attributeMaps.length||(o.attributeMaps=[]),o.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return o},e.AttributeMap=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.key="",r.prototype.value="",r.prototype.origin="",r.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),i.origin!=null&&Object.hasOwnProperty.call(i,"origin")&&o.uint32(26).string(i.origin),i.ms!=null&&Object.hasOwnProperty.call(i,"ms")&&o.uint32(32).uint64(i.ms),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var s=new t.GroupAttributeRet.AttributeMap;i.pos<o;){var l=i.uint32();switch(l>>>3){case 1:s.key=i.string();break;case 2:s.value=i.string();break;case 3:s.origin=i.string();break;case 4:s.ms=i.uint64();break;default:i.skipType(7&l)}}return s},r}(),e}(),HB=t.GroupAttributeSet=function(){function e(r){if(this.attributeInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&i.uint32(24).bool(r.broadcast),r.attributeInfos!=null&&r.attributeInfos.length)for(var o=0;o<r.attributeInfos.length;++o)t.GroupAttributeSet.AttributeInfo.encode(r.attributeInfos[o],i.uint32(34).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeSet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.broadcast=r.bool();break;case 4:o.attributeInfos&&o.attributeInfos.length||(o.attributeInfos=[]),o.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return o},e.AttributeInfo=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.key="",r.prototype.value="",r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var s=new t.GroupAttributeSet.AttributeInfo;i.pos<o;){var l=i.uint32();switch(l>>>3){case 1:s.key=i.string();break;case 2:s.value=i.string();break;default:i.skipType(7&l)}}return s},r}(),e}(),IB=t.GroupAttributeMod=function(){function e(r){if(this.attributeInfos=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&i.uint32(24).bool(r.broadcast),r.attributeInfos!=null&&r.attributeInfos.length)for(var o=0;o<r.attributeInfos.length;++o)t.GroupAttributeMod.AttributeInfo.encode(r.attributeInfos[o],i.uint32(34).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeMod;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.broadcast=r.bool();break;case 4:o.attributeInfos&&o.attributeInfos.length||(o.attributeInfos=[]),o.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return o},e.AttributeInfo=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.key="",r.prototype.value="",r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var s=new t.GroupAttributeMod.AttributeInfo;i.pos<o;){var l=i.uint32();switch(l>>>3){case 1:s.key=i.string();break;case 2:s.value=i.string();break;default:i.skipType(7&l)}}return s},r}(),e}(),JB=t.GroupAttributeDel=function(){function e(r){if(this.attributes=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&i.uint32(24).bool(r.broadcast),r.attributes!=null&&r.attributes.length)for(var o=0;o<r.attributes.length;++o)i.uint32(34).string(r.attributes[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeDel;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.broadcast=r.bool();break;case 4:o.attributes&&o.attributes.length||(o.attributes=[]),o.attributes.push(r.string());break;default:r.skipType(7&s)}}return o},e}(),KB=t.GroupAttributeAlt=function(){function e(r){if(this.attributeMaps=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(24).uint64(r.instance),r.attributeMaps!=null&&r.attributeMaps.length)for(var o=0;o<r.attributeMaps.length;++o)t.GroupAttributeAlt.AttributeMap.encode(r.attributeMaps[o],i.uint32(34).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeAlt;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;case 3:o.instance=r.uint64();break;case 4:o.attributeMaps&&o.attributeMaps.length||(o.attributeMaps=[]),o.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return o},e.AttributeMap=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.key="",r.prototype.value="",r.prototype.origin="",r.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,r.encode=function(i,o){return o||(o=L.create()),i.key!=null&&Object.hasOwnProperty.call(i,"key")&&o.uint32(10).string(i.key),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&o.uint32(18).string(i.value),i.origin!=null&&Object.hasOwnProperty.call(i,"origin")&&o.uint32(26).string(i.origin),i.ms!=null&&Object.hasOwnProperty.call(i,"ms")&&o.uint32(32).uint64(i.ms),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var s=new t.GroupAttributeAlt.AttributeMap;i.pos<o;){var l=i.uint32();switch(l>>>3){case 1:s.key=i.string();break;case 2:s.value=i.string();break;case 3:s.origin=i.string();break;case 4:s.ms=i.uint64();break;default:i.skipType(7&l)}}return s},r}(),e}(),LB=t.GroupAttributeRsp=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeRsp;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;default:r.skipType(7&s)}}return o},e}(),MB=t.GroupAttributeErr=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(16).uint32(r.code),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeErr;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.code=r.uint32();break;default:r.skipType(7&s)}}return o},e}(),NB=t.GroupAttributeKeysGet=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(r,i){return i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&i.uint32(18).string(r.group),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeKeysGet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.group=r.string();break;default:r.skipType(7&s)}}return o},e}(),OB=t.GroupAttributeKeysRet=function(){function e(r){if(this.keys=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.keys!=null&&r.keys.length)for(var o=0;o<r.keys.length;++o)i.uint32(18).string(r.keys[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.GroupAttributeKeysRet;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.keys&&o.keys.length||(o.keys=[]),o.keys.push(r.string());break;default:r.skipType(7&s)}}return o},e}(),PB=t.SubscribeUserStatus=function(){function e(r){if(this.users=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var o=0;o<r.users.length;++o)i.uint32(18).string(r.users[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.SubscribeUserStatus;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.users&&o.users.length||(o.users=[]),o.users.push(r.string());break;default:r.skipType(7&s)}}return o},e}(),QB=t.UnsubscribeUserStatus=function(){function e(r){if(this.users=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var o=0;o<r.users.length;++o)i.uint32(18).string(r.users[o]);return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UnsubscribeUserStatus;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.users&&o.users.length||(o.users=[]),o.users.push(r.string());break;default:r.skipType(7&s)}}return o},e}(),RB=t.UserJoinNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(r,i){return i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&i.uint32(26).string(r.user),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserJoinNotice;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.instance=r.uint64();break;case 2:o.seq=r.uint64();break;case 3:o.user=r.string();break;default:r.skipType(7&s)}}return o},e}(),SB=t.UserQuitNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(r,i){return i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&i.uint32(26).string(r.user),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserQuitNotice;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.instance=r.uint64();break;case 2:o.seq=r.uint64();break;case 3:o.user=r.string();break;default:r.skipType(7&s)}}return o},e}(),TB=t.UserWaitNotice=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(r,i){return i||(i=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&i.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&i.uint32(26).string(r.user),i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.UserWaitNotice;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.instance=r.uint64();break;case 2:o.seq=r.uint64();break;case 3:o.user=r.string();break;default:r.skipType(7&s)}}return o},e}(),UB=t.SubscribeResponse=function(){function e(r){if(this.errors=[],r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.errors=q.emptyArray,e.encode=function(r,i){if(i||(i=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&i.uint32(8).uint64(r.seq),r.errors!=null&&r.errors.length)for(var o=0;o<r.errors.length;++o)t.SubscribeResponse.SubscribeErrorsType.encode(r.errors[o],i.uint32(18).fork()).ldelim();return i},e.decode=function(r,i){r instanceof u||(r=u.create(r)),i=i===void 0?r.len:r.pos+i;for(var o=new t.SubscribeResponse;r.pos<i;){var s=r.uint32();switch(s>>>3){case 1:o.seq=r.uint64();break;case 2:o.errors&&o.errors.length||(o.errors=[]),o.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(r,r.uint32()));break;default:r.skipType(7&s)}}return o},e.SubscribeErrorsType=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.account="",r.prototype.code=0,r.encode=function(i,o){return o||(o=L.create()),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&o.uint32(10).string(i.account),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&o.uint32(16).uint32(i.code),o},r.decode=function(i,o){i instanceof u||(i=u.create(i)),o=o===void 0?i.len:i.pos+o;for(var s=new t.SubscribeResponse.SubscribeErrorsType;i.pos<o;){var l=i.uint32();switch(l>>>3){case 1:s.account=i.string();break;case 2:s.code=i.uint32();break;default:i.skipType(7&l)}}return s},r}(),e}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(e){return function(r,i,o){var s=(r=String(jb(r))).length;return o=o===void 0?" ":String(o),(i=ta(i))<=s||o==""?r:(i-=s,(s=Pn.call(o,WB(i/o.length))).length>i&&(s=s.slice(0,i)),e?r+s:s+r)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(e){return YB(this,e,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(e){return function(r){r=qb(r);for(var i,o=Dc(r),s=o.length,l=0,d=[];s>l;)i=o[l++],ka&&!ZB.call(r,i)||d.push(e?[i,r[i]]:r[i]);return d}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(e){return $B(e)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var e=bC(String.prototype,"endsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(e){var r=String(jb(this));ck(e);var i=1<arguments.length?arguments[1]:void 0,o=ta(r.length);return i=i===void 0?o:cC(ta(i),o),o=String(e),Br?Br.call(r,o,i):r.slice(i-o.length,i)===o}}),dh("match",1,function(e,r,i){return[function(o){var s=jb(this),l=o?.[e];return l!==void 0?l.call(o,s):new RegExp(o)[e](String(s))},function(o){var s=i(r,o,this);if(s.done)return s.value;if(o=va(o),s=String(this),!o.global)return Ke(o,s);var l=o.unicode;o.lastIndex=0;for(var d,h=[],p=0;(d=Ke(o,s))!==null;)d=String(d[0]),h[p]=d,d===""&&(o.lastIndex=xj(s,ta(o.lastIndex),l)),p++;return p===0?null:h}]});var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var e=eC(String.prototype,"startsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(e){var r=String(jb(this));ck(e);var i=ta(fC(1<arguments.length?arguments[1]:void 0,r.length)),o=String(e);return Dr?Dr.call(r,o,i):r.slice(i,i+o.length)===o}});var Nm=function(e){var r=/(%?)(%([jds]))/g,i=Array.prototype.slice.call(arguments,1);return i.length&&(e=e.replace(r,function(o,s,l,d){switch(l=i.shift(),d){case"s":l=""+l;break;case"d":l=Number(l);break;case"j":l=JSON.stringify(l)}return s?(i.unshift(l),o):l})),i.length&&(e+=" "+i.join(" ")),""+(e=e.replace(/%{2,2}/g,"%"))},hC=/\s/,iC=function(e){for(var r=e.length;r--&&hC.test(e.charAt(r)););return r},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(e){if(typeof e=="number")return e;if(ie(e))return Fr;if(lb(e)&&(e=typeof e.valueOf=="function"?e.valueOf():e,e=lb(e)?e+"":e),typeof e!="string")return e===0?e:+e;e=e&&e.slice(0,iC(e)+1).replace(jC,"");var r=lC.test(e);return r||mC.test(e)?nC(e.slice(2),r?2:8):kC.test(e)?Fr:+e},oC=Math.max,pC=Math.min,qC=function(e,r,i){function o(j){var z=p,_t=f;return p=f=void 0,C=j,_=e.apply(_t,z)}function s(j){var z=j-b;return j-=C,b===void 0||z>=r||0>z||A&&j>=x}function l(){var j=Cb.Date.now();if(s(j))return d(j);var z=setTimeout,_t=j-C;j=r-(j-b),_t=A?pC(j,x-_t):j,g=z(l,_t)}function d(j){return g=void 0,P&&p?o(j):(p=f=void 0,_)}function h(){var j=Cb.Date.now(),z=s(j);if(p=arguments,f=this,b=j,z){if(g===void 0)return C=j=b,g=setTimeout(l,r),k?o(j):_;if(A)return clearTimeout(g),g=setTimeout(l,r),o(b)}return g===void 0&&(g=setTimeout(l,r)),_}var p,f,_,g,b,C=0,k=!1,A=!1,P=!0;if(typeof e!="function")throw new TypeError("Expected a function");if(r=gl(r)||0,lb(i)){k=!!i.leading;var x=(A="maxWait"in i)?oC(gl(i.maxWait)||0,r):x;P="trailing"in i?!!i.trailing:P}return h.cancel=function(){g!==void 0&&clearTimeout(g),C=0,p=b=f=g=void 0},h.flush=function(){return g===void 0?_:d(Cb.Date.now())},h},yc=function(e){function r(o,s){return W(this,r),m(n(o=i.call(this,Mm(o,s))),"originalError",void 0),m(n(o),"code",void 0),m(n(o),"serverCode",void 0),typeof s=="number"?o.code=s:typeof s=="string"?o.name=s:s!==void 0&&(s.originalError&&(o.originalError=s.originalError),s.code!==void 0&&(o.code=s.code),s.serverCode!==void 0&&(o.serverCode=s.serverCode)),o}la(r,e);var i=ma(r);return r}(ef(Error)),Ia=function(e){function r(o,s){return W(this,r),m(n(o=i.call(this,Mm(o,s))),"name","RtmInternalError"),m(n(o),"code",void 0),o.code=s,o}la(r,e);var i=ma(r);return r}(ef(Error)),Ph=function(){return function(e){function r(o){W(this,r);var s=Object.keys(o);return i.call(this,o[s[0]],s[0])}la(r,e);var i=ma(r);return r}(Ia)},Fa=Ph(),db=function(e){function r(){W(this,r);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return m(n(o=i.call.apply(i,[this].concat(s))),"name","RtmTimeoutError"),o}la(r,e);var i=ma(r);return r}(yc),I=function(e){function r(){W(this,r);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return m(n(o=i.call.apply(i,[this].concat(s))),"name","RtmInvalidArgumentError"),o}la(r,e);var i=ma(r);return r}(yc),K=function(e){function r(){W(this,r);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return m(n(o=i.call.apply(i,[this].concat(s))),"name","RtmInvalidStatusError"),o}la(r,e);var i=ma(r);return r}(yc),hl=function(e){function r(){W(this,r);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return m(n(o=i.call.apply(i,[this].concat(s))),"name","RtmInterruptedError"),o}la(r,e);var i=ma(r);return r}(yc),ib=function(e){function r(){W(this,r);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return m(n(o=i.call.apply(i,[this].concat(s))),"name","RtmLimitExceededError"),o}la(r,e);var i=ma(r);return r}(yc),rC=function(e){function r(){W(this,r);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return m(n(o=i.call.apply(i,[this].concat(s))),"name","RtmInvokeTooOftenError"),o}la(r,e);var i=ma(r);return r}(yc),da=function(e){function r(){W(this,r);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return m(n(o=i.call.apply(i,[this].concat(s))),"name","RtmUnavailableError"),m(n(o),"serverCode",void 0),m(n(o),"statusCode",void 0),o}la(r,e);var i=ma(r);return r}(yc),Ye=function(e){function r(){W(this,r);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return m(n(o=i.call.apply(i,[this].concat(s))),"name","RtmUnauthenticatedError"),m(n(o),"serverCode",void 0),o}la(r,e);var i=ma(r);return r}(yc),Wc=function(e){function r(){W(this,r);for(var o=arguments.length,s=Array(o),l=0;l<o;l++)s[l]=arguments[l];return m(n(o=i.call.apply(i,[this].concat(s))),"name","RtmUnknownError"),o}la(r,e);var i=ma(r);return r}(yc),Sa=function(e){return e instanceof db||e instanceof pb},sa=function(e){return e instanceof yc},Yd=function(e,r,i){return['Executing "%s.%s" timed out after %ds',e,r,i/1e3]},Lm=new Map,sC=function(){var e=new Date;return"".concat(e.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(e){return typeof e=="string"?e.endsWith(".")?e:"".concat(e,"."):e},Sm=function(e){for(var r="",i=(e=new Uint8Array(e)).byteLength,o=-1;++o<i;)r+=String.fromCharCode(e[o]);return r=btoa(r),"data:;base64,".concat(r)},tC=R(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});N({target:"Date",proto:!0,forced:tC},{toJSON:function(e){e=Qa(this);var r=lc(e);return typeof r!="number"||isFinite(r)?e.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(e,r,i){return JSON.stringify(Ym(e),r,i)};Gr.ensureProperties=Ym;var uC=function(e,r){r=r||{};var i=X(e);if(i==="string"&&0<e.length)return au(e);if(i==="number"&&isFinite(e))return r.long?e=864e5<=(r=Math.abs(e))?Jg(e,r,864e5,"day"):36e5<=r?Jg(e,r,36e5,"hour"):6e4<=r?Jg(e,r,6e4,"minute"):1e3<=r?Jg(e,r,1e3,"second"):e+" ms":e=864e5<=(r=Math.abs(e))?Math.round(e/864e5)+"d":36e5<=r?Math.round(e/36e5)+"h":6e4<=r?Math.round(e/6e4)+"m":1e3<=r?Math.round(e/1e3)+"s":e+"ms",e;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},vC=function(e){function r(s){function l(){for(var p=arguments.length,f=Array(p),_=0;_<p;_++)f[_]=arguments[_];if(l.enabled){p=Number(new Date),l.diff=p-(d||p),l.prev=d,d=l.curr=p,f[0]=r.coerce(f[0]),typeof f[0]!="string"&&f.unshift("%O");var g=0;f[0]=f[0].replace(/%([a-zA-Z%])/g,function(b,C){return b==="%%"?"%":(g++,typeof(C=r.formatters[C])=="function"&&(b=C.call(l,f[g]),f.splice(g,1),g--),b)}),r.formatArgs.call(l,f),(l.log||r.log).apply(l,f)}}var d,h=null;return l.namespace=s,l.useColors=r.useColors(),l.color=r.selectColor(s),l.extend=i,l.destroy=r.destroy,Object.defineProperty(l,"enabled",{enumerable:!0,configurable:!1,get:function(){return h===null?r.enabled(s):h},set:function(p){h=p}}),typeof r.init=="function"&&r.init(l),l}function i(s,l){return(s=r(this.namespace+(l===void 0?":":l)+s)).log=this.log,s}function o(s){return s.toString().substring(2,s.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(s){return s instanceof Error?s.stack||s.message:s},r.disable=function(){var s=[].concat(G(r.names.map(o)),G(r.skips.map(o).map(function(l){return"-"+l}))).join(",");return r.enable(""),s},r.enable=function(s){r.save(s),r.names=[],r.skips=[];var l,d=(typeof s=="string"?s:"").split(/[\s,]+/),h=d.length;for(l=0;l<h;l++)d[l]&&((s=d[l].replace(/\*/g,".*?"))[0]==="-"?r.skips.push(new RegExp("^"+s.substr(1)+"$")):r.names.push(new RegExp("^"+s+"$")))},r.enabled=function(s){if(s[s.length-1]==="*")return!0;var l,d=0;for(l=r.skips.length;d<l;d++)if(r.skips[d].test(s))return!1;for(d=0,l=r.names.length;d<l;d++)if(r.names[d].test(s))return!0;return!1},r.humanize=uC,r.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(function(s){r[s]=e[s]}),r.names=[],r.skips=[],r.formatters={},r.selectColor=function(s){for(var l=0,d=0;d<s.length;d++)l=(l<<5)-l+s.charCodeAt(d),l|=0;return r.colors[Math.abs(l)%r.colors.length]},r.enable(r.load()),r},Hr=$a(function(e,r){r.formatArgs=function(o){if(o[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+o[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var s="color: "+this.color;o.splice(1,0,s,"color: inherit");var l=0,d=0;o[0].replace(/%[a-zA-Z%]/g,function(h){h!=="%%"&&(l++,h==="%c"&&(d=l))}),o.splice(d,0,s)}},r.save=function(o){try{o?r.storage.setItem("debug",o):r.storage.removeItem("debug")}catch{}},r.load=function(){try{var o=r.storage.getItem("debug")}catch{}return!o&&typeof process<"u"&&"env"in process&&(o=process.env.DEBUG),o},r.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};t:{try{var i=localStorage;break t}catch{}i=void 0}r.storage=i,r.destroy=function(){var o=!1;return function(){o||(o=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),r.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),r.log=console.debug||console.log||function(){},e.exports=vC(r),e.exports.formatters.j=function(o){try{return JSON.stringify(o)}catch(s){return"[UnexpectedJSONParseError]: "+s.message}}}),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function e(r){W(this,e),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=r.processId,this.sdkVersion=r.sdkVersion,this.rtmConfig=r.rtmConfig,this.uploadRequest=r.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(e,[{key:"upload",value:function(r){this.LogCache.push(r),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(r){var i=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark(function o(){var s,l,d;return w.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return s={sdk_version:i.sdkVersion,process_id:i.processId,payload:JSON.stringify(r)},h.prev=1,h.next=4,i.uploadRequest(s,(l=i.rtmConfig.enableCloudProxy)!==null&&l!==void 0&&l);case 4:if(!Uk){h.next=6;break}throw Error("RTM is busy");case 6:h.next=13;break;case 8:return h.prev=8,h.t0=h.catch(1),d=2>i.uploadResendCount++?2e3:1e4,setTimeout(function(){return i.postLog(i.LogsToPost)},d),h.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),i.LogCache.length!==0){h.next=17;break}return i.uploadState=Ze.Free,h.abrupt("return");case 17:i.uploadResendCount=0,i.LogsToPost=40>i.LogCache.length?i.LogCache.splice(0,i.LogCache.length):i.LogCache.splice(0,40),i.postLog(i.LogsToPost);case 20:case"end":return h.stop()}},o,null,[[1,8]])})),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e}(),Jr=function(e,r,i,o,s,l,d,h){var p=0;for(d=!!d&&Id(d,h,3);p<o;){if(p in i){if(h=d?d(i[p],p,r):i[p],0<l&&gd(h))s=Jr(e,r,h,ta(h.length),s,l-1)-1;else{if(9007199254740991<=s)throw TypeError("Exceed the acceptable array length");e[s]=h}s++}p++}return s},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,r=Qa(this),i=ta(r.length),o=Sg(r,0);return o.length=xC(o,r,r,i,0,e===void 0?1:$b(e)),o}}),N({target:"Object",stat:!0},{values:function(e){return aC(e)}});var yC=["CODE"],Db,ud,F;(function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"})(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(e){return Object.values(yf).flat().includes(e)},cu=function(e){var r;return(r=Hg(yf).find(function(i){return(i=ra(i,2))[0],i[1].includes(e)}))===null||r===void 0?void 0:r[0]},AC=function(e){return e.sort(function(r,i){return Kr.indexOf(r)-Kr.indexOf(i)})},xe=function(e){var r=new Set;if((e=AC(e).slice(0,3).map(function(i){var o=Kg[i];if(o===void 0)throw new Ia("invalid area key");return i=o.CODE,o=ff(o,yC),r.add(i),o})).length===0)throw new Ia("areas cannot be empty");return ua({CODES:r},e.reduce(function(i,o){for(var s=0,l=Hg(i);s<l.length;s++){var d=ra(l[s],2),h=d[0];d=d[1],i[h]=Array.from(new Set([].concat(G(o[h]),G(d))))}return i}))},M,Lr=function(){var e=J(w.mark(function r(i,o){var s,l,d,h,p,f=arguments;return w.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!(2<(l=2<f.length&&f[2]!==void 0?f[2]:0))){_.next=3;break}return _.abrupt("return");case 3:return d={withCredentials:!0,body:i,timeout:2e4},h=0<l?M?.LOG_UPLOAD_SERVER[0]||"rtm.logservice.sd-rtn.com":M?.LOG_UPLOAD_SERVER[0]||"logservice-rtm.agora.io",p=o?"https://".concat((s=M?.PROXY_NGINX[0])!==null&&s!==void 0?s:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(h,"&p=443&d=upload/v1"):"https://".concat(h,"/upload/v1"),_.next=8,te(p,d).catch(function(g){return Lr(i,o,l+1)});case 8:case"end":return _.stop()}},r)}));return function(r,i){return e.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(e){if(typeof e=="string")return oa(e);if(Array.isArray(e)&&e.every(function(l){return typeof l=="string"}))return e.map(function(l){return oa(l)});if(!Il(e)){for(var r={},i=0;i<Or.length;i++){var o=Or[i];o in e&&(r[o]=e[o])}if(0<Object.keys(r).length)return r;if(5>Object.keys(e).length){for(i=0,e=Object.entries(e);i<e.length;i++){var s=ra(e[i],2);o=s[0],s=s[1],il.includes(o)?r[o]="[Hidden Info]":r[oa(o)]=typeof s=="string"?oa(s):"[Sensitive Info]"}return r}return"[Sensitive Info]"}return e},Pr=function(e){return X(e)==="object"?yd(e)?Vm(fe(e,5),il,Nr):e.constructor&&e.constructor.name:e},Qr=function(e,r){return e instanceof Error?e.message:typeof e!="string"?JSON.stringify(Vm(fe(e,5),il,Nr)):(r=r.map(function(i){return i instanceof Error?i.message:X(i)==="object"?Gr(Array.isArray(i)?i.map(Pr):Pr(i)):i}),Nm.apply(void 0,[e.replace(/%[%Oo]/g,function(i){return i==="%%"?"%":i==="%o"||i==="%O"?"%s":i})].concat(G(r))))},CC=1,Rr=function(e,r,i){var o=Hr(e);return o.enabled=!0,o.log=i,o.useColors=!1,function(s){for(var l=arguments.length,d=Array(1<l?l-1:0),h=1;h<l;h++)d[h-1]=arguments[h];if(r.enableLogUpload){l=Cg(s);var p=Qr(l,d);Mr.upload({log_item_id:"".concat(CC++),log_level:e,payload_str:"[".concat(sC(),"] ").concat(e," - ").concat(256<p.length?p.slice(0,256):p)})}switch(l=function(f){var _=p||Qr(Cg(s),d),g=Nc.LOG_HANDLER;typeof g=="function"&&g({level:f,message:_}),o(_)},e){case"RTM:INFO":r.logFilter.info&&l("log");break;case"RTM:WARN":r.logFilter.warn&&l("warning");break;case"RTM:ERROR":r.logFilter.error&&l("error");break;case"RTM:TRACK":r.logFilter.track&&l("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":r.logFilter.debug&&l("debug");break;case"RTM:DEBUG":r.logFilter.debug&&l("debug")}}},jl,Sr=function(e){return function(r){var i=jl===1||e===void 0?"":"Ins#".concat(e," ");return"".concat(i).concat(r)}},kl=function(e,r,i){var o=Sr(jl);return Rr("RTM:".concat(r),i,function(s){return e(o(s))})},tb=function(){return function(e){function r(o,s){var l=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,r);var d=i.call(this);if(m(n(d),"logError",void 0),m(n(d),"invokeTracker",void 0),m(n(d),"resultTracker",void 0),m(n(d),"errorTracker",void 0),m(n(d),"eventTracker",void 0),m(n(d),"info",void 0),m(n(d),"warn",void 0),m(n(d),"log",void 0),m(n(d),"genLogger",void 0),m(n(d),"loggerId",void 0),m(n(d),"logger",void 0),m(n(d),"name",void 0),d.logger=o,d.name=s,d.loggerId=o.loggerId,d.info=o.info,d.warn=o.warn,d.logError=o.logError,d.genLogger=o.genLogger,d.log=o.genLogger("RTM:DEBUG","<".concat(s,"> ")),d.invokeTracker=o.genTracker("Invoke"),d.eventTracker=o.genTracker("Event"),d.resultTracker=o.genTracker("Result"),d.errorTracker=o.genTracker("Error"),l){var h=d.emit.bind(n(d));d.emit=function(){for(var p=arguments.length,f=Array(p),_=0;_<p;_++)f[_]=arguments[_];p=f[0],_=f.slice(1);var g=BC.includes(p);d.eventTracker.apply(d,["%s: ".concat(0<_.length?"%s emitted with args: ".concat(_.map(function(){return"%o"})):"%s emitted"),s,p].concat(G(g?_.map(ye):_)));try{h.apply(void 0,f)}catch(b){d.logError("Caught in the callback function of the event %s",p,b)}}}return d}la(r,e);var i=ma(r);return r}(ea)},DC=function(e){return kl(console.log.bind(console),"INFO",e)},EC=function(e){return kl(console.warn.bind(console),"WARN",e)},FC=function(e){return kl(console.error.bind(console),"ERROR",e)},Tr=function(e,r){return function(i){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",s=Sr(e),l=console.debug.bind(console),d=Rr(i,r,function(h){return l(s(h))});return function(h){for(var p=arguments.length,f=Array(1<p?p-1:0),_=1;_<p;_++)f[_-1]=arguments[_];return d.apply(void 0,[o+h].concat(f))}}},GC=function(e,r){return function(i){return Tr(e,r)("RTM:TRACK","[".concat(i,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(e,r){var i=-1,o=e.length,s=o-1;for(r=r===void 0?o:r;++i<r;){var l=e[o=nr(i,s)];e[o]=e[i],e[i]=l}return e.length=r,e},IC=function(e){return Ur(Xh(e))},JC=function(e){return Ur(Ni(e))},$e=function(e){return(Va(e)?IC:JC)(e)},af={0:9591,1:9593},$d=function(e){return"https://".concat(e,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(e){function r(o,s,l,d,h,p){W(this,r);var f=i.call(this,h,Ai("Socket-",h.loggerId));if(m(n(f),"isActiveClose",!1),m(n(f),"loggedIn",!1),m(n(f),"useNewDomain",void 0),m(n(f),"receivedPacket",new Pa),m(n(f),"open$",void 0),m(n(f),"input$",new Pa),m(n(f),"userJoin$",new Pa),m(n(f),"attemptsSinceLastError",0),m(n(f),"message$",new Pa),m(n(f),"socket$",void 0),m(n(f),"toClose",new Pa),m(n(f),"toReconnect",new Pa),m(n(f),"sendLogger",void 0),m(n(f),"receiveLogger",void 0),m(n(f),"ip",void 0),m(n(f),"env",void 0),m(n(f),"ticket",void 0),m(n(f),"context",void 0),m(n(f),"getDomain",function(){return an(f.ip,f.useNewDomain)}),m(n(f),"socketReconnector",function(b){var C=function(k){return f.attemptsSinceLastError+=1,f.warn("The %s of Env %d reconnecting %s",f.name,f.env,k.message),Bc(3e3)};return b.pipe(Ga(function(k){return f.log("socket connection closed"),f.loggedIn=!1,2<=f.attemptsSinceLastError?(f.warn("socket connection failure"),f.emit("connectionFailure"),f.close(),Z(k)):f.isActiveClose?vb:(f.emit("reconnect"),f.useNewDomain=!f.useNewDomain,Z(k))}),oe(function(k){return k.pipe(Cc(C))}))}),f.ip=o,f.env=s,f.ticket=l,f.context=d,f.useNewDomain=p??.5<=Math.random(),f.sendLogger=f.genLogger("RTM:MSG:SEND"),f.receiveLogger=f.genLogger("RTM:MSG:RECV"),s!==0&&s!==1)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(o))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var _=af[s];f.log("Opening websocket address %s for the Env %d",f.ip,f.env);var g=Xb(f.input$,f.userJoin$.pipe(Rt(2)),f.message$).pipe(ba(function(b){return Oh.encode(b).finish()}));return o=Xb(St("",{protocols:[],makeWebSocket:function(){if(f.context.config.enableCloudProxy){if(f.context.cloudProxyServers.length===0)throw f.logError("No cloud proxy server to connect"),new da;var b="wss://".concat(an(bn(f.context.cloudProxyServers),!1),"/");b=we(b,"sid",f.context.sid),b=we(b,"remote_port",_.toString()),b=we(b,"remote_ip",f.ip),b=we(b,"token",f.context.key),b=new WebSocket(b)}else b=new WebSocket("wss://".concat(f.getDomain(),":").concat(_));return b.binaryType="arraybuffer",b}}),f.toReconnect),f.socket$=Ca(o,Tk.pipe(hb(15e3),Ga(function(b){return Sa(b)&&f.warn("socket open timed out"),Z(b)}))).pipe(ba(function(b){if(b instanceof Error)throw f.warn("Env_%d: Force reconnect the socket",f.env),b;return b(g).pipe(ba(function(C){return Oh.decode(new Uint8Array(C))}))}),f.socketReconnector),f.open$=f.socket$.pipe(ca(function(b){f.log("Websocket opened",f.name),b.subscribe(function(C){var k=C.data;C=Li[C.uri].slice(0,-3),k=$m[C].decode(k);var A=HA({},Gk(k,"toJSON"),function(z,_t){return _t instanceof U?Km(_t):_t}),P=!1;if((k instanceof vr||k instanceof ur)&&k.instance.lessThanOrEqual(4294967295)&&(P=!0),k instanceof wr||k instanceof xr){var x=k.instance,j=k.sequence;(k.dialogue.lessThanOrEqual(4294967295)||x.lessThanOrEqual(4294967295)||j.lessThan(1))&&(P=!0)}P?f.warn("Env_%d: Illegal %s, abandoned %o",f.env,C,A):(C!=="Pong"&&f.receiveLogger("Env_%d: %s %o",f.env,C,A),f.receivedPacket.next([C,k]))},function(){})}),qf(void 0),ob(f.toClose),pe()),f}la(r,e);var i=ma(r);return Ha(r,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(o,s){if(o!=="Ping"){var l=uc(s,function(d){return d instanceof U?Km(d):d});this.sendLogger("Env_%d: %s %o",this.env,o,l)}s=du(o,s),o==="UserJoin"?this.userJoin$.next(s):o==="Message"?this.message$.next(s):this.input$.next(s)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(o){var s=this;return this.receivedPacket.pipe(ca(function(l){var d=ra(l,2);l=d[0],d=d[1],l==="UserResp"&&(s.attemptsSinceLastError=0,s.loggedIn=!0),l==="UserDrop"&&s.emit("socketUserDrop",d)}),wb(function(l){return ra(l,1)[0]===o}),ba(function(l){return ra(l,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),r}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(e){return XB(this,e,1<arguments.length?arguments[1]:void 0)}});var OC=function(e){var r=xf(Kg);e=Yt(e);for(var i=0;i<r.length;i++){var o=Kg[r[i]];if(o!=null&&o.AP_DOMAINS.includes(e)||o!=null&&o.AP_BACKUP_DOMAINS.includes(e)||o!=null&&o.PROXY_AP.includes(e))return[o.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(e){function r(o,s){var l=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,r);var d=i.call(this,s,"AccessPoint");return m(n(d),"handleUniLbsError",function(h,p){var f=h;if(4<h.toString().length){var _=h.toString().padStart(8,"0"),g=parseInt(_.slice(0,4),10);if(_=parseInt(_.slice(4,8),10),g===201)f=_;else if(g===101&&!QC.includes(_))return Z(Error("service is currently unavailable"))}if(g=f.toString(),!Object.keys(Vr).includes(g))return(h=new da(["Login is rejected by the server. The response code is %d",h],jg)).serverCode=f,Z(h);switch(g=Vr[g],f=PC[g],g){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(p=new Ye(f,$q)).serverCode=h,Z(p);case"INVALID_USER_ID":return(p=new Ye(f,Jh)).serverCode=h,Z(p);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(p=new Ye(f,Kh)).serverCode=h,Z(p);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(p=new Ye(f,ar)).serverCode=h,Z(p);case"CANNOT_MEET_AREA_DEMAND":return(p=OC(p)).forEach(function(b){return d.failedAreas.add(b)}),d.failedAreas.size===(M===void 0?2:M.CODES.size)?((p=new I(f,jg)).serverCode=h,Z(p)):Z(Error("ap ".concat(p.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(p=new da(f,jg)).serverCode=h,Z(p);default:return Z(Im("ApResErrType",g))}}),m(n(d),"getApEdgeInfo$",void 0),m(n(d),"getApEdgeInfoEndFirst$",void 0),m(n(d),"apFinish$",new Pa),m(n(d),"retryCount",0),m(n(d),"failedAreas",new Set),m(n(d),"usedUrl",[]),m(n(d),"newDomainUsed",!1),m(n(d),"backupNewDomainUsed",!1),m(n(d),"genUrl",function(){return M===void 0?mi.apply(void 0,G($e([KC,LC]))).pipe(ni(function(h){return bb.apply(void 0,G(h))})):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))}),m(n(d),"genBackupUrl",function(){return M===void 0?mi.apply(void 0,G($e([MC,NC]))).pipe(ni(function(h){return bb.apply(void 0,G(h))})):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))}),m(n(d),"getApUrl$",function(h){var p,f;return d.genUrl().pipe(wb(function(_){return(!d.newDomainUsed||!_.includes("sd-rtn.com"))&&(_.includes("sd-rtn.com")&&(d.newDomainUsed=!0),!dl(d.usedUrl,function(g){var b;return g===((b=_.match(Qh))===null||b===void 0?void 0:b[1])}))}),ca(function(_){var g;M===void 0&&typeof(_=(g=_.match(Qh))===null||g===void 0?void 0:g[1])=="string"&&d.usedUrl.push(_)}),Ka(h?Math.max(Nc.RECONNECTING_AP_NUM,(p=M?.CODES.size)!==null&&p!==void 0?p:0):(f=M?.CODES.size)!==null&&f!==void 0?f:2),Dd(function(){return r.runOutOfUrlSymbol}),Ga(function(_,g){return d.newDomainUsed=!1,_===r.runOutOfUrlSymbol?(d.usedUrl=[],g):Z(_)}))}),m(n(d),"getBackupApUrl$",function(h){var p,f;return d.genBackupUrl().pipe(wb(function(_){return(!d.backupNewDomainUsed||!_.includes("sd-rtn.com"))&&(_.includes("sd-rtn.com")&&(d.backupNewDomainUsed=!0),!dl(d.usedUrl,function(g){var b;return g===((b=_.match(Qh))===null||b===void 0?void 0:b[1])}))}),ca(function(_){var g;M===void 0&&typeof(_=(g=_.match(Qh))===null||g===void 0?void 0:g[1])=="string"&&d.usedUrl.push(_)}),Ka(h?Math.max(Nc.RECONNECTING_AP_NUM,(p=M?.CODES.size)!==null&&p!==void 0?p:0):(f=M?.CODES.size)!==null&&f!==void 0?f:2),Dd(function(){return r.runOutOfUrlSymbol}),Ga(function(_,g){return d.backupNewDomainUsed=!1,_===r.runOutOfUrlSymbol?(d.usedUrl=[],g):Z(_)}))}),m(n(d),"getProxyApUrl$",function(h){var p,f;return bb.apply(void 0,G((M?.PROXY_AP.slice(0,3)||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(h?Math.max(Nc.RECONNECTING_AP_NUM,(p=M?.CODES.size)!==null&&p!==void 0?p:0):(f=M?.CODES.size)!==null&&f!==void 0?f:2))}),m(n(d),"context",void 0),m(n(d),"fetchCloudProxy",function(h,p){var f=Ai("AP-",d.loggerId);d.log("The AccessPoint requests %s(%s)",h,f);var _=new AbortController;return d.apFinish$.pipe(Ka(1)).subscribe(function(){return _.abort()}),ad(J(w.mark(function g(){var b;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return b=Ag(0,Number.MAX_SAFE_INTEGER),d.log("%s request opid: %d",f,b),C.abrupt("return",te(h,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:d.context.sid,opid:b,appid:d.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:p??d.context.key,cname:d.context.uid,uid:0,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(k){return k===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):k}).join(",")})}}]},signal:_.signal}));case 3:case"end":return C.stop()}},g)}))).pipe(Ga(function(g){return g.name!=="AbortError"&&(d.logError(g),d.warn("The AP server %s request failure",h,g)),vb}),cb(function(){var g=J(w.mark(function b(C){var k,A,P,x,j,z,_t,ue,_n,Ei,_s,kc,_i,_h,_p,Qm,_o,ga,vf;return w.wrap(function(Fi){for(;;)switch(Fi.prev=Fi.next){case 0:if(k=C.responseText,A=JSON.parse(k),d.log("The %s response is %o",f,A),((P=A.response_body)===void 0||P.length===0||P.some(function(Gi){var _d;return((_d=Gi.buffer)===null||_d===void 0?void 0:_d.code)===void 0||Gi.uri!==23}))&&Z(new da("cloud proxy response_body not valid",jg)),(x=P.filter(function(Gi){return Gi.buffer.code!==0})).length===0){Fi.next=14;break}if((j=x.find(function(Gi){return Gi.buffer.flag===128}))===void 0){Fi.next=12;break}return Fi.abrupt("return",d.handleUniLbsError(j.buffer.code,h));case 12:return d.logError("cloud proxy error response"),Fi.abrupt("return",d.handleUniLbsError(x[0].buffer.code,h));case 14:for(z=[],_t=0;_t<P.length;_t++)if(((Ei=P[_t])==null||(ue=Ei.buffer)===null||ue===void 0?void 0:ue.flag)===262144)(_s=Ei.buffer)===null||_s===void 0||(kc=_s.edges_services)===null||kc===void 0||(_i=kc.forEach)===null||_i===void 0||_i.call(kc,function(Gi){Gm(Gi=Gi.ip)&&d.context.cloudProxyServers.indexOf(Gi)===-1&&(d.log("got cloud proxy server: %s",Gi),d.context.cloudProxyServers.push(Gi))});else if((Ei==null||(_n=Ei.buffer)===null||_n===void 0?void 0:_n.flag)===128){for(_o=function(Gi,_d){var Di=_d[Gi];z.some(function(H){return H.ip===Di.ip})||z.push({ip:Di.ip,ticket:Ei.buffer.cert})},ga=0,vf=Ei.buffer.edges_services;ga<vf.length;ga++)_o(ga,vf);d.context.rtmArea=(_h=(_p=Ei.buffer)===null||_p===void 0||(Qm=_p.detail)===null||Qm===void 0?void 0:Qm[9])!==null&&_h!==void 0?_h:""}return Fi.abrupt("return",bb.apply(void 0,G(z).concat([fg])));case 19:case"end":return Fi.stop()}},b)}));return function(b){return g.apply(this,arguments)}}()),Ga(function(g){return sa(g)?Z(g):vb}),tg(),wb(function(g){return g!==void 0&&typeof g.ip=="string"&&typeof g.ticket=="string"}))}),m(n(d),"fetchAp",function(h,p){var f=Ai("AP-",d.loggerId);d.log("The AccessPoint requests %s(%s)",h,f);var _=new AbortController;return d.apFinish$.pipe(Ka(1)).subscribe(function(){return _.abort()}),ad(J(w.mark(function g(){var b;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return b=Ag(0,Number.MAX_SAFE_INTEGER),d.log("%s request opid: %d",f,b),C.abrupt("return",te(h,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:b,key:p||d.context.key,cname:d.context.uid,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(k){return k===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):k}).join(",")}),uid:0,sid:d.context.sid},signal:_.signal}));case 3:case"end":return C.stop()}},g)}))).pipe(Ga(function(g){return g.name!=="AbortError"&&(d.logError(g),d.warn("The AP server %s request failure",h,g)),vb}),cb(function(){var g=J(w.mark(function b(C){var k,A,P,x,j,z,_t;return w.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(k=C.responseText,A=JSON.parse(k),d.log("The %s response is %o",f,A),x=(P=A).code,j=P.addresses,z=P.detail,x===0){ue.next=6;break}return ue.abrupt("return",d.handleUniLbsError(x,h));case 6:if((_t=j).length!==0){ue.next=11;break}return ue.abrupt("return",Z(Error("No available edge address to connect")));case 11:return d.context.rtmArea=z?.[9],ue.abrupt("return",bb.apply(void 0,G(_t).concat([fg])));case 13:case"end":return ue.stop()}},b)}));return function(b){return g.apply(this,arguments)}}()),tg(),Ga(function(g){return sa(g)?Z(g):vb}),wb(function(g){return g!==void 0&&typeof g.ip=="string"&&typeof g.ticket=="string"}))}),d.context=o,d.getApEdgeInfoEndFirst$=function(){var h=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return Bc(0,h||l?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca(function(){d.retryCount+=1}),cb(function(){return d.context.config.enableCloudProxy?d.getProxyApUrl$(h||l):(4<=d.retryCount&&(d.retryCount=0),3>=d.retryCount?d.getApUrl$(h||l):d.getBackupApUrl$(h||l))}),cb(function(p){return d.context.config.enableCloudProxy?d.fetchCloudProxy(p):d.fetchAp(p)}),Ga(function(p){return p instanceof pb&&d.warn("AP request timeout"),Z(p)}),om(function(p){return p.ip}),ob(d.apFinish$))},d.getApEdgeInfo$=function(h){return Bc(0,h||l?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca(function(){d.retryCount+=1}),cb(function(){return d.context.config.enableCloudProxy?d.getProxyApUrl$(h||l):3>=d.retryCount?d.getApUrl$(h||l):d.getBackupApUrl$(h||l)}),cb(function(p){return(d.context.config.enableCloudProxy?d.fetchCloudProxy(p):d.fetchAp(p)).pipe()}),Ga(function(p){return p instanceof pb&&d.warn("AP request timeout"),Z(p)}),om(function(p){return p.ip}),ob(d.apFinish$))},d}la(r,e);var i=ma(r);return Ha(r,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),r}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(e){function r(o,s,l){W(this,r);var d=i.call(this,s,"Connection");m(n(d),"apClient",void 0),m(n(d),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(d),"curOpenSockets",[void 0,void 0]),m(n(d),"ipIterator",0),m(n(d),"firstEnv",.5<=Math.random()?1:0),m(n(d),"firstSocketOpener",void 0),m(n(d),"secondSocketOpener",void 0),m(n(d),"firstOpenKeeperSubject",new Pa),m(n(d),"secondOpenKeeperSubject",new Pa),m(n(d),"edgeInfoReplayed",void 0),m(n(d),"firstEnvOpenSocket",void 0),m(n(d),"firstOpenKeeperSub",void 0),m(n(d),"secondOpenKeeperSub",void 0),m(n(d),"context",void 0),m(n(d),"logger",void 0),d.context=o,d.logger=s,d.apClient=new Wr(d.context,s),d.apClient.apFinish$.subscribe(function(){d.log("Ap client fetch finished")});var h,p=[];return d.edgeInfoReplayed=d.apClient.getApEdgeInfo$(l).pipe(oe(function(f){return f.pipe(ca(function(_){if(sa(_))throw _}),cd(l?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))}),wb(function(f){return!dl(p,f)}),Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),ca(function(f){p.push(f),d.log("An edge info got %o",f)}),ca({error:function(f){d.emit("connectionInitFailure",f)}}),wg(function(){d.apClient.clearUp()}),sm()),d.firstEnvOpenSocket=d.edgeInfoReplayed.pipe(cb(function(f){if(f===void 0)return Z(Error("Invalid edge info"));var _=new ml(f.ip,d.firstEnv,f.ticket,d.context,s,h);return d.firstEnv=d.firstEnv===1?0:1,_.on("connectionFailure",function(){return d.onSocketConnectionFailure(_)}),h=!_.useNewDomain,_.open$.pipe(qf(_))}),ca(function(f){d.log("The websocket of ENV_%d opened to %s:%d",f.env,f.ip,af[f.env]),d.curOpenSockets[f.env]=f,d.lastOpenSockets[f.env].next(f),d.firstEnv=f.env,d.openSecondSocket(f.env,f.ip,f.useNewDomain)}),Ka(1),pe()),d.firstSocketOpener=d.firstEnvOpenSocket.pipe(cb(function(f){return f.open$.pipe(ca(function(){d.log("The websocket of first ENV_%d re-opened to %s:%d",f.env,f.ip,af[f.env]),d.curOpenSockets[f.env]=f,d.lastOpenSockets[f.env].next(f)}))})),o=d.firstOpenKeeperSubject.pipe(Cc(Yc)),d.firstOpenKeeperSub=o.subscribe({error:d.logError}),d}la(r,e);var i=ma(r);return Ha(r,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(o,s){if(![0,1].includes(o))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var l=o===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var d=this.curOpenSockets[o];this.curOpenSockets[o]=void 0,d&&(d.isActiveClose=!0,setTimeout(function(){d.close()},s)),l!==void 0&&setTimeout(function(){l?.unsubscribe()},s)}},{key:"waitClosing",value:function(o){var s=this;return o.isActiveClose=!0,o.open$.pipe(tt(),Ga(function(l){return l.message===mr.normalClosureMessage?vb:Z(l)}),hb(5e3),Ga(function(l){return l instanceof pb?(s.warn("Force closing the ENV_%d connection",o.env),vb):Z(l)}))}},{key:"onSocketConnectionFailure",value:function(o){var s=[0,1].filter(function(l){return l!==o.env})[0];(s=this.curOpenSockets[s])&&s.loggedIn?this.reopenSocketWithApRequest(o.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(o,s,l){var d=this,h=o===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm(function(p,f){return[].concat(G(p),[f])},[]),ba(function(p){return kr(p,function(f){return Jm(s,f.ip)}).slice(-1)[0]}),Ka(1),cb(function(p){if(p===void 0)return Z(Error("Invalid edge info"));var f=new ml(p.ip,h,p.ticket,d.context,d.logger,l);return f.on("connectionFailure",function(){return d.onSocketConnectionFailure(f)}),f.open$.pipe(ca(function(){d.lastOpenSockets[h].next(f),d.curOpenSockets[h]=f}))}),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(o){var s=this,l=[0,1].filter(function(p){return p!==o})[0];if((l=this.curOpenSockets[l])!==void 0){var d,h=l.ip;l=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),oe(function(p){return p.pipe(ca(function(f){if(f.code===Kh)s.emit("tokenExpired"),s.apClient.apFinish$.next(void 0);else if(sa(f))throw f}),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))}),ca(function(p){s.log("An edge info got %o",p)}),wg(function(){s.apClient.clearUp()})).pipe(rm(function(p,f){return[].concat(G(p),[f])},[]),ba(function(p){return(p=kr(p,function(f){return Jm(h,f.ip)})).length-1>=s.ipIterator?p.slice(-s.ipIterator++-1)[0]:(s.ipIterator=0,p.slice(-1)[0])}),Dd(),cb(function(p){if(p===void 0)return Z(Error("Invalid edge info"));var f=new ml(p.ip,o,p.ticket,s.context,s.logger,d);return f.on("connectionFailure",function(){return s.onSocketConnectionFailure(f)}),d=!f.useNewDomain,f.open$.pipe(qf(f))}),ca(function(p){s.log("The websocket of ENV_%d re-opened to %s:%d using ap",p.env,p.ip,af[p.env]),s.curOpenSockets[o]=p,s.lastOpenSockets[o].next(p)}),cb(function(p){return p.open$.pipe(ca(function(){s.log("The websocket of ENV_%d re-opened to %s:%d",p.env,p.ip,af[p.env]),s.curOpenSockets[o]=p,s.lastOpenSockets[o].next(p)}))}),pe()),o===this.firstEnv?this.firstOpenKeeperSubject.next(l):this.secondOpenKeeperSubject.next(l)}}}]),r}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.appId!=null&&Object.hasOwnProperty.call(r,"appId")&&i.uint32(42).string(r.appId),r.ver!=null&&Object.hasOwnProperty.call(r,"ver")&&i.uint32(50).string(r.ver),r.buildno!=null&&Object.hasOwnProperty.call(r,"buildno")&&i.uint32(56).int32(r.buildno),r.installId!=null&&Object.hasOwnProperty.call(r,"installId")&&i.uint32(66).string(r.installId),r.os!=null&&Object.hasOwnProperty.call(r,"os")&&i.uint32(128).int32(r.os),r.did!=null&&Object.hasOwnProperty.call(r,"did")&&i.uint32(138).string(r.did),r.index!=null&&Object.hasOwnProperty.call(r,"index")&&zc.Session.CommonIndex.encode(r.index,i.uint32(162).fork()).ldelim(),r.token!=null&&Object.hasOwnProperty.call(r,"token")&&i.uint32(170).string(r.token),r.version!=null&&Object.hasOwnProperty.call(r,"version")&&i.uint32(176).int32(r.version),r.subVersion!=null&&Object.hasOwnProperty.call(r,"subVersion")&&i.uint32(184).int32(r.subVersion),i},e.CommonIndex=function(){function r(i){if(i)for(var o=Object.keys(i),s=0;s<o.length;++s)i[o[s]]!=null&&(this[o[s]]=i[o[s]])}return r.prototype.index1="",r.prototype.index2="",r.prototype.index3="",r.encode=function(i,o){return o||(o=Xc.create()),i.index1!=null&&Object.hasOwnProperty.call(i,"index1")&&o.uint32(10).string(i.index1),i.index2!=null&&Object.hasOwnProperty.call(i,"index2")&&o.uint32(18).string(i.index2),i.index3!=null&&Object.hasOwnProperty.call(i,"index3")&&o.uint32(26).string(i.index3),o},r}(),e}(),SC=zc.Link=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.ec!=null&&Object.hasOwnProperty.call(r,"ec")&&i.uint32(40).int32(r.ec),r.sc!=null&&Object.hasOwnProperty.call(r,"sc")&&i.uint32(48).int32(r.sc),r.destServerIp!=null&&Object.hasOwnProperty.call(r,"destServerIp")&&i.uint32(58).string(r.destServerIp),r.ackedServerIp!=null&&Object.hasOwnProperty.call(r,"ackedServerIp")&&i.uint32(66).string(r.ackedServerIp),r.responseTime!=null&&Object.hasOwnProperty.call(r,"responseTime")&&i.uint32(72).int32(r.responseTime),i},e}(),TC=zc.Logout=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),i},e}(),UC=zc.KickedOff=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.linkId!=null&&Object.hasOwnProperty.call(r,"linkId")&&i.uint32(48).int32(r.linkId),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&i.uint32(56).int32(r.code),r.server!=null&&Object.hasOwnProperty.call(r,"server")&&i.uint32(66).string(r.server),r.serverCode!=null&&Object.hasOwnProperty.call(r,"serverCode")&&i.uint32(72).int32(r.serverCode),i},e}(),VC=zc.ChnJoin=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&i.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&i.uint32(56).int32(r.errCode),i},e}(),WC=zc.ChnJoinRes=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&i.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&i.uint32(56).int32(r.errCode),r.serverErrCode!=null&&Object.hasOwnProperty.call(r,"serverErrCode")&&i.uint32(64).int32(r.serverErrCode),i},e}(),XC=zc.ChnLeave=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&i.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&i.uint32(56).int32(r.errCode),i},e}(),YC=zc.ConnectionStateChange=function(){function e(r){if(r)for(var i=Object.keys(r),o=0;o<i.length;++o)r[i[o]]!=null&&(this[i[o]]=r[i[o]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(r,i){return i||(i=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&i.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&i.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&i.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&i.uint32(32).int64(r.elapse),r.oldState!=null&&Object.hasOwnProperty.call(r,"oldState")&&i.uint32(40).int32(r.oldState),r.newState!=null&&Object.hasOwnProperty.call(r,"newState")&&i.uint32(48).int32(r.newState),r.reason!=null&&Object.hasOwnProperty.call(r,"reason")&&i.uint32(56).int32(r.reason),r.reconnId!=null&&Object.hasOwnProperty.call(r,"reconnId")&&i.uint32(64).int32(r.reconnId),i},e}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(e){function r(o,s,l){return W(this,r),m(n(l=i.call(this,l,"Context")),"_token",void 0),m(n(l),"config",void 0),m(n(l),"_uid",void 0),m(n(l),"_sid",void 0),m(n(l),"_area","CN"),m(n(l),"appId",void 0),m(n(l),"enableCloudProxy",!1),m(n(l),"cloudProxyServers",[]),l.appId=o,l.config=s,l}la(r,e);var i=ma(r);return Ha(r,[{key:"token",set:function(o){this._token=typeof o=="string"&&o?o:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(o){if(this.log("The user ID is set to %s",oa(o)),!za(o))throw new Ia;this._uid=o}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(o){if(this.log("sid is set to %s",o),typeof o!="string"||!o)throw new Ia;this._sid=o}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(o){this.log("area is set to %s",o),typeof o=="string"&&o?this._area=o:this.warn("set area failed")}}]),r}(tb()),$C=!!Fc&&R(function(){Fc.prototype.finally.call({then:function(){}},function(){})});if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(e){var r=kd(this,mc("Promise")),i=typeof e=="function";return this.then(i?function(o){return mj(r,e()).then(function(){return o})}:e,i?function(o){return mj(r,e()).then(function(){throw o})}:e)}}),typeof Fc=="function"){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var e=J(w.mark(function r(i){return w.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.t0=Uint8Array,o.next=3,crypto.subtle.digest("SHA-256",i);case 3:return o.t1=o.sent,o.abrupt("return",new o.t0(o.t1));case 5:case"end":return o.stop()}},r)}));return function(r){return e.apply(this,arguments)}}(),$r=function(e){return Array.from(e).map(function(r){return r.toString(16).padStart(2,"0")}).join("")},bD=function(e){if(typeof e!="string")throw new TypeError("Expected input to be a string");if(e.length%2!=0)throw new RangeError("Expected string to be an even number of characters");for(var r=new Uint8Array(e.length/2),i=0;i<e.length;i+=2)r[i/2]=parseInt(e.substring(i,i+2),16);return r},as=function(e){return btoa(String.fromCharCode.apply(String,G(e))).replace(/={1,2}$/,"")},bs=function(){var e=J(w.mark(function r(i){var o;return w.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,crypto.subtle.digest("SHA-1",i);case 3:o=s.sent,s.next=9;break;case 6:s.prev=6,s.t0=s.catch(0),o=sha1.arrayBuffer(i);case 9:return s.abrupt("return",as(new Uint8Array(o)));case 10:case"end":return s.stop()}},r,null,[[0,6]])}));return function(r){return e.apply(this,arguments)}}(),cs=function(e,r,i,o){o[r]=!0,i.has(e)?i.get(e).add(r):i.set(e,new Set([r]))},cD=function(e){switch(e){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(e){function r(o,s,l,d){W(this,r);var h=i.call(this,l,"ChunkDownloadManager");if(m(n(h),"abortController",new AbortController),m(n(h),"downloadedSize",0),m(n(h),"successCount",0),m(n(h),"timer",void 0),m(n(h),"chunks",[]),m(n(h),"retUnit",void 0),m(n(h),"singleThread",!1),m(n(h),"initialized",!1),m(n(h),"ee",void 0),m(n(h),"chunkCount",void 0),m(n(h),"aborted",!1),m(n(h),"serverToIndices",new Map),m(n(h),"backupToIndices",new Map),m(n(h),"indexToBackupServers",[]),m(n(h),"busyBackupServers",new Map),m(n(h),"downloadingChunks",new Set),m(n(h),"metaInfo",void 0),m(n(h),"transHandler",void 0),h.metaInfo=o,h.transHandler=s,h.ee=d===void 0?new ea:d,l=o.size,o=o.unit,l===0)throw new Ia("size cannot be 0");return s.cancelSignal!==void 0&&s.cancelSignal.addEventListener("abort",function(){h.abortController.abort()},{once:!0}),h.abortController.signal.addEventListener("abort",function(){h.aborted=!0},{once:!0}),h.chunkCount=Math.ceil(l/(32768*o)),h}la(r,e);var i=ma(r);return Ha(r,[{key:"setInfoByResponse",value:function(o){var s=this,l=o.serverList,d=o.backupList;if(o=o.unit,l.length<this.chunkCount&&d.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var h=Array(this.chunkCount).fill(!1);if(l.forEach(function(p,f){return p.forEach(function(_){return cs(_,f,s.serverToIndices,h)})}),d.forEach(function(p,f){return p.forEach(function(_){return cs(_,f,s.backupToIndices,h)})}),h.some(function(){return!1}))throw new da("Not enough servers to download",mg);this.indexToBackupServers=d.map(function(p){return new Set(p)}),this.retUnit=o}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):this.serverToIndices.size===1&&Array.from(this.serverToIndices.keys())[0]===0?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(o){var s=this,l=this.downloadedSize+o;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=l,this.timer!==void 0&&o!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&this.successCount!==this.chunkCount&&(this.timer=setTimeout(function(){s.ee.emit("timedOut"),s.abortController.abort()},12e4)),this.initialized&&o===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var o=0,s=0,l=this.chunks;s<l.length;s++)o+=l[s].byteLength;if(o!==this.metaInfo.size)throw new Ia("invalid chunks total size");o=new Uint8Array(o),l=s=0;for(var d=this.chunks;l<d.length;l++){var h=d[l];o.set(new Uint8Array(h),s),s+=h.byteLength}return s=Array.from(o.subarray(0,4)).map(function(p){return p.toString(16)}).join("").toUpperCase(),Zt(o.buffer,cD(s))}},{key:"getDownloadUrl",value:function(o){var s=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(o).split(".").join("-"),".edge.").concat(s,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var o=J(w.mark(function s(l){var d,h=this,p=arguments;return w.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return d=1<p.length&&p[1]!==void 0&&p[1],f.next=3,Promise.all(Array.from(l.entries()).map(function(_){return _=ra(_,2),h.postDownloadRequest(_[0],Array.from(_[1]),d).catch(function(g){g.statusCode===404?(h.ee.emit("notExist"),h.abortController.abort()):g.name!=="AbortError"&&(Sa(g)?h.singleThread?(h.abortController.abort(),h.ee.emit("timedOut")):(h.warn("%d download timed out after %d, retrying use single thread",g.index,h.singleThread?6e4:3e4),h.abortController.abort(),h.singleThread=!0,h.ee.emit("multiTimeOut")):(h.ee.emit("error",g),h.abortController.abort()))})}));case 3:case"end":return f.stop()}},s)}));return function(s){return o.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var o=J(w.mark(function s(l,d,h){var p,f,_,g,b,C,k,A,P,x=this;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(P=function(){return(P=J(w.mark(function z(_t){var ue,_n,Ei,_s,kc,_i,_h,_p,Qm;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:if(_o.prev=0,_t!==void 0||l!==0){_o.next=5;break}throw new Ia("Invalid serverIp");case 5:ue=_t===void 0?k.getDownloadUrl(l):_t;case 6:return k.downloadingChunks.add(p),_o.next=9,C(ue);case 9:return _n=_o.sent,Ei=_n.responseData,k.downloadingChunks.delete(p),_o.abrupt("return",Ei);case 15:if(_o.prev=15,_o.t0=_o.catch(0),k.downloadingChunks.delete(p),d.unshift(p),k.metaInfo.useNewDomain=!1,_o.t0.name!=="AbortError"){_o.next=22;break}throw _o.t0;case 22:if(!Sa(_o.t0)){_o.next=25;break}throw _o.t0.index=p,_o.t0;case 25:if(_s=g,g+=1,!(2>_s)){_o.next=30;break}return _o.t0 instanceof Ia||k.warn("%o, %d download failed, retrying",_o.t0,p),_o.abrupt("return",A());case 30:if(_o.t0.statusCode!==504){_o.next=34;break}throw(kc=new db("download server timed out",{originalError:_o.t0,serverCode:504})).index=p,kc;case 34:if(!h||_s!==2||b[0]===0){_o.next=45;break}return _o.t0 instanceof Ia||k.warn("%d download failed, using backup: %d, %o",p,b[0],_o.t0),_o.next=38,k.busyBackupServers.get(b[0]);case 38:return _i=A(k.getDownloadUrl(b[0])),k.busyBackupServers.set(b[0],_i),_o.next=42,_i;case 42:return _h=_o.sent,k.busyBackupServers.delete(b[0]),_o.abrupt("return",_h);case 45:if(!(h&&2<_s&&b[1]!==void 0&&b[1]!==0)){_o.next=56;break}return k.warn("%d download failed, using backup 1: %d",p,b[1]),_o.next=49,k.busyBackupServers.get(b[1]);case 49:return _p=A(k.getDownloadUrl(b[1])),k.busyBackupServers.set(b[1],_p),_o.next=53,_p;case 53:return Qm=_o.sent,k.busyBackupServers.delete(b[1]),_o.abrupt("return",Qm);case 56:throw _o.t0.index=p,_o.t0;case 58:case"end":return _o.stop()}},z,null,[[0,15]])}))).apply(this,arguments)},A=function(z){return P.apply(this,arguments)},!this.aborted){j.next=4;break}throw new Ia("download already aborted");case 4:if((p=d.shift())!==void 0){j.next=8;break}return this.log("%s download finished",l),j.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){j.next=10;break}return j.abrupt("return");case 10:if(!this.downloadingChunks.has(p)){j.next=13;break}return this.log("%s already downloading, return",p),j.abrupt("return");case 13:if(this.chunks[p]===void 0){j.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",p),j.next=18,this.postDownloadRequest(l,d,h);case 18:return j.abrupt("return");case 19:return f=new FormData,_={hash:hu(this.metaInfo.hashHexStr),unit:this.retUnit===void 0?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:p},f.append("parameter",JSON.stringify(_)),g=0,b=Array.from(this.indexToBackupServers[p]),C=function(z){return te(z,{body:f,signal:x.abortController.signal,timeout:x.singleThread?12e4:3e4},{useBinaryResponse:!0})},k=this,j.next=28,A().then(function(z){return x.chunks[p]!==void 0?x.log("chunk %d download duplicated",p):(x.chunks[p]=z,x.log("chunk %d downloaded",p),x.successCount+=1,x.updateProgress(x.chunks[p].byteLength)),x.successCount===x.chunkCount&&(x.log("chunks all download"),x.ee.emit("finished")),x.singleThread?(x.downloadChunks(),Promise.resolve()):x.postDownloadRequest(l,d,h)});case 28:case"end":return j.stop()}},s,this)}));return function(s,l,d){return o.apply(this,arguments)}}()}]),r}(tb()),es=function(e){function r(o,s,l,d){W(this,r);var h=i.call(this,l,"ChunkUploadManager");if(m(n(h),"chunkCount",0),m(n(h),"chunks",[]),m(n(h),"uploadedChunks",[]),m(n(h),"totalFailures",0),m(n(h),"timer",void 0),m(n(h),"initState","uninitialized"),m(n(h),"ee",void 0),m(n(h),"unit",0),m(n(h),"uploadedSize",0),m(n(h),"singleThread",!1),m(n(h),"abortController",new AbortController),m(n(h),"servers",[]),m(n(h),"aborted",!1),m(n(h),"metaInfo",void 0),m(n(h),"transHandler",void 0),h.metaInfo=o,h.transHandler=s,h.ee=d===void 0?new ea:d,o.file.length===0)throw new I("file not found or is empty",wf);return s.cancelSignal!==void 0&&s.cancelSignal.addEventListener("abort",function(){h.abortController.abort()},{once:!0}),h.abortController.signal.addEventListener("abort",function(){h.aborted=!0},{once:!0}),h}la(r,e);var i=ma(r);return Ha(r,[{key:"initChunks",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_,g=this;return w.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(this.initState!=="initialized"&&this.initState!=="initializing"){b.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=l,d=this.sliceFile(l,this.metaInfo.file),this.chunkCount=d.length,h=[],p=function(C,k){var A=(C=ra(k[C],2))[0],P=C[1];C=bs(P).then(function(x){g.chunks[A]={payload:P,sha1:x,uploadedTo:void 0,index:A,processed:!1}}),h.push(C)},f=0,_=Array.from(d.entries());f<_.length;f++)p(f,_);return b.next=11,Promise.all(h);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return b.stop()}},s,this)}));return function(s){return o.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var o=this;if(!this.aborted){for(var s=this.chunks.filter(function(h){return!h.processed}),l=function(h){var p=s[h],f=o.servers.filter(function(g){return!g.isUploading}).sort(function(g,b){return g.successCount-b.successCount}).sort(function(g,b){return g.failureCount-b.failureCount})[0];if(f===void 0||1<f.failureCount)return o.log("Upload server not available, waiting"),o.ee.emit("serverUsedUp"),Om(1e3).then(function(){o.totalFailures>2*o.chunkCount&&o.ee.emit("error"),o.totalFailures+=1,f!==void 0&&(f.failureCount=0),o.uploadToServers()}).catch(function(){}),"break";p.processed=!0,f.isUploading=!0,o.log("uploading chunk %d to server %s",p.index,Dg(f.ip));var _=o.getUploadUrl(f.ip);return J(w.mark(function g(){var b;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.prev=0,C.next=3,o.postChunk(p.payload,_,p.index);case 3:b=o.chunks.findIndex(function(k){return k===p}),p.uploadedTo=f.ip,o.chunks.splice(b,1),o.uploadedChunks.push(p),f.successCount+=1,f.isUploading=!1,o.updateProgress(p.payload.byteLength),o.log("upload chunk %d successfully",p.index),C.next=31;break;case 13:if(C.prev=13,C.t0=C.catch(0),f.isUploading=!1,p.processed=!1,C.t0.statusCode!==504&&!Sa(C.t0)){C.next=27;break}if(o.singleThread){C.next=24;break}return o.warn("%d upload timed out after %d, retrying use single thread",p.index,o.singleThread?12e4:3e4),o.abortController.abort(),o.singleThread=!0,o.ee.emit("multiTimeOut"),C.abrupt("return");case 24:return o.ee.emit("timedOut"),o.abortController.abort(),C.abrupt("return");case 27:return o.metaInfo.useNewDomain=!1,f.failureCount+=1,C.next=31,Om(1e3);case 31:o.uploadedChunks.length===o.chunkCount?(o.log("chunks uploaded"),o.ee.emit("finished")):(o.singleThread||o.chunks.filter(function(k){return!k.processed}).length===1)&&o.uploadToServers();case 32:case"end":return C.stop()}},g,null,[[0,13]])}))(),o.singleThread?"break":void 0},d=0;d<s.length&&l(d)!=="break";d++);s.length===0&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var o=!0,s=[],l=G(this.uploadedChunks).sort(function(p,f){return p.index-f.index}),d=0;for(l=Array.from(l.values());d<l.length;d++){var h=l[d].uploadedTo;if(h===void 0){o=!1;break}s.push(h)}if(!o)throw new Ia("some chunks not uploaded, cannot get upload server ips");return s}},{key:"addServers",value:function(o){var s=this;o.forEach(function(l){var d=s.servers.findIndex(function(h){return h.ip===l});d!==-1?s.servers[d].failureCount=0:(s.log("server %s added",Dg(l)),s.servers.push({successCount:0,isUploading:!1,ip:l,failureCount:0}))})}},{key:"updateProgress",value:function(o){var s=this,l=o!==void 0?this.uploadedSize+o:this.metaInfo.file.length;l>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=l,this.timer!==void 0&&o!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&o!==void 0&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout(function(){s.ee.emit("timedOut"),s.abortController.abort()},12e4)),this.initState==="initialized"&&o===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(o,s){var l=0,d=[],h=s.length;for(o*=32768;l<h;)d.push(s.slice(l,l+o)),l+=o;return this.log("chunks split into %d",d.length),d}},{key:"postChunk",value:function(){var o=J(w.mark(function s(l,d,h){var p,f,_,g,b,C,k,A;return w.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(!this.aborted){P.next=2;break}throw new Ia("upload already aborted");case 2:if(this.unit!==void 0){P.next=4;break}throw new Ia("unit is undefined");case 4:return p=this.metaInfo,f=p.ticket,_=p.instance,g=p.loginOpt,b=p.hashStr,P.t0=h,P.t1=b,P.next=9,bs(l);case 9:return P.t2=P.sent,P.t3=this.unit,P.t4=f,P.t5=_,P.t6=g,C={index:P.t0,hash:P.t1,sha1:P.t2,unit:P.t3,ticket:P.t4,instance:P.t5,loginOpt:P.t6},(k=new FormData).append("parameter",JSON.stringify(C)),k.append("payload",new Blob([l])),P.next=20,te(d,{headers:{Accept:"application/json"},body:k,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(A=P.sent,A.status===201){P.next=24;break}throw new da("uploading chunk ".concat(h," failed"));case 24:case"end":return P.stop()}},s,this)}));return function(s,l,d){return o.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(o){var s=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(o).split(".").join("-"),".edge.").concat(s,":9601/api/v1/chuck/upload")}}]),r}(tb()),fs=function(e){function r(o){W(this,r);var s=i.call(this,o,"MediaTaskManager");return m(n(s),"isProcessing",!1),m(n(s),"authInfo",void 0),m(n(s),"taskFinishers",{}),m(n(s),"mediaTasks",new Map),m(n(s),"ongoingTask",void 0),s.on("connectionStateChanged",function(l){if(l===S.ConnectionState.ABORTED||l===S.ConnectionState.DISCONNECTED){s.ongoingTask!==void 0&&s.cancelTask(s.ongoingTask),l=0;for(var d=Array.from(s.mediaTasks.entries());l<d.length;l++){var h=ra(d[l],2)[1];s.cancelTask(h)}s.mediaTasks.clear(),s.taskFinishers={}}else l===S.ConnectionState.RECONNECTING?s.ongoingTask!==void 0&&s.ongoingTask.manager.abortController.abort():l===S.ConnectionState.CONNECTED&&s.ongoingTask!==void 0&&s.ongoingTask.manager.ee.emit("reconnected")}),s}la(r,e);var i=ma(r);return Ha(r,[{key:"setAuthInfo",value:function(o){this.authInfo=o}},{key:"waitMediaTask",value:function(o){var s=this;return new Promise(function(l,d){s.taskFinishers[o]={resolve:l,reject:d},s.isProcessing||s.processMediaTask()}).finally(function(){s.ongoingTask!==void 0&&s.ongoingTask.manager.timer!==void 0&&clearTimeout(s.ongoingTask.manager.timer),delete s.taskFinishers[o],s.mediaTasks.size!==0?s.processMediaTask():s.isProcessing=!1})}},{key:"addUploadTask",value:function(o,s,l,d){var h=o.file;if(o=o.hash,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=r.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return d=new es({hashStr:as(o),file:h,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},d,this.logger),h=Ud(),this.mediaTasks.set(h,{type:"UPLOAD",manager:d,hash:o,setter:l,fetcher:s,taskId:h}),h}},{key:"addDownloadTask",value:function(o,s,l){var d=o.hashHexStr,h=o.size,p=o.unit;if(o=o.zone,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=r.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return l=new ds({hashHexStr:d,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:h,zone:o,unit:p},l,this.logger),d=Ud(),this.mediaTasks.set(d,{type:"DOWNLOAD",manager:l,fetcher:s,taskId:d}),d}},{key:"doDownloadTaskImpl",value:function(){var o=J(w.mark(function s(l,d){var h,p,f,_,g,b,C,k,A=this,P=arguments;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return h=2<P.length&&P[2]!==void 0&&P[2],f=p=l.manager,h&&(p=new ds(f.metaInfo,f.transHandler,this.logger,f.ee)),_=l.fetcher,x.next=7,_();case 7:if(g=x.sent,b=g.serverList,C=g.backupList,k=g.unit,!h||k===f.retUnit){x.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:h&&(l.manager=p,p.downloadedSize=f.downloadedSize,p.successCount=f.successCount,p.timer=f.timer,p.chunks=f.chunks,p.initialized=f.initialized,p.singleThread=f.singleThread,p.updateProgress(0)),p.ee.once("reconnected",function(){p.ee.removeAllListeners(),A.doDownloadTaskImpl(l,d,!0).catch(function(j){d.reject(j)})}),p.ee.once("multiTimeOut",function(){p.ee.removeAllListeners(),A.doDownloadTaskImpl(l,d,!0).catch(function(j){d.reject(j)})}),p.ee.once("error",function(j){p.ee.removeAllListeners(),d.reject(new da(["download file file, index %d",j.index],{code:mg,originalError:j}))}),p.ee.once("notExist",function(){p.abortController.abort(),p.ee.removeAllListeners(),d.reject(new da("download file not found",AA))}),p.ee.once("timedOut",function(){p.ee.removeAllListeners(),p.abortController.abort(),d.reject(new db("download timed out",zA))}),p.transHandler.cancelSignal!==void 0&&p.transHandler.cancelSignal.addEventListener("abort",function(){d.reject(new hl("Downloading canceled",ir))},{once:!0}),p.ee.once("finished",function(){d.resolve({type:"DOWNLOAD",payload:p.getPayload()})}),p.setInfoByResponse({serverList:b,backupList:C,unit:k}),p.downloadChunks();case 23:case"end":return x.stop()}},s,this)}));return function(s,l){return o.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(o,s){var l=this,d=2<arguments.length&&arguments[2]!==void 0&&arguments[2],h=o.taskId;return d||(this.mediaTasks.delete(h),this.ongoingTask=o),new Promise(function(p,f){l.doDownloadTaskImpl(o,s,d).then(p).catch(f)})}},{key:"doUploadTaskImpl",value:function(){var o=J(w.mark(function s(l,d){var h,p,f,_,g,b,C,k,A,P=this,x=arguments;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return h=2<x.length&&x[2]!==void 0&&x[2],f=p=l.manager,h&&(p=new es(f.metaInfo,f.transHandler,this.logger,f.ee)),_=l.fetcher,g=new Pa,C=new Promise(function(z,_t){var ue=_(),_n=ue.ret,Ei=ue.err,_s=ue.timeout;ue.fin.pipe(ob(g)).subscribe({next:function(kc){d.resolve({type:"UPLOAD",retUnit:kc.unit,zone:kc.zone})},complete:function(){z({hasExist:!0}),g.next(),g.complete()}}),_n.pipe(ob(g),cb(function(){var kc=J(w.mark(function _i(_h){var _p,Qm;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:if(_p=_h.servers,Qm=_h.unit,h&&f.unit!==Qm?d.reject(new da("upload unit is different, reject to continue",lg)):h&&(l.manager=p,p.chunkCount=f.chunkCount,p.chunks=f.chunks,p.totalFailures=f.totalFailures,p.uploadedChunks=f.uploadedChunks,p.timer=f.timer,p.initState=f.initState,p.unit=f.unit,p.uploadedSize=f.uploadedSize,p.singleThread=f.singleThread,p.updateProgress(0)),p.addServers(_p),p.initState!=="uninitialized"){_o.next=7;break}return b=p.initChunks(Qm),_o.next=7,b;case 7:case"end":return _o.stop()}},_i)}));return function(_i){return kc.apply(this,arguments)}}())).subscribe({complete:function(){return z({hasExist:!1})},error:_t}),ue=function(kc){p.initState!=="uninitialized"&&b?z(b.then(function(){return{hasExist:!1}})):_t(kc)},Ei.pipe(ob(g)).subscribe({error:ue}),_s.pipe(ob(g)).subscribe({error:ue})}),j.next=9,C;case 9:if(k=j.sent,!k.hasExist){j.next=15;break}return p.updateProgress(),this.log("file already exists, skipping upload"),j.abrupt("return");case 15:g.next(),g.complete(),this.log("chunks initialization promise resolved"),A=gb(p.ee,"serverUsedUp").pipe(Gt(function(){return p.chunkCount!==p.uploadedChunks.length}),Jt(5e3,void 0,{leading:!1}),pm(function(){return _().ret})).subscribe(function(z){p.addServers(z.servers)}),p.ee.once("reconnected",function(){p.ee.removeAllListeners(),P.doUploadTask(l,d,!0).catch(function(z){d.reject(z)})}),p.ee.once("multiTimeOut",function(){p.ee.removeAllListeners(),P.doUploadTask(l,d,!0).catch(function(z){d.reject(z)})}),p.ee.once("timedOut",function(){A.unsubscribe(),p.ee.removeAllListeners(),p.abortController.abort(),d.reject(new db("upload timed out",Lh))}),p.ee.once("error",function(z){A.unsubscribe(),p.ee.removeAllListeners(),p.abortController.abort(),d.reject(z||new da("upload error",lg))}),p.transHandler.cancelSignal!==void 0&&p.transHandler.cancelSignal.addEventListener("abort",function(){d.reject(new hl("Uploading canceled",hr))},{once:!0}),p.ee.once("finished",J(w.mark(function z(){var _t,ue,_n;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:return A.unsubscribe(),Ei.next=3,l.setter(p.unit,p.getUploadServerIPs());case 3:_t=Ei.sent,ue=_t.zone,_n=_t.unit,p.ee.removeAllListeners(),d.resolve({type:"UPLOAD",retUnit:_n,zone:ue});case 8:case"end":return Ei.stop()}},z)}))),p.uploadToServers();case 26:case"end":return j.stop()}},s,this)}));return function(s,l){return o.apply(this,arguments)}}()},{key:"doUploadTask",value:function(o,s){var l=this,d=2<arguments.length&&arguments[2]!==void 0&&arguments[2],h=o.taskId;return d||(this.mediaTasks.delete(h),this.ongoingTask=o),new Promise(function(p,f){l.doUploadTaskImpl(o,s,d).then(p).catch(f)})}},{key:"processMediaTask",value:function(){var o=J(w.mark(function s(){var l,d,h;return w.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.mediaTasks.size!==0){p.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,l=this.mediaTasks.keys().next().value,(d=this.taskFinishers[l])!==void 0){p.next=7;break}throw Error("top task not found");case 7:if((h=this.mediaTasks.get(l))!==void 0){p.next=10;break}throw new Ia("task invalid");case 10:if(h.type!=="UPLOAD"){p.next=15;break}return p.next=13,this.doUploadTask(h,d).catch(function(f){h.manager.ee.removeAllListeners(),d.reject(f)});case 13:p.next=18;break;case 15:if(h.type!=="DOWNLOAD"){p.next=18;break}return p.next=18,this.doDownloadTask(h,d).catch(function(f){h.manager.ee.removeAllListeners(),d.reject(f)});case 18:case"end":return p.stop()}},s,this)}));return function(){return o.apply(this,arguments)}}()},{key:"cancelTask",value:function(o){var s=o.type==="DOWNLOAD"?ir:hr;o.manager.ee.removeAllListeners(),o.manager.abortController.abort(),this.taskFinishers[o.taskId]!==void 0&&this.taskFinishers[o.taskId].reject(new hl("User logged out or kicked off, media task canceled",s))}}]),r}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",function(){for(var e=0,r=arguments.length,i=new(Ne(this))(r);r>e;)i[e]=arguments[e++];return i},Dj);var gs=1/0,dD=Math.max,ju=function(e,r,i){var o=Object(e);if(!Ed(e)){var s=Te(r);e=Ad(e),r=function(l){return s(o[l],l,o)}}return-1<(r=function(l,d,h){var p=l==null?0:l.length;if(!p)return-1;if(h==null)h=0;else{var f=(h=h?(h=gl(h))===gs||h===-gs?17976931348623157e292*(0>h?-1:1):h==h?h:0:h===0?h:0)%1;h=h==h?f?h-f:h:0}return 0>h&&(h=dD(p+h,0)),Xp(l,Te(d),h)}(e,r,i))?o[s?e[r]:r]:void 0},iu=function(e,r){return e&&e.length?vk(e,void 0,typeof r=="function"?r:void 0):[]},hs=function(){function e(){W(this,e),m(this,"size",0),m(this,"fields",new Map)}return Ha(e,[{key:"define",value:function(r,i,o){if(this.size+=o,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(i={val:0,isNumber:i==="number",isBoolean:i==="boolean",oneof:i==="number"||i==="boolean"?void 0:i,len:o}),this.fields.set(r,i)}},{key:"set",value:function(r,i){if(!(r=this.fields.get(r)))throw Error("field not found");var o=r.oneof;if(!U.isLong(i)&&typeof i!="number")if(typeof i=="boolean")i=i?1:0;else{if(o===void 0)throw Error("invalid field type");if((i=o[i])===void 0)throw Error("field type not found")}Mg(r,i),r.val=i}},{key:"toNumber",value:function(){for(var r=0,i=0,o=0,s=Array.from(this.fields);o<s.length;o++){var l=ra(s[o],2)[1],d=l.len;(l=l.val)!==void 0&&(r+=U.fromValue(l).shiftLeft(i).toNumber(),i+=d)}return r}},{key:"toLong",value:function(){for(var r=U.fromNumber(0,!0),i=0,o=0,s=Array.from(this.fields);o<s.length;o++){var l=ra(s[o],2)[1],d=l.len;(l=l.val)!==void 0&&(r=U.fromValue(l).shiftLeft(i).add(r),i+=d)}return r}},{key:"assert",value:function(r,i){function o(d){if(!U.isLong(d)&&typeof d!="number")if(typeof d=="boolean")d=d?1:0;else{if(l===void 0)throw Error("invalid field type");if((d=l[d])===void 0)throw Error("field type not found")}return Mg(s,d),Lg(d,s.val)}var s=this.fields.get(r);if(!s)throw Error("field not found");var l=s.oneof;if(!Array.isArray(i))return o(i);if(i.length===1)return o(i[0]);if(i.every(function(d){return typeof d=="string"})&&l!==void 0)return i.some(function(d){return o(d)});throw Error("invalid valueTypes")}},{key:"from",value:function(r){r=U.fromValue(r);for(var i=0,o=0,s=Array.from(this.fields);o<s.length;o++){var l=ra(s[o],2)[1],d=l.len,h=U.fromNumber(Math.pow(2,d)-1,!0).shiftLeft(i);Mg(l,h=r.and(h).shiftRightUnsigned(i)),l.val=h,i+=d}}},{key:"typeOf",value:function(r){if((r=this.fields.get(r))!==void 0){var i=r.oneof;if(r=r.val,i!==void 0){var o=0;for(i=Object.entries(i);o<i.length;o++){var s=ra(i[o],2),l=s[0];if(Lg(r,s[1]))return l}}}throw new TypeError("can only get type of oneof type")}}]),e}(),is=function(e){function r(o){W(this,r);var s=i.call(this);return s.define("Rejoin","boolean",1),s.define("Unused","number",31),s.define("Platform","number",8),s.define("Version","number",12),s.define("Subversion","number",12),s.set("Platform",7),s.set("Version",4),s.set("Subversion",203),s.set("Rejoin",o),s}la(r,e);var i=ma(r);return r}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(e){function r(o){W(this,r);var s=i.call(this);if(s.define("MessageType",fD,8),s.define("BroadcastJumps","number",2),s.define("ToCache","boolean",1),s.define("FromCache","boolean",1),s.define("CompressionMethod",gD,2),s.define("IterationNumber","number",4),s.define("BufferedMessage","boolean",1),s.define("ToArchive","boolean",1),s.define("FromArchive","boolean",1),typeof o=="number"||U.isLong(o))s.from(o);else if(o!==void 0){var l=0;for(o=Hg(o);l<o.length;l++){var d=ra(o[l],2);s.set(d[0],d[1])}}return s}la(r,e);var i=ma(r);return Ha(r,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(o){var s=this;return o!==void 0?this.assert("MessageType",o):xf(js).some(function(l){return s.assert("MessageType",l)})}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),r}(hs),hD=function(e){function r(o){return W(this,r),m(n(o=i.call(this,o,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),o}la(r,e);var i=ma(r);return Ha(r,[{key:"getChatInfo",value:function(o){var s=this.dialogueLru.get(o);if(this.dialogueLru.prune(),s){var l=s.dialogue,d={dialogue:l,sequence:s=s.sequence.add(1)};return this.dialogueLru.set(o,{dialogue:l,sequence:s}),d}return l={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(o,l),l}}]),r}(tb()),v={};(typeof module>"u"?"undefined":X(module))=="object"&&(module.exports=v),v.parse=function(e,r){var i,o=v.bin.readUshort,s=v.bin.readUint,l={};for(i=(e=new Uint8Array(e)).length-4;s(e,i)!=101010256;)i--;var d=o(e,i=i+4+4);o(e,i+=2),s(e,i+=2),i=s(e,i+=4);for(var h=0;h<d;h++){s(e,i),i+=4,i+=4,i+=4,s(e,i+=4);var p=s(e,i+=4),f=s(e,i+=4),_=o(e,i+=4),g=o(e,i+2),b=o(e,i+4);i+=6;var C=s(e,i+=8);i+=4,i+=_+g+b,v._readLocal(e,C,l,p,f,r)}return l},v._readLocal=function(e,r,i,o,s,l){var d=v.bin.readUshort,h=v.bin.readUint;h(e,r),d(e,r+=4),d(e,r+=2);var p=d(e,r+=2);h(e,r+=2),h(e,r+=4),h=d(e,r=r+4+8);var f=d(e,r+=2);if(r+=2,d=v.bin.readUTF8(e,r,h),r=r+h+f,l)i[d]={size:s,csize:o};else if(e=new Uint8Array(e.buffer,r),p==0)i[d]=new Uint8Array(e.buffer.slice(r,r+o));else{if(p!=8)throw"unknown compression method: "+p;r=new Uint8Array(s),v.inflateRaw(e,r),i[d]=r}},v.inflateRaw=function(e,r){return v.F.inflate(e,r)},v.inflate=function(e,r){return e[0],e[1],v.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-2),r)},v.deflate=function(e,r){r==null&&(r={level:6});var i=0,o=new Uint8Array(50+Math.floor(1.1*e.length));return o[i]=120,o[i+1]=156,i=v.F.deflateRaw(e,o,i+2,r.level),e=v.adler(e,0,e.length),o[i+0]=e>>>24&255,o[i+1]=e>>>16&255,o[i+2]=e>>>8&255,o[i+3]=e>>>0&255,new Uint8Array(o.buffer,0,i+4)},v.deflateRaw=function(e,r){r==null&&(r={level:6});var i=new Uint8Array(50+Math.floor(1.1*e.length)),o=v.F.deflateRaw(e,i,o,r.level);return new Uint8Array(i.buffer,0,o)},v.encode=function(e,r){r==null&&(r=!1);var i,o=0,s=v.bin.writeUint,l=v.bin.writeUshort,d={};for(i in e){var h=!v._noNeed(i)&&!r,p=e[i],f=v.crc.crc(p,0,p.length);d[i]={cpr:h,usize:p.length,crc:f,file:h?v.deflateRaw(p):p}}for(i in d)o+=d[i].file.length+30+46+2*v.bin.sizeUTF8(i);for(i in e=new Uint8Array(o+22),r=0,p=[],d)f=d[i],p.push(r),r=v._writeHeader(e,r,i,f,0);for(i in o=0,h=r,d)f=d[i],p.push(r),r=v._writeHeader(e,r,i,f,1,p[o++]);return d=r-h,s(e,r,101010256),l(e,r=r+4+4,o),l(e,r+=2,o),s(e,r+=2,d),s(e,r+4,h),e.buffer},v._noNeed=function(e){return e=e.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(e)!=-1},v._writeHeader=function(e,r,i,o,s,l){var d=v.bin.writeUint,h=v.bin.writeUshort,p=o.file;return d(e,r,s==0?67324752:33639248),r+=4,s==1&&(r+=2),h(e,r,20),h(e,r+=2,0),h(e,r+=2,o.cpr?8:0),d(e,r+=2,0),d(e,r+=4,o.crc),d(e,r+=4,p.length),d(e,r+=4,o.usize),h(e,r+=4,v.bin.sizeUTF8(i)),h(e,r+=2,0),r+=2,s==1&&(d(e,r=r+2+2+6,l),r+=4),r+=i=v.bin.writeUTF8(e,r,i),s==0&&(e.set(p,r),r+=p.length),r},v.crc={table:function(){for(var e=new Uint32Array(256),r=0;256>r;r++){for(var i=r,o=0;8>o;o++)i=1&i?3988292384^i>>>1:i>>>1;e[r]=i}return e}(),update:function(e,r,i,o){for(var s=0;s<o;s++)e=v.crc.table[255&(e^r[i+s])]^e>>>8;return e},crc:function(e,r,i){return 4294967295^v.crc.update(4294967295,e,r,i)}},v.adler=function(e,r,i){var o=1,s=0,l=r;for(r+=i;l<r;){for(i=Math.min(l+5552,r);l<i;)s+=o+=e[l++];o%=65521,s%=65521}return s<<16|o},v.bin={readUshort:function(e,r){return e[r]|e[r+1]<<8},writeUshort:function(e,r,i){e[r]=255&i,e[r+1]=i>>8&255},readUint:function(e,r){return 16777216*e[r+3]+(e[r+2]<<16|e[r+1]<<8|e[r])},writeUint:function(e,r,i){e[r]=255&i,e[r+1]=i>>8&255,e[r+2]=i>>16&255,e[r+3]=i>>24&255},readASCII:function(e,r,i){for(var o="",s=0;s<i;s++)o+=String.fromCharCode(e[r+s]);return o},writeASCII:function(e,r,i){for(var o=0;o<i.length;o++)e[r+o]=i.charCodeAt(o)},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(e,r,i){for(var o,s="",l=0;l<i;l++)s+="%"+v.bin.pad(e[r+l].toString(16));try{o=decodeURIComponent(s)}catch{return v.bin.readASCII(e,r,i)}return o},writeUTF8:function(e,r,i){for(var o=i.length,s=0,l=0;l<o;l++){var d=i.charCodeAt(l);if(!(4294967168&d))e[r+s]=d,s++;else if(!(4294965248&d))e[r+s]=192|d>>6,e[r+s+1]=128|d>>0&63,s+=2;else if(!(4294901760&d))e[r+s]=224|d>>12,e[r+s+1]=128|d>>6&63,e[r+s+2]=128|d>>0&63,s+=3;else{if(4292870144&d)throw"e";e[r+s]=240|d>>18,e[r+s+1]=128|d>>12&63,e[r+s+2]=128|d>>6&63,e[r+s+3]=128|d>>0&63,s+=4}}return s},sizeUTF8:function(e){for(var r=e.length,i=0,o=0;o<r;o++){var s=e.charCodeAt(o);if(!(4294967168&s))i++;else if(!(4294965248&s))i+=2;else if(!(4294901760&s))i+=3;else{if(4292870144&s)throw"e";i+=4}}return i}},v.F={},v.F.deflateRaw=function(e,r,i,o){var s=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][o],l=v.F.U,d=v.F._goodIndex;v.F._hash;var h=v.F._putsE,p=0;i<<=3;var f=0,_=e.length;if(o==0){for(;p<_;){var g=Math.min(65535,_-p);h(r,i,p+g==_?1:0),i=v.F._copyExact(e,p,g,r,i+8),p+=g}return i>>>3}h=l.lits,o=l.strt;var b=l.prev,C=0,k=0,A=0,P=0,x=0;for(2<_&&(o[x=v.F._hash(e,0)]=0),p=0;p<_;p++){if(g=x,p+1<_-2){x=v.F._hash(e,p+1);var j=p+1&32767;b[j]=o[x],o[x]=j}if(f<=p){if((14e3<C||26697<k)&&100<_-p&&(f<p&&(h[C]=p-f,C+=2,f=p),i=v.F._writeBlock(p==_-1||f==_?1:0,h,C,P,e,A,p-A,r,i),C=k=P=0,A=p),j=0,p<_-2&&(j=v.F._bestMatch(e,p,b,g,Math.min(s[2],_-p),s[3])),j!=0){g=j>>>16,j&=65535;var z=d(g,l.of0);l.lhst[257+z]++;var _t=d(j,l.df0);l.dhst[_t]++,P+=l.exb[z]+l.dxb[_t],h[C]=g<<23|p-f,h[C+1]=j<<16|z<<8|_t,C+=2,f=p+g}else l.lhst[e[p]]++;k++}}for(A==p&&e.length!=0||(f<p&&(h[C]=p-f,C+=2),i=v.F._writeBlock(1,h,C,P,e,A,p-A,r,i));7&i;)i++;return i>>>3},v.F._bestMatch=function(e,r,i,o,s,l){var d=32767&r,h=i[d],p=d-h+32768&32767;if(h==d||o!=v.F._hash(e,r-p))return 0;for(var f=o=0,_=Math.min(32767,r);p<=_&&--l!=0&&h!=d;){if((o==0||e[r+o]==e[r+o-p])&&(d=v.F._howLong(e,r,p))>o){if(f=p,(o=d)>=s)break;p+2<d&&(d=p+2);for(var g=0,b=0;b<d-2;b++){var C=r-p+b+32768&32767,k=C-i[C]+32768&32767;k>g&&(g=k,h=C)}}p+=(d=h)-(h=i[d])+32768&32767}return o<<16|f},v.F._howLong=function(e,r,i){if(e[r]!=e[r-i]||e[r+1]!=e[r+1-i]||e[r+2]!=e[r+2-i])return 0;var o=r,s=Math.min(e.length,r+258);for(r+=3;r<s&&e[r]==e[r-i];)r++;return r-o},v.F._hash=function(e,r){return(e[r]<<8|e[r+1])+(e[r+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(e,r,i,o,s,l,d,h,p){var f=v.F.U,_=v.F._putsF,g=v.F._putsE;f.lhst[256]++;var b=v.F.getTrees(),C=b[0],k=b[1],A=b[2],P=b[3],x=b[4],j=b[5],z=b[6];b=b[7];var _t=32+(p+3&7?8-(p+3&7):0)+(d<<3),ue=o+v.F.contSize(f.fltree,f.lhst)+v.F.contSize(f.fdtree,f.dhst);o=o+v.F.contSize(f.ltree,f.lhst)+v.F.contSize(f.dtree,f.dhst),o+=14+3*j+v.F.contSize(f.itree,f.ihst)+(2*f.ihst[16]+3*f.ihst[17]+7*f.ihst[18]);for(var _n=0;286>_n;_n++)f.lhst[_n]=0;for(_n=0;30>_n;_n++)f.dhst[_n]=0;for(_n=0;19>_n;_n++)f.ihst[_n]=0;if(_t=_t<ue&&_t<o?0:ue<o?1:2,_(h,p,e),_(h,p+1,_t),p+=3,_t==0){for(;7&p;)p++;p=v.F._copyExact(s,l,d,h,p)}else{if(_t==1)var Ei=f.fltree,_s=f.fdtree;if(_t==2){for(v.F.makeCodes(f.ltree,C),v.F.revCodes(f.ltree,C),v.F.makeCodes(f.dtree,k),v.F.revCodes(f.dtree,k),v.F.makeCodes(f.itree,A),v.F.revCodes(f.itree,A),Ei=f.ltree,_s=f.dtree,g(h,p,P-257),g(h,p+=5,x-1),g(h,p+=5,j-4),p+=4,e=0;e<j;e++)g(h,p+3*e,f.itree[1+(f.ordr[e]<<1)]);p=v.F._codeTiny(z,f.itree,h,p+3*j),p=v.F._codeTiny(b,f.itree,h,p)}for(j=0;j<i;j+=2){for(z=(e=r[j])>>>23,e=l+(8388607&e);l<e;)p=v.F._writeLit(s[l++],Ei,h,p);z!=0&&(e=(C=r[j+1])>>16,d=C>>8&255,C&=255,g(h,p=v.F._writeLit(257+d,Ei,h,p),z-f.of0[d]),p+=f.exb[d],_(h,p=v.F._writeLit(C,_s,h,p),e-f.df0[C]),p+=f.dxb[C],l+=z)}p=v.F._writeLit(256,Ei,h,p)}return p},v.F._copyExact=function(e,r,i,o,s){var l=s>>>3;return o[l]=i,o[l+1]=i>>>8,o[l+2]=255-o[l],o[l+3]=255-o[l+1],l+=4,o.set(new Uint8Array(e.buffer,r,i),l),s+(i+4<<3)},v.F.getTrees=function(){for(var e=v.F.U,r=v.F._hufTree(e.lhst,e.ltree,15),i=v.F._hufTree(e.dhst,e.dtree,15),o=[],s=v.F._lenCodes(e.ltree,o),l=[],d=v.F._lenCodes(e.dtree,l),h=0;h<o.length;h+=2)e.ihst[o[h]]++;for(h=0;h<l.length;h+=2)e.ihst[l[h]]++;h=v.F._hufTree(e.ihst,e.itree,7);for(var p=19;4<p&&e.itree[1+(e.ordr[p-1]<<1)]==0;)p--;return[r,i,h,s,d,p,o,l]},v.F.getSecond=function(e){for(var r=[],i=0;i<e.length;i+=2)r.push(e[i+1]);return r},v.F.nonZero=function(e){for(var r="",i=0;i<e.length;i+=2)e[i+1]!=0&&(r+=(i>>1)+",");return r},v.F.contSize=function(e,r){for(var i=0,o=0;o<r.length;o++)i+=r[o]*e[1+(o<<1)];return i},v.F._codeTiny=function(e,r,i,o){for(var s=0;s<e.length;s+=2){var l=e[s],d=e[s+1];o=v.F._writeLit(l,r,i,o);var h=l==16?2:l==17?3:7;15<l&&(v.F._putsE(i,o,d,h),o+=h)}return o},v.F._lenCodes=function(e,r){for(var i=e.length;i!=2&&e[i-1]==0;)i-=2;for(var o=0;o<i;o+=2){var s=e[o+1],l=o+3<i?e[o+3]:-1,d=o+5<i?e[o+5]:-1,h=o==0?-1:e[o-1];if(s==0&&l==s&&d==s){for(l=o+5;l+2<i&&e[l+2]==s;)l+=2;11>(s=Math.min(l+1-o>>>1,138))?r.push(17,s-3):r.push(18,s-11),o+=2*s-2}else if(s==h&&l==s&&d==s){for(l=o+5;l+2<i&&e[l+2]==s;)l+=2;s=Math.min(l+1-o>>>1,6),r.push(16,s-3),o+=2*s-2}else r.push(s,0)}return i>>>1},v.F._hufTree=function(e,r,i){var o=[],s=e.length,l=r.length,d=0;for(d=0;d<l;d+=2)r[d]=0,r[d+1]=0;for(d=0;d<s;d++)e[d]!=0&&o.push({lit:d,f:e[d]});if(e=o.length,s=o.slice(0),e==0)return 0;if(e==1)return r[1+((i=o[0].lit)<<1)]=1,r[1+((i==0?1:0)<<1)]=1;o.sort(function(_,g){return _.f-g.f}),d=o[0],l=o[1];var h=0,p=1,f=2;for(o[0]={lit:-1,f:d.f+l.f,l:d,r:l,d:0};p!=e-1;)d=h!=p&&(f==e||o[h].f<o[f].f)?o[h++]:o[f++],l=h!=p&&(f==e||o[h].f<o[f].f)?o[h++]:o[f++],o[p++]={lit:-1,f:d.f+l.f,l:d,r:l};for((o=v.F.setDepth(o[p-1],0))>i&&(v.F.restrictDepth(s,i,o),o=i),d=0;d<e;d++)r[1+(s[d].lit<<1)]=s[d].d;return o},v.F.setDepth=function(e,r){return e.lit!=-1?e.d=r:Math.max(v.F.setDepth(e.l,r+1),v.F.setDepth(e.r,r+1))},v.F.restrictDepth=function(e,r,i){var o=0,s=1<<i-r,l=0;for(e.sort(function(h,p){return p.d==h.d?h.f-p.f:p.d-h.d}),o=0;o<e.length&&e[o].d>r;o++){var d=e[o].d;e[o].d=r,l+=s-(1<<i-d)}for(l>>>=i-r;0<l;)(d=e[o].d)<r?(e[o].d++,l-=1<<r-d-1):o++;for(;0<=o;o--)e[o].d==r&&0>l&&(e[o].d--,l++);l!=0&&console.log("debt left")},v.F._goodIndex=function(e,r){var i=0;return r[16|i]<=e&&(i|=16),r[8|i]<=e&&(i|=8),r[4|i]<=e&&(i|=4),r[2|i]<=e&&(i|=2),r[1|i]<=e&&(i|=1),i},v.F._writeLit=function(e,r,i,o){return v.F._putsF(i,o,r[e<<1]),o+r[1+(e<<1)]},v.F.inflate=function(e,r){var i=Uint8Array;if(e[0]==3&&e[1]==0)return r||new i(0);var o=v.F,s=o._bitsF,l=o._bitsE,d=o._decodeTiny,h=o.makeCodes,p=o.codes2map,f=o._get17,_=o.U,g=r==null;g&&(r=new i(e.length>>>2<<3));for(var b,C,k,A,P=0,x=0,j=C=0,z=0;P==0;)if(P=s(e,z,1),b=s(e,z+1,2),z+=3,b==0)7&z&&(z+=8-(7&z)),b=e[(z=4+(z>>>3))-4]|e[z-3]<<8,g&&(r=v.F._check(r,j+b)),r.set(new i(e.buffer,e.byteOffset+z,b),j),z=z+b<<3,j+=b;else{if(g&&(r=v.F._check(r,j+131072)),b==1&&(k=_.flmap,A=_.fdmap,x=511,C=31),b==2){for(C=l(e,z,5)+257,b=l(e,z+5,5)+1,k=l(e,z+10,4)+4,z+=14,A=0;38>A;A+=2)_.itree[A]=0,_.itree[A+1]=0;for(x=1,A=0;A<k;A++){var _t=l(e,z+3*A,3);_.itree[1+(_.ordr[A]<<1)]=_t,_t>x&&(x=_t)}z+=3*k,h(_.itree,x),p(_.itree,x,_.imap),k=_.lmap,A=_.dmap,z=d(_.imap,(1<<x)-1,C+b,e,z,_.ttree),x=(1<<(_t=o._copyOut(_.ttree,0,C,_.ltree)))-1,C=(1<<(b=o._copyOut(_.ttree,C,b,_.dtree)))-1,h(_.ltree,_t),p(_.ltree,_t,k),h(_.dtree,b),p(_.dtree,b,A)}for(;;)if(z+=15&(b=k[f(e,z)&x]),(_t=b>>>4)>>>8==0)r[j++]=_t;else{if(_t==256)break;b=j+_t-254,264<_t&&(b=j+((_t=_.ldef[_t-257])>>>3)+l(e,z,7&_t),z+=7&_t),z+=15&(_t=A[f(e,z)&C]);var ue=((_t=_.ddef[_t>>>4])>>>4)+s(e,z,15&_t);for(z+=15&_t,g&&(r=v.F._check(r,j+131072));j<b;)r[j]=r[j++-ue],r[j]=r[j++-ue],r[j]=r[j++-ue],r[j]=r[j++-ue];j=b}}return r.length==j?r:r.slice(0,j)},v.F._check=function(e,r){var i=e.length;return r<=i?e:((r=new Uint8Array(Math.max(i<<1,r))).set(e,0),r)},v.F._decodeTiny=function(e,r,i,o,s,l){for(var d=v.F._bitsE,h=v.F._get17,p=0;p<i;){var f=e[h(o,s)&r];s+=15&f;var _=f>>>4;if(15>=_)l[p]=_,p++;else{var g=f=0;for(_==16?(g=3+d(o,s,2),s+=2,f=l[p-1]):_==17?(g=3+d(o,s,3),s+=3):_==18&&(g=11+d(o,s,7),s+=7),_=p+g;p<_;)l[p]=f,p++}}return s},v.F._copyOut=function(e,r,i,o){for(var s=0,l=0,d=o.length>>>1;l<i;){var h=e[l+r];o[l<<1]=0,o[1+(l<<1)]=h,h>s&&(s=h),l++}for(;l<d;)o[l<<1]=0,o[1+(l<<1)]=0,l++;return s},v.F.makeCodes=function(e,r){var i,o,s=v.F.U,l=e.length,d=s.bl_count;for(i=0;i<=r;i++)d[i]=0;for(i=1;i<l;i+=2)d[e[i]]++;for(s=s.next_code,i=0,d[0]=0,o=1;o<=r;o++)i=i+d[o-1]<<1,s[o]=i;for(r=0;r<l;r+=2)(d=e[r+1])!=0&&(e[r]=s[d],s[d]++)},v.F.codes2map=function(e,r,i){for(var o=e.length,s=v.F.U.rev15,l=0;l<o;l+=2)if(e[l+1]!=0){var d=e[l+1],h=l>>1<<4|d,p=r-d;for(p=(d=e[l]<<p)+(1<<p);d!=p;)i[s[d]>>>15-r]=h,d++}},v.F.revCodes=function(e,r){for(var i=v.F.U.rev15,o=15-r,s=0;s<e.length;s+=2)e[s]=i[e[s]<<r-e[s+1]]>>>o},v.F._putsE=function(e,r,i){i<<=7&r,e[r>>>=3]|=i,e[r+1]|=i>>>8},v.F._putsF=function(e,r,i){i<<=7&r,e[r>>>=3]|=i,e[r+1]|=i>>>8,e[r+2]|=i>>>16},v.F._bitsE=function(e,r,i){return(e[r>>>3]|e[1+(r>>>3)]<<8)>>>(7&r)&(1<<i)-1},v.F._bitsF=function(e,r,i){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)&(1<<i)-1},v.F._get17=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)},v.F._get25=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16|e[3+(r>>>3)]<<24)>>>(7&r)},v.F.U=function(){var e=Uint16Array,r=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new e(65536),prev:new e(32768)}}(),function(){function e(s,l,d){for(;l--!=0;)s.push(0,d)}for(var r=v.F.U,i=0;32768>i;i++){var o=i;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,r.rev15[i]=(o>>>16|o<<16)>>>17}for(i=0;32>i;i++)r.ldef[i]=r.of0[i]<<3|r.exb[i],r.ddef[i]=r.df0[i]<<4|r.dxb[i];e(r.fltree,144,8),e(r.fltree,112,9),e(r.fltree,24,7),e(r.fltree,8,8),v.F.makeCodes(r.fltree,9),v.F.codes2map(r.fltree,9,r.flmap),v.F.revCodes(r.fltree,9),e(r.fdtree,32,5),v.F.makeCodes(r.fdtree,5),v.F.codes2map(r.fdtree,5,r.fdmap),v.F.revCodes(r.fdtree,5),e(r.itree,19,0),e(r.ltree,286,0),e(r.dtree,30,0),e(r.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(e){function r(o,s,l,d){W(this,r);var h=i.call(this,d,"Session");return m(n(h),"chatManager",void 0),m(n(h),"joinedChannels",new Set),m(n(h),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(h),"startTime",Date.now()),m(n(h),"seq",U.fromNumber(1,!0)),m(n(h),"userJoinOptions",new is(!1)),m(n(h),"seqSentStatuses",[!1,!1]),m(n(h),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(h),"loggedOut",!1),m(n(h),"messageSentTimes",[]),m(n(h),"curLoginSockets",[void 0,void 0]),m(n(h),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(h),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(h),"dialPendingMsgSubjectMap",new Map),m(n(h),"context",void 0),m(n(h),"connection",void 0),m(n(h),"instanceId",void 0),m(n(h),"registerSocketsFailureListener",function(){h.connection.once("socketsFailure",function(){h.log("socketsFailure, creating a new connection"),ad(function(){return h.connection.removeAllListeners(),h.connection=new Yr(h.context,h.logger,!0),h.loginHandler(15e3,!0)}).pipe(oe(function(p){return p.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))}),ob(h.connection.apClient.apFinish$)).subscribe(function(){h.log("new connection connected")})}),h.connection.listenerCount("tokenExpired")===0&&h.connection.on("tokenExpired",function(){h.emit("tokenExpired")})}),h.context=o,h.connection=s,h.instanceId=l,h.chatManager=new hD(d),h.log("The instanceId is %s",h.instanceId.toString()),h}la(r,e);var i=ma(r);return Ha(r,[{key:"fetchFileUploadIndexGet",value:function(o){var s=o.hash,l=o.size;if((o=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var d=this.incGetSeq();return o.forEach(function(h){h.sendPacket("FileUploadIndexGet",{seq:d,hash:s,size:l})}),{ret:Ca.apply(void 0,G(o.map(function(h){return h.fromReceived("FileUploadIndexRet").pipe(aa(function(p){return d.eq(p.seq)}))}))),fin:Ca.apply(void 0,G(o.map(function(h){return h.fromReceived("FileUploadIndexFin").pipe(aa(function(p){return d.eq(p.seq)}))}))),err:Xb.apply(void 0,G(o.map(function(h){return h.fromReceived("FileUploadIndexErr").pipe(aa(function(p){return d.eq(p.seq)}),ba(function(p){throw new da(["The media message upload failure, code %d",p.code],lg)}))}))),timeout:r.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(o){var s=o.hash,l=o.unit,d=o.servers;if((o=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var h=this.incGetSeq();return o.forEach(function(p){p.sendPacket("FileUploadIndexSet",{seq:h,servers:d,hash:s,unit:l})}),Ca.apply(void 0,[r.genTimeoutError(Lh)].concat(G(o.map(function(p){return p.fromReceived("FileUploadIndexErr").pipe(aa(function(f){return h.eq(f.seq)}),ba(function(f){throw new da(["FileUploadIndexSet failure, code %d",f.code],lg)}))})),G(o.map(function(p){return p.fromReceived("FileUploadIndexFin").pipe(aa(function(f){return h.eq(f.seq)}))}))))}},{key:"requestFileDownloadIndexGet",value:function(o){var s=o.size,l=o.zone,d=o.unit,h=o.hash,p=this.getLoginSockets();if(p.length===0)throw new K("Client is not logged in");var f=this.incGetSeq();return p.forEach(function(_){_.sendPacket("FileDownloadIndexGet",{seq:f,size:s,zone:l,unit:d,hash:h})}),o=Ca.apply(void 0,G(p.map(function(_){return _.fromReceived("FileDownloadIndexRet").pipe(aa(function(g){return f.eq(g.seq)}))}))).pipe(ba(function(_){var g=_.backups,b=_.servers;return _=ff(_,iD),ua({backupList:g.map(function(C){return[C]}),serverList:b.map(function(C){return[C]})},_)}),cd(500)),p=jm(p.map(function(_){return _.fromReceived("FileDownloadIndexRet").pipe(aa(function(g){return f.eq(g.seq)}))})),Ca(o,p.pipe(ba(function(_){return _.reduce(function(g,b){var C=g.backupList,k=g.serverList;g=b.backups;var A=b.servers;return b=ff(b,jD),ua({backupList:g.map(function(P,x){return[P].concat(G(C!==void 0&&Array.isArray(C[x])?C[x]:[]))}),serverList:A.map(function(P,x){return[P].concat(G(C!==void 0&&Array.isArray(k[x])?k[x]:[]))})},b)},{})})),r.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var o=this,s=0<arguments.length&&arguments[0]!==void 0?arguments[0]:2e4,l=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&l)throw new K("Already logged out, request ignored");l&&this.registerSocketsFailureListener(),this.connection.initConnection();var d=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),h=Date.now();return d.forEach(function(p,f){var _=o.loginSocketSubs[f].login;_!==void 0&&_.unsubscribe(),o.loginSocketSubs[f].login=p.pipe(ca(function(g){var b;o.curLoginSockets[f]=g;var C=Date.now();eb("Link",{ackedServerIp:g.address,destServerIp:g.ip,ec:0,sc:0,elapse:fb(o.startTime),lts:U.fromNumber(C),responseTime:h-C,sid:Xa(o.instanceId),userId:o.context.uid},(b=o.context.config.enableCloudProxy)!==null&&b!==void 0&&b),o.emit("userJoined",g.env),l&&o.connection.apClient.apFinish$.next(void 0)})).subscribe(o.lastLoginSockets[f])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(d).concat([gb(this.connection,"connectionInitFailure").pipe(ca(function(p){throw sa(p)||Sa(p)?p:new da("Login failure",{code:Zq,originalError:p})}))])).pipe(Ka(1),hb(s),Ga(function(p){return p instanceof pb&&o.warn("Client login timeout"),p&&p.code===Kh&&(o.connection.emit("tokenExpired"),o.connection.apClient.apFinish$.next(void 0)),o.clearSockets(0,l),Z(p)}),ca(function(){l||o.registerSocketsFailureListener()}),wg(function(){l||o.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:function(){var o=J(w.mark(function s(){var l,d,h,p=this;return w.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),l=this.getLoginSockets(),d=l.map(function(_){return _.sendPacket("UserQuit",{}),p.connection.waitClosing(_)}),this.clearSockets(5e3),h=l.map(function(_){return _.env}),[0,1].filter(function(_){return!h.includes(_)}).forEach(function(_){p.connection.closeSocket(_,0)}),f.abrupt("return",Xb.apply(void 0,G(d)).toPromise());case 9:case"end":return f.stop()}},s,this)}));return function(){return o.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var o=J(w.mark(function s(l,d){var h,p,f,_=this;return w.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.getLoginSockets().length!==0){g.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return h=gb(this,"channelLeft").pipe(wb(function(b){return b===l}),Ka(1)),p=this.incGetSeq(),(f=this.lastLoginSockets.map(function(b){return b.pipe(Cc(function(C,k){k!==0&&_.incSeqIfNeeded(C.env);var A=k===0?p:_.seq;return C.sendPacket("GroupEnter",{account:d,seq:A}),C.fromReceived("GroupReply").pipe(aa(function(P){return A.eq(P.seq)}),ca(function(P){if((P=P.code)!==0)throw new da(["Channel join failure. The response code is %d",P],Rq)}))}),ob(h),pe())})).forEach(function(b,C){var k=function(){return _.loginSocketSubs[C].channels.delete(l.channelId)};_.loginSocketSubs[C].channels.set(l.channelId,b.subscribe({error:k,complete:k}))}),g.next=8,Xb.apply(void 0,G(f)).pipe(Ka(1),hb(1e4),Ga(function(b){return b instanceof pb&&_.warn("Channel join timeout"),Z(b)})).toPromise();case 8:this.joinedChannels.add(l);case 9:case"end":return g.stop()}},s,this)}));return function(s,l){return o.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(o,s){this.emit("channelLeft",o),this.joinedChannels.delete(o),this.getLoginSockets().forEach(function(l){l.sendPacket("GroupLeave",{account:s})})}},{key:"requestChannelMemberList",value:function(o){var s=this.getLoginSockets();if(s.length===0)throw new K("Client is not logged in. Cannot get the channel members",cA);var l=this.incGetSeq();return s.forEach(function(d){d.sendPacket("GroupAllUsersList",{group:o,pageNumber:0,pageSize:200,seq:l})}),Ca.apply(void 0,[r.genTimeoutError(Pq)].concat(G(s.map(function(d){return d.fromReceived("GroupAllUsersResult").pipe(aa(function(h){var p=h.seq;return h.group===o&&l.eq(p)}))}))))}},{key:"requestPeersOnlineStatus",value:function(o){var s=this.getLoginSockets();if(s.length===0)throw new K("Client is not logged in");var l=this.incGetSeq();return s.forEach(function(d){d.sendPacket("UserStatusList",{users:o,seq:l})}),Ca.apply(void 0,[r.genTimeoutError(oA)].concat(G(s.map(function(d){return d.fromReceived("UserStatusResult").pipe(aa(function(h){return l.eq(h.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(o,s){var l=this,d=this.getLoginSockets();if(d.length===0)throw new K("Client is not logged in");var h=this.incGetSeq();return d.forEach(function(p,f){s!==void 0&&f!==s||p.sendPacket("UserAttributeSet",{account:l.context.uid,attributeInfos:Object.entries(o).map(function(_){return{key:(_=ra(_,2))[0],value:_[1]}}),seq:h})}),Ca.apply(void 0,G(d.map(function(p){return p.fromReceived("UserAttributeErr").pipe(aa(function(f){return h.eq(f.seq)}),ba(function(f){throw new da(["The user attributes set failure, code %d",f.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(d.map(function(p){return p.fromReceived("UserAttributeRsp").pipe(aa(function(f){return h.eq(f.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(o,s,l){var d=this.getLoginSockets();if(d.length===0)throw new K("Client is not logged in");var h=this.incGetSeq();return d.forEach(function(p){p.sendPacket("GroupAttributeSet",{broadcast:l,group:o,attributeInfos:Object.entries(s).map(function(f){return{key:(f=ra(f,2))[0],value:f[1]}}),seq:h})}),Ca.apply(void 0,G(d.map(function(p){return p.fromReceived("GroupAttributeErr").pipe(aa(function(f){return h.eq(f.seq)}),ba(function(f){throw new da(["The group attributes set failure, code %d",f.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(d.map(function(p){return p.fromReceived("GroupAttributeRsp").pipe(aa(function(f){return h.eq(f.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(o){var s=this,l=this.getLoginSockets();if(l.length===0)throw new K("Client is not logged in");var d=this.incGetSeq();return l.forEach(function(h){h.sendPacket("UserAttributeMod",{account:s.context.uid,attributeInfos:Object.entries(o).map(function(p){return{key:(p=ra(p,2))[0],value:p[1]}}),seq:d})}),Ca.apply(void 0,G(l.map(function(h){return h.fromReceived("UserAttributeErr").pipe(aa(function(p){return d.eq(p.seq)}),ba(function(p){throw new da(["The user attributes add or update failure, code %d",p.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(l.map(function(h){return h.fromReceived("UserAttributeRsp").pipe(aa(function(p){return d.eq(p.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(o,s,l){var d=this.getLoginSockets();if(d.length===0)throw new K("Client is not logged in");var h=this.incGetSeq();return d.forEach(function(p){p.sendPacket("GroupAttributeMod",{broadcast:l,group:o,attributeInfos:Object.entries(s).map(function(f){return{key:(f=ra(f,2))[0],value:f[1]}}),seq:h})}),Ca.apply(void 0,G(d.map(function(p){return p.fromReceived("GroupAttributeErr").pipe(aa(function(f){return h.eq(f.seq)}),ba(function(f){throw new da(["The group attributes add or update failure, code %d",f.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(d.map(function(p){return p.fromReceived("GroupAttributeRsp").pipe(aa(function(f){return h.eq(f.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(o){var s=this,l=this.getLoginSockets();if(l.length===0)throw new K("Client is not logged in");var d=this.incGetSeq();return l.forEach(function(h){h.sendPacket("UserAttributeDel",{account:s.context.uid,attributes:o,seq:d})}),Ca.apply(void 0,G(l.map(function(h){return h.fromReceived("UserAttributeErr").pipe(aa(function(p){return d.eq(p.seq)}),ba(function(p){throw new da(["The user attributes delete failure, code %d",p.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(l.map(function(h){return h.fromReceived("UserAttributeRsp").pipe(aa(function(p){return d.eq(p.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(o,s,l){var d=this.getLoginSockets();if(d.length===0)throw new K("Client is not logged in");var h=this.incGetSeq();return d.forEach(function(p){p.sendPacket("GroupAttributeDel",{group:o,broadcast:l,attributes:s,seq:h})}),Ca.apply(void 0,G(d.map(function(p){return p.fromReceived("GroupAttributeErr").pipe(aa(function(f){return h.eq(f.seq)}),ba(function(f){throw new da(["The channel attributes delete failure, code %d",f.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(d.map(function(p){return p.fromReceived("GroupAttributeRsp").pipe(aa(function(f){return h.eq(f.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var o=this,s=this.getLoginSockets();if(s.length===0)throw new K("Client is not logged in");var l=this.incGetSeq();return s.forEach(function(d){d.sendPacket("UserAttributeSet",{account:o.context.uid,seq:l,attributeInfos:[]})}),Ca.apply(void 0,G(s.map(function(d){return d.fromReceived("UserAttributeErr").pipe(aa(function(h){return l.eq(h.seq)}),ba(function(h){throw new da(["The user attributes clear failure, code %d",h.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(s.map(function(d){return d.fromReceived("UserAttributeRsp").pipe(aa(function(h){return l.eq(h.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(o,s){var l=this.getLoginSockets();if(l.length===0)throw new K("Client is not logged in");var d=this.incGetSeq();return l.forEach(function(h){h.sendPacket("GroupAttributeSet",{group:o,seq:d,attributeInfos:[],broadcast:s})}),Ca.apply(void 0,G(l.map(function(h){return h.fromReceived("GroupAttributeErr").pipe(aa(function(p){return d.eq(p.seq)}),ba(function(p){throw new da(["The channel attributes clear failure, code %d",p.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(l.map(function(h){return h.fromReceived("GroupAttributeRsp").pipe(aa(function(p){return d.eq(p.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(o,s){var l=this.getLoginSockets();if(l.length===0)throw new K("Client is not logged in");var d=this.incGetSeq();return l.forEach(function(h){h.sendPacket("UserAttributeGet",{account:o,seq:d,attributes:s})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(l.map(function(h){return h.fromReceived("UserAttributeErr").pipe(aa(function(p){return d.eq(p.seq)}),ba(function(p){throw(p=p.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",p],Sb)}))})),G(l.map(function(h){return h.fromReceived("UserAttributeRet").pipe(aa(function(p){return d.eq(p.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(o,s){var l=this.getLoginSockets();if(l.length===0)throw new K("Client is not logged in");var d=this.incGetSeq();return l.forEach(function(h){h.sendPacket("GroupAttributeGet",{group:o,seq:d,attributes:s})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(l.map(function(h){return h.fromReceived("GroupAttributeErr").pipe(aa(function(p){return d.eq(p.seq)}),ba(function(p){throw new da(["The channel attributes get failure, code %d",p.code],Sb)}))})),G(l.map(function(h){return h.fromReceived("GroupAttributeRet").pipe(aa(function(p){return d.eq(p.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(o){var s=this.getLoginSockets();if(s.length===0)throw new K("Client is not logged in");var l=this.incGetSeq();return s.forEach(function(d){d.sendPacket("UserAttributeKeysGet",{account:o,seq:l})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(s.map(function(d){return d.fromReceived("UserAttributeErr").pipe(aa(function(h){return l.eq(h.seq)}),ba(function(h){throw(h=h.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",h],Sb)}))})),G(s.map(function(d){return d.fromReceived("UserAttributeKeysRet").pipe(aa(function(h){return l.eq(h.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(o){var s=this.getLoginSockets();if(s.length===0)throw new K("Client is not logged in");var l=this.incGetSeq();return s.forEach(function(d){d.sendPacket("GroupAttributeKeysGet",{group:o,seq:l})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(s.map(function(d){return d.fromReceived("GroupAttributeErr").pipe(aa(function(h){return l.eq(h.seq)}),ba(function(h){throw new Wc(["Channel attribute operation unknown error code: %d",h.code],Sb)}))})),G(s.map(function(d){return d.fromReceived("GroupAttributeKeysRet").pipe(aa(function(h){return l.eq(h.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(o){var s=this.getLoginSockets();if(s.length===0)throw new K("Client is not logged in");var l=this.incGetSeq();return s.forEach(function(d){d.sendPacket("GroupStatusList",{groups:o,seq:l})}),Ca.apply(void 0,[r.genTimeoutError(Pq)].concat(G(s.map(function(d){return d.fromReceived("GroupStatusResult").pipe(aa(function(h){return l.eq(h.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(o){var s=this.getLoginSockets();if(s.length===0)throw new K("Client is not logged in");var l=this.incGetSeq();return s.forEach(function(d){d.sendPacket("SubscribeUserStatus",{seq:l,users:o})}),Ca.apply(void 0,[r.genTimeoutError(vA)].concat(G(s.map(function(d){return d.fromReceived("SubscribeResponse").pipe(aa(function(h){return l.eq(h.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(o){var s=this.getLoginSockets();if(s.length===0)throw new K("Client is not logged in");var l=this.incGetSeq();s.forEach(function(d){d.sendPacket("UnsubscribeUserStatus",{seq:l,users:o})})}},{key:"sendInvitationMessage",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_,g,b,C,k,A,P,x,j=this;return w.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(d=l.peerId,h=l.callId,p=l.extra,f=l.isAcceptAck,_=l.channelId,g=l.type,b={callId:h},f===void 0){z.next=6;break}if(g==="CallAccept"){z.next=5;break}throw Error("invalid invitation type");case 5:b.type=f?"ack":"request";case 6:return b.channel=_,(g==="CallInvite"||g==="CallCancel"||g==="CallReject"||g==="CallAccept"&&f===!1)&&p!==void 0&&(b.extra=p),C=Bg(),this.log("The sent invitation body is %o",b),k=function(_t){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:C,instance:j.instanceId,dst:d,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:_t,MessageType:g}).toLong(),payload:new TextEncoder().encode(JSON.stringify(b)),src:j.context.uid}},z.next=14,Kb(this.sendMessageToRetry(k,!0)).pipe(hb(1e4),Ga(function(_t){return _t instanceof pb&&j.warn("Send invitation timeout"),Z(_t)})).toPromise();case 14:return A=z.sent,P=A.code,x=A.retryTimes,z.abrupt("return",{hasPeerReceived:P===0,hasReSent:x!==0});case 18:case"end":return z.stop()}},s,this)}));return function(s){return o.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var o=J(w.mark(function s(l,d,h,p,f,_){var g,b,C,k,A,P,x,j,z,_t,ue,_n,Ei,_s,kc,_i,_h,_p,Qm,_o,ga,vf,Fi,Gi,_d,Di,H,Wt,_e,_f=this;return w.wrap(function(uE){for(;;)switch(uE.prev=uE.next){case 0:if(b=d.width,C=b===void 0?0:b,k=d.height,A=k===void 0?0:k,P=d.fileName,x=P===void 0?"":P,j=d.description,z=j===void 0?"":j,_t=d.thumbnail,ue=_t===void 0?new Blob:_t,_n=d.thumbnailHeight,Ei=_n===void 0?0:_n,_s=d.thumbnailWidth,kc=_s===void 0?0:_s,_i=d.size,_h=_i===void 0?0:_i,_p=d.mediaId,Qm=f.enableOfflineMessaging,_o=f.enableHistoricalMessaging,za(h)){uE.next=4;break}throw new I("The send message arguments are not valid",p?$k:hg);case 4:if(!(32768<new Blob([x,ue,z]).size)){uE.next=6;break}throw new I("The size of message overflowed ",p?ve:Hh);case 6:return ga=this.chatManager.getChatInfo(h),vf=ga.dialogue,Fi=ga.sequence,Gi=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(Gi,"-").concat(vf,"#").concat(Fi,'"'),p?" peer":" channel",oa(h)),m(g={},"media_description",z),m(g,"media_width",C),m(g,"media_height",A),m(g,"media_thumbnailwidth",kc),m(g,"media_thumbnailheight",Ei),m(g,"media_size",_h),m(g,"media_id",_p),m(g,"media_filename",x),_d=uc(g,function(IE){return new TextEncoder().encode(IE.toString())}),uE.t0=Uint8Array,uE.next=14,Ji(ue);case 14:return uE.t1=uE.sent,_d.media_thumbnail=new uE.t0(uE.t1),Di=p&&l==="IMAGE"?"PeerImageMessage":p&&l==="FILE"?"PeerFileMessage":p||l!=="IMAGE"?"ChannelFileMessage":"ChannelImageMessage",H=function(IE){return{MiscMap:_d,sequence:Fi,dialogue:vf,instance:Gi,dst:h,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:IE,CompressionMethod:"Uncompressed",MessageType:Di,ToCache:Qm,ToArchive:_o}).toLong(),payload:new Uint8Array,src:_f.context.uid}},uE.next=20,Kb(this.sendMessageToRetry(H,!0)).pipe(hb(_===void 0?1e4:_),Ga(function(IE){return IE instanceof pb&&_f.warn("Send message timeout"),Z(IE)})).toPromise();case 20:if(Wt=uE.sent,(_e=Wt.code)!==2){uE.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return uE.abrupt("return",{hasPeerReceived:_e===0});case 25:case"end":return uE.stop()}},s,this)}));return function(s,l,d,h,p,f){return o.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var o=J(w.mark(function s(l,d,h,p,f,_){var g,b,C,k,A,P,x,j,z,_t,ue=this;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(g=f.enableOfflineMessaging,b=f.enableHistoricalMessaging,za(h)&&l instanceof Uint8Array&&typeof d=="string"){_n.next=3;break}throw new I("The send message arguments are not valid",p?$k:hg);case 3:if(!(32768<l.byteLength+new Blob([d]).size)){_n.next=5;break}throw new ib("The message size is over the 32KB limit",p?ve:Hh);case 5:return C=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=l.byteLength,k=this.chatManager.getChatInfo(h),A=k.dialogue,P=k.sequence,x=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(x,"-").concat(A,"#").concat(P,'"'),C?" compressed":"",p?"peer":"channel",oa(h)),j=function(Ei){return{MiscMap:{description:new TextEncoder().encode(d)},sequence:P,dialogue:A,instance:x,dst:h,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:Ei,CompressionMethod:C?"Zlib":"Uncompressed",MessageType:p?"PeerRawMessage":"ChannelRawMessage",ToCache:g,ToArchive:b}).toLong(),payload:C?ks(l):l,src:ue.context.uid}},_n.next=12,Kb(this.sendMessageToRetry(j,!0)).pipe(hb(_===void 0?1e4:_),Ga(function(Ei){return Ei instanceof pb&&ue.warn("Send message timeout"),Z(Ei)})).toPromise();case 12:return z=_n.sent,_t=z.code,_n.abrupt("return",{hasPeerReceived:_t===0});case 15:case"end":return _n.stop()}},s,this)}));return function(s,l,d,h,p,f){return o.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var o=J(w.mark(function s(l,d,h,p,f){var _,g,b,C,k,A,P,x,j,z,_t,ue=this;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(_=p.enableOfflineMessaging,g=p.enableHistoricalMessaging,za(d)){_n.next=3;break}throw new I("The send message arguments are not valid",h?$k:hg);case 3:if(!(32768<new Blob([l]).size)){_n.next=5;break}throw new ib("The message size is over the 32KB limit",h?ve:Hh);case 5:return b=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([l]).size,C=this.chatManager.getChatInfo(d),k=C.dialogue,A=C.sequence,P=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(P,"-").concat(k,"#").concat(A,'"'),b?" compressed":"",h?"peer":"channel",oa(d)),x=new TextEncoder().encode(l),j=function(Ei){return{MiscMap:{},sequence:A,dialogue:k,instance:P,dst:d,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:Ei,CompressionMethod:b?"Zlib":"Uncompressed",MessageType:h?"PeerTextMessage":"ChannelTextMessage",ToCache:_,ToArchive:g}).toLong(),payload:b?ks(x):x,src:ue.context.uid}},_n.next=13,Kb(this.sendMessageToRetry(j,!0)).pipe(hb(f===void 0?1e4:f),Ga(function(Ei){return Ei instanceof pb&&ue.warn("Send message timeout"),Z(Ei)})).toPromise();case 13:return z=_n.sent,_t=z.code,_n.abrupt("return",{hasPeerReceived:_t===0});case 16:case"end":return _n.stop()}},s,this)}));return function(s,l,d,h,p){return o.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(o,s){Object.entries(this.loginSocketSubs[o]).forEach(function(l){var d=(l=ra(l,2))[1];l[0]==="channels"&&s||(Array.isArray(d)||d instanceof Map?d.forEach(function(h){return h.unsubscribe()}):d&&d.unsubscribe())}),this.loginSocketSubs[o]={channels:s?this.loginSocketSubs[o].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var o=J(w.mark(function s(l,d){var h,p,f,_,g,b,C,k,A,P=this,x=arguments;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(h=2<x.length&&x[2]!==void 0?x[2]:0,this.log("Attempt to send the message ".concat(d?" with retrying, %o":"without retrying"),{retryTimes:h}),(p=this.getLoginSockets()).length!==0){j.next=5;break}throw Error("no logged-in sockets");case 5:return f=l(h),p.forEach(function(z){z.sendPacket("Message",f)}),_=f.dialogue,g=f.sequence,b=f.instance,C=p.map(function(z){return z.fromReceived("Ack").pipe(wb(function(_t){return _.eq(_t.dialogue)&&g.eq(_t.sequence)&&b.eq(_t.instance)}))}),j.prev=9,j.next=12,Xb.apply(void 0,G(C)).pipe(hb(6e3),Ga(function(z){return Sa(z)&&P.warn("Message send timeout, retry times %d",h),Z(z)}),Ka(1)).toPromise();case 12:return k=j.sent,A=k.code,this.log("The message has been acked, %o",{code:A}),j.abrupt("return",{code:A,retryTimes:h});case 18:if(j.prev=18,j.t0=j.catch(9),!(j.t0 instanceof pb&&d)){j.next=22;break}return j.abrupt("return",this.sendMessageToRetry(l,!1,h+1));case 22:throw j.t0;case 23:case"end":return j.stop()}},s,this,[[9,18]])}));return function(s,l){return o.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var o=this;this.lastLoginSockets.map(function(s){return s.pipe(Cc(function(l){return Bc(0,2750).pipe(ca(function(){o.incSeqIfNeeded(l.env),l.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:o.seq})}))}))}).forEach(function(s,l){var d=o.loginSocketSubs[l].keepAlive;d!==void 0&&d.unsubscribe(),o.loginSocketSubs[l].keepAlive=s.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var o=this;this.lastLoginSockets.map(function(s){return s.pipe(Cc(function(l){var d,h=!1,p=l.userJoin$.pipe(ca(function(){h=!0})),f=l.input$.pipe(ca(function(_){Li[_.uri].slice(0,-3)!=="Ping"&&(h=!1)}));return Xb(Bc(15e3,1e4).pipe(Pt(l.receivedPacket),ca(function(_){_=ra(_,2),_=ra(_[1],2)[1],d!==_||h||l.forceReconnect(),d=_})),p,f)}))}).forEach(function(s,l){var d=o.loginSocketSubs[l].keepAliveReconnector;d!==void 0&&d.unsubscribe(),o.loginSocketSubs[l].keepAliveReconnector=s.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var o=this;this.lastLoginSockets.map(function(s){return s.pipe(Cc(function(l){return Xb(gb(l,"reconnect").pipe(ca(o.onSocketReconnect(l))),l.fromReceived("Message").pipe(ca(o.onMessage(l))),l.fromReceived("GroupEnterNotice").pipe(ca(o.onGroupEnterNotice())),l.fromReceived("GroupLeaveNotice").pipe(ca(o.onGroupLeaveNotice())),l.fromReceived("GroupCountNotice").pipe(ca(o.onGroupCountNotice())),l.fromReceived("GroupAttributeAlt").pipe(ca(o.onGroupAttributeAlt())),l.fromReceived("UserJoinNotice").pipe(ca(o.onUserNotice(S.PeerOnlineState.ONLINE))),l.fromReceived("UserQuitNotice").pipe(ca(o.onUserNotice(S.PeerOnlineState.OFFLINE))),l.fromReceived("UserWaitNotice").pipe(ca(o.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))}))}).forEach(function(s,l){o.loginSocketSubs[l].receivers.push(s.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(o,s,l){var d=this;return im(ad(function(){d.userJoinOptions=new is(s),o.sendPacket("UserJoin",{account:d.context.uid,instance:d.instanceId,opt:d.userJoinOptions.toLong(),seq:l,ticket:o.ticket})}),o.fromReceived("UserResp").pipe(aa(function(h){return l.eq(h.seq)}),ca(function(h){if((h=h.code)!==0)throw d.clearSockets(),d.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",h],jg);d.log("ENV_%d logged in",o.env)}),qf(o),hb(15e3))).pipe(wb(function(h){return h!==void 0}),Ga(function(h){return h instanceof pb&&d.warn("Login response timeout, rejoin: %s",s),Z(h)}))}},{key:"getSocketLoginObservables",value:function(o,s){var l=this;return o.map(function(d){return d.pipe(ca(function(h){h.listenerCount("socketUserDrop")===0&&h.on("socketUserDrop",function(p){return l.onUserDrop(p,h)})}),Cc(function(h,p){return l.incSeqIfNeeded(h.env),l.requestSocketLogin(h,p!==0,p===0?s:l.seq)}),pe())})}},{key:"incSeqIfNeeded",value:function(o){if(![0,1].includes(o))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[o]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[o]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var o=this.curLoginSockets,s=-1,l=o==null?0:o.length,d=0,h=[];++s<l;){var p=o[s];p&&(h[d++]=p)}return h}},{key:"emitMessage",value:function(o,s){var l=o.options,d=o.payload,h=o.src,p=o.dst,f=o.instance,_=o.dialogue,g=o.sequence,b=o.ms,C=o.MiscMap;this.dialogueSequenceLru.set(_.toString(),g),f="".concat(f,"-").concat(_,"#").concat(g),this.msgDedupLru.has(f)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",s,f):(this.msgDedupLru.set(f,void 0),s=new ae(l),this.lastLoginSockets.forEach(function(){var k=J(w.mark(function A(P){var x;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,P.pipe(Ka(1)).toPromise();case 2:x=j.sent,r.sendMessageAck(o,x);case 4:case"end":return j.stop()}},A)}));return function(A){return k.apply(this,arguments)}}()),l=s.isZlibCompressed(),s.isInvitation()?(p=pa(l?nl(Xm(d,Uint8Array.of(0,0,0,0))):d),p=JSON.parse(p),this.log("The received invitation body is %o",p),this.emit("invitationMessage",{body:p,type:s.getInvitationType(),peerId:h,serverReceivedTs:b.toNumber()})):s.isTextMessage()?(C=s.isPeerTextMessage(),d=pa(l?nl(Xm(d,Uint8Array.of(0,0,0,0))):d),this.info("Received a %s %s text message from %s to %s, %s",l?" compressed":"",C?"peer":"channel",oa(h),oa(p),f),C?(h={text:d,peerId:h,properties:{serverReceivedTs:b.toNumber(),isOfflineMessage:s.isFromCache()}},this.emit("peerTextMessage",h)):this.emit("channelTextMessage",{channelId:p,memberId:h,text:d,properties:{serverReceivedTs:b.toNumber(),isOfflineMessage:!1}})):s.isRawMessage()?(_=s.isRawPeerMessage(),C=(C=C.description)===void 0?"":pa(C),d=l?nl(d):d,this.info("Received a %s %s raw message from %s to %s, %s",l?" compressed":"",_?"peer":"channel",oa(h),oa(p),f),_?(h={desc:C,raw:d,peerId:h,properties:{serverReceivedTs:b.toNumber(),isOfflineMessage:s.isFromCache()}},this.emit("peerRawMessage",h)):this.emit("channelRawMessage",{desc:C,raw:d,channelId:p,memberId:h,properties:{serverReceivedTs:b.toNumber(),isOfflineMessage:!1}})):(s.isImageMessage()||s.isFileMessage())&&(d=s.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",d?"peer":"channel",oa(h),oa(p),f),d?this.emit("peerMediaMessage",{messageType:s.isImageMessage()?"IMAGE":"FILE",details:C,peerId:h,properties:{serverReceivedTs:b.toNumber(),isOfflineMessage:s.isFromCache()}}):this.emit("channelMediaMessage",{messageType:s.isImageMessage()?"IMAGE":"FILE",details:C,memberId:h,channelId:p,properties:{serverReceivedTs:b.toNumber(),isOfflineMessage:s.isFromCache()}})))}},{key:"onSocketReconnect",value:function(o){var s=this;return function(){var l=[0,1].filter(function(d){return d!==o.env})[0];(l=s.connection.curOpenSockets[l])&&!l.loggedIn&&s.emit("connectionLost")}}},{key:"onUserDrop",value:function(o,s){var l;o=o.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(s.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:s.address,serverCode:o,sid:Xa(this.instanceId),userId:this.context.uid},(l=this.context.config.enableCloudProxy)!==null&&l!==void 0&&l),o===10006||o===10001?this.warn("Login too often and kicked off, reconnect and login"):o===10009?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(o)&&(this.emit("userDrop",o),this.clearSockets())}},{key:"clearSockets",value:function(){var o=this,s=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,l=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(d){o.cleanLoginSubs(d,l),o.connection.closeSocket(d,s)})}},{key:"onMessage",value:function(o){var s=this;return function(l){var d=l.dialogue,h=l.instance,p=l.sequence,f=l.options;if(l.src===s.context.uid)s.log("The message is from the local account, ignored");else{var _=d.toString(),g=s.dialPendingMsgSubjectMap.get(_);if(d="".concat(h,"-").concat(d,"#").concat(p),g)g.next(l),s.log("Env_%d: The dialogue has pending messages, next: %s",o.env,d);else{var b=s.dialogueSequenceLru.get(_);if(g=!b&&p.eq(1),h=b!==void 0&&p.sub(b).eq(1),g||h)s.emitMessage(l,o.env);else{if(b){if(p.lte(b))return;s.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",o.env,d)}else s.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",o.env,d);p=new Pa,s.dialPendingMsgSubjectMap.set(_,p);var C=p.pipe(Qs(Pk),xg(function(k,A){return[].concat(G(k),[A])},[]),ba(function(k){return G(k).sort(function(A,P){return A=A.sequence,P=P.sequence,A.eq(P)?0:A.gt(P)?1:-1})}),sm(1));f=!(f=new ae(f)).isFromCache()&&!f.isBufferedMessage(),C.pipe(ob(Bc(f?750:1500)),aa(function(k){if(2>k.length)return!1;for(var A=b===void 0?U.fromNumber(1,!0):b.add(1),P=0;P<k.length;A=A.add(1),P++)if(!k[P].sequence.eq(A))return!1;return!0}),wg(function(){s.dialPendingMsgSubjectMap.delete(_)})).subscribe(function(k){k.forEach(function(A){s.emitMessage(A,o.env),s.log("Env_%d: The message queue has fully ordered, emitting: %s",o.env,"".concat(A.instance,"-").concat(A.dialogue,"#").concat(A.sequence))})},function(k){k instanceof vg&&C.pipe(Ka(1)).subscribe(function(A){return A.forEach(function(P){s.log("Env_%d: The message pending queue expired, emitting: %s",o.env,"".concat(P.instance,"-").concat(P.dialogue,"#").concat(P.sequence)),s.emitMessage(P,o.env)})})}),p.next(l)}}}}}},{key:"onGroupEnterNotice",value:function(){var o=this;return function(s){o.emit("memberNotice",{channelId:s.group,seq:s.seq,instance:s.instance,memberId:s.user,type:"MemberJoined",size:s.size})}}},{key:"onGroupLeaveNotice",value:function(){var o=this;return function(s){o.emit("memberNotice",{channelId:s.group,seq:s.seq,instance:s.instance,memberId:s.user,type:"MemberLeft",size:s.size})}}},{key:"onGroupCountNotice",value:function(){var o=this;return function(s){o.emit("memberNotice",{channelId:s.group,seq:s.seq,instance:s.instance,type:"MemberCountUpdated",size:s.size})}}},{key:"onGroupAttributeAlt",value:function(){var o=this;return function(s){var l=s.group;s=ff(s,kD),o.emit("channelAttributesUpdated",ua({channelId:l},s))}}},{key:"onUserNotice",value:function(o){var s=this;return function(l){s.emit("peerOnlineStatusChanged",{peerId:l.user,instance:l.instance,seq:l.seq,state:o})}}}],[{key:"sendMessageAck",value:function(o,s){var l=new ae(o.options);(l.isInvitation()||l.isPeerMessage())&&s.sendPacket("Ack",{code:0,dialogue:o.dialogue,instance:o.instance,sequence:o.sequence})}}]),r}(tb());m(ls,"genTimeoutError",function(e,r){return bb(void 0).pipe(cd(r===void 0?1e4:r),ba(function(){throw new db(["Request timed out after %ds",r===void 0?1e4:r],e)}))});var ms,ol,pl=0,ql=0;Ud.v1=function(e,r,i){i=r&&i||0;var o=r||[],s=(e=e||{}).node||ms,l=e.clockseq!==void 0?e.clockseq:ol;if(s==null||l==null){var d=Jq();s==null&&(s=ms=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),l==null&&(l=ol=16383&(d[6]<<8|d[7]))}d=e.msecs!==void 0?e.msecs:new Date().getTime();var h=e.nsecs!==void 0?e.nsecs:ql+1,p=d-pl+(h-ql)/1e4;if(0>p&&e.clockseq===void 0&&(l=l+1&16383),(0>p||d>pl)&&e.nsecs===void 0&&(h=0),1e4<=h)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=d,ql=h,ol=l,e=(1e4*(268435455&(d+=122192928e5))+h)%4294967296,o[i++]=e>>>24&255,o[i++]=e>>>16&255,o[i++]=e>>>8&255,o[i++]=255&e,e=d/4294967296*1e4&268435455,o[i++]=e>>>8&255,o[i++]=255&e,o[i++]=e>>>24&15|16,o[i++]=e>>>16&255,o[i++]=l>>>8|128,o[i++]=255&l,l=0;6>l;++l)o[i+l]=s[l];return r||Kq(o)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(e){function r(o,s,l){W(this,r);var d=i.call(this,l,"RtmLocalInvitation",!0);return m(n(d),"state",Ba.IDLE),m(n(d),"localInvitationEnd$",Ca(gb(n(d),"LocalInvitationAccepted"),gb(n(d),"LocalInvitationRefused"),gb(n(d),"LocalInvitationFailure"),gb(n(d),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(d),"callId",Ud.v4()),m(n(d),"_content",""),m(n(d),"_channelId",""),m(n(d),"_response",""),m(n(d),"calleeId",void 0),m(n(d),"logger",void 0),m(n(d),"getSession",void 0),d.calleeId=o,d.getSession=s,d.logger=l,d}la(r,e);var i=ma(r);return Ha(r,[{key:"channelId",get:function(){return this._channelId},set:function(o){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=o)}},{key:"content",get:function(){return this._content},set:function(o){this.log("set content for %s",this.callId),this._content=o}},{key:"response",get:function(){return this._response},set:function(o){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var o,s=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 \xD7 1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark(function l(){var d,h,p;return w.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,s.getSession().sendInvitationMessage({peerId:s.calleeId,callId:s.callId,extra:s._content,type:"CallInvite",channelId:s._channelId});case 2:if(d=f.sent,h=d.hasPeerReceived,p=d.hasReSent,!s.isLocalInvitationEnd()){f.next=7;break}throw new db("send invitation timeout");case 7:if(s.log("The local invitation has sent to the callee"),h||p){f.next=11;break}throw o=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(h){f.next=14;break}throw o=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return f.stop()}},l)}))).pipe(oe(function(l){return l.pipe(ca(function(d){if(!(d instanceof rl))throw d}),cd(2e3))}),hb(3e4),Ga(function(l){return Sa(l)&&s.warn("local invitation ack timed out"),Z(l)}),ob(this.localInvitationEnd$)).subscribe({next:function(){s.state===Ba.RECEIVED_BY_REMOTE?s.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):s.state!==Ba.SENT_TO_REMOTE?s.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(s.info("The peer received the local invitation %s.",s.callId),s.state=Ba.RECEIVED_BY_REMOTE,s.emit("LocalInvitationReceivedByPeer"),s.localInvitationEnd$.pipe(hb(6e4),Ga(function(l){return Sa(l)&&s.warn("local invitation expired"),Z(l)})).subscribe({error:function(){s.state=Ba.FAILURE,s.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(l){s.isLocalInvitationEnd()?s.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(s.state=Ba.FAILURE,Sa(l)&&o?o.code==="PEER_NOT_ONLINE"?s.emit("LocalInvitationFailure",bf.PEER_OFFLINE):o.code==="RESENT_AND_OFFLINE"&&s.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(l)?s.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):l.name==="RtmInvalidStatusError"?s.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):s.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 \xD7 1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(o){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=o,this.emit("LocalInvitationAccepted",o))}}},{key:"onRefuseReceived",value:function(o){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=o,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",o)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),r}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(e){function r(o){var s=o.invitationChannel,l=o.extraContent,d=o.callId,h=o.callerId,p=o.logger;o=o.getSession,W(this,r);var f=i.call(this,p,"RtmRemoteInvitation",!0);return m(n(f),"state",kb.INVITATION_RECEIVED),m(n(f),"remoteInvitationEnd$",Ca(gb(n(f),"RemoteInvitationCanceled"),gb(n(f),"RemoteInvitationRefused"),gb(n(f),"RemoteInvitationAccepted"),gb(n(f),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(f),"callerId",void 0),m(n(f),"callId",void 0),m(n(f),"_getSession",void 0),m(n(f),"logger",void 0),m(n(f),"_content",void 0),m(n(f),"_channelId",void 0),m(n(f),"_response",""),f._channelId=s,f._content=l,f.callId=d,f.callerId=h,f._getSession=o,f.logger=p,f.remoteInvitationEnd$.pipe(hb(6e4),Ga(function(_){return Sa(_)&&f.warn("Remote invitation expired"),Z(_)})).subscribe({error:function(){f.state=kb.FAILURE,f.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),f}la(r,e);var i=ma(r);return Ha(r,[{key:"channelId",get:function(){return this._channelId},set:function(o){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(o){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(o){this._response=o}},{key:"accept",value:function(){var o,s=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 \xD7 1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb(function(){return ad(J(w.mark(function l(){return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",s._getSession().sendInvitationMessage({peerId:s.callerId,callId:s.callId,extra:s.response,type:"CallAccept",isAcceptAck:!1,channelId:s.channelId}));case 1:case"end":return d.stop()}},l)})))}),wb(function(l){return o=l.hasPeerReceived}),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(l){if(s.logError(l),s.state=kb.FAILURE,Sa(l))switch(o){case void 0:case!0:return void s.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void s.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}s.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 \xD7 1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(o){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=o,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",o))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),r}(tb()),nD=function(e){function r(o,s){W(this,r);var l=i.call(this,s,"InvitationManager");return m(n(l),"getSession",void 0),m(n(l),"invitationDispatcher",new ea.EventEmitter),m(n(l),"outgoingLocalInvitations",new Map),m(n(l),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(l),"logger",void 0),l.getSession=cn(o),l.logger=s,l.invitationDispatcher.on("remoteInvitationToManager",function(d){var h=d.callId,p=d.extra,f=d.callerId;d=d.channelId,l.receivedRemoteInvitations.has(h)||((p=new mD({callerId:f,callId:h,getSession:l.getSession,logger:s,extraContent:p,invitationChannel:d})).remoteInvitationEnd$.subscribe(function(){l.receivedRemoteInvitations.delete(h)}),l.receivedRemoteInvitations.set(h,p),l.emit("remoteInvitationInstance",p))}),l.invitationDispatcher.on("acceptAckToRemoteInvitation",function(d){(d=l.receivedRemoteInvitations.get(d.callId))&&d.onAcceptAckReceived()}),l.invitationDispatcher.on("cancelToRemoteInvitation",function(d){var h=d.extra;(d=l.receivedRemoteInvitations.get(d.callId))&&d.onCancelReceived(h)}),l.invitationDispatcher.on("acceptToLocalInvitation",function(d){var h=d.extra;(d=l.outgoingLocalInvitations.get(d.callId))&&d.onAcceptReceived(h)}),l.invitationDispatcher.on("refuseToLocalInvitation",function(d){var h=d.extra;(d=l.outgoingLocalInvitations.get(d.callId))&&d.onRefuseReceived(h)}),l}la(r,e);var i=ma(r);return Ha(r,[{key:"invitationMessageHandler",value:function(o){var s=o.body,l=s.callId,d=s.extra;d=d===void 0?"":d;var h=s.type,p=(s=s.channel)===void 0?"":s,f=o.type;switch(s=o.peerId,o=o.serverReceivedTs,f){case"CallAccept":h==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:l}):h==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:l,extra:d});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:l,callerId:s,extra:d,channelId:p});break;case"CallCancel":if(l==="0"){l="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(p,"_").concat(d),this.getSession().emit("peerTextMessage",{peerId:s,properties:{serverReceivedTs:o,isOfflineMessage:!1},text:l});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:l,extra:d});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:l,extra:d});break;default:throw Im("invitationType",f)}}},{key:"genLocalInvitation",value:function(o){var s=this,l=new lD(o,this.getSession,this.logger);return l.localInvitationEnd$.subscribe(function(){s.outgoingLocalInvitations.delete(l.callId)}),this.outgoingLocalInvitations.set(l.callId,l),l}}]),r}(tb()),oD=function(e,r,i){var o=!0,s=!0;if(typeof e!="function")throw new TypeError("Expected a function");return lb(i)&&(o="leading"in i?!!i.leading:o,s="trailing"in i?!!i.trailing:s),qC(e,r,{leading:o,maxWait:r,trailing:s})},ub,cf;(function(e){e[e.JOINED=0]="JOINED",e[e.LEFT=1]="LEFT"})(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(e){function r(o,s,l,d){W(this,r);var h=i.call(this,d,"RtmChannel",!0);return m(n(h),"onMemberCountUpdated",oD(function(p){p!==h.memberCount&&(h.memberCount=p,h.emit("MemberCountUpdated",p))},1e3)),m(n(h),"getSession",void 0),m(n(h),"memberCount",0),m(n(h),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(h),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(h),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(h),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(h),"channelId",void 0),m(n(h),"client",void 0),m(n(h),"onAttributesUpdated",function(p){var f=p.channelId,_=p.attributeMaps,g=p.seq;p=p.instance.toString();var b=h.attributesSeqLru.get(p);if((!b||g.greaterThan(b))&&(h.attributesSeqLru.set(p,g),f===h.channelId)){for(f={},g=0;g<_.length;g++){var C=_[g];p=C.key,b=C.ms;var k=C.value;if(C=C.origin,typeof p!="string"||!U.isLong(b)||typeof k!="string"||!za(C))break;f[p]={value:k,lastUpdateUserId:C,lastUpdateTs:b.toNumber()}}h.emit("AttributesUpdated",f)}}),m(n(h),"onChannelTextMessage",function(p){var f=p.memberId,_=p.text,g=p.properties;p.channelId===h.channelId&&h.emit("ChannelMessage",{text:_,messageType:S.MessageType.TEXT},f,g)}),m(n(h),"onChannelMediaMessage",function(p){var f=p.memberId,_=p.properties,g=p.details,b=p.messageType;p.channelId===h.channelId&&(b==="FILE"?h.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(g.media_size),10),description:pa(g.media_description),fileName:pa(g.media_filename),mediaId:pa(g.media_id),thumbnail:new Blob([g.media_thumbnail])},f,_):b==="IMAGE"&&h.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(g.media_size),10),description:pa(g.media_description),fileName:pa(g.media_filename),mediaId:pa(g.media_id),thumbnail:new Blob([g.media_thumbnail]),height:parseInt(pa(g.media_height),10),width:parseInt(pa(g.media_width),10),thumbnailHeight:parseInt(pa(g.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(g.media_thumbnailwidth),10)},f,_))}),m(n(h),"onChannelRawMessage",function(p){var f=p.desc,_=p.raw,g=p.memberId,b=p.properties;p.channelId===h.channelId&&h.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:_,description:f},g,b)}),m(n(h),"onMemberNotice",function(p){var f=p.memberId,_=p.type,g=p.size;if(p.channelId===h.channelId){var b=p.instance.toString();p=p.seq.toString();var C={MemberLeft:h.memberLeftLru,MemberJoined:h.memberJoinedLru,MemberCountUpdated:void 0}[_];if(C){if(C.has(b+p))return void h.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",_,p,oa(h.channelId),oa(f||""));if(C.set(b+p,void 0),typeof f!="string")return;if(f!==h.getSession().context.uid&&((b=h.memberJoinStateLru.get(f))===cf.JOINED&&_==="MemberJoined"||b===cf.LEFT&&_==="MemberLeft"))return void h.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",_,p,oa(h.channelId),oa(f||""));h.memberJoinStateLru.set(f,_==="MemberJoined"?cf.JOINED:cf.LEFT)}h.info("Channel %s - %s, memberId: %s",_,oa(h.channelId),_==="MemberCountUpdated"?"[unknown]":oa(f||"")),b=f===h.getSession().context.uid,_==="MemberLeft"&&za(f)||_==="MemberJoined"&&za(f)?(b||h.emit(_,f),h.onMemberCountUpdated(g)):_==="MemberCountUpdated"&&typeof g=="number"&&h.onMemberCountUpdated(g)}}),h.getSession=cn(s),h.channelId=o,h.client=l,h.info("A channel created, id %s",oa(o)),h}la(r,e);var i=ma(r);return Ha(r,[{key:"join",value:function(){var o=J(w.mark(function s(){var l,d,h,p,f,_,g;return w.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(za(this.channelId)){b.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:b.prev=2,l=this.getSession(),b.next=9;break;case 6:throw b.prev=6,b.t0=b.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!l.joinedChannels.has(this)){b.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:l.context.uid,elapse:fb(l.startTime),errCode:Uq,sid:Xa(l.instanceId)},(d=this.client.context.config.enableCloudProxy)!==null&&d!==void 0&&d),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(b.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){b.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:l.context.uid,elapse:fb(l.startTime),errCode:Wq,sid:Xa(l.instanceId)},(f=this.client.context.config.enableCloudProxy)!==null&&f!==void 0&&f),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(l.joinedChannels.size!==20){b.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:l.context.uid,elapse:fb(l.startTime),errCode:Tq,sid:Xa(l.instanceId)},(_=this.client.context.config.enableCloudProxy)!==null&&_!==void 0&&_),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:l.context.uid,elapse:fb(l.startTime),errCode:0,sid:Xa(l.instanceId)},(h=this.client.context.config.enableCloudProxy)!==null&&h!==void 0&&h),b.next=23,l.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(l.startTime),errCode:0,sid:Xa(l.instanceId),serverErrCode:0,userId:l.context.uid},(p=this.client.context.config.enableCloudProxy)!==null&&p!==void 0&&p),this.info("The channel %s joined successfully",oa(this.channelId)),l.on("channelTextMessage",this.onChannelTextMessage),l.on("channelRawMessage",this.onChannelRawMessage),l.on("channelMediaMessage",this.onChannelMediaMessage),l.on("memberNotice",this.onMemberNotice),l.on("channelAttributesUpdated",this.onAttributesUpdated),b.next=41;break;case 32:if(b.prev=32,b.t1=b.catch(12),this.logError(b.t1),!sa(b.t1)){b.next=37;break}throw b.t1;case 37:if(!Sa(b.t1)){b.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(l.startTime),errCode:Sq,sid:Xa(l.instanceId),serverErrCode:0,userId:l.context.uid},(g=this.client.context.config.enableCloudProxy)!==null&&g!==void 0&&g),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:b.t1});case 41:case"end":return b.stop()}},s,this,[[2,6],[12,32]])}));return function(){return o.apply(this,arguments)}}()},{key:"leave",value:function(){var o=J(w.mark(function s(){var l,d,h,p;return w.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:f.prev=0,d=this.getSession(),f.next=7;break;case 4:throw f.prev=4,f.t0=f.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(d.joinedChannels.has(this)){f.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:f.prev=9,d.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,d.removeListener("channelTextMessage",this.onChannelTextMessage),d.removeListener("channelRawMessage",this.onChannelRawMessage),d.removeListener("channelMediaMessage",this.onChannelMediaMessage),d.removeListener("memberNotice",this.onMemberNotice),d.removeListener("channelAttributesUpdated",this.onAttributesUpdated),f.next=32;break;case 23:if(f.prev=23,f.t1=f.catch(9),this.logError(f.t1),!sa(f.t1)){f.next=30;break}throw f.t1.code===void 0&&(f.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(d.startTime),errCode:Yq,sid:Xa(d.instanceId),userId:d.context.uid},(p=this.client.context.config.enableCloudProxy)!==null&&p!==void 0&&p),f.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(d.startTime),errCode:Xq,sid:Xa(d.instanceId),userId:d.context.uid},(h=this.client.context.config.enableCloudProxy)!==null&&h!==void 0&&h),new Wc("The channel leave failure",{code:Xq,originalError:f.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(d.startTime),errCode:0,sid:Xa(d.instanceId),userId:d.context.uid},(l=this.client.context.config.enableCloudProxy)!==null&&l!==void 0&&l);case 33:case"end":return f.stop()}},s,this,[[0,4],[9,23]])}));return function(){return o.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_,g=this,b=arguments;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:d=1<b.length&&b[1]!==void 0?b[1]:{},h=d.enableHistoricalMessaging,p=h!==void 0&&h,Tm(l,Hh),C.prev=2,f=this.getSession(),C.next=9;break;case 6:throw C.prev=6,C.t0=C.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(f.joinedChannels.has(this)){C.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){C.next=16;break}return _=Date.now(),C.next=15,new Promise(function(k,A){var P=function(){var j=J(w.mark(function z(){var _t;return w.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:return _t=Date.now()-_,ue.prev=1,ue.next=4,Gg({message:l,peerId:g.channelId,toPeer:!1,session:g.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:_t,logger:g.logger,options:{enableHistoricalMessaging:p,enableOfflineMessaging:!1}});case 4:k(),ue.next=12;break;case 7:ue.prev=7,ue.t0=ue.catch(1),Sa(ue.t0)&&A(new db(Yd(g.name,"sendMessageToPeer",1e4),Yk)),sa(ue.t0)&&A(ue.t0),A(new da("Channel message send failure",{code:hg,originalError:ue.t0}));case 12:return ue.prev=12,clearTimeout(x),ue.finish(12);case 15:case"end":return ue.stop()}},z,null,[[1,7,12,15]])}));return function(){return j.apply(this,arguments)}}();g.client.internalEmitter.once("RECONNECTED",P);var x=setTimeout(function(){g.client.internalEmitter.off("RECONNECTED",P),A(new db(Yd(g.name,"sendMessageToPeer",1e4),Yk))},9e3)});case 15:return C.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){C.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return C.prev=18,C.next=21,Gg({message:l,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:p,enableOfflineMessaging:!1}});case 21:C.next=31;break;case 23:if(C.prev=23,C.t1=C.catch(18),!Sa(C.t1)){C.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(C.t1)){C.next=30;break}throw this.logError(C.t1),C.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return C.stop()}},s,this,[[2,6],[18,23]])}));return function(s){return o.apply(this,arguments)}}()},{key:"getMembers",value:function(){var o=J(w.mark(function s(){var l,d,h;return w.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:p.prev=0,p.prev=1,l=this.getSession(),p.next=8;break;case 5:throw p.prev=5,p.t0=p.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(l.joinedChannels.has(this)){p.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return d=this.getSession().requestChannelMemberList(this.channelId),p.next=13,d.pipe(ba(function(f){return f.memberInfos.map(function(_){return _.account})})).toPromise();case 13:return h=p.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),h.map(oa)),p.abrupt("return",h);case 18:if(p.prev=18,p.t1=p.catch(0),!sa(p.t1)){p.next=23;break}throw this.logError(p.t1),p.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return p.stop()}},s,this,[[0,18],[1,5]])}));return function(){return o.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var o=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some(function(s){return s.channelId===o.channelId})}}]),r}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(e){function r(o,s,l,d){W(this,r);var h=i.call(this,s,"RtmClient",!0);return m(n(h),"connectionState",T.DISCONNECTED),m(n(h),"internalEmitter",new ea),m(n(h),"context",void 0),m(n(h),"attributes",{}),m(n(h),"loginPromise",void 0),m(n(h),"attributeDrafts",new Set),m(n(h),"session",void 0),m(n(h),"lastLoginTime",void 0),m(n(h),"reconnId",0),m(n(h),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(h),"invitationManager",void 0),m(n(h),"subscribedPeerStatusCache",{}),m(n(h),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(h),"peerUnreachableTimers",{}),m(n(h),"mediaTaskManager",void 0),m(n(h),"setParameters",void 0),m(n(h),"updateConfig",void 0),m(n(h),"userDropHandler",function(p){if(h.connectionState!==T.ABORTED)switch(p){case 11:h.logError("Kicked off by remote session"),h.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:h.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[p])),h.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:h.logError("User kicked off for unknown code: ".concat(p)),h.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}}),h.context=new ZC(o,l,s),h.mediaTaskManager=new fs(s),h.context.config=l,h.internalEmitter.setMaxListeners(512),h.setParameters=d.bind(n(h)),h.updateConfig=d.bind(n(h)),h.invitationManager=new nD(function(){return h.session},s),h.invitationManager.on("remoteInvitationInstance",function(p){h.emit("RemoteInvitationReceived",p)}),h}la(r,e);var i=ma(r);return Ha(r,[{key:"renewToken",value:function(){var o=J(w.mark(function s(l){var d,h,p,f=this;return w.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(typeof l=="string"&&l.length!==0){_.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){_.next=5;break}return _.next=5,new Promise(function(){});case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){_.next=7;break}throw new K("The client is not logged in",uA);case 7:if(this.session!==void 0){_.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return _.prev=9,d=this.context.token,this.context.token=l,_.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd(function(){return Error("No available edge address to connect")}),oe(function(g){return g.pipe(ca(function(b){if(sa(b))throw b}),cd(2500),Ka(4))}),Ka(1),hb(2e4),Ga(function(g){return Sa(g)&&f.warn("renewToken timed out"),Z(g)})).toPromise();case 14:h=_.sent,p=h.ticket,_.next=27;break;case 18:if(_.prev=18,_.t0=_.catch(9),this.context.token=d,_.t0.code!==$q&&_.t0.code!==ar){_.next=23;break}throw new Ye("Invalid token",tA);case 23:if(_.t0.code!==Kh){_.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(_.t0)){_.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter(function(g){return g!==void 0}).forEach(function(g){return g.ticket=p});case 28:case"end":return _.stop()}},s,this,[[9,18]])}));return function(s){return o.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var o=J(w.mark(function s(l){var d,h,p=this;return w.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.connectionState===T.CONNECTED){f.next=2;break}throw new K("The client is not logged in",pA);case 2:if(this.session!==void 0){f.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(l)||l.length===0||l.some(function(_){return!za(_)})||256<l.length)){f.next=6;break}throw new I("invalid arguments",er);case 6:return f.next=8,this.session.requestPeersOnlineStatus(l).toPromise();case 8:return d=f.sent,h=uc(Jk(d.userInfos,"account"),function(_){return!!_.ts}),Object.keys(h).forEach(function(_){if(_ in p.subscribedPeerStatusCache&&p.subscribedPeerStatusCache[_]!==S.PeerOnlineState.UNREACHABLE){var g=h[_]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;p.emit("PeersOnlineStatusChanged",m({},_,g)),p.subscribedPeerStatusCache[_]=g}}),f.abrupt("return",h);case 12:case"end":return f.stop()}},s,this)}));return function(s){return o.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_,g,b,C=this;return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(this.connectionState===T.CONNECTED){k.next=2;break}throw new K("The client is not logged in",aA);case 2:if(this.session!==void 0){k.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(l)&&l.every(function(A){return typeof A=="string"})&&l.length!==0){k.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<l.length)){k.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:d=0;case 9:if(!(d<l.length)){k.next=16;break}if(za(h=l[d])){k.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",h],Oq);case 13:d++,k.next=9;break;case 16:return k.next=18,this.session.requestGetChannelMemberCount(l).toPromise();case 18:for(p=k.sent,f=p.groupInfos,_={},g=function(A){var P=(A=f[A]).group,x=A.memberCount;za(P)&&typeof x=="number"&&(C.session.joinedChannels.forEach(function(j){j.channelId===P&&j.onMemberCountUpdated(x)}),_[P]=x)},b=0;b<f.length;b++)g(b);return k.abrupt("return",_);case 24:case"end":return k.stop()}},s,this)}));return function(s){return o.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var o=J(w.mark(function s(l){var d,h;return w.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(uf({attributes:l,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){p.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){p.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return d=this.session.requestSetLocalUserAttributes(l).toPromise(),h={attribute:l,promise:d},this.attributeDrafts.add(h),p.prev=8,p.next=11,d;case 11:this.attributes=l,p.next=19;break;case 14:if(p.prev=14,p.t0=p.catch(8),!sa(p.t0)){p.next=18;break}throw p.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return p.prev=19,this.attributeDrafts.delete(h),p.finish(19);case 22:case"end":return p.stop()}},s,this,[[8,14,19,22]])}));return function(s){return o.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var o=J(w.mark(function s(l,d){var h,p,f,_,g,b=arguments;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(h=2<b.length&&b[2]!==void 0?b[2]:{},p=h.enableNotificationToChannelMembers,f=p!==void 0&&p,uf({attributes:d,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){C.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){C.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return _=this.session.requestSetChannelAttributes(l,d,f).toPromise(),C.prev=7,C.next=10,_;case 10:g=uc(d,function(k){return new Blob([k]).size}),this.channelAttributesCacheLru.set(l,g),C.next=19;break;case 14:if(C.prev=14,C.t0=C.catch(7),!sa(C.t0)){C.next=18;break}throw C.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return C.stop()}},s,this,[[7,14]])}));return function(s,l){return o.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var o=J(w.mark(function s(l){var d,h,p;return w.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(d=ua(ua({},this.attributes),l),uf({attributes:l,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:d,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){f.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){f.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return h=this.session.requestAddOrUpdateLocalUserAttributes(l).toPromise(),p={attribute:d,promise:h},this.attributeDrafts.add(p),f.prev=10,f.next=13,h;case 13:this.attributes=d,f.next=21;break;case 16:if(f.prev=16,f.t0=f.catch(10),!sa(f.t0)){f.next=20;break}throw f.t0;case 20:throw new I("arguments is not valid",er);case 21:return f.prev=21,this.attributeDrafts.delete(p),f.finish(21);case 24:case"end":return f.stop()}},s,this,[[10,16,21,24]])}));return function(s){return o.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var o=J(w.mark(function s(l,d){var h,p,f,_,g,b,C,k=arguments;return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(h=2<k.length&&k[2]!==void 0?k[2]:{},p=h.enableNotificationToChannelMembers,f=p!==void 0&&p,_=this.channelAttributesCacheLru.get(l,{}),g=uc(d,function(P){return new Blob([P]).size}),b=ua(ua({},_),g),uf({attributes:d,attrSizeMap:b,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){A.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(this.session!==void 0){A.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return C=this.session.requestAddOrUpdateChannelAttributes(l,d,f).toPromise(),A.prev=10,A.next=13,C;case 13:this.channelAttributesCacheLru.set(l,b),A.next=21;break;case 16:if(A.prev=16,A.t0=A.catch(10),!sa(A.t0)){A.next=20;break}throw A.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return A.stop()}},s,this,[[10,16]])}));return function(s,l){return o.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var o=J(w.mark(function s(l){var d,h,p,f;return w.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(Array.isArray(l)&&l.length!==0&&!l.some(function(g){return g.length===0})){_.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){_.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return d=this.session.requestDeleteLocalUserAttributesByKeys(l).toPromise(),h={attribute:Gk(this.attributes,l),promise:d},this.attributeDrafts.add(h),_.prev=9,_.next=12,d;case 12:for(p=0;p<l.length;p++)f=l[p],delete this.attributes[f];_.next=20;break;case 15:if(_.prev=15,_.t0=_.catch(9),!sa(_.t0)){_.next=19;break}throw _.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return _.prev=20,this.attributeDrafts.delete(h),_.finish(20);case 23:case"end":return _.stop()}},s,this,[[9,15,20,23]])}));return function(s){return o.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var o=J(w.mark(function s(l,d){var h,p,f,_,g,b,C,k=arguments;return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(h=2<k.length&&k[2]!==void 0?k[2]:{},p=h.enableNotificationToChannelMembers,f=p!==void 0&&p,Array.isArray(d)&&d.length!==0&&za(l)&&!d.some(function(P){return P.length===0||512<P.length})){A.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){A.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){A.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return _=this.session.requestDeleteChannelAttributesByKeys(l,d,f).toPromise(),A.prev=8,A.next=11,_;case 11:if(g=this.channelAttributesCacheLru.get(l))for(b=0;b<d.length;b++)C=d[b],delete g[C];A.next=20;break;case 15:if(A.prev=15,A.t0=A.catch(8),!sa(A.t0)){A.next=19;break}throw A.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return A.stop()}},s,this,[[8,15]])}));return function(s,l){return o.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var o=J(w.mark(function s(){var l,d;return w.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.connectionState===T.CONNECTED){h.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){h.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return l=this.session.requestClearLocalUserAttributes().toPromise(),d={attribute:{},promise:l},this.attributeDrafts.add(d),h.prev=7,h.next=10,l;case 10:this.attributes={},h.next=18;break;case 13:if(h.prev=13,h.t0=h.catch(7),!sa(h.t0)){h.next=17;break}throw h.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return h.prev=18,this.attributeDrafts.delete(d),h.finish(18);case 21:case"end":return h.stop()}},s,this,[[7,13,18,21]])}));return function(){return o.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_=arguments;return w.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(d=1<_.length&&_[1]!==void 0?_[1]:{},h=d.enableNotificationToChannelMembers,p=h!==void 0&&h,this.connectionState===T.CONNECTED){g.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){g.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return f=this.session.requestClearChannelAttributes(l,p).toPromise(),g.prev=6,g.next=9,f;case 9:this.channelAttributesCacheLru.delete(l),g.next=17;break;case 12:if(g.prev=12,g.t0=g.catch(6),!sa(g.t0)){g.next=16;break}throw g.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return g.stop()}},s,this,[[6,12]])}));return function(s){return o.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var o=J(w.mark(function s(l){var d,h,p;return w.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(za(l)){f.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){f.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){f.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return f.prev=6,f.next=9,this.session.requestGetUserAttributeKeys(l).toPromise();case 9:return d=f.sent,h=d.keys,f.next=13,this.session.requestGetUserAttributesByKeys(l,h.slice(0,512)).toPromise();case 13:p=f.sent,f.next=21;break;case 16:if(f.prev=16,f.t0=f.catch(6),!sa(f.t0)){f.next=20;break}throw f.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return f.abrupt("return",Yp(p.attributeInfos.map(function(_){return[_.key,_.value]})));case 22:case"end":return f.stop()}},s,this,[[6,16]])}));return function(s){return o.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_,g,b,C,k,A,P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(za(l)){x.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){x.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){x.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return x.prev=6,x.next=9,this.session.requestGetChannelAttributesKeys(l).toPromise();case 9:return d=x.sent,h=d.keys,x.next=13,this.session.requestGetChannelAttributesByKeys(l,h).toPromise();case 13:p=x.sent,f=p.attributeMaps,x.next=22;break;case 17:if(x.prev=17,x.t0=x.catch(6),!sa(x.t0)){x.next=21;break}throw x.t0;case 21:throw new I("arguments is not valid",Ja);case 22:_={},g=0;case 24:if(!(g<f.length)){x.next=32;break}if(b=f[g],C=b.key,k=b.ms,A=b.value,P=b.origin,typeof C=="string"&&U.isLong(k)&&typeof A=="string"&&za(P)){x.next=28;break}return x.abrupt("break",32);case 28:_[C]={value:A,lastUpdateUserId:P,lastUpdateTs:k.toNumber()};case 29:g++,x.next=24;break;case 32:return this.channelAttributesCacheLru.set(l,uc(_,function(j){return new Blob([j.value]).size})),x.abrupt("return",_);case 34:case"end":return x.stop()}},s,this,[[6,17]])}));return function(s){return o.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var o=J(w.mark(function s(l,d){var h,p,f,_,g,b,C,k,A,P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(this.connectionState===T.CONNECTED){x.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){x.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(l,d),x.prev=5,x.next=8,this.session.requestGetChannelAttributesByKeys(l,d).toPromise();case 8:h=x.sent,p=h.attributeMaps,x.next=17;break;case 12:if(x.prev=12,x.t0=x.catch(5),!sa(x.t0)){x.next=16;break}throw x.t0;case 16:throw new I("arguments is not valid",Ja);case 17:f={},_=this.channelAttributesCacheLru.get(l,{}),g=0;case 20:if(!(g<p.length)){x.next=29;break}if(b=p[g],C=b.key,k=b.ms,A=b.value,P=b.origin,typeof C=="string"&&U.isLong(k)&&typeof A=="string"&&za(P)){x.next=24;break}return x.abrupt("break",29);case 24:_[C]=new Blob([A]).size,f[C]={value:A,lastUpdateUserId:P,lastUpdateTs:k.toNumber()};case 26:g++,x.next=20;break;case 29:return this.channelAttributesCacheLru.set(l,_),x.abrupt("return",f);case 31:case"end":return x.stop()}},s,this,[[5,12]])}));return function(s,l){return o.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var o=J(w.mark(function s(l,d){var h;return w.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.connectionState===T.CONNECTED){p.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){p.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(l,d),p.prev=5,p.next=8,this.session.requestGetUserAttributesByKeys(l,d).toPromise();case 8:h=p.sent,p.next=16;break;case 11:if(p.prev=11,p.t0=p.catch(5),!sa(p.t0)){p.next=15;break}throw p.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return p.abrupt("return",Yp(h.attributeInfos.map(function(f){return[f.key,f.value]})));case 17:case"end":return p.stop()}},s,this,[[5,11]])}));return function(s,l){return o.apply(this,arguments)}}()},{key:"login",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_=this;return w.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(Uk=!0,d=Bg(),h=l.token,l.token===this.context.appId&&(h=void 0),setTimeout(function(){var b;eb("Session",{appId:_.context.appId,did:navigator.userAgent,elapse:fb(_.session&&_.session.startTime),index:{index1:l.uid,index2:_.context.appId,index3:"enableLogUpload=".concat(_.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(d),token:h||"",userId:l.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},(b=_.context.config.enableCloudProxy)!==null&&b!==void 0&&b)},1e4),yd(l)&&za(l.uid)){g.next=7;break}throw new I("not a valid user id",Jh);case 7:if(typeof h!="string"||!h){g.next=11;break}this.context.token=h,g.next=13;break;case 11:if(typeof h=="string"||h==null){g.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return p=Date.now(),this.context.sid=Xa(d),this.loginPromise=this.loginImpl({uid:l.uid,instanceId:d}),this.info("RTM Client logging in as ".concat(oa(l.uid))),g.prev=17,g.next=20,this.loginPromise;case 20:g.next=27;break;case 22:throw g.prev=22,g.t0=g.catch(17),sa(g.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:g.t0.code||1,sc:g.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-p,sid:Xa(d),userId:l.uid},(f=this.context.config.enableCloudProxy)!==null&&f!==void 0&&f),this.context.token=void 0,g.t0;case 27:return g.prev=27,this.loginPromise=void 0,g.finish(27);case 30:Uk=!1;case 31:case"end":return g.stop()}},s,this,[[17,22,27,30]])}));return function(s){return o.apply(this,arguments)}}()},{key:"logout",value:function(){var o=J(w.mark(function s(){var l;return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!this.loginPromise){d.next=3;break}return d.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){d.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){d.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),d.abrupt("return");case 10:if(this.session!==void 0){d.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),d.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(l=this.context.config.enableCloudProxy)!==null&&l!==void 0&&l),d.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return d.stop()}},s,this)}));return function(){return o.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var o,s=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(o=this.context.config.enableCloudProxy)!==null&&o!==void 0&&o),this.session.logoutHandler().then(function(){s.log("Log out success")})),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var o=J(w.mark(function s(l,d){var h,p,f,_,g,b,C=this,k=arguments;return w.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(h=2<k.length&&k[2]!==void 0?k[2]:{},p=h.enableOfflineMessaging,f=p!==void 0&&p,_=h.enableHistoricalMessaging,g=_!==void 0&&_,Tm(l,ve),this.connectionState!==T.RECONNECTING){A.next=5;break}return b=Date.now(),A.abrupt("return",new Promise(function(P,x){var j=function(){var _t=J(w.mark(function ue(){var _n;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:if(C.session!==void 0){Ei.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return _n=Date.now()-b,Ei.prev=3,Ei.t0=P,Ei.next=7,Gg({message:l,peerId:d,toPeer:!0,session:C.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:_n,logger:C.logger,options:{enableHistoricalMessaging:g,enableOfflineMessaging:f}});case 7:Ei.t1=Ei.sent,(0,Ei.t0)(Ei.t1),Ei.next=16;break;case 11:Ei.prev=11,Ei.t2=Ei.catch(3),Sa(Ei.t2)&&x(new db(Yd(C.name,"sendMessageToPeer",1e4),Zk)),sa(Ei.t2)&&x(Ei.t2),x(new da("Peer-to-peer message send failure",{code:cr,originalError:Ei.t2}));case 16:return Ei.prev=16,clearTimeout(z),Ei.finish(16);case 19:case"end":return Ei.stop()}},ue,null,[[3,11,16,19]])}));return function(){return _t.apply(this,arguments)}}();C.internalEmitter.once("RECONNECTED",j);var z=setTimeout(function(){C.internalEmitter.off("RECONNECTED",j),x(new db(Yd(C.name,"sendMessageToPeer",1e4),Zk))},9e3)}));case 5:if(this.connectionState===T.CONNECTED){A.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(this.session!==void 0){A.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return A.prev=9,A.next=12,Gg({message:l,peerId:d,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:g,enableOfflineMessaging:f}});case 12:return A.abrupt("return",A.sent);case 15:if(A.prev=15,A.t0=A.catch(9),!Sa(A.t0)){A.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(A.t0)){A.next=21;break}throw A.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:A.t0});case 22:case"end":return A.stop()}},s,this,[[9,15]])}));return function(s,l){return o.apply(this,arguments)}}()},{key:"createChannel",value:function(o){var s=this;if(!za(o))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:o})[0]],Zz);return new pD(o,function(){return s.session},this,this.logger)}},{key:"createLocalInvitation",value:function(o){if(!za(o))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:o})[0]],xc);return this.invitationManager.genLocalInvitation(o)}},{key:"subscribePeersOnlineStatus",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_,g,b,C,k,A,P,x,j,z=this;return w.wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:if(this.connectionState===T.CONNECTED){_t.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){_t.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(l)&&l.length!==0){_t.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:d=0;case 7:if(!(d<l.length)){_t.next=14;break}if(za(h=l[d])){_t.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",h],kg);case 11:d++,_t.next=7;break;case 14:if(!(512<(p=l&&l.length?vk(l):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){_t.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return _t.next=19,this.session.requestSubscribePeersOnlineStatus(p).toPromise();case 19:f=_t.sent,_=f.errors,g=[],b=[],C=0;case 24:if(!(C<_.length)){_t.next=32;break}if(k=_[C],A=k.code,typeof(P=k.account)=="string"){_t.next=28;break}throw new da("Returned account is invalid",fr);case 28:A!==0&&g.push(P);case 29:C++,_t.next=24;break;case 32:for(x=0;x<p.length;x++)j=p[x],g.includes(j)||(b.push(j),this.subscribedPeerStatusCache[j]=void 0);if(this.session.requestPeersOnlineStatus(b).pipe(ba(function(ue){return uc(Jk(ue.userInfos,"account"),function(_n){return!!_n.ts})})).subscribe(function(ue){ue=uc(ue,function(_n,Ei){return _n=_n?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,z.subscribedPeerStatusCache[Ei]=_n}),z.emit("PeersOnlineStatusChanged",ue)}),g.length===0){_t.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return _t.stop()}},s,this)}));return function(s){return o.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_;return w.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(this.connectionState===T.CONNECTED){g.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){g.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(l)&&l.length!==0){g.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:d=0;case 7:if(!(d<l.length)){g.next=14;break}if(za(h=l[d])){g.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",h],kg);case 11:d++,g.next=7;break;case 14:if(!(512<l.length)){g.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(p=l&&l.length?vk(l):[],this.session.requestUnsubscribePeersOnlineStatus(p),f=0;f<p.length;f++)_=p[f],delete this.subscribedPeerStatusCache[_];case 19:case"end":return g.stop()}},s,this)}));return function(s){return o.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var o=J(w.mark(function s(l){return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.connectionState===T.CONNECTED){d.next=2;break}throw new K("The client is not logged in",bl);case 2:if(l!==S.PeerSubscriptionOption.ONLINE_STATUS){d.next=4;break}return d.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return d.stop()}},s,this)}));return function(s){return o.apply(this,arguments)}}()},{key:"createMessage",value:function(o){return o.messageType==="IMAGE"?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},o):o.messageType==="FILE"?ua({fileName:"",description:"",thumbnail:new Blob,size:0},o):o}},{key:"downloadMedia",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_,g,b,C,k,A,P,x,j,z,_t=this,ue=arguments;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(d=1<ue.length&&ue[1]!==void 0?ue[1]:{},typeof l=="string"){_n.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(_n.prev=3,h=l.split("z"),p=ra(h,3),f=p[0],_=p[1],g=p[2],b=f.slice(1,65),C=bD(b),k=parseInt(f.slice(65),10),A=parseInt(_,10),P=parseInt(g,10),!(Number.isNaN(k)||Number.isNaN(A)||Number.isNaN(P))){_n.next=12;break}throw new I("Invalid mediaId content",cl);case 12:_n.next=19;break;case 14:if(_n.prev=14,_n.t0=_n.catch(3),!sa(_n.t0)){_n.next=18;break}throw _n.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:_n.t0});case 19:if(this.connectionState===T.CONNECTED){_n.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(this.session!==void 0){_n.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return x=this.mediaTaskManager.addDownloadTask({unit:A,zone:k,hashHexStr:b,size:P},function(){if(_t.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return _t.session.requestFileDownloadIndexGet({hash:C,zone:k,unit:A,size:P}).toPromise()},d),_n.next=26,this.mediaTaskManager.waitMediaTask(x);case 26:return j=_n.sent,z=j.payload,_n.abrupt("return",z);case 29:case"end":return _n.stop()}},s,this,[[3,14]])}));return function(s){return o.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_,g,b,C,k,A,P,x,j,z,_t,ue,_n,Ei,_s,kc,_i,_h,_p,Qm,_o=this,ga=arguments;return w.wrap(function(vf){for(;;)switch(vf.prev=vf.next){case 0:if(d=1<ga.length&&ga[1]!==void 0?ga[1]:{},h=2<ga.length&&ga[2]!==void 0?ga[2]:{},yd(d)){vf.next=4;break}throw new I("Invalid params",wf);case 4:if(p="thumbnailWidth"in d||"thumbnailHeight"in d||"width"in d||"height"in d,f=d.messageType,_=f===void 0?p?"IMAGE":"FILE":f,g=d.description,b=g===void 0?"":g,C=d.fileName,k=C===void 0?"":C,A=d.thumbnail,typeof d.messageType=="string"&&typeof b=="string"&&typeof k=="string"&&(Pm(A)||A===void 0)&&Pm(l)){vf.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!p||_!=="FILE"){vf.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(P=l.size))){vf.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return vf.next=15,Ji(l);case 15:return x=vf.sent,vf.next=18,aD(x);case 18:if(j=vf.sent,this.connectionState===T.CONNECTED){vf.next=21;break}throw new K("The client is not logged in",yA);case 21:if(_!=="IMAGE"){vf.next=29;break}return vf.next=24,Xt(d,x);case 24:z=vf.sent,_t=z.height,ue=z.width,_n=z.thumbnailWidth,Ei=z.thumbnailHeight;case 29:return _s=this.mediaTaskManager.addUploadTask({file:new Uint8Array(x),hash:j},function(){if(_o.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return _o.session.fetchFileUploadIndexGet({hash:j,size:P})},function(Fi,Gi){if(_o.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return _o.session.requestFileUploadIndexSet({hash:j,unit:Fi,servers:Gi}).toPromise()},h),vf.next=32,this.mediaTaskManager.waitMediaTask(_s);case 32:if(kc=vf.sent,_i=kc.zone,_h=kc.retUnit,_!=="IMAGE"){vf.next=38;break}return _p={height:_t,width:ue,fileName:k,size:P,description:b,thumbnail:A,messageType:_,thumbnailWidth:_n,thumbnailHeight:Ei,mediaId:"0".concat($r(j)).concat(_i,"z").concat(_h,"z").concat(P,"z").concat(_t,"z").concat(ue)},vf.abrupt("return",_p);case 38:return Qm={fileName:k,size:P,description:b,mediaId:"0".concat($r(j)).concat(_i,"z").concat(_h,"z").concat(P),thumbnail:A,messageType:_},vf.abrupt("return",Qm);case 40:case"end":return vf.stop()}},s,this)}));return function(s){return o.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var o=J(w.mark(function s(l){var d,h,p,f,_=this;return w.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(d=l.uid,h=l.instanceId,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){g.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){g.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:g.prev=6,this.context.uid=d,g.next=13;break;case 10:throw g.prev=10,g.t0=g.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:d})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=p=new ls(this.context,new Yr(this.context,this.logger,!1),h,this.logger),f=function(){_.connectionState===T.CONNECTED&&(_.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),_.session)&&_.session.once("userJoined",function(){_.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)})},p.on("connectionLost",f),p.on("tokenExpired",function(){_.emit("TokenExpired")}),p.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(b){_.emit("MessageFromPeer",{text:b.text,messageType:S.MessageType.TEXT},b.peerId,b.properties)}),this.session.on("peerMediaMessage",function(b){var C=b.peerId,k=b.properties,A=b.messageType;b=b.details,A==="FILE"?_.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(b.media_size),10),description:pa(b.media_description),fileName:pa(b.media_filename),mediaId:pa(b.media_id),thumbnail:new Blob([b.media_thumbnail])},C,k):A==="IMAGE"&&_.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(b.media_size),10),description:pa(b.media_description),fileName:pa(b.media_filename),mediaId:pa(b.media_id),thumbnail:new Blob([b.media_thumbnail]),height:parseInt(pa(b.media_height),10),width:parseInt(pa(b.media_width),10),thumbnailHeight:parseInt(pa(b.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(b.media_thumbnailwidth),10)},C,k)}),this.session.on("peerRawMessage",function(b){_.emit("MessageFromPeer",{rawMessage:b.raw,description:b.desc,messageType:S.MessageType.RAW},b.peerId,b.properties)}),p.on("instanceChanged",function(b){return h=b}),p.on("peerOnlineStatusChanged",function(b){var C=b.instance.toString()+b.state,k=_.peerStatusSeqLru.get(C);!k||b.seq.greaterThan(k)?(_.peerStatusSeqLru.set(C,b.seq),b.state!==_.subscribedPeerStatusCache[b.peerId]&&_.emit("PeersOnlineStatusChanged",m({},b.peerId,b.state)),_.subscribedPeerStatusCache[b.peerId]=b.state,clearTimeout(_.peerUnreachableTimers[C]),b.state===S.PeerOnlineState.UNREACHABLE&&(_.peerUnreachableTimers[C]=setTimeout(function(){_.subscribedPeerStatusCache[b.peerId]===S.PeerOnlineState.UNREACHABLE&&(_.subscribedPeerStatusCache[b.peerId]=S.PeerOnlineState.ONLINE,_.emit("PeersOnlineStatusChanged",m({},b.peerId,S.PeerOnlineState.ONLINE)))},3e4))):_.log("peerOnlineStatusChanged dedup for %s, %d",C,b.seq.toNumber())}),p.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),p.on("channelAttributesUpdated",function(b){var C=b.channelId;b=b.attributeMaps;for(var k={},A=0;A<b.length;A++){var P=b[A],x=P.key,j=P.ms,z=P.value;if(P=P.origin,typeof x!="string"||!U.isLong(j)||typeof z!="string"||!za(P))break;k[x]=new Blob([z]).size}_.channelAttributesCacheLru.set(C,k)}),p.on("userJoined",function(b){if(Object.keys(_.attributes).length!==0){if(_.session===void 0)return;_.session.requestSetLocalUserAttributes(_.attributes,b).toPromise()}if(_.attributeDrafts.size!==0)for(var C=function(P,x){var j=(P=x[P]).attribute;P.promise.then(function(){_.session!==void 0&&_.session.requestSetLocalUserAttributes(j,b).toPromise()})},k=0,A=Array.from(_.attributeDrafts);k<A.length;k++)C(k,A);Object.keys(_.subscribedPeerStatusCache).length!==0&&p.requestSubscribePeersOnlineStatus(Object.keys(_.subscribedPeerStatusCache))}),this.lastLoginTime=Date.now(),g.prev=29,g.next=32,p.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:p.connection.curOpenSockets.filter(function(b){return b!==void 0})[0].ticket,instance:p.instanceId,useNewDomain:.5<=Math.random(),loginOpt:p.userJoinOptions.toLong()}),g.next=44;break;case 35:if(g.prev=35,g.t1=g.catch(29),!Sa(g.t1)){g.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(g.t1)){g.next=43;break}throw g.t1;case 43:throw new da("Login failure",{code:Zq,originalError:g.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return g.stop()}},s,this,[[6,10],[29,35]])}));return function(s){return o.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(o,s){var l,d=this;o===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[o],oldState:os[this.connectionState],reason:qD[s],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(l=this.context.config.enableCloudProxy)!==null&&l!==void 0&&l),this.connectionState===T.RECONNECTING&&o===T.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba(function(h){return uc(Jk(h.userInfos,"account"),function(p){return!!p.ts})})).subscribe(function(h){h=uc(h,function(p,f){return p=p?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,d.subscribedPeerStatusCache[f]=p}),d.emit("PeersOnlineStatusChanged",h)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=o,o!==T.ABORTED&&o!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",o),this.emit("ConnectionStateChanged",o,s)}}]),r}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},i=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e))throw new I(["The %s in the arguments is invalid",Object.keys({appId:e})[0]],Nq);var o=Object.keys(r).filter(function(_){return!(_ in qs)});if(o.length!==0)throw new I("Invalid RTM config: ".concat(o.join(", ")),Nq);var s=ua(ua({},qs),r);if(i!==void 0&&(!Array.isArray(i)||i.length===0))throw new I("Invalid area config");if(i!=null){if(!i.every(function(_){return _ in S.LegacyAreaCode}))throw new I("Invalid area codes: ".concat(i.filter(function(_){return!(_ in S)}).join(", ")));M=xe(i.map(function(_){return zC[_]}))}i=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var l=DC(s);o=EC(s);var d=FC(s),h=GC(i,s),p=Tr(i,s),f=p("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=s,l("The Agora RTM Web SDK version is %s","1.4.3-203"),r.enableCloudProxy&&l("RTM cloud proxy enabled"),r.enableLogUpload&&l("Log upload enabled"),M&&f("Area is set to %s",Array.from(M.CODES).map(function(_){return xf(F).find(function(g){return F[g]===_})}).join(", ")),f("Creating an RtmClient instance"),f('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),f("The App ID is %s",Um(e,4,10,"*".repeat(6))),l("The process ID is %s",gg),f("The build is %s","v1.4.3-17-g1e27aa38"),f("NODE_ENV is %s","production"),new rD(e,{genLogger:p,genTracker:h,info:l,warn:o,logError:d,loggerId:i},s,function(_){for(var g=0,b=xf(_);g<b.length;g++){var C=b[g];try{var k=_[C];k!=null&&(_.enableCloudProxy&&l("RTM cloud proxy enabled"),_.enableLogUpload&&l("Log upload enabled"),s[C]=k)}catch{throw new I(["The %s in the arguments is invalid",C],void 0)}}})},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(e,r){Object.keys(Nc).includes(e)&&(Nc[e]=r)},getParameter:function(e){return Nc[e]},setArea:function(e){var r=e.areaCodes;if(e=e.excludedArea,!Array.isArray(r)||r.length===0||!r.every(function(i){return i in S.AreaCode}))throw new I("Invalid area config");if(e!==void 0&&e===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(e===void 0)M=xe(r.map(function(i){return F[i]}));else{if(r.includes(e))throw new I("Excluded area cannot be in areaCodes");if(!(e in F))throw new I("Invalid excludedArea:",e);M=bu({areas:r.map(function(i){return F[i]}),excludedArea:F[e]})}}});return Zd})});var PR=lN(cP(),1),ect=lN(u9(),1);var _c=lN(cP());var OT=lN(cP());function Ilt(e,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var s=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,s.get?s:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var y1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function m_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var M_=function(e){try{return!!e()}catch{return!0}},V3=!M_(function(){var e=function(){}.bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),Xnt=V3,Qnt=Function.prototype,C5=Qnt.call,Clt=Xnt&&Qnt.bind.bind(C5,C5),k_=Xnt?Clt:function(e){return function(){return C5.apply(e,arguments)}},j0=k_({}.isPrototypeOf),yM=function(e){return e&&e.Math==Math&&e},V_=yM(typeof globalThis=="object"&&globalThis)||yM(typeof window=="object"&&window)||yM(typeof self=="object"&&self)||yM(typeof y1=="object"&&y1)||function(){return this}()||y1||Function("return this")(),Alt=V3,Znt=Function.prototype,l9=Znt.apply,d9=Znt.call,F3=typeof Reflect=="object"&&Reflect.apply||(Alt?d9.bind(l9):function(){return d9.apply(l9,arguments)}),$nt=k_,Olt=$nt({}.toString),Nlt=$nt("".slice),CR=function(e){return Nlt(Olt(e),8,-1)},klt=CR,Plt=k_,lL=function(e){if(klt(e)==="Function")return Plt(e)},J4=typeof document=="object"&&document.all,B3={all:J4,IS_HTMLDDA:J4===void 0&&J4!==void 0},Dlt=B3.all,t0=B3.IS_HTMLDDA?function(e){return typeof e=="function"||e===Dlt}:function(e){return typeof e=="function"},xL={},QS=!M_(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Llt=V3,SM=Function.prototype.call,u0=Llt?SM.bind(SM):function(){return SM.apply(SM,arguments)},G3={},trt={}.propertyIsEnumerable,ert=Object.getOwnPropertyDescriptor,Mlt=ert&&!trt.call({1:2},1);G3.f=Mlt?function(e){var r=ert(this,e);return!!r&&r.enumerable}:trt;var CI,_U,_A=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},Ult=M_,xlt=CR,X4=Object,jlt=k_("".split),q3=Ult(function(){return!X4("z").propertyIsEnumerable(0)})?function(e){return xlt(e)=="String"?jlt(e,""):X4(e)}:X4,W1=function(e){return e==null},Vlt=W1,Flt=TypeError,H1=function(e){if(Vlt(e))throw Flt("Can't call method on "+e);return e},Blt=q3,Glt=H1,tO=function(e){return Blt(Glt(e))},h9=t0,qlt=B3.all,PS=B3.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:h9(e)||e===qlt}:function(e){return typeof e=="object"?e!==null:h9(e)},ZS={},Q4=ZS,Z4=V_,Wlt=t0,p9=function(e){return Wlt(e)?e:void 0},fS=function(e,r){return arguments.length<2?p9(Q4[e])||p9(Z4[e]):Q4[e]&&Q4[e][r]||Z4[e]&&Z4[e][r]},eO=typeof navigator<"u"&&String(navigator.userAgent)||"",nrt=V_,$4=eO,f9=nrt.process,m9=nrt.Deno,E9=f9&&f9.versions||m9&&m9.version,_9=E9&&E9.v8;_9&&(_U=(CI=_9.split("."))[0]>0&&CI[0]<4?1:+(CI[0]+CI[1])),!_U&&$4&&(!(CI=$4.match(/Edge\/(\d+)/))||CI[1]>=74)&&(CI=$4.match(/Chrome\/(\d+)/))&&(_U=+CI[1]);var QO=_U,g9=QO,Hlt=M_,Klt=V_.String,K1=!!Object.getOwnPropertySymbols&&!Hlt(function(){var e=Symbol();return!Klt(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&g9&&g9<41}),rrt=K1&&!Symbol.sham&&typeof Symbol.iterator=="symbol",zlt=fS,Ylt=t0,Jlt=j0,Xlt=Object,jL=rrt?function(e){return typeof e=="symbol"}:function(e){var r=zlt("Symbol");return Ylt(r)&&Jlt(r.prototype,Xlt(e))},Qlt=String,z1=function(e){try{return Qlt(e)}catch{return"Object"}},Zlt=t0,$lt=z1,tdt=TypeError,$S=function(e){if(Zlt(e))return e;throw tdt($lt(e)+" is not a function")},edt=$S,ndt=W1,W3=function(e,r){var i=e[r];return ndt(i)?void 0:edt(i)},tG=u0,eG=t0,nG=PS,rdt=TypeError,irt={exports:{}},v9=V_,idt=Object.defineProperty,odt=function(e,r){try{idt(v9,e,{value:r,configurable:!0,writable:!0})}catch{v9[e]=r}return r},y9="__core-js_shared__",lW=V_[y9]||odt(y9,{}),S9=lW;(irt.exports=function(e,r){return S9[e]||(S9[e]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"\xA9 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Y1=irt.exports,sdt=H1,adt=Object,AR=function(e){return adt(sdt(e))},cdt=AR,udt=k_({}.hasOwnProperty),m0=Object.hasOwn||function(e,r){return udt(cdt(e),r)},ldt=k_,ddt=0,hdt=Math.random(),pdt=ldt(1 .toString),dW=function(e){return"Symbol("+(e===void 0?"":e)+")_"+pdt(++ddt+hdt,36)},fdt=Y1,T9=m0,mdt=dW,Edt=K1,_dt=rrt,l1=V_.Symbol,rG=fdt("wks"),gdt=_dt?l1.for||l1:l1&&l1.withoutSetter||mdt,C_=function(e){return T9(rG,e)||(rG[e]=Edt&&T9(l1,e)?l1[e]:gdt("Symbol."+e)),rG[e]},vdt=u0,b9=PS,R9=jL,ydt=W3,Sdt=function(e,r){var i,o;if(r==="string"&&eG(i=e.toString)&&!nG(o=tG(i,e))||eG(i=e.valueOf)&&!nG(o=tG(i,e))||r!=="string"&&eG(i=e.toString)&&!nG(o=tG(i,e)))return o;throw rdt("Can't convert object to primitive value")},Tdt=TypeError,bdt=C_("toPrimitive"),Rdt=function(e,r){if(!b9(e)||R9(e))return e;var i,o=ydt(e,bdt);if(o){if(r===void 0&&(r="default"),i=vdt(o,e,r),!b9(i)||R9(i))return i;throw Tdt("Can't convert object to primitive value")}return r===void 0&&(r="number"),Sdt(e,r)},wdt=jL,H3=function(e){var r=Rdt(e,"string");return wdt(r)?r:r+""},w9=PS,A5=V_.document,Idt=w9(A5)&&w9(A5.createElement),hW=function(e){return Idt?A5.createElement(e):{}},Cdt=hW,ort=!QS&&!M_(function(){return Object.defineProperty(Cdt("div"),"a",{get:function(){return 7}}).a!=7}),Adt=QS,Odt=u0,Ndt=G3,kdt=_A,Pdt=tO,Ddt=H3,Ldt=m0,Mdt=ort,I9=Object.getOwnPropertyDescriptor;xL.f=Adt?I9:function(e,r){if(e=Pdt(e),r=Ddt(r),Mdt)try{return I9(e,r)}catch{}if(Ldt(e,r))return kdt(!Odt(Ndt.f,e,r),e[r])};var Udt=M_,xdt=t0,jdt=/#|\.prototype\./,VL=function(e,r){var i=Fdt[Vdt(e)];return i==Gdt||i!=Bdt&&(xdt(r)?Udt(r):!!r)},Vdt=VL.normalize=function(e){return String(e).replace(jdt,".").toLowerCase()},Fdt=VL.data={},Bdt=VL.NATIVE="N",Gdt=VL.POLYFILL="P",srt=VL,qdt=$S,Wdt=V3,Hdt=lL(lL.bind),nO=function(e,r){return qdt(e),r===void 0?e:Wdt?Hdt(e,r):function(){return e.apply(r,arguments)}},IT={},art=QS&&M_(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Kdt=PS,zdt=String,Ydt=TypeError,nS=function(e){if(Kdt(e))return e;throw Ydt(zdt(e)+" is not an object")},Jdt=QS,Xdt=ort,Qdt=art,TM=nS,C9=H3,Zdt=TypeError,iG=Object.defineProperty,$dt=Object.getOwnPropertyDescriptor,oG="enumerable",sG="configurable",aG="writable";IT.f=Jdt?Qdt?function(e,r,i){if(TM(e),r=C9(r),TM(i),typeof e=="function"&&r==="prototype"&&"value"in i&&aG in i&&!i[aG]){var o=$dt(e,r);o&&o[aG]&&(e[r]=i.value,i={configurable:sG in i?i[sG]:o[sG],enumerable:oG in i?i[oG]:o[oG],writable:!1})}return iG(e,r,i)}:iG:function(e,r,i){if(TM(e),r=C9(r),TM(i),Xdt)try{return iG(e,r,i)}catch{}if("get"in i||"set"in i)throw Zdt("Accessors not supported");return"value"in i&&(e[r]=i.value),e};var tht=IT,eht=_A,rO=QS?function(e,r,i){return tht.f(e,r,eht(1,i))}:function(e,r,i){return e[r]=i,e},bM=V_,nht=F3,rht=lL,iht=t0,oht=xL.f,sht=srt,BN=ZS,aht=nO,GN=rO,A9=m0,cht=function(e){var r=function(i,o,s){if(this instanceof r){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,s)}return nht(e,this,arguments)};return r.prototype=e.prototype,r},zE=function(e,r){var i,o,s,l,d,h,p,f,_,g=e.target,b=e.global,C=e.stat,k=e.proto,A=b?bM:C?bM[g]:(bM[g]||{}).prototype,P=b?BN:BN[g]||GN(BN,g,{})[g],x=P.prototype;for(l in r)o=!(i=sht(b?l:g+(C?".":"#")+l,e.forced))&&A&&A9(A,l),h=P[l],o&&(p=e.dontCallGetSet?(_=oht(A,l))&&_.value:A[l]),d=o&&p?p:r[l],o&&typeof h==typeof d||(f=e.bind&&o?aht(d,bM):e.wrap&&o?cht(d):k&&iht(d)?rht(d):d,(e.sham||d&&d.sham||h&&h.sham)&&GN(f,"sham",!0),GN(P,l,f),k&&(A9(BN,s=g+"Prototype")||GN(BN,s,{}),GN(BN[s],l,d),e.real&&x&&(i||!x[l])&&GN(x,l,d)))},uht=Math.ceil,lht=Math.floor,dht=Math.trunc||function(e){var r=+e;return(r>0?lht:uht)(r)},hht=dht,pW=function(e){var r=+e;return r!=r||r===0?0:hht(r)},pht=pW,fht=Math.max,mht=Math.min,fW=function(e,r){var i=pht(e);return i<0?fht(i+r,0):mht(i,r)},Eht=pW,_ht=Math.min,crt=function(e){return e>0?_ht(Eht(e),9007199254740991):0},ght=crt,rI=function(e){return ght(e.length)},vht=tO,yht=fW,Sht=rI,O9=function(e){return function(r,i,o){var s,l=vht(r),d=Sht(l),h=yht(o,d);if(e&&i!=i){for(;d>h;)if((s=l[h++])!=s)return!0}else for(;d>h;h++)if((e||h in l)&&l[h]===i)return e||h||0;return!e&&-1}},mW={includes:O9(!0),indexOf:O9(!1)},Tht=mW.includes;zE({target:"Array",proto:!0,forced:M_(function(){return!Array(1).includes()})},{includes:function(e){return Tht(this,e,arguments.length>1?arguments[1]:void 0)}});var bht=ZS,CT=function(e){return bht[e+"Prototype"]},Rht=CT("Array").includes,wht=PS,Iht=CR,Cht=C_("match"),urt=function(e){var r;return wht(e)&&((r=e[Cht])!==void 0?!!r:Iht(e)=="RegExp")},Aht=urt,Oht=TypeError,lrt={};lrt[C_("toStringTag")]="z";var EW=String(lrt)==="[object z]",Nht=EW,kht=t0,gU=CR,Pht=C_("toStringTag"),Dht=Object,Lht=gU(function(){return arguments}())=="Arguments",OR=Nht?gU:function(e){var r,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(s,l){try{return s[l]}catch{}}(r=Dht(e),Pht))=="string"?i:Lht?gU(r):(o=gU(r))=="Object"&&kht(r.callee)?"Arguments":o},Mht=OR,Uht=String,tT=function(e){if(Mht(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Uht(e)},xht=C_("match"),jht=zE,Vht=function(e){if(Aht(e))throw Oht("The method doesn't accept regular expressions");return e},Fht=H1,N9=tT,Bht=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[xht]=!1,"/./"[e](r)}catch{}}return!1},Ght=k_("".indexOf);jht({target:"String",proto:!0,forced:!Bht("includes")},{includes:function(e){return!!~Ght(N9(Fht(this)),N9(Vht(e)),arguments.length>1?arguments[1]:void 0)}});var qht=CT("String").includes,k9=j0,Wht=Rht,Hht=qht,cG=Array.prototype,uG=String.prototype,Kht=function(e){var r=e.includes;return e===cG||k9(cG,e)&&r===cG.includes?Wht:typeof e=="string"||e===uG||k9(uG,e)&&r===uG.includes?Hht:r},nE=m_(Kht),zht=$S,Yht=AR,Jht=q3,Xht=rI,Qht=TypeError,P9=function(e){return function(r,i,o,s){zht(i);var l=Yht(r),d=Jht(l),h=Xht(l),p=e?h-1:0,f=e?-1:1;if(o<2)for(;;){if(p in d){s=d[p],p+=f;break}if(p+=f,e?p<0:h<=p)throw Qht("Reduce of empty array with no initial value")}for(;e?p>=0:h>p;p+=f)p in d&&(s=i(s,d[p],p,l));return s}},Zht={left:P9(!1),right:P9(!0)},$ht=M_,K3=function(e,r){var i=[][e];return!!i&&$ht(function(){i.call(null,r||function(){return 1},1)})},J1=typeof process<"u"&&CR(process)=="process",tpt=Zht.left;zE({target:"Array",proto:!0,forced:!J1&&QO>79&&QO<83||!K3("reduce")},{reduce:function(e){var r=arguments.length;return tpt(this,e,r,r>1?arguments[1]:void 0)}});var ept=CT("Array").reduce,npt=j0,rpt=ept,lG=Array.prototype,ipt=function(e){var r=e.reduce;return e===lG||npt(lG,e)&&r===lG.reduce?rpt:r},drt=ipt,QT=m_(drt),hrt=!0,prt=!0;function RM(e,r,i){let o=e.match(r);return o&&o.length>=i&&parseInt(o[i],10)}function rN(e,r,i){if(!e.RTCPeerConnection)return;let o=e.RTCPeerConnection.prototype,s=o.addEventListener;o.addEventListener=function(d,h){if(d!==r)return s.apply(this,arguments);let p=f=>{let _=i(f);_&&(h.handleEvent?h.handleEvent(_):h(_))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(h,p),s.apply(this,[d,p])};let l=o.removeEventListener;o.removeEventListener=function(d,h){if(d!==r||!this._eventMap||!this._eventMap[r])return l.apply(this,arguments);if(!this._eventMap[r].has(h))return l.apply(this,arguments);let p=this._eventMap[r].get(h);return this._eventMap[r].delete(h),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,l.apply(this,[d,p])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(d){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),d&&this.addEventListener(r,this["_on"+r]=d)},enumerable:!0,configurable:!0})}function opt(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(hrt=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function spt(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(prt=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function frt(){if(typeof window=="object"){if(hrt)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _W(e,r){prt&&console.warn(e+" is deprecated, please use "+r+" instead.")}function D9(e){return Object.prototype.toString.call(e)==="[object Object]"}function mrt(e){var r;return D9(e)?QT(r=Object.keys(e)).call(r,function(i,o){let s=D9(e[o]),l=s?mrt(e[o]):e[o],d=s&&!Object.keys(l).length;return l===void 0||d?i:Object.assign(i,{[o]:l})},{}):e}function O5(e,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?O5(e,e.get(r[o]),i):o.endsWith("Ids")&&r[o].forEach(s=>{O5(e,e.get(s),i)})}))}function L9(e,r,i){let o=i?"outbound-rtp":"inbound-rtp",s=new Map;if(r===null)return s;let l=[];return e.forEach(d=>{d.type==="track"&&d.trackIdentifier===r.id&&l.push(d)}),l.forEach(d=>{e.forEach(h=>{h.type===o&&h.trackId===d.id&&O5(e,h,s)})}),s}var apt=dW,M9=Y1("keys"),z3=function(e){return M9[e]||(M9[e]=apt(e))},cpt=!M_(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),upt=m0,lpt=t0,dpt=AR,hpt=cpt,U9=z3("IE_PROTO"),N5=Object,ppt=N5.prototype,gW=hpt?N5.getPrototypeOf:function(e){var r=dpt(e);if(upt(r,U9))return r[U9];var i=r.constructor;return lpt(i)&&r instanceof i?i.prototype:r instanceof N5?ppt:null},fpt=k_,mpt=$S,Ept=t0,_pt=String,gpt=TypeError,vpt=function(e,r,i){try{return fpt(mpt(Object.getOwnPropertyDescriptor(e,r)[i]))}catch{}},ypt=nS,Spt=function(e){if(typeof e=="object"||Ept(e))return e;throw gpt("Can't set "+_pt(e)+" as a prototype")},Tpt=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,i={};try{(e=vpt(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(o,s){return ypt(o),Spt(s),r?e(o,s):o.__proto__=s,o}}():void 0),Y3={},J3={},dG=m0,bpt=tO,Rpt=mW.indexOf,wpt=J3,x9=k_([].push),Ert=function(e,r){var i,o=bpt(e),s=0,l=[];for(i in o)!dG(wpt,i)&&dG(o,i)&&x9(l,i);for(;r.length>s;)dG(o,i=r[s++])&&(~Rpt(l,i)||x9(l,i));return l},vW=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Ipt=Ert,Cpt=vW.concat("length","prototype");Y3.f=Object.getOwnPropertyNames||function(e){return Ipt(e,Cpt)};var FL={};FL.f=Object.getOwnPropertySymbols;var Apt=fS,Opt=Y3,Npt=FL,kpt=nS,Ppt=k_([].concat),Dpt=Apt("Reflect","ownKeys")||function(e){var r=Opt.f(kpt(e)),i=Npt.f;return i?Ppt(r,i(e)):r},j9=m0,Lpt=Dpt,Mpt=xL,Upt=IT,yW={},xpt=Ert,jpt=vW,X3=Object.keys||function(e){return xpt(e,jpt)},Vpt=QS,Fpt=art,Bpt=IT,Gpt=nS,qpt=tO,Wpt=X3;yW.f=Vpt&&!Fpt?Object.defineProperties:function(e,r){Gpt(e);for(var i,o=qpt(r),s=Wpt(r),l=s.length,d=0;l>d;)Bpt.f(e,i=s[d++],o[i]);return e};var wM,_rt=fS("document","documentElement"),Hpt=nS,Kpt=yW,V9=vW,zpt=J3,Ypt=_rt,Jpt=hW,k5="prototype",P5="script",grt=z3("IE_PROTO"),hG=function(){},vrt=function(e){return"<"+P5+">"+e+"</"+P5+">"},F9=function(e){e.write(vrt("")),e.close();var r=e.parentWindow.Object;return e=null,r},vU=function(){try{wM=new ActiveXObject("htmlfile")}catch{}var e,r,i;vU=typeof document<"u"?document.domain&&wM?F9(wM):(r=Jpt("iframe"),i="java"+P5+":",r.style.display="none",Ypt.appendChild(r),r.src=String(i),(e=r.contentWindow.document).open(),e.write(vrt("document.F=Object")),e.close(),e.F):F9(wM);for(var o=V9.length;o--;)delete vU[k5][V9[o]];return vU()};zpt[grt]=!0;var BL=Object.create||function(e,r){var i;return e!==null?(hG[k5]=Hpt(e),i=new hG,hG[k5]=null,i[grt]=e):i=vU(),r===void 0?i:Kpt.f(i,r)},Xpt=PS,Qpt=rO,yrt=Error,Zpt=k_("".replace),$pt=String(yrt("zxcasd").stack),Srt=/\n\s*at [^:]*:[^\n]*/,tft=Srt.test($pt),eft=_A,nft=!M_(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",eft(1,7)),e.stack!==7)}),rft=rO,ift=function(e,r){if(tft&&typeof e=="string"&&!yrt.prepareStackTrace)for(;r--;)e=Zpt(e,Srt,"");return e},oft=nft,B9=Error.captureStackTrace,iN={},sft=iN,aft=C_("iterator"),cft=Array.prototype,Trt=function(e){return e!==void 0&&(sft.Array===e||cft[aft]===e)},uft=OR,G9=W3,lft=W1,dft=iN,hft=C_("iterator"),Q3=function(e){if(!lft(e))return G9(e,hft)||G9(e,"@@iterator")||dft[uft(e)]},pft=u0,fft=$S,mft=nS,Eft=z1,_ft=Q3,gft=TypeError,SW=function(e,r){var i=arguments.length<2?_ft(e):r;if(fft(i))return mft(pft(i,e));throw gft(Eft(e)+" is not iterable")},vft=u0,q9=nS,yft=W3,brt=function(e,r,i){var o,s;q9(e);try{if(!(o=yft(e,"return"))){if(r==="throw")throw i;return i}o=vft(o,e)}catch(l){s=!0,o=l}if(r==="throw")throw i;if(s)throw o;return q9(o),i},Sft=nO,Tft=u0,bft=nS,Rft=z1,wft=Trt,Ift=rI,W9=j0,Cft=SW,Aft=Q3,H9=brt,Oft=TypeError,yU=function(e,r){this.stopped=e,this.result=r},K9=yU.prototype,GL=function(e,r,i){var o,s,l,d,h,p,f,_=i&&i.that,g=!(!i||!i.AS_ENTRIES),b=!(!i||!i.IS_RECORD),C=!(!i||!i.IS_ITERATOR),k=!(!i||!i.INTERRUPTED),A=Sft(r,_),P=function(j){return o&&H9(o,"normal",j),new yU(!0,j)},x=function(j){return g?(bft(j),k?A(j[0],j[1],P):A(j[0],j[1])):k?A(j,P):A(j)};if(b)o=e.iterator;else if(C)o=e;else{if(!(s=Aft(e)))throw Oft(Rft(e)+" is not iterable");if(wft(s)){for(l=0,d=Ift(e);d>l;l++)if((h=x(e[l]))&&W9(K9,h))return h;return new yU(!1)}o=Cft(e,s)}for(p=b?e.next:o.next;!(f=Tft(p,o)).done;){try{h=x(f.value)}catch(j){H9(o,"throw",j)}if(typeof h=="object"&&h&&W9(K9,h))return h}return new yU(!1)},Nft=tT,kft=zE,Pft=j0,Dft=gW,WU=Tpt,Lft=function(e,r,i){for(var o=Lpt(r),s=Upt.f,l=Mpt.f,d=0;d<o.length;d++){var h=o[d];j9(e,h)||i&&j9(i,h)||s(e,h,l(r,h))}},Rrt=BL,pG=rO,fG=_A,Mft=function(e,r){Xpt(r)&&"cause"in r&&Qpt(e,"cause",r.cause)},Uft=function(e,r,i,o){oft&&(B9?B9(e,r):rft(e,"stack",ift(i,o)))},xft=GL,jft=function(e,r){return e===void 0?arguments.length<2?"":r:Nft(e)},Vft=C_("toStringTag"),HU=Error,Fft=[].push,k1=function(e,r){var i,o=Pft(mG,this);WU?i=WU(HU(),o?Dft(this):mG):(i=o?this:Rrt(mG),pG(i,Vft,"Error")),r!==void 0&&pG(i,"message",jft(r)),Uft(i,k1,i.stack,1),arguments.length>2&&Mft(i,arguments[2]);var s=[];return xft(e,Fft,{that:s}),pG(i,"errors",s),i};WU?WU(k1,HU):Lft(k1,HU,{name:!0});var mG=k1.prototype=Rrt(HU.prototype,{constructor:fG(1,k1),message:fG(1,""),name:fG(1,"AggregateError")});kft({global:!0,constructor:!0,arity:2},{AggregateError:k1});var KU,YD,zU,Bft=t0,z9=V_.WeakMap,Gft=Bft(z9)&&/native code/.test(String(z9)),wrt=V_,qft=PS,Wft=rO,EG=m0,_G=lW,Hft=z3,Kft=J3,Y9="Object already initialized",D5=wrt.TypeError,zft=wrt.WeakMap;Gft||_G.state?(BT=_G.state||(_G.state=new zft),BT.get=BT.get,BT.has=BT.has,BT.set=BT.set,KU=function(e,r){if(BT.has(e))throw D5(Y9);return r.facade=e,BT.set(e,r),r},YD=function(e){return BT.get(e)||{}},zU=function(e){return BT.has(e)}):(bO=Hft("state"),Kft[bO]=!0,KU=function(e,r){if(EG(e,bO))throw D5(Y9);return r.facade=e,Wft(e,bO,r),r},YD=function(e){return EG(e,bO)?e[bO]:{}},zU=function(e){return EG(e,bO)});var BT,bO,zO,J9,X9,oN={set:KU,get:YD,has:zU,enforce:function(e){return zU(e)?YD(e):KU(e,{})},getterFor:function(e){return function(r){var i;if(!qft(r)||(i=YD(r)).type!==e)throw D5("Incompatible receiver, "+e+" required");return i}}},L5=QS,Yft=m0,Irt=Function.prototype,Jft=L5&&Object.getOwnPropertyDescriptor,gG=Yft(Irt,"name"),Crt={EXISTS:gG,PROPER:gG&&function(){}.name==="something",CONFIGURABLE:gG&&(!L5||L5&&Jft(Irt,"name").configurable)},Xft=rO,iO=function(e,r,i,o){return o&&o.enumerable?e[r]=i:Xft(e,r,i),e},Qft=M_,Zft=t0,$ft=PS,tmt=BL,Q9=gW,emt=iO,M5=C_("iterator"),Art=!1;[].keys&&("next"in(X9=[].keys())?(J9=Q9(Q9(X9)))!==Object.prototype&&(zO=J9):Art=!0);var nmt=!$ft(zO)||Qft(function(){var e={};return zO[M5].call(e)!==e});Zft((zO=nmt?{}:tmt(zO))[M5])||emt(zO,M5,function(){return this});var Ort={IteratorPrototype:zO,BUGGY_SAFARI_ITERATORS:Art},rmt=OR,imt=EW?{}.toString:function(){return"[object "+rmt(this)+"]"},omt=EW,smt=IT.f,amt=rO,cmt=m0,umt=imt,Z9=C_("toStringTag"),oO=function(e,r,i,o){if(e){var s=i?e:e.prototype;cmt(s,Z9)||smt(s,Z9,{configurable:!0,value:r}),o&&!omt&&amt(s,"toString",umt)}},lmt=Ort.IteratorPrototype,dmt=BL,hmt=_A,pmt=oO,fmt=iN,mmt=function(){return this},TW=function(e,r,i,o){var s=r+" Iterator";return e.prototype=dmt(lmt,{next:hmt(+!o,i)}),pmt(e,s,!1,!0),fmt[s]=mmt,e},Emt=zE,_mt=u0,gmt=Crt,vmt=TW,ymt=gW,Smt=oO,$9=iO,tJ=iN,Tmt=Ort,bmt=gmt.PROPER,IM=Tmt.BUGGY_SAFARI_ITERATORS,vG=C_("iterator"),eJ="keys",CM="values",nJ="entries",Rmt=function(){return this},Nrt=function(e,r,i,o,s,l,d){vmt(i,r,o);var h,p,f,_=function(x){if(x===s&&A)return A;if(!IM&&x in C)return C[x];switch(x){case eJ:case CM:case nJ:return function(){return new i(this,x)}}return function(){return new i(this)}},g=r+" Iterator",b=!1,C=e.prototype,k=C[vG]||C["@@iterator"]||s&&C[s],A=!IM&&k||_(s),P=r=="Array"&&C.entries||k;if(P&&(h=ymt(P.call(new e)))!==Object.prototype&&h.next&&(Smt(h,g,!0,!0),tJ[g]=Rmt),bmt&&s==CM&&k&&k.name!==CM&&(b=!0,A=function(){return _mt(k,this)}),s)if(p={values:_(CM),keys:l?A:_(eJ),entries:_(nJ)},d)for(f in p)(IM||b||!(f in C))&&$9(C,f,p[f]);else Emt({target:r,proto:!0,forced:IM||b},p);return d&&C[vG]!==A&&$9(C,vG,A,{name:s}),tJ[r]=A,p},bW=function(e,r){return{value:e,done:r}},wmt=tO,rJ=iN,krt=oN;IT.f;var Imt=Nrt,iJ=bW,Prt="Array Iterator",Cmt=krt.set,Amt=krt.getterFor(Prt);Imt(Array,"Array",function(e,r){Cmt(this,{type:Prt,target:wmt(e),index:0,kind:r})},function(){var e=Amt(this),r=e.target,i=e.kind,o=e.index++;return!r||o>=r.length?(e.target=void 0,iJ(void 0,!0)):iJ(i=="keys"?o:i=="values"?r[o]:[o,r[o]],!1)},"values"),rJ.Arguments=rJ.Array;var Omt=IT,Z3=function(e,r,i){return Omt.f(e,r,i)},Nmt=fS,kmt=Z3,Pmt=QS,oJ=C_("species"),Dmt=j0,Lmt=TypeError,RW=function(e,r){if(Dmt(r,e))return e;throw Lmt("Incorrect invocation")},Mmt=t0,U5=lW,Umt=k_(Function.toString);Mmt(U5.inspectSource)||(U5.inspectSource=function(e){return Umt(e)});var Drt=U5.inspectSource,xmt=k_,jmt=M_,Lrt=t0,Vmt=OR,Fmt=Drt,Mrt=function(){},Bmt=[],Urt=fS("Reflect","construct"),wW=/^\s*(?:class|function)\b/,Gmt=xmt(wW.exec),qmt=!wW.exec(Mrt),tD=function(e){if(!Lrt(e))return!1;try{return Urt(Mrt,Bmt,e),!0}catch{return!1}},xrt=function(e){if(!Lrt(e))return!1;switch(Vmt(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return qmt||!!Gmt(wW,Fmt(e))}catch{return!0}};xrt.sham=!0;var dL,qN,sJ,yG,$3=!Urt||jmt(function(){var e;return tD(tD.call)||!tD(Object)||!tD(function(){e=!0})||e})?xrt:tD,Wmt=$3,Hmt=z1,Kmt=TypeError,aJ=nS,zmt=function(e){if(Wmt(e))return e;throw Kmt(Hmt(e)+" is not a constructor")},Ymt=W1,Jmt=C_("species"),IW=function(e,r){var i,o=aJ(e).constructor;return o===void 0||Ymt(i=aJ(o)[Jmt])?r:zmt(i)},tV=k_([].slice),Xmt=TypeError,X1=function(e,r){if(e<r)throw Xmt("Not enough arguments");return e},jrt=/(?:ipad|iphone|ipod).*applewebkit/i.test(eO),zS=V_,Qmt=F3,Zmt=nO,cJ=t0,$mt=m0,Vrt=M_,uJ=_rt,tEt=tV,lJ=hW,eEt=X1,nEt=jrt,rEt=J1,x5=zS.setImmediate,j5=zS.clearImmediate,iEt=zS.process,SG=zS.Dispatch,oEt=zS.Function,dJ=zS.MessageChannel,sEt=zS.String,TG=0,JD={},hJ="onreadystatechange";Vrt(function(){dL=zS.location});var CW=function(e){if($mt(JD,e)){var r=JD[e];delete JD[e],r()}},bG=function(e){return function(){CW(e)}},pJ=function(e){CW(e.data)},fJ=function(e){zS.postMessage(sEt(e),dL.protocol+"//"+dL.host)};x5&&j5||(x5=function(e){eEt(arguments.length,1);var r=cJ(e)?e:oEt(e),i=tEt(arguments,1);return JD[++TG]=function(){Qmt(r,void 0,i)},qN(TG),TG},j5=function(e){delete JD[e]},rEt?qN=function(e){iEt.nextTick(bG(e))}:SG&&SG.now?qN=function(e){SG.now(bG(e))}:dJ&&!nEt?(yG=(sJ=new dJ).port2,sJ.port1.onmessage=pJ,qN=Zmt(yG.postMessage,yG)):zS.addEventListener&&cJ(zS.postMessage)&&!zS.importScripts&&dL&&dL.protocol!=="file:"&&!Vrt(fJ)?(qN=fJ,zS.addEventListener("message",pJ,!1)):qN=hJ in lJ("script")?function(e){uJ.appendChild(lJ("script"))[hJ]=function(){uJ.removeChild(this),CW(e)}}:function(e){setTimeout(bG(e),0)});var eV={set:x5,clear:j5},Frt=function(){this.head=null,this.tail=null};Frt.prototype={add:function(e){var r={item:e,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var WN,RG,wG,IG,mJ,Brt=Frt,aEt=/ipad|iphone|ipod/i.test(eO)&&typeof Pebble<"u",cEt=/web0s(?!.*chrome)/i.test(eO),ZO=V_,EJ=nO,uEt=xL.f,CG=eV.set,lEt=Brt,dEt=jrt,hEt=aEt,pEt=cEt,AG=J1,_J=ZO.MutationObserver||ZO.WebKitMutationObserver,gJ=ZO.document,vJ=ZO.process,AM=ZO.Promise,yJ=uEt(ZO,"queueMicrotask"),V5=yJ&&yJ.value;V5||(sD=new lEt,uD=function(){var e,r;for(AG&&(e=vJ.domain)&&e.exit();r=sD.get();)try{r()}catch(i){throw sD.head&&WN(),i}e&&e.enter()},dEt||AG||pEt||!_J||!gJ?!hEt&&AM&&AM.resolve?((IG=AM.resolve(void 0)).constructor=AM,mJ=EJ(IG.then,IG),WN=function(){mJ(uD)}):AG?WN=function(){vJ.nextTick(uD)}:(CG=EJ(CG,ZO),WN=function(){CG(uD)}):(RG=!0,wG=gJ.createTextNode(""),new _J(uD).observe(wG,{characterData:!0}),WN=function(){wG.data=RG=!RG}),V5=function(e){sD.head||WN(),sD.add(e)});var sD,uD,Grt=V5,Q1=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},$O=V_.Promise,qrt=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",fEt=!qrt&&!J1&&typeof window=="object"&&typeof document=="object",mEt=V_,XD=$O,EEt=t0,_Et=srt,gEt=Drt,vEt=C_,yEt=fEt,SEt=qrt,OG=QO,SJ=XD&&XD.prototype,TEt=vEt("species"),Wrt=!1,Hrt=EEt(mEt.PromiseRejectionEvent),bEt=_Et("Promise",function(){var e=gEt(XD),r=e!==String(XD);if(!r&&OG===66||!SJ.catch||!SJ.finally)return!0;if(!OG||OG<51||!/native code/.test(e)){var i=new XD(function(s){s(1)}),o=function(s){s(function(){},function(){})};if((i.constructor={})[TEt]=o,!(Wrt=i.then(function(){})instanceof o))return!0}return!r&&(yEt||SEt)&&!Hrt}),qL={CONSTRUCTOR:bEt,REJECTION_EVENT:Hrt,SUBCLASSING:Wrt},NR={},TJ=$S,REt=TypeError,wEt=function(e){var r,i;this.promise=new e(function(o,s){if(r!==void 0||i!==void 0)throw REt("Bad Promise constructor");r=o,i=s}),this.resolve=TJ(r),this.reject=TJ(i)};NR.f=function(e){return new wEt(e)};var NG,bJ,IEt=zE,YU=J1,ZI=V_,WL=u0,CEt=iO,AEt=oO,OEt=function(e){var r=Nmt(e);Pmt&&r&&!r[oJ]&&kmt(r,oJ,{configurable:!0,get:function(){return this}})},NEt=$S,F5=t0,kEt=PS,PEt=RW,DEt=IW,Krt=eV.set,AW=Grt,LEt=function(e,r){try{arguments.length==1?console.error(e):console.error(e,r)}catch{}},MEt=Q1,UEt=Brt,zrt=oN,B5=$O,Yrt=qL,Jrt=NR,SU="Promise",RJ=Yrt.CONSTRUCTOR,xEt=Yrt.REJECTION_EVENT,kG=zrt.getterFor(SU),jEt=zrt.set,VEt=B5&&B5.prototype,ED=B5,PG=VEt,Xrt=ZI.TypeError,G5=ZI.document,OW=ZI.process,q5=Jrt.f,FEt=q5,BEt=!!(G5&&G5.createEvent&&ZI.dispatchEvent),Qrt="unhandledrejection",Zrt=function(e){var r;return!(!kEt(e)||!F5(r=e.then))&&r},$rt=function(e,r){var i,o,s,l=r.value,d=r.state==1,h=d?e.ok:e.fail,p=e.resolve,f=e.reject,_=e.domain;try{h?(d||(r.rejection===2&&qEt(r),r.rejection=1),h===!0?i=l:(_&&_.enter(),i=h(l),_&&(_.exit(),s=!0)),i===e.promise?f(Xrt("Promise-chain cycle")):(o=Zrt(i))?WL(o,i,p,f):p(i)):f(l)}catch(g){_&&!s&&_.exit(),f(g)}},tit=function(e,r){e.notified||(e.notified=!0,AW(function(){for(var i,o=e.reactions;i=o.get();)$rt(i,e);e.notified=!1,r&&!e.rejection&&GEt(e)}))},eit=function(e,r,i){var o,s;BEt?((o=G5.createEvent("Event")).promise=r,o.reason=i,o.initEvent(e,!1,!0),ZI.dispatchEvent(o)):o={promise:r,reason:i},!xEt&&(s=ZI["on"+e])?s(o):e===Qrt&&LEt("Unhandled promise rejection",i)},GEt=function(e){WL(Krt,ZI,function(){var r,i=e.facade,o=e.value;if(wJ(e)&&(r=MEt(function(){YU?OW.emit("unhandledRejection",o,i):eit(Qrt,i,o)}),e.rejection=YU||wJ(e)?2:1,r.error))throw r.value})},wJ=function(e){return e.rejection!==1&&!e.parent},qEt=function(e){WL(Krt,ZI,function(){var r=e.facade;YU?OW.emit("rejectionHandled",r):eit("rejectionhandled",r,e.value)})},d1=function(e,r,i){return function(o){e(r,o,i)}},S1=function(e,r,i){e.done||(e.done=!0,i&&(e=i),e.value=r,e.state=2,tit(e,!0))},W5=function(e,r,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===r)throw Xrt("Promise can't be resolved itself");var o=Zrt(r);o?AW(function(){var s={done:!1};try{WL(o,r,d1(W5,s,e),d1(S1,s,e))}catch(l){S1(s,l,e)}}):(e.value=r,e.state=1,tit(e,!1))}catch(s){S1({done:!1},s,e)}}};RJ&&(PG=(ED=function(e){PEt(this,PG),NEt(e),WL(NG,this);var r=kG(this);try{e(d1(W5,r),d1(S1,r))}catch(i){S1(r,i)}}).prototype,(NG=function(e){jEt(this,{type:SU,done:!1,notified:!1,parent:!1,reactions:new UEt,rejection:!1,state:0,value:void 0})}).prototype=CEt(PG,"then",function(e,r){var i=kG(this),o=q5(DEt(this,ED));return i.parent=!0,o.ok=!F5(e)||e,o.fail=F5(r)&&r,o.domain=YU?OW.domain:void 0,i.state==0?i.reactions.add(o):AW(function(){$rt(o,i)}),o.promise}),bJ=function(){var e=new NG,r=kG(e);this.promise=e,this.resolve=d1(W5,r),this.reject=d1(S1,r)},Jrt.f=q5=function(e){return e===ED||e===void 0?new bJ(e):FEt(e)}),IEt({global:!0,constructor:!0,wrap:!0,forced:RJ},{Promise:ED}),AEt(ED,SU,!1,!0),OEt(SU);var nit=C_("iterator"),rit=!1;try{IJ=0,DG={next:function(){return{done:!!IJ++}},return:function(){rit=!0}},DG[nit]=function(){return this},Array.from(DG,function(){throw 2})}catch{}var IJ,DG,WEt=$O,HEt=function(e,r){if(!r&&!rit)return!1;var i=!1;try{var o={};o[nit]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},nV=qL.CONSTRUCTOR||!HEt(function(e){WEt.all(e).then(void 0,function(){})}),KEt=u0,zEt=$S,YEt=NR,JEt=Q1,XEt=GL;zE({target:"Promise",stat:!0,forced:nV},{all:function(e){var r=this,i=YEt.f(r),o=i.resolve,s=i.reject,l=JEt(function(){var d=zEt(r.resolve),h=[],p=0,f=1;XEt(e,function(_){var g=p++,b=!1;f++,KEt(d,r,_).then(function(C){b||(b=!0,h[g]=C,--f||o(h))},s)}),--f||o(h)});return l.error&&s(l.value),i.promise}});var QEt=zE,ZEt=qL.CONSTRUCTOR;$O&&$O.prototype,QEt({target:"Promise",proto:!0,forced:ZEt,real:!0},{catch:function(e){return this.then(void 0,e)}});var $Et=u0,t_t=$S,e_t=NR,n_t=Q1,r_t=GL;zE({target:"Promise",stat:!0,forced:nV},{race:function(e){var r=this,i=e_t.f(r),o=i.reject,s=n_t(function(){var l=t_t(r.resolve);r_t(e,function(d){$Et(l,r,d).then(i.resolve,o)})});return s.error&&o(s.value),i.promise}});var i_t=u0,o_t=NR;zE({target:"Promise",stat:!0,forced:qL.CONSTRUCTOR},{reject:function(e){var r=o_t.f(this);return i_t(r.reject,void 0,e),r.promise}});var s_t=nS,a_t=PS,c_t=NR,iit=function(e,r){if(s_t(e),a_t(r)&&r.constructor===e)return r;var i=c_t.f(e);return(0,i.resolve)(r),i.promise},u_t=zE,l_t=$O,d_t=qL.CONSTRUCTOR,h_t=iit,p_t=fS("Promise"),f_t=!d_t;u_t({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return h_t(f_t&&this===p_t?l_t:this,e)}});var m_t=u0,E_t=$S,__t=NR,g_t=Q1,v_t=GL;zE({target:"Promise",stat:!0,forced:nV},{allSettled:function(e){var r=this,i=__t.f(r),o=i.resolve,s=i.reject,l=g_t(function(){var d=E_t(r.resolve),h=[],p=0,f=1;v_t(e,function(_){var g=p++,b=!1;f++,m_t(d,r,_).then(function(C){b||(b=!0,h[g]={status:"fulfilled",value:C},--f||o(h))},function(C){b||(b=!0,h[g]={status:"rejected",reason:C},--f||o(h))})}),--f||o(h)});return l.error&&s(l.value),i.promise}});var y_t=u0,S_t=$S,T_t=fS,b_t=NR,R_t=Q1,w_t=GL,CJ="No one promise resolved";zE({target:"Promise",stat:!0,forced:nV},{any:function(e){var r=this,i=T_t("AggregateError"),o=b_t.f(r),s=o.resolve,l=o.reject,d=R_t(function(){var h=S_t(r.resolve),p=[],f=0,_=1,g=!1;w_t(e,function(b){var C=f++,k=!1;_++,y_t(h,r,b).then(function(A){k||g||(g=!0,s(A))},function(A){k||g||(k=!0,p[C]=A,--_||l(new i(p,CJ)))})}),--_||l(new i(p,CJ))});return d.error&&l(d.value),o.promise}});var I_t=zE,H5=$O,C_t=M_,A_t=fS,O_t=t0,N_t=IW,AJ=iit,k_t=H5&&H5.prototype;I_t({target:"Promise",proto:!0,real:!0,forced:!!H5&&C_t(function(){k_t.finally.call({then:function(){}},function(){})})},{finally:function(e){var r=N_t(this,A_t("Promise")),i=O_t(e);return this.then(i?function(o){return AJ(r,e()).then(function(){return o})}:e,i?function(o){return AJ(r,e()).then(function(){throw o})}:e)}});var NW=k_,P_t=pW,D_t=tT,L_t=H1,M_t=NW("".charAt),OJ=NW("".charCodeAt),U_t=NW("".slice),NJ=function(e){return function(r,i){var o,s,l=D_t(L_t(r)),d=P_t(i),h=l.length;return d<0||d>=h?e?"":void 0:(o=OJ(l,d))<55296||o>56319||d+1===h||(s=OJ(l,d+1))<56320||s>57343?e?M_t(l,d):o:e?U_t(l,d,d+2):s-56320+(o-55296<<10)+65536}},kW={codeAt:NJ(!1),charAt:NJ(!0)},x_t=kW.charAt,j_t=tT,oit=oN,V_t=Nrt,kJ=bW,sit="String Iterator",F_t=oit.set,B_t=oit.getterFor(sit);V_t(String,"String",function(e){F_t(this,{type:sit,string:j_t(e),index:0})},function(){var e,r=B_t(this),i=r.string,o=r.index;return o>=i.length?kJ(void 0,!0):(e=x_t(i,o),r.index+=e.length,kJ(e,!1))});var G_t=ZS.Promise,q_t={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},W_t=V_,H_t=OR,K_t=rO,PJ=iN,DJ=C_("toStringTag");for(OM in q_t)LG=W_t[OM],NM=LG&&LG.prototype,NM&&H_t(NM)!==DJ&&K_t(NM,DJ,OM),PJ[OM]=PJ.Array;var LG,NM,OM,ait=G_t,eE=m_(ait),LJ=frt;function cit(e,r){let i=e&&e.navigator;if(!i.mediaDevices)return;let o=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;let h={};return Object.keys(d).forEach(p=>{if(p==="require"||p==="advanced"||p==="mediaSource")return;let f=typeof d[p]=="object"?d[p]:{ideal:d[p]};f.exact!==void 0&&typeof f.exact=="number"&&(f.min=f.max=f.exact);let _=function(g,b){return g?g+b.charAt(0).toUpperCase()+b.slice(1):b==="deviceId"?"sourceId":b};if(f.ideal!==void 0){h.optional=h.optional||[];let g={};typeof f.ideal=="number"?(g[_("min",p)]=f.ideal,h.optional.push(g),g={},g[_("max",p)]=f.ideal,h.optional.push(g)):(g[_("",p)]=f.ideal,h.optional.push(g))}f.exact!==void 0&&typeof f.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[_("",p)]=f.exact):["min","max"].forEach(g=>{f[g]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[_(g,p)]=f[g])})}),d.advanced&&(h.optional=(h.optional||[]).concat(d.advanced)),h},s=function(d,h){if(r.version>=61)return h(d);if((d=JSON.parse(JSON.stringify(d)))&&typeof d.audio=="object"){let p=function(f,_,g){_ in f&&!(g in f)&&(f[g]=f[_],delete f[_])};p((d=JSON.parse(JSON.stringify(d))).audio,"autoGainControl","googAutoGainControl"),p(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=o(d.audio)}if(d&&typeof d.video=="object"){let p=d.video.facingMode;p=p&&(typeof p=="object"?p:{ideal:p});let f=r.version<66;if(p&&(p.exact==="user"||p.exact==="environment"||p.ideal==="user"||p.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||f)){let _;if(delete d.video.facingMode,p.exact==="environment"||p.ideal==="environment"?_=["back","rear"]:p.exact!=="user"&&p.ideal!=="user"||(_=["front"]),_)return i.mediaDevices.enumerateDevices().then(g=>{let b=(g=g.filter(C=>C.kind==="videoinput")).find(C=>_.some(k=>{var A;return nE(A=C.label.toLowerCase()).call(A,k)}));return!b&&g.length&&nE(_).call(_,"back")&&(b=g[g.length-1]),b&&(d.video.deviceId=p.exact?{exact:b.deviceId}:{ideal:b.deviceId}),d.video=o(d.video),LJ("chrome: "+JSON.stringify(d)),h(d)})}d.video=o(d.video)}return LJ("chrome: "+JSON.stringify(d)),h(d)},l=function(d){return r.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=function(d,h,p){s(d,f=>{i.webkitGetUserMedia(f,h,_=>{p&&p(l(_))})})}.bind(i),i.mediaDevices.getUserMedia){let d=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(h){return s(h,p=>d(p).then(f=>{if(p.audio&&!f.getAudioTracks().length||p.video&&!f.getVideoTracks().length)throw f.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return f},f=>eE.reject(l(f))))}}}function uit(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function lit(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===o.track.id):{track:o.track};let l=new Event("track");l.track=o.track,l.receiver=s,l.transceiver={receiver:s},l.streams=[i.stream],this.dispatchEvent(l)}),i.stream.getTracks().forEach(o=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===o.id):{track:o};let l=new Event("track");l.track=o,l.receiver=s,l.transceiver={receiver:s},l.streams=[i.stream],this.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else rN(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function dit(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let r=function(s,l){return{track:l,get dtmf(){return this._dtmf===void 0&&(l.kind==="audio"?this._dtmf=s.createDTMFSender(l):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,h){let p=s.apply(this,arguments);return p||(p=r(this,d),this._senders.push(p)),p};let l=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){l.apply(this,arguments);let h=this._senders.indexOf(d);h!==-1&&this._senders.splice(h,1)}}let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach(l=>{this._senders.push(r(this,l))})};let o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],o.apply(this,[s]),s.getTracks().forEach(l=>{let d=this._senders.find(h=>h.track===l);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function hit(e){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[i,o,s]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);let l=function(h){let p={};return h.result().forEach(f=>{let _={id:f.id,timestamp:f.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[f.type]||f.type};f.names().forEach(g=>{_[g]=f.stat(g)}),p[_.id]=_}),p},d=function(h){return new Map(Object.keys(h).map(p=>[p,h[p]]))};if(arguments.length>=2){let h=function(p){o(d(l(p)))};return r.apply(this,[h,i])}return new eE((h,p)=>{r.apply(this,[function(f){h(d(l(f)))},p])}).then(o,s)}}function pit(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){let s=i.apply(this,[]);return s.forEach(l=>l._pc=this),s});let o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){let s=o.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){let s=this;return this._pc.getStats().then(l=>L9(l,s.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){let o=i.apply(this,[]);return o.forEach(s=>s._pc=this),o}),rN(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){let o=this;return this._pc.getStats().then(s=>L9(s,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let i=arguments[0],o,s,l;return this.getSenders().forEach(d=>{d.track===i&&(o?l=!0:o=d)}),this.getReceivers().forEach(d=>(d.track===i&&(s?l=!0:s=d),d.track===i)),l||o&&s?eE.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():s?s.getStats():eE.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function fit(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(l=>this._shimmedLocalStreams[l][0])};let r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,d){if(!d)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let h=r.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(h)===-1&&this._shimmedLocalStreams[d.id].push(h):this._shimmedLocalStreams[d.id]=[d,h],h};let i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(l){this._shimmedLocalStreams=this._shimmedLocalStreams||{},l.getTracks().forEach(p=>{if(this.getSenders().find(_=>_.track===p))throw new DOMException("Track already exists.","InvalidAccessError")});let d=this.getSenders();i.apply(this,arguments);let h=this.getSenders().filter(p=>d.indexOf(p)===-1);this._shimmedLocalStreams[l.id]=[l].concat(h)};let o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[l.id],o.apply(this,arguments)};let s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},l&&Object.keys(this._shimmedLocalStreams).forEach(d=>{let h=this._shimmedLocalStreams[d].indexOf(l);h!==-1&&this._shimmedLocalStreams[d].splice(h,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),s.apply(this,arguments)}}function mit(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return fit(e);let i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let p=i.apply(this);return this._reverseStreams=this._reverseStreams||{},p.map(f=>this._reverseStreams[f.id])};let o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(p){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},p.getTracks().forEach(f=>{if(this.getSenders().find(g=>g.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[p.id]){let f=new e.MediaStream(p.getTracks());this._streams[p.id]=f,this._reverseStreams[f.id]=p,p=f}o.apply(this,[p])};let s=e.RTCPeerConnection.prototype.removeStream;function l(p,f){let _=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(g=>{let b=p._reverseStreams[g],C=p._streams[b.id];_=_.replace(new RegExp(C.id,"g"),b.id)}),new RTCSessionDescription({type:f.type,sdp:_})}e.RTCPeerConnection.prototype.removeStream=function(p){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[p.id]||p]),delete this._reverseStreams[this._streams[p.id]?this._streams[p.id].id:p.id],delete this._streams[p.id]},e.RTCPeerConnection.prototype.addTrack=function(p,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(C=>C===p))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(C=>C.track===p))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let b=this._streams[f.id];if(b)b.addTrack(p),eE.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let C=new e.MediaStream([p]);this._streams[f.id]=C,this._reverseStreams[C.id]=f,this.addStream(C)}return this.getSenders().find(C=>C.track===p)},["createOffer","createAnswer"].forEach(function(p){let f=e.RTCPeerConnection.prototype[p],_={[p](){let g=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[b=>{let C=l(this,b);g[0].apply(null,[C])},b=>{g[1]&&g[1].apply(null,b)},arguments[2]]):f.apply(this,arguments).then(b=>l(this,b))}};e.RTCPeerConnection.prototype[p]=_[p]});let d=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(p,f){let _=f.sdp;return Object.keys(p._reverseStreams||[]).forEach(g=>{let b=p._reverseStreams[g],C=p._streams[b.id];_=_.replace(new RegExp(b.id,"g"),C.id)}),new RTCSessionDescription({type:f.type,sdp:_})}(this,arguments[0]),d.apply(this,arguments)):d.apply(this,arguments)};let h=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let p=h.get.apply(this);return p.type===""?p:l(this,p)}}),e.RTCPeerConnection.prototype.removeTrack=function(p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!p._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(p._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(g=>p.track===g)&&(f=this._streams[_])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(p.track),this.dispatchEvent(new Event("negotiationneeded")))}}function K5(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let o=e.RTCPeerConnection.prototype[i],s={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=s[i]})}function Eit(e,r){rN(e,"negotiationneeded",i=>{let o=i.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var MJ=Object.freeze({__proto__:null,fixNegotiationNeeded:Eit,shimAddTrackRemoveTrack:mit,shimAddTrackRemoveTrackWithNative:fit,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof r=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(o=>{let s=i.video&&i.video.width,l=i.video&&i.video.height,d=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:d||3}},s&&(i.video.mandatory.maxWidth=s),l&&(i.video.mandatory.maxHeight=l),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:dit,shimGetStats:hit,shimGetUserMedia:cit,shimMediaStream:uit,shimOnTrack:lit,shimPeerConnection:K5,shimSenderReceiverGetStats:pit});function _it(e,r){let i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(s,l,d){_W("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(s).then(l,d)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){let s=function(d,h,p){h in d&&!(p in d)&&(d[p]=d[h],delete d[h])},l=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(d){return typeof d=="object"&&typeof d.audio=="object"&&(d=JSON.parse(JSON.stringify(d)),s(d.audio,"autoGainControl","mozAutoGainControl"),s(d.audio,"noiseSuppression","mozNoiseSuppression")),l(d)},o&&o.prototype.getSettings){let d=o.prototype.getSettings;o.prototype.getSettings=function(){let h=d.apply(this,arguments);return s(h,"mozAutoGainControl","autoGainControl"),s(h,"mozNoiseSuppression","noiseSuppression"),h}}if(o&&o.prototype.applyConstraints){let d=o.prototype.applyConstraints;o.prototype.applyConstraints=function(h){return this.kind==="audio"&&typeof h=="object"&&(h=JSON.parse(JSON.stringify(h)),s(h,"autoGainControl","mozAutoGainControl"),s(h,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[h])}}}}function git(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function z5(e,r){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){let l=e.RTCPeerConnection.prototype[s],d={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),l.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=d[s]});let i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[s,l,d]=arguments;return o.apply(this,[s||null]).then(h=>{if(r.version<53&&!l)try{h.forEach(p=>{p.type=i[p.type]||p.type})}catch(p){if(p.name!=="TypeError")throw p;h.forEach((f,_)=>{h.set(_,Object.assign({},f,{type:i[f.type]||f.type}))})}return h}).then(l,d)}}function vit(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){let o=r.apply(this,[]);return o.forEach(s=>s._pc=this),o});let i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){let o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):eE.resolve(new Map)}}function yit(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){let i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i}),rN(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function Sit(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(r){_W("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&nE(o=r.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function Tit(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function bit(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];let o=i.length>0;o&&i.forEach(l=>{if("rid"in l&&!/^[a-z0-9]{0,16}$/i.test(l.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in l&&!(parseFloat(l.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in l&&!(parseFloat(l.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let s=r.apply(this,arguments);if(o){let{sender:l}=s,d=l.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=i,l.sendEncodings=i,this.setParametersPromises.push(l.setParameters(d).then(()=>{delete l.sendEncodings}).catch(()=>{delete l.sendEncodings})))}return s})}function Rit(e){if(typeof e!="object"||!e.RTCRtpSender)return;let r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){let i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function wit(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?eE.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function Iit(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?eE.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var UJ=Object.freeze({__proto__:null,shimAddTransceiver:bit,shimCreateAnswer:Iit,shimCreateOffer:wit,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){let o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,eE.reject(o)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:Rit,shimGetUserMedia:_it,shimOnTrack:git,shimPeerConnection:z5,shimRTCDataChannel:Tit,shimReceiverGetStats:yit,shimRemoveStream:Sit,shimSenderGetStats:vit});function Cit(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),nE(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(s=>r.call(this,s,i)),i.getVideoTracks().forEach(s=>r.call(this,s,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,s=new Array(o>1?o-1:0),l=1;l<o;l++)s[l-1]=arguments[l];return s&&s.forEach(d=>{var h;this._localStreams?nE(h=this._localStreams).call(h,d)||this._localStreams.push(d):this._localStreams=[d]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);let i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);let o=r.getTracks();this.getSenders().forEach(s=>{nE(o).call(o,s.track)&&this.removeTrack(s)})})}}function Ait(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(s=>{var l;if(this._remoteStreams||(this._remoteStreams=[]),nE(l=this._remoteStreams).call(l,s))return;this._remoteStreams.push(s);let d=new Event("addstream");d.stream=s,this.dispatchEvent(d)})})}});let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(s=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(s)>=0)return;i._remoteStreams.push(s);let l=new Event("addstream");l.stream=s,i.dispatchEvent(l)})}),r.apply(i,arguments)}}}function Oit(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let r=e.RTCPeerConnection.prototype,i=r.createOffer,o=r.createAnswer,s=r.setLocalDescription,l=r.setRemoteDescription,d=r.addIceCandidate;r.createOffer=function(p,f){let _=arguments.length>=2?arguments[2]:arguments[0],g=i.apply(this,[_]);return f?(g.then(p,f),eE.resolve()):g},r.createAnswer=function(p,f){let _=arguments.length>=2?arguments[2]:arguments[0],g=o.apply(this,[_]);return f?(g.then(p,f),eE.resolve()):g};let h=function(p,f,_){let g=s.apply(this,[p]);return _?(g.then(f,_),eE.resolve()):g};r.setLocalDescription=h,h=function(p,f,_){let g=l.apply(this,[p]);return _?(g.then(f,_),eE.resolve()):g},r.setRemoteDescription=h,h=function(p,f,_){let g=d.apply(this,[p]);return _?(g.then(f,_),eE.resolve()):g},r.addIceCandidate=h}function Nit(e){let r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){let i=r.mediaDevices,o=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=s=>o(kit(s))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=function(i,o,s){r.mediaDevices.getUserMedia(i).then(o,s)}.bind(r))}function kit(e){return e&&e.video!==void 0?Object.assign({},e,{video:mrt(e.video)}):e}function Pit(e){if(!e.RTCPeerConnection)return;let r=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){let s=[];for(let l=0;l<i.iceServers.length;l++){let d=i.iceServers[l];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(_W("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,s.push(d)):s.push(i.iceServers[l])}i.iceServers=s}return new r(i,o)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function Dit(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Lit(e){let r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);let o=this.getTransceivers().find(l=>l.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);let s=this.getTransceivers().find(l=>l.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):i.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function Mit(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var xJ=Object.freeze({__proto__:null,shimAudioContext:Mit,shimCallbacksAPI:Oit,shimConstraints:kit,shimCreateOfferLegacy:Lit,shimGetUserMedia:Nit,shimLocalStreamsAPI:Cit,shimRTCIceServerUrls:Pit,shimRemoteStreamsAPI:Ait,shimTrackEventTransceiver:Dit}),Uit=`	
\v\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF`,z_t=H1,Y_t=tT,Y5=Uit,jJ=k_("".replace),J_t=RegExp("^["+Y5+"]+"),X_t=RegExp("(^|[^"+Y5+"])["+Y5+"]+$"),MG=function(e){return function(r){var i=Y_t(z_t(r));return 1&e&&(i=jJ(i,J_t,"")),2&e&&(i=jJ(i,X_t,"$1")),i}},Q_t={start:MG(1),end:MG(2),trim:MG(3)},Z_t=Crt.PROPER,$_t=M_,VJ=Uit,tgt=Q_t.trim;zE({target:"String",proto:!0,forced:function(e){return $_t(function(){return!!VJ[e]()||"\u200B\x85\u180E"[e]()!=="\u200B\x85\u180E"||Z_t&&VJ[e].name!==e})}("trim")},{trim:function(){return tgt(this)}});var egt=CT("String").trim,ngt=j0,rgt=egt,UG=String.prototype,igt=function(e){var r=e.trim;return typeof e=="string"||e===UG||ngt(UG,e)&&r===UG.trim?rgt:r},C0=m_(igt),xit={exports:{}};(function(e){let r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(i){return i.split(`
m=`).map((o,s)=>(s>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(i){let o=r.splitSections(i);return o&&o[0]},r.getMediaSections=function(i){let o=r.splitSections(i);return o.shift(),o},r.matchPrefix=function(i,o){return r.splitLines(i).filter(s=>s.indexOf(o)===0)},r.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");let s={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let l=8;l<o.length;l+=2)switch(o[l]){case"raddr":s.relatedAddress=o[l+1];break;case"rport":s.relatedPort=parseInt(o[l+1],10);break;case"tcptype":s.tcpType=o[l+1];break;case"ufrag":s.ufrag=o[l+1],s.usernameFragment=o[l+1];break;default:s[o[l]]===void 0&&(s[o[l]]=o[l+1])}return s},r.writeCandidate=function(i){let o=[];o.push(i.foundation);let s=i.component;s==="rtp"?o.push(1):s==="rtcp"?o.push(2):o.push(s),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);let l=i.type;return o.push("typ"),o.push(l),l!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let o=i.substring(9).split(" "),s={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),s.name=o[0],s.clockRate=parseInt(o[1],10),s.channels=o.length===3?parseInt(o[2],10):1,s.numChannels=s.channels,s},r.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);let s=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(s!==1?"/"+s:"")+`\r
`},r.parseExtmap=function(i){let o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){let o={},s,l=i.substring(i.indexOf(" ")+1).split(";");for(let d=0;d<l.length;d++)s=l[d].trim().split("="),o[s[0].trim()]=s[1];return o},r.writeFmtp=function(i){let o="",s=i.payloadType;if(i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){let l=[];Object.keys(i.parameters).forEach(d=>{i.parameters[d]!==void 0?l.push(d+"="+i.parameters[d]):l.push(d)}),o+="a=fmtp:"+s+" "+l.join(";")+`\r
`}return o},r.parseRtcpFb=function(i){let o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(i){let o="",s=i.payloadType;return i.preferredPayloadType!==void 0&&(s=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(l=>{o+="a=rtcp-fb:"+s+" "+l.type+(l.parameter&&l.parameter.length?" "+l.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(i){let o=i.indexOf(" "),s={ssrc:parseInt(i.substring(7,o),10)},l=i.indexOf(":",o);return l>-1?(s.attribute=i.substring(o+1,l),s.value=i.substring(l+1)):s.attribute=i.substring(o+1),s},r.parseSsrcGroup=function(i){let o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(s=>parseInt(s,10))}},r.getMid=function(i){let o=r.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(i){let o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:r.matchPrefix(i+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,o){let s="a=setup:"+o+`\r
`;return i.fingerprints.forEach(l=>{s+="a=fingerprint:"+l.algorithm+" "+l.value+`\r
`}),s},r.parseCryptoLine=function(i){let o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;let o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,o){return r.matchPrefix(i+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,o){let s=r.matchPrefix(i+o,"a=ice-ufrag:")[0],l=r.matchPrefix(i+o,"a=ice-pwd:")[0];return s&&l?{usernameFragment:s.substring(12),password:l.substring(10)}:null},r.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(i){let o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=r.splitLines(i)[0].split(" ");o.profile=s[2];for(let d=3;d<s.length;d++){let h=s[d],p=r.matchPrefix(i,"a=rtpmap:"+h+" ")[0];if(p){let f=r.parseRtpMap(p),_=r.matchPrefix(i,"a=fmtp:"+h+" ");switch(f.parameters=_.length?r.parseFmtp(_[0]):{},f.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+h+" ").map(r.parseRtcpFb),o.codecs.push(f),f.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(f.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(d=>{o.headerExtensions.push(r.parseExtmap(d))});let l=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(d=>{l.forEach(h=>{d.rtcpFeedback.find(p=>p.type===h.type&&p.parameter===h.parameter)||d.rtcpFeedback.push(h)})}),o},r.writeRtpDescription=function(i,o){let s="";s+="m="+i+" ",s+=o.codecs.length>0?"9":"0",s+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=o.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(d=>{s+=r.writeRtpMap(d),s+=r.writeFmtp(d),s+=r.writeRtcpFb(d)});let l=0;return o.codecs.forEach(d=>{d.maxptime>l&&(l=d.maxptime)}),l>0&&(s+="a=maxptime:"+l+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(d=>{s+=r.writeExtmap(d)}),s},r.parseRtpEncodingParameters=function(i){let o=[],s=r.parseRtpParameters(i),l=s.fecMechanisms.indexOf("RED")!==-1,d=s.fecMechanisms.indexOf("ULPFEC")!==-1,h=r.matchPrefix(i,"a=ssrc:").map(b=>r.parseSsrcMedia(b)).filter(b=>b.attribute==="cname"),p=h.length>0&&h[0].ssrc,f,_=r.matchPrefix(i,"a=ssrc-group:FID").map(b=>b.substring(17).split(" ").map(C=>parseInt(C,10)));_.length>0&&_[0].length>1&&_[0][0]===p&&(f=_[0][1]),s.codecs.forEach(b=>{if(b.name.toUpperCase()==="RTX"&&b.parameters.apt){let C={ssrc:p,codecPayloadType:parseInt(b.parameters.apt,10)};p&&f&&(C.rtx={ssrc:f}),o.push(C),l&&(C=JSON.parse(JSON.stringify(C)),C.fec={ssrc:p,mechanism:d?"red+ulpfec":"red"},o.push(C))}}),o.length===0&&p&&o.push({ssrc:p});let g=r.matchPrefix(i,"b=");return g.length&&(g=g[0].indexOf("b=TIAS:")===0?parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?1e3*parseInt(g[0].substring(5),10)*.95-16e3:void 0,o.forEach(b=>{b.maxBitrate=g})),o},r.parseRtcpParameters=function(i){let o={},s=r.matchPrefix(i,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="cname")[0];s&&(o.cname=s.value,o.ssrc=s.ssrc);let l=r.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=l.length>0,o.compound=l.length===0;let d=r.matchPrefix(i,"a=rtcp-mux");return o.mux=d.length>0,o},r.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},r.parseMsid=function(i){let o,s=r.matchPrefix(i,"a=msid:");if(s.length===1)return o=s[0].substring(7).split(" "),{stream:o[0],track:o[1]};let l=r.matchPrefix(i,"a=ssrc:").map(d=>r.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return l.length>0?(o=l[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(i){let o=r.parseMLine(i),s=r.matchPrefix(i,"a=max-message-size:"),l;s.length>0&&(l=parseInt(s[0].substring(19),10)),isNaN(l)&&(l=65536);let d=r.matchPrefix(i,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substring(12),10),protocol:o.fmt,maxMessageSize:l};let h=r.matchPrefix(i,"a=sctpmap:");if(h.length>0){let p=h[0].substring(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:l}}},r.writeSctpDescription=function(i,o){let s=[];return s=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&s.push("a=max-message-size:"+o.maxMessageSize+`\r
`),s.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,o,s){let l,d=o!==void 0?o:2;return l=i||r.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+l+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,o){let s=r.splitLines(i);for(let l=0;l<s.length;l++)switch(s[l]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[l].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){let o=r.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(i){let o=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;let o=r.splitLines(i);for(let s=0;s<o.length;s++)if(o[s].length<2||o[s].charAt(1)!=="=")return!1;return!0},e.exports=r})(xit);var jit=xit.exports,T1=m_(jit),ogt=Ilt({__proto__:null,default:T1},[jit]);function TU(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let r=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){let o=new r(i),s=T1.parseCandidate(i.candidate),l=Object.assign(o,s);return l.toJSON=function(){return{candidate:l.candidate,sdpMid:l.sdpMid,sdpMLineIndex:l.sdpMLineIndex,usernameFragment:l.usernameFragment}},l}return new r(i)},e.RTCIceCandidate.prototype=r.prototype,rN(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function J5(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||rN(e,"icecandidate",r=>{if(r.candidate){let i=T1.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function bU(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let i=function(h){if(!h||!h.sdp)return!1;let p=T1.splitSections(h.sdp);return p.shift(),p.some(f=>{let _=T1.parseMLine(f);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},o=function(h){let p=h.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(p===null||p.length<2)return-1;let f=parseInt(p[1],10);return f!=f?-1:f},s=function(h){let p=65536;return r.browser==="firefox"&&(p=r.version<57?h===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),p},l=function(h,p){let f=65536;r.browser==="firefox"&&r.version===57&&(f=65535);let _=T1.matchPrefix(h.sdp,"a=max-message-size:");return _.length>0?f=parseInt(_[0].substr(19),10):r.browser==="firefox"&&p!==-1&&(f=2147483637),f},d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){let{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){let h=o(arguments[0]),p=s(h),f=l(arguments[0],h),_;_=p===0&&f===0?Number.POSITIVE_INFINITY:p===0||f===0?Math.max(p,f):Math.min(p,f);let g={};Object.defineProperty(g,"maxMessageSize",{get:()=>_}),this._sctp=g}return d.apply(this,arguments)}}function RU(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function r(o,s){let l=o.send;o.send=function(){let d=arguments[0],h=d.length||d.size||d.byteLength;if(o.readyState==="open"&&s.sctp&&h>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return l.apply(o,arguments)}}let i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let o=i.apply(this,arguments);return r(o,this),o},rN(e,"datachannel",o=>(r(o.channel,o.target),o))}function X5(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{let o=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{let l=s.target;if(l._lastConnectionState!==l.connectionState){l._lastConnectionState=l.connectionState;let d=new Event("connectionstatechange",s);l.dispatchEvent(d)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function Q5(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;let i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let s=o.sdp.split(`
`).filter(l=>C0(l).call(l)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:s}):o.sdp=s}return i.apply(this,arguments)}}function wU(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?eE.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),eE.resolve())})}function IU(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(s=>i.apply(this,[s]))})}var sgt=Object.freeze({__proto__:null,removeExtmapAllowMixed:Q5,shimAddIceCandidateNullOrEmpty:wU,shimConnectionState:X5,shimMaxMessageSize:bU,shimParameterlessSetLocalDescription:IU,shimRTCIceCandidate:TU,shimRTCIceCandidateRelayProtocol:J5,shimSendThrowTypeError:RU});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},i=frt,o=function(l){let d={browser:null,version:null};if(l===void 0||!l.navigator)return d.browser="Not a browser.",d;let{navigator:h}=l;if(h.mozGetUserMedia)d.browser="firefox",d.version=RM(h.userAgent,/Firefox\/(\d+)\./,1);else if(h.webkitGetUserMedia||l.isSecureContext===!1&&l.webkitRTCPeerConnection)d.browser="chrome",d.version=RM(h.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!l.RTCPeerConnection||!h.userAgent.match(/AppleWebKit\/(\d+)\./))return d.browser="Not a supported browser.",d;d.browser="safari",d.version=RM(h.userAgent,/AppleWebKit\/(\d+)\./,1),d.supportsUnifiedPlan=l.RTCRtpTransceiver&&"currentDirection"in l.RTCRtpTransceiver.prototype}return d}(e),s={browserDetails:o,commonShim:sgt,extractVersion:RM,disableLog:opt,disableWarnings:spt,sdp:ogt};switch(o.browser){case"chrome":if(!MJ||!K5||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),s;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),s;i("adapter.js shimming chrome."),s.browserShim=MJ,wU(e,o),IU(e),cit(e,o),uit(e),K5(e,o),lit(e),mit(e,o),dit(e),hit(e),pit(e),Eit(e,o),TU(e),J5(e),X5(e),bU(e,o),RU(e),Q5(e,o);break;case"firefox":if(!UJ||!z5||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),s;i("adapter.js shimming firefox."),s.browserShim=UJ,wU(e,o),IU(e),_it(e,o),z5(e,o),git(e),Sit(e),vit(e),yit(e),Tit(e),bit(e),Rit(e),wit(e),Iit(e),TU(e),X5(e),bU(e,o),RU(e);break;case"safari":if(!xJ||!r.shimSafari)return i("Safari shim is not included in this adapter release."),s;i("adapter.js shimming safari."),s.browserShim=xJ,wU(e,o),IU(e),Pit(e),Lit(e),Oit(e),Cit(e),Ait(e),Dit(e),Nit(e),Mit(e),TU(e),J5(e),bU(e,o),RU(e),Q5(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var agt=CT("Array").keys,cgt=OR,ugt=m0,lgt=j0,dgt=agt,xG=Array.prototype,hgt={DOMTokenList:!0,NodeList:!0},pgt=function(e){var r=e.keys;return e===xG||lgt(xG,e)&&r===xG.keys||ugt(hgt,cgt(e))?dgt:r},RS=m_(pgt),FJ=z1,fgt=TypeError,mgt=H3,Egt=IT,_gt=_A,rV=function(e,r,i){var o=mgt(r);o in e?Egt.f(e,o,_gt(0,i)):e[o]=i},BJ=fW,ggt=rI,vgt=rV,ygt=Array,Sgt=Math.max,PW=function(e,r,i){for(var o=ggt(e),s=BJ(r,o),l=BJ(i===void 0?o:i,o),d=ygt(Sgt(l-s,0)),h=0;s<l;s++,h++)vgt(d,h,e[s]);return d.length=h,d},GJ=PW,Tgt=Math.floor,Z5=function(e,r){var i=e.length,o=Tgt(i/2);return i<8?bgt(e,r):Rgt(e,Z5(GJ(e,0,o),r),Z5(GJ(e,o),r),r)},bgt=function(e,r){for(var i,o,s=e.length,l=1;l<s;){for(o=l,i=e[l];o&&r(e[o-1],i)>0;)e[o]=e[--o];o!==l++&&(e[o]=i)}return e},Rgt=function(e,r,i,o){for(var s=r.length,l=i.length,d=0,h=0;d<s||h<l;)e[d+h]=d<s&&h<l?o(r[d],i[h])<=0?r[d++]:i[h++]:d<s?r[d++]:i[h++];return e},Vit=Z5,qJ=eO.match(/firefox\/(\d+)/i),wgt=!!qJ&&+qJ[1],Igt=/MSIE|Trident/.test(eO),WJ=eO.match(/AppleWebKit\/(\d+)\./),Cgt=!!WJ&&+WJ[1],Agt=zE,Fit=k_,Ogt=$S,Ngt=AR,HJ=rI,kgt=function(e,r){if(!delete e[r])throw fgt("Cannot delete property "+FJ(r)+" of "+FJ(e))},KJ=tT,DW=M_,Pgt=Vit,Dgt=K3,zJ=wgt,Lgt=Igt,YJ=QO,JJ=Cgt,FI=[],XJ=Fit(FI.sort),Mgt=Fit(FI.push),Ugt=DW(function(){FI.sort(void 0)}),xgt=DW(function(){FI.sort(null)}),jgt=Dgt("sort"),QJ=!DW(function(){if(YJ)return YJ<70;if(!(zJ&&zJ>3)){if(Lgt)return!0;if(JJ)return JJ<603;var e,r,i,o,s="";for(e=65;e<76;e++){switch(r=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)FI.push({k:r+o,v:i})}for(FI.sort(function(l,d){return d.v-l.v}),o=0;o<FI.length;o++)r=FI[o].k.charAt(0),s.charAt(s.length-1)!==r&&(s+=r);return s!=="DGBEFHACIJK"}});Agt({target:"Array",proto:!0,forced:Ugt||!xgt||!jgt||!QJ},{sort:function(e){e!==void 0&&Ogt(e);var r=Ngt(this);if(QJ)return e===void 0?XJ(r):XJ(r,e);var i,o,s=[],l=HJ(r);for(o=0;o<l;o++)o in r&&Mgt(s,r[o]);for(Pgt(s,function(d){return function(h,p){return p===void 0?-1:h===void 0?1:d!==void 0?+d(h,p)||0:KJ(h)>KJ(p)?1:-1}}(e)),i=HJ(s),o=0;o<i;)r[o]=s[o++];for(;o<l;)kgt(r,o++);return r}});var jG,VG,Vgt=CT("Array").sort,Fgt=j0,Bgt=Vgt,FG=Array.prototype,Ggt=function(e){var r=e.sort;return e===FG||Fgt(FG,e)&&r===FG.sort?Bgt:r},HL=m_(Ggt),$5={exports:{}};jG=$5,VG=$5.exports,function(e,r){var i="function",o="undefined",s="object",l="string",d="major",h="model",p="name",f="type",_="vendor",g="version",b="architecture",C="console",k="mobile",A="tablet",P="smarttv",x="wearable",j="embedded",z="Amazon",_t="Apple",ue="ASUS",_n="BlackBerry",Ei="Browser",_s="Chrome",kc="Firefox",_i="Google",_h="Huawei",_p="LG",Qm="Microsoft",_o="Motorola",ga="Opera",vf="Samsung",Fi="Sharp",Gi="Sony",_d="Xiaomi",Di="Zebra",H="Facebook",Wt="Chromium OS",_e="Mac OS",_f=function(bE){for(var dE={},gE=0;gE<bE.length;gE++)dE[bE[gE].toUpperCase()]=bE[gE];return dE},uE=function(bE,dE){return typeof bE===l&&IE(dE).indexOf(IE(bE))!==-1},IE=function(bE){return bE.toLowerCase()},O_=function(bE,dE){if(typeof bE===l)return bE=bE.replace(/^\s\s*/,""),typeof dE===o?bE:bE.substring(0,350)},A0=function(bE,dE){for(var gE,r_,y0,a_,LE,z0,iI=0;iI<dE.length&&!LE;){var PT=dE[iI],NH=dE[iI+1];for(gE=r_=0;gE<PT.length&&!LE&&PT[gE];)if(LE=PT[gE++].exec(bE))for(y0=0;y0<NH.length;y0++)z0=LE[++r_],typeof(a_=NH[y0])===s&&a_.length>0?a_.length===2?typeof a_[1]==i?this[a_[0]]=a_[1].call(this,z0):this[a_[0]]=a_[1]:a_.length===3?typeof a_[1]!==i||a_[1].exec&&a_[1].test?this[a_[0]]=z0?z0.replace(a_[1],a_[2]):r:this[a_[0]]=z0?a_[1].call(this,z0,a_[2]):r:a_.length===4&&(this[a_[0]]=z0?a_[3].call(this,z0.replace(a_[1],a_[2])):r):this[a_]=z0||r;iI+=2}},kT=function(bE,dE){for(var gE in dE)if(typeof dE[gE]===s&&dE[gE].length>0){for(var r_=0;r_<dE[gE].length;r_++)if(uE(dE[gE][r_],bE))return gE==="?"?r:gE}else if(uE(dE[gE],bE))return gE==="?"?r:gE;return bE},aO={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Mb={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,g],[/opios[\/ ]+([\w\.]+)/i],[g,[p,ga+" Mini"]],[/\bopr\/([\w\.]+)/i],[g,[p,ga]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[p,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[p,"UC"+Ei]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[g,[p,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[g,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[p,"IE"]],[/yabrowser\/([\w\.]+)/i],[g,[p,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+Ei],g],[/\bfocus\/([\w\.]+)/i],[g,[p,kc+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[p,ga+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[p,ga+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[p,"MIUI "+Ei]],[/fxios\/([-\w\.]+)/i],[g,[p,kc]],[/\bqihu|(qi?ho?o?|360)browser/i],[[p,"360 "+Ei]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1 "+Ei],g],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[p,g],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,H],g],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[p,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[p,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[p,_s+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,_s+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[p,"Android "+Ei]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,g],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[g,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[g,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[g,kT,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[p,kc+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[p,g],[/(cobalt)\/([\w\.]+)/i],[p,[g,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[b,"amd64"]],[/(ia32(?=;))/i],[[b,IE]],[/((?:i[346]|x)86)[;\)]/i],[[b,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[b,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[b,"armhf"]],[/windows (ce|mobile); ppc;/i],[[b,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[b,/ower/,"",IE]],[/(sun4\w)[;\)]/i],[[b,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[b,IE]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[_,vf],[f,A]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[h,[_,vf],[f,k]],[/\((ip(?:hone|od)[\w ]*);/i],[h,[_,_t],[f,k]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[_,_t],[f,A]],[/(macintosh);/i],[h,[_,_t]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[_,Fi],[f,k]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[h,[_,_h],[f,A]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[_,_h],[f,k]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[h,/_/g," "],[_,_d],[f,k]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[h,/_/g," "],[_,_d],[f,A]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[_,"OPPO"],[f,k]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[_,"Vivo"],[f,k]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[h,[_,"Realme"],[f,k]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[h,[_,_o],[f,k]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[_,_o],[f,A]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[_,_p],[f,A]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[_,_p],[f,k]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[h,[_,"Lenovo"],[f,A]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[h,/_/g," "],[_,"Nokia"],[f,k]],[/(pixel c)\b/i],[h,[_,_i],[f,A]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[h,[_,_i],[f,k]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[_,Gi],[f,k]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[_,Gi],[f,A]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[_,"OnePlus"],[f,k]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[_,z],[f,A]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[_,z],[f,k]],[/(playbook);[-\w\),; ]+(rim)/i],[h,_,[f,A]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[_,_n],[f,k]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[_,ue],[f,A]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[_,ue],[f,k]],[/(nexus 9)/i],[h,[_,"HTC"],[f,A]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[h,/_/g," "],[f,k]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[_,"Acer"],[f,A]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[_,"Meizu"],[f,k]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_,h,[f,k]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,h,[f,A]],[/(surface duo)/i],[h,[_,Qm],[f,A]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[_,"Fairphone"],[f,k]],[/(u304aa)/i],[h,[_,"AT&T"],[f,k]],[/\bsie-(\w*)/i],[h,[_,"Siemens"],[f,k]],[/\b(rct\w+) b/i],[h,[_,"RCA"],[f,A]],[/\b(venue[\d ]{2,7}) b/i],[h,[_,"Dell"],[f,A]],[/\b(q(?:mv|ta)\w+) b/i],[h,[_,"Verizon"],[f,A]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[h,[_,"Barnes & Noble"],[f,A]],[/\b(tm\d{3}\w+) b/i],[h,[_,"NuVision"],[f,A]],[/\b(k88) b/i],[h,[_,"ZTE"],[f,A]],[/\b(nx\d{3}j) b/i],[h,[_,"ZTE"],[f,k]],[/\b(gen\d{3}) b.+49h/i],[h,[_,"Swiss"],[f,k]],[/\b(zur\d{3}) b/i],[h,[_,"Swiss"],[f,A]],[/\b((zeki)?tb.*\b) b/i],[h,[_,"Zeki"],[f,A]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],h,[f,A]],[/\b(ns-?\w{0,9}) b/i],[h,[_,"Insignia"],[f,A]],[/\b((nxa|next)-?\w{0,9}) b/i],[h,[_,"NextBook"],[f,A]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],h,[f,k]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],h,[f,k]],[/\b(ph-1) /i],[h,[_,"Essential"],[f,k]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[h,[_,"Envizen"],[f,A]],[/\b(trio[-\w\. ]+) b/i],[h,[_,"MachSpeed"],[f,A]],[/\btu_(1491) b/i],[h,[_,"Rotor"],[f,A]],[/(shield[\w ]+) b/i],[h,[_,"Nvidia"],[f,A]],[/(sprint) (\w+)/i],[_,h,[f,k]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[_,Qm],[f,k]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[_,Di],[f,A]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[_,Di],[f,k]],[/smart-tv.+(samsung)/i],[_,[f,P]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[_,vf],[f,P]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,_p],[f,P]],[/(apple) ?tv/i],[_,[h,_t+" TV"],[f,P]],[/crkey/i],[[h,_s+"cast"],[_,_i],[f,P]],[/droid.+aft(\w)( bui|\))/i],[h,[_,z],[f,P]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[_,Fi],[f,P]],[/(bravia[\w ]+)( bui|\))/i],[h,[_,Gi],[f,P]],[/(mitv-\w{5}) bui/i],[h,[_,_d],[f,P]],[/Hbbtv.*(technisat) (.*);/i],[_,h,[f,P]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,O_],[h,O_],[f,P]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[f,P]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,h,[f,C]],[/droid.+; (shield) bui/i],[h,[_,"Nvidia"],[f,C]],[/(playstation [345portablevi]+)/i],[h,[_,Gi],[f,C]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[_,Qm],[f,C]],[/((pebble))app/i],[_,h,[f,x]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[_,_t],[f,x]],[/droid.+; (glass) \d/i],[h,[_,_i],[f,x]],[/droid.+; (wt63?0{2,3})\)/i],[h,[_,Di],[f,x]],[/(quest( 2| pro)?)/i],[h,[_,H],[f,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[f,j]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[h,[f,k]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[h,[f,A]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[f,A]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[f,k]],[/(android[-\w\. ]{0,9});.+buil/i],[h,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[p,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[p,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,g],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[p,[g,kT,aO]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,"Windows"],[g,kT,aO]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,_e],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[g,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,g],[/\(bb(10);/i],[g,[p,_n]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[p,kc+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[g,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[g,[p,_s+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,Wt],g],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,g],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[p,g]]},rS=function(bE,dE){if(typeof bE===s&&(dE=bE,bE=r),!(this instanceof rS))return new rS(bE,dE).getResult();var gE=typeof e!==o&&e.navigator?e.navigator:r,r_=bE||(gE&&gE.userAgent?gE.userAgent:""),y0=gE&&gE.userAgentData?gE.userAgentData:r,a_=dE?function(LE,z0){var iI={};for(var PT in LE)z0[PT]&&z0[PT].length%2==0?iI[PT]=z0[PT].concat(LE[PT]):iI[PT]=LE[PT];return iI}(Mb,dE):Mb;return this.getBrowser=function(){var LE={};return LE[p]=r,LE[g]=r,A0.call(LE,r_,a_.browser),LE[d]=function(z0){return typeof z0===l?z0.replace(/[^\d\.]/g,"").split(".")[0]:r}(LE[g]),gE&&gE.brave&&typeof gE.brave.isBrave==i&&(LE[p]="Brave"),LE},this.getCPU=function(){var LE={};return LE[b]=r,A0.call(LE,r_,a_.cpu),LE},this.getDevice=function(){var LE={};return LE[_]=r,LE[h]=r,LE[f]=r,A0.call(LE,r_,a_.device),!LE[f]&&y0&&y0.mobile&&(LE[f]=k),LE[h]=="Macintosh"&&gE&&typeof gE.standalone!==o&&gE.maxTouchPoints&&gE.maxTouchPoints>2&&(LE[h]="iPad",LE[f]=A),LE},this.getEngine=function(){var LE={};return LE[p]=r,LE[g]=r,A0.call(LE,r_,a_.engine),LE},this.getOS=function(){var LE={};return LE[p]=r,LE[g]=r,A0.call(LE,r_,a_.os),!LE[p]&&y0&&y0.platform!="Unknown"&&(LE[p]=y0.platform.replace(/chrome os/i,Wt).replace(/macos/i,_e)),LE},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r_},this.setUA=function(LE){return r_=typeof LE===l&&LE.length>350?O_(LE,350):LE,this},this.setUA(r_),this};rS.VERSION="0.7.34",rS.BROWSER=_f([p,g,d]),rS.CPU=_f([b]),rS.DEVICE=_f([h,_,f,C,k,P,A,x,j]),rS.ENGINE=rS.OS=_f([p,g]),jG.exports&&(VG=jG.exports=rS),VG.UAParser=rS;var K_=typeof e!==o&&(e.jQuery||e.Zepto);if(K_&&!K_.ua){var UE=new rS;K_.ua=UE.getResult(),K_.ua.get=function(){return UE.getUA()},K_.ua.set=function(bE){UE.setUA(bE);var dE=UE.getResult();for(var gE in dE)K_.ua[gE]=dE[gE]}}}(typeof window=="object"?window:y1);var qgt=m_($5.exports),Wgt=OR,Hgt=m0,Kgt=W1,zgt=iN,Ygt=C_("iterator"),Jgt=Object,Xgt=function(e){if(Kgt(e))return!1;var r=Jgt(e);return r[Ygt]!==void 0||"@@iterator"in r||Hgt(zgt,Wgt(r))},Qgt=m_(Xgt),BG=V_;zE({global:!0,forced:BG.globalThis!==BG},{globalThis:BG});var ZJ=m_(V_),$J=eV.clear;zE({global:!0,bind:!0,enumerable:!0,forced:V_.clearImmediate!==$J},{clearImmediate:$J});var Zgt=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",Bit=V_,$gt=F3,tvt=t0,evt=Zgt,nvt=eO,rvt=tV,ivt=X1,ovt=Bit.Function,svt=/MSIE .\./.test(nvt)||evt&&function(){var e=Bit.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),avt=zE,Git=V_,tX=eV.set,cvt=function(e,r){var i=r?2:1;return svt?function(o,s){var l=ivt(arguments.length,1)>i,d=tvt(o)?o:ovt(o),h=l?rvt(arguments,i):[],p=l?function(){$gt(d,this,h)}:d;return r?e(p,s):e(p)}:e},eX=Git.setImmediate?cvt(tX,!1):tX;avt({global:!0,bind:!0,enumerable:!0,forced:Git.setImmediate!==eX},{setImmediate:eX});var nX=m_(ZS.setImmediate),uvt=zE,lvt=Grt,dvt=$S,hvt=X1,pvt=J1,fvt=V_.process;uvt({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(e){hvt(arguments.length,1),dvt(e);var r=pvt&&fvt.domain;lvt(r?r.bind(e):e)}});var rX=m_(ZS.queueMicrotask);function qit(e,r){return function(){return e.apply(r,arguments)}}var{toString:mvt}=Object.prototype,{getPrototypeOf:LW}=Object,JU=(GG=Object.create(null),e=>{let r=mvt.call(e);return GG[r]||(GG[r]=r.slice(8,-1).toLowerCase())}),GG,ZT=e=>(e=e.toLowerCase(),r=>JU(r)===e),iV=e=>r=>typeof r===e,{isArray:o1}=Array,DD=iV("undefined"),iX=ZT("ArrayBuffer"),Evt=iV("string"),BS=iV("function"),oX=iV("number"),kM=e=>e!==null&&typeof e=="object",PM=e=>{if(JU(e)!=="object")return!1;let r=LW(e);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in e||Qgt(e))},_vt=ZT("Date"),gvt=ZT("File"),vvt=ZT("Blob"),yvt=ZT("FileList"),Svt=ZT("URLSearchParams"),[Tvt,bvt,Rvt,wvt]=["ReadableStream","Request","Response","Headers"].map(ZT);function LD(e,r){let i,o,{allOwnKeys:s=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),o1(e))for(i=0,o=e.length;i<o;i++)r.call(null,e[i],i,e);else{let l=s?Object.getOwnPropertyNames(e):Object.keys(e),d=l.length,h;for(i=0;i<d;i++)h=l[i],r.call(null,e[h],h,e)}}function sX(e,r){r=r.toLowerCase();let i=Object.keys(e),o,s=i.length;for(;s-- >0;)if(o=i[s],r===o.toLowerCase())return o;return null}var VO=ZJ!==void 0?ZJ:typeof self<"u"?self:typeof window<"u"?window:global,aX=e=>!DD(e)&&e!==VO,Ivt=(qG=typeof Uint8Array<"u"&&LW(Uint8Array),e=>qG&&e instanceof qG),qG,Cvt=ZT("HTMLFormElement"),cX=(e=>{let{hasOwnProperty:r}=e;return(i,o)=>r.call(i,o)})(Object.prototype),Avt=ZT("RegExp"),uX=(e,r)=>{let i=Object.getOwnPropertyDescriptors(e),o={};LD(i,(s,l)=>{let d;(d=r(s,l,e))!==!1&&(o[l]=d||s)}),Object.defineProperties(e,o)},WG="abcdefghijklmnopqrstuvwxyz",lX="0123456789",dX={DIGIT:lX,ALPHA:WG,ALPHA_DIGIT:WG+WG.toUpperCase()+lX},Ovt=ZT("AsyncFunction"),Wit=(hX=typeof nX=="function",pX=BS(VO.postMessage),hX?nX:pX?(HG="axios@".concat(Math.random()),DM=[],VO.addEventListener("message",e=>{let{source:r,data:i}=e;r===VO&&i===HG&&DM.length&&DM.shift()()},!1),e=>{DM.push(e),VO.postMessage(HG,"*")}):e=>setTimeout(e)),hX,pX,HG,DM,Nvt=rX!==void 0?rX.bind(VO):typeof process<"u"&&process.nextTick||Wit,tE={isArray:o1,isArrayBuffer:iX,isBuffer:function(e){return e!==null&&!DD(e)&&e.constructor!==null&&!DD(e.constructor)&&BS(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||BS(e.append)&&((r=JU(e))==="formdata"||r==="object"&&BS(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&iX(e.buffer),r},isString:Evt,isNumber:oX,isBoolean:e=>e===!0||e===!1,isObject:kM,isPlainObject:PM,isReadableStream:Tvt,isRequest:bvt,isResponse:Rvt,isHeaders:wvt,isUndefined:DD,isDate:_vt,isFile:gvt,isBlob:vvt,isRegExp:Avt,isFunction:BS,isStream:e=>kM(e)&&BS(e.pipe),isURLSearchParams:Svt,isTypedArray:Ivt,isFileList:yvt,forEach:LD,merge:function e(){let{caseless:r}=aX(this)&&this||{},i={},o=(s,l)=>{let d=r&&sX(i,l)||l;PM(i[d])&&PM(s)?i[d]=e(i[d],s):PM(s)?i[d]=e({},s):o1(s)?i[d]=s.slice():i[d]=s};for(let s=0,l=arguments.length;s<l;s++)arguments[s]&&LD(arguments[s],o);return i},extend:function(e,r,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return LD(r,(s,l)=>{i&&BS(s)?e[l]=qit(s,i):e[l]=s},{allOwnKeys:o}),e},trim:e=>C0(e)?C0(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,r,i,o)=>{e.prototype=Object.create(r.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,r,i,o)=>{let s,l,d,h={};if(r=r||{},e==null)return r;do{for(s=Object.getOwnPropertyNames(e),l=s.length;l-- >0;)d=s[l],o&&!o(d,e,r)||h[d]||(r[d]=e[d],h[d]=!0);e=i!==!1&&LW(e)}while(e&&(!i||i(e,r))&&e!==Object.prototype);return r},kindOf:JU,kindOfTest:ZT,endsWith:(e,r,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=r.length;let o=e.indexOf(r,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(o1(e))return e;let r=e.length;if(!oX(r))return null;let i=new Array(r);for(;r-- >0;)i[r]=e[r];return i},forEachEntry:(e,r)=>{let i=(e&&e[Symbol.iterator]).call(e),o;for(;(o=i.next())&&!o.done;){let s=o.value;r.call(e,s[0],s[1])}},matchAll:(e,r)=>{let i,o=[];for(;(i=e.exec(r))!==null;)o.push(i);return o},isHTMLForm:Cvt,hasOwnProperty:cX,hasOwnProp:cX,reduceDescriptors:uX,freezeMethods:e=>{uX(e,(r,i)=>{if(BS(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;let o=e[i];BS(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,r)=>{let i={},o=s=>{s.forEach(l=>{i[l]=!0})};return o1(e)?o(e):o(String(e).split(r)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,r)=>e!=null&&Number.isFinite(e=+e)?e:r,findKey:sX,global:VO,isContextDefined:aX,ALPHABET:dX,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:dX.ALPHA_DIGIT,i="",{length:o}=r;for(;e--;)i+=r[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&BS(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{let r=new Array(10),i=(o,s)=>{if(kM(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[s]=o;let l=o1(o)?[]:{};return LD(o,(d,h)=>{let p=i(d,s+1);!DD(p)&&(l[h]=p)}),r[s]=void 0,l}}return o};return i(e,0)},isAsyncFn:Ovt,isThenable:e=>e&&(kM(e)||BS(e))&&BS(e.then)&&BS(e.catch),setImmediate:Wit,asap:Nvt};function KE(e,r,i,o,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),o&&(this.request=o),s&&(this.response=s,this.status=s.status?s.status:null)}tE.inherits(KE,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:tE.toJSONObject(this.config),code:this.code,status:this.status}}});var fX=KE.prototype,mX={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{mX[e]={value:e}}),Object.defineProperties(KE,mX),Object.defineProperty(fX,"isAxiosError",{value:!0}),KE.from=(e,r,i,o,s,l)=>{let d=Object.create(fX);return tE.toFlatObject(e,d,function(h){return h!==Error.prototype},h=>h!=="isAxiosError"),KE.call(d,e.message,r,i,o,s),d.cause=e,d.name=e.name,l&&Object.assign(d,l),d};function KG(e){return tE.isPlainObject(e)||tE.isArray(e)}function Hit(e){return tE.endsWith(e,"[]")?e.slice(0,-2):e}function EX(e,r,i){return e?e.concat(r).map(function(o,s){return o=Hit(o),!i&&s?"["+o+"]":o}).join(i?".":""):r}var kvt=tE.toFlatObject(tE,{},null,function(e){return/^is[A-Z]/.test(e)});function XU(e,r,i){if(!tE.isObject(e))throw new TypeError("target must be an object");r=r||new FormData;let o=(i=tE.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,C){return!tE.isUndefined(C[b])})).metaTokens,s=i.visitor||f,l=i.dots,d=i.indexes,h=(i.Blob||typeof Blob<"u"&&Blob)&&tE.isSpecCompliantForm(r);if(!tE.isFunction(s))throw new TypeError("visitor must be a function");function p(b){if(b===null)return"";if(tE.isDate(b))return b.toISOString();if(!h&&tE.isBlob(b))throw new KE("Blob is not supported. Use a Buffer instead.");return tE.isArrayBuffer(b)||tE.isTypedArray(b)?h&&typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function f(b,C,k){let A=b;if(b&&!k&&typeof b=="object"){if(tE.endsWith(C,"{}"))C=o?C:C.slice(0,-2),b=JSON.stringify(b);else if(tE.isArray(b)&&function(P){return tE.isArray(P)&&!P.some(KG)}(b)||(tE.isFileList(b)||tE.endsWith(C,"[]"))&&(A=tE.toArray(b)))return C=Hit(C),A.forEach(function(P,x){!tE.isUndefined(P)&&P!==null&&r.append(d===!0?EX([C],x,l):d===null?C:C+"[]",p(P))}),!1}return!!KG(b)||(r.append(EX(k,C,l),p(b)),!1)}let _=[],g=Object.assign(kvt,{defaultVisitor:f,convertValue:p,isVisitable:KG});if(!tE.isObject(e))throw new TypeError("data must be an object");return function b(C,k){if(!tE.isUndefined(C)){if(_.indexOf(C)!==-1)throw Error("Circular reference detected in "+k.join("."));_.push(C),tE.forEach(C,function(A,P){(!(tE.isUndefined(A)||A===null)&&s.call(r,A,tE.isString(P)?C0(P).call(P):P,k,g))===!0&&b(A,k?k.concat(P):[P])}),_.pop()}}(e),r}function _X(e){let r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function MW(e,r){this._pairs=[],e&&XU(e,this,r)}var gX=MW.prototype;function Pvt(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Kit(e,r,i){if(!r)return e;let o=i&&i.encode||Pvt,s=i&&i.serialize,l;if(l=s?s(r,i):tE.isURLSearchParams(r)?r.toString():new MW(r,i).toString(o),l){let d=e.indexOf("#");d!==-1&&(e=e.slice(0,d)),e+=(e.indexOf("?")===-1?"?":"&")+l}return e}gX.append=function(e,r){this._pairs.push([e,r])},gX.toString=function(e){let r=e?function(i){return e.call(this,i,_X)}:_X;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var vX=class{constructor(){this.handlers=[]}use(e,r,i){return this.handlers.push({fulfilled:e,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){tE.forEach(this.handlers,function(r){r!==null&&e(r)})}},zit={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Yit={exports:{}},Dvt=zE,Lvt=QS,yX=IT.f;Dvt({target:"Object",stat:!0,forced:Object.defineProperty!==yX,sham:!Lvt},{defineProperty:yX});var Jit=ZS.Object,Mvt=Yit.exports=function(e,r,i){return Jit.defineProperty(e,r,i)};Jit.defineProperty.sham&&(Mvt.sham=!0);var Xit=m_(Yit.exports),Uvt=CR,KL=Array.isArray||function(e){return Uvt(e)=="Array"},xvt=TypeError,SX=KL,jvt=$3,Vvt=PS,Fvt=C_("species"),TX=Array,Bvt=function(e){var r;return SX(e)&&(r=e.constructor,(jvt(r)&&(r===TX||SX(r.prototype))||Vvt(r)&&(r=r[Fvt])===null)&&(r=void 0)),r===void 0?TX:r},Qit=function(e,r){return new(Bvt(e))(r===0?0:r)},Gvt=M_,qvt=QO,Wvt=C_("species"),Zit=function(e){return qvt>=51||!Gvt(function(){var r=[];return(r.constructor={})[Wvt]=function(){return{foo:1}},r[e](Boolean).foo!==1})},Hvt=zE,Kvt=M_,zvt=KL,Yvt=PS,Jvt=AR,Xvt=rI,bX=function(e){if(e>9007199254740991)throw xvt("Maximum allowed index exceeded");return e},RX=rV,Qvt=Qit,Zvt=Zit,$vt=QO,$it=C_("isConcatSpreadable"),tyt=$vt>=51||!Kvt(function(){var e=[];return e[$it]=!1,e.concat()[0]!==e}),eyt=function(e){if(!Yvt(e))return!1;var r=e[$it];return r!==void 0?!!r:zvt(e)};Hvt({target:"Array",proto:!0,arity:1,forced:!tyt||!Zvt("concat")},{concat:function(e){var r,i,o,s,l,d=Jvt(this),h=Qvt(d,0),p=0;for(r=-1,o=arguments.length;r<o;r++)if(eyt(l=r===-1?d:arguments[r]))for(s=Xvt(l),bX(p+s),i=0;i<s;i++,p++)i in l&&RX(h,p,l[i]);else bX(p+1),RX(h,p++,l);return h.length=p,h}});var tot={},nyt=CR,ryt=tO,wX=Y3.f,iyt=PW,IX=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];tot.f=function(e){return IX&&nyt(e)=="Window"?function(r){try{return wX(r)}catch{return iyt(IX)}}(e):wX(ryt(e))};var Z1={},oyt=C_;Z1.f=oyt;var CX=ZS,syt=m0,ayt=Z1,cyt=IT.f,o0=function(e){var r=CX.Symbol||(CX.Symbol={});syt(r,e)||cyt(r,e,{value:ayt.f(e)})},uyt=u0,lyt=fS,dyt=C_,hyt=iO,eot=function(){var e=lyt("Symbol"),r=e&&e.prototype,i=r&&r.valueOf,o=dyt("toPrimitive");r&&!r[o]&&hyt(r,o,function(s){return uyt(i,this)},{arity:1})},pyt=nO,fyt=q3,myt=AR,Eyt=rI,_yt=Qit,AX=k_([].push),AI=function(e){var r=e==1,i=e==2,o=e==3,s=e==4,l=e==6,d=e==7,h=e==5||l;return function(p,f,_,g){for(var b,C,k=myt(p),A=fyt(k),P=pyt(f,_),x=Eyt(A),j=0,z=g||_yt,_t=r?z(p,x):i||d?z(p,0):void 0;x>j;j++)if((h||j in A)&&(C=P(b=A[j],j,k),e))if(r)_t[j]=C;else if(C)switch(e){case 3:return!0;case 5:return b;case 6:return j;case 2:AX(_t,b)}else switch(e){case 4:return!1;case 7:AX(_t,b)}return l?-1:o||s?s:_t}},not={forEach:AI(0),map:AI(1),filter:AI(2),some:AI(3),every:AI(4),find:AI(5),findIndex:AI(6),filterReject:AI(7)},LM=zE,UW=V_,xW=u0,gyt=k_,b1=QS,HN=K1,vyt=M_,M0=m0,yyt=j0,_q=nS,oV=tO,jW=H3,Syt=tT,t8=_A,hL=BL,rot=X3,Tyt=Y3,iot=tot,byt=FL,oot=xL,sot=IT,Ryt=yW,aot=G3,OX=iO,wyt=Z3,VW=Y1,cot=J3,NX=dW,Iyt=C_,Cyt=Z1,Ayt=o0,Oyt=eot,Nyt=oO,uot=oN,sV=not.forEach,wS=z3("hidden"),QU="Symbol",pL="prototype",kyt=uot.set,kX=uot.getterFor(QU),JT=Object[pL],h1=UW.Symbol,CU=h1&&h1[pL],Pyt=UW.TypeError,zG=UW.QObject,lot=oot.f,LO=sot.f,dot=iot.f,Dyt=aot.f,hot=gyt([].push),nI=VW("symbols"),zL=VW("op-symbols"),Lyt=VW("wks"),YG=!zG||!zG[pL]||!zG[pL].findChild,e8=b1&&vyt(function(){return hL(LO({},"a",{get:function(){return LO(this,"a",{value:7}).a}})).a!=7})?function(e,r,i){var o=lot(JT,r);o&&delete JT[r],LO(e,r,i),o&&e!==JT&&LO(JT,r,o)}:LO,JG=function(e,r){var i=nI[e]=hL(CU);return kyt(i,{type:QU,tag:e,description:r}),b1||(i.description=r),i},ZU=function(e,r,i){e===JT&&ZU(zL,r,i),_q(e);var o=jW(r);return _q(i),M0(nI,o)?(i.enumerable?(M0(e,wS)&&e[wS][o]&&(e[wS][o]=!1),i=hL(i,{enumerable:t8(0,!1)})):(M0(e,wS)||LO(e,wS,t8(1,{})),e[wS][o]=!0),e8(e,o,i)):LO(e,o,i)},XG=function(e,r){_q(e);var i=oV(r),o=rot(i).concat(fot(i));return sV(o,function(s){b1&&!xW(pot,i,s)||ZU(e,s,i[s])}),e},pot=function(e){var r=jW(e),i=xW(Dyt,this,r);return!(this===JT&&M0(nI,r)&&!M0(zL,r))&&(!(i||!M0(this,r)||!M0(nI,r)||M0(this,wS)&&this[wS][r])||i)},PX=function(e,r){var i=oV(e),o=jW(r);if(i!==JT||!M0(nI,o)||M0(zL,o)){var s=lot(i,o);return!s||!M0(nI,o)||M0(i,wS)&&i[wS][o]||(s.enumerable=!0),s}},DX=function(e){var r=dot(oV(e)),i=[];return sV(r,function(o){M0(nI,o)||M0(cot,o)||hot(i,o)}),i},fot=function(e){var r=e===JT,i=dot(r?zL:oV(e)),o=[];return sV(i,function(s){!M0(nI,s)||r&&!M0(JT,s)||hot(o,nI[s])}),o};HN||(OX(CU=(h1=function(){if(yyt(CU,this))throw Pyt("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Syt(arguments[0]):void 0,r=NX(e),i=function(o){this===JT&&xW(i,zL,o),M0(this,wS)&&M0(this[wS],r)&&(this[wS][r]=!1),e8(this,r,t8(1,o))};return b1&&YG&&e8(JT,r,{configurable:!0,set:i}),JG(r,e)})[pL],"toString",function(){return kX(this).tag}),OX(h1,"withoutSetter",function(e){return JG(NX(e),e)}),aot.f=pot,sot.f=ZU,Ryt.f=XG,oot.f=PX,Tyt.f=iot.f=DX,byt.f=fot,Cyt.f=function(e){return JG(Iyt(e),e)},b1&&wyt(CU,"description",{configurable:!0,get:function(){return kX(this).description}})),LM({global:!0,constructor:!0,wrap:!0,forced:!HN,sham:!HN},{Symbol:h1}),sV(rot(Lyt),function(e){Ayt(e)}),LM({target:QU,stat:!0,forced:!HN},{useSetter:function(){YG=!0},useSimple:function(){YG=!1}}),LM({target:"Object",stat:!0,forced:!HN,sham:!b1},{create:function(e,r){return r===void 0?hL(e):XG(hL(e),r)},defineProperty:ZU,defineProperties:XG,getOwnPropertyDescriptor:PX}),LM({target:"Object",stat:!0,forced:!HN},{getOwnPropertyNames:DX}),Oyt(),Nyt(h1,QU),cot[wS]=!0;var mot=K1&&!!Symbol.for&&!!Symbol.keyFor,Myt=zE,Uyt=fS,xyt=m0,jyt=tT,Eot=Y1,Vyt=mot,QG=Eot("string-to-symbol-registry"),Fyt=Eot("symbol-to-string-registry");Myt({target:"Symbol",stat:!0,forced:!Vyt},{for:function(e){var r=jyt(e);if(xyt(QG,r))return QG[r];var i=Uyt("Symbol")(r);return QG[r]=i,Fyt[i]=r,i}});var Byt=zE,Gyt=m0,qyt=jL,Wyt=z1,Hyt=mot,LX=Y1("symbol-to-string-registry");Byt({target:"Symbol",stat:!0,forced:!Hyt},{keyFor:function(e){if(!qyt(e))throw TypeError(Wyt(e)+" is not a symbol");if(Gyt(LX,e))return LX[e]}});var MX=KL,Kyt=t0,UX=CR,zyt=tT,xX=k_([].push),Yyt=zE,_ot=fS,got=F3,Jyt=u0,YL=k_,vot=M_,jX=t0,VX=jL,yot=tV,Xyt=function(e){if(Kyt(e))return e;if(MX(e)){for(var r=e.length,i=[],o=0;o<r;o++){var s=e[o];typeof s=="string"?xX(i,s):typeof s!="number"&&UX(s)!="Number"&&UX(s)!="String"||xX(i,zyt(s))}var l=i.length,d=!0;return function(h,p){if(d)return d=!1,p;if(MX(this))return p;for(var f=0;f<l;f++)if(i[f]===h)return p}}},Qyt=K1,Zyt=String,KI=_ot("JSON","stringify"),MM=YL(/./.exec),FX=YL("".charAt),$yt=YL("".charCodeAt),t0t=YL("".replace),e0t=YL(1 .toString),n0t=/[\uD800-\uDFFF]/g,BX=/^[\uD800-\uDBFF]$/,GX=/^[\uDC00-\uDFFF]$/,qX=!Qyt||vot(function(){var e=_ot("Symbol")();return KI([e])!="[null]"||KI({a:e})!="{}"||KI(Object(e))!="{}"}),WX=vot(function(){return KI("\uDF06\uD834")!=='"\\udf06\\ud834"'||KI("\uDEAD")!=='"\\udead"'}),r0t=function(e,r){var i=yot(arguments),o=Xyt(r);if(jX(o)||e!==void 0&&!VX(e))return i[1]=function(s,l){if(jX(o)&&(l=Jyt(o,this,Zyt(s),l)),!VX(l))return l},got(KI,null,i)},i0t=function(e,r,i){var o=FX(i,r-1),s=FX(i,r+1);return MM(BX,e)&&!MM(GX,s)||MM(GX,e)&&!MM(BX,o)?"\\u"+e0t($yt(e,0),16):e};KI&&Yyt({target:"JSON",stat:!0,arity:3,forced:qX||WX},{stringify:function(e,r,i){var o=yot(arguments),s=got(qX?r0t:KI,null,o);return WX&&typeof s=="string"?t0t(s,n0t,i0t):s}});var HX=FL,o0t=AR;zE({target:"Object",stat:!0,forced:!K1||M_(function(){HX.f(1)})},{getOwnPropertySymbols:function(e){var r=HX.f;return r?r(o0t(e)):[]}}),o0("asyncIterator"),o0("hasInstance"),o0("isConcatSpreadable"),o0("iterator"),o0("match"),o0("matchAll"),o0("replace"),o0("search"),o0("species"),o0("split");var s0t=eot;o0("toPrimitive"),s0t();var a0t=fS,c0t=oO;o0("toStringTag"),c0t(a0t("Symbol"),"Symbol"),o0("unscopables"),oO(V_.JSON,"JSON",!0);var u0t=ZS.Symbol,l0t=C_,d0t=IT.f,KX=l0t("metadata"),zX=Function.prototype;zX[KX]===void 0&&d0t(zX,KX,{value:null}),o0("dispose"),o0("metadata");var h0t=u0t;o0("asyncDispose");var p0t=k_,FW=fS("Symbol"),f0t=FW.keyFor,m0t=p0t(FW.prototype.valueOf),Sot=FW.isRegisteredSymbol||function(e){try{return f0t(m0t(e))!==void 0}catch{return!1}};zE({target:"Symbol",stat:!0},{isRegisteredSymbol:Sot});for(YX=Y1,ZG=fS,JX=k_,XX=jL,QX=C_,_D=ZG("Symbol"),n8=_D.isWellKnownSymbol,r8=ZG("Object","getOwnPropertyNames"),Tot=JX(_D.prototype.valueOf),i8=YX("wks"),UM=0,$G=r8(_D),ZX=$G.length;UM<ZX;UM++)try{t6=$G[UM],XX(_D[t6])&&QX(t6)}catch{}var t6,YX,ZG,JX,XX,QX,_D,n8,r8,Tot,i8,UM,$G,ZX,$X=function(e){if(n8&&n8(e))return!0;try{for(var r=Tot(e),i=0,o=r8(i8),s=o.length;i<s;i++)if(i8[o[i]]==r)return!0}catch{}return!1};zE({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:$X}),o0("matcher"),o0("observable"),zE({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Sot}),zE({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:$X}),o0("metadataKey"),o0("patternMatch"),o0("replaceAll");var p1=m_(h0t),bot=m_(Z1.f("iterator"));function QD(e){return QD=typeof p1=="function"&&typeof bot=="symbol"?function(r){return typeof r}:function(r){return r&&typeof p1=="function"&&r.constructor===p1&&r!==p1.prototype?"symbol":typeof r},QD(e)}var E0t=m_(Z1.f("toPrimitive"));function _0t(e){var r=function(i,o){if(QD(i)!=="object"||i===null)return i;var s=i[E0t];if(s!==void 0){var l=s.call(i,o||"default");if(QD(l)!=="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return QD(r)==="symbol"?r:String(r)}function $(e,r,i){return(r=_0t(r))in e?Xit(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}var g0t=M_,v0t=C_("iterator"),BW=!g0t(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),r=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",r.forEach(function(s,l){r.delete("b"),o+=l+s}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!r.size&&!0||!r.sort||e.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[v0t]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://\u0442\u0435\u0441\u0442").host!=="xn--e1aybc"||new URL("http://a#\u0431").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),y0t=iO,e6=zE,P1=V_,xM=u0,wR=k_,f1=QS,tQ=BW,eQ=iO,S0t=Z3,T0t=function(e,r,i){for(var o in r)i&&i.unsafe&&e[o]?e[o]=r[o]:y0t(e,o,r[o],i);return e},b0t=oO,R0t=TW,GW=oN,Rot=RW,n6=t0,w0t=m0,I0t=nO,C0t=OR,A0t=nS,wot=PS,lS=tT,O0t=BL,nQ=_A,o8=SW,N0t=Q3,KN=X1,k0t=Vit,P0t=C_("iterator"),fL="URLSearchParams",Iot=fL+"Iterator",Cot=GW.set,_T=GW.getterFor(fL),D0t=GW.getterFor(Iot),L0t=Object.getOwnPropertyDescriptor,qW=function(e){if(!f1)return P1[e];var r=L0t(P1,e);return r&&r.value},rQ=qW("fetch"),$U=qW("Request"),ZD=qW("Headers"),r6=$U&&$U.prototype,iQ=ZD&&ZD.prototype,M0t=P1.RegExp,U0t=P1.TypeError,Aot=P1.decodeURIComponent,x0t=P1.encodeURIComponent,j0t=wR("".charAt),oQ=wR([].join),FO=wR([].push),s8=wR("".replace),V0t=wR([].shift),sQ=wR([].splice),aQ=wR("".split),F0t=wR("".slice),B0t=/\+/g,cQ=Array(4),G0t=function(e){return cQ[e-1]||(cQ[e-1]=M0t("((?:%[\\da-f]{2}){"+e+"})","gi"))},q0t=function(e){try{return Aot(e)}catch{return e}},uQ=function(e){var r=s8(e,B0t," "),i=4;try{return Aot(r)}catch{for(;i;)r=s8(r,G0t(i--),q0t);return r}},W0t=/[!'()~]|%20/g,H0t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},K0t=function(e){return H0t[e]},lQ=function(e){return s8(x0t(e),W0t,K0t)},i6=R0t(function(e,r){Cot(this,{type:Iot,iterator:o8(_T(e).entries),kind:r})},"Iterator",function(){var e=D0t(this),r=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),i},!0),Oot=function(e){this.entries=[],this.url=null,e!==void 0&&(wot(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?j0t(e,0)==="?"?F0t(e,1):e:lS(e)))};Oot.prototype={type:fL,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var r,i,o,s,l,d,h,p=N0t(e);if(p)for(i=(r=o8(e,p)).next;!(o=xM(i,r)).done;){if(l=(s=o8(A0t(o.value))).next,(d=xM(l,s)).done||(h=xM(l,s)).done||!xM(l,s).done)throw U0t("Expected sequence with length 2");FO(this.entries,{key:lS(d.value),value:lS(h.value)})}else for(var f in e)w0t(e,f)&&FO(this.entries,{key:f,value:lS(e[f])})},parseQuery:function(e){if(e)for(var r,i,o=aQ(e,"&"),s=0;s<o.length;)(r=o[s++]).length&&(i=aQ(r,"="),FO(this.entries,{key:uQ(V0t(i)),value:uQ(oQ(i,"="))}))},serialize:function(){for(var e,r=this.entries,i=[],o=0;o<r.length;)e=r[o++],FO(i,lQ(e.key)+"="+lQ(e.value));return oQ(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var _x=function(){Rot(this,s1);var e=Cot(this,new Oot(arguments.length>0?arguments[0]:void 0));f1||(this.size=e.entries.length)},s1=_x.prototype;T0t(s1,{append:function(e,r){var i=_T(this);KN(arguments.length,2),FO(i.entries,{key:lS(e),value:lS(r)}),f1||this.length++,i.updateURL()},delete:function(e){for(var r=_T(this),i=KN(arguments.length,1),o=r.entries,s=lS(e),l=i<2?void 0:arguments[1],d=l===void 0?l:lS(l),h=0;h<o.length;){var p=o[h];if(p.key!==s||d!==void 0&&p.value!==d)h++;else if(sQ(o,h,1),d!==void 0)break}f1||(this.size=o.length),r.updateURL()},get:function(e){var r=_T(this).entries;KN(arguments.length,1);for(var i=lS(e),o=0;o<r.length;o++)if(r[o].key===i)return r[o].value;return null},getAll:function(e){var r=_T(this).entries;KN(arguments.length,1);for(var i=lS(e),o=[],s=0;s<r.length;s++)r[s].key===i&&FO(o,r[s].value);return o},has:function(e){for(var r=_T(this).entries,i=KN(arguments.length,1),o=lS(e),s=i<2?void 0:arguments[1],l=s===void 0?s:lS(s),d=0;d<r.length;){var h=r[d++];if(h.key===o&&(l===void 0||h.value===l))return!0}return!1},set:function(e,r){var i=_T(this);KN(arguments.length,1);for(var o,s=i.entries,l=!1,d=lS(e),h=lS(r),p=0;p<s.length;p++)(o=s[p]).key===d&&(l?sQ(s,p--,1):(l=!0,o.value=h));l||FO(s,{key:d,value:h}),f1||(this.size=s.length),i.updateURL()},sort:function(){var e=_T(this);k0t(e.entries,function(r,i){return r.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var r,i=_T(this).entries,o=I0t(e,arguments.length>1?arguments[1]:void 0),s=0;s<i.length;)o((r=i[s++]).value,r.key,this)},keys:function(){return new i6(this,"keys")},values:function(){return new i6(this,"values")},entries:function(){return new i6(this,"entries")}},{enumerable:!0}),eQ(s1,P0t,s1.entries,{name:"entries"}),eQ(s1,"toString",function(){return _T(this).serialize()},{enumerable:!0}),f1&&S0t(s1,"size",{get:function(){return _T(this).entries.length},configurable:!0,enumerable:!0}),b0t(_x,fL),e6({global:!0,constructor:!0,forced:!tQ},{URLSearchParams:_x}),!tQ&&n6(ZD)&&(dQ=wR(iQ.has),hQ=wR(iQ.set),o6=function(e){if(wot(e)){var r,i=e.body;if(C0t(i)===fL)return r=e.headers?new ZD(e.headers):new ZD,dQ(r,"content-type")||hQ(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),O0t(e,{body:nQ(0,lS(i)),headers:nQ(0,r)})}return e},n6(rQ)&&e6({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return rQ(e,arguments.length>1?o6(arguments[1]):{})}}),n6($U)&&(jM=function(e){return Rot(this,r6),new $U(e,arguments.length>1?o6(arguments[1]):{})},r6.constructor=jM,jM.prototype=r6,e6({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:jM})));var dQ,hQ,o6,jM,z0t={URLSearchParams:_x,getState:_T},pQ=m_(ZS.URLSearchParams),Y0t={isBrowser:!0,classes:{URLSearchParams:pQ!==void 0?pQ:MW,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},WW=typeof window<"u"&&typeof document<"u",a8=typeof navigator=="object"&&navigator||void 0,J0t=WW&&(!a8||["ReactNative","NativeScript","NS"].indexOf(a8.product)<0),X0t=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Q0t=WW&&window.location.href||"http://localhost";function fQ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function mQ(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?fQ(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fQ(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var OS=mQ(mQ({},Object.freeze({__proto__:null,hasBrowserEnv:WW,hasStandardBrowserEnv:J0t,hasStandardBrowserWebWorkerEnv:X0t,navigator:a8,origin:Q0t})),Y0t),Z0t=nS,$0t=u0,tSt=m0,eSt=j0,nSt=function(){var e=Z0t(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},EQ=RegExp.prototype,Not=function(e){var r=e.flags;return r!==void 0||"flags"in EQ||tSt(e,"flags")||!eSt(EQ,e)?r:$0t(nSt,e)},rSt=kW.charAt,_Q=u0,iSt=nS,oSt=t0,sSt=CR,aSt=/./.exec,cSt=TypeError,uSt=zE,gQ=u0,kot=lL,lSt=TW,VM=bW,vQ=H1,Pot=crt,mL=tT,dSt=nS,hSt=W1,pSt=CR,fSt=urt,Dot=Not,mSt=W3,ESt=M_,_St=IW,gSt=function(e,r,i){return r+(i?rSt(e,r).length:1)},vSt=function(e,r){var i=e.exec;if(oSt(i)){var o=_Q(i,e,r);return o!==null&&iSt(o),o}if(sSt(e)==="RegExp")return _Q(aSt,e,r);throw cSt("RegExp#exec called on incompatible receiver")},Lot=oN,ySt=C_("matchAll"),Mot="RegExp String",Uot=Mot+" Iterator",SSt=Lot.set,TSt=Lot.getterFor(Uot),bSt=TypeError,c8=kot("".indexOf),_j=kot("".matchAll),s6=!!_j&&!ESt(function(){_j("a",/./)}),RSt=lSt(function(e,r,i,o){SSt(this,{type:Uot,regexp:e,string:r,global:i,unicode:o,done:!1})},Mot,function(){var e=TSt(this);if(e.done)return VM(void 0,!0);var r=e.regexp,i=e.string,o=vSt(r,i);return o===null?(e.done=!0,VM(void 0,!0)):e.global?(mL(o[0])===""&&(r.lastIndex=gSt(i,Pot(r.lastIndex),e.unicode)),VM(o,!1)):(e.done=!0,VM(o,!1))}),yQ=function(e){var r,i,o,s=dSt(this),l=mL(e),d=_St(s,RegExp),h=mL(Dot(s));return r=new d(d===RegExp?s.source:s,h),i=!!~c8(h,"g"),o=!!~c8(h,"u"),r.lastIndex=Pot(s.lastIndex),new RSt(r,l,i,o)};uSt({target:"String",proto:!0,forced:s6},{matchAll:function(e){var r,i,o,s,l=vQ(this);if(hSt(e)){if(s6)return _j(l,e)}else{if(fSt(e)&&(r=mL(vQ(Dot(e))),!~c8(r,"g")))throw bSt("`.matchAll` does not allow non-global regexes");if(s6)return _j(l,e);if((o=mSt(e,ySt))===void 0&&pSt(e)=="RegExp"&&(o=yQ),o)return gQ(o,e,l)}return i=mL(l),s=new RegExp(e,"g"),gQ(yQ,s,i)}});var wSt=CT("String").matchAll,ISt=j0,CSt=wSt,a6=String.prototype,ASt=function(e){var r=e.matchAll;return typeof e=="string"||e===a6||ISt(a6,e)&&r===a6.matchAll?CSt:r},OSt=m_(ASt);function xot(e){function r(i,o,s,l){let d=i[l++];if(d==="__proto__")return!0;let h=Number.isFinite(+d),p=l>=i.length;return d=!d&&tE.isArray(s)?s.length:d,p?(tE.hasOwnProp(s,d)?s[d]=[s[d],o]:s[d]=o,!h):(s[d]&&tE.isObject(s[d])||(s[d]=[]),r(i,o,s[d],l)&&tE.isArray(s[d])&&(s[d]=function(f){let _={},g=Object.keys(f),b,C=g.length,k;for(b=0;b<C;b++)k=g[b],_[k]=f[k];return _}(s[d])),!h)}if(tE.isFormData(e)&&tE.isFunction(e.entries)){let i={};return tE.forEachEntry(e,(o,s)=>{r(function(l){return OSt(tE).call(tE,/\w+|\[(\w*)]/g,l).map(d=>d[0]==="[]"?"":d[1]||d[0])}(o),s,i,0)}),i}return null}var HW={transitional:zit,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){let i=r.getContentType()||"",o=i.indexOf("application/json")>-1,s=tE.isObject(e);if(s&&tE.isHTMLForm(e)&&(e=new FormData(e)),tE.isFormData(e))return o?JSON.stringify(xot(e)):e;if(tE.isArrayBuffer(e)||tE.isBuffer(e)||tE.isStream(e)||tE.isFile(e)||tE.isBlob(e)||tE.isReadableStream(e))return e;if(tE.isArrayBufferView(e))return e.buffer;if(tE.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(s){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(d,h){return XU(d,new OS.classes.URLSearchParams,Object.assign({visitor:function(p,f,_,g){return OS.isNode&&tE.isBuffer(p)?(this.append(f,p.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},h))}(e,this.formSerializer).toString();if((l=tE.isFileList(e))||i.indexOf("multipart/form-data")>-1){let d=this.env&&this.env.FormData;return XU(l?{"files[]":e}:e,d&&new d,this.formSerializer)}}return s||o?(r.setContentType("application/json",!1),function(d,h,p){if(tE.isString(d))try{return(h||JSON.parse)(d),C0(tE).call(tE,d)}catch(f){if(f.name!=="SyntaxError")throw f}return(p||JSON.stringify)(d)}(e)):e}],transformResponse:[function(e){let r=this.transitional||HW.transitional,i=r&&r.forcedJSONParsing,o=this.responseType==="json";if(tE.isResponse(e)||tE.isReadableStream(e))return e;if(e&&tE.isString(e)&&(i&&!this.responseType||o)){let s=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(l){if(s)throw l.name==="SyntaxError"?KE.from(l,KE.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:OS.classes.FormData,Blob:OS.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};tE.forEach(["delete","get","head","post","put","patch"],e=>{HW.headers[e]={}});var KW=HW,NSt=tE.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),SQ=Symbol("internals");function vD(e){var r;return e&&C0(r=String(e)).call(r).toLowerCase()}function AU(e){return e===!1||e==null?e:tE.isArray(e)?e.map(AU):String(e)}function c6(e,r,i,o,s){return tE.isFunction(o)?o.call(this,r,i):(s&&(r=i),tE.isString(r)?tE.isString(o)?r.indexOf(o)!==-1:tE.isRegExp(o)?o.test(r):void 0:void 0)}var R1=class{constructor(r){r&&this.set(r)}set(r,i,o){let s=this;function l(p,f,_){let g=vD(f);if(!g)throw new Error("header name must be a non-empty string");let b=tE.findKey(s,g);(!b||s[b]===void 0||_===!0||_===void 0&&s[b]!==!1)&&(s[b||f]=AU(p))}let d=(p,f)=>tE.forEach(p,(_,g)=>l(_,g,f));if(tE.isPlainObject(r)||r instanceof this.constructor)d(r,i);else if(tE.isString(r)&&(r=C0(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(C0(h=r).call(h)))d((p=>{let f={},_,g,b;return p&&p.split(`
`).forEach(function(C){var k,A;b=C.indexOf(":"),_=C0(k=C.substring(0,b)).call(k).toLowerCase(),g=C0(A=C.substring(b+1)).call(A),!_||f[_]&&NSt[_]||(_==="set-cookie"?f[_]?f[_].push(g):f[_]=[g]:f[_]=f[_]?f[_]+", "+g:g)}),f})(r),i);else if(tE.isHeaders(r))for(let[p,f]of r.entries())l(f,p,o);else r!=null&&l(i,r,o);var h;return this}get(r,i){if(r=vD(r)){let o=tE.findKey(this,r);if(o){let s=this[o];if(!i)return s;if(i===!0)return function(l){let d=Object.create(null),h=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,p;for(;p=h.exec(l);)d[p[1]]=p[2];return d}(s);if(tE.isFunction(i))return i.call(this,s,o);if(tE.isRegExp(i))return i.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,i){if(r=vD(r)){let o=tE.findKey(this,r);return!(!o||this[o]===void 0||i&&!c6(0,this[o],o,i))}return!1}delete(r,i){let o=this,s=!1;function l(d){if(d=vD(d)){let h=tE.findKey(o,d);!h||i&&!c6(0,o[h],h,i)||(delete o[h],s=!0)}}return tE.isArray(r)?r.forEach(l):l(r),s}clear(r){let i=Object.keys(this),o=i.length,s=!1;for(;o--;){let l=i[o];r&&!c6(0,this[l],l,r,!0)||(delete this[l],s=!0)}return s}normalize(r){let i=this,o={};return tE.forEach(this,(s,l)=>{var d;let h=tE.findKey(o,l);if(h)return i[h]=AU(s),void delete i[l];let p=r?function(f){return C0(f).call(f).toLowerCase().replace(/([a-z\d])(\w*)/g,(_,g,b)=>g.toUpperCase()+b)}(l):C0(d=String(l)).call(d);p!==l&&delete i[l],i[p]=AU(s),o[p]=!0}),this}concat(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(r){let i=Object.create(null);return tE.forEach(this,(o,s)=>{o!=null&&o!==!1&&(i[s]=r&&tE.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[i,o]=r;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){let i=new this(r);for(var o=arguments.length,s=new Array(o>1?o-1:0),l=1;l<o;l++)s[l-1]=arguments[l];return s.forEach(d=>i.set(d)),i}static accessor(r){let i=(this[SQ]=this[SQ]={accessors:{}}).accessors,o=this.prototype;function s(l){let d=vD(l);i[d]||(function(h,p){let f=tE.toCamelCase(" "+p);["get","set","has"].forEach(_=>{Object.defineProperty(h,_+f,{value:function(g,b,C){return this[_].call(this,p,g,b,C)},configurable:!0})})}(o,l),i[d]=!0)}return tE.isArray(r)?r.forEach(s):s(r),this}};R1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),tE.reduceDescriptors(R1.prototype,(e,r)=>{let{value:i}=e,o=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(s){this[o]=s}}}),tE.freezeMethods(R1);var XT=R1;function u6(e,r){let i=this||KW,o=r||i,s=XT.from(o.headers),l=o.data;return tE.forEach(e,function(d){l=d.call(i,l,s.normalize(),r?r.status:void 0)}),s.normalize(),l}function jot(e){return!(!e||!e.__CANCEL__)}function $1(e,r,i){KE.call(this,e??"canceled",KE.ERR_CANCELED,r,i),this.name="CanceledError"}function Vot(e,r,i){let o=i.config.validateStatus;i.status&&o&&!o(i.status)?r(new KE("Request failed with status code "+i.status,[KE.ERR_BAD_REQUEST,KE.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}tE.inherits($1,KE,{__CANCEL__:!0});var $j=function(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0,s=function(l,d){l=l||10;let h=new Array(l),p=new Array(l),f,_=0,g=0;return d=d!==void 0?d:1e3,function(b){let C=Date.now(),k=p[g];f||(f=C),h[_]=b,p[_]=C;let A=g,P=0;for(;A!==_;)P+=h[A++],A%=l;if(_=(_+1)%l,_===g&&(g=(g+1)%l),C-f<d)return;let x=k&&C-k;return x?Math.round(1e3*P/x):void 0}}(50,250);return function(l,d){let h,p,f=0,_=1e3/d,g=function(b){f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),h=null,p&&(clearTimeout(p),p=null),l.apply(null,b)};return[function(){let b=Date.now(),C=b-f;for(var k=arguments.length,A=new Array(k),P=0;P<k;P++)A[P]=arguments[P];C>=_?g(A,b):(h=A,p||(p=setTimeout(()=>{p=null,g(h)},_-C)))},()=>h&&g(h)]}(l=>{let d=l.loaded,h=l.lengthComputable?l.total:void 0,p=d-o,f=s(p);o=d,e({loaded:d,total:h,progress:h?d/h:void 0,bytes:p,rate:f||void 0,estimated:f&&h&&d<=h?(h-d)/f:void 0,event:l,lengthComputable:h!=null,[r?"download":"upload"]:!0})},i)},TQ=(e,r)=>{let i=e!=null;return[o=>r[0]({lengthComputable:i,total:e,loaded:o}),r[1]]},bQ=e=>function(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return tE.asap(()=>e(...i))},kSt=OS.hasStandardBrowserEnv?function(){let e=OS.navigator&&/(msie|trident)/i.test(OS.navigator.userAgent),r=document.createElement("a"),i;function o(s){let l=s;return e&&(r.setAttribute("href",l),l=r.href),r.setAttribute("href",l),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return i=o(window.location.href),function(s){let l=tE.isString(s)?o(s):s;return l.protocol===i.protocol&&l.host===i.host}}():function(){return!0},PSt=OS.hasStandardBrowserEnv?{write(e,r,i,o,s,l){let d=[e+"="+encodeURIComponent(r)];tE.isNumber(i)&&d.push("expires="+new Date(i).toGMTString()),tE.isString(o)&&d.push("path="+o),tE.isString(s)&&d.push("domain="+s),l===!0&&d.push("secure"),document.cookie=d.join("; ")},read(e){let r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Fot(e,r){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(r)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,r):r}function RQ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}var wQ=e=>e instanceof XT?function(r){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?RQ(Object(o),!0).forEach(function(s){$(r,s,o[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):RQ(Object(o)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(o,s))})}return r}({},e):e;function tN(e,r){r=r||{};let i={};function o(f,_,g){return tE.isPlainObject(f)&&tE.isPlainObject(_)?tE.merge.call({caseless:g},f,_):tE.isPlainObject(_)?tE.merge({},_):tE.isArray(_)?_.slice():_}function s(f,_,g){return tE.isUndefined(_)?tE.isUndefined(f)?void 0:o(void 0,f,g):o(f,_,g)}function l(f,_){if(!tE.isUndefined(_))return o(void 0,_)}function d(f,_){return tE.isUndefined(_)?tE.isUndefined(f)?void 0:o(void 0,f):o(void 0,_)}function h(f,_,g){return g in r?o(f,_):g in e?o(void 0,f):void 0}let p={url:l,method:l,data:l,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,withXSRFToken:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:h,headers:(f,_)=>s(wQ(f),wQ(_),!0)};return tE.forEach(Object.keys(Object.assign({},e,r)),function(f){let _=p[f]||s,g=_(e[f],r[f],f);tE.isUndefined(g)&&_!==h||(i[f]=g)}),i}var Bot=e=>{let r=tN({},e),i,{data:o,withXSRFToken:s,xsrfHeaderName:l,xsrfCookieName:d,headers:h,auth:p}=r;if(r.headers=h=XT.from(h),r.url=Kit(Fot(r.baseURL,r.url),e.params,e.paramsSerializer),p&&h.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):""))),tE.isFormData(o)){if(OS.hasStandardBrowserEnv||OS.hasStandardBrowserWebWorkerEnv)h.setContentType(void 0);else if((i=h.getContentType())!==!1){let[f,..._]=i?i.split(";").map(g=>C0(g).call(g)).filter(Boolean):[];h.setContentType([f||"multipart/form-data",..._].join("; "))}}if(OS.hasStandardBrowserEnv&&(s&&tE.isFunction(s)&&(s=s(r)),s||s!==!1&&kSt(r.url))){let f=l&&d&&PSt.read(d);f&&h.set(l,f)}return r},DSt=typeof XMLHttpRequest<"u"&&function(e){return new eE(function(r,i){let o=Bot(e),s=o.data,l=XT.from(o.headers).normalize(),d,h,p,f,_,{responseType:g,onUploadProgress:b,onDownloadProgress:C}=o;function k(){f&&f(),_&&_(),o.cancelToken&&o.cancelToken.unsubscribe(d),o.signal&&o.signal.removeEventListener("abort",d)}let A=new XMLHttpRequest;function P(){if(!A)return;let j=XT.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders());Vot(function(z){r(z),k()},function(z){i(z),k()},{data:g&&g!=="text"&&g!=="json"?A.response:A.responseText,status:A.status,statusText:A.statusText,headers:j,config:e,request:A}),A=null}A.open(o.method.toUpperCase(),o.url,!0),A.timeout=o.timeout,"onloadend"in A?A.onloadend=P:A.onreadystatechange=function(){A&&A.readyState===4&&(A.status!==0||A.responseURL&&A.responseURL.indexOf("file:")===0)&&setTimeout(P)},A.onabort=function(){A&&(i(new KE("Request aborted",KE.ECONNABORTED,e,A)),A=null)},A.onerror=function(){i(new KE("Network Error",KE.ERR_NETWORK,e,A)),A=null},A.ontimeout=function(){let j=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded",z=o.transitional||zit;o.timeoutErrorMessage&&(j=o.timeoutErrorMessage),i(new KE(j,z.clarifyTimeoutError?KE.ETIMEDOUT:KE.ECONNABORTED,e,A)),A=null},s===void 0&&l.setContentType(null),"setRequestHeader"in A&&tE.forEach(l.toJSON(),function(j,z){A.setRequestHeader(z,j)}),tE.isUndefined(o.withCredentials)||(A.withCredentials=!!o.withCredentials),g&&g!=="json"&&(A.responseType=o.responseType),C&&([p,_]=$j(C,!0),A.addEventListener("progress",p)),b&&A.upload&&([h,f]=$j(b),A.upload.addEventListener("progress",h),A.upload.addEventListener("loadend",f)),(o.cancelToken||o.signal)&&(d=j=>{A&&(i(!j||j.type?new $1(null,e,A):j),A.abort(),A=null)},o.cancelToken&&o.cancelToken.subscribe(d),o.signal&&(o.signal.aborted?d():o.signal.addEventListener("abort",d)));let x=function(j){let z=/^([-+\w]{1,25})(:?\/\/|:)/.exec(j);return z&&z[1]||""}(o.url);x&&OS.protocols.indexOf(x)===-1?i(new KE("Unsupported protocol "+x+":",KE.ERR_BAD_REQUEST,e)):A.send(s||null)})},LSt=(e,r)=>{let{length:i}=e=e?e.filter(Boolean):[];if(r||i){let o,s=new AbortController,l=function(f){if(!o){o=!0,h();let _=f instanceof Error?f:this.reason;s.abort(_ instanceof KE?_:new $1(_ instanceof Error?_.message:_))}},d=r&&setTimeout(()=>{d=null,l(new KE("timeout ".concat(r," of ms exceeded"),KE.ETIMEDOUT))},r),h=()=>{e&&(d&&clearTimeout(d),d=null,e.forEach(f=>{f.unsubscribe?f.unsubscribe(l):f.removeEventListener("abort",l)}),e=null)};e.forEach(f=>f.addEventListener("abort",l));let{signal:p}=s;return p.unsubscribe=()=>tE.asap(h),p}},MSt=ait,USt=NR;zE({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=USt.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var xSt=NR,jSt=Q1;zE({target:"Promise",stat:!0,forced:!0},{try:function(e){var r=xSt.f(this),i=jSt(e);return(i.error?r.reject:r.resolve)(i.value),r.promise}});var u8=m_(MSt),Got=Z1.f("asyncIterator"),VSt=m_(Got);function zW(e,r){this.v=e,this.k=r}function MD(e){var r,i;function o(l,d){try{var h=e[l](d),p=h.value,f=p instanceof zW;u8.resolve(f?p.v:p).then(function(_){if(f){var g=l==="return"?"return":"next";if(!p.k||_.done)return o(g,_);_=e[g](_).value}s(h.done?"return":"normal",_)},function(_){o("throw",_)})}catch(_){s("throw",_)}}function s(l,d){switch(l){case"return":r.resolve({value:d,done:!0});break;case"throw":r.reject(d);break;default:r.resolve({value:d,done:!1})}(r=r.next)?o(r.key,r.arg):i=null}this._invoke=function(l,d){return new u8(function(h,p){var f={key:l,arg:d,resolve:h,reject:p,next:null};i?i=i.next=f:(r=i=f,o(l,d))})},typeof e.return!="function"&&(this.return=void 0)}function YS(e){return function(){return new MD(e.apply(this,arguments))}}function PE(e){return new zW(e,0)}function t3(e){var r={},i=!1;function o(s,l){return i=!0,{done:!1,value:new zW(l=new u8(function(d){d(e[s](l))}),1)}}return r[p1!==void 0&&bot||"@@iterator"]=function(){return this},r.next=function(s){return i?(i=!1,s):o("next",s)},typeof e.throw=="function"&&(r.throw=function(s){if(i)throw i=!1,s;return o("throw",s)}),typeof e.return=="function"&&(r.return=function(s){return i?(i=!1,s):o("return",s)}),r}MD.prototype[typeof p1=="function"&&VSt||"@@asyncIterator"]=function(){return this},MD.prototype.next=function(e){return this._invoke("next",e)},MD.prototype.throw=function(e){return this._invoke("throw",e)},MD.prototype.return=function(e){return this._invoke("return",e)};var YW=m_(Got);function l8(e){var r,i,o,s=2;for(typeof Symbol<"u"&&(i=YW,o=Symbol.iterator);s--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new OU(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function OU(e){function r(i){if(Object(i)!==i)return eE.reject(new TypeError(i+" is not an object."));var o=i.done;return eE.resolve(i.value).then(function(s){return{value:s,done:o}})}return OU=function(i){this.s=i,this.n=i.next},OU.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?eE.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?eE.reject(i):r(o.apply(this.s,arguments))}},new OU(e)}var FSt=function*(e,r){let i=e.byteLength;if(!r||i<r)return void(yield e);let o,s=0;for(;s<i;)o=s+r,yield e.slice(s,o),s=o},BSt=function(){var e=YS(function*(r,i){var o,s=!1,l=!1;try{for(var d,h=l8(GSt(r));s=!(d=yield PE(h.next())).done;s=!1){let p=d.value;yield*t3(l8(FSt(p,i)))}}catch(p){l=!0,o=p}finally{try{s&&h.return!=null&&(yield PE(h.return()))}finally{if(l)throw o}}});return function(r,i){return e.apply(this,arguments)}}(),GSt=function(){var e=YS(function*(r){if(r[YW])return void(yield*t3(l8(r)));let i=r.getReader();try{for(;;){let{done:o,value:s}=yield PE(i.read());if(o)break;yield s}}finally{yield PE(i.cancel())}});return function(r){return e.apply(this,arguments)}}(),IQ=(e,r,i,o)=>{let s=BSt(e,r),l,d=0,h=p=>{l||(l=!0,o&&o(p))};return new ReadableStream({async pull(p){try{let{done:f,value:_}=await s.next();if(f)return h(),void p.close();let g=_.byteLength;if(i){let b=d+=g;i(b)}p.enqueue(new Uint8Array(_))}catch(f){throw h(f),f}},cancel:p=>(h(p),s.return())},{highWaterMark:2})};function CQ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function AQ(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?CQ(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):CQ(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var aV=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",qot=aV&&typeof ReadableStream=="function",qSt=aV&&(typeof TextEncoder=="function"?(OQ=new TextEncoder,e=>OQ.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer())),OQ,Wot=function(e){try{for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return!!e(...i)}catch{return!1}},WSt=qot&&Wot(()=>{let e=!1,r=new Request(OS.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!r}),d8=qot&&Wot(()=>tE.isReadableStream(new Response("").body)),e3={stream:d8&&(e=>e.body)},NQ;aV&&(NQ=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!e3[e]&&(e3[e]=tE.isFunction(NQ[e])?r=>r[e]():(r,i)=>{throw new KE("Response type '".concat(e,"' is not supported"),KE.ERR_NOT_SUPPORT,i)})}));var HSt=async(e,r)=>{let i=tE.toFiniteNumber(e.getContentLength());return i??(async o=>o==null?0:tE.isBlob(o)?o.size:tE.isSpecCompliantForm(o)?(await new Request(OS.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:tE.isArrayBufferView(o)||tE.isArrayBuffer(o)?o.byteLength:(tE.isURLSearchParams(o)&&(o+=""),tE.isString(o)?(await qSt(o)).byteLength:void 0))(r)},KSt=aV&&(async e=>{let{url:r,method:i,data:o,signal:s,cancelToken:l,timeout:d,onDownloadProgress:h,onUploadProgress:p,responseType:f,headers:_,withCredentials:g="same-origin",fetchOptions:b}=Bot(e);f=f?(f+"").toLowerCase():"text";let C,k=LSt([s,l&&l.toAbortSignal()],d),A=k&&k.unsubscribe&&(()=>{k.unsubscribe()}),P;try{if(p&&WSt&&i!=="get"&&i!=="head"&&(P=await HSt(_,o))!==0){let ue,_n=new Request(r,{method:"POST",body:o,duplex:"half"});if(tE.isFormData(o)&&(ue=_n.headers.get("content-type"))&&_.setContentType(ue),_n.body){let[Ei,_s]=TQ(P,$j(bQ(p)));o=IQ(_n.body,65536,Ei,_s)}}tE.isString(g)||(g=g?"include":"omit");let x="credentials"in Request.prototype;C=new Request(r,AQ(AQ({},b),{},{signal:k,method:i.toUpperCase(),headers:_.normalize().toJSON(),body:o,duplex:"half",credentials:x?g:void 0}));let j=await fetch(C),z=d8&&(f==="stream"||f==="response");if(d8&&(h||z&&A)){let ue={};["status","statusText","headers"].forEach(kc=>{ue[kc]=j[kc]});let _n=tE.toFiniteNumber(j.headers.get("content-length")),[Ei,_s]=h&&TQ(_n,$j(bQ(h),!0))||[];j=new Response(IQ(j.body,65536,Ei,()=>{_s&&_s(),A&&A()}),ue)}f=f||"text";let _t=await e3[tE.findKey(e3,f)||"text"](j,e);return!z&&A&&A(),await new eE((ue,_n)=>{Vot(ue,_n,{data:_t,headers:XT.from(j.headers),status:j.status,statusText:j.statusText,config:e,request:C})})}catch(x){throw A&&A(),x&&x.name==="TypeError"&&/fetch/i.test(x.message)?Object.assign(new KE("Network Error",KE.ERR_NETWORK,e,C),{cause:x.cause||x}):KE.from(x,x&&x.code,e,C)}}),h8={http:null,xhr:DSt,fetch:KSt};tE.forEach(h8,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});var kQ=e=>"- ".concat(e),zSt=e=>tE.isFunction(e)||e===null||e===!1,Hot={getAdapter:e=>{e=tE.isArray(e)?e:[e];let{length:r}=e,i,o,s={};for(let l=0;l<r;l++){let d;if(i=e[l],o=i,!zSt(i)&&(o=h8[(d=String(i)).toLowerCase()],o===void 0))throw new KE("Unknown adapter '".concat(d,"'"));if(o)break;s[d||"#"+l]=o}if(!o){let l=Object.entries(s).map(d=>{let[h,p]=d;return"adapter ".concat(h," ")+(p===!1?"is not supported by the environment":"is not available in the build")});throw new KE("There is no suitable adapter to dispatch the request "+(r?l.length>1?`since :
`+l.map(kQ).join(`
`):" "+kQ(l[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:h8};function l6(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new $1(null,e)}function PQ(e){return l6(e),e.headers=XT.from(e.headers),e.data=u6.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Hot.getAdapter(e.adapter||KW.adapter)(e).then(function(r){return l6(e),r.data=u6.call(e,e.transformResponse,r),r.headers=XT.from(r.headers),r},function(r){return jot(r)||(l6(e),r&&r.response&&(r.response.data=u6.call(e,e.transformResponse,r.response),r.response.headers=XT.from(r.response.headers))),eE.reject(r)})}var Kot="1.7.7",JW={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{JW[e]=function(i){return typeof i===e||"a"+(r<1?"n ":" ")+e}});var DQ={};JW.transitional=function(e,r,i){function o(s,l){return"[Axios v"+Kot+"] Transitional option '"+s+"'"+l+(i?". "+i:"")}return(s,l,d)=>{if(e===!1)throw new KE(o(l," has been removed"+(r?" in "+r:"")),KE.ERR_DEPRECATED);return r&&!DQ[l]&&(DQ[l]=!0,console.warn(o(l," has been deprecated since v"+r+" and will be removed in the near future"))),!e||e(s,l,d)}};var p8={assertOptions:function(e,r,i){if(typeof e!="object")throw new KE("options must be an object",KE.ERR_BAD_OPTION_VALUE);let o=Object.keys(e),s=o.length;for(;s-- >0;){let l=o[s],d=r[l];if(d){let h=e[l],p=h===void 0||d(h,l,e);if(p!==!0)throw new KE("option "+l+" must be "+p,KE.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new KE("Unknown option "+l,KE.ERR_BAD_OPTION)}},validators:JW},OI=p8.validators,NU=class{constructor(e){this.defaults=e,this.interceptors={request:new vX,response:new vX}}async request(e,r){try{return await this._request(e,r)}catch(i){if(i instanceof Error){let o;Error.captureStackTrace?Error.captureStackTrace(o={}):o=new Error;let s=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?s&&!String(i.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+s):i.stack=s}catch{}}throw i}}_request(e,r){typeof e=="string"?(r=r||{}).url=e:r=e||{},r=tN(this.defaults,r);let{transitional:i,paramsSerializer:o,headers:s}=r;i!==void 0&&p8.assertOptions(i,{silentJSONParsing:OI.transitional(OI.boolean),forcedJSONParsing:OI.transitional(OI.boolean),clarifyTimeoutError:OI.transitional(OI.boolean)},!1),o!=null&&(tE.isFunction(o)?r.paramsSerializer={serialize:o}:p8.assertOptions(o,{encode:OI.function,serialize:OI.function},!0)),r.method=(r.method||this.defaults.method||"get").toLowerCase();let l=s&&tE.merge(s.common,s[r.method]);s&&tE.forEach(["delete","get","head","post","put","patch","common"],C=>{delete s[C]}),r.headers=XT.concat(l,s);let d=[],h=!0;this.interceptors.request.forEach(function(C){typeof C.runWhen=="function"&&C.runWhen(r)===!1||(h=h&&C.synchronous,d.unshift(C.fulfilled,C.rejected))});let p=[],f;this.interceptors.response.forEach(function(C){p.push(C.fulfilled,C.rejected)});let _,g=0;if(!h){let C=[PQ.bind(this),void 0];for(C.unshift.apply(C,d),C.push.apply(C,p),_=C.length,f=eE.resolve(r);g<_;)f=f.then(C[g++],C[g++]);return f}_=d.length;let b=r;for(g=0;g<_;){let C=d[g++],k=d[g++];try{b=C(b)}catch(A){k.call(this,A);break}}try{f=PQ.call(this,b)}catch(C){return eE.reject(C)}for(g=0,_=p.length;g<_;)f=f.then(p[g++],p[g++]);return f}getUri(e){return Kit(Fot((e=tN(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};tE.forEach(["delete","get","head","options"],function(e){NU.prototype[e]=function(r,i){return this.request(tN(i||{},{method:e,url:r,data:(i||{}).data}))}}),tE.forEach(["post","put","patch"],function(e){function r(i){return function(o,s,l){return this.request(tN(l||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}NU.prototype[e]=r(),NU.prototype[e+"Form"]=r(!0)});var kU=NU,f8=class e{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new eE(function(s){i=s});let o=this;this.promise.then(s=>{if(!o._listeners)return;let l=o._listeners.length;for(;l-- >0;)o._listeners[l](s);o._listeners=null}),this.promise.then=s=>{let l,d=new eE(h=>{o.subscribe(h),l=h}).then(s);return d.cancel=function(){o.unsubscribe(l)},d},r(function(s,l,d){o.reason||(o.reason=new $1(s,l,d),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;let i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){let r=new AbortController,i=o=>{r.abort(o)};return this.subscribe(i),r.signal.unsubscribe=()=>this.unsubscribe(i),r.signal}static source(){let r;return{token:new e(function(i){r=i}),cancel:r}}},YSt=f8,m8={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(m8).forEach(e=>{let[r,i]=e;m8[i]=r});var JSt=m8,_0=function e(r){let i=new kU(r),o=qit(kU.prototype.request,i);return tE.extend(o,kU.prototype,i,{allOwnKeys:!0}),tE.extend(o,i,null,{allOwnKeys:!0}),o.create=function(s){return e(tN(r,s))},o}(KW);_0.Axios=kU,_0.CanceledError=$1,_0.CancelToken=YSt,_0.isCancel=jot,_0.VERSION=Kot,_0.toFormData=XU,_0.AxiosError=KE,_0.Cancel=_0.CanceledError,_0.all=function(e){return eE.all(e)},_0.spread=function(e){return function(r){return e.apply(null,r)}},_0.isAxiosError=function(e){return tE.isObject(e)&&e.isAxiosError===!0},_0.mergeConfig=tN,_0.AxiosHeaders=XT,_0.formToJSON=e=>xot(tE.isHTMLForm(e)?new FormData(e):e),_0.getAdapter=Hot.getAdapter,_0.HttpStatusCode=JSt,_0.default=_0;var K0=_0,XSt=()=>{};function EL(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:XSt};return e.promise=new eE((r,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,r(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}var FM=new Map,BM=new Map,aR=new Map,W_=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),FE=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),E8=new qgt,YT=E8.getResult(),d6=null;function DE(e){if(!d6){e&&E8.setUA(e),YT=E8.getResult();let r=function(h){if(h.engine.name==="Blink"&&h.browser.name!=="WeChat")return FE.CHROME;switch(h.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return FE.CHROME;case"Safari":case"Mobile Safari":return FE.SAFARI;case"Edge":return FE.EDGE;case"Firefox":return FE.FIREFOX;case"QQ":case"QQBrowser":return FE.QQ;case"Opera":return FE.OPERA;case"WeChat":return FE.WECHAT;default:return h.browser.name||""}}(YT),i=LQ(YT),o=function(h){return h.os.name==="Windows"?h.os.version?h.os.name+" "+h.os.version:h.os.name:h.os.name||""}(YT),s=YT.os.version,l=LQ(YT,!1),d=YT.device.type;if(!(r&&i&&o&&s))return{name:r,version:i,os:o,osVersion:s,browserVersion:l,deviceType:d};d6={name:r,version:i,os:o,osVersion:s,browserVersion:l,deviceType:d}}return d6}function LQ(e){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?r.split(".")[0]:r}function cV(){return DE().os}function MQ(){let e=DE();return"".concat(e.os," ").concat(e.osVersion)}function n3(){let e=DE();return!!(YT.engine.name==="WebKit"&&e.os===W_.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==FE.SAFARI||U0()&&e.name!==FE.SAFARI)}function zI(){return DE().name===FE.CHROME}function a0(){return DE().name===FE.SAFARI}function zot(){return DE().name===FE.EDGE}function f_(){return DE().name===FE.FIREFOX}function U0(){return DE().os===W_.IOS}function _8(e){let r=DE();return!(r.name!==FE.CHROME||!r.osVersion)&&Number(r.version)>=e}function Yot(e){let r=DE();return!(r.name!==FE.CHROME||!r.osVersion)&&Number(r.version)<e}function UQ(e){let r=DE();return!(r.name!==FE.EDGE||!r.osVersion)&&Number(r.version)>=e}function Jot(e){let r=DE();return!(r.name!==FE.SAFARI||!r.osVersion)&&Number(r.version)>=e}function Xot(e,r,i){let o=DE();if(o.os!==W_.IOS||!o.osVersion)return!1;let s=o.osVersion.split(".");return i?r&&Number(s[0])===e&&Number(s[1])<r||Number(s[0])<e:r?Number(s[0])===e&&Number(s[1])<=r||Number(s[0])<e:Number(s[0])<=e}function Qot(e,r,i){let o=DE();if(o.name!==FE.SAFARI||!o.osVersion||!o.browserVersion)return!1;let s=o.browserVersion.split(".");return i?r&&Number(s[0])===e&&Number(s[1])<r||Number(s[0])<e:r?Number(s[0])===e&&Number(s[1])<=r||Number(s[0])<e:Number(s[0])<=e}function xQ(e){let r=DE();return!(r.name!==FE.OPERA||!r.osVersion)&&Number(r.version)>=e}function jQ(){let e=DE();if(e.os!==W_.IOS||!e.osVersion)return!1;let r=e.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function D1(){let e=DE();if(e.os!==W_.IOS||!e.osVersion)return!1;let r=e.osVersion.split(".");return Number(r[0])===15}function g8(){let e=DE();if(e.os!==W_.IOS||!e.osVersion)return!1;let r=e.osVersion.split(".");return Number(r[0])===16}function VQ(){let e=DE();if(e.os!==W_.IOS||!e.osVersion)return!1;let r=e.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function wT(){return a0()&&navigator.maxTouchPoints>0}function Zot(){return DE().name===FE.WECHAT}function $ot(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function XW(){let e=cV();return function(){let{deviceType:r}=DE();return r==="mobile"||r==="tablet"}()||e===W_.ANDROID||e===W_.IOS||e===W_.HARMONY_OS}function $I(){let e=DE();return e.name!==FE.EDGE&&e.name!==FE.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function uV(){return cV()===W_.ANDROID}function _L(){let e=DE();return uV()&&(e.name===FE.CHROME||e.name===FE.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function n_(e,r,i){return(r=function(o){var s=function(l,d){if(typeof l!="object"||!l)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var p=h.call(l,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(o);return typeof s=="symbol"?s:s+""}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function FQ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function sE(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?FQ(Object(i),!0).forEach(function(o){n_(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):FQ(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Vt=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),_u=class extends Error{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),n_(this,"code",void 0),n_(this,"message",void 0),n_(this,"data",void 0),n_(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return e==="error"&&(r||console).error(this.toString()),e==="warning"&&(r||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function tI(e,r){if(typeof e!="boolean")throw new _u(Vt.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function j_(e,r,i){if(!nE(i).call(i,e))throw new _u(Vt.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function HE(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(s){return typeof s=="number"&&s%1==0}(e))throw new _u(Vt.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function h6(e,r){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new _u(Vt.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));e.min!==void 0&&HE(e.min,"".concat(r,".min"),0,1/0),e.max!==void 0&&HE(e.max,"".concat(r,".max"),1,1/0),e.exact!==void 0&&HE(e.exact,"".concat(r,".exact"),1,1/0),e.ideal!==void 0&&HE(e.ideal,"".concat(r,".ideal"),1,1/0)}else HE(e,r,1,1/0)}function _g(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new _u(Vt.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!tst(e,i,o,s))throw new _u(Vt.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(s?" ASCII characters only.":""))}function ZR(e,r){if(!Array.isArray(e))throw new _u(Vt.INVALID_PARAMS,"".concat(r," should be an array"))}function l_(e){return e==null}function tst(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=r&&(!o||function(s){if(typeof s!="string")return!1;for(let l=0;l<s.length;l+=1){let d=s.charCodeAt(l);if(d<0||d>255)return!1}return!0}(e))}var UD=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(UD||{}),v8=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(v8||{}),est=new class{constructor(){n_(this,"_clientSize",null),n_(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),n_(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),n_(this,"getStyle",e=>window.getComputedStyle(e,null)),n_(this,"checkCssVisibleProperty",e=>{var r;let i=!0,o=this.getStyle(e),{display:s,visibility:l,opacity:d,filter:h}=o;return(s==="none"||nE(r=["hidden","collapse"]).call(r,l)||Number(d)<.1)&&(i=!1),!!i&&(h&&h.split(" ").filter(p=>{var f;let _=p.split("(")[0];return nE(f=["brightness","blur","opacity"]).call(f,_)}).map(p=>{let[f,_]=p.split(/\(|\)/);return[f,Number(_.match(/^[0-9\.]+/))]}).forEach(p=>{let[f,_]=p;switch(f){case"brightness":(_<.1||_>3)&&(i=!1);break;case"blur":_>3&&(i=!1);break;case"opacity":_<.1&&(i=!1)}}),i)}),n_(this,"checkPropertyUpToAllParentNodes",(e,r)=>{let i=!0,o=!0,s=d=>r(d),l=e;for(;l&&o;)s(l)||(i=!1,o=!1),l=l.parentElement,l||(o=!1);return i}),n_(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),n_(this,"getSizeAboutClient",e=>{let{width:r,height:i,left:o,right:s,top:l,bottom:d}=e.getBoundingClientRect(),h=this.getClientWidth(),p=this.getClientHeight();return{width:r,height:i,left:o,right:s,top:l,bottom:d,clientWidth:h,clientHeight:p,clientMin:Math.min(h,p)}}),n_(this,"checkActualSize",()=>{let{width:e,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,r,i)}),n_(this,"elementFromPoint",(e,r)=>document.elementFromPoint?document.elementFromPoint(e,r):null),n_(this,"checkCoverForAPoint",(e,r,i)=>{let o=this.elementFromPoint(e,r);return o!==null&&o!==i}),n_(this,"getPointPositionList",()=>{let{width:e,height:r,left:i,top:o}=this._clientSize,s=e/6,l=r/6,d=[],h=10**6;for(let p=0;p<5;p++)for(let f=0;f<5;f++){let _=(i*h+(p===0?.1:p===4?(s*p*h-1e5)/h:s*p)*h)/h,g=(o*h+(f===0?.1:f===4?(l*f*h-1e5)/h:l*f)*h)/h;d.push({x:_,y:g})}return[...d]}),n_(this,"checkElementCover",e=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,e)).filter(r=>!!r).length>6),n_(this,"checkSizeIsVisible",(e,r,i)=>(e>50||i/e<=10)&&(r>50||i/r<=10)),n_(this,"checkSizeOfPartInClient",()=>{let{left:e,right:r,top:i,bottom:o,clientHeight:s,clientWidth:l,clientMin:d}=this._clientSize,h,p,f,_;if(e<0)h=0;else{if(!(e<l))return!1;h=e}if(r<0)return!1;if(p=r<l?r:l,i<0)f=0;else{if(!(i<s))return!1;f=i}if(o<0)return!1;_=o<s?o:s;let g=p-h,b=_-f;return this.checkSizeIsVisible(g,b,d)}),n_(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),n_(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(UD.COVERED);{let r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(UD.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(UD.SIZE)}}return this.returnHiddenResult(UD.STYLE)}return this.returnHiddenResult(v8.UNMOUNTED)}return this.returnHiddenResult(v8.INVALID_HTML_ELEMENT)}),n_(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function QW(e){return new TextEncoder().encode(e)}var BQ=function(e,r){let i=new Uint8Array(e.byteLength+r.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(r),e.byteLength),i},y8=async e=>function(r,i){let o="";return new Uint8Array(r).forEach(s=>{o+=s.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",QW(e)),16),s_=class{constructor(){n_(this,"_events",{}),n_(this,"addListener",this.on)}getListeners(r){return this._events[r]?this._events[r].map(i=>i.listener):[]}on(r,i){this._events[r]||(this._events[r]=[]);let o=this._events[r];this._indexOfListener(o,i)===-1&&o.push({listener:i,once:!1})}once(r,i){this._events[r]||(this._events[r]=[]);let o=this._events[r];this._indexOfListener(o,i)===-1&&o.push({listener:i,once:!0})}off(r,i){if(!this._events[r])return;let o=this._events[r],s=this._indexOfListener(o,i);s!==-1&&o.splice(s,1),this._events[r].length===0&&delete this._events[r]}removeAllListeners(r){r?delete this._events[r]:this._events={}}emit(r){this._events[r]||(this._events[r]=[]);let i=this._events[r].map(d=>d);for(var o=arguments.length,s=new Array(o>1?o-1:0),l=1;l<o;l++)s[l-1]=arguments[l];for(let d=0;d<i.length;d+=1){let h=i[d];h.once&&this.off(r,h.listener),h.listener.apply(this,s||[])}}safeEmit(r){for(var i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];[...this._events[r]||[]].forEach(l=>{l.once&&this.off(r,l.listener);try{l.listener.apply(this,o)}catch(d){console.error("safeEmit event:".concat(r," error ").concat(d?.toString()))}})}_indexOfListener(r,i){let o=r.length;for(;o--;)if(r[o].listener===i)return o;return-1}},yD=null;function nst(){if(yD)return yD;if(window.electron)return yD=window.electron;if(!window.require)return null;try{return yD=window.require("electron"),yD}catch{return null}}var L_=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),p_=function(e){return e.TRACER="tracer",e}({});function GQ(e){return HE(e.timeout,"config.timeout",0,1e5),HE(e.timeoutFactor,"config.timeoutFactor",0,100,!1),HE(e.maxRetryCount,"config.maxRetryConfig",0,1/0),HE(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}var QSt=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),GE=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function lV(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function rst(e){return _g(e.turnServerURL,"turnServerURL"),_g(e.username,"username"),_g(e.password,"password"),e.udpport&&HE(e.udpport,"udpport",1,99999,!0),e.forceturn&&tI(e.forceturn,"forceturn"),e.security&&tI(e.security,"security"),e.tcpport&&HE(e.tcpport,"tcpport",1,99999,!0),!0}function qQ(e){return e.level!==void 0&&j_(e.level,"level",[1,2,3]),e.delay!==void 0&&HE(e.delay,"delay",0,3e3,!0),!0}var CE=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),s0=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),dS=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),m1=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function c0(e,r){for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];return e.getListeners(r).length===0?eE.reject(new _u(Vt.UNEXPECTED_ERROR,"can not emit promise")):new eE((l,d)=>{e.emit(r,...o,l,d)})}function JE(e,r){if(e.getListeners(r).length===0)return eE.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];return c0(e,r,...o)}function JS(e,r){if(e.getListeners(r).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];return gL(e,r,...o)}function gL(e,r){let i=null,o=null;for(var s=arguments.length,l=new Array(s>2?s-2:0),d=2;d<s;d++)l[d-2]=arguments[d];if(e.emit(r,...l,h=>{i=h},h=>{o=h}),o!==null)throw o;if(i===null)throw new _u(Vt.UNEXPECTED_ERROR,"handler is not sync");return i}var I_=new class extends s_{set networkState(e){this.emit(m1.NETWORK_STATE_CHANGE,e,this._networkState),e===dS.ONLINE?this.emit(m1.ONLINE):e===dS.OFFLINE&&(this.onlineWaiter=new eE(r=>{this.once(m1.ONLINE,()=>{this.onlineWaiter=void 0,r(dS.ONLINE)})}),this.emit(m1.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===dS.ONLINE}constructor(){super(),n_(this,"_moduleName","network-indicator"),n_(this,"_networkState",dS.ONLINE),n_(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=dS.ONLINE}),window.addEventListener("offline",()=>{this.networkState=dS.OFFLINE})}};function r3(e,r){let i=e.indexOf(r);i!==-1&&e.splice(i,1)}function E1(e){let r=[];return e.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function dV(e){eE!==void 0?eE.resolve().then(e):setTimeout(e,0)}function R_(e){return JSON.parse(JSON.stringify(e))}function BO(e){try{return R_(e)}catch{return e}}var WQ={};function _C(e,r){WQ[r]||(WQ[r]=!0,e())}function GO(e){let r=window.atob(e),i=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)i[o]=r.charCodeAt(o);return i}function YI(e){let r="";for(let i=0;i<e.length;i+=1)r+=String.fromCharCode(e[i]);return window.btoa(r)}function ist(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>r)i=i.slice(0,r);else if(i.length<r){let o=new Uint8Array(r);o.set(i),i=o}return i}function HQ(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=QT(r).call(r,(d,h)=>d+h.length,0),s=new Uint8Array(new ArrayBuffer(o)),l=0;return r.forEach(d=>{s.set(d,l),l+=d.length}),s}function SR(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function ost(e){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{r+=typeof i=="string"?SR(i):i.size}),r+138}function ZSt(e){let r=new _u(Vt.TIMEOUT,"timeout");return new eE((i,o)=>{window.setTimeout(()=>o(r),e)})}function _y(e){return new eE(r=>{window.setTimeout(r,e)})}function ZE(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0,i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(r).concat(i):"".concat(r).concat(i)+ZE(e-i.length,"")}function _1(){return ZE(32,"").toUpperCase()}var hV=()=>{},KQ=new class{constructor(){n_(this,"fnMap",new Map)}throttleByKey(e,r,i,o){for(var s=arguments.length,l=new Array(s>4?s-4:0),d=4;d<s;d++)l[d-4]=arguments[d];if(this.fnMap.has(r)){let h=this.fnMap.get(r);if(h.threshold!==i){h.fn(...h.args),clearTimeout(h.timer);let p=window.setTimeout(()=>{let f=this.fnMap.get(r);f&&f.fn(...f.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:p,args:l,skipFn:o})}else h.skipFn&&h.skipFn(...h.args),this.fnMap.set(r,sE(sE({},h),{},{fn:e,args:l,skipFn:o}))}else{let h=window.setTimeout(()=>{let p=this.fnMap.get(r);p&&p.fn(...p.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:h,args:l,skipFn:o})}}},zQ=KQ.throttleByKey.bind(KQ);function YQ(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function S8(e,r){if(!YQ(e)||!YQ(r)||Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(e)){let i=[...e];for(let o=0;o<r.length;o++)i[o]=S8(e[o],r[o]);return i}{let i=sE({},e);for(let o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=S8(e[o],r[o]):i[o]=r[o]);return i}}function JQ(e,r){let i=[0];if(r&&(i=new Array(r).fill(0)),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,!r||o!==r););return i}function p6(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function sst(e){let r="0123456789abcdef";function i(z){let _t,ue="";for(_t=0;_t<=3;_t++)ue+=r.charAt(z>>8*_t+4&15)+r.charAt(z>>8*_t&15);return ue}function o(z,_t){let ue=(65535&z)+(65535&_t);return(z>>16)+(_t>>16)+(ue>>16)<<16|65535&ue}function s(z,_t,ue,_n,Ei,_s){return o(function(kc,_i){return kc<<_i|kc>>>32-_i}(o(o(_t,z),o(_n,_s)),Ei),ue)}function l(z,_t,ue,_n,Ei,_s,kc){return s(_t&ue|~_t&_n,z,_t,Ei,_s,kc)}function d(z,_t,ue,_n,Ei,_s,kc){return s(_t&_n|ue&~_n,z,_t,Ei,_s,kc)}function h(z,_t,ue,_n,Ei,_s,kc){return s(_t^ue^_n,z,_t,Ei,_s,kc)}function p(z,_t,ue,_n,Ei,_s,kc){return s(ue^(_t|~_n),z,_t,Ei,_s,kc)}let f=function(z){let _t,ue=1+(z.length+8>>6),_n=new Array(16*ue);for(_t=0;_t<16*ue;_t++)_n[_t]=0;for(_t=0;_t<z.length;_t++)_n[_t>>2]|=z.charCodeAt(_t)<<_t%4*8;return _n[_t>>2]|=128<<_t%4*8,_n[16*ue-2]=8*z.length,_n}(e),_,g,b,C,k,A=1732584193,P=-271733879,x=-1732584194,j=271733878;for(_=0;_<f.length;_+=16)g=A,b=P,C=x,k=j,A=l(A,P,x,j,f[_+0],7,-680876936),j=l(j,A,P,x,f[_+1],12,-389564586),x=l(x,j,A,P,f[_+2],17,606105819),P=l(P,x,j,A,f[_+3],22,-1044525330),A=l(A,P,x,j,f[_+4],7,-176418897),j=l(j,A,P,x,f[_+5],12,1200080426),x=l(x,j,A,P,f[_+6],17,-1473231341),P=l(P,x,j,A,f[_+7],22,-45705983),A=l(A,P,x,j,f[_+8],7,1770035416),j=l(j,A,P,x,f[_+9],12,-1958414417),x=l(x,j,A,P,f[_+10],17,-42063),P=l(P,x,j,A,f[_+11],22,-1990404162),A=l(A,P,x,j,f[_+12],7,1804603682),j=l(j,A,P,x,f[_+13],12,-40341101),x=l(x,j,A,P,f[_+14],17,-1502002290),P=l(P,x,j,A,f[_+15],22,1236535329),A=d(A,P,x,j,f[_+1],5,-165796510),j=d(j,A,P,x,f[_+6],9,-1069501632),x=d(x,j,A,P,f[_+11],14,643717713),P=d(P,x,j,A,f[_+0],20,-373897302),A=d(A,P,x,j,f[_+5],5,-701558691),j=d(j,A,P,x,f[_+10],9,38016083),x=d(x,j,A,P,f[_+15],14,-660478335),P=d(P,x,j,A,f[_+4],20,-405537848),A=d(A,P,x,j,f[_+9],5,568446438),j=d(j,A,P,x,f[_+14],9,-1019803690),x=d(x,j,A,P,f[_+3],14,-187363961),P=d(P,x,j,A,f[_+8],20,1163531501),A=d(A,P,x,j,f[_+13],5,-1444681467),j=d(j,A,P,x,f[_+2],9,-51403784),x=d(x,j,A,P,f[_+7],14,1735328473),P=d(P,x,j,A,f[_+12],20,-1926607734),A=h(A,P,x,j,f[_+5],4,-378558),j=h(j,A,P,x,f[_+8],11,-2022574463),x=h(x,j,A,P,f[_+11],16,1839030562),P=h(P,x,j,A,f[_+14],23,-35309556),A=h(A,P,x,j,f[_+1],4,-1530992060),j=h(j,A,P,x,f[_+4],11,1272893353),x=h(x,j,A,P,f[_+7],16,-155497632),P=h(P,x,j,A,f[_+10],23,-1094730640),A=h(A,P,x,j,f[_+13],4,681279174),j=h(j,A,P,x,f[_+0],11,-358537222),x=h(x,j,A,P,f[_+3],16,-722521979),P=h(P,x,j,A,f[_+6],23,76029189),A=h(A,P,x,j,f[_+9],4,-640364487),j=h(j,A,P,x,f[_+12],11,-421815835),x=h(x,j,A,P,f[_+15],16,530742520),P=h(P,x,j,A,f[_+2],23,-995338651),A=p(A,P,x,j,f[_+0],6,-198630844),j=p(j,A,P,x,f[_+7],10,1126891415),x=p(x,j,A,P,f[_+14],15,-1416354905),P=p(P,x,j,A,f[_+5],21,-57434055),A=p(A,P,x,j,f[_+12],6,1700485571),j=p(j,A,P,x,f[_+3],10,-1894986606),x=p(x,j,A,P,f[_+10],15,-1051523),P=p(P,x,j,A,f[_+1],21,-2054922799),A=p(A,P,x,j,f[_+8],6,1873313359),j=p(j,A,P,x,f[_+15],10,-30611744),x=p(x,j,A,P,f[_+6],15,-1560198380),P=p(P,x,j,A,f[_+13],21,1309151649),A=p(A,P,x,j,f[_+4],6,-145523070),j=p(j,A,P,x,f[_+11],10,-1120210379),x=p(x,j,A,P,f[_+2],15,718787259),P=p(P,x,j,A,f[_+9],21,-343485551),A=o(A,g),P=o(P,b),x=o(x,C),j=o(j,k);return i(A)+i(P)+i(x)+i(j)}var $St=1,GM=console,f0=class{static setLogger(e){GM=e}constructor(e){n_(this,"lockingPromise",eE.resolve()),n_(this,"locks",0),n_(this,"name",""),n_(this,"lockId",void 0),this.lockId=$St++,e&&(this.name=e),GM.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let r;this.locks+=1,GM.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:""));let i=new eE(s=>{r=()=>{this.locks-=1,GM.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof e=="string"?e:"")),s()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function L1(e,r){return function(i,o,s){let l=s.value;if(typeof l!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){let d=this[r];if(!d)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(e));let h=await d.lock("From ".concat(e,".").concat(o));try{for(var p=arguments.length,f=new Array(p),_=0;_<p;_++)f[_]=arguments[_];return await l.apply(this,f)}finally{h()}},s}}var N_={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function ZW(e,r){let i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,e));return Math.min(r.maxRetryTimeout,i)}function $T(e,r,i,o){let s=Object.assign({},N_,o),l=s.timeout,d=async()=>{await function(f){return new eE(_=>{window.setTimeout(_,f)})}(l),l*=s.timeoutFactor,l=Math.min(s.maxRetryTimeout,l)},h=!1,p=new eE(async(f,_)=>{r=r||(()=>!1),i=i||(()=>!0);for(let g=0;g<s.maxRetryCount;g+=1){if(h)return _(new _u(Vt.OPERATION_ABORTED));try{let b=await e();if(!r(b,g)||g+1===s.maxRetryCount)return f(b);await d()}catch(b){if(!i(b,g)||g+1===s.maxRetryCount)return _(b);await d()}}});return p.cancel=()=>h=!0,p}var i3=class{constructor(r){n_(this,"input",[]),n_(this,"size",void 0),this.size=r}add(r){this.input.push(r),this.input.length>this.size&&this.input.splice(0,1)}mean(){var r;return this.input.length===0?0:QT(r=this.input).call(r,(i,o)=>i+o)/this.input.length}},qM,WM=0,f6=0;function T8(e,r,i,o){return new eE((s,l)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),WM+=SR(r.data)):i&&(r.data.size?WM+=r.data.size:r.data instanceof FormData?WM+=ost(r.data):WM+=SR(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,K0.request(r).then(d=>{typeof d.data=="string"?f6+=SR(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?f6+=d.data.byteLength:f6+=SR(JSON.stringify(d.data)),o&&s({data:d.data,headers:d.headers}),s(d.data)}).catch(d=>{K0.isCancel(d)?l(new _u(Vt.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?l(new _u(Vt.NETWORK_TIMEOUT,d.message)):d.response?l(new _u(Vt.NETWORK_RESPONSE_ERROR,d.response.status)):l(new _u(Vt.NETWORK_ERROR,d.message))})})}async function tTt(e,r){let i=new Blob([r.data],{type:"buffer"});return await T8(e,sE(sE({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}var XQ=()=>window.isSecureContext!==void 0,XS=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){let i=r[1],o=r[2];return"".concat(i,".").concat(o)}return"4.0.0.999"}("4.22.1"),$W=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),NO=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),i0=function(){let e="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");let o=i.join(""),s=[];for(let h=0;h<6;h++)s.push("1");let l=s.join(""),d={};return d[e]=o,d[r]=l,Object.assign(d,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=i0;var tH={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},eH="v4.22.1-0-g1c8e27e9(9/19/2024, 2:23:30 PM)",y_=sE(sE({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:tH,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0,DISABLE_SCREEN_SHARE_REMB:!1},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0});function WE(e,r,i){var o,s,l;nE(o=Object.keys(y_)).call(o,e)&&(!i&&nE(s=Object.keys(BI)).call(s,e)||(y_[e]=r,e==="ENABLE_VIDEO_SEI"&&r===!0&&(y_.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&r&&(l=!!r,y_.USE_NEW_NETWORK_CONFIG=l,l&&(y_.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],y_.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],y_.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],y_.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],y_.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",y_.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",y_.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&r&&(y_.ENABLE_INSTANT_VIDEO=!0,y_.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&r&&(y_.ENABLE_AUT_CC=!0)))}function _r(e){return y_[e]}$W||(y_.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],y_.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],y_.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],y_.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],y_.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],y_.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],y_.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",y_.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",y_.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",y_.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",y_.AREAS=["NORTH_AMERICA","OVERSEA"]);var BI={},RE=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(RE||{}),b8=class{constructor(r,i,o,s){n_(this,"state",void 0),this.state={codec:r,audioCodec:i,mode:o,clientId:s,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:NO.Default}}dispatch(r){this.state=function(i,o){switch(o.type){case RE.SET_SESSION_ID:return sE(sE({},i),{},{sessionId:o.sessionId});case RE.SET_P2P_ID:return sE(sE({},i),{},{p2pId:o.p2pId});case RE.SET_UID:return sE(sE({},i),{},{uid:o.uid});case RE.SET_INT_UID:return sE(sE({},i),{},{intUid:o.intUid});case RE.SET_PUB_ID:return sE(sE({},i),{},{pubId:o.pubId});case RE.KEY_METRIC_CLIENT_CREATED:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{clientCreated:o.metric})});case RE.KEY_METRIC_JOIN_START:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{joinStart:o.metric})});case RE.AVOID_JOIN_START:return sE(sE({},i),{},{avoidJoinStart:o.avoidJoinStart});case RE.KEY_METRIC_JOIN_END:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{joinEnd:o.metric})});case RE.KEY_METRIC_REQUEST_AP_START:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{requestAPStart:o.metric})});case RE.KEY_METRIC_REQUEST_AP_END:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{requestAPEnd:o.metric})});case RE.KEY_METRIC_JOIN_GATEWAY_START:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{joinGatewayStart:o.metric})});case RE.KEY_METRIC_JOIN_GATEWAY_END:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{joinGatewayEnd:o.metric})});case RE.KEY_METRIC_PEER_CONNECTION_START:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{peerConnectionStart:o.metric})});case RE.KEY_METRIC_PEER_CONNECTION_END:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{peerConnectionEnd:o.metric})});case RE.KEY_METRIC_DESCRIPTION_START:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{descriptionStart:o.metric})});case RE.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{signalChannelOpen:o.metric})});case RE.KEY_METRIC_ICE_CONNECTION_END:return sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{iceConnectionEnd:o.metric})});case RE.KEY_METRIC_PUBLISH:{let s=i.keyMetrics.publish,l=s.findIndex(d=>d.trackId===o.metric.trackId);return l!==-1?(s[l]=sE(sE({},s[l]),o.metric),sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{publish:[...s]})})):sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{publish:[...i.keyMetrics.publish,o.metric]})})}case RE.KEY_METRIC_SUBSCRIBE:{let s=i.keyMetrics.subscribe,l=s.findIndex(d=>d.userId===o.metric.userId&&d.type===o.metric.type);return l!==-1?(s[l]=sE(sE({},s[l]),o.metric),sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{subscribe:[...s]})})):sE(sE({},i),{},{keyMetrics:sE(sE({},i.keyMetrics),{},{subscribe:[...i.keyMetrics.subscribe,o.metric]})})}case RE.SET_CLOUD_PROXY_SERVER_MODE:return i.cloudProxyServerMode=o.mode,i;case RE.RECORD_JOIN_CHANNEL_SERVICE:return typeof o.index!="number"?i.joinChannelServiceRecords=[...i.joinChannelServiceRecords,o.record]:(i.joinChannelServiceRecords[o.index]=sE(sE({},i.joinChannelServiceRecords[o.index]),o.record),i.joinChannelServiceRecords=[...i.joinChannelServiceRecords]),i;case RE.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return i.joinChannelServiceRecords=[],i;case RE.RESET_KEY_METRICS:return i.keyMetrics={publish:[],subscribe:[]},i;case RE.SET_USE_P2P:return sE(sE({},i),{},{useP2P:o.val});case RE.SET_TRANSPORT_TYPE:return sE(sE({},i),{},{p2pTransport:o.val});default:return i}}(this.state,r)}set sessionId(r){this.dispatch({type:RE.SET_SESSION_ID,sessionId:r})}get sessionId(){return this.state.sessionId}set codec(r){this.state.codec=r}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(r){this.dispatch({type:RE.SET_P2P_ID,p2pId:r})}get p2pId(){return this.state.p2pId}set dcId(r){this.dispatch({type:RE.SET_DC_ID,dcId:r})}get dcId(){return this.state.dcId}set uid(r){this.dispatch({type:RE.SET_UID,uid:r})}get uid(){return this.state.uid}set intUid(r){this.dispatch({type:RE.SET_INT_UID,intUid:r})}get intUid(){return this.state.intUid}set pubId(r){this.dispatch({type:RE.SET_PUB_ID,pubId:r})}get pubId(){return this.state.pubId}set cloudProxyServerMode(r){this.dispatch({type:RE.SET_CLOUD_PROXY_SERVER_MODE,mode:r})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(r){this.dispatch({type:RE.SET_USE_P2P,val:r})}get useP2P(){return this.state.useP2P}set p2pTransport(r){this.dispatch({type:RE.SET_TRANSPORT_TYPE,val:r})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:RE.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:RE.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:RE.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:RE.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:RE.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:RE.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:RE.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:RE.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:RE.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:RE.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:RE.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:RE.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(r,i,o,s){this.dispatch({type:RE.KEY_METRIC_PUBLISH,metric:sE(sE({trackId:r,type:i},o&&{publishStart:o}),s&&{publishEnd:s})})}subscribe(r,i,o,s,l,d,h){this.dispatch({type:RE.KEY_METRIC_SUBSCRIBE,metric:sE(sE(sE(sE(sE({userId:r,type:i},o&&{subscribeStart:o}),s&&{subscribeEnd:s}),l&&{firstFrame:l}),d&&{streamAdded:d}),h&&{firstDecoded:h})})}massSubscribe(r,i,o,s){r.forEach(l=>{this.dispatch({type:RE.KEY_METRIC_SUBSCRIBE,metric:sE(sE(sE({userId:l.userId,type:l.type},i&&{subscribeStart:i}),o&&{subscribeEnd:o}),s&&{firstFrame:s})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(r,i){r.service==="gateway"&&Array.isArray(r.urls)&&(r.urls=r.urls.map(o=>o.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof i!="number"?(this.dispatch({type:RE.RECORD_JOIN_CHANNEL_SERVICE,record:sE(sE({},r),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(i<0||i>=this.state.joinChannelServiceRecords.length||this.dispatch({type:RE.RECORD_JOIN_CHANNEL_SERVICE,record:r,index:i}),i)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:RE.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:RE.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(r){this.dispatch({type:RE.AVOID_JOIN_START,avoidJoinStart:r})}},pV=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});var QQ=128,eTt=96,ZQ=1e3,zN=10,nTt=0;function __(e,r,i){return(r=function(o){var s=function(l,d){if(typeof l!="object"||!l)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var p=h.call(l,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(o);return typeof s=="symbol"?s:s+""}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function $Q(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function yE(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?$Q(Object(i),!0).forEach(function(o){__(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$Q(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var ast=new class extends s_{constructor(){super(...arguments),__(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:r}=e;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",e))}},R8=class{constructor(r){__(this,"logger",void 0),__(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}};function m6(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function tZ(){let e=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?r?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}var qS={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},HM=Date.now(),SD=e=>{for(let r in qS)if(Object.prototype.hasOwnProperty.call(qS,r)&&qS[r]===e)return r;return"DEFAULT"},B=new class{constructor(){__(this,"proxyServerURL",void 0),__(this,"logLevel",qS.DEBUG),__(this,"uploadState","collecting"),__(this,"uploadLogWaitingList",[]),__(this,"uploadLogUploadingList",[]),__(this,"uploadErrorCount",0),__(this,"currentLogID",0),__(this,"url",void 0),__(this,"extLog",(e,r)=>{this.appendLogToWaitingList(e,...r)})}debug(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=[qS.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=[qS.INFO].concat(r);this.log.apply(this,o)}warning(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=[qS.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=[qS.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];let o=[qS.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){WE("UPLOAD_LOG",!0)}disableLogUpload(){WE("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new R8(this).prefix(e)}log(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-HM<100)return void setTimeout(()=>{this.log(...r)},Date.now()-HM);let o=Math.max(0,Math.min(4,r[0]));if(r[0]=m6()+" Agora-SDK [".concat(SD(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;let s=m6()+" %cAgora-SDK [".concat(SD(o),"]:"),l=[];if(!_r("USE_NEW_LOG"))switch(o){case qS.DEBUG:l=[s,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,l);break;case qS.INFO:l=[s,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,l);break;case qS.WARNING:l=[s,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,l);break;case qS.ERROR:l=[s,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,l)}}uploadLog(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-HM<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-HM);let o=Math.max(0,Math.min(4,r[0]));r[0]=m6()+" Agora-SDK [".concat(SD(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(e){if(!_r("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=tZ()+" Agora-SDK [".concat(SD(e),"]:"):i[0]=tZ()+" Agora-SDK [".concat(SD(e),"]:");let s="";i.forEach(l=>{typeof l=="object"&&(l=JSON.stringify(l)),s+="".concat(l," ")}),this.uploadLogWaitingList.push({payload_str:s,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,r={sdk_version:XS,process_id:_r("PROCESS_ID"),payload:JSON.stringify(e)};return $T(async()=>{let i=await K0.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(_r("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(_r("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){let o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{let o={status:-1,message:i.message,errorRange:e.map(s=>s.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),ast.reportLogUploadError(o),!0},{timeout:_r("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:_r("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,_r("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),_r("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),_r("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),_r("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},eZ;function rTt(e){return _g(e.reportId,"params.reportId",0,100,!1),_g(e.category,"params.category",0,100,!1),_g(e.event,"params.event",0,100,!1),_g(e.label,"params.label",0,100,!1),HE(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(eZ={}).FREE="free",eZ.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});var iTt={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},Eg=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),d_=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});var oTt=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function pE(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,o){let s=o.value;if(typeof s=="function"){let l=e.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];let f=h;if(e.argsMap)try{f=e.argsMap(this,...h)}catch(g){B.warning(g),f=[]}try{JSON.stringify(f)}catch{B.warning("arguments for method ".concat(l,".").concat(String(i)," not serializable for apiInvoke.")),f=[]}let _=(e.report||aE).reportApiInvoke(this._sessionId||null,{name:"".concat(l,".").concat(String(i)),options:f,tag:p_.TRACER,reportResult:e.reportResult},e.throttleTime);try{let g=s.apply(this,h);return g instanceof eE?g.then(b=>(_.onSuccess(e.reportResult&&b),b)).catch(b=>{throw _.onError(b),b}):(_.onSuccess(e.reportResult&&g),g)}catch(g){throw _.onError(g),g}}}return o}}var aE=new class{constructor(){__(this,"baseInfoMap",new Map),__(this,"proxyServer",void 0),__(this,"eventUploadTimer",void 0),__(this,"setSessionIdTimer",void 0),__(this,"url",void 0),__(this,"sids",new Set),__(this,"backupUrl",void 0),__(this,"_appId",void 0),__(this,"keyEventUploadPendingItems",[]),__(this,"normalEventUploadPendingItems",[]),__(this,"apiInvokeUploadPendingItems",[]),__(this,"apiInvokeCount",0),__(this,"ltsList",[]),__(this,"lastSendNormalEventTime",Date.now()),__(this,"customReportCounterTimer",void 0),__(this,"customReportCount",0),__(this,"extApiInvoke",async e=>{for(let r of e){let i=yE(yE({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:p_.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),_r("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),_r("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void B.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));let r=this.baseInfoMap.get(e),i=Date.now(),o=r.startTime;r.startTime=i,B.debug("rewrite session ".concat(e," startTime: ").concat(i," , ").concat(i-o,"ms")),this.baseInfoMap.set(e,r)}setAppId(e){this._appId=e}reportApiInvoke(e,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;let o=Date.now();this.apiInvokeCount+=1;let s=this.apiInvokeCount,l=()=>({tag:r.tag,invokeId:s,sid:e,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null}),d=!!_r("SHOW_REPORT_INVOKER_LOG");d&&B.info("".concat(r.name," start"),r.options);let h=!1;_y(r.timeout).then(()=>{h||(this.sendApiInvoke(yE(yE({},l()),{},{error:Vt.API_INVOKE_TIMEOUT,success:!1})),B.debug("".concat(r.name," timeout")))});let p=new _u(Vt.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:f=>{let _=()=>{if(h)throw p;return h=!0,this.sendApiInvoke(yE(yE({},l()),{},{success:!0},r.reportResult&&{result:f})),d&&B.info("".concat(r.name," onSuccess")),f};return i?zQ(_,r.name+"Success",i,()=>h=!0):_()},onError:f=>{let _=()=>{if(h)throw f;h=!0,this.sendApiInvoke(yE(yE({},l()),{},{success:!1,error:f})),d&&B.info("".concat(r.name," onFailure"),f.toString())};return i?zQ(_,r.name+"Error",i,()=>h=!0):_()}}}sessionInit(e,r){if(this.baseInfoMap.has(e))return;let i=Date.now(),o=this.createBaseInfo(e,i);o.cname=r.cname;let s=Object.assign({},{willUploadConsoleLog:_r("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:$W?"global":"oversea",areas:_r("AREAS")&&_r("AREAS").join(",")},r.extend),{stringUid:l,channelProfile:d,channelMode:h,isABTestSuccess:p,lsid:f,clientRole:_}=r,g=Date.now(),b=yE(yE({},o),{},{eventType:Eg.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:eH,lts:g,elapse:g-i,extend:JSON.stringify(s),mode:r.mode,process:_r("PROCESS_ID"),appType:_r("APP_TYPE"),success:!0,version:XS,stringUid:l,channelProfile:d,channelMode:h,isABTestSuccess:p,lsid:f,clientType:nE(C=window.navigator.userAgent).call(C,"AgoraWebView")?42:20,clientRole:_,serviceId:_r("PROCESS_ID"),extensionID:_r("PLUGIN_INFO").join(",")||""});var C;this.send({type:d_.SESSION,data:b},!0)}joinChooseServer(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE({},o),{},{eventType:Eg.JOIN_CHOOSE_SERVER,lts:s,eventElapse:r.elapse||s-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:s-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:d_.JOIN_CHOOSE_SERVER,data:l},!0)}reqUserAccount(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE({},o),{},{eventType:Eg.REQ_USER_ACCOUNT,lts:s,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||s-i.startTime,eventElapse:s-r.lts,extend:JSON.stringify(r.extend)});this.send({type:d_.REQ_USER_ACCOUNT,data:l},!0)}joinGateway(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;let s=Date.now(),{firstSuccess:l,avoidJoinStartTime:d}=r,h=s-(l&&d?d:i.startTime),p=yE(yE({},o),{},{eventType:Eg.JOIN_GATEWAY,lts:s,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:h,eventElapse:s-r.lts,firstSuccess:l,signalChannel:r.signalChannel,preload:r.preload?1:0});r.succ&&(i.lastJoinSuccessTime=s),this.send({type:d_.JOIN_GATEWAY,data:p},!0)}joinChannelTimeout(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=Date.now(),s=yE(yE({},i.info),{},{lts:o,timeout:r,elapse:o-i.startTime});this.send({type:d_.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE({},o),{},{eventType:Eg.PUBLISH,lts:s,eventElapse:r.eventElapse,elapse:s-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:d_.PUBLISH,data:l},!0)}subscribe(e,r,i){let o=this.baseInfoMap.get(e);if(!o)return;let s=o.info,l=Date.now(),d=yE(yE({},s),{},{eventType:Eg.SUBSCRIBE,lts:l,eventElapse:r.eventElapse,elapse:l-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?d.peerSuid=r.peerid:d.peer=r.peerid,this.send({type:d_.SUBSCRIBE,data:d},!0)}wsCompressorInit(e){var r;let i=[...RS(r=this.baseInfoMap).call(r)],o=i.length?i[0]:"UnableToGetSid",s=this.baseInfoMap.get(o);if(!s)return;let l=s.info,d=Date.now(),h=yE(yE({},l),{},{eventType:Eg.WS_COMPRESSOR_INIT,lts:d,eventElapse:e.eventElapse,elapse:d-s.startTime,status:e.status?1:2});this.send({type:d_.WS_COMPRESSOR_INIT,data:h},!0)}firstRemoteVideoDecode(e,r,i,o){let s=this.baseInfoMap.get(e);if(!s)return;let l=s.info,d=Date.now(),h=yE(yE(yE({},l),o),{},{elapse:d-s.startTime,eventType:r,lts:d,firstDecodeFrame:Math.max((o.firstFrame||d)-s.startTime,0),apEnd:Math.max(o.apEnd-s.startTime,0),apStart:Math.max(o.apStart-s.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-s.startTime,0),joinGwStart:Math.max(o.joinGwStart-s.startTime,0),pcEnd:Math.max(o.pcEnd-s.startTime,0),pcStart:Math.max(o.pcStart-s.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-s.startTime,0),subscriberStart:Math.max(o.subscriberStart-s.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-s.startTime,0)});this.send({type:i,data:h},!0)}firstRemoteFrame(e,r,i,o){let s=this.baseInfoMap.get(e);if(!s)return;let l=s.info,d=Date.now(),h=yE(yE(yE({},l),o),{},{elapse:d-s.startTime,eventType:r,lts:d});this.send({type:i,data:h},!0)}pcStats(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE(yE({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:s-i.startTime,eventType:Eg.PC_STATS,lts:s,preallocation:r.preallocation?1:0});this.send({type:d_.PC_STATS,data:l},!0)}updateRemoteRTPCapabilities(e,r){if(e){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE(yE({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Eg.UPDATE_REMOTE_RTPCAPABILITIES,lts:s});this.send({type:d_.UPDATE_REMOTE_RTPCAPABILITIES,data:l},!0)}}onGatewayStream(e,r,i,o){let s=this.baseInfoMap.get(e);if(!s)return;let l=s.info,d=Date.now(),h=yE(yE(yE({},l),o),{},{eventType:r,lts:d});this.send({type:i,data:h},!0)}streamSwitch(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE({},o),{},{eventType:Eg.STREAM_SWITCH,lts:s,isDual:r.isdual,elapse:s-i.startTime,success:r.succ});this.send({type:d_.STREAM_SWITCH,data:l},!0)}requestProxyAppCenter(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE({},o),{},{eventType:Eg.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-r.lts,elapse:s-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:d_.REQUEST_PROXY_APPCENTER,data:l},!0)}requestProxyWorkerManager(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE({},o),{},{eventType:Eg.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-r.lts,elapse:s-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:d_.REQUEST_PROXY_WORKER_MANAGER,data:l},!0)}setProxyServer(e){this.proxyServer=e,e?B.debug("reportProxyServerurl: ".concat(e)):B.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:s,elapse:s-i.startTime,joinChannelSuccessElapse:s-(i.lastJoinSuccessTime||s),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:d_.PEER_PUBLISH_STATUS,data:l},!0)}workerEvent(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now();(function(l,d,h){let p=l[d];if(!p||typeof p!="string")return[l];l[d]="";let f=SR(JSON.stringify(l)),_=0,g=[],b=0;for(let C=0;C<p.length;C++)b+=p.charCodeAt(C)<=127?1:3,b<=h-f||(g[g.length]=sE(sE({},l),{},{[d]:p.substring(_,C)}),_=C,b=p.charCodeAt(C)<=127?1:3);return _!==p.length-1&&(g[g.length]=sE(sE({},l),{},{[d]:p.substring(_)})),g})(yE(yE(yE({},o),r),{},{elapse:s-i.startTime,lts:s,productType:"WebRTC"}),"payload",1300).forEach(l=>this.send({type:d_.WORKER_EVENT,data:l},!0))}apworkerEvent(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE(yE({},o),r),{},{elapse:s-i.startTime,lts:s});this.send({type:d_.AP_WORKER_EVENT,data:l},!0)}joinWebProxyAP(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE(yE({},o),r),{},{elapse:s-i.startTime,lts:s,extend:r.extend||void 0});this.send({type:d_.JOIN_WEB_PROXY_AP,data:l},!0)}WebSocketQuit(e,r){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,s=Date.now(),l=yE(yE(yE({},o),r),{},{elapse:s-i.startTime,lts:s});this.send({type:d_.WEBSOCKET_QUIT,data:l},!0)}async sendCustomReportMessage(e,r){if(this.customReportCount+=r.length,this.customReportCount>_r("CUSTOM_REPORT_LIMIT"))throw new _u(Vt.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let i=Date.now(),o=r.map(s=>({type:d_.USER_ANALYTICS,data:yE(yE({sid:e},s),{},{lts:i})}));try{_r("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(s){throw B.error("send custom report message failed",s.toString()),new _u(Vt.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(e){let r=_r("NOT_REPORT_EVENT");if(e.tag&&nE(r)&&nE(r).call(r,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;let i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:o,uid:s,cid:l}=i.info,d;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof _u){let{code:p,message:f}=e.error;d=p||f||e.error.toString()}else d=e.error.toString();let h={invokeId:e.invokeId,sid:e.sid,cname:o,cid:l,uid:s,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?d:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:d_.API_INVOKE,data:h},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(e.length===0)return;let r=Array.from(this.sids).find(i=>i!==null);r&&e.forEach(i=>{i&&(i.sid=r,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,r){if(r)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>_r("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,r){let i=[],o=[];for(;e.length;){let l=e.shift();i.length<20?i.push(l):o.push(l)}e.push(...o);for(let l of[...i]){var s;this.ltsList.indexOf(l.data.lts)!==-1?(l.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(l.data.lts)):(this.ltsList.push(l.data.lts),HL(s=this.ltsList).call(s,(d,h)=>d-h))}return r||(this.lastSendNormalEventTime=Date.now()),_r("ENABLE_EVENT_REPORT")&&i.length&&(_r("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((l=>d=>{_r("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(l):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(l),this.normalEventUploadPendingItems.length>_r("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-_r("NORMAL_EVENT_QUEUE_CAPACITY")),B.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){I_.networkState===dS.OFFLINE&&await eE.race([I_.onlineWaiter,_y(2*N_.maxRetryTimeout)]);let r=s=>{let l=new Uint8Array;return s.forEach(d=>{let h=QW(JSON.stringify(d.data)),p=new ArrayBuffer(5),f=(g=>{let b=0;return Object.entries(d_).forEach(C=>{let[k,A]=C;A===g.type&&(b=oTt[k])}),b})(d),_=new DataView(p);_.setUint16(0,h.byteLength,!0),_.setUint8(2,255&f),_.setUint8(3,f>>>8&255),_.setUint8(4,f>>>16&255),l=BQ(l,new Uint8Array(p)),l=BQ(l,h)}),l},i="event",o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_r("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(_r("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let s=0;s<2;s+=1){s===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_r("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(_r("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await T8(o,{timeout:1e4,data:r(e),headers:yE(yE({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(l){if(s===1)throw l;continue}return}}async postDataToStatsCollector(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(l=>JSON.stringify(l)),vid:(l=>{let d=l&&l.data.sid&&this.baseInfoMap.get(l.data.sid);return d&&d.info.vid&&+d.info.vid||0})(e[0])};I_.networkState===dS.OFFLINE&&await eE.race([I_.onlineWaiter,_y(2*N_.maxRetryTimeout)]);let o=r?"/events/proto-raws":"/events/messages",s=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_r("EVENT_REPORT_DOMAIN"),"&p=").concat(_r("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(_r("EVENT_REPORT_DOMAIN"),":").concat(_r("STATS_COLLECTOR_PORT")).concat(o));for(let l=0;l<2;l+=1){l===1&&(s=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_r("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(_r("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(_r("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(_r("STATS_COLLECTOR_PORT")).concat(o)));try{r?await tTt(s,{timeout:1e4,data:i}):await T8(s,{timeout:1e4,data:i})}catch(d){if(l===1)throw d;continue}return}}createBaseInfo(e,r){let i=Object.assign({},iTt);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:r}),i}reportResourceTiming(e,r){let i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:p_.TRACER}).onSuccess()}};ast.on("REPORT_LOG_UPLOAD",e=>{e.networkState=I_.networkState,aE.reportApiInvoke(null,{name:"logUploadError",options:e,tag:p_.TRACER}).onSuccess("logUploadError")});var _a=class extends _u{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),__(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,B)}throw(){super.throw(B)}},sTt=["CHINA","GLOBAL"],cst=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],MO=[];function RO(e,r){return!!r&&MO.some(i=>i.uid===e&&i.channelName===r)}var aTt=not.forEach,nZ=K3("forEach")?[].forEach:function(e){return aTt(this,e,arguments.length>1?arguments[1]:void 0)};zE({target:"Array",proto:!0,forced:[].forEach!=nZ},{forEach:nZ});var cTt=CT("Array").forEach,uTt=OR,lTt=m0,dTt=j0,hTt=cTt,E6=Array.prototype,pTt={DOMTokenList:!0,NodeList:!0},fTt=function(e){var r=e.forEach;return e===E6||dTt(E6,e)&&r===E6.forEach||lTt(pTt,uTt(e))?hTt:r},mTt=m_(fTt),ETt=AR,rZ=X3;zE({target:"Object",stat:!0,forced:M_(function(){rZ(1)})},{keys:function(e){return rZ(ETt(e))}});var ust=m_(ZS.Object.keys),_Tt=m_(drt),gTt=zE,vTt=KL,yTt=k_([].reverse),iZ=[1,2];gTt({target:"Array",proto:!0,forced:String(iZ)===String(iZ.reverse())},{reverse:function(){return vTt(this)&&(this.length=this.length),yTt(this)}});var STt=CT("Array").reverse,TTt=j0,bTt=STt,_6=Array.prototype,RTt=function(e){var r=e.reverse;return e===_6||TTt(_6,e)&&r===_6.reverse?bTt:r},lst=RTt,wTt=m_(lst),ITt=zE,oZ=KL,CTt=$3,ATt=PS,sZ=fW,OTt=rI,NTt=tO,kTt=rV,PTt=C_,DTt=tV,LTt=Zit("slice"),MTt=PTt("species"),g6=Array,UTt=Math.max;ITt({target:"Array",proto:!0,forced:!LTt},{slice:function(e,r){var i,o,s,l=NTt(this),d=OTt(l),h=sZ(e,d),p=sZ(r===void 0?d:r,d);if(oZ(l)&&(i=l.constructor,(CTt(i)&&(i===g6||oZ(i.prototype))||ATt(i)&&(i=i[MTt])===null)&&(i=void 0),i===g6||i===void 0))return DTt(l,h,p);for(o=new(i===void 0?g6:i)(UTt(p-h,0)),s=0;h<p;h++,s++)h in l&&kTt(o,s,l[h]);return o.length=s,o}});var xTt=CT("Array").slice,jTt=j0,VTt=xTt,v6=Array.prototype,FTt=function(e){var r=e.slice;return e===v6||jTt(v6,e)&&r===v6.slice?VTt:r},BTt=m_(FTt);function oE(e,r,i,o,s){var l,d,h,p={};return mTt(l=ust(o)).call(l,function(f){p[f]=o[f]}),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=_Tt(d=wTt(h=BTt(i).call(i)).call(h)).call(d,function(f,_){return _(e,r,f)||f},p),s&&p.initializer!==void 0&&(p.value=p.initializer?p.initializer.call(s):void 0,p.initializer=void 0),p.initializer===void 0&&(Xit(e,r,p),p=null),p}var w8=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),yS=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),PU=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),y6=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),cT=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),k0=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),hE=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),QE=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),EE=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),mE=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),vL=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),wE=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),L0=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),_E=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function fV(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw B.error("Invalid Channel Name ".concat(e)),new _a(Vt.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function mV(e){if(!function(r){return typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295}(e)&&!tst(e,1,255))throw new _a(Vt.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof e=="string"&&B.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}var ER=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),GTt={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},S6={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function T6(e,r){_g(e.url,"".concat(r,".url"),1,1e3,!1),l_(e.x)||HE(e.x,"".concat(r,".x"),0,1e4),l_(e.y)||HE(e.y,"".concat(r,".y"),0,1e4),l_(e.width)||HE(e.width,"".concat(r,".width"),0,1e4),l_(e.height)||HE(e.height,"".concat(r,".height"),0,1e4),l_(e.zOrder)||HE(e.zOrder,"".concat(r,".zOrder"),0,255),l_(e.alpha)||HE(e.alpha,"".concat(r,".alpha"),0,1,!1)}var qTt={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},jI=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),I8=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),P_=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function aZ(e){if(!e.channelName)throw new _a(Vt.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new _a(Vt.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&_g(e.token,"info.token",1,2047),mV(e.uid),fV(e.channelName),!0}var P0=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),zR=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),tS=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),a1=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),VE=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),r0=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e}({}),DU=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),q_=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),xE=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),cZ=[xE.AFRICA,xE.ASIA,xE.CHINA,xE.EUROPE,xE.GLOBAL,xE.INDIA,xE.JAPAN,xE.NORTH_AMERICA,xE.OCEANIA,xE.OVERSEA,xE.SOUTH_AMERICA],h0=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),EV={CHINA:{},ASIA:{CODE:h0.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:h0.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:h0.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:h0.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:h0.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:h0.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:h0.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:h0.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:h0.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:h0.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:h0.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:h0.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:h0.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};$W&&(EV.CHINA={CODE:h0.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});var C8=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({}),o3=class extends s_{constructor(r,i){super(),$(this,"onICEConnectionStateChange",void 0),$(this,"onConnectionStateChange",void 0),$(this,"onDTLSTransportStateChange",void 0),$(this,"onDTLSTransportError",void 0),$(this,"onICETransportStateChange",void 0),$(this,"onFirstAudioReceived",void 0),$(this,"onFirstVideoReceived",void 0),$(this,"onFirstAudioDecoded",void 0),$(this,"onFirstVideoDecoded",void 0),$(this,"onFirstVideoDecodedTimeout",void 0),$(this,"onSelectedLocalCandidateChanged",void 0),$(this,"onSelectedRemoteCandidateChanged",void 0),$(this,"getLocalVideoStats",void 0)}},s3=class extends o3{constructor(r,i){super(r,i),$(this,"establishPromise",void 0)}},cE=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),hS=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),qR=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),_m=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),jE=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),fE=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),mT=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),uT=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),J_=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),dst=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),_R=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),GS=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),KT=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),YN=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),v_=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),JN=function(e){return e.ABORT="abort",e}({}),GI=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),WTt=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),HTt={[PU.ACCESS_POINT]:{[k0.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[k0.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[k0.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[k0.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[k0.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[k0.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[k0.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[PU.UNILBS]:{[cT.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[cT.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[cT.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[cT.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[cT.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[cT.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[cT.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[cT.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[cT.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[cT.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[cT.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[cT.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[PU.STRING_UID_ALLOCATOR]:{[y6.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[y6.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[y6.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function M1(e){let r=HTt[Math.floor(e/1e4)];if(!r)return{desc:"unknown error",retry:!1};let i=r[e%1e4];if(!i){if(Math.floor(e/1e4)===PU.ACCESS_POINT){let o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}var KTt={[hE.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[hE.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[hE.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[hE.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[hE.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[hE.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[hE.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[hE.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[hE.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[hE.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[hE.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[hE.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[hE.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[hE.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[hE.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[hE.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[hE.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[hE.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[hE.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[hE.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[hE.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[hE.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[hE.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[hE.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[hE.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[hE.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[hE.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[hE.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[hE.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[hE.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[hE.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[hE.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[hE.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[hE.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[hE.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[hE.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[hE.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[hE.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[hE.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[hE.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[hE.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[hE.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[hE.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[hE.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[hE.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[hE.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[hE.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[hE.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[hE.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[hE.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[hE.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[hE.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[hE.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[hE.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[hE.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[hE.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[hE.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[hE.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[hE.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[hE.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[hE.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[hE.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[hE.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function yL(e){return KTt[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function uZ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function b6(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?uZ(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):uZ(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function lZ(e){return e.every(r=>r.readyState===WebSocket.CLOSED||r.readyState===WebSocket.CLOSING)}function dZ(e,r){if(typeof e=="string")return e;let{proxy:i,host:o,port:s}=e;if(r){let l=_r("JOIN_GATEWAY_FALLBACK_PORT")||443;return l===443?"wss://".concat(o,"/ws/?p=").concat(Number(s)+150):"wss://".concat(o,":").concat(l,"/ws/?p=").concat(Number(s)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(s):"wss://".concat(o,":").concat(s)}var zTt=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,YTt=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,JTt=/wss:\/\/(.+):([0-9]+)\/?/,XTt=/wss:\/\/(.[^\/]+)\/?/,QTt=0,A8=class{constructor(r,i){$(this,"id",0),$(this,"store",void 0),$(this,"recordIndex",void 0),$(this,"websockets",[]),$(this,"try443PortDuration",2e3),$(this,"forceCloseWSDuration",5e3),$(this,"try443PortTimeout",null),$(this,"forceCloseTimeout",null),$(this,"isTry443PortFailed",!1),$(this,"isNormalPortFailed",!1),$(this,"useDoubleDomain",!1),$(this,"useProxy",!1),$(this,"startTime",Date.now()),this.id=++QTt,this.try443PortDuration=_r("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var r;let i=Date.now()-this.startTime;for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];B.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...s)}createWebSocket(r,i,o){this.logger("createWebSocket:",r,{isTry443Port:i,hasTimeoutDetection:o});let s=_r("GATEWAY_DOMAINS"),l=Date.now(),d=[],h=s.find(_=>{var g;return nE(g=r.host).call(g,_)});h||(this.useDoubleDomain=!1);let p=[];if(this.useDoubleDomain)s.forEach(_=>{p.push(dZ(b6(b6({},r),{},{host:r.host.replace(h,_)}),i))});else{let _=b6({},r);if(i&&h){let g=s.find(b=>b!==h);g&&(_.host=_.host.replace(h,g))}p.push(dZ(_,i))}try{p.forEach(_=>{let g=new WebSocket(_);g.binaryType="arraybuffer",d.push(g),this.logger("ws is connecting:",g.url)})}catch(_){if(this.logger("ws create failed"),d.forEach(g=>g.close()),d.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,i,o);if(!i&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new _a(Vt.WS_ERR,"init websocket failed! Error: ".concat(_.toString()))}let f=EL();return this.store&&this.store.recordJoinChannelService({urls:d.map(_=>_.url),service:"gateway"},this.recordIndex),d.forEach(_=>{_.onopen=()=>{this.logger("onopen: ws ".concat(_.url," open cost ").concat(Date.now()-l,"ms")),this.websockets.forEach(g=>{g!==_&&(g.onopen=null,g.onclose=null,g.onmessage=null,g.close(),this.logger("close backup websocket: ".concat(g.url)))}),this.websockets.length=0,f.resolve(_)},_.onclose=g=>{this.logger("onclose: ws ".concat(_.url," closed cost ").concat(Date.now()-l,"ms state: ").concat(_.readyState)),i?this.isTry443PortFailed=lZ(d):this.isNormalPortFailed=lZ(d),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(i&&this.isTry443PortFailed||!i&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(g.reason)),f.reject({code:g.code,reason:DU.A_ROUND_WS_FAILED}))},_.onmessage=g=>this.logger("".concat(_.url," onmessage: ").concat(g.data))}),this.websockets.push(...d),o||(()=>{let _=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",f.isResolved),this.websockets.forEach(g=>g.readyState!==WebSocket.OPEN&&g.close())};if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(_,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",f.isResolved),f.isResolved)return _();DE().os===W_.MAC_OS&&f_()&&_(),this.createWebSocket(r,!0,!0).then(g=>f.resolve(g)).catch(g=>{this.isNormalPortFailed&&f.reject(g),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(_,this.forceCloseWSDuration)},this.try443PortDuration)})(),f.promise}chooseBestWebsocket(r,i,o,s){return this.useDoubleDomain=!!i,typeof r=="string"&&(r=function(l){let d,h,p;return[,d,h,p]=l.match(zTt)||[],d||([,h,p]=l.match(YTt)||[]),h&&p||([,h,p]=l.match(JTt)||[]),h&&p||([,h]=l.match(XTt)||[]),h||B.warning("un-destructible url: ",l),{proxy:d,host:h,port:p||"443"}}(r)),this.recordIndex=s,this.useProxy=!!r.proxy,o&&this.useProxy&&(B.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}};function hZ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}var a3=class extends s_{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;nE(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(_E.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(_E.CONNECTED):this._state==="closed"?this.emit(_E.CLOSED):this._state==="failed"&&this.emit(_E.FAILED))}resetReconnectCount(r){B.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],l=arguments.length>4&&arguments[4]!==void 0&&arguments[4],d=arguments.length>5?arguments[5]:void 0;super(),$(this,"connectionID",0),$(this,"currentURLIndex",0),$(this,"urls",[]),$(this,"_reconnectMode","tryNext"),$(this,"reconnectReason",void 0),$(this,"_initMutex",new f0("websocket")),$(this,"name",void 0),$(this,"_state","closed"),$(this,"reconnectInterrupter",void 0),$(this,"websocket",void 0),$(this,"retryConfig",void 0),$(this,"reconnectCount",0),$(this,"forceCloseTimeout",5e3),$(this,"onlineReconnectListener",void 0),$(this,"useCompress",void 0),$(this,"tryDoubleDomain",!1),$(this,"use443PortOnly",!1),$(this,"wsInflateLength",0),$(this,"wsDeflateLength",0),$(this,"closeEstablishingWs",()=>{}),$(this,"store",void 0),$(this,"joinGatewayRecordIndex",void 0),this.store=d,this.name=r,this.retryConfig=function(g){for(var b=1;b<arguments.length;b++){var C=arguments[b]!=null?arguments[b]:{};b%2?hZ(Object(C),!0).forEach(function(k){$(g,k,C[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(C)):hZ(Object(C)).forEach(function(k){Object.defineProperty(g,k,Object.getOwnPropertyDescriptor(C,k))})}return g}({},i),this.useCompress=o,this.tryDoubleDomain=s,this.use443PortOnly=l;let{timeout:h,timeoutFactor:p}=i,f=Math.max(300,Math.floor(3*h/5)),_=Math.max(1.2,Math.floor(8*p)/10);dS.ONLINE&&(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=_),I_.on(m1.NETWORK_STATE_CHANGE,(g,b)=>{g!==b&&(this.resetReconnectCount("network state change: ".concat(b," -> ").concat(g)),g===dS.ONLINE?(this.retryConfig.timeout=f,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=p))})}getConnection(){return this.websocket||void 0}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,o=await this._initMutex.lock();this.forceCloseTimeout=i,this.urls=r,this.state="connecting";try{let s=EL(),l=this.urls[this.currentURLIndex];_r("ENABLE_PREALLOC_PC")&&this.emit(dst.PRE_CONNECT_PC),this.createWebSocketConnection(l).then(s.resolve).catch(s.reject),this.once(_E.CLOSED,()=>{s.reject(new _u(Vt.WS_DISCONNECT))}),this.once(_E.CONNECTED,s.resolve),await s.promise}catch{}finally{o()}}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void B.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),B.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);let o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new _u(Vt.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new _u(Vt.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){let r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var i;let o=EL();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let s=_=>{var g;(g=this.store)===null||g===void 0||g.signalChannelOpen(),B.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},l=async _=>{var g;if(B.debug("[".concat(this.name,"] websocket close ").concat((g=this.websocket)===null||g===void 0?void 0:g.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new _u(Vt.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");let b=JS(this,_E.WILL_RECONNECT,this.reconnectMode,_.reason)||this.reconnectMode,C=await this.reconnectWithAction(b);if(this.state==="closed")return void B.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!C)return o.reject(new _u(Vt.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),this.close(!0);o.resolve()}},d=_=>{this.emit(_E.ON_MESSAGE,_)},h=_=>{B.warn("[".concat(this.connectionID,"] ws open error ").concat(_))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),_r("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=_r("GATEWAY_WSS_ADDRESS")),B.debug("[".concat(this.name,"] start connect, url:"),r);let p=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var f;let _=await this.chooseBestWebsocketConnection(r);this.websocket=_,s&&s(this.websocket.url),this.websocket.onclose=l,this.websocket.onmessage=d,this.websocket.onerror=h,(f=this.store)===null||f===void 0||f.recordJoinChannelService({endTs:Date.now(),status:"success"},p),this.joinGatewayRecordIndex=p}catch(_){let g=this.state==="closed",b=_ instanceof _u,C=b&&_.code===Vt.WS_ABORT,k=b&&_.code===Vt.WS_ERR,A=b?_.message:_&&(_.reason||_.toString());B.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(A)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:C?"aborted":"error",errors:[_]},p),g||k?(o.reject(g?new _u(Vt.WS_DISCONNECT,"websocket is closed: ".concat(A)):new _u(Vt.WS_ERR,"init websocket failed: ".concat(A))),k&&B.error("[".concat(this.name,"] init websocket failed: ").concat(A))):l&&l(_)}return o.promise}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;B.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||I_.isOnline||!I_.onlineWaiter||(this.onlineReconnectListener=I_.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){let d=ZW(this.reconnectCount,this.retryConfig);B.debug("[".concat(this.name,"] wait ").concat(d,"ms to reconnect websocket, mode: ").concat(r)),await eE.race([_y(d),this.onlineReconnectListener||new eE(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;let s=async(d,h)=>{this.emit(_E.RECONNECT_CREATE_CONNECTION,h),await this.createWebSocketConnection(d)};try{if(r==="retry")this.emit(_E.RECONNECT_WAITTING_FINISH,r),await s(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);B.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(_E.RECONNECT_WAITTING_FINISH,r),await s(this.urls[this.currentURLIndex],r)}else r==="recover"&&(B.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(_E.RECONNECT_WAITTING_FINISH,r),this.urls=await c0(this,_E.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],r))}catch(d){var l;B.error("[".concat(this.name,"] reconnect failed ").concat(d&&d.toString()));let h=d==null||(l=d.data)===null||l===void 0?void 0:l.desc;return Array.isArray(h)&&nE(h).call(h,"dynamic key expired")?(this.emit(_E.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,i)}return!0}},SL=class extends a3{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){let o=EL(),s=function(d,h){return new A8(d,h)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{B.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),o.reject(new _u(Vt.WS_ABORT,"choose best websocket aborted"))};let l=_r("GATEWAY_DOMAINS");return B.debug("[choose-best-ws] currentDomain: ",r,", domains: ",l,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}},eN=class extends a3{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){return new eE((o,s)=>{let l=!1,d=[];this.closeEstablishingWs=()=>{B.debug("[choose-best-ws] close establishing websockets"),d.forEach(k=>{k.onclose=null,k.onopen=null,k.onmessage=null,k.close()}),s(new _u(Vt.WS_ABORT,"choose best websocket aborted"))};let h=_r("GATEWAY_DOMAINS"),p,f=r.indexOf("?h="),_=h.find(k=>f!==-1?nE(r).call(r,k,f):nE(r).call(r,k));B.debug("[choose-best-ws] currentDomain: ",_,", domains: ",h);let g=!this.tryDoubleDomain||!_;if(!g&&_){var b;let k=Date.now();try{h.forEach(A=>{let P=f===-1?r.replace(_,A):r.substr(0,f)+r.substr(f).replace(_,A),x=new WebSocket(P);x.binaryType="arraybuffer",d.push(x),B.debug("[choose-best-ws] ws is connecting:",x.url)})}catch{for(B.debug("[choose-best-ws] ws create failed, fallback to single url"),d.forEach(P=>P.close());d.length;)d.pop();g=!0}(b=this.store)===null||b===void 0||b.recordJoinChannelService({urls:d.map(A=>A.url),service:"gateway"},i),d.forEach(A=>{A.onopen=()=>{if(l)return;let P=Date.now()-k;B.debug("[choose-best-ws] ws open cost ".concat(P,"ms")),d.filter(x=>x!==A).forEach(x=>{B.debug("[choose-best-ws]close backup websocket: ".concat(x.url)),x.close()}),l=!0,o(A)},A.onclose=P=>{p=P,!l&&(d.find(x=>!(x.readyState===WebSocket.CLOSED||x.readyState===WebSocket.CLOSING))||(B.debug("[choose-best-ws] all websocket is closed"),l=!0,s(p)))},A.onmessage=P=>{B.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(P.data))}}),_y(this.forceCloseTimeout).then(()=>{d.forEach(A=>{A.readyState!==WebSocket.OPEN&&A.close()})})}if(g){var C;let k;B.debug("[choose-best-ws] use single url: ",r),(C=this.store)===null||C===void 0||C.recordJoinChannelService({urls:[r],service:"gateway"},i);try{k=new WebSocket(r),d.push(k),k.binaryType="arraybuffer"}catch(A){let P=new _u(Vt.WS_ERR,"init websocket failed! Error: ".concat(A.toString()));return B.error("[".concat(this.name,"]").concat(P)),void s(P)}k.onopen=()=>{o(k)},k.onclose=A=>{s(A)},k.onmessage=A=>{B.debug("[choose-best-ws]".concat(k.url," onmessage: ").concat(A.data))},_y(this.forceCloseTimeout).then(()=>{k&&k.readyState!==WebSocket.OPEN&&k.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}},O8=class extends s_{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===QE.CONNECTED?this.emit(EE.WS_CONNECTED):r===QE.RECONNECTING?this.emit(EE.WS_RECONNECTING,this._websocketReconnectReason):r===QE.CLOSED&&this.emit(EE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",QE.CLOSED),$(this,"reconnectToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new i3(5)),$(this,"pingpongTimer",void 0),$(this,"wsInflateDataTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(EE.ON_BINARY_DATA,o.data);let s=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){let l="res-@".concat(s._id);this.emit(l,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===wE.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===wE.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(GE.UID_BANNED);break;case 15:this.close(GE.IP_BANNED);break;case 16:this.close(GE.CHANNEL_BANNED)}if(s._type===wE.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case hE.ERR_LICENSE_MISSING:this.close(GE.LICENSE_MISSING);break;case hE.ERR_LICENSE_EXPIRED:this.close(GE.LICENSE_EXPIRED);break;case hE.ERR_LICENSE_MINUTES_EXCEEDED:this.close(GE.LICENSE_MINUTES_EXCEEDED);break;case hE.ERR_LICENSE_PERIOD_INVALID:this.close(GE.LICENSE_PERIOD_INVALID);break;case hE.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(GE.LICENSE_MULTIPLE_SDK_SERVICE);break;case hE.ERR_LICENSE_ILLEGAL:this.close(GE.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new SL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,_r("JOIN_GATEWAY_USE_DUAL_DOMAIN"),_r("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===QE.CONNECTED&&this.reconnect("retry",s0.OFFLINE)})}async request(r,i,o,s){let l=ZE(6,""),d={_id:l,_type:r,_message:i},h=this.websocket.connectionID,p=()=>new eE((k,A)=>{if(this.connectionState===QE.CONNECTED)return k();let P=()=>{this.off(EE.WS_CLOSED,x),k()},x=()=>{this.off(EE.WS_CONNECTED,P),A(new _a(Vt.WS_ABORT))};this.once(EE.WS_CONNECTED,P),this.once(EE.WS_CLOSED,x),r!==mE.PUBLISH&&r!==mE.PUBLISH_DATASTREAM&&r!==mE.SUBSCRIBE&&r!==mE.SUBSCRIBE_DATASTREAM&&r!==mE.UNSUBSCRIBE&&r!==mE.UNSUBSCRIBE_DATASTREAM&&r!==mE.UNPUBLISH&&r!==mE.UNPUBLISH_DATASTREAM&&r!==mE.CONTROL&&r!==mE.RESTART_ICE||this.once(EE.DISCONNECT_P2P,()=>{A(new _a(Vt.DISCONNECT_P2P))}),r!==mE.PUBLISH&&r!==mE.RESTART_ICE||this.once(EE.ABORT_P2P_EXECUTION,()=>{A(new _a(Vt.DISCONNECT_P2P))})});if(this.connectionState!==QE.CONNECTING&&this.connectionState!==QE.RECONNECTING||r===mE.JOIN||r===mE.REJOIN||await p(),this.websocket.sendMessage(d,!0),s)return;let f=new eE((k,A)=>{let P=!1,x=(z,_t)=>{P=!0,k({isSuccess:z==="success",message:_t||{}}),this.off(EE.WS_CLOSED,j),this.off(EE.WS_RECONNECTING,j),this.emit(EE.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(l),x);let j=()=>{A(new _a(Vt.WS_ABORT,"type: ".concat(r))),this.off(EE.WS_CLOSED,j),this.off(EE.WS_RECONNECTING,j),this.off("res-@".concat(l),x)};this.once(EE.WS_CLOSED,j),this.once(EE.WS_RECONNECTING,j),_y(_r("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||P||(B.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(EE.REQUEST_TIMEOUT,r,i))})}),_=null;try{_=await f}catch(k){if(this.connectionState===QE.CLOSED||r===mE.LEAVE)throw new _a(Vt.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?k.throw():r===mE.JOIN||r===mE.REJOIN?null:(await p(),await this.request(r,i))}if(_.isSuccess)return _.message;let g=Number(_.message.error_code||_.message.code),b=yL(g),C=new _a(Vt.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(_.message.error_str),{code:g,data:_.message,desc:b.desc});return b.action==="success"?_.message:(B.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(g,", message: ").concat(b.desc,", action: ").concat(b.action)),g===hE.ERR_TOO_MANY_BROADCASTERS?((r===mE.JOIN||r===mE.REJOIN)&&(this.initError=C,this.close()),C.throw()):b.action==="failed"?C.throw():b.action==="quit"?(this.initError=C,this.close(),C.throw()):(g===hE.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,B.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",s0.MULTI_IP)):this.reconnect(b.action,s0.SERVER_ERROR),r===mE.JOIN||r===mE.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new eE(o=>{let s=l=>{(!i||i(l))&&(this.off(r,s),o(l))};this.on(r,s)})}uploadWRTCStats(r){if(!this.store.sessionId)return void B.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(vL.WRTC_STATS,i)}upload(r,i){let o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{let l=_r("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==QE.CONNECTED)return;let d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},_r("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){let o={_type:r,_message:i};this.websocket.sendMessage(o)}init(r,i){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new eE((o,s)=>{this.once(EE.WS_CONNECTED,()=>o(this.joinResponse)),this.once(EE.WS_CLOSED,()=>s(this.initError||new _a(Vt.WS_ABORT))),this.connectionState=QE.CONNECTING,this.websocket.init(r).catch(s),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||GE.LEAVE,this.connectionState=QE.CLOSED,B.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(EE.ABORT_P2P_EXECUTION);let r=await c0(this,EE.REQUEST_JOIN_INFO),i=await this.request(mE.JOIN,r);if(!i)return this.emit(EE.REPORT_JOIN_GATEWAY,DU.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(EE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=QE.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new _a(Vt.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let r=gL(this,EE.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;let i=await this.request(mE.REJOIN,r);return!!i&&(this.connectionState=QE.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(wE.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(wE.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(wE.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(wE.MUTE_AUDIO,{uid:o.uid}):this.emit(wE.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(wE.MUTE_VIDEO,{uid:o.uid}):this.emit(wE.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(wE.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(wE.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(wE.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(wE.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(wE.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleNotification(r){B.debug("[".concat(this.clientId,"] receive notification: "),r);let i=yL(r.code);if(r.code===28&&"detail"in r&&(B.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(EE.RECOVER_NOTIFICATION,r.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(GE.UID_BANNED),void this.close()):void this.reconnect(i.action,s0.SERVER_ERROR);B.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let r=_r("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(B.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>_r("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",s0.TIMEOUT):this.request(mE.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let o=Date.now()-i;this.rttRolling.add(o),_r("REPORT_STATS")&&this.send(mE.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){let{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();r!==0&&i!==0&&this.upload(vL.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(_E.RECONNECT_WAITTING_FINISH,r=>{this.emit(EE.WS_RECONNECT_WAITTING_FINISH,r)}),this.websocket.on(_E.RECONNECT_CREATE_CONNECTION,r=>{this.emit(EE.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(_E.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(_E.CLOSED,()=>{this.connectionState=QE.CLOSED}),this.websocket.on(_E.FAILED,()=>{this._disconnectedReason=GE.NETWORK_ERROR,this.connectionState=QE.CLOSED}),this.websocket.on(_E.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===QE.CONNECTED?this.connectionState=QE.RECONNECTING:this.connectionState=QE.CONNECTING}),this.websocket.on(_E.WILL_RECONNECT,(r,i,o)=>{let s=gL(this,EE.IS_P2P_DISCONNECTED),l=s||r!=="retry";s&&r==="retry"&&(B.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",i=DU.P2P_DISCONNECTED),l&&(B.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(EE.REPORT_JOIN_GATEWAY,i||DU.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(EE.DISCONNECT_P2P)),o(r)}),this.websocket.on(_E.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{B.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",s0.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(EE.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof _a){if(r.code===Vt.UNEXPECTED_RESPONSE&&r.data.code===hE.ERR_NO_AUTHORIZED)return this.initError=new _a(Vt.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),B.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",s0.SERVER_ERROR);B.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",s0.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(_E.REQUEST_NEW_URLS,(r,i)=>{c0(this,EE.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(_E.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wE.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(dst.PRE_CONNECT_PC,()=>{this.emit(EE.PRE_CONNECT_PC)})}},w_=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function pZ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function KM(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?pZ(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):pZ(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function g1(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(_r("TURN_DOMAIN")):(B.info("Unidentified as ip: ".concat(e,", use as host")),e)}function nH(e,r){e.addresses||(e.addresses=[]);let i=function(h,p){if(_r("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return h.map(g=>{let{ip:b,port:C}=g;return{address:"".concat(b,":").concat(C)}});let f=_r("GATEWAY_DOMAINS"),_=f[1]&&nE(p).call(p,f[1])?1:0;return h.map(g=>{let{domain_prefix:b,port:C,ip:k}=g;if(b)return{address:"".concat(b,".").concat(f[_++%f.length],":").concat(C)};let A=/^[\.\:\d]+$/.test(k),P=A?"".concat(k.replace(/[^\d]/g,"-"),".").concat(f[_++%f.length],":").concat(C):"".concat(k,":").concat(C);return A||B.info("Unidentified as ip: ".concat(k,", use as host")),{ip:k,port:C,address:P}})}(e.addresses,r),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){let h=o.split(";");for(let p=0;p<h.length;p++){var s;let f=C0(s=h[p]).call(s);i[p]&&f&&(i[p].ip6=f)}}let l=e.detail&&e.detail.candidate,d;if(l){let[h,p]=l.split(":");h&&p&&(d={port:Number(p),ip:h,address:"".concat(h,":").concat(p)})}return{gatewayAddrs:i,apGatewayAddress:d,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function pS(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function fZ(e){let r=e._encoderConfig;if(!r)return{};let i={resolution:r.width&&r.height?"".concat(pS(r.width),"x").concat(pS(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function mZ(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function TL(e,r){let i,o,s;switch(r){case w_.CHOOSE_SERVER:o=4096,s="choose server";break;case w_.CLOUD_PROXY:o=1048576,s="proxy";break;case w_.CLOUD_PROXY_5:o=4194304,s="proxy5";break;case w_.CLOUD_PROXY_FALLBACK:o=4194310,s="proxy fallback";break;default:throw new _a(Vt.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(l=>{l.buffer&&l.buffer.flag===o&&(i={code:l.buffer.code,addresses:(l.buffer.edges_services||[]).map(d=>KM(KM({},d),{},{ticket:l.buffer.cert})),server_ts:e.enter_ts,uid:l.buffer.uid,cid:l.buffer.cid,cname:l.buffer.cname,detail:KM(KM({},l.buffer.detail),e.detail),flag:l.buffer.flag,opid:e.opid,cert:l.buffer.cert})}),!i)throw new _a(Vt.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function hst(e,r){return await eE.all(e.addresses.map(async i=>({address:g1(i.ip),tcpport:i.port,udpport:i.port,username:r&&_r("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():i0.username,password:r&&_r("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await y8(r.toString()):i0.password})))}function N8(e,r){let i=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||i.height,s=r.videoWidth||i.width;return o&&s?Math.max(Math.min(o,s)/Math.min(pS(e.height),pS(e.width)),1):(B.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function qI(e){let{candidateType:r,relayProtocol:i,type:o,address:s,port:l,protocol:d}=e;return o==="local-candidate"?{candidateType:r,relayProtocol:i,protocol:d}:{candidateType:r,relayProtocol:i,address:s,port:l,protocol:d}}var lT,ZTt=m_(lst),$Tt=CT("Array").values,tbt=OR,ebt=m0,nbt=j0,rbt=$Tt,R6=Array.prototype,ibt={DOMTokenList:!0,NodeList:!0},obt=function(e){var r=e.values;return e===R6||nbt(R6,e)&&r===R6.values||ebt(ibt,tbt(e))?rbt:r},eI=m_(obt),EZ=QS,sbt=k_,abt=u0,cbt=M_,w6=X3,ubt=FL,lbt=G3,dbt=AR,hbt=q3,XN=Object.assign,_Z=Object.defineProperty,pbt=sbt([].concat),fbt=!XN||cbt(function(){if(EZ&&XN({b:1},XN(_Z({},"a",{enumerable:!0,get:function(){_Z(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(s){r[s]=s}),XN({},e)[i]!=7||w6(XN({},r)).join("")!=o})?function(e,r){for(var i=dbt(e),o=arguments.length,s=1,l=ubt.f,d=lbt.f;o>s;)for(var h,p=hbt(arguments[s++]),f=l?pbt(w6(p),l(p)):w6(p),_=f.length,g=0;_>g;)h=f[g++],EZ&&!abt(d,p,h)||(i[h]=p[h]);return i}:XN,mbt=nS,Ebt=brt,_bt=nO,gbt=u0,vbt=AR,ybt=function(e,r,i,o){try{return o?r(mbt(i)[0],i[1]):r(i)}catch(s){Ebt(e,"throw",s)}},Sbt=Trt,Tbt=$3,bbt=rI,gZ=rV,Rbt=SW,wbt=Q3,vZ=Array,sN=k_,I6=2147483647,Ibt=/[^\0-\u007E]/,pst=/[.\u3002\uFF0E\uFF61]/g,yZ="Overflow: input needs wider integers to process",SZ=RangeError,Cbt=sN(pst.exec),v1=Math.floor,C6=String.fromCharCode,TZ=sN("".charCodeAt),fst=sN([].join),xI=sN([].push),Abt=sN("".replace),Obt=sN("".split),Nbt=sN("".toLowerCase),bZ=function(e){return e+22+75*(e<26)},kbt=function(e,r,i){var o=0;for(e=i?v1(e/700):e>>1,e+=v1(e/r);e>455;)e=v1(e/35),o+=36;return v1(o+36*e/(e+38))},Pbt=function(e){var r=[];e=function(x){for(var j=[],z=0,_t=x.length;z<_t;){var ue=TZ(x,z++);if(ue>=55296&&ue<=56319&&z<_t){var _n=TZ(x,z++);(64512&_n)==56320?xI(j,((1023&ue)<<10)+(1023&_n)+65536):(xI(j,ue),z--)}else xI(j,ue)}return j}(e);var i,o,s=e.length,l=128,d=0,h=72;for(i=0;i<e.length;i++)(o=e[i])<128&&xI(r,C6(o));var p=r.length,f=p;for(p&&xI(r,"-");f<s;){var _=I6;for(i=0;i<e.length;i++)(o=e[i])>=l&&o<_&&(_=o);var g=f+1;if(_-l>v1((I6-d)/g))throw SZ(yZ);for(d+=(_-l)*g,l=_,i=0;i<e.length;i++){if((o=e[i])<l&&++d>I6)throw SZ(yZ);if(o==l){for(var b=d,C=36;;){var k=C<=h?1:C>=h+26?26:C-h;if(b<k)break;var A=b-k,P=36-k;xI(r,C6(bZ(k+A%P))),b=v1(A/P),C+=36}xI(r,C6(bZ(b))),h=kbt(d,g,f==p),d=0,f++}}d++,l++}return fst(r,"")},Dbt=zE,rH=QS,Lbt=BW,iH=V_,RZ=nO,AT=k_,zM=iO,dT=Z3,Mbt=RW,k8=m0,oH=fbt,QN=function(e){var r=vbt(e),i=Tbt(this),o=arguments.length,s=o>1?arguments[1]:void 0,l=s!==void 0;l&&(s=_bt(s,o>2?arguments[2]:void 0));var d,h,p,f,_,g,b=wbt(r),C=0;if(!b||this===vZ&&Sbt(b))for(d=bbt(r),h=i?new this(d):vZ(d);d>C;C++)g=l?s(r[C],C):r[C],gZ(h,C,g);else for(_=(f=Rbt(r,b)).next,h=i?new this:[];!(p=gbt(_,f)).done;C++)g=l?ybt(f,s,[p.value,C],!0):p.value,gZ(h,C,g);return h.length=C,h},GT=PW,Ubt=kW.codeAt,xbt=function(e){var r,i,o=[],s=Obt(Abt(Nbt(e),pst,"."),".");for(r=0;r<s.length;r++)i=s[r],xI(o,Cbt(Ibt,i)?"xn--"+Pbt(i):i);return fst(o,".")},YR=tT,jbt=oO,Vbt=X1,mst=z0t,Est=oN,Fbt=Est.set,c3=Est.getterFor("URL"),Bbt=mst.URLSearchParams,Gbt=mst.getState,TD=iH.URL,P8=iH.TypeError,YM=iH.parseInt,qbt=Math.floor,wZ=Math.pow,yT=AT("".charAt),HT=AT(/./.exec),xD=AT([].join),Wbt=AT(1 .toString),Hbt=AT([].pop),ZN=AT([].push),A6=AT("".replace),Kbt=AT([].shift),zbt=AT("".split),VD=AT("".slice),LU=AT("".toLowerCase),Ybt=AT([].unshift),O6="Invalid scheme",wO="Invalid host",IZ="Invalid port",_st=/[a-z]/i,Jbt=/[\d+-.a-z]/i,N6=/\d/,Xbt=/^0x/i,Qbt=/^[0-7]+$/,Zbt=/^\d+$/,CZ=/^[\da-f]+$/i,$bt=/[\0\t\n\r #%/:<>?@[\\\]^|]/,tRt=/[\0\t\n\r #/:<>?@[\\\]^|]/,eRt=/^[\u0000-\u0020]+/,nRt=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,rRt=/[\t\n\r]/g,RD=function(e){var r,i,o,s;if(typeof e=="number"){for(r=[],i=0;i<4;i++)Ybt(r,e%256),e=qbt(e/256);return xD(r,".")}if(typeof e=="object"){for(r="",o=function(l){for(var d=null,h=1,p=null,f=0,_=0;_<8;_++)l[_]!==0?(f>h&&(d=p,h=f),p=null,f=0):(p===null&&(p=_),++f);return f>h&&(d=p,h=f),d}(e),i=0;i<8;i++)s&&e[i]===0||(s&&(s=!1),o===i?(r+=i?":":"::",s=!0):(r+=Wbt(e[i],16),i<7&&(r+=":")));return"["+r+"]"}return e},MU={},gst=oH({},MU,{" ":1,'"':1,"<":1,">":1,"`":1}),vst=oH({},gst,{"#":1,"?":1,"{":1,"}":1}),k6=oH({},vst,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),NI=function(e,r){var i=Ubt(e,0);return i>32&&i<127&&!k8(r,e)?e:encodeURIComponent(e)},JM={ftp:21,file:null,http:80,https:443,ws:80,wss:443},FD=function(e,r){var i;return e.length==2&&HT(_st,yT(e,0))&&((i=yT(e,1))==":"||!r&&i=="|")},AZ=function(e){var r;return e.length>1&&FD(VD(e,0,2))&&(e.length==2||(r=yT(e,2))==="/"||r==="\\"||r==="?"||r==="#")},iRt=function(e){return e==="."||LU(e)==="%2e"},P6={},OZ={},D6={},NZ={},kZ={},L6={},PZ={},DZ={},XM={},QM={},M6={},U6={},x6={},j6={},LZ={},V6={},$N={},cR={},MZ={},IO={},WR={},sH=function(e,r,i){var o,s,l,d=YR(e);if(r){if(s=this.parse(d))throw P8(s);this.searchParams=null}else{if(i!==void 0&&(o=new sH(i,!0)),s=this.parse(d,null,o))throw P8(s);(l=Gbt(new Bbt)).bindURL(this),this.searchParams=l}};sH.prototype={type:"URL",parse:function(e,r,i){var o,s,l,d,h,p=this,f=r||P6,_=0,g="",b=!1,C=!1,k=!1;for(e=YR(e),r||(p.scheme="",p.username="",p.password="",p.host=null,p.port=null,p.path=[],p.query=null,p.fragment=null,p.cannotBeABaseURL=!1,e=A6(e,eRt,""),e=A6(e,nRt,"$1")),e=A6(e,rRt,""),o=QN(e);_<=o.length;){switch(s=o[_],f){case P6:if(!s||!HT(_st,s)){if(r)return O6;f=D6;continue}g+=LU(s),f=OZ;break;case OZ:if(s&&(HT(Jbt,s)||s=="+"||s=="-"||s=="."))g+=LU(s);else{if(s!=":"){if(r)return O6;g="",f=D6,_=0;continue}if(r&&(p.isSpecial()!=k8(JM,g)||g=="file"&&(p.includesCredentials()||p.port!==null)||p.scheme=="file"&&!p.host))return;if(p.scheme=g,r)return void(p.isSpecial()&&JM[p.scheme]==p.port&&(p.port=null));g="",p.scheme=="file"?f=j6:p.isSpecial()&&i&&i.scheme==p.scheme?f=NZ:p.isSpecial()?f=DZ:o[_+1]=="/"?(f=kZ,_++):(p.cannotBeABaseURL=!0,ZN(p.path,""),f=MZ)}break;case D6:if(!i||i.cannotBeABaseURL&&s!="#")return O6;if(i.cannotBeABaseURL&&s=="#"){p.scheme=i.scheme,p.path=GT(i.path),p.query=i.query,p.fragment="",p.cannotBeABaseURL=!0,f=WR;break}f=i.scheme=="file"?j6:L6;continue;case NZ:if(s!="/"||o[_+1]!="/"){f=L6;continue}f=XM,_++;break;case kZ:if(s=="/"){f=QM;break}f=cR;continue;case L6:if(p.scheme=i.scheme,s==lT)p.username=i.username,p.password=i.password,p.host=i.host,p.port=i.port,p.path=GT(i.path),p.query=i.query;else if(s=="/"||s=="\\"&&p.isSpecial())f=PZ;else if(s=="?")p.username=i.username,p.password=i.password,p.host=i.host,p.port=i.port,p.path=GT(i.path),p.query="",f=IO;else{if(s!="#"){p.username=i.username,p.password=i.password,p.host=i.host,p.port=i.port,p.path=GT(i.path),p.path.length--,f=cR;continue}p.username=i.username,p.password=i.password,p.host=i.host,p.port=i.port,p.path=GT(i.path),p.query=i.query,p.fragment="",f=WR}break;case PZ:if(!p.isSpecial()||s!="/"&&s!="\\"){if(s!="/"){p.username=i.username,p.password=i.password,p.host=i.host,p.port=i.port,f=cR;continue}f=QM}else f=XM;break;case DZ:if(f=XM,s!="/"||yT(g,_+1)!="/")continue;_++;break;case XM:if(s!="/"&&s!="\\"){f=QM;continue}break;case QM:if(s=="@"){b&&(g="%40"+g),b=!0,l=QN(g);for(var A=0;A<l.length;A++){var P=l[A];if(P!=":"||k){var x=NI(P,k6);k?p.password+=x:p.username+=x}else k=!0}g=""}else if(s==lT||s=="/"||s=="?"||s=="#"||s=="\\"&&p.isSpecial()){if(b&&g=="")return"Invalid authority";_-=QN(g).length+1,g="",f=M6}else g+=s;break;case M6:case U6:if(r&&p.scheme=="file"){f=V6;continue}if(s!=":"||C){if(s==lT||s=="/"||s=="?"||s=="#"||s=="\\"&&p.isSpecial()){if(p.isSpecial()&&g=="")return wO;if(r&&g==""&&(p.includesCredentials()||p.port!==null))return;if(d=p.parseHost(g))return d;if(g="",f=$N,r)return;continue}s=="["?C=!0:s=="]"&&(C=!1),g+=s}else{if(g=="")return wO;if(d=p.parseHost(g))return d;if(g="",f=x6,r==U6)return}break;case x6:if(!HT(N6,s)){if(s==lT||s=="/"||s=="?"||s=="#"||s=="\\"&&p.isSpecial()||r){if(g!=""){var j=YM(g,10);if(j>65535)return IZ;p.port=p.isSpecial()&&j===JM[p.scheme]?null:j,g=""}if(r)return;f=$N;continue}return IZ}g+=s;break;case j6:if(p.scheme="file",s=="/"||s=="\\")f=LZ;else{if(!i||i.scheme!="file"){f=cR;continue}if(s==lT)p.host=i.host,p.path=GT(i.path),p.query=i.query;else if(s=="?")p.host=i.host,p.path=GT(i.path),p.query="",f=IO;else{if(s!="#"){AZ(xD(GT(o,_),""))||(p.host=i.host,p.path=GT(i.path),p.shortenPath()),f=cR;continue}p.host=i.host,p.path=GT(i.path),p.query=i.query,p.fragment="",f=WR}}break;case LZ:if(s=="/"||s=="\\"){f=V6;break}i&&i.scheme=="file"&&!AZ(xD(GT(o,_),""))&&(FD(i.path[0],!0)?ZN(p.path,i.path[0]):p.host=i.host),f=cR;continue;case V6:if(s==lT||s=="/"||s=="\\"||s=="?"||s=="#"){if(!r&&FD(g))f=cR;else if(g==""){if(p.host="",r)return;f=$N}else{if(d=p.parseHost(g))return d;if(p.host=="localhost"&&(p.host=""),r)return;g="",f=$N}continue}g+=s;break;case $N:if(p.isSpecial()){if(f=cR,s!="/"&&s!="\\")continue}else if(r||s!="?")if(r||s!="#"){if(s!=lT&&(f=cR,s!="/"))continue}else p.fragment="",f=WR;else p.query="",f=IO;break;case cR:if(s==lT||s=="/"||s=="\\"&&p.isSpecial()||!r&&(s=="?"||s=="#")){if((h=LU(h=g))===".."||h==="%2e."||h===".%2e"||h==="%2e%2e"?(p.shortenPath(),s=="/"||s=="\\"&&p.isSpecial()||ZN(p.path,"")):iRt(g)?s=="/"||s=="\\"&&p.isSpecial()||ZN(p.path,""):(p.scheme=="file"&&!p.path.length&&FD(g)&&(p.host&&(p.host=""),g=yT(g,0)+":"),ZN(p.path,g)),g="",p.scheme=="file"&&(s==lT||s=="?"||s=="#"))for(;p.path.length>1&&p.path[0]==="";)Kbt(p.path);s=="?"?(p.query="",f=IO):s=="#"&&(p.fragment="",f=WR)}else g+=NI(s,vst);break;case MZ:s=="?"?(p.query="",f=IO):s=="#"?(p.fragment="",f=WR):s!=lT&&(p.path[0]+=NI(s,MU));break;case IO:r||s!="#"?s!=lT&&(s=="'"&&p.isSpecial()?p.query+="%27":p.query+=s=="#"?"%23":NI(s,MU)):(p.fragment="",f=WR);break;case WR:s!=lT&&(p.fragment+=NI(s,gst))}_++}},parseHost:function(e){var r,i,o;if(yT(e,0)=="["){if(yT(e,e.length-1)!="]"||(r=function(s){var l,d,h,p,f,_,g,b=[0,0,0,0,0,0,0,0],C=0,k=null,A=0,P=function(){return yT(s,A)};if(P()==":"){if(yT(s,1)!=":")return;A+=2,k=++C}for(;P();){if(C==8)return;if(P()!=":"){for(l=d=0;d<4&&HT(CZ,P());)l=16*l+YM(P(),16),A++,d++;if(P()=="."){if(d==0||(A-=d,C>6))return;for(h=0;P();){if(p=null,h>0){if(!(P()=="."&&h<4))return;A++}if(!HT(N6,P()))return;for(;HT(N6,P());){if(f=YM(P(),10),p===null)p=f;else{if(p==0)return;p=10*p+f}if(p>255)return;A++}b[C]=256*b[C]+p,++h!=2&&h!=4||C++}if(h!=4)return;break}if(P()==":"){if(A++,!P())return}else if(P())return;b[C++]=l}else{if(k!==null)return;A++,k=++C}}if(k!==null)for(_=C-k,C=7;C!=0&&_>0;)g=b[C],b[C--]=b[k+_-1],b[k+--_]=g;else if(C!=8)return;return b}(VD(e,1,-1)),!r))return wO;this.host=r}else if(this.isSpecial()){if(e=xbt(e),HT($bt,e)||(r=function(s){var l,d,h,p,f,_,g,b=zbt(s,".");if(b.length&&b[b.length-1]==""&&b.length--,(l=b.length)>4)return s;for(d=[],h=0;h<l;h++){if((p=b[h])=="")return s;if(f=10,p.length>1&&yT(p,0)=="0"&&(f=HT(Xbt,p)?16:8,p=VD(p,f==8?1:2)),p==="")_=0;else{if(!HT(f==10?Zbt:f==8?Qbt:CZ,p))return s;_=YM(p,f)}ZN(d,_)}for(h=0;h<l;h++)if(_=d[h],h==l-1){if(_>=wZ(256,5-l))return null}else if(_>255)return null;for(g=Hbt(d),h=0;h<d.length;h++)g+=d[h]*wZ(256,3-h);return g}(e),r===null))return wO;this.host=r}else{if(HT(tRt,e))return wO;for(r="",i=QN(e),o=0;o<i.length;o++)r+=NI(i[o],MU);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return k8(JM,this.scheme)},shortenPath:function(){var e=this.path,r=e.length;!r||this.scheme=="file"&&r==1&&FD(e[0],!0)||e.length--},serialize:function(){var e=this,r=e.scheme,i=e.username,o=e.password,s=e.host,l=e.port,d=e.path,h=e.query,p=e.fragment,f=r+":";return s!==null?(f+="//",e.includesCredentials()&&(f+=i+(o?":"+o:"")+"@"),f+=RD(s),l!==null&&(f+=":"+l)):r=="file"&&(f+="//"),f+=e.cannotBeABaseURL?d[0]:d.length?"/"+xD(d,"/"):"",h!==null&&(f+="?"+h),p!==null&&(f+="#"+p),f},setHref:function(e){var r=this.parse(e);if(r)throw P8(r);this.searchParams.update()},getOrigin:function(){var e=this.scheme,r=this.port;if(e=="blob")try{return new U1(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+RD(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(YR(e)+":",P6)},getUsername:function(){return this.username},setUsername:function(e){var r=QN(YR(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=NI(r[i],k6)}},getPassword:function(){return this.password},setPassword:function(e){var r=QN(YR(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=NI(r[i],k6)}},getHost:function(){var e=this.host,r=this.port;return e===null?"":r===null?RD(e):RD(e)+":"+r},setHost:function(e){this.cannotBeABaseURL||this.parse(e,M6)},getHostname:function(){var e=this.host;return e===null?"":RD(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,U6)},getPort:function(){var e=this.port;return e===null?"":YR(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=YR(e))==""?this.port=null:this.parse(e,x6))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+xD(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,$N))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=YR(e))==""?this.query=null:(yT(e,0)=="?"&&(e=VD(e,1)),this.query="",this.parse(e,IO)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=YR(e))!=""?(yT(e,0)=="#"&&(e=VD(e,1)),this.fragment="",this.parse(e,WR)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var U1=function(e){var r=Mbt(this,cS),i=Vbt(arguments.length,1)>1?arguments[1]:void 0,o=Fbt(r,new sH(e,!1,i));rH||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},cS=U1.prototype,hT=function(e,r){return{get:function(){return c3(this)[e]()},set:r&&function(i){return c3(this)[r](i)},configurable:!0,enumerable:!0}};rH&&(dT(cS,"href",hT("serialize","setHref")),dT(cS,"origin",hT("getOrigin")),dT(cS,"protocol",hT("getProtocol","setProtocol")),dT(cS,"username",hT("getUsername","setUsername")),dT(cS,"password",hT("getPassword","setPassword")),dT(cS,"host",hT("getHost","setHost")),dT(cS,"hostname",hT("getHostname","setHostname")),dT(cS,"port",hT("getPort","setPort")),dT(cS,"pathname",hT("getPathname","setPathname")),dT(cS,"search",hT("getSearch","setSearch")),dT(cS,"searchParams",hT("getSearchParams")),dT(cS,"hash",hT("getHash","setHash"))),zM(cS,"toJSON",function(){return c3(this).serialize()},{enumerable:!0}),zM(cS,"toString",function(){return c3(this).serialize()},{enumerable:!0}),TD&&(F6=TD.createObjectURL,B6=TD.revokeObjectURL,F6&&zM(U1,"createObjectURL",RZ(F6,TD)),B6&&zM(U1,"revokeObjectURL",RZ(B6,TD)));var F6,B6;jbt(U1,"URL"),Dbt({global:!0,constructor:!0,forced:!Lbt,sham:!rH},{URL:U1});var oRt=zE,sRt=M_,aRt=X1,UZ=tT,cRt=BW,xZ=fS("URL");oRt({target:"URL",stat:!0,forced:!(cRt&&sRt(function(){xZ.canParse()}))},{canParse:function(e){var r=aRt(arguments.length,1),i=UZ(e),o=r<2||arguments[1]===void 0?void 0:UZ(arguments[1]);try{return!!new xZ(i,o)}catch{return!1}}});var jZ=m_(ZS.URL),$_={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ME(){return $_}function yst(){return"setSinkId"in HTMLAudioElement.prototype&&(!_r("RESTRICTION_SET_PLAYBACK_DEVICE")||(zI()||zot())&&!XW())}function VZ(){return!$_.supportUnifiedPlan||_r("CHROME_FORCE_PLAN_B")&&$I()}var Fg=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function t1(e,r,i){return{sampleRate:e,stereo:r,bitrate:i}}function NE(e,r,i,o,s){return{width:e,height:r,frameRate:i,bitrateMin:o,bitrateMax:s}}function pT(e,r,i,o,s){return{width:{max:e},height:{max:r},frameRate:i,bitrateMin:o,bitrateMax:s}}function G6(e,r){return{numSpatialLayers:e,numTemporalLayers:r}}var uRt={"90p":NE(160,90),"90p_1":NE(160,90),"120p":NE(160,120,15,30,65),"120p_1":NE(160,120,15,30,65),"120p_3":NE(120,120,15,30,50),"120p_4":NE(212,120),"180p":NE(320,180,15,30,140),"180p_1":NE(320,180,15,30,140),"180p_3":NE(180,180,15,30,100),"180p_4":NE(240,180,15,30,120),"240p":NE(320,240,15,40,200),"240p_1":NE(320,240,15,40,200),"240p_3":NE(240,240,15,40,140),"240p_4":NE(424,240,15,40,220),"360p":NE(640,360,15,80,400),"360p_1":NE(640,360,15,80,400),"360p_3":NE(360,360,15,80,260),"360p_4":NE(640,360,30,80,600),"360p_6":NE(360,360,30,80,400),"360p_7":NE(480,360,15,80,320),"360p_8":NE(480,360,30,80,490),"360p_9":NE(640,360,15,80,800),"360p_10":NE(640,360,24,80,800),"360p_11":NE(640,360,24,80,1e3),"480p":NE(640,480,15,100,500),"480p_1":NE(640,480,15,100,500),"480p_2":NE(640,480,30,100,1e3),"480p_3":NE(480,480,15,100,400),"480p_4":NE(640,480,30,100,750),"480p_6":NE(480,480,30,100,600),"480p_8":NE(848,480,15,100,610),"480p_9":NE(848,480,30,100,930),"480p_10":NE(640,480,10,100,400),"720p":NE(1280,720,15,120,1130),"720p_auto":NE(1280,720,30,900,3e3),"720p_1":NE(1280,720,15,120,1130),"720p_2":NE(1280,720,30,120,2e3),"720p_3":NE(1280,720,30,120,1710),"720p_5":NE(960,720,15,120,910),"720p_6":NE(960,720,30,120,1380),"1080p":NE(1920,1080,15,120,2080),"1080p_1":NE(1920,1080,15,120,2080),"1080p_2":NE(1920,1080,30,120,3e3),"1080p_3":NE(1920,1080,30,120,3150),"1080p_5":NE(1920,1080,60,120,4780),"1440p":NE(2560,1440,30,120,4850),"1440p_1":NE(2560,1440,30,120,4850),"1440p_2":NE(2560,1440,60,120,7350),"4k":NE(3840,2160,30,120,8910),"4k_1":NE(3840,2160,30,120,8910),"4k_3":NE(3840,2160,60,120,13500)},lRt={"480p":pT(640,480,5),"480p_1":pT(640,480,5),"480p_2":pT(640,480,30),"480p_3":pT(640,480,15),"720p":pT(1280,720,5),"720p_auto":NE(1280,720,30,900,3e3),"720p_1":pT(1280,720,5),"720p_2":pT(1280,720,30),"720p_3":pT(1280,720,15),"1080p":pT(1920,1080,5),"1080p_1":pT(1920,1080,5),"1080p_2":pT(1920,1080,30),"1080p_3":pT(1920,1080,15)},dRt={"1SL1TL":G6(1,1),"3SL3TL":G6(3,3),"2SL3TL":G6(2,3)};function TR(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},uRt[e]):e}function q6(e){return typeof e=="string"?Object.assign({},lRt[e]):e}function ZM(e){return typeof e=="string"?Object.assign({},dRt[e]):e}var hRt={speech_low_quality:t1(16e3,!1),speech_standard:t1(32e3,!1,18),music_standard:t1(48e3,!1),standard_stereo:t1(48e3,!0,56),high_quality:t1(48e3,!1,128),high_quality_stereo:t1(48e3,!0,192)};function u3(e){return typeof e=="string"?Object.assign({},hRt[e]):e}var c1=[];function FZ(e){return j_(e,"mediaSource",["screen","window","application"]),!0}var iE=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),XE=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),x1=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),pRt=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),fRt=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),YO=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),_k=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),w1=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),tP=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),AS=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});var D8={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},L8={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Sst={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},mRt={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Tst={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},x0=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),kS=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),wD=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),qO=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),I0=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),uR=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),W6={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},UU=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function kE(e,r,i,o,s){var l,d,h={};return Object.keys(o).forEach(function(p){h[p]=o[p]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=QT(l=ZTt(d=i.slice()).call(d)).call(l,function(p,f){return f(e,r,p)||p},h),s&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(s):void 0,h.initializer=void 0),h.initializer===void 0&&(Object.defineProperty(e,r,h),h=null),h}function _l(e,r,i){return(r=function(o){var s=function(l,d){if(typeof l!="object"||!l)return l;var h=l[Symbol.toPrimitive];if(h!==void 0){var p=h.call(l,"string");if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(l)}(o);return typeof s=="symbol"?s:s+""}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function BZ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function o_(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?BZ(Object(i),!0).forEach(function(o){_l(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):BZ(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var l3=class extends s_{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(YO.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,i){super(),_l(this,"trackMediaType",void 0),_l(this,"_ID",void 0),_l(this,"_rtpTransceiver",void 0),_l(this,"_lowRtpTransceiver",void 0),_l(this,"_hints",[]),_l(this,"_isClosed",!1),_l(this,"_originMediaStreamTrack",void 0),_l(this,"mediaStreamTrack",void 0),_l(this,"_external",{}),this._ID=i||ZE(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){nE(c1).call(c1,o)||c1.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||_C(()=>{var i;aE.reportApiInvoke(null,{name:L_.GET_MEDIA_STREAM_TRACK,options:[],tag:p_.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===x1.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){let i=c1.indexOf(r);i!==-1&&c1.splice(i,1)}(this),this.emit(_k.CLOSED),this.removeAllListeners(YO.SEI_RECEIVED)}_updateRtpTransceiver(r,i){if(i===x1.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(YO.TRANSCEIVER_UPDATED,r,i)}},WI=class extends l3{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,i){super(r,i),_l(this,"_enabled",!0),_l(this,"_muted",!1),_l(this,"_isExternalTrack",!1),_l(this,"_isClosed",!1),_l(this,"_enabledMutex",void 0),_l(this,"processor",void 0),_l(this,"_processorContext",void 0),_l(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new f0("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return(r=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,B.debug("[".concat(this.getTrackId(),"] close")),this.emit(iE.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await JE(this,iE.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){B.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_k.TRACK_ENDED)}stateCheck(r,i){if(B.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),tI(i,r),this._enabled&&this._muted&&r==="enabled"&&i===!1)throw new _u(Vt.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",B);if(!this._enabled&&!this._muted&&r==="muted"&&i===!0)throw new _u(Vt.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",B)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():eE.resolve([])}},GZ=window.AudioContext||window.webkitAudioContext,TS=null,qE=new class extends s_{constructor(){super(...arguments),_l(this,"prevState",void 0),_l(this,"curState",void 0),_l(this,"currentTime",void 0),_l(this,"currentTimeStuckAt",void 0),_l(this,"interruptDetectorTrack",void 0),_l(this,"onLocalAudioTrackMute",()=>{B.info("ios15-interruption-start"),this.emit(Fg.IOS_15_16_INTERRUPTION_START)}),_l(this,"onLocalAudioTrackUnmute",async()=>{B.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?B.info("ios15-interruption-end-canceled"):(TS&&await TS.suspend(),this.emit(Fg.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){B.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){B.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function eP(){if(!TS){if(function(){if(!GZ)return void B.error("your browser is not support web audio");B.info("create audio context");let e=o_({},_r("WEBAUDIO_INIT_OPTIONS"));B.debug("audio context init option:",JSON.stringify(e)),TS=new GZ(e),qE.curState=TS.state,TS.onstatechange=()=>{qE.prevState=qE.curState,qE.curState=TS?TS.state:void 0;let{prevState:r,curState:i}=qE,o=i==="running",s=i==="interrupted",l=r==="running",d=r==="suspended",h=r==="interrupted",p=DE().osVersion;(U0()||wT())&&l&&s&&(B.info("ios".concat(p,"-interruption-start")),qE.emit(Fg.IOS_INTERRUPTION_START)),(U0()||wT())&&(d||h)&&o&&(B.info("ios".concat(p,"-interruption-end")),qE.emit(Fg.IOS_INTERRUPTION_END)),r!==i&&qE.emit(Fg.STATE_CHANGE,i,r)},setInterval(()=>{var r;let i=(r=TS)===null||r===void 0?void 0:r.currentTime;qE.currentTime!==i?(qE.currentTimeStuckAt&&(B.debug("AudioContext current time resume at ".concat(i)),qE.currentTimeStuckAt=void 0),qE.currentTime=i):(i!==qE.currentTimeStuckAt&&(aE.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:p_.TRACER}).onSuccess(),B.warning("AudioContext current time stuck at ".concat(i))),qE.currentTimeStuckAt=i)},5e3),async function(r){let i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],o,s=!1,l=!1,d=!1;function h(A){r.state==="running"?p(!1):U0()||wT()?r.state==="suspended"&&(p(!0),A&&r.resume().then(f,f)):r.state!=="closed"&&(p(!0),A&&r.resume().then(f,f))}function p(A){if(s!==A){s=A;for(let P=0,x=i;P<x.length;P+=1){let j=x[P];A?window.addEventListener(j,_,{capture:!0,passive:!0}):window.removeEventListener(j,_,{capture:!0,passive:!0})}}}function f(){h(!1)}function _(){h(!0)}function g(A){if(!d)if(o.paused)if(A){let P;b(!1),d=!0;try{P=o.play(),P?P.then(C,C):(o.addEventListener("playing",C),o.addEventListener("abort",C),o.addEventListener("error",C))}catch{C()}}else b(!0);else b(!1)}function b(A){if(l!==A){l=A;for(let P=0,x=i;P<x.length;P++){let j=x[P];A?window.addEventListener(j,k,{capture:!0,passive:!0}):window.removeEventListener(j,k,{capture:!0,passive:!0})}}}function C(){o.removeEventListener("playing",C),o.removeEventListener("abort",C),o.removeEventListener("error",C),d=!1,g(!1)}function k(){g(!0)}if(U0()){let A=r.createMediaStreamDestination(),P=document.createElement("div");P.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=P.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=A.stream,g(!0)}qE.on(Fg.STATE_CHANGE,function(){h(!0)}),h(!1)}(TS)}(),!TS)throw new _u(Vt.NOT_SUPPORTED,"can not create audio context");return TS}return TS}function kO(e){if(function(){if(H6!==null)return H6;let o=eP(),s=o.createBufferSource(),l=o.createGain(),d=o.createGain();s.connect(l),s.connect(d),s.disconnect(l);let h=!1;try{s.disconnect(l)}catch{h=!0}return s.disconnect(),H6=h,h}())return;let r=e.connect,i=e.disconnect;e.connect=(o,s,l)=>{var d;return e._inputNodes||(e._inputNodes=[]),nE(d=e._inputNodes).call(d,o)||(o instanceof AudioNode?(e._inputNodes.push(o),r.call(e,o,s,l)):r.call(e,o,s)),e},e.disconnect=(o,s,l)=>{i.call(e),o?r3(e._inputNodes,o):e._inputNodes=[];for(let d of e._inputNodes)r.call(e,d)}}var H6=null;function aH(e,r){let i=!1,o=1/r;if(_r("DISABLE_WEBAUDIO")){let s=window.setInterval(()=>{i?window.clearInterval(s):e(performance.now()/1e3)},1e3*o)}else{let s=eP(),l=s.createGain();l.gain.value=0,l.connect(s.destination);let d=()=>{if(i)return void(l=null);let h=s.createOscillator();h.onended=d,h.connect(l),h.start(0),h.stop(s.currentTime+o),e(s.currentTime)};d()}return()=>{i=!0}}var d3=class{constructor(){_l(this,"context",void 0),_l(this,"analyserNode",void 0),_l(this,"sourceNode",void 0),this.context=eP(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||U0()||wT()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{let o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let s=0;s<r.length;++s)r[s]=o[s]/128-1}let i=QT(r).call(r,(o,s)=>o+s*s,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{B.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}},h3=class extends s_{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),_l(this,"outputNode",void 0),_l(this,"outputTrack",void 0),_l(this,"isPlayed",!1),_l(this,"sourceNode",void 0),_l(this,"context",void 0),_l(this,"audioBufferNode",void 0),_l(this,"destNode",void 0),_l(this,"audioOutputLevel",0),_l(this,"volumeLevelAnalyser",void 0),_l(this,"_processedNode",void 0),_l(this,"playNode",void 0),_l(this,"isDestroyed",!1),_l(this,"onNoAudioInput",void 0),_l(this,"isNoAudioInput",!1),_l(this,"_noAudioInputCount",0),this.context=eP(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),kO(this.outputNode),this.volumeLevelAnalyser=new d3}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(AS.ON_AUDIO_BUFFER,function(o){for(let s=0;s<o.outputBuffer.numberOfChannels;s+=1){let l=o.outputBuffer.getChannelData(s);for(let d=0;d<l.length;d+=1)l[d]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ME().webAudioMediaStreamDest)throw new _u(Vt.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&dV(()=>{qE.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;U0()||wT()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let i=this.volumeLevelAnalyser.getAnalyserNode(),o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let s=!1;for(let l=0;l<o.length;l++)o[l]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await _y(200),await this.checkHasAudioInput(r?r+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;(r=this.processedNode)===null||r===void 0||r.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}},p3=class extends h3{get isFreeze(){return!1}constructor(r,i,o){var s;if(super(),_l(this,"sourceNode",void 0),_l(this,"track",void 0),_l(this,"clonedTrack",void 0),_l(this,"audioElement",void 0),_l(this,"isCurrentTrackCloned",!1),_l(this,"isRemoteTrack",!1),_l(this,"originVolumeLevelAnalyser",void 0),_l(this,"rebuildWebAudio",async()=>{if(B.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void B.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>B.info("resume success")),B.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let h=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?h.stop():this.isCurrentTrackCloned=!0;let p=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(p),kO(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let f=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(f,this.context.currentTime),kO(this.outputNode),this.emit(AS.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=p,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new _u(Vt.UNEXPECTED_ERROR);this.track=r;let l=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(l),kO(this.sourceNode),o){let h=o.clone();h.enabled=!0,this.clonedTrack=h,B.debug("create an unmuted track ".concat(h.id," from the original track ").concat(o.id," to get the volume"));let p=this.context.createMediaStreamSource(new MediaStream([h]));kO(p),this.originVolumeLevelAnalyser=new d3,this.originVolumeLevelAnalyser.updateSource(p)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=l;let d=DE();i&&d.os===W_.IOS&&Number((s=d.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(qE.on(Fg.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(h=>{h||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;let i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),kO(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(AS.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),qE.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){let i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),B.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));let o=this.context.createMediaStreamSource(new MediaStream([i]));kO(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}};async function bst(e,r,i){let o=(l,d)=>l?typeof l!="number"?l.max||l.exact||l.ideal||l.min||d:l:d,s={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(s.video.mandatory.maxFrameRate=r.frameRate.max,s.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(s.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function ERt(e,r){let i=await Rst(e.mediaSource),{sourceId:o,audio:s}=await function(l){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new eE((h,p)=>{let f=document.createElement("div");f.innerText="share screen",f.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let _=document.createElement("div");_.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let g=document.createElement("div");g.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",g.setAttribute("style","height: 12%;");let b=document.createElement("div");b.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let C=document.createElement("div");C.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let k=document.createElement("button");k.innerHTML="cancel",k.setAttribute("style","width: 85px;"),k.onclick=()=>{document.body.removeChild(x);let j=new Error("NotAllowedError");j.name="NotAllowedError",p(j)};let A=d,P=document.createElement("div");if(d){let j=document.createElement("input");j.setAttribute("type","checkbox");let z=document.createElement("span");j.setAttribute("style","margin-right: 6px;"),z.innerText="Share audio",j.checked=A,j.onchange=()=>{A=j.checked},P.appendChild(j),P.appendChild(z)}C.appendChild(P),C.appendChild(k),_.appendChild(g),_.appendChild(b),_.appendChild(C);let x=document.createElement("div");x.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),x.appendChild(f),x.appendChild(_),document.body.appendChild(x),l.map(j=>{if(j.id){let z=document.createElement("div");z.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let _t=j.thumbnail;try{let{width:ue}=_t.getSize();ue>1920&&(_t=_t.resize({width:1920}))}catch(ue){throw ue&&ue.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),ue}z.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+_t.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+j.name.replace(/[\u00A0-\u9999<>\&]/g,function(ue){return"&#"+ue.charCodeAt(0)+";"})+"</span>",z.onclick=()=>{document.body.removeChild(x),h({sourceId:j.id,audio:A})},b.appendChild(z)}})})}(i,r);return await bst(o,e,s)}async function Rst(e){let r=["window","screen"];e!=="application"&&e!=="window"||(r=["window"]),e==="screen"&&(r=["screen"]);let i=nst();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new _u(Vt.ELECTRON_IS_NULL);let o=null;try{var s;o=((s=i.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new eE((l,d)=>{i.desktopCapturer.getSources({types:r},(h,p)=>{h?d(h):l(p)})}));try{return await o}catch(l){throw new _u(Vt.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,l.toString())}}var M8=new f0("safari"),wst=!1,Ist=!1;async function IS(e,r){let i=0,o=null;for(;i<2;)try{o=await _Rt(e,r,i>0);break}catch(s){if(s instanceof _u)throw B.error("[".concat(r,"] ").concat(s.toString())),s;let l=xU(s.name||s.code||s,s.message);if(l.code===Vt.MEDIA_OPTION_INVALID){B.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await _y(500);continue}throw B.error("[".concat(r,"] ").concat(l.toString())),l}if(!o)throw new _u(Vt.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function _Rt(e,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new _u(Vt.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let o=ME(),s=new MediaStream;if(e.audioSource&&s.addTrack(e.audioSource),e.videoSource&&s.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return B.debug("Using Video Source/ Audio Source"),s;if(e.screen)if(nst())e.screen.sourceId?e1(s,await bst(e.screen.sourceId,e.screen,e.screenAudio)):e1(s,await ERt(e.screen,e.screenAudio));else if(zI()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new _u(Vt.NOT_SUPPORTED,"This browser does not support screen sharing");B.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));let b=await(d=e.screen.extensionId,h=r,new eE((C,k)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},A=>{if(!A||!A.streamId)return B.error("[".concat(h,"] No response from Chrome Plugin. Plugin not installed properly"),A),void k(new _u(Vt.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));C(A.streamId)})}catch(A){B.error("[".concat(h,"] AgoraRTC screensharing plugin is not accessible(").concat(d,")"),A.toString()),k(new _u(Vt.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=b,e1(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var l;e.screen.mediaSource&&FZ(e.screen.mediaSource);let b={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(l=e.screen.displaySurface)!==null&&l!==void 0?l:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:C,surfaceSwitching:k,systemAudio:A}=e.screen,P={selfBrowserSurface:C,surfaceSwitching:k,systemAudio:A};!C&&delete P.selfBrowserSurface,!k&&delete P.surfaceSwitching,!A&&delete P.systemAudio,B.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:b,audio:!!e.screenAudio,controls:P})),e1(s,await navigator.mediaDevices.getDisplayMedia(o_({video:b,audio:!!e.screenAudio},P)))}else{if(!f_())throw B.error("[".concat(r,"] This browser does not support screenSharing")),new _u(Vt.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&FZ(e.screen.mediaSource);let b={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};B.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(b))),e1(s,await navigator.mediaDevices.getUserMedia(b))}}var d,h;if(!e.video&&!e.audio)return s;let p={video:e.video,audio:e.audio},f=_r("MEDIA_DEVICE_CONSTRAINTS");if(f)try{typeof f=="string"&&(f=JSON.parse(f)),p=S8(p,f)}catch{}B.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(p)),DE();let _,g=null;(a0()||U0()||n3())&&(g=await M8.lock());try{_=await navigator.mediaDevices.getUserMedia(p)}catch(b){throw g&&g(),b}return p.audio&&(wst=!0),p.video&&(Ist=!0),e1(s,_),g&&g(),s}function xU(e,r){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new _u(Vt.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new _u(Vt.DEVICE_NOT_FOUND,"".concat(e,": ").concat(r));case"NotSupportedError":return new _u(Vt.NOT_SUPPORTED,"".concat(e,": ").concat(r));case"NotReadableError":return new _u(Vt.NOT_READABLE,"".concat(e,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new _u(Vt.PERMISSION_DENIED,"".concat(e,": ").concat(r));case"ConstraintNotSatisfiedError":return new _u(Vt.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(r));default:return B.error("getUserMedia unexpected error",e),new _u(Vt.UNEXPECTED_ERROR,"".concat(e,": ").concat(r))}}function e1(e,r){let i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],s=r.getVideoTracks()[0],l=r.getAudioTracks()[0];l&&(o&&e.removeTrack(o),e.addTrack(l)),s&&(i&&e.removeTrack(i),e.addTrack(s))}var NS=new class extends s_{get state(){return this._state}set state(e){e!==this._state&&(this.emit(qO.STATE_CHANGE,e),this._state=e)}constructor(){super(),_l(this,"_state",wD.IDLE),_l(this,"isAccessMicrophonePermission",!1),_l(this,"isAccessCameraPermission",!1),_l(this,"lastAccessMicrophonePermission",!1),_l(this,"lastAccessCameraPermission",!1),_l(this,"checkdeviceMatched",!1),_l(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(_r("ENUMERATE_DEVICES_INTERVAL")||(uV()||cV()===W_.HARMONY_OS)&&$I())&&this.updateDevicesInfo()},_r("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>B.error(e.toString()))}async enumerateDevices(e,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new _u(Vt.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let o=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(o),l=!this.isAccessMicrophonePermission&&e,d=!this.isAccessCameraPermission&&r;s.audio&&(l=!1),s.video&&(d=!1);let h=null,p=null,f=null;if(!i&&(l||d)){if(M8.isLocked&&(B.debug("[device manager] wait GUM lock"),(await M8.lock())(),B.debug("[device manager] GUM unlock")),wst&&(l=!1,this.isAccessMicrophonePermission=!0),Ist&&(d=!1,this.isAccessCameraPermission=!0),B.debug("[device manager] check media device permissions",e,r,l,d),l&&d){try{f=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){let g=xU(_.name||_.code||_,_.message);if(g.code===Vt.PERMISSION_DENIED)throw g;B.warning("getUserMedia failed in getDevices",g)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(l){try{h=await navigator.mediaDevices.getUserMedia({audio:e})}catch(_){let g=xU(_.name||_.code||_,_.message);if(g.code===Vt.PERMISSION_DENIED)throw g;B.warning("getUserMedia failed in getDevices",g)}this.isAccessMicrophonePermission=!0}else if(d){try{p=await navigator.mediaDevices.getUserMedia({video:r})}catch(_){let g=xU(_.name||_.code||_,_.message);if(g.code===Vt.PERMISSION_DENIED)throw g;B.warning("getUserMedia failed in getDevices",g)}this.isAccessCameraPermission=!0}B.debug("[device manager] mic permission",e,"cam permission",r)}try{let _=await navigator.mediaDevices.enumerateDevices();return h&&h.getTracks().forEach(g=>g.stop()),p&&p.getTracks().forEach(g=>g.stop()),f&&f.getTracks().forEach(g=>g.stop()),h=null,p=null,f=null,_}catch(_){return h&&h.getTracks().forEach(g=>g.stop()),p&&p.getTracks().forEach(g=>g.stop()),f&&f.getTracks().forEach(g=>g.stop()),h=null,p=null,f=null,new _u(Vt.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(e){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(r=i.device.deviceId)}),r}async getDeviceById(e){let r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!r)throw new _u(Vt.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=wD.INITING;try{await this.updateDevicesInfo(),this.state=wD.INITEND}catch(e){throw B.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=wD.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new _u(Vt.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let s=e.find(d=>d.kind==="audioinput"&&d.deviceId==="default"),l=e.find(d=>d.kind==="audiooutput"&&d.deviceId==="default");s&&l?l.groupId===s.groupId?B.debug("[device-check] default input ".concat(s.label," and output ").concat(l.label," is the same group")):B.warning("[device-check] default input ".concat(s.label," and output ").concat(l.label," is not the same group")):B.debug("[device-check] default input or output not found")}let o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(s=>{if(!s.deviceId)return;let l=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((l?l.state:"INACTIVE")!=="ACTIVE"){let d={initAt:r,updateAt:r,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),d),i.push(d)}l&&(l.updateAt=r)}),this.deviceInfoMap.forEach((s,l)=>{s.state==="ACTIVE"&&s.updateAt!==r&&(s.state="INACTIVE",i.push(s))}),this.state!==wD.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(qO.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(qO.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(qO.PLAYOUT_DEVICE_CHANGED,s)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let r=e.filter(s=>s.kind==="audioinput"),i=e.filter(s=>s.kind==="videoinput"),o={audio:!1,video:!1};for(let s of r)if(s.label&&s.deviceId){o.audio=!0;break}for(let s of i)if(s.label&&s.deviceId){o.video=!0;break}return o}},K6=!1,bS=new class extends s_{constructor(){super(...arguments),_l(this,"onAutoplayFailed",void 0),_l(this,"onAudioAutoplayFailed",void 0)}};function Cst(){if(DE(),!K6){let e=r=>{r.preventDefault(),K6=!1,_L()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};K6=!0,_L()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),B.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),bS.onAutoplayFailed?bS.onAutoplayFailed():bS.onAudioAutoplayFailed?B.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):B.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),bS.emit("autoplay-failed")}}function Ast(e,r,i,o){if(!e)return;let s=aE.getBaseInfoBySessionId(e);if(!s)return;let l=s.info,d=Date.now(),h=o_(o_({},l),{},{vid:l.vid===void 0?0:Number(l.vid),lts:d,elapse:d-s.startTime,cbRegistered:bS.onAutoplayFailed||bS.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:o,extend:void 0});aE.send({type:d_.AUTOPLAY_FAILED,data:h},!0)}var gRt=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],H0=new class{constructor(){_l(this,"onAutoplayFailed",void 0),_l(this,"elementMap",new Map),_l(this,"elementStateMap",new Map),_l(this,"elementsNeedToResume",[]),_l(this,"sinkIdMap",new Map),_l(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,o]=r,s=this.elementStateMap.get(i),l=o.srcObject.getAudioTracks()[0],d=l&&l.readyState;if(B.debug("resume after interrupted, ele: ".concat(s," audio: ").concat(d," ").concat(e)),d==="live"){if(e)return o.pause(),void o.play();if(qE.curState==="running")return D1()?(o.pause(),void o.play()):void(s&&s==="paused"&&o.play())}})}),_l(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,i]=e,o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(B.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),qE.on(Fg.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qE.on(Fg.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),qE.on(Fg.STATE_CHANGE,()=>{U0()&&qE.prevState==="suspended"&&qE.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,r){let i=this.elementMap.get(e);if(this.sinkIdMap.set(e,r),i)try{await i.setSinkId(r)}catch(o){throw new _u(Vt.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,r,i,o){if(this.elementMap.has(r))return;let s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([e]),this.bindAudioElementEvents(r,s),this.elementMap.set(r,s),this.elementStateMap.set(r,I0.INIT),this.setVolume(r,i);let l=this.sinkIdMap.get(r);if(l)try{s.setSinkId(l).catch(h=>{B.warning("[".concat(r,"] set sink id failed"),h.toString())})}catch(h){B.warning("[".concat(r,"] set sink id failed"),h.toString())}let d=s.play();d&&d.then&&d.catch(h=>{o&&Ast(o,"audio",h.message,r),B.warning("audio element play warning",h.toString()),this.elementMap.has(r)&&h.name==="NotAllowedError"&&(B.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),dV(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Cst()}))})}updateTrack(e,r){let i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([r]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,r){let i=this.elementMap.get(e);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}stop(e){let r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!r)return;let i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,r){gRt.forEach(i=>{r.addEventListener(i,o=>{let s=this.elementStateMap.get(e),l=o.type==="pause"?"paused":o.type;if(B.debug("[".concat(e,"] audio-element-status change ").concat(s," => ").concat(l)),o.type==="error"){let d=r?.error;d&&B.error("[".concat(e,"] media error, code: ").concat(d.code,", message: ").concat(d.message))}this.elementStateMap.set(e,l)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{B.debug("Auto resume audio element success")}).catch(i=>{B.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new eE(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{_L()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function S_(){return function(e,r,i){let o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new _u(Vt.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",B);for(var s=arguments.length,l=new Array(s),d=0;d<s;d++)l[d]=arguments[d];let h=o.apply(this,l);return h instanceof eE?new eE((p,f)=>{h.then(p).catch(f)}):h}),i}}var f3=class extends s_{constructor(r){super(),_l(this,"name","VideoProcessorDestination"),_l(this,"ID","0"),_l(this,"_source",void 0),_l(this,"videoContext",void 0),_l(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new _u(Vt.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new _u(Vt.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(x0.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(x0.ON_TRACK,void 0)}},m3=class extends s_{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),_l(this,"constraintsMap",new Map),_l(this,"statsRegistry",[]),_l(this,"usageRegistry",[]),_l(this,"trackId",void 0),_l(this,"direction",void 0),_l(this,"_chained",!1),this.trackId=r,this.direction=i}async getConstraints(){return await c0(this,kS.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,i){var o;return B.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),JE(this,kS.REQUEST_UPDATE_CONSTRAINTS,Array.from(eI(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return B.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),JE(this,kS.REQUEST_UPDATE_CONSTRAINTS,Array.from(eI(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name&&s.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){let o=this.statsRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name&&s.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){let r=[];for(let{processorID:i,processorName:o,type:s,cb:l}of this.statsRegistry)try{let d=l();r.push({processorID:i,processorName:o,type:s,stats:d})}catch(d){B.error(new _u(Vt.UNEXPECTED_ERROR,d.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){let i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){let r=[];if(!this.chained)return[];for(let{cb:i}of this.usageRegistry)try{let o=i();o instanceof eE&&(o=await o),r.push(o_(o_({},o),{},{direction:this.direction}))}catch(o){B.error("gather extension usage error",o)}return r}getDirection(){return this.direction}},E3=class extends s_{constructor(r){super(),_l(this,"name","AudioProcessorDestination"),_l(this,"ID","0"),_l(this,"inputTrack",void 0),_l(this,"inputNode",void 0),_l(this,"audioProcessorContext",void 0),_l(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new _u(Vt.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new _u(Vt.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(x0.ON_TRACK,void 0),this.emit(x0.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(x0.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(x0.ON_NODE,this.inputNode))}},_3=class extends s_{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,o){super(),_l(this,"constraintsMap",new Map),_l(this,"statsRegistry",[]),_l(this,"audioContext",void 0),_l(this,"trackId",void 0),_l(this,"direction",void 0),_l(this,"usageRegistry",[]),_l(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=o}async getConstraints(){return c0(this,kS.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,i){var o;return B.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),JE(this,kS.REQUEST_UPDATE_CONSTRAINTS,Array.from(eI(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),JE(this,kS.REQUEST_UPDATE_CONSTRAINTS,Array.from(eI(i=this.constraintsMap).call(i)))}registerStats(r,i,o){this.statsRegistry.find(s=>s.processorID===r.ID&&s.processorName===r.name&&s.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:o})}unregisterStats(r,i){let o=this.statsRegistry.findIndex(s=>s.processorID===r.ID&&s.processorName===r.name&&s.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){let r=[];for(let{processorID:i,processorName:o,type:s,cb:l}of this.statsRegistry)try{let d=l();r.push({processorID:i,processorName:o,type:s,stats:d})}catch(d){B.error(new _u(Vt.UNEXPECTED_ERROR,d.message))}return r}registerUsage(r,i){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){let i=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){let r=[];if(!this.chained)return[];for(let{cb:i}of this.usageRegistry)try{let o=i();o instanceof eE&&(o=await o),r.push(o_(o_({},o),{},{direction:this.direction}))}catch(o){B.error("gather extension usage error",o)}return r}getDirection(){return this.direction}},bL=class extends s_{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),_l(this,"context",void 0),_l(this,"processSourceNode",void 0),_l(this,"outputTrack",void 0),_l(this,"processedNode",void 0),_l(this,"clonedTrack",void 0),_l(this,"outputNode",void 0),this.outputNode=new U8}setVolume(){}createOutputTrack(){throw new _u(Vt.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}},U8=class{disconnect(){}connect(){}};function Ost(e){return new eE((r,i)=>{let o=!1,s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);let l=U0()?"canplay":"playing";s.addEventListener(l,()=>{let d=s.videoWidth,h=s.videoHeight;!d&&f_()||(o=!0,s.srcObject=null,s.remove(),r([d,h]))}),s.srcObject=new MediaStream([e]),s.play().catch(hV),setTimeout(()=>{o||(s.srcObject=null,s.remove(),r([s.videoWidth,s.videoHeight]))},4e3)})}function g3(e){let r={};e.facingMode&&(r.facingMode=e.facingMode),e.cameraId&&(r.deviceId={exact:e.cameraId});let i=TR(e.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!$ot()&&i.frameRate&&(r.frameRate=i.frameRate),zot()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),f_()&&(r.frameRate={ideal:30,max:30}),r}function qZ(e){let r={};if($ot()||(e.AGC!==void 0&&(r.autoGainControl=e.AGC),e.AEC!==void 0&&(r.echoCancellation=e.AEC),e.ANS!==void 0&&(r.noiseSuppression=e.ANS,zI()&&e.ANS&&(r.googHighpassFilter=e.ANS))),e.encoderConfig){let i=u3(e.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return e.microphoneId&&(r.deviceId={exact:e.microphoneId}),uV()&&(r.sampleRate=void 0),r}var vRt=e=>{let r=e._encoderConfig;if(!r)return;let{frameRate:i,width:o,height:s}=e.getMediaStreamTrackSettings(),{frameRate:l=i,width:d=o,height:h=s}=r;if(!l||!d||!h)return;d=p6(d),h=p6(h),l=p6(l);let{max:p,min:f}=function(C,k,A){let P=200*Math.pow(A/15,.6)*Math.pow(C*k/640/360,.75);return{min:Math.floor(P),max:Math.floor(4*P)}}(d,h,l),{bitrateMax:_,bitrateMin:g}=r||{};_||B.debug("calculate bitrate: [w: ".concat(d,", h: ").concat(h,", fps: ").concat(l,"] => [brMax: ").concat(_,", brMin: ").concat(g,"]"));let{maxFramerate:b}=_r("ENCODER_CONFIG_LIMIT");return b&&typeof b=="number"&&(l=Math.min(l,b)),{frameRate:l,bitrateMax:_||p,bitrateMin:g||f,scaleResolutionDownBy:1,scale:0}},Nst=async(e,r,i)=>await(async(o,s,l)=>{let d=function(f){let _=[];for(let g=0;g<f.length;g+=2)_.push(parseInt(f.slice(g,g+2),16));return Uint8Array.from(_)}(sst(""+s+l)).slice(0,16),h=d.slice(0,12),p=await window.crypto.subtle.importKey("raw",d,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:h},p,o))})(e.buffer,r,i),cH=e=>{let r=document.createElement("canvas");return r.width=2,r.height=2,new eE((i,o)=>{r.toBlob(async s=>{if(r.remove(),s){let l=await kst(s);i({buffer:l,width:r.width,height:r.height})}else o(new _u(Vt.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},kst=async e=>{let r=await e.arrayBuffer();return new Uint8Array(r)},WZ,HZ,KZ,zZ,YZ,JZ,XZ,QZ,ZZ,$Z,t$,e$,n$,r$,i$,o$,s$,a$,c_,c$,u$,l$,d$,h$,p$,lR,f$,m$,E$,_$,g$,v$,y$,S$,T$,b$,R$,w$,I$,n0,h_=(WZ=pE({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),HZ=pE({argsMap:(e,r)=>[e.getTrackId(),r]}),KZ=S_(),zZ=L1("LocalAudioTrack","_enabledMutex"),YZ=pE({argsMap:(e,r)=>[e.getTrackId(),r]}),JZ=S_(),XZ=L1("LocalAudioTrack","_enabledMutex"),QZ=pE({argsMap:(e,r)=>[e.getTrackId(),r]}),ZZ=S_(),$Z=S_(),t$=S_(),e$=pE({argsMap:e=>[e.getTrackId()]}),n$=S_(),r$=pE({argsMap:e=>[e.getTrackId()]}),i$=S_(),o$=pE({argsMap:e=>[e.getTrackId()]}),s$=pE({argsMap:(e,r)=>[e.getTrackId(),r.name]}),a$=pE({argsMap:e=>[e.getTrackId()]}),kE((c_=class extends WI{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?H0.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,r,i,o){super(e,i),_l(this,"trackMediaType",tP.AUDIO),_l(this,"_encoderConfig",void 0),_l(this,"_trackSource",void 0),_l(this,"_enabled",!0),_l(this,"_volume",100),_l(this,"_useAudioElement",!0),_l(this,"_bypassWebAudio",!1),_l(this,"processor",void 0),_l(this,"_processorContext",void 0),_l(this,"_processorDestination",void 0),_l(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new bL,_r("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),_r("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),a0()&&!TS?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){HE(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&H0.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void B.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,JE(this,iE.NEED_REPLACE_TRACK,this).then(()=>{B.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{B.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!yst())throw new _u(Vt.NOT_SUPPORTED,"your browser does not support setting the audio output device");await H0.setSinkID(this.getTrackId(),e)}async setEnabled(e,r,i){return this._setEnabled(e,r,i)}async _setEnabled(e,r,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(B.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await JE(this,iE.NEED_ENABLE_TRACK,this),B.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),B.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await JE(this,iE.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),B.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,B.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await JE(this,iE.NEED_MUTE_TRACK,this):await JE(this,iE.NEED_UNMUTE_TRACK,this))}getStats(){return _C(()=>{B.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),JS(this,iE.GET_STATS)||o_({},D8)}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(AS.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(AS.ON_AUDIO_BUFFER),this._source.on(AS.ON_AUDIO_BUFFER,i=>e(i))}play(){B.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(B.debug("[".concat(this.getTrackId(),"] start audio playback in element")),H0.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){B.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?H0.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];B.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&H0.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,r){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await JE(this,iE.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return eE.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new _u(Vt.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new _u(Vt.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(e){e.on(x0.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await JE(this,iE.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await JE(this,iE.NEED_REPLACE_TRACK,this))}),e.on(x0.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(e){e.removeAllListeners(x0.ON_TRACK),e.removeAllListeners(x0.ON_NODE)}bindProcessorContextEvents(e){e.on(kS.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(kS.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof bL&&(this._trackSource=new p3(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new _3(this._source.context,this.getTrackId(),"local"),r=new E3(e);return this._processorContext=e,this._processorDestination=r,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(r),this._source.on(AS.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(H0.stop(this.getTrackId()),this._source.play()),JE(this,iE.NEED_REPLACE_MIXING_TRACK,this).then(()=>{B.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{B.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:r}}}).prototype,"setVolume",[WZ],Object.getOwnPropertyDescriptor(c_.prototype,"setVolume"),c_.prototype),kE(c_.prototype,"setPlaybackDevice",[HZ,KZ],Object.getOwnPropertyDescriptor(c_.prototype,"setPlaybackDevice"),c_.prototype),kE(c_.prototype,"setEnabled",[zZ,YZ,JZ],Object.getOwnPropertyDescriptor(c_.prototype,"setEnabled"),c_.prototype),kE(c_.prototype,"setMuted",[XZ,QZ,ZZ],Object.getOwnPropertyDescriptor(c_.prototype,"setMuted"),c_.prototype),kE(c_.prototype,"getStats",[$Z],Object.getOwnPropertyDescriptor(c_.prototype,"getStats"),c_.prototype),kE(c_.prototype,"setAudioFrameCallback",[t$],Object.getOwnPropertyDescriptor(c_.prototype,"setAudioFrameCallback"),c_.prototype),kE(c_.prototype,"play",[e$,n$],Object.getOwnPropertyDescriptor(c_.prototype,"play"),c_.prototype),kE(c_.prototype,"stop",[r$,i$],Object.getOwnPropertyDescriptor(c_.prototype,"stop"),c_.prototype),kE(c_.prototype,"close",[o$],Object.getOwnPropertyDescriptor(c_.prototype,"close"),c_.prototype),kE(c_.prototype,"pipe",[s$],Object.getOwnPropertyDescriptor(c_.prototype,"pipe"),c_.prototype),kE(c_.prototype,"unpipe",[a$],Object.getOwnPropertyDescriptor(c_.prototype,"unpipe"),c_.prototype),c_),v3=(c$=pE({argsMap:(e,r)=>[e.getTrackId(),r]}),u$=S_(),l$=L1("MicrophoneAudioTrack","_enabledMutex"),d$=pE({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),h$=S_(),p$=pE({argsMap:e=>[e.getTrackId()]}),kE((lR=class extends h_{get __className__(){return"MicrophoneAudioTrack"}constructor(e,r,i,o){super(e,r.encoderConfig?u3(r.encoderConfig):{},o,_r("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),_l(this,"_config",void 0),_l(this,"_deviceName","default"),_l(this,"_constraints",void 0),_l(this,"_originalConstraints",void 0),_l(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(D1()||g8())&&qE.bindInterruptDetectorTrack(this)}async setDevice(e){if(B.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let r=await NS.getDeviceById(e),i={};i.audio=o_({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await IS(i,this.getTrackId())}catch(s){throw B.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),o=await IS({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw B.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{let r=await NS.getDeviceById(e);this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw B.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}B.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,r,i){if(r)return B.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(B.info("[".concat(this.getTrackId(),"] start setEnabled"),e),_r("AUTO_RESET_AUDIO_ROUTE")&&(U0()||wT())){let d=navigator.audioSession;d&&(e||(d.type="playback"),d.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await JE(this,iE.NEED_DISABLE_TRACK,this)}catch(d){throw B.error("[".concat(this.getTrackId(),"] setEnabled false failed"),d.toString()),d}return}let s=o_({},this._constraints),l=NS.searchDeviceIdByName(this._deviceName);l&&!s.deviceId&&(s.deviceId=l);try{i||(this._enabled=!0);let d=await IS({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),await JE(this,iE.NEED_ENABLE_TRACK,this)}catch(d){throw i||(this._enabled=!1),B.error("[".concat(this.getTrackId(),"] setEnabled true failed"),d.toString()),d}B.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(D1()||g8())&&qE.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((U0()||wT())&&this._enabled&&!this._isClosed&&qE.duringInterruption){let e=async()=>{qE.off(Fg.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(B.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};qE.on(Fg.IOS_INTERRUPTION_END,e)}else B.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_k.TRACK_ENDED)}async renewMediaStreamTrack(e){let r=e||this._constraints,i=NS.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();let o=await IS({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(kS.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{let s=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(s),i()}catch(s){o(s)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(kS.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[c$,u$],Object.getOwnPropertyDescriptor(lR.prototype,"setDevice"),lR.prototype),kE(lR.prototype,"setEnabled",[l$,d$,h$],Object.getOwnPropertyDescriptor(lR.prototype,"setEnabled"),lR.prototype),kE(lR.prototype,"close",[p$],Object.getOwnPropertyDescriptor(lR.prototype,"close"),lR.prototype),lR),yRt=(f$=pE({argsMap:(e,r)=>[e.getTrackId(),r,e.duration]}),m$=S_(),E$=pE({argsMap:e=>[e.getTrackId()]}),_$=S_(),g$=pE({argsMap:e=>[e.getTrackId()]}),v$=S_(),y$=pE({argsMap:e=>[e.getTrackId()]}),S$=S_(),T$=pE({argsMap:e=>[e.getTrackId()]}),b$=S_(),R$=pE({argsMap:e=>[e.getTrackId()]}),w$=pE({argsMap:e=>[e.getTrackId()]}),I$=S_(),kE((n0=class extends h_{get __className__(){return"BufferSourceAudioTrack"}constructor(e,r,i,o){super(r.createOutputTrack(),i,o),_l(this,"source",void 0),_l(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=r,this._bufferSource.on(AS.AUDIO_SOURCE_STATE_CHANGE,s=>{this.safeEmit(_k.SOURCE_STATE_CHANGE,s)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){HE(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[f$,m$],Object.getOwnPropertyDescriptor(n0.prototype,"startProcessAudioBuffer"),n0.prototype),kE(n0.prototype,"pauseProcessAudioBuffer",[E$,_$],Object.getOwnPropertyDescriptor(n0.prototype,"pauseProcessAudioBuffer"),n0.prototype),kE(n0.prototype,"seekAudioBuffer",[g$,v$],Object.getOwnPropertyDescriptor(n0.prototype,"seekAudioBuffer"),n0.prototype),kE(n0.prototype,"resumeProcessAudioBuffer",[y$,S$],Object.getOwnPropertyDescriptor(n0.prototype,"resumeProcessAudioBuffer"),n0.prototype),kE(n0.prototype,"stopProcessAudioBuffer",[T$,b$],Object.getOwnPropertyDescriptor(n0.prototype,"stopProcessAudioBuffer"),n0.prototype),kE(n0.prototype,"close",[R$],Object.getOwnPropertyDescriptor(n0.prototype,"close"),n0.prototype),kE(n0.prototype,"setAudioBufferPlaybackSpeed",[w$,I$],Object.getOwnPropertyDescriptor(n0.prototype,"setAudioBufferPlaybackSpeed"),n0.prototype),n0),D_=class e extends h_{get __className__(){return"MixingAudioTrack"}get isActive(){for(let r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){let r=eP().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,ZE(8,"track-mix-")),_l(this,"trackList",void 0),_l(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(B.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):B.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){B.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}r3(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){let r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof e?i.emit(YO.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}},x8=class extends h3{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(AS.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),_l(this,"audioBuffer",void 0),_l(this,"sourceNode",void 0),_l(this,"startPlayTime",0),_l(this,"startPlayOffset",0),_l(this,"pausePlayTime",0),_l(this,"options",void 0),_l(this,"currentLoopCount",0),_l(this,"currentPlaybackSpeed",100),_l(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):B.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}},C$=new Map,RL=class{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let r=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(B.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var i;r!==this._videoState&&(this._videoState=r,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(r){_l(this,"trackId",void 0),_l(this,"config",void 0),_l(this,"onFirstVideoFrameDecoded",void 0),_l(this,"onVideoStateChanged",void 0),_l(this,"freezeTimeCounterList",[]),_l(this,"renderFreezeAccTime",0),_l(this,"isKeepLastFrame",!1),_l(this,"timeUpdatedCount",0),_l(this,"freezeTime",0),_l(this,"playbackTime",0),_l(this,"lastTimeUpdatedTime",0),_l(this,"autoplayFailed",!1),_l(this,"videoTrack",void 0),_l(this,"videoElement",void 0),_l(this,"cacheVideoElement",void 0),_l(this,"renderStats",void 0),_l(this,"_videoState",uR.VideoStateStopped),_l(this,"videoElementCheckInterval",void 0),_l(this,"videoElementFreezeTimeout",void 0),_l(this,"_videoElementStatus",I0.NONE),_l(this,"isGettingVideoDimensions",!1),_l(this,"startGetVideoDimensions",()=>{let i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return B.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),_l(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&qE.curState==="running"&&(B.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(MQ())),VQ()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),_l(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=I0.PLAYING;break;case"loadeddata":if(this.videoState=uR.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=I0.CANPLAY;break;case"stalled":this.videoElementStatus=I0.STALLED;break;case"suspend":this.videoElementStatus=I0.SUSPEND;break;case"pause":this.videoElementStatus=I0.PAUSED,U0()||wT()||a0()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(B.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=I0.WAITING;break;case"abort":this.videoElementStatus=I0.ABORT;break;case"ended":this.videoElementStatus=I0.ENDED;break;case"emptied":this.videoElementStatus=I0.EMPTIED;break;case"error":{let o=this.videoElement.error,s=o?"".concat(o.message," (").concat(o.code,")"):"";o&&(this.videoElementStatus=I0.ERROR),B.error("[".concat(this.trackId,"] media error: ").concat(s," "));break}case"timeupdate":{let o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);let s=o-this.lastTimeUpdatedTime,l=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,JR.lastVisibleTime<JR.lastHiddenTime||l<JR.lastHiddenTime||l<JR.lastVisibleTime)return;for(s>_r("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;let d=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(d),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),_l(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(B.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(MQ())),VQ()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),qE.on(Fg.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qE.on(Fg.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){let i=this.videoElement.play();i&&i.catch&&i.catch(s=>{r&&Ast(r,"video",s.message,this.trackId),s.name==="NotAllowedError"?(B.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):B.warning("[".concat(this.trackId,"] play warning: "),s)});let o=DE();if((o.name==="Safari"&&Number(o.version)===15||D1())&&i&&i.then){let s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(s).catch(s)}}getCurrentFrame(){let r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;let i=r.getContext("2d");if(!i)return B.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);let o=i.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;let s=o.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,o.width,o.height),new eE((l,d)=>{o.toBlob(async h=>{if(o.remove(),h){let p=await kst(h);l({buffer:p,width:o.width,height:o.height})}else d(new _u(Vt.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,i<0?.1:i>1?1:i)})):await cH(r)}destroy(){this.renderStats=void 0,qE.off(Fg.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qE.off(Fg.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=uR.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=I0.INIT,!this.videoElementCheckInterval&&(A$.forEach(l=>{this.videoElement.addEventListener(l,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(l){return l!==document.body&&document.body.contains(l)})(this.videoElement)||(this.videoElementStatus=I0.DESTROYED)},1e3),_r("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let l,d=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",d),this.videoElementFreezeTimeout=window.setTimeout(h,_r("VIDEO_FREEZE_DURATION")))},h=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===uR.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=uR.VideoStateFrozen:document.addEventListener("visibilitychange",d))},p=(f,_)=>{if(this.videoElementStatus===I0.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=_.mediaTime):this.renderStats={lastTs:_.mediaTime,curTs:_.mediaTime,lastRenderNum:0,renderNum:0},l){let C=_.presentationTime-l.presentationTime;this.videoState===uR.VideoStateStarting&&(this.videoState=uR.VideoStateDecoding),this.videoState===uR.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(h,_r("VIDEO_FREEZE_DURATION"))),C<_r("VIDEO_FREEZE_DURATION")&&this.videoState===uR.VideoStateFrozen&&(this.videoState=uR.VideoStateDecoding),C>_r("VIDEO_FREEZE_DURATION")&&JR.lastVisibleTime>=JR.lastHiddenTime&&l.timestamp>JR.lastVisibleTime&&l.timestamp>JR.lastHiddenTime&&(this.renderFreezeAccTime+=C)}l=o_(o_({},_),{},{timestamp:f})}var g,b;_r("ENABLE_VIDEO_FRAME_CALLBACK")&&((g=(b=this.videoElement).requestVideoFrameCallback)===null||g===void 0||g.call(b,p))};(r=(i=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(i,p)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),uV()&&!_r("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let o=DE();o.name==="Safari"&&Number(o.version)===15||D1()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,f_()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,f_()&&this.videoElement.load());let s=this.videoElement.play();s!==void 0&&s.catch(l=>{B.debug("[".concat(this.trackId,"] playback interrupted"),l.toString())})}resetVideoElement(){A$.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=I0.NONE}handleAutoPlayFailed(){let r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{B.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{B.error(o)}),this.autoplayFailed=!1,_L()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};_L()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),Cst()}},A$=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"],y3=class extends RL{constructor(r){super(r),_l(this,"container",void 0),_l(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;let i=r.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await cH(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",_r("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}},O$,N$,k$,P$,D$,L$,M$,U$,x$,j$,V$,F$,B$,G$,q$,W$,H$,K$,z$,Y$,J$,X$,Q$,Z$,AE,$$,ttt,ett,ntt,rtt,itt,ott,stt,SS,e_=(O$=pE({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),N$=S_(),k$=pE({argsMap:e=>[e.getTrackId()]}),P$=L1("LocalVideoTrack","_enabledMutex"),D$=pE({argsMap:(e,r)=>[e.getTrackId(),r]}),L$=S_(),M$=L1("LocalVideoTrack","_enabledMutex"),U$=pE({argsMap:(e,r)=>[e.getTrackId(),r]}),x$=S_(),j$=pE({argsMap:(e,r)=>[e.getTrackId(),r]}),V$=S_(),F$=S_(),B$=pE({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),G$=S_(),q$=S_(),W$=S_(),H$=S_(),K$=S_(),z$=S_(),Y$=S_(),J$=pE({argsMap:(e,r)=>[e.getTrackId(),r.name]}),X$=pE({argsMap:e=>[e.getTrackId()]}),Q$=pE({argsMap:e=>[e.getTrackId()]}),Z$=pE({argsMap:(e,r,i)=>[e.getTrackId(),r.label,i]}),AE=class Pst extends WI{get videoHeight(){if(a0()){let{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(a0()){let{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==I0.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,o,s,l,d){if(super(r,l),_l(this,"trackMediaType",tP.VIDEO),_l(this,"_player",void 0),_l(this,"isUseScaleResolutionDownBy",!1),_l(this,"_videoVisibleTimer",null),_l(this,"_previousVideoVisibleStatus",void 0),_l(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_l(this,"_encoderConfig",void 0),_l(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),_l(this,"_optimizationMode",void 0),_l(this,"_videoHeight",void 0),_l(this,"_videoWidth",void 0),_l(this,"_forceBitrateLimit",void 0),_l(this,"_enabled",!0),_l(this,"_processorDestination",void 0),_l(this,"_processorContext",void 0),a0()){let{width:h,height:p}=r.getSettings();this._videoWidth=h,this._videoHeight=p}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=s,this._hints=d||[],this._hints.indexOf(XE.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(h,p,f){let _=DE();return!(_.name!==h||!_.osVersion)&&(f?Number(_.version)>=p&&Number(_.version)<=f:Number(_.version)===p)}(FE.CHROME,115)&&cV().indexOf("Windows")!==-1){let h=function(p,f){if("VideoFrame"in window&&"TransformStream"in window&&ME().supportWebRTCInsertableStream){let _=new MediaStreamTrackProcessor(p),g=new MediaStreamTrackGenerator({kind:"video"}),b,C,k=Date.now(),A=()=>{P&&(clearInterval(P),P=void 0),b&&(b.close(),b=void 0),p.stop(),C=void 0,g.removeEventListener("ended",A)},P=window.setInterval(()=>{if(C&&b&&Date.now()-k>(f??1e3))try{g.readyState==="live"?C.enqueue(b.clone()):A()}catch{A()}},f??1e3),x=new TransformStream({transform:(j,z)=>{g.readyState==="live"?(C=z,k=Date.now(),b===void 0?(b=j,z.enqueue(j.clone())):(z.enqueue(b),b=j)):j.close()}});return g.addEventListener("ended",A),_.readable.pipeThrough(x).pipeTo(g.writable),g}}(r);h&&(B.info("local screen video track begin to inject frame"),this._mediaStreamTrack=h)}i&&this._hints.indexOf(XE.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new m3(this.getTrackId(),"local"),this._processorDestination=new f3(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){let s=document.getElementById(r);s?r=s:(B.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}B.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));let o=o_(o_(o_({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new RL(o):this._player=new y3(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let s=this.getVideoElementVisibleStatus();this.safeEmit(_k.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}},_r("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,B.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(B.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await JE(this,iE.NEED_DISABLE_TRACK,this)}catch(o){throw B.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void B.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await JE(this,iE.NEED_ENABLE_TRACK,this)}catch(o){throw B.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}B.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,B.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await JE(this,iE.NEED_MUTE_TRACK,this):await JE(this,iE.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,i){if(!this._enabled)throw new _u(Vt.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=TR(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){let o=g3({encoderConfig:r});(a0()||U0()||wT())&&(o.deviceId=void 0),B.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(s){let l=new _u(Vt.UNEXPECTED_ERROR,s.toString());throw B.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}}this._encoderConfig=r,this._hints.indexOf(XE.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await JE(this,iE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(B)}}getStats(){return _C(()=>{B.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),JS(this,iE.GET_STATS)||o_({},L8)}async setBeautyEffect(r){B.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await cH(r)}async setBitrateLimit(r){if(B.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r){this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate);try{await JE(this,iE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(B)}}}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void B.error(Vt.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let i=this._optimizationMode;try{this._optimizationMode=r,await JE(this,iE.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,B.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}B.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return B.error(Vt.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,B.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){Ost(this._originMediaStreamTrack).then(r=>{let[i,o]=r;this._videoHeight=o,this._videoWidth=i}).catch(hV)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new _u(Vt.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");B.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=TR(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(XE.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await JE(this,iE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(B)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:r,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!i||!o)return;let{bitrateMax:s,bitrateMin:l}=this._encoderConfig;if(l==null||s==null){let{max:d,min:h}=function(p,f,_,g,b){let C=_r("BITRATE_ADAPTER_TYPE");if(C==="DEFAULT_BITRATE")return{min:g,max:b};if(b===void 0){var k;let P=Math.floor(200*Math.pow(_/15,.6)*Math.pow(p*f/640/360,.75));b=C==="STANDARD_BITRATE"?4*P:2*P,g=(k=g)!==null&&k!==void 0?k:P}else{var A;g=(A=g)!==null&&A!==void 0?A:Math.floor(b/10)}return{min:g,max:b}}(r,i,o,l,s);this._encoderConfig.bitrateMin=h,this._encoderConfig.bitrateMax=d,B.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(d,", brMin: ").concat(h,"]"))}}getVideoElementVisibleStatus(){try{var r,i;let o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),s={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o?.parentElement},{element:l,slot:d}=s;if(this.isPlaying&&l instanceof HTMLVideoElement&&d instanceof HTMLElement){let h=est.checkOneElementVisible(l),p=Object.assign({},h);if(p.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=p.visible;let f=aE.reportApiInvoke(null,{tag:p_.TRACER,name:L_.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});p.visible?f.onSuccess("Video is visible"):f.onSuccess("Invisible because of ".concat(p.reason))}return p}return}catch(o){throw new _u(Vt.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new _u(Vt.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;let r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=o_(o_({},o),TR(r))),o=BO(o);let s=ZE(8,"track-video-cloned-"),l=new Pst(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,BO(this._scalabilityMode),this._optimizationMode,s,BO(this._hints));return r&&o&&l.setEncoderConfiguration(o),B.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(i)),l}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new _u(Vt.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new _u(Vt.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(_C(()=>{aE.reportApiInvoke(null,{name:L_.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:p_.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!_r("ENABLE_VIDEO_SEI")||!_r("ENABLE_ENCODED_TRANSFORM"))return void B.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new _u(Vt.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let i=this.getRTCRtpTransceiver();if(!i)return void B.warning("Video track is not published, SEI can not be send");let o=i.sender.getParameters();if(o.codecs.length===0)return;let s=o.codecs[0].mimeType.toLocaleLowerCase();s==="video/h264"?this.safeEmit("sei-to-send",r):B.warning("SEI is not supported by ".concat(s))}bindProcessorDestinationEvents(){this.processorDestination.on(x0.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await JE(this,iE.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await JE(this,iE.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(x0.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(kS.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(kS.REQUEST_CONSTRAINTS)}},kE(AE.prototype,"play",[O$,N$],Object.getOwnPropertyDescriptor(AE.prototype,"play"),AE.prototype),kE(AE.prototype,"stop",[k$],Object.getOwnPropertyDescriptor(AE.prototype,"stop"),AE.prototype),kE(AE.prototype,"setEnabled",[P$,D$,L$],Object.getOwnPropertyDescriptor(AE.prototype,"setEnabled"),AE.prototype),kE(AE.prototype,"setMuted",[M$,U$,x$],Object.getOwnPropertyDescriptor(AE.prototype,"setMuted"),AE.prototype),kE(AE.prototype,"setEncoderConfiguration",[j$,V$],Object.getOwnPropertyDescriptor(AE.prototype,"setEncoderConfiguration"),AE.prototype),kE(AE.prototype,"getStats",[F$],Object.getOwnPropertyDescriptor(AE.prototype,"getStats"),AE.prototype),kE(AE.prototype,"setBeautyEffect",[B$,G$],Object.getOwnPropertyDescriptor(AE.prototype,"setBeautyEffect"),AE.prototype),kE(AE.prototype,"getCurrentFrameData",[q$],Object.getOwnPropertyDescriptor(AE.prototype,"getCurrentFrameData"),AE.prototype),kE(AE.prototype,"getCurrentFrameImage",[W$],Object.getOwnPropertyDescriptor(AE.prototype,"getCurrentFrameImage"),AE.prototype),kE(AE.prototype,"setBitrateLimit",[H$],Object.getOwnPropertyDescriptor(AE.prototype,"setBitrateLimit"),AE.prototype),kE(AE.prototype,"setOptimizationMode",[K$],Object.getOwnPropertyDescriptor(AE.prototype,"setOptimizationMode"),AE.prototype),kE(AE.prototype,"setScalabiltyMode",[z$],Object.getOwnPropertyDescriptor(AE.prototype,"setScalabiltyMode"),AE.prototype),kE(AE.prototype,"updateMediaStreamTrackResolution",[Y$],Object.getOwnPropertyDescriptor(AE.prototype,"updateMediaStreamTrackResolution"),AE.prototype),kE(AE.prototype,"pipe",[J$],Object.getOwnPropertyDescriptor(AE.prototype,"pipe"),AE.prototype),kE(AE.prototype,"unpipe",[X$],Object.getOwnPropertyDescriptor(AE.prototype,"unpipe"),AE.prototype),kE(AE.prototype,"close",[Q$],Object.getOwnPropertyDescriptor(AE.prototype,"close"),AE.prototype),kE(AE.prototype,"replaceTrack",[Z$],Object.getOwnPropertyDescriptor(AE.prototype,"replaceTrack"),AE.prototype),AE),j8=($$=pE({argsMap:(e,r)=>[e.getTrackId(),r]}),ttt=S_(),ett=L1("CameraVideoTrack","_enabledMutex"),ntt=pE({argsMap:(e,r)=>[e.getTrackId(),r]}),rtt=S_(),itt=pE({argsMap:(e,r)=>[e.getTrackId(),r]}),ott=S_(),stt=pE({argsMap:e=>[e.getTrackId()]}),SS=class Dst extends e_{get __className__(){return"CameraVideoTrack"}constructor(r,i,o,s,l,d){super(r,TR(i.encoderConfig),s,l,d),_l(this,"_config",void 0),_l(this,"_originalConstraints",void 0),_l(this,"_constraints",void 0),_l(this,"_enabled",!0),_l(this,"_deviceName","default"),_l(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(D1()||g8())&&!function(){let h=DE();if(h.os!==W_.IOS||!h.osVersion)return!1;let p=h.osVersion.split(".");return Number(p[0])===15&&Number(p[1])>=2}()&&Zot()&&this._enabled&&!this._isClosed&&(B.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=TR(this._config.encoderConfig),qE.on(Fg.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),qE.on(Fg.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(B.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{let i=await NS.getDeviceById(r),o={};o.video=o_({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await IS(o,this.getTrackId())}catch(l){throw B.error("[".concat(this.getTrackId(),"] setDevice failed"),l.toString()),s=await IS({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),l}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw B.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{let i=await NS.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw B.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}B.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){B.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));let i={video:o_(o_({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await IS(i,this.getTrackId())}catch(s){throw B.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),s.toString()),o=await IS({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=o_({},i.video),B.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(B.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let o=await IS({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await JE(this,iE.NEED_ENABLE_TRACK,this)}catch(o){throw B.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),B.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await JE(this,iE.NEED_DISABLE_TRACK,this)}catch(o){throw B.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}B.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new _u(Vt.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=TR(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);let o=R_(this._config);o.encoderConfig=r;let s=g3(o);(a0()||U0()||wT())&&(s.deviceId=void 0),B.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(l){let d=new _u(Vt.UNEXPECTED_ERROR,l.toString());throw B.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}this._config=o,this._constraints=s,this._originalConstraints=s,this._encoderConfig=r,this._hints.indexOf(XE.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await JE(this,iE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(l){return l.throw(B)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((U0()||wT())&&this._enabled&&!this._isClosed&&qE.duringInterruption){let r=async()=>{qE.off(Fg.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(B.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};qE.on(Fg.IOS_INTERRUPTION_END,r)}else B.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(_k.TRACK_ENDED)}async renewMediaStreamTrack(r){let i=r||this._constraints,o=NS.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){let s=await IS({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),qE.off(Fg.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),qE.off(Fg.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=o_(o_({},o),TR(r))),o=BO(o);let s=ZE(8,"track-cam-cloned-"),l=new Dst(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,BO(o_(o_({},this._config),{},{encoderConfig:o})),BO(this._constraints),BO(this._scalabilityMode),this._optimizationMode,s);return r&&o&&l.setEncoderConfiguration(o),B.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(i)),l}bindProcessorContextEvents(){this.processorContext.on(kS.REQUEST_UPDATE_CONSTRAINTS,async(r,i,o)=>{try{let s=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(s),i()}catch(s){o(s)}}),this.processorContext.on(kS.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},kE(SS.prototype,"setDevice",[$$,ttt],Object.getOwnPropertyDescriptor(SS.prototype,"setDevice"),SS.prototype),kE(SS.prototype,"setEnabled",[ett,ntt,rtt],Object.getOwnPropertyDescriptor(SS.prototype,"setEnabled"),SS.prototype),kE(SS.prototype,"setEncoderConfiguration",[itt,ott],Object.getOwnPropertyDescriptor(SS.prototype,"setEncoderConfiguration"),SS.prototype),kE(SS.prototype,"close",[stt],Object.getOwnPropertyDescriptor(SS.prototype,"close"),SS.prototype),SS);function z6(e,r,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=o_(o_({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?B.debug("[".concat(e,"] set content hint to"),i.optimizationMode):B.debug("[".concat(e,"] set content hint failed")))):B.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var att,ctt,utt,ltt,VS,dtt,htt,ptt,ftt,mtt,Ett,b0,S3=class extends l3{getUserId(){return this._userId}constructor(r,i,o,s){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(s.clientId,"_").concat(ZE(5,""))),_l(this,"_userId",void 0),_l(this,"_uintId",void 0),_l(this,"_isDestroyed",!1),_l(this,"store",void 0),_l(this,"processor",void 0),_l(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=s}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,B.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}},I1=(att=pE({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),ctt=pE({argsMap:e=>[e.getTrackId()]}),utt=pE({argsMap:(e,r)=>[e.getTrackId(),r.name]}),ltt=pE({argsMap:e=>[e.getTrackId()]}),kE((VS=class extends S3{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==I0.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,r,i,o){super(e,r,i,o),_l(this,"_videoVisibleTimer",null),_l(this,"_previousVideoVisibleStatus",void 0),_l(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_l(this,"trackMediaType",tP.VIDEO),_l(this,"_videoWidth",void 0),_l(this,"_videoHeight",void 0),_l(this,"_player",void 0),_l(this,"processorDestination",void 0),_l(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new m3(this.getTrackId(),"remote"),this.processorDestination=new f3(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return _C(()=>{B.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),JS(this,iE.GET_STATS)||o_({},Tst)}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let o=document.getElementById(e);o?e=o:(B.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}B.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));let i=o_(o_({fit:"cover"},r),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new RL(i):this._player=new y3(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(w1.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(w1.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let o=this.getVideoElementVisibleStatus();this.safeEmit(w1.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},_r("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,B.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Ost(this._originMediaStreamTrack).then(e=>{let[r,i]=e;this._videoHeight=i,this._videoWidth=r}).catch(hV)}_updatePlayerSource(){B.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,r;let i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i?.parentElement},{element:s,slot:l}=o;if(this.isPlaying&&s instanceof HTMLVideoElement&&l instanceof HTMLElement){let d=est.checkOneElementVisible(s),h=Object.assign({},d);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;let p=aE.reportApiInvoke(null,{tag:p_.TRACER,name:L_.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(i){throw new _u(Vt.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new _u(Vt.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(x0.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(x0.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(YO.SEI_RECEIVED,e)}}).prototype,"play",[att],Object.getOwnPropertyDescriptor(VS.prototype,"play"),VS.prototype),kE(VS.prototype,"stop",[ctt],Object.getOwnPropertyDescriptor(VS.prototype,"stop"),VS.prototype),kE(VS.prototype,"pipe",[utt],Object.getOwnPropertyDescriptor(VS.prototype,"pipe"),VS.prototype),kE(VS.prototype,"unpipe",[ltt],Object.getOwnPropertyDescriptor(VS.prototype,"unpipe"),VS.prototype),VS),C1=(dtt=pE({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),htt=pE({argsMap:(e,r)=>[e.getTrackId(),r]}),ptt=pE({argsMap:e=>[e.getTrackId()]}),ftt=pE({argsMap:e=>[e.getTrackId()]}),mtt=pE({argsMap:(e,r)=>[e.getTrackId(),r.name]}),Ett=pE({argsMap:e=>[e.getTrackId()]}),kE((b0=class extends S3{get isPlaying(){return this._useAudioElement?H0.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,r,i,o){super(e,r,i,o),_l(this,"trackMediaType",tP.AUDIO),_l(this,"_source",void 0),_l(this,"_useAudioElement",!0),_l(this,"_volume",100),_l(this,"processorContext",void 0),_l(this,"processorDestination",void 0),_l(this,"_played",!1),_l(this,"_bypassWebAudio",!1),_r("DISABLE_WEBAUDIO")?(this._source=new bL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new p3(e,!0),_r("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(AS.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(w1.FIRST_FRAME_DECODED)}),this.processorContext=new _3(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new E3(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(AS.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(AS.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(AS.ON_AUDIO_BUFFER),this._source.on(AS.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?H0.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!yst())throw new _u(Vt.NOT_SUPPORTED,"your browser does not support setting the audio output device");await H0.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return _C(()=>{B.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),JS(this,iE.GET_STATS)||o_({},Sst)}play(){B.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(B.debug("[".concat(this.getTrackId(),"] use audio element to play")),H0.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){B.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?H0.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];B.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&H0.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new _u(Vt.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new _u(Vt.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new _u(Vt.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(x0.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(x0.ON_NODE,e=>{this._source.processedNode=e;let r=!e;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(x0.ON_TRACK),this.processorDestination.removeAllListeners(x0.ON_NODE)}}).prototype,"setVolume",[dtt],Object.getOwnPropertyDescriptor(b0.prototype,"setVolume"),b0.prototype),kE(b0.prototype,"setPlaybackDevice",[htt],Object.getOwnPropertyDescriptor(b0.prototype,"setPlaybackDevice"),b0.prototype),kE(b0.prototype,"play",[ptt],Object.getOwnPropertyDescriptor(b0.prototype,"play"),b0.prototype),kE(b0.prototype,"stop",[ftt],Object.getOwnPropertyDescriptor(b0.prototype,"stop"),b0.prototype),kE(b0.prototype,"pipe",[mtt],Object.getOwnPropertyDescriptor(b0.prototype,"pipe"),b0.prototype),kE(b0.prototype,"unpipe",[Ett],Object.getOwnPropertyDescriptor(b0.prototype,"unpipe"),b0.prototype),b0),JR=new class extends s_{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),_l(this,"_lastHiddenTime",0),_l(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),B.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}},T3=class extends s_{constructor(r,i){super(),_l(this,"trackMediaType",tP.DATA),_l(this,"_version",1),_l(this,"_type",3),_l(this,"_config",void 0),_l(this,"_originDataChannel",void 0),_l(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),_l(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),_l(this,"_datachannelEventMap",new Map),this._config=r,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return _r("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new eE((r,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();let o=setTimeout(()=>{var s;i(new _u(Vt.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((s=this._originDataChannel)===null||s===void 0?void 0:s.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new _u(Vt.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new _u(Vt.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){let r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[UU.OPEN,UU.CLOSE,UU.ERROR].forEach(i=>{let o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),r.addEventListener(i,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,s]=i;r.removeEventListener(o,s)}),this._datachannelEventMap.clear()}},V8=class extends T3{constructor(r){super(r),_l(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),s=new DataView(o).getUint8(3);if(s!==this.id)return void(_r("SHOW_DATASTREAM2_LOG")&&B.debug("invalid datachannel id: ".concat(s," !== ").concat(this.id)));let l=i.data.slice(this._dataStreamPacketHeader.byteLength);l=this._dataStreamPacketHandler.deserialize(l),this.emit(UU.MESSAGE,l)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}},F8=class extends T3{send(r){if(this._originDataChannel){let i=r;i=this._dataStreamPacketHandler.serialize(r);let o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}};function jU(){let e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>jZ.revokeObjectURL(e),0),new Worker(jZ.createObjectURL(e))}var $M=new Map,tU=new Map;function SRt(e,r,i){let o=new Uint8Array(e,r,i),s=[],l=0;for(;s.length<i;)l+3<i&&o[l]===0&&o[l+1]===0&&o[l+2]===3&&(o[l+3]===0||o[l+3]===1||o[l+3]===2||o[l+3]===3)?(s.push(o[l],o[l+1],o[l+3]),l+=4):(s.push(o[l]),l++);return new Uint8Array(s)}var eU=new Map;async function TRt(e,r){if(!ME().supportWebRTCEncodedTransform)return void B.warning("browser not support video encoded transform");if(eU.has(e)||!e.track)return;let i={track:e.track};if(zI()){if(!e.createEncodedStreams)return void B.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(h){return void B.error("create video-encoded-streams error",h&&h.message)}let l=[];r.on("sei-to-send",h=>{l.push(h)});let d=new TransformStream({transform(h,p){i.controller||(i.controller=p),e.track&&e.track.id!==i.track.id&&(B.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));let f=l.shift();f&&(h.data=function(_,g){let b=function(j){let z=j.length,_t=[],ue=0;for(;ue<z;)ue+2<z&&j[ue]===0&&j[ue+1]===0&&(j[ue+2]===0||j[ue+2]===1||j[ue+2]===2||j[ue+2]===3)?(_t.push(j[ue],j[ue+1],3,j[ue+2]),ue+=3):(_t.push(j[ue]),ue++);return new Uint8Array(_t)}(g),C=b.length,k=Math.floor(C/255),A=C%255,P=new Uint8Array(6+k+1+C+_.byteLength);P[0]=0,P[1]=0,P[2]=0,P[3]=1,P[4]=6,P[5]=101;let x=0;for(;x<k;)P[6+x]=255,x++;return P[6+x]=A,x++,P.set(b,6+x),P.set(new Uint8Array(_),6+x+C),P.buffer}(h.data,f)),p.enqueue(h)}});s.readable.pipeThrough(d).pipeTo(s.writable)}else{if(!a0())return;{if(typeof RTCRtpScriptTransform>"u")return void B.warning("browser not support RTCRtpScriptTransform");let s=jU(),l=new MessageChannel;await new eE(h=>s.onmessage=p=>{p.data==="registered"&&h(void 0)});let d=new RTCRtpScriptTransform(s,{name:"tx",port:l.port2},[l.port2]);e.transform=d,await new eE(h=>s.onmessage=p=>{p.data==="started"&&h(void 0)}),r.on("sei-to-send",h=>{l.port1.postMessage({sei:h})}),l.port1.onmessage=h=>{var p;h.data.transformed&&e.track&&((p=e.track)===null||p===void 0?void 0:p.id)!==i.track.id&&(B.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=s}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}let s=eU.get(e);if(s){eU.delete(e);try{var l,d;(l=s.controller)===null||l===void 0||l.terminate(),(d=s.worker)===null||d===void 0||d.terminate()}catch(h){B.warning(h&&h.message)}}}eU.set(e,i),e.track.addEventListener("ended",o)}var ID=new Map;(function(){let e=DE();$_.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),$_.getStreamFromExtension=e.name===FE.CHROME&&Number(e.version)>34,$_.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let r=new RTCPeerConnection,i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),$_.supportMinBitrate=e.name===FE.CHROME||e.name===FE.EDGE,$_.supportSetRtpSenderParameters=function(){let r=DE();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!$I()||!(!a0()&&!n3())||r.name===FE.FIREFOX&&Number(r.version)>=64)}(),e.name===FE.SAFARI&&(Number(e.version)>=14?$_.supportDualStream=!0:$_.supportDualStream=!1),$_.webAudioMediaStreamDest=function(){let r=DE();return!(r.name===FE.SAFARI&&Number(r.version)<12)}(),$_.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",$_.supportWebGL=typeof WebGLRenderingContext<"u",$_.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,$I()||($_.webAudioWithAEC=!0),$_.supportShareAudio=function(){let r=DE();return(r.os===W_.WIN_10||r.os===W_.WIN_81||r.os===W_.WIN_7||r.os===W_.LINUX||r.os===W_.MAC_OS||r.os===W_.CHROMIUM_OS)&&r.name===FE.CHROME&&Number(r.version)>=74}(),$_.supportDataChannel=!!(_8(76)||function(r){let i=DE();return!(i.name!==FE.FIREFOX||!i.osVersion)&&Number(i.version)>=r}(68)||Jot(14)),$_.supportPCSetConfiguration=function(){let r=window.RTCPeerConnection;return!f_()&&!!r&&r.prototype.setConfiguration instanceof Function}(),$_.supportWebRTCEncodedTransform=function(){let r=DE();return r.name==="Chrome"&&Number(r.version)>=86||r.name==="Safari"&&Number(r.version)>=15}(),$_.supportWebRTCInsertableStream=function(){let r=DE();return(r.name===FE.CHROME||r.name===FE.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),$_.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,$_.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,dV(()=>{$_.supportDualStreamEncoding=function(){let r=DE();return!!_r("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&_r("CHROME_DUAL_STREAM_USE_ENCODING"))}(),B.info("browser compatibility",JSON.stringify($_),JSON.stringify(e))})})();var j1=class e extends s_{constructor(r,i){super(),$(this,"signal",void 0),$(this,"token",void 0),$(this,"tokenTimeout",void 0),$(this,"tokenInterval",void 0),$(this,"_sequence",0),$(this,"userMap",new Map),$(this,"encoder",new TextEncoder),this.signal=r,this.token=i;let o=()=>{this.signal.connectionState===QE.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*_r("P2P_TOKEN_INTERVAL"))};o()}async send(r,i,o,s,l){var d,h,p;if(this.userMap.size===0)return;let f=Array.from(eI(d=this.userMap).call(d))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),s=(h=s)!==null&&h!==void 0?h:ZE(6,""),l=(p=l)!==null&&p!==void 0?p:this._sequence++;let _={_id:s,_type:r,_seq:l,_message:i,token:"".concat(this.token,"_").concat(f)};_r("SHOW_P2P_LOG")&&B.debug("send message",_,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(_)).forEach(b=>{this.signal.request(mE.DATA_STREAM,{payload:YI(this.encoder.encode(b))})});let g=new eE((b,C)=>{let k=window.setTimeout(()=>{this.off("res-@".concat(s,"_ack"),A),this.off("res-@".concat(s),x),this.off(JN.ABORT,P),B.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(s)),this.userMap.size===0?C(new _u(Vt.INVALID_REMOTE_USER)):C(new _u(Vt.TIMEOUT))},_r("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),A=()=>{k&&window.clearTimeout(k),this.off(JN.ABORT,P),o&&b()},P=()=>{k&&window.clearTimeout(k),this.off("res-@".concat(s,"_ack"),A),this.off("res-@".concat(s),x),C(new _u(Vt.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(s)))};this.once(JN.ABORT,P),this.once("res-@".concat(s,"_ack"),A);let x=(z,_t)=>{j=!0,k&&window.clearTimeout(k),this.off("res-@".concat(s,"_ack"),A),this.off(JN.ABORT,P),z==="success"?b(_t):C(new _u(Vt.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(s)))},j=!1;o||(this.once("res-@".concat(s),x),_y(_r("SIGNAL_REQUEST_TIMEOUT")).then(()=>{j||B.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(s,", ").concat(_))}))});try{return await g}catch(b){if(b.code===Vt.TIMEOUT)return await this.send(r,i,o,s,l);throw b}}onMessage(r){var i;let{_uid:o}=r,s,l=this.userMap.get(o);if(l)s=l.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==v_.CHECK)return;let{token:f}=r;s=new Map,l={uid:o,isStart:!0,token:f,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,l),this.signal.emit(wE.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var d;let{id:f,total:_}=r,g=(d=s.get(f))!==null&&d!==void 0?d:[];if(g.push(r),s.has(f)||s.set(f,g),g.length!==_)return;{let b=HL(g).call(g,(C,k)=>C.index-k.index).map(C=>C.payload).join("");s.delete(f),(r=JSON.parse(b))._uid=o}}let{_type:h,token:p}=r;if(nE(i=[v_.ACK,v_.CHECK]).call(i,h))return h===v_.CHECK&&this.handleCheckToken(l,p),void this.receiveMessage(r);p==="".concat(l.token,"_").concat(this.token)?this.handleReceivedMessage(r):B.debug('Receive unexpected message", '.concat(p,", cur_token: ").concat(l.token,"_").concat(this.token),r)}check(){let r={_id:ZE(6,""),token:this.token,_type:v_.CHECK};_r("SHOW_P2P_LOG")&&B.debug("send message",r),this.signal.request(mE.DATA_STREAM,{payload:YI(this.encoder.encode(JSON.stringify(r)))})}ack(r){let i={_id:r,_type:v_.ACK,token:this.token};_r("SHOW_P2P_LOG")&&B.debug("send message",i),this.signal.request(mE.DATA_STREAM,{payload:YI(this.encoder.encode(JSON.stringify(i)))})}response(r,i,o){this.send(v_.RESPONSE,JSON.stringify({success:!o,message:i}),!0,r)}handleReceivedMessage(r){let i=()=>{this.userMap.forEach(f=>{let{receivedMessagesMap:_,nextExpectedSequenceNumber:g}=f;for(;_.has(g);){let b=_.get(g);_.delete(g),this.receiveMessage(b),f.nextExpectedSequenceNumber++}})};if(!r)return void i();let{_uid:o,_seq:s}=r,l=this.userMap.get(o),{receivedMessagesMap:d,isStart:h,nextExpectedSequenceNumber:p}=l;if(s<p)return this.ack(r._id),void B.debug("[external-signal] receive old message, seq: ".concat(s,", ").concat(r._message));d.set(s,r),h&&s===p&&(this.receiveMessage(r),d.delete(p),l.nextExpectedSequenceNumber++,i())}receiveMessage(r){let{_id:i,_type:o,_message:s,_uid:l}=r;if(_r("SHOW_P2P_LOG")&&B.debug("receive message",r),i){let d;switch(r._type!==v_.ACK&&(s&&(d=JSON.parse(s)),this.ack(r._id)),r._type){case v_.CANDIDATE:case v_.CONTROL:this.signal.emit(o,d,l);break;case v_.PUBLISH:case v_.UNPUBLISH:case v_.RESTART_ICE:case v_.CALL:d.uid=l,c0(this.signal,o,d).then(h=>{this.response(r._id,h)}).catch(()=>{this.response(r._id,void 0,!0)});break;case v_.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case v_.RESPONSE:{let{success:h,message:p}=d;this.emit("res-@".concat(i),h?"success":"failed",p);break}}}}splitMessage(r){if(r.length<e.MAX_MESSAGE_SIZE)return[r];let i=[],{remoteToken:o}=JSON.parse(r),s=ZE(6,""),l=0,d=800,h=Math.ceil(r.length/d);for(;r.length>0;){l++;let p={id:s,index:l,total:h,payload:r.slice(0,d),token:"".concat(this.token,"_").concat(o)};JSON.stringify(p).length>e.MAX_MESSAGE_SIZE?d-=50:(i.push(p),r=r.slice(d))}return i.map(p=>JSON.stringify(p))}handleCheckToken(r,i){return r.token!==i?(B.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{B.debug("token timeout, ".concat(i)),this.reset(r.uid)},_r("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let r=await c0(this.signal,v_.CALL,void 0),i=await this.send(v_.CALL,r);this.signal.emit(EE.P2P_CONNECTION,i,!0)}async reset(r,i){let o=this.userMap.get(r);o&&(this.emit(JN.ABORT),this.signal.emit(wE.ON_USER_OFFLINE,{uid:o.uid,reason:WTt.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(B.debug("change local token from ".concat(i," to ").concat(i)),this.token=ZE(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(JN.ABORT)}};$(j1,"MAX_SIZE",1),$(j1,"MAX_MESSAGE_SIZE",1024);var b3=class extends s_{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===QE.CONNECTED?this.emit(EE.WS_CONNECTED):r===QE.RECONNECTING?this.emit(EE.WS_RECONNECTING,this._websocketReconnectReason):r===QE.CLOSED&&this.emit(EE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",QE.CLOSED),$(this,"reconnectToken",void 0),$(this,"p2pToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new i3(5)),$(this,"pingpongTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"_external_signal",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(EE.ON_BINARY_DATA,o.data);let s=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){let l="res-@".concat(s._id);this.emit(l,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){switch(s._type){case wE.ON_DATA_STREAM:return void this.handleDataStream(s._message);case wE.MUTE_AUDIO:case wE.MUTE_VIDEO:case wE.ON_P2P_LOST:case wE.ON_USER_ONLINE:return;case wE.ON_USER_OFFLINE:let{uid:l}=s._message;return B.debug("[".concat(this.clientId,"] user-offline uid: ").concat(l)),void this._external_signal.reset(l)}if(this.emit(s._type,s._message),s._type===wE.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===wE.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(GE.UID_BANNED);break;case 15:this.close(GE.IP_BANNED);break;case 16:this.close(GE.CHANNEL_BANNED)}if(s._type===wE.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case hE.ERR_LICENSE_MISSING:this.close(GE.LICENSE_MISSING);break;case hE.ERR_LICENSE_EXPIRED:this.close(GE.LICENSE_EXPIRED);break;case hE.ERR_LICENSE_MINUTES_EXCEEDED:this.close(GE.LICENSE_MINUTES_EXCEEDED);break;case hE.ERR_LICENSE_PERIOD_INVALID:this.close(GE.LICENSE_PERIOD_INVALID);break;case hE.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(GE.LICENSE_MULTIPLE_SDK_SERVICE);break;case hE.ERR_LICENSE_ILLEGAL:this.close(GE.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new SL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,_r("JOIN_GATEWAY_USE_DUAL_DOMAIN"),_r("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===QE.CONNECTED&&this.reconnect("retry",s0.OFFLINE)}),this.p2pToken=ZE(6,""),this._external_signal=new j1(this,this.p2pToken)}async request(r,i,o,s){let l=ZE(6,""),d={_id:l,_type:r,_message:i},h=this.websocket.connectionID,p=()=>new eE((k,A)=>{if(this.connectionState===QE.CONNECTED)return k();let P=()=>{this.off(EE.WS_CLOSED,x),k()},x=()=>{this.off(EE.WS_CONNECTED,P),A(new _u(Vt.WS_ABORT))};this.once(EE.WS_CONNECTED,P),this.once(EE.WS_CLOSED,x)});if(this.connectionState!==QE.CONNECTING&&this.connectionState!==QE.RECONNECTING||r===mE.JOIN||r===mE.REJOIN||await p(),this.websocket.sendMessage(d,!0),s)return;let f=new eE((k,A)=>{let P=!1,x=(z,_t)=>{P=!0,k({isSuccess:z==="success",message:_t||{}}),this.off(EE.WS_CLOSED,j),this.off(EE.WS_RECONNECTING,j),this.emit(EE.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(l),x);let j=()=>{A(new _u(Vt.WS_ABORT,"type: ".concat(r))),this.off(EE.WS_CLOSED,j),this.off(EE.WS_RECONNECTING,j),this.off("res-@".concat(l),x)};this.once(EE.WS_CLOSED,j),this.once(EE.WS_RECONNECTING,j),_y(_r("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==h||P||(B.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(EE.REQUEST_TIMEOUT,r,i))})}),_=null;try{_=await f}catch(k){if(this.connectionState===QE.CLOSED||r===mE.LEAVE)throw new _u(Vt.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?k.throw():r===mE.JOIN||r===mE.REJOIN?null:(await p(),await this.request(r,i))}if(_.isSuccess)return _.message;let g=Number(_.message.error_code||_.message.code),b=yL(g),C=new _u(Vt.UNEXPECTED_RESPONSE,"".concat(b.desc,": ").concat(_.message.error_str),{code:g,data:_.message,desc:b.desc});return b.action==="success"?_.message:(B.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(g,", message: ").concat(b.desc,", action: ").concat(b.action)),g===hE.ERR_TOO_MANY_BROADCASTERS?((r===mE.JOIN||r===mE.REJOIN)&&(this.initError=C,this.close()),C.throw()):b.action==="failed"?C.throw():b.action==="quit"?(this.initError=C,this.close(),C.throw()):(g===hE.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,B.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",s0.MULTI_IP)):this.reconnect(b.action,s0.SERVER_ERROR),r===mE.JOIN||r===mE.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new eE(o=>{let s=l=>{(!i||i(l))&&(this.off(r,s),o(l))};this.on(r,s)})}uploadWRTCStats(r){if(!this.store.sessionId)return void B.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(vL.WRTC_STATS,i)}upload(r,i){let o={_type:r,_message:i};try{this.websocket.sendMessage(o)}catch{let l=_r("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>l&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==QE.CONNECTED)return;let d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},_r("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){let o={_type:r,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(r,i,o){return await this._external_signal.send(r,i,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new eE((i,o)=>{this.once(EE.WS_CONNECTED,()=>i(this.joinResponse)),this.once(EE.WS_CLOSED,()=>o(this.initError||new _u(Vt.WS_ABORT))),this.connectionState=QE.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||GE.LEAVE,this.connectionState=QE.CLOSED,B.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=ZE(6,""),this._external_signal.clear(),this._external_signal=new j1(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(EE.ABORT_P2P_EXECUTION);let r=await c0(this,EE.REQUEST_JOIN_INFO),i=await this.request(mE.JOIN,r);if(!i)return this.emit(EE.REPORT_JOIN_GATEWAY,Vt.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(EE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=QE.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}handleDataStream(r){try{var i;let o=GO(r.payload),s=new TextDecoder().decode(o),l=JSON.parse(s);"total"in l&&"id"in l||nE(i=Object.values(v_)).call(i,l._type)?(l._uid=r.uid,this._external_signal.onMessage(l)):this.emit(wE.ON_DATA_STREAM,r)}catch{this.emit(wE.ON_DATA_STREAM,r)}}handleNotification(r){B.debug("[".concat(this.clientId,"] receive notification: "),r);let i=yL(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(GE.UID_BANNED),void this.close()):void this.reconnect(i.action,s0.SERVER_ERROR);B.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let r=_r("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(B.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>_r("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",s0.TIMEOUT):this.request(mE.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let o=Date.now()-i;this.rttRolling.add(o),_r("REPORT_STATS")&&this.send(mE.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(_E.RECONNECT_WAITTING_FINISH,r=>{this.emit(EE.WS_RECONNECT_WAITTING_FINISH,r)}),this.websocket.on(_E.RECONNECT_CREATE_CONNECTION,r=>{this.emit(EE.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(_E.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(_E.CLOSED,()=>{this.connectionState=QE.CLOSED}),this.websocket.on(_E.FAILED,()=>{this._disconnectedReason=GE.NETWORK_ERROR,this.connectionState=QE.CLOSED}),this.websocket.on(_E.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===QE.CONNECTED?this.connectionState=QE.RECONNECTING:this.connectionState=QE.CONNECTING}),this.websocket.on(_E.WILL_RECONNECT,(r,i,o)=>{r!=="retry"?(B.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):B.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(_E.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(EE.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof _u&&r.code===Vt.UNEXPECTED_RESPONSE&&r.data.code===hE.ERR_NO_AUTHORIZED)return B.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",s0.SERVER_ERROR);B.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",s0.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(_E.REQUEST_NEW_URLS,(r,i)=>{c0(this,EE.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(_E.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(wE.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}},Lst={exports:{}};Lst.exports=(()=>{var e={8:(o,s,l)=>{l.r(s),l.d(s,{Parser:()=>kc,Printer:()=>_o,parse:()=>Gi,print:()=>_d});let d=`
`,h="".concat("\r").concat(d),p=" ",f;function _(Di){return Di>="0"&&Di<="9"}function g(Di){return Di>="!"&&Di<="~"}function b(Di){return g(Di)||Di>="\x80"&&Di<="\xFF"}function C(Di){return Di==="!"||Di>="#"&&Di<="'"||Di>="*"&&Di<="+"||Di>="-"&&Di<="."||Di>="0"&&Di<="9"||Di>="A"&&Di<="Z"||Di>="^"&&Di<="~"}function k(Di){return Di>="1"&&Di<="9"}function A(Di){return Di>="A"&&Di<="Z"||Di>="a"&&Di<="z"}function P(Di){return Di==="d"||Di==="h"||Di==="m"||Di==="s"}function x(Di){return Di>""&&Di<"	"||Di>"\v"&&Di<"\f"||Di>""&&Di<"\xFF"}function j(Di){return A(Di)||_(Di)||Di==="+"||Di==="/"}function z(Di){return _(Di)||A(Di)||Di==="+"||Di==="/"||Di==="-"||Di==="_"}function _t(Di){return A(Di)||_(Di)||Di==="+"||Di==="/"}function ue(Di,H){var Wt=Object.keys(Di);if(Object.getOwnPropertySymbols){var _e=Object.getOwnPropertySymbols(Di);H&&(_e=_e.filter(function(_f){return Object.getOwnPropertyDescriptor(Di,_f).enumerable})),Wt.push.apply(Wt,_e)}return Wt}function _n(Di){for(var H=1;H<arguments.length;H++){var Wt=arguments[H]!=null?arguments[H]:{};H%2?ue(Object(Wt),!0).forEach(function(_e){Ei(Di,_e,Wt[_e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Di,Object.getOwnPropertyDescriptors(Wt)):ue(Object(Wt)).forEach(function(_e){Object.defineProperty(Di,_e,Object.getOwnPropertyDescriptor(Wt,_e))})}return Di}function Ei(Di,H,Wt){return H in Di?Object.defineProperty(Di,H,{value:Wt,enumerable:!0,configurable:!0,writable:!0}):Di[H]=Wt,Di}(function(Di){Di.VERSION="v",Di.ORIGIN="o",Di.SESSION_NAME="s",Di.INFORMATION="i",Di.URI="u",Di.EMAIL="e",Di.PHONE="p",Di.CONNECTION="c",Di.BANDWIDTH="b",Di.TIME="t",Di.REPEAT="r",Di.ZONE_ADJUSTMENTS="z",Di.KEY="k",Di.ATTRIBUTE="a",Di.MEDIA="m"})(f||(f={}));class _s{consumeText(H,Wt){let _e=Wt;for(;_e<H.length;){let _f=H[_e];if(_f==="\0"||_f==="\r"||_f===d)break;_e+=1}if(_e-Wt==0)throw new Error("Invalid text, at ".concat(H));return _e}consumeUnicastAddress(H,Wt,_e){return this.consumeTill(H,Wt,p)}consumeOneOrMore(H,Wt,_e){let _f=Wt;for(;_e(H[_f]);)_f++;if(_f-Wt==0)throw new Error("Invalid rule at ".concat(Wt,"."));return _f}consumeSpace(H,Wt){if(H[Wt]===p)return Wt+1;throw new Error("Invalid space at ".concat(Wt,"."))}consumeIP4Address(H,Wt){let _e=Wt;for(let _f=0;_f<4;_f++)if(_e=this.consumeDecimalUChar(H,_e),_f!==3){if(H[_e]!==".")throw new Error("Invalid IP4 address.");_e++}return _e}consumeDecimalUChar(H,Wt){let _e=Wt;for(let uE=0;uE<3&&_(H[_e]);uE++,_e++);if(_e-Wt==0)throw new Error("Invalid decimal uchar.");let _f=parseInt(H.slice(Wt,_e));if(_f>=0&&_f<=255)return _e;throw new Error("Invalid decimal uchar")}consumeIP6Address(H,Wt){let _e=this.consumeHexpart(H,Wt);return H[_e]===":"&&(_e+=1,_e=this.consumeIP4Address(H,_e)),_e}consumeHexpart(H,Wt){let _e=Wt;if(H[_e]===":"&&H[_e+1]===":"){_e+=2;try{_e=this.consumeHexseq(H,_e)}catch{}return _e}if(_e=this.consumeHexseq(H,_e),H[_e]===":"&&H[_e+1]===":"){_e+=2;try{_e=this.consumeHexseq(H,_e)}catch{}return _e}return _e}consumeHexseq(H,Wt){let _e=Wt;for(;_e=this.consumeHex4(H,_e),H[_e]===":"&&H[_e+1]!==":";)_e+=1;return _e}consumeHex4(H,Wt){let _e=0;for(;_e<4;_e++)if(!((_f=H[Wt+_e])>="0"&&_f<="9"||_f>="a"&&_f<="f"||_f>="A"&&_f<="F")){if(_e===0)throw new Error("Invalid hex 4");break}var _f;return Wt+_e}consumeFQDN(H,Wt){let _e=Wt;for(;_(H[_e])||A(H[_e])||H[_e]==="-"||H[_e]===".";)_e+=1;if(_e-Wt<4)throw new Error("Invalid FQDN");return _e}consumeExtnAddr(H,Wt){return this.consumeOneOrMore(H,Wt,b)}consumeMulticastAddress(H,Wt,_e){switch(_e){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(H,Wt);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(H,Wt);default:try{return this.consumeFQDN(H,Wt)}catch{return this.consumeExtnAddr(H,Wt)}}}consumeIP6MulticastAddress(H,Wt){let _e=this.consumeHexpart(H,Wt);return H[_e]==="/"?this.consumeInteger(H,_e+1):_e}consumeIP4MulticastAddress(H,Wt){let _e=Wt+3,_f=H.slice(Wt,_e),uE=parseInt(_f);if(uE<224||uE>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let IE=0;IE<3;IE++){if(H[_e]!==".")throw new Error("Invalid IP4 multicast address.");_e+=1,_e=this.consumeDecimalUChar(H,_e)}return H[_e]==="/"&&(_e+=1),_e=this.consumeTTL(H,_e),H[_e]==="/"&&(_e=this.consumeInteger(H,_e)),_e}consumeInteger(H,Wt){if(!k(H[Wt]))throw new Error("Invalid integer.");for(Wt+=1;_(H[Wt]);)Wt+=1;return Wt}consumeTTL(H,Wt){if(H[Wt]==="0")return Wt+1;if(!k(H[Wt]))throw new Error("Invalid TTL.");Wt+=1;for(let _e=0;_e<2&&_(H[Wt]);_e++)Wt+=1;return Wt}consumeToken(H,Wt){return this.consumeOneOrMore(H,Wt,C)}consumeTime(H,Wt){let _e=Wt;if(H[_e]==="0")return _e+1;for(k(H[_e])&&(_e+=1);_(H[_e]);)_e++;if(_e-Wt<10)throw new Error("Invalid time");return _e}consumeAddress(H,Wt){return this.consumeTill(H,Wt,p)}consumeTypedTime(H,Wt){let _e=Wt;return _e=this.consumeOneOrMore(H,_e,_),P(H[_e])?_e+1:_e}consumeRepeatInterval(H,Wt){if(!k(H[Wt]))throw new Error("Invalid repeat interval");for(Wt+=1;_(H[Wt]);)Wt+=1;return P(H[Wt])&&(Wt+=1),Wt}consumePort(H,Wt){return this.consumeOneOrMore(H,Wt,_)}consume(H,Wt,_e){for(let _f=0;_f<_e.length;_f++){if(Wt+_f>=H.length)throw new Error("consume exceeding value length");if(H[Wt+_f]!==_e[_f])throw new Error("consume ".concat(_e," failed at ").concat(_f))}return Wt+_e.length}consumeTill(H,Wt,_e){let _f=Wt;for(;_f<H.length&&(typeof _e!="string"||H[_f]!==_e)&&(typeof _e!="function"||!_e(H[_f]));)_f++;return _f}}class kc extends _s{constructor(){super(),Ei(this,"records",[]),Ei(this,"currentLine",0)}parse(H){let Wt=this.probeEOL(H);this.records=H.split(Wt).filter(dE=>!!C0(dE).call(dE)).map(this.parseLine),this.currentLine=0;let _e=this.parseVersion(),_f=this.parseOrigin(),uE=this.parseSessionName(),IE=this.parseInformation(),O_=this.parseUri(),A0=this.parseEmail(),kT=this.parsePhone(),aO=this.parseConnection(),Mb=this.parseBandWidth(),rS=this.parseTimeFields(),K_=this.parseKey(),UE=this.parseSessionAttribute(),bE=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:_e,origin:_f,sessionName:uE,information:IE,uri:O_,emails:A0,phones:kT,connection:aO,bandwidths:Mb,timeFields:rS,key:K_,attributes:UE,mediaDescriptions:bE}}getCurrentRecord(){let H=this.records[this.currentLine];if(!H)throw new Error("Record doesn't exit.");return H}probeEOL(H){for(let Wt=0;Wt<H.length;Wt++)if(H[Wt]===d)return H[Wt-1]==="\r"?h:d;throw new Error("Invalid newline character.")}parseLine(H,Wt){if(H.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let _e=H[0];if(H[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:_e,value:H.slice(2),line:Wt,cur:0}}parseSessionAttribute(){let H=new _h;for(;this.currentLine<this.records.length;){let Wt=this.getCurrentRecord();if(Wt.type!==f.ATTRIBUTE)break;let _e={attField:this.extractOneOrMore(Wt,_f=>C(_f)&&_f!==":"),_cur:0};Wt.value[Wt.cur]===":"&&(Wt.cur+=1,_e.attValue=this.extractOneOrMore(Wt,x)),H.parse(_e),this.currentLine++}return H.digest()}parseMediaAttributes(H){let Wt=new _p(H);for(;this.currentLine<this.records.length;){let _e=this.getCurrentRecord();if(_e.type!==f.ATTRIBUTE)break;let _f={attField:this.extractOneOrMore(_e,uE=>C(uE)&&uE!==":"),_cur:0};_e.value[_e.cur]===":"&&(_e.cur+=1,_f.attValue=this.extractOneOrMore(_e,x)),Wt.parse(_f),this.currentLine++}return Wt.digest()}parseKey(){let H=this.getCurrentRecord();if(H.type===f.KEY){if(H.value==="prompt"||H.value==="clear:"||H.value==="base64:"||H.value==="uri:")return H.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let H=this.getCurrentRecord();if(H.type===f.ZONE_ADJUSTMENTS){let Wt=[];for(;;)try{let _e=this.extract(H,this.consumeTime);this.consumeSpaceForRecord(H);let _f=!1;H.value[H.cur]==="-"&&(_f=!0,H.cur+=1);let uE=this.extract(H,this.consumeTypedTime);Wt.push({time:_e,typedTime:uE,back:_f})}catch{break}if(Wt.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,Wt}return[]}parseRepeat(){let H=[];for(;;){let Wt=this.getCurrentRecord();if(Wt.type!==f.REPEAT)break;{let _e=this.extract(Wt,this.consumeRepeatInterval),_f=this.parseTypedTime(Wt);H.push({repeatInterval:_e,typedTimes:_f}),this.currentLine++}}return H}parseTypedTime(H){let Wt=[];for(;;)try{this.consumeSpaceForRecord(H),Wt.push(this.extract(H,this.consumeTypedTime))}catch{break}if(Wt.length===0)throw new Error("Invalid typed time.");return Wt}parseTime(){let H=this.getCurrentRecord(),Wt=this.extract(H,this.consumeTime);this.consumeSpaceForRecord(H);let _e=this.extract(H,this.consumeTime);return this.currentLine++,{startTime:Wt,stopTime:_e}}parseBandWidth(){let H=[];for(;this.currentLine<this.records.length;){let Wt=this.getCurrentRecord();if(Wt.type!==f.BANDWIDTH)break;{let _e=this.extractOneOrMore(Wt,C);if(Wt.value[Wt.cur]!==":")throw new Error("Invalid bandwidth field.");Wt.cur++;let _f=this.extractOneOrMore(Wt,_);H.push({bwtype:_e,bandwidth:_f}),this.currentLine++}}return H}parseVersion(){let H=this.getCurrentRecord();if(H.type!==f.VERSION)throw new Error("first sdp record must be version");let Wt=H.value.slice(0,this.consumeOneOrMore(H.value,0,_));if(Wt.length!==H.value.length)throw new Error('invalid proto version, "v='.concat(H.value,'"'));return this.currentLine++,Wt}parseOrigin(){let H=this.getCurrentRecord();if(H.type!==f.ORIGIN)throw new Error("second line of sdp must be origin");let Wt=this.extractOneOrMore(H,b);this.consumeSpaceForRecord(H);let _e=this.extractOneOrMore(H,_);this.consumeSpaceForRecord(H);let _f=this.extractOneOrMore(H,_);this.consumeSpaceForRecord(H);let uE=this.extractOneOrMore(H,C);this.consumeSpaceForRecord(H);let IE=this.extractOneOrMore(H,C);this.consumeSpaceForRecord(H);let O_=this.extract(H,this.consumeUnicastAddress);return this.currentLine++,{username:Wt,sessId:_e,sessVersion:_f,nettype:uE,addrtype:IE,unicastAddress:O_}}parseSessionName(){let H=this.getCurrentRecord();if(H.type===f.SESSION_NAME){let Wt=this.extract(H,this.consumeText);return this.currentLine++,Wt}}parseInformation(){let H=this.getCurrentRecord();if(H.type!==f.INFORMATION)return;let Wt=this.extract(H,this.consumeText);return this.currentLine++,Wt}parseUri(){let H=this.getCurrentRecord();if(H.type===f.URI)return this.currentLine++,H.value}parseEmail(){let H=[];for(;;){let Wt=this.getCurrentRecord();if(Wt.type!==f.EMAIL)break;H.push(Wt.value),this.currentLine++}return H}parsePhone(){let H=[];for(;;){let Wt=this.getCurrentRecord();if(Wt.type!==f.PHONE)break;H.push(Wt.value),this.currentLine++}return H}parseConnection(){let H=this.getCurrentRecord();if(H.type===f.CONNECTION){let Wt=this.extractOneOrMore(H,C);this.consumeSpaceForRecord(H);let _e=this.extractOneOrMore(H,C);this.consumeSpaceForRecord(H);let _f=this.extract(H,this.consumeAddress);return this.currentLine++,{nettype:Wt,addrtype:_e,address:_f}}}parseMedia(){let H=this.getCurrentRecord(),Wt=this.extract(H,this.consumeToken);this.consumeSpaceForRecord(H);let _e=this.extract(H,this.consumePort);H.value[H.cur]==="/"&&(H.cur+=1,_e+=this.extract(H,this.consumeInteger)),this.consumeSpaceForRecord(H);let _f=[];for(_f.push(this.extract(H,this.consumeToken));H.value[H.cur]==="/";)H.cur+=1,_f.push(this.extract(H,this.consumeToken));if(_f.length===0)throw new Error("Invalid proto");let uE=this.parseFmt(H);return this.currentLine++,{mediaType:Wt,port:_e,protos:_f,fmts:uE}}parseTimeFields(){let H=[];for(;this.getCurrentRecord().type===f.TIME;){let Wt=this.parseTime(),_e=this.parseRepeat(),_f=this.parseZone();H.push({time:Wt,repeats:_e,zones:_f})}return H}parseMediaDescription(){let H=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.MEDIA;){let Wt=this.parseMedia(),_e=this.parseInformation(),_f=this.parseConnections(),uE=this.parseBandWidth(),IE=this.parseKey(),O_=this.parseMediaAttributes(Wt);H.push({media:Wt,information:_e,connections:_f,bandwidths:uE,key:IE,attributes:O_})}return H}parseConnections(){let H=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===f.CONNECTION;)H.push(this.parseConnection());return H}parseFmt(H){let Wt=[];for(;;)try{this.consumeSpaceForRecord(H),Wt.push(this.extract(H,this.consumeToken))}catch{break}if(Wt.length===0)throw new Error("Invalid fmts");return Wt}extract(H,Wt){for(var _e=arguments.length,_f=new Array(_e>2?_e-2:0),uE=2;uE<_e;uE++)_f[uE-2]=arguments[uE];let IE=Wt.call(this,H.value,H.cur,..._f),O_=H.value.slice(H.cur,IE);return H.cur=IE,O_}extractOneOrMore(H,Wt){let _e=this.consumeOneOrMore(H.value,H.cur,Wt),_f=H.value.slice(H.cur,_e);return H.cur=_e,_f}consumeSpaceForRecord(H){if(H.value[H.cur]!==p)throw new Error("Invalid space at ".concat(H.cur,"."));H.cur+=1}}class _i extends _s{constructor(){super(...arguments),Ei(this,"attributes",void 0),Ei(this,"digested",!1)}extractOneOrMore(H,Wt,_e){let _f=this.consumeOneOrMore(H.attValue,H._cur,Wt),uE=H.attValue.slice(H._cur,_f),[IE,O_]=_e||[];if(typeof IE=="number"&&uE.length<IE)throw new Error("error in length, should be more or equal than ".concat(IE," characters."));if(typeof O_=="number"&&uE.length>O_)throw new Error("error in length, should be less or equal than ".concat(O_," characters."));return H._cur=_f,uE}consumeAttributeSpace(H){if(H.attValue[H._cur]!==p)throw new Error("Invalid space at ".concat(H._cur,"."));H._cur+=1}extract(H,Wt){if(!H.attValue)throw new Error("Nothing to extract from attValue.");for(var _e=arguments.length,_f=new Array(_e>2?_e-2:0),uE=2;uE<_e;uE++)_f[uE-2]=arguments[uE];let IE=Wt.call(this,H.attValue,H._cur,..._f),O_=H.attValue.slice(H._cur,IE);return H._cur=IE,O_}atEnd(H){if(!H.attValue)throw new Error;return H._cur>=H.attValue.length}peekChar(H){if(!H.attValue)throw new Error;return H.attValue[H._cur]}peek(H,Wt){if(!H.attValue)throw new Error;for(let _e=0;_e<Wt.length;_e++)if(Wt[_e]!==H.attValue[H._cur+_e])return!1;return!0}parseIceUfrag(H){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(H,j,[4,256])}parseIcePwd(H){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(H,j,[22,256])}parseIceOptions(H){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let Wt=[];for(;!this.atEnd(H);){Wt.push(this.extractOneOrMore(H,j));try{this.consumeAttributeSpace(H)}catch(_e){if(this.atEnd(H))break;throw _e}}this.attributes.iceOptions=Wt}parseFingerprint(H){let Wt=this.extract(H,this.consumeToken);this.consumeAttributeSpace(H);let _e=this.extract(H,this.consumeTill);this.attributes.fingerprints.push({hashFunction:Wt,fingerprint:_e})}parseExtmap(H){let Wt=this.extractOneOrMore(H,_),_e;this.peekChar(H)==="/"&&(this.extract(H,this.consume,"/"),_e=this.extract(H,this.consumeToken)),this.consumeAttributeSpace(H);let _f=this.extract(H,this.consumeTill,p),uE=_n(_n({entry:parseInt(Wt,10)},_e&&{direction:_e}),{},{extensionName:_f});this.peekChar(H)===p&&(this.consumeAttributeSpace(H),uE.extensionAttributes=this.extract(H,this.consumeTill)),this.attributes.extmaps.push(uE)}parseSetup(H){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let Wt=this.extract(H,this.consumeTill);if(Wt!=="active"&&Wt!=="passive"&&Wt!=="actpass"&&Wt!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=Wt}}class _h extends _i{constructor(){super(...arguments),Ei(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(H){if(this.digested)throw new Error("already digested");try{switch(H.attField){case"group":this.parseGroup(H);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(H);break;case"ice-pwd":this.parseIcePwd(H);break;case"ice-options":this.parseIceOptions(H);break;case"fingerprint":this.parseFingerprint(H);break;case"setup":this.parseSetup(H);break;case"tls-id":this.parseTlsId(H);break;case"identity":this.parseIdentity(H);break;case"extmap":this.parseExtmap(H);break;case"msid-semantic":this.parseMsidSemantic(H);break;default:H.ignored=!0,this.attributes.unrecognized.push(H)}}catch(Wt){throw console.error("parsing session attribute ".concat(H.attField,' error, "a=').concat(H.attField,":").concat(H.attValue,'"')),Wt}if(!H.ignored&&H.attValue&&!this.atEnd(H))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(H){let Wt=this.extract(H,this.consumeToken),_e=[];for(;!this.atEnd(H)&&this.peekChar(H)===p;)this.consumeAttributeSpace(H),_e.push(this.extract(H,this.consumeToken));this.attributes.groups.push({semantic:Wt,identificationTag:_e})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(H){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(H,z)}parseIdentity(H){let Wt=this.extractOneOrMore(H,_t),_e=[];for(;!this.atEnd(H)&&this.peekChar(H)===p;){this.consumeAttributeSpace(H);let _f=this.extract(H,this.consumeToken);this.extract(H,this.consume,"=");let uE=this.extractOneOrMore(H,IE=>IE!==p&&x(IE));_e.push({name:_f,value:uE})}this.attributes.identities.push({assertionValue:Wt,extensions:_e})}parseMsidSemantic(H){this.peekChar(H)===p&&this.consumeAttributeSpace(H);let Wt={semantic:this.extract(H,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(H)}catch{break}if(this.peekChar(H)==="*"){this.extract(H,this.consume,"*"),Wt.applyForAll=!0;break}{let _e=this.extract(H,this.consumeTill,p);Wt.identifierList.push(_e)}}this.attributes.msidSemantic=Wt}}class _p extends _i{constructor(H){super(),Ei(this,"attributes",void 0),H.protos.indexOf("RTP")!==-1||H.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(H){if(this.digested)throw new Error("already digested");try{switch(H.attField){case"extmap":this.parseExtmap(H);break;case"setup":this.parseSetup(H);break;case"ice-ufrag":this.parseIceUfrag(H);break;case"ice-pwd":this.parseIcePwd(H);break;case"ice-options":this.parseIceOptions(H);break;case"candidate":this.parseCandidate(H);break;case"remote-candidate":this.parseRemoteCandidate(H);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(H);break;case"rtpmap":this.parseRtpmap(H);break;case"ptime":this.parsePtime(H);break;case"maxptime":this.parseMaxPtime(H);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(H);break;case"ssrc":this.parseSSRC(H);break;case"fmtp":this.parseFmtp(H);break;case"rtcp-fb":this.parseRtcpFb(H);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(H);break;case"mid":this.parseMid(H);break;case"msid":this.parseMsid(H);break;case"imageattr":this.parseImageAttr(H);break;case"rid":this.parseRid(H);break;case"simulcast":this.parseSimulcast(H);break;case"sctp-port":this.parseSctpPort(H);break;case"max-message-size":this.parseMaxMessageSize(H);break;case"ssrc-group":this.parseSSRCGroup(H);break;default:H.ignored=!0,this.attributes.unrecognized.push(H)}}catch(Wt){throw console.error("parsing media attribute ".concat(H.attField,' error, "a=').concat(H.attField,":").concat(H.attValue,'"')),Wt}if(!H.ignored&&H.attValue&&!this.atEnd(H))throw new Error("attribute parsing error")}parseCandidate(H){let Wt=this.extractOneOrMore(H,j,[1,32]);this.consumeAttributeSpace(H);let _e=this.extractOneOrMore(H,_,[1,5]);this.consumeAttributeSpace(H);let _f=this.extract(H,this.consumeToken);this.consumeAttributeSpace(H);let uE=this.extractOneOrMore(H,_,[1,10]);this.consumeAttributeSpace(H);let IE=this.extract(H,this.consumeAddress);this.consumeAttributeSpace(H);let O_=this.extract(H,this.consumePort);this.consumeAttributeSpace(H),this.extract(H,this.consume,"typ"),this.consumeAttributeSpace(H);let A0={foundation:Wt,componentId:_e,transport:_f,priority:uE,connectionAddress:IE,port:O_,type:this.extract(H,this.consumeToken),extension:{}};for(this.peek(H," raddr")&&(this.extract(H,this.consume," raddr"),this.consumeAttributeSpace(H),A0.relAddr=this.extract(H,this.consumeAddress)),this.peek(H," rport")&&(this.extract(H,this.consume," rport"),this.consumeAttributeSpace(H),A0.relPort=this.extract(H,this.consumePort));this.peekChar(H)===p;){this.consumeAttributeSpace(H);let kT=this.extract(H,this.consumeToken);this.consumeAttributeSpace(H),A0.extension[kT]=this.extractOneOrMore(H,g)}this.attributes.candidates.push(A0)}parseRemoteCandidate(H){let Wt=[];for(;;){let _e=this.extractOneOrMore(H,_,[1,5]);this.consumeAttributeSpace(H);let _f=this.extract(H,this.consumeAddress);this.consumeAttributeSpace(H);let uE=this.extract(H,this.consumePort);Wt.push({componentId:_e,connectionAddress:_f,port:uE});try{this.consumeAttributeSpace(H)}catch{break}}this.attributes.remoteCandidatesList.push(Wt)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(H){let Wt=this.extract(H,this.consumeToken);this.consumeAttributeSpace(H);let _e=this.extract(H,this.consumeTill,"/");this.extract(H,this.consume,"/");let _f={encodingName:_e,clockRate:this.extractOneOrMore(H,_)};this.atEnd(H)||this.peekChar(H)!=="/"||(this.extract(H,this.consume,"/"),_f.encodingParameters=parseInt(this.extract(H,this.consumeTill),10));let uE=this.attributes.payloads.find(IE=>IE.payloadType===parseInt(Wt,10));uE?uE.rtpMap=_f:this.attributes.payloads.push({payloadType:parseInt(Wt,10),rtpMap:_f,rtcpFeedbacks:[]})}parsePtime(H){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(H,this.consumeTill)}parseMaxPtime(H){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(H,this.consumeTill)}parseDirection(H){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=H.attField}parseSSRC(H){let Wt=this.extractOneOrMore(H,_);this.consumeAttributeSpace(H);let _e=this.extract(H,this.consumeTill,":"),_f;this.peekChar(H)===":"&&(this.extract(H,this.consume,":"),_f=this.extract(H,this.consumeTill));let uE=this.attributes.ssrcs.find(IE=>IE.ssrcId===parseInt(Wt,10));uE?uE.attributes[_e]=_f:this.attributes.ssrcs.push({ssrcId:parseInt(Wt,10),attributes:{[_e]:_f}})}parseFmtp(H){let Wt=this.extract(H,this.consumeTill,p);this.consumeAttributeSpace(H);let _e=this.extract(H,this.consumeTill),_f={};_e.split(";").forEach(IE=>{let[O_,A0]=IE.split("=");O_=C0(O_).call(O_);let kT=typeof A0=="string"?C0(A0).call(A0):null;typeof O_=="string"&&O_.length>0&&(_f[O_]=kT)});let uE=this.attributes.payloads.find(IE=>IE.payloadType===parseInt(Wt,10));uE?uE.fmtp={parameters:_f}:this.attributes.payloads.push({payloadType:parseInt(Wt,10),rtcpFeedbacks:[],fmtp:{parameters:_f}})}parseFmtParameters(H){let Wt={},_e=this.extract(H,this.consumeTill,"=");H._cur++;let _f=this.extract(H,this.consumeTill,";");for(Wt[_e]=_f;H.attValue[H._cur]===";";){let uE=this.extract(H,this.consumeTill,"=");H._cur++;let IE=this.extract(H,this.consumeTill,";");Wt[uE]=IE}return Wt}parseRtcpFb(H){let Wt="";Wt=this.peekChar(H)==="*"?this.extract(H,this.consume,"*"):this.extract(H,this.consumeTill,p),this.consumeAttributeSpace(H);let _e=this.extract(H,this.consumeTill,p),_f;if(_e==="trr-int")_f={type:_e,interval:this.extract(H,this.consumeTill)};else{let uE={type:_e};this.peekChar(H)===p&&(this.consumeAttributeSpace(H),uE.parameter=this.extract(H,this.consumeToken),this.peekChar(H)===p&&(uE.additional=this.extract(H,this.consumeTill))),_f=uE}if(Wt==="*")this.attributes.rtcpFeedbackWildcards.push(_f);else{let uE=this.attributes.payloads.find(IE=>IE.payloadType===parseInt(Wt,10));uE?uE.rtcpFeedbacks.push(_f):this.attributes.payloads.push({payloadType:parseInt(Wt,10),rtcpFeedbacks:[_f]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(H){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let Wt={port:this.extract(H,this.consumePort)};this.peekChar(H)===p&&(this.consumeAttributeSpace(H),Wt.netType=this.extractOneOrMore(H,C),this.consumeAttributeSpace(H),Wt.addressType=this.extractOneOrMore(H,C),this.consumeAttributeSpace(H),Wt.address=this.extract(H,this.consumeAddress)),this.attributes.rtcp=Wt}parseMsid(H){let Wt={id:this.extractOneOrMore(H,C,[1,64])};this.peekChar(H)===p&&(this.consumeAttributeSpace(H),Wt.appdata=this.extractOneOrMore(H,C,[1,64])),this.attributes.msids.push(Wt)}parseImageAttr(H){this.attributes.imageattr.push(H.attValue)}parseRid(H){let Wt=this.extractOneOrMore(H,_f=>A(_f)||_(_f)||_f==="_"||_f==="-");this.consumeAttributeSpace(H);let _e={id:Wt,direction:this.extract(H,this.consumeToken),params:[]};if(this.peekChar(H)===p){if(this.consumeAttributeSpace(H),this.peek(H,"pt=")){this.extract(H,this.consume,"pt=");let _f=[];for(;;){let uE=this.extract(H,this.consumeToken);_f.push(uE);try{this.extract(H,this.consume,",")}catch{break}}_e.payloads=_f,this.peekChar(H)===p&&this.extract(H,this.consume,p)}for(;;){let _f=this.extract(H,this.consumeToken);switch(_f){case"depend":{let uE={type:_f,rids:this.extract(H,this.consume,"=").split(",")};_e.params.push(uE);break}default:{let uE={type:_f};this.peekChar(H)==="="&&(this.extract(H,this.consume,"="),uE.val=this.extract(H,this.consumeTill,";")),_e.params.push(uE)}}try{this.extract(H,this.consume,";")}catch{break}}}this.attributes.rids.push(_e)}parseSimulcast(H){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=H.attValue,this.extract(H,this.consumeTill)}parseSctpPort(H){this.attributes.sctpPort=this.extractOneOrMore(H,_,[1,5])}parseMaxMessageSize(H){this.attributes.maxMessageSize=this.extractOneOrMore(H,_,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(H){this.attributes.mid=this.extract(H,this.consumeToken)}parseSSRCGroup(H){let Wt=this.extract(H,this.consumeToken),_e=[];for(;;)try{this.consumeAttributeSpace(H);let _f=this.extract(H,this.consumeInteger);_e.push(parseInt(_f,10))}catch{break}this.attributes.ssrcGroups.push({semantic:Wt,ssrcIds:_e})}}function Qm(Di,H,Wt){return H in Di?Object.defineProperty(Di,H,{value:Wt,enumerable:!0,configurable:!0,writable:!0}):Di[H]=Wt,Di}class _o{constructor(){Qm(this,"eol",h)}print(H,Wt){let _e="";return Wt&&(this.eol=Wt),_e+=this.printVersion(H.version),_e+=this.printOrigin(H.origin),_e+=this.printSessionName(H.sessionName),_e+=this.printInformation(H.information),_e+=this.printUri(H.uri),_e+=this.printEmail(H.emails),_e+=this.printPhone(H.phones),_e+=this.printConnection(H.connection),_e+=this.printBandwidth(H.bandwidths),_e+=this.printTimeFields(H.timeFields),_e+=this.printKey(H.key),_e+=this.printSessionAttributes(H.attributes),_e+=this.printMediaDescription(H.mediaDescriptions),_e}printVersion(H){return"v=".concat(H).concat(this.eol)}printOrigin(H){return"o=".concat(H.username," ").concat(H.sessId," ").concat(H.sessVersion," ").concat(H.nettype," ").concat(H.addrtype," ").concat(H.unicastAddress).concat(this.eol)}printSessionName(H){return H?"s=".concat(H).concat(this.eol):""}printInformation(H){return H?"i=".concat(H).concat(this.eol):""}printUri(H){return H?"u=".concat(H).concat(this.eol):""}printEmail(H){let Wt="";for(let _e of H)Wt+="e=".concat(_e).concat(this.eol);return Wt}printPhone(H){let Wt="";for(let _e of H)Wt+="e=".concat(_e).concat(this.eol);return Wt}printConnection(H){return H?"c=".concat(H.nettype," ").concat(H.addrtype," ").concat(H.address).concat(this.eol):""}printBandwidth(H){let Wt="";for(let _e of H)Wt+="b=".concat(_e.bwtype,":").concat(_e.bandwidth).concat(this.eol);return Wt}printTimeFields(H){let Wt="";for(let _e of H){Wt+="t=".concat(_e.time.startTime," ").concat(_e.time.startTime).concat(this.eol);for(let _f of _e.repeats)Wt+="r=".concat(_f.repeatInterval," ").concat(_f.typedTimes.join(" ")).concat(this.eol);_e.zoneAdjustments&&(Wt+="z=",Wt+="z=".concat(_e.zoneAdjustments.map(_f=>"".concat(_f.time," ").concat(_f.back?"-":""," ").concat(_f.typedTime)).join(" ")).concat(this.eol),Wt+=this.eol)}return Wt}printKey(H){return H?"k=".concat(H).concat(this.eol):""}printAttributes(H){let Wt="";for(let _e of H)Wt+="a=".concat(_e.attField).concat(_e.attValue?":".concat(_e.attValue):"").concat(this.eol);return Wt}printMediaDescription(H){let Wt="";for(let _e of H)Wt+=this.printMedia(_e.media),Wt+=this.printInformation(_e.information),Wt+=this.printConnections(_e.connections),Wt+=this.printBandwidth(_e.bandwidths),Wt+=this.printKey(_e.key),Wt+=this.printMediaAttributes(_e);return Wt}printConnections(H){let Wt="";for(let _e of H)Wt+=this.printConnection(_e);return Wt}printMedia(H){return"m=".concat(H.mediaType," ").concat(H.port," ").concat(H.protos.join("/")," ").concat(H.fmts.join(" ")).concat(this.eol)}printSessionAttributes(H){return new vf(this.eol).print(H)}printMediaAttributes(H){return new Fi(this.eol).print(H)}}class ga{constructor(H){Qm(this,"eol",void 0),this.eol=H}printIceUfrag(H){return H===void 0?"":"a=ice-ufrag:".concat(H).concat(this.eol)}printIcePwd(H){return H===void 0?"":"a=ice-pwd:".concat(H).concat(this.eol)}printIceOptions(H){return H===void 0?"":"a=ice-options:".concat(H.join(p)).concat(this.eol)}printFingerprints(H){return H.length>0?H.map(Wt=>"a=fingerprint:".concat(Wt.hashFunction).concat(p).concat(Wt.fingerprint)).join(this.eol)+this.eol:""}printExtmap(H){return H.map(Wt=>"a=extmap:".concat(Wt.entry).concat(Wt.direction?"/".concat(Wt.direction):"").concat(p).concat(Wt.extensionName).concat(Wt.extensionAttributes?"".concat(p).concat(Wt.extensionAttributes):"").concat(this.eol)).join("")}printSetup(H){return H===void 0?"":"a=setup:".concat(H).concat(this.eol)}printUnrecognized(H){return H.map(Wt=>"a=".concat(Wt.attField).concat(Wt.attValue?":".concat(Wt.attValue):"").concat(this.eol)).join("")}}class vf extends ga{print(H){let Wt="";return Wt+=this.printGroups(H.groups),Wt+=this.printMsidSemantic(H.msidSemantic),Wt+=this.printIceLite(H.iceLite),Wt+=this.printIceUfrag(H.iceUfrag),Wt+=this.printIcePwd(H.icePwd),Wt+=this.printIceOptions(H.iceOptions),Wt+=this.printFingerprints(H.fingerprints),Wt+=this.printSetup(H.setup),Wt+=this.printTlsId(H.tlsId),Wt+=this.printIdentity(H.identities),Wt+=this.printExtmap(H.extmaps),Wt+=this.printUnrecognized(H.unrecognized),Wt}printGroups(H){let Wt="";return H.length>0&&(Wt+=H.map(_e=>"a=group:".concat(_e.semantic).concat(_e.identificationTag.map(_f=>"".concat(p).concat(_f)).join("")).concat(this.eol)).join("")),Wt}printIceLite(H){return H===void 0?"":"a=ice-lite"+this.eol}printTlsId(H){return H?"a=tls-id:".concat(H).concat(this.eol):""}printIdentity(H){return H.length===0?"":H.map(Wt=>"a=identity:".concat(Wt.assertionValue).concat(Wt.extensions.map(_e=>"".concat(p).concat(_e.name).concat(_e.value?"=".concat(_e.value):"")))).join(this.eol)+this.eol}printMsidSemantic(H){if(!H)return"";let Wt="a=msid-semantic:".concat(H.semantic);return H.applyForAll?Wt+="".concat(p,"*"):H.identifierList.length>0&&(Wt+=H.identifierList.map(_e=>"".concat(p).concat(_e))),Wt+this.eol}}class Fi extends ga{print(H){let Wt=H.attributes,_e="";return _e+=this.printRTCP(Wt.rtcp),_e+=this.printIceUfrag(Wt.iceUfrag),_e+=this.printIcePwd(Wt.icePwd),_e+=this.printIceOptions(Wt.iceOptions),_e+=this.printCandidates(Wt.candidates),_e+=this.printRemoteCandidatesList(Wt.remoteCandidatesList),_e+=this.printEndOfCandidates(Wt.endOfCandidates),_e+=this.printFingerprints(Wt.fingerprints),_e+=this.printSetup(Wt.setup),_e+=this.printMid(Wt.mid),_e+=this.printExtmap(Wt.extmaps),_e+=this.printRTPRelated(Wt),_e+=this.printPtime(Wt.ptime),_e+=this.printMaxPtime(Wt.maxPtime),_e+=this.printDirection(Wt.direction),_e+=this.printSSRCGroups(Wt.ssrcGroups),_e+=this.printSSRC(Wt.ssrcs),_e+=this.printRTCPMux(Wt.rtcpMux),_e+=this.printRTCPMuxOnly(Wt.rtcpMuxOnly),_e+=this.printRTCPRsize(Wt.rtcpRsize),_e+=this.printMSId(Wt.msids),_e+=this.printImageattr(Wt.imageattr),_e+=this.printRid(Wt.rids),_e+=this.printSimulcast(Wt.simulcast),_e+=this.printSCTPPort(Wt.sctpPort),_e+=this.printMaxMessageSize(Wt.maxMessageSize),_e+=this.printUnrecognized(Wt.unrecognized),_e}printCandidates(H){return H.map(Wt=>"a=candidate:".concat(Wt.foundation).concat(p).concat(Wt.componentId).concat(p).concat(Wt.transport).concat(p).concat(Wt.priority).concat(p).concat(Wt.connectionAddress).concat(p).concat(Wt.port).concat(p,"typ").concat(p).concat(Wt.type).concat(Wt.relAddr?"".concat(p,"raddr").concat(p).concat(Wt.relAddr):"").concat(Wt.relPort?"".concat(p,"rport").concat(p).concat(Wt.relPort):"").concat(Object.keys(Wt.extension).map(_e=>"".concat(p).concat(_e).concat(p).concat(Wt.extension[_e])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(H){return H.map(Wt=>"a=remote-candidates:".concat(Wt.join(p)).concat(this.eol)).join("")}printEndOfCandidates(H){return H===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(H){if(!H.payloads)return"";let Wt=H.payloads,_e="";_e+=H.rtcpFeedbackWildcards.map(_f=>this.printRTCPFeedback("*",_f)).join("");for(let _f of Wt)_e+=this.printRtpMap(_f.payloadType,_f.rtpMap),_e+=this.printFmtp(_f.payloadType,_f.fmtp),_e+=_f.rtcpFeedbacks.map(uE=>this.printRTCPFeedback(_f.payloadType,uE)).join("");return _e}printFmtp(H,Wt){if(!Wt)return"";let _e=Object.keys(Wt.parameters);return _e.length===1&&Wt.parameters[_e[0]]===null?"a=fmtp:".concat(H).concat(p).concat(_e[0]).concat(this.eol):"a=fmtp:".concat(H).concat(p).concat(Object.keys(Wt.parameters).map(_f=>"".concat(_f,"=").concat(Wt.parameters[_f])).join(";")).concat(this.eol)}printRtpMap(H,Wt){return Wt?"a=rtpmap:".concat(H).concat(p).concat(Wt.encodingName,"/").concat(Wt.clockRate).concat(Wt.encodingParameters?"/".concat(Wt.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(H,Wt){let _e="a=rtcp-fb:".concat(H).concat(p),_f=Wt;return _f.type==="trr-int"?_e+="ttr-int".concat(p).concat(_f.interval):(_e+="".concat(_f.type),_f.parameter&&(_e+="".concat(p).concat(_f.parameter),_f.additional&&(_e+="".concat(p).concat(_f.additional)))),_e+this.eol}printPtime(H){return H===void 0?"":"a=ptime:".concat(H).concat(this.eol)}printMaxPtime(H){return H===void 0?"":"a=maxptime:".concat(H).concat(this.eol)}printDirection(H){return H===void 0?"":"a=".concat(H).concat(this.eol)}printSSRC(H){return H.map(Wt=>Object.keys(Wt.attributes).map(_e=>"a=ssrc:".concat(Wt.ssrcId.toString(10)).concat(p).concat(_e).concat(Wt.attributes[_e]?":".concat(Wt.attributes[_e]):"").concat(this.eol)).join("")).join("")}printRTCPMux(H){return H===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(H){return H===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(H){return H===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(H){if(H===void 0)return"";let Wt="a=rtcp:".concat(H.port);return H.netType&&(Wt+="".concat(p).concat(H.netType)),H.addressType&&(Wt+="".concat(p).concat(H.addressType)),H.address&&(Wt+="".concat(p).concat(H.address)),Wt+this.eol}printMSId(H){return H.map(Wt=>"a=msid:".concat(Wt.id).concat(Wt.appdata?"".concat(p).concat(Wt.appdata):"").concat(this.eol)).join("")}printImageattr(H){return H.map(Wt=>"a=imageattr:".concat(Wt).concat(this.eol)).join("")}printRid(H){return H.map(Wt=>{let _e="a=rid:".concat(Wt.id).concat(p).concat(Wt.direction);return Wt.payloads&&(_e+="".concat(p,"pt=").concat(Wt.payloads.join(","))),Wt.params.length>0&&(_e+="".concat(p).concat(Wt.params.map(_f=>_f.type==="depend"?"depend=".concat(_f.rids.join(",")):"".concat(_f.type,"=").concat(_f.val)).join(";"))),_e+this.eol}).join("")}printSimulcast(H){return H===void 0?"":"a=simulcast:".concat(H).concat(this.eol)}printSCTPPort(H){return H===void 0?"":"a=sctp-port:".concat(H).concat(this.eol)}printMaxMessageSize(H){return H===void 0?"":"a=max-message-size:".concat(H).concat(this.eol)}printMid(H){return H===void 0?"":"a=mid:".concat(H).concat(this.eol)}printSSRCGroups(H){return H.map(Wt=>"a=ssrc-group:".concat(Wt.semantic).concat(Wt.ssrcIds.map(_e=>"".concat(p).concat(_e.toString(10))).join("")).concat(this.eol)).join("")}}function Gi(Di){return new kc().parse(Di)}function _d(Di,H){return new _o().print(Di,H)}}},r={};function i(o){if(r[o])return r[o].exports;var s=r[o]={exports:{}};return e[o](s,s.exports,i),s.exports}return i.d=(o,s)=>{for(var l in s)i.o(s,l)&&!i.o(o,l)&&Object.defineProperty(o,l,{enumerable:!0,get:s[l]})},i.o=(o,s)=>Object.prototype.hasOwnProperty.call(o,s),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();var _v=Lst.exports;function B8(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_r("SVC_MODE");if(_r("ENABLE_SVC"))return function(r){return r in w8}(e)?e:w8.L1T3}function _tt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function gtt(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?_tt(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_tt(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function wL(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0,{filterRTX:s,filterVideoFec:l,filterAudioFec:d,filterAudioCodec:h,filterVideoCodec:p}=r,{useXR:f}=i,_=[],g=[],b=[],C=[],k=!1,A=!1;if(_v.parse(e).mediaDescriptions.forEach(x=>{o&&o!==x.attributes.direction||(x.media.mediaType!=="video"||k||(g=x.attributes.payloads,C=x.attributes.extmaps,k=!0),x.media.mediaType!=="audio"||A||(_=x.attributes.payloads,b=x.attributes.extmaps,A=!0))}),!C||g.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!b||_.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(g.forEach(x=>{var j;(j=x.rtpMap)!==null&&j!==void 0&&j.clockRate&&(x.rtpMap.clockRate=parseInt(x.rtpMap.clockRate)),f&&x.rtcpFeedbacks.push({type:"rrtr"})}),_.forEach(x=>{var j;(j=x.rtpMap)!==null&&j!==void 0&&j.clockRate&&(x.rtpMap.clockRate=parseInt(x.rtpMap.clockRate)),f&&x.rtcpFeedbacks.push({type:"rrtr"})}),s&&(_=_.filter(x=>{var j;return((j=x.rtpMap)===null||j===void 0?void 0:j.encodingName.toLowerCase())!=="rtx"}),g=g.filter(x=>{var j;return((j=x.rtpMap)===null||j===void 0?void 0:j.encodingName.toLowerCase())!=="rtx"})),l&&(g=g.filter(x=>{var j;return!/(red)|(ulpfec)|(flexfec)/i.test(((j=x.rtpMap)===null||j===void 0?void 0:j.encodingName)||"")})),d&&(_=_.filter(x=>{var j;return!/(red)|(ulpfec)|(flexfec)/i.test(((j=x.rtpMap)===null||j===void 0?void 0:j.encodingName)||"")})),h&&h?.length>0&&(_=_.filter(x=>{var j;return nE(h).call(h,((j=x.rtpMap)===null||j===void 0?void 0:j.encodingName.toLowerCase())||"")})),p&&p?.length>0){let x=g.filter(j=>{var z;return nE(p).call(p,((z=j.rtpMap)===null||z===void 0?void 0:z.encodingName.toLowerCase())||"")});g=x.concat(s?[]:dH(x,g))}let P=_r("UNSUPPORTED_VIDEO_CODEC");return P&&P.length>0&&(g=g.filter(x=>!(x.rtpMap&&nE(P).call(P,x.rtpMap.encodingName.toLowerCase())))),{audioCodecs:_,videoCodecs:g,audioExtensions:b,videoExtensions:C}}function HI(e){let r=_v.parse(e),i,o;for(let s of r.mediaDescriptions){if(!i){let l=s.attributes.iceUfrag,d=s.attributes.icePwd;if(!l||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:l,icePwd:d}}if(!o){let l=s.attributes.fingerprints;l.length>0&&(o={fingerprints:l})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function Mst(e,r){let i=[],o=e.attributes.ssrcGroups.filter(d=>d.semantic==="FID"),s=e.attributes.ssrcGroups.find(d=>d.semantic==="SIM"),l=e.attributes.ssrcs;if(s)s.ssrcIds.forEach(d=>{var h;let p=(h=o.find(f=>f.ssrcIds[0]===d))===null||h===void 0?void 0:h.ssrcIds[1];i.push({ssrcId:d,rtx:r?p:void 0})});else if(o.length>0){let d=o[0].ssrcIds[0],h=o[0].ssrcIds[1];i.push({ssrcId:d,rtx:r?h:void 0})}else{if(l.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:l[0].ssrcId})}return i}function vtt(e,r,i){let{cname:o}=e,s=[];r&&(s=Ust(r)),s.length===0&&(s=e.iceParameters.candidates.map(_=>({foundation:_.foundation,componentId:"1",transport:_.protocol,priority:_.priority.toString(),connectionAddress:_.ip,port:_.port.toString(),type:_.type,extension:{}})),B.debug("Using candidates from gateway."));let l={fingerprints:e.dtlsParameters.fingerprints.map(_=>({hashFunction:_.algorithm,fingerprint:_.fingerprint}))},d={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},h;switch(e.dtlsParameters.role){case"server":h="passive";break;case"client":h="active";break;case"auto":h="actpass"}let p=w3(e.rtpCapabilities),f=[];return Array.isArray(i)&&i.length>0&&i.forEach(_=>{f.push({kind:cE.VIDEO,ssrcId:_.v,rtx:_.v_rtx,mslabel:"".concat(_.v,"_").concat(_.a)},{kind:cE.AUDIO,ssrcId:_.a,mslabel:"".concat(_.v,"_").concat(_.a)})}),{dtlsParameters:l,iceParameters:d,candidates:s,rtpCapabilities:p,setup:h,cname:o,preSSRCs:f}}function Ust(e){let r=[];return e.ip&&typeof e.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],B.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),B.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),r}function UO(e,r,i){let o=[],s=[];return e.forEach(l=>{let{ssrcId:d,rtx:h}=l,p=ZE(8,"track-"),f={ssrcId:d,attributes:gtt({label:p,mslabel:i=i||ZE(10,""),msid:"".concat(i," ").concat(p)},r&&{cname:r})};if(o.push(f),h!==void 0){let _={ssrcId:h,attributes:gtt({label:p,mslabel:i,msid:"".concat(i," ").concat(p)},r&&{cname:r})};o.push(_),s.push({semantic:"FID",ssrcIds:[d,h]})}}),e.length>1&&s.push({semantic:"SIM",ssrcIds:e.map(l=>{let{ssrcId:d}=l;return d})}),{ssrcs:o,ssrcGroups:s}}function V1(e,r){r instanceof h_&&e.attributes.payloads.forEach(i=>{var o;let s=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";let l=r._encoderConfig;l&&s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(l.bitrate&&!f_()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*l.bitrate))),l.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(l.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(l.sampleRate)),l.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function uH(e){let r=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&e.attributes.unrecognized.splice(r,1)}function lH(e,r){var i;if(!(r instanceof e_&&r._encoderConfig&&r._hints.indexOf(XE.SCREEN_TRACK)===-1))return;let o=r._encoderConfig;ME().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(s=>{var l,d;nE(l=["h264","h265","vp8","vp9","av1"]).call(l,((d=s.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),ME().supportMinBitrate&&!nE(i=r._hints).call(i,XE.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(s=>{var l,d;nE(l=["h264","h265","vp8","vp9","av1"]).call(l,((d=s.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(_r("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function xst(e){if(e.media.mediaType!=="video")return;let r=DE();if(r.name!==FE.SAFARI&&r.os!==W_.IOS)return;let i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function R3(e,r,i){if(!r)return;let o,s;if(e.media.mediaType==="video"?(o=i.videoExtensions,s=i.videoCodecs):(o=i.audioExtensions,s=i.audioCodecs),r.twcc===!0){let l=o.find(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");l&&(e.attributes.extmaps.find(h=>h.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:l.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(h,p){return p.filter(f=>!!h.find(_=>_.payloadType===f.payloadType&&!!_.rtcpFeedbacks.find(g=>g.type==="transport-cc")))}(s,e.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(p=>p.type==="transport-cc")||h.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(r.twcc===!1){let l=e.attributes.extmaps.findIndex(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(d=>{let h=d.rtcpFeedbacks.findIndex(p=>p.type==="transport-cc");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}if(r.remb===!0){let l=o.find(d=>d.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");l&&(e.attributes.extmaps.find(h=>h.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:l.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(h,p){return p.filter(f=>!!h.find(_=>_.payloadType===f.payloadType&&!!_.rtcpFeedbacks.find(g=>g.type==="goog-remb")))}(s,e.attributes.payloads).forEach(h=>{h.rtcpFeedbacks.find(p=>p.type==="goog-remb")||h.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(r.remb===!1){let l=e.attributes.extmaps.findIndex(d=>d.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");l!==-1&&e.attributes.extmaps.splice(l,1),e.attributes.payloads.forEach(d=>{let h=d.rtcpFeedbacks.findIndex(p=>p.type==="goog-remb");h!==-1&&d.rtcpFeedbacks.splice(h,1)})}}function jst(e,r,i){if(f_()||e.media.mediaType!=="video"||!(r instanceof e_)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!_r("SIMULCAST")||i==="vp9"&&_r("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;let o=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,s=e.attributes.ssrcs[0],l=e.attributes.ssrcGroups.find(h=>h.semantic==="FID"&&h.ssrcIds[0]===s.ssrcId),d={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let h=1;h<o;h++)e.attributes.ssrcs.push({ssrcId:s.ssrcId+h,attributes:R_(s.attributes)}),d.ssrcIds.push(s.ssrcId+h),l&&(e.attributes.ssrcs.push({ssrcId:l.ssrcIds[1]+h,attributes:R_(s.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+h,l.ssrcIds[1]+h]}));e.attributes.ssrcGroups.unshift(d)}async function Vst(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});let o=(await i.createOffer()).sdp,{send:s,recv:l,sendrecv:d}=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0,_=wL(f,h,p,"sendonly"),g=wL(f,h,p,"recvonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(RT(_,g,"videoExtensions",b,C,k),RT(_,g,"videoCodecs",b,C,k),RT(_,g,"audioExtensions",b,C,k),RT(_,g,"audioCodecs",b,C,k),_r("RAISE_H264_BASELINE_PRIORITY")){let A=k.videoCodecs.findIndex(P=>{var x,j;return((x=P.rtpMap)===null||x===void 0?void 0:x.encodingName.toLocaleLowerCase())==="h264"&&((j=P.fmtp)===null||j===void 0?void 0:j.parameters["profile-level-id"])==="42001f"});if(A!==-1){let P=k.videoCodecs.findIndex(x=>{var j;return((j=x.rtpMap)===null||j===void 0?void 0:j.encodingName.toLocaleLowerCase())==="h264"});if(P<A){B.debug("raising H264 baseline profile priority");let x=k.videoCodecs[A];k.videoCodecs.splice(A,1),k.videoCodecs.splice(P,0,x)}P!==-1&&(C.videoCodecs=C.videoCodecs.filter(x=>{var j,z;return!(((j=x.rtpMap)===null||j===void 0?void 0:j.encodingName.toLocaleLowerCase())==="h264"&&((z=x.fmtp)===null||z===void 0?void 0:z.parameters["profile-level-id"])!=="42001f")})),P!==-1&&_r("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(x=>{var j,z;return!(((j=x.rtpMap)===null||j===void 0?void 0:j.encodingName.toLocaleLowerCase())==="h264"&&((z=x.fmtp)===null||z===void 0?void 0:z.parameters["profile-level-id"])!=="42001f")}))}}return{send:b,recv:C,sendrecv:k}}(e,r,o);try{i.close()}catch{}return{send:s,recv:l,sendrecv:d}}function ytt(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=wL(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(RT(e,r,"videoExtensions",i,o,s),RT(e,r,"videoCodecs",i,o,s),RT(e,r,"audioExtensions",i,o,s),RT(e,r,"audioCodecs",i,o,s),_r("RAISE_H264_BASELINE_PRIORITY")){let l=s.videoCodecs.findIndex(d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]==="42001f");if(l!==-1){let d=s.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(d<l){B.debug("raising H264 baseline profile priority");let h=s.videoCodecs[l];s.videoCodecs.splice(l,1),s.videoCodecs.splice(d,0,h)}d!==-1&&(o.videoCodecs=o.videoCodecs.filter(h=>!(h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:s}}function RT(e,r,i,o,s,l){if(i==="videoExtensions"||i==="audioExtensions"){let d=[];return e[i].forEach(h=>{r[i].some((p,f)=>{if(h.entry===p.entry&&h.extensionName===p.extensionName)return d.push(f),!0})?l[i].push(h):o[i].push(h)}),void r[i].forEach((h,p)=>{d.indexOf(p)===-1&&s[i].push(h)})}if(i==="videoCodecs"||i==="audioCodecs"){let d=[];return e[i].forEach(h=>{r[i].some((p,f)=>{if(h.payloadType===p.payloadType&&JSON.stringify(h)===JSON.stringify(p))return d.push(f),!0})?l[i].push(h):o[i].push(h)}),void r[i].forEach((h,p)=>{d.indexOf(p)===-1&&s[i].push(h)})}}function w3(e){let{send:r,recv:i,sendrecv:o}=e;if(!o){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let s,l;return r?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...r.audioCodecs,...o.audioCodecs],s.videoCodecs=[...r.videoCodecs,...o.videoCodecs],s.audioExtensions=[...r.audioExtensions,...o.audioExtensions],s.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):s=o,i?(l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l.audioCodecs=[...i.audioCodecs,...o.audioCodecs],l.videoCodecs=[...i.videoCodecs,...o.videoCodecs],l.audioExtensions=[...i.audioExtensions,...o.audioExtensions],l.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):l=o,{send:s,recv:l}}function F1(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function $D(e,r,i,o){let s=[];if(e===cE.VIDEO){if(_r("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(s=r.videoCodecs.filter(l=>{var d;return nE(d=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(d,o)&&l&&l.fmtp&&l.fmtp.parameters["profile-level-id"]===_r("H264_PROFILE_LEVEL_ID")})),!Array.isArray(s)||s.length===0){let l=[],d=[],h=[],p=[];if(i.videoCodecs.forEach(f=>{let _=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"";nE(_).call(_,o)?l.push(f):nE(_).call(_,"vp9")?d.push(f):nE(_).call(_,"vp8")?h.push(f):nE(_).call(_,"h264")&&p.push(f)}),l.length===0){let f="";d.length!==0?(l=d,f="vp9"):h.length!==0?(l=h,f="vp8"):p.length!==0&&(l=p,f="h264"),B.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(f))}l.length!==0&&(s=r.videoCodecs.filter(f=>l.some(_=>_.payloadType===f.payloadType)))}if(s.length===0&&(B.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),s=r.videoCodecs),_r("USE_PUB_RTX")||_r("USE_SUB_RTX")){let l=dH(s,r.videoCodecs);s=[...s,...l]}}else s=r.audioCodecs.filter(l=>{var d;return nE(d=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(d,o)}),s.length===0&&(B.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),s=r.audioCodecs.filter(l=>{var d;return nE(d=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"").call(d,"opus")}));return s}function dH(e,r){let i=e.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&nE(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function nU(e,r,i){let o=r.toString(),s=Bst(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});let l=await e.createAnswer();if(!l.sdp)throw new Error("cannot get answer sdp");let d=l.sdp;d=Fst(d,i||{}),s?.(d||""),await e.setLocalDescription({type:"answer",sdp:d})}function Fst(e,r,i){let o=_v.parse(e),{useXR:s}=r;return o.mediaDescriptions.forEach(l=>{var d;l.attributes.mid&&(Array.isArray(i)&&!nE(i).call(i,l.attributes.mid)||(l.media.mediaType==="audio"&&F1(l),s&&nE(d=["audio","video"]).call(d,l.media.mediaType)&&l.attributes.payloads.forEach(h=>{h.rtcpFeedbacks.findIndex(p=>p.type==="rrtr")===-1&&h.rtcpFeedbacks.push({type:"rrtr"})})))}),_v.print(o)}function Bst(e,r,i,o){if(_r("SDP_LOGGING"))return B.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(o,`
`),e),r==="offer"?s=>{Bst(s,"answer",i==="local"?"remote":"local",o)}:void 0}function dR(e,r){return typeof _r(e)===r?_r(e):void 0}function Stt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function kI(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Stt(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Stt(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Y6=new Map,G8=class extends s_{get state(){return this._state}set state(r){if(r===this._state)return;let i=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(r0.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit(r0.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){B.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){super(),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"key",void 0),$(this,"ntpOffset",0),$(this,"signal",void 0),$(this,"role",void 0),$(this,"inChannelInfo",{joinAt:null,duration:0}),$(this,"spec",void 0),$(this,"_state","DISCONNECTED"),$(this,"_statsCollector",void 0),$(this,"_disconnectedReason",void 0),$(this,"isSignalRecover",!1),$(this,"hasChangeBGPAddress",!1),$(this,"trafficStatsInterval",void 0),$(this,"networkQualityInterval",void 0),$(this,"_joinGatewayStartTime",0),$(this,"_signalTimeout",!1),$(this,"_clientRoleOptions",void 0),$(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useP2P?new b3(kI(kI({},i),{},{retryConfig:i.websocketRetryConfig}),r):new O8(kI(kI({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(r,i,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let s=Date.now(),l=Y6.get(r.cname);if(l||(l=new Map,Y6.set(r.cname,l)),this._isProactiveJoin=!0,l.has(r.uid)){let f=new _a(Vt.UID_CONFLICT);throw aE.joinGateway(r.sid,{lts:s,succ:!1,ec:f.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),this._isProactiveJoin=!1,f}l.set(r.uid,!0),this.joinInfo=r,this.key=i;let d=0;this.joinGatewayStartTime=s;let h=r.proxyServer;try{B.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(d));let f=r.gatewayAddrs.map(_=>{let{address:g}=_,[b,C]=g.split(":"),k={host:b,port:C};return r.proxyServer&&(k.proxy=r.proxyServer),k});d=(await this.signal.init(f,o)).uid,B.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(d," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(f){var p;throw B.error("[".concat(this.store.clientId,"] User join failed"),f.toString()),aE.joinGateway(r.sid,{lts:s,succ:!1,ec:((p=f.data)===null||p===void 0?void 0:p.desc)||f.code,errorMsg:f.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!h,signalChannel:"0",preload:r.preload}),this._isProactiveJoin=!1,l.delete(r.uid),this.signal.close(),f}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),B.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(f=>{B.warning("[".concat(this.store.clientId,"] get traffic stats error"),f.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(r0.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(r0.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(r0.NETWORK_QUALITY,{uplinkNetworkQuality:mZ(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:mZ(this._statsCollector.trafficStats.B_dnq)}):this.emit(r0.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),d}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==GE.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==QE.CONNECTED||await function(o,s){return s===1/0?o:eE.race([o,ZSt(s)])}(this.signal.request(mE.LEAVE,void 0,!0),3e3)}catch(o){B.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==GE.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let s={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:_r("PUB_EXTEND"),twcc:!!_r("PUBLISH_TWCC"),rtx:!!_r("USE_PUB_RTX")};try{return(await this.signal.request(mE.PUBLISH,s,!0))._message}catch(l){if(o&&l.data&&l.data.code===hE.ERR_PUBLISH_REQUEST_INVALID)return B.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),l.toString()),await this.tryUnpubBeforeRepub(r,i),this.publish(r,i,!1);throw l}}async publishDataChannel(r,i,o){var s;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let l={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(s=i.maxRetransmits)!==null&&s!==void 0?s:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(mE.PUBLISH_DATASTREAM,l,!0)}catch(d){if(o&&d.data&&d.data.code===hE.ERR_PUBLISH_REQUEST_INVALID)return B.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),d.toString()),await this.tryUnpubDataChannelBeforeRepub(r,i),this.publishDataChannel(r,i,!1);throw d}}async unpublish(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(mE.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(o){B.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await eE.all(r.map(i=>this.signal.request(mE.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){B.warning("unpublish datachannels warning: ",i)}}async presubscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let s={stream_id:r,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!_r("SUBSCRIBE_TWCC"),rtx:!!_r("USE_SUB_RTX")||void 0,extend:_r("SUB_EXTEND"),svc:Array.isArray(_r("SVC"))&&_r("SVC").length!==0?_r("SVC"):void 0};try{return await this.signal.request(mE.PRE_SUBSCRIBE,s,!0)}catch(l){if(o&&l.data&&l.data.code===hE.ERR_SUBSCRIBE_REQUEST_INVALID)return B.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),l.toString()),this.presubscribe(r,i,!1);throw l}}async subscribe(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let s={stream_id:r,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!_r("SUBSCRIBE_TWCC"),rtx:!!_r("USE_SUB_RTX"),extend:_r("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(_r("SVC"))&&_r("SVC").length!==0?_r("SVC"):void 0};try{return(await this.signal.request(mE.SUBSCRIBE,s,!0))._message}catch(l){if(o&&l.data&&l.data.code===hE.ERR_SUBSCRIBE_REQUEST_INVALID)return B.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),l.toString()),await this.tryUnsubBeforeResub(r,i),await this.subscribe(r,i,!1);throw l}}async subscribeDataChannel(r,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let s={uid:r,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(mE.SUBSCRIBE_DATASTREAM,s,!0)}catch(l){if(o&&l.data&&l.data.code===hE.ERR_SUBSCRIBE_REQUEST_INVALID)return B.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),l.toString()),await this.tryUnsubDataChannelBeforeResub(r,i),await this.subscribeDataChannel(r,i,!1);throw l}}async subscribeAll(r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!_r("USE_SUB_RTX"),twcc:!!_r("SUBSCRIBE_TWCC"),svc:Array.isArray(_r("SVC"))&&_r("SVC").length!==0?_r("SVC"):void 0};try{return await this.signal.request(mE.SUBSCRIBE_STREAMS,o,!0)}catch(s){if(i&&s.data&&s.data.code===hE.ERR_SUBSCRIBE_REQUEST_INVALID)return B.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw s}}async setVideoProfile(r){let i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let s=o.frameRate,l=o.width,d=o.height,h=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(h=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,l||(h=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,s||(h=!1)),h?{stream_type:0,width:l,height:d,fps:s,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(i)return this.signal.request(mE.SET_VIDEO_PROFILE,i);B.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,i){try{await this.signal.request(mE.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:i},!0)}catch(o){B.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await eE.all(r.map(o=>this.signal.request(mE.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){B.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(mE.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){B.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(r){let{iceParameters:i,dtlsParameters:o,rtpCapabilities:s}=r;return{gatewayEstablishParams:await this.signal.request(mE.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(mE.GATEWAY_INFO)}async renewToken(r){await this.signal.request(mE.RENEW_TOKEN,r),this.key=r.token}async setClientRole(r,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),this.state!=="CONNECTED")return void(this.role=r);let o,s=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0,await this.signal.request(mE.SET_CLIENT_ROLE,{role:r,level:s,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,i){await this.signal.request(mE.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(mE.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,i){await this.signal.request(mE.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})}async pickSVCLayer(r,i){await this.signal.request(mE.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(r){await this.signal.request(mE.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,i,o){if(this.signal instanceof b3)return this.signal.sendExtensionMessage(r,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),kI({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(mE.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let r=Y6.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let r=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:i0.username,password:i0.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(kI(kI({},i0),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let r=await this.signal.request(mE.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(i=>{let o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(s=>s.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&dV(()=>{this.emit(r0.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new _a(Vt.UNEXPECTED_ERROR,"can not generate join message, no join info");let i=Object.assign({},this.joinInfo.apResponse),o=_r("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}o&&o.length>128&&(o=void 0);let s=!(f_()||Yot(87)||VZ())&&typeof _r("ENABLE_PRE_SUB")=="boolean"&&_r("ENABLE_PRE_SUB"),l=!VZ()&&dR("ENABLE_PREALLOC_PC","boolean"),d=kI({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:XS,browser:navigator.userAgent,process_id:_r("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:_r("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:{enablePublishedUserList:_r("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:_r("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof _r("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?_r("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof _r("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?_r("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof _r("ENABLE_USER_LICENSE_CHECK")=="boolean"?_r("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:_r("USE_PUB_RTX")===!0||_r("USE_SUB_RTX")===!0||void 0,disableFEC:_r("DISABLE_FEC"),enableNTPReport:!!_r("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!_r("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!_r("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:dR("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!_r("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!_r("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:dR("USE_XR","boolean"),enableLossbasedBwe:dR("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!_r("ENABLE_AUT_CC")||void 0,enableCCFallback:dR("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:l,preSubNum:s?dR("PRE_SUB_NUM","number"):void 0,enablePubTWCC:dR("PUBLISH_TWCC","boolean"),enableSubTWCC:dR("SUBSCRIBE_TWCC","boolean"),enablePubRTX:dR("USE_PUB_RTX","boolean"),enableSubRTX:dR("USE_SUB_RTX","boolean"),enableSubSVC:_r("ENABLE_SVC")?_r("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(_r("SVC"))&&_r("SVC").length!==0?_r("SVC"):void 0}},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(d.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(d.aes_mode=this.joinInfo.aesmode,_r("ENCRYPT_AES")?(d.aes_secret=this.joinInfo.aespassword,d.aes_encrypt=!0):d.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(d.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(d.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(d.default_video_stream=this.joinInfo.defaultVideoStream),d}getRejoinMessage(){if(!this.joinInfo)throw new _a(Vt.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(EE.WS_RECONNECT_WAITTING_FINISH,r=>{var i;nE(i=["tryNext","recover"]).call(i,r)&&this.joinInfo&&aE.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(EE.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(EE.WS_RECONNECTING,r=>{this.joinInfo&&aE.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||s0.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",aE.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(EE.WS_CLOSED,r=>{let i;switch(r){case GE.LEAVE:i=s0.LEAVE;break;case GE.UID_BANNED:case GE.IP_BANNED:case GE.CHANNEL_BANNED:case GE.SERVER_ERROR:i=s0.SERVER_ERROR;break;case GE.FALLBACK:i=s0.FALLBACK;break;case GE.LICENSE_MISSING:case GE.LICENSE_EXPIRED:case GE.LICENSE_MINUTES_EXCEEDED:case GE.LICENSE_PERIOD_INVALID:case GE.LICENSE_MULTIPLE_SDK_SERVICE:case GE.LICENSE_ILLEGAL:case GE.TOKEN_EXPIRE:i=r;break;default:i=s0.NETWORK_ERROR}B.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+s0.NETWORK_ERROR)),this.joinInfo&&aE.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===GE.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=r,r!==GE.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(EE.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(B.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),aE.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){let r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void B.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));WE("EVENT_REPORT_DOMAIN",r[1]),WE("EVENT_REPORT_BACKUP_DOMAIN",r[1]),WE("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}),this.signal.on(wE.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(EE.REQUEST_RECOVER,(r,i,o)=>{if(!this.joinInfo)return o(new _a(Vt.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,c0(this,r0.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on(EE.REQUEST_JOIN_INFO,async r=>{var i;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));let{iceParameters:o,dtlsParameters:s,rtpCapabilities:l}=await c0(this,r0.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(i=this.joinInfo)===null||i===void 0?void 0:i.turnServer});r(this.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:s,rtpCapabilities:l,version:"2"}}))}),this.signal.on(EE.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(EE.REPORT_JOIN_GATEWAY,(r,i)=>{if(!this.joinInfo)return;let o,s="";var l;r instanceof _a?(o=((l=r.data)===null||l===void 0?void 0:l.desc)||r.code,s=r.message):o=r,aE.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:s,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(EE.IS_P2P_DISCONNECTED,r=>{r(gL(this,r0.IS_P2P_DISCONNECTED))}),this.signal.on(EE.DISCONNECT_P2P,()=>{this.emit(r0.DISCONNECT_P2P)}),this.signal.on(EE.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(EE.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(EE.JOIN_RESPONSE,r=>{let i=this.getCurrentGatewayAddress();this.emit(r0.JOIN_RESPONSE,r,i)}),this.signal.on(EE.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();let r=this.getCurrentGatewayAddress(),i=_r("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&i){let o=Ust(r);this.emit(r0.PRE_CONNECT_PC,{candidates:o,fingerprint:i})}}}),this.signal.on(EE.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof _r("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(_r("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,i){try{await this.signal.request(mE.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(o){throw B.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,i){try{await this.signal.request(mE.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw B.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,i){try{await this.signal.request(mE.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(o){throw B.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,i){try{await this.signal.request(mE.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw B.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){let i={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(mE.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw B.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,i){let o={action:r.find(s=>s.stream_type===VE.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(mE.CONTROL,o,!0,!0)}catch(s){throw B.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(r,i){let o={action:r.find(s=>s.stream_type===VE.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(mE.CONTROL,o,!0,!0)}catch(s){throw B.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}async muteRemote(r,i){let o={action:r===cE.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(mE.CONTROL,o,!0,!0)}catch(s){throw B.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),s),s}}async unmuteRemote(r,i){let o={action:r===cE.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(mE.CONTROL,o,!0,!0)}catch(s){throw B.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),s),s}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}async restartICE(r){let i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(mE.RESTART_ICE,i,!0)}catch(o){throw B.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,s0.P2P_FAILED)}getCurrentGatewayAddress(){var r,i;if(!_r("GATEWAY_WSS_ADDRESS"))return _r("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(B.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(mE.SET_PARAMETER,{enablePublishAudioFilter:r})}},rU=0,J6=0;function _b(e,r,i,o){return new eE((s,l)=>{r.timeout=r.timeout||_r("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),rU+=SR(r.data)):i&&(r.data.size?rU+=r.data.size:r.data instanceof FormData?rU+=ost(r.data):rU+=SR(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,K0.request(r).then(d=>{typeof d.data=="string"?J6+=SR(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?J6+=d.data.byteLength:J6+=SR(JSON.stringify(d.data)),o&&s({data:d.data,headers:d.headers}),s(d.data)}).catch(d=>{K0.isCancel(d)?l(new _a(Vt.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?l(new _a(Vt.NETWORK_TIMEOUT,d.message)):d.response?l(new _a(Vt.NETWORK_RESPONSE_ERROR,d.response.status)):l(new _a(Vt.NETWORK_ERROR,d.message))})})}(function(){var e;function r(Fi){var Gi=0;return function(){return Gi<Fi.length?{done:!1,value:Fi[Gi++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(Fi,Gi,_d){return Fi==Array.prototype||Fi==Object.prototype||(Fi[Gi]=_d.value),Fi},o,s=function(Fi){Fi=[typeof globalThis=="object"&&globalThis,Fi,typeof window=="object"&&window,typeof self=="object"&&self,typeof y1=="object"&&y1];for(var Gi=0;Gi<Fi.length;++Gi){var _d=Fi[Gi];if(_d&&_d.Math==Math)return _d}throw Error("Cannot find global object")}(this);function l(Fi,Gi){if(Gi)t:{var _d=s;Fi=Fi.split(".");for(var Di=0;Di<Fi.length-1;Di++){var H=Fi[Di];if(!(H in _d))break t;_d=_d[H]}(Gi=Gi(Di=_d[Fi=Fi[Fi.length-1]]))!=Di&&Gi!=null&&i(_d,Fi,{configurable:!0,writable:!0,value:Gi})}}function d(Fi){return(Fi={next:Fi})[Symbol.iterator]=function(){return this},Fi}function h(Fi){var Gi=typeof Symbol<"u"&&Symbol.iterator&&Fi[Symbol.iterator];return Gi?Gi.call(Fi):{next:r(Fi)}}if(l("Symbol",function(Fi){function Gi(H,Wt){this.A=H,i(this,"description",{configurable:!0,writable:!0,value:Wt})}if(Fi)return Fi;Gi.prototype.toString=function(){return this.A};var _d="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Di=0;return function H(Wt){if(this instanceof H)throw new TypeError("Symbol is not a constructor");return new Gi(_d+(Wt||"")+"_"+Di++,Wt)}}),l("Symbol.iterator",function(Fi){if(Fi)return Fi;Fi=Symbol("Symbol.iterator");for(var Gi="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),_d=0;_d<Gi.length;_d++){var Di=s[Gi[_d]];typeof Di=="function"&&typeof Di.prototype[Fi]!="function"&&i(Di.prototype,Fi,{configurable:!0,writable:!0,value:function(){return d(r(this))}})}return Fi}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var p;t:{var f={};try{f.__proto__={a:!0},p=f.a;break t}catch{}p=!1}o=p?function(Fi,Gi){if(Fi.__proto__=Gi,Fi.__proto__!==Gi)throw new TypeError(Fi+" is not extensible");return Fi}:null}var _=o;function g(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function b(Fi){if(Fi.m)throw new TypeError("Generator is already running");Fi.m=!0}function C(Fi,Gi){return Fi.h=3,{value:Gi}}function k(Fi){this.g=new g,this.G=Fi}function A(Fi,Gi,_d,Di){try{var H=Gi.call(Fi.g.j,_d);if(!(H instanceof Object))throw new TypeError("Iterator result "+H+" is not an object");if(!H.done)return Fi.g.m=!1,H;var Wt=H.value}catch(_e){return Fi.g.j=null,Fi.g.s(_e),P(Fi)}return Fi.g.j=null,Di.call(Fi.g,Wt),P(Fi)}function P(Fi){for(;Fi.g.h;)try{var Gi=Fi.G(Fi.g);if(Gi)return Fi.g.m=!1,{value:Gi.value,done:!1}}catch(_d){Fi.g.v=void 0,Fi.g.s(_d)}if(Fi.g.m=!1,Fi.g.l){if(Gi=Fi.g.l,Fi.g.l=null,Gi.F)throw Gi.D;return{value:Gi.return,done:!0}}return{value:void 0,done:!0}}function x(Fi){this.next=function(Gi){return Fi.o(Gi)},this.throw=function(Gi){return Fi.s(Gi)},this.return=function(Gi){return function(_d,Di){b(_d.g);var H=_d.g.j;return H?A(_d,"return"in H?H.return:function(Wt){return{value:Wt,done:!0}},Di,_d.g.return):(_d.g.return(Di),P(_d))}(Fi,Gi)},this[Symbol.iterator]=function(){return this}}function j(Fi,Gi){return Gi=new x(new k(Gi)),_&&Fi.prototype&&_(Gi,Fi.prototype),Gi}if(g.prototype.o=function(Fi){this.v=Fi},g.prototype.s=function(Fi){this.l={D:Fi,F:!0},this.h=this.C||this.u},g.prototype.return=function(Fi){this.l={return:Fi},this.h=this.u},k.prototype.o=function(Fi){return b(this.g),this.g.j?A(this,this.g.j.next,Fi,this.g.o):(this.g.o(Fi),P(this))},k.prototype.s=function(Fi){return b(this.g),this.g.j?A(this,this.g.j.throw,Fi,this.g.o):(this.g.s(Fi),P(this))},l("Array.prototype.entries",function(Fi){return Fi||function(){return function(Gi,_d){Gi instanceof String&&(Gi+="");var Di=0,H=!1,Wt={next:function(){if(!H&&Di<Gi.length){var _e=Di++;return{value:_d(_e,Gi[_e]),done:!1}}return H=!0,{done:!0,value:void 0}}};return Wt[Symbol.iterator]=function(){return Wt},Wt}(this,function(Gi,_d){return[Gi,_d]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var z=function(Fi,Gi){for(var _d=0;_d<Fi.length;_d++)Gi(Fi[_d])},_t=function(Fi){return Fi.replace(/\r?\n|\r/g,`\r
`)},ue=function(Fi,Gi,_d){return Gi instanceof Blob?(_d=_d!==void 0?_d+"":typeof Gi.name=="string"?Gi.name:"blob",Gi.name===_d&&Object.prototype.toString.call(Gi)!=="[object Blob]"||(Gi=new File([Gi],_d)),[String(Fi),Gi]):[String(Fi),String(Gi)]},_n=function(Fi,Gi){if(Fi.length<Gi)throw new TypeError(Gi+" argument required, but only "+Fi.length+" present.")},Ei=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,_s=Ei.FormData,kc=Ei.XMLHttpRequest&&Ei.XMLHttpRequest.prototype.send,_i=Ei.Request&&Ei.fetch,_h=Ei.navigator&&Ei.navigator.sendBeacon,_p=Ei.Element&&Ei.Element.prototype,Qm=Ei.Symbol&&Symbol.toStringTag;Qm&&(Blob.prototype[Qm]||(Blob.prototype[Qm]="Blob"),"File"in Ei&&!File.prototype[Qm]&&(File.prototype[Qm]="File"));try{new File([],"")}catch{Ei.File=function(Gi,_d,Di){return Gi=new Blob(Gi,Di||{}),Object.defineProperties(Gi,{name:{value:_d},lastModified:{value:+(Di&&Di.lastModified!==void 0?new Date(Di.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Qm&&Object.defineProperty(Gi,Qm,{value:"File"}),Gi}}var _o=function(Fi){return Fi.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},ga=function(Fi){this.i=[];var Gi=this;Fi&&z(Fi.elements,function(_d){if(_d.name&&!_d.disabled&&_d.type!=="submit"&&_d.type!=="button"&&!_d.matches("form fieldset[disabled] *"))if(_d.type==="file"){var Di=_d.files&&_d.files.length?_d.files:[new File([],"",{type:"application/octet-stream"})];z(Di,function(H){Gi.append(_d.name,H)})}else _d.type==="select-multiple"||_d.type==="select-one"?z(_d.options,function(H){!H.disabled&&H.selected&&Gi.append(_d.name,H.value)}):_d.type==="checkbox"||_d.type==="radio"?_d.checked&&Gi.append(_d.name,_d.value):(Di=_d.type==="textarea"?_t(_d.value):_d.value,Gi.append(_d.name,Di))})};if((e=ga.prototype).append=function(Fi,Gi,_d){_n(arguments,2),this.i.push(ue(Fi,Gi,_d))},e.delete=function(Fi){_n(arguments,1);var Gi=[];Fi=String(Fi),z(this.i,function(_d){_d[0]!==Fi&&Gi.push(_d)}),this.i=Gi},e.entries=function Fi(){var Gi,_d=this;return j(Fi,function(Di){if(Di.h==1&&(Gi=0),Di.h!=3)return Gi<_d.i.length?Di=C(Di,_d.i[Gi]):(Di.h=0,Di=void 0),Di;Gi++,Di.h=2})},e.forEach=function(Fi,Gi){_n(arguments,1);for(var _d=h(this),Di=_d.next();!Di.done;Di=_d.next()){var H=h(Di.value);Di=H.next().value,H=H.next().value,Fi.call(Gi,H,Di,this)}},e.get=function(Fi){_n(arguments,1);var Gi=this.i;Fi=String(Fi);for(var _d=0;_d<Gi.length;_d++)if(Gi[_d][0]===Fi)return Gi[_d][1];return null},e.getAll=function(Fi){_n(arguments,1);var Gi=[];return Fi=String(Fi),z(this.i,function(_d){_d[0]===Fi&&Gi.push(_d[1])}),Gi},e.has=function(Fi){_n(arguments,1),Fi=String(Fi);for(var Gi=0;Gi<this.i.length;Gi++)if(this.i[Gi][0]===Fi)return!0;return!1},e.keys=function Fi(){var Gi,_d,Di,H,Wt=this;return j(Fi,function(_e){if(_e.h==1&&(Gi=h(Wt),_d=Gi.next()),_e.h!=3)return _d.done?void(_e.h=0):(Di=_d.value,H=h(Di),C(_e,H.next().value));_d=Gi.next(),_e.h=2})},e.set=function(Fi,Gi,_d){_n(arguments,2),Fi=String(Fi);var Di=[],H=ue(Fi,Gi,_d),Wt=!0;z(this.i,function(_e){_e[0]===Fi?Wt&&(Wt=!Di.push(H)):Di.push(_e)}),Wt&&Di.push(H),this.i=Di},e.values=function Fi(){var Gi,_d,Di,H,Wt=this;return j(Fi,function(_e){if(_e.h==1&&(Gi=h(Wt),_d=Gi.next()),_e.h!=3)return _d.done?void(_e.h=0):(Di=_d.value,(H=h(Di)).next(),C(_e,H.next().value));_d=Gi.next(),_e.h=2})},ga.prototype._asNative=function(){for(var Fi=new _s,Gi=h(this),_d=Gi.next();!_d.done;_d=Gi.next()){var Di=h(_d.value);_d=Di.next().value,Di=Di.next().value,Fi.append(_d,Di)}return Fi},ga.prototype._blob=function(){var Fi="----formdata-polyfill-"+Math.random(),Gi=[],_d="--"+Fi+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Di,H){return typeof Di=="string"?Gi.push(_d+_o(_t(H))+`"\r
\r
`+_t(Di)+`\r
`):Gi.push(_d+_o(_t(H))+'"; filename="'+_o(Di.name)+`"\r
Content-Type: `+(Di.type||"application/octet-stream")+`\r
\r
`,Di,`\r
`)}),Gi.push("--"+Fi+"--"),new Blob(Gi,{type:"multipart/form-data; boundary="+Fi})},ga.prototype[Symbol.iterator]=function(){return this.entries()},ga.prototype.toString=function(){return"[object FormData]"},_p&&!_p.matches&&(_p.matches=_p.matchesSelector||_p.mozMatchesSelector||_p.msMatchesSelector||_p.oMatchesSelector||_p.webkitMatchesSelector||function(Fi){for(var Gi=(Fi=(this.document||this.ownerDocument).querySelectorAll(Fi)).length;0<=--Gi&&Fi.item(Gi)!==this;);return-1<Gi}),Qm&&(ga.prototype[Qm]="FormData"),kc){var vf=Ei.XMLHttpRequest.prototype.setRequestHeader;Ei.XMLHttpRequest.prototype.setRequestHeader=function(Fi,Gi){vf.call(this,Fi,Gi),Fi.toLowerCase()==="content-type"&&(this.B=!0)},Ei.XMLHttpRequest.prototype.send=function(Fi){Fi instanceof ga?(Fi=Fi._blob(),this.B||this.setRequestHeader("Content-Type",Fi.type),kc.call(this,Fi)):kc.call(this,Fi)}}_i&&(Ei.fetch=function(Fi,Gi){return Gi&&Gi.body&&Gi.body instanceof ga&&(Gi.body=Gi.body._blob()),_i.call(this,Fi,Gi)}),_h&&(Ei.navigator.sendBeacon=function(Fi,Gi){return Gi instanceof ga&&(Gi=Gi._asNative()),_h.call(this,Fi,Gi)}),Ei.FormData=ga}})();var IL=()=>{let e=_r("AREAS");return e.length===0&&e.push(xE.GLOBAL),QT(e).call(e,(r,i,o)=>{let s=Gst(i);return s?o===0?s:"".concat(r,",").concat(s):r},"")},Gst=e=>e===xE.OVERSEA?"".concat(h0.ASIA,",").concat(h0.EUROPE,",").concat(h0.AFRICA,",").concat(h0.NORTH_AMERICA,",").concat(h0.SOUTH_AMERICA,",").concat(h0.OCEANIA):h0[e],bRt=e=>{let r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{let o=EV[i],s=Object.keys(o);s&&s.map(l=>{l!=="CODE"&&(r[l]=r[l].concat(o[l]))})}),r},VU={GLOBAL:{ASIA:[xE.CHINA,xE.JAPAN,xE.INDIA,xE.KOREA,xE.HKMC],EUROPE:[],NORTH_AMERICA:[xE.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},iU=Object.keys(VU[xE.GLOBAL]),X6=[xE.CHINA,xE.NORTH_AMERICA,xE.EUROPE,xE.ASIA,xE.JAPAN,xE.INDIA,xE.OCEANIA,xE.SOUTH_AMERICA,xE.AFRICA,xE.KOREA,xE.HKMC,xE.US],RRt=function(e,r){let i=[];if(nE(e).call(e,xE.GLOBAL)){let l=[xE.GLOBAL,xE.OVERSEA],d=Object.keys(EV);if(r===xE.GLOBAL)throw new _a(Vt.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===xE.CHINA)i=[xE.OVERSEA];else if(s=r,nE(iU).call(iU,s)){let h=(o=r,VU[xE.GLOBAL][o]||[]),p=[...l,r,...h];i=d.filter(f=>!nE(p).call(p,f))}else if(function(h){let p=!1;return iU.forEach(f=>{var _;nE(_=VU[xE.GLOBAL][f]).call(_,h)&&(p=!0)}),p}(r)){let h=function(f){let _;return iU.forEach(g=>{var b;nE(b=VU[xE.GLOBAL][g]).call(b,f)&&(_=g)}),_}(r),p=[...l,h,r];i=d.filter(f=>!nE(p).call(p,f))}else i=e;i=function(h){let p=[];return X6.forEach(f=>{nE(h).call(h,f)&&p.push(f)}),p.concat(h.filter(f=>!nE(X6).call(X6,f)))}(i)}else i=e;var o,s;return i};function Ttt(e){var r,i;if(!e&&nE(r=_r("AREAS")).call(r,xE.EXTENSIONS))return B.debug("update area from ap : reset"),void hH(sTt,!0);if(!nE(i=_r("AREAS")).call(i,xE.GLOBAL)||!e)return;let o=EV.EXTENSIONS;o&&(o={CODE:Gst(xE.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},B.debug("update area from ap success: ".concat(e,",config is "),o),WE("AREAS",[xE.EXTENSIONS],!0),Object.keys(o).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?WE(s,o[s][0]):WE(s,o[s])}))}function hH(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1],i=aE.reportApiInvoke(null,{name:L_.SET_AREA,options:e,tag:p_.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(l=>{if(!nE(cZ).call(cZ,l))throw new _a(Vt.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:l,excludedArea:d}=e;if(!l)throw new _a(Vt.INVALID_PARAMS,"area code is needed");let h=l;typeof l=="string"&&(h=[l]),o=d?RRt(h,d):h}if(!r){if(BI.AREAS){let l=new _a(Vt.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(l),void B.warning("setArea is prohibited because of config-distribute")}if(nE(o).call(o,xE.GLOBAL)&&_r("AREAS")===xE.EXTENSIONS){let l=new _a(Vt.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(l),void B.warning("setArea is prohibited because of ap extensions")}}WE("AREAS",o,r);let s=bRt(o);Object.keys(s).map(l=>{l==="LOG_UPLOAD_SERVER"||l==="EVENT_REPORT_DOMAIN"||l==="EVENT_REPORT_BACKUP_DOMAIN"||l==="PROXY_SERVER_TYPE3"?WE(l,s[l][0]):WE(l,s[l])}),B.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function btt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function I3(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?btt(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):btt(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Q6=1;function wRt(e,r,i,o,s){Q6+=1;let l={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:Q6,requestId:Q6,version:XS,cname:i.cname},d={service_name:r,json_body:JSON.stringify(l)},h,p,f=e[0];return $T(async()=>{h=Date.now();let _=await _b(f,{data:d,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(p=Date.now()-h,_.code!==0){let C=new _a(Vt.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:p});throw B.error(C.toString()),C}let g=JSON.parse(_.json_body);if(g.code!==200){let C=new _a(Vt.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(g.code,", reason: ").concat(g.reason),{code:g.code,responseTime:p});throw B.error(C.toString()),C}if(!g.servers||g.servers.length===0){let C=new _a(Vt.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:g.code,responseTime:p});throw B.error(C.toString()),C}let b=function(C,k){return{addressList:C.servers.map(A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(_r("WORKER_DOMAIN"),":").concat(A.wss,"?serviceName=").concat(encodeURIComponent(k))),workerToken:C.workerToken,vid:C.vid}}(g,r);return _r("LIVE_STREAMING_ADDRESS")&&(b.addressList=_r("LIVE_STREAMING_ADDRESS")instanceof Array?_r("LIVE_STREAMING_ADDRESS"):[_r("LIVE_STREAMING_ADDRESS")]),I3(I3({},b),{},{responseTime:p})},(_,g)=>(aE.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(_.addressList),firstSuccess:g===0,responseTime:p,serverIp:e[g%e.length]}),!1),(_,g)=>(aE.apworkerEvent(i.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:r,responseTime:p,serverIp:e[g%e.length]}),!!(_.code!==Vt.OPERATION_ABORTED&&_.code!==Vt.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(f=e[(g+1)%e.length],!0)),s)}var Z6=1;function Rtt(e,r,i,o){let{url:s,areaCode:l}=e,{clientId:d,sid:h}=r,p=Date.now(),f,[_,g]=fH(r,l,[w_.CHOOSE_SERVER]),b=I_.networkState;return $T(async()=>{b&&I_.networkState===dS.OFFLINE&&I_.onlineWaiter&&await eE.race([I_.onlineWaiter,_y(o&&o.maxRetryTimeout||N_.maxRetryTimeout)]),b=I_.networkState;let{data:C,headers:k}=await _b(s,{data:_,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);f=k.http3==="1"?1:-1,aE.reportResourceTiming(s,h),qst(C,s,r,p,[w_.CHOOSE_SERVER],f);let A=TL(C,w_.CHOOSE_SERVER);return pH(A),nH(A,s)},C=>(C&&aE.joinChooseServer(h,{lts:p,succ:!0,csAddr:s,opid:g,serverList:C.gatewayAddrs.map(k=>k.address),ec:null,cid:C.cid.toString(),uid:C.uid.toString(),csIp:C.csIp,unilbsServerIds:[w_.CHOOSE_SERVER].toString(),isHttp3:f,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:C.res.detail&&C.res.detail[38]}),!1),C=>C.code!==Vt.OPERATION_ABORTED&&(C.code===Vt.CAN_NOT_GET_GATEWAY_SERVER?C.data.retry:(aE.joinChooseServer(h,{lts:p,succ:!1,csAddr:s,serverList:null,opid:g,ec:C.code,csIp:C.data&&C.data.csIp,unilbsServerIds:[w_.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:b}),isHttp3:f,corssRegionTagReq:r.apRequestDetail}),B.warning("[".concat(d||"sid-".concat(h.slice(0,6)),"] Choose server network error, retry"),C),!0)),o)}function wtt(e,r,i,o){let s,{url:l,areaCode:d,serviceIds:h}=e,p=Date.now(),[f,_]=fH(r,d,h),g;return $T(async()=>{g&&I_.networkState===dS.OFFLINE&&I_.onlineWaiter&&await eE.race([I_.onlineWaiter,_y(o&&o.maxRetryTimeout||N_.maxRetryTimeout)]),g=I_.networkState;let{data:b,headers:C}=await _b(l,{data:f,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=C.http3==="1"?1:-1,aE.reportResourceTiming(l,r.sid),qst(b,l,r,p,h,s);let k=TL(b,w_.CHOOSE_SERVER),A=TL(b,r.cloudProxyServer==="proxy5"?w_.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?w_.CLOUD_PROXY:w_.CLOUD_PROXY_FALLBACK);return pH(k),{gatewayInfo:nH(k,l),proxyInfo:A,url:l}},b=>(b.gatewayInfo&&aE.joinChooseServer(r.sid,{lts:p,succ:!0,csAddr:l,serverList:b.gatewayInfo.gatewayAddrs.map(C=>C.address),ec:null,opid:_,cid:b.gatewayInfo.cid.toString(),uid:b.gatewayInfo.uid.toString(),csIp:b.gatewayInfo.csIp,unilbsServerIds:h.toString(),isHttp3:s,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:b.gatewayInfo.res.detail&&b.gatewayInfo.res.detail[38]}),b.proxyInfo&&aE.joinWebProxyAP(r.sid,{lts:p,sucess:1,apServerAddr:l,turnServerAddrList:b.proxyInfo.addresses.map(C=>C.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:h.toString()}),!1),b=>b.code!==Vt.OPERATION_ABORTED&&(b.code===Vt.CAN_NOT_GET_GATEWAY_SERVER?b.data.retry:(aE.joinWebProxyAP(r.sid,{lts:p,sucess:0,apServerAddr:l,turnServerAddrList:null,errorCode:b.code,eventType:r.cloudProxyServer,unilbsServerIds:h.toString(),extend:JSON.stringify({networkState:g})}),B.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),b),!0)),o)}var qst=(e,r,i,o,s,l)=>{let{sid:d,clientId:h,cloudProxyServer:p}=i,f=[],_=g=>{g.flag===4096?aE.joinChooseServer(d,{lts:o,succ:!1,csAddr:r,opid:e.opid,serverList:null,ec:g.error.message,csIp:g.error.data&&g.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:l,corssRegionTagReq:i.apRequestDetail}):g.flag!==1048576&&g.flag!==4194304&&g.flag!==4194310||aE.joinWebProxyAP(d,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:g.error.code,eventType:p,unilbsServerIds:s.toString()})};if(e.response_body.forEach(g=>{let b=g.buffer.code;if(g.uri===23&&b===0&&!g.buffer.edges_services)if(g.buffer.flag===4194310)B.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),g.buffer.edges_services=[];else{let C={error:new _a(Vt.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:g.buffer.flag};f.push(C),_(C)}if(b!==0){let C=M1(b),k={error:new _a(Vt.CAN_NOT_GET_GATEWAY_SERVER,C.desc,{desc:C.desc,retry:C.retry,csIp:e.detail[502]}),flag:g.buffer.flag};g.buffer.flag===4194310?B.warning(k.error.toString()):f.push(k),_(k)}}),f.length)throw B.warning("[".concat(h||"sid-".concat(d.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(f.map(g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message,", retry: ").concat(g.error.data.retry)).join(" | "))),new _a(Vt.CAN_NOT_GET_GATEWAY_SERVER,f.map(g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message)).join(" | "),{retry:!!f.find(g=>g.error.data.retry),csIp:e.detail[502],desc:[...new Set(f.map(g=>{var b;return g==null||(b=g.error)===null||b===void 0||(b=b.data)===null||b===void 0?void 0:b.desc}).filter(g=>!!g))]})},pH=e=>{var r,i,o,s;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new _a(Vt.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(_r("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((s=e.detail)===null||s===void 0?void 0:s[23])=="string"?Ttt(e.detail[23].toLowerCase()):Ttt()),(r=e.detail)!==null&&r!==void 0&&r[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){let d=e.detail[19],h=d?.split(";");for(let p=0;p<h.length;p++){var l;let f=C0(l=h[p]).call(l);e.addresses[p]&&h&&(e.addresses[p].fingerprint=f)}}if(_r("GATEWAY_ADDRESS")&&_r("GATEWAY_ADDRESS").length>0){B.debug("assign gateway address to",_r("GATEWAY_ADDRESS"));let d=_r("GATEWAY_ADDRESS").map(h=>{var p,f;let _=(p=(f=e.addresses.find(g=>g.ip===h.ip&&g.port===h.port))===null||f===void 0?void 0:f.fingerprint)!==null&&p!==void 0?p:"";return{ip:h.ip,port:h.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:_}});e.addresses=d}},IRt=(e,r)=>{if(e.response_body&&e.response_body.length){let i=e.response_body[0];if(i.buffer.code!==0){let o=M1(i.buffer.code);throw new _a(Vt.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw B.debug("update ticket request received ap response without response body:",r),new _a(Vt.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},fH=(e,r,i)=>{let o=Math.floor(Math.random()*1e12),s={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:I3(I3({6:e.stringUid,11:r,12:_r("USE_NEW_TOKEN")?"1":void 0,22:r},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};s.request_bodies.forEach(d=>{e.multiIP&&e.multiIP.gateway_ip&&(d.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let l=new FormData;return l.append("request",JSON.stringify(s)),[l,o]},CRt=(e,r)=>{let i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:r,uid:e.uid||0,edges_services:e.apResponse.addresses.map(l=>({ip:l.ip,port:l.port}))}}]},s=new FormData;return s.append("request",JSON.stringify(o)),[s,i]},A1=0;function nP(e){return eE.all(e.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}var CL=async e=>{let{fragementLength:r,referenceList:i,asyncMapHandler:o,allFailedhandler:s,promisesCollector:l}=e,d=0,h=r,p,f=0,_=async()=>{let g=(()=>{let b=d*h,C=b+h;return i.slice(b,C).map(o)})();l&&l.push(...g);try{p=await nP(g)}catch(b){if(f+=h,d++,!(f>=i.length))return void await _();s(b)}g.forEach(b=>b.cancel())};return await _(),p},Wst=async e=>{let{referenceList:r,asyncMapHandler:i,closeFn:o}=e,s=r.length,l=0,d=async()=>{let h=i(r.shift());try{return await h}catch(p){if(l++,l>=s||o!=null&&o(p))throw p;return d()}};return d()};async function q8(e,r,i,o){return{gatewayInfo:await async function(l,d,h,p){let f=null,_=[],g=async()=>{let C=_r("WEBCS_DOMAIN").slice(0,_r("AJAX_REQUEST_CONCURRENT")).map(P=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(P+"/api/v2/transpond/webrtc?v=2"):"https://".concat(P,"/api/v2/transpond/webrtc?v=2"),areaCode:IL()})),k=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(P=>P.url)}),A=await CL({fragementLength:_r("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:P=>(B.debug("[".concat(l.clientId,"] Connect to choose_server:"),P.url),Rtt(P,l,d,h)),allFailedhandler:P=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},k),P[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},k),A},b=async()=>{if(await _y(1e3),f!==null)return f;let C=_r("WEBCS_DOMAIN_BACKUP_LIST").map(P=>({url:l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(P+"/api/v2/transpond/webrtc?v=2"):"https://".concat(P,"/api/v2/transpond/webrtc?v=2"),areaCode:IL()})),k=p.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(P=>P.url)}),A=await CL({fragementLength:_r("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:P=>(B.debug("[".concat(l.clientId,"] Connect to backup choose_server:"),P.url),Rtt(P,l,d,h)),allFailedhandler:P=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},k),P[0]},promisesCollector:_});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},k),A};try{return f=await nP([g(),b()]),_.length&&_.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),f}catch(C){throw C[0]}}(e,r,i,o)}}async function Itt(e,r,i,o,s){let l=e.cloudProxyServer;if(l==="disabled"){if(!o)return;if(e.useLocalAccessPoint)return await q8(e,r,i,s);if(_r("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:b,proxyInfo:C}=await Att(e,r,i,s);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:b};let k=C.map(A=>({turnServerURL:A.address,tcpport:A.tcpport||i0.tcpport,udpport:A.udpport||i0.udpport,username:A.username||i0.username,password:A.password||i0.password,forceturn:!1,security:!0}));if(s.useP2P){var d;let A=(d=e.uid)!==null&&d!==void 0?d:b.uid,P="glb:".concat(A.toString()),x=await y8(P),j=C.map(z=>({turnServerURL:z.address,tcpport:z.tcpport||i0.tcpport,udpport:z.udpport||i0.udpport,username:P,password:x,forceturn:!1,security:!0}));k.push(...j)}return e.turnServer={mode:"manual",servers:k},{gatewayInfo:b}}return await q8(e,r,i,s)}let{proxyInfo:h,gatewayInfo:p}=await Att(e,r,i,s),f={gatewayInfo:p},_=h.map(b=>({turnServerURL:b.address,tcpport:l==="proxy3"?void 0:b.tcpport?b.tcpport:i0.tcpport,udpport:l==="proxy4"?void 0:b.udpport?b.udpport:i0.udpport,username:b.username||i0.username,password:b.password||i0.password,forceturn:l!=="proxy4",security:l==="proxy5"}));if(s.useP2P){var g;let b=(g=e.uid)!==null&&g!==void 0?g:p.uid,C="glb:".concat(b.toString()),k=await y8(C),A=h.map(P=>({turnServerURL:P.address,tcpport:l==="proxy3"?void 0:P.tcpport||i0.tcpport,udpport:l==="proxy4"?void 0:P.udpport||i0.udpport,username:C,password:k,forceturn:l!=="proxy4",security:l==="proxy5"}));_.push(...A)}return e.turnServer={mode:"manual",servers:_},B.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(l)),f}async function Hst(e,r,i,o,s){let l=_r("ACCOUNT_REGISTER").slice(0,_r("AJAX_REQUEST_CONCURRENT")),d=[];d=r.proxyServer?l.map(p=>"https://".concat(r.proxyServer,"/ap/?url=").concat(p+"/api/v1")):l.map(p=>"https://".concat(p,"/api/v1"));let h=s?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:d});try{let p=await async function(f,_,g,b,C){let k=Date.now(),A={sid:g.sid,opid:10,appid:g.appId,string_uid:_},P=f[0],x=await $T(()=>_b(P+"".concat(P.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:b,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(j,z)=>{if(j.code===0){if(j.uid<=0||j.uid>=Math.pow(2,32))throw B.error("Invalid Uint Uid ".concat(_," => ").concat(j.uid),j),aE.reqUserAccount(A.sid,{lts:k,success:!1,serverAddr:P,stringUid:A.string_uid,uid:j.uid,errorCode:Vt.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new _a(Vt.INVALID_UINT_UID_FROM_STRING_UID);return aE.reqUserAccount(A.sid,{lts:k,success:!0,serverAddr:P,stringUid:A.string_uid,uid:j.uid,errorCode:null,extend:A}),!1}let _t=M1(j.code);return _t.retry&&(P=f[(z+1)%f.length]),aE.reqUserAccount(A.sid,{lts:k,success:!1,serverAddr:P,stringUid:A.string_uid,uid:j.uid,errorCode:_t.desc,extend:A}),_t.retry},(j,z)=>j.code!==Vt.OPERATION_ABORTED&&(aE.reqUserAccount(A.sid,{lts:k,success:!1,serverAddr:P,stringUid:A.string_uid,uid:null,errorCode:j.code,extend:A}),P=f[(z+1)%f.length],!0),C);if(x.code!==0){let j=M1(x.code);throw new _a(Vt.UNEXPECTED_RESPONSE,j.desc)}return x}(d,e,r,i,o);return s?.recordJoinChannelService({status:"success",endTs:Date.now()},h),p.uid}catch(p){throw s?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[p]},h),p}}async function ARt(e,r,i){let o=_r("ACCOUNT_REGISTER"),s=[];s=r.proxyServer?o.map(l=>"https://".concat(r.proxyServer,"/ap/?url=").concat(l+"/api/v1")):o.map(l=>"https://".concat(l,"/api/v1"));try{return await Wst({referenceList:s,asyncMapHandler:d=>async function(h,p,f,_){let g=Date.now(),b={sid:f.sid,opid:10,appid:f.appId,string_uid:p};try{let C=await _b(h+"".concat(h.indexOf("?")===-1?"?":"&","action=stringuid"),{data:b,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(C.code!==0){let k=M1(C.code);throw new _a(Vt.UNEXPECTED_RESPONSE,"preload sua error:".concat(k.desc),k)}if(C.uid<=0||C.uid>=Math.pow(2,32))throw new _a(Vt.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:g,url:h,req:b,uid:C.uid,elapse:Date.now()-g}}catch(C){throw C}}(d,e,r,i),closeFn:d=>d.code===Vt.OPERATION_ABORTED||d.code===Vt.UNEXPECTED_RESPONSE&&!d.data.retry})}catch(l){throw l}}async function ORt(e,r,i){let o=_r("CDS_AP").slice(0,_r("AJAX_REQUEST_CONCURRENT")).map(p=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(p+"/api/v1"):"https://".concat(p,"/api/v1?action=config")),s=o.map(p=>function(f,_,g,b){let C=DE(),k={flag:64,cipher_method:0,features:{device:C.name,system:C.os,system_general:navigator.userAgent,vendor:_.appId,version:XS,cname:_.cname,sid:_.sid,session_id:_.sid,detail:"",proxyServer:_.proxyServer}};return $T(()=>_b(f,{data:k,timeout:1e3,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,A=>A.code!==Vt.OPERATION_ABORTED,b)}(p,e,r,i)),l=null,d=null,h={};try{l=await nP(s)}catch(p){if(p.code===Vt.OPERATION_ABORTED)throw p;d=p}if(s.forEach(p=>p.cancel()),aE.reportApiInvoke(e.sid,{name:L_.REQUEST_CONFIG_DISTRIBUTE,options:{error:d,res:l}}).onSuccess(),l&&l.test_tags)try{h=function(p){if(!p.test_tags)return{};let f=p.test_tags,_=Object.keys(f),g={};return _.forEach(b=>{var C;let k=C0(C=b.slice(4)).call(C),A=JSON.parse(f[b])[1];g[k]=A}),g}(l)}catch{}return h}async function Ctt(e,r){let i=_r("WEBCS_DOMAIN").concat(_r("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:IL(),serviceIds:[w_.CHOOSE_SERVER,w_.CLOUD_PROXY_FALLBACK]}));try{return await Wst({referenceList:i,asyncMapHandler:s=>async function(l,d,h){let p,{url:f,areaCode:_,serviceIds:g}=l,b=Date.now(),[C,k]=fH(d,_,g),A=I_.networkState;try{A&&I_.networkState===dS.OFFLINE&&I_.onlineWaiter&&await eE.race([I_.onlineWaiter,_y(N_.maxRetryTimeout)]),A=I_.networkState;let{data:P,headers:x}=await _b(f,{data:C,cancelToken:h,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=x.http3==="1"?1:-1,(ue=>{let _n=[];if(ue.response_body.forEach(Ei=>{let _s=Ei.buffer.code;if(Ei.uri===23&&_s===0&&!Ei.buffer.edges_services)if(Ei.buffer.flag===4194310)Ei.buffer.edges_services=[];else{let kc={error:new _a(Vt.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:ue.detail[502]}),flag:Ei.buffer.flag};_n.push(kc)}if(_s!==0){let kc=M1(_s),_i={error:new _a(Vt.CAN_NOT_GET_GATEWAY_SERVER,kc.desc,{desc:kc.desc,retry:kc.retry,csIp:ue.detail[502]}),flag:Ei.buffer.flag};Ei.buffer.flag===4194310?B.warning(_i.error.toString()):_n.push(_i)}}),_n.length)throw new _a(Vt.CAN_NOT_GET_GATEWAY_SERVER,_n.map(Ei=>"flag: ".concat(Ei.flag,", message: ").concat(Ei.error.message)).join(" | "),{retry:!!_n.find(Ei=>Ei.error.data.retry),csIp:ue.detail[502],desc:[...new Set(_n.map(Ei=>{var _s;return Ei==null||(_s=Ei.error)===null||_s===void 0||(_s=_s.data)===null||_s===void 0?void 0:_s.desc}).filter(Ei=>!!Ei))]})})(P);let z=TL(P,w_.CHOOSE_SERVER),_t=TL(P,w_.CLOUD_PROXY_FALLBACK);return pH(z),{gatewayInfo:nH(z,f),proxyInfo:_t,opid:k,requestTime:b,url:f,isHttp3:p,elapse:Date.now()-b}}catch(P){throw P}}(s,e,r),closeFn:s=>s.code===Vt.OPERATION_ABORTED||s.code===Vt.CAN_NOT_GET_GATEWAY_SERVER&&!s.data.retry})}catch(o){throw o}}async function Att(e,r,i,o){let s=_r("PROXY_SERVER_TYPE3"),l=(C,k,A)=>{let P=A||s;return Array.isArray(P)&&(P=k%2==0?s[1]:s[0]),"https://".concat(P,"/ap/?url=").concat(C)},d=null,h=[],p=async()=>{let C=_r("WEBCS_DOMAIN").slice(0,_r("AJAX_REQUEST_CONCURRENT")).map((P,x)=>{let j;return j=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(P,"/api/v2/transpond/webrtc?v=2"),x,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(P,"/api/v2/transpond/webrtc?v=2"):l("".concat(P,"/api/v2/transpond/webrtc?v=2"),x),{url:j,areaCode:IL(),serviceIds:[w_.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?w_.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?w_.CLOUD_PROXY:w_.CLOUD_PROXY_FALLBACK]}}),k=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(P=>P.url)}),A=await CL({fragementLength:_r("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:P=>(B.debug("[".concat(e.clientId,"] Connect to choose_server:"),P.url),wtt(P,e,r,i)),allFailedhandler:P=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},k),P[0]},promisesCollector:h});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},k),A},f=async()=>{if(await _y(1e3),d!==null)return d;let C=_r("WEBCS_DOMAIN_BACKUP_LIST").map((P,x)=>{let j;return j=e.cloudProxyServer==="disabled"&&e.proxyServer?l("".concat(P,"/api/v2/transpond/webrtc?v=2"),x,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(P,"/api/v2/transpond/webrtc?v=2"):l("".concat(P,"/api/v2/transpond/webrtc?v=2"),x),{url:j,areaCode:IL(),serviceIds:[w_.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?w_.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?w_.CLOUD_PROXY:w_.CLOUD_PROXY_FALLBACK]}}),k=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:C.map(P=>P.url)}),A=await CL({fragementLength:_r("FRAGEMENT_LENGTH"),referenceList:C,asyncMapHandler:P=>(B.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),P.url),wtt(P,e,r,i)),allFailedhandler:P=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:P},k),P[0]},promisesCollector:h});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},k),A},_,g,b;try{({gatewayInfo:_,proxyInfo:g,url:b}=await nP([p(),f()]))}catch(C){throw C[0]}if(h.length&&h.forEach(C=>C.cancel&&typeof C.cancel=="function"&&C.cancel()),!_||!g)throw new _a(Vt.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=b,e.cloudProxyServer!=="disabled"&&Array.isArray(s)&&b){let C=/^https?:\/\/(.+?)(\/.*)?$/.exec(b)[1];nE(s).call(s,C)&&(e.proxyServer=C,B.setProxyServer(C),aE.setProxyServer(C))}return d={gatewayInfo:_,proxyInfo:await hst(g,_.uid)},d}async function NRt(e,r,i){let o=_r("UAP_AP").slice(0,_r("AJAX_REQUEST_CONCURRENT")).map(l=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(l+"/api/v1?action=uap"):"https://".concat(l,"/api/v1?action=uap")),s=o.map(l=>function(d,h,p,f){let _={command:"convergeAllocateEdge",sid:h.sid,appId:h.appId,token:h.token,ts:Date.now(),version:XS,cname:h.cname,uid:h.uid.toString(),requestId:Z6,seq:Z6};Z6+=1;let g={service_name:"tele_channel",json_body:JSON.stringify(_)};return $T(async()=>{let b=await _b(d,{data:g,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(b.code!==0){let k=new _a(Vt.UNEXPECTED_RESPONSE,"cross channel ap error, code"+b.code,{retry:!0});throw B.error(k.toString()),k}let C=JSON.parse(b.json_body);if(C.code!==200){let k=new _a(Vt.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(C.code,", reason: ").concat(C.reason));throw B.error(k.toString()),k}if(!C.servers||C.servers.length===0){let k=new _a(Vt.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw B.error(k.toString()),k}return{vid:C.vid,workerToken:C.workerToken,addressList:(_r("CHANNEL_MEDIA_RELAY_SERVERS")||C.servers).map(k=>"wss://".concat(k.address.replace(/\./g,"-"),".").concat(_r("WORKER_DOMAIN"),":").concat(k.wss))}},void 0,b=>!!(b.code!==Vt.OPERATION_ABORTED&&b.code!==Vt.UNEXPECTED_RESPONSE||b.data&&b.data.retry),f)}(l,e,r,i));try{let l=await nP(s);return s.forEach(d=>d.cancel()),l}catch(l){throw l[0]}}async function kRt(e,r,i){let o=null,s=[],l=async d=>{let h=_r(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(p=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(p+"/api/v2/transpond/webrtc?v=2"):"https://".concat(p,"/api/v2/transpond/webrtc?v=2"));return d&&(await _y(1e3),o!==null)?o:await CL({fragementLength:_r("FRAGEMENT_LENGTH"),referenceList:h,asyncMapHandler:p=>(B.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(d?"backup":""," choose_server:"),p),function(f,_,g,b){let[C]=CRt(_,[w_.CHOOSE_SERVER]),k=I_.networkState;return $T(async()=>{k&&I_.networkState===dS.OFFLINE&&I_.onlineWaiter&&await eE.race([I_.onlineWaiter,_y(b&&b.maxRetryTimeout||N_.maxRetryTimeout)]),k=I_.networkState;let A=await _b(f,{data:C,cancelToken:g,headers:{"Content-Type":"multipart/form-data;"}},!0);return IRt(A,f)},()=>!1,A=>A.code!==Vt.OPERATION_ABORTED&&(A.code===Vt.UPDATE_TICKET_FAILED?A.data.retry:(B.warning("[".concat(_.clientId,"] update ticket network error, retry"),A),!0)),b)}(p,e,r,i)),allFailedhandler:p=>{throw p[0]},promisesCollector:s})};try{return o=await nP([l(!1),l(!0)]),s.length&&s.forEach(d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),o}catch(d){throw d[0]}}function Ott(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function Ntt(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Ott(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ott(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var W8=class extends s_{get isSuccess(){return!!this.configs}constructor(){super(),$(this,"configs",void 0),$(this,"joinInfo",void 0),$(this,"cancelToken",void 0),$(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),$(this,"interval",void 0),$(this,"mutex",new f0("config-distribute")),$(this,"mutableParamsRead",!1)}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),_r("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},_r("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,aE.reportApiInvoke(null,{options:void 0,name:L_.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:p_.TRACER}).onSuccess(JSON.stringify(BI))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void B.debug("[config-distribute] get config distribute interrupted have no joininfo");let r,i=await this.mutex.lock();try{r=await ORt(this.joinInfo,this.cancelToken,this.retryConfig),B.debug("[config-distribute] get config distribute",JSON.stringify(r)),r.limit_bitrate&&this.handleBitrateLimit(r.limit_bitrate),this.cacheGlobalParameterConfig(r),this.configs=r}catch(o){let s=new _a(Vt.NETWORK_RESPONSE_ERROR,o);B.warning("[config-distribute] ".concat(s.toString()))}finally{i()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(r){var i;(i=r)&&i.uplink&&i.id&&i.uplink.max_bitrate!==void 0&&i.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==r.id&&this.emit(C8.UPDATE_BITRATE_LIMIT,r):this.emit(C8.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&Ntt({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(r){var i;let o=HL(i=Object.keys(r).filter(l=>/^webrtc_ng_global_parameter/.test(l))).call(i);for(let l=0;l<o.length;l++)for(let d=o.length-1;d>l;d--){let h=o[d];if(typeof r[h].__priority=="number"){let p=r[h].__priority,f=o[d-1];if(typeof r[f].__priority=="number"){if(!(p>r[f].__priority))continue;{let _=h;o[d]=o[d-1],o[d-1]=_}}else{let _=h;o[d]=o[d-1],o[d-1]=_}}}let s={};o.forEach(l=>{let d=r[l],h=d.__expires;Object.keys(d).forEach(p=>{p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=Ntt({value:d[p]},h&&{expires:h}))})});try{(function(h){try{let p=Date.now();Object.keys(h).forEach(f=>{switch(f){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(y_,f)){let{value:_,expires:g}=h[f];if(g&&g<=p)return;BI[f]=_,y_[f]=_,B.debug("Update global parameters from config distribute",f,_)}}})}catch(p){B.error("Error update config immediately: ".concat(h),p.message)}})(s);let l=JSON.stringify(s),d=window.btoa(l);window.localStorage.setItem("websdk_ng_global_parameter",d),B.debug("Caching global parameters ".concat(l))}catch(l){B.error("Error caching global parameters:",l.message)}}},H8=class extends s_{constructor(){super(...arguments),$(this,"resultStorage",new Map)}setLocalAudioStats(r,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(r,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,i){let o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){let o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(r,i,o){if(_r("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});let s=this.resultStorage.get(r);if(s&&(s.result.push(o),s.result.length>=5)){var l;let d=nE(l=s.result).call(l,!0);s.isPrevNormal&&!d&&this.emit("exception",ktt[r],r,i),!s.isPrevNormal&&d&&this.emit("exception",ktt[r]+2e3,r+"_RECOVER",i),s.isPrevNormal=d,s.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,i){return i instanceof D_&&!i.isActive||!!i.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=pS(i._encoderConfig.frameRate));let s=r.captureFrameRate;return!o||!s||!(o>10&&s<5||o<10&&o>=5&&s<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,i){return!!i.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,i){return i instanceof D_&&!i.isActive||!!i.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}},ktt={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},p0=new class{markSubscribeStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(r))}markPublishStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(r))}measureFromSubscribeStart(e,r){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(r));if(i.length>0){let o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,r){let i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(r));if(i.length>0){let o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}},Ptt=m_(ZS.Object.getOwnPropertySymbols),PRt=zE,DRt=mW.indexOf,LRt=K3,K8=lL([].indexOf),Dtt=!!K8&&1/K8([1],1,-0)<0;PRt({target:"Array",proto:!0,forced:Dtt||!LRt("indexOf")},{indexOf:function(e){var r=arguments.length>1?arguments[1]:void 0;return Dtt?K8(this,e,r)||0:DRt(this,e,r)}});var MRt=CT("Array").indexOf,URt=j0,xRt=MRt,$6=Array.prototype,jRt=function(e){var r=e.indexOf;return e===$6||URt($6,e)&&r===$6.indexOf?xRt:r},Ltt=m_(jRt);function VRt(e,r){if(e==null)return{};var i,o,s=function(d,h){if(d==null)return{};var p,f,_={},g=ust(d);for(f=0;f<g.length;f++)p=g[f],Ltt(h).call(h,p)>=0||(_[p]=d[p]);return _}(e,r);if(Ptt){var l=Ptt(e);for(o=0;o<l.length;o++)i=l[o],Ltt(r).call(r,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(s[i]=e[i])}return s}function ST(e){if(Array.isArray(e))return e.map(i=>i);if(!Mtt(e))return e;let r={};for(let i in e){let o=e[i];Mtt(o)||Array.isArray(o)?r[i]=ST(o):r[i]=o}return r}function Mtt(e){return!(typeof e!="object"||Array.isArray(e)||!e)}var tL=class{constructor(r){$(this,"input",[]),$(this,"size",void 0),this.size=r}add(r){this.input.push(r),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},IR={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},AL={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:IR,remoteCandidate:IR}},Kst={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},zst={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},Yst={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},Jst={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function Utt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function xtt(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Utt(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Utt(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var OL=class{constructor(r,i){$(this,"onFirstVideoReceived",void 0),$(this,"onFirstVideoDecoded",void 0),$(this,"onFirstAudioReceived",void 0),$(this,"onFirstVideoDecodedTimeout",void 0),$(this,"onFirstAudioDecoded",void 0),$(this,"onSelectedLocalCandidateChanged",void 0),$(this,"onSelectedRemoteCandidateChanged",void 0),$(this,"videoIsReady",!1),$(this,"videoIsReady2",{}),$(this,"pc",void 0),$(this,"options",void 0),$(this,"intervalTimer",void 0),$(this,"stats",ST(AL)),$(this,"isFirstVideoReceived",{}),$(this,"isFirstVideoDecoded",{}),$(this,"isFirstAudioReceived",{}),$(this,"isFirstAudioDecoded",{}),$(this,"isFirstVideoDecodedTimeout",{}),$(this,"lossRateWindowStats",[]),this.pc=r,this.options=i,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new eE(r=>{r({local:xtt({},IR),remote:xtt({},IR)})})}setVideoIsReady(r){this.videoIsReady=r}setVideoIsReady2(r,i){this.videoIsReady2[r]=i}getVideoIsReady(r){return this.videoIsReady2[r]||!1}setIsFirstAudioDecoded(r){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(r){this.lossRateWindowStats.push(r),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let i=this.lossRateWindowStats.length,o=["videoSend","audioSend","videoRecv","audioRecv"],s=0,l=0,d=0,h=0;for(let p of o)r[p].forEach((f,_)=>{if(!this.lossRateWindowStats[i-1][p][_]||!this.lossRateWindowStats[0][p][_])return;let g=this.lossRateWindowStats[i-1][p][_].packets-this.lossRateWindowStats[0][p][_].packets,b=this.lossRateWindowStats[i-1][p][_].packetsLost-this.lossRateWindowStats[0][p][_].packetsLost;p==="videoSend"||p==="audioSend"?(s+=g,d+=b):(l+=g,h+=b),Number.isNaN(g)||Number.isNaN(g)?f.packetLostRate=0:f.packetLostRate=g<=0||b<=0?0:b/(g+b)});r.sendPacketLossRate=s<=0||d<=0?0:d/(s+d),r.recvPacketLossRate=l<=0||h<=0?0:h/(l+h)}};function jtt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function FRt(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?jtt(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):jtt(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var z8=class extends OL{constructor(){super(...arguments),$(this,"_stats",AL),$(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let r=await this._getStats(),i=this.statsResponsesToObjects(r);this._stats=ST(AL);let o=i.filter(l=>l.type==="ssrc");this.processSSRCStats(o);let s=i.find(l=>l.type==="VideoBwe");s&&this.processBandwidthStats(s),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(r){this._stats.bitrate={actualEncoded:Number(r.googActualEncBitrate),targetEncoded:Number(r.googTargetEncBitrate),retransmit:Number(r.googRetransmitBitrate),transmit:Number(r.googTransmitBitrate)},this._stats.sendBandwidth=Number(r.googAvailableSendBandwidth)}processSSRCStats(r){r.forEach(i=>{var o;let s=nE(o=i.id).call(o,"send");switch("".concat(i.mediaType,"_").concat(s?"send":"recv")){case"video_send":{let l=ST(zst);l.codec=i.googCodecName,l.adaptionChangeReason="none",i.googCpuLimitedResolution&&(l.adaptionChangeReason="cpu"),i.googBandwidthLimitedResolution&&(l.adaptionChangeReason="bandwidth"),l.avgEncodeMs=Number(i.googAvgEncodeMs),l.inputFrame={width:Number(i.googFrameWidthInput)||Number(i.googFrameWidthSent),height:Number(i.googFrameHeightInput)||Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},l.sentFrame={width:Number(i.googFrameWidthSent),height:Number(i.googFrameHeightSent),frameRate:Number(i.googFrameRateInput)},l.firsCount=Number(i.googFirReceived),l.nacksCount=Number(i.googNacksReceived),l.plisCount=Number(i.googPlisReceived),l.frameCount=Number(i.framesEncoded),l.bytes=Number(i.bytesSent),l.packets=Number(i.packetsSent),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.rttMs=Number(i.googRtt||0),this._stats.videoSend.push(l),this._stats.rtt=l.rttMs;break}case"video_recv":{let l=ST(Kst),d=this.lastDecodeVideoReceiverStats.get(Number(i.ssrc));if(l.codec=i.googCodecName,l.targetDelayMs=Number(i.googTargetDelayMs),l.renderDelayMs=Number(i.googRenderDelayMs),l.currentDelayMs=Number(i.googCurrentDelayMs),l.minPlayoutDelayMs=Number(i.googMinPlayoutDelayMs),l.decodeMs=Number(i.googDecodeMs),l.maxDecodeMs=Number(i.googMaxDecodeMs),l.receivedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateReceived)},l.decodedFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateDecoded)},l.decodeFrameRate=Number(i.googFrameRateDecoded),l.outputFrame={width:Number(i.googFrameWidthReceived),height:Number(i.googFrameHeightReceived),frameRate:Number(i.googFrameRateOutput)},l.jitterBufferMs=Number(i.googJitterBufferMs),l.firsCount=Number(i.googFirsSent),l.nacksCount=Number(i.googNacksSent),l.plisCount=Number(i.googPlisSent),l.framesDecodeCount=Number(i.framesDecoded),l.bytes=Number(i.bytesReceived),l.packets=Number(i.packetsReceived),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.packets>0&&!this.isFirstVideoReceived[l.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(l.ssrc),this.isFirstVideoReceived[l.ssrc]=!0),l.framesDecodeCount>0&&!this.isFirstVideoDecoded[l.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(l.ssrc,l.decodedFrame.width,l.decodedFrame.height),this.isFirstVideoDecoded[l.ssrc]=!0),d){let h=d.stats,p=Date.now()-d.lts;l.framesDecodeFreezeTime=h.framesDecodeFreezeTime,l.framesDecodeInterval=h.framesDecodeInterval,l.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[l.ssrc]?(d.lts=Date.now(),l.framesDecodeInterval=p,l.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc,10))?l.framesDecodeFreezeTime+=l.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):l.framesDecodeCount<d.stats.framesDecodeCount&&(l.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(l.ssrc,{stats:FRt({},l),lts:Date.now()}),this._stats.videoRecv.push(l);break}case"audio_recv":{let l=ST(Jst);l.codec=i.googCodecName,l.outputLevel=Math.abs(Number(i.audioOutputLevel))/32767,l.decodingCNG=Number(i.googDecodingCNG),l.decodingCTN=Number(i.googDecodingCTN),l.decodingCTSG=Number(i.googDecodingCTSG),l.decodingNormal=Number(i.googDecodingNormal),l.decodingPLC=Number(i.googDecodingPLC),l.decodingPLCCNG=Number(i.googDecodingPLCCNG),l.expandRate=Number(i.googExpandRate),l.accelerateRate=Number(i.googAccelerateRate),l.preemptiveExpandRate=Number(i.googPreemptiveExpandRate),l.secondaryDecodedRate=Number(i.googSecondaryDecodedRate),l.speechExpandRate=Number(i.googSpeechExpandRate),l.preferredJitterBufferMs=Number(i.googPreferredJitterBufferMs),l.jitterBufferMs=Number(i.googJitterBufferMs),l.jitterMs=Number(i.googJitterReceived),l.bytes=Number(i.bytesReceived),l.packets=Number(i.packetsReceived),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.receivedFrames=Number(i.googDecodingCTN)||Number(i.packetsReceived),l.droppedFrames=Number(i.googDecodingPLC)+Number(i.googDecodingPLCCNG)||Number(i.packetsLost),l.receivedFrames>0&&!this.isFirstAudioReceived[l.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(l.ssrc),this.isFirstAudioReceived[l.ssrc]=!0),l.decodingNormal>0&&!this.isFirstAudioDecoded[l.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(l.ssrc),this.isFirstAudioDecoded[l.ssrc]=!0),this._stats.audioRecv.push(l);break}case"audio_send":{let l=ST(Yst);l.codec=i.googCodecName,l.inputLevel=Math.abs(Number(i.audioInputLevel))/32767,l.aecReturnLoss=Number(i.googEchoCancellationReturnLoss||0),l.aecReturnLossEnhancement=Number(i.googEchoCancellationReturnLossEnhancement||0),l.residualEchoLikelihood=Number(i.googResidualEchoLikelihood||0),l.residualEchoLikelihoodRecentMax=Number(i.googResidualEchoLikelihoodRecentMax||0),l.bytes=Number(i.bytesSent),l.packets=Number(i.packetsSent),l.packetsLost=Number(i.packetsLost),l.ssrc=Number(i.ssrc),l.rttMs=Number(i.googRtt||0),this._stats.rtt=l.rttMs,this._stats.audioSend.push(l);break}}})}_getStats(){return new eE((r,i)=>{this.pc.getStats(r,i)})}statsResponsesToObjects(r){let i=[];return r.result().forEach(o=>{let s={id:o.id,timestamp:o.timestamp.valueOf().toString(),type:o.type};o.names().forEach(l=>{s[l]=o.stat(l)}),i.push(s)}),i}};function Vtt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function CO(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Vtt(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Vtt(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var C3=class extends OL{constructor(){super(...arguments),$(this,"_stats",AL),$(this,"report",void 0),$(this,"lastDecodeVideoReceiverStats",new Map),$(this,"lastVideoFramesRecv",new Map),$(this,"lastVideoFramesSent",new Map),$(this,"lastVideoFramesDecode",new Map),$(this,"lastVideoFramesOutput",new Map),$(this,"lastVideoJBDelay",new Map),$(this,"lastAudioJBDelay",new Map),$(this,"mediaBytesSent",new Map),$(this,"mediaBytesRetransmit",new Map),$(this,"mediaBytesTargetEncode",new Map),$(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=ST(AL),this.report.forEach(r=>{switch(r.type){case yS.OUTBOUND:case yS.INBOUND:{let i=r.mediaType||r.kind,o=!i&&"frameWidth"in r,s=!i&&!("frameWidth"in r);r.type===yS.OUTBOUND?i==="audio"||s?this.processAudioOutboundStats(r):(i==="video"||o)&&this.processVideoOutboundStats(r):r.type===yS.INBOUND&&(i==="audio"||s?this.processAudioInboundStats(r):(i==="video"||o)&&this.processVideoInboundStats(r));break}case yS.TRANSPORT:{let i=this.report.get(r.selectedCandidatePairId);i&&this.processCandidatePairStats(i);break}case yS.CANDIDATE_PAIR:r.selected&&this.processCandidatePairStats(r)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let r=await this.pc.getStats(),i={local:CO({},IR),remote:CO({},IR)};return r.forEach(o=>{let s;if(o.type===yS.TRANSPORT&&(s=r.get(o.selectedCandidatePairId)),o.type===yS.CANDIDATE_PAIR&&o.selected&&(s=o),s){let l=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(s.localCandidateId){let d=r.get(s.localCandidateId);d&&l(i.local,d)}if(s.remoteCandidateId){let d=r.get(s.remoteCandidateId);d&&l(i.remote,d)}}}),i}processCandidatePairStats(r){if(this._stats.sendBandwidth=r.availableOutgoingBitrate||0,r.currentRoundTripTime&&(this._stats.rtt=1e3*r.currentRoundTripTime),this._stats.videoSend.forEach(i=>{r.currentRoundTripTime&&(i.rttMs=1e3*r.currentRoundTripTime)}),this._stats.audioSend.forEach(i=>{r.currentRoundTripTime&&(i.rttMs=1e3*r.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=r.id,r.localCandidateId){let i=this.report.get(r.localCandidateId);i&&this.processCandidateStats(i)}if(r.remoteCandidateId){let i=this.report.get(r.remoteCandidateId);i&&this.processCandidateStats(i)}}processCandidateStats(r){let i;r.type===yS.LOCAL_CANDIDATE&&(i=this._stats.selectedCandidatePair.localCandidate),r.type===yS.REMOTE_CANDIDATE&&(i=this._stats.selectedCandidatePair.remoteCandidate),i&&(i.type=r.type,i.id=r.id,r.address&&(i.address=r.address),r.candidateType&&(i.candidateType=r.candidateType),r.port&&(i.port=r.port),r.priority&&(i.priority=r.priority),r.protocol&&(i.protocol=r.protocol),r.relayProtocol&&(i.relayProtocol=r.relayProtocol),r.type===yS.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==i.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(CO({},i),CO({},this.stats.selectedCandidatePair.localCandidate)),r.type===yS.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==i.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(CO({},i),CO({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(r){let i=this._stats.audioRecv.find(o=>o.ssrc===r.ssrc);i||(i=ST(Jst),this._stats.audioRecv.push(i)),i.ssrc=r.ssrc,i.packets=r.packetsReceived,i.packetsLost=r.packetsLost,i.packetsDiscarded=r.packetsDiscarded,i.bytes=r.bytesReceived,i.jitterMs=1e3*r.jitter,this.processAudioTrackReceiverStats(r,r.trackId,i),r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),i.receivedFrames||(i.receivedFrames=r.packetsReceived),i.droppedFrames||(i.droppedFrames=r.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.outputLevel&&i.outputLevel>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),typeof r.concealedSamples=="number"&&(i.concealedSamples=r.concealedSamples)}processVideoInboundStats(r){let i=this._stats.videoRecv.find(h=>h.ssrc===r.ssrc);i||(i=ST(Kst),this._stats.videoRecv.push(i)),i.ssrc=r.ssrc,i.packets=r.packetsReceived,i.packetsLost=r.packetsLost,i.bytes=r.bytesReceived,i.firsCount=r.firCount,i.nacksCount=r.nackCount,i.plisCount=r.pliCount,i.framesDecodeCount=r.framesDecoded,i.framesDroppedCount=r.framesDropped,i.totalInterFrameDelay=r.totalInterFrameDelay,i.totalSquaredInterFrameDelay=r.totalSquaredInterFrameDelay,i.totalFreezesDuration=r.totalFreezesDuration;let o=this.lastDecodeVideoReceiverStats.get(i.ssrc),s=this.lastVideoFramesDecode.get(i.ssrc),l=this.lastVideoFramesOutput.get(i.ssrc),d=Date.now();if(i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]){let h=i.decodedFrame?i.decodedFrame.width:0,p=i.decodedFrame?i.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,h,p),this.isFirstVideoDecoded[i.ssrc]=!0}if(o){let h=o.stats,p=d-o.lts;i.framesDecodeFreezeTime=h.framesDecodeFreezeTime,i.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[i.ssrc]&&p>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[i.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(i.ssrc),this.isFirstVideoDecodedTimeout[i.ssrc]=!0),i.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(o.lts=Date.now(),i.framesDecodeInterval=p,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):i.framesDecodeCount<h.framesDecodeCount&&(i.framesDecodeInterval=0),r.framesDecoded&&r.qpSum&&(o.stats.framesDecodeCount>r.framesDecoded?i.qpSumPerFrame=r.qpSum/r.framesDecoded:i.qpSumPerFrame=(r.qpSum-o.qpSum)/(r.framesDecoded-o.stats.framesDecodeCount))}s&&d-s.lts>=800?(i.decodeFrameRate=Math.round((i.framesDecodeCount-s.count)/((d-s.lts)/1e3)),this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:d,rate:i.decodeFrameRate})):s?i.decodeFrameRate=s.rate:this.lastVideoFramesDecode.set(i.ssrc,{count:i.framesDecodeCount,lts:d,rate:0}),i.framesDroppedCount&&r.framesReceived&&(l&&d-l.lts>=800?(i.outputFrameRate=Math.round((r.framesReceived-i.framesDroppedCount-l.count)/((d-l.lts)/1e3)),this.lastVideoFramesOutput.set(i.ssrc,{count:r.framesReceived-i.framesDroppedCount,lts:d,rate:Math.max(i.outputFrameRate,0)})):l?i.outputFrameRate=l.rate:this.lastVideoFramesOutput.set(i.ssrc,{count:r.framesReceived-i.framesDroppedCount,lts:d,rate:0})),r.totalDecodeTime&&(i.decodeMs=1e3*r.totalDecodeTime),this.processVideoTrackReceiverStats(r,r.trackId,i),r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),r.framerateMean&&(i.framesRateFirefox=r.framerateMean),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:CO({},i),lts:o?o.lts:Date.now(),qpSum:r.qpSum})}processVideoOutboundStats(r){let i=this._stats.videoSend.find(s=>s.ssrc===r.ssrc);i||(i=ST(zst),this._stats.videoSend.push(i));let o=this.mediaBytesSent.get(r.ssrc);if(o)o.add(r.bytesSent);else{let s=new tL(10);s.add(r.bytesSent),this.mediaBytesSent.set(r.ssrc,s)}if(r.retransmittedBytesSent!==void 0){let s=this.mediaBytesRetransmit.get(r.ssrc);if(s)s.add(r.retransmittedBytesSent);else{let l=new tL(10);l.add(r.retransmittedBytesSent),this.mediaBytesRetransmit.set(r.ssrc,l)}}if(r.totalEncodedBytesTarget){let s=this.mediaBytesTargetEncode.get(r.ssrc);if(s)s.add(r.totalEncodedBytesTarget);else{let l=new tL(10);l.add(r.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(r.ssrc,l)}}if(i.ssrc=r.ssrc,i.bytes=r.bytesSent,i.packets=r.packetsSent,i.firsCount=r.firCount,i.nacksCount=r.nackCount,i.plisCount=r.pliCount,i.frameCount=r.framesEncoded,i.adaptionChangeReason=r.qualityLimitationReason,i.scalabilityMode=r.scalabilityMode,r.totalEncodeTime&&r.framesEncoded){let s=this.lastEncoderMs.get(r.ssrc);if(!s||s.lastFrameCount>r.framesEncoded)i.avgEncodeMs=1e3*r.totalEncodeTime/r.framesEncoded;else{let l=r.framesEncoded-s.lastFrameCount,d=r.totalEncodeTime-s.lastEncoderTime;i.avgEncodeMs=1e3*d/l}}if(r.framesEncoded&&r.qpSum){let s=this.lastEncoderMs.get(r.ssrc);!s||s.lastFrameCount>r.framesEncoded?i.qpSumPerFrame=r.qpSum/r.framesEncoded:i.qpSumPerFrame=(r.qpSum-s.lastQpSum)/(r.framesEncoded-s.lastFrameCount)}if(this.lastEncoderMs.set(r.ssrc,{lastFrameCount:r.framesEncoded,lastEncoderTime:r.totalEncodeTime,lastQpSum:r.qpSum,lts:Date.now()}),r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),r.mediaSourceId&&this.processVideoMediaSource(r.mediaSourceId,i),this.processVideoTrackSenderStats(r,r.trackId,i),r.remoteId)this.processRemoteInboundStats(r.remoteId,i);else{let s=this.findRemoteStatsId(r.ssrc,yS.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,i)}}processAudioOutboundStats(r){let i=this._stats.audioSend.find(o=>o.ssrc===r.ssrc);if(i||(i=ST(Yst),this._stats.audioSend.push(i)),i.ssrc=r.ssrc,i.packets=r.packetsSent,i.bytes=r.bytesSent,r.mediaSourceId&&this.processAudioMediaSource(r.mediaSourceId,i),r.codecId&&(i.codec=this.getCodecFromCodecStats(r.codecId)),this.processAudioTrackSenderStats(r,r.trackId,i),r.remoteId)this.processRemoteInboundStats(r.remoteId,i);else{let o=this.findRemoteStatsId(r.ssrc,yS.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,i)}}findRemoteStatsId(r,i){var o;let s=Array.from(eI(o=this.report).call(o)).find(l=>l.type===i&&l.ssrc===r);return s?s.id:null}processVideoMediaSource(r,i){let o=this.report.get(r);o&&o.width&&o.height&&o.framesPerSecond&&(i.inputFrame={width:o.width,height:o.height,frameRate:o.framesPerSecond})}processAudioMediaSource(r,i){let o=this.report.get(r);o&&(i.inputLevel=o.audioLevel)}processVideoTrackSenderStats(r,i,o){var s,l,d,h;let p=i?this.report.get(i):void 0,f=(s=p?.framesSent)!==null&&s!==void 0?s:r.framesSent;if(typeof f!="number")return;let _=(l=p?.frameWidth)!==null&&l!==void 0?l:r.frameWidth,g=(d=p?.frameHeight)!==null&&d!==void 0?d:r.frameHeight,b=(h=p?.framesPerSecond)!==null&&h!==void 0?h:r.framesPerSecond;if(typeof _=="number"&&typeof g=="number"||(_=0,g=0),b==null){let C=Date.now(),k=this.lastVideoFramesSent.get(o.ssrc);k&&C-k.lts>=800?(b=Math.round((f-k.count)/((C-k.lts)/1e3)),this.lastVideoFramesSent.set(o.ssrc,{count:f,lts:C,rate:b})):k?b=k.rate:this.lastVideoFramesSent.set(o.ssrc,{count:f,lts:C,rate:0})}o.sentFrame={width:_,height:g,frameRate:Math.max(0,b)}}processVideoTrackReceiverStats(r,i,o){var s,l,d,h,p;let f=i?this.report.get(i):void 0,_=(s=f?.framesReceived)!==null&&s!==void 0?s:r.framesReceived,g=(l=f?.frameWidth)!==null&&l!==void 0?l:r.frameWidth,b=(d=f?.frameHeight)!==null&&d!==void 0?d:r.frameHeight,C=(h=f?.jitterBufferDelay)!==null&&h!==void 0?h:r.jitterBufferDelay,k=(p=f?.jitterBufferEmittedCount)!==null&&p!==void 0?p:r.jitterBufferEmittedCount;if(typeof _=="number"){let A=this.lastVideoFramesRecv.get(o.ssrc),P=Date.now();o.framesReceivedCount=_;let x=0;A&&P-A.lts>=800?(x=Math.round((_-A.count)/((P-A.lts)/1e3)),this.lastVideoFramesRecv.set(o.ssrc,{count:_,lts:P,rate:x})):A?x=A.rate:this.lastVideoFramesRecv.set(o.ssrc,{count:_,lts:P,rate:0}),o.receivedFrame={width:g||0,height:b||0,frameRate:x||0},o.decodedFrame={width:g||0,height:b||0,frameRate:o.decodeFrameRate||0},o.outputFrame={width:g||0,height:b||0,frameRate:o.outputFrameRate||o.decodeFrameRate||0}}if(C&&k){let A=this.lastVideoJBDelay.get(o.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},P=A.jitterBufferMs,x=k-A.jitterBufferEmittedCount;x>0&&(P=1e3*(C-A.jitterBufferDelay)/x),o.jitterBufferMs=P,o.currentDelayMs=Math.round(P),this.lastVideoJBDelay.set(o.ssrc,{jitterBufferDelay:C,jitterBufferEmittedCount:k,jitterBufferMs:o.currentDelayMs})}}processAudioTrackSenderStats(r,i,o){var s,l,d,h;let p=i?this.report.get(i):void 0,f=(s=(l=p?.echoReturnLoss)!==null&&l!==void 0?l:r.echoReturnLoss)!==null&&s!==void 0?s:0,_=(d=(h=p?.echoReturnLossEnhancement)!==null&&h!==void 0?h:r.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;o.aecReturnLoss=f,o.aecReturnLossEnhancement=_}processAudioTrackReceiverStats(r,i,o){var s,l,d,h,p,f,_;let g=i?this.report.get(i):void 0,b=(s=g?.removedSamplesForAcceleration)!==null&&s!==void 0?s:r.removedSamplesForAcceleration,C=(l=g?.totalSamplesReceived)!==null&&l!==void 0?l:r.totalSamplesReceived,k=(d=g?.jitterBufferDelay)!==null&&d!==void 0?d:r.jitterBufferDelay,A=(h=g?.jitterBufferEmittedCount)!==null&&h!==void 0?h:r.jitterBufferEmittedCount,P=(p=g?.audioLevel)!==null&&p!==void 0?p:r?.audioLevel,x=(f=g?.totalSamplesDuration)!==null&&f!==void 0?f:r?.totalSamplesDuration,j=(_=g?.concealedSamples)!==null&&_!==void 0?_:r.concealedSamples;if(b&&C&&(o.accelerateRate=b/C),k&&A){let _t=this.lastAudioJBDelay.get(o.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},ue=_t.jitterBufferMs,_n=A-_t.jitterBufferEmittedCount;_n>0&&(ue=1e3*(k-_t.jitterBufferDelay)/_n),o.jitterBufferMs=Math.round(ue),this.lastAudioJBDelay.set(o.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:A,jitterBufferMs:o.jitterBufferMs})}o.outputLevel=P;let z=1920;x&&C&&(z=C/x/50,o.receivedFrames=Math.round(C/z)),j&&(o.droppedFrames=Math.round(j/z))}processRemoteInboundStats(r,i){let o=this.report.get(r);o&&(i.packetsLost=o.packetsLost,o.roundTripTime&&(i.rttMs=1e3*o.roundTripTime),o.jitter&&(i.jitterMs=1e3*o.jitter),o.timestamp&&(i.timestamp=o.timestamp))}getCodecFromCodecStats(r){let i=this.report.get(r);if(!i)return"";let o=i.mimeType.match(/\/(.*)$/);return o&&o[1]?o[1]:""}updateSendBitrate(){let r=0,i=null,o=null;this.mediaBytesSent.forEach(l=>{r+=l.diffMean()}),this.mediaBytesRetransmit.forEach(l=>{i=i===null?l.diffMean():i+l.diffMean()}),this.mediaBytesTargetEncode.forEach(l=>{o=o===null?l.diffMean():o+l.diffMean()});let s=i!==null?r-i:r;this._stats.bitrate={actualEncoded:8*s/(this.options.updateInterval/1e3),transmit:8*r/(this.options.updateInterval/1e3)},i!==null&&(this._stats.bitrate.retransmit=8*i/(this.options.updateInterval/1e3)),o!==null&&(this._stats.bitrate.targetEncoded=8*o/(this.options.updateInterval/1e3))}},Y8=class extends OL{updateStats(){return eE.resolve()}};function mH(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,l=function(){let d=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return d&&d[0]?Number(d[0].split("/")[1]):null}();return l?l<76?new z8(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:s}):new C3(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:s}):function(d){if(!window.RTCStatsReport)return!1;let h=d.getStats();return!!(h instanceof eE||function(p){return!!p&&(typeof p=="object"||typeof p=="function")&&typeof p.then=="function"}(h))}(e)?new C3(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:s}):new Y8(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:s})}var Ftt=class{get localCapabilities(){return R_(this._localCapabilities)}get rtpCapabilities(){return R_(this._rtpCapabilities)}get candidates(){return R_(this._candidates)}get iceParameters(){return R_(this._iceParameters)}get dtlsParameters(){return R_(this._dtlsParameters)}constructor(e){$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_iceParameters",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname","o/i14u9pJrxRKAsu"),$(this,"firefoxSsrcMidMap",new Map),e=R_(e);let{remoteIceParameters:r,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:s,localCapabilities:l,direction:d,setup:h,videoCodec:p,audioCodec:f}=e,_;this.setup=h,_=d===L0.RECEIVE_ONLY?_v.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):_v.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=s,this._candidates=o,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=l;let g=d===L0.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,b=d===L0.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,C=d===L0.RECEIVE_ONLY?s.send.videoCodecs:$D(cE.VIDEO,g,b,p),k=d===L0.RECEIVE_ONLY?s.send.audioCodecs:$D(cE.AUDIO,g,b,f);for(let A of _.mediaDescriptions)A.attributes.iceUfrag=r.iceUfrag,A.attributes.icePwd=r.icePwd,A.attributes.fingerprints=i.fingerprints,A.attributes.candidates=o,A.attributes.setup=this.setup,A.media.mediaType==="application"&&(A.attributes.sctpPort="5000"),A.media.mediaType==="video"&&(A.media.fmts=C.map(P=>P.payloadType.toString(10)),A.attributes.payloads=C,A.attributes.extmaps=g.videoExtensions),A.media.mediaType==="audio"&&(A.media.fmts=k.map(P=>P.payloadType.toString(10)),A.attributes.payloads=k,A.attributes.extmaps=g.audioExtensions,F1(A));this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return _v.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===e)}send(e,r,i,o,s){i=i.replace(/ /g,"-");let{ssrcs:l,ssrcGroups:d}=UO(r,this.cname,_r("SYNC_GROUP")?i:void 0),h=this.findPreloadMediaDesc(l);if(h){if(f_()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,h.attributes.mid),s&&(s.twcc||s.remb)){let p=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(h,s),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{let p=this.findAvailableMediaIndex(e,l,o),f;return p===-1?(f=this.createOrRecycleSendMedia(e,l,d,"sendonly",o,s),this.updateBundleMids()):(f=R_(this.sessionDesc.mediaDescriptions[p]),f.attributes.direction="sendonly",f.attributes.ssrcs=l,f.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(f,s)),f_()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,f.attributes.mid),{needExchangeSDP:!0,mid:f.attributes.mid}}}stopSending(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,r,i){let o=[];return e.forEach(s=>{let l=s._mediaStreamTrack.kind,d=this.findAvailableRecvMediaIndex(l),h,p=!1;d===-1?(p=!0,h=this.createOrRecycleRecvMedia(s,[],"recvonly",r,i),this.updateBundleMids()):(h=R_(this.sessionDesc.mediaDescriptions[d]),h.attributes.direction="recvonly"),o.push({mid:h.attributes.mid,needCreateTransceiver:p})}),o}stopReceiving(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:r,protocol:i,address:o,port:s,type:l,relatedAddress:d,relatedPort:h,priority:p}=new RTCIceCandidate(e),f={foundation:r??"",componentId:"1",transport:i??"",priority:p?p+"":"",connectionAddress:o??"",port:s?s+"":"",type:l?l+"":"",relAddr:d??"",relPort:h?h+"":"",extension:{}};this.candidates.some(_=>_.priority===f.priority&&_.connectionAddress===f.connectionAddress&&_.port===f.port)||(this._candidates.push(f),this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,r,i,o,s){let l=e._mediaStreamTrack.kind,d=this.rtpCapabilities.recv,h=$D(l,d,this.localCapabilities.send,l===cE.AUDIO?s:o),p=l===cE.VIDEO?d.videoExtensions:d.audioExtensions,f="".concat(++this.currentMidIndex),_={media:{mediaType:l,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};_=this.mungRecvMediaDsec(_,e);let g=this.findFirstClosedMedia(l);if(g){let b=this.sessionDesc.mediaDescriptions.indexOf(g);this.sessionDesc.mediaDescriptions[b]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}muteRemote(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>nE(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){let r=this.sessionDesc.mediaDescriptions.filter(i=>nE(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,r,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{let s=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(f_()){if(s){let l=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(l||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!l||l!==o.attributes.mid)}return!1}return s&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(r=>{let i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(e){let r=[];for(let i=0;i<e;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(e){e=R_(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,r,i,o,s,l){let d=this.rtpCapabilities.send,h=e===cE.VIDEO?d.videoCodecs:d.audioCodecs,p=e===cE.VIDEO?d.videoExtensions:d.audioExtensions;f_()&&(s="".concat(++this.currentMidIndex));let f={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:s}};f=this.mungSendMediaDesc(f,l);let _=this.findFirstClosedMedia(e);if(_){let g=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[g]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}mungRecvMediaDsec(e,r,i){let o=R_(e);return uH(o),V1(o,r),lH(o,r),xst(o),R3(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,r){let i=R_(e);return R3(i,r,this.localCapabilities.recv),F1(i),i}updateRecvMedia(e,r){let i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){let o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>f_()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}},BRt=["sdp"],$E;function Btt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function PI(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Btt(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Btt(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Gtt=($E=class u1 extends o3{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,o){super(r,i),$(this,"direction",void 0),$(this,"name",void 0),$(this,"store",void 0),$(this,"spec",void 0),$(this,"peerConnection",void 0),$(this,"initialOffer",void 0),$(this,"transport",void 0),$(this,"statsFilter",void 0),$(this,"localCandidateCount",0),$(this,"_isInRestartIce",!1),$(this,"mutex",new f0("P2PConnection-mutex")),$(this,"onLocalCandidate",void 0),$(this,"remoteSDP",void 0),$(this,"pendingCandidates",[]),$(this,"localCapabilities",void 0),$(this,"isReady",!1),$(this,"restartCnt",0),$(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.peerConnection=new RTCPeerConnection(u1.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??L0.SEND_ONLY,this.name=this.direction===L0.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=mH(this.peerConnection,_r("STATS_UPDATE_INTERVAL"),void 0,f_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{let i=await Vst();if(this.localCapabilities=w3(i),r){let{sdp:o}=r,s=VRt(r,BRt),l=function(){let _={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},g=wL(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},C={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(RT(g,_,"videoExtensions",b,C,k),RT(g,_,"videoCodecs",b,C,k),RT(g,_,"audioExtensions",b,C,k),RT(g,_,"audioCodecs",b,C,k),_r("RAISE_H264_BASELINE_PRIORITY")){let A=k.videoCodecs.findIndex(P=>P.rtpMap&&P.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&P.fmtp&&P.fmtp.parameters["profile-level-id"]==="42001f");if(A!==-1){let P=k.videoCodecs.findIndex(x=>x.rtpMap&&x.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(P<A){B.debug("raising H264 baseline profile priority");let x=k.videoCodecs[A];k.videoCodecs.splice(A,1),k.videoCodecs.splice(P,0,x)}P!==-1&&_r("FILTER_SEND_H264_BASELINE")&&(b.videoCodecs=b.videoCodecs.filter(x=>!(x.rtpMap&&x.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&x.fmtp&&x.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:b,recv:C,sendrecv:k}}({},{},o);this.remoteSDP=new Ftt({remoteIceParameters:s.iceParameters,remoteDtlsParameters:s.dtlsParameters,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let d=await this.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let h=HI(d.sdp);await this.peerConnection.setLocalDescription(d);let p=await ytt({},{},d.sdp);this.localCapabilities=w3(p);let f=this.peerConnection.getTransceivers()[0];return f!=null&&f.receiver&&f.receiver.transport&&this.tryBindTransportEvents(f.receiver.transport),PI(PI({},h),{},{sdp:d.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let s=HI(o.sdp);return this.initialOffer=o,PI(PI({},s),{},{sdp:o.sdp})}}catch(i){throw new _u(Vt.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:i,iceParameters:o,dtlsParameters:s}=r,l=await ytt({},{},i);this.remoteSDP=new Ftt({remoteIceParameters:o,remoteDtlsParameters:s,candidates:[],remoteRTPCapabilities:l,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let d=this.peerConnection.getTransceivers()[0];d!=null&&d.sender&&d.sender.transport&&this.tryBindTransportEvents(d.sender.transport)}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new _u(Vt.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,o){var s=this;return YS(function*(){let l=yield PE(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let d=[],h=s.remoteSDP.receive(r,i,o);r.forEach((P,x)=>{if(h[x].needCreateTransceiver){let j=s.peerConnection.addTransceiver(P._mediaStreamTrack,{direction:"sendonly"});d.push(j),P._updateRtpTransceiver(j)}else{let j=s.peerConnection.getTransceivers().find(z=>z.mid===h[x].mid);if(!j)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(h[x].mid));d.push(j),P._updateRtpTransceiver(j)}}),f_()&&_r("SIMULCAST")===!0&&(yield PE(s.applySimulcastForFirefox(d,r)));let p=h.map(P=>P.mid),f=yield PE(s.peerConnection.createOffer()),_=s.mungSendOfferSDP(f.sdp,r,p),g=_v.parse(_),b=p.map(P=>{let x=g.mediaDescriptions.find(j=>j.attributes.mid===P);if(!x)throw new Error("Cannot extract ssrc from mediaDescription.");return Mst(x,_r("USE_PUB_RTX"))}),C=d.map((P,x)=>{let j=p[x];return{localSSRC:b[x],id:j}});yield PE(s.peerConnection.setLocalDescription({type:"offer",sdp:_}));try{yield C}catch(P){let x=s.remoteSDP.toString();throw yield PE(s.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield PE(s.peerConnection.setRemoteDescription({type:"answer",sdp:x})),yield PE(s.stopSending(p,!0)),P}yield PE(s.applySimulcastEncodings(d,r)),yield PE(s.applySendEncodings(d,r));let k=s.remoteSDP.toString(),A=s.logSDPExchange(_,"offer","local","send");return A?.(k),yield PE(s.setRemoteDescription({type:"answer",sdp:k})),d.map((P,x)=>{let j=p[x];return{localSSRC:b[x],id:j}})}catch(d){throw d instanceof _u?d:new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{l()}})()}async stopSending(r,i){let o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let s=this.peerConnection.getTransceivers().filter(p=>r.indexOf(p.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length (".concat(s.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));s.map(p=>{var f;p.direction="inactive",(f=p.stop)===null||f===void 0||f.call(p)});let l=await this.peerConnection.createOffer(),d=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(r);let h=this.remoteSDP.toString();d?.(h),await this.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{o&&o()}}async receive(r,i,o,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));let{mid:l,needExchangeSDP:d}=this.remoteSDP.send(r,i,o,s);if(d){let p=this.remoteSDP.toString(),f=this.logSDPExchange(p,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:p});let _=await this.peerConnection.createAnswer(),g=this.mungReceiveAnswerSDP(_.sdp,l,r);f?.(g||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:g}),B.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else B.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));let h=this.peerConnection.getTransceivers().find(p=>p.mid===l);if(!h||h.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,mid:h.mid,transceiver:h}}catch(l){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async mockReceive(r,i,o,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));let{mid:l,needExchangeSDP:d}=this.remoteSDP.send(r,i,o,s);if(d){let h=this.remoteSDP.toString(),p=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});let f=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(f.sdp,l,r);p?.(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),B.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else B.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(l){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});let s=await this.peerConnection.createAnswer();o?.(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===NO.Auto&&(this.store.p2pTransport=NO.SdRtn,ME().supportPCSetConfiguration&&this.peerConnection.setConfiguration(u1.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,ME().supportPCSetConfiguration&&this.peerConnection.setConfiguration(u1.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;let i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:o}=HI(i.sdp);return this.store.descriptionStart(),this.direction===L0.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===L0.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:o}=HI(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);let l=this.remoteSDP.toString(),d=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),d?.(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new _u(Vt.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){let o=this.peerConnection.getTransceivers().filter(s=>s.mid===r);o.length===1&&(this.isVP8Simulcast(i)?f_()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){let o=this.peerConnection.getTransceivers().find(s=>s.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){let r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){let i=r[0].transport.iceTransport,{local:o,remote:s}=i.getSelectedCandidatePair();return{local:PI(PI({},IR),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:PI(PI({},IR),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;nE(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else B.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s={iceServers:[]};var l;return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(lV(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...u1.turnServerConfigToIceServers(r.turnServer.servers,i,o)),_r("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...u1.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,o)),nE(l=[NO.Relay,NO.SdRtn]).call(l,i)&&(s.iceTransportPolicy="relay"),_r("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(d=>{d.forceturn&&(s.iceTransportPolicy="relay")}))),_r("ENABLE_ENCODED_TRANSFORM")&&ME().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),B.debug("P2PConnection p2pTransport is ".concat(i)),s}static turnServerConfigToIceServers(r,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=[],l=r.filter(h=>h.tcpport);B.debug("P2PConnection turnServers is ".concat(l,", current index is ").concat(o));let d=l.length>o?l[o]:l[0];switch(i){case NO.SdRtn:let h=r.filter(f=>{var _;return nE(_=f.username).call(_,"glb:")&&f.turnServerURL==f.turnServerURL}),p=h.length>o?h[o]:h[0];p&&(s.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(g1(p.turnServerURL),":").concat(p.tcpport,"?transport=udp")}),s.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(g1(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}));break;case NO.Relay:d&&(s.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),s.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(g1(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;default:d&&(s.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=udp")}),s.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(g1(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}),s.push({username:d.username,credential:d.password,credentialType:"password",urls:"stun:".concat(d.turnServerURL,":").concat(d.tcpport)}))}return s}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in o?o.error:o)};let i=r.iceTransport;i&&(i.onstatechange=()=>{let o=r?.iceTransport.state;var s;o&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){let{local:o,remote:s}=i.getSelectedCandidatePair();B.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(_=>_.track===r._mediaStreamTrack)),!i)return B.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return B.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ME().supportSetRtpSenderParameters)return B.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let s={},l={};switch(r._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(r._encoderConfig){var d;let{bitrateMax:_,frameRate:g,scaleResolutionDownBy:b}=r._encoderConfig;_&&(l.maxBitrate=1e3*_),nE(d=r._hints).call(d,XE.LOW_STREAM)&&(g&&(l.maxFramerate=pS(g)),b&&b>=1&&(l.scaleResolutionDownBy=b))}if(_r("DSCP_TYPE")&&$I()){var h;let _=_r("DSCP_TYPE");nE(h=["very-low","low","medium","high"]).call(h,_)&&(l.networkPriority=_)}let p=i.getParameters(),f=(o=p.encodings)===null||o===void 0?void 0:o[0];f_()&&!f&&(s.encodings=[l]),f&&Object.assign(f,l),Object.assign(p,s),B.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await i.setParameters(p)}async applySendEncodings(r,i){try{if(!ME().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){let s=r[o],l=i[o];l instanceof e_&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,s.sender)}}catch{B.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){let s=_v.parse(r);return i.forEach((l,d)=>{let h=o[d],p=s.mediaDescriptions.find(f=>f.attributes.mid===h);p&&(V1(p,l),jst(p,l,this.store.codec))}),_v.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let p=0;p<r.length;p++){var o,s,l,d,h;let f=r[p],_=i[p];if(_ instanceof e_&&!nE(o=_._hints).call(o,XE.LOW_STREAM)&&(s=_._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((l=_._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(d=_._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=_._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){let g={},b={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];let C=f.sender.getParameters();await f.sender.setParameters(Object.assign(C,g))}}}async applySimulcastEncodings(r,i){if(!f_()&&r.length===i.length)for(let o=0;o<r.length;o++){let s=i[o];if(s instanceof e_&&this.isVP8Simulcast(s)){let l=r[o],d={},h={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];let p=l.sender.getParameters();await l.sender.setParameters(Object.assign(p,d))}}}isVP8Simulcast(r){var i,o,s,l,d;return!!(r instanceof e_&&_r("SIMULCAST")&&this.store.codec==="vp8"&&!nE(i=r._hints).call(i,XE.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((s=r._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(l=r._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((d=r._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(r,i,o,s){if(_r("SDP_LOGGING"))return B.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(s,`
`),r),i==="offer"?l=>{this.logSDPExchange(l,"answer",o==="local"?"remote":"local",s)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(d=>d.mid&&r.indexOf(d.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(d=>{d.direction="inactive"});let o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);let l=this.remoteSDP.toString();s?.(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(d=>d.mid&&r.indexOf(d.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async d=>{d.direction="sendonly"});let o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);let l=this.remoteSDP.toString();s?.(l),await this.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var o,s;if(i=(o=i)!==null&&o!==void 0?o:(s=this.currentRemoteDescription)===null||s===void 0?void 0:s.sdp){var l;let d=(l=_v.parse(i).mediaDescriptions.find(h=>h.attributes.mid===r))===null||l===void 0?void 0:l.attributes.ssrcs;return d?.[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),nE(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,o){let s=_v.parse(r),l=s.mediaDescriptions.find(d=>d.attributes.mid===i);return l&&o===cE.AUDIO&&l.media.mediaType==="audio"&&F1(l),_v.print(s)}},oE($E.prototype,"establish",[fT],Object.getOwnPropertyDescriptor($E.prototype,"establish"),$E.prototype),oE($E.prototype,"connect",[fT],Object.getOwnPropertyDescriptor($E.prototype,"connect"),$E.prototype),oE($E.prototype,"receive",[fT],Object.getOwnPropertyDescriptor($E.prototype,"receive"),$E.prototype),oE($E.prototype,"mockReceive",[fT],Object.getOwnPropertyDescriptor($E.prototype,"mockReceive"),$E.prototype),oE($E.prototype,"stopReceiving",[fT],Object.getOwnPropertyDescriptor($E.prototype,"stopReceiving"),$E.prototype),oE($E.prototype,"restartICE",[fT],Object.getOwnPropertyDescriptor($E.prototype,"restartICE"),$E.prototype),oE($E.prototype,"close",[fT],Object.getOwnPropertyDescriptor($E.prototype,"close"),$E.prototype),oE($E.prototype,"updateEncoderConfig",[fT],Object.getOwnPropertyDescriptor($E.prototype,"updateEncoderConfig"),$E.prototype),oE($E.prototype,"updateSendParameters",[fT],Object.getOwnPropertyDescriptor($E.prototype,"updateSendParameters"),$E.prototype),oE($E.prototype,"replaceTrack",[fT],Object.getOwnPropertyDescriptor($E.prototype,"replaceTrack"),$E.prototype),oE($E.prototype,"muteLocal",[fT],Object.getOwnPropertyDescriptor($E.prototype,"muteLocal"),$E.prototype),oE($E.prototype,"unmuteLocal",[fT],Object.getOwnPropertyDescriptor($E.prototype,"unmuteLocal"),$E.prototype),$E);function fT(e,r,i){let o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let s=this.mutex,l=await s.lock("From P2PConnection.".concat(r));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await o.apply(this,h)}finally{l()}},i}function J8(e,r){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=pS(r.width),o.height=pS(r.height);let s=pS(r.framerate||15);document.body.append(i),document.body.append(o);let l=e._mediaStreamTrack;i.srcObject=new MediaStream([l]),i.play();let d=o.getContext("2d");if(!d)throw new _a(Vt.UNEXPECTED_ERROR,"can not get canvas context");let h=ME(),p=o.captureStream(h.supportRequestFrame?0:s).getVideoTracks()[0];p.canvas||(p.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){let _=i.videoWidth,g=i.videoHeight/_,b=o.width*g;Math.abs(b-o.height)>=2&&(B.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(b)),o.height=b)}d.drawImage(i,0,0,o.width,o.height),p.requestFrame&&p.requestFrame(),l!==e._mediaStreamTrack&&(l=e._mediaStreamTrack,i.srcObject=new MediaStream([l]))},o.stopCapture=aH(()=>o.startCapture&&o.startCapture(),s);let f=p.stop;return p.stop=()=>{f.call(p),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),B.debug("clean low stream renderer")},p}var FU=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(FU||{}),G_=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(G_||{}),PO=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(PO||{}),g0=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(g0||{}),DO=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(DO||{}),Xst=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(Xst||{}),XR=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(XR||{}),ET=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}(ET||{}),Qst=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(Qst||{}),HS=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(HS||{}),HR=1e3,AO=3;function SE(e,r,i){i!=null&&Number.isFinite(i)&&(e[r]=Math.round(Math.max(0,i)))}function qtt(e){let r={[HS.CONN_TYPE]:0,[HS.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[HS.CONN_TYPE]=1),i==="tcp"&&(r[HS.CONN_TYPE]=3),i==="tls"&&(r[HS.CONN_TYPE]=4);break}case"srflx":r[HS.CONN_TYPE]=2}return r}function Wtt(e){let r=0;switch(e){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}var A3=class extends s_{constructor(r){super(),$(this,"store",void 0),$(this,"uploadWRTCStatsTimer",void 0),$(this,"uploadOutboundDenoiserStatsTimer",void 0),$(this,"uploadExtStatsTimer",void 0),$(this,"uploadExtUsageStatsTimer",void 0),$(this,"uploadInboundExtStatsTimer",void 0),$(this,"requestStats",void 0),$(this,"requestTransportStats",void 0),$(this,"requestLocalMedia",void 0),$(this,"requestRemoteMedia",void 0),$(this,"requestAllTracks",void 0),$(this,"requestVideoIsReady",void 0),$(this,"requestUploadStats",void 0),$(this,"requestUpload",void 0),$(this,"uploadOutboundStarted",!1),$(this,"uploadInboundStarted",!1),$(this,"uploadTransportStarted",!1),$(this,"uploadExtensionUsageStarted",!1),$(this,"lastRecvStats",void 0),$(this,"lastSendStats",void 0),$(this,"lastFullRecvStats",void 0),$(this,"lastFullSendStats",void 0),$(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;let i,o;if(this.uploadTransportStarted&&(i=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!i&&this.uploadOutboundStarted&&(i=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),i||o){let s={};if(this.uploadTransportStarted&&i){let l=this.getTransportStats(i,o,r);l&&(s.misc=[l])}if(this.uploadOutboundStarted&&i){let l=this.getOutboundStats(i,r?this.lastSendStats:this.lastFullSendStats,r);l&&(s.outbound=[l])}if(this.uploadInboundStarted&&o){let l=this.getInboundStats(o,r?this.lastRecvStats:this.lastFullRecvStats,r);l&&(s.inbound=l)}this.requestUploadStats(s)}this.lastRecvStats=o,this.lastSendStats=i,r||(this.lastFullRecvStats=o,this.lastFullSendStats=i)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(r!==AO),++r===AO+1&&(r=1)},HR)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,i,o){if(!this.requestStats)return;if(o)return r.rtt==null?void 0:{addition:{[HS.RTT]:r.rtt,[HS.CONN_TYPE]:void 0}};let s=qtt(r);if(this.store.useP2P){if(i){let l=qtt(i);s[HS.CONN_TYPE]+=l[HS.CONN_TYPE]<<3}s[HS.CONN_TYPE]+=110}else s[HS.CONN_TYPE]+=100;return{addition:s}}getOutboundStats(r,i,o){if(!this.requestUploadStats||!this.requestLocalMedia)return;let s=this.requestLocalMedia();if(!s||s.length===0)return;let l,d,h;return s.forEach(p=>{let[f,{track:_,ssrcs:g}]=p;switch(f){case _m.LocalVideoLowTrack:case _m.LocalVideoTrack:if(f===_m.LocalVideoTrack){let b=function(A,P,x,j,z){let _t=P.videoSend.find(_i=>_i.ssrc===A);if(!_t)return;let ue={},{sentFrame:_n,inputFrame:Ei}=_t;if(Ei&&_n){let _i=Ei.frameRate,_h=_n.frameRate;ue[G_.FREEZE]=function(_p,Qm){let _o=!0;return _o=!(_p<=5)&&(_p<=10?Qm<3:_p<=20?Qm<4:Qm<5),_o}(_i,_h)?1:0}if(SE(ue,G_.QP_SUM,_t.qpSumPerFrame),z)return ue;switch(_n&&(SE(ue,G_.HEIGHT,_n.height),SE(ue,G_.WIDTH,_n.width),SE(ue,G_.FRAME_RATE,_n.frameRate)),ue[G_.DISABLED]=j._originMediaStreamTrack&&!j._originMediaStreamTrack.enabled||j._mediaStreamTrack&&!j._mediaStreamTrack.enabled?1:0,_t.adaptionChangeReason){case"none":ue[G_.ADAPTATION]=0;break;case"cpu":ue[G_.ADAPTATION]=1;break;case"bandwidth":ue[G_.ADAPTATION]=2;break;case"other":ue[G_.ADAPTATION]=3}let _s=0;_t.adaptionChangeReason&&(_s+=Wtt(_t.adaptionChangeReason)),P.qualityLimitationReason&&(_s+=Wtt(P.qualityLimitationReason)<<3),ue[G_.ADAPTATION]=_s,ue[G_.PLAYER_STATUS]=W6[j._player?j._player.videoElementStatus:"uninit"],SE(ue,G_.NACKS,_t.nacksCount),SE(ue,G_.PLIS,_t.plisCount),SE(ue,G_.FIRS,_t.firsCount),SE(ue,G_.AVG_ENCODE,_t.avgEncodeMs);let kc=x&&x.videoSend.find(_i=>_i.ssrc===A);if(kc){let _i=z?HR:HR*AO;kc.timestamp&&_t.timestamp&&(_i=_t.timestamp-kc.timestamp),kc.packets!=null&&_t.packets!=null&&SE(ue,G_.PACKAGE_RATE,1e3*(_t.packets-kc.packets)/_i),_t.packetsLost!=null&&kc.packetsLost!=null&&SE(ue,G_.PACKAGE_LOST,_t.packetsLost-kc.packetsLost),kc.bytes!=null&&_t.bytes!=null&&SE(ue,G_.BITRATE,8*(_t.bytes-kc.bytes)/_i)}return ue}(g[0].ssrcId,r,i,_,o),C=o?null:function(A,P,x){let j=P.videoSend.find(_s=>_s.ssrc===A);if(!j)return null;let z={},_t=j.inputFrame,ue=_t&&_t.height||x&&x.videoHeight||0,_n=_t&&_t.width||x&&x.videoWidth||0,Ei=_t&&_t.frameRate||0;return SE(z,FU.HEIGHT,ue),SE(z,FU.WIDTH,_n),SE(z,FU.FRAME_RATE,Ei),z}(g[0].ssrcId,r,_),k=o?null:function(A){let P={};return SE(P,G_.RETRANSMIT,A.bitrate.retransmit),SE(P,G_.TARGET_ENCODED,A.bitrate.targetEncoded),SE(P,G_.ACTUAL_ENCODED,A.bitrate.actualEncoded),SE(P,G_.TRANSMIT,A.bitrate.transmit),SE(P,G_.BANDWIDTH,A.sendBandwidth),P}(r);d=Object.assign({},b,C,k)}else h=o?void 0:function(b,C,k){let A=C.videoSend.find(j=>j.ssrc===b);if(!A)return;let P={},x=A.sentFrame;if(x&&(SE(P,PO.HEIGHT,x.height),SE(P,PO.WIDTH,x.width),SE(P,PO.FRAME_RATE,x.frameRate)),k){let j=k.videoSend.find(z=>z.ssrc===b);if(j){let z=HR*AO;j.timestamp&&A.timestamp&&(z=A.timestamp-j.timestamp),j.packets!=null&&A.packets!=null&&SE(P,PO.PACKAGE_RATE,1e3*(A.packets-j.packets)/z),A.packetsLost!=null&&j.packetsLost!=null&&SE(P,PO.PACKAGE_LOST,A.packetsLost-j.packetsLost),j.bytes!=null&&A.bytes!=null&&SE(P,PO.BITRATE,8*(A.bytes-j.bytes)/z)}}return P}(g[0].ssrcId,r,i);break;case _m.LocalAudioTrack:l=o?void 0:function(b,C,k,A){let P=C.audioSend.find(ue=>ue.ssrc===b);if(!P)return;let x={};x[XR.DISABLED]=A._originMediaStreamTrack&&!A._originMediaStreamTrack.enabled||A._mediaStreamTrack&&!A._mediaStreamTrack.enabled?1:0;let j=100*A._source.getAccurateVolumeLevel(),z=P.inputLevel;if(z!=null){let ue=Math.ceil(50*Math.log10(100*z+1));SE(x,XR.LEVEL,ue)}else SE(x,XR.LEVEL,j);SE(x,Xst.PCM_LEVEL,j),SE(x,XR.AEC_RETURN_LOSS,P.aecReturnLoss),SE(x,XR.AEC_RETURN_LOSS_ENH,P.aecReturnLossEnhancement),x[XR.FREEZE]=0;let _t=k&&k.audioSend.find(ue=>ue.ssrc===b);if(_t){let ue=HR*AO;_t.timestamp&&P.timestamp&&(ue=P.timestamp-_t.timestamp),_t.bytes!=null&&P.bytes!=null&&SE(x,XR.BITRATE,8*(P.bytes-_t.bytes)/ue),_t.packets!=null&&P.packets!=null&&SE(x,XR.PACKAGE_RATE,1e3*(P.packets-_t.packets)/ue)}return x}(g[0].ssrcId,r,i,_)}}),{high:d,low:h,audio:l}}getInboundStats(r,i,o){if(!this.requestRemoteMedia)return;let s=this.requestRemoteMedia()||[],l=[];return s.forEach(d=>{let[h,p]=d,f={peer:h.uid};if(p.has(cE.VIDEO)&&h.videoTrack){let _=h._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(h._videoSSRC)||!1,g=h.videoTrack?function(b,C,k,A,P,x,j){var z;let _t=C.videoRecv.find(_h=>_h.ssrc===b);if(!_t)return;let ue={},{receivedFrame:_n,outputFrame:Ei,decodeFrameRate:_s}=_t,kc=k&&k.videoRecv.find(_h=>_h.ssrc===b);if(ue[g0.FREEZE]=P&&O3.isRemoteVideoFreeze(A,_t,kc)?1:0,SE(ue,DO.FRAME_RATE_DECODE,_s),SE(ue,g0.QP_SUM,_t.qpSumPerFrame),_t.framesRateFirefox&&SE(ue,g0.FRAME_RATE,_t.framesRateFirefox),_n&&SE(ue,g0.FRAME_RATE,_n.frameRate),kc){let _h=C.timestamp-k.timestamp||(j?HR:AO*HR);_t.packetsLost!=null&&kc.packetsLost!=null&&SE(ue,g0.PACKAGE_LOST,_t.packetsLost-kc.packetsLost),kc.bytes!=null&&_t.bytes!=null&&SE(ue,g0.BITRATE,8*(_t.bytes-kc.bytes)/_h),kc.packets!=null&&_t.packets!=null&&SE(ue,g0.PACKAGE_RATE,1e3*(_t.packets-kc.packets)/_h)}if(j)return ue;_n?(SE(ue,g0.HEIGHT,_n.height),SE(ue,g0.WIDTH,_n.width)):A&&(SE(ue,g0.HEIGHT,A._videoHeight||0),SE(ue,g0.WIDTH,A._videoWidth||0)),Ei&&SE(ue,DO.FRAME_RATE_OUTPUT,Ei.frameRate);let _i=(z=A._player)===null||z===void 0?void 0:z.rendFrameRate.toFixed(0);if(_i&&SE(ue,DO.FRAME_RATE_RENDER,+_i),SE(ue,g0.JITTER_BUFFER,_t.jitterBufferMs),SE(ue,g0.CURRENT_DELAY,_t.currentDelayMs),SE(ue,g0.FIRS,_t.firsCount),SE(ue,g0.NACKS,_t.nacksCount),SE(ue,g0.PLIS,_t.plisCount),A){ue[g0.DISABLED]=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?0:1;let _h=A._player;if(_h){let{freezeTimeCounterList:_p,renderFreezeAccTime:Qm,videoElementStatus:_o}=_h;if(_p&&_p.length>0&&SE(ue,DO.FREEZE_TIME,_p.splice(0,1)[0]),x&&JR.visibility==="visible"&&_o===I0.PLAYING&&ME().supportRequestVideoFrameCallback){let ga=Math.min(6e3,Qm);_h.renderFreezeAccTime=Math.max(0,Qm-ga),SE(ue,DO.FREEZE_TIME_RENDER,ga)}if(typeof _t.totalFreezesDuration=="number"){let ga=kc&&kc.totalFreezesDuration?_t.totalFreezesDuration-kc.totalFreezesDuration:_t.totalFreezesDuration;SE(ue,DO.FREEZE_DURATION,1e3*ga)}}}if(ue[g0.PLAYER_STATUS]=W6[A._player?A._player.videoElementStatus:"uninit"],kc&&_t.totalInterFrameDelay!==void 0&&_t.totalSquaredInterFrameDelay!==void 0&&kc.totalInterFrameDelay!==void 0&&kc.totalSquaredInterFrameDelay!==void 0){let _h=_t.totalInterFrameDelay-kc.totalInterFrameDelay,_p=_t.totalSquaredInterFrameDelay-kc.totalSquaredInterFrameDelay,Qm=_t.framesDecodeCount-kc.framesDecodeCount,_o=_h/Qm*1e3,ga=Math.round(1e3*Math.sqrt((_p-Math.pow(_h,2)/Qm)/Qm));!isNaN(ga)&&_o+ga>Math.max(3*_o,_o+150)&&(ue[g0.I_FRAME_DELAY]=ga)}return ue}(h._videoSSRC,r,i,h.videoTrack,_===!0,this.needUploadRenderFreezeTime,o):void 0;g&&(f.video=g)}if(p.has(cE.AUDIO)&&h.audioTrack){let _=h.audioTrack?function(g,b,C,k,A){let P=b.audioRecv.find(kc=>kc.ssrc===g);if(!P)return;let x={},j=C&&C.audioRecv.find(kc=>kc.ssrc===g),{receivedFrames:z,droppedFrames:_t}=P;var ue,_n;if(SE(x,ET.JITTER,P.jitterMs),z!=null&&_t!=null&&(x[ET.FREEZE]=(_n=_t,(ue=z)===0||100*_n/ue>20?1:0)),j){let kc=b.timestamp-C.timestamp||(A?HR:HR*AO);P.packets!=null&&j.packets!=null&&SE(x,ET.PACKAGE_RATE,1e3*(P.packets-j.packets)/kc),j.bytes!=null&&P.bytes!=null&&SE(x,ET.BITRATE,8*(P.bytes-j.bytes)/kc),P.packetsLost!=null&&j.packetsLost!=null&&SE(x,ET.PACKAGE_LOST,P.packetsLost-j.packetsLost)}if(A)return x;let Ei=100*k._source.getAccurateVolumeLevel(),_s=P.outputLevel;if(_s!=null){let kc=Math.ceil(50*Math.log10(100*_s+1));SE(x,Qst.LEVEL,kc)}if(SE(x,ET.PCM_LEVEL,Ei),k&&(x[ET.DISABLED]=k._originMediaStreamTrack.enabled&&k._mediaStreamTrack.enabled?0:1),SE(x,ET.JITTER_BUFFER,P.jitterBufferMs),SE(x,ET.CURRENT_DELAY,P.jitterBufferMs),x[ET.PLAYER_STATUS]=W6[H0.getPlayerState(k.getTrackId())],j){let kc=P.concealedSamples-j.concealedSamples;kc>0&&SE(x,ET.CONCEALED_SAMPLES,kc)}return x}(h._audioSSRC,r,i,h.audioTrack,o):void 0;_&&(f.audio=_)}(f.video||f.audio)&&l.push(f)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,l}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let r=(this.requestAllTracks()||[]).find(i=>i instanceof v3);if(r&&r._external.getDenoiserStats){let i=r._external.getDenoiserStats();i&&this.requestUpload(vL.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[i,o]=r;o.has(cE.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)}),o.has(cE.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let i=Date.now(),o={connectionInterval:_r("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i},s=[],l=this.requestAllTracks&&this.requestAllTracks()||[];for(let f of l)!f.muted&&f.enabled&&(s=s.concat(await f.getProcessorUsage()));let d=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[f,_]of d)_.has(cE.VIDEO)&&f.videoTrack&&(s=s.concat(await f.videoTrack.getProcessorUsage())),_.has(cE.AUDIO)&&f.audioTrack&&(s=s.concat(await f.audioTrack.getProcessorUsage()));if(s.length===0)return;o.details=function(f,_){let g={};for(let{id:A,value:P,level:x,direction:j}of f){var b;let z=(b=_.get(A))!==null&&b!==void 0?b:0,_t=P===2?z+_r("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:z;var C,k;_.set(A,_t),g[A]?(P===2&&(g[A].value=P),x>g[A].level&&(g[A].level=x),j==="remote"&&(g[A].remoteUidCount+=1),g[A].totalTs=(C=_.get(A))!==null&&C!==void 0?C:0):g[A]={value:P,level:x,remoteUidCount:j==="local"?0:1,totalTs:(k=_.get(A))!==null&&k!==void 0?k:0}}return Object.keys(g).map(A=>{let{level:P,value:x,totalTs:j}=g[A];return{id:A,level:P,value:x,totalTs:j}})}(s,r);let h=Date.now(),p=h>i?h:i+1;this.requestUpload&&this.requestUpload(vL.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:p})},_r("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}},gR=class{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,i){$(this,"uid",void 0),$(this,"_uintid",void 0),$(this,"_trust_in_room_",!0),$(this,"_trust_audio_enabled_state_",!0),$(this,"_trust_video_enabled_state_",!0),$(this,"_trust_audio_mute_state_",!0),$(this,"_trust_video_mute_state_",!0),$(this,"_audio_muted_",!1),$(this,"_video_muted_",!1),$(this,"_audio_enabled_",!0),$(this,"_video_enabled_",!0),$(this,"_audio_added_",!1),$(this,"_video_added_",!1),$(this,"_is_pre_created",!1),$(this,"_video_pre_subscribed",!1),$(this,"_audio_pre_subscribed",!1),$(this,"_trust_video_stream_added_state_",!0),$(this,"_trust_audio_stream_added_state_",!0),$(this,"_audioTrack",void 0),$(this,"_videoTrack",void 0),$(this,"_dataChannels",[]),$(this,"_audioSSRC",void 0),$(this,"_videoSSRC",void 0),$(this,"_audioOrtc",void 0),$(this,"_videoOrtc",void 0),$(this,"_cname",void 0),$(this,"_rtxSsrcId",void 0),$(this,"_videoMid",void 0),$(this,"_audioMid",void 0),this.uid=r,this._uintid=i}},zT=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function GRt(e,r){var i;let o;switch(r){case _m.LocalAudioTrack:o=VE.Audio;break;case _m.LocalVideoTrack:o=nE(i=e._hints).call(i,XE.SCREEN_TRACK)?VE.Screen:VE.High;break;case _m.LocalVideoLowTrack:o=VE.Low}return o}function X8(e){let r=ME();if(e.some(i=>i._bypassWebAudio))throw new _u(Vt.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new _u(Vt.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function t5(e,r){X8(e);let i=r||new D_;return e.forEach(o=>i.addAudioTrack(o)),i}var Htt,Ktt,ztt,Ytt,Jtt,Xtt,Qtt,Ztt,$tt,tet,eet,i_;function net(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function oU(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?net(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):net(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var uS=(Htt=qT(zT.SEND_ONLY),Ktt=qT(zT.SEND_ONLY),ztt=qT(),Ytt=qT(zT.RECEIVE_ONLY),Jtt=qT(zT.RECEIVE_ONLY),Xtt=qT(zT.RECEIVE_ONLY),Qtt=qT(zT.RECEIVE_ONLY),Ztt=qT(zT.RECEIVE_ONLY),$tt=qT(zT.RECEIVE_ONLY),tet=qT(),eet=qT(zT.RECEIVE_ONLY),i_=class extends s_{get state(){return this._state}set state(e){let r=this._state;this._state=e,this.emit(fE.StateChange,r,this._state)}constructor(e,r){super(),$(this,"isPlanB",!1),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"sendConnection",void 0),$(this,"recvConnection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"statsCollector",void 0),$(this,"dtlsFailedCount",0),$(this,"sendMutex",new f0("P2PChannel2-send-mutex")),$(this,"recvMutex",new f0("P2PChannel2-recv-mutex")),$(this,"_state",jE.Disconnected),$(this,"_restartStates",["disconnected","failed"]),$(this,"reconnectInterval",void 0),$(this,"uploadUnplinkStarted",!1),$(this,"uploadDownlinkStarted",!1),$(this,"uplinkStateUploadInterval",void 0),$(this,"downlinkStatsUploadInterval",void 0),$(this,"handleMuteLocalTrack",async(i,o,s)=>{let l=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==jE.Connected)return void s(new _u(Vt.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let p=this.filterTobeMutedTracks(i);if(p.length===0)return void o();let f=p.find(C=>C[0]==="videoLowTrack");f&&f[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(p.map(C=>{let[,{id:k}]=C;return k}));let _=!1;var d,h;i.trackMediaType==="video"?_=!((d=this.localTrackMap.get(_m.LocalAudioTrack))===null||d===void 0||!d.track._muted):_=((h=this.localTrackMap.get(_m.LocalVideoTrack))===null||h===void 0?void 0:h.id)===void 0;let g=this.createMuteMessage(p);await JE(this,fE.RequestMuteLocal,g);let b=i.trackMediaType==="video"?GI.MUTE_LOCAL_VIDEO:GI.MUTE_LOCAL_AUDIO;await JE(this,fE.RequestP2PMuteLocal,{action:b,message:g,isMuteAll:_}),o()}catch(p){s(p)}finally{l()}}),$(this,"handleUnmuteLocalTrack",async(i,o,s)=>{let l=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==jE.Connected)return void s(new _u(Vt.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let d=this.filterTobeUnmutedTracks(i);if(d.length===0)return void o();await this.sendConnection.unmuteLocal(d.map(f=>{let[,{id:_}]=f;return _}));let h=this.createUnmuteMessage(d),p=i.trackMediaType==="video"?GI.UNMUTE_LOCAL_VIDEO:GI.UNMUTE_LOCAL_AUDIO;await JE(this,fE.RequestP2PMuteLocal,{action:p,message:h}),o()}catch(d){s(d)}finally{l()}}),$(this,"handleUpdateVideoEncoder",async(i,o,s)=>{let l=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{let d=this.localTrackMap.get(_m.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==i||this.state!==jE.Connected)return void o();let{id:h,track:p}=d;h&&(await this.sendConnection.updateSendParameters(h,p),await this.sendConnection.updateEncoderConfig(h,p),this.emit(fE.UpdateVideoEncoder,p)),o()}catch(d){s(d)}finally{l()}}),$(this,"handleUpdateVideoSendParameters",async(i,o,s)=>{let l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let d=this.localTrackMap.get(_m.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==i||this.state!==jE.Connected)return void o();let{id:h,track:p}=d;h&&await this.sendConnection.updateSendParameters(h,p),o()}catch(d){s(d)}finally{l()}}),$(this,"handleReplaceTrack",async(i,o,s,l)=>{let d;B.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof l=="boolean"&&l||(d=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var h;let f=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:g}]=_;return i===g});if(!this.sendConnection||!f||f[1].id===void 0||this.state!==jE.Connected)return void o();if(await((h=this.sendConnection)===null||h===void 0?void 0:h.replaceTrack(i,f[1].id)),f[0]===_m.LocalVideoTrack&&ME().supportDualStreamEncoding){let _=this.localTrackMap.get(_m.LocalVideoLowTrack);if(_){let g=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=g,_.track._originMediaStreamTrack=g,await new eE((b,C)=>{this.handleReplaceTrack(_.track,b,C,!0)})}}o()}catch(f){s(f)}finally{var p;(p=d)===null||p===void 0||p()}}),$(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),$(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new A3(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},_r("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,r){throw new _u(Vt.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new _u(Vt.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,r){let i;try{if(r){this.recvConnection&&(B.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Gtt(e,this.store,L0.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=jE.New,this.sendConnection&&(B.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Gtt(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new _u(Vt.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=jE.Connected}async addRemoteCandidate(e,r){if(r===L0.RECEIVE_ONLY){if(!this.sendConnection)throw new _u(Vt.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new _u(Vt.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,r,i){var o=this;return YS(function*(){let s=yield PE(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==jE.Connected){o.throwIfTrackTypeNotMatch(e);let f=e.filter(_=>o.pendingLocalTracks.indexOf(_)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(f))}o.store.pubId=o.store.pubId+1,p0.markPublishStart(o.store.clientId,o.store.pubId);let l=o.filterTobePublishedTracks(e,r,i);if(l.length===0)return void(yield PE(o.tryToUnmuteAudio(e)));l.forEach(f=>{let{track:_,type:g}=f,b=Date.now();o.store.publish(_.getTrackId(),g===_m.LocalAudioTrack?"audio":"video",b)}),o.bindLocalTrackEvents(l);let d=yield PE(o.sendConnection.send(l.map(f=>{let{track:_}=f;return _}),o.store.codec,o.store.audioCodec)),h=(yield PE(d.next())).value,p=o.createGatewayPublishMessage(l,h);try{yield p}catch(f){throw d.throw(f),f?.code===Vt.WS_ABORT&&l.forEach(_=>{let{track:g}=_;o.pendingLocalTracks.indexOf(g)===-1&&o.pendingLocalTracks.push(g)}),o.unbindLocalTrackEvents(l),f}yield PE(d.next()),l.forEach(f=>{let{type:_}=f;o.statsCollector.addLocalStats(_)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(l,h),l.forEach(f=>{let{track:_,type:g}=f,b=Date.now();o.store.publish(_.getTrackId(),g===_m.LocalAudioTrack?"audio":"video",void 0,b)}),o.startUploadUplinkState()}finally{s()}})()}async unpublish(e){if(!this.sendConnection||this.state!==jE.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(s=>!nE(e).call(e,s)));let r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;let i=r.find(s=>s[0]==="videoLowTrack");i&&i[1].track.close();let o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(s=>{let[,{id:l}]=s;return l})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(s=>{let[l,{track:d}]=s;return{type:l,track:d}})),r.forEach(s=>{let[l]=s;this.statsCollector.removeLocalStats(l)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===jE.Connected)return i&&i[1].track.close(),o;e.forEach(s=>{let l=this.pendingLocalTracks.indexOf(s);l!==-1&&this.pendingLocalTracks.splice(l,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[s,{track:l,ssrcs:d}]=o,h={stream_type:GRt(l,s),ssrcs:d};l._muted||!l._enabled?r.push(h):i.push(h)}),r.length>0&&r.forEach(o=>{JE(this,fE.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{JE(this,fE.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return YS(function*(){throw new _u(Vt.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(B.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await c0(this,fE.RequestRePublish,this.pendingLocalTracks),this.emit(fE.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new _u(Vt.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,r,i,o){var s;if(!this.recvConnection)throw new _u(Vt.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(r))return;let{track:l,mid:d,transceiver:h}=await this.recvConnection.receive(r,[{ssrcId:i}],String(e.uid),o);r===cE.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new C1(l,e.uid,e._uintid,this.store),B.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new I1(l,e.uid,e._uintid,this.store),B.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack));let p=this.remoteUserMap.get(e);p?p.set(r,d):this.remoteUserMap.set(e,new Map([[r,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let f=this.pendingRemoteTracks.findIndex(_=>{let{user:g,kind:b}=_;return g.uid===e.uid&&r===b});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(fE.MediaReconnectEnd,e.uid))}async mockSubscribe(e,r,i,o){if(!this.recvConnection)throw new _u(Vt.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,r,i){let o=this.pendingRemoteTracks.filter(l=>{let{user:d,kind:h}=l;return r!==void 0?d.uid===e.uid&&r===h:d.uid===e.uid});if(o.forEach(l=>{let d=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(d,1)}),this.recvConnection||i||o.forEach(l=>{let{kind:d}=l;var h;if(d===cE.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(d===cE.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let s=this.filterTobeUnSubscribedTracks(e,r);s.length!==0&&(await this.recvConnection.stopReceiving(s.map(l=>{let[,{id:d}]=l;return d})),this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),s.forEach(l=>{let[d,{kind:h}]=l;var p,f;if(h===cE.VIDEO&&d._videoSSRC&&((p=this.recvConnection)===null||p===void 0||p.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===cE.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),i||((f=d._videoTrack)===null||f===void 0||f._destroy(),d._videoTrack=void 0);else if(h===cE.AUDIO){var _;this.unbindRemoteTrackEvents(d._audioTrack),!i&&((_=d._audioTrack)===null||_===void 0||_._destroy(),d._audioTrack=void 0)}}),s.forEach(l=>{let[,{kind:d}]=l;JE(this,fE.RequestP2PMuteRemote,d)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[cE.VIDEO,cE.AUDIO].forEach(o=>{i.has(o)?JE(this,fE.RequestP2PUnmuteRemote,o):JE(this,fE.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new _u(Vt.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new _u(Vt.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new _u(Vt.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new _u(Vt.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,r){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void B.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void B.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));let o=r===cE.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.recvConnection)return;let i=this.remoteUserMap.get(e);if(!i)return void B.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||B.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){let r=this.localTrackMap.get(_m.LocalAudioTrack);if(r?.track instanceof D_){let i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[s]=o;return s!==_m.LocalAudioTrack}).filter(o=>{let[s]=o;return!(e&&s===_m.LocalVideoLowTrack)}).map(o=>{let[,{track:s}]=o;return s}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===_m.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,r,i,o,s){if(e){let d=this.localTrackMap.get(_m.LocalAudioTrack),h=o?this.localTrackMap.get(_m.LocalVideoLowTrack):this.localTrackMap.get(_m.LocalVideoTrack);aE.publish(this.store.sessionId,{eventElapse:p0.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:d?.track.getTrackLabel(),videoName:h?.track.getTrackLabel(),screenshare:h?.track._hints.indexOf(XE.SCREEN_TRACK)!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var l;i||(i=[]);let d=i.find(p=>p instanceof h_),h=o?(l=this.localTrackMap.get(_m.LocalVideoTrack))===null||l===void 0?void 0:l.track:i.find(p=>p instanceof e_);aE.publish(this.store.sessionId,{eventElapse:p0.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:d?.getTrackLabel(),videoName:h?.getTrackLabel(),screenshare:h?._hints.indexOf(XE.SCREEN_TRACK)!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,r,i,o){let s=o===cE.VIDEO?i._videoSSRC:i._audioSSRC;s&&aE.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===cE.VIDEO,audio:o===cE.AUDIO,peerid:i.uid,subscribeRequestid:o===cE.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:p0.measureFromSubscribeStart(this.store.clientId,s)})}reset(){B.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new f0("P2PChannel2-send-mutex"),this.sendMutex=new f0("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(_m.LocalAudioTrack);if(e?.track instanceof D_){if(e.track.trackList.length>0){let r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=jE.Disconnected}getStats(e){var r,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(_m.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(_m.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let r=this.localTrackMap.get(e);return r&&r.track instanceof e_||r&&r.track instanceof h_?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;let i=Array.from(RS(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}}),r=this.localTrackMap.get(_m.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=HL(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(B.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=jE.Reconnecting,_r("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case _m.LocalVideoTrack:nE(r=o._hints).call(r,XE.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case _m.LocalAudioTrack:o instanceof D_?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case _m.LocalVideoLowTrack:}}),this.emit(fE.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(RS(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(fE.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),B.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,r){for(let i of this.pendingRemoteTracks){let{user:o,kind:s}=i;if((e instanceof gR?e.uid:e)===o.uid&&r===s)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}async restartICE(e,r){let i,o;if(e===L0.SEND_ONLY){if(!this.sendConnection)throw new _u(Vt.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new _u(Vt.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){let s=await o.restartICE(r);return o.isInRestartIce=!1,s}{let s=await o.restartICE();if(s){let l=await c0(this,fE.RequestP2PRestartICE,{direction:L0.RECEIVE_ONLY,iceParameter:s});await o.restartICE(l),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),r=this.localTrackMap.get(_m.LocalVideoTrack),i=this.localTrackMap.get(_m.LocalAudioTrack),o=e.videoSend.find(C=>{var k;return C.ssrc===(r==null||(k=r.ssrcs)===null||k===void 0?void 0:k[0].ssrcId)}),s=e.audioSend.find(C=>{var k;return C.ssrc===(i==null||(k=i.ssrcs)===null||k===void 0?void 0:k[0].ssrcId)});if(!o||!s)return 1;let l=JS(this,fE.NeedSignalRTT),d=o?o.rttMs:void 0,h=s?s.rttMs:void 0,p=d&&h?(d+h)/2:d||h,f=(p&&l?(p+l)/2:p||l)||0,_=100*e.sendPacketLossRate*.7/50+.3*f/1500,g=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,b=r?.track;if(b&&b._encoderConfig&&b._hints.indexOf(XE.SCREEN_TRACK)===-1){let C=b._encoderConfig.bitrateMax,k=e.bitrate.actualEncoded;if(C&&k){let A=(1e3*C-k)/(1e3*C);return cst[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i,s=o._audioSSRC,l=o._videoSSRC,d=e.audioRecv.find(k=>k.ssrc===s),h=e.videoRecv.find(k=>k.ssrc===l);if(!d&&!h)return void(r+=1);let p=JS(this,fE.NeedSignalRTT),f=e.rtt,_=(f&&p?(f+p)/2:f||p)||0,g=d?d.jitterMs:void 0,b=e.recvPacketLossRate,C=.7*b*100/50+.3*_/1500;g&&(C=.6*b*100/50+.2*_/1500+.2*g/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new eE((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}filterTobePublishedTracks(e,r,i){let o=[],s=ME(),l=this.getAllTracks();e=E1(e=e.filter(p=>l.indexOf(p)===-1));let d=!1,h=!1;for(let p of e){if(p instanceof e_&&(this.localTrackMap.has(_m.LocalVideoTrack)||d?new _u(Vt.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:p,type:_m.LocalVideoTrack}),d=!0),r)){let f=this.getLowVideoTrack(p,i);o.push({track:f,type:_m.LocalVideoLowTrack})}if(p instanceof h_){let f=this.localTrackMap.get(_m.LocalAudioTrack);if(f){if(!(f.track instanceof D_))throw new _u(Vt.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new _u(Vt.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0)}else if(h){let _=o.find(g=>{let{type:b}=g;return b===_m.LocalAudioTrack});if(!(_.track instanceof D_))throw new _u(Vt.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(p._bypassWebAudio)throw new _u(Vt.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(p)}else{if(!s.webAudioMediaStreamDest||p instanceof D_||p._bypassWebAudio)o.push({track:p,type:_m.LocalAudioTrack});else{let _=new D_;_.addAudioTrack(p),o.push({track:_,type:_m.LocalAudioTrack})}h=!0}}}return o}filterTobeUnpublishedTracks(e){let r=[],i=this.getAllTracks();e=E1(e=e.filter(o=>i.indexOf(o)!==-1));for(let o of e){if(o instanceof h_){let s=this.localTrackMap.get(_m.LocalAudioTrack);if(!s)continue;s.track instanceof D_?(s.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),s.track.trackList.length===0&&(r.push([_m.LocalAudioTrack,s]),s.track.close())):r.push([_m.LocalAudioTrack,s])}if(o instanceof e_){let s=this.localTrackMap.get(_m.LocalVideoTrack);if(!s)continue;r.push([_m.LocalVideoTrack,s]);let l=this.localTrackMap.get(_m.LocalVideoLowTrack);l&&r.push([_m.LocalVideoLowTrack,l])}}return r}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case _m.LocalVideoTrack:i.addListener(iE.GET_STATS,this.handleGetLocalVideoStats),i.addListener(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(iE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(iE.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(iE.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _m.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case _m.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof D_?e.trackList.forEach(i=>{i.addListener(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(iE.GET_STATS,this.handleGetLocalAudioStats),i.addListener(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(iE.GET_STATS,this.handleGetLocalAudioStats),e.addListener(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||e.addListener(iE.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case _m.LocalVideoTrack:i.off(iE.GET_STATS,this.handleGetLocalVideoStats),i.off(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(iE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(iE.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(iE.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _m.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case _m.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof D_?e.trackList.forEach(r=>{r.off(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(iE.GET_STATS,this.handleGetLocalAudioStats),r.off(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(iE.GET_STATS,this.handleGetLocalAudioStats),e.off(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(iE.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof I1&&r.addListener(iE.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof C1&&r.addListener(iE.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(iE.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(cE.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(cE.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var s;let l,{track:d,type:h}=i;switch(h){case _m.LocalAudioTrack:l=VE.Audio;break;case _m.LocalVideoTrack:l=nE(s=d._hints).call(s,XE.SCREEN_TRACK)?VE.Screen:VE.High;break;case _m.LocalVideoLowTrack:l=VE.Low}return{kind:h===_m.LocalAudioTrack?cE.AUDIO:cE.VIDEO,stream_type:l,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:d.muted||!d.enabled}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[s,{track:l,ssrcs:d,id:h}]=r;switch(s){case _m.LocalVideoTrack:o=nE(i=l._hints).call(i,XE.SCREEN_TRACK)?VE.Screen:VE.High;break;case _m.LocalAudioTrack:o=VE.Audio;break;case _m.LocalVideoLowTrack:o=VE.Low}return{stream_type:o,ssrcs:d,mid:h}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:s,type:l}=i;this.localTrackMap.set(l,{track:s,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{var i;B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),this.emit(fE.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(e.isInRestartIce=!1),nE(i=this._restartStates).call(i,r)&&!e.isInRestartIce&&(r==="disconnected"&&await _y(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),aE.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:p_.TRACER}).onSuccess(),this.emit(fE.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;let o=Array.from(RS(i=this.remoteUserMap).call(i)).find(l=>l._audioSSRC===r);var s;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(s=o.audioTrack)===null||s===void 0||s.emit(w1.FIRST_FRAME_DECODED),aE.firstRemoteFrame(this.store.sessionId,Eg.FIRST_AUDIO_DECODE,d_.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:p0.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;let o=Array.from(RS(i=this.remoteUserMap).call(i)).find(s=>s._audioSSRC===r);o&&aE.firstRemoteFrame(this.store.sessionId,Eg.FIRST_AUDIO_RECEIVED,d_.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:p0.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;let o=Array.from(RS(i=this.remoteUserMap).call(i)).find(s=>s._videoSSRC===r);o&&aE.firstRemoteFrame(this.store.sessionId,Eg.FIRST_VIDEO_RECEIVED,d_.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:p0.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{let o=r.candidateType==="relay",s=i.candidateType==="relay";i.candidateType!=="unknown"&&o===s||this.emit(fE.ConnectionTypeChange,o),B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(qI(i))," -> ").concat(JSON.stringify(qI(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(qI(i))," -> ").concat(JSON.stringify(qI(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.onLocalCandidate=r=>{this.emit(fE.LocalCandidate,{candidate:r,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let r=e===L0.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,B.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),e===L0.SEND_ONLY?this.restartICE(e):c0(this,fE.RequestP2PRestartICE,{direction:L0.SEND_ONLY}))}filterTobeMutedTracks(e){let r=[];if(this.getAllTracks().indexOf(e)===-1)return r;let i=this.localTrackMap.get(_m.LocalAudioTrack);if(e instanceof h_&&i?.track instanceof D_)return i.track.isActive||r.push([_m.LocalAudioTrack,i]),r;let o=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:l}]=s;return e===l});if(o&&(r.push(o),o[0]===_m.LocalVideoTrack)){let s=this.localTrackMap.get(_m.LocalVideoLowTrack);s&&r.push([_m.LocalVideoLowTrack,s])}return r}filterTobeUnmutedTracks(e){let r=[],i=this.localTrackMap.get(_m.LocalAudioTrack);if(e instanceof h_&&i?.track instanceof D_)return i.track.isActive&&r.push([_m.LocalAudioTrack,i]),r;let o=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:l}]=s;return e===l});if(o)if(o[0]===_m.LocalVideoTrack){r.push(o);let s=this.localTrackMap.get(_m.LocalVideoLowTrack);s&&r.push([_m.LocalVideoLowTrack,s])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[s,{track:l,ssrcs:d,id:h}]=r;switch(s){case _m.LocalAudioTrack:o=VE.Audio;break;case _m.LocalVideoTrack:o=nE(i=l._hints).call(i,XE.SCREEN_TRACK)?VE.Screen:VE.High;break;case _m.LocalVideoLowTrack:o=VE.Low}return{stream_type:o,ssrcs:d,mid:h}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[s,{track:l,ssrcs:d,id:h}]=r;switch(s){case _m.LocalAudioTrack:o=VE.Audio;break;case _m.LocalVideoTrack:o=nE(i=l._hints).call(i,XE.SCREEN_TRACK)?VE.Screen:VE.High;break;case _m.LocalVideoLowTrack:o=VE.Low}return{stream_type:o,ssrcs:d,mid:h}})}filterTobeUnSubscribedTracks(e,r){let i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){let s=o.get(r);if(!s)return i;i.push([e,{kind:r,id:s}])}else Array.from(o.entries()).forEach(s=>{let[l,d]=s;i.push([e,{kind:l,id:d}])});return i}createUnsubscribeMessage(e){let r=[];return e.forEach(i=>{let[o,{kind:s,id:l}]=i;switch(s){case cE.VIDEO:return void(o._videoSSRC&&r.push({stream_type:cE.VIDEO,ssrcId:o._videoSSRC}));case cE.AUDIO:return void(o._audioSSRC&&r.push({stream_type:cE.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r,s=this.remoteUserMap.get(i);s&&(s.delete(o),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let r=this.localTrackMap.get(_m.LocalVideoTrack),i=this.localTrackMap.get(_m.LocalVideoLowTrack);r&&await r.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return e!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof h_){let i=this.filterTobeUnmutedTracks(e[r]);if(i.length===0)continue;let o=this.createUnmuteMessage(i);return void await JE(this,fE.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:r}]=e;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(fE.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(fE.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await _y(ZW(this.dtlsFailedCount,N_)),this.emit(fE.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(_m.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof e_)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof e_).length>1)throw new _u(Vt.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof h_).length>1&&(e.some(r=>r instanceof h_&&r._bypassWebAudio)||!ME().webAudioMediaStreamDest))throw new _u(Vt.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let r of e){if(r instanceof e_&&this.pendingLocalTracks.some(i=>i instanceof e_))throw new _u(Vt.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof h_&&this.pendingLocalTracks.some(i=>i instanceof h_)&&(!ME().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof h_&&i._bypassWebAudio)))throw new _u(Vt.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){let i=!_r("DISABLE_DUAL_STREAM_USE_ENCODING")&&ME().supportDualStreamEncoding,o=oU(oU({},{width:160,height:120,framerate:15,bitrate:50}),r),s;s=i?e._mediaStreamTrack.clone():J8(e,o);let l=ZE(8,"track-low-"),d=new e_(s,oU(oU({},i&&{scaleResolutionDownBy:N8(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,l);return d.on(YO.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,x1.LOW_STREAM)}),d._hints.push(XE.LOW_STREAM),e.addListener(iE.NEED_CLOSE,()=>{d.close()}),d}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,r,i,o){var s;let l=Array.from(RS(s=this.remoteUserMap).call(s)).find(d=>d._videoSSRC===e);if(l){o||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());let d=this.store.keyMetrics,h=d.subscribe.find(p=>p.userId===l.uid&&p.type==="video");aE.firstRemoteVideoDecode(this.store.sessionId,Eg.FIRST_VIDEO_DECODE,d_.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:r,videoheight:i,subscribeElapse:p0.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:h?.subscribeEnd||0,subscriberStart:h?.subscribeStart||0,videoAddNotify:h?.streamAdded||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.recvConnection)return!1;let o=this.remoteUserMap.get(e);if(!o)return!1;let s=o.get(r);if(!s)return!1;let l=await this.recvConnection.getRemoteSSRC(s);return l!==void 0&&l!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new _u(Vt.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new _u(Vt.NOT_SUPPORTED)}async subscribeDataChannel(e,r){throw new _u(Vt.NOT_SUPPORTED)}async unsubscribeDataChannel(e,r){throw new _u(Vt.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,r){throw new _u(Vt.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,r){throw new _u(Vt.NOT_SUPPORTED)}async preConnect(e){throw new _u(Vt.NOT_SUPPORTED)}getEstablishParams(){throw new _u(Vt.NOT_SUPPORTED)}async reSubscribe(e){throw new _u(Vt.NOT_SUPPORTED)}async updateVideoStreamParameter(e,r){throw new _u(Vt.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===_m.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,x1.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},oE(i_.prototype,"p2pConnect",[Htt],Object.getOwnPropertyDescriptor(i_.prototype,"p2pConnect"),i_.prototype),oE(i_.prototype,"unpublish",[Ktt],Object.getOwnPropertyDescriptor(i_.prototype,"unpublish"),i_.prototype),oE(i_.prototype,"unpublishLowStream",[ztt],Object.getOwnPropertyDescriptor(i_.prototype,"unpublishLowStream"),i_.prototype),oE(i_.prototype,"subscribe",[Ytt],Object.getOwnPropertyDescriptor(i_.prototype,"subscribe"),i_.prototype),oE(i_.prototype,"mockSubscribe",[Jtt],Object.getOwnPropertyDescriptor(i_.prototype,"mockSubscribe"),i_.prototype),oE(i_.prototype,"unsubscribe",[Xtt],Object.getOwnPropertyDescriptor(i_.prototype,"unsubscribe"),i_.prototype),oE(i_.prototype,"muteRemote",[Qtt],Object.getOwnPropertyDescriptor(i_.prototype,"muteRemote"),i_.prototype),oE(i_.prototype,"unmuteRemote",[Ztt],Object.getOwnPropertyDescriptor(i_.prototype,"unmuteRemote"),i_.prototype),oE(i_.prototype,"hasRemoteMediaWithLock",[$tt],Object.getOwnPropertyDescriptor(i_.prototype,"hasRemoteMediaWithLock"),i_.prototype),oE(i_.prototype,"disconnectForReconnect",[tet],Object.getOwnPropertyDescriptor(i_.prototype,"disconnectForReconnect"),i_.prototype),oE(i_.prototype,"remoteMediaSsrcChanged",[eet],Object.getOwnPropertyDescriptor(i_.prototype,"remoteMediaSsrcChanged"),i_.prototype),i_);function qT(e){return function(r,i,o){let s=r[i];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];switch(e){case zT.SEND_ONLY:{let p=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await s.apply(this,d)}finally{p()}}case zT.RECEIVE_ONLY:{let p=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await s.apply(this,d)}finally{p()}}default:{let p=await this.sendMutex.lock("From P2PChannel2.".concat(i)),f=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await s.apply(this,d)}finally{p(),f()}}}},o}}function ret(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function OO(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?ret(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ret(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var O3=class e{constructor(r){$(this,"store",void 0),$(this,"onStatsException",void 0),$(this,"onUploadPublishDuration",void 0),$(this,"onStatsChanged",void 0),$(this,"localStats",new Map),$(this,"remoteStats",new Map),$(this,"updateStatsInterval",void 0),$(this,"trafficStats",void 0),$(this,"trafficStatsPeerList",[]),$(this,"uplinkStats",void 0),$(this,"exceptionMonitor",void 0),$(this,"p2pChannel",void 0),$(this,"scalabilityMode",w8.L1T1),$(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new H8,this.exceptionMonitor.on("exception",(i,o,s)=>{this.onStatsException&&this.onStatsException(i,o,s)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(_m.LocalAudioTrack)||OO({},D8)}getLocalVideoTrackStats(){return this.localStats.get(_m.LocalVideoTrack)||OO({},L8)}getRemoteAudioTrackStats(r){let i=(l,d)=>{if(!this.trafficStats)return d;let h=this.trafficStats.peer_delay.find(p=>p.peer_uid===l);return h&&(d.publishDuration=h.B_ppad+(Date.now()-this.trafficStats.timestamp)),d},o={};if(r){var s;let l=(s=this.remoteStats.get(r))===null||s===void 0?void 0:s.audioStats;l&&(o[r]=i(r,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[d,{audioStats:h}]=l;h&&(o[d]=i(d,h))});return o}getRemoteNetworkQualityStats(r){let i={};if(r){var o;let s=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;s&&(i[r]=s)}else Array.from(this.remoteStats.entries()).forEach(s=>{let[l,{networkStats:d}]=s;d&&(i[l]=d)});return i}getRemoteVideoTrackStats(r){let i=(l,d)=>{if(!this.trafficStats)return d;let h=this.trafficStats.peer_delay.find(p=>p.peer_uid===l);return h&&(d.publishDuration=h.B_ppvd+(Date.now()-this.trafficStats.timestamp)),d},o={};if(r){var s;let l=(s=this.remoteStats.get(r))===null||s===void 0?void 0:s.videoStats;l&&(o[r]=i(r,l))}else Array.from(this.remoteStats.entries()).forEach(l=>{let[d,{videoStats:h}]=l;h&&(o[d]=i(d,h))});return o}getRTCStats(){let r=0,i=0,o=0,s=0,l=this.localStats.get(_m.LocalAudioTrack);l&&(r+=l.sendBytes,i+=l.sendBitrate);let d=this.localStats.get(_m.LocalVideoTrack);d&&(r+=d.sendBytes,i+=d.sendBitrate);let h=this.localStats.get(_m.LocalVideoLowTrack);h&&(r+=h.sendBytes,i+=h.sendBitrate),this.remoteStats.forEach(f=>{let{audioStats:_,videoStats:g}=f;_&&(o+=_.receiveBytes,s+=_.receiveBitrate),g&&(o+=g.receiveBytes,s+=g.receiveBitrate)});let p=1;return this.trafficStats&&(p+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:p,SendBitrate:i,SendBytes:r,RecvBytes:o,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;let s=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),l=s!=null&&s.videoSSRC?p0.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,d=s!=null&&s.audioSSRC?p0.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,l>d?l:d),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&B.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,o){if(!r)return!1;let s=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,l=!o||i.framesDecodeCount>o.framesDecodeCount;return s||!l}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[o,s]=i;switch(o){case _m.LocalVideoTrack:case _m.LocalVideoLowTrack:{let d=s,h=OO({},L8),p=r.getStats(),f=r.getLocalMedia(o);if(p){let _=p.videoSend.find(g=>g.ssrc===f?.ssrcs[0].ssrcId);if(_){let g=r.getLocalVideoSize(),b=r.getEncoderConfig(_m.LocalVideoTrack);_.codec!=="H264"&&_.codec!=="H265"&&_.codec!=="VP8"&&_.codec!=="VP9"&&_.codec!=="AV1X"&&_.codec!=="AV1"||(h.codecType=_.codec),h.sendBytes=_.bytes,h.sendBitrate=d?8*Math.max(0,h.sendBytes-d.sendBytes):0,_.inputFrame?(h.captureFrameRate=_.inputFrame.frameRate,h.captureResolutionHeight=_.inputFrame.height,h.captureResolutionWidth=_.inputFrame.width):g&&(h.captureResolutionWidth=g.width,h.captureResolutionHeight=g.height),_.sentFrame?(h.sendFrameRate=_.sentFrame.frameRate,h.sendResolutionHeight=_.sentFrame.height,h.sendResolutionWidth=_.sentFrame.width):g&&(h.sendResolutionWidth=g.width,h.sendResolutionHeight=g.height),_.avgEncodeMs&&(h.encodeDelay=_.avgEncodeMs),b&&b.bitrateMax&&(h.targetSendBitrate=1e3*b.bitrateMax),h.sendPackets=_.packets,h.sendPacketsLost=_.packetsLost,h.sendJitterMs=_.jitterMs,h.sendRttMs=_.rttMs,h.totalDuration=d?d.totalDuration+1:1,h.totalFreezeTime=d?d.totalFreezeTime:0,this.isLocalVideoFreeze(_)&&(h.totalFreezeTime+=1),_.scalabilityMode&&this.scalabilityMode!==_.scalabilityMode&&(B.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(_.scalabilityMode)),this.scalabilityMode=_.scalabilityMode)}this.trafficStats&&(h.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var l;this.localStats.set(o,h),(d?.sendResolutionWidth!==h.sendResolutionWidth||d?.sendResolutionHeight!==h.sendResolutionHeight)&&((l=this.onStatsChanged)===null||l===void 0||l.call(this,"resolution",{width:h.sendResolutionWidth,height:h.sendResolutionHeight})),h&&f&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,f.track,h);break}case _m.LocalAudioTrack:{let d=s,h=OO({},D8),p=r.getStats(),f=r.getLocalMedia(o);if(p){let _=p.audioSend.find(g=>g.ssrc===f?.ssrcs[0].ssrcId);if(_){if(_.codec!=="opus"&&_.codec!=="aac"&&_.codec!=="PCMU"&&_.codec!=="PCMA"&&_.codec!=="G722"||(h.codecType=_.codec),_.inputLevel)h.sendVolumeLevel=Math.round(32767*_.inputLevel);else{let g=r.getLocalAudioVolume();g&&(h.sendVolumeLevel=Math.round(32767*g))}h.sendBytes=_.bytes,h.sendPackets=_.packets,h.sendPacketsLost=_.packetsLost,h.sendJitterMs=_.jitterMs,h.sendRttMs=_.rttMs,h.sendBitrate=d?8*Math.max(0,h.sendBytes-d.sendBytes):0}}this.trafficStats&&(h.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(_m.LocalAudioTrack,h),h&&f&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,f.track,h);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var o,s;let[l,{videoStats:d,audioStats:h,videoPcStats:p}]=i,f=h,_=d,g=p,b=OO({},Sst),C=OO({},Tst),k=OO({},mRt),{audioTrack:A,videoTrack:P,audioSSRC:x,videoSSRC:j}=r.getRemoteMedia(l),z;z=r instanceof uS?r.getStats(!0):r.getStats();let _t=(o=z)===null||o===void 0?void 0:o.audioRecv.find(Ei=>Ei.ssrc===x),ue=(s=z)===null||s===void 0?void 0:s.videoRecv.find(Ei=>Ei.ssrc===j),_n=this.trafficStats&&this.trafficStats.peer_delay.find(Ei=>Ei.peer_uid===l);if(_t&&(_t.codec!=="opus"&&_t.codec!=="aac"&&_t.codec!=="PCMU"&&_t.codec!=="PCMA"&&_t.codec!=="G722"||(b.codecType=_t.codec),_t.outputLevel?b.receiveLevel=Math.round(32767*_t.outputLevel):A&&(b.receiveLevel=Math.round(32767*A.getVolumeLevel())),b.receiveBytes=_t.bytes,b.receivePackets=_t.packets,b.receivePacketsLost=_t.packetsLost,b.receivePacketsDiscarded=_t.packetsDiscarded,b.packetLossRate=b.receivePacketsLost/(b.receivePackets+b.receivePacketsLost),b.receiveBitrate=f?8*Math.max(0,b.receiveBytes-f.receiveBytes):0,b.totalDuration=f?f.totalDuration+1:1,b.totalFreezeTime=f?f.totalFreezeTime:0,b.freezeRate=b.totalFreezeTime/b.totalDuration,b.receiveDelay=_t.jitterBufferMs,b.totalDuration>10&&e.isRemoteAudioFreeze(A)&&(b.totalFreezeTime+=1)),ue){ue.codec!=="H264"&&ue.codec!=="H265"&&ue.codec!=="VP8"&&ue.codec!=="VP9"&&ue.codec!=="AV1X"&&ue.codec!=="AV1"||(C.codecType=ue.codec),C.receiveBytes=ue.bytes,C.receiveBitrate=_?8*Math.max(0,C.receiveBytes-_.receiveBytes):0,C.decodeFrameRate=ue.decodeFrameRate<0?0:ue.decodeFrameRate,C.renderFrameRate=ue.decodeFrameRate<0?0:ue.decodeFrameRate,ue.outputFrame&&(C.renderFrameRate=ue.outputFrame.frameRate),ue.receivedFrame?(C.receiveFrameRate=ue.receivedFrame.frameRate,C.receiveResolutionHeight=ue.receivedFrame.height,C.receiveResolutionWidth=ue.receivedFrame.width):P&&(C.receiveResolutionHeight=P._videoHeight||0,C.receiveResolutionWidth=P._videoWidth||0),ue.framesRateFirefox!==void 0&&(C.receiveFrameRate=Math.round(ue.framesRateFirefox)),C.receivePackets=ue.packets,C.receivePacketsLost=ue.packetsLost,C.packetLossRate=C.receivePacketsLost/(C.receivePackets+C.receivePacketsLost),C.totalDuration=_?_.totalDuration+1:1,C.totalFreezeTime=_?_.totalFreezeTime:0,C.receiveDelay=ue.jitterBufferMs||0;let Ei=!!j&&r.getRemoteVideoIsReady(j);P&&Ei&&e.isRemoteVideoFreeze(P,ue,g)&&(C.totalFreezeTime+=1),C.freezeRate=C.totalFreezeTime/C.totalDuration}_n&&(b.end2EndDelay=_n.B_ad,C.end2EndDelay=_n.B_vd,b.transportDelay=_n.B_ed,C.transportDelay=_n.B_ed,b.currentPacketLossRate=_n.B_ealr4/100,C.currentPacketLossRate=_n.B_evlr4/100,k.uplinkNetworkQuality=_n.B_punq?_n.B_punq:0,k.downlinkNetworkQuality=_n.B_pdnq?_n.B_pdnq:0),this.remoteStats.set(l,{audioStats:b,videoStats:C,videoPcStats:ue,networkStats:k}),A&&this.exceptionMonitor.setRemoteAudioStats(A,b),P&&this.exceptionMonitor.setRemoteVideoStats(P,C)})}},N3=class{constructor(){$(this,"destChannelMediaInfos",new Map),$(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){aZ(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){aZ(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){fV(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}};function iet(e){if(!(e instanceof N3))return new _a(Vt.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let r=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!r)return new _a(Vt.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new _a(Vt.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function oet(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function set(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?oet(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):oet(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var YE;function aet(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function sU(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?aet(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):aet(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var CD=(YE=class BD extends s3{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return nE(i=Object.keys(pV)).call(i,r)}))]}constructor(r,i){super(r,i),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"statsFilter",void 0),$(this,"useRTX",!1),$(this,"localCapabilities",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"establishPromise",void 0),$(this,"mutex",new f0("P2PConnection-mutex")),this.store=i,this.peerConnection=new RTCPeerConnection(BD.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=mH(this.peerConnection,_r("STATS_UPDATE_INTERVAL"),void 0,f_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=HI(r.sdp),o=wL(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:_r("FILTER_VIDEO_FEC"),filterAudioFec:_r("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,sU(sU({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new _u(Vt.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(o){$(this,"sessionDesc",void 0),$(this,"localCapabilities",void 0),$(this,"rtpCapabilities",void 0),$(this,"candidates",void 0),$(this,"iceParameters",void 0),$(this,"dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),o=R_(o);let{iceParameters:s,dtlsParameters:l,candidates:d,rtpCapabilities:h,setup:p,localCapabilities:f,sdkCodec:_,cname:g}=o,b=_v.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=h,this.candidates=d,this.iceParameters=s,this.dtlsParameters=l,this.setup=p,this.localCapabilities=f,this.cname=g;for(let C=0;C<b.mediaDescriptions.length;C++){let k=b.mediaDescriptions[C];if(k.attributes.iceUfrag=s.iceUfrag,k.attributes.icePwd=s.icePwd,k.attributes.fingerprints=l.fingerprints,k.attributes.candidates=d,k.attributes.setup=p,k.media.mediaType==="video"){k.media.fmts=h.videoCodecs.map(P=>P.payloadType.toString(10));let A=h.videoCodecs.filter(P=>{var x,j;return(x=P.rtpMap)===null||x===void 0?void 0:nE(j=x.encodingName.toLowerCase()).call(j,_)});A.length===0&&(A=h.videoCodecs),k.attributes.payloads=A,k.attributes.extmaps=h.videoExtensions}k.media.mediaType==="audio"&&(k.media.fmts=h.audioCodecs.map(A=>A.payloadType.toString(10)),k.attributes.payloads=h.audioCodecs,k.attributes.extmaps=h.audioExtensions),b.mediaDescriptions[C]=this.mungMediaDesc(k)}this.sessionDesc=b,this.currentMidIndex=b.mediaDescriptions.length-1}toString(){return _v.print(this.sessionDesc)}send(o,s,l){let{ssrcs:d,ssrcGroups:h}=UO(s,this.cname),p=this.sessionDesc.mediaDescriptions.find(g=>o===cE.VIDEO?g.media.mediaType==="video":g.media.mediaType==="audio"),f=d[0].attributes.label,_=d[0].attributes.mslabel;return p.attributes.ssrcs=p.attributes.ssrcs.concat(d),p.attributes.ssrcGroups=p.attributes.ssrcGroups.concat(h),{id:f,mslabel:_}}batchSend(o){return o.map(s=>{let{kind:l,ssrcMsg:d}=s;return this.send(l,d,void 0)})}stopSending(o){this.sessionDesc.mediaDescriptions.forEach(s=>{let l=[],d=[],h=[];s.attributes.ssrcs.forEach(p=>{nE(o).call(o,p.attributes.label||"")?h.push(p):l.push(p)}),s.attributes.ssrcGroups.forEach(p=>{var f;nE(f=h.map(_=>_.ssrcId)).call(f,p.ssrcIds[0])||d.push(p)}),s.attributes.ssrcs=l,s.attributes.ssrcGroups=d})}mute(o){let s=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===o);if(!s)throw new Error("mediaDescription not found with ".concat(o," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(o){let s=this.sessionDesc.mediaDescriptions.find(l=>l.attributes.mid===o);if(!s)throw new Error("mediaDescription not found with ".concat(o," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(o,s,l){o.forEach((d,h)=>{let p=d._mediaStreamTrack,f=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===p.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[f],d);this.sessionDesc.mediaDescriptions[f]=_})}stopReceiving(o){}updateCandidates(o){o===hS.TCP?this.candidates.forEach(s=>{this.candidates.findIndex(l=>l.transport==="tcp"&&l.connectionAddress===s.connectionAddress&&l.port===s.port)===-1&&this.candidates.push(set(set({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}):this.candidates=this.candidates.filter(s=>s.transport!=="tcp");for(let s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}restartICE(o){o=R_(o),this.iceParameters=o,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=o.iceUfrag,s.attributes.icePwd=o.icePwd})}predictReceivingMids(o){let s=[];for(let l=0;l<o;l++)s.push((this.currentMidIndex+l+1).toString(10));return s}mungRecvMediaDsec(o,s){let l=R_(o);return V1(l,s),lH(l,s),l}updateRecvMedia(o,s){let l=this.sessionDesc.mediaDescriptions.findIndex(d=>d.attributes.mid===o);if(l!==-1){let d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],s);this.sessionDesc.mediaDescriptions[l]=d}}bumpMid(o){this.currentMidIndex+=o}updateTrackLabel(o,s,l){let d=this.sessionDesc.mediaDescriptions.find(p=>o===cE.VIDEO?p.attributes.mid==="video":p.attributes.mid==="audio");if(d){let p=d.attributes.ssrcs.find(f=>f.attributes.label===s);var h;p&&(p.attributes.label=l,(h=p.attributes.msid)===null||h===void 0||h.replace(s,l))}}mungMediaDesc(o){let s=R_(o);return uH(s),function(l){let d=l.attributes.extmaps.find(h=>h.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");d&&l.attributes.extmaps.splice(l.attributes.extmaps.indexOf(d),1),l.attributes.payloads.forEach(h=>{let p=h.rtcpFeedbacks.findIndex(f=>f.type==="transport-cc");p!==-1&&h.rtcpFeedbacks.splice(p,1)})}(s),s}getSSRC(o){for(let s of this.sessionDesc.mediaDescriptions)for(let l of s.attributes.ssrcs)if(l.attributes.label===o)return[l]}}(sU(sU({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new _u(Vt.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var o=this;return YS(function*(){let s=yield PE(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let l=r.map(b=>o.peerConnection.addTrack(b._mediaStreamTrack)),d=yield PE(o.peerConnection.createOffer()),h=_v.parse(d.sdp),p=r.map(b=>{let C=b._mediaStreamTrack,k=h.mediaDescriptions.find(A=>A.attributes.mid===C.kind);if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return function(A,P,x){let j=A.attributes.ssrcs.filter(_t=>_t.attributes.label===P),z=A.attributes.ssrcGroups;if(j.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(z&&j.length>1){let _t=z.find(ue=>ue.ssrcIds.indexOf(j[0].ssrcId)!==-1);return _t?[{ssrcId:_t.ssrcIds[0],rtx:x?_t.ssrcIds[1]:void 0}]:[{ssrcId:j[0].ssrcId}]}return[{ssrcId:j[0].ssrcId}]}(k,C.id,o.useRTX)}),f;try{f=yield p}catch(b){throw l.forEach(C=>{a0()&&C.replaceTrack(null),o.peerConnection.removeTrack(C)}),b}let _=o.mungSendOfferSDP(d.sdp,r);o.remoteSDP.receive(r,i,f);let g=o.remoteSDP.toString();return yield PE(o.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield PE(o.applySendEncodings(l,r)),yield PE(o.peerConnection.setRemoteDescription({type:"answer",sdp:g})),r.map((b,C)=>{let k=b._mediaStreamTrack.id;return{localSSRC:p[C],id:k}})}catch(l){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{s()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getSenders().filter(l=>{var d;return r.indexOf(((d=l.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(l=>{a0()&&l.replaceTrack(null),this.peerConnection.removeTrack(l)});let o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,o,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));let{id:l,mslabel:d}=this.remoteSDP.send(r,i,s),h=new eE((_,g)=>{let b=setTimeout(()=>{g(new Error("Cannot receive track, id: ".concat(l)))},1e4),C=k=>{let A=DE();if((A.name==="Safari"&&Number(A.version)===11||U0())&&k.track.id!==l&&k.streams[0].id===d){var P;let x=k.streams[0].getTracks()[0];return(P=this.remoteSDP)===null||P===void 0||P.updateTrackLabel(r,l,k.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(b),void _(x)}if(k.track.id===l)return this.peerConnection.removeEventListener("track",C),clearTimeout(b),void _(k.track)};this.peerConnection.addEventListener("track",C)}),p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});let f=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(f),{track:await h,id:l}}catch(l){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(o=>{var s;return r.indexOf(((s=o.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(a0()&&o.track)o.track.enabled=!1;else{let s=o.getParameters();s.encodings.forEach(l=>l.active=!1),o.setParameters(s)}})}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getSenders().filter(l=>{var d;return r.indexOf(((d=l.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async l=>{if(a0()&&l.track)l.track.enabled=!0;else{let d=l.getParameters();d.encodings.forEach(h=>h.active=!0),await l.setParameters(d)}});let o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return YS(function*(){let o=yield PE(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ME().supportPCSetConfiguration){let p=i.peerConnection.getConfiguration(),f=r===hS.RELAY?"relay":"all";p.iceTransportPolicy!==f&&(B.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(f,"]")),p.iceTransportPolicy=f,i.peerConnection.setConfiguration(p))}else if(r===hS.RELAY)return;r!==hS.RELAY&&i.remoteSDP.updateCandidates(r);let s=yield PE(i.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let l=HI(s.sdp),{remoteIceParameters:d}=yield l.iceParameters;i.remoteSDP.restartICE(d);let h=i.remoteSDP.toString();yield PE(i.peerConnection.setLocalDescription(s)),yield PE(i.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(s){B.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),s)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);let l=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new _u(Vt.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){let o=this.peerConnection.getSenders().filter(s=>{var l;return((l=s.track)===null||l===void 0?void 0:l.id)===r});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){let o=this.peerConnection.getSenders().find(s=>{var l;return((l=s.track)===null||l===void 0?void 0:l.id)===i});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new _u(Vt.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new _u(Vt.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,B.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,B.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},_r("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){let i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(lV(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...BD.turnServerConfigToIceServers(r.turnServer.servers)),_r("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...BD.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){let i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var o;if(i||(i=this.peerConnection.getSenders().find(f=>{var _;return((_=f.track)===null||_===void 0?void 0:_.id)===r._mediaStreamTrack.id})),!i)return B.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!ME().supportSetRtpSenderParameters)return B.warn("Browser not support set rtp-sender parameters");let s={},l={};if(r instanceof e_)switch(r._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(_r("DSCP_TYPE")&&$I()){var d;let f=_r("DSCP_TYPE");nE(d=["very-low","low","medium","high"]).call(d,f)&&(l.networkPriority=f)}let h=i.getParameters(),p=(o=h.encodings)===null||o===void 0?void 0:o[0];p&&Object.assign(p,l),Object.assign(h,s),B.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await i.setParameters(h)}async applySendEncodings(r,i){try{if(!ME().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){let s=r[o],l=i[o];s&&l&&await this.updateRtpSenderEncodings(l,s)}}catch{B.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){let o=_v.parse(r);return i.forEach((s,l)=>{let d=s._mediaStreamTrack,h=o.mediaDescriptions.find(p=>p.attributes.mid===d.kind);h&&V1(h,s)}),_v.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let i=this.remoteSDP.batchSend(r).map((l,d)=>{let{id:h,mslabel:p}=l,{kind:f}=r[d];return new eE((_,g)=>{let b=setTimeout(()=>{g(new Error("Cannot receive track, id: ".concat(h)))},1e4),C=k=>{let A=DE();if(A.name==="Safari"&&Number(A.version)===11&&k.track.id!==h&&k.streams[0].id===p){var P;let x=k.streams[0].getTracks()[0];return(P=this.remoteSDP)===null||P===void 0||P.updateTrackLabel(f,h,k.track.id),this.peerConnection.removeEventListener("track",C),clearTimeout(b),void _({track:x,id:h})}if(k.track.id===h)return this.peerConnection.removeEventListener("track",C),clearTimeout(b),void _({track:k.track,id:h})};this.peerConnection.addEventListener("track",C)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});let s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await eE.all(i)}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(r);return i?.[0].ssrcId}setConfiguration(r){if(ME().supportPCSetConfiguration){let i=BD.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},oE(YE.prototype,"connect",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"connect"),YE.prototype),oE(YE.prototype,"stopSending",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"stopSending"),YE.prototype),oE(YE.prototype,"receive",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"receive"),YE.prototype),oE(YE.prototype,"stopReceiving",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"stopReceiving"),YE.prototype),oE(YE.prototype,"muteRemote",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"muteRemote"),YE.prototype),oE(YE.prototype,"unmuteRemote",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"unmuteRemote"),YE.prototype),oE(YE.prototype,"muteLocal",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"muteLocal"),YE.prototype),oE(YE.prototype,"unmuteLocal",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"unmuteLocal"),YE.prototype),oE(YE.prototype,"close",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"close"),YE.prototype),oE(YE.prototype,"updateEncoderConfig",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"updateEncoderConfig"),YE.prototype),oE(YE.prototype,"updateSendParameters",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"updateSendParameters"),YE.prototype),oE(YE.prototype,"replaceTrack",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"replaceTrack"),YE.prototype),oE(YE.prototype,"getRemoteSSRC",[FS],Object.getOwnPropertyDescriptor(YE.prototype,"getRemoteSSRC"),YE.prototype),YE);function FS(e,r,i){let o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let s=this.mutex,l=await s.lock("Locking from P2PConnection.".concat(r));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await o.apply(this,h)}finally{l()}},i}function cet(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function DI(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?cet(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):cet(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var AD="9",uet=4e4,Q8=class{get localCapabilities(){return R_(this._localCapabilities)}get rtpCapabilities(){return R_(this._rtpCapabilities)}get candidates(){return R_(this._candidates)}get iceParameters(){return R_(this._iceParameters)}get dtlsParameters(){return R_(this._dtlsParameters)}constructor(r){$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_iceParameters",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),$(this,"firefoxSsrcMidMap",new Map),r=R_(r);let{iceParameters:i,dtlsParameters:o,candidates:s,rtpCapabilities:l,setup:d,localCapabilities:h,cname:p}=r;this._rtpCapabilities=l,this._candidates=s,this._iceParameters=i,this._dtlsParameters=o,this._localCapabilities=h,this.setup=d,this.cname=p,this.sessionDesc=this.updateRemoteRTPCapabilities(l),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(r){let i=this.candidates,o=this.dtlsParameters,s=this.iceParameters,l=this.rtpCapabilities.send,d=this.sessionDesc.mediaDescriptions.length-1;for(let h=1;h<r;h++){let p=2*h+2e4,f=2*h+uet,{ssrcs:_,ssrcGroups:g}=UO([{ssrcId:p}],this.cname),{ssrcs:b,ssrcGroups:C}=UO([{ssrcId:f,rtx:_r("USE_SUB_RTX")?f+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:AD,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.videoCodecs.map(k=>k.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:i,extmaps:l.videoExtensions,fingerprints:o.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:b,ssrcGroups:C,rtcpFeedbackWildcards:[],payloads:l.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++d)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:AD,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.audioCodecs.map(k=>k.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:s.iceUfrag,icePwd:s.icePwd,unrecognized:[],candidates:i,extmaps:l.audioExtensions,fingerprints:o.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:g,rtcpFeedbackWildcards:[],payloads:l.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++d)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return _v.print(this.sessionDesc)}send(r,i,o,s){let{ssrcs:l,ssrcGroups:d}=UO(i,this.cname,_r("SYNC_GROUP")?o:void 0),h=this.findPreloadMediaDesc(l);if(h){if(f_()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,h.attributes.mid),s&&(s.twcc||s.remb)){let p=this.sessionDesc.mediaDescriptions.indexOf(h);return this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(h,s),{mid:h.attributes.mid,needExchangeSDP:!0}}return{mid:h.attributes.mid,needExchangeSDP:!1}}{let p=this.findAvailableMediaIndex(r,l),f;return p===-1||p===1&&(a0()||function(){let _=DE();return!(_.name!==FE.CHROME||!_.osVersion)&&Number(_.version)<=90}())||p===0&&_r("USE_SUB_RTX")||jQ()?(f=this.createOrRecycleSendMedia(r,l,d,"sendonly",s),this.updateBundleMids()):(f=R_(this.sessionDesc.mediaDescriptions[p]),f.attributes.direction="sendonly",f.attributes.ssrcs=l,f.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[p]=this.mungSendMediaDesc(f,s)),f_()&&this.firefoxSsrcMidMap.set(l[0].ssrcId,f.attributes.mid),{mid:f.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:r,needExchangeSDP:i}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:r.attributes.mid,needExchangeSDP:i}}batchSend(r){let i=r.map(l=>{let{kind:d,ssrcMsg:h,mslabel:p}=l;return this.send(d,h,p)}),o=[],s=!1;return i.forEach(l=>{let{mid:d,needExchangeSDP:h}=l;h&&(s=!0),o.push(d)}),{mids:o,needExchangeSDP:s}}stopSending(r){let i=this.sessionDesc.mediaDescriptions.filter(o=>o.attributes.mid&&r.indexOf(o.attributes.mid)!==-1);if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");i.forEach(o=>{o.attributes.mid==="0"||f_()||jQ()?o.attributes.ssrcs=[]:(o.attributes.ssrcs=[],o.attributes.direction="inactive",o.media.port="0")}),this.updateBundleMids()}mute(r){let i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){let i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}muteRemote(r){let i=this.sessionDesc.mediaDescriptions.filter(o=>nE(r).call(r,o.attributes.mid||""));if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(o=>{o.attributes.direction="inactive"})}unmuteRemote(r){let i=this.sessionDesc.mediaDescriptions.filter(o=>nE(r).call(r,o.attributes.mid||""));if(i.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");i.forEach(o=>{o.attributes.direction="recvonly"})}receive(r,i,o,s){r.forEach((l,d)=>{this.createOrRecycleRecvMedia(l,[],"recvonly",i,o,s[d])}),this.updateBundleMids()}stopReceiving(r){let i=this.sessionDesc.mediaDescriptions.filter(o=>r.indexOf(o.attributes.mid)!==-1);if(i.length!==r.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");i.forEach(o=>{o.media.port="0",o.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(r){let i=this.sessionDesc||_v.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=r;let o=this.rtpCapabilities.send,s=this.localCapabilities.send;for(let l of i.mediaDescriptions){if(l.attributes.iceUfrag=this._iceParameters.iceUfrag,l.attributes.icePwd=this._iceParameters.icePwd,l.attributes.fingerprints=this._dtlsParameters.fingerprints,l.attributes.candidates=this._candidates,l.attributes.setup=this.setup,l.media.mediaType==="application"&&(l.attributes.sctpPort="5000"),l.media.mediaType==="video"){if(o.videoCodecs.length===0){let d=s.videoCodecs.filter(h=>{var p,f;return(p=h.rtpMap)===null||p===void 0?void 0:nE(f=p.encodingName.toLowerCase()).call(f,"vp8")})||[s.videoCodecs[0]];l.media.fmts=d.map(h=>h.payloadType.toString(10)),l.attributes.payloads=d,l.attributes.extmaps=[]}else if(l.media.fmts=o.videoCodecs.map(d=>d.payloadType.toString(10)),l.attributes.payloads=o.videoCodecs,l.attributes.extmaps=o.videoExtensions,_r("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:d,ssrcGroups:h}=UO([{ssrcId:uet,rtx:_r("USE_SUB_RTX")?40001:void 0}],this.cname);l.attributes.ssrcs=d,l.attributes.ssrcGroups=h}}if(l.media.mediaType==="audio"){if(o.audioCodecs.length===0){let d=s.audioCodecs.filter(h=>{var p,f;return(p=h.rtpMap)===null||p===void 0?void 0:nE(f=p.encodingName.toLowerCase()).call(f,"opus")})||[s.audioCodecs[0]];l.media.fmts=d.map(h=>h.payloadType.toString(10)),l.attributes.payloads=d,l.attributes.extmaps=[]}else if(l.media.fmts=o.audioCodecs.map(d=>d.payloadType.toString(10)),l.attributes.payloads=o.audioCodecs,l.attributes.extmaps=o.audioExtensions,F1(l),_r("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:d,ssrcGroups:h}=UO([{ssrcId:2e4}],this.cname);l.attributes.ssrcs=d,l.attributes.ssrcGroups=h}}}return this.sessionDesc=i,this.currentMidIndex=i.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(r){let i=this._candidates.filter(o=>o.transport==="udp");if(r===hS.TCP){if(i.length===0)return;if(_r("TCP_CANDIDATE_ONLY")){let o=this._candidates.filter(s=>s.transport==="tcp");i.forEach(s=>{o.findIndex(l=>l.connectionAddress===s.connectionAddress)===-1&&o.push(DI(DI({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}),this._candidates=o}else{let o=[];i.forEach(s=>{o.push(DI(DI({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))}),this._candidates=[...i,...o]}}else if(r===hS.RELAY){if(i.length!==0)return;{let o=this._candidates.filter(s=>s.transport==="tcp");o.forEach(s=>{i.push(DI(DI({},s),{},{foundation:"udpcandidate",priority:Number(s.priority)+1+"",transport:"udp",port:Number(s.port)-90+""}))}),this._candidates=[...i,...o]}}else i.length===0?(this._candidates.filter(o=>o.transport==="tcp").forEach(o=>{i.push(DI(DI({},o),{},{foundation:"udpcandidate",priority:Number(o.priority)+1+"",transport:"udp",port:Number(o.port)-90+""}))}),this._candidates=i):this._candidates=this._candidates.filter(o=>o.transport!=="tcp");for(let o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}restartICE(r){r=R_(r),this._iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){let i=[];for(let o=0;o<r;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}findAvailableMediaIndex(r,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{let s=o.media.mediaType===r&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(f_()){if(s){let l=this.firefoxSsrcMidMap.get(i[0].ssrcId);return!(l||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!l||l!==o.attributes.mid)}return!1}return s})}createOrRecycleDataChannel(){for(let o of this.sessionDesc.mediaDescriptions)if(o.media.mediaType==="application")return{mediaDesc:o,needExchangeSDP:!1};this.currentMidIndex+=1;let r="".concat(this.currentMidIndex),i={media:{mediaType:"application",port:AD,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(r),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(i),{mediaDesc:i,needExchangeSDP:!0}}createOrRecycleRecvMedia(r,i,o,s,l,d){let h=r._mediaStreamTrack.kind,p=this.rtpCapabilities.recv,f=$D(h,p,this.localCapabilities.send,h===cE.VIDEO?s:l),_=h===cE.VIDEO?p.videoExtensions:p.audioExtensions;this.currentMidIndex+=1;let g="".concat(this.currentMidIndex),b={media:{mediaType:h,port:AD,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(k=>k.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(g)}};b=this.mungRecvMediaDsec(b,r,d);let C=this.findFirstClosedMedia(h);if(C){let k=this.sessionDesc.mediaDescriptions.indexOf(C);this.sessionDesc.mediaDescriptions[k]=b}else this.sessionDesc.mediaDescriptions.push(b);return b}updateRemoteCodec(r,i,o){let s=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").filter(b=>{var C;return nE(C=Object.keys(pV)).call(C,b)}))],l=new Set(i);if(s.every(b=>l.has(b)))return B.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(i)),!1;let d=this._rtpCapabilities.recv.videoCodecs.filter(b=>i.some(C=>{var k;return nE(k=b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").call(k,C)}));if(d.length===0)return B.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(s," codecs: ").concat(i)),!1;let h=[...new Set(d.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||""))],p;if(B.debug("updateRemoteCodec, from ".concat(s," to ").concat(h)),r.length===0)p=this.sessionDesc.mediaDescriptions.filter(b=>b.media.mediaType==="video"&&b.attributes.direction==="recvonly");else if(p=this.sessionDesc.mediaDescriptions.filter(b=>b.attributes.mid&&nE(r).call(r,b.attributes.mid)&&b.attributes.direction==="recvonly"),p.length!==r.length)return B.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(r,", codecs: ").concat(i)),!1;if(_r("USE_PUB_RTX")||_r("USE_SUB_RTX")){let b=dH(d,this.rtpCapabilities.recv.videoCodecs);d.push(...b)}this._rtpCapabilities.recv.videoCodecs=d;let f=this.localCapabilities.send,_=this.rtpCapabilities.recv,g=$D(cE.VIDEO,_,f,o);return p.forEach(b=>{let C=g.map(k=>k.payloadType.toString(10));B.debug("updateRemoteCodec mid: ".concat(b.attributes.mid,", from ").concat(b.attributes.payloads," to ").concat(g)),b.attributes.payloads=g,b.media.fmts=C}),!0}createOrRecycleSendMedia(r,i,o,s,l){let d=this.rtpCapabilities.send,h=r===cE.VIDEO?d.videoCodecs:d.audioCodecs,p=r===cE.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;let f="".concat(this.currentMidIndex),_={media:{mediaType:r,port:AD,protos:["UDP","TLS","RTP","SAVPF"],fmts:h.map(b=>b.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:p,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:i,ssrcGroups:o,rtcpFeedbackWildcards:[],payloads:h,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};_=this.mungSendMediaDesc(_,l);let g=this.findFirstClosedMedia(r);if(g){let b=this.sessionDesc.mediaDescriptions.indexOf(g);this.sessionDesc.mediaDescriptions[b]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(r=>r.media.port!=="0").map(r=>r.attributes.mid)}mungRecvMediaDsec(r,i,o){let s=R_(r);return uH(s),V1(s,i),lH(s,i),xst(s),R3(s,o,this.localCapabilities.send),s}mungSendMediaDesc(r,i){let o=R_(r);return R3(o,i,this.localCapabilities.recv),F1(o),o}updateRecvMedia(r,i){let o=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===r);if(o!==-1){let s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=s}}bumpMid(r){this.currentMidIndex+=r}findFirstClosedMedia(r){return this.sessionDesc.mediaDescriptions.find(i=>f_()?i.media.port==="0"&&i.media.mediaType===r:i.media.port==="0")}findPreloadMediaDesc(r){return this.sessionDesc.mediaDescriptions.find(i=>{var o;return((o=i.attributes)===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===r[0].ssrcId})}getSSRC(r){var i;return(i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r))===null||i===void 0?void 0:i.attributes.ssrcs}};function det(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function QR(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?det(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):det(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var eL=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),O1=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(O1||{}),k3=new Map;function het(e,r,i,o){let{scale:s}=e;if(s===0&&o===O1.UP||s>=r.length-1&&o===O1.DOWN)return e;let l=QR(QR({},e),{},{scale:o===O1.DOWN?++s:--s});switch(i){case"maintain-framerate":l=QR(QR({},l),r[s].motion);break;case"maintain-resolution":l=QR(QR({},l),r[s].detail);break;case"balanced":l=QR(QR({},l),r[s].balanced)}return l}function Zst(e,r){if(r){let i={overUse:0,underUse:0,adaptationList:$st(r)};k3.set(e,i)}else k3.delete(e)}function $st(e){let r=QR({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:s,bitrateMin:l}=r,{MIN_FRAME_RATE:d,MAX_THRESHOLD_FRAMERATE:h,MAX_SCALE:p,BITRATE_MIN_THRESHOLD:f,BITRATE_MAX_THRESHOLD:_,BWE_SCALE_UP_THRESHOLD:g,BWE_SCALE_DOWN_THRESHOLD:b,PERF_SCALE_DOWN_THRESHOLD:C,PERF_SCALE_UP_THRESHOLD:k,BALANCE_BITRATE_FACTOR:A,BALANCE_FRAMERATE_FACTOR:P,BALANCE_RESOLUTION_FACTOR:x,MOTION_RESOLUTION_FACTOR:j,MOTION_BITRATE_FACTOR:z,DETAIL_FRAMERATE_FACTOR:_t,DETAIL_BITRATE_FACTOR:ue}=tH,_n=Math.min(r.frameRate,h),Ei=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(b,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(C,1)*_n),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:l},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:l},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:l}}];for(let _s=1;_s<=p;_s++){let kc={bwe_up:Math.round(Math.pow(g,_s)*i),bwe_down:Math.round(Math.pow(b,_s+1)*i),fps_up:Math.round(Math.pow(k,_s)*_n),fps_down:Math.round(Math.pow(C,_s+1)*_n)},_i={scaleResolutionDownBy:s/Math.pow(x,_s),frameRate:Math.max(Math.round(Math.pow(P,_s)*o),d),bitrateMax:Math.max(Math.round(Math.pow(A,_s)*i),_),bitrateMin:Math.max(Math.round(Math.pow(A,_s)*l),f)},_h={scaleResolutionDownBy:s/Math.pow(j,_s),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(z,_s)*i),_),bitrateMin:Math.max(Math.round(Math.pow(z,_s)*l),f)},_p={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_t,_s)*o),d),bitrateMax:Math.max(Math.round(Math.pow(ue,_s)*i),_),bitrateMin:Math.max(Math.round(Math.pow(ue,_s)*l),f)};Ei.push({scale:_s,threshold:kc,balanced:_i,motion:_h,detail:_p})}return Ei}function qRt(e,r,i,o,s,l){let d=k3.get(e)||{overUse:0,underUse:0,adaptationList:$st(s)},{adaptationList:h}=d;k3.set(e,d);let{OVERUSE_TIMES_THRESHOLD:p,UNDERUSE_TIMES_THRESHOLD:f}=tH,{scale:_}=o,g,b;return typeof r=="number"&&r>0&&function(C,k,A,P){if(k>=A.length)return!1;let{threshold:{fps_down:x}}=A[k];return _r("FORCE_AG_HIGH_FRAMERATE")&&P==="maintain-framerate"&&(x=A[0].threshold.fps_down),C<x}(r,_,h,l)&&(d.overUse++,b=eL.CPU,d.overUse>p)||typeof i=="number"&&i>0&&function(C,k,A){if(k>=A.length)return!1;let{threshold:{bwe_down:P}}=A[k];return C<P}(i,_,h)&&(d.overUse++,b=eL.BANDWIDTH,d.overUse>p)?(d.overUse=0,d.underUse=0,g=het(o,h,l,O1.DOWN),[g,b]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(C,k,A,P){if(k===0)return;let{threshold:{fps_up:x}}=A[k];return _r("FORCE_AG_HIGH_FRAMERATE")&&P==="maintain-framerate"&&(x=A[1].threshold.fps_up),C>x}(r,_,h,l)&&function(C,k,A){if(k===0)return;let{threshold:{bwe_up:P}}=A[k];return C>P}(i,_,h)&&(d.underUse++,d.underUse>f&&(d.overUse=0,d.underUse=0,g=het(o,h,l,O1.UP),g.scale===0&&(b=eL.NONE))),[g,b])}function pet(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function e5(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?pet(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):pet(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function WRt(e){var r;return!!_r("ENABLE_AG_ADAPTATION")&&!!(e instanceof j8||nE(r=e._hints).call(r,XE.CUSTOM_TRACK))&&(!!_r("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){let o=DE();if(o.os!==W_.IOS||!o.osVersion)return!1;let s=o.osVersion.split(".");return Number(s[0])>=i}(14)&&Xot(17,4,!0)||Jot(14)&&Qot(17,4,!0)))}var P3=new Map;function aU(e,r){let i=P3.get(e);if(i){let{timer:o}=i;window.clearTimeout(o),P3.delete(e)}r.qualityLimitationReason=eL.NONE,Zst(e)}var OE;function fet(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function hR(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?fet(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):fet(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var WT=(OE=class GD extends s3{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return nE(i=Object.keys(pV)).call(i,r)}))]}constructor(r,i){super(r,i),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"id",ZE(5,"connection-")),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"transportEventReceiver",void 0),$(this,"statsFilter",void 0),$(this,"extension",{useXR:_r("USE_XR")}),$(this,"localCapabilities",void 0),$(this,"remoteCodecs",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"isPreallocation",!1),$(this,"preSSRCMap",new Map),$(this,"dataStreamChannelMap",new Map),$(this,"establishPromise",void 0),$(this,"recoveredDataChannelIds",[]),$(this,"currentDataChannelId",1),$(this,"mutex",new f0("P2PConnection-mutex")),$(this,"qualityLimitationReason",eL.NONE),this.store=i,this.peerConnection=new RTCPeerConnection(GD.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=mH(this.peerConnection,_r("STATS_UPDATE_INTERVAL"),void 0,f_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){let i=this.preSSRCMap.get(r);if(i!==void 0){let o=this.peerConnection.getTransceivers().find(s=>s.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void B.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){let o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);let l=this.remoteSDP.toString();s?.(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}else B.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=HI(r.sdp),o=await Vst({filterRTX:!_r("USE_PUB_RTX")&&!_r("USE_SUB_RTX"),filterVideoFec:_r("FILTER_VIDEO_FEC"),filterAudioFec:_r("FILTER_AUDIO_FEC"),filterVideoCodec:_r("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=w3(o),this.initialOffer=r,hR(hR({},i),{},{rtpCapabilities:o,offerSDP:r.sdp})}catch(r){throw new _u(Vt.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Q8(hR(hR({},r),{},{localCapabilities:this.localCapabilities})),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let i=this.remoteSDP.toString(),o=Fst(this.initialOffer.sdp,this.extension),s=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),s?.(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});let l=this.peerConnection.getTransceivers()[0];if(l!=null&&l.receiver&&this.tryBindTransportEvents(l.receiver),_r("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(_r("PRELOAD_MEDIA_COUNT"));let h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});let p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p)}let{preSSRCs:d}=r;if(Array.isArray(d)&&d.length>0){let{mids:h}=this.remoteSDP.batchSend(d.map(p=>({kind:p.kind,ssrcMsg:[{ssrcId:p.ssrcId,rtx:p.rtx}],mslabel:p.mslabel})));h.forEach((p,f)=>{this.preSSRCMap.set(d[f].ssrcId,p)}),await nU(this.peerConnection,this.remoteSDP,this.extension),B.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let{rtpCapabilities:i}=r;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){let{mids:s}=this.remoteSDP.batchSend(o.map(l=>Object.assign({},{kind:l.kind,ssrcMsg:[{ssrcId:l.ssrcId,rtx:l.rtx}],mslabel:l.mslabel})));s.forEach((l,d)=>{this.preSSRCMap.set(o[d].ssrcId,l)})}await nU(this.peerConnection,this.remoteSDP,this.extension),B.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,o){var s=this;return YS(function*(){let l=yield PE(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let d=[];r.forEach(A=>{let P=s.peerConnection.addTransceiver(A._mediaStreamTrack,{direction:"sendonly"});d.push(P),A._updateRtpTransceiver(P)}),f_()&&_r("SIMULCAST")===!0&&(yield PE(s.applySimulcastForFirefox(d,r)));let h=yield PE(s.peerConnection.createOffer()),p=s.remoteSDP.predictReceivingMids(r.length),f=s.mungSendOfferSDP(h.sdp,r,p),_=_v.parse(f),g=p.map(A=>{let P=_.mediaDescriptions.find(x=>x.attributes.mid===A);if(!P)throw new Error("Cannot extract ssrc from mediaDescription.");return Mst(P,_r("USE_PUB_RTX"))}),b;try{b=yield g}catch(A){b=[],s.remoteSDP.receive(r,i,o,b);let P=s.remoteSDP.toString();throw yield PE(s.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield PE(s.peerConnection.setRemoteDescription({type:"answer",sdp:P})),yield PE(s.stopSending(p,!0)),A}s.remoteSDP.receive(r,i,o,b);let C=s.remoteSDP.toString(),k=s.logSDPExchange(f,"offer","local","send");return yield PE(s.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield PE(s.applySimulcastEncodings(d,r)),yield PE(s.applySendEncodings(d,r)),k?.(C),yield PE(s.peerConnection.setRemoteDescription({type:"answer",sdp:C})),d.map((A,P)=>{let x=p[P];return{localSSRC:g[P],id:x,transceiver:A}})}catch(d){throw d instanceof _u?d:new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{l()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")B.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let l=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof l!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:l,negotiated:!0,ordered:!1,maxRetransmits:_r("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}i.forEach(l=>{l._updateOriginDataChannel(o)});let{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){let l=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:l});let d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),B.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else B.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof _u?o:new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{let i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof _u?i:new _u(Vt.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){let o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let s=this.peerConnection.getTransceivers().filter(p=>r.indexOf(p.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(p=>{var f;aU(this.id+p.mid,this),p.direction="inactive",(f=p.stop)===null||f===void 0||f.call(p)});let l=await this.peerConnection.createOffer(),d=this.logSDPExchange(l.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(l),this.remoteSDP.stopReceiving(r);let h=this.remoteSDP.toString();d?.(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(s){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{o&&o()}}async receive(r,i,o,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));let{mid:l,needExchangeSDP:d}=this.remoteSDP.send(r,i,o,s);d&&(await nU(this.peerConnection,this.remoteSDP,this.extension),B.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));let h=this.peerConnection.getTransceivers().find(p=>p.mid===l);if(!h)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:h.receiver.track,id:l,transceiver:h}}catch(l){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(l.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await nU(this.peerConnection,this.remoteSDP,this.extension),B.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(s=>{let l=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!l)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:l.receiver.track,id:s,transceiver:l}})}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(l=>{Array.from(this.preSSRCMap.entries()).some(d=>{let[h,p]=d;if(p===l)return this.preSSRCMap.delete(h),!0})}),this.remoteSDP.stopSending(r);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let s=await this.peerConnection.createAnswer();o?.(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let s=await this.peerConnection.createAnswer();o?.(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);let i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});let s=await this.peerConnection.createAnswer();o?.(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(d=>d.mid&&r.indexOf(d.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(d=>{d.direction="inactive"});let o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);let l=this.remoteSDP.toString();s?.(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let i=this.peerConnection.getTransceivers().filter(d=>d.mid&&r.indexOf(d.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(d,h)=>{d.direction="sendonly"});let o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);let l=this.remoteSDP.toString();s?.(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(i){throw new _u(Vt.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return YS(function*(){let o=yield PE(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ME().supportPCSetConfiguration){let f=i.peerConnection.getConfiguration(),_=r===hS.RELAY?"relay":"all";f.iceTransportPolicy!==_&&(B.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(f.iceTransportPolicy,"] to [").concat(_,"]")),f.iceTransportPolicy=_,i.peerConnection.setConfiguration(f))}else if(r===hS.RELAY)return;i.remoteSDP.updateCandidates(r);let s=yield PE(i.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let l=HI(s.sdp),{remoteIceParameters:d}=yield l.iceParameters;i.remoteSDP.restartICE(d);let h=i.remoteSDP.toString(),p=i.logSDPExchange(s.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield PE(i.peerConnection.setLocalDescription(s)),p?.(h),yield PE(i.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(s){B.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),s)}finally{o()}})()}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{aU(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return hR(hR({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let o=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(o.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);let l=this.remoteSDP.toString(),d=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),d?.(l),await this.peerConnection.setRemoteDescription({type:"answer",sdp:l})}catch(o){throw new _u(Vt.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,i){let o=this.peerConnection.getTransceivers().filter(s=>s.mid===r);o.length===1&&(this.isVP8Simulcast(i)?f_()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){let o=this.peerConnection.getTransceivers().find(s=>s.mid===i);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){let r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){let i=r[0].transport.iceTransport,{local:o,remote:s}=i.getSelectedCandidatePair();return{local:hR(hR({},IR),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:hR(hR({},IR),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,B.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,B.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},_r("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){let i={iceServers:[]};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(lV(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...GD.turnServerConfigToIceServers(r.turnServer.servers)),_r("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...GD.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),_r("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),_r("ENABLE_ENCODED_TRANSFORM")&&ME().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){let i=[];return r.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(g1(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!_r("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}tryBindTransportEvents(r){let i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var s;i!=null&&i.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,i.state))},i.onerror=s=>{var l;(l=this.onDTLSTransportError)===null||l===void 0||l.call(this,"error"in s?s.error:s)};let o=i.iceTransport;o&&(o.onstatechange=()=>{let s=i?.iceTransport.state;var l;s&&((l=this.onICETransportStateChange)===null||l===void 0||l.call(this,s))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){let{local:s,remote:l}=o.getSelectedCandidatePair();B.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol}),", remote ").concat(JSON.stringify({candidateType:l.type,protocol:l.protocol,address:l.address,port:l.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var o,s;if(i||(i=this.peerConnection.getSenders().find(P=>P.track===r._mediaStreamTrack)),!i)return B.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return B.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ME().supportSetRtpSenderParameters)return B.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let l={},d={};switch(r._optimizationMode){case"motion":l.degradationPreference="maintain-framerate";break;case"detail":l.degradationPreference="maintain-resolution";break;case"balanced":l.degradationPreference="balanced"}let h=function(A,P){return A.getTransceivers().find(x=>x.sender.track===P||x.receiver.track===P)}(this.peerConnection,r._mediaStreamTrack),p=vRt(r);if(WRt(r)&&h&&i&&p&&this.getLocalVideoStats&&nE(o=["vp8","vp9"]).call(o,this.store.codec)){var f;let A=l.degradationPreference||(nE(f=r._hints).call(f,XE.CUSTOM_TRACK)?_r("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(P,x,j,z,_t,ue){if(aU(P,j),_t(x),z!=="balanced"&&z!=="maintain-framerate"&&z!=="maintain-resolution")return;let _n=-1;Zst(P,x);let Ei=window.setInterval(()=>{let kc=P3.get(P);if(!_r("ENABLE_AG_ADAPTATION")||!kc)return aU(P,j),void _t(x);let _i=ue();if(_i.sendPackets>0&&_i.OutgoingAvailableBandwidth>0){if(_n===-1)return void(_n=Date.now());if(Date.now()-_n<1e3)return;let _h=_i.sendFrameRate,_p=_i.OutgoingAvailableBandwidth,[Qm,_o]=qRt(P,_h,_p,kc.adaptationConfig,x,z);_o&&(j.qualityLimitationReason=_o),Qm&&kc.adaptationConfig.scale!==Qm.scale&&(B.debug("[".concat(P,"] applyAdaptation: ").concat(j.qualityLimitationReason,`
           sendFps `).concat(_h,", bwe ").concat(_p,", switch from ").concat(kc.adaptationConfig.scale," to ").concat(Qm.scale," ")),kc.adaptationConfig=e5(e5({},kc.adaptationConfig),Qm),_t(Qm))}},_r("CHECK_LOCAL_STATS_INTERVAL")),_s=e5({},x);P3.set(P,{timer:Ei,adaptationConfig:_s,originConfig:x,adaptationFunc:_t}),B.debug("[".concat(P,"] start adaptation, originConfig: ").concat(JSON.stringify(x),", degradationPreference: ").concat(z))})(this.id+h.mid,p,this,A,P=>{i&&this.updateAdaptation(i,P)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var _;let{bitrateMax:A,frameRate:P,scaleResolutionDownBy:x}=r._encoderConfig;A&&(d.maxBitrate=1e3*A),(nE(_=r._hints).call(_,XE.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(P&&(d.maxFramerate=pS(P)),x&&x>=1&&(d.scaleResolutionDownBy=x))}let{maxFramerate:g}=_r("ENCODER_CONFIG_LIMIT");if(g&&typeof g=="number"&&(d.maxFramerate=d.maxFramerate?Math.min(d.maxFramerate,g):g),_r("DSCP_TYPE")&&$I()){var b;let A=_r("DSCP_TYPE");nE(b=["very-low","low","medium","high"]).call(b,A)&&(d.networkPriority=A)}let C=i.getParameters(),k=(s=C.encodings)===null||s===void 0?void 0:s[0];f_()&&!k&&(l.encodings=[d]),k&&Object.assign(k,d),Object.assign(C,l),B.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await i.setParameters(C),await async function(A,P,x){try{var j;if(!ME().supportSetRtpSenderParameters||!function(Ei){return Ei==="vp9"}(A)||!_r("ENABLE_SVC"))return;let z={},_t={},ue=P.getParameters(),_n=(j=ue.encodings)===null||j===void 0?void 0:j[0];_t.scalabilityMode=B8(x),_n&&Object.assign(_n,_t),Object.assign(ue,z),await P.setParameters(ue),B.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(ue.encodings)))}catch(z){B.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",z)}}(this.store.codec,i,_r("SVC_MODE"))}async updateAdaptation(r,i){var o,s;if(!r)return B.debug("[updateAdaptation] no rtpSender found");if(!ME().supportSetRtpSenderParameters)return B.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let l={},{bitrateMax:d,frameRate:h,scaleResolutionDownBy:p}=i;d&&(l.maxBitrate=1e3*d),h&&(l.maxFramerate=pS(h)),p&&p>=1&&nE(o=["vp8","vp9"]).call(o,this.store.codec)&&(l.scaleResolutionDownBy=p);let f=r.getParameters(),_=(s=f.encodings)===null||s===void 0?void 0:s[0];_&&Object.assign(_,l),Object.assign(f,{});try{await r.setParameters(f),B.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(f.encodings)))}catch(g){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?B.debug("[updateAdaptation] peerConnection not connected}"):B.debug("[updateAdaptation] updateRtpSenderEncodings failed",g):B.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!ME().supportSetRtpSenderParameters||r.length!==i.length)return;for(let o=0;o<r.length;o++){let s=r[o],l=i[o];l instanceof e_&&!this.isVP8Simulcast(l)&&await this.updateRtpSenderEncodings(l,s.sender)}}catch{B.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,o){let s=_v.parse(r);return i.forEach((l,d)=>{let h=o[d],p=s.mediaDescriptions.find(f=>f.attributes.mid===h);p&&(V1(p,l),jst(p,l,this.store.codec))}),_v.print(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,o)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,r,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let p=0;p<r.length;p++){var o,s,l,d,h;let f=r[p],_=i[p];if(_ instanceof e_&&!nE(o=_._hints).call(o,XE.LOW_STREAM)&&(s=_._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((l=_._encoderConfig)===null||l===void 0?void 0:l.bitrateMax)>200&&(d=_._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=_._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1&&this.store.codec==="vp8"){let g={},b={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:b.high}];let C=f.sender.getParameters();await f.sender.setParameters(Object.assign(C,g))}}}async applySimulcastEncodings(r,i){if(!f_()&&r.length===i.length)for(let o=0;o<r.length;o++){let s=i[o];if(s instanceof e_&&this.isVP8Simulcast(s)){let l=r[o],d={},h={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:h.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:h.medium,scaleResolutionDownBy:4}];let p=l.sender.getParameters();await l.sender.setParameters(Object.assign(p,d))}}}isVP8Simulcast(r){var i,o,s,l,d;return!!(r instanceof e_&&_r("SIMULCAST")&&this.store.codec==="vp8"&&!nE(i=r._hints).call(i,XE.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((s=r._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(l=r._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((d=r._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1)}logSDPExchange(r,i,o,s){if(_r("SDP_LOGGING"))return B.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(s,`
`),r),i==="offer"?l=>{this.logSDPExchange(l,"answer",o==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;let i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(ME().supportPCSetConfiguration){let i=GD.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},oE(OE.prototype,"updateRemoteRTPCapabilities",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"updateRemoteRTPCapabilities"),OE.prototype),oE(OE.prototype,"connect",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"connect"),OE.prototype),oE(OE.prototype,"updateRemoteConnect",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"updateRemoteConnect"),OE.prototype),oE(OE.prototype,"createDataChannels",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"createDataChannels"),OE.prototype),oE(OE.prototype,"receive",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"receive"),OE.prototype),oE(OE.prototype,"batchReceive",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"batchReceive"),OE.prototype),oE(OE.prototype,"stopReceiving",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"stopReceiving"),OE.prototype),oE(OE.prototype,"muteRemote",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"muteRemote"),OE.prototype),oE(OE.prototype,"unmuteRemote",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"unmuteRemote"),OE.prototype),oE(OE.prototype,"muteLocal",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"muteLocal"),OE.prototype),oE(OE.prototype,"unmuteLocal",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"unmuteLocal"),OE.prototype),oE(OE.prototype,"close",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"close"),OE.prototype),oE(OE.prototype,"updateEncoderConfig",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"updateEncoderConfig"),OE.prototype),oE(OE.prototype,"updateSendParameters",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"updateSendParameters"),OE.prototype),oE(OE.prototype,"replaceTrack",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"replaceTrack"),OE.prototype),oE(OE.prototype,"updateAdaptation",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"updateAdaptation"),OE.prototype),oE(OE.prototype,"getRemoteSSRC",[q0],Object.getOwnPropertyDescriptor(OE.prototype,"getRemoteSSRC"),OE.prototype),OE);function q0(e,r,i){let o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let s=this.mutex,l=await s.lock("From P2PConnection.".concat(r));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await o.apply(this,h)}finally{l()}},i}var TE;function met(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function pR(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?met(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):met(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Eet(e){var r,i,o,s=2;for(typeof Symbol<"u"&&(i=YW,o=Symbol.iterator);s--;){if(i&&(r=e[i])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new BU(r.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function BU(e){function r(i){if(Object(i)!==i)return eE.reject(new TypeError(i+" is not an object."));var o=i.done;return eE.resolve(i.value).then(function(s){return{value:s,done:o}})}return BU=function(i){this.s=i,this.n=i.next},BU.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?eE.resolve({value:i,done:!0}):r(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?eE.reject(i):r(o.apply(this.s,arguments))}},new BU(e)}var cU=(TE=class extends s_{get state(){return this._state}set state(e){let r=this._state;this._state=e,this.emit(fE.StateChange,r,this._state)}constructor(e,r){super(),$(this,"isPlanB",void 0),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"connection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"remoteDataChannelMap",new Map),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"pendingLocalDataChannels",[]),$(this,"pendingRemoteDataChannels",[]),$(this,"statsCollector",void 0),$(this,"shouldForwardP2PCreation",void 0),$(this,"iceFailedCount",0),$(this,"dtlsFailedCount",0),$(this,"mutex",new f0("P2PChannel-mutex")),$(this,"_state",jE.Disconnected),$(this,"_pcStatsUploadType",_r("NEW_ICE_RESTART")?qR.FIRST_CONNECTION:qR.OLD_FIRST_CONNECTION),$(this,"_isInRestartIce",!1),$(this,"_isStartRestartIce",!1),$(this,"_restartStates",["disconnected","failed"]),$(this,"_restartTimer",void 0),$(this,"_isFirstConnected",!0),$(this,"handleMuteLocalTrack",async(i,o,s)=>{let l=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==jE.Connected)return void s(new _u(Vt.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let d=this.filterTobeMutedTracks(i);if(d.length===0)return void o();let h=d.find(f=>f[0]==="videoLowTrack");h&&h[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(d.map(f=>{let[,{id:_}]=f;return _}));let p=this.createMuteMessage(d);await JE(this,fE.RequestMuteLocal,p),o()}catch(d){s(d)}finally{l()}}),$(this,"handleUnmuteLocalTrack",async(i,o,s)=>{let l=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==jE.Connected)return void s(new _u(Vt.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let d=this.filterTobeUnmutedTracks(i);if(d.length===0)return void o();let h=d.find(f=>f[0]==="videoLowTrack");if(h){let f=h[1];if(f.track._originMediaStreamTrack.stop(),!_r("DISABLE_DUAL_STREAM_USE_ENCODING")&&ME().supportDualStreamEncoding){let _=i._mediaStreamTrack.clone();f.track._mediaStreamTrack=_,f.track._originMediaStreamTrack=_}else{let _=J8(i,gL(this,fE.RequestLowStreamParameter));f.track._mediaStreamTrack=_,f.track._originMediaStreamTrack=_}await new eE((_,g)=>{this.handleReplaceTrack(f.track,_,g,!0)})}await this.connection.unmuteLocal(d.map(f=>{let[,{id:_}]=f;return _}));let p=this.createUnmuteMessage(d);await JE(this,fE.RequestUnmuteLocal,p),o()}catch(d){s(d)}finally{l()}}),$(this,"handleUpdateVideoEncoder",async(i,o,s)=>{let l=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{let d=this.localTrackMap.get(_m.LocalVideoTrack);if(!this.connection||!d||d.track!==i||this.state!==jE.Connected)return void o();let{id:h,track:p}=d;await this.connection.updateSendParameters(h,p),await this.connection.updateEncoderConfig(h,p),this.emit(fE.UpdateVideoEncoder,p),o()}catch(d){s(d)}finally{l()}}),$(this,"handleUpdateVideoSendParameters",async(i,o,s)=>{let l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let d=this.localTrackMap.get(_m.LocalVideoTrack);if(!this.connection||!d||d.track!==i||this.state!==jE.Connected)return void o();let{id:h,track:p}=d;await this.connection.updateSendParameters(h,p),o()}catch(d){s(d)}finally{l()}}),$(this,"handleReplaceMixingTrack",async(i,o,s,l)=>{if(!this.connection||this.state!==jE.Connected)return void o();let d=t5([i]),h;B.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(d.getTrackId(),"]")),typeof l=="boolean"&&l||(h=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,d),o()}catch(f){s(f)}finally{var p;(p=h)===null||p===void 0||p()}}),$(this,"handleReplaceTrack",async(i,o,s,l)=>{let d;B.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof l=="boolean"&&l||(d=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var h;let f=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:g}]=_;return i===g});if(!this.connection||!f||this.state!==jE.Connected)return void o();if(await((h=this.connection)===null||h===void 0?void 0:h.replaceTrack(i,f[1].id)),this.isPlanB){let _=f[1];_.id=i._mediaStreamTrack.id,this.localTrackMap.set(f[0],_)}if(f[0]===_m.LocalVideoTrack&&!_r("DISABLE_DUAL_STREAM_USE_ENCODING")&&ME().supportDualStreamEncoding){let _=this.localTrackMap.get(_m.LocalVideoLowTrack);if(_){let g=i._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=g,_.track._originMediaStreamTrack=g,await new eE((b,C)=>{this.handleReplaceTrack(_.track,b,C,!0)})}}o()}catch(f){s(f)}finally{var p;(p=d)===null||p===void 0||p()}}),$(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),$(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),$(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new A3(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!ME().supportUnifiedPlan||_r("CHROME_FORCE_PLAN_B")&&$I(),this.shouldForwardP2PCreation=_r("FORWARD_P2P_CREATION")&&ME().supportPCSetConfiguration&&XW(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new CD({},this.store):new WT({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var r;this.state=jE.New;let i=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(B.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new CD(e,this.store):new WT(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new _u(Vt.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=_r("NEW_ICE_RESTART")?qR.FIRST_CONNECTION:qR.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new _u(Vt.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");_r("ENABLE_PREALLOC_PC")&&this.state===jE.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=jE.Connected)}updateRemoteRTPCapabilities(e){let r=Array.from(this.localTrackMap.entries()).filter(s=>{var l;let[d]=s;return nE(l=[_m.LocalVideoLowTrack,_m.LocalVideoTrack]).call(l,d)}),i=r.map(s=>{let[,{id:l}]=s;return l}),o=r.map(s=>{let[l]=s;return l});if(this.connection instanceof WT){if(aE.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!nE(e).call(e,this.store.codec)){let s=["vp9","vp8","h264"].find(l=>nE(e).call(e,l));s&&(this.store.codec=s,B.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(s,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof WT&&this.connection.peerConnectionState!=="closed"&&nE(e=[jE.New,jE.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==jE.Connected){if(this.state===jE.Disconnected)throw new _u(Vt.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;nE(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}let r=this.filterTobePublishedDataChannels(e);return r.length===0?[]:(r.forEach(i=>{let o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);let o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,r,i){var o=this;return YS(function*(){let s=yield PE(o.mutex.lock("From P2PChannel.publish"));try{if(!o.connection||o.state!==jE.Connected){if(o.state===jE.Disconnected)throw new _u(Vt.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);let d=e.filter(h=>o.pendingLocalTracks.indexOf(h)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(d))}o.store.pubId=o.store.pubId+1,p0.markPublishStart(o.store.clientId,o.store.pubId);let l=o.filterTobePublishedTracks(e,r,i);if(l.length===0)return void(yield PE(o.tryToUnmuteAudio(e)));yield*t3(Eet(o.doPublish(o.connection,l)))}finally{s()}})()}doPublish(e,r){var i=this;return YS(function*(){r.forEach(g=>{let{track:b,type:C}=g,k=Date.now();i.store.publish(b.getTrackId(),C===_m.LocalAudioTrack?"audio":"video",k)}),i.bindLocalTrackEvents(r);let o=r.map(g=>{let{track:b}=g;return b}),s=yield PE(e.send(o,i.store.codec,i.store.audioCodec)),l=(yield PE(s.next())).value,d=i.createGatewayPublishMessage(r,l),h;try{h=yield d}catch(g){throw s.throw(g),g?.code===Vt.WS_ABORT&&r.forEach(b=>{let{track:C}=b;i.pendingLocalTracks.indexOf(C)===-1&&i.pendingLocalTracks.push(C)}),i.unbindLocalTrackEvents(r),g}let p=i.mapPubResToRemoteConfig(d,h,o),f=(yield PE(s.next(p))).value,_=_r("ENABLE_VIDEO_SEI");o.forEach(async g=>{let b=g.getRTCRtpTransceiver();b&&_&&(g.trackMediaType===cE.VIDEO?await TRt(b.sender,g):g.trackMediaType===cE.AUDIO&&await async function(C){if(!ME().supportWebRTCEncodedTransform)return void B.warning("browser not support audio encoded transform");if($M.has(C)||!C.track)return;let k={track:C.track};if(zI()){if(!C.createEncodedStreams)return void B.warning("browser not support createEncodedStreams() API");let P=null;try{P=C.createEncodedStreams()}catch(j){return void B.error("create audio-encoded-streams error",j&&j.message)}let x=new TransformStream({transform(j,z){k.controller||(k.controller=z),C.track&&C.track.id!==k.track.id&&(B.debug("audio track changed: ".concat(k.track.id," => ").concat(C.track.id)),k.track.removeEventListener("ended",A),k.track=C.track,k.track.addEventListener("ended",A)),z.enqueue(j)}});P.readable.pipeThrough(x).pipeTo(P.writable)}else if(a0()){if(typeof RTCRtpScriptTransform>"u")return void B.warning("browser not support RTCRtpScriptTransform");let P=jU(),x=new MessageChannel;await new eE(z=>P.onmessage=_t=>{_t.data==="registered"&&z(void 0)});let j=new RTCRtpScriptTransform(P,{name:"tx",port:x.port2},[x.port2]);C.transform=j,await new eE(z=>P.onmessage=_t=>{_t.data==="started"&&z(void 0)}),x.port1.onmessage=z=>{var _t;z.data.transformed&&C.track&&((_t=C.track)===null||_t===void 0?void 0:_t.id)!==k.track.id&&(B.debug("audio track changed: ".concat(k.track.id," => ").concat(C.track.id)),k.track.removeEventListener("ended",A),k.track=C.track,k.track.addEventListener("ended",A))},k.worker=P}function A(){if(C.track){if(this.id!==C.track.id)return;C.track.removeEventListener("ended",A)}let P=$M.get(C);if(P){$M.delete(C);try{var x,j;(x=P.controller)===null||x===void 0||x.terminate(),(j=P.worker)===null||j===void 0||j.terminate()}catch(z){B.warning(z&&z.message)}}}$M.set(C,k),C.track.addEventListener("ended",A)}(b.sender))}),r.forEach(g=>{let{type:b}=g;i.statsCollector.addLocalStats(b)}),i.assignLocalTracks(r,f),i.statsUploader.startUploadOutboundStats(),r.forEach(g=>{let{track:b,type:C}=g,k=Date.now();i.store.publish(b.getTrackId(),C===_m.LocalAudioTrack?"audio":"video",void 0,k)})})()}async updateVideoStreamParameter(e,r){let i=this.localTrackMap.get(r);if(!i)return;if(!(i.track instanceof e_))return B.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof WT||this.connection instanceof CD))return B.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");let{track:o}=i,s=function(l,d){let h={};return l.height&&l.width&&(h.scaleResolutionDownBy=N8(l,d)),h.maxFramerate=l.framerate?pS(l.framerate):void 0,h.maxBitrate=l.bitrate?1e3*l.bitrate:void 0,h}(e,o);if(o._encoderConfig||(o._encoderConfig={}),r!==_m.LocalVideoLowTrack||!_r("DISABLE_DUAL_STREAM_USE_ENCODING")&&ME().supportDualStreamEncoding)s.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=s.scaleResolutionDownBy);else{let l=o._originMediaStreamTrack;if(!l.canvas)return B.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(d,h){let p=d.canvas;h.width&&(p.width=pS(h.width)),h.height&&(p.height=pS(h.height)),h.framerate&&(p.stopCapture&&p.stopCapture(),p.stopCapture=aH(()=>{!p.startCapture&&p.stopCapture&&p.stopCapture(),p.startCapture&&p.startCapture()},pS(h.framerate)))})(l,e)}s.maxBitrate!=null&&(o._encoderConfig.bitrateMax=s.maxBitrate/1e3),s.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=s.maxFramerate:o._encoderConfig.frameRate={max:s.maxFramerate}),B.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var r=this;return YS(function*(){if(!r.connection||r.state!==jE.Connected)return;let i=yield PE(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let s=r.localTrackMap.get(_m.LocalVideoTrack);if(!s)throw new _u(Vt.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(_m.LocalVideoLowTrack))throw new _u(Vt.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));let l=[{track:r.getLowVideoTrack(s.track,e),type:_m.LocalVideoLowTrack}];if(yield*t3(Eet(r.doPublish(r.connection,l))),s.track.muted||!s.track.enabled){var o;let d=(o=r.localTrackMap.get(_m.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;d!==void 0&&(yield PE(r.connection.muteLocal([d])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(B.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await c0(this,fE.RequestRePublish,this.pendingLocalTracks),this.emit(fE.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(B.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await c0(this,fE.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){let{user:i,kind:o}=this.pendingRemoteTracks[r];(o!==cE.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==cE.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(e)await c0(this,fE.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===cE.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(fE.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==jE.Connected)return void e.forEach(o=>{let s=this.pendingLocalTracks.indexOf(o);s!==-1&&this.pendingLocalTracks.splice(s,1)});let r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;let i=r.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(e){if(!this.connection||this.state!==jE.Connected)return void e.forEach(i=>{let o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});let r=this.filterTobeUnpublishedDataChannels(e);return r.length!==0?(r.forEach(i=>{let o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==jE.Connected)return;let e=this.localTrackMap.get(_m.LocalVideoLowTrack);if(!e)return;e.track.close();let r=[[_m.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,r)}async doUnpublish(e,r){let i=this.createGatewayUnpublishMessage(r);return await e.stopSending(r.map(o=>{let[,{id:s}]=o;return s})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[s,{track:l}]=o;return{type:s,track:l}})),r.forEach(o=>{let[s]=o;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,r){if(!this.connection||this.state!==jE.Connected)throw new _u(Vt.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let i=r.filter(o=>{var s;return!((s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var s;this.remoteDataChannelMap.has(e)?(s=this.remoteDataChannelMap.get(e))===null||s===void 0||s.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));let l=this.pendingRemoteDataChannels.findIndex(d=>{let{user:h,id:p}=d;return h.uid===e.uid&&p===o.id});l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),i.map(o=>o.id)}async subscribe(e,r,i,o,s){var l;if(!this.connection||this.state!==jE.Connected)throw new _u(Vt.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((l=this.remoteUserMap.get(e))!==null&&l!==void 0&&l.has(r))return;let d,h,p,f=this.connection.getPreMedia(i);if(f)B.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),p=f.transceiver,d=f.track,h=f.id;else if(s){let b=s.find(k=>{let{stream_type:A}=k;return A===r});if(!b)throw new _u(Vt.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));let C=await this.connection.receive(r,b.ssrcs,String(e._uintid),b.attributes);this.connection instanceof WT&&(p=C.transceiver),d=C.track,h=C.id}else{let b=await this.connection.receive(r,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof WT&&(p=b.transceiver),d=b.track,h=b.id}r===cE.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new C1(d,e.uid,e._uintid,this.store),B.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),p&&e._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new I1(d,e.uid,e._uintid,this.store),B.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),p&&e._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(e,e._videoTrack)),_r("ENABLE_VIDEO_SEI")&&p&&(r==cE.VIDEO?await async function(b){let C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ME().supportWebRTCEncodedTransform)return void B.warning("browser not support video encoded transform");if(!b.track)return;if(ID.has(b)){let P=ID.get(b);return void(P&&(P.onSei=C.onSei))}let k={track:b.track,onSei:C.onSei};if(zI()){if(!b.createEncodedStreams)return void B.warning("browser not support createEncodedStreams() API");let P=null;try{P=b.createEncodedStreams()}catch(j){return void B.error("create video-encoded-streams error",j&&j.message)}let x=new TransformStream({transform(j,z){k.controller||(k.controller=z),b.track&&b.track.id!==k.track.id&&(B.debug("video track changed: ".concat(k.track.id," => ").concat(b.track.id)),k.track.removeEventListener("ended",A),k.track=b.track,k.track.addEventListener("ended",A));let _t=function(ue){let _n=new DataView(ue.data),Ei=0;for(;Ei+4<ue.data.byteLength;){if(_n.getUint8(Ei+0)===0&&_n.getUint8(Ei+1)===0&&_n.getUint8(Ei+2)===0&&_n.getUint8(Ei+3)===1&&_n.getUint8(Ei+4)===6){let _s=Ei+6,kc=0,_i=0;for(;(_i=_n.getUint8(_s++))===255;)kc+=255;kc+=_i;let _h=SRt(ue.data,_s,kc);return new Uint8Array(_h)}Ei++}return null}(j);_t&&k.onSei&&k.onSei(_t),z.enqueue(j)}});P.readable.pipeThrough(x).pipeTo(P.writable)}else if(a0()){if(typeof RTCRtpScriptTransform>"u")return void B.warning("browser not support RTCRtpScriptTransform");let P=jU(),x=new MessageChannel;await new eE(z=>P.onmessage=_t=>{_t.data==="registered"&&z(void 0)});let j=new RTCRtpScriptTransform(P,{name:"rx",port:x.port2},[x.port2]);b.transform=j,await new eE(z=>P.onmessage=_t=>{_t.data==="started"&&z(void 0)}),x.port1.onmessage=z=>{var _t;z.data.transformed&&b.track&&((_t=b.track)===null||_t===void 0?void 0:_t.id)!==k.track.id?(B.debug("video track changed: ".concat(k.track.id," => ").concat(b.track.id)),k.track.removeEventListener("ended",A),k.track=b.track,k.track.addEventListener("ended",A)):z.data.sei&&k.onSei&&k.onSei(z.data.sei)},k.worker=P}function A(){if(b.track){if(this.id!==b.track.id)return;b.track.removeEventListener("ended",A)}(function(P){let x=ID.get(P);if(x){ID.delete(P);try{var j,z;(j=x.controller)===null||j===void 0||j.terminate(),(z=x.worker)===null||z===void 0||z.terminate()}catch(_t){B.warning(_t&&_t.message)}}})(b)}ID.set(b,k),b.track.addEventListener("ended",A)}(p.receiver,{onSei:b=>{var C;(C=e._videoTrack)===null||C===void 0||C._onSei(b)}}):r==cE.AUDIO&&await async function(b){if(!ME().supportWebRTCEncodedTransform)return void B.warning("browser not support audio encoded transform");if(tU.has(b))return;let C={track:b.track};if(zI()){if(!b.createEncodedStreams)return void B.warning("browser not support createEncodedStreams() API");let A=null;try{A=b.createEncodedStreams()}catch(x){return void B.error("create audio-encoded-streams error",x&&x.message)}let P=new TransformStream({transform(x,j){C.controller||(C.controller=j),b.track&&b.track.id!==C.track.id&&(B.debug("audio track changed: ".concat(C.track.id," => ").concat(b.track.id)),C.track.removeEventListener("ended",k),C.track=b.track,C.track.addEventListener("ended",k)),j.enqueue(x)}});A.readable.pipeThrough(P).pipeTo(A.writable)}else if(a0()){if(typeof RTCRtpScriptTransform>"u")return void B.warning("browser not support RTCRtpScriptTransform");let A=jU(),P=new MessageChannel;await new eE(j=>A.onmessage=z=>{z.data==="registered"&&j(void 0)});let x=new RTCRtpScriptTransform(A,{name:"rx",port:P.port2},[P.port2]);b.transform=x,await new eE(j=>A.onmessage=z=>{z.data==="started"&&j(void 0)}),P.port1.onmessage=j=>{var z;j.data.transformed&&b.track&&((z=b.track)===null||z===void 0?void 0:z.id)!==C.track.id&&(B.debug("audio track changed: ".concat(C.track.id," => ").concat(b.track.id)),C.track.removeEventListener("ended",k),C.track=b.track,C.track.addEventListener("ended",k))},C.worker=A}function k(){b.track.removeEventListener("ended",k),function(A){let P=tU.get(A);if(P){tU.delete(A);try{var x,j;(x=P.controller)===null||x===void 0||x.terminate(),(j=P.worker)===null||j===void 0||j.terminate()}catch(z){B.warning(z&&z.message)}}}(b)}tU.set(b,C),b.track.addEventListener("ended",k)}(p.receiver));let _=this.remoteUserMap.get(e);_?_.set(r,h):this.remoteUserMap.set(e,new Map([[r,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let g=this.pendingRemoteTracks.findIndex(b=>{let{user:C,kind:k}=b;return C.uid===e.uid&&r===k});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(fE.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==jE.Connected)throw new _u(Vt.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(s=>{var l;let{user:d,mediaType:h}=s;return!((l=this.remoteUserMap.get(d))!==null&&l!==void 0&&l.has(h))});let r=[],i=new Map;e.forEach(s=>{if(!this.connection)return;let l=this.connection.getPreMedia(s.ssrcId);l?i.set(s.ssrcId,l):r.push(s)});let o=await this.connection.batchReceive(r.map(s=>{let{user:l,mediaType:d,ssrcId:h,rtxSsrcId:p}=s;return{kind:d,ssrcMsg:[{ssrcId:h,rtx:p}],mslabel:String(l._uintid)}}));r.forEach((s,l)=>{i.set(s.ssrcId,o[l])}),e.forEach(s=>{let{user:l,mediaType:d,ssrcId:h}=s,p=i.get(h);if(!p)return void B.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(l.uid," subscribe data,").concat(d,", ").concat(h));let{track:f,id:_,transceiver:g}=p;d===cE.AUDIO?(l._audioTrack?l._audioTrack._updateOriginMediaStreamTrack(f):(l._audioTrack=new C1(f,l.uid,l._uintid,this.store),B.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(l._audioTrack.getTrackId()))),g&&l._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(l,l._audioTrack)):(l._videoTrack?l._videoTrack._updateOriginMediaStreamTrack(f):(l._videoTrack=new I1(f,l.uid,l._uintid,this.store),B.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(l._videoTrack.getTrackId()))),g&&l._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(l,l._videoTrack));let b=this.remoteUserMap.get(l);b?b.set(d,_):this.remoteUserMap.set(l,new Map([[d,_]])),this.statsCollector.addRemoteStats(l.uid),this.statsUploader.startUploadInboundStats();let C=this.pendingRemoteTracks.findIndex(k=>{let{user:A,kind:P}=k;return A.uid===l.uid&&d===P});C!==-1&&(this.pendingRemoteTracks.splice(C,1),this.emit(fE.MediaReconnectEnd,l.uid))})}async unsubscribe(e,r,i){let o=this.pendingRemoteTracks.filter(d=>{let{user:h,kind:p}=d;return r!==void 0?h.uid===e.uid&&r===p:h.uid===e.uid});if(o.forEach(d=>{let h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)}),this.connection&&this.state===jE.Connected||i||o.forEach(d=>{let{kind:h}=d;var p;if(h===cE.AUDIO)(p=e._audioTrack)===null||p===void 0||p._destroy(),e._audioTrack=void 0;else if(h===cE.VIDEO){var f;(f=e._videoTrack)===null||f===void 0||f._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==jE.Connected)return;let s=this.filterTobeUnSubscribedTracks(e,r);if(s.length===0)return;await this.connection.stopReceiving(s.map(d=>{let[,{id:h}]=d;return h}));let l=this.createUnsubscribeMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(d=>{let[h,{kind:p}]=d;var f,_;if(p===cE.VIDEO&&h._videoSSRC&&((f=this.connection)===null||f===void 0||f.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),p===cE.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((_=h._videoTrack)===null||_===void 0||_._destroy(),h._videoTrack=void 0);else if(p===cE.AUDIO){var g;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((g=h._audioTrack)===null||g===void 0||g._destroy(),h._audioTrack=void 0)}}),l}async unsubscribeDataChannel(e,r){if(r.forEach(s=>{let l=this.pendingRemoteDataChannels.findIndex(d=>d.id===s.id);l!==-1&&this.pendingRemoteDataChannels.splice(l,1)}),!this.connection)return;let i=this.filterTobeUnSubscribedDataChannels(e,r);if(i.length===0)return;r.forEach(s=>{s._close()});let o=this.remoteDataChannelMap.get(e);return i.forEach(s=>{o&&o.delete(s.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(s=>s.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let r=[];for(let{user:s,mediaType:l}of e){let d=this.pendingRemoteTracks.filter(h=>{let{user:p,kind:f}=h;return l!==void 0?p.uid===s.uid&&l===f:p.uid===s.uid});d.forEach(h=>{let p=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(p,1)}),r=r.concat(d)}if(!this.connection||this.state!==jE.Connected)return void r.forEach(s=>{let{user:l,kind:d}=s;var h;if(d===cE.AUDIO)(h=l._audioTrack)===null||h===void 0||h._destroy(),l._audioTrack=void 0;else if(d===cE.VIDEO){var p;(p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0}});let i=QT(e).call(e,(s,l)=>{let{user:d,mediaType:h}=l,p=this.filterTobeUnSubscribedTracks(d,h);return s.concat(p)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(s=>{let[,{id:l}]=s;return l}));let o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(s=>{let[l,{kind:d}]=s;var h,p;if(d===cE.VIDEO&&l._videoSSRC&&((h=this.connection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),d===cE.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),(p=l._videoTrack)===null||p===void 0||p._destroy(),l._videoTrack=void 0;else if(d===cE.AUDIO){var f;this.unbindRemoteTrackEvents(l._audioTrack),(f=l._audioTrack)===null||f===void 0||f._destroy(),l._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==jE.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,r){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void B.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void B.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));let o=r===cE.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.connection)return;let i=this.remoteUserMap.get(e);if(!i)return void B.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||B.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){let r=this.localTrackMap.get(_m.LocalAudioTrack);if(r?.track instanceof D_){let i=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[s]=o;return s!==_m.LocalAudioTrack}).filter(o=>{let[s]=o;return!(e&&s===_m.LocalVideoLowTrack)}).map(o=>{let[,{track:s}]=o;return s}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===_m.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,r,i,o,s){if(e){let d=this.localTrackMap.get(_m.LocalAudioTrack),h=o?this.localTrackMap.get(_m.LocalVideoLowTrack):this.localTrackMap.get(_m.LocalVideoTrack);aE.publish(this.store.sessionId,{eventElapse:p0.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:d?.track.getTrackLabel(),videoName:h?.track.getTrackLabel(),screenshare:h?.track._hints.indexOf(XE.SCREEN_TRACK)!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var l;i||(i=[]);let d=i.find(p=>p instanceof h_),h=o?(l=this.localTrackMap.get(_m.LocalVideoTrack))===null||l===void 0?void 0:l.track:i.find(p=>p instanceof e_);aE.publish(this.store.sessionId,{eventElapse:p0.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:d?.getTrackLabel(),videoName:h?.getTrackLabel(),screenshare:h?._hints.indexOf(XE.SCREEN_TRACK)!==-1,audio:!!d,video:!!h,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,r,i,o){let s=o===cE.VIDEO?i._videoSSRC:i._audioSSRC;s&&aE.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===cE.VIDEO,audio:o===cE.AUDIO,peerid:i.uid,subscribeRequestid:s,p2pid:this.store.p2pId,eventElapse:p0.measureFromSubscribeStart(this.store.clientId,s),preSsrc:this.isPreSubScribe(s)})}reset(){B.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new f0("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new CD({},this.store):new WT({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(_m.LocalAudioTrack);if(e?.track instanceof D_){if(e.track.trackList.length>0){let r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=jE.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(_m.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(_m.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let r=this.localTrackMap.get(e);return r&&r.track instanceof e_||r&&r.track instanceof h_?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;let i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;let i=Array.from(RS(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}}),r=this.localTrackMap.get(_m.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=HL(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(B.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=jE.Reconnecting,_r("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new CD({},this.store):new WT({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:o}]=e;switch(i){case _m.LocalVideoTrack:nE(r=o._hints).call(r,XE.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case _m.LocalAudioTrack:o instanceof D_?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case _m.LocalVideoLowTrack:}}),this.emit(fE.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(RS(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(fE.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[r,i]=e;Array.from(RS(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),B.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,r){for(let i of this.pendingRemoteDataChannels){let{user:o,id:s}=i;if((e instanceof gR?e.uid:e)===o.uid&&s===r)return!0}return!1}setPendingRemoteDataChannel(e,r){this.hasPendingRemoteDataChannel(e,r)||this.pendingRemoteDataChannels.push({user:e,id:r})}hasPendingRemoteMedia(e,r){for(let i of this.pendingRemoteTracks){let{user:o,kind:s}=i;if((e instanceof gR?e.uid:e)===o.uid&&r===s)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}restartICE(e){var r=this;return YS(function*(){if(!r.connection||r.state!==jE.Connected)return;let i=yield PE(r.mutex.lock("From P2PChannel.restartICE")),o;try{o=yield PE(r.connection.restartICE(e));let l=yield PE(o.next());if(l.done)return;let d=l.value,h=yield d;switch(r.reportPCDisconnectedOrFailed(e),e){case hS.TCP:r._pcStatsUploadType=qR.TCP_RESTART;break;case hS.RELAY:r._pcStatsUploadType=qR.RELAY_RESTART;break;default:r._pcStatsUploadType=qR.OLD_RESTART}r._isInRestartIce=!0,o.next(h)}catch(l){var s;(s=o)===null||s===void 0||s.throw(l)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),r=this.localTrackMap.get(_m.LocalVideoTrack),i=this.localTrackMap.get(_m.LocalAudioTrack),o=e.videoSend.find(C=>C.ssrc===r?.ssrcs[0].ssrcId),s=e.audioSend.find(C=>C.ssrc===i?.ssrcs[0].ssrcId);if(!o||!s)return 1;let l=JS(this,fE.NeedSignalRTT),d=o?o.rttMs:void 0,h=s?s.rttMs:void 0,p=d&&h?(d+h)/2:d||h,f=(p&&l?(p+l)/2:p||l)||0,_=100*e.sendPacketLossRate*.7/50+.3*f/1500,g=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,b=r?.track;if(b&&b._encoderConfig&&b._hints.indexOf(XE.SCREEN_TRACK)===-1){let C=b._encoderConfig.bitrateMax,k=e.bitrate.actualEncoded;if(C&&k){let A=(1e3*C-k)/(1e3*C);return cst[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i,s=o._audioSSRC,l=o._videoSSRC,d=e.audioRecv.find(k=>k.ssrc===s),h=e.videoRecv.find(k=>k.ssrc===l);if(!d&&!h)return void(r+=1);let p=JS(this,fE.NeedSignalRTT),f=e.rtt,_=(f&&p?(f+p)/2:f||p)||0,g=d?d.jitterMs:void 0,b=e.recvPacketLossRate,C=.7*b*100/50+.3*_/1500;g&&(C=.6*b*100/50+.2*_/1500+.2*g/400),r+=C<.1?1:C<.17?2:C<.36?3:C<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new eE((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}async replaceTrack(e,r){var i;if(B.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==jE.Connected)return;let o=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:d}]=l;return e===d});if(!o)return;let s=o[0];if(e!==r&&(this.unbindLocalTrackEvents([{track:e,type:s}]),this.bindLocalTrackEvents([{track:r,type:s}]),o[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,o[1].id)),this.isPlanB){let l=o[1];l.id=r._mediaStreamTrack.id,this.localTrackMap.set(s,l)}if(s===_m.LocalVideoTrack&&!_r("DISABLE_DUAL_STREAM_USE_ENCODING")&&ME().supportDualStreamEncoding){let l=this.localTrackMap.get(_m.LocalVideoLowTrack);if(l){let d=e._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=d,l.track._originMediaStreamTrack=d,await new eE((h,p)=>{this.handleReplaceTrack(l.track,h,p,!0)})}}}filterTobePublishedTracks(e,r,i){let o=[],s=this.getAllTracks();e=E1(e=e.filter(p=>s.indexOf(p)===-1));let l,d=!1,h=this.localTrackMap.get(_m.LocalAudioTrack);for(let p of e){if(p instanceof e_&&(this.localTrackMap.has(_m.LocalVideoTrack)||d?new _u(Vt.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:p,type:_m.LocalVideoTrack}),d=!0),r)){let f=this.getLowVideoTrack(p,i);o.push({track:f,type:_m.LocalVideoLowTrack})}if(p instanceof h_)if(h){let f=h.track;if(f instanceof D_)X8([p]),f.addAudioTrack(p),this.bindLocalAudioTrackEvents(p,!0);else{let _=t5([f,p]);B.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_.getTrackId(),"]")),this.replaceTrack(f,_)}}else l instanceof D_?(X8([p]),l.addAudioTrack(p)):l||!p._useAudioElement&&ME().webAudioMediaStreamDest&&!p._bypassWebAudio?l=t5(l?[p,l]:[p]):l=p}return l&&(B.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(l.getTrackId(),"]")),o.push({track:l,type:_m.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){let r=[],i=this.getAllTracks();e=E1(e=e.filter(o=>i.indexOf(o)!==-1));for(let o of e){if(o instanceof h_){let s=this.localTrackMap.get(_m.LocalAudioTrack);if(!s)continue;s.track instanceof D_?(s.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),s.track.trackList.length===0&&(r.push([_m.LocalAudioTrack,s]),s.track.close())):r.push([_m.LocalAudioTrack,s])}if(o instanceof e_){let s=this.localTrackMap.get(_m.LocalVideoTrack);if(!s)continue;r.push([_m.LocalVideoTrack,s]);let l=this.localTrackMap.get(_m.LocalVideoLowTrack);l&&r.push([_m.LocalVideoLowTrack,l])}}return r}filterTobePublishedDataChannels(e){return e=(e=E1(e)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=E1(e)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:o}=r;switch(o){case _m.LocalVideoTrack:i.addListener(iE.GET_STATS,this.handleGetLocalVideoStats),i.addListener(iE.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(iE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(iE.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(iE.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _m.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case _m.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof D_?e.trackList.forEach(i=>{i.addListener(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(iE.GET_STATS,this.handleGetLocalAudioStats),i.addListener(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(iE.GET_STATS,this.handleGetLocalAudioStats),e.addListener(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(e.addListener(iE.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(iE.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:o}]=r;return{track:o,type:i}})),e.forEach(r=>{let{track:i,type:o}=r;switch(o){case _m.LocalVideoTrack:i.off(iE.GET_STATS,this.handleGetLocalVideoStats),i.off(iE.GET_RTC_STATS,this.handleGetRTCStats),i.off(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(iE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(iE.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(iE.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case _m.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case _m.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof D_?e.trackList.forEach(r=>{r.off(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(iE.GET_STATS,this.handleGetLocalAudioStats),r.off(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(iE.GET_STATS,this.handleGetLocalAudioStats),e.off(iE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(iE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(iE.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(iE.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(iE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(iE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof I1&&r.addListener(iE.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof C1&&r.addListener(iE.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(iE.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(cE.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(cE.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,o)=>{var s;let l,d,{track:h,type:p}=i;switch(p){case _m.LocalAudioTrack:l=VE.Audio,d={dtx:h instanceof v3&&h._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case _m.LocalVideoTrack:l=nE(s=h._hints).call(s,XE.SCREEN_TRACK)?VE.Screen:VE.High,d=pR(pR({},fZ(h)),{},{codec:this.store.codec,svc_mode:B8()});break;case _m.LocalVideoLowTrack:l=VE.Low,d=pR(pR({},fZ(h)),{},{codec:this.store.codec,svc_mode:B8()})}return{stream_type:l,attributes:d,ssrcs:r[o]}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let o,[s,{track:l,ssrcs:d,id:h}]=r;switch(s){case _m.LocalVideoTrack:o=nE(i=l._hints).call(i,XE.SCREEN_TRACK)?VE.Screen:VE.High;break;case _m.LocalAudioTrack:o=VE.Audio;break;case _m.LocalVideoLowTrack:o=VE.Low}return{stream_type:o,ssrcs:d,mid:h}})}assignLocalTracks(e,r){e.forEach((i,o)=>{let{track:s,type:l}=i;this.localTrackMap.set(l,{track:s,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{if(B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(fE.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),_r("NEW_ICE_RESTART")){var i;if(nE(i=this._restartStates).call(i,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let o=d=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(B.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(d)),JS(this,fE.QueryClientConnectionState)==="CONNECTED"&&this.emit(fE.RequestRestartICE,d))},s=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),B.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(fE.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},l=_r("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(_r("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ME().supportPCSetConfiguration)o(hS.RELAY),this._restartTimer=window.setTimeout(s,l);else if(f_())o(hS.UDP),this._restartTimer=window.setTimeout(s,4e3);else{if(o(hS.TCP),ME().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{o(hS.RELAY),this._restartTimer=window.setTimeout(s,l)},l));this._restartTimer=window.setTimeout(s,l)}},800))}}else{if(r==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&_r("ICE_RESTART")&&JS(this,fE.QueryClientConnectionState)==="CONNECTED"&&this.emit(fE.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(B.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(fE.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(B.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(fE.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),aE.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:p_.TRACER}).onSuccess(),this.emit(fE.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;let o=Array.from(RS(i=this.remoteUserMap).call(i)).find(l=>l._audioSSRC===r);var s;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(s=o.audioTrack)===null||s===void 0||s.emit(w1.FIRST_FRAME_DECODED),aE.firstRemoteFrame(this.store.sessionId,Eg.FIRST_AUDIO_DECODE,d_.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:p0.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;let o=Array.from(RS(i=this.remoteUserMap).call(i)).find(s=>s._audioSSRC===r);o&&aE.firstRemoteFrame(this.store.sessionId,Eg.FIRST_AUDIO_RECEIVED,d_.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:p0.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,o)=>{this.reportVideoFirstFrameDecoded(r,i,o)},e.onFirstVideoReceived=r=>{var i;let o=Array.from(RS(i=this.remoteUserMap).call(i)).find(s=>s._videoSSRC===r);o&&aE.firstRemoteFrame(this.store.sessionId,Eg.FIRST_VIDEO_RECEIVED,d_.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:p0.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{let o=r.candidateType==="relay",s=i.candidateType==="relay";i.candidateType!=="unknown"&&o===s||this.emit(fE.ConnectionTypeChange,o),B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(qI(i))," -> ").concat(JSON.stringify(qI(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{B.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(qI(i))," -> ").concat(JSON.stringify(qI(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return pR(pR({},r),i)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){let r=[];if(this.getAllTracks().indexOf(e)===-1)return r;let i=this.localTrackMap.get(_m.LocalAudioTrack);if(e instanceof h_&&i?.track instanceof D_)return i.track.isActive||r.push([_m.LocalAudioTrack,i]),r;let o=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:l}]=s;return e===l});if(o&&(r.push(o),o[0]===_m.LocalVideoTrack)){let s=this.localTrackMap.get(_m.LocalVideoLowTrack);s&&r.push([_m.LocalVideoLowTrack,s])}return r}filterTobeUnmutedTracks(e){let r=[],i=this.localTrackMap.get(_m.LocalAudioTrack);if(e instanceof h_&&i?.track instanceof D_)return i.track.isActive&&r.push([_m.LocalAudioTrack,i]),r;let o=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:l}]=s;return e===l});if(o)if(o[0]===_m.LocalVideoTrack){r.push(o);let s=this.localTrackMap.get(_m.LocalVideoLowTrack);s&&r.push([_m.LocalVideoLowTrack,s])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var i;let o,[s,{track:l,ssrcs:d,id:h}]=r;switch(s){case _m.LocalAudioTrack:o=VE.Audio;break;case _m.LocalVideoTrack:o=nE(i=l._hints).call(i,XE.SCREEN_TRACK)?VE.Screen:VE.High;break;case _m.LocalVideoLowTrack:o=VE.Low}return{stream_type:o,ssrcs:d,mid:h}})}createUnmuteMessage(e){return e.map(r=>{var i;let o,[s,{track:l,ssrcs:d,id:h}]=r;switch(s){case _m.LocalAudioTrack:o=VE.Audio;break;case _m.LocalVideoTrack:o=nE(i=l._hints).call(i,XE.SCREEN_TRACK)?VE.Screen:VE.High;break;case _m.LocalVideoLowTrack:o=VE.Low}return{stream_type:o,ssrcs:d,mid:h}})}filterTobeUnSubscribedTracks(e,r){let i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(r){let s=o.get(r);if(!s)return i;i.push([e,{kind:r,id:s}])}else Array.from(o.entries()).forEach(s=>{let[l,d]=s;i.push([e,{kind:l,id:d}])});return i}filterTobeUnSubscribedDataChannels(e,r){let i=[];return r.forEach(o=>{var s;(s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){let r=[];return e.forEach(i=>{let[o,{kind:s,id:l}]=i;switch(s){case cE.VIDEO:return void(o._videoSSRC&&r.push({stream_type:cE.VIDEO,ssrcId:o._videoSSRC}));case cE.AUDIO:return void(o._audioSSRC&&r.push({stream_type:cE.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(e){let r=new Map;return e.forEach(i=>{let[o,{kind:s}]=i;if(r.has(o)){let l=r.get(o);s===cE.VIDEO?l|=q_.Video:l|=q_.Audio,r.set(o,l)}else s===cE.VIDEO?r.set(o,q_.Video):r.set(o,q_.Audio)}),{users:Array.from(r.entries()).map(i=>{let[o,s]=i;return{stream_id:o.uid,stream_type:s}})}}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:o}]=r,s=this.remoteUserMap.get(i);s&&(s.delete(o),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){let r=this.localTrackMap.get(_m.LocalVideoTrack),i=this.localTrackMap.get(_m.LocalVideoLowTrack);r&&await r.track.setBitrateLimit(e.uplink),i&&e.low_stream_uplink&&await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,r,i){return e.map((o,s)=>{var l;let{stream_type:d}=o,h=(l=r.find(p=>{let{stream_type:f}=p;return d===f}))===null||l===void 0?void 0:l.attributes;if(h&&_r("DISABLE_SCREEN_SHARE_REMB")){let p=i[s]._hints;(nE(p).call(p,XE.SCREEN_TRACK)||nE(p).call(p,XE.SCREEN_LOW_TRACK))&&(h.remb=!1,B.debug("disable remb for screen share, hints:",p))}return h})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof h_){var r;let o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(l=>{let[,{id:d}]=l;return d})));let s=this.createUnmuteMessage(o);return void await JE(this,fE.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(fE.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(fE.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await _y(ZW(this.dtlsFailedCount,N_)),this.emit(fE.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),r.length>0&&await c0(this,fE.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(fE.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(_m.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof e_)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof e_).length>1)throw new _u(Vt.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof h_).length>1&&(e.some(r=>r instanceof h_&&r._bypassWebAudio)||!ME().webAudioMediaStreamDest))throw new _u(Vt.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let r of e){if(r instanceof e_&&this.pendingLocalTracks.some(i=>i instanceof e_))throw new _u(Vt.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof h_&&this.pendingLocalTracks.some(i=>i instanceof h_)&&(!ME().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof h_&&i._bypassWebAudio)))throw new _u(Vt.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){var i;let o=!_r("DISABLE_DUAL_STREAM_USE_ENCODING")&&ME().supportDualStreamEncoding,s=pR(pR({},{width:160,height:120,framerate:15,bitrate:50}),r),l;l=o?e._mediaStreamTrack.clone():J8(e,s);let d=ZE(8,"track-low-"),h=new e_(l,pR(pR({},o&&{scaleResolutionDownBy:N8(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,d);return h.on(YO.TRANSCEIVER_UPDATED,p=>{e._updateRtpTransceiver(p,x1.LOW_STREAM)}),h._hints.push(XE.LOW_STREAM),nE(i=e._hints).call(i,XE.SCREEN_TRACK)&&h._hints.push(XE.SCREEN_LOW_TRACK),e.on("sei-to-send",p=>{h.emit("sei-to-send",p)}),e.addListener(iE.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,r,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof WT){var s,l,d,h;let p=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:f,dtlsTransportState:_,peerConnectionState:g}=this.connection,{local:b,remote:C}=await this.connection.getSelectedCandidatePair();aE.pcStats(this.store.sessionId,{startTime:p,eventElapse:e-p||0,iceconnectionsate:f,dtlsstate:_,connectionstate:g,intSucc:r?1:2,error:o,selectedLocalCandidateProtocol:(s=b?.protocol)!==null&&s!==void 0?s:"",selectedLocalCandidateType:(l=b.candidateType)!==null&&l!==void 0?l:"",selectedLocalCandidateAddress:"".concat(b.address,":").concat(b.port),selectedRemoteCandidateProtocol:(d=C.protocol)!==null&&d!==void 0?d:"",selectedRemoteCandidateType:(h=C.candidateType)!==null&&h!==void 0?h:"",selectedRemoteCandidateAddress:"".concat(C.address,":").concat(C.port),restartCnt:i,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(e,r,i,o){var s;let l=Array.from(RS(s=this.remoteUserMap).call(s)).find(d=>d._videoSSRC===e);if(l){o||this.store.subscribe(l.uid,"video",void 0,void 0,void 0,void 0,Date.now());let d=this.store.keyMetrics,h=d.subscribe.find(p=>p.userId===l.uid&&p.type==="video");aE.firstRemoteVideoDecode(this.store.sessionId,Eg.FIRST_VIDEO_DECODE,d_.FIRST_VIDEO_DECODE,{peer:l._uintid,videowidth:r,videoheight:i,subscribeElapse:p0.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:h?.subscribeEnd||0,subscriberStart:h?.subscribeStart||0,videoAddNotify:h?.streamAdded||0,state:o?1:0,firstFrame:h?.firstFrame||0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.connection)return!1;let o=this.remoteUserMap.get(e);if(!o)return!1;let s=o.get(r);if(!s)return!1;let l=await this.connection.getRemoteSSRC(s);return l!==void 0&&l!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===_m.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,x1.LOW_STREAM):i._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof WT&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===qR.TCP_RESTART&&e===hS.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,qR.DISCONNECTED_OR_FAILED)))}},oE(TE.prototype,"startP2PConnection",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"startP2PConnection"),TE.prototype),oE(TE.prototype,"connect",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"connect"),TE.prototype),oE(TE.prototype,"updateRemoteRTPCapabilities",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"updateRemoteRTPCapabilities"),TE.prototype),oE(TE.prototype,"publishDataChannel",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"publishDataChannel"),TE.prototype),oE(TE.prototype,"unpublish",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"unpublish"),TE.prototype),oE(TE.prototype,"unpublishDataChannel",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"unpublishDataChannel"),TE.prototype),oE(TE.prototype,"unpublishLowStream",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"unpublishLowStream"),TE.prototype),oE(TE.prototype,"subscribeDataChannel",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"subscribeDataChannel"),TE.prototype),oE(TE.prototype,"subscribe",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"subscribe"),TE.prototype),oE(TE.prototype,"massSubscribe",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"massSubscribe"),TE.prototype),oE(TE.prototype,"unsubscribe",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"unsubscribe"),TE.prototype),oE(TE.prototype,"unsubscribeDataChannel",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"unsubscribeDataChannel"),TE.prototype),oE(TE.prototype,"massUnsubscribe",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"massUnsubscribe"),TE.prototype),oE(TE.prototype,"muteRemote",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"muteRemote"),TE.prototype),oE(TE.prototype,"unmuteRemote",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"unmuteRemote"),TE.prototype),oE(TE.prototype,"hasRemoteMediaWithLock",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"hasRemoteMediaWithLock"),TE.prototype),oE(TE.prototype,"disconnectForReconnect",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"disconnectForReconnect"),TE.prototype),oE(TE.prototype,"updateBitrateLimit",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"updateBitrateLimit"),TE.prototype),oE(TE.prototype,"remoteMediaSsrcChanged",[R0],Object.getOwnPropertyDescriptor(TE.prototype,"remoteMediaSsrcChanged"),TE.prototype),TE);function R0(e,r,i){let o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let s=this.mutex,l=await s.lock("From P2PChannel.".concat(r));try{for(var d=arguments.length,h=new Array(d),p=0;p<d;p++)h[p]=arguments[p];return await o.apply(this,h)}finally{l()}},i}var tat={};function OD(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&B.debug("install service ".concat(e.name)),tat[e.name]=e}function WD(e){let r=tat[e];if(!r)throw new _u(Vt.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return r}function _et(e,r){return WD("DataStream").create(e,r)}function get(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function vet(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?get(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):get(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var HRt=Date.now(),KRt=20,Z8=new Map,GU=new Map;async function eat(e){let r=Z8.get(e),i=Array.isArray(r)&&r[r.length-1],o=GU.get(e);if(!i)return void(o.isSyncing=!1);let s={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);let l=i.sendTs-o.firstSendTs,d=l-(Date.now()-o.firstRecvTs);d>0&&(o.firstRecvTs=Date.now()-l);let h=i.mediaDelay+d;h<=0?(r.pop(),nat(i.context,s),h=0):h=Math.min(h,KRt),setTimeout(()=>r.length&&eat(e),h)}function nat(e,r){e.safeEmit(CE.STREAM_MESSAGE,r.uid,r.payload),e.onStreamMessage&&e.onStreamMessage(r)}function zRt(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return nat(i,{uid:e.uid,payload:e.payload});let o="".concat(i.id,"-").concat(e.uid),s=Z8.get(o)||[],l=s.findIndex(f=>e.sendTs>=f.sendTs),d=vet(vet({},e),{},{context:i,mediaDelay:r,recvTs:Date.now()});l===-1?s.push(d):s.splice(l,0,d),Z8.set(o,s);let h=!1;var p;GU.has(o)?h=!((p=GU.get(o))===null||p===void 0||!p.isSyncing):GU.set(o,{isSyncing:h,firstRecvTs:0,firstSendTs:0}),h||eat(o)}var YRt=DE().name;function yet(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function Tet(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?yet(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):yet(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var N1="websdk_ng_cache_parameter",JRt=_r("MAX_PRELOAD_ASYNC_LENGTH"),XRt=1e4,xO=new Map,jO=[],n5=null,r5=0,i5=0,uU=new Map,QRt=function(e,r){let i=[],o=0,s=async()=>{let l=i.shift();l&&await l(),i.length>0&&o<r?s():o--};return async function(){for(var l=arguments.length,d=new Array(l),h=0;h<l;h++)d[h]=arguments[h];return new eE(async(p,f)=>{i.push(async()=>{try{let _=await e(...d);p(_)}catch(_){f(_)}}),o<r&&(o++,s())})}}(rat,JRt),o5=K0.CancelToken.source();async function rat(e,r,i,o,s,l){try{if(!_r("ENABLE_PRELOAD"))return;if(!ME().supportWebCrypto)return void _C(()=>{B.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new _u(Vt.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&_g(i,"token",1,2047),_g(e,"appid",1,2047),fV(r),o&&mV(o);let d=_1();B.debug("preload channel ".concat(r,", uid is ").concat(o));let h={appId:e,cname:r,token:i||e,uid:typeof o!="string"?o:null,sid:d,proxyServer:s},p,f;typeof o=="string"?(h.stringUid=o,[f,p]=await eE.all([ARt(o,{sid:d,appId:e},o5.token),Ctt(Tet(Tet({},h),{},{token:i||e,uid:0}),o5.token)]),h.uid=f.uid,p.gatewayInfo.uid=h.uid,p.gatewayInfo.res.uid=h.uid):(l&&(h.stringUid=l),p=await Ctt(h,o5.token));let _={sid:d,appId:e,cname:r,token:i||e,uid:h.stringUid||o,intUid:h.uid||p.gatewayInfo.uid,stringUid:h.stringUid,ts:Date.now(),sua:f,ap:p};await async function(g){let b;try{g.uid&&iat({appId:g.appId,cname:g.cname,token:g.token,uid:g.uid,stringUid:g.stringUid});let C=aat(g),k=await async function(P,x){try{let j=await window.crypto.subtle.importKey("raw",ist(x),"AES-GCM",!1,["encrypt"]),z=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},j,GO(window.btoa(JSON.stringify(P))));return YI(new Uint8Array(z))}catch{return}}(g,g.token||g.appId);if(!k)return;b=sat(N1);let A=b?JSON.parse(b):[];A.push({[C]:k}),A.length>_r("AP_CACHE_NUM")&&A.shift(),D3(N1,JSON.stringify(A))}catch(C){B.warn("Error caching server parameters:",C.message),D3(N1,"")}}(_),r5++}catch(d){throw i5++,function(h){n5||(n5=window.setTimeout(()=>{let f="";uU.forEach((_,g)=>{f+="".concat(g,": ").concat(_," ;")}),aE.reportApiInvoke(null,{name:L_.PRELOAD,options:{success:r5,failed:i5,err:f}}).onError(h),r5=0,i5=0,uU.clear(),n5=null},XRt));let p=uU.get(h.code)||0;uU.set(h.code,p+1)}(d),d}}async function bet(e){try{if(_r("AP_REQUEST_DETAIL"))return;let r=iat(e);if(!r||e.cloudProxyServer!=="disabled")return;let i=await async function(o,s){try{let l=await window.crypto.subtle.importKey("raw",ist(s),"AES-GCM",!1,["decrypt"]),d=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},l,GO(o));return JSON.parse(window.atob(YI(new Uint8Array(d))))}catch{return}}(r,e.token||e.appId);if(!i||!function(o,s){return o.cname===s.cname&&o.appId===s.appId&&o.token===s.token?s.stringUid?o.stringUid===s.stringUid:typeof s.uid=="number"?o.uid===s.uid:o.uid==s.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<_r("AP_CACHE_LIFETIME"))return i}catch(r){B.warn("Error get preloadInfo",r.message)}}function iat(e){let r;try{if(r=sat(N1),!r)return;let i=JSON.parse(r),o=aat(e),s=function(d,h){for(let p=d.length-1;p>=0;p--)if(h(d[p]))return p;return-1}(i,d=>o in d);if(s===-1)return;let l=i.splice(s,1)[0];return D3(N1,JSON.stringify(i)),l[o]}catch(i){B.warn("Error delete preload info: ".concat(r),i.message),D3(N1,"")}}function EH(e){if(e){let r=xO.get(e);r&&(window.clearTimeout(r),r=null,xO.delete(e)),nE(jO).call(jO,e)||e.cloudProxyServer!=="disabled"||jO.push(e)}if(xO.size<_r("AP_CACHE_NUM")&&jO.length>0){let r=jO.shift();xO.set(r,window.setTimeout(async()=>{let{appId:i,cname:o,token:s,stringUid:l,uid:d,proxyServer:h}=r;try{await QRt(i,o,s,d,h,l),xO.has(r)&&EH(r)}catch(p){B.warn("update preload failed",p.message),oat(r)}},_r("AP_UPDATE_INTERVAL")))}}function oat(e){let r=jO.indexOf(e);r!==-1&&jO.splice(r,1);let i=xO.get(e);i&&(window.clearTimeout(i),i=null,xO.delete(e),EH())}function Ret(e,r){let i=e.sua,o=e.ap;r&&i&&aE.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:e.intUid,errorCode:null,extend:i.req}),aE.reportResourceTiming(e.ap.url,e.sid),aE.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(s=>s.ip).join(","),eventType:"disabled",unilbsServerIds:[w_.CHOOSE_SERVER,w_.CLOUD_PROXY_FALLBACK].toString()}),aE.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(s=>s.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[w_.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function sat(e){return window.atob(window.localStorage.getItem(e)||"")}function D3(e,r){window.localStorage.setItem(e,window.btoa(r))}function aat(e){let r="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(r+="_s_".concat(e.uid)),typeof e.uid=="number"&&(r+="_".concat(e.uid)),e.token&&(r+="_".concat(e.token)),sst(r)}function ZRt(e){let r=function(){let i=ewt.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let s=i.appId;s!==void 0&&(b_(o,10),LI(o,s));let l=i.cid;l!==void 0&&(b_(o,16),b_(o,l));let d=i.cname;d!==void 0&&(b_(o,26),LI(o,d));let h=i.deviceId;h!==void 0&&(b_(o,34),LI(o,h));let p=i.elapse;p!==void 0&&(b_(o,40),MI(o,p));let f=i.fileSize;f!==void 0&&(b_(o,48),MI(o,n1(f)));let _=i.height;_!==void 0&&(b_(o,56),MI(o,n1(_)));let g=i.jpg;g!==void 0&&(b_(o,66),b_(o,g.length),wet(o,g));let b=i.networkType;b!==void 0&&(b_(o,72),MI(o,n1(b)));let C=i.osType;C!==void 0&&(b_(o,80),MI(o,n1(C)));let k=i.requestId;k!==void 0&&(b_(o,90),LI(o,k));let A=i.sdkVersion;A!==void 0&&(b_(o,98),LI(o,A));let P=i.sequence;P!==void 0&&(b_(o,104),MI(o,n1(P)));let x=i.sid;x!==void 0&&(b_(o,114),LI(o,x));let j=i.timestamp;j!==void 0&&(b_(o,120),MI(o,j));let z=i.uid;z!==void 0&&(b_(o,128),b_(o,z));let _t=i.vid;_t!==void 0&&(b_(o,136),b_(o,_t));let ue=i.width;ue!==void 0&&(b_(o,144),MI(o,n1(ue)));let _n=i.service;_n!==void 0&&(b_(o,152),b_(o,_n));let Ei=i.callbackData;Ei!==void 0&&(b_(o,162),b_(o,Ei.length),wet(o,Ei));let _s=i.ticket;_s!==void 0&&(b_(o,170),LI(o,_s));let kc=i.vendorConfigs;kc!==void 0&&(b_(o,178),LI(o,kc))}(e,r),function(i){let o=i.bytes,s=i.limit;return o.length===s?o:o.subarray(0,s)}(r)}function $Rt(e){return function(i){let o={};t:for(;!nwt(i);){let s=HD(i);switch(s>>>3){case 0:break t;case 1:o.code=HD(i);break;case 2:o.msg=Iet(i,HD(i));break;case 3:o.requestId=Iet(i,HD(i));break;case 4:o.timestamp=rwt(i,!1);break;default:twt(i,7&s)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function twt(e,r){switch(r){case 0:for(;128&gT(e););break;case 2:s5(e,HD(e));break;case 5:s5(e,4);break;case 1:s5(e,8);break;default:throw new Error("Unimplemented type: "+r)}}function n1(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var ewt=[];function s5(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function nwt(e){return e.offset>=e.limit}function _V(e,r){let i=e.bytes,o=e.offset,s=e.limit,l=o+r;if(l>i.length){let d=new Uint8Array(2*l);d.set(i),e.bytes=d}return e.offset=l,l>s&&(e.limit=l),o}function cat(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function wet(e,r){let i=_V(e,r.length);e.bytes.set(r,i)}function Iet(e,r){let i=cat(e,r),o=String.fromCharCode,s=e.bytes,l="\uFFFD",d="";for(let h=0;h<r;h++){let p,f,_,g,b=s[h+i];128&b?(224&b)==192?h+1>=r?d+=l:(p=s[h+i+1],(192&p)!=128?d+=l:(g=(31&b)<<6|63&p,g<128?d+=l:(d+=o(g),h++))):(240&b)==224?h+2>=r?d+=l:(p=s[h+i+1],f=s[h+i+2],(49344&(p|f<<8))!=32896?d+=l:(g=(15&b)<<12|(63&p)<<6|63&f,g<2048||g>=55296&&g<=57343?d+=l:(d+=o(g),h+=2))):(248&b)==240?h+3>=r?d+=l:(p=s[h+i+1],f=s[h+i+2],_=s[h+i+3],(12632256&(p|f<<8|_<<16))!=8421504?d+=l:(g=(7&b)<<18|(63&p)<<12|(63&f)<<6|63&_,g<65536||g>1114111?d+=l:(g-=65536,d+=o(55296+(g>>10),56320+(1023&g)),h+=3))):d+=l:d+=o(b)}return d}function LI(e,r){let i=r.length,o=0;for(let d=0;d<i;d++){let h=r.charCodeAt(d);h>=55296&&h<=56319&&d+1<i&&(h=(h<<10)+r.charCodeAt(++d)-56613888),o+=h<128?1:h<2048?2:h<65536?3:4}b_(e,o);let s=_V(e,o),l=e.bytes;for(let d=0;d<i;d++){let h=r.charCodeAt(d);h>=55296&&h<=56319&&d+1<i&&(h=(h<<10)+r.charCodeAt(++d)-56613888),h<128?l[s++]=h:(h<2048?l[s++]=h>>6&31|192:(h<65536?l[s++]=h>>12&15|224:(l[s++]=h>>18&7|240,l[s++]=h>>12&63|128),l[s++]=h>>6&63|128),l[s++]=63&h|128)}}function gT(e){return e.bytes[cat(e,1)]}function Cet(e,r){let i=_V(e,1);e.bytes[i]=r}function HD(e){let r,i=0,o=0;do r=gT(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function b_(e,r){for(r>>>=0;r>=128;)Cet(e,127&r|128),r>>>=7;Cet(e,r)}function rwt(e,r){let i,o=0,s=0,l=0;return i=gT(e),o=127&i,128&i&&(i=gT(e),o|=(127&i)<<7,128&i&&(i=gT(e),o|=(127&i)<<14,128&i&&(i=gT(e),o|=(127&i)<<21,128&i&&(i=gT(e),s=127&i,128&i&&(i=gT(e),s|=(127&i)<<7,128&i&&(i=gT(e),s|=(127&i)<<14,128&i&&(i=gT(e),s|=(127&i)<<21,128&i&&(i=gT(e),l=127&i,128&i&&(i=gT(e),l|=(127&i)<<7))))))))),{low:o|s<<28,high:s>>>4|l<<24,unsigned:r}}function MI(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,s=r.high>>>24,l=s===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:s<128?9:10,d=_V(e,l),h=e.bytes;switch(l){case 10:h[d+9]=s>>>7&1;case 9:h[d+8]=l!==9?128|s:127&s;case 8:h[d+7]=l!==8?o>>>21|128:o>>>21&127;case 7:h[d+6]=l!==7?o>>>14|128:o>>>14&127;case 6:h[d+5]=l!==6?o>>>7|128:o>>>7&127;case 5:h[d+4]=l!==5?128|o:127&o;case 4:h[d+3]=l!==4?i>>>21|128:i>>>21&127;case 3:h[d+2]=l!==3?i>>>14|128:i>>>14&127;case 2:h[d+1]=l!==2?i>>>7|128:i>>>7&127;case 1:h[d]=l!==1?128|i:127&i}}var Aet={},Oet={},L3=4294967296,uat=L3*L3,Net=uat/2,a5=lat(0,!0),ket=lat(0),iwt=B1(0,-2147483648,!1),owt=B1(-1,2147483647,!1),swt=B1(-1,-1,!0);function lat(e,r){let i,o,s;return r?(s=0<=(e>>>=0)&&e<256)&&(o=Oet[e],o)?o:(i=B1(e,0,!0),s&&(Oet[e]=i),i):(s=-128<=(e|=0)&&e<128)&&(o=Aet[e],o)?o:(i=B1(e,e<0?-1:0,!1),s&&(Aet[e]=i),i)}function B1(e,r,i){return{low:0|e,high:0|r,unsigned:!!i}}function awt(e,r){if(isNaN(e))return r?a5:ket;if(r){if(e<0)return a5;if(e>=uat)return swt}else{if(e<=-Net)return iwt;if(e+1>=Net)return owt}return e<0?r?a5:ket:B1(e%L3|0,e/L3|0,r)}function Pet(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}var $8=class e extends s_{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;let i=this._connectionState;this._connectionState=r,this.emit(KT.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),$(this,"name","AgoraRTCImageModeration"),$(this,"_connectionState",GS.CONNECTING),$(this,"_sequence",0),$(this,"_moderationStartTime",void 0),$(this,"_workerConnection",void 0),$(this,"_workerMessageLengthLimit",void 0),$(this,"_qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",K0.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"_moderationInterval",void 0),$(this,"_moderationTimer",null),$(this,"_moderationMode",1),$(this,"_quality",1),$(this,"_qualityTimer",null),$(this,"_ticket",void 0),$(this,"_moderationIntervalMinimum",void 0),$(this,"_uploadFailedNum",0),$(this,"_uploadNum",0),$(this,"_uploadTimer",null),$(this,"_extraInfo",void 0),$(this,"_vendor",""),$(this,"_encoder",new TextEncoder),$(this,"_moderationId",void 0),$(this,"inspectImage",()=>{if(this.connectionState!==GS.CONNECTED)throw new _a(Vt.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===GS.CONNECTED?this.requestToInspectImage():B.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ZE(5,"image-moderation-"),this._workerMessageLengthLimit=_r("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=_r("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=_r("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new eN("worker-"+this._moderationId,N_),this.on(KT.STATE_CHANGE,(o,s)=>{B.debug("[".concat(this._moderationId,"] Moderation operation :").concat(YN[o]," ").concat(s||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(KT.STATE_CHANGE,YN.CONNECT_AP),this._connectInfo=r;let o=this._cancelTokenSource.token;return this._retryConfig=i,new eE((s,l)=>{this.on(KT.CONNECTION_STATE_CHANGE,(d,h)=>{d===GS.CONNECTED&&s()}),this.requestAP(r,o,i).then(d=>{this.connectWorker(d)}).catch(d=>{l(d)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),B.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===GS.CONNECTED&&this.inspectImage()}async requestAP(r,i,o){let s=_r("WEBCS_DOMAIN").map(p=>"https://".concat(p,"/api/v1")),l=await function(p,f,_,g){let{appId:b,areaCode:C,cname:k,sid:A,token:P,uid:x}=f;A1++;let j="moderation_plugin",z={service_name:j,json_body:JSON.stringify({appId:b,areaCode:C,cname:k,command:"allocateEdge",requestId:A1,seq:A1,sid:A,appToken:P,ts:Date.now(),uid:x+""})},_t,ue,_n=p[0];return $T(async()=>{_t=Date.now();let Ei=await _b(_n,{data:z,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ue=Date.now()-_t,Ei.code!==0){let _i=new _a(Vt.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ei.code,{retry:!0,responseTime:ue});throw B.error(_i.toString()),_i}let _s=JSON.parse(Ei.json_body);if(_s.code!==200){let _i=new _a(Vt.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(_s.code,", reason: ").concat(_s.reason),{code:_s.code,responseTime:ue});throw B.error(_i.toString()),_i}if(!_s.servers||!Array.isArray(_s.servers)||_s.servers.length===0){let _i=new _a(Vt.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:_s.code,responseTime:ue});throw B.error(_i.toString()),_i}if(!_s.servers.some(_i=>!!_i.wss)){let _i=new _a(Vt.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:_s.code,responseTime:ue});throw B.error(_i.toString()),_i}let kc=_r("IMAGE_MODERATION_WORKER_HOST");return{addressList:_s.servers.map(_i=>{let{address:_h,wss:_p}=_i;if(_h&&_p)return"wss://".concat(_h.replace(/\./g,"-"),".").concat(kc,":").concat(_p,"/moderation")}).filter(_i=>!!_i),workerToken:_s.workerToken,vid:_s.vid,ticket:_s.appTicket,responseTime:ue}},(Ei,_s)=>(aE.apworkerEvent(A,{success:!0,sc:200,serviceName:j,responseDetail:JSON.stringify(Ei.addressList),firstSuccess:_s===0,responseTime:ue,serverIp:p[_s%p.length]}),!1),(Ei,_s)=>(aE.apworkerEvent(A,{success:!1,sc:Ei.data&&Ei.data.code||200,serviceName:j,responseTime:ue,serverIp:p[_s%p.length]}),!!(Ei.code!==Vt.OPERATION_ABORTED&&Ei.code!==Vt.UNEXPECTED_RESPONSE||Ei.data&&Ei.data.retry)&&(_n=p[(_s+1)%p.length],!0)),g)}(s,r,i,o);this.emit(KT.STATE_CHANGE,YN.AP_CONNECTED);let{addressList:d,ticket:h}=l;return this._ticket=h,d}async connectWorker(r){this.emit(KT.STATE_CHANGE,YN.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(_E.CONNECTED,async()=>{this.emit(KT.STATE_CHANGE,YN.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=GS.CONNECTED}),this._workerConnection.on(_E.CLOSED,()=>{this.connectionState=GS.CLOSED}),this._workerConnection.on(_E.FAILED,()=>{this.connectionState=GS.CLOSED}),this._workerConnection.on(_E.RECONNECTING,()=>{this.connectionState=this.connectionState===GS.CONNECTED?GS.RECONNECTING:GS.CONNECTING}),this._workerConnection.on(_E.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){let i=$Rt(new Uint8Array(r.data));_r("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&B.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,B.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{aE.reportApiInvoke(this._connectInfo.sid||null,{name:L_.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:p_.TRACER}).onError(new _a(Vt.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},_r("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else B.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(_E.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(_E.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){let r=JS(this,KT.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(_r("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&B.debug("Only the track being played can be inspected"));this._sequence++;let o=await this.generateRequestData(r,i);this._workerConnection.sendMessage(o,!0,!0)}else _r("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&B.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:o,cname:s,cid:l,vid:d,sid:h,uid:p}=i,f=Date.now(),_=await r.getCurrentFrameImage("image/jpeg",this.quality),g=await Nst(_,o,s),b=this._sequence+"-"+l+"-"+p+"-"+f+"-"+ZE(12,""),C={appId:o,cid:l,cname:s,deviceId:"",elapse:e.intToLong(Number(f-this._moderationStartTime)),fileSize:_.buffer.byteLength,height:_.height,width:_.width,jpg:g,networkType:6,osType:7,requestId:b,sdkVersion:"4.22.1",sequence:this._sequence,sid:h,timestamp:awt(f),uid:p,vid:d,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete C.callbackData;let k=ZRt(C);if(k.byteLength<this._workerMessageLengthLimit){if(_r("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let A=function(P){for(var x=1;x<arguments.length;x++){var j=arguments[x]!=null?arguments[x]:{};x%2?Pet(Object(j),!0).forEach(function(z){$(P,z,j[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(j)):Pet(Object(j)).forEach(function(z){Object.defineProperty(P,z,Object.getOwnPropertyDescriptor(j,z))})}return P}({},C);delete A.jpg,B.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return k}{let A=this.quality*this._qualityRatio;return this.quality=A,await this.generateRequestData(r,{appId:o,cname:s,cid:l,vid:d,sid:h,uid:p})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=K0.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=GS.CLOSED,this.emit(KT.STATE_CHANGE,YN.CLOSED)}};function dat(e){if(HE(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new _a(Vt.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new _a(Vt.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}var cwt={name:"ImageModeration",create:function(e){let{config:r}=e;return dat(r),new $8(r)}},Det,Let,Met,Uet,xet,jet,Vet,Fet,Bet,Get,qet,Wet,Het,Ket,zet,Yet,Jet,Xet,Qet,Zet,$et,tnt,ent,nnt,rnt,int,ont,snt,ant,cnt,unt,lnt,dnt,hnt,pnt,fnt,mnt,Ent,_nt,gnt,rE;function vnt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function vT(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?vnt(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):vnt(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}f0.setLogger(B);var uwt=(Det=pE(),Let=pE({argsMap:(e,r)=>{if(!Array.isArray(r)){if(!(r instanceof WI))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),Met=pE({argsMap:(e,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==tP.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),Uet=pE({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),xet=pE({argsMap:(e,r,i)=>[r,i]}),jet=pE({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:s}=i;return[o?.uid,s]})}),Vet=pE({argsMap:(e,r,i,o)=>[typeof r=="object"?r.uid:r,i,o]}),Fet=pE({argsMap:(e,r)=>r.map(i=>{let{user:o,mediaType:s}=i;return{uid:o?.uid,mediaType:s}})}),Bet=pE(),Get=pE(),qet=pE(),Wet=pE(),Het=pE(),Ket=pE(),zet=pE(),Yet=pE(),Jet=pE(),Xet=pE(),Qet=pE(),Zet=pE(),$et=pE(),tnt=pE(),ent=pE({argsMap:(e,r)=>[r]}),nnt=pE(),rnt=pE(),int=pE(),ont=pE(),snt=pE(),ant=pE(),cnt=pE(),unt=pE(),lnt=pE({argsMap:(e,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),dnt=pE(),hnt=pE(),pnt=pE(),fnt=pE(),mnt=pE(),Ent=pE(),_nt=pE({reportResult:!0}),gnt=pE(),rE=class extends s_{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let r;if(super(),$(this,"store",void 0),$(this,"_uid",void 0),$(this,"_channelName",void 0),$(this,"_uintUid",void 0),$(this,"_users",[]),$(this,"_config",void 0),$(this,"_clientId",void 0),$(this,"_appId",void 0),$(this,"_sessionId",null),$(this,"_key",void 0),$(this,"_rtmConfig",{}),$(this,"_joinInfo",void 0),$(this,"_gateway",void 0),$(this,"_statsCollector",void 0),$(this,"_configDistribute",void 0),$(this,"_leaveMutex",new f0("client-leave")),$(this,"_publishMutex",new f0("client-publish")),$(this,"_renewTokenMutex",new f0("client-renewtoken")),$(this,"_subscribeMutex",new f0("client-subscribe")),$(this,"_encryptionMode","none"),$(this,"_encryptionSecret",null),$(this,"_encryptionSalt",null),$(this,"_encryptDataStream",!1),$(this,"_encryptDataStreamKey",null),$(this,"_encryptDataStreamIv",null),$(this,"_proxyServer",void 0),$(this,"_turnServer",{servers:[],mode:"auto"}),$(this,"_cloudProxyServerMode","disabled"),$(this,"_isDualStreamEnabled",!1),$(this,"_defaultStreamFallbackType",void 0),$(this,"_lowStreamParameter",void 0),$(this,"_streamFallbackTypeCacheMap",new Map),$(this,"_remoteStreamTypeCacheMap",new Map),$(this,"_axiosCancelSource",K0.CancelToken.source()),$(this,"_audioVolumeIndicationInterval",void 0),$(this,"_networkQualityInterval",void 0),$(this,"_userOfflineTimeout",void 0),$(this,"_streamRemovedTimeout",void 0),$(this,"_liveTranscodeStreamingClient",void 0),$(this,"_liveRawStreamingClient",void 0),$(this,"_channelMediaRelayClient",void 0),$(this,"_networkQualitySensitivity","normal"),$(this,"_p2pChannel",void 0),$(this,"_useLocalAccessPoint",!1),$(this,"_setLocalAPVersion",void 0),$(this,"_joinAndNotLeaveYet",!1),$(this,"_numberOfJoinCount",0),$(this,"_remoteDefaultVideoStreamType",void 0),$(this,"_inspect",void 0),$(this,"_moderation",void 0),$(this,"_license",void 0),$(this,"_pendingPublishedUsers",[]),$(this,"ntpAlignErrorCount",0),$(this,"remoteInboundOffset",0),$(this,"_handleLocalTrackEnable",(i,o,s)=>{this.publish(i,!1).then(o).catch(s)}),$(this,"_handleLocalTrackDisable",(i,o,s)=>{this.unpublish(i).then(o).catch(s)}),$(this,"_handleUserOnline",i=>{if(_r("BLOCK_LOCAL_CLIENT")&&RO(i.uid,this.channelName))return void B.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&B.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let o=this._users.find(s=>s.uid===i.uid);if(o)o._trust_in_room_=!0,o._is_pre_created&&(o._is_pre_created=!1,this.safeEmit(CE.USER_JOINED,o));else{let s=new gR(i.uid,i.uint_id||i.uid);this._users.push(s),B.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(CE.USER_JOINED,s)}}),$(this,"_handleUserOffline",i=>{if(_r("BLOCK_LOCAL_CLIENT")&&RO(i.uid,this.channelName))return;let o=this._users.find(s=>s.uid===i.uid);o&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),o._audio_pre_subscribed||o._video_pre_subscribed?o._is_pre_created=!0:r3(this._users,o),this._remoteStreamTypeCacheMap.delete(o.uid),this._streamFallbackTypeCacheMap.delete(o.uid),B.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(CE.USER_LEAVED,o,i.reason))}),$(this,"_handleAddAudioOrVideoStream",(i,o,s,l,d,h,p)=>{if(_r("BLOCK_LOCAL_CLIENT")&&RO(o,this.channelName))return;let f=this._users.find(g=>g.uid===o);if(!f)return void B.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));B.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(f.uid,i,void 0,void 0,void 0,Date.now());let _=i==="audio"?f.hasAudio:f.hasVideo;f._uintid||(f._uintid=d||o),i==="audio"?f._trust_audio_stream_added_state_=!0:f._trust_video_stream_added_state_=!0,i==="audio"?(f._audio_added_=!0,s!==void 0&&(f._audioSSRC=s),l!==void 0&&(f._cname=l),h&&(f._audioOrtc=h)):(f._video_added_=!0,s!==void 0&&(f._videoSSRC=s),l!==void 0&&(f._cname=l),p!==void 0&&(f._rtxSsrcId=p),h&&(f._videoOrtc=h)),(i==="audio"?f.hasAudio:f.hasVideo)&&!_&&(B.info("[".concat(this._clientId,"] remote user ").concat(f.uid," published ").concat(i)),this.safeEmit(CE.USER_PUBLISHED,f,i)),i==="video"?aE.onGatewayStream(this._sessionId,Eg.ON_ADD_VIDEO_STREAM,d_.ON_ADD_VIDEO_STREAM,{peer:d||o,ssrc:f._videoSSRC}):aE.onGatewayStream(this._sessionId,Eg.ON_ADD_AUDIO_STREAM,d_.ON_ADD_AUDIO_STREAM,{peer:d||o,ssrc:f._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(f,i,s).then(g=>{if(g&&(B.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(f.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof cU))return this._p2pChannel.unsubscribe(f,i,!0).then(()=>this._subscribe(f,i,!0).catch(b=>{B.error("[".concat(this._clientId,"] resubscribe error"),b.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(f,i)&&(B.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(f.uid," after reconnect.")),this._subscribe(f,i,!0).catch(g=>{B.error("[".concat(this._clientId,"] resubscribe error"),g.toString())}))}),$(this,"_handleRemoveStream",i=>{if(_r("BLOCK_LOCAL_CLIENT")&&RO(i.uid,this.channelName))return;let o=this._users.find(l=>l.uid===i.uid);if(!o)return void B.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));B.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let s=()=>{};o.hasAudio&&o.hasVideo?s=()=>{B.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(CE.USER_UNPUBLISHED,o,"audio"),B.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(CE.USER_UNPUBLISHED,o,"video")}:o.hasVideo?s=()=>{B.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(CE.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(s=()=>{B.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(CE.USER_UNPUBLISHED,o,"audio")}),o._video_pre_subscribed||o._audio_pre_subscribed||(o._trust_audio_stream_added_state_=!0,o._trust_video_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,this._p2pChannel instanceof cU&&this._p2pChannel.unsubscribe(o).then(l=>{if(l)return this._gateway.unsubscribe(l,o.uid)}),o._audioSSRC=void 0,o._videoSSRC=void 0,o._audioOrtc=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),aE.onGatewayStream(this._sessionId,Eg.ON_REMOVE_STREAM,d_.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),s()}),$(this,"_handleSetStreamLocalEnable",(i,o,s)=>{if(_r("BLOCK_LOCAL_CLIENT")&&RO(o,this.channelName))return;let l=this._users.find(p=>p.uid===o);if(!l)return void B.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));B.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(s?"enabled":"disabled"," with uid ").concat(o));let d=i==="audio"?l.hasAudio:l.hasVideo;if(i==="audio"){l._trust_audio_enabled_state_=!0;let p=l._audio_enabled_;if(l._audio_enabled_=s,l._audio_enabled_===p)return;{let f=l._audio_enabled_?"enable-local-audio":"disable-local-audio";B.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(o,", msg: ").concat(f)),this.safeEmit(CE.USER_INFO_UPDATED,o,f)}}else{l._trust_video_enabled_state_=!0;let p=l._video_enabled_;if(l._video_enabled_=s,l._video_enabled_===p)return;{let f=l._video_enabled_?"enable-local-video":"disable-local-video";B.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(f)),this.safeEmit(CE.USER_INFO_UPDATED,o,f)}}let h=i==="audio"?l.hasAudio:l.hasVideo;return d!==h?!d&&h?(B.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(i)),void this.safeEmit(CE.USER_PUBLISHED,l,i)):(i==="video"&&l._videoTrack&&l._videoTrack._destroy(),i==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,i),B.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(i)),void this.safeEmit(CE.USER_UNPUBLISHED,l,i)):void 0}),$(this,"_handleMuteStream",(i,o,s)=>{if(_r("BLOCK_LOCAL_CLIENT")&&RO(i,this.channelName))return;B.debug("[".concat(this._clientId,"] receive mute message"),i,o,s);let l=this._users.find(p=>p.uid===i);if(!l)return void B.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));let d=o==="audio"?l.hasAudio:l.hasVideo;if(o==="audio"){l._trust_audio_mute_state_=!0;let p=l._audio_muted_;if(l._audio_muted_=s,l._audio_muted_===p)return;{let f=l._audio_muted_?"mute-audio":"unmute-audio";B.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(f)),this.safeEmit(CE.USER_INFO_UPDATED,i,f)}}else{l._trust_video_mute_state_=!0;let p=l._video_muted_;if(l._video_muted_=s,l._video_muted_===p)return;{let f=l._video_muted_?"mute-video":"unmute-video";B.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(f)),this.safeEmit(CE.USER_INFO_UPDATED,i,f)}}let h=o==="audio"?l.hasAudio:l.hasVideo;if(d!==h){if(!d&&h)return(o==="audio"?l._audioSSRC:l._videoSSRC)?(B.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(o)),void this.safeEmit(CE.USER_PUBLISHED,l,o)):void B.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(o," unmute message  before add stream message, ").concat(o," SSRC doesn't exist yet."));o==="video"&&l._videoTrack&&!l._video_pre_subscribed&&l._videoTrack._destroy(),o==="audio"&&l._audioTrack,this._p2pChannel.muteRemote(l,o),B.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(o)),this.safeEmit(CE.USER_UNPUBLISHED,l,o)}}),$(this,"_handleP2PLost",async i=>{B.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():B.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),$(this,"_handleTokenWillExpire",()=>{B.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(CE.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),$(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),B.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),$(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(CE.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(CE.NETWORK_QUALITY,i)}),$(this,"_handleP2PAddAudioOrVideoStream",(i,o,s,l)=>{let d=this._users.find(p=>p.uid===o);if(!d)return void B.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));B.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(d.uid,i,void 0,void 0,void 0,Date.now());let h=i==="audio"?d.hasAudio:d.hasVideo;i==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,i==="audio"?(d._audio_added_=!0,s!==void 0&&(d._audioSSRC=s),l!==void 0&&(d._audioMid=l)):(d._video_added_=!0,s!==void 0&&(d._videoSSRC=s),l!==void 0&&(d._videoMid=l)),(i==="audio"?d.hasAudio:d.hasVideo)&&!h&&(B.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(i)),this.safeEmit(CE.USER_PUBLISHED,d,i)),this._p2pChannel.hasPendingRemoteMedia(d,i)&&(B.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,i,!0).catch(p=>{B.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=e,this._clientId=ZE(5,"client-"),this.store=new b8(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),B.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(XS," build: ").concat(eH,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{qQ(e.clientRoleOptions),r=Object.assign({},e.clientRoleOptions)}catch(i){B.warning("[".concat(this._clientId,"] ").concat(i.toString()))}this._statsCollector=new O3(this.store),this._statsCollector.onStatsException=(i,o,s)=>{B.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(o,", uid: ").concat(s)),this.safeEmit(CE.EXCEPTION,{code:i,msg:o,uid:s})},this._statsCollector.onUploadPublishDuration=(i,o,s,l)=>{let d=this._users.find(h=>h.uid===i);d&&aE.peerPublishStatus(this._sessionId,{subscribeElapse:l,audioPublishDuration:o,videoPublishDuration:s,peer:d._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new G8(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||N_,httpRetryConfig:e.httpRetryConfig||N_,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:r}),this._configDistribute=new W8,this.store.useP2P?(this._p2pChannel=new uS(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new cU(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,r,i,o,s){let l=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],d=arguments.length>6&&arguments[6]!==void 0&&arguments[6];WE("JOIN_GATEWAY_USE_443PORT_ONLY",l),WE("JOIN_GATEWAY_USE_DUAL_DOMAIN",d);let h=this._gateway.signal.websocket;return h instanceof SL&&(h.use443PortOnly=l,h.tryDoubleDomain=d),async function(p,f,_){FM.get(p)||FM.set(p,[]),BM.get(p)||BM.set(p,f),aR.get(p)||aR.set(p,0);let g=FM.get(p),b=BM.get(p);if(!g||!b)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(aR.get(p)===b){let x=EL();g.push(x),await x.promise}aR.set(p,aR.get(p)+1);for(var C=arguments.length,k=new Array(C>3?C-3:0),A=3;A<C;A++)k[A-3]=arguments[A];let P=await _(...k);return aR.set(p,aR.get(p)-1),aR.get(p)===b-1&&g.length>0&&(g[0].resolve(),g.shift()),aR.get(p)===0&&(FM.set(p,[]),BM.set(p,0),aR.set(p,0)),P}("client.join",_r("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,r,i,o,s)}async join(e,r,i,o,s){let l=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);let d=(qM||qM||(qM=(window.location.protocol.split(":")[0]||"").toUpperCase(),qM))==="HTTPS",h=XQ()?window.isSecureContext:"Browser Not Support";(!XQ()&&!d||!window.isSecureContext)&&B.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),B.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),aE.setAppId(e);try{if(!i&&i!==null)throw new _a(Vt.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&_g(i,"token",1,2047),_g(e,"appid",1,2047),fV(r),o&&mV(o),s&&_g(s,"optionalInfo",1,2047)}catch(A){throw aE.reportApiInvoke(_1(),{name:L_.JOIN,options:[e,r,i,o],states:{isHttps:d,isSecureContext:h},tag:p_.TRACER}).onError(A),A}if(this._leaveMutex.isLocked&&(B.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),B.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let A=new _a(Vt.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw aE.reportApiInvoke(_1(),{name:L_.JOIN,options:[e,r,i,o],states:{isHttps:d,isSecureContext:h},tag:p_.TRACER}).onError(A),A}this._gateway.state="CONNECTING";let p=await bet({appId:e,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new _a(Vt.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let f=p?.sid||_1();B.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(l)),this._sessionId||(this._sessionId=f,this.store.sessionId=this._sessionId);let _=aE.reportApiInvoke(f,{name:L_.JOIN,options:[e,r,i,o],states:{isHttps:d,isSecureContext:h},tag:p_.TRACER}),g=vT(vT(vT({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:s,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!p},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:_r("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(g.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(g.stringUid=o,this._uintUid?(g.uid=this._uintUid,this._uintUid=void 0):g.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(g.aesmode=this._encryptionMode,g.aespassword=await(async A=>{let P=function(_t){let ue=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),_n=new Uint8Array(new ArrayBuffer(ue.length));for(let Ei=0;Ei<ue.length;Ei+=1)_n[Ei]=ue.charCodeAt(Ei);return _n}(),x=await window.crypto.subtle.importKey("spki",P,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),j=QW(A),z=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},x,j);return function(_t){let ue="";for(let _n=0;_n<_t.length;_n+=1)ue+=String.fromCharCode(_t[_n]);return window.btoa(ue)}(new Uint8Array(z))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new _a(Vt.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(g.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let A=new TextEncoder,P=_r("USE_PURE_ENCRYPTION_MASTER_KEY")?A.encode(g.appId+this._encryptionSecret+this._encryptionSecret):A.encode(g.appId+g.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(x,j,z){let _t=await window.crypto.subtle.importKey("raw",j,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=x==="aes-128-gcm2"?128:256,_n=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:ZQ,hash:"SHA-256",salt:z},_t,ue+eTt);return new Uint8Array(_n).subarray(ue/8)}(this._encryptionMode,P,GO(this._encryptionSalt)),this._encryptDataStreamKey=await async function(x,j,z){let _t=await window.crypto.subtle.importKey("raw",j,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=x==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:ZQ,hash:"SHA-256",salt:z},_t,{name:"AES-GCM",length:ue},!0,["encrypt","decrypt"])}(this._encryptionMode,P,GO(this._encryptionSalt))}else h?B.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):B.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,B.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:e,stringUid:g.stringUid});let b=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&b===this._sessionId&&aE.joinChannelTimeout(this._sessionId,5)},5e3);try{var C;let A,P=g.cloudProxyServer;if(nE(C=["proxy3","proxy4","proxy5"]).call(C,P)){let ue=_r("PROXY_SERVER_TYPE3");Array.isArray(ue)?g.proxyServer=ue[0]:g.proxyServer=ue}if(aE.setProxyServer(g.proxyServer),B.setProxyServer(g.proxyServer),this.store.requestAPStart(),p){if(B.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(g.stringUid?", ".concat(g.stringUid," => ").concat(p.intUid):""," ")),g.stringUid&&!g.uid&&(g.uid=p.intUid),A={gatewayInfo:p.ap.gatewayInfo},_r("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&g.turnServer.mode==="auto")if(p.ap.proxyInfo.addresses.length===0)B.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let ue=(await hst(p.ap.proxyInfo,p.ap.gatewayInfo.uid)).map(_n=>({turnServerURL:_n.address,tcpport:_n.tcpport||i0.tcpport,udpport:_n.udpport||i0.udpport,username:_n.username||i0.username,password:_n.password||i0.password,forceturn:!1,security:!0}));g.turnServer={mode:"manual",servers:ue}}Ret(p,g.stringUid)}else{if(g.stringUid&&!g.uid){let ue;[ue,A]=await eE.all([Hst(g.stringUid,g,this._axiosCancelSource.token,this._config.httpRetryConfig||N_,this.store),Itt(g,this._axiosCancelSource.token,this._config.httpRetryConfig||N_,!0,this.store)]),B.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(g.stringUid," => ").concat(ue)),g.uid=ue,A.gatewayInfo.uid=ue,A.gatewayInfo.res.uid=ue}else A=await Itt(g,this._axiosCancelSource.token,this._config.httpRetryConfig||N_,!0,this.store);if(!this._joinAndNotLeaveYet)throw new _a(Vt.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(g,this._axiosCancelSource.token),this._configDistribute.on(C8.UPDATE_BITRATE_LIMIT,ue=>{this._p2pChannel.updateBitrateLimit(ue)})},0),this._key=i||e;let x=A.gatewayInfo,j=g.uid?g.uid:x.uid;this._joinInfo=vT(vT({},g),{},{cid:x.cid,uid:j,vid:x.vid,apResponse:x.res,apGatewayAddress:x.apGatewayAddress,uni_lbs_ip:x.uni_lbs_ip,gatewayAddrs:x.gatewayAddrs}),this.store.intUid=j;let z=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new _a(Vt.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));_.onSuccess(z),this._appId=e,this._channelName=g.cname,this._uid=z,this.store.uid=z,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(a0()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let _t=g.stringUid?"string uid: ".concat(g.stringUid,",uid: ").concat(g.uid):"uid: ".concat(this._uid);return B.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(_t)),setTimeout(()=>{B.startUpload()},5e3),this.store.joinEnd(),k=this,nE(MO).call(MO,k)||MO.push(k),this._cloudProxyServerMode==="disabled"&&ME().supportWebCrypto&&_r("ENABLE_PRELOAD")&&EH(this._joinInfo),z}catch(A){let P=Array.isArray(A)?A[0]:A;throw P&&P.code===Vt.OPERATION_ABORTED?B.warning("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),P):B.error("[".concat(this._clientId,"] join number: ").concat(l,", Joining channel failed, rollback"),P),P.code!==Vt.OPERATION_ABORTED&&this._numberOfJoinCount===l&&(this._gateway.state="DISCONNECTED",this._reset()),_.onError(P),P}var k}_joinGateway(){if(!this._joinInfo||!this._key)throw new _a(Vt.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!_r("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){B.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(a0()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){let i=MO.indexOf(r);i!==-1&&MO.splice(i,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return B.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),B.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof WI))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new _a(Vt.INVALID_PARAMS,"param list is empty");let i=e;if(this._gateway.role==="audience")throw new _a(Vt.INVALID_OPERATION,"audience can not publish stream");for(let s of i){if(!(s instanceof WI))throw new _a(Vt.INVALID_PARAMS,"parameter is not local track");if(!s._enabled&&r)throw new _a(Vt.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(s.getTrackId()))}B.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(s=>"".concat(s.getTrackId()," "))));let o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(s=>{let l=this._configDistribute.getBitrateLimit();s instanceof e_&&l&&s.setBitrateLimit(l.uplink)});try{await this._publishHighStream(i),B.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(s=>"".concat(s.getTrackId()," "))))}catch(s){throw B.error("[".concat(this._clientId,"] publish error"),s.toString()),s}finally{o()}}async _publishDataChannel(e){HE(e.id,"id",0,65535,!0),tI(e.ordered,"ordered"),_g(e.metadata,"metadata",0,512),B.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(s=>s.id===e.id)!==-1)throw new _a(Vt.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new _a(Vt.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&_r("FORCE_TURN")&&!_r("TURN_ENABLE_TCP")&&!_r("TURN_ENABLE_UDP"))throw new _a(Vt.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let i=function(s){return _et(s,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw B.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new _a(Vt.CREATE_DATACHANNEL_ERROR);try{await eE.all(o.map(s=>this._uid&&this._gateway.publishDataChannel(this._uid,s,!0))),await i._waitTillOpen()}catch(s){if(s.code!==Vt.DISCONNECT_P2P)throw s}}return B.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw B.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new _a(Vt.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(e)if(Array.isArray(e))r=e;else{if(!(e instanceof WI))return this._unpublishDataChannel([e]);r=[e]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);B.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));let i=await this._publishMutex.lock();try{if(this._p2pChannel instanceof uS){let o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(v_.UNPUBLISH,{unpubMsg:o},!0)}else{let o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),B.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(s=>"".concat(s.getTrackId()))))}}catch(o){throw B.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),B.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));let r=await this._publishMutex.lock();try{let i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),B.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw B.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(e,r,i){if(!(e instanceof gR)){let o=this.remoteUsers.find(s=>s.uid===e);if(!o)throw new _a(Vt.INVALID_REMOTE_USER,"user is not in the channel");e=o}return r==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,r)}async presubscribe(e,r){if(j_(r,"mediaType",["audio","video"]),this._p2pChannel instanceof uS)throw new _a(Vt.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let i=r===cE.AUDIO,o=r===cE.VIDEO,s=await this._subscribeMutex.lock();try{let{ssrcId:l,ortc:d,rtxSsrcId:h,cname:p,uint_id:f}=await this._gateway.presubscribe(e,r,!0);if(l==null)throw new _a(Vt.UNEXPECTED_RESPONSE,"no ssrc id");let _=this._users.find(b=>b.uid===e);_||(_=new gR(e,f||e),_._is_pre_created=!0,this._users.push(_)),p&&(_._cname=p),_._uintid||(_._uintid=f||e),i&&(_._audioSSRC=l,_._audio_pre_subscribed=!0,d&&(_._audioOrtc=d)),o&&(_._videoSSRC=l,_._video_pre_subscribed=!0,d&&(_._videoOrtc=d),h!=null&&(_._rtxSsrcId=h)),B.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(l)),await this._p2pChannel.subscribe(_,r,l,h,d);let g=i?_._audioTrack:_._videoTrack;if(!g)throw new _a(Vt.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0),o&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0),g}catch(l){throw B.error("[".concat(this._clientId,"] presub user ").concat(e," error"),l),l}finally{s()}}async _subscribeDataChannel(e,r){var i;if(HE(r,"channelId",0,65535,!0),!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e))throw B.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new _a(Vt.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw B.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new _a(Vt.INVALID_REMOTE_USER,"user is not published");let s=(i=e._dataChannels)===null||i===void 0?void 0:i.find(h=>h.id===r);if(!s)throw B.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new _a(Vt.REMOTE_USER_IS_NOT_PUBLISHED);let l=await this._subscribeMutex.lock();B.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let h=await this._p2pChannel.subscribeDataChannel(e,[s]);if(h&&nE(h).call(h,s.id))try{var d;if(typeof s._originDataChannelId!="number")throw B.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new _a(Vt.CREATE_DATACHANNEL_ERROR);let p={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:(d=s.metadata)!==null&&d!==void 0?d:""};await this._gateway.subscribeDataChannel(e.uid,p,!0),await s._waitTillOpen()}catch(p){if(p?.code!==Vt.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[s]),p;await this._p2pChannel.unsubscribeDataChannel(e,[s]),this._p2pChannel.setPendingRemoteDataChannel(e,s.id)}return B.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),s}finally{l()}}async _p2pSubscribe(e,r,i){if(j_(r,"mediaType",["audio","video"]),!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e)){let l=new _a(Vt.INVALID_REMOTE_USER,"user is not in the channel");throw B.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),l}if(!e.hasAudio&&!e.hasVideo){let l=new _a(Vt.INVALID_REMOTE_USER,"user is not published");throw B.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),l}if(!i&&(r==="audio"&&!e.hasAudio||r==="video"&&!e.hasVideo)){let l=new _a(Vt.REMOTE_USER_IS_NOT_PUBLISHED);throw B.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),l}let s=await this._subscribeMutex.lock();B.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{let d=r==="audio"?e._audioSSRC:e._videoSSRC,h=r==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,r,Date.now()),this._p2pChannel instanceof uS&&await this._p2pChannel.subscribe(e,r,d,h)}catch(d){throw d}B.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(d=>{B.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});let l=r==="audio"?e._audioTrack:e._videoTrack;if(!l)throw new _a(Vt.UNEXPECTED_ERROR,"can not find remote track in user object");return l}catch(l){throw B.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),l),l}finally{s()}}async _subscribe(e,r,i){if(this._p2pChannel instanceof uS)return this._p2pSubscribe(e,r);if(j_(r,"mediaType",["audio","video"]),!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){let f=new _a(Vt.INVALID_REMOTE_USER,"user is not in the channel");throw B.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){let f=new _a(Vt.INVALID_REMOTE_USER,"user is not published");throw B.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!(i||(r!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(r!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let f=new _a(Vt.REMOTE_USER_IS_NOT_PUBLISHED);throw B.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),f}let s=r==="audio"?e._audioSSRC:e._videoSSRC,l=r==="audio"?e._audioOrtc:e._videoOrtc,d=r==="video"?e._rtxSsrcId:void 0,h={stream_type:r==="audio"?cE.AUDIO:cE.VIDEO,ssrcId:s},p=await this._subscribeMutex.lock();B.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{let _=r==="audio"?e._audioSSRC:e._videoSSRC;_!==void 0&&_!==s&&(s=_,l=r==="audio"?e._audioOrtc:e._videoOrtc,d=r==="video"?e._rtxSsrcId:void 0,h={stream_type:r==="audio"?cE.AUDIO:cE.VIDEO,ssrcId:s}),p0.markSubscribeStart(this.store.clientId,s),this.store.subscribe(e.uid,r,Date.now()),await this._p2pChannel.subscribe(e,r,s,d,l);try{this._p2pChannel.isPreSubScribe(s)||await this._gateway.subscribe(e.uid,h,!0)}catch(g){if(g?.code!==Vt.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,r),g;await this._p2pChannel.unsubscribe(e,r,!0),this._p2pChannel.setPendingRemoteMedia(e,r)}this.store.subscribe(e.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,r)}catch(_){throw this._p2pChannel.reportSubscribeEvent(!1,_?.code,e,r),_}B.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(_=>{B.warning("[".concat(this._clientId,"] auto set fallback failed"),_)});let f=r==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new _a(Vt.UNEXPECTED_ERROR,"can not find remote track in user object");return f}catch(f){throw B.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{p()}}async massSubscribe(e){if(ZR(e,"subscribeList"),!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let r=Date.now(),i=new Map,o=await this._subscribeMutex.lock();B.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(h=>{let{user:p,mediaType:f}=h;return"user: ".concat(p?.uid,", mediaType: ").concat(f)}).join("; ")));let s=(e=[...e]).map(h=>{let{user:p,mediaType:f}=h;return{user:p,mediaType:f}}),l=await this._p2pChannel.globalLock();try{var d;for(let p=e.length-1;p>=0;p--){let f=e[p],{user:_,mediaType:g}=f;if(j_(g,"mediaType",["audio","video"]),!_){let A=new _a(Vt.INVALID_PARAMS,"user property does not exist in subscribeList item");throw B.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),A}if(!this._users.find(A=>A===_)){let A=new _a(Vt.INVALID_REMOTE_USER,"user is not in the channel");B.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),s[p].error=A,e.splice(p,1);continue}if(g==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||g==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){let A=new _a(Vt.REMOTE_USER_IS_NOT_PUBLISHED);B.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(g,", remote user is not published")),s[p].error=A,e.splice(p,1);continue}let C=q_.Video|q_.LwoVideo,k=i.get(_);if(k){if(g==="video"?k&C:k&q_.Audio){e.splice(p,1),B.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(g," twice"));continue}i.set(_,k|(g==="video"?C:q_.Audio))}else i.set(_,g==="video"?C:q_.Audio)}for(let p=e.length-1;p>=0;p--){let f=e[p],{user:_,mediaType:g}=f,b=q_.Video|q_.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,g)){await this._p2pChannel.unmuteRemoteNoLock(_,g);let C=i.get(_);i.set(_,g==="video"?C^b:C^q_.Audio),e.splice(p,1)}}this.store.massSubscribe(e.map(p=>({userId:p.user.uid,type:p.mediaType})),r);let h=QT(d=Array.from(i.entries())).call(d,(p,f)=>{let[_,g]=f;if(g===0)return p;let b={stream_id:_.uid,stream_type:g};return g&q_.Audio&&(b.audio_ssrc=_._audioSSRC),g&q_.Video&&(b.video_ssrc=_._videoSSRC),p.push(b),p},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(f=>{let{user:_,mediaType:g}=f;return{user:_,mediaType:g,ssrcId:g===cE.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:g===cE.VIDEO?_._rtxSsrcId:void 0}}));let p=new Map;if(h=h.filter(f=>f.video_ssrc&&!this._p2pChannel.isPreSubScribe(f.video_ssrc)||f.audio_ssrc&&!this._p2pChannel.isPreSubScribe(f.audio_ssrc)||!f.video_ssrc&&!f.audio_ssrc),h.length>0){let f=await this._gateway.subscribeAll(h,!0);(f?.users||[]).forEach(_=>{let{stream_id:g,video_error_code:b,audio_error_code:C,error_code:k}=_;(b||C||k)&&p.set(g,{video_error_code:b,audio_error_code:C,error_code:k})})}if(Array.from(p.entries()).length>0){let f=[];Array.from(p.entries()).forEach(_=>{let[g,b]=_,C=this.remoteUsers.find(k=>k.uid===g);if(C){let k;b.error_code||b.video_error_code&&b.audio_error_code?k=void 0:b.video_error_code?k=cE.VIDEO:b.audio_error_code&&(k=cE.AUDIO),f.push({user:C,mediaType:k})}}),f.length>0&&await this._p2pChannel.massUnsubscribeNoLock(f)}for(let f of s){let _=p.get(f.user.uid);if(_){let g=_.error_code||f.mediaType==="audio"&&_.audio_error_code||f.mediaType==="video"&&_.video_error_code;if(g){let b=yL(g);B.error("user:".concat(f.user.uid," mediaType:").concat(f.mediaType," has massSubscribe error ").concat(b.desc)),f.error=new _a(Vt.SUBSCRIBE_FAILED,"code ".concat(g,": ").concat(b.desc))}}f.error||(f.mediaType==="video"?f.track=f.user.videoTrack:f.track=f.user.audioTrack)}return this.store.massSubscribe(s.filter(f=>!f.error).map(f=>({userId:f.user.uid,type:f.mediaType})),void 0,Date.now()),s.forEach(f=>{var _;aE.subscribe(this.store.sessionId,{succ:!!f.error,ec:((_=f.error)===null||_===void 0?void 0:_.code)||null,video:f.mediaType===cE.VIDEO,audio:f.mediaType===cE.AUDIO,peerid:f.user.uid,subscribeRequestid:f.mediaType===cE.VIDEO?f.user._videoSSRC:f.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(f.user._videoSSRC)},!0)}),B.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(f=>{let{user:_,mediaType:g}=f;return"user: ".concat(_?.uid,", mediaType: ").concat(g)}).join("; "))),s}catch(p){throw await this._p2pChannel.massUnsubscribeNoLock(e),p}}finally{l(),o()}}async unsubscribe(e,r,i){if(!(e instanceof gR)){let l=this.remoteUsers.find(d=>d.uid===e);if(!l)throw new _a(Vt.INVALID_REMOTE_USER,"user is not in the channel");e=l}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(r&&j_(r,"mediaType",["audio","video"]),!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(l=>l===e)){let l=new _a(Vt.INVALID_REMOTE_USER,"user is not in the channel");throw B.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),l}B.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(r));let s=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof uS)await this._p2pChannel.unsubscribe(e,r);else{let l=await this._p2pChannel.unsubscribe(e,r);l&&await this._gateway.unsubscribe(l,e.uid),r&&r!=="audio"||(e._audio_pre_subscribed=!1),r&&r!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&r3(this._users,e),B.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(r))}}catch(l){if(l.code===Vt.DISCONNECT_P2P)return void B.warning("disconnecting p2p, abort unsubscribe request.");throw B.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),l.toString()),l}finally{s()}}async _unsubscribeDataChannel(e,r){if(r&&HE(r,"id",0,65535,!0),!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(s=>s===e)){let s=new _a(Vt.INVALID_REMOTE_USER,"user is not in the channel");throw B.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}let o;if(typeof r=="number"){let s=e._dataChannels.find(l=>l.id===r);s&&(o=[s])}else o=e._dataChannels;if(o===void 0){let s=new _a(Vt.REMOTE_USER_IS_NOT_PUBLISHED);throw B.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(r,", remote datachannel is not published")),s}B.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(s=>s.id)));try{let s=await this._p2pChannel.unsubscribeDataChannel(e,o);s&&await this._gateway.unsubscribeDataChannel(s,e.uid),B.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s))}catch(s){if(s.code===Vt.DISCONNECT_P2P)return void B.warning("disconnecting p2p, abort unsubscribe request.");throw B.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}}async massUnsubscribe(e){if(ZR(e,"unsubscribeList"),!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");B.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:s}=i;return"user: ".concat(o?.uid,", mediaType: ").concat(s,";")}).join())),e=[...e];let r=new Map;for(let i=e.length-1;i>=0;i--){let{user:o,mediaType:s}=e[i];if(!o){let h=new _a(Vt.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw B.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),h}if(j_(s,"mediaType",["video","audio",void 0]),!this._users.find(h=>h===o)){B.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}let d=q_.Video|q_.LwoVideo;if(r.has(o)){let h=r.get(o),p;switch(s){case"video":p=h&d;break;case"audio":p=h&q_.Audio;break;default:p=h&(q_.Audio|d)}if(p){B.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(s," twice.")),e.splice(i,1);continue}s?s==="audio"?r.set(o,h|q_.Audio):s==="video"&&r.set(o,h|d):r.set(o,h|q_.Audio|d)}else s?s==="audio"?r.set(o,q_.Audio):s==="video"&&r.set(o,d):r.set(o,q_.Audio|d)}try{let i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),B.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:s,mediaType:l}=o;return"user: ".concat(s?.uid,", mediaType: ").concat(l,";")}).join()))}catch(i){if(i.code===Vt.DISCONNECT_P2P)return void B.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw B.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new _u(Vt.INVALID_PARAMS);l_(i.width)||h6(i.width,"streamParameter.width"),l_(i.height)||h6(i.height,"streamParameter.height"),l_(i.framerate)||h6(i.framerate,"streamParameter.framerate"),l_(i.bitrate)||HE(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&B.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),B.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&e.bitrate&&r.bitrate<e.bitrate&&(e.bitrate=r.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,_m.LocalVideoLowTrack)}async enableDualStream(){if(!ME().supportDualStream)throw aE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new _a(Vt.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new _a(Vt.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw aE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,aE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),B.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(_m.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw aE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,aE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),B.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,r){if(function(i){j_(i,"role",["audience","host"])}(e),r&&qQ(r),this.mode==="rtc"||this.mode==="p2p")throw B.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new _a(Vt.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&e==="host")throw new _a(Vt.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new _a(Vt.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,r),this._config.role=e,B.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(r&&r.level))}getRemoteInboundOffset(){var e;let r=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!r||!r.timestamp)return 0;let i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,r){if(_g(e,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new _a(Vt.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new _a(Vt.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,aE.setProxyServer(this._proxyServer),B.setProxyServer(this._proxyServer),B.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(e,r){if(Array.isArray(e)||(e=[e]),!r){if(this.connectionState!=="DISCONNECTED")throw new _a(Vt.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new _a(Vt.INVALID_OPERATION,"You have already set the proxy")}if(lV(e))return this._turnServer={servers:e,mode:"original-manual"},void B.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>rst(i)),this._turnServer={servers:e,mode:"manual"},B.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new _a(Vt.INVALID_OPERATION,"you should set license before join channel");if(_g(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new _a(Vt.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,B.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new _a(Vt.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new _a(Vt.INVALID_OPERATION,"You have already set the proxy");let r=[3,4,5],i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new _a(Vt.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new _a(Vt.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,B.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new _a(Vt.INVALID_OPERATION,"Stop proxy server after leave channel");aE.setProxyServer(),B.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",B.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new _a(Vt.INVALID_PARAMS,"accessPoints is required.");ZR(e.accessPoints.serverList,"accessPoints.serverList"),_g(e.accessPoints.domain,"accessPoints.domain");let r=(b,C)=>{HE(b,C,0,65535,!0)},i=443;if(e.accessPoints.port&&(r(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new _a(Vt.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");_r("CLOSE_AFB_FOR_LOCAL_AP")&&(WE("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),WE("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,s=e.accessPoints.domain,l=e.accessPoints.serverList.map(b=>o.test(b)?"".concat(b.replace(/\./g,"-"),".").concat(s):b),d=l.map(b=>"".concat(b,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,WE("WEBCS_DOMAIN",d),WE("WEBCS_DOMAIN_BACKUP_LIST",d),WE("GATEWAY_DOMAINS",[s]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(ZR(e.report.hostname,"report.hostname"),WE("EVENT_REPORT_DOMAIN",e.report.hostname[0]),WE("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(WE("EVENT_REPORT_DOMAIN",l[0]),WE("EVENT_REPORT_BACKUP_DOMAIN",l[1]||l[0]));let h=6443;e.report&&e.report.port&&(r(e.report.port,"report.port"),h=e.report.port),WE("STATS_COLLECTOR_PORT",h),e.report?WE("ENABLE_EVENT_REPORT",!0):WE("ENABLE_EVENT_REPORT",!1);let p="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(ZR(e.log.hostname,"log.hostname"),p=e.log.hostname[0]):p=l[0];let f=6444;e.log&&e.log.port&&(r(e.log.port,"log.port"),f=e.log.port),WE("LOG_UPLOAD_SERVER","".concat(p,":").concat(f));let _=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(ZR(e.cds.hostname,"cds.hostname"),_=e.cds.hostname):_=l;let g=443;e.cds&&e.cds.port&&(r(e.cds.port,"cds.port"),g=e.cds.port),WE("CDS_AP",_.map(b=>"".concat(b,":").concat(g))),e.cds?WE("ENABLE_CONFIG_DISTRIBUTE",!0):WE("ENABLE_CONFIG_DISTRIBUTE",!1),B.info("set local access point v2 success")}setLocalAccessPoints(e,r){if(ZR(e,"serverList"),_g(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new _a(Vt.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,WE("WEBCS_DOMAIN",e),WE("WEBCS_DOMAIN_BACKUP_LIST",e),WE("GATEWAY_DOMAINS",[r]),WE("EVENT_REPORT_DOMAIN",e[0]),WE("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),WE("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),B.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(j_(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw B.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else B.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,r){j_(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,r),setTimeout(()=>{let i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw B.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}B.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(e,r)}async setStreamFallbackOption(e,r){j_(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,r)}catch(i){throw B.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}B.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(e,r)}setEncryptionConfig(e,r,i,o){(function(l){j_(l,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),_g(r,"secret");let s=["aes-128-gcm2","aes-256-gcm2"];if(nE(s).call(s,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new _a(Vt.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new _a(Vt.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(tI(o,"encryptDataStream"),!nE(s).call(s,e))throw new _a(Vt.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||B.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=r,i&&(this._encryptionSalt=YI(i))}async renewToken(e){if(_g(e,"token",1,2047),!this._key||!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"renewToken should not be called before user join");let r=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let i=await this._renewTokenMutex.lock();try{if(_r("USE_NEW_TOKEN")){B.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let o=await kRt(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||N_);B.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else B.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});B.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,B.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?B.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(CE.VOLUME_INDICATOR,e)},_r("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return e.Duration=Math.round(r.duration/1e3),e}async startLiveStreaming(e,r){if(!r){if(this.codec!=="h264")throw new _a(Vt.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new _a(Vt.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new _a(Vt.LIVE_STREAMING_TASK_CONFLICT);let i=r?ER.TRANSCODE:ER.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(ER.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!r.length)throw new _a(Vt.INVALID_PARAMS,"can not find live streaming url to stop");await eE.all(r.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){iet(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){iet(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let s=new TextEncoder;e.payload=s.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&nE(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,e.payload=await async function(s,l,d){var h;let p=QT(h=Array.from(d)).call(h,(A,P)=>A+P,0),f={serverTs:0,seq:nTt++,length:d.length,checkSum:p},_=new Uint8Array(JQ(p,2)),g=new ArrayBuffer(zN),b=new DataView(g);b.setUint32(0,f.serverTs),b.setUint16(4,f.seq),b.setUint16(6,f.length),b.setUint16(8,f.checkSum);let C=16-d.length%16;d=HQ(d,new Uint8Array(C));let k=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s,tagLength:QQ,additionalData:_},l,d);return HQ(new Uint8Array(g),new Uint8Array(k))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new _a(Vt.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(mE.DATA_STREAM,{payload:YI(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-HRt},!i)}sendMetadata(e){if(!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new _a(Vt.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(mE.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:YI(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(rTt),!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"can not send custom report, not joined");await aE.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,r){j_(r.spatialLayer,"spatialLayer",[0,1,2,3]),j_(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,r)}catch(i){throw B.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){let{apRTM:r=!1,rtmFlag:i}=e;if(tI(r,"apRTM"),HE(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,B.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(B.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=K0.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&oat(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&aE.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(r=>r._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new f0("client-publish"),this._subscribeMutex=new f0("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,r){var i;let o=e||_1();e?B.debug("[".concat(this._clientId,"] new Session ").concat(o)):B.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));let s=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,aE.addSid(o);let l={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:r?.stringUid||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:s,clientRole:this.role==="audience"?2:1};aE.sessionInit(this._sessionId,vT({cname:r.channel,appid:r.appId},l)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new _a(Vt.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&_r("FORCE_TURN")&&!_r("TURN_ENABLE_TCP")&&!_r("TURN_ENABLE_UDP"))throw new _a(Vt.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");B.debug("[".concat(this._clientId,"] publish high stream"));try{let i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof uS){let o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(v_.PUBLISH,o,!0)}catch(s){throw i.throw(s),s}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let o=(await i.next()).value;if(o){var r;let s;try{s=await this._gateway.publish(this._uid,o,!0)}catch(l){if(l.code!==Vt.DISCONNECT_P2P)throw i.throw(l),l}await i.next(((r=s)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let s of e)s instanceof e_&&s._encoderConfig&&this._gateway.setVideoProfile(s._encoderConfig),!s.muted&&s.enabled||await this._p2pChannel.muteLocalTrack(s)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i?.code,e),i?.code===Vt.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new _a(Vt.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new _a(Vt.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));B.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var r;let s;try{s=await this._gateway.publish(this._uid,o,!0)}catch(l){if(l.code!==Vt.DISCONNECT_P2P)throw i.throw(l),l}i.next(((r=s)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i?.code,void 0,!0),i?.code===Vt.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){let r=()=>{if(!this._joinInfo||!this._appId)return new _a(Vt.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},WD("LiveStreaming").create(o));var o;return i.onLiveStreamError=(s,l)=>{aE.reportApiInvoke(this._sessionId,{name:L_.ON_LIVE_STREAM_ERROR,options:[s,l],tag:p_.TRACER}).onSuccess(),this.safeEmit(CE.LIVE_STREAMING_ERROR,s,l)},i.onLiveStreamWarning=(s,l)=>{aE.reportApiInvoke(this._sessionId,{name:L_.ON_LIVE_STREAM_WARNING,options:[s,l],tag:p_.TRACER}).onSuccess(),this.safeEmit(CE.LIVE_STREAMING_WARNING,s,l)},i.on(I8.REQUEST_WORKER_MANAGER_LIST,(s,l,d)=>{if(!this._joinInfo)return d(new _a(Vt.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(h,p,f,_){let g=_r("UAP_AP").slice(0,_r("AJAX_REQUEST_CONCURRENT")).map(b=>p.proxyServer?"https://".concat(p.proxyServer,"/ap/?url=").concat(b+"/api/v1?action=uap"):"https://".concat(b,"/api/v1?action=uap"));return await wRt(g,h,p,f,_)})(s,this._joinInfo,this._axiosCancelSource.token,N_).then(l).catch(d)}),i};return e===ER.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new _a(Vt.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},WD("ChannelMediaRelay").create(e));o.on("state",s=>{s===tS.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(CE.CHANNEL_MEDIA_RELAY_STATE,s)}),o.on("event",s=>{this.safeEmit(CE.CHANNEL_MEDIA_RELAY_EVENT,s)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(s,l)=>{var d;s==="resolution"&&((d=this._channelMediaRelayClient)===null||d===void 0||d.setVideoProfile(l))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,r){let{added:i,deleted:o}=e,s=[];if(r){let l=[];this._users.forEach(d=>{d._dataChannels.forEach(h=>{i.every(p=>p.uid!==d._uintid||p.stream_id!==h.id)&&l.push({uid:d._uintid,stream_id:h.id,ordered:h.ordered,max_retrans_times:h.maxRetransmits,metadata:h.metadata})})}),l.length>0&&this._handleUpdateDataChannel({added:[],deleted:l})}Array.isArray(i)&&i.length>0&&i.forEach(l=>{let{uid:d,stream_id:h,ordered:p,max_retrans_times:f,metadata:_}=l,g=this._users.find(b=>b._uintid===d);if(!g)return void B.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(B.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(d)),nE(s).call(s,g)||s.push(g),g._uintid||(g._uintid=d),g._dataChannels.findIndex(b=>b.id===l.stream_id)===-1){let b={id:h,ordered:!!p,maxRetransmits:f,metadata:_},C=function(k){return _et(k,!0)}(b);g._dataChannels.push(C),B.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published datachannel")),r||this.safeEmit(CE.USER_PUBLISHED,g,"datachannel",b)}this._p2pChannel.hasPendingRemoteDataChannel(g,l.stream_id)&&(B.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(g.uid," after reconnect.")),this._subscribeDataChannel(g,l.stream_id).catch(b=>{B.error("[".concat(this._clientId,"] resubscribe datachannel error"),b.toString())}))}),r&&(this.safeEmit(CE.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(l=>{let{uid:d,stream_id:h}=l,p=this._users.find(_=>_._uintid===d);if(!p)return void B.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let f=p._dataChannels.find(_=>_.id===l.stream_id);f&&(B.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(d)),this._p2pChannel.unsubscribeDataChannel(p,[f]).then(_=>{if(p._dataChannels=p._dataChannels.filter(g=>g!==f),_)return this._gateway.unsubscribeDataChannel(_,p.uid)}),B.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished datachannel ,id:").concat(f.id)),this.safeEmit(CE.USER_UNPUBLISHED,p,"datachannel",f._config))})}_handleRemoveDataChannels(e){let r=this._users.find(i=>i.uid===e.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){B.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let i=()=>{B.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(CE.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),i()}}else B.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(r0.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(r0.CONNECTION_STATE_CHANGE,(e,r,i)=>{var o;if(i===GE.FALLBACK)return;let s=()=>{this.safeEmit(CE.CONNECTION_STATE_CHANGE,e,r,i)};if(aE.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:L_.CONNECTION_STATE_CHANGE,options:[e,r,i],tag:p_.TRACER}).onSuccess(JSON.stringify({cur:e,prev:r,reason:i})),B.info("[".concat(this._clientId,"] connection state change: ").concat(r," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void s();if(e==="RECONNECTING")this._users.forEach(d=>{d._trust_in_room_=!1,d._trust_audio_enabled_state_=!1,d._trust_video_enabled_state_=!1,d._trust_audio_mute_state_=!1,d._trust_video_mute_state_=!1,d._trust_audio_stream_added_state_=!1,d._trust_video_stream_added_state_=!1,d._is_pre_created||(d._audio_pre_subscribed||(d._audioSSRC=void 0,d._audioOrtc=void 0),d._video_pre_subscribed||(d._videoSSRC=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),d._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var l;this._streamFallbackTypeCacheMap.forEach((d,h)=>{this._gateway.setStreamFallbackOption(h,d).catch(p=>{B.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),p)})}),this._remoteStreamTypeCacheMap.forEach((d,h)=>{this._gateway.setRemoteVideoStreamType(h,d).catch(p=>{B.warning("[".concat(this._clientId,"] auto set remote stream type failed"),p)})}),this._remoteDefaultVideoStreamType!==void 0&&((l=this._joinInfo)===null||l===void 0?void 0:l.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{B.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(d=>{B.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(d))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(d=>!d._trust_in_room_).forEach(d=>{B.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(d.uid)),this._handleUserOffline({uid:d.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(d=>{d._trust_audio_mute_state_||(B.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,cE.AUDIO,!1)),d._trust_video_mute_state_||(B.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,cE.VIDEO,!1)),d._trust_audio_enabled_state_||(B.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(d.uid)),this._handleSetStreamLocalEnable("audio",d.uid,!0)),d._trust_video_enabled_state_||(B.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(d.uid)),this._handleSetStreamLocalEnable("video",d.uid,!0)),d._trust_video_stream_added_state_||(B.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(d.uid)),this._handleResetAddStream(d,"video")),d._trust_audio_stream_added_state_||(B.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(d.uid)),this._handleResetAddStream(d,"audio")),d._video_added_||d._audio_added_||(B.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(d.uid)),this._handleRemoveStream({uid:d.uid,uint_id:d._uintid}))}))},1e3))}s()}),this._gateway.on(r0.REQUEST_NEW_GATEWAY_LIST,async(e,r)=>{if(!this._joinInfo)return r(new _a(Vt.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i,o=await bet(vT(vT({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,Ret(o),this._joinInfo.preload=!0):(i=await q8(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||N_,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);let s=[];i.gatewayInfo.gatewayAddrs.forEach(l=>{let{address:d}=l,[h,p]=d.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:h,port:p}):s.push({host:h,port:p})}),e(s)}catch(i){r(i)}}),this._gateway.on(r0.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(CE.NETWORK_QUALITY,e)}),this._gateway.on(r0.STREAM_TYPE_CHANGE,(e,r)=>{this.safeEmit(CE.STREAM_TYPE_CHANGED,e,r),aE.reportApiInvoke(this._sessionId,{name:L_.STREAM_TYPE_CHANGE,options:[e,r],tag:p_.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:r}))}),this._gateway.on(r0.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(r0.REQUEST_P2P_CONNECTION_PARAMS,async(e,r,i)=>{try{let o=await this._p2pChannel.getEstablishParams();_r("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),r(o)}catch(o){i(o)}}),this._gateway.on(r0.JOIN_RESPONSE,(e,r)=>{if(this.store.useP2P)return;let i=vtt(e.ortc,r,e.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(i)}),this._gateway.on(r0.PRE_CONNECT_PC,async e=>{let{candidates:r,fingerprint:i}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});let{cert:s,cid:l}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(l,"_").concat(s),icePwd:"".concat(l,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=_r("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(wE.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(wE.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(wE.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(wE.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(wE.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(wE.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(wE.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(wE.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(wE.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,cE.AUDIO,!0)),this._gateway.signal.on(wE.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,cE.AUDIO,!1)),this._gateway.signal.on(wE.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,cE.VIDEO,!0)),this._gateway.signal.on(wE.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,cE.VIDEO,!1)),this._gateway.signal.on(wE.RECEIVE_METADATA,e=>{let r=GO(e.metadata);this.safeEmit(CE.RECEIVE_METADATA,e.uid,r)}),this._gateway.signal.on(wE.ON_DATA_STREAM,async e=>{var r;if(!e)return;let i=GO(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&nE(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(e.payload.length<zN)throw new _a(Vt.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(zN));i=await async function(l,d,h){let p=h.subarray(0,zN),f=p.slice(8,zN),_=(f[0]<<8)+f[1],g=(p[6]<<8)+p[7],b=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:l,tagLength:QQ,additionalData:new Uint8Array(JQ(_,2))},d,h.subarray(zN));return new Uint8Array(b).subarray(0,g)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){let s=this._p2pChannel.getStats(),l=this.remoteUsers.find(h=>h.uid===e.uid),d=s?.audioRecv.find(h=>h.ssrc===l?._audioSSRC);o=d?.jitterBufferMs}o==null&&(o=0),zRt(vT(vT({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(wE.ON_CRYPT_ERROR,()=>{_C(()=>{B.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(CE.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(wE.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(wE.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{B.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,GE.TOKEN_EXPIRE),this.safeEmit(CE.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(wE.ON_STREAM_FALLBACK_UPDATE,e=>{B.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(CE.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(wE.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),B.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(wE.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(wE.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(EE.REQUEST_TIMEOUT,(e,r)=>{if(this._joinInfo)switch(e){case mE.PUBLISH:{if(!r)return;let s=r.ortc;if(s){var i,o;let l=s.some(p=>{let{stream_type:f}=p;return f===VE.Audio}),d=s.some(p=>{let{stream_type:f}=p;return f!==VE.Audio}),h=s.some(p=>{let{stream_type:f}=p;return f===VE.Screen||f===VE.ScreenLow});r.state==="offer"&&aE.publish(this._joinInfo.sid,{eventElapse:p0.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Vt.TIMEOUT,audio:l,video:d,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:h,audioName:l?(i=s.find(p=>{let{stream_type:f}=p;return f===VE.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:d?(o=s.find(p=>{let{stream_type:f}=p;return f!==VE.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case mE.SUBSCRIBE:r&&aE.subscribe(this._joinInfo.sid,{succ:!1,ec:Vt.TIMEOUT,audio:r.stream_type===cE.AUDIO,video:r.stream_type===cE.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:p0.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(wE.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(wE.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;_r("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!RO(o.string_id||o.stream_id,this.channelName)));let r=[],i=[];for(let o of e.users){let s=this._users.find(_=>_._uintid===o.stream_id);s?s._trust_in_room_=!0:(s=new gR(o.string_id||o.stream_id,o.stream_id),this._users.push(s),this.getListeners(CE.PUBLISHED_USER_LIST).length===0&&(B.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(CE.USER_JOINED,s)));let l=q_.Audio&o.stream_type,d=(q_.Video|q_.LwoVideo)&o.stream_type,h=(65280&o.stream_type)!=0,p=l&&s.hasAudio,f=d&&s.hasVideo;d&&(s._trust_video_stream_added_state_=!0,s._video_added_=!0,s._videoSSRC=o.video_ssrc,s._rtxSsrcId=o.video_rtx),l&&(s._trust_audio_stream_added_state_=!0,s._audio_added_=!0,s._audioSSRC=o.audio_ssrc),l&&!p&&this.getListeners(CE.PUBLISHED_USER_LIST).length===0&&(B.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published audio")),this.safeEmit(CE.USER_PUBLISHED,s,"audio")),d&&!f&&this.getListeners(CE.PUBLISHED_USER_LIST).length===0&&(B.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published video")),this.safeEmit(CE.USER_PUBLISHED,s,"video")),(l&&!p||d&&!f||h)&&r.push(s),d&&this._p2pChannel.hasPendingRemoteMedia(s,"video")&&i.push({user:s,mediaType:"video"}),l&&this._p2pChannel.hasPendingRemoteMedia(s,"audio")&&i.push({user:s,mediaType:"audio"})}i.length>0&&(B.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{B.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(CE.PUBLISHED_USER_LIST).length>0?_r("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(B.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(CE.PUBLISHED_USER_LIST,r)):B.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(wE.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:r}=e;this._p2pChannel instanceof cU&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var o;return nE(o=Object.keys(pV)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(wE.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(v_.PUBLISH,(e,r,i)=>{let{uid:o}=e;e.forEach(s=>{let{kind:l,ssrcs:d,mid:h,isMuted:p}=s;this._handleP2PAddAudioOrVideoStream(l,o,d[0].ssrcId,h);let f=this._users.find(_=>_.uid===o);return f&&this._p2pChannel instanceof uS?this._p2pChannel.mockSubscribe(f,l,d[0].ssrcId,h).then(()=>{r()}).catch(i):r(),this._handleMuteStream(o,l,!!p)})}),this._gateway.signal.on(v_.CALL,async(e,r,i)=>{if(this._p2pChannel instanceof uS)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(s){i(s)}}),this._gateway.signal.on(EE.P2P_CONNECTION,async e=>{this._p2pChannel instanceof uS&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(v_.UNPUBLISH,async(e,r,i)=>{if(this._p2pChannel instanceof uS){let{unpubMsg:o,uid:s}=e,l=this._users.find(d=>d.uid===s);if(!l)return B.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s)),void r();try{o.forEach(async d=>{let{stream_type:h}=d,p=h===VE.Audio?cE.AUDIO:cE.VIDEO;await this._p2pChannel.unsubscribe(l,p),this._handleMuteStream(s,p,!0)}),r()}catch(d){i(d)}}}),this._gateway.signal.on(v_.CONTROL,async(e,r)=>{let{action:i}=e;switch(i){case GI.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,cE.VIDEO,!0);break;case GI.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,cE.AUDIO,!0);break;case GI.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,cE.VIDEO,!1);break;case GI.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,cE.AUDIO,!1)}}),this._gateway.signal.on(v_.RESTART_ICE,async(e,r,i)=>{if(this._p2pChannel instanceof uS)try{let{direction:o,iceParameter:s}=e;o!==L0.SEND_ONLY||s?r(await this._p2pChannel.restartICE(o,s)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){i(o)}}),this._gateway.signal.on(v_.CANDIDATE,e=>{if(this._p2pChannel instanceof uS){let{candidate:r,direction:i}=e;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(fE.RequestP2PRestartICE,async(e,r,i)=>{try{let{direction:o}=e;r(await this._gateway.sendExtensionMessage(v_.RESTART_ICE,e,o===L0.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(fE.LocalCandidate,e=>{this._gateway.sendExtensionMessage(v_.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(fE.RequestP2PMuteLocal,async(e,r,i)=>{try{await this._gateway.sendExtensionMessage(v_.CONTROL,e,!0),r()}catch(o){i(o)}}),this._p2pChannel.on(fE.RequestP2PUnmuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===Vt.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(fE.RequestP2PMuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===Vt.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(fE.StateChange,(e,r)=>{r===jE.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(fE.RequestMuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===Vt.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(fE.RequestUnmuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===Vt.DISCONNECT_P2P?r():i(o)}else r()}),this._p2pChannel.on(fE.RequestRePublish,(e,r,i)=>{this.publish(e,!1).then(r).catch(i)}),this._p2pChannel.on(fE.RequestRePublishDataChannel,(e,r,i)=>{eE.all(e.map(async o=>{let s=await this._p2pChannel.publishDataChannel([o]);try{s.forEach(l=>{this._uid&&this._gateway.publishDataChannel(this._uid,l,!0)})}catch(l){if(l.code!==Vt.DISCONNECT_P2P)throw l}})).then(r).catch(i)}),this._p2pChannel.on(fE.RequestReSubscribe,async(e,r,i)=>{try{for(let{user:o,kind:s}of e)s===cE.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){i(o)}}),this._p2pChannel.on(fE.RequestUpload,(e,r)=>{this._gateway.upload(e,r)}),this._p2pChannel.on(fE.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(fE.MediaReconnectStart,e=>{this.safeEmit(CE.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(fE.MediaReconnectEnd,e=>{this.safeEmit(CE.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(fE.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(fE.RequestRestartICE,async e=>{if(this._p2pChannel instanceof uS)return;let r=await this._p2pChannel.restartICE(e),i=await r.next();if(i.done)return;let o=i.value,s;try{s=await this._gateway.restartICE({iceParameters:o})}catch(d){return void r.throw(d)}let{iceParameters:l}=function(d){let h=d.iceParameters;return{iceParameters:{iceUfrag:h.iceUfrag,icePwd:h.icePwd}}}(s);await r.next({remoteIceParameters:l})}),this._p2pChannel.on(fE.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(fE.RequestReconnectPC,async()=>{var e;let{iceParameters:r,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:s,gatewayAddress:l}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:o}),d=vtt(s,l);await this._p2pChannel.connect(d),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(fE.RequestUnpublishForReconnectPC,async(e,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),r()):i()}),this._p2pChannel.on(fE.P2PLost,()=>{this.safeEmit(CE.P2P_LOST,this.store.uid)}),this._p2pChannel.on(fE.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(fE.ConnectionTypeChange,e=>{this.safeEmit(CE.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(fE.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(fE.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new _a(Vt.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new _a(Vt.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let i=(r={config:e},WD("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);let{appId:o,cname:s,sid:l,token:d,uid:h,cid:p,vid:f}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:s,sid:l,token:d,uid:h,cid:p,vid:f?Number(f):0},N_)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(e){e.on(J_.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(CE.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===mT.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(CE.CONTENT_INSPECT_ERROR,new _a(Vt.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(J_.INSPECT_RESULT,(r,i)=>{var o;if(i?.code===Vt.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return B.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(CE.CONTENT_INSPECT_RESULT,r,i)}),e.on(J_.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new _a(Vt.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,r){if(tI(e,"enabled"),e){if(!r)throw new _a(Vt.INVALID_PARAMS,"config is required");if(dat(r),!this._joinInfo)throw new _a(Vt.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{let o=(i={config:r},WD("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);let{appId:s,cname:l,sid:d,token:h,uid:p,cid:f,vid:_}=this._joinInfo;await o.init({appId:s,areaCode:"",cname:l,sid:d,token:h,uid:p,cid:f,vid:_?Number(_):0},N_)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new _a(Vt.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(KT.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(CE.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===GS.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new _a(Vt.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(KT.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(r){j_(r,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new _a(Vt.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,B.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return B.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){tI(e,"enabled"),WE("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,r){switch(r){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},oE(rE.prototype,"leave",[Det],Object.getOwnPropertyDescriptor(rE.prototype,"leave"),rE.prototype),oE(rE.prototype,"publish",[Let],Object.getOwnPropertyDescriptor(rE.prototype,"publish"),rE.prototype),oE(rE.prototype,"unpublish",[Met],Object.getOwnPropertyDescriptor(rE.prototype,"unpublish"),rE.prototype),oE(rE.prototype,"subscribe",[Uet],Object.getOwnPropertyDescriptor(rE.prototype,"subscribe"),rE.prototype),oE(rE.prototype,"presubscribe",[xet],Object.getOwnPropertyDescriptor(rE.prototype,"presubscribe"),rE.prototype),oE(rE.prototype,"massSubscribe",[jet],Object.getOwnPropertyDescriptor(rE.prototype,"massSubscribe"),rE.prototype),oE(rE.prototype,"unsubscribe",[Vet],Object.getOwnPropertyDescriptor(rE.prototype,"unsubscribe"),rE.prototype),oE(rE.prototype,"massUnsubscribe",[Fet],Object.getOwnPropertyDescriptor(rE.prototype,"massUnsubscribe"),rE.prototype),oE(rE.prototype,"setLowStreamParameter",[Bet],Object.getOwnPropertyDescriptor(rE.prototype,"setLowStreamParameter"),rE.prototype),oE(rE.prototype,"enableDualStream",[Get],Object.getOwnPropertyDescriptor(rE.prototype,"enableDualStream"),rE.prototype),oE(rE.prototype,"disableDualStream",[qet],Object.getOwnPropertyDescriptor(rE.prototype,"disableDualStream"),rE.prototype),oE(rE.prototype,"setClientRole",[Wet],Object.getOwnPropertyDescriptor(rE.prototype,"setClientRole"),rE.prototype),oE(rE.prototype,"setProxyServer",[Het],Object.getOwnPropertyDescriptor(rE.prototype,"setProxyServer"),rE.prototype),oE(rE.prototype,"setTurnServer",[Ket],Object.getOwnPropertyDescriptor(rE.prototype,"setTurnServer"),rE.prototype),oE(rE.prototype,"setLicense",[zet],Object.getOwnPropertyDescriptor(rE.prototype,"setLicense"),rE.prototype),oE(rE.prototype,"startProxyServer",[Yet],Object.getOwnPropertyDescriptor(rE.prototype,"startProxyServer"),rE.prototype),oE(rE.prototype,"stopProxyServer",[Jet],Object.getOwnPropertyDescriptor(rE.prototype,"stopProxyServer"),rE.prototype),oE(rE.prototype,"setLocalAccessPointsV2",[Xet],Object.getOwnPropertyDescriptor(rE.prototype,"setLocalAccessPointsV2"),rE.prototype),oE(rE.prototype,"setLocalAccessPoints",[Qet],Object.getOwnPropertyDescriptor(rE.prototype,"setLocalAccessPoints"),rE.prototype),oE(rE.prototype,"setRemoteDefaultVideoStreamType",[Zet],Object.getOwnPropertyDescriptor(rE.prototype,"setRemoteDefaultVideoStreamType"),rE.prototype),oE(rE.prototype,"setRemoteVideoStreamType",[$et],Object.getOwnPropertyDescriptor(rE.prototype,"setRemoteVideoStreamType"),rE.prototype),oE(rE.prototype,"setStreamFallbackOption",[tnt],Object.getOwnPropertyDescriptor(rE.prototype,"setStreamFallbackOption"),rE.prototype),oE(rE.prototype,"setEncryptionConfig",[ent],Object.getOwnPropertyDescriptor(rE.prototype,"setEncryptionConfig"),rE.prototype),oE(rE.prototype,"renewToken",[nnt],Object.getOwnPropertyDescriptor(rE.prototype,"renewToken"),rE.prototype),oE(rE.prototype,"enableAudioVolumeIndicator",[rnt],Object.getOwnPropertyDescriptor(rE.prototype,"enableAudioVolumeIndicator"),rE.prototype),oE(rE.prototype,"startLiveStreaming",[int],Object.getOwnPropertyDescriptor(rE.prototype,"startLiveStreaming"),rE.prototype),oE(rE.prototype,"setLiveTranscoding",[ont],Object.getOwnPropertyDescriptor(rE.prototype,"setLiveTranscoding"),rE.prototype),oE(rE.prototype,"stopLiveStreaming",[snt],Object.getOwnPropertyDescriptor(rE.prototype,"stopLiveStreaming"),rE.prototype),oE(rE.prototype,"startChannelMediaRelay",[ant],Object.getOwnPropertyDescriptor(rE.prototype,"startChannelMediaRelay"),rE.prototype),oE(rE.prototype,"updateChannelMediaRelay",[cnt],Object.getOwnPropertyDescriptor(rE.prototype,"updateChannelMediaRelay"),rE.prototype),oE(rE.prototype,"stopChannelMediaRelay",[unt],Object.getOwnPropertyDescriptor(rE.prototype,"stopChannelMediaRelay"),rE.prototype),oE(rE.prototype,"sendCustomReportMessage",[lnt],Object.getOwnPropertyDescriptor(rE.prototype,"sendCustomReportMessage"),rE.prototype),oE(rE.prototype,"pickSVCLayer",[dnt],Object.getOwnPropertyDescriptor(rE.prototype,"pickSVCLayer"),rE.prototype),oE(rE.prototype,"setRTMConfig",[hnt],Object.getOwnPropertyDescriptor(rE.prototype,"setRTMConfig"),rE.prototype),oE(rE.prototype,"enableContentInspect",[pnt],Object.getOwnPropertyDescriptor(rE.prototype,"enableContentInspect"),rE.prototype),oE(rE.prototype,"disableContentInspect",[fnt],Object.getOwnPropertyDescriptor(rE.prototype,"disableContentInspect"),rE.prototype),oE(rE.prototype,"setImageModeration",[mnt],Object.getOwnPropertyDescriptor(rE.prototype,"setImageModeration"),rE.prototype),oE(rE.prototype,"setP2PTransport",[Ent],Object.getOwnPropertyDescriptor(rE.prototype,"setP2PTransport"),rE.prototype),oE(rE.prototype,"getJoinChannelServiceRecords",[_nt],Object.getOwnPropertyDescriptor(rE.prototype,"getJoinChannelServiceRecords"),rE.prototype),oE(rE.prototype,"setPublishAudioFilterEnabled",[gnt],Object.getOwnPropertyDescriptor(rE.prototype,"setPublishAudioFilterEnabled"),rE.prototype),rE),M3=class e{constructor(r,i){$(this,"id",0),$(this,"element",void 0),$(this,"peerPair",void 0),$(this,"context",void 0),$(this,"audioPlayerElement",void 0),$(this,"audioTrack",void 0),e.count+=1,this.id=e.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{let i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;let r=async(o,s)=>{let l=s==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(l),o.iceGatheringState==="complete"?o.localDescription:new eE(d=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&d(o.localDescription)}})},i=async(o,s)=>await o.setRemoteDescription(s);try{let o=await r(this.peerPair[0],"offer");await i(this.peerPair[1],o);let s=await r(this.peerPair[1],"answer");await i(this.peerPair[0],s)}catch(o){throw new _a(Vt.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(s){throw new _a(Vt.LOCAL_AEC_ERROR,s.toString()).print()}if(!i)throw new _a(Vt.LOCAL_AEC_ERROR,"no dest node when local aec").print();let o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){B.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}},ynt,lU;$(M3,"count",0);var lwt=window.AudioContext||window.webkitAudioContext,dwt=new(ynt=pE({report:aE}),oE((lU=class{constructor(){$(this,"units",[]),$(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return B.debug("the system does not need to process local aec"),-1;this.context||(this.context=new lwt);let r=this.units.find(i=>i&&i.getElement()===e);return r||(r=new M3(e,this.context),this.units.push(r)),r.startEchoCancellation(),B.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return DE().name!==FE.SAFARI}}).prototype,"processExternalMediaAEC",[ynt],Object.getOwnPropertyDescriptor(lU.prototype,"processExternalMediaAEC"),lU.prototype),lU);function Snt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function Tnt(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Snt(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Snt(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var c5=window||document;function hat(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!c5)return;let i=g_._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);let o=s=>{if(!(s&&s.blockedURI&&(g_.onSecurityPolicyViolation||g_.getListeners(_R.SECURITY_POLICY_VIOLATION).length>0)))return;let l=s.blockedURI;_r("CSP_DETECTED_HOSTNAME_LIST").some(d=>nE(l).call(l,d))&&(g_.onSecurityPolicyViolation&&typeof g_.onSecurityPolicyViolation=="function"&&g_.onSecurityPolicyViolation(s),g_.getListeners(_R.SECURITY_POLICY_VIOLATION).length>0&&g_.safeEmit(_R.SECURITY_POLICY_VIOLATION,s))};i&&c5.removeEventListener("securitypolicyviolation",i),(r||e&&typeof e=="function"||g_.getListeners(_R.SECURITY_POLICY_VIOLATION).length>0)&&c5.addEventListener("securitypolicyviolation",o),g_._cspEventHandlerPointer=o}var hwt=j0,pwt=Not,bnt=RegExp.prototype,fwt=function(e){return e===bnt||hwt(bnt,e)?pwt(e):e.flags},w0=m_(fwt);function rP(e){let r=e.length;for(;--r>=0;)e[r]=0}var _H=256,pat=286,nL=30,rL=15,tW=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),qU=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),mwt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Rnt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$R=new Array(576);rP($R);var iL=new Array(60);rP(iL);var NL=new Array(512);rP(NL);var kL=new Array(256);rP(kL);var gH=new Array(29);rP(gH);var U3=new Array(nL);function u5(e,r,i,o,s){this.static_tree=e,this.extra_bits=r,this.extra_base=i,this.elems=o,this.max_length=s,this.has_stree=e&&e.length}var wnt,Int,Cnt;function l5(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}rP(U3);var fat=e=>e<256?NL[e]:NL[256+(e>>>7)],PL=(e,r)=>{e.pending_buf[e.pending++]=255&r,e.pending_buf[e.pending++]=r>>>8&255},CS=(e,r,i)=>{e.bi_valid>16-i?(e.bi_buf|=r<<e.bi_valid&65535,PL(e,e.bi_buf),e.bi_buf=r>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=i)},vR=(e,r,i)=>{CS(e,i[2*r],i[2*r+1])},mat=(e,r)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--r>0);return i>>>1},Eat=(e,r,i)=>{let o=new Array(16),s,l,d=0;for(s=1;s<=rL;s++)d=d+i[s-1]<<1,o[s]=d;for(l=0;l<=r;l++){let h=e[2*l+1];h!==0&&(e[2*l]=mat(o[h]++,h))}},_at=e=>{let r;for(r=0;r<pat;r++)e.dyn_ltree[2*r]=0;for(r=0;r<nL;r++)e.dyn_dtree[2*r]=0;for(r=0;r<19;r++)e.bl_tree[2*r]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},gat=e=>{e.bi_valid>8?PL(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Ant=(e,r,i,o)=>{let s=2*r,l=2*i;return e[s]<e[l]||e[s]===e[l]&&o[r]<=o[i]},d5=(e,r,i)=>{let o=e.heap[i],s=i<<1;for(;s<=e.heap_len&&(s<e.heap_len&&Ant(r,e.heap[s+1],e.heap[s],e.depth)&&s++,!Ant(r,o,e.heap[s],e.depth));)e.heap[i]=e.heap[s],i=s,s<<=1;e.heap[i]=o},Ont=(e,r,i)=>{let o,s,l,d,h=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+h++],o+=(255&e.pending_buf[e.sym_buf+h++])<<8,s=e.pending_buf[e.sym_buf+h++],o===0?vR(e,s,r):(l=kL[s],vR(e,l+_H+1,r),d=tW[l],d!==0&&(s-=gH[l],CS(e,s,d)),o--,l=fat(o),vR(e,l,i),d=qU[l],d!==0&&(o-=U3[l],CS(e,o,d)));while(h<e.sym_next);vR(e,256,r)},h5=(e,r)=>{let i=r.dyn_tree,o=r.stat_desc.static_tree,s=r.stat_desc.has_stree,l=r.stat_desc.elems,d,h,p,f=-1;for(e.heap_len=0,e.heap_max=573,d=0;d<l;d++)i[2*d]!==0?(e.heap[++e.heap_len]=f=d,e.depth[d]=0):i[2*d+1]=0;for(;e.heap_len<2;)p=e.heap[++e.heap_len]=f<2?++f:0,i[2*p]=1,e.depth[p]=0,e.opt_len--,s&&(e.static_len-=o[2*p+1]);for(r.max_code=f,d=e.heap_len>>1;d>=1;d--)d5(e,i,d);p=l;do d=e.heap[1],e.heap[1]=e.heap[e.heap_len--],d5(e,i,1),h=e.heap[1],e.heap[--e.heap_max]=d,e.heap[--e.heap_max]=h,i[2*p]=i[2*d]+i[2*h],e.depth[p]=(e.depth[d]>=e.depth[h]?e.depth[d]:e.depth[h])+1,i[2*d+1]=i[2*h+1]=p,e.heap[1]=p++,d5(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((_,g)=>{let b=g.dyn_tree,C=g.max_code,k=g.stat_desc.static_tree,A=g.stat_desc.has_stree,P=g.stat_desc.extra_bits,x=g.stat_desc.extra_base,j=g.stat_desc.max_length,z,_t,ue,_n,Ei,_s,kc=0;for(_n=0;_n<=rL;_n++)_.bl_count[_n]=0;for(b[2*_.heap[_.heap_max]+1]=0,z=_.heap_max+1;z<573;z++)_t=_.heap[z],_n=b[2*b[2*_t+1]+1]+1,_n>j&&(_n=j,kc++),b[2*_t+1]=_n,_t>C||(_.bl_count[_n]++,Ei=0,_t>=x&&(Ei=P[_t-x]),_s=b[2*_t],_.opt_len+=_s*(_n+Ei),A&&(_.static_len+=_s*(k[2*_t+1]+Ei)));if(kc!==0){do{for(_n=j-1;_.bl_count[_n]===0;)_n--;_.bl_count[_n]--,_.bl_count[_n+1]+=2,_.bl_count[j]--,kc-=2}while(kc>0);for(_n=j;_n!==0;_n--)for(_t=_.bl_count[_n];_t!==0;)ue=_.heap[--z],ue>C||(b[2*ue+1]!==_n&&(_.opt_len+=(_n-b[2*ue+1])*b[2*ue],b[2*ue+1]=_n),_t--)}})(e,r),Eat(i,f,e.bl_count)},Nnt=(e,r,i)=>{let o,s,l=-1,d=r[1],h=0,p=7,f=4;for(d===0&&(p=138,f=3),r[2*(i+1)+1]=65535,o=0;o<=i;o++)s=d,d=r[2*(o+1)+1],++h<p&&s===d||(h<f?e.bl_tree[2*s]+=h:s!==0?(s!==l&&e.bl_tree[2*s]++,e.bl_tree[32]++):h<=10?e.bl_tree[34]++:e.bl_tree[36]++,h=0,l=s,d===0?(p=138,f=3):s===d?(p=6,f=3):(p=7,f=4))},knt=(e,r,i)=>{let o,s,l=-1,d=r[1],h=0,p=7,f=4;for(d===0&&(p=138,f=3),o=0;o<=i;o++)if(s=d,d=r[2*(o+1)+1],!(++h<p&&s===d)){if(h<f)do vR(e,s,e.bl_tree);while(--h!=0);else s!==0?(s!==l&&(vR(e,s,e.bl_tree),h--),vR(e,16,e.bl_tree),CS(e,h-3,2)):h<=10?(vR(e,17,e.bl_tree),CS(e,h-3,3)):(vR(e,18,e.bl_tree),CS(e,h-11,7));h=0,l=s,d===0?(p=138,f=3):s===d?(p=6,f=3):(p=7,f=4)}},Pnt=!1,vat=(e,r,i,o)=>{CS(e,0+(o?1:0),3),gat(e),PL(e,i),PL(e,~i),i&&e.pending_buf.set(e.window.subarray(r,r+i),e.pending),e.pending+=i},Ewt=e=>{Pnt||((()=>{let r,i,o,s,l,d=new Array(16);for(o=0,s=0;s<28;s++)for(gH[s]=o,r=0;r<1<<tW[s];r++)kL[o++]=s;for(kL[o-1]=s,l=0,s=0;s<16;s++)for(U3[s]=l,r=0;r<1<<qU[s];r++)NL[l++]=s;for(l>>=7;s<nL;s++)for(U3[s]=l<<7,r=0;r<1<<qU[s]-7;r++)NL[256+l++]=s;for(i=0;i<=rL;i++)d[i]=0;for(r=0;r<=143;)$R[2*r+1]=8,r++,d[8]++;for(;r<=255;)$R[2*r+1]=9,r++,d[9]++;for(;r<=279;)$R[2*r+1]=7,r++,d[7]++;for(;r<=287;)$R[2*r+1]=8,r++,d[8]++;for(Eat($R,287,d),r=0;r<nL;r++)iL[2*r+1]=5,iL[2*r]=mat(r,5);wnt=new u5($R,tW,257,pat,rL),Int=new u5(iL,qU,0,nL,rL),Cnt=new u5(new Array(0),mwt,0,19,7)})(),Pnt=!0),e.l_desc=new l5(e.dyn_ltree,wnt),e.d_desc=new l5(e.dyn_dtree,Int),e.bl_desc=new l5(e.bl_tree,Cnt),e.bi_buf=0,e.bi_valid=0,_at(e)},_wt=(e,r,i,o)=>{let s,l,d=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(h=>{let p,f=4093624447;for(p=0;p<=31;p++,f>>>=1)if(1&f&&h.dyn_ltree[2*p]!==0)return 0;if(h.dyn_ltree[18]!==0||h.dyn_ltree[20]!==0||h.dyn_ltree[26]!==0)return 1;for(p=32;p<_H;p++)if(h.dyn_ltree[2*p]!==0)return 1;return 0})(e)),h5(e,e.l_desc),h5(e,e.d_desc),d=(h=>{let p;for(Nnt(h,h.dyn_ltree,h.l_desc.max_code),Nnt(h,h.dyn_dtree,h.d_desc.max_code),h5(h,h.bl_desc),p=18;p>=3&&h.bl_tree[2*Rnt[p]+1]===0;p--);return h.opt_len+=3*(p+1)+5+5+4,p})(e),s=e.opt_len+3+7>>>3,l=e.static_len+3+7>>>3,l<=s&&(s=l)):s=l=i+5,i+4<=s&&r!==-1?vat(e,r,i,o):e.strategy===4||l===s?(CS(e,2+(o?1:0),3),Ont(e,$R,iL)):(CS(e,4+(o?1:0),3),((h,p,f,_)=>{let g;for(CS(h,p-257,5),CS(h,f-1,5),CS(h,_-4,4),g=0;g<_;g++)CS(h,h.bl_tree[2*Rnt[g]+1],3);knt(h,h.dyn_ltree,p-1),knt(h,h.dyn_dtree,f-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),Ont(e,e.dyn_ltree,e.dyn_dtree)),_at(e),o&&gat(e)},gwt=(e,r,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,r===0?e.dyn_ltree[2*i]++:(e.matches++,r--,e.dyn_ltree[2*(kL[i]+_H+1)]++,e.dyn_dtree[2*fat(r)]++),e.sym_next===e.sym_end),vwt=e=>{CS(e,2,3),vR(e,256,$R),(r=>{r.bi_valid===16?(PL(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(e)},ywt={_tr_init:Ewt,_tr_stored_block:vat,_tr_flush_block:_wt,_tr_tally:gwt,_tr_align:vwt},DL=(e,r,i,o)=>{let s=65535&e|0,l=e>>>16&65535|0,d=0;for(;i!==0;){d=i>2e3?2e3:i,i-=d;do s=s+r[o++]|0,l=l+s|0;while(--d);s%=65521,l%=65521}return s|l<<16|0},Swt=new Uint32Array((()=>{let e,r=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;r[i]=e}return r})()),D0=(e,r,i,o)=>{let s=Swt,l=o+i;e^=-1;for(let d=o;d<l;d++)e=e>>>8^s[255&(e^r[d])];return-1^e},nN={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},iP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Twt,_tr_stored_block:eW,_tr_flush_block:bwt,_tr_tally:JI,_tr_align:Rwt}=ywt,{Z_NO_FLUSH:XI,Z_PARTIAL_FLUSH:wwt,Z_FULL_FLUSH:Iwt,Z_FINISH:TT,Z_BLOCK:Dnt,Z_OK:W0,Z_STREAM_END:Lnt,Z_STREAM_ERROR:bR,Z_DATA_ERROR:Cwt,Z_BUF_ERROR:p5,Z_DEFAULT_COMPRESSION:Awt,Z_FILTERED:Owt,Z_HUFFMAN_ONLY:dU,Z_RLE:Nwt,Z_FIXED:kwt,Z_DEFAULT_STRATEGY:Pwt,Z_UNKNOWN:Dwt,Z_DEFLATED:gV}=iP,nW=286,Lwt=30,Mwt=19,Uwt=2*nW+1,xwt=15,WO=258,RR=262,G1=42,HO=113,KD=666,KO=(e,r)=>(e.msg=nN[r],r),Mnt=e=>2*e-(e>4?9:0),VI=e=>{let r=e.length;for(;--r>=0;)e[r]=0},jwt=e=>{let r,i,o,s=e.w_size;r=e.hash_size,o=r;do i=e.head[--o],e.head[o]=i>=s?i-s:0;while(--r);r=s,o=r;do i=e.prev[--o],e.prev[o]=i>=s?i-s:0;while(--r)},QI=(e,r,i)=>(r<<e.hash_shift^i)&e.hash_mask,WS=e=>{let r=e.state,i=r.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),e.next_out),e.next_out+=i,r.pending_out+=i,e.total_out+=i,e.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},KS=(e,r)=>{bwt(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,WS(e.strm)},E_=(e,r)=>{e.pending_buf[e.pending++]=r},ND=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=255&r},rW=(e,r,i,o)=>{let s=e.avail_in;return s>o&&(s=o),s===0?0:(e.avail_in-=s,r.set(e.input.subarray(e.next_in,e.next_in+s),i),e.state.wrap===1?e.adler=DL(e.adler,r,s,i):e.state.wrap===2&&(e.adler=D0(e.adler,r,s,i)),e.next_in+=s,e.total_in+=s,s)},yat=(e,r)=>{let i,o,s=e.max_chain_length,l=e.strstart,d=e.prev_length,h=e.nice_match,p=e.strstart>e.w_size-RR?e.strstart-(e.w_size-RR):0,f=e.window,_=e.w_mask,g=e.prev,b=e.strstart+WO,C=f[l+d-1],k=f[l+d];e.prev_length>=e.good_match&&(s>>=2),h>e.lookahead&&(h=e.lookahead);do if(i=r,f[i+d]===k&&f[i+d-1]===C&&f[i]===f[l]&&f[++i]===f[l+1]){l+=2,i++;do;while(f[++l]===f[++i]&&f[++l]===f[++i]&&f[++l]===f[++i]&&f[++l]===f[++i]&&f[++l]===f[++i]&&f[++l]===f[++i]&&f[++l]===f[++i]&&f[++l]===f[++i]&&l<b);if(o=WO-(b-l),l=b-WO,o>d){if(e.match_start=r,d=o,o>=h)break;C=f[l+d-1],k=f[l+d]}}while((r=g[r&_])>p&&--s!=0);return d<=e.lookahead?d:e.lookahead},q1=e=>{let r=e.w_size,i,o,s;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-RR)&&(e.window.set(e.window.subarray(r,r+r-o),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),jwt(e),o+=r),e.strm.avail_in===0)break;if(i=rW(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=QI(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=QI(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<RR&&e.strm.avail_in!==0)},Sat=(e,r)=>{let i,o,s,l=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,d=0,h=e.strm.avail_in;do{if(i=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>s&&(i=s),i<l&&(i===0&&r!==TT||r===XI||i!==o+e.strm.avail_in)))break;d=r===TT&&i===o+e.strm.avail_in?1:0,eW(e,0,0,d),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,WS(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(rW(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(d===0);return h-=e.strm.avail_in,h&&(h>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=h&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-h,e.strm.next_in),e.strstart),e.strstart+=h,e.insert+=h>e.w_size-e.insert?e.w_size-e.insert:h),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),d?4:r!==XI&&r!==TT&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(rW(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,l=s>e.w_size?e.w_size:s,o=e.strstart-e.block_start,(o>=l||(o||r===TT)&&r!==XI&&e.strm.avail_in===0&&o<=s)&&(i=o>s?s:o,d=r===TT&&e.strm.avail_in===0&&i===o?1:0,eW(e,e.block_start,i,d),e.block_start+=i,WS(e.strm)),d?3:1)},f5=(e,r)=>{let i,o;for(;;){if(e.lookahead<RR){if(q1(e),e.lookahead<RR&&r===XI)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=QI(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-RR&&(e.match_length=yat(e,i)),e.match_length>=3)if(o=JI(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=QI(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=QI(e,e.ins_h,e.window[e.strstart+1]);else o=JI(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(KS(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,r===TT?(KS(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(KS(e,!1),e.strm.avail_out===0)?1:2},r1=(e,r)=>{let i,o,s;for(;;){if(e.lookahead<RR){if(q1(e),e.lookahead<RR&&r===XI)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=QI(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-RR&&(e.match_length=yat(e,i),e.match_length<=5&&(e.strategy===Owt||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,o=JI(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=QI(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(KS(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=JI(e,0,e.window[e.strstart-1]),o&&KS(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=JI(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,r===TT?(KS(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(KS(e,!1),e.strm.avail_out===0)?1:2};function fR(e,r,i,o,s){this.good_length=e,this.max_lazy=r,this.nice_length=i,this.max_chain=o,this.func=s}var zD=[new fR(0,0,0,0,Sat),new fR(4,4,8,4,f5),new fR(4,5,16,8,f5),new fR(4,6,32,32,f5),new fR(4,4,16,16,r1),new fR(8,16,32,32,r1),new fR(8,16,128,128,r1),new fR(8,32,128,256,r1),new fR(32,128,258,1024,r1),new fR(32,258,258,4096,r1)];function Vwt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=gV,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Uwt),this.dyn_dtree=new Uint16Array(2*(2*Lwt+1)),this.bl_tree=new Uint16Array(2*(2*Mwt+1)),VI(this.dyn_ltree),VI(this.dyn_dtree),VI(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(xwt+1),this.heap=new Uint16Array(2*nW+1),VI(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*nW+1),VI(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var LL=e=>{if(!e)return 1;let r=e.state;return!r||r.strm!==e||r.status!==G1&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==HO&&r.status!==KD?1:0},Tat=e=>{if(LL(e))return KO(e,bR);e.total_in=e.total_out=0,e.data_type=Dwt;let r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?G1:HO,e.adler=r.wrap===2?0:1,r.last_flush=-2,Twt(r),W0},bat=e=>{let r=Tat(e);return r===W0&&(i=>{i.window_size=2*i.w_size,VI(i.head),i.max_lazy_match=zD[i.level].max_lazy,i.good_match=zD[i.level].good_length,i.nice_match=zD[i.level].nice_length,i.max_chain_length=zD[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),r},Unt=(e,r,i,o,s,l)=>{if(!e)return bR;let d=1;if(r===Awt&&(r=6),o<0?(d=0,o=-o):o>15&&(d=2,o-=16),s<1||s>9||i!==gV||o<8||o>15||r<0||r>9||l<0||l>kwt||o===8&&d!==1)return KO(e,bR);o===8&&(o=9);let h=new Vwt;return e.state=h,h.strm=e,h.status=G1,h.wrap=d,h.gzhead=null,h.w_bits=o,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=s+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new Uint8Array(2*h.w_size),h.head=new Uint16Array(h.hash_size),h.prev=new Uint16Array(h.w_size),h.lit_bufsize=1<<s+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new Uint8Array(h.pending_buf_size),h.sym_buf=h.lit_bufsize,h.sym_end=3*(h.lit_bufsize-1),h.level=r,h.strategy=l,h.method=i,bat(e)},Fwt=(e,r)=>{if(LL(e)||r>Dnt||r<0)return e?KO(e,bR):bR;let i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===KD&&r!==TT)return KO(e,e.avail_out===0?p5:bR);let o=i.last_flush;if(i.last_flush=r,i.pending!==0){if(WS(e),e.avail_out===0)return i.last_flush=-1,W0}else if(e.avail_in===0&&Mnt(r)<=Mnt(o)&&r!==TT)return KO(e,p5);if(i.status===KD&&e.avail_in!==0)return KO(e,p5);if(i.status===G1&&i.wrap===0&&(i.status=HO),i.status===G1){let s=gV+(i.w_bits-8<<4)<<8,l=-1;if(l=i.strategy>=dU||i.level<2?0:i.level<6?1:i.level===6?2:3,s|=l<<6,i.strstart!==0&&(s|=32),s+=31-s%31,ND(i,s),i.strstart!==0&&(ND(i,e.adler>>>16),ND(i,65535&e.adler)),e.adler=1,i.status=HO,WS(e),i.pending!==0)return i.last_flush=-1,W0}if(i.status===57){if(e.adler=0,E_(i,31),E_(i,139),E_(i,8),i.gzhead)E_(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),E_(i,255&i.gzhead.time),E_(i,i.gzhead.time>>8&255),E_(i,i.gzhead.time>>16&255),E_(i,i.gzhead.time>>24&255),E_(i,i.level===9?2:i.strategy>=dU||i.level<2?4:0),E_(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(E_(i,255&i.gzhead.extra.length),E_(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=D0(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(E_(i,0),E_(i,0),E_(i,0),E_(i,0),E_(i,0),E_(i,i.level===9?2:i.strategy>=dU||i.level<2?4:0),E_(i,3),i.status=HO,WS(e),i.pending!==0)return i.last_flush=-1,W0}if(i.status===69){if(i.gzhead.extra){let s=i.pending,l=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+l>i.pending_buf_size;){let h=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+h),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>s&&(e.adler=D0(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex+=h,WS(e),i.pending!==0)return i.last_flush=-1,W0;s=0,l-=h}let d=new Uint8Array(i.gzhead.extra);i.pending_buf.set(d.subarray(i.gzindex,i.gzindex+l),i.pending),i.pending+=l,i.gzhead.hcrc&&i.pending>s&&(e.adler=D0(e.adler,i.pending_buf,i.pending-s,s)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let s,l=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>l&&(e.adler=D0(e.adler,i.pending_buf,i.pending-l,l)),WS(e),i.pending!==0)return i.last_flush=-1,W0;l=0}s=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,E_(i,s)}while(s!==0);i.gzhead.hcrc&&i.pending>l&&(e.adler=D0(e.adler,i.pending_buf,i.pending-l,l)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let s,l=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>l&&(e.adler=D0(e.adler,i.pending_buf,i.pending-l,l)),WS(e),i.pending!==0)return i.last_flush=-1,W0;l=0}s=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,E_(i,s)}while(s!==0);i.gzhead.hcrc&&i.pending>l&&(e.adler=D0(e.adler,i.pending_buf,i.pending-l,l))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(WS(e),i.pending!==0))return i.last_flush=-1,W0;E_(i,255&e.adler),E_(i,e.adler>>8&255),e.adler=0}if(i.status=HO,WS(e),i.pending!==0)return i.last_flush=-1,W0}if(e.avail_in!==0||i.lookahead!==0||r!==XI&&i.status!==KD){let s=i.level===0?Sat(i,r):i.strategy===dU?((l,d)=>{let h;for(;;){if(l.lookahead===0&&(q1(l),l.lookahead===0)){if(d===XI)return 1;break}if(l.match_length=0,h=JI(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++,h&&(KS(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,d===TT?(KS(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(KS(l,!1),l.strm.avail_out===0)?1:2})(i,r):i.strategy===Nwt?((l,d)=>{let h,p,f,_,g=l.window;for(;;){if(l.lookahead<=WO){if(q1(l),l.lookahead<=WO&&d===XI)return 1;if(l.lookahead===0)break}if(l.match_length=0,l.lookahead>=3&&l.strstart>0&&(f=l.strstart-1,p=g[f],p===g[++f]&&p===g[++f]&&p===g[++f])){_=l.strstart+WO;do;while(p===g[++f]&&p===g[++f]&&p===g[++f]&&p===g[++f]&&p===g[++f]&&p===g[++f]&&p===g[++f]&&p===g[++f]&&f<_);l.match_length=WO-(_-f),l.match_length>l.lookahead&&(l.match_length=l.lookahead)}if(l.match_length>=3?(h=JI(l,1,l.match_length-3),l.lookahead-=l.match_length,l.strstart+=l.match_length,l.match_length=0):(h=JI(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++),h&&(KS(l,!1),l.strm.avail_out===0))return 1}return l.insert=0,d===TT?(KS(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(KS(l,!1),l.strm.avail_out===0)?1:2})(i,r):zD[i.level].func(i,r);if(s!==3&&s!==4||(i.status=KD),s===1||s===3)return e.avail_out===0&&(i.last_flush=-1),W0;if(s===2&&(r===wwt?Rwt(i):r!==Dnt&&(eW(i,0,0,!1),r===Iwt&&(VI(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),WS(e),e.avail_out===0))return i.last_flush=-1,W0}return r!==TT?W0:i.wrap<=0?Lnt:(i.wrap===2?(E_(i,255&e.adler),E_(i,e.adler>>8&255),E_(i,e.adler>>16&255),E_(i,e.adler>>24&255),E_(i,255&e.total_in),E_(i,e.total_in>>8&255),E_(i,e.total_in>>16&255),E_(i,e.total_in>>24&255)):(ND(i,e.adler>>>16),ND(i,65535&e.adler)),WS(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?W0:Lnt)},Bwt=(e,r)=>{let i=r.length;if(LL(e))return bR;let o=e.state,s=o.wrap;if(s===2||s===1&&o.status!==G1||o.lookahead)return bR;if(s===1&&(e.adler=DL(e.adler,r,i,0)),o.wrap=0,i>=o.w_size){s===0&&(VI(o.head),o.strstart=0,o.block_start=0,o.insert=0);let p=new Uint8Array(o.w_size);p.set(r.subarray(i-o.w_size,i),0),r=p,i=o.w_size}let l=e.avail_in,d=e.next_in,h=e.input;for(e.avail_in=i,e.next_in=0,e.input=r,q1(o);o.lookahead>=3;){let p=o.strstart,f=o.lookahead-2;do o.ins_h=QI(o,o.ins_h,o.window[p+3-1]),o.prev[p&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=p,p++;while(--f);o.strstart=p,o.lookahead=2,q1(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=d,e.input=h,e.avail_in=l,o.wrap=s,W0},oL={deflateInit:(e,r)=>Unt(e,r,gV,15,8,Pwt),deflateInit2:Unt,deflateReset:bat,deflateResetKeep:Tat,deflateSetHeader:(e,r)=>LL(e)||e.state.wrap!==2?bR:(e.state.gzhead=r,W0),deflate:Fwt,deflateEnd:e=>{if(LL(e))return bR;let r=e.state.status;return e.state=null,r===HO?KO(e,Cwt):W0},deflateSetDictionary:Bwt,deflateInfo:"pako deflate (from Nodeca project)"},Gwt=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),vV={assign:function(e){let r=Array.prototype.slice.call(arguments,1);for(;r.length;){let i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(let o in i)Gwt(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let r=0;for(let o=0,s=e.length;o<s;o++)r+=e[o].length;let i=new Uint8Array(r);for(let o=0,s=0,l=e.length;o<l;o++){let d=e[o];i.set(d,s),s+=d.length}return i}},Rat=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Rat=!1}var ML=new Uint8Array(256);for(let e=0;e<256;e++)ML[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;ML[254]=ML[254]=1;var UL={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,i,o,s,l,d=e.length,h=0;for(s=0;s<d;s++)i=e.charCodeAt(s),(64512&i)==55296&&s+1<d&&(o=e.charCodeAt(s+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),s++)),h+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(h),l=0,s=0;l<h;s++)i=e.charCodeAt(s),(64512&i)==55296&&s+1<d&&(o=e.charCodeAt(s+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),s++)),i<128?r[l++]=i:i<2048?(r[l++]=192|i>>>6,r[l++]=128|63&i):i<65536?(r[l++]=224|i>>>12,r[l++]=128|i>>>6&63,r[l++]=128|63&i):(r[l++]=240|i>>>18,r[l++]=128|i>>>12&63,r[l++]=128|i>>>6&63,r[l++]=128|63&i);return r},buf2string:(e,r)=>{let i=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let o,s,l=new Array(2*i);for(s=0,o=0;o<i;){let d=e[o++];if(d<128){l[s++]=d;continue}let h=ML[d];if(h>4)l[s++]=65533,o+=h-1;else{for(d&=h===2?31:h===3?15:7;h>1&&o<i;)d=d<<6|63&e[o++],h--;h>1?l[s++]=65533:d<65536?l[s++]=d:(d-=65536,l[s++]=55296|d>>10&1023,l[s++]=56320|1023&d)}}return((d,h)=>{if(h<65534&&d.subarray&&Rat)return String.fromCharCode.apply(null,d.length===h?d:d.subarray(0,h));let p="";for(let f=0;f<h;f++)p+=String.fromCharCode(d[f]);return p})(l,s)},utf8border:(e,r)=>{(r=r||e.length)>e.length&&(r=e.length);let i=r-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?r:i+ML[e[i]]>r?i:r}},wat=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Iat=Object.prototype.toString,{Z_NO_FLUSH:qwt,Z_SYNC_FLUSH:Wwt,Z_FULL_FLUSH:Hwt,Z_FINISH:Kwt,Z_OK:x3,Z_STREAM_END:zwt,Z_DEFAULT_COMPRESSION:Ywt,Z_DEFAULT_STRATEGY:Jwt,Z_DEFLATED:Xwt}=iP;function sL(e){this.options=vV.assign({level:Ywt,method:Xwt,chunkSize:16384,windowBits:15,memLevel:8,strategy:Jwt},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new wat,this.strm.avail_out=0;let i=oL.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==x3)throw new Error(nN[i]);if(r.header&&oL.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?UL.string2buf(r.dictionary):Iat.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=oL.deflateSetDictionary(this.strm,o),i!==x3)throw new Error(nN[i]);this._dict_set=!0}}function m5(e,r){let i=new sL(r);if(i.push(e,!0),i.err)throw i.msg||nN[i.err];return i.result}sL.prototype.push=function(e,r){let i=this.strm,o=this.options.chunkSize,s,l;if(this.ended)return!1;for(l=r===~~r?r:r===!0?Kwt:qwt,typeof e=="string"?i.input=UL.string2buf(e):Iat.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(l===Wwt||l===Hwt)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(s=oL.deflate(i,l),s===zwt)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),s=oL.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===x3;if(i.avail_out!==0){if(l>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},sL.prototype.onData=function(e){this.chunks.push(e)},sL.prototype.onEnd=function(e){e===x3&&(this.result=vV.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Qwt={Deflate:sL,deflate:m5,deflateRaw:function(e,r){return(r=r||{}).raw=!0,m5(e,r)},gzip:function(e,r){return(r=r||{}).gzip=!0,m5(e,r)},constants:iP},hU=16209,Zwt=function(e,r){let i,o,s,l,d,h,p,f,_,g,b,C,k,A,P,x,j,z,_t,ue,_n,Ei,_s,kc,_i=e.state;i=e.next_in,_s=e.input,o=i+(e.avail_in-5),s=e.next_out,kc=e.output,l=s-(r-e.avail_out),d=s+(e.avail_out-257),h=_i.dmax,p=_i.wsize,f=_i.whave,_=_i.wnext,g=_i.window,b=_i.hold,C=_i.bits,k=_i.lencode,A=_i.distcode,P=(1<<_i.lenbits)-1,x=(1<<_i.distbits)-1;t:do{C<15&&(b+=_s[i++]<<C,C+=8,b+=_s[i++]<<C,C+=8),j=k[b&P];e:for(;;){if(z=j>>>24,b>>>=z,C-=z,z=j>>>16&255,z===0)kc[s++]=65535&j;else{if(!(16&z)){if(!(64&z)){j=k[(65535&j)+(b&(1<<z)-1)];continue e}if(32&z){_i.mode=16191;break t}e.msg="invalid literal/length code",_i.mode=hU;break t}_t=65535&j,z&=15,z&&(C<z&&(b+=_s[i++]<<C,C+=8),_t+=b&(1<<z)-1,b>>>=z,C-=z),C<15&&(b+=_s[i++]<<C,C+=8,b+=_s[i++]<<C,C+=8),j=A[b&x];n:for(;;){if(z=j>>>24,b>>>=z,C-=z,z=j>>>16&255,!(16&z)){if(!(64&z)){j=A[(65535&j)+(b&(1<<z)-1)];continue n}e.msg="invalid distance code",_i.mode=hU;break t}if(ue=65535&j,z&=15,C<z&&(b+=_s[i++]<<C,C+=8,C<z&&(b+=_s[i++]<<C,C+=8)),ue+=b&(1<<z)-1,ue>h){e.msg="invalid distance too far back",_i.mode=hU;break t}if(b>>>=z,C-=z,z=s-l,ue>z){if(z=ue-z,z>f&&_i.sane){e.msg="invalid distance too far back",_i.mode=hU;break t}if(_n=0,Ei=g,_===0){if(_n+=p-z,z<_t){_t-=z;do kc[s++]=g[_n++];while(--z);_n=s-ue,Ei=kc}}else if(_<z){if(_n+=p+_-z,z-=_,z<_t){_t-=z;do kc[s++]=g[_n++];while(--z);if(_n=0,_<_t){z=_,_t-=z;do kc[s++]=g[_n++];while(--z);_n=s-ue,Ei=kc}}}else if(_n+=_-z,z<_t){_t-=z;do kc[s++]=g[_n++];while(--z);_n=s-ue,Ei=kc}for(;_t>2;)kc[s++]=Ei[_n++],kc[s++]=Ei[_n++],kc[s++]=Ei[_n++],_t-=3;_t&&(kc[s++]=Ei[_n++],_t>1&&(kc[s++]=Ei[_n++]))}else{_n=s-ue;do kc[s++]=kc[_n++],kc[s++]=kc[_n++],kc[s++]=kc[_n++],_t-=3;while(_t>2);_t&&(kc[s++]=kc[_n++],_t>1&&(kc[s++]=kc[_n++]))}break}}break}}while(i<o&&s<d);_t=C>>3,i-=_t,C-=_t<<3,b&=(1<<C)-1,e.next_in=i,e.next_out=s,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=s<d?d-s+257:257-(s-d),_i.hold=b,_i.bits=C},pU=15,$wt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),tIt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),eIt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),nIt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),aL=(e,r,i,o,s,l,d,h)=>{let p=h.bits,f,_,g,b,C,k,A=0,P=0,x=0,j=0,z=0,_t=0,ue=0,_n=0,Ei=0,_s=0,kc=null,_i=new Uint16Array(16),_h=new Uint16Array(16),_p,Qm,_o,ga=null;for(A=0;A<=pU;A++)_i[A]=0;for(P=0;P<o;P++)_i[r[i+P]]++;for(z=p,j=pU;j>=1&&_i[j]===0;j--);if(z>j&&(z=j),j===0)return s[l++]=20971520,s[l++]=20971520,h.bits=1,0;for(x=1;x<j&&_i[x]===0;x++);for(z<x&&(z=x),_n=1,A=1;A<=pU;A++)if(_n<<=1,_n-=_i[A],_n<0)return-1;if(_n>0&&(e===0||j!==1))return-1;for(_h[1]=0,A=1;A<pU;A++)_h[A+1]=_h[A]+_i[A];for(P=0;P<o;P++)r[i+P]!==0&&(d[_h[r[i+P]]++]=P);if(e===0?(kc=ga=d,k=20):e===1?(kc=$wt,ga=tIt,k=257):(kc=eIt,ga=nIt,k=0),_s=0,P=0,A=x,C=l,_t=z,ue=0,g=-1,Ei=1<<z,b=Ei-1,e===1&&Ei>852||e===2&&Ei>592)return 1;for(;;){_p=A-ue,d[P]+1<k?(Qm=0,_o=d[P]):d[P]>=k?(Qm=ga[d[P]-k],_o=kc[d[P]-k]):(Qm=96,_o=0),f=1<<A-ue,_=1<<_t,x=_;do _-=f,s[C+(_s>>ue)+_]=_p<<24|Qm<<16|_o|0;while(_!==0);for(f=1<<A-1;_s&f;)f>>=1;if(f!==0?(_s&=f-1,_s+=f):_s=0,P++,--_i[A]==0){if(A===j)break;A=r[i+d[P]]}if(A>z&&(_s&b)!==g){for(ue===0&&(ue=z),C+=x,_t=A-ue,_n=1<<_t;_t+ue<j&&(_n-=_i[_t+ue],!(_n<=0));)_t++,_n<<=1;if(Ei+=1<<_t,e===1&&Ei>852||e===2&&Ei>592)return 1;g=_s&b,s[g]=z<<24|_t<<16|C-l|0}}return _s!==0&&(s[C+_s]=A-ue<<24|64<<16|0),h.bits=z,0},{Z_FINISH:xnt,Z_BLOCK:rIt,Z_TREES:fU,Z_OK:JO,Z_STREAM_END:iIt,Z_NEED_DICT:oIt,Z_STREAM_ERROR:bT,Z_DATA_ERROR:Cat,Z_MEM_ERROR:Aat,Z_BUF_ERROR:sIt,Z_DEFLATED:jnt}=iP,yV=16180,j3=16190,KR=16191,E5=16192,_5=16194,mU=16199,EU=16200,g5=16206,Y_=16209,Vnt=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function aIt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var XO=e=>{if(!e)return 1;let r=e.state;return!r||r.strm!==e||r.mode<yV||r.mode>16211?1:0},Oat=e=>{if(XO(e))return bT;let r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=1&r.wrap),r.mode=yV,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,JO},Nat=e=>{if(XO(e))return bT;let r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,Oat(e)},kat=(e,r)=>{let i;if(XO(e))return bT;let o=e.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?bT:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=i,o.wbits=r,Nat(e))},Fnt=(e,r)=>{if(!e)return bT;let i=new aIt;e.state=i,i.strm=e,i.window=null,i.mode=yV;let o=kat(e,r);return o!==JO&&(e.state=null),o},v5,y5,Bnt=!0,cIt=e=>{if(Bnt){v5=new Int32Array(512),y5=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(aL(1,e.lens,0,288,v5,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;aL(2,e.lens,0,32,y5,0,e.work,{bits:5}),Bnt=!1}e.lencode=v5,e.lenbits=9,e.distcode=y5,e.distbits=5},Pat=(e,r,i,o)=>{let s,l=e.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new Uint8Array(l.wsize)),o>=l.wsize?(l.window.set(r.subarray(i-l.wsize,i),0),l.wnext=0,l.whave=l.wsize):(s=l.wsize-l.wnext,s>o&&(s=o),l.window.set(r.subarray(i-o,i-o+s),l.wnext),(o-=s)?(l.window.set(r.subarray(i-o,i),0),l.wnext=o,l.whave=l.wsize):(l.wnext+=s,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=s))),0},uIt=(e,r)=>{let i,o,s,l,d,h,p,f,_,g,b,C,k,A,P,x,j,z,_t,ue,_n,Ei,_s=0,kc=new Uint8Array(4),_i,_h,_p=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(XO(e)||!e.output||!e.input&&e.avail_in!==0)return bT;i=e.state,i.mode===KR&&(i.mode=E5),d=e.next_out,s=e.output,p=e.avail_out,l=e.next_in,o=e.input,h=e.avail_in,f=i.hold,_=i.bits,g=h,b=p,Ei=JO;t:for(;;)switch(i.mode){case yV:if(i.wrap===0){i.mode=E5;break}for(;_<16;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}if(2&i.wrap&&f===35615){i.wbits===0&&(i.wbits=15),i.check=0,kc[0]=255&f,kc[1]=f>>>8&255,i.check=D0(i.check,kc,2,0),f=0,_=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",i.mode=Y_;break}if((15&f)!==jnt){e.msg="unknown compression method",i.mode=Y_;break}if(f>>>=4,_-=4,_n=8+(15&f),i.wbits===0&&(i.wbits=_n),_n>15||_n>i.wbits){e.msg="invalid window size",i.mode=Y_;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&f?16189:KR,f=0,_=0;break;case 16181:for(;_<16;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}if(i.flags=f,(255&w0(i))!==jnt){e.msg="unknown compression method",i.mode=Y_;break}if(57344&w0(i)){e.msg="unknown header flags set",i.mode=Y_;break}i.head&&(i.head.text=f>>8&1),512&w0(i)&&4&i.wrap&&(kc[0]=255&f,kc[1]=f>>>8&255,i.check=D0(i.check,kc,2,0)),f=0,_=0,i.mode=16182;case 16182:for(;_<32;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}i.head&&(i.head.time=f),512&w0(i)&&4&i.wrap&&(kc[0]=255&f,kc[1]=f>>>8&255,kc[2]=f>>>16&255,kc[3]=f>>>24&255,i.check=D0(i.check,kc,4,0)),f=0,_=0,i.mode=16183;case 16183:for(;_<16;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}i.head&&(i.head.xflags=255&f,i.head.os=f>>8),512&w0(i)&&4&i.wrap&&(kc[0]=255&f,kc[1]=f>>>8&255,i.check=D0(i.check,kc,2,0)),f=0,_=0,i.mode=16184;case 16184:if(1024&w0(i)){for(;_<16;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}i.length=f,i.head&&(i.head.extra_len=f),512&w0(i)&&4&i.wrap&&(kc[0]=255&f,kc[1]=f>>>8&255,i.check=D0(i.check,kc,2,0)),f=0,_=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&w0(i)&&(C=i.length,C>h&&(C=h),C&&(i.head&&(_n=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(l,l+C),_n)),512&w0(i)&&4&i.wrap&&(i.check=D0(i.check,o,C,l)),h-=C,l+=C,i.length-=C),i.length))break t;i.length=0,i.mode=16186;case 16186:if(2048&w0(i)){if(h===0)break t;C=0;do _n=o[l+C++],i.head&&_n&&i.length<65536&&(i.head.name+=String.fromCharCode(_n));while(_n&&C<h);if(512&w0(i)&&4&i.wrap&&(i.check=D0(i.check,o,C,l)),h-=C,l+=C,_n)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&w0(i)){if(h===0)break t;C=0;do _n=o[l+C++],i.head&&_n&&i.length<65536&&(i.head.comment+=String.fromCharCode(_n));while(_n&&C<h);if(512&w0(i)&&4&i.wrap&&(i.check=D0(i.check,o,C,l)),h-=C,l+=C,_n)break t}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&w0(i)){for(;_<16;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}if(4&i.wrap&&f!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Y_;break}f=0,_=0}i.head&&(i.head.hcrc=w0(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=KR;break;case 16189:for(;_<32;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}e.adler=i.check=Vnt(f),f=0,_=0,i.mode=j3;case j3:if(i.havedict===0)return e.next_out=d,e.avail_out=p,e.next_in=l,e.avail_in=h,i.hold=f,i.bits=_,oIt;e.adler=i.check=1,i.mode=KR;case KR:if(r===rIt||r===fU)break t;case E5:if(i.last){f>>>=7&_,_-=7&_,i.mode=g5;break}for(;_<3;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}switch(i.last=1&f,f>>>=1,_-=1,3&f){case 0:i.mode=16193;break;case 1:if(cIt(i),i.mode=mU,r===fU){f>>>=2,_-=2;break t}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=Y_}f>>>=2,_-=2;break;case 16193:for(f>>>=7&_,_-=7&_;_<32;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Y_;break}if(i.length=65535&f,f=0,_=0,i.mode=_5,r===fU)break t;case _5:i.mode=16195;case 16195:if(C=i.length,C){if(C>h&&(C=h),C>p&&(C=p),C===0)break t;s.set(o.subarray(l,l+C),d),h-=C,l+=C,p-=C,d+=C,i.length-=C;break}i.mode=KR;break;case 16196:for(;_<14;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}if(i.nlen=257+(31&f),f>>>=5,_-=5,i.ndist=1+(31&f),f>>>=5,_-=5,i.ncode=4+(15&f),f>>>=4,_-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Y_;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;_<3;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}i.lens[_p[i.have++]]=7&f,f>>>=3,_-=3}for(;i.have<19;)i.lens[_p[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,_i={bits:i.lenbits},Ei=aL(0,i.lens,0,19,i.lencode,0,i.work,_i),i.lenbits=_i.bits,Ei){e.msg="invalid code lengths set",i.mode=Y_;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;_s=i.lencode[f&(1<<i.lenbits)-1],P=_s>>>24,x=_s>>>16&255,j=65535&_s,!(P<=_);){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}if(j<16)f>>>=P,_-=P,i.lens[i.have++]=j;else{if(j===16){for(_h=P+2;_<_h;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}if(f>>>=P,_-=P,i.have===0){e.msg="invalid bit length repeat",i.mode=Y_;break}_n=i.lens[i.have-1],C=3+(3&f),f>>>=2,_-=2}else if(j===17){for(_h=P+3;_<_h;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}f>>>=P,_-=P,_n=0,C=3+(7&f),f>>>=3,_-=3}else{for(_h=P+7;_<_h;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}f>>>=P,_-=P,_n=0,C=11+(127&f),f>>>=7,_-=7}if(i.have+C>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Y_;break}for(;C--;)i.lens[i.have++]=_n}}if(i.mode===Y_)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=Y_;break}if(i.lenbits=9,_i={bits:i.lenbits},Ei=aL(1,i.lens,0,i.nlen,i.lencode,0,i.work,_i),i.lenbits=_i.bits,Ei){e.msg="invalid literal/lengths set",i.mode=Y_;break}if(i.distbits=6,i.distcode=i.distdyn,_i={bits:i.distbits},Ei=aL(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,_i),i.distbits=_i.bits,Ei){e.msg="invalid distances set",i.mode=Y_;break}if(i.mode=mU,r===fU)break t;case mU:i.mode=EU;case EU:if(h>=6&&p>=258){e.next_out=d,e.avail_out=p,e.next_in=l,e.avail_in=h,i.hold=f,i.bits=_,Zwt(e,b),d=e.next_out,s=e.output,p=e.avail_out,l=e.next_in,o=e.input,h=e.avail_in,f=i.hold,_=i.bits,i.mode===KR&&(i.back=-1);break}for(i.back=0;_s=i.lencode[f&(1<<i.lenbits)-1],P=_s>>>24,x=_s>>>16&255,j=65535&_s,!(P<=_);){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}if(x&&!(240&x)){for(z=P,_t=x,ue=j;_s=i.lencode[ue+((f&(1<<z+_t)-1)>>z)],P=_s>>>24,x=_s>>>16&255,j=65535&_s,!(z+P<=_);){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}f>>>=z,_-=z,i.back+=z}if(f>>>=P,_-=P,i.back+=P,i.length=j,x===0){i.mode=16205;break}if(32&x){i.back=-1,i.mode=KR;break}if(64&x){e.msg="invalid literal/length code",i.mode=Y_;break}i.extra=15&x,i.mode=16201;case 16201:if(i.extra){for(_h=i.extra;_<_h;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}i.length+=f&(1<<i.extra)-1,f>>>=i.extra,_-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;_s=i.distcode[f&(1<<i.distbits)-1],P=_s>>>24,x=_s>>>16&255,j=65535&_s,!(P<=_);){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}if(!(240&x)){for(z=P,_t=x,ue=j;_s=i.distcode[ue+((f&(1<<z+_t)-1)>>z)],P=_s>>>24,x=_s>>>16&255,j=65535&_s,!(z+P<=_);){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}f>>>=z,_-=z,i.back+=z}if(f>>>=P,_-=P,i.back+=P,64&x){e.msg="invalid distance code",i.mode=Y_;break}i.offset=j,i.extra=15&x,i.mode=16203;case 16203:if(i.extra){for(_h=i.extra;_<_h;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}i.offset+=f&(1<<i.extra)-1,f>>>=i.extra,_-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Y_;break}i.mode=16204;case 16204:if(p===0)break t;if(C=b-p,i.offset>C){if(C=i.offset-C,C>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Y_;break}C>i.wnext?(C-=i.wnext,k=i.wsize-C):k=i.wnext-C,C>i.length&&(C=i.length),A=i.window}else A=s,k=d-i.offset,C=i.length;C>p&&(C=p),p-=C,i.length-=C;do s[d++]=A[k++];while(--C);i.length===0&&(i.mode=EU);break;case 16205:if(p===0)break t;s[d++]=i.length,p--,i.mode=EU;break;case g5:if(i.wrap){for(;_<32;){if(h===0)break t;h--,f|=o[l++]<<_,_+=8}if(b-=p,e.total_out+=b,i.total+=b,4&i.wrap&&b&&(e.adler=i.check=w0(i)?D0(i.check,s,b,d-b):DL(i.check,s,b,d-b)),b=p,4&i.wrap&&(w0(i)?f:Vnt(f))!==i.check){e.msg="incorrect data check",i.mode=Y_;break}f=0,_=0}i.mode=16207;case 16207:if(i.wrap&&w0(i)){for(;_<32;){if(h===0)break t;h--,f+=o[l++]<<_,_+=8}if(4&i.wrap&&f!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Y_;break}f=0,_=0}i.mode=16208;case 16208:Ei=iIt;break t;case Y_:Ei=Cat;break t;case 16210:return Aat;default:return bT}return e.next_out=d,e.avail_out=p,e.next_in=l,e.avail_in=h,i.hold=f,i.bits=_,(i.wsize||b!==e.avail_out&&i.mode<Y_&&(i.mode<g5||r!==xnt))&&Pat(e,e.output,e.next_out,b-e.avail_out),g-=e.avail_in,b-=e.avail_out,e.total_in+=g,e.total_out+=b,i.total+=b,4&i.wrap&&b&&(e.adler=i.check=w0(i)?D0(i.check,s,b,e.next_out-b):DL(i.check,s,b,e.next_out-b)),e.data_type=i.bits+(i.last?64:0)+(i.mode===KR?128:0)+(i.mode===mU||i.mode===_5?256:0),(g===0&&b===0||r===xnt)&&Ei===JO&&(Ei=sIt),Ei},_w={inflateReset:Nat,inflateReset2:kat,inflateResetKeep:Oat,inflateInit:e=>Fnt(e,15),inflateInit2:Fnt,inflate:uIt,inflateEnd:e=>{if(XO(e))return bT;let r=e.state;return r.window&&(r.window=null),e.state=null,JO},inflateGetHeader:(e,r)=>{if(XO(e))return bT;let i=e.state;return 2&i.wrap?(i.head=r,r.done=!1,JO):bT},inflateSetDictionary:(e,r)=>{let i=r.length,o,s,l;return XO(e)?bT:(o=e.state,o.wrap!==0&&o.mode!==j3?bT:o.mode===j3&&(s=1,s=DL(s,r,i,0),s!==o.check)?Cat:(l=Pat(e,r,i,i),l?(o.mode=16210,Aat):(o.havedict=1,JO)))},inflateInfo:"pako inflate (from Nodeca project)"},lIt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Dat=Object.prototype.toString,{Z_NO_FLUSH:dIt,Z_FINISH:hIt,Z_OK:cL,Z_STREAM_END:S5,Z_NEED_DICT:T5,Z_STREAM_ERROR:pIt,Z_DATA_ERROR:Gnt,Z_MEM_ERROR:fIt}=iP;function uL(e){this.options=vV.assign({chunkSize:65536,windowBits:15,to:""},e||{});let r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&!(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new wat,this.strm.avail_out=0;let i=_w.inflateInit2(this.strm,r.windowBits);if(i!==cL)throw new Error(nN[i]);if(this.header=new lIt,_w.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=UL.string2buf(r.dictionary):Dat.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=_w.inflateSetDictionary(this.strm,r.dictionary),i!==cL)))throw new Error(nN[i])}function b5(e,r){let i=new uL(r);if(i.push(e),i.err)throw i.msg||nN[i.err];return i.result}uL.prototype.push=function(e,r){let i=this.strm,o=this.options.chunkSize,s=this.options.dictionary,l,d,h;if(this.ended)return!1;for(d=r===~~r?r:r===!0?hIt:dIt,Dat.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),l=_w.inflate(i,d),l===T5&&s&&(l=_w.inflateSetDictionary(i,s),l===cL?l=_w.inflate(i,d):l===Gnt&&(l=T5));i.avail_in>0&&l===S5&&i.state.wrap>0&&e[i.next_in]!==0;)_w.inflateReset(i),l=_w.inflate(i,d);switch(l){case pIt:case Gnt:case T5:case fIt:return this.onEnd(l),this.ended=!0,!1}if(h=i.avail_out,i.next_out&&(i.avail_out===0||l===S5))if(this.options.to==="string"){let p=UL.utf8border(i.output,i.next_out),f=i.next_out-p,_=UL.buf2string(i.output,p);i.next_out=f,i.avail_out=o-f,f&&i.output.set(i.output.subarray(p,p+f),0),this.onData(_)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(l!==cL||h!==0){if(l===S5)return l=_w.inflateEnd(this.strm),this.onEnd(l),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},uL.prototype.onData=function(e){this.chunks.push(e)},uL.prototype.onEnd=function(e){e===cL&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=vV.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var mIt={Inflate:uL,inflate:b5,inflateRaw:function(e,r){return(r=r||{}).raw=!0,b5(e,r)},ungzip:b5,constants:iP},{Deflate:ICt,deflate:EIt,deflateRaw:CCt,gzip:ACt}=Qwt,{Inflate:OCt,inflate:_It,inflateRaw:NCt,ungzip:kCt}=mIt,gIt=EIt,vIt=_It,Lat=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(Lat||{}),iW=class{constructor(){$(this,"_sequence",0),$(this,"_startTime",Date.now()),$(this,"isUseOneByte",!0)}get startTime(){let r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){let i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){let h=new Uint8Array(4);h.set([1,0,0,0]);let p={id:0,length:4,data:h.buffer},f={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[p]};i.commonPacketHeader.extension=1,i.extension=f,i.payload=this.compress(r),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;_r("SHOW_DATASTREAM2_LOG")&&B.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));let o=new ArrayBuffer(i.commonPacketHeader.length),s=new Uint8Array(o),l=new DataView(o),d=0;if(l.setUint16(d,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),d+=2,l.setUint32(d,i.commonPacketHeader.sequence,!0),d+=4,l.setUint16(d,i.commonStreamHeader,!0),d+=2,i.extension){let h=this.serializeExtension(i.extension);s.set(new Uint8Array(h),d),d+=h.byteLength}if(s.set(new Uint8Array(i.payload),d),d+=i.payload.byteLength,d!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);let i=new DataView(r),o=0,s=i.getUint16(o,!0);o+=2;let l={length:16383&s,reserved:(16384&s)>>14,extension:(32768&s)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)},d,h;if(o+=4,_r("SHOW_DATASTREAM2_LOG")&&B.debug("receive data header: ".concat(JSON.stringify(l))),i.getUint16(o,!0),o+=2,l.extension){h=this.deserializeExtension(r.slice(o)),o+=2+h.length,d=r.slice(o);let p=!1;if(h.datas.length>0){let f=h.datas.find(_=>_.id===0);f&&(p=(1&new DataView(f.data).getUint32(0,!0))==1)}d=p?this.decompress(d):d}else d=r.slice(8);return d}serializeExtension(r){let{profile:i,length:o,datas:s}=r,l=new ArrayBuffer(o+2),d=new Uint8Array(l),h=new DataView(l),p=0;if(h.setUint8(p++,i),h.setUint8(p++,o),s.forEach(f=>{i?(h.setUint8(p++,f.id),h.setUint8(p++,f.length),d.set(new Uint8Array(f.data),p),p+=f.data.byteLength):(h.setUint8(p++,f.id|f.length<<4),d.set(new Uint8Array(f.data),p),p+=f.data.byteLength)}),p!==o+2)throw Error("serialize extension error, is ".concat(p,"!==").concat(o+2));return l}deserializeExtension(r){let i=new DataView(r),o=0,s=i.getUint8(o);o++;let l=i.getUint8(o);o++;let d=s===Lat.TWO_BYTE,h=[],p=new DataView(r,2),f=0;for(;f<l;){let _=0,g=0,b=new ArrayBuffer(0);d?(_=p.getUint8(f),f++,g=p.getUint8(f),f++):(_=15&p.getUint8(f),g=p.getUint8(f)>>4,f++),g>0&&(b=p.buffer.slice(f+2,f+2+g),f+=b.byteLength),h.push({id:_,length:g,data:b})}if(f!==l)throw Error("parse error");return{profile:s,length:l,datas:h}}decompress(r){return vIt(new Uint8Array(r))}compress(r){return gIt(new Uint8Array(r))}},yIt={name:"DataStream",create:(e,r)=>{let i=r?new V8(e):new F8(e);return i.useDataStream(new iW),i}},oW=class extends s_{constructor(r,i,o){super(),$(this,"ws",void 0),$(this,"requestId",1),$(this,"heartBeatTimer",void 0),$(this,"joinInfo",void 0),$(this,"clientId",void 0),$(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),$(this,"onClose",s=>{this.emit("close"),this.dispose()}),$(this,"onMessage",s=>{let l=JSON.parse(s.data);if(!l||l.command!=="serverResponse"||!l.requestId)return l&&l.command==="serverStatus"&&l.serverStatus&&l.serverStatus.command?(this.emit("status",l.serverStatus),void this.emit(l.serverStatus.command,l.serverStatus)):void 0;this.emit("req_".concat(l.requestId),l)}),this.joinInfo=r,this.clientId=i,this.ws=new eN("cross-channel-".concat(this.clientId),o),this.ws.on(_E.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(_E.CONNECTED,this.onOpen),this.ws.on(_E.ON_MESSAGE,this.onMessage),this.ws.on(_E.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){let i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new eE((i,o)=>{let s=window.setTimeout(()=>{o(new _a(Vt.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,l=>{window.clearTimeout(s),l.state&&l.state!==0?o(new _a(Vt.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(s),o(new _a(Vt.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new _a(Vt.WS_DISCONNECT);let i=()=>new eE((d,h)=>{this.ws.once(_E.CLOSED,()=>h(new _a(Vt.WS_ABORT))),this.ws.once(_E.CONNECTED,d)});this.ws.state!=="connected"&&await i();let o=this.sendMessage(r),s=new eE((d,h)=>{let p=()=>{h(new _a(Vt.WS_ABORT))};this.ws.once(_E.RECONNECTING,p),this.ws.once(_E.CLOSED,p),this.once("req_".concat(o),d),_y(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(_E.RECONNECTING,p),this.ws.off(_E.CLOSED,p),h(new _a(Vt.TIMEOUT,"cross channel ws request timeout"))})}),l=await s;if(!l||l.code!==200)throw new _a(Vt.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(l)));return l}async connect(r){this.ws.removeAllListeners(_E.REQUEST_NEW_URLS),this.ws.on(_E.REQUEST_NEW_URLS,i=>{i(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){let i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}},sW=class extends s_{set state(r){r!==this._state&&(r!==tS.RELAY_STATE_FAILURE&&(this.errorCode=a1.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,o,s,l){super(),$(this,"joinInfo",void 0),$(this,"sid",void 0),$(this,"clientId",void 0),$(this,"cancelToken",K0.CancelToken.source()),$(this,"workerToken",void 0),$(this,"requestId",0),$(this,"signal",void 0),$(this,"prevChannelMediaConfig",void 0),$(this,"httpRetryConfig",void 0),$(this,"_resolution",void 0),$(this,"_state",tS.RELAY_STATE_IDLE),$(this,"errorCode",a1.RELAY_OK),$(this,"onStatus",d=>{B.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event",zR.PACKET_RECEIVED_AUDIO_FROM_SRC),d.command==="onVideoPacketReceived"&&this.emit("event",zR.PACKET_RECEIVED_VIDEO_FROM_SRC),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=a1.SRC_TOKEN_EXPIRED,this.state=tS.RELAY_STATE_FAILURE),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=a1.DEST_TOKEN_EXPIRED,this.state=tS.RELAY_STATE_FAILURE))}),$(this,"onReconnect",async()=>{B.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",zR.NETWORK_DISCONNECTED),this.state=tS.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!==tS.RELAY_STATE_IDLE&&(B.error("auto restart channel media relay failed",d.toString()),this.errorCode=a1.SERVER_CONNECTION_LOST,this.state=tS.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=i,this.sid=_1(),this.signal=new oW(this.joinInfo,this.clientId,o),this.httpRetryConfig=s,this._resolution=l}async startChannelMediaRelay(r){if(this.state!==tS.RELAY_STATE_IDLE)throw new _a(Vt.INVALID_OPERATION);this.state=tS.RELAY_STATE_CONNECTING,await this.connect(),B.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new _a(Vt.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new _a(Vt.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new _a(Vt.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==tS.RELAY_STATE_RUNNING)throw new _a(Vt.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==tS.RELAY_STATE_RUNNING)throw new _a(Vt.INVALID_OPERATION);let i=this.genMessage(P0.SetVideoProfile);await this.signal.request(i),B.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),B.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=tS.RELAY_STATE_IDLE,this.dispose()}dispose(){B.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=K0.CancelToken.source(),this.state=tS.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let r=await NRt(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",zR.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){let i=this.genMessage(P0.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),B.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let o=this.genMessage(P0.SetSdkProfile,r);await this.signal.request(o),B.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let s=this.genMessage(P0.SetSourceChannel,r);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",zR.PACKET_JOINED_SRC_CHANNEL),B.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let l=this.genMessage(P0.SetSourceUserId,r);await this.signal.request(l),B.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let d=this.genMessage(P0.SetDestChannel,r);await this.signal.request(d),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",zR.PACKET_JOINED_DEST_CHANNEL),B.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let h=this.genMessage(P0.StartPacketTransfer,r);await this.signal.request(h),this.emit("event",zR.PACKET_SENT_TO_DEST_CHANNEL),this.state=tS.RELAY_STATE_RUNNING,B.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){let i=this.genMessage(P0.UpdateDestChannel,r);await this.signal.request(i),this.emit("event",zR.PACKET_UPDATE_DEST_CHANNEL),B.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let r=this.genMessage(P0.StopPacketTransfer);await this.signal.request(r),B.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,i){let o=[],s=[],l=[];this.requestId+=1;let d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:XS,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.22.1"&&(d.sdkVersion="0.0.1");let h=null,p=null;switch(r){case P0.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case P0.SetSourceChannel:if(p=i&&i.getSrcChannelMediaInfo(),!p)throw new _a(Vt.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:p.channelName,token:p.token||this.joinInfo.appId},d;case P0.SetSourceUserId:if(p=i&&i.getSrcChannelMediaInfo(),!p)throw new _a(Vt.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:p.uid+""},d;case P0.SetDestChannel:if(h=i&&i.getDestChannelMediaInfo(),!h)throw new _a(Vt.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(f=>{o.push(f.channelName),s.push(f.uid+""),l.push(f.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:o,uid:s,token:l},d;case P0.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case P0.Reconnect:return d.clientRequest={command:"Reconnect"},d;case P0.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case P0.UpdateDestChannel:if(h=i&&i.getDestChannelMediaInfo(),!h)throw new _a(Vt.UNEXPECTED_ERROR,"can not find dest config");return h.forEach(f=>{o.push(f.channelName),s.push(f.uid+""),l.push(f.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:o,uid:s,token:l},d;case P0.SetVideoProfile:d.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return d}},SIt={name:"ChannelMediaRelay",create:function(e){return new sW(e.joinInfo,e.clientId,e.websocketRetryConfig||N_,e.httpRetryConfig||N_,e.resolution)}};function qnt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function PD(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?qnt(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):qnt(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var aW=class extends s_{constructor(r,i,o,s){super(),$(this,"spec",void 0),$(this,"token",void 0),$(this,"websocket",void 0),$(this,"pingpongTimer",void 0),$(this,"reconnectMode","retry"),$(this,"serviceMode",void 0),$(this,"reqId",0),$(this,"commandReqId",0),$(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),$(this,"handleWebSocketMessage",l=>{if(!l.data)return;let d=JSON.parse(l.data);d.requestId?this.emit("@".concat(d.requestId,"-").concat(d.sid),d):(aE.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===ER.TRANSCODE?1:2}),this.emit(jI.PUBLISH_STREAM_STATUS,d))}),this.spec=i,this.token=r,this.serviceMode=s,this.websocket=new eN("live-streaming",o),this.websocket.on(_E.CONNECTED,this.handleWebSocketOpen),this.websocket.on(_E.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(_E.REQUEST_NEW_URLS,(l,d)=>{c0(this,jI.REQUEST_NEW_ADDRESS).then(l).catch(d)}),this.websocket.on(_E.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,i,o,s){this.reqId+=1,r==="request"&&(this.commandReqId+=1);let l=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new _a(Vt.UNEXPECTED_ERROR);let h=PD({command:r,sdkVersion:XS==="4.22.1"?"0.0.1":XS,seq:d,requestId:d,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new _a(Vt.WS_DISCONNECT);let p=()=>new eE((b,C)=>{this.websocket.once(_E.CLOSED,()=>C(new _a(Vt.WS_ABORT))),this.websocket.once(_E.CONNECTED,b)});this.websocket.state!=="connected"&&await p(),h.clientRequest&&(h.clientRequest.workerToken=this.token);let f=new eE((b,C)=>{let k=()=>{C(new _a(Vt.WS_ABORT))};this.websocket.once(_E.RECONNECTING,k),this.websocket.once(_E.CLOSED,k),this.once("@".concat(d,"-").concat(this.spec.sid),A=>{b(A)})});s&&aE.workerEvent(this.spec.sid,PD(PD({},s),{},{requestId:l,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));let _=Date.now();this.websocket.sendMessage(h);let g=null;try{g=await f}catch(b){if(this.websocket.state==="closed")throw b;return await p(),await this.request(r,i,o)}return s&&aE.workerEvent(this.spec.sid,PD(PD({},s),{},{requestId:l,actionType:"response",payload:JSON.stringify(g.serverResponse),serverCode:g.code,success:g.code===200,responseTime:Date.now()-_})),g.code!==200&&this.handleResponseError(g),g}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let r=XS==="4.22.1"?"0.0.1":XS;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case P_.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void B.warning("live stream response already exists stream");case P_.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case P_.LIVE_STREAM_RESPONSE_BAD_STREAM:case P_.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new _a(Vt.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case P_.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new _a(Vt.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case P_.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new _a(Vt.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case P_.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let i=new _a(Vt.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(jI.WARNING,i,r.serverResponse.url)}case P_.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let i=new _a(Vt.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(jI.WARNING,i,r.serverResponse.url)}case P_.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new _a(Vt.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case P_.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new _a(Vt.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case P_.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let i=new _a(Vt.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(jI.WARNING,i,r.serverResponse.url)}case P_.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new _a(Vt.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case P_.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new _a(Vt.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case P_.LIVE_STREAM_RESPONSE_WORKER_LOST:case P_.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new _a(Vt.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case P_.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new _a(Vt.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new _a(Vt.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case P_.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case P_.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case P_.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case P_.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new _a(Vt.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(hV)},6e3)}};function Wnt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}function $0(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Wnt(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Wnt(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var cW=class extends s_{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:N_,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:N_;super(),$(this,"onLiveStreamWarning",void 0),$(this,"onLiveStreamError",void 0),$(this,"spec",void 0),$(this,"retryTimeout",1e4),$(this,"connection",void 0),$(this,"httpRetryConfig",void 0),$(this,"wsRetryConfig",void 0),$(this,"streamingTasks",new Map),$(this,"isStartingStreamingTask",!1),$(this,"taskMutex",new f0("live-streaming")),$(this,"cancelToken",K0.CancelToken.source()),$(this,"transcodingConfig",void 0),$(this,"uapResponse",void 0),$(this,"lastTaskId",1),$(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(r){let i=$0($0({},qTt),r);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(B.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(d=>$0($0($0({},GTt),d),{},{zOrder:d.zOrder?d.zOrder+1:1}))),function(d){l_(d.width)||HE(d.width,"config.width",0,1e4),l_(d.height)||HE(d.height,"config.height",0,1e4),l_(d.videoBitrate)||HE(d.videoBitrate,"config.videoBitrate",1,1e6),l_(d.videoFrameRate)||HE(d.videoFrameRate,"config.videoFrameRate"),l_(d.lowLatency)||tI(d.lowLatency,"config.lowLatency"),l_(d.audioSampleRate)||j_(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),l_(d.audioBitrate)||HE(d.audioBitrate,"config.audioBitrate",1,128),l_(d.audioChannels)||j_(d.audioChannels,"config.audioChannels",[1,2,3,4,5]),l_(d.videoGop)||HE(d.videoGop,"config.videoGop"),l_(d.videoCodecProfile)||j_(d.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),l_(d.userCount)||HE(d.userCount,"config.userCount",0,17),l_(d.backgroundColor)||HE(d.backgroundColor,"config.backgroundColor",0,16777215),l_(d.userConfigExtraInfo)||_g(d.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),d.transcodingUsers&&!l_(d.transcodingUsers)&&(ZR(d.transcodingUsers,"config.transcodingUsers"),d.transcodingUsers.forEach((h,p)=>{mV(h.uid),l_(h.x)||HE(h.x,"transcodingUser[".concat(p,"].x"),0,1e4),l_(h.y)||HE(h.y,"transcodingUser[".concat(p,"].y"),0,1e4),l_(h.width)||HE(h.width,"transcodingUser[".concat(p,"].width"),0,1e4),l_(h.height)||HE(h.height,"transcodingUser[".concat(p,"].height"),0,1e4),l_(h.zOrder)||HE(h.zOrder-1,"transcodingUser[".concat(p,"].zOrder"),0,100),l_(h.alpha)||HE(h.alpha,"transcodingUser[".concat(p,"].alpha"),0,1,!1)})),l_(d.watermark)||T6(d.watermark,"watermark"),l_(d.backgroundImage)||T6(d.backgroundImage,"backgroundImage"),d.images&&!l_(d.images)&&(ZR(d.images,"config.images"),d.images.forEach((h,p)=>{T6(h,"images[".concat(p,"]"))}))}(i);let o=[];i.images&&o.push(...i.images.map(d=>$0($0($0({},S6),d),{},{zOrder:255}))),i.backgroundImage&&(o.push($0($0($0({},S6),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push($0($0($0({},S6),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(d=>$0({},d)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);let s=(i.userConfigs||[]).map(d=>typeof d.uid=="number"?eE.resolve(d.uid):Hst(d.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await eE.all(s)).forEach((d,h)=>{i.userConfigs&&i.userConfigs[h]&&(i.userConfigs[h].uid=d)}),this.transcodingConfig=i,this.connection)try{var l;let d=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(eI(l=this.streamingTasks).call(l)).map(h=>h.taskId).join("#")});B.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(d.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(d){if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(h=>{B.warning("[".concat(this.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,d).then(()=>{B.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(h.url," success"))}).catch(p=>{B.error("[".concat(this.spec.clientId,"] live streaming republish failed"),h.url,p.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,p)})})}}async startLiveStreamingTask(r,i,o){if(!this.transcodingConfig&&i===ER.TRANSCODE)throw new _a(Vt.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let s={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};B.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));let l=await this.taskMutex.lock();if(!this.connection&&o)return void l();if(this.streamingTasks.get(r)&&!o)return l(),new _a(Vt.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(h){throw l(),h}switch(i){case ER.TRANSCODE:s.transcodingConfig=$0({},this.transcodingConfig);case ER.RAW:}this.uapResponse&&this.uapResponse.vid&&(s.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let d=this.lastTaskId++;try{let h=new eE((f,_)=>{_y(this.retryTimeout).then(()=>{if(o)return _(o);let g=this.statusError.get(r);return g?(this.statusError.delete(r),_(g)):void 0})}),p=await eE.race([this.connection.request("request",{clientRequest:s},!0,{url:r,command:"PublishStream",workerType:i===ER.TRANSCODE?1:2,requestByUser:!o,tid:d.toString()}),h]);this.isStartingStreamingTask=!1,B.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(p.code)),this.streamingTasks.set(r,{clientRequest:s,mode:i,url:r,taskId:d}),l()}catch(h){if(l(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||o)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,i,h)):await this.startLiveStreamingTask(r,i,h)}}stopLiveStreamingTask(r){return new eE((i,o)=>{let s=this.streamingTasks.get(r);if(!s||!this.connection)return new _a(Vt.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let l=s.mode;s.abortTask=()=>{B.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:s.url}},!1,{url:r,command:"UnPublishStream",workerType:l===ER.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{B.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(d.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(o)})}resetAllTask(){var r;let i=Array.from(eI(r=this.streamingTasks).call(r));this.terminate();for(let o of i)this.startLiveStreamingTask(o.url,o.mode).catch(s=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,s)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=K0.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new _a(Vt.UNEXPECTED_ERROR,"live streaming connection has already connected");let i=await c0(this,I8.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=i,this.connection=new aW(i.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(jI.WARNING,(o,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,o)),this.connection.on(jI.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(jI.REQUEST_NEW_ADDRESS,(o,s)=>{if(!this.connection)return s(new _a(Vt.UNEXPECTED_ERROR,"can not get new live streaming address list"));c0(this,I8.REQUEST_WORKER_MANAGER_LIST,r).then(l=>{this.uapResponse=l,o(l.addressList)}).catch(s)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(r){let i=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),s=r.reason;switch(r.code){case P_.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case P_.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case P_.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case P_.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let d=new _a(Vt.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return B.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,d);if(!this.isStartingStreamingTask)return;this.statusError.set(i,d)}case P_.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let d=new _a(Vt.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,d)}case P_.LIVE_STREAM_RESPONSE_WORKER_LOST:case P_.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var l;if(!this.connection)return;this.connection.tryNextAddress();let d=Array.from(eI(l=this.streamingTasks).call(l));for(let h of d)h.abortTask?h.abortTask():(B.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",h.url),this.startLiveStreamingTask(h.url,h.mode,new _a(Vt.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{B.debug("[".concat(this.spec.clientId,"] republish live stream success"),h.url)}).catch(p=>{B.error(p.toString()),this.onLiveStreamError&&this.onLiveStreamError(h.url,p)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}},TIt={name:"LiveStreaming",create:function(e){return new cW(e.joinInfo,e.websocketRetryConfig||N_,e.httpRetryConfig||N_)}};function bIt(e){let r=Hnt();return function(i,o){let s=i.appId;s!==void 0&&(BE(o,10),mR(o,s));let l=i.cid;l!==void 0&&(BE(o,16),BE(o,l));let d=i.cname;d!==void 0&&(BE(o,26),mR(o,d));let h=i.deviceId;h!==void 0&&(BE(o,34),mR(o,h));let p=i.elapse;p!==void 0&&(BE(o,40),UI(o,p));let f=i.fileSize;f!==void 0&&(BE(o,48),UI(o,i1(f)));let _=i.height;_!==void 0&&(BE(o,56),UI(o,i1(_)));let g=i.jpg;g!==void 0&&(BE(o,66),BE(o,g.length),function(vf,Fi){let Gi=oP(vf,Fi.length);vf.bytes.set(Fi,Gi)}(o,g));let b=i.networkType;b!==void 0&&(BE(o,72),UI(o,i1(b)));let C=i.osType;C!==void 0&&(BE(o,80),UI(o,i1(C)));let k=i.requestId;k!==void 0&&(BE(o,90),mR(o,k));let A=i.sdkVersion;A!==void 0&&(BE(o,98),mR(o,A));let P=i.sequence;P!==void 0&&(BE(o,104),UI(o,i1(P)));let x=i.sid;x!==void 0&&(BE(o,114),mR(o,x));let j=i.timestamp;j!==void 0&&(BE(o,120),UI(o,j));let z=i.uid;z!==void 0&&(BE(o,128),BE(o,z));let _t=i.vid;_t!==void 0&&(BE(o,136),BE(o,_t));let ue=i.width;ue!==void 0&&(BE(o,144),UI(o,i1(ue)));let _n=i.service;_n!==void 0&&(BE(o,152),BE(o,_n));let Ei=i.callbackData;Ei!==void 0&&(BE(o,162),mR(o,Ei));let _s=i.jpgEncryption;_s!==void 0&&(BE(o,168),BE(o,_s));let kc=i.requestType;kc!==void 0&&(BE(o,176),BE(o,kc));let _i=i.scorePorn;_i!==void 0&&(BE(o,185),I5(o,_i));let _h=i.scoreSexy;_h!==void 0&&(BE(o,193),I5(o,_h));let _p=i.scoreNeutral;_p!==void 0&&(BE(o,201),I5(o,_p));let Qm=i.scene;Qm!==void 0&&(BE(o,208),BE(o,Qm));let _o=i.ossFilePrefix;_o!==void 0&&(BE(o,218),mR(o,_o));let ga=i.serviceVendor;if(ga!==void 0)for(let vf of ga){BE(o,226);let Fi=Hnt();IIt(vf,Fi),BE(o,Fi.limit),NIt(o,Fi),OIt(Fi)}}(e,r),function(i){let o=i.bytes,s=i.limit;return o.length===s?o:o.subarray(0,s)}(r)}function RIt(e){return function(i){let o={};t:for(;!xat(i);){let s=yR(i);switch(s>>>3){case 0:break t;case 1:o.code=yR(i);break;case 2:o.msg=jat(i,yR(i));break;case 3:{let l=CIt(i);o.data=wIt(i),i.limit=l;break}default:Mat(i,7&s)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function wIt(e){let r={};t:for(;!xat(e);){let i=yR(e);switch(i>>>3){case 0:break t;case 1:r.requestId=jat(e,yR(e));break;case 2:r.requestType=yR(e)>>>0;break;case 3:r.scorePorn=w5(e);break;case 4:r.scoreSexy=w5(e);break;case 5:r.scoreNeutral=w5(e);break;case 6:r.requestScene=yR(e)>>>0;break;case 7:r.scene=yR(e)>>>0;break;default:Mat(e,7&i)}}return r}function IIt(e,r){let i=e.service;i!==void 0&&(BE(r,8),BE(r,i));let o=e.vendor;o!==void 0&&(BE(r,16),BE(r,o));let s=e.token;s!==void 0&&(BE(r,26),mR(r,s));let l=e.callbackUrl;l!==void 0&&(BE(r,34),mR(r,l))}function CIt(e){let r=yR(e),i=e.limit;return e.limit=e.offset+r,i}function Mat(e,r){switch(r){case 0:for(;128&Vat(e););break;case 2:R5(e,yR(e));break;case 5:R5(e,4);break;case 1:R5(e,8);break;default:throw new Error("Unimplemented type: "+r)}}var AIt=new Float32Array(1);new Uint8Array(AIt.buffer);var vH=new Float64Array(1),eS=new Uint8Array(vH.buffer);function i1(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var Uat=[];function Hnt(){let e=Uat.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function OIt(e){Uat.push(e)}function R5(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function xat(e){return e.offset>=e.limit}function oP(e,r){let i=e.bytes,o=e.offset,s=e.limit,l=o+r;if(l>i.length){let d=new Uint8Array(2*l);d.set(i),e.bytes=d}return e.offset=l,l>s&&(e.limit=l),o}function yH(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function jat(e,r){let i=yH(e,r),o=String.fromCharCode,s=e.bytes,l="\uFFFD",d="";for(let h=0;h<r;h++){let p,f,_,g,b=s[h+i];128&b?(224&b)==192?h+1>=r?d+=l:(p=s[h+i+1],(192&p)!=128?d+=l:(g=(31&b)<<6|63&p,g<128?d+=l:(d+=o(g),h++))):(240&b)==224?h+2>=r?d+=l:(p=s[h+i+1],f=s[h+i+2],(49344&(p|f<<8))!=32896?d+=l:(g=(15&b)<<12|(63&p)<<6|63&f,g<2048||g>=55296&&g<=57343?d+=l:(d+=o(g),h+=2))):(248&b)==240?h+3>=r?d+=l:(p=s[h+i+1],f=s[h+i+2],_=s[h+i+3],(12632256&(p|f<<8|_<<16))!=8421504?d+=l:(g=(7&b)<<18|(63&p)<<12|(63&f)<<6|63&_,g<65536||g>1114111?d+=l:(g-=65536,d+=o(55296+(g>>10),56320+(1023&g)),h+=3))):d+=l:d+=o(b)}return d}function mR(e,r){let i=r.length,o=0;for(let d=0;d<i;d++){let h=r.charCodeAt(d);h>=55296&&h<=56319&&d+1<i&&(h=(h<<10)+r.charCodeAt(++d)-56613888),o+=h<128?1:h<2048?2:h<65536?3:4}BE(e,o);let s=oP(e,o),l=e.bytes;for(let d=0;d<i;d++){let h=r.charCodeAt(d);h>=55296&&h<=56319&&d+1<i&&(h=(h<<10)+r.charCodeAt(++d)-56613888),h<128?l[s++]=h:(h<2048?l[s++]=h>>6&31|192:(h<65536?l[s++]=h>>12&15|224:(l[s++]=h>>18&7|240,l[s++]=h>>12&63|128),l[s++]=h>>6&63|128),l[s++]=63&h|128)}}function NIt(e,r){let i=oP(e,r.limit),o=e.bytes,s=r.bytes;for(let l=0,d=r.limit;l<d;l++)o[l+i]=s[l]}function Vat(e){return e.bytes[yH(e,1)]}function Knt(e,r){let i=oP(e,1);e.bytes[i]=r}function w5(e){let r=yH(e,8),i=e.bytes;return eS[0]=i[r++],eS[1]=i[r++],eS[2]=i[r++],eS[3]=i[r++],eS[4]=i[r++],eS[5]=i[r++],eS[6]=i[r++],eS[7]=i[r++],vH[0]}function I5(e,r){let i=oP(e,8),o=e.bytes;vH[0]=r,o[i++]=eS[0],o[i++]=eS[1],o[i++]=eS[2],o[i++]=eS[3],o[i++]=eS[4],o[i++]=eS[5],o[i++]=eS[6],o[i++]=eS[7]}function yR(e){let r,i=0,o=0;do r=Vat(e),i<32&&(o|=(127&r)<<i),i+=7;while(128&r);return o}function BE(e,r){for(r>>>=0;r>=128;)Knt(e,127&r|128),r>>>=7;Knt(e,r)}function UI(e,r){let i=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,s=r.high>>>24,l=s===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:s<128?9:10,d=oP(e,l),h=e.bytes;switch(l){case 10:h[d+9]=s>>>7&1;case 9:h[d+8]=l!==9?128|s:127&s;case 8:h[d+7]=l!==8?o>>>21|128:o>>>21&127;case 7:h[d+6]=l!==7?o>>>14|128:o>>>14&127;case 6:h[d+5]=l!==6?o>>>7|128:o>>>7&127;case 5:h[d+4]=l!==5?128|o:127&o;case 4:h[d+3]=l!==4?i>>>21|128:i>>>21&127;case 3:h[d+2]=l!==3?i>>>14|128:i>>>14&127;case 2:h[d+1]=l!==2?i>>>7|128:i>>>7&127;case 1:h[d]=l!==1?128|i:127&i}}function znt(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),i.push.apply(i,o)}return i}var kIt=new Map([["moderation",1],["supervise",2]]);function Ynt(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}var uW=class extends s_{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;let i=this._connectionState;this._connectionState=r,this.emit(J_.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=QT(i=r.map(o=>kIt.get(o)||0)).call(i,(o,s)=>o+s),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),$(this,"name","AgoraRTCVideoContentInspect"),$(this,"_connectionState",mT.CONNECTING),$(this,"_innerConnectionState",void 0),$(this,"sequence",0),$(this,"inspectStartTime",void 0),$(this,"workerManagerConnection",void 0),$(this,"workerConnection",void 0),$(this,"workerMessageLengthLimit",void 0),$(this,"inspectIntervalMinimum",void 0),$(this,"qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",K0.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"wmSequence",0),$(this,"inspectInterval",void 0),$(this,"inspectTimer",null),$(this,"ossFilePrefix",void 0),$(this,"extraInfo",void 0),$(this,"_inspectType",void 0),$(this,"_inspectMode",void 0),$(this,"_quality",1),$(this,"qualityTimer",null),$(this,"_inspectId",void 0),$(this,"_needWorkUrlOnly",!1),$(this,"inspectImage",()=>{if(this.connectionState!==mT.CONNECTED)throw new _a(Vt.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===mT.CONNECTED?this.requestToInspectImage():B.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ZE(5,"inspect-"),this.workerMessageLengthLimit=_r("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=_r("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=_r("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new eN("worker-manager-"+this._inspectId,N_),this.on(J_.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,B.debug("[".concat(this._inspectId,"] Inspect operation :").concat(uT[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new eN("worker-"+this._inspectId,N_),this.handleWorkerEvents()}async init(r,i){this.emit(J_.STATE_CHANGE,uT.CONNECT_AP),this._connectInfo=r;let o=this._cancelTokenSource.token;return this._retryConfig=i,new eE((s,l)=>{this.on(J_.CONNECTION_STATE_CHANGE,(d,h)=>{h===mT.CONNECTED&&s()}),this.requestAP(r,o,i).then(d=>{this.connectWorkerManager(d)}).catch(d=>{l(d)})})}async requestAP(r,i,o){let s=_r("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),l=await function(h,p,f,_){let{appId:g,areaCode:b,cname:C,sid:k,token:A,uid:P}=p;A1++;let x="image_moderation_api",j={service_name:x,json_body:JSON.stringify({appId:g,areaCode:b,cname:C,command:"allocateEdge",requestId:A1,seq:A1,sid:k,token:A,ts:Date.now(),uid:P+""})},z,_t,ue=h[0];return $T(async()=>{z=Date.now();let _n=await _b(ue,{data:j,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_t=Date.now()-z,_n.code!==0){let _i=new _a(Vt.UNEXPECTED_RESPONSE,"image inspect ap error, code"+_n.code,{retry:!0,responseTime:_t});throw B.error(_i.toString()),_i}let Ei=JSON.parse(_n.json_body);if(Ei.code!==200){let _i=new _a(Vt.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ei.code,", reason: ").concat(Ei.reason),{code:Ei.code,responseTime:_t});throw B.error(_i.toString()),_i}if(!Ei.servers||!Array.isArray(Ei.servers)||Ei.servers.length===0){let _i=new _a(Vt.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ei.code,responseTime:_t});throw B.error(_i.toString()),_i}let _s=_r("VIDEO_INSPECT_WORKER_MANAGER_HOST"),kc=_r("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ei.servers.map(_i=>{let{address:_h,wss:_p}=_i;if(_h&&_p)return"wss://".concat(_h.replace(/\./g,"-"),".").concat(_s,":").concat(kc||_p)}).filter(_i=>!!_i),workerToken:Ei.workerToken,vid:Ei.vid,responseTime:_t}},(_n,Ei)=>(aE.apworkerEvent(k,{success:!0,sc:200,serviceName:x,responseDetail:JSON.stringify(_n.addressList),firstSuccess:Ei===0,responseTime:_t,serverIp:h[Ei%h.length]}),!1),(_n,Ei)=>(aE.apworkerEvent(k,{success:!1,sc:_n.data&&_n.data.code||200,serviceName:x,responseTime:_t,serverIp:h[Ei%h.length]}),!!(_n.code!==Vt.OPERATION_ABORTED&&_n.code!==Vt.UNEXPECTED_RESPONSE||_n.data&&_n.data.retry)&&(ue=h[(Ei+1)%h.length],!0)),_)}(s,r,i,o);this.emit(J_.STATE_CHANGE,uT.AP_CONNECTED);let{addressList:d}=l;return this.wmSequence++,d}async connectWorkerManager(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(J_.STATE_CHANGE,uT.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(_E.CONNECTED,async()=>{this.emit(J_.STATE_CHANGE,uT.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(_E.CLOSED,()=>{this._innerConnectionState<uT.GET_WORKER_MANAGER_RESPONSE&&B.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(_E.FAILED,()=>{this._innerConnectionState<uT.GET_WORKER_MANAGER_RESPONSE&&B.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(_E.RECONNECTING,()=>{this._innerConnectionState<uT.GET_WORKER_MANAGER_RESPONSE&&B.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(_E.ON_MESSAGE,async r=>{this.emit(J_.STATE_CHANGE,uT.GET_WORKER_MANAGER_RESPONSE);let i=this.workerManagerConnection.url;this.workerManagerConnection.close();let o=JSON.parse(r.data);if(o.code!==200)throw B.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new _a(Vt.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw B.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new _a(Vt.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{let s=_r("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,l=i.replace(/:\d+\/?$/,":".concat(s));this.emit(J_.STATE_CHANGE,uT.CONNECT_WORKER,l),this._needWorkUrlOnly?this.emit(J_.REQUEST_NEW_WORKER_URL,l):await this.connectWorker(l)}}),this.workerManagerConnection.on(_E.WILL_RECONNECT,(r,i,o)=>{o(r)}),this.workerManagerConnection.on(_E.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}handleWorkerEvents(){this.workerConnection.on(_E.CONNECTED,async()=>{this.emit(J_.STATE_CHANGE,uT.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=mT.CONNECTED}),this.workerConnection.on(_E.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){let o=RIt(new Uint8Array(r.data));if(_r("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&B.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(J_.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;let s={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},l=QT(i=Object.keys(s)).call(i,(h,p)=>s[h]>s[p]?h:p,"porn"),d=Object.keys(s).find(h=>h===l);this.emit(J_.INSPECT_RESULT,d)}else this.emit(J_.INSPECT_RESULT,void 0,new _a(Vt.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(J_.INSPECT_RESULT,void 0,new _a(Vt.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else B.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(J_.INSPECT_RESULT,void 0,new _a(Vt.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(_E.CLOSED,()=>{this.connectionState=mT.CLOSED}),this.workerConnection.on(_E.FAILED,()=>{this.connectionState=mT.CLOSED}),this.workerConnection.on(_E.RECONNECTING,()=>{this.connectionState=this.connectionState===mT.CONNECTED?mT.RECONNECTING:mT.CONNECTING}),this.workerConnection.on(_E.WILL_RECONNECT,(r,i,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(_E.REQUEST_NEW_URLS,(r,i)=>{this.workerManagerConnection.close(),this.once(J_.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}async requestToInspectImage(){this.sequence++;let r=JS(this,J_.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(J_.INSPECT_RESULT,void 0,new _a(Vt.INVALID_OPERATION,"Only the track being played can be inspected"));let o=await this.generateRequestData(r,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(J_.INSPECT_RESULT,void 0,new _a(Vt.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,i){let{appId:o,cname:s,cid:l,vid:d,sid:h,uid:p}=i,f=Date.now(),_=await r.getCurrentFrameImage("image/jpeg",this.quality),g=await Nst(_,o,s),b=this.sequence+"-"+l+"-"+p+"-"+f+"-"+ZE(12,""),C={appId:o,cid:l,cname:s,deviceId:"",elapse:Ynt(Number(f-this.inspectStartTime)),fileSize:g.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:g,networkType:6,osType:7,requestId:b,sdkVersion:"4.22.1",sequence:this.sequence,sid:h,timestamp:Ynt(f),uid:p,vid:d,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete C.callbackData,this.ossFilePrefix===void 0&&delete C.ossFilePrefix;let k=bIt(C);if(k.byteLength<this.workerMessageLengthLimit){if(_r("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let A=function(P){for(var x=1;x<arguments.length;x++){var j=arguments[x]!=null?arguments[x]:{};x%2?znt(Object(j),!0).forEach(function(z){$(P,z,j[z])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(j)):znt(Object(j)).forEach(function(z){Object.defineProperty(P,z,Object.getOwnPropertyDescriptor(j,z))})}return P}({},C);delete A.jpg,B.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(A))}return k}{let A=this.quality*this.qualityRatio;return this.quality=A,await this.generateRequestData(r,{appId:o,cname:s,cid:l,vid:d,sid:h,uid:p})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=K0.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=mT.CLOSED,this.emit(J_.STATE_CHANGE,uT.CLOSED)}},PIt={name:"ContentInspect",create:function(e){let{config:r}=e;return function(i){if(!i)throw new _a(Vt.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new _a(Vt.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let o=[...new Set(i.inspectType)];o.forEach(s=>{var l;if(!nE(l=["supervise","moderation"]).call(l,s))throw new _a(Vt.INVALID_PARAMS,"".concat(s," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new _a(Vt.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new uW(r)}};WE("PROCESS_ID","process-".concat(ZE(8,""),"-").concat(ZE(4,""),"-").concat(ZE(4,""),"-").concat(ZE(4,""),"-").concat(ZE(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void B.error("Error loading sdk config",r.message)}if(e)try{let r=JSON.parse(window.atob(e)),i=Date.now();B.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(y_,o)){let{value:s,expires:l}=r[o];if(l&&l<=i)return;BI[o]=s,y_[o]=s}})}catch(r){B.error("Error loading mutableParamsCache: ".concat(e),r.message)}}(),Array.isArray(BI.AREAS)&&BI.AREAS.length>0&&hH(BI.AREAS,!0);var Jnt=(e,r,i)=>{B.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(r))),WE(e,r,i)};OD(SIt,!1),OD(TIt,!1),OD(cwt,!1),OD(PIt,!1),OD(yIt,!1);var g_=function(e){let r=new s_,i=e,o={getListeners:r.getListeners.bind(r),on:(s,l)=>(function(d,h){d===_R.SECURITY_POLICY_VIOLATION&&hat(h,!0)}(s,l),r.on.bind(r)(s,l)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return Tnt(Tnt({},i),o)}({__TRACK_LIST__:c1,VERSION:XS,BUILD:eH,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:Jnt,getParameter:_r,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let r=new RTCPeerConnection,i=await async function(o){let s;return ME().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),s=(await o.createOffer()).sdp):s=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,s}(r);if(!i)return e;r.close(),r=null,e=function(o){let s={video:[],audio:[]};return o.match(/ VP8/i)&&s.video.push("VP8"),o.match(/ VP9/i)&&s.video.push("VP9"),o.match(/ AV1/i)&&s.video.push("AV1"),o.match(/ H264/i)&&s.video.push("H264"),o.match(/ H265/i)&&s.video.push("H265"),o.match(/ opus/i)&&s.audio.push("OPUS"),o.match(/ PCMU/i)&&s.audio.push("PCMU"),o.match(/ PCMA/i)&&s.audio.push("PCMA"),o.match(/ G722/i)&&s.audio.push("G722"),s}(i)}catch(r){throw new _a(Vt.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return e},checkSystemRequirements:function(){let e=aE.reportApiInvoke(null,{name:L_.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:p_.TRACER}),r=!1;try{let l=window.RTCPeerConnection,d=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,h=window.WebSocket;r=!!(l&&d&&h),r&&XW()&&Yot(75)&&new l().close()}catch(l){return B.error("check system requirement failed: ",l),!1}let i=!1,o=DE();o.name===FE.CHROME&&Number(o.version)>=58&&(YT.engine.name!=="WebKit"||function(){let l=DE();if(n3()){if(l.os===W_.MAC_OS)return!0;if(l.os===W_.IOS){let d=YT.os.version&&YT.os.version.split(".");if(d&&Number(d[0])===14&&d[1]&&Number(d[1])>=3||d&&Number(d[0])>14)return!0}}return!1}())&&(i=!0),(o.name===FE.FIREFOX&&Number(o.version)>=56||o.name===FE.OPERA&&Number(o.version)>=45||o.name===FE.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(U0()||wT())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||Zot()||DE().name===FE.QQ)&&(i=!0),B.debug("checkSystemRequirements, api:",r,"browser",i);let s=r&&i;return e.onSuccess(s),s},getDevices:function(e){return NS.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return NS.getRecordingDevices(e)},getCameras:function(e){return NS.getCamerasDevices(e)},getElectronScreenSources:Rst,getPlaybackDevices:function(e){return NS.getSpeakers(e)},createClient:function(){var e;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},i=aE.reportApiInvoke(null,{name:L_.CREATE_CLIENT,options:[r],tag:p_.TRACER});try{(function(o){j_(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),j_(o.mode,"config.mode",["rtc","live","p2p"]),o.audioCodec!==void 0&&j_(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&_g(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&rst(o.turnServer),o.httpRetryConfig!==void 0&&GQ(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&GQ(o.websocketRetryConfig)})(r)}catch(o){throw i.onError(o),o}return(Xot(16,0,!0)||Qot(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",B.debug("browser not support vp9, force use vp8")),WE("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),i.onSuccess(),new uwt(vT(vT({forceWaitGatewayResponse:!0},r),{},{role:nE(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=_r("CAMERA_CAPTURE_CONFIG"),i=aE.reportApiInvoke(null,{tag:p_.TRACER,name:L_.CREATE_CAM_VIDEO_TRACK,options:[o_({},e),r]});r&&(e.encoderConfig=r);let o=g3(e),s=ZE(8,"track-cam-"),l=null;B.info("start create camera video track with config",JSON.stringify(e),"trackId",s);try{l=(await IS({video:o},s)).getVideoTracks()[0]||null}catch(h){throw i.onError(h),h}if(!l){let h=new _u(Vt.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(B)}e.optimizationMode&&z6(s,l,e,TR(e.encoderConfig));let d=new j8(l,e,o,e.scalabiltyMode?ZM(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);return i.onSuccess(d.getTrackId()),B.info("create camera video success, trackId:",s),d},createCustomVideoTrack:function(e){let r=aE.reportApiInvoke(null,{tag:p_.TRACER,name:L_.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),i=new e_(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?ZM(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,ZE(8,"track-cus-"),[XE.CUSTOM_TRACK]);return r.onSuccess(i.getTrackId()),B.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",i=aE.reportApiInvoke(null,{tag:p_.TRACER,name:L_.CREATE_SCREEN_VIDEO_TRACK,options:[o_({},e),r]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let o=function(_){let g={};_.screenSourceType&&(g.mediaSource=_.screenSourceType),_.extensionId&&zI()&&(g.extensionId=_.extensionId);let{displaySurface:b,selfBrowserSurface:C,surfaceSwitching:k,systemAudio:A}=_;(_8(107)||UQ(107)||xQ(93))&&(b&&(j_(b,"displaySurface",["browser","window","monitor"]),g.displaySurface=b),C?(j_(C,"selfBrowserSurface",["exclude","include"]),g.selfBrowserSurface=C):g.selfBrowserSurface="include",k&&(j_(k,"surfaceSwitching",["exclude","include"]),g.surfaceSwitching=k)),(_8(105)||UQ(105)||xQ(91))&&A&&(j_(A,"systemAudio",["exclude","include"]),g.systemAudio=A),_.electronScreenSourceId&&(g.sourceId=_.electronScreenSourceId);let P=_.encoderConfig?q6(_.encoderConfig):null;return g.mandatory={chromeMediaSource:"desktop",maxWidth:P?P.width:void 0,maxHeight:P?P.height:void 0},P&&(P.frameRate&&(typeof P.frameRate=="number"?(g.mandatory.maxFrameRate=P.frameRate,g.mandatory.minFrameRate=P.frameRate):(g.mandatory.maxFrameRate=P.frameRate.max||P.frameRate.ideal||P.frameRate.exact||void 0,g.mandatory.minFrameRate=P.frameRate.min||P.frameRate.ideal||P.frameRate.exact||void 0),g.frameRate=P.frameRate),P.width&&(g.width=P.width),P.height&&(g.height=P.height)),g}(e),s=ZE(8,"track-scr-v-"),l=null,d=null,h=ME();if(!h.supportShareAudio&&r==="enable"){let _=new _u(Vt.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(_),_.throw(B)}B.info("start create screen video track with config",e,"withAudio",r,"trackId",s);try{let _=await IS({screen:o,screenAudio:r==="auto"?h.supportShareAudio:r==="enable"},s);l=_.getVideoTracks()[0]||null,d=_.getAudioTracks()[0]||null}catch(_){throw i.onError(_),_}if(!l){let _=new _u(Vt.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(_),_.throw(B)}if(!d&&r==="enable"){l&&l.stop();let _=new _u(Vt.SHARE_AUDIO_NOT_ALLOWED);return i.onError(_),_.throw(B)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(z6(s,l,e,e.encoderConfig&&q6(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let p=new e_(l,e.encoderConfig?q6(e.encoderConfig):{},e.scalabiltyMode?ZM(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s,[XE.SCREEN_TRACK]);if(!d)return i.onSuccess(p.getTrackId()),B.info("create screen video track success","video:",p.getTrackId()),p;let f=new h_(d,void 0,ZE(8,"track-scr-a-"),!1);return i.onSuccess([p.getTrackId(),f.getTrackId()]),B.info("create screen video track success","video:",p.getTrackId(),"audio:",f.getTrackId()),[p,f]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=_r("CAMERA_CAPTURE_CONFIG"),o=aE.reportApiInvoke(null,{tag:p_.TRACER,name:L_.CREATE_MIC_AND_CAM_TRACKS,options:[e,r,i]});i&&(r.encoderConfig=i);let s=g3(r),l=qZ(e),d=ZE(8,"track-mic-"),h=ZE(8,"track-cam-"),p=null,f=null;B.info("start create camera video track(".concat(h,") and microphone audio track(").concat(d,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(r)));try{let b=await IS({audio:l,video:s},"".concat(d,"-").concat(h));p=b.getAudioTracks()[0],f=b.getVideoTracks()[0]}catch(b){throw o.onError(b),b}if(!p||!f){let b=new _u(Vt.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(b),b.throw(B)}r.optimizationMode&&z6(h,f,r,TR(r.encoderConfig));let _=new v3(p,e,l,d),g=new j8(f,r,s,r.scalabiltyMode?ZM(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,h);return o.onSuccess([_.getTrackId(),g.getTrackId()]),B.info("create camera video track(".concat(h,") and microphone audio track(").concat(d,") success")),[_,g]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=aE.reportApiInvoke(null,{tag:p_.TRACER,name:L_.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=qZ(e),o=ZE(8,"track-mic-"),s=null;B.info("start create microphone audio track with config",JSON.stringify(e),"trackId",o);try{s=(await IS({audio:i},o)).getAudioTracks()[0]||null}catch(d){throw r.onError(d),d}if(!s){let d=new _u(Vt.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(d),d.throw(B)}let l=new v3(s,e,i,o);return r.onSuccess(l.getTrackId()),B.info("create microphone audio track success, trackId:",o),l},createCustomAudioTrack:function(e){let r=aE.reportApiInvoke(null,{tag:p_.TRACER,name:L_.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new h_(e.mediaStreamTrack,e.encoderConfig?u3(e.encoderConfig):{},ZE(8,"track-cus-"),!1);return B.info("create custom audio track success with config",e,"trackId",i.getTrackId()),r.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var r;let{cacheOnlineFile:i,encoderConfig:o}=e,{source:s}=e,l={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":s,cacheOnlineFile:i,encoderConfig:o},d=aE.reportApiInvoke(null,{tag:p_.TRACER,name:L_.CREATE_BUFFER_AUDIO_TRACK,options:[l]});if(_r("DISABLE_WEBAUDIO"))throw new _u(Vt.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");let h=ZE(8,"track-buf-");B.info("start create buffer source audio track with config",JSON.stringify(l),"trackId",h);let p=s;if(!(s instanceof AudioBuffer))try{s=await async function(g,b){let C=null;if(typeof g=="string"){let A=C$.get(g);if(A)return B.debug("use cached audio resource: ",g),A;try{C=(await $T(()=>K0.get(g,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(P){throw new _u(Vt.FETCH_AUDIO_FILE_FAILED,P.toString())}}else C=await new eE((P,x)=>{let j=new FileReader;j.onload=z=>{z.target?P(z.target.result):x(new _u(Vt.READ_LOCAL_AUDIO_FILE_ERROR))},j.onerror=()=>{x(new _u(Vt.READ_LOCAL_AUDIO_FILE_ERROR))},j.readAsArrayBuffer(g)});let k=await function(A){let P=eP();return new eE((x,j)=>{P.decodeAudioData(A,z=>{x(z)},z=>{j(new _u(Vt.DECODE_AUDIO_FILE_FAILED,z.toString()))})})}(C);return typeof g=="string"&&b&&C$.set(g,k),k}(s,i)}catch(g){return d.onError(g),g.throw(B)}let f=new x8(s),_=new yRt(p,f,o?u3(o):{},h);return B.info("create buffer source audio track success, trackId:",h),d.onSuccess(_.getTrackId()),_},setAppType:function(e){if(B.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw B.debug("Invalid appType"),new _a(Vt.INVALID_PARAMS,"invalid app type",e);WE("APP_TYPE",Math.floor(e))},setLogLevel:function(e){B.setLogLevel(e)},enableLogUpload:function(){_r("USE_NEW_LOG")?WE("UPLOAD_LOG",!0):B.enableLogUpload()},disableLogUpload:function(){_r("USE_NEW_LOG")?WE("UPLOAD_LOG",!1):B.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new N3},checkAudioTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=aE.reportApiInvoke(null,{tag:p_.TRACER,name:L_.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof h_||e instanceof C1)){let p=new _a(Vt.INVALID_TRACK,"the parameter is not a audio track");return i.onError(p),p.throw()}r&&r<1e3&&(r=1e3);let o=e instanceof h_?e.getTrackLabel():"remote_track",s=e.getVolumeLevel(),l=s,d=s,h=Date.now();return new eE(p=>{let f=setInterval(()=>{let _=e.getVolumeLevel();l=_>l?_:l,d=_<d?_:d;let g=l-d>1e-4,b=Date.now()-h;if(g||b>r){clearInterval(f);let C=g,k={duration:b,deviceLabel:o,maxVolumeLevel:l,result:C};B.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(k))),i.onSuccess(k),p(C)}},200)})},checkVideoTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,i=aE.reportApiInvoke(null,{tag:p_.TRACER,name:L_.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof e_||e instanceof I1)){let g=new _a(Vt.INVALID_TRACK,"the parameter is not a video track");return i.onError(g),g.throw()}r&&r<1e3&&(r=1e3);let o=e instanceof e_?e.getTrackLabel():"remote_track",s=e.getMediaStreamTrack(!0),l=document.createElement("video");l.style.width="1px",l.style.height="1px",l.setAttribute("muted",""),l.muted=!0,l.setAttribute("playsinline",""),l.controls=!1,(a0()||n3())&&(l.style.opacity="0.01",l.style.position="fixed",l.style.left="0",l.style.top="0",document.body.appendChild(l)),l.srcObject=new MediaStream([s]),l.play();let d=document.createElement("canvas");d.width=160,d.height=120;let h=0,p=0;try{let g=Date.now();h=await function(b,C,k,A){let P,x=0,j=null;return new eE((z,_t)=>{function ue(){x>A&&P&&(P(),z(x));let _n=k.getContext("2d");if(!_n){let kc=new _a(Vt.UNEXPECTED_ERROR,"can not get canvas 2d context.");return B.error(kc.toString()),void _t(kc)}_n.drawImage(b,0,0,160,120);let Ei=_n.getImageData(0,0,k.width,k.height),_s=Math.floor(Ei.data.length/3);if(j){for(let kc=0;kc<_s;kc+=3)if(Ei.data[kc]!==j[kc])return x+=1,void(j=Ei.data);j=Ei.data}else j=Ei.data}setTimeout(()=>{P&&(P(),z(x))},C),P=aH(()=>{ue()},30)})}(l,r,d,4),p=Date.now()-g}catch(g){throw i.onError(g),g}YRt===FE.SAFARI&&(l.pause(),l.remove()),l.srcObject=null;let f=h>4,_={duration:p,changedPicNum:h,deviceLabel:o,result:f};return B.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),i.onSuccess(_),f},setArea:hH,audioElementPlayCenter:H0,resumeAudioContext:function(){H0.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){dwt.processExternalMediaAEC(e)},registerExtensions:function(e){let r=_r("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!nE(r).call(r,i.name)&&r.push(i.name);let o=i;o.__registered__=!0,o.logger.hookLog=B.extLog,o.reporter.hookApiInvoke=aE.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(s=>{o.parameters[s]=_r(s)})}),Jnt("PLUGIN_INFO",r)},ChannelMediaRelayError:a1,ChannelMediaRelayEvent:zR,ChannelMediaRelayState:tS,RemoteStreamFallbackType:fRt,RemoteStreamType:pRt,ConnectionDisconnectedReason:GE,AudienceLatencyLevelType:QSt,AREAS:xE,preload:async function(e,r,i,o){return rat(e,r,i,o)}});Object.defineProperties(g_,{onAudioAutoplayFailed:{get:()=>bS.onAudioAutoplayFailed,set:e=>{bS.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>bS.onAutoplayFailed,set:e=>{bS.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>g_._onSecurityPolicyViolation,set(e){g_._onSecurityPolicyViolation=e,hat(e)}},__CLIENT_LIST__:{get:()=>_r("SHOW_GLOBAL_CLIENT_LIST")?MO:[]}}),NS.on(qO.CAMERA_DEVICE_CHANGED,e=>{B.info("camera device changed",JSON.stringify(e)),g_.onCameraChanged&&g_.onCameraChanged(e),g_.safeEmit(_R.CAMERA_CHANGED,e)}),NS.on(qO.RECORDING_DEVICE_CHANGED,e=>{B.info("microphone device changed",JSON.stringify(e)),g_.onMicrophoneChanged&&g_.onMicrophoneChanged(e),g_.safeEmit(_R.MICROPHONE_CHANGED,e)}),NS.on(qO.PLAYOUT_DEVICE_CHANGED,e=>{B.debug("playout device changed",JSON.stringify(e)),g_.onPlaybackDeviceChanged&&g_.onPlaybackDeviceChanged(e),g_.safeEmit(_R.PLAYBACK_DEVICE_CHANGED,e)}),H0.onAutoplayFailed=()=>{B.info("detect audio element autoplay failed"),bS.onAudioAutoplayFailed&&bS.onAudioAutoplayFailed()},qE.on("autoplay-failed",()=>{B.info("detect webaudio autoplay failed"),bS.onAudioAutoplayFailed&&bS.onAudioAutoplayFailed(),g_.safeEmit(_R.AUTOPLAY_FAILED)}),qE.on(Fg.STATE_CHANGE,(e,r)=>{B.info("audio context state changed: ".concat(r," => ").concat(e)),g_.onAudioContextStateChanged&&g_.onAudioContextStateChanged(e,r),g_.safeEmit(_R.AUDIO_CONTEXT_STATE_CHANGED,e,r)}),I_.on(m1.NETWORK_STATE_CHANGE,(e,r)=>{B.info("[network-indicator] network state changed, ".concat(r," => ").concat(e))}),window&&(window.__ARTC__=g_);function DIt(e,r){if(e==null)return{};var i={},o=Object.keys(e),s,l;for(l=0;l<o.length;l++)s=o[l],!(r.indexOf(s)>=0)&&(i[s]=e[s]);return i}var Fat;(function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"})(Fat||(Fat={}));var Bat=function(r){var i;function o(){return i||(i=g_.createClient(r)),i}return function(){return o()}};function Gat(e,r){var i=function(){try{return Promise.resolve(g_.createMicrophoneAndCameraTracks(e,r)).then(function(l){return o=l,o})}catch(l){return Promise.reject(l)}},o=null;return function(){var l=(0,OT.useState)(!1),d=l[0],h=l[1],p=(0,OT.useState)(null),f=p[0],_=p[1],g=(0,OT.useRef)(o);return(0,OT.useEffect)(function(){return g.current===null?i().then(function(b){g.current=b,h(!0)},function(b){_(b)}):h(!0),function(){o=null}},[]),{ready:d,tracks:g.current,error:f}}}var SH=function(r){var i=(0,OT.useRef)(null),o=r.videoTrack,s=r.config,l=DIt(r,["videoTrack","config"]);return(0,OT.useLayoutEffect)(function(){return i.current!==null&&o.play(i.current,s),function(){o.stop()}},[o]),OT.default.createElement("div",Object.assign({},l,{ref:i}))},SV=g_;var NT={};cct(NT,{createChannel:()=>MIt,createClient:()=>LIt,createLazyChannel:()=>RH,createLazyClient:()=>bH,default:()=>JL});var TV=lN(TH());tR(NT,lN(TH()));var LIt=function(r,i,o){var s;function l(){return s||(s=TV.default.createInstance(r,i,o)),s}return function(){return l()}},MIt=function(r){var i;function o(s){return i||(i=s.createChannel(r)),i}return function(s){return o(s)}},bH=function(){var r;function i(o,s,l){return r||(r=TV.default.createInstance(o,s,l)),r}return function(o,s,l){return i(o,s,l)}},RH=function(){var r;function i(o,s){return r||(r=o.createChannel(s)),r}return function(o,s){return i(o,s)}},qat;(function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"})(qat||(qat={}));var JL=TV.default;function A_(){return A_=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},A_.apply(this,arguments)}var hAt=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator",pAt=typeof Symbol<"u"?Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")):"@@asyncIterator";function Lb(e,r){try{var i=e()}catch(o){return r(o)}return i&&i.then?i.then(void 0,r):i}var kR=_c.default.createContext({}),UIt=kR.Provider,fAt=kR.Consumer,l0;(function(e){e[e.yes=0]="yes",e[e.subbed=1]="subbed",e[e.no=2]="no"})(l0||(l0={}));var cN;(function(e){e[e.grid=0]="grid",e[e.pin=1]="pin"})(cN||(cN={}));var H_;(function(e){e[e.disabled=0]="disabled",e[e.enabled=1]="enabled",e[e.disabling=2]="disabling",e[e.enabling=3]="enabling"})(H_||(H_={}));var xIt={rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}},v0=_c.default.createContext(xIt),jIt=v0.Provider,CV=_c.default.createContext([]),VIt=CV.Provider,FIt=CV.Consumer,AV=_c.default.createContext([]),BIt=AV.Provider,GIt=AV.Consumer,Xat=_c.default.createContext({}),qIt=Xat.Provider,IH={max:[{uid:0,hasAudio:l0.no,hasVideo:l0.no}],min:[],isScreensharing:!1},WIt=function(r,i){var o=IH,s=[].concat(r.max,r.min).map(function(f){return f.uid});switch(i.type){case"Screensharing":o=A_({},r,{isScreensharing:i.value[0]}),console.log("!Screensharingstate",r,o);break;case"update-user-video":o={min:r.min.map(function(f){return f.uid===0?{uid:0,hasAudio:l0.subbed,hasVideo:l0.subbed}:f}),max:r.max.map(function(f){return f.uid===0?{uid:0,hasAudio:l0.subbed,hasVideo:l0.subbed}:f}),isScreensharing:r.isScreensharing};break;case"user-joined":if(s.indexOf(i.value[0].uid)===-1){var l=[].concat(r.min,[{uid:i.value[0].uid,hasAudio:l0.no,hasVideo:l0.no}]);l.length===1&&r.max[0].uid===0?o={max:l,min:r.max,isScreensharing:r.isScreensharing}:o={min:l,max:r.max,isScreensharing:r.isScreensharing}}break;case"user-unpublished":if(r.max[0].uid===i.value[0].uid)o={max:[{uid:i.value[0].uid,hasAudio:i.value[1]==="audio"?l0.no:r.max[0].hasAudio,hasVideo:i.value[1]==="video"?l0.no:r.max[0].hasVideo}],min:r.min,isScreensharing:r.isScreensharing};else{var d=r.min.find(function(f){return f.uid===i.value[0].uid});if(d){var h=[].concat(r.min.filter(function(f){return f.uid!==i.value[0].uid}),[{uid:i.value[0].uid,hasAudio:i.value[1]==="audio"?l0.no:d.hasAudio,hasVideo:i.value[1]==="video"?l0.no:d.hasVideo}]);o={min:h,max:r.max,isScreensharing:r.isScreensharing}}}break;case"user-published":r.max[0].uid===i.value[0].uid?o={max:[{uid:i.value[0].uid,hasAudio:i.value[1]==="audio"?l0.subbed:r.max[0].hasAudio,hasVideo:i.value[1]==="video"?l0.subbed:r.max[0].hasVideo}],min:r.min,isScreensharing:r.isScreensharing}:o={min:r.min.map(function(f){return f.uid!==i.value[0].uid?f:{uid:f.uid,hasAudio:i.value[1]==="audio"?l0.subbed:f.hasAudio,hasVideo:i.value[1]==="video"?l0.subbed:f.hasVideo}}),max:r.max,isScreensharing:r.isScreensharing};break;case"user-left":if(r.max[0].uid===i.value[0].uid){var p=[].concat(r.min);o={max:[p.pop()],min:p,isScreensharing:r.isScreensharing}}else o={min:r.min.filter(function(f){return f.uid!==i.value[0].uid}),max:r.max,isScreensharing:r.isScreensharing};break;case"user-swap":r.max[0].uid===i.value[0].uid||(o={max:[i.value[0]],min:[].concat(r.min.filter(function(f){return f.uid!==i.value[0].uid}),[r.max[0]]),isScreensharing:r.isScreensharing});break;case"local-user-mute-video":o={min:r.min.map(function(f){return f.uid===0?{uid:0,hasAudio:f.hasAudio,hasVideo:i.value[0]}:f}),max:r.max.map(function(f){return f.uid===0?{uid:0,hasAudio:f.hasAudio,hasVideo:i.value[0]}:f}),isScreensharing:r.isScreensharing};break;case"local-user-mute-audio":o={min:r.min.map(function(f){return f.uid===0?{uid:0,hasAudio:i.value[0],hasVideo:f.hasVideo}:f}),max:r.max.map(function(f){return f.uid===0?{uid:0,hasAudio:i.value[0],hasVideo:f.hasVideo}:f}),isScreensharing:r.isScreensharing};break;case"remote-user-mute-video":o={min:r.min.map(function(f){return f.uid===i.value[0].uid?{uid:f.uid,hasVideo:i.value[1],hasAudio:f.hasAudio}:f}),max:r.max.map(function(f){return f.uid===i.value[0].uid?{uid:f.uid,hasVideo:i.value[1],hasAudio:f.hasAudio}:f}),isScreensharing:r.isScreensharing};break;case"remote-user-mute-audio":o={min:r.min.map(function(f){return f.uid===i.value[0].uid?{uid:f.uid,hasAudio:i.value[1],hasVideo:f.hasVideo}:f}),max:r.max.map(function(f){return f.uid===i.value[0].uid?{uid:f.uid,hasAudio:i.value[1],hasVideo:f.hasVideo}:f}),isScreensharing:r.isScreensharing};break;case"leave-channel":o=IH;break;case"ActiveSpeaker":r.max[0].uid===i.value[0]?o=A_({},r):o={max:[r.min.find(function(f){return f.uid===i.value[0]})],min:[].concat(r.min.filter(function(f){return f.uid!==i.value[0]}),[r.max[0]]),isScreensharing:r.isScreensharing};break}return console.log("!state-update",A_({},r,o),o),A_({},r,o)},HIt=function(r,i,o,s,l,d,h){try{var p=function(){try{try{console.log(g),d&&(g.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(d+"/rtc/"+i+"/publisher/uid/"+C+"/")).then(function(x){return Promise.resolve(x.json()).then(function(j){var z=j.rtcToken;g.renewToken(z)})})}catch(x){return Promise.reject(x)}}),g.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(d+"/rtc/"+i+"/publisher/uid/"+C+"/")).then(function(x){return Promise.resolve(x.json()).then(function(j){var z=j.rtcToken;g.renewToken(z)})})}catch(x){return Promise.reject(x)}})),o.on("track-ended",function(){g.leave(),g.removeAllListeners()})}catch(x){console.log(x)}return Promise.resolve()}catch(x){return Promise.reject(x)}},f=function(){try{g.setClientRole("host");var x=function(){if(d){var j=Lb(function(){return Promise.resolve(fetch(d+"/rtc/"+i+"/publisher/uid/"+C+"/")).then(function(z){return Promise.resolve(z.json()).then(function(_t){var ue=_t.rtcToken;return Promise.resolve(g.join(r,i,ue,C)).then(function(_n){b=_n})})})},function(z){console.log(z)});if(j&&j.then)return j.then(function(){})}else return Promise.resolve(g.join(r,i,s||null,C||0)).then(function(z){b=z})}();return Promise.resolve(x&&x.then?x.then(function(){}):void 0)}catch(j){return Promise.reject(j)}},_=function(){try{var x=function(){var _t=function(){if(o.enabled){var ue=function(){if(!k)return Promise.resolve(g.publish([o]).then(function(){k=!0})).then(function(){})}();if(ue&&ue.then)return ue.then(function(){})}}();if(_t&&_t.then)return _t.then(function(){})},j=function(){if(h)return Promise.resolve(g.enableDualStream()).then(function(){})}();return Promise.resolve(j&&j.then?j.then(x):x(j))}catch(z){return Promise.reject(z)}},g=SV.createClient({mode:"live",role:"host",codec:"vp8"}),b=0,C=l||1,k=!1,A=function(){try{var x=Lb(function(){return o.close(),Promise.resolve(g.leave()).then(function(){g.removeAllListeners()})},function(j){console.log(j)});return Promise.resolve(x&&x.then?x.then(function(){}):void 0)}catch(j){return Promise.reject(j)}};return RV=A,Promise.resolve(p()).then(function(){return Promise.resolve(f()).then(function(){return Promise.resolve(_()).then(function(){b&&console.log(b)})})})}catch(P){return Promise.reject(P)}},RV=function(){},KIt=Bat({codec:"vp8",mode:"live"}),zIt=function(r){var i=(0,_c.useRef)(),o=(0,_c.useRef)(),s=(0,_c.useRef)(!1),l=(0,_c.useContext)(Xat),d=l.localVideoTrack,h=l.localAudioTrack,p=(0,_c.useContext)(v0),f=p.callbacks,_=p.rtcProps,g=(0,_c.useState)(!1),b=g[0],C=g[1],k=(0,_c.useState)(!1),A=k[0],P=k[1],x=null,j=(0,_c.useRef)(new Promise(function(_p,Qm){x=_p,console.log(Qm)})),z=KIt();_.customRtcClient&&(z.removeAllListeners(),z=_.customRtcClient);var _t=!1,ue=!1,_n=(0,_c.useRef)({}),Ei=r.callActive;Ei===void 0&&(Ei=!0);var _s=(0,_c.useReducer)(WIt,IH),kc=_s[0],_i=_s[1];(0,_c.useEffect)(function(){var _p=function(){try{try{if(console.log(z),z.on("user-joined",function(){try{for(var Gi=arguments.length,_d=new Array(Gi),Di=0;Di<Gi;Di++)_d[Di]=arguments[Di];var H=_d[0];return H.uid===r.screenshareUid&&s.current||H.uid===1&&s.current||(_n.current[H.uid]={}),_i({type:"user-joined",value:_d}),Promise.resolve()}catch(Wt){return Promise.reject(Wt)}}),z.on("user-published",function(){for(var Gi=arguments.length,_d=new Array(Gi),Di=0;Di<Gi;Di++)_d[Di]=arguments[Di];try{var H=_d[0],Wt=_d[1];return console.log("user-published",H.uid),H.uid===r.screenshareUid&&s.current||H.uid===1&&s.current?_i({type:"user-published",value:_d}):z.subscribe(H,Wt).then(function(_e){if(_n.current[H.uid][Wt+"Track"]=H[Wt+"Track"],Wt==="audio"){var _f;(_f=H.audioTrack)===null||_f===void 0||_f.play()}else _.enableDualStream&&_.dualStreamMode&&z.setStreamFallbackOption(H.uid,_.dualStreamMode);_i({type:"user-published",value:_d})}).catch(function(_e){return console.log(_e)}),Promise.resolve()}catch(_e){return Promise.reject(_e)}}),z.on("user-unpublished",function(){try{for(var Gi=arguments.length,_d=new Array(Gi),Di=0;Di<Gi;Di++)_d[Di]=arguments[Di];var H=_d[0],Wt=_d[1];if(console.log("user-unpublished",H.uid),Wt==="audio"){var _e;(_e=H.audioTrack)===null||_e===void 0||_e.stop()}return _i({type:"user-unpublished",value:_d}),Promise.resolve()}catch(_f){return Promise.reject(_f)}}),z.on("connection-state-change",function(){try{for(var Gi=arguments.length,_d=new Array(Gi),Di=0;Di<Gi;Di++)_d[Di]=arguments[Di];var H=_d[0],Wt=_d[1],_e=_d[2];if(console.log("connection",Wt,H,_e),H==="CONNECTED")P(!0);else if(H==="DISCONNECTED"){try{RV(),s.current=!1}catch(_f){console.log("stopscreenshare",_f)}_i({type:"leave-channel",value:null})}else P(!1);return Promise.resolve()}catch(_f){return Promise.reject(_f)}}),z.on("user-left",function(){for(var Gi=arguments.length,_d=new Array(Gi),Di=0;Di<Gi;Di++)_d[Di]=arguments[Di];_i({type:"user-left",value:_d})}),_.tokenUrl){var _o=_.tokenUrl,ga=_.channel,vf=_.uid;z.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(_o+"/rtc/"+ga+"/publisher/uid/"+(vf||0)+"/")).then(function(Gi){return Promise.resolve(Gi.json()).then(function(_d){var Di=_d.rtcToken;z.renewToken(Di)})})}catch(Gi){return Promise.reject(Gi)}}),z.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(_o+"/rtc/"+ga+"/publisher/uid/"+(vf||0)+"/")).then(function(Gi){return Promise.resolve(Gi.json()).then(function(_d){var Di=_d.rtcToken;z.renewToken(Di)})})}catch(Gi){return Promise.reject(Gi)}})}if(f){var Fi=Object.keys(f);Fi.map(function(Gi){try{z.on(Gi,function(){for(var _d=arguments.length,Di=new Array(_d),H=0;H<_d;H++)Di[H]=arguments[H];f[Gi].apply(null,Di)})}catch(_d){console.log(_d)}})}x(!0),C(!0)}catch(Gi){console.log("!!!",Gi)}return Promise.resolve()}catch(Gi){return Promise.reject(Gi)}};return x?(_p(),function(){try{z.removeAllListeners()}catch(Qm){console.log(Qm)}}):function(){}},[_.appId]),(0,_c.useEffect)(function(){var _p=function(){try{return Promise.resolve(j.current).then(function(){var ga=_.tokenUrl,vf=_.channel,Fi=_.uid,Gi=_.appId,_d=_.token,Di=function(){if(z&&!Qm){_.role==="audience"?z.setClientRole(_.role):z.setClientRole("host");var H=function(){if(ga){var Wt=Lb(function(){return Promise.resolve(fetch(ga+"/rtc/"+vf+"/publisher/uid/"+(Fi||0)+"/")).then(function(_e){return Promise.resolve(_e.json()).then(function(_f){var uE=_f.rtcToken;return Promise.resolve(z.join(Gi,vf,uE,Fi||0)).then(function(IE){i.current=IE})})})},function(_e){console.log(_e)});if(Wt&&Wt.then)return Wt.then(function(){})}else return Promise.resolve(z.join(Gi,vf,_d||null,Fi||0)).then(function(_e){i.current=_e})}();if(H&&H.then)return H.then(function(){})}else console.error("trying to join before RTC Engine was initialized")}();if(Di&&Di.then)return Di.then(function(){})})}catch(ga){return Promise.reject(ga)}},Qm=!1;return Ei?(_p(),console.log("Attempted join: ",_.channel)):console.log("In precall - waiting to join"),function(){if(Qm=!0,Ei){console.log("Leaving channel");try{RV(),s.current=!1}catch(_o){console.log(_o)}j.current=z.leave().catch(function(_o){return console.log(_o)})}}},[_.channel,_.uid,Ei,_.tokenUrl]),(0,_c.useEffect)(function(){var _p=function(){try{var _o=function(){function Fi(){var _d=function(){if(d!=null&&d.enabled&&A){var Di=function(){if(!_t)return Promise.resolve(z.publish([d]).then(function(){_t=!0})).then(function(){})}();if(Di&&Di.then)return Di.then(function(){})}}();if(_d&&_d.then)return _d.then(function(){})}var Gi=function(){if(h!=null&&h.enabled&&A){var _d=function(){if(!ue)return Promise.resolve(z.publish([h]).then(function(){ue=!0})).then(function(){})}();if(_d&&_d.then)return _d.then(function(){})}}();return Gi&&Gi.then?Gi.then(Fi):Fi(Gi)},ga=function(){if(_.enableDualStream)return Promise.resolve(z.enableDualStream()).then(function(){})}();return Promise.resolve(ga&&ga.then?ga.then(_o):_o(ga))}catch(vf){return Promise.reject(vf)}};console.log("Publish",d,h,Ei),Ei&&_p()},[Ei,d?.enabled,h?.enabled,A]),(0,_c.useEffect)(function(){d&&h!==null&&(_n.current[0]={audioTrack:h,videoTrack:d},_i({type:"update-user-video",value:[h,d]}))},[_.channel,A]),(0,_c.useEffect)(function(){A&&_.token&&z.renewToken(_.token).then(function(_p){return console.log("renewed token",_p)})},[_.token,A]),(0,_c.useEffect)(function(){_.role&&z.setClientRole(_.role).then(function(_p){return console.log("changed role",_p)})},[_.role,A]),(0,_c.useEffect)(function(){var _p=function(){try{var _o=function(){if(_.activeSpeaker&&_.layout!==cN.grid)return z.on("volume-indicator",function(ga){var vf=ga.reduce(function(_d,Di){return _d===null||Di.level>_d.level?Di:_d},null),Fi=vf?vf.uid:void 0,Gi=Fi===i.current?0:Fi;Fi!==void 0&&_i({type:"ActiveSpeaker",value:[Gi]})}),Promise.resolve(z.enableAudioVolumeIndicator()).then(function(){})}();return Promise.resolve(_o&&_o.then?_o.then(function(){}):void 0)}catch(ga){return Promise.reject(ga)}};return Ei&&_p(),function(){z.removeAllListeners("volume-indicator")}},[_.activeSpeaker,_.layout]);var _h=function(){try{var Qm=function(){try{return _i({type:"Screensharing",value:[!0]}),Promise.resolve(SV.createScreenVideoTrack({},"disable")).then(function(vf){o.current=vf;var Fi=_.screenshareUid||1;return _n.current[Fi]={videoTrack:o.current},o.current.on("track-ended",function(){s.current=!1,_i({type:"Screensharing",value:[!1]})}),s.current=!0,Promise.resolve(HIt(_.appId,_.channel,o.current,_.screenshareToken,_.screenshareUid,_.tokenUrl,_.enableDualStream)).then(function(){})})}catch(vf){return Promise.reject(vf)}},_o=function(){RV(),s.current=!1};return s.current?_o():Qm(),Promise.resolve()}catch(ga){return Promise.reject(ga)}};return _c.default.createElement(UIt,{value:{client:z,mediaStore:_n.current,localVideoTrack:d,localAudioTrack:h,dispatch:_i,localUid:i,channelJoined:A,toggleScreensharing:_h,isScreensharing:s.current}},_c.default.createElement(VIt,{value:kc.max},_c.default.createElement(BIt,{value:kc.min},b?r.children:null)))},YIt={videocam:_c.default.createElement(_c.default.Fragment,null,_c.default.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),_c.default.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),videocamOff:_c.default.createElement(_c.default.Fragment,null,_c.default.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),_c.default.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),remoteSwap:_c.default.createElement(_c.default.Fragment,null,_c.default.createElement("polyline",{points:"15 3 21 3 21 9"}),_c.default.createElement("polyline",{points:"9 21 3 21 3 15"}),_c.default.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),_c.default.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),callEnd:_c.default.createElement(_c.default.Fragment,null,_c.default.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),_c.default.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),mic:_c.default.createElement(_c.default.Fragment,null,_c.default.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),_c.default.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),_c.default.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),_c.default.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),micOff:_c.default.createElement(_c.default.Fragment,null,_c.default.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),_c.default.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),_c.default.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),_c.default.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),_c.default.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),screen:_c.default.createElement(_c.default.Fragment,null,_c.default.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),_c.default.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),_c.default.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),stop:_c.default.createElement(_c.default.Fragment,null,_c.default.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),_c.default.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},uN=function(r){var i=r.onClick,o=r.name,s=r.disabled,l=r.style,d=(0,_c.useContext)(v0),h=d.styleProps,p=h||{},f=p.theme,_=p.BtnTemplateStyles,g=p.iconSize,b=p.customIcon;return _c.default.createElement("div",{style:A_({},{width:35,height:35,borderRadius:"100%",borderWidth:2,borderStyle:"solid",borderColor:"#fff",backgroundColor:"rgba(0,80,180,0.2)",alignItems:"center",justifyContent:"center",display:"flex",cursor:s?"auto":"pointer",margin:4},_,l),onClick:i},b?_c.default.createElement("img",{src:b[o],alt:o}):_c.default.createElement("svg",{style:{width:g||24,height:g||24},xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",opacity:s?"0.5":"1",stroke:f||"#fff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},YIt[o]))};function JIt(){var e=(0,_c.useContext)(v0),r=e.styleProps,i=e.callbacks,o=r||{},s=o.localBtnStyles,l=s||{},d=l.endCall;return _c.default.createElement(uN,{style:d||{backgroundColor:"#ef5588",borderColor:"#f00"},name:"callEnd",onClick:function(){return i?.EndCall&&i.EndCall()}})}var QL=(0,_c.createContext)({}),XIt=function(r){var i=(0,_c.useContext)(CV),o=(0,_c.useContext)(AV),s;return i[0].uid===0?s=i[0]:s=o.find(function(l){return l.uid===0}),_c.default.createElement(QL.Provider,{value:s},r.children)},wV=function(e,r,i,o){try{var s=function(){if(e.uid===0){var l=e.hasAudio,d=function(){if(l===H_.enabled||l===H_.disabled){var h=l===H_.enabled?H_.disabling:H_.enabling;r({type:"local-user-mute-audio",value:[h]}),o&&o["local-user-mute-audio"]&&o["local-user-mute-audio"](h);var p=Lb(function(){return Promise.resolve(i?.setEnabled(l!==H_.enabled)).then(function(){h=l===H_.enabled?H_.disabled:H_.enabled,o&&o["local-user-mute-audio"]&&o["local-user-mute-audio"](h),r({type:"local-user-mute-audio",value:[l===H_.enabled?H_.disabled:H_.enabled]})})},function(){r({type:"local-user-mute-audio",value:[l]})});if(p&&p.then)return p.then(function(){})}}();if(d&&d.then)return d.then(function(){})}}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(l){return Promise.reject(l)}};function QIt(){var e=(0,_c.useContext)(v0),r=e.styleProps,i=e.callbacks,o=r||{},s=o.localBtnStyles,l=s||{},d=l.muteLocalAudio,h=(0,_c.useContext)(kR),p=h.dispatch,f=h.localAudioTrack,_=(0,_c.useContext)(QL);return _c.default.createElement("div",null,_c.default.createElement(uN,{style:d,name:_.hasAudio===H_.enabled?"mic":"micOff",onClick:function(){return f&&wV(_,p,f,i)}}))}function ZIt(){var e=(0,_c.useContext)(v0),r=e.styleProps,i=r||{},o=i.localBtnStyles,s=o||{},l=s.screenshare,d=(0,_c.useContext)(kR),h=d.toggleScreensharing,p=d.isScreensharing;return _c.default.createElement("div",null,_c.default.createElement(uN,{style:l,name:p?"stop":"screen",onClick:function(){return h()}}))}var IV=function(e,r,i,o){try{var s=function(){if(e.uid===0){var l=e.hasVideo,d=function(){if(l===H_.enabled||l===H_.disabled){var h=l===H_.enabled?H_.disabling:H_.enabling;r({type:"local-user-mute-video",value:[h]}),o&&o["local-user-mute-video"]&&o["local-user-mute-video"](h);var p=Lb(function(){return Promise.resolve(i?.setEnabled(l!==H_.enabled)).then(function(){h=l===H_.enabled?H_.disabled:H_.enabled,o&&o["local-user-mute-video"]&&o["local-user-mute-video"](h),r({type:"local-user-mute-video",value:[h]})})},function(){r({type:"local-user-mute-video",value:[l]})});if(p&&p.then)return p.then(function(){})}}();if(d&&d.then)return d.then(function(){})}}();return Promise.resolve(s&&s.then?s.then(function(){}):void 0)}catch(l){return Promise.reject(l)}};function $It(){var e=(0,_c.useContext)(v0),r=e.styleProps,i=e.callbacks,o=r||{},s=o.localBtnStyles,l=s||{},d=l.muteLocalVideo,h=(0,_c.useContext)(kR),p=h.dispatch,f=h.localVideoTrack,_=(0,_c.useContext)(QL);return _c.default.createElement("div",null,_c.default.createElement(uN,{style:d,name:_.hasVideo===H_.enabled?"videocam":"videocamOff",onClick:function(){return f&&IV(_,p,f,i)}}))}function Wat(){var e=(0,_c.useContext)(v0),r=e.styleProps,i=e.rtcProps,o=r||{},s=o.localBtnContainer;return _c.default.createElement("div",{style:A_({},{backgroundColor:"#007bff",width:"100%",height:70,zIndex:10,display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center"},s)},i.role!=="audience"&&_c.default.createElement($It,null),i.role!=="audience"&&_c.default.createElement(QIt,null),i.role!=="audience"&&i.enableScreensharing&&_c.default.createElement(ZIt,null),_c.default.createElement(JIt,null))}var aN;(function(e){e[e.initFailed=0]="initFailed",e[e.offline=1]="offline",e[e.initialising=2]="initialising",e[e.loggingIn=3]="loggingIn",e[e.loggedIn=4]="loggedIn",e[e.connected=5]="connected",e[e.loginFailed=6]="loginFailed"})(aN||(aN={}));var Hat;(function(e){e[e.broadcaster=0]="broadcaster",e[e.audience=1]="audience"})(Hat||(Hat={}));var sO;(function(e){e[e.camera=0]="camera",e[e.microphone=1]="microphone"})(sO||(sO={}));var V0;(function(e){e[e.closed=0]="closed",e[e.muteMic=1]="muteMic",e[e.muteCamera=2]="muteCamera",e[e.unmuteMic=3]="unmuteMic",e[e.unmuteCamera=4]="unmuteCamera"})(V0||(V0={}));var sP=(0,_c.createContext)(null),tCt=sP.Provider,mAt=sP.Consumer;function CH(e){var r=(0,_c.useContext)(v0),i=r.styleProps,o=(0,_c.useContext)(sP),s=o.sendMuteRequest,l=o.uidMap,d=i||{},h=d.remoteBtnStyles,p=h||{},f=p.muteRemoteVideo,_=e.UIKitUser,g=_.hasVideo===l0.no;return _.uid!==0&&l[_.uid]?_c.default.createElement("div",null,_c.default.createElement(uN,{name:_.hasVideo===l0.subbed?"videocam":"videocamOff",style:f,onClick:function(){return s(sO.camera,_.uid,!g)}})):null}function AH(e){var r=(0,_c.useContext)(v0),i=r.styleProps,o=i||{},s=o.remoteBtnStyles,l=(0,_c.useContext)(sP),d=l.sendMuteRequest,h=l.uidMap,p=s||{},f=p.muteRemoteAudio,_=e.UIKitUser,g=_.hasAudio===l0.no;return _.uid!==0&&h[_.uid]?_c.default.createElement("div",null,_c.default.createElement(uN,{style:f,name:_.hasAudio===l0.subbed?"mic":"micOff",onClick:function(){return d(sO.microphone,_.uid,!g)}})):null}function Qat(e){var r=(0,_c.useContext)(kR),i=r.dispatch,o=e.UIKitUser;return _c.default.createElement("div",null,_c.default.createElement(uN,{name:"remoteSwap",onClick:function(){return i({type:"user-swap",value:[o]})}}))}var Zat=function(r){var i=(0,_c.useContext)(v0),o=i.styleProps,s=i.rtcProps,l=o||{},d=l.maxViewStyles,h=l.maxViewOverlayContainer,p=r.user,f=s.CustomVideoPlaceholder;return f?f&&f(A_({},r),null):_c.default.createElement("div",{key:p.uid,style:A_({},bV.max,d)},_c.default.createElement("div",{style:bV.imgContainer},_c.default.createElement("img",{style:bV.img,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg=="})),r.isShown&&_c.default.createElement("div",{style:A_({},bV.btnContainer,h)},r.showButtons&&_c.default.createElement(_c.default.Fragment,null,!s.disableRtm&&_c.default.createElement(CH,{UIKitUser:p}),!s.disableRtm&&_c.default.createElement(AH,{UIKitUser:p}),r.showSwap&&_c.default.createElement(Qat,{UIKitUser:p}))))},bV={max:{flex:1,display:"flex",backgroundColor:"#007bff33",flexDirection:"row",position:"relative"},imgContainer:{flex:10,display:"flex",justifyContent:"center"},img:{width:100,height:100,position:"absolute",alignSelf:"center",justifySelf:"center",margin:"auto",display:"flex"},btnContainer:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},Kat=function(r){var i=(0,_c.useContext)(sP),o=i.usernames,s=(0,_c.useContext)(v0),l=s.rtmProps,d=s.styleProps,h=r.user;return l!=null&&l.displayUsername?_c.default.createElement("p",{style:A_({},eCt.username,d?.usernameText)},h.uid===1?"Screenshare":o[h.uid]):_c.default.createElement(_c.default.Fragment,null)},eCt={username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},$at=function(r){var i=(0,_c.useContext)(kR),o=i.mediaStore,s=(0,_c.useContext)(v0),l=s.styleProps,d=s.rtcProps,h=l||{},p=h.maxViewStyles,f=h.videoMode,_=h.maxViewOverlayContainer,g=f?.max,b=(0,_c.useState)(!1),C=b[0],k=b[1],A=r.user;return _c.default.createElement("div",{style:A_({},XL.container,r.style,p),onMouseEnter:function(){return k(!0)},onMouseLeave:function(){return k(!1)}},A.hasVideo===1?_c.default.createElement("div",{style:XL.videoContainer},!d.disableRtm&&_c.default.createElement(Kat,{user:A}),_c.default.createElement(SH,{style:XL.videoplayer,config:{fit:g||"cover"},videoTrack:o[A.uid].videoTrack}),C&&_c.default.createElement("div",{style:A_({},XL.overlay,_)},!d.disableRtm&&_c.default.createElement(CH,{UIKitUser:A}),!d.disableRtm&&_c.default.createElement(AH,{UIKitUser:A}))):_c.default.createElement("div",{style:XL.videoContainer},!d.disableRtm&&_c.default.createElement(Kat,{user:A}),_c.default.createElement(Zat,{user:A,isShown:C,showButtons:!0})))},XL={container:{display:"flex",flex:1},videoContainer:{display:"flex",flex:1,position:"relative"},videoplayer:{width:"100%",display:"flex",flex:1},overlay:{position:"absolute",margin:5,flexDirection:"column",display:"flex"},username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},nCt=function(r){var i=(0,_c.useContext)(kR),o=i.mediaStore,s=(0,_c.useContext)(v0),l=s.styleProps,d=s.rtcProps,h=l||{},p=h.minViewStyles,f=h.videoMode,_=h.minViewOverlayContainer,g=f?.min,b=(0,_c.useState)(!1),C=b[0],k=b[1],A=r.user;return _c.default.createElement("div",{style:A_({},{display:"flex",flex:1},p),onMouseEnter:function(){return k(!0)},onMouseLeave:function(){return k(!1)}},A.hasVideo===1?_c.default.createElement("div",{style:A_({},{display:"flex",flex:1,position:"relative"})},_c.default.createElement(SH,{style:{flex:10,display:"flex"},config:{fit:g!==void 0?g:"cover"},videoTrack:o[A.uid].videoTrack}),C&&_c.default.createElement("div",{style:A_({},{margin:4,position:"absolute",flex:1,display:"flex",flexDirection:"column"},_)},!d.disableRtm&&_c.default.createElement(CH,{UIKitUser:A}),!d.disableRtm&&_c.default.createElement(AH,{UIKitUser:A}),_c.default.createElement(Qat,{UIKitUser:A}))):_c.default.createElement(Zat,{user:A,isShown:C,showButtons:!0,showSwap:!0}))},rCt={test:"_3ybTi",scrollbar:"_3Sxu7"},zat=function(){var r=(0,_c.useContext)(v0),i=r.styleProps,o=r.rtcProps,s=i||{},l=s.minViewContainer,d=s.pinnedVideoContainer,h=s.maxViewContainer,p=s.scrollViewContainer,f=(0,_c.useRef)(null),_=(0,_c.useState)(0),g=_[0],b=_[1],C=(0,_c.useState)(0),k=C[0],A=C[1],P=g>k;return(0,_c.useEffect)(function(){var x=function(){f.current&&(b(f.current.offsetWidth),A(f.current.offsetHeight))};return window.addEventListener("resize",x),f.current&&(b(f.current.offsetWidth),A(f.current.offsetHeight)),function(){window.removeEventListener("resize",x)}},[]),_c.default.createElement("div",{ref:f,style:A_({},{display:"flex",flex:1,flexDirection:P?"row":"column-reverse",overflow:"hidden"},d)},_c.default.createElement("div",{style:A_({},{display:"flex",flex:P?5:4},h)},_c.default.createElement(FIt,null,function(x){return o.role==="audience"&&x[0].uid===0?null:_c.default.createElement($at,{user:x[0]})})),_c.default.createElement("div",{className:rCt.scrollbar,style:A_({},{overflowY:P?"scroll":"hidden",overflowX:P?"hidden":"scroll",display:"flex",flex:1,flexDirection:P?"column":"row"},p)},_c.default.createElement(GIt,null,function(x){return x.map(function(j){return o.role==="audience"&&j.uid===0?null:_c.default.createElement("div",{style:A_({},{minHeight:P?"35vh":"99%",minWidth:P?"99%":"40vw",margin:2,display:"flex"},l),key:j.uid},_c.default.createElement(nCt,{user:j}))})})))},Yat=function(){var r=(0,_c.useContext)(v0),i=r.styleProps,o=r.rtcProps,s=i||{},l=s.gridVideoCells,d=s.gridVideoContainer,h=(0,_c.useContext)(CV),p=(0,_c.useContext)(AV),f=o.role==="audience"?[].concat(h,p).filter(function(z){return z.uid!==0}):[].concat(h,p),_=(0,_c.useRef)(null),g=(0,_c.useState)(window.innerWidth),b=g[0],C=g[1],k=(0,_c.useState)(window.innerHeight),A=k[0],P=k[1],x=b>A,j="minmax(0, 1fr) ";return(0,_c.useEffect)(function(){var z=function(){_.current&&(C(_.current.offsetWidth),P(_.current.offsetHeight))};return window.addEventListener("resize",z),_.current&&(C(_.current.offsetWidth),P(_.current.offsetHeight)),function(){window.removeEventListener("resize",z)}},[]),_c.default.createElement("div",{ref:_,style:A_({},{width:"100%",height:"100%",display:"grid",gridTemplateColumns:x?f.length>9?j.repeat(4):f.length>4?j.repeat(3):f.length>1?j.repeat(2):j:f.length>8?j.repeat(3):f.length>2?j.repeat(2):j},d)},f.map(function(z){return _c.default.createElement($at,{user:z,style:A_({},{height:"100%",width:"100%"},l),key:z.uid})}))},iCt=Gat({encoderConfig:{}},{encoderConfig:{}}),oCt=function(r){var i=(0,_c.useState)(!1),o=i[0],s=i[1],l=(0,_c.useState)(null),d=l[0],h=l[1],p=(0,_c.useState)(null),f=p[0],_=p[1],g=iCt(),b=g.ready,C=g.tracks,k=g.error,A=(0,_c.useRef)({});return(0,_c.useEffect)(function(){return C!==null?(_(C[0]),h(C[1]),A.current[0]={audioTrack:C[0],videoTrack:C[1]},s(!0)):k&&(console.error(k),s(!1)),function(){if(C){var P,x;(P=C[0])===null||P===void 0||P.close(),(x=C[1])===null||x===void 0||x.close()}}},[b,k]),_c.default.createElement(qIt,{value:{localVideoTrack:d,localAudioTrack:f}},o?r.children:null)},sCt=function(){return new Date().getTime()},aCt=RH(),cCt=bH(),uCt=function(r){var i=(0,_c.useContext)(v0),o=i.rtcProps,s=i.rtmProps,l=(0,_c.useState)(!1),d=l[0],h=l[1],p=cCt(o.appId),f=aCt(p,o.channel),_=(0,_c.useRef)(""),g=(0,_c.useRef)(5),b=(0,_c.useContext)(QL),C=(0,_c.useContext)(v0),k=C.rtmCallbacks,A=(0,_c.useState)({}),P=A[0],x=A[1],j=(0,_c.useState)({}),z=j[0],_t=j[1],ue=(0,_c.useState)({}),_n=ue[0],Ei=ue[1],_s=(0,_c.useState)(V0.closed),kc=_s[0],_i=_s[1],_h=(0,_c.useState)(aN.offline),_p=_h[0],Qm=_h[1],_o=(0,_c.useContext)(kR),ga=_o.localUid,vf=_o.localAudioTrack,Fi=_o.localVideoTrack,Gi=_o.dispatch,_d=_o.channelJoined,Di=function K_(){try{var UE=o.tokenUrl,bE=function(){if(UE){var dE=Lb(function(){return Promise.resolve(fetch(UE+"/rtm/"+(s?.uid||_.current))).then(function(r_){return Promise.resolve(r_.json()).then(function(y0){var a_=y0.rtmToken;return Promise.resolve(p.login({uid:s?.uid||_.current,token:a_})).then(function(){g.current=5})})})},function(){setTimeout(function(){try{return g.current=g.current+g.current,K_(),Promise.resolve()}catch(r_){return Promise.reject(r_)}},g.current*1e3)});if(dE&&dE.then)return dE.then(function(){})}else{var gE=Lb(function(){return Promise.resolve(p.login({uid:s?.uid||_.current,token:s?.token||void 0})).then(function(){g.current=5})},function(){setTimeout(function(){try{return g.current=g.current+g.current,K_(),Promise.resolve()}catch(r_){return Promise.reject(r_)}},g.current*1e3)});if(gE&&gE.then)return gE.then(function(){})}}();return Promise.resolve(bE&&bE.then?bE.then(function(){}):void 0)}catch(dE){return Promise.reject(dE)}},H=function K_(){try{var UE=Lb(function(){return Promise.resolve(f.join()).then(function(){g.current=5})},function(){setTimeout(function(){try{return g.current=g.current+g.current,K_(),Promise.resolve()}catch(bE){return Promise.reject(bE)}},g.current*1e3)});return Promise.resolve(UE&&UE.then?UE.then(function(){}):void 0)}catch(bE){return Promise.reject(bE)}},Wt=function(){try{if(Qm(aN.initialising),o.uid?_.current=String(o.uid):_.current=String(sCt()),p.on("ConnectionStateChanged",function(dE,gE){console.log(dE,gE)}),p.on("TokenExpired",function(){try{var dE=o.tokenUrl;console.log("token expired - renewing");var gE=function(){if(dE){var r_=Lb(function(){return Promise.resolve(fetch(dE+"/rtm/"+(s?.uid||_.current))).then(function(y0){return Promise.resolve(y0.json()).then(function(a_){var LE=a_.rtmToken;return Promise.resolve(p.renewToken(LE)).then(function(){g.current=5})})})},function(y0){console.error("TokenExpiredError",y0)});if(r_&&r_.then)return r_.then(function(){})}}();return Promise.resolve(gE&&gE.then?gE.then(function(){}):void 0)}catch(r_){return Promise.reject(r_)}}),p.on("MessageFromPeer",function(dE,gE){uE(dE,gE)}),f.on("ChannelMessage",function(dE,gE){uE(dE,gE)}),f.on("MemberJoined",function(dE){try{return Promise.resolve(Mb(_e(),dE)).then(function(){})}catch(gE){return Promise.reject(gE)}}),f.on("MemberCountUpdated",function(dE){try{return console.log("RTM-MemberCountUpdated: ",dE),Promise.resolve()}catch(gE){return Promise.reject(gE)}}),k!=null&&k.channel?Object.keys(k.channel).map(function(dE){k.channel&&f.on(dE,k.channel[dE])}):k!=null&&k.client&&Object.keys(k.client).map(function(dE){k.client&&p.on(dE,k.client[dE])}),o.tokenUrl){var UE=o.tokenUrl,bE=o.uid;p.on("TokenExpired",function(){try{return console.log("token expired"),Promise.resolve(fetch(UE+"/rtm/"+(bE||0)+"/")).then(function(dE){return Promise.resolve(dE.json()).then(function(gE){var r_=gE.rtmToken;p.renewToken(r_)})})}catch(dE){return Promise.reject(dE)}})}return Qm(aN.loggingIn),Promise.resolve(Di()).then(function(){return Qm(aN.loggedIn),Promise.resolve(H()).then(function(){Qm(aN.connected),_t(function(dE){return A_({},dE,{0:s?.username})}),aO(_e())})})}catch(dE){return Promise.reject(dE)}},_e=function(){return{messageType:"UserData",rtmId:s?.uid||_.current,rtcId:ga.current,username:s?.username,role:o.role==="audience"?1:0,uikit:{platform:"web",framework:"react",version:"1.2.0"},agora:{rtm:JL.VERSION,rtc:SV.VERSION}}},_f=function(UE,bE,dE){var gE=s?.showPopUpBeforeRemoteMute===!1,r_={messageType:"MuteRequest",device:UE,rtcId:bE,mute:dE,isForceful:gE},y0=P[bE];gE&&!dE?console.log("cannot send force unmute request"):y0?Mb(r_,y0):console.log("peer not found")},uE=function(UE,bE){var dE;if(UE.messageType==="RAW"?dE=dCt(UE.rawMessage):UE.messageType==="TEXT"&&(dE=JSON.parse(UE.text)),console.log(dE,bE),dE)switch(dE.messageType){case"UserData":IE(dE);break;case"MuteRequest":O_(dE);break;case"RtmDataRequest":switch(dE.type){case"ping":A0(bE);break;case"userData":kT(bE);break;default:console.log(bE)}break;default:console.log("unknown message content")}else console.log("unknown rtm message type")},IE=function(UE){x(function(bE){var dE;return A_({},bE,(dE={},dE[UE.rtcId]=UE.rtmId,dE))}),_t(function(bE){var dE;return A_({},bE,(dE={},dE[UE.rtcId]=UE.username,dE))}),Ei(function(bE){var dE;return A_({},bE,(dE={},dE[UE.rtmId]=UE,dE))})},O_=function(UE){ga.current===UE.rtcId&&(UE.isForceful?UE.mute?UE.device===sO.microphone?vf&&wV(b,Gi,vf):UE.device===sO.camera&&Fi&&IV(b,Gi,Fi):console.error("cannot force unmute"):UE.device===sO.microphone?UE.mute?_i(V0.muteMic):_i(V0.unmuteMic):UE.device===sO.camera&&(UE.mute?_i(V0.muteCamera):_i(V0.unmuteCamera)))},A0=function(UE){Mb({messageType:"RtmDataRequest",type:"pong"},UE)},kT=function(UE){Mb(_e(),UE)},aO=function(UE){try{var bE=p.createMessage({text:JSON.stringify(UE),messageType:JL.MessageType.TEXT}),dE=Lb(function(){return Promise.resolve(f.sendMessage(bE)).then(function(){})},function(gE){console.error(gE)});return Promise.resolve(dE&&dE.then?dE.then(function(){}):void 0)}catch(gE){return Promise.reject(gE)}},Mb=function(UE,bE){try{var dE=p.createMessage({text:JSON.stringify(UE),messageType:JL.MessageType.TEXT}),gE=Lb(function(){return Promise.resolve(p.sendMessageToPeer(dE,String(bE))).then(function(){})},function(r_){console.error(r_)});return Promise.resolve(gE&&gE.then?gE.then(function(){}):void 0)}catch(r_){return Promise.reject(r_)}},rS=function(){try{return Promise.resolve(p.logout()).then(function(){return Promise.resolve(p.removeAllListeners()).then(function(){})})}catch(UE){return Promise.reject(UE)}};return(0,_c.useEffect)(function(){return _d&&(Wt(),h(!0)),function(){_d&&rS()}},[o.channel,o.appId,_d]),_c.default.createElement(tCt,{value:{rtmStatus:_p,sendPeerMessage:Mb,sendChannelMessage:aO,sendMuteRequest:_f,rtmClient:p,uidMap:P,usernames:z,userDataMap:_n,popUpState:kc,setPopUpState:_i}},d?r.children:_c.default.createElement(_c.default.Fragment,null))},EAt=new TextEncoder,lCt=new TextDecoder;var dCt=function(r){return JSON.parse(lCt.decode(r))};function hCt(){var e=(0,_c.useContext)(v0),r=e.styleProps,i=(0,_c.useContext)(sP),o=i.popUpState,s=i.setPopUpState,l=r||{},d=l.popUpContainer,h=(0,_c.useContext)(kR),p=h.dispatch,f=h.localVideoTrack,_=h.localAudioTrack,g=(0,_c.useContext)(QL);return o!==V0.closed?_c.default.createElement("div",{style:A_({},wH.container,d)},_c.default.createElement("div",{style:{color:"#fff",fontSize:18,fontWeight:700}},o===V0.muteCamera||o===V0.muteMic?"Mute ":"Unmute ",o===V0.muteCamera||o===V0.unmuteCamera?"Camera":"Mic","?"),_c.default.createElement("div",{style:{flexDirection:"row",display:"flex",width:"100%",justifyContent:"space-around"}},_c.default.createElement("div",{onClick:function(){switch(o){case V0.muteCamera:g.hasVideo&&f&&IV(g,p,f);break;case V0.muteMic:g.hasAudio&&_&&wV(g,p,_);break;case V0.unmuteCamera:!g.hasVideo&&f&&IV(g,p,f);break;case V0.unmuteMic:!g.hasAudio&&_&&wV(g,p,_);break}s(V0.closed)},style:wH.button},"Confirm"),_c.default.createElement("div",{style:wH.buttonClose,onClick:function(){return s(V0.closed)}},"Close"))):null}var wH={button:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},buttonClose:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},container:{backgroundColor:"#007bffaa",position:"absolute",width:240,height:80,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},pCt=function(r){var i=r.styleProps,o=r.rtcProps,s=i||{},l=s.UIKitContainer;return _c.default.createElement(jIt,{value:r},_c.default.createElement("div",{style:A_({},fCt,l)},o.role==="audience"?_c.default.createElement(Jat,null):_c.default.createElement(oCt,null,_c.default.createElement(Jat,null))))},Jat=function(){var r=(0,_c.useContext)(v0),i=r.rtcProps;return _c.default.createElement(zIt,{callActive:i.callActive},_c.default.createElement(XIt,null,i.disableRtm?_c.default.createElement(_c.default.Fragment,null,i?.layout===cN.grid?_c.default.createElement(Yat,null):_c.default.createElement(zat,null),_c.default.createElement(Wat,null)):_c.default.createElement(uCt,null,_c.default.createElement(hCt,null),i?.layout===cN.grid?_c.default.createElement(Yat,null):_c.default.createElement(zat,null),_c.default.createElement(Wat,null))))},fCt={display:"flex",flex:1,minHeight:0,flexDirection:"column"},tct=pCt;var OH="agora-root";function mCt(){let e=document.getElementById(OH);if(e)return e;let r=document.createElement("div");return r.setAttribute("id",OH),r.style.width="100vw",r.style.height="100vh",r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.zIndex="50",document.body.appendChild(r),r}function ECt(){let e=document.getElementById(OH);e&&e.remove()}var nct={start:function(e){this.end();let r=e.viewport||mCt();this.options=e;let i={rtcProps:{appId:e.appId,channel:e.channel,token:e.token,layout:typeof e.layout>"u"?cN.grid:e.layout,enableScreensharing:!0,uid:e.uid,enableAudio:typeof e.enableAudio>"u"?!0:e.enableAudio,enableVideo:typeof e.enableVideo>"u"?!0:e.enableVideo},callbacks:{EndCall:()=>{this.end()},"user-joined":()=>{e.onUserJoin&&e.onUserJoin()},"user-left":()=>{e.onUserLeft&&e.onUserLeft()}}},o={width:"100%",height:"100%",display:"flex",flex:1},s=()=>{let[l,d]=(0,PR.useState)(!0);return this.unmount=()=>{d(!1)},PR.default.createElement("div",{style:o},l?PR.default.createElement(tct,{...i}):PR.default.createElement(PR.default.Fragment,null))};(0,ect.createRoot)(r).render(PR.default.createElement(PR.default.StrictMode,null,PR.default.createElement(s,null)))},end:async function(){this.unmount&&(this.unmount(),this.unmount=void 0,await new Promise(e=>{setTimeout(e,50)})),!this.options?.viewport&&ECt()}};window.AgoraUIKit=nct;var TAt=nct;})();
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

scheduler/cjs/scheduler.production.min.js:
  (**
   * @license React
   * scheduler.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

react-dom/cjs/react-dom.production.min.js:
  (**
   * @license React
   * react-dom.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)

agora-rtm-sdk/index.js:
  (*
   @preserve
   AgoraRTM Web SDK 1.4.3-203 - commit: v1.4.3-17-g1e27aa38
   Copyright (C) 2018-2021 Agora Lab.
   This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
   A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
  *)

agora-rtc-sdk-ng/AgoraRTC_N-production.esm.mjs:
  (*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> *)
*/
//# sourceMappingURL=agora-ui-kit.min.js.map
