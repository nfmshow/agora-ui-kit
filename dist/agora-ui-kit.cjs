var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function createCommonjsModule(e){var t={exports:{}};return e(t,t.exports),t.exports}var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u$1=Symbol.for("react.context"),v$2=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x$1=Symbol.for("react.memo"),y$1=Symbol.for("react.lazy"),z$2=Symbol.iterator;function A$2(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=z$2&&e[z$2]||e["@@iterator"])?e:null}var B$2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$2={};function E$2(e,t,n){this.props=e,this.context=t,this.refs=D$2,this.updater=n||B$2}function F$1(){}function G$2(e,t,n){this.props=e,this.context=t,this.refs=D$2,this.updater=n||B$2}E$2.prototype.isReactComponent={},E$2.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},E$2.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},F$1.prototype=E$2.prototype;var H$2=G$2.prototype=new F$1;H$2.constructor=G$2,C$2(H$2,E$2.prototype),H$2.isPureReactComponent=!0;var I$2=Array.isArray,J$1=Object.prototype.hasOwnProperty,K$2={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(e,t,n){var r,i={},o=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)J$1.call(t,r)&&!L$2.hasOwnProperty(r)&&(i[r]=t[r]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var c=Array(s),u=0;u<s;u++)c[u]=arguments[u+2];i.children=c}if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===i[r]&&(i[r]=s[r]);return{$$typeof:l$1,type:e,key:o,ref:a,props:i,_owner:K$2.current}}function N$2(e,t){return{$$typeof:l$1,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function O$2(e){return"object"==typeof e&&null!==e&&e.$$typeof===l$1}function escape$1(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}var P$2=/\/+/g;function Q$2(e,t){return"object"==typeof e&&null!==e&&null!=e.key?escape$1(""+e.key):t.toString(36)}function R$2(e,t,n,r,i){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var a=!1;if(null===e)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case l$1:case n$1:a=!0}}if(a)return i=i(a=e),e=""===r?"."+Q$2(a,0):r,I$2(i)?(n="",null!=e&&(n=e.replace(P$2,"$&/")+"/"),R$2(i,t,n,"",function(e){return e})):null!=i&&(O$2(i)&&(i=N$2(i,n+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(P$2,"$&/")+"/")+e)),t.push(i)),1;if(a=0,r=""===r?".":r+":",I$2(e))for(var s=0;s<e.length;s++){var c=r+Q$2(o=e[s],s);a+=R$2(o,t,n,c,i)}else if("function"==typeof(c=A$2(e)))for(e=c.call(e),s=0;!(o=e.next()).done;)a+=R$2(o=o.value,t,n,c=r+Q$2(o,s++),i);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return a}function S$2(e,t,n){if(null==e)return e;var r=[],i=0;return R$2(e,r,"","",function(e){return t.call(n,e,i++)}),r}function T$2(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var U$2={current:null},V$2={transition:null},W$2={ReactCurrentDispatcher:U$2,ReactCurrentBatchConfig:V$2,ReactCurrentOwner:K$2};function X$2(){throw Error("act(...) is not supported in production builds of React.")}var Children={map:S$2,forEach:function(e,t,n){S$2(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return S$2(e,function(){t++}),t},toArray:function(e){return S$2(e,function(e){return e})||[]},only:function(e){if(!O$2(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},Component=E$2,Fragment$1=p$2,Profiler=r$1,PureComponent=G$2,StrictMode=q$1,Suspense=w$1,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED$1=W$2,act=X$2,cloneElement=function(e,t,n){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=C$2({},e.props),i=e.key,o=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,a=K$2.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(c in t)J$1.call(t,c)&&!L$2.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==s?s[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=n;else if(1<c){s=Array(c);for(var u=0;u<c;u++)s[u]=arguments[u+2];r.children=s}return{$$typeof:l$1,type:e.type,key:i,ref:o,props:r,_owner:a}},createContext=function(e){return(e={$$typeof:u$1,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:t$1,_context:e},e.Consumer=e},createElement=M$2,createFactory=function(e){var t=M$2.bind(null,e);return t.type=e,t},createRef=function(){return{current:null}},forwardRef=function(e){return{$$typeof:v$2,render:e}},isValidElement=O$2,lazy=function(e){return{$$typeof:y$1,_payload:{_status:-1,_result:e},_init:T$2}},memo=function(e,t){return{$$typeof:x$1,type:e,compare:void 0===t?null:t}},startTransition=function(e){var t=V$2.transition;V$2.transition={};try{e()}finally{V$2.transition=t}},unstable_act=X$2,useCallback=function(e,t){return U$2.current.useCallback(e,t)},useContext=function(e){return U$2.current.useContext(e)},useDebugValue=function(){},useDeferredValue=function(e){return U$2.current.useDeferredValue(e)},useEffect=function(e,t){return U$2.current.useEffect(e,t)},useId=function(){return U$2.current.useId()},useImperativeHandle=function(e,t,n){return U$2.current.useImperativeHandle(e,t,n)},useInsertionEffect=function(e,t){return U$2.current.useInsertionEffect(e,t)},useLayoutEffect=function(e,t){return U$2.current.useLayoutEffect(e,t)},useMemo=function(e,t){return U$2.current.useMemo(e,t)},useReducer=function(e,t,n){return U$2.current.useReducer(e,t,n)},useRef=function(e){return U$2.current.useRef(e)},useState=function(e){return U$2.current.useState(e)},useSyncExternalStore=function(e,t,n){return U$2.current.useSyncExternalStore(e,t,n)},useTransition=function(){return U$2.current.useTransition()},version$1="18.3.1",react_production_min={Children:Children,Component:Component,Fragment:Fragment$1,Profiler:Profiler,PureComponent:PureComponent,StrictMode:StrictMode,Suspense:Suspense,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED$1,act:act,cloneElement:cloneElement,createContext:createContext,createElement:createElement,createFactory:createFactory,createRef:createRef,forwardRef:forwardRef,isValidElement:isValidElement,lazy:lazy,memo:memo,startTransition:startTransition,unstable_act:unstable_act,useCallback:useCallback,useContext:useContext,useDebugValue:useDebugValue,useDeferredValue:useDeferredValue,useEffect:useEffect,useId:useId,useImperativeHandle:useImperativeHandle,useInsertionEffect:useInsertionEffect,useLayoutEffect:useLayoutEffect,useMemo:useMemo,useReducer:useReducer,useRef:useRef,useState:useState,useSyncExternalStore:useSyncExternalStore,useTransition:useTransition,version:version$1},react_development=createCommonjsModule(function(e,t){"production"!==process.env.NODE_ENV&&function(){"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.suspense_list"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),f=Symbol.for("react.offscreen"),m=Symbol.iterator;function g(e){if(null===e||"object"!=typeof e)return null;var t=m&&e[m]||e["@@iterator"];return"function"==typeof t?t:null}var v={current:null},E={transition:null},y={current:null,isBatchingLegacy:!1,didScheduleLegacyUpdate:!1},_={current:null},b={},S=null;function w(e){S=e}b.setExtraStackFrame=function(e){S=e},b.getCurrentStack=null,b.getStackAddendum=function(){var e="";S&&(e+=S);var t=b.getCurrentStack;return t&&(e+=t()||""),e};var T={ReactCurrentDispatcher:v,ReactCurrentBatchConfig:E,ReactCurrentOwner:_};function R(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];I("warn",e,n)}function C(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];I("error",e,n)}function I(e,t,n){var r=T.ReactDebugCurrentFrame.getStackAddendum();""!==r&&(t+="%s",n=n.concat([r]));var i=n.map(function(e){return String(e)});i.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,i)}T.ReactDebugCurrentFrame=b,T.ReactCurrentActQueue=y;var O={};function A(e,t){var n=e.constructor,r=n&&(n.displayName||n.name)||"ReactClass",i=r+"."+t;O[i]||(C("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",t,r),O[i]=!0)}var N={isMounted:function(e){return!1},enqueueForceUpdate:function(e,t,n){A(e,"forceUpdate")},enqueueReplaceState:function(e,t,n,r){A(e,"replaceState")},enqueueSetState:function(e,t,n,r){A(e,"setState")}},k=Object.assign,P={};function L(e,t,n){this.props=e,this.context=t,this.refs=P,this.updater=n||N}Object.freeze(P),L.prototype.isReactComponent={},L.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw new Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},L.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};var D={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]},M=function(e,t){Object.defineProperty(L.prototype,e,{get:function(){R("%s(...) is deprecated in plain JavaScript React classes. %s",t[0],t[1])}})};for(var x in D)D.hasOwnProperty(x)&&M(x,D[x]);function U(){}function F(e,t,n){this.props=e,this.context=t,this.refs=P,this.updater=n||N}U.prototype=L.prototype;var $=F.prototype=new U;$.constructor=F,k($,L.prototype),$.isPureReactComponent=!0;var j=Array.isArray;function V(e){return j(e)}function B(e){return""+e}function G(e){if(function(e){try{return B(e),!1}catch(e){return!0}}(e))return C("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",function(e){return"function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object"}(e)),B(e)}function H(e){return e.displayName||"Context"}function W(e){if(null==e)return null;if("number"==typeof e.tag&&C("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case i:return"Fragment";case r:return"Portal";case a:return"Profiler";case o:return"StrictMode";case l:return"Suspense";case d:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case c:return H(e)+".Consumer";case s:return H(e._context)+".Provider";case u:return function(e,t,n){var r=e.displayName;if(r)return r;var i=t.displayName||t.name||"";return""!==i?n+"("+i+")":n}(e,e.render,"ForwardRef");case h:var t=e.displayName||null;return null!==t?t:W(e.type)||"Memo";case p:var n=e._payload,f=e._init;try{return W(f(n))}catch(e){return null}}return null}var q,z,K,Y=Object.prototype.hasOwnProperty,X={key:!0,ref:!0,__self:!0,__source:!0};function J(e){if(Y.call(e,"ref")){var t=Object.getOwnPropertyDescriptor(e,"ref").get;if(t&&t.isReactWarning)return!1}return void 0!==e.ref}function Q(e){if(Y.call(e,"key")){var t=Object.getOwnPropertyDescriptor(e,"key").get;if(t&&t.isReactWarning)return!1}return void 0!==e.key}K={};var Z=function(e,t,r,i,o,a,s){var c={$$typeof:n,type:e,key:t,ref:r,props:s,_owner:a,_store:{}};return Object.defineProperty(c._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(c,"_self",{configurable:!1,enumerable:!1,writable:!1,value:i}),Object.defineProperty(c,"_source",{configurable:!1,enumerable:!1,writable:!1,value:o}),Object.freeze&&(Object.freeze(c.props),Object.freeze(c)),c};function ee(e,t,n){var r,i={},o=null,a=null,s=null,c=null;if(null!=t)for(r in J(t)&&(a=t.ref,function(e){if("string"==typeof e.ref&&_.current&&e.__self&&_.current.stateNode!==e.__self){var t=W(_.current.type);K[t]||(C('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',t,e.ref),K[t]=!0)}}(t)),Q(t)&&(G(t.key),o=""+t.key),s=void 0===t.__self?null:t.__self,c=void 0===t.__source?null:t.__source,t)Y.call(t,r)&&!X.hasOwnProperty(r)&&(i[r]=t[r]);var u=arguments.length-2;if(1===u)i.children=n;else if(u>1){for(var l=Array(u),d=0;d<u;d++)l[d]=arguments[d+2];Object.freeze&&Object.freeze(l),i.children=l}if(e&&e.defaultProps){var h=e.defaultProps;for(r in h)void 0===i[r]&&(i[r]=h[r])}if(o||a){var p="function"==typeof e?e.displayName||e.name||"Unknown":e;o&&function(e,t){var n=function(){q||(q=!0,C("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"key",{get:n,configurable:!0})}(i,p),a&&function(e,t){var n=function(){z||(z=!0,C("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",t))};n.isReactWarning=!0,Object.defineProperty(e,"ref",{get:n,configurable:!0})}(i,p)}return Z(e,o,a,s,c,_.current,i)}function te(e,t,n){if(null==e)throw new Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r,i,o=k({},e.props),a=e.key,s=e.ref,c=e._self,u=e._source,l=e._owner;if(null!=t)for(r in J(t)&&(s=t.ref,l=_.current),Q(t)&&(G(t.key),a=""+t.key),e.type&&e.type.defaultProps&&(i=e.type.defaultProps),t)Y.call(t,r)&&!X.hasOwnProperty(r)&&(o[r]=void 0===t[r]&&void 0!==i?i[r]:t[r]);var d=arguments.length-2;if(1===d)o.children=n;else if(d>1){for(var h=Array(d),p=0;p<d;p++)h[p]=arguments[p+2];o.children=h}return Z(e.type,a,s,c,u,l,o)}function ne(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var re,ie=!1,oe=/\/+/g;function ae(e){return e.replace(oe,"$&/")}function se(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(G(e.key),n={"=":"=0",":":"=2"},"$"+(""+e.key).replace(/[=:]/g,function(e){return n[e]})):t.toString(36);var n}function ce(e,t,i,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var c,u,l,d=!1;if(null===e)d=!0;else switch(s){case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case n:case r:d=!0}}if(d){var h=e,p=a(h),f=""===o?"."+se(h,0):o;if(V(p)){var m="";null!=f&&(m=ae(f)+"/"),ce(p,t,m,"",function(e){return e})}else null!=p&&(ne(p)&&(!p.key||h&&h.key===p.key||G(p.key),c=p,u=i+(!p.key||h&&h.key===p.key?"":ae(""+p.key)+"/")+f,p=Z(c.type,u,c.ref,c._self,c._source,c._owner,c.props)),t.push(p));return 1}var v=0,E=""===o?".":o+":";if(V(e))for(var y=0;y<e.length;y++)v+=ce(l=e[y],t,i,E+se(l,y),a);else{var _=g(e);if("function"==typeof _){var b=e;_===b.entries&&(ie||R("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),ie=!0);for(var S,w=_.call(b),T=0;!(S=w.next()).done;)v+=ce(l=S.value,t,i,E+se(l,T++),a)}else if("object"===s){var C=String(e);throw new Error("Objects are not valid as a React child (found: "+("[object Object]"===C?"object with keys {"+Object.keys(e).join(", ")+"}":C)+"). If you meant to render a collection of children, use an array instead.")}}return v}function ue(e,t,n){if(null==e)return e;var r=[],i=0;return ce(e,r,"","",function(e){return t.call(n,e,i++)}),r}function le(e){if(-1===e._status){var t=(0,e._result)();if(t.then(function(t){if(0===e._status||-1===e._status){var n=e;n._status=1,n._result=t}},function(t){if(0===e._status||-1===e._status){var n=e;n._status=2,n._result=t}}),-1===e._status){var n=e;n._status=0,n._result=t}}if(1===e._status){var r=e._result;return void 0===r&&C("lazy: Expected the result of a dynamic import() call. Instead received: %s\n\nYour code should look like: \n  const MyComponent = lazy(() => import('./MyComponent'))\n\nDid you accidentally put curly braces around the import?",r),"default"in r||C("lazy: Expected the result of a dynamic import() call. Instead received: %s\n\nYour code should look like: \n  const MyComponent = lazy(() => import('./MyComponent'))",r),r.default}throw e._result}function de(e){return"string"==typeof e||"function"==typeof e||e===i||e===a||e===o||e===l||e===d||e===f||"object"==typeof e&&null!==e&&(e.$$typeof===p||e.$$typeof===h||e.$$typeof===s||e.$$typeof===c||e.$$typeof===u||e.$$typeof===re||void 0!==e.getModuleId)}function he(){var e=v.current;return null===e&&C("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem."),e}re=Symbol.for("react.module.reference");var pe,fe,me,ge,ve,Ee,ye,_e=0;function be(){}be.__reactDisabledLog=!0;var Se,we=T.ReactCurrentDispatcher;function Te(e,t,n){if(void 0===Se)try{throw Error()}catch(e){var r=e.stack.trim().match(/\n( *(at )?)/);Se=r&&r[1]||""}return"\n"+Se+e}var Re,Ce=!1,Ie="function"==typeof WeakMap?WeakMap:Map;function Oe(e,t){if(!e||Ce)return"";var n,r=Re.get(e);if(void 0!==r)return r;Ce=!0;var i,o=Error.prepareStackTrace;Error.prepareStackTrace=void 0,i=we.current,we.current=null,function(){if(0===_e){pe=console.log,fe=console.info,me=console.warn,ge=console.error,ve=console.group,Ee=console.groupCollapsed,ye=console.groupEnd;var e={configurable:!0,enumerable:!0,value:be,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}_e++}();try{if(t){var a=function(){throw Error()};if(Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(a,[])}catch(e){n=e}Reflect.construct(e,[],a)}else{try{a.call()}catch(e){n=e}e.call(a.prototype)}}else{try{throw Error()}catch(e){n=e}e()}}catch(t){if(t&&n&&"string"==typeof t.stack){for(var s=t.stack.split("\n"),c=n.stack.split("\n"),u=s.length-1,l=c.length-1;u>=1&&l>=0&&s[u]!==c[l];)l--;for(;u>=1&&l>=0;u--,l--)if(s[u]!==c[l]){if(1!==u||1!==l)do{if(u--,--l<0||s[u]!==c[l]){var d="\n"+s[u].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),"function"==typeof e&&Re.set(e,d),d}}while(u>=1&&l>=0);break}}}finally{Ce=!1,we.current=i,function(){if(0==--_e){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:k({},e,{value:pe}),info:k({},e,{value:fe}),warn:k({},e,{value:me}),error:k({},e,{value:ge}),group:k({},e,{value:ve}),groupCollapsed:k({},e,{value:Ee}),groupEnd:k({},e,{value:ye})})}_e<0&&C("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=o}var h=e?e.displayName||e.name:"",p=h?Te(h):"";return"function"==typeof e&&Re.set(e,p),p}function Ae(e,t,n){if(null==e)return"";if("function"==typeof e)return Oe(e,function(e){var t=e.prototype;return!(!t||!t.isReactComponent)}(e));if("string"==typeof e)return Te(e);switch(e){case l:return Te("Suspense");case d:return Te("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case u:return function(e){return Oe(e,!1)}(e.render);case h:return Ae(e.type,t,n);case p:var r=e._payload,i=e._init;try{return Ae(i(r),t,n)}catch(e){}}return""}Re=new Ie;var Ne,ke={},Pe=T.ReactDebugCurrentFrame;function Le(e){if(e){var t=e._owner,n=Ae(e.type,e._source,t?t.type:null);Pe.setExtraStackFrame(n)}else Pe.setExtraStackFrame(null)}function De(e){if(e){var t=e._owner;w(Ae(e.type,e._source,t?t.type:null))}else w(null)}function Me(){if(_.current){var e=W(_.current.type);if(e)return"\n\nCheck the render method of `"+e+"`."}return""}Ne=!1;var xe={};function Ue(e,t){if(e._store&&!e._store.validated&&null==e.key){e._store.validated=!0;var n=function(e){var t=Me();if(!t){var n="string"==typeof e?e:e.displayName||e.name;n&&(t="\n\nCheck the top-level render call using <"+n+">.")}return t}(t);if(!xe[n]){xe[n]=!0;var r="";e&&e._owner&&e._owner!==_.current&&(r=" It was passed a child from "+W(e._owner.type)+"."),De(e),C('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',n,r),De(null)}}}function Fe(e,t){if("object"==typeof e)if(V(e))for(var n=0;n<e.length;n++){var r=e[n];ne(r)&&Ue(r,t)}else if(ne(e))e._store&&(e._store.validated=!0);else if(e){var i=g(e);if("function"==typeof i&&i!==e.entries)for(var o,a=i.call(e);!(o=a.next()).done;)ne(o.value)&&Ue(o.value,t)}}function $e(e){var t,n=e.type;if(null!=n&&"string"!=typeof n){if("function"==typeof n)t=n.propTypes;else{if("object"!=typeof n||n.$$typeof!==u&&n.$$typeof!==h)return;t=n.propTypes}if(t){var r=W(n);!function(e,t,n,r,i){var o=Function.call.bind(Y);for(var a in e)if(o(e,a)){var s=void 0;try{if("function"!=typeof e[a]){var c=Error((r||"React class")+": "+n+" type `"+a+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[a]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw c.name="Invariant Violation",c}s=e[a](t,a,r,n,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(e){s=e}!s||s instanceof Error||(Le(i),C("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",r||"React class",n,a,typeof s),Le(null)),s instanceof Error&&!(s.message in ke)&&(ke[s.message]=!0,Le(i),C("Failed %s type: %s",n,s.message),Le(null))}}(t,e.props,"prop",r,e)}else void 0===n.PropTypes||Ne||(Ne=!0,C("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",W(n)||"Unknown"));"function"!=typeof n.getDefaultProps||n.getDefaultProps.isReactClassApproved||C("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function je(e,t,r){var o,a,s=de(e);if(!s){var c,u="";(void 0===e||"object"==typeof e&&null!==e&&0===Object.keys(e).length)&&(u+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports."),u+=(null!=(o=t)&&void 0!==(a=o.__source)?"\n\nCheck your code at "+a.fileName.replace(/^.*[\\\/]/,"")+":"+a.lineNumber+".":"")||Me(),null===e?c="null":V(e)?c="array":void 0!==e&&e.$$typeof===n?(c="<"+(W(e.type)||"Unknown")+" />",u=" Did you accidentally export a JSX literal instead of a component?"):c=typeof e,C("React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",c,u)}var l=ee.apply(this,arguments);if(null==l)return l;if(s)for(var d=2;d<arguments.length;d++)Fe(arguments[d],e);return e===i?function(e){for(var t=Object.keys(e.props),n=0;n<t.length;n++){var r=t[n];if("children"!==r&&"key"!==r){De(e),C("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",r),De(null);break}}null!==e.ref&&(De(e),C("Invalid attribute `ref` supplied to `React.Fragment`."),De(null))}(l):$e(l),l}var Ve=!1,Be=!1,Ge=null,He=0,We=!1;function qe(e){var t=He;He++,null===y.current&&(y.current=[]);var n,r=y.isBatchingLegacy;try{if(y.isBatchingLegacy=!0,n=e(),!r&&y.didScheduleLegacyUpdate){var i=y.current;null!==i&&(y.didScheduleLegacyUpdate=!1,Xe(i))}}catch(e){throw ze(t),e}finally{y.isBatchingLegacy=r}if(null!==n&&"object"==typeof n&&"function"==typeof n.then){var o=n,a=!1,s={then:function(e,n){a=!0,o.then(function(r){ze(t),0===He?Ke(r,e,n):e(r)},function(e){ze(t),n(e)})}};return We||"undefined"==typeof Promise||Promise.resolve().then(function(){}).then(function(){a||(We=!0,C("You called act(async () => ...) without await. This could lead to unexpected testing behaviour, interleaving multiple act calls and mixing their scopes. You should - await act(async () => ...);"))}),s}var c=n;if(ze(t),0===He){var u=y.current;return null!==u&&(Xe(u),y.current=null),{then:function(e,t){null===y.current?(y.current=[],Ke(c,e,t)):e(c)}}}return{then:function(e,t){e(c)}}}function ze(e){e!==He-1&&C("You seem to have overlapping act() calls, this is not supported. Be sure to await previous act() calls before making a new one. "),He=e}function Ke(t,n,r){var i=y.current;if(null!==i)try{Xe(i),function(){if(null===Ge)try{var o=("require"+Math.random()).slice(0,7);Ge=(e&&e[o]).call(e,"timers").setImmediate}catch(e){Ge=function(e){!1===Be&&(Be=!0,"undefined"==typeof MessageChannel&&C("This browser does not have a MessageChannel implementation, so enqueuing tasks via await act(async () => ...) will fail. Please file an issue at https://github.com/facebook/react/issues if you encounter this warning."));var t=new MessageChannel;t.port1.onmessage=e,t.port2.postMessage(void 0)}}Ge(function(){0===i.length?(y.current=null,n(t)):Ke(t,n,r)})}()}catch(e){r(e)}else n(t)}var Ye=!1;function Xe(e){if(!Ye){Ye=!0;var t=0;try{for(;t<e.length;t++){var n=e[t];do{n=n(!0)}while(null!==n)}e.length=0}catch(n){throw e=e.slice(t+1),n}finally{Ye=!1}}}var Je=je,Qe={map:ue,forEach:function(e,t,n){ue(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return ue(e,function(){t++}),t},toArray:function(e){return ue(e,function(e){return e})||[]},only:function(e){if(!ne(e))throw new Error("React.Children.only expected to receive a single React element child.");return e}};t.Children=Qe,t.Component=L,t.Fragment=i,t.Profiler=a,t.PureComponent=F,t.StrictMode=o,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=T,t.act=qe,t.cloneElement=function(e,t,n){for(var r=te.apply(this,arguments),i=2;i<arguments.length;i++)Fe(arguments[i],r.type);return $e(r),r},t.createContext=function(e){var t={$$typeof:c,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null};t.Provider={$$typeof:s,_context:t};var n=!1,r=!1,i=!1,o={$$typeof:c,_context:t};return Object.defineProperties(o,{Provider:{get:function(){return r||(r=!0,C("Rendering <Context.Consumer.Provider> is not supported and will be removed in a future major release. Did you mean to render <Context.Provider> instead?")),t.Provider},set:function(e){t.Provider=e}},_currentValue:{get:function(){return t._currentValue},set:function(e){t._currentValue=e}},_currentValue2:{get:function(){return t._currentValue2},set:function(e){t._currentValue2=e}},_threadCount:{get:function(){return t._threadCount},set:function(e){t._threadCount=e}},Consumer:{get:function(){return n||(n=!0,C("Rendering <Context.Consumer.Consumer> is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?")),t.Consumer}},displayName:{get:function(){return t.displayName},set:function(e){i||(R("Setting `displayName` on Context.Consumer has no effect. You should set it directly on the context with Context.displayName = '%s'.",e),i=!0)}}}),t.Consumer=o,t._currentRenderer=null,t._currentRenderer2=null,t},t.createElement=Je,t.createFactory=function(e){var t=je.bind(null,e);return t.type=e,Ve||(Ve=!0,R("React.createFactory() is deprecated and will be removed in a future major release. Consider using JSX or use React.createElement() directly instead.")),Object.defineProperty(t,"type",{enumerable:!1,get:function(){return R("Factory.type is deprecated. Access the class directly before passing it to createFactory."),Object.defineProperty(this,"type",{value:e}),e}}),t},t.createRef=function(){var e={current:null};return Object.seal(e),e},t.forwardRef=function(e){null!=e&&e.$$typeof===h?C("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):"function"!=typeof e?C("forwardRef requires a render function but was given %s.",null===e?"null":typeof e):0!==e.length&&2!==e.length&&C("forwardRef render functions accept exactly two parameters: props and ref. %s",1===e.length?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),null!=e&&(null==e.defaultProps&&null==e.propTypes||C("forwardRef render functions do not support propTypes or defaultProps. Did you accidentally pass a React component?"));var t,n={$$typeof:u,render:e};return Object.defineProperty(n,"displayName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(n){t=n,e.name||e.displayName||(e.displayName=n)}}),n},t.isValidElement=ne,t.lazy=function(e){var t,n,r={$$typeof:p,_payload:{_status:-1,_result:e},_init:le};return Object.defineProperties(r,{defaultProps:{configurable:!0,get:function(){return t},set:function(e){C("React.lazy(...): It is not supported to assign `defaultProps` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),t=e,Object.defineProperty(r,"defaultProps",{enumerable:!0})}},propTypes:{configurable:!0,get:function(){return n},set:function(e){C("React.lazy(...): It is not supported to assign `propTypes` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),n=e,Object.defineProperty(r,"propTypes",{enumerable:!0})}}}),r},t.memo=function(e,t){de(e)||C("memo: The first argument must be a component. Instead received: %s",null===e?"null":typeof e);var n,r={$$typeof:h,type:e,compare:void 0===t?null:t};return Object.defineProperty(r,"displayName",{enumerable:!1,configurable:!0,get:function(){return n},set:function(t){n=t,e.name||e.displayName||(e.displayName=t)}}),r},t.startTransition=function(e,t){var n=E.transition;E.transition={};var r=E.transition;E.transition._updatedFibers=new Set;try{e()}finally{E.transition=n,null===n&&r._updatedFibers&&(r._updatedFibers.size>10&&R("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),r._updatedFibers.clear())}},t.unstable_act=qe,t.useCallback=function(e,t){return he().useCallback(e,t)},t.useContext=function(e){var t=he();if(void 0!==e._context){var n=e._context;n.Consumer===e?C("Calling useContext(Context.Consumer) is not supported, may cause bugs, and will be removed in a future major release. Did you mean to call useContext(Context) instead?"):n.Provider===e&&C("Calling useContext(Context.Provider) is not supported. Did you mean to call useContext(Context) instead?")}return t.useContext(e)},t.useDebugValue=function(e,t){return he().useDebugValue(e,t)},t.useDeferredValue=function(e){return he().useDeferredValue(e)},t.useEffect=function(e,t){return he().useEffect(e,t)},t.useId=function(){return he().useId()},t.useImperativeHandle=function(e,t,n){return he().useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return he().useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return he().useLayoutEffect(e,t)},t.useMemo=function(e,t){return he().useMemo(e,t)},t.useReducer=function(e,t,n){return he().useReducer(e,t,n)},t.useRef=function(e){return he().useRef(e)},t.useState=function(e){return he().useState(e)},t.useSyncExternalStore=function(e,t,n){return he().useSyncExternalStore(e,t,n)},t.useTransition=function(){return he().useTransition()},t.version="18.3.1","undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()}),react=createCommonjsModule(function(e){e.exports="production"===process.env.NODE_ENV?react_production_min:react_development}),scheduler_production_min=createCommonjsModule(function(e,t){function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var s=2*(r+1)-1,c=e[s],u=s+1,l=e[u];if(0>o(c,n))u<i&&0>o(l,c)?(e[r]=l,e[u]=n,r=u):(e[r]=c,e[s]=n,r=s);else{if(!(u<i&&0>o(l,n)))break e;e[r]=l,e[u]=n,r=u}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,c=s.now();t.unstable_now=function(){return s.now()-c}}var u=[],l=[],d=1,h=null,p=3,f=!1,m=!1,g=!1,v="function"==typeof setTimeout?setTimeout:null,E="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function _(e){for(var t=r(l);null!==t;){if(null===t.callback)i(l);else{if(!(t.startTime<=e))break;i(l),t.sortIndex=t.expirationTime,n(u,t)}t=r(l)}}function b(e){if(g=!1,_(e),!m)if(null!==r(u))m=!0,L(S);else{var t=r(l);null!==t&&D(b,t.startTime-e)}}function S(e,n){m=!1,g&&(g=!1,E(C),C=-1),f=!0;var o=p;try{for(_(n),h=r(u);null!==h&&(!(h.expirationTime>n)||e&&!A());){var a=h.callback;if("function"==typeof a){h.callback=null,p=h.priorityLevel;var s=a(h.expirationTime<=n);n=t.unstable_now(),"function"==typeof s?h.callback=s:h===r(u)&&i(u),_(n)}else i(u);h=r(u)}if(null!==h)var c=!0;else{var d=r(l);null!==d&&D(b,d.startTime-n),c=!1}return c}finally{h=null,p=o,f=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,T=!1,R=null,C=-1,I=5,O=-1;function A(){return!(t.unstable_now()-O<I)}function N(){if(null!==R){var e=t.unstable_now();O=e;var n=!0;try{n=R(!0,e)}finally{n?w():(T=!1,R=null)}}else T=!1}if("function"==typeof y)w=function(){y(N)};else if("undefined"!=typeof MessageChannel){var k=new MessageChannel,P=k.port2;k.port1.onmessage=N,w=function(){P.postMessage(null)}}else w=function(){v(N,0)};function L(e){R=e,T||(T=!0,w())}function D(e,n){C=v(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,L(S))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(u)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,i,o){var a=t.unstable_now();switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?a+o:a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,n(l,e),null===r(u)&&e===r(l)&&(g?(E(C),C=-1):g=!0,D(b,o-a))):(e.sortIndex=s,n(u,e),m||f||(m=!0,L(S))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}}),scheduler_development=createCommonjsModule(function(e,t){"production"!==process.env.NODE_ENV&&function(){function e(e,t){var n=e.length;e.push(t),function(e,t,n){for(var r=n;r>0;){var o=r-1>>>1,a=e[o];if(!(i(a,t)>0))return;e[o]=t,e[r]=a,r=o}}(e,t,n)}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();return n!==t&&(e[0]=n,function(e,t){for(var n=0,r=e.length,o=r>>>1;n<o;){var a=2*(n+1)-1,s=e[a],c=a+1,u=e[c];if(i(s,t)<0)c<r&&i(u,s)<0?(e[n]=u,e[c]=t,n=c):(e[n]=s,e[a]=t,n=a);else{if(!(c<r&&i(u,t)<0))return;e[n]=u,e[c]=t,n=c}}}(e,n)),t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error),"object"==typeof performance&&"function"==typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();t.unstable_now=function(){return a.now()-s}}var c=[],u=[],l=1,d=null,h=3,p=!1,f=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,E="undefined"!=typeof setImmediate?setImmediate:null;function y(t){for(var i=n(u);null!==i;){if(null===i.callback)r(u);else{if(!(i.startTime<=t))return;r(u),i.sortIndex=i.expirationTime,e(c,i)}i=n(u)}}function _(e){if(m=!1,y(e),!f)if(null!==n(c))f=!0,P(b);else{var t=n(u);null!==t&&L(_,t.startTime-e)}}function b(e,i){f=!1,m&&(m=!1,D()),p=!0;var o=h;try{return function(e,i){var o=i;for(y(o),d=n(c);null!==d&&(!(d.expirationTime>o)||e&&!I());){var a=d.callback;if("function"==typeof a){d.callback=null,h=d.priorityLevel;var s=a(d.expirationTime<=o);o=t.unstable_now(),"function"==typeof s?d.callback=s:d===n(c)&&r(c),y(o)}else r(c);d=n(c)}if(null!==d)return!0;var l=n(u);return null!==l&&L(_,l.startTime-o),!1}(e,i)}finally{d=null,h=o,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S=!1,w=null,T=-1,R=5,C=-1;function I(){return!(t.unstable_now()-C<R)}var O,A=function(){if(null!==w){var e=t.unstable_now();C=e;var n=!0;try{n=w(!0,e)}finally{n?O():(S=!1,w=null)}}else S=!1};if("function"==typeof E)O=function(){E(A)};else if("undefined"!=typeof MessageChannel){var N=new MessageChannel,k=N.port2;N.port1.onmessage=A,O=function(){k.postMessage(null)}}else O=function(){g(A,0)};function P(e){w=e,S||(S=!0,O())}function L(e,n){T=g(function(){e(t.unstable_now())},n)}function D(){v(T),T=-1}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||p||(f=!0,P(b))},t.unstable_forceFrameRate=function(e){e<0||e>125?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=e>0?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){var t;switch(h){case 1:case 2:case 3:t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},t.unstable_scheduleCallback=function(r,i,o){var a,s,d=t.unstable_now();if("object"==typeof o&&null!==o){var h=o.delay;a="number"==typeof h&&h>0?d+h:d}else a=d;switch(r){case 1:s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}var g=a+s,v={id:l++,callback:i,priorityLevel:r,startTime:a,expirationTime:g,sortIndex:-1};return a>d?(v.sortIndex=a,e(u,v),null===n(c)&&v===n(u)&&(m?D():m=!0,L(_,a-d))):(v.sortIndex=g,e(c,v),f||p||(f=!0,P(b))),v},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()}),scheduler=createCommonjsModule(function(e){e.exports="production"===process.env.NODE_ENV?scheduler_production_min:scheduler_development});function p$1(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da$1=new Set,ea$1={};function fa$1(e,t){ha$1(e,t),ha$1(e+"Capture",t)}function ha$1(e,t){for(ea$1[e]=t,e=0;e<t.length;e++)da$1.add(t[e])}var ia$1=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),ja$1=Object.prototype.hasOwnProperty,ka$1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la$1={},ma$1={};function oa$1(e){return!!ja$1.call(ma$1,e)||!ja$1.call(la$1,e)&&(ka$1.test(e)?ma$1[e]=!0:(la$1[e]=!0,!1))}function pa$1(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}function qa$1(e,t,n,r){if(null==t||pa$1(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function v$1(e,t,n,r,i,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var z$1={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){z$1[e]=new v$1(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];z$1[t]=new v$1(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){z$1[e]=new v$1(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){z$1[e]=new v$1(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){z$1[e]=new v$1(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){z$1[e]=new v$1(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){z$1[e]=new v$1(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){z$1[e]=new v$1(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){z$1[e]=new v$1(e,5,!1,e.toLowerCase(),null,!1,!1)});var ra$1=/[\-:]([a-z])/g;function sa$1(e){return e[1].toUpperCase()}function ta$1(e,t,n,r){var i=z$1.hasOwnProperty(t)?z$1[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(qa$1(t,n,i,r)&&(n=null),r||null===i?oa$1(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(ra$1,sa$1);z$1[t]=new v$1(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(ra$1,sa$1);z$1[t]=new v$1(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(ra$1,sa$1);z$1[t]=new v$1(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){z$1[e]=new v$1(e,1,!1,e.toLowerCase(),null,!1,!1)}),z$1.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){z$1[e]=new v$1(e,1,!1,e.toLowerCase(),null,!0,!0)});var ua$1=react.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va$1=Symbol.for("react.element"),wa$1=Symbol.for("react.portal"),ya$1=Symbol.for("react.fragment"),za$1=Symbol.for("react.strict_mode"),Aa$1=Symbol.for("react.profiler"),Ba$1=Symbol.for("react.provider"),Ca$1=Symbol.for("react.context"),Da$1=Symbol.for("react.forward_ref"),Ea$1=Symbol.for("react.suspense"),Fa$1=Symbol.for("react.suspense_list"),Ga$1=Symbol.for("react.memo"),Ha$1=Symbol.for("react.lazy"),Ia$1=Symbol.for("react.offscreen"),Ja$1=Symbol.iterator;function Ka$1(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=Ja$1&&e[Ja$1]||e["@@iterator"])?e:null}var A$1=Object.assign,La$1;function Ma$1(e){if(void 0===La$1)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);La$1=t&&t[1]||""}return"\n"+La$1+e}var Na$1=!1;function Oa$1(e,t){if(!e||Na$1)return"";Na$1=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var i=t.stack.split("\n"),o=r.stack.split("\n"),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||i[a]!==o[s]){var c="\n"+i[a].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}}while(1<=a&&0<=s);break}}}finally{Na$1=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Ma$1(e):""}function Pa$1(e){switch(e.tag){case 5:return Ma$1(e.type);case 16:return Ma$1("Lazy");case 13:return Ma$1("Suspense");case 19:return Ma$1("SuspenseList");case 0:case 2:case 15:return Oa$1(e.type,!1);case 11:return Oa$1(e.type.render,!1);case 1:return Oa$1(e.type,!0);default:return""}}function Qa$1(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case ya$1:return"Fragment";case wa$1:return"Portal";case Aa$1:return"Profiler";case za$1:return"StrictMode";case Ea$1:return"Suspense";case Fa$1:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case Ca$1:return(e.displayName||"Context")+".Consumer";case Ba$1:return(e._context.displayName||"Context")+".Provider";case Da$1:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case Ga$1:return null!==(t=e.displayName||null)?t:Qa$1(e.type)||"Memo";case Ha$1:t=e._payload,e=e._init;try{return Qa$1(e(t))}catch(e){}}return null}function Ra$1(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa$1(t);case 8:return t===za$1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function Sa$1(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function Ta$1(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Ua$1(e){var t=Ta$1(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Va$1(e){e._valueTracker||(e._valueTracker=Ua$1(e))}function Wa$1(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=Ta$1(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Xa$1(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Ya$1(e,t){var n=t.checked;return A$1({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Za$1(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=Sa$1(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function ab$1(e,t){null!=(t=t.checked)&&ta$1(e,"checked",t,!1)}function bb$1(e,t){ab$1(e,t);var n=Sa$1(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?cb$1(e,t.type,n):t.hasOwnProperty("defaultValue")&&cb$1(e,t.type,Sa$1(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function db$1(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(("submit"===r||"reset"===r)&&null==t.value)return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function cb$1(e,t,n){"number"===t&&Xa$1(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var eb$1=Array.isArray;function fb$1(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Sa$1(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function gb$1(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(p$1(91));return A$1({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function hb$1(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(p$1(92));if(eb$1(n)){if(1<n.length)throw Error(p$1(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:Sa$1(n)}}function ib$1(e,t){var n=Sa$1(t.value),r=Sa$1(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function jb$1(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function kb$1(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb$1(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?kb$1(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var mb$1,nb$1=function(e){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction(function(){return e(t,n)})}:e}(function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((mb$1=mb$1||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=mb$1.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ob$1(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var pb$1={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb$1=["Webkit","ms","Moz","O"];function rb$1(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||pb$1.hasOwnProperty(e)&&pb$1[e]?(""+t).trim():t+"px"}function sb$1(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=rb$1(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(pb$1).forEach(function(e){qb$1.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pb$1[t]=pb$1[e]})});var tb$1=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub$1(e,t){if(t){if(tb$1[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(p$1(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(p$1(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(p$1(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(p$1(62))}}function vb$1(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb$1=null;function xb$1(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var yb$1=null,zb$1=null,Ab$1=null;function Bb$1(e){if(e=Cb$1(e)){if("function"!=typeof yb$1)throw Error(p$1(280));var t=e.stateNode;t&&(t=Db$1(t),yb$1(e.stateNode,e.type,t))}}function Eb$1(e){zb$1?Ab$1?Ab$1.push(e):Ab$1=[e]:zb$1=e}function Fb$1(){if(zb$1){var e=zb$1,t=Ab$1;if(Ab$1=zb$1=null,Bb$1(e),t)for(e=0;e<t.length;e++)Bb$1(t[e])}}function Gb$1(e,t){return e(t)}function Hb$1(){}var Ib$1=!1;function Jb$1(e,t,n){if(Ib$1)return e(t,n);Ib$1=!0;try{return Gb$1(e,t,n)}finally{Ib$1=!1,(null!==zb$1||null!==Ab$1)&&(Hb$1(),Fb$1())}}function Kb$1(e,t){var n=e.stateNode;if(null===n)return null;var r=Db$1(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(p$1(231,t,typeof n));return n}var Lb$1=!1;if(ia$1)try{var Mb$1={};Object.defineProperty(Mb$1,"passive",{get:function(){Lb$1=!0}}),window.addEventListener("test",Mb$1,Mb$1),window.removeEventListener("test",Mb$1,Mb$1)}catch(a){Lb$1=!1}function Nb$1(e,t,n,r,i,o,a,s,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(e){this.onError(e)}}var Ob$1=!1,Pb$1=null,Qb$1=!1,Rb$1=null,Sb$1={onError:function(e){Ob$1=!0,Pb$1=e}};function Tb$1(e,t,n,r,i,o,a,s,c){Ob$1=!1,Pb$1=null,Nb$1.apply(Sb$1,arguments)}function Ub$1(e,t,n,r,i,o,a,s,c){if(Tb$1.apply(this,arguments),Ob$1){if(!Ob$1)throw Error(p$1(198));var u=Pb$1;Ob$1=!1,Pb$1=null,Qb$1||(Qb$1=!0,Rb$1=u)}}function Vb$1(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Wb$1(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function Xb$1(e){if(Vb$1(e)!==e)throw Error(p$1(188))}function Yb$1(e){var t=e.alternate;if(!t){if(null===(t=Vb$1(e)))throw Error(p$1(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return Xb$1(i),e;if(o===r)return Xb$1(i),t;o=o.sibling}throw Error(p$1(188))}if(n.return!==r.return)n=i,r=o;else{for(var a=!1,s=i.child;s;){if(s===n){a=!0,n=i,r=o;break}if(s===r){a=!0,r=i,n=o;break}s=s.sibling}if(!a){for(s=o.child;s;){if(s===n){a=!0,n=o,r=i;break}if(s===r){a=!0,r=o,n=i;break}s=s.sibling}if(!a)throw Error(p$1(189))}}if(n.alternate!==r)throw Error(p$1(190))}if(3!==n.tag)throw Error(p$1(188));return n.stateNode.current===n?e:t}function Zb$1(e){return null!==(e=Yb$1(e))?$b$1(e):null}function $b$1(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=$b$1(e);if(null!==t)return t;e=e.sibling}return null}var ac$1=scheduler.unstable_scheduleCallback,bc$1=scheduler.unstable_cancelCallback,cc$1=scheduler.unstable_shouldYield,dc$1=scheduler.unstable_requestPaint,B$1=scheduler.unstable_now,ec$1=scheduler.unstable_getCurrentPriorityLevel,fc$1=scheduler.unstable_ImmediatePriority,gc$1=scheduler.unstable_UserBlockingPriority,hc$1=scheduler.unstable_NormalPriority,ic$1=scheduler.unstable_LowPriority,jc$1=scheduler.unstable_IdlePriority,kc$1=null,lc$1=null;function mc$1(e){if(lc$1&&"function"==typeof lc$1.onCommitFiberRoot)try{lc$1.onCommitFiberRoot(kc$1,e,void 0,!(128&~e.current.flags))}catch(e){}}var oc$1=Math.clz32?Math.clz32:nc$1,pc$1=Math.log,qc$1=Math.LN2;function nc$1(e){return 0==(e>>>=0)?32:31-(pc$1(e)/qc$1|0)|0}var rc$1=64,sc$1=4194304;function tc$1(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function uc$1(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,a=268435455&n;if(0!==a){var s=a&~i;0!==s?r=tc$1(s):0!=(o&=a)&&(r=tc$1(o))}else 0!=(a=n&~i)?r=tc$1(a):0!==o&&(r=tc$1(o));if(0===r)return 0;if(0!==t&&t!==r&&!(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&4194240&o))return t;if(4&r&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)r|=e[n=31-oc$1(t)],t&=~(i=1<<n);return r}function vc$1(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function wc$1(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-oc$1(o),s=1<<a,c=i[a];-1===c?s&n&&!(s&r)||(i[a]=vc$1(s,t)):c<=t&&(e.expiredLanes|=s),o&=~s}}function xc$1(e){return 0!=(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function yc$1(){var e=rc$1;return!(4194240&(rc$1<<=1))&&(rc$1=64),e}function zc$1(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ac$1(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-oc$1(t)]=n}function Bc$1(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-oc$1(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}function Cc$1(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-oc$1(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var C$1=0;function Dc$1(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var Ec$1,Fc$1,Gc$1,Hc$1,Ic$1,Jc$1=!1,Kc$1=[],Lc$1=null,Mc$1=null,Nc$1=null,Oc$1=new Map,Pc$1=new Map,Qc$1=[],Rc$1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc$1(e,t){switch(e){case"focusin":case"focusout":Lc$1=null;break;case"dragenter":case"dragleave":Mc$1=null;break;case"mouseover":case"mouseout":Nc$1=null;break;case"pointerover":case"pointerout":Oc$1.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc$1.delete(t.pointerId)}}function Tc$1(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&null!==(t=Cb$1(t))&&Fc$1(t),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Uc$1(e,t,n,r,i){switch(t){case"focusin":return Lc$1=Tc$1(Lc$1,e,t,n,r,i),!0;case"dragenter":return Mc$1=Tc$1(Mc$1,e,t,n,r,i),!0;case"mouseover":return Nc$1=Tc$1(Nc$1,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return Oc$1.set(o,Tc$1(Oc$1.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return Pc$1.set(o=i.pointerId,Tc$1(Pc$1.get(o)||null,e,t,n,r,i)),!0}return!1}function Vc$1(e){var t=Wc$1(e.target);if(null!==t){var n=Vb$1(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Wb$1(n)))return e.blockedOn=t,void Ic$1(e.priority,function(){Gc$1(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Xc$1(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yc$1(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=Cb$1(n))&&Fc$1(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);wb$1=r,n.target.dispatchEvent(r),wb$1=null,t.shift()}return!0}function Zc$1(e,t,n){Xc$1(e)&&n.delete(t)}function $c$1(){Jc$1=!1,null!==Lc$1&&Xc$1(Lc$1)&&(Lc$1=null),null!==Mc$1&&Xc$1(Mc$1)&&(Mc$1=null),null!==Nc$1&&Xc$1(Nc$1)&&(Nc$1=null),Oc$1.forEach(Zc$1),Pc$1.forEach(Zc$1)}function ad$1(e,t){e.blockedOn===t&&(e.blockedOn=null,Jc$1||(Jc$1=!0,scheduler.unstable_scheduleCallback(scheduler.unstable_NormalPriority,$c$1)))}function bd$1(e){function t(t){return ad$1(t,e)}if(0<Kc$1.length){ad$1(Kc$1[0],e);for(var n=1;n<Kc$1.length;n++){var r=Kc$1[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Lc$1&&ad$1(Lc$1,e),null!==Mc$1&&ad$1(Mc$1,e),null!==Nc$1&&ad$1(Nc$1,e),Oc$1.forEach(t),Pc$1.forEach(t),n=0;n<Qc$1.length;n++)(r=Qc$1[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Qc$1.length&&null===(n=Qc$1[0]).blockedOn;)Vc$1(n),null===n.blockedOn&&Qc$1.shift()}var cd$1=ua$1.ReactCurrentBatchConfig,dd$1=!0;function ed$1(e,t,n,r){var i=C$1,o=cd$1.transition;cd$1.transition=null;try{C$1=1,fd$1(e,t,n,r)}finally{C$1=i,cd$1.transition=o}}function gd$1(e,t,n,r){var i=C$1,o=cd$1.transition;cd$1.transition=null;try{C$1=4,fd$1(e,t,n,r)}finally{C$1=i,cd$1.transition=o}}function fd$1(e,t,n,r){if(dd$1){var i=Yc$1(e,t,n,r);if(null===i)hd$1(e,t,r,id$1,n),Sc$1(e,r);else if(Uc$1(i,e,t,n,r))r.stopPropagation();else if(Sc$1(e,r),4&t&&-1<Rc$1.indexOf(e)){for(;null!==i;){var o=Cb$1(i);if(null!==o&&Ec$1(o),null===(o=Yc$1(e,t,n,r))&&hd$1(e,t,r,id$1,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else hd$1(e,t,r,null,n)}}var id$1=null;function Yc$1(e,t,n,r){if(id$1=null,null!==(e=Wc$1(e=xb$1(r))))if(null===(t=Vb$1(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Wb$1(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return id$1=e,null}function jd$1(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec$1()){case fc$1:return 1;case gc$1:return 4;case hc$1:case ic$1:return 16;case jc$1:return 536870912;default:return 16}default:return 16}}var kd$1=null,ld$1=null,md$1=null;function nd$1(){if(md$1)return md$1;var e,t,n=ld$1,r=n.length,i="value"in kd$1?kd$1.value:kd$1.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return md$1=i.slice(e,1<t?1-t:void 0)}function od$1(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function pd$1(){return!0}function qd$1(){return!1}function rd$1(e){function t(t,n,r,i,o){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(this[a]=(t=e[a])?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?pd$1:qd$1,this.isPropagationStopped=qd$1,this}return A$1(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=pd$1)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=pd$1)},persist:function(){},isPersistent:pd$1}),t}var sd$1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td$1=rd$1(sd$1),ud$1=A$1({},sd$1,{view:0,detail:0}),vd$1=rd$1(ud$1),wd$1,xd$1,yd$1,Ad$1=A$1({},ud$1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd$1,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yd$1&&(yd$1&&"mousemove"===e.type?(wd$1=e.screenX-yd$1.screenX,xd$1=e.screenY-yd$1.screenY):xd$1=wd$1=0,yd$1=e),wd$1)},movementY:function(e){return"movementY"in e?e.movementY:xd$1}}),Bd$1=rd$1(Ad$1),Cd$1=A$1({},Ad$1,{dataTransfer:0}),Dd$1=rd$1(Cd$1),Ed$1=A$1({},ud$1,{relatedTarget:0}),Fd$1=rd$1(Ed$1),Gd$1=A$1({},sd$1,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd$1=rd$1(Gd$1),Id$1=A$1({},sd$1,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Jd$1=rd$1(Id$1),Kd$1=A$1({},sd$1,{data:0}),Ld$1=rd$1(Kd$1),Md$1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd$1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od$1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd$1(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Od$1[e])&&!!t[e]}function zd$1(){return Pd$1}var Qd$1=A$1({},ud$1,{key:function(e){if(e.key){var t=Md$1[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=od$1(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Nd$1[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd$1,charCode:function(e){return"keypress"===e.type?od$1(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?od$1(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Rd$1=rd$1(Qd$1),Sd$1=A$1({},Ad$1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td$1=rd$1(Sd$1),Ud$1=A$1({},ud$1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd$1}),Vd$1=rd$1(Ud$1),Wd$1=A$1({},sd$1,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd$1=rd$1(Wd$1),Yd$1=A$1({},Ad$1,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd$1=rd$1(Yd$1),$d$1=[9,13,27,32],ae$1=ia$1&&"CompositionEvent"in window,be$1=null;ia$1&&"documentMode"in document&&(be$1=document.documentMode);var ce$1=ia$1&&"TextEvent"in window&&!be$1,de$1=ia$1&&(!ae$1||be$1&&8<be$1&&11>=be$1),ee$1=String.fromCharCode(32),fe$1=!1;function ge$1(e,t){switch(e){case"keyup":return-1!==$d$1.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var ie$1=!1;function je$1(e,t){switch(e){case"compositionend":return he$1(t);case"keypress":return 32!==t.which?null:(fe$1=!0,ee$1);case"textInput":return(e=t.data)===ee$1&&fe$1?null:e;default:return null}}function ke$1(e,t){if(ie$1)return"compositionend"===e||!ae$1&&ge$1(e,t)?(e=nd$1(),md$1=ld$1=kd$1=null,ie$1=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return de$1&&"ko"!==t.locale?null:t.data}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!le$1[e.type]:"textarea"===t}function ne$1(e,t,n,r){Eb$1(r),0<(t=oe$1(t,"onChange")).length&&(n=new td$1("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var pe$1=null,qe$1=null;function re$1(e){se$1(e,0)}function te$1(e){if(Wa$1(ue$1(e)))return e}function ve$1(e,t){if("change"===e)return t}var we$1=!1;if(ia$1){var xe$1;if(ia$1){var ye$1="oninput"in document;if(!ye$1){var ze$1=document.createElement("div");ze$1.setAttribute("oninput","return;"),ye$1="function"==typeof ze$1.oninput}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$1&&(pe$1.detachEvent("onpropertychange",Be$1),qe$1=pe$1=null)}function Be$1(e){if("value"===e.propertyName&&te$1(qe$1)){var t=[];ne$1(t,qe$1,e,xb$1(e)),Jb$1(re$1,t)}}function Ce$1(e,t,n){"focusin"===e?(Ae$1(),qe$1=n,(pe$1=t).attachEvent("onpropertychange",Be$1)):"focusout"===e&&Ae$1()}function De$1(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return te$1(qe$1)}function Ee$1(e,t){if("click"===e)return te$1(t)}function Fe$1(e,t){if("input"===e||"change"===e)return te$1(t)}function Ge$1(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t}var He$1="function"==typeof Object.is?Object.is:Ge$1;function Ie$1(e,t){if(He$1(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!ja$1.call(t,i)||!He$1(e[i],t[i]))return!1}return!0}function Je$1(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ke$1(e,t){var n,r=Je$1(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Je$1(r)}}function Le$1(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?Le$1(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function Me$1(){for(var e=window,t=Xa$1();t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(!n)break;t=Xa$1((e=t.contentWindow).document)}return t}function Ne$1(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function Oe$1(e){var t=Me$1(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Le$1(n.ownerDocument.documentElement,n)){if(null!==r&&Ne$1(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=Ke$1(n,o);var a=Ke$1(n,r);i&&a&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"==typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Pe$1=ia$1&&"documentMode"in document&&11>=document.documentMode,Qe$1=null,Re$1=null,Se$1=null,Te$1=!1;function Ue$1(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;Te$1||null==Qe$1||Qe$1!==Xa$1(r)||(r="selectionStart"in(r=Qe$1)&&Ne$1(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},Se$1&&Ie$1(Se$1,r)||(Se$1=r,0<(r=oe$1(Re$1,"onSelect")).length&&(t=new td$1("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=Qe$1)))}function Ve$1(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var We$1={animationend:Ve$1("Animation","AnimationEnd"),animationiteration:Ve$1("Animation","AnimationIteration"),animationstart:Ve$1("Animation","AnimationStart"),transitionend:Ve$1("Transition","TransitionEnd")},Xe$1={},Ye$1={};function Ze$1(e){if(Xe$1[e])return Xe$1[e];if(!We$1[e])return e;var t,n=We$1[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ye$1)return Xe$1[e]=n[t];return e}ia$1&&(Ye$1=document.createElement("div").style,"AnimationEvent"in window||(delete We$1.animationend.animation,delete We$1.animationiteration.animation,delete We$1.animationstart.animation),"TransitionEvent"in window||delete We$1.transitionend.transition);var $e$1=Ze$1("animationend"),af$1=Ze$1("animationiteration"),bf$1=Ze$1("animationstart"),cf$1=Ze$1("transitionend"),df$1=new Map,ef$1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff$1(e,t){df$1.set(e,t),fa$1(t,[e])}for(var gf$1=0;gf$1<ef$1.length;gf$1++){var hf$1=ef$1[gf$1],jf$1=hf$1.toLowerCase(),kf$1=hf$1[0].toUpperCase()+hf$1.slice(1);ff$1(jf$1,"on"+kf$1)}ff$1($e$1,"onAnimationEnd"),ff$1(af$1,"onAnimationIteration"),ff$1(bf$1,"onAnimationStart"),ff$1("dblclick","onDoubleClick"),ff$1("focusin","onFocus"),ff$1("focusout","onBlur"),ff$1(cf$1,"onTransitionEnd"),ha$1("onMouseEnter",["mouseout","mouseover"]),ha$1("onMouseLeave",["mouseout","mouseover"]),ha$1("onPointerEnter",["pointerout","pointerover"]),ha$1("onPointerLeave",["pointerout","pointerover"]),fa$1("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fa$1("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fa$1("onBeforeInput",["compositionend","keypress","textInput","paste"]),fa$1("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fa$1("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fa$1("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf$1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf$1=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf$1));function nf$1(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,Ub$1(r,t,void 0,e),e.currentTarget=null}function se$1(e,t){t=!!(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var a=r.length-1;0<=a;a--){var s=r[a],c=s.instance,u=s.currentTarget;if(s=s.listener,c!==o&&i.isPropagationStopped())break e;nf$1(i,s,u),o=c}else for(a=0;a<r.length;a++){if(c=(s=r[a]).instance,u=s.currentTarget,s=s.listener,c!==o&&i.isPropagationStopped())break e;nf$1(i,s,u),o=c}}}if(Qb$1)throw e=Rb$1,Qb$1=!1,Rb$1=null,e}function D$1(e,t){var n=t[of$1];void 0===n&&(n=t[of$1]=new Set);var r=e+"__bubble";n.has(r)||(pf$1(t,e,2,!1),n.add(r))}function qf$1(e,t,n){var r=0;t&&(r|=4),pf$1(n,e,r,t)}var rf$1="_reactListening"+Math.random().toString(36).slice(2);function sf$1(e){if(!e[rf$1]){e[rf$1]=!0,da$1.forEach(function(t){"selectionchange"!==t&&(mf$1.has(t)||qf$1(t,!1,e),qf$1(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[rf$1]||(t[rf$1]=!0,qf$1("selectionchange",!1,t))}}function pf$1(e,t,n,r){switch(jd$1(t)){case 1:var i=ed$1;break;case 4:i=gd$1;break;default:i=fd$1}n=i.bind(null,t,n,e),i=void 0,!Lb$1||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),e.addEventListener(t,n,r?void 0===i||{capture:!0,passive:i}:void 0!==i&&{passive:i})}function hd$1(e,t,n,r,i){var o=r;if(!(1&t||2&t||null===r))e:for(;;){if(null===r)return;var a=r.tag;if(3===a||4===a){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===a)for(a=r.return;null!==a;){var c=a.tag;if((3===c||4===c)&&((c=a.stateNode.containerInfo)===i||8===c.nodeType&&c.parentNode===i))return;a=a.return}for(;null!==s;){if(null===(a=Wc$1(s)))return;if(5===(c=a.tag)||6===c){r=o=a;continue e}s=s.parentNode}}r=r.return}Jb$1(function(){var r=o,i=xb$1(n),a=[];e:{var s=df$1.get(e);if(void 0!==s){var c=td$1,u=e;switch(e){case"keypress":if(0===od$1(n))break e;case"keydown":case"keyup":c=Rd$1;break;case"focusin":u="focus",c=Fd$1;break;case"focusout":u="blur",c=Fd$1;break;case"beforeblur":case"afterblur":c=Fd$1;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=Bd$1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=Dd$1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=Vd$1;break;case $e$1:case af$1:case bf$1:c=Hd$1;break;case cf$1:c=Xd$1;break;case"scroll":c=vd$1;break;case"wheel":c=Zd$1;break;case"copy":case"cut":case"paste":c=Jd$1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=Td$1}var l=!!(4&t),d=!l&&"scroll"===e,h=l?null!==s?s+"Capture":null:s;l=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==h&&null!=(m=Kb$1(f,h))&&l.push(tf$1(f,m,p))),d)break;f=f.return}0<l.length&&(s=new c(s,u,null,n,i),a.push({event:s,listeners:l}))}}if(!(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===wb$1||!(u=n.relatedTarget||n.fromElement)||!Wc$1(u)&&!u[uf$1])&&(c||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,c?(c=r,null!==(u=(u=n.relatedTarget||n.toElement)?Wc$1(u):null)&&(u!==(d=Vb$1(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(c=null,u=r),c!==u)){if(l=Bd$1,m="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(l=Td$1,m="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==c?s:ue$1(c),p=null==u?s:ue$1(u),(s=new l(m,f+"leave",c,n,i)).target=d,s.relatedTarget=p,m=null,Wc$1(i)===r&&((l=new l(h,f+"enter",u,n,i)).target=p,l.relatedTarget=d,m=l),d=m,c&&u)e:{for(h=u,f=0,p=l=c;p;p=vf$1(p))f++;for(p=0,m=h;m;m=vf$1(m))p++;for(;0<f-p;)l=vf$1(l),f--;for(;0<p-f;)h=vf$1(h),p--;for(;f--;){if(l===h||null!==h&&l===h.alternate)break e;l=vf$1(l),h=vf$1(h)}l=null}else l=null;null!==c&&wf$1(a,s,c,l,!1),null!==u&&null!==d&&wf$1(a,d,u,l,!0)}if("select"===(c=(s=r?ue$1(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type)var g=ve$1;else if(me$1(s))if(we$1)g=Fe$1;else{g=De$1;var v=Ce$1}else(c=s.nodeName)&&"input"===c.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=Ee$1);switch(g&&(g=g(e,r))?ne$1(a,g,n,i):(v&&v(e,s,r),"focusout"===e&&(v=s._wrapperState)&&v.controlled&&"number"===s.type&&cb$1(s,"number",s.value)),v=r?ue$1(r):window,e){case"focusin":(me$1(v)||"true"===v.contentEditable)&&(Qe$1=v,Re$1=r,Se$1=null);break;case"focusout":Se$1=Re$1=Qe$1=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue$1(a,n,i);break;case"selectionchange":if(Pe$1)break;case"keydown":case"keyup":Ue$1(a,n,i)}var E;if(ae$1)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else ie$1?ge$1(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(de$1&&"ko"!==n.locale&&(ie$1||"onCompositionStart"!==y?"onCompositionEnd"===y&&ie$1&&(E=nd$1()):(ld$1="value"in(kd$1=i)?kd$1.value:kd$1.textContent,ie$1=!0)),0<(v=oe$1(r,y)).length&&(y=new Ld$1(y,e,null,n,i),a.push({event:y,listeners:v}),(E||null!==(E=he$1(n)))&&(y.data=E))),(E=ce$1?je$1(e,n):ke$1(e,n))&&0<(r=oe$1(r,"onBeforeInput")).length&&(i=new Ld$1("onBeforeInput","beforeinput",null,n,i),a.push({event:i,listeners:r}),i.data=E)}se$1(a,t)})}function tf$1(e,t,n){return{instance:e,listener:t,currentTarget:n}}function oe$1(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Kb$1(e,n))&&r.unshift(tf$1(e,o,i)),null!=(o=Kb$1(e,t))&&r.push(tf$1(e,o,i))),e=e.return}return r}function vf$1(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function wf$1(e,t,n,r,i){for(var o=t._reactName,a=[];null!==n&&n!==r;){var s=n,c=s.alternate,u=s.stateNode;if(null!==c&&c===r)break;5===s.tag&&null!==u&&(s=u,i?null!=(c=Kb$1(n,o))&&a.unshift(tf$1(n,c,s)):i||null!=(c=Kb$1(n,o))&&a.push(tf$1(n,c,s))),n=n.return}0!==a.length&&e.push({event:t,listeners:a})}var xf$1=/\r\n?/g,yf$1=/\u0000|\uFFFD/g;function zf$1(e){return("string"==typeof e?e:""+e).replace(xf$1,"\n").replace(yf$1,"")}function Af$1(e,t,n){if(t=zf$1(t),zf$1(e)!==t&&n)throw Error(p$1(425))}function Bf$1(){}var Cf$1=null,Df$1=null;function Ef$1(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Ff$1="function"==typeof setTimeout?setTimeout:void 0,Gf$1="function"==typeof clearTimeout?clearTimeout:void 0,Hf$1="function"==typeof Promise?Promise:void 0,Jf$1="function"==typeof queueMicrotask?queueMicrotask:void 0!==Hf$1?function(e){return Hf$1.resolve(null).then(e).catch(If$1)}:Ff$1;function If$1(e){setTimeout(function(){throw e})}function Kf$1(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void bd$1(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);bd$1(t)}function Lf$1(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function Mf$1(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Nf$1=Math.random().toString(36).slice(2),Of$1="__reactFiber$"+Nf$1,Pf$1="__reactProps$"+Nf$1,uf$1="__reactContainer$"+Nf$1,of$1="__reactEvents$"+Nf$1,Qf$1="__reactListeners$"+Nf$1,Rf$1="__reactHandles$"+Nf$1;function Wc$1(e){var t=e[Of$1];if(t)return t;for(var n=e.parentNode;n;){if(t=n[uf$1]||n[Of$1]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Mf$1(e);null!==e;){if(n=e[Of$1])return n;e=Mf$1(e)}return t}n=(e=n).parentNode}return null}function Cb$1(e){return!(e=e[Of$1]||e[uf$1])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ue$1(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(p$1(33))}function Db$1(e){return e[Pf$1]||null}var Sf$1=[],Tf$1=-1;function Uf$1(e){return{current:e}}function E$1(e){0>Tf$1||(e.current=Sf$1[Tf$1],Sf$1[Tf$1]=null,Tf$1--)}function G$1(e,t){Tf$1++,Sf$1[Tf$1]=e.current,e.current=t}var Vf$1={},H$1=Uf$1(Vf$1),Wf$1=Uf$1(!1),Xf$1=Vf$1;function Yf$1(e,t){var n=e.type.contextTypes;if(!n)return Vf$1;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Zf$1(e){return null!=e.childContextTypes}function $f$1(){E$1(Wf$1),E$1(H$1)}function ag$1(e,t,n){if(H$1.current!==Vf$1)throw Error(p$1(168));G$1(H$1,t),G$1(Wf$1,n)}function bg$1(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(p$1(108,Ra$1(e)||"Unknown",i));return A$1({},n,r)}function cg$1(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vf$1,Xf$1=H$1.current,G$1(H$1,e),G$1(Wf$1,Wf$1.current),!0}function dg$1(e,t,n){var r=e.stateNode;if(!r)throw Error(p$1(169));n?(e=bg$1(e,t,Xf$1),r.__reactInternalMemoizedMergedChildContext=e,E$1(Wf$1),E$1(H$1),G$1(H$1,e)):E$1(Wf$1),G$1(Wf$1,n)}var eg$1=null,fg$1=!1,gg$1=!1;function hg$1(e){null===eg$1?eg$1=[e]:eg$1.push(e)}function ig$1(e){fg$1=!0,hg$1(e)}function jg$1(){if(!gg$1&&null!==eg$1){gg$1=!0;var e=0,t=C$1;try{var n=eg$1;for(C$1=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}eg$1=null,fg$1=!1}catch(t){throw null!==eg$1&&(eg$1=eg$1.slice(e+1)),ac$1(fc$1,jg$1),t}finally{C$1=t,gg$1=!1}}return null}var kg$1=[],lg$1=0,mg$1=null,ng$1=0,og$1=[],pg$1=0,qg$1=null,rg$1=1,sg$1="";function tg$1(e,t){kg$1[lg$1++]=ng$1,kg$1[lg$1++]=mg$1,mg$1=e,ng$1=t}function ug$1(e,t,n){og$1[pg$1++]=rg$1,og$1[pg$1++]=sg$1,og$1[pg$1++]=qg$1,qg$1=e;var r=rg$1;e=sg$1;var i=32-oc$1(r)-1;r&=~(1<<i),n+=1;var o=32-oc$1(t)+i;if(30<o){var a=i-i%5;o=(r&(1<<a)-1).toString(32),r>>=a,i-=a,rg$1=1<<32-oc$1(t)+i|n<<i|r,sg$1=o+e}else rg$1=1<<o|n<<i|r,sg$1=e}function vg$1(e){null!==e.return&&(tg$1(e,1),ug$1(e,1,0))}function wg$1(e){for(;e===mg$1;)mg$1=kg$1[--lg$1],kg$1[lg$1]=null,ng$1=kg$1[--lg$1],kg$1[lg$1]=null;for(;e===qg$1;)qg$1=og$1[--pg$1],og$1[pg$1]=null,sg$1=og$1[--pg$1],og$1[pg$1]=null,rg$1=og$1[--pg$1],og$1[pg$1]=null}var xg$1=null,yg$1=null,I$1=!1,zg$1=null;function Ag$1(e,t){var n=Bg$1(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function Cg$1(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,xg$1=e,yg$1=Lf$1(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,xg$1=e,yg$1=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(e.memoizedState={dehydrated:t,treeContext:n=null!==qg$1?{id:rg$1,overflow:sg$1}:null,retryLane:1073741824},(n=Bg$1(18,null,null,0)).stateNode=t,n.return=e,e.child=n,xg$1=e,yg$1=null,!0);default:return!1}}function Dg$1(e){return!(!(1&e.mode)||128&e.flags)}function Eg$1(e){if(I$1){var t=yg$1;if(t){var n=t;if(!Cg$1(e,t)){if(Dg$1(e))throw Error(p$1(418));t=Lf$1(n.nextSibling);var r=xg$1;t&&Cg$1(e,t)?Ag$1(r,n):(e.flags=-4097&e.flags|2,I$1=!1,xg$1=e)}}else{if(Dg$1(e))throw Error(p$1(418));e.flags=-4097&e.flags|2,I$1=!1,xg$1=e}}}function Fg$1(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;xg$1=e}function Gg$1(e){if(e!==xg$1)return!1;if(!I$1)return Fg$1(e),I$1=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!Ef$1(e.type,e.memoizedProps)),t&&(t=yg$1)){if(Dg$1(e))throw Hg$1(),Error(p$1(418));for(;t;)Ag$1(e,t),t=Lf$1(t.nextSibling)}if(Fg$1(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(p$1(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){yg$1=Lf$1(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}yg$1=null}}else yg$1=xg$1?Lf$1(e.stateNode.nextSibling):null;return!0}function Hg$1(){for(var e=yg$1;e;)e=Lf$1(e.nextSibling)}function Ig$1(){yg$1=xg$1=null,I$1=!1}function Jg$1(e){null===zg$1?zg$1=[e]:zg$1.push(e)}var Kg$1=ua$1.ReactCurrentBatchConfig;function Lg$1(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(p$1(309));var r=n.stateNode}if(!r)throw Error(p$1(147,e));var i=r,o=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=i.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!=typeof e)throw Error(p$1(284));if(!n._owner)throw Error(p$1(290,e))}return e}function Mg$1(e,t){throw e=Object.prototype.toString.call(t),Error(p$1(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ng$1(e){return(0,e._init)(e._payload)}function Og$1(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)e.set(null!==t.key?t.key:t.index,t),t=t.sibling;return e}function i(e,t){return(e=Pg$1(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function s(e,t,n,r){return null===t||6!==t.tag?((t=Qg$1(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type;return o===ya$1?l(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"==typeof o&&null!==o&&o.$$typeof===Ha$1&&Ng$1(o)===t.type)?((r=i(t,n.props)).ref=Lg$1(e,t,n),r.return=e,r):((r=Rg$1(n.type,n.key,n.props,null,e.mode,r)).ref=Lg$1(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Sg$1(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function l(e,t,n,r,o){return null===t||7!==t.tag?((t=Tg$1(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=Qg$1(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case va$1:return(n=Rg$1(t.type,t.key,t.props,null,e.mode,n)).ref=Lg$1(e,null,t),n.return=e,n;case wa$1:return(t=Sg$1(t,e.mode,n)).return=e,t;case Ha$1:return d(e,(0,t._init)(t._payload),n)}if(eb$1(t)||Ka$1(t))return(t=Tg$1(t,e.mode,n,null)).return=e,t;Mg$1(e,t)}return null}function h(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:s(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case va$1:return n.key===i?c(e,t,n,r):null;case wa$1:return n.key===i?u(e,t,n,r):null;case Ha$1:return h(e,t,(i=n._init)(n._payload),r)}if(eb$1(n)||Ka$1(n))return null!==i?null:l(e,t,n,r,null);Mg$1(e,n)}return null}function p(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return s(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case va$1:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case wa$1:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case Ha$1:return p(e,t,n,(0,r._init)(r._payload),i)}if(eb$1(r)||Ka$1(r))return l(t,e=e.get(n)||null,r,i,null);Mg$1(t,r)}return null}function f(i,a,s,c){for(var u=null,l=null,f=a,m=a=0,g=null;null!==f&&m<s.length;m++){f.index>m?(g=f,f=null):g=f.sibling;var v=h(i,f,s[m],c);if(null===v){null===f&&(f=g);break}e&&f&&null===v.alternate&&t(i,f),a=o(v,a,m),null===l?u=v:l.sibling=v,l=v,f=g}if(m===s.length)return n(i,f),I$1&&tg$1(i,m),u;if(null===f){for(;m<s.length;m++)null!==(f=d(i,s[m],c))&&(a=o(f,a,m),null===l?u=f:l.sibling=f,l=f);return I$1&&tg$1(i,m),u}for(f=r(i,f);m<s.length;m++)null!==(g=p(f,i,m,s[m],c))&&(e&&null!==g.alternate&&f.delete(null===g.key?m:g.key),a=o(g,a,m),null===l?u=g:l.sibling=g,l=g);return e&&f.forEach(function(e){return t(i,e)}),I$1&&tg$1(i,m),u}function m(i,a,s,c){var u=Ka$1(s);if("function"!=typeof u)throw Error(p$1(150));if(null==(s=u.call(s)))throw Error(p$1(151));for(var l=u=null,f=a,m=a=0,g=null,v=s.next();null!==f&&!v.done;m++,v=s.next()){f.index>m?(g=f,f=null):g=f.sibling;var E=h(i,f,v.value,c);if(null===E){null===f&&(f=g);break}e&&f&&null===E.alternate&&t(i,f),a=o(E,a,m),null===l?u=E:l.sibling=E,l=E,f=g}if(v.done)return n(i,f),I$1&&tg$1(i,m),u;if(null===f){for(;!v.done;m++,v=s.next())null!==(v=d(i,v.value,c))&&(a=o(v,a,m),null===l?u=v:l.sibling=v,l=v);return I$1&&tg$1(i,m),u}for(f=r(i,f);!v.done;m++,v=s.next())null!==(v=p(f,i,m,v.value,c))&&(e&&null!==v.alternate&&f.delete(null===v.key?m:v.key),a=o(v,a,m),null===l?u=v:l.sibling=v,l=v);return e&&f.forEach(function(e){return t(i,e)}),I$1&&tg$1(i,m),u}return function e(r,o,s,c){if("object"==typeof s&&null!==s&&s.type===ya$1&&null===s.key&&(s=s.props.children),"object"==typeof s&&null!==s){switch(s.$$typeof){case va$1:e:{for(var u=s.key,l=o;null!==l;){if(l.key===u){if((u=s.type)===ya$1){if(7===l.tag){n(r,l.sibling),(o=i(l,s.props.children)).return=r,r=o;break e}}else if(l.elementType===u||"object"==typeof u&&null!==u&&u.$$typeof===Ha$1&&Ng$1(u)===l.type){n(r,l.sibling),(o=i(l,s.props)).ref=Lg$1(r,l,s),o.return=r,r=o;break e}n(r,l);break}t(r,l),l=l.sibling}s.type===ya$1?((o=Tg$1(s.props.children,r.mode,c,s.key)).return=r,r=o):((c=Rg$1(s.type,s.key,s.props,null,r.mode,c)).ref=Lg$1(r,o,s),c.return=r,r=c)}return a(r);case wa$1:e:{for(l=s.key;null!==o;){if(o.key===l){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(r,o.sibling),(o=i(o,s.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=Sg$1(s,r.mode,c)).return=r,r=o}return a(r);case Ha$1:return e(r,o,(l=s._init)(s._payload),c)}if(eb$1(s))return f(r,o,s,c);if(Ka$1(s))return m(r,o,s,c);Mg$1(r,s)}return"string"==typeof s&&""!==s||"number"==typeof s?(s=""+s,null!==o&&6===o.tag?(n(r,o.sibling),(o=i(o,s)).return=r,r=o):(n(r,o),(o=Qg$1(s,r.mode,c)).return=r,r=o),a(r)):n(r,o)}}var Ug$1=Og$1(!0),Vg$1=Og$1(!1),Wg$1=Uf$1(null),Xg$1=null,Yg$1=null,Zg$1=null;function $g$1(){Zg$1=Yg$1=Xg$1=null}function ah$1(e){var t=Wg$1.current;E$1(Wg$1),e._currentValue=t}function bh$1(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function ch$1(e,t){Xg$1=e,Zg$1=Yg$1=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(!!(e.lanes&t)&&(dh$1=!0),e.firstContext=null)}function eh$1(e){var t=e._currentValue;if(Zg$1!==e)if(e={context:e,memoizedValue:t,next:null},null===Yg$1){if(null===Xg$1)throw Error(p$1(308));Yg$1=e,Xg$1.dependencies={lanes:0,firstContext:e}}else Yg$1=Yg$1.next=e;return t}var fh$1=null;function gh$1(e){null===fh$1?fh$1=[e]:fh$1.push(e)}function hh$1(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,gh$1(t)):(n.next=i.next,i.next=n),t.interleaved=n,ih$1(e,r)}function ih$1(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var jh$1=!1;function kh$1(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh$1(e,t){t.updateQueue===(e=e.updateQueue)&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mh$1(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function nh$1(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,2&K$1){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,ih$1(e,n)}return null===(i=r.interleaved)?(t.next=t,gh$1(r)):(t.next=i.next,i.next=t),r.interleaved=t,ih$1(e,n)}function oh$1(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;t.lanes=n|=r&=e.pendingLanes,Cc$1(e,n)}}function ph$1(e,t){var n=e.updateQueue,r=e.alternate;if(null===r||n!==(r=r.updateQueue))null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t;else{var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=a:o=o.next=a,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;e.updateQueue=n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects}}}function qh$1(e,t,n,r){var i=e.updateQueue;jh$1=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var c=s,u=c.next;c.next=null,null===a?o=u:a.next=u,a=c;var l=e.alternate;null!==l&&(s=(l=l.updateQueue).lastBaseUpdate)!==a&&(null===s?l.firstBaseUpdate=u:s.next=u,l.lastBaseUpdate=c)}if(null!==o){var d=i.baseState;for(a=0,l=u=c=null,s=o;;){var h=s.lane,p=s.eventTime;if((r&h)===h){null!==l&&(l=l.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(h=t,p=n,m.tag){case 1:if("function"==typeof(f=m.payload)){d=f.call(p,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(h="function"==typeof(f=m.payload)?f.call(p,d,h):f))break e;d=A$1({},d,h);break e;case 2:jh$1=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(u=l=p,c=d):l=l.next=p,a|=h;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(h=s).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===l&&(c=d),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=l,null!==(t=i.shared.interleaved)){i=t;do{a|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);rh$1|=a,e.lanes=a,e.memoizedState=d}}function sh$1(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(p$1(191,i));i.call(r)}}}var th$1={},uh$1=Uf$1(th$1),vh$1=Uf$1(th$1),wh$1=Uf$1(th$1);function xh$1(e){if(e===th$1)throw Error(p$1(174));return e}function yh$1(e,t){switch(G$1(wh$1,t),G$1(vh$1,e),G$1(uh$1,th$1),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:lb$1(null,"");break;default:t=lb$1(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}E$1(uh$1),G$1(uh$1,t)}function zh$1(){E$1(uh$1),E$1(vh$1),E$1(wh$1)}function Ah$1(e){xh$1(wh$1.current);var t=xh$1(uh$1.current),n=lb$1(t,e.type);t!==n&&(G$1(vh$1,e),G$1(uh$1,n))}function Bh$1(e){vh$1.current===e&&(E$1(uh$1),E$1(vh$1))}var L$1=Uf$1(0);function Ch$1(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Dh$1=[];function Eh$1(){for(var e=0;e<Dh$1.length;e++)Dh$1[e]._workInProgressVersionPrimary=null;Dh$1.length=0}var Fh$1=ua$1.ReactCurrentDispatcher,Gh$1=ua$1.ReactCurrentBatchConfig,Hh$1=0,M$1=null,N$1=null,O$1=null,Ih$1=!1,Jh$1=!1,Kh$1=0,Lh$1=0;function P$1(){throw Error(p$1(321))}function Mh$1(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!He$1(e[n],t[n]))return!1;return!0}function Nh$1(e,t,n,r,i,o){if(Hh$1=o,M$1=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Fh$1.current=null===e||null===e.memoizedState?Oh$1:Ph$1,e=n(r,i),Jh$1){o=0;do{if(Jh$1=!1,Kh$1=0,25<=o)throw Error(p$1(301));o+=1,O$1=N$1=null,t.updateQueue=null,Fh$1.current=Qh$1,e=n(r,i)}while(Jh$1)}if(Fh$1.current=Rh$1,t=null!==N$1&&null!==N$1.next,Hh$1=0,O$1=N$1=M$1=null,Ih$1=!1,t)throw Error(p$1(300));return e}function Sh$1(){var e=0!==Kh$1;return Kh$1=0,e}function Th$1(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===O$1?M$1.memoizedState=O$1=e:O$1=O$1.next=e,O$1}function Uh$1(){if(null===N$1){var e=M$1.alternate;e=null!==e?e.memoizedState:null}else e=N$1.next;var t=null===O$1?M$1.memoizedState:O$1.next;if(null!==t)O$1=t,N$1=e;else{if(null===e)throw Error(p$1(310));e={memoizedState:(N$1=e).memoizedState,baseState:N$1.baseState,baseQueue:N$1.baseQueue,queue:N$1.queue,next:null},null===O$1?M$1.memoizedState=O$1=e:O$1=O$1.next=e}return O$1}function Vh$1(e,t){return"function"==typeof t?t(e):t}function Wh$1(e){var t=Uh$1(),n=t.queue;if(null===n)throw Error(p$1(311));n.lastRenderedReducer=e;var r=N$1,i=r.baseQueue,o=n.pending;if(null!==o){if(null!==i){var a=i.next;i.next=o.next,o.next=a}r.baseQueue=i=o,n.pending=null}if(null!==i){r=r.baseState;var s=a=null,c=null,u=o=i.next;do{var l=u.lane;if((Hh$1&l)===l)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:l,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(s=c=d,a=r):c=c.next=d,M$1.lanes|=l,rh$1|=l}u=u.next}while(null!==u&&u!==o);null===c?a=r:c.next=s,He$1(r,t.memoizedState)||(dh$1=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{M$1.lanes|=o=i.lane,rh$1|=o,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Xh$1(e){var t=Uh$1(),n=t.queue;if(null===n)throw Error(p$1(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{o=e(o,a.action),a=a.next}while(a!==i);He$1(o,t.memoizedState)||(dh$1=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Yh$1(){}function Zh$1(e,t){var n=M$1,r=Uh$1(),i=t(),o=!He$1(r.memoizedState,i);if(o&&(r.memoizedState=i,dh$1=!0),$h$1(ai$1.bind(null,n,r=r.queue,e),[e]),r.getSnapshot!==t||o||null!==O$1&&1&O$1.memoizedState.tag){if(n.flags|=2048,bi$1(9,ci$1.bind(null,n,r,i,t),void 0,null),null===Q$1)throw Error(p$1(349));30&Hh$1||di$1(n,t,i)}return i}function di$1(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=M$1.updateQueue)?(M$1.updateQueue=t={lastEffect:null,stores:null},t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function ci$1(e,t,n,r){t.value=n,t.getSnapshot=r,ei$1(t)&&fi$1(e)}function ai$1(e,t,n){return n(function(){ei$1(t)&&fi$1(e)})}function ei$1(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!He$1(e,n)}catch(e){return!0}}function fi$1(e){var t=ih$1(e,1);null!==t&&gi$1(t,e,1,-1)}function hi$1(e){var t=Th$1();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,t.queue=e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh$1,lastRenderedState:e},e=e.dispatch=ii$1.bind(null,M$1,e),[t.memoizedState,e]}function bi$1(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=M$1.updateQueue)?(M$1.updateQueue=t={lastEffect:null,stores:null},t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function ji$1(){return Uh$1().memoizedState}function ki$1(e,t,n,r){var i=Th$1();M$1.flags|=e,i.memoizedState=bi$1(1|t,n,void 0,void 0===r?null:r)}function li$1(e,t,n,r){var i=Uh$1();r=void 0===r?null:r;var o=void 0;if(null!==N$1){var a=N$1.memoizedState;if(o=a.destroy,null!==r&&Mh$1(r,a.deps))return void(i.memoizedState=bi$1(t,n,o,r))}M$1.flags|=e,i.memoizedState=bi$1(1|t,n,o,r)}function mi$1(e,t){return ki$1(8390656,8,e,t)}function $h$1(e,t){return li$1(2048,8,e,t)}function ni$1(e,t){return li$1(4,2,e,t)}function oi$1(e,t){return li$1(4,4,e,t)}function pi$1(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function qi$1(e,t,n){return n=null!=n?n.concat([e]):null,li$1(4,4,pi$1.bind(null,t,e),n)}function ri$1(){}function si$1(e,t){var n=Uh$1();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Mh$1(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function ti$1(e,t){var n=Uh$1();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Mh$1(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function ui$1(e,t,n){return 21&Hh$1?(He$1(n,t)||(n=yc$1(),M$1.lanes|=n,rh$1|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,dh$1=!0),e.memoizedState=n)}function vi$1(e,t){var n=C$1;C$1=0!==n&&4>n?n:4,e(!0);var r=Gh$1.transition;Gh$1.transition={};try{e(!1),t()}finally{C$1=n,Gh$1.transition=r}}function wi$1(){return Uh$1().memoizedState}function xi$1(e,t,n){var r=yi$1(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},zi$1(e)?Ai$1(t,n):null!==(n=hh$1(e,t,n,r))&&(gi$1(n,e,r,R$1()),Bi$1(n,t,r))}function ii$1(e,t,n){var r=yi$1(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(zi$1(e))Ai$1(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,n);if(i.hasEagerState=!0,i.eagerState=s,He$1(s,a)){var c=t.interleaved;return null===c?(i.next=i,gh$1(t)):(i.next=c.next,c.next=i),void(t.interleaved=i)}}catch(e){}null!==(n=hh$1(e,t,i,r))&&(gi$1(n,e,r,i=R$1()),Bi$1(n,t,r))}}function zi$1(e){var t=e.alternate;return e===M$1||null!==t&&t===M$1}function Ai$1(e,t){Jh$1=Ih$1=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Bi$1(e,t,n){if(4194240&n){var r=t.lanes;t.lanes=n|=r&=e.pendingLanes,Cc$1(e,n)}}var Rh$1={readContext:eh$1,useCallback:P$1,useContext:P$1,useEffect:P$1,useImperativeHandle:P$1,useInsertionEffect:P$1,useLayoutEffect:P$1,useMemo:P$1,useReducer:P$1,useRef:P$1,useState:P$1,useDebugValue:P$1,useDeferredValue:P$1,useTransition:P$1,useMutableSource:P$1,useSyncExternalStore:P$1,useId:P$1,unstable_isNewReconciler:!1},Oh$1={readContext:eh$1,useCallback:function(e,t){return Th$1().memoizedState=[e,void 0===t?null:t],e},useContext:eh$1,useEffect:mi$1,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,ki$1(4194308,4,pi$1.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ki$1(4194308,4,e,t)},useInsertionEffect:function(e,t){return ki$1(4,2,e,t)},useMemo:function(e,t){var n=Th$1();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Th$1();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,r.queue=e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},e=e.dispatch=xi$1.bind(null,M$1,e),[r.memoizedState,e]},useRef:function(e){return Th$1().memoizedState={current:e}},useState:hi$1,useDebugValue:ri$1,useDeferredValue:function(e){return Th$1().memoizedState=e},useTransition:function(){var e=hi$1(!1),t=e[0];return e=vi$1.bind(null,e[1]),Th$1().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=M$1,i=Th$1();if(I$1){if(void 0===n)throw Error(p$1(407));n=n()}else{if(n=t(),null===Q$1)throw Error(p$1(349));30&Hh$1||di$1(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,mi$1(ai$1.bind(null,r,o,e),[e]),r.flags|=2048,bi$1(9,ci$1.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Th$1(),t=Q$1.identifierPrefix;if(I$1){var n=sg$1;t=":"+t+"R"+(n=(rg$1&~(1<<32-oc$1(rg$1)-1)).toString(32)+n),0<(n=Kh$1++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Lh$1++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Ph$1={readContext:eh$1,useCallback:si$1,useContext:eh$1,useEffect:$h$1,useImperativeHandle:qi$1,useInsertionEffect:ni$1,useLayoutEffect:oi$1,useMemo:ti$1,useReducer:Wh$1,useRef:ji$1,useState:function(){return Wh$1(Vh$1)},useDebugValue:ri$1,useDeferredValue:function(e){return ui$1(Uh$1(),N$1.memoizedState,e)},useTransition:function(){return[Wh$1(Vh$1)[0],Uh$1().memoizedState]},useMutableSource:Yh$1,useSyncExternalStore:Zh$1,useId:wi$1,unstable_isNewReconciler:!1},Qh$1={readContext:eh$1,useCallback:si$1,useContext:eh$1,useEffect:$h$1,useImperativeHandle:qi$1,useInsertionEffect:ni$1,useLayoutEffect:oi$1,useMemo:ti$1,useReducer:Xh$1,useRef:ji$1,useState:function(){return Xh$1(Vh$1)},useDebugValue:ri$1,useDeferredValue:function(e){var t=Uh$1();return null===N$1?t.memoizedState=e:ui$1(t,N$1.memoizedState,e)},useTransition:function(){return[Xh$1(Vh$1)[0],Uh$1().memoizedState]},useMutableSource:Yh$1,useSyncExternalStore:Zh$1,useId:wi$1,unstable_isNewReconciler:!1};function Ci$1(e,t){if(e&&e.defaultProps){for(var n in t=A$1({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function Di$1(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:A$1({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Ei$1={isMounted:function(e){return!!(e=e._reactInternals)&&Vb$1(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=R$1(),i=yi$1(e),o=mh$1(r,i);o.payload=t,null!=n&&(o.callback=n),null!==(t=nh$1(e,o,i))&&(gi$1(t,e,i,r),oh$1(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=R$1(),i=yi$1(e),o=mh$1(r,i);o.tag=1,o.payload=t,null!=n&&(o.callback=n),null!==(t=nh$1(e,o,i))&&(gi$1(t,e,i,r),oh$1(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=R$1(),r=yi$1(e),i=mh$1(n,r);i.tag=2,null!=t&&(i.callback=t),null!==(t=nh$1(e,i,r))&&(gi$1(t,e,r,n),oh$1(t,e,r))}};function Fi$1(e,t,n,r,i,o,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,a):!(t.prototype&&t.prototype.isPureReactComponent&&Ie$1(n,r)&&Ie$1(i,o))}function Gi$1(e,t,n){var r=!1,i=Vf$1,o=t.contextType;return"object"==typeof o&&null!==o?o=eh$1(o):(i=Zf$1(t)?Xf$1:H$1.current,o=(r=null!=(r=t.contextTypes))?Yf$1(e,i):Vf$1),t=new t(n,o),e.memoizedState=null!=t.state?t.state:null,t.updater=Ei$1,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function Hi$1(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Ei$1.enqueueReplaceState(t,t.state,null)}function Ii$1(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},kh$1(e);var o=t.contextType;"object"==typeof o&&null!==o?i.context=eh$1(o):(o=Zf$1(t)?Xf$1:H$1.current,i.context=Yf$1(e,o)),i.state=e.memoizedState,"function"==typeof(o=t.getDerivedStateFromProps)&&(Di$1(e,t,o,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Ei$1.enqueueReplaceState(i,i.state,null),qh$1(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4194308)}function Ji$1(e,t){try{var n="",r=t;do{n+=Pa$1(r),r=r.return}while(r);var i=n}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i,digest:null}}function Ki$1(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function Li$1(e,t){try{console.error(t.value)}catch(e){setTimeout(function(){throw e})}}var Mi$1="function"==typeof WeakMap?WeakMap:Map;function Ni$1(e,t,n){(n=mh$1(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Oi$1||(Oi$1=!0,Pi$1=r),Li$1(e,t)},n}function Qi$1(e,t,n){(n=mh$1(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){Li$1(e,t)}}var o=e.stateNode;return null!==o&&"function"==typeof o.componentDidCatch&&(n.callback=function(){Li$1(e,t),"function"!=typeof r&&(null===Ri$1?Ri$1=new Set([this]):Ri$1.add(this));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}function Si$1(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new Mi$1;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Ti$1.bind(null,e,t,n),t.then(e,e))}function Ui$1(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Vi$1(e,t,n,r,i){return 1&e.mode?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=mh$1(-1,1)).tag=2,nh$1(n,t,1))),n.lanes|=1),e)}var Wi$1=ua$1.ReactCurrentOwner,dh$1=!1;function Xi$1(e,t,n,r){t.child=null===e?Vg$1(t,null,n,r):Ug$1(t,e.child,n,r)}function Yi$1(e,t,n,r,i){n=n.render;var o=t.ref;return ch$1(t,i),r=Nh$1(e,t,n,r,o,i),n=Sh$1(),null===e||dh$1?(I$1&&n&&vg$1(t),t.flags|=1,Xi$1(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Zi$1(e,t,i))}function $i$1(e,t,n,r,i){if(null===e){var o=n.type;return"function"!=typeof o||aj$1(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Rg$1(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,bj$1(e,t,o,r,i))}return o=e.child,e.lanes&i||!(n=null!==(n=n.compare)?n:Ie$1)(o.memoizedProps,r)||e.ref!==t.ref?(t.flags|=1,(e=Pg$1(o,r)).ref=t.ref,e.return=t,t.child=e):Zi$1(e,t,i)}function bj$1(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(Ie$1(o,r)&&e.ref===t.ref){if(dh$1=!1,t.pendingProps=r=o,!(e.lanes&i))return t.lanes=e.lanes,Zi$1(e,t,i);131072&e.flags&&(dh$1=!0)}}return cj$1(e,t,n,r,i)}function dj$1(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,G$1(ej$1,fj$1),fj$1|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,G$1(ej$1,fj$1),fj$1|=r}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(ej$1,fj$1),fj$1|=n;else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,G$1(ej$1,fj$1),fj$1|=r;return Xi$1(e,t,i,n),t.child}function gj$1(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function cj$1(e,t,n,r,i){var o=Zf$1(n)?Xf$1:H$1.current;return o=Yf$1(t,o),ch$1(t,i),n=Nh$1(e,t,n,r,o,i),r=Sh$1(),null===e||dh$1?(I$1&&r&&vg$1(t),t.flags|=1,Xi$1(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Zi$1(e,t,i))}function hj$1(e,t,n,r,i){if(Zf$1(n)){var o=!0;cg$1(t)}else o=!1;if(ch$1(t,i),null===t.stateNode)ij$1(e,t),Gi$1(t,n,r),Ii$1(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var c=a.context,u=n.contextType;u="object"==typeof u&&null!==u?eh$1(u):Yf$1(t,u=Zf$1(n)?Xf$1:H$1.current);var l=n.getDerivedStateFromProps,d="function"==typeof l||"function"==typeof a.getSnapshotBeforeUpdate;d||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==r||c!==u)&&Hi$1(t,a,r,u),jh$1=!1;var h=t.memoizedState;a.state=h,qh$1(t,r,a,i),c=t.memoizedState,s!==r||h!==c||Wf$1.current||jh$1?("function"==typeof l&&(Di$1(t,n,l,r),c=t.memoizedState),(s=jh$1||Fi$1(t,n,s,r,h,c,u))?(d||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),a.props=r,a.state=c,a.context=u,r=s):("function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,lh$1(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:Ci$1(t.type,s),a.props=u,d=t.pendingProps,h=a.context,c="object"==typeof(c=n.contextType)&&null!==c?eh$1(c):Yf$1(t,c=Zf$1(n)?Xf$1:H$1.current);var p=n.getDerivedStateFromProps;(l="function"==typeof p||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(s!==d||h!==c)&&Hi$1(t,a,r,c),jh$1=!1,a.state=h=t.memoizedState,qh$1(t,r,a,i);var f=t.memoizedState;s!==d||h!==f||Wf$1.current||jh$1?("function"==typeof p&&(Di$1(t,n,p,r),f=t.memoizedState),(u=jh$1||Fi$1(t,n,u,r,h,f,c)||!1)?(l||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,f,c),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,f,c)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),a.props=r,a.state=f,a.context=c,r=u):("function"!=typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return jj$1(e,t,n,r,o,i)}function jj$1(e,t,n,r,i,o){gj$1(e,t);var a=!!(128&t.flags);if(!r&&!a)return i&&dg$1(t,n,!1),Zi$1(e,t,o);r=t.stateNode,Wi$1.current=t;var s=a&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=Ug$1(t,e.child,null,o),t.child=Ug$1(t,null,s,o)):Xi$1(e,t,s,o),t.memoizedState=r.state,i&&dg$1(t,n,!0),t.child}function kj$1(e){var t=e.stateNode;t.pendingContext?ag$1(e,t.pendingContext,t.pendingContext!==t.context):t.context&&ag$1(e,t.context,!1),yh$1(e,t.containerInfo)}function lj$1(e,t,n,r,i){return Ig$1(),Jg$1(i),t.flags|=256,Xi$1(e,t,n,r),t.child}var mj$1={dehydrated:null,treeContext:null,retryLane:0},zj$1,Aj$1,Bj$1,Cj$1;function nj$1(e){return{baseLanes:e,cachePool:null,transitions:null}}function oj$1(e,t,n){var r,i=t.pendingProps,o=L$1.current,a=!1,s=!!(128&t.flags);if((r=s)||(r=(null===e||null!==e.memoizedState)&&!!(2&o)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),G$1(L$1,1&o),null===e)return Eg$1(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(t.lanes=1&t.mode?"$!"===e.data?8:1073741824:1,null):(s=i.children,e=i.fallback,a?(a=t.child,s={mode:"hidden",children:s},1&(i=t.mode)||null===a?a=pj$1(s,i,0,null):(a.childLanes=0,a.pendingProps=s),e=Tg$1(e,i,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=nj$1(n),t.memoizedState=mj$1,e):qj$1(t,s));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return rj$1(e,t,s,i,r,o,n);if(a){a=i.fallback,r=(o=e.child).sibling;var c={mode:"hidden",children:i.children};return 1&(s=t.mode)||t.child===o?(i=Pg$1(o,c)).subtreeFlags=14680064&o.subtreeFlags:((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null),null!==r?a=Pg$1(r,a):(a=Tg$1(a,s,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,s=null===(s=e.child.memoizedState)?nj$1(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},a.memoizedState=s,a.childLanes=e.childLanes&~n,t.memoizedState=mj$1,i}return e=(a=e.child).sibling,i=Pg$1(a,{mode:"visible",children:i.children}),!(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function qj$1(e,t){return(t=pj$1({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function sj$1(e,t,n,r){return null!==r&&Jg$1(r),Ug$1(t,e.child,null,n),(e=qj$1(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function rj$1(e,t,n,r,i,o,a){if(n)return 256&t.flags?(t.flags&=-257,sj$1(e,t,a,r=Ki$1(Error(p$1(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,r=pj$1({mode:"visible",children:r.children},i=t.mode,0,null),(o=Tg$1(o,i,a,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,1&t.mode&&Ug$1(t,e.child,null,a),t.child.memoizedState=nj$1(a),t.memoizedState=mj$1,o);if(!(1&t.mode))return sj$1(e,t,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var s=r.dgst;return r=s,sj$1(e,t,a,r=Ki$1(o=Error(p$1(419)),r,void 0))}if(s=!!(a&e.childLanes),dh$1||s){if(null!==(r=Q$1)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=i&(r.suspendedLanes|a)?0:i)&&i!==o.retryLane&&(o.retryLane=i,ih$1(e,i),gi$1(r,e,i,-1))}return tj$1(),sj$1(e,t,a,r=Ki$1(Error(p$1(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=uj$1.bind(null,e),i._reactRetry=t,null):(e=o.treeContext,yg$1=Lf$1(i.nextSibling),xg$1=t,I$1=!0,zg$1=null,null!==e&&(og$1[pg$1++]=rg$1,og$1[pg$1++]=sg$1,og$1[pg$1++]=qg$1,rg$1=e.id,sg$1=e.overflow,qg$1=t),(t=qj$1(t,r.children)).flags|=4096,t)}function vj$1(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),bh$1(e.return,t,n)}function wj$1(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function xj$1(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Xi$1(e,t,r.children,n),2&(r=L$1.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&vj$1(e,n,t);else if(19===e.tag)vj$1(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(G$1(L$1,r),1&t.mode)switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Ch$1(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),wj$1(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Ch$1(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}wj$1(t,!0,n,null,o);break;case"together":wj$1(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function ij$1(e,t){!(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Zi$1(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),rh$1|=t.lanes,!(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(p$1(153));if(null!==t.child){for(n=Pg$1(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)(n=n.sibling=Pg$1(e=e.sibling,e.pendingProps)).return=t;n.sibling=null}return t.child}function yj$1(e,t,n){switch(t.tag){case 3:kj$1(t),Ig$1();break;case 5:Ah$1(t);break;case 1:Zf$1(t.type)&&cg$1(t);break;case 4:yh$1(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;G$1(Wg$1,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(G$1(L$1,1&L$1.current),t.flags|=128,null):n&t.child.childLanes?oj$1(e,t,n):(G$1(L$1,1&L$1.current),null!==(e=Zi$1(e,t,n))?e.sibling:null);G$1(L$1,1&L$1.current);break;case 19:if(r=!!(n&t.childLanes),128&e.flags){if(r)return xj$1(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),G$1(L$1,L$1.current),r)break;return null;case 22:case 23:return t.lanes=0,dj$1(e,t,n)}return Zi$1(e,t,n)}function Dj$1(e,t){if(!I$1)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function S$1(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ej$1(e,t,n){var r=t.pendingProps;switch(wg$1(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(t),null;case 1:case 17:return Zf$1(t.type)&&$f$1(),S$1(t),null;case 3:return r=t.stateNode,zh$1(),E$1(Wf$1),E$1(H$1),Eh$1(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Gg$1(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==zg$1&&(Fj$1(zg$1),zg$1=null))),Aj$1(e,t),S$1(t),null;case 5:Bh$1(t);var i=xh$1(wh$1.current);if(n=t.type,null!==e&&null!=t.stateNode)Bj$1(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(p$1(166));return S$1(t),null}if(e=xh$1(uh$1.current),Gg$1(t)){n=t.type;var o=t.memoizedProps;switch((r=t.stateNode)[Of$1]=t,r[Pf$1]=o,e=!!(1&t.mode),n){case"dialog":D$1("cancel",r),D$1("close",r);break;case"iframe":case"object":case"embed":D$1("load",r);break;case"video":case"audio":for(i=0;i<lf$1.length;i++)D$1(lf$1[i],r);break;case"source":D$1("error",r);break;case"img":case"image":case"link":D$1("error",r),D$1("load",r);break;case"details":D$1("toggle",r);break;case"input":Za$1(r,o),D$1("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},D$1("invalid",r);break;case"textarea":hb$1(r,o),D$1("invalid",r)}for(var a in ub$1(n,o),i=null,o)if(o.hasOwnProperty(a)){var s=o[a];"children"===a?"string"==typeof s?r.textContent!==s&&(!0!==o.suppressHydrationWarning&&Af$1(r.textContent,s,e),i=["children",s]):"number"==typeof s&&r.textContent!==""+s&&(!0!==o.suppressHydrationWarning&&Af$1(r.textContent,s,e),i=["children",""+s]):ea$1.hasOwnProperty(a)&&null!=s&&"onScroll"===a&&D$1("scroll",r)}switch(n){case"input":Va$1(r),db$1(r,o,!0);break;case"textarea":Va$1(r),jb$1(r);break;case"select":case"option":break;default:"function"==typeof o.onClick&&(r.onclick=Bf$1)}t.updateQueue=r=i,null!==r&&(t.flags|=4)}else{a=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=kb$1(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=a.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof r.is?e=a.createElement(n,{is:r.is}):(e=a.createElement(n),"select"===n&&(a=e,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):e=a.createElementNS(e,n),e[Of$1]=t,e[Pf$1]=r,zj$1(e,t,!1,!1),t.stateNode=e;e:{switch(a=vb$1(n,r),n){case"dialog":D$1("cancel",e),D$1("close",e),i=r;break;case"iframe":case"object":case"embed":D$1("load",e),i=r;break;case"video":case"audio":for(i=0;i<lf$1.length;i++)D$1(lf$1[i],e);i=r;break;case"source":D$1("error",e),i=r;break;case"img":case"image":case"link":D$1("error",e),D$1("load",e),i=r;break;case"details":D$1("toggle",e),i=r;break;case"input":Za$1(e,r),i=Ya$1(e,r),D$1("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=A$1({},r,{value:void 0}),D$1("invalid",e);break;case"textarea":hb$1(e,r),i=gb$1(e,r),D$1("invalid",e)}for(o in ub$1(n,i),s=i)if(s.hasOwnProperty(o)){var c=s[o];"style"===o?sb$1(e,c):"dangerouslySetInnerHTML"===o?null!=(c=c?c.__html:void 0)&&nb$1(e,c):"children"===o?"string"==typeof c?("textarea"!==n||""!==c)&&ob$1(e,c):"number"==typeof c&&ob$1(e,""+c):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(ea$1.hasOwnProperty(o)?null!=c&&"onScroll"===o&&D$1("scroll",e):null!=c&&ta$1(e,o,c,a))}switch(n){case"input":Va$1(e),db$1(e,r,!1);break;case"textarea":Va$1(e),jb$1(e);break;case"option":null!=r.value&&e.setAttribute("value",""+Sa$1(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?fb$1(e,!!r.multiple,o,!1):null!=r.defaultValue&&fb$1(e,!!r.multiple,r.defaultValue,!0);break;default:"function"==typeof i.onClick&&(e.onclick=Bf$1)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return S$1(t),null;case 6:if(e&&null!=t.stateNode)Cj$1(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(p$1(166));if(n=xh$1(wh$1.current),xh$1(uh$1.current),Gg$1(t)){if(n=t.memoizedProps,(r=t.stateNode)[Of$1]=t,(o=r.nodeValue!==n)&&null!==(e=xg$1))switch(e.tag){case 3:Af$1(r.nodeValue,n,!!(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Af$1(r.nodeValue,n,!!(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Of$1]=t,t.stateNode=r}return S$1(t),null;case 13:if(E$1(L$1),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(I$1&&null!==yg$1&&1&t.mode&&!(128&t.flags))Hg$1(),Ig$1(),t.flags|=98560,o=!1;else if(o=Gg$1(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(p$1(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(p$1(317));o[Of$1]=t}else Ig$1(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;S$1(t),o=!1}else null!==zg$1&&(Fj$1(zg$1),zg$1=null),o=!0;if(!o)return 65536&t.flags?t:null}return 128&t.flags?(t.lanes=n,t):((r=null!==r)!=(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,1&t.mode&&(null===e||1&L$1.current?0===T$1&&(T$1=3):tj$1())),null!==t.updateQueue&&(t.flags|=4),S$1(t),null);case 4:return zh$1(),Aj$1(e,t),null===e&&sf$1(t.stateNode.containerInfo),S$1(t),null;case 10:return ah$1(t.type._context),S$1(t),null;case 19:if(E$1(L$1),null===(o=t.memoizedState))return S$1(t),null;if(r=!!(128&t.flags),null===(a=o.rendering))if(r)Dj$1(o,!1);else{if(0!==T$1||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(a=Ch$1(e))){for(t.flags|=128,Dj$1(o,!1),null!==(r=a.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(a=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,o.type=a.type,o.dependencies=null===(e=a.dependencies)?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return G$1(L$1,1&L$1.current|2),t.child}e=e.sibling}null!==o.tail&&B$1()>Gj$1&&(t.flags|=128,r=!0,Dj$1(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=Ch$1(a))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Dj$1(o,!0),null===o.tail&&"hidden"===o.tailMode&&!a.alternate&&!I$1)return S$1(t),null}else 2*B$1()-o.renderingStartTime>Gj$1&&1073741824!==n&&(t.flags|=128,r=!0,Dj$1(o,!1),t.lanes=4194304);o.isBackwards?(a.sibling=t.child,t.child=a):(null!==(n=o.last)?n.sibling=a:t.child=a,o.last=a)}return null!==o.tail?(o.rendering=t=o.tail,o.tail=t.sibling,o.renderingStartTime=B$1(),t.sibling=null,n=L$1.current,G$1(L$1,r?1&n|2:1&n),t):(S$1(t),null);case 22:case 23:return Hj$1(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&fj$1)&&(S$1(t),6&t.subtreeFlags&&(t.flags|=8192)):S$1(t),null;case 24:case 25:return null}throw Error(p$1(156,t.tag))}function Ij$1(e,t){switch(wg$1(t),t.tag){case 1:return Zf$1(t.type)&&$f$1(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return zh$1(),E$1(Wf$1),E$1(H$1),Eh$1(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Bh$1(t),null;case 13:if(E$1(L$1),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(p$1(340));Ig$1()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return E$1(L$1),null;case 4:return zh$1(),null;case 10:return ah$1(t.type._context),null;case 22:case 23:return Hj$1(),null;default:return null}}zj$1=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Aj$1=function(){},Bj$1=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,xh$1(uh$1.current);var o,a=null;switch(n){case"input":i=Ya$1(e,i),r=Ya$1(e,r),a=[];break;case"select":i=A$1({},i,{value:void 0}),r=A$1({},r,{value:void 0}),a=[];break;case"textarea":i=gb$1(e,i),r=gb$1(e,r),a=[];break;default:"function"!=typeof i.onClick&&"function"==typeof r.onClick&&(e.onclick=Bf$1)}for(u in ub$1(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var s=i[u];for(o in s)s.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(ea$1.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in r){var c=r[u];if(s=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==s&&(null!=c||null!=s))if("style"===u)if(s){for(o in s)!s.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&s[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(a||(a=[]),a.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(s=s?s.__html:void 0,null!=(c=c?c.__html:void 0)&&s!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!=typeof c&&"number"!=typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(ea$1.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&D$1("scroll",e),a||s===c||(a=[])):(a=a||[]).push(u,c))}n&&(a=a||[]).push("style",n);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Cj$1=function(e,t,n,r){n!==r&&(t.flags|=4)};var Jj$1=!1,U$1=!1,Kj$1="function"==typeof WeakSet?WeakSet:Set,V$1=null;function Lj$1(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){W$1(e,t,n)}else n.current=null}function Mj$1(e,t,n){try{n()}catch(n){W$1(e,t,n)}}var Nj$1=!1;function Oj$1(e,t){if(Cf$1=dd$1,Ne$1(e=Me$1())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;var a=0,s=-1,c=-1,u=0,l=0,d=e,h=null;e:for(;;){for(var p;d!==n||0!==i&&3!==d.nodeType||(s=a+i),d!==o||0!==r&&3!==d.nodeType||(c=a+r),3===d.nodeType&&(a+=d.nodeValue.length),null!==(p=d.firstChild);)h=d,d=p;for(;;){if(d===e)break e;if(h===n&&++u===i&&(s=a),h===o&&++l===r&&(c=a),null!==(p=d.nextSibling))break;h=(d=h).parentNode}d=p}n=-1===s||-1===c?null:{start:s,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Df$1={focusedElem:e,selectionRange:n},dd$1=!1,V$1=t;null!==V$1;)if(e=(t=V$1).child,1028&t.subtreeFlags&&null!==e)e.return=t,V$1=e;else for(;null!==V$1;){t=V$1;try{var f=t.alternate;if(1024&t.flags)switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var m=f.memoizedProps,g=f.memoizedState,v=t.stateNode,E=v.getSnapshotBeforeUpdate(t.elementType===t.type?m:Ci$1(t.type,m),g);v.__reactInternalSnapshotBeforeUpdate=E}break;case 3:var y=t.stateNode.containerInfo;1===y.nodeType?y.textContent="":9===y.nodeType&&y.documentElement&&y.removeChild(y.documentElement);break;default:throw Error(p$1(163))}}catch(e){W$1(t,t.return,e)}if(null!==(e=t.sibling)){e.return=t.return,V$1=e;break}V$1=t.return}return f=Nj$1,Nj$1=!1,f}function Pj$1(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&Mj$1(t,n,o)}i=i.next}while(i!==r)}}function Qj$1(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{(n.tag&e)===e&&(n.destroy=(0,n.create)()),n=n.next}while(n!==t)}}function Rj$1(e){var t=e.ref;null!==t&&(e=e.stateNode,"function"==typeof t?t(e):t.current=e)}function Sj$1(e){var t=e.alternate;null!==t&&(e.alternate=null,Sj$1(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&null!==(t=e.stateNode)&&(delete t[Of$1],delete t[Pf$1],delete t[of$1],delete t[Qf$1],delete t[Rf$1]),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Tj$1(e){return 5===e.tag||3===e.tag||4===e.tag}function Uj$1(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Tj$1(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function Vj$1(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!=(n=n._reactRootContainer)||null!==t.onclick||(t.onclick=Bf$1));else if(4!==r&&null!==(e=e.child))for(Vj$1(e,t,n),e=e.sibling;null!==e;)Vj$1(e,t,n),e=e.sibling}function Wj$1(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(Wj$1(e,t,n),e=e.sibling;null!==e;)Wj$1(e,t,n),e=e.sibling}var X$1=null,Xj$1=!1;function Yj$1(e,t,n){for(n=n.child;null!==n;)Zj$1(e,t,n),n=n.sibling}function Zj$1(e,t,n){if(lc$1&&"function"==typeof lc$1.onCommitFiberUnmount)try{lc$1.onCommitFiberUnmount(kc$1,n)}catch(e){}switch(n.tag){case 5:U$1||Lj$1(n,t);case 6:var r=X$1,i=Xj$1;X$1=null,Yj$1(e,t,n),Xj$1=i,null!==(X$1=r)&&(Xj$1?(n=n.stateNode,8===(e=X$1).nodeType?e.parentNode.removeChild(n):e.removeChild(n)):X$1.removeChild(n.stateNode));break;case 18:null!==X$1&&(Xj$1?(n=n.stateNode,8===(e=X$1).nodeType?Kf$1(e.parentNode,n):1===e.nodeType&&Kf$1(e,n),bd$1(e)):Kf$1(X$1,n.stateNode));break;case 4:r=X$1,i=Xj$1,X$1=n.stateNode.containerInfo,Xj$1=!0,Yj$1(e,t,n),X$1=r,Xj$1=i;break;case 0:case 11:case 14:case 15:if(!U$1&&null!==(r=n.updateQueue)&&null!==(r=r.lastEffect)){i=r=r.next;do{var o=i,a=o.destroy;o=o.tag,void 0!==a&&(2&o||4&o)&&Mj$1(n,t,a),i=i.next}while(i!==r)}Yj$1(e,t,n);break;case 1:if(!U$1&&(Lj$1(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(e){W$1(n,t,e)}Yj$1(e,t,n);break;case 21:Yj$1(e,t,n);break;case 22:1&n.mode?(U$1=(r=U$1)||null!==n.memoizedState,Yj$1(e,t,n),U$1=r):Yj$1(e,t,n);break;default:Yj$1(e,t,n)}}function ak$1(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Kj$1),t.forEach(function(t){var r=bk$1.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function ck$1(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var o=e,a=t,s=a;e:for(;null!==s;){switch(s.tag){case 5:X$1=s.stateNode,Xj$1=!1;break e;case 3:case 4:X$1=s.stateNode.containerInfo,Xj$1=!0;break e}s=s.return}if(null===X$1)throw Error(p$1(160));Zj$1(o,a,i),X$1=null,Xj$1=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(e){W$1(i,t,e)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)dk$1(t,e),t=t.sibling}function dk$1(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ck$1(t,e),ek$1(e),4&r){try{Pj$1(3,e,e.return),Qj$1(3,e)}catch(t){W$1(e,e.return,t)}try{Pj$1(5,e,e.return)}catch(t){W$1(e,e.return,t)}}break;case 1:ck$1(t,e),ek$1(e),512&r&&null!==n&&Lj$1(n,n.return);break;case 5:if(ck$1(t,e),ek$1(e),512&r&&null!==n&&Lj$1(n,n.return),32&e.flags){var i=e.stateNode;try{ob$1(i,"")}catch(t){W$1(e,e.return,t)}}if(4&r&&null!=(i=e.stateNode)){var o=e.memoizedProps,a=null!==n?n.memoizedProps:o,s=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===s&&"radio"===o.type&&null!=o.name&&ab$1(i,o),vb$1(s,a);var u=vb$1(s,o);for(a=0;a<c.length;a+=2){var l=c[a],d=c[a+1];"style"===l?sb$1(i,d):"dangerouslySetInnerHTML"===l?nb$1(i,d):"children"===l?ob$1(i,d):ta$1(i,l,d,u)}switch(s){case"input":bb$1(i,o);break;case"textarea":ib$1(i,o);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?fb$1(i,!!o.multiple,p,!1):h!==!!o.multiple&&(null!=o.defaultValue?fb$1(i,!!o.multiple,o.defaultValue,!0):fb$1(i,!!o.multiple,o.multiple?[]:"",!1))}i[Pf$1]=o}catch(t){W$1(e,e.return,t)}}break;case 6:if(ck$1(t,e),ek$1(e),4&r){if(null===e.stateNode)throw Error(p$1(162));i=e.stateNode,o=e.memoizedProps;try{i.nodeValue=o}catch(t){W$1(e,e.return,t)}}break;case 3:if(ck$1(t,e),ek$1(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{bd$1(t.containerInfo)}catch(t){W$1(e,e.return,t)}break;case 4:default:ck$1(t,e),ek$1(e);break;case 13:ck$1(t,e),ek$1(e),8192&(i=e.child).flags&&(i.stateNode.isHidden=o=null!==i.memoizedState,!o||null!==i.alternate&&null!==i.alternate.memoizedState||(fk$1=B$1())),4&r&&ak$1(e);break;case 22:if(l=null!==n&&null!==n.memoizedState,1&e.mode?(U$1=(u=U$1)||l,ck$1(t,e),U$1=u):ck$1(t,e),ek$1(e),8192&r){if((e.stateNode.isHidden=u=null!==e.memoizedState)&&!l&&1&e.mode)for(V$1=e,l=e.child;null!==l;){for(d=V$1=l;null!==V$1;){switch(p=(h=V$1).child,h.tag){case 0:case 11:case 14:case 15:Pj$1(4,h,h.return);break;case 1:Lj$1(h,h.return);var f=h.stateNode;if("function"==typeof f.componentWillUnmount){r=h,n=h.return;try{f.props=(t=r).memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(e){W$1(r,n,e)}}break;case 5:Lj$1(h,h.return);break;case 22:if(null!==h.memoizedState){gk$1(d);continue}}null!==p?(p.return=h,V$1=p):gk$1(d)}l=l.sibling}e:for(l=null,d=e;;){if(5===d.tag){if(null===l){l=d;try{i=d.stateNode,u?"function"==typeof(o=i.style).setProperty?o.setProperty("display","none","important"):o.display="none":(s=d.stateNode,a=null!=(c=d.memoizedProps.style)&&c.hasOwnProperty("display")?c.display:null,s.style.display=rb$1("display",a))}catch(t){W$1(e,e.return,t)}}}else if(6===d.tag){if(null===l)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(t){W$1(e,e.return,t)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;l===d&&(l=null),d=d.return}l===d&&(l=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ck$1(t,e),ek$1(e),4&r&&ak$1(e);case 21:}}function ek$1(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(Tj$1(n)){var r=n;break e}n=n.return}throw Error(p$1(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(ob$1(i,""),r.flags&=-33),Wj$1(e,Uj$1(e),i);break;case 3:case 4:var o=r.stateNode.containerInfo;Vj$1(e,Uj$1(e),o);break;default:throw Error(p$1(161))}}catch(t){W$1(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function hk$1(e,t,n){V$1=e,ik$1(e)}function ik$1(e,t,n){for(var r=!!(1&e.mode);null!==V$1;){var i=V$1,o=i.child;if(22===i.tag&&r){var a=null!==i.memoizedState||Jj$1;if(!a){var s=i.alternate,c=null!==s&&null!==s.memoizedState||U$1;s=Jj$1;var u=U$1;if(Jj$1=a,(U$1=c)&&!u)for(V$1=i;null!==V$1;)c=(a=V$1).child,22===a.tag&&null!==a.memoizedState?jk$1(i):null!==c?(c.return=a,V$1=c):jk$1(i);for(;null!==o;)V$1=o,ik$1(o),o=o.sibling;V$1=i,Jj$1=s,U$1=u}kk$1(e)}else 8772&i.subtreeFlags&&null!==o?(o.return=i,V$1=o):kk$1(e)}}function kk$1(e){for(;null!==V$1;){var t=V$1;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:U$1||Qj$1(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!U$1)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:Ci$1(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&sh$1(t,o,r);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}sh$1(t,a,n)}break;case 5:if(null===n&&4&t.flags){n=t.stateNode;var s=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":s.autoFocus&&n.focus();break;case"img":s.src&&(n.src=s.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var c=t.alternate;if(null!==c){var u=c.memoizedState;if(null!==u){var l=u.dehydrated;null!==l&&bd$1(l)}}}break;default:throw Error(p$1(163))}U$1||512&t.flags&&Rj$1(t)}catch(e){W$1(t,t.return,e)}}if(t===e){V$1=null;break}if(null!==(n=t.sibling)){n.return=t.return,V$1=n;break}V$1=t.return}}function gk$1(e){for(;null!==V$1;){var t=V$1;if(t===e){V$1=null;break}var n=t.sibling;if(null!==n){n.return=t.return,V$1=n;break}V$1=t.return}}function jk$1(e){for(;null!==V$1;){var t=V$1;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Qj$1(4,t)}catch(e){W$1(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(e){W$1(t,i,e)}}var o=t.return;try{Rj$1(t)}catch(e){W$1(t,o,e)}break;case 5:var a=t.return;try{Rj$1(t)}catch(e){W$1(t,a,e)}}}catch(e){W$1(t,t.return,e)}if(t===e){V$1=null;break}var s=t.sibling;if(null!==s){s.return=t.return,V$1=s;break}V$1=t.return}}var lk$1=Math.ceil,mk$1=ua$1.ReactCurrentDispatcher,nk$1=ua$1.ReactCurrentOwner,ok$1=ua$1.ReactCurrentBatchConfig,K$1=0,Q$1=null,Y$1=null,Z$1=0,fj$1=0,ej$1=Uf$1(0),T$1=0,pk$1=null,rh$1=0,qk$1=0,rk$1=0,sk$1=null,tk$1=null,fk$1=0,Gj$1=Infinity,uk$1=null,Oi$1=!1,Pi$1=null,Ri$1=null,vk$1=!1,wk$1=null,xk$1=0,yk$1=0,zk$1=null,Ak$1=-1,Bk$1=0,Vk$1;function R$1(){return 6&K$1?B$1():-1!==Ak$1?Ak$1:Ak$1=B$1()}function yi$1(e){return 1&e.mode?2&K$1&&0!==Z$1?Z$1&-Z$1:null!==Kg$1.transition?(0===Bk$1&&(Bk$1=yc$1()),Bk$1):0!==(e=C$1)?e:e=void 0===(e=window.event)?16:jd$1(e.type):1}function gi$1(e,t,n,r){if(50<yk$1)throw yk$1=0,zk$1=null,Error(p$1(185));Ac$1(e,n,r),2&K$1&&e===Q$1||(e===Q$1&&(!(2&K$1)&&(qk$1|=n),4===T$1&&Ck$1(e,Z$1)),Dk$1(e,r),1===n&&0===K$1&&!(1&t.mode)&&(Gj$1=B$1()+500,fg$1&&jg$1()))}function Dk$1(e,t){var n=e.callbackNode;wc$1(e,t);var r=uc$1(e,e===Q$1?Z$1:0);if(0===r)null!==n&&bc$1(n),e.callbackNode=null,e.callbackPriority=0;else if(e.callbackPriority!==(t=r&-r)){if(null!=n&&bc$1(n),1===t)0===e.tag?ig$1(Ek$1.bind(null,e)):hg$1(Ek$1.bind(null,e)),Jf$1(function(){!(6&K$1)&&jg$1()}),n=null;else{switch(Dc$1(r)){case 1:n=fc$1;break;case 4:n=gc$1;break;case 16:default:n=hc$1;break;case 536870912:n=jc$1}n=Fk$1(n,Gk$1.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Gk$1(e,t){if(Ak$1=-1,Bk$1=0,6&K$1)throw Error(p$1(327));var n=e.callbackNode;if(Hk$1()&&e.callbackNode!==n)return null;var r=uc$1(e,e===Q$1?Z$1:0);if(0===r)return null;if(30&r||r&e.expiredLanes||t)t=Ik$1(e,r);else{t=r;var i=K$1;K$1|=2;var o=Jk$1();for(Q$1===e&&Z$1===t||(uk$1=null,Gj$1=B$1()+500,Kk$1(e,t));;)try{Lk$1();break}catch(t){Mk$1(e,t)}$g$1(),mk$1.current=o,K$1=i,null!==Y$1?t=0:(Q$1=null,Z$1=0,t=T$1)}if(0!==t){if(2===t&&0!==(i=xc$1(e))&&(r=i,t=Nk$1(e,i)),1===t)throw n=pk$1,Kk$1(e,0),Ck$1(e,r),Dk$1(e,B$1()),n;if(6===t)Ck$1(e,r);else{if(i=e.current.alternate,!(30&r||Ok$1(i)||(t=Ik$1(e,r),2===t&&(o=xc$1(e),0!==o&&(r=o,t=Nk$1(e,o))),1!==t)))throw n=pk$1,Kk$1(e,0),Ck$1(e,r),Dk$1(e,B$1()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(p$1(345));case 2:case 5:Pk$1(e,tk$1,uk$1);break;case 3:if(Ck$1(e,r),(130023424&r)===r&&10<(t=fk$1+500-B$1())){if(0!==uc$1(e,0))break;if(((i=e.suspendedLanes)&r)!==r){R$1(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Ff$1(Pk$1.bind(null,e,tk$1,uk$1),t);break}Pk$1(e,tk$1,uk$1);break;case 4:if(Ck$1(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var a=31-oc$1(r);o=1<<a,(a=t[a])>i&&(i=a),r&=~o}if(r=i,10<(r=(120>(r=B$1()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*lk$1(r/1960))-r)){e.timeoutHandle=Ff$1(Pk$1.bind(null,e,tk$1,uk$1),r);break}Pk$1(e,tk$1,uk$1);break;default:throw Error(p$1(329))}}}return Dk$1(e,B$1()),e.callbackNode===n?Gk$1.bind(null,e):null}function Nk$1(e,t){var n=sk$1;return e.current.memoizedState.isDehydrated&&(Kk$1(e,t).flags|=256),2!==(e=Ik$1(e,t))&&(t=tk$1,tk$1=n,null!==t&&Fj$1(t)),e}function Fj$1(e){null===tk$1?tk$1=e:tk$1.push.apply(tk$1,e)}function Ok$1(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!He$1(o(),i))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Ck$1(e,t){for(t&=~rk$1,e.suspendedLanes|=t&=~qk$1,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-oc$1(t),r=1<<n;e[n]=-1,t&=~r}}function Ek$1(e){if(6&K$1)throw Error(p$1(327));Hk$1();var t=uc$1(e,0);if(!(1&t))return Dk$1(e,B$1()),null;var n=Ik$1(e,t);if(0!==e.tag&&2===n){var r=xc$1(e);0!==r&&(t=r,n=Nk$1(e,r))}if(1===n)throw n=pk$1,Kk$1(e,0),Ck$1(e,t),Dk$1(e,B$1()),n;if(6===n)throw Error(p$1(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Pk$1(e,tk$1,uk$1),Dk$1(e,B$1()),null}function Qk$1(e,t){var n=K$1;K$1|=1;try{return e(t)}finally{0===(K$1=n)&&(Gj$1=B$1()+500,fg$1&&jg$1())}}function Rk$1(e){null!==wk$1&&0===wk$1.tag&&!(6&K$1)&&Hk$1();var t=K$1;K$1|=1;var n=ok$1.transition,r=C$1;try{if(ok$1.transition=null,C$1=1,e)return e()}finally{C$1=r,ok$1.transition=n,!(6&(K$1=t))&&jg$1()}}function Hj$1(){fj$1=ej$1.current,E$1(ej$1)}function Kk$1(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Gf$1(n)),null!==Y$1)for(n=Y$1.return;null!==n;){var r=n;switch(wg$1(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&$f$1();break;case 3:zh$1(),E$1(Wf$1),E$1(H$1),Eh$1();break;case 5:Bh$1(r);break;case 4:zh$1();break;case 13:case 19:E$1(L$1);break;case 10:ah$1(r.type._context);break;case 22:case 23:Hj$1()}n=n.return}if(Q$1=e,Y$1=e=Pg$1(e.current,null),Z$1=fj$1=t,T$1=0,pk$1=null,rk$1=qk$1=rh$1=0,tk$1=sk$1=null,null!==fh$1){for(t=0;t<fh$1.length;t++)if(null!==(r=(n=fh$1[t]).interleaved)){n.interleaved=null;var i=n.pending;if(null!==i){var o=i.next;i.next=r.next,r.next=o}n.pending=r}fh$1=null}return e}function Mk$1(e,t){for(;;){var n=Y$1;try{if($g$1(),Fh$1.current=Rh$1,Ih$1){for(var r=M$1.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}Ih$1=!1}if(Hh$1=0,O$1=N$1=M$1=null,Jh$1=!1,Kh$1=0,nk$1.current=null,null===n||null===n.return){T$1=1,pk$1=t,Y$1=null;break}e:{var o=e,a=n.return,s=n,c=t;if(t=Z$1,s.flags|=32768,null!==c&&"object"==typeof c&&"function"==typeof c.then){var u=c,l=s,d=l.tag;if(!(1&l.mode||0!==d&&11!==d&&15!==d)){var h=l.alternate;h?(l.updateQueue=h.updateQueue,l.memoizedState=h.memoizedState,l.lanes=h.lanes):(l.updateQueue=null,l.memoizedState=null)}var p=Ui$1(a);if(null!==p){p.flags&=-257,Vi$1(p,a,s,o,t),1&p.mode&&Si$1(o,u,t),c=u;var f=(t=p).updateQueue;if(null===f){var m=new Set;m.add(c),t.updateQueue=m}else f.add(c);break e}if(!(1&t)){Si$1(o,u,t),tj$1();break e}c=Error(p$1(426))}else if(I$1&&1&s.mode){var g=Ui$1(a);if(null!==g){!(65536&g.flags)&&(g.flags|=256),Vi$1(g,a,s,o,t),Jg$1(Ji$1(c,s));break e}}o=c=Ji$1(c,s),4!==T$1&&(T$1=2),null===sk$1?sk$1=[o]:sk$1.push(o),o=a;do{switch(o.tag){case 3:o.flags|=65536,o.lanes|=t&=-t,ph$1(o,Ni$1(o,c,t));break e;case 1:s=c;var v=o.stateNode;if(!(128&o.flags||"function"!=typeof o.type.getDerivedStateFromError&&(null===v||"function"!=typeof v.componentDidCatch||null!==Ri$1&&Ri$1.has(v)))){o.flags|=65536,o.lanes|=t&=-t,ph$1(o,Qi$1(o,s,t));break e}}o=o.return}while(null!==o)}Sk$1(n)}catch(e){t=e,Y$1===n&&null!==n&&(Y$1=n=n.return);continue}break}}function Jk$1(){var e=mk$1.current;return mk$1.current=Rh$1,null===e?Rh$1:e}function tj$1(){0!==T$1&&3!==T$1&&2!==T$1||(T$1=4),null===Q$1||!(268435455&rh$1)&&!(268435455&qk$1)||Ck$1(Q$1,Z$1)}function Ik$1(e,t){var n=K$1;K$1|=2;var r=Jk$1();for(Q$1===e&&Z$1===t||(uk$1=null,Kk$1(e,t));;)try{Tk$1();break}catch(t){Mk$1(e,t)}if($g$1(),K$1=n,mk$1.current=r,null!==Y$1)throw Error(p$1(261));return Q$1=null,Z$1=0,T$1}function Tk$1(){for(;null!==Y$1;)Uk$1(Y$1)}function Lk$1(){for(;null!==Y$1&&!cc$1();)Uk$1(Y$1)}function Uk$1(e){var t=Vk$1(e.alternate,e,fj$1);e.memoizedProps=e.pendingProps,null===t?Sk$1(e):Y$1=t,nk$1.current=null}function Sk$1(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=Ij$1(n,t)))return n.flags&=32767,void(Y$1=n);if(null===e)return T$1=6,void(Y$1=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Ej$1(n,t,fj$1)))return void(Y$1=n);if(null!==(t=t.sibling))return void(Y$1=t);Y$1=t=e}while(null!==t);0===T$1&&(T$1=5)}function Pk$1(e,t,n){var r=C$1,i=ok$1.transition;try{ok$1.transition=null,C$1=1,Wk$1(e,t,n,r)}finally{ok$1.transition=i,C$1=r}return null}function Wk$1(e,t,n,r){do{Hk$1()}while(null!==wk$1);if(6&K$1)throw Error(p$1(327));var i=e.finishedLanes;if(null===(n=e.finishedWork))return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(p$1(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(Bc$1(e,o),e===Q$1&&(Y$1=Q$1=null,Z$1=0),!(2064&n.subtreeFlags)&&!(2064&n.flags)||vk$1||(vk$1=!0,Fk$1(hc$1,function(){return Hk$1(),null})),o=!!(15990&n.flags),15990&n.subtreeFlags||o){o=ok$1.transition,ok$1.transition=null;var a=C$1;C$1=1;var s=K$1;K$1|=4,nk$1.current=null,Oj$1(e,n),dk$1(n,e),Oe$1(Df$1),dd$1=!!Cf$1,Df$1=Cf$1=null,e.current=n,hk$1(n),dc$1(),K$1=s,C$1=a,ok$1.transition=o}else e.current=n;if(vk$1&&(vk$1=!1,wk$1=e,xk$1=i),0===(o=e.pendingLanes)&&(Ri$1=null),mc$1(n.stateNode),Dk$1(e,B$1()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((i=t[n]).value,{componentStack:i.stack,digest:i.digest});if(Oi$1)throw Oi$1=!1,e=Pi$1,Pi$1=null,e;return 1&xk$1&&0!==e.tag&&Hk$1(),1&(o=e.pendingLanes)?e===zk$1?yk$1++:(yk$1=0,zk$1=e):yk$1=0,jg$1(),null}function Hk$1(){if(null!==wk$1){var e=Dc$1(xk$1),t=ok$1.transition,n=C$1;try{if(ok$1.transition=null,C$1=16>e?16:e,null===wk$1)var r=!1;else{if(e=wk$1,wk$1=null,xk$1=0,6&K$1)throw Error(p$1(331));var i=K$1;for(K$1|=4,V$1=e.current;null!==V$1;){var o=V$1,a=o.child;if(16&V$1.flags){var s=o.deletions;if(null!==s){for(var c=0;c<s.length;c++){var u=s[c];for(V$1=u;null!==V$1;){var l=V$1;switch(l.tag){case 0:case 11:case 15:Pj$1(8,l,o)}var d=l.child;if(null!==d)d.return=l,V$1=d;else for(;null!==V$1;){var h=(l=V$1).sibling,p=l.return;if(Sj$1(l),l===u){V$1=null;break}if(null!==h){h.return=p,V$1=h;break}V$1=p}}}var f=o.alternate;if(null!==f){var m=f.child;if(null!==m){f.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}V$1=o}}if(2064&o.subtreeFlags&&null!==a)a.return=o,V$1=a;else e:for(;null!==V$1;){if(2048&(o=V$1).flags)switch(o.tag){case 0:case 11:case 15:Pj$1(9,o,o.return)}var v=o.sibling;if(null!==v){v.return=o.return,V$1=v;break e}V$1=o.return}}var E=e.current;for(V$1=E;null!==V$1;){var y=(a=V$1).child;if(2064&a.subtreeFlags&&null!==y)y.return=a,V$1=y;else e:for(a=E;null!==V$1;){if(2048&(s=V$1).flags)try{switch(s.tag){case 0:case 11:case 15:Qj$1(9,s)}}catch(e){W$1(s,s.return,e)}if(s===a){V$1=null;break e}var _=s.sibling;if(null!==_){_.return=s.return,V$1=_;break e}V$1=s.return}}if(K$1=i,jg$1(),lc$1&&"function"==typeof lc$1.onPostCommitFiberRoot)try{lc$1.onPostCommitFiberRoot(kc$1,e)}catch(e){}r=!0}return r}finally{C$1=n,ok$1.transition=t}}return!1}function Xk$1(e,t,n){e=nh$1(e,t=Ni$1(e,t=Ji$1(n,t),1),1),t=R$1(),null!==e&&(Ac$1(e,1,t),Dk$1(e,t))}function W$1(e,t,n){if(3===e.tag)Xk$1(e,e,n);else for(;null!==t;){if(3===t.tag){Xk$1(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===Ri$1||!Ri$1.has(r))){t=nh$1(t,e=Qi$1(t,e=Ji$1(n,e),1),1),e=R$1(),null!==t&&(Ac$1(t,1,e),Dk$1(t,e));break}}t=t.return}}function Ti$1(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=R$1(),e.pingedLanes|=e.suspendedLanes&n,Q$1===e&&(Z$1&n)===n&&(4===T$1||3===T$1&&(130023424&Z$1)===Z$1&&500>B$1()-fk$1?Kk$1(e,0):rk$1|=n),Dk$1(e,t)}function Yk$1(e,t){0===t&&(1&e.mode?(t=sc$1,!(130023424&(sc$1<<=1))&&(sc$1=4194304)):t=1);var n=R$1();null!==(e=ih$1(e,t))&&(Ac$1(e,t,n),Dk$1(e,n))}function uj$1(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Yk$1(e,n)}function bk$1(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(p$1(314))}null!==r&&r.delete(t),Yk$1(e,n)}function Fk$1(e,t){return ac$1(e,t)}function $k$1(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg$1(e,t,n,r){return new $k$1(e,t,n,r)}function aj$1(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Zk$1(e){if("function"==typeof e)return aj$1(e)?1:0;if(null!=e){if((e=e.$$typeof)===Da$1)return 11;if(e===Ga$1)return 14}return 2}function Pg$1(e,t){var n=e.alternate;return null===n?((n=Bg$1(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,n.dependencies=null===(t=e.dependencies)?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Rg$1(e,t,n,r,i,o){var a=2;if(r=e,"function"==typeof e)aj$1(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case ya$1:return Tg$1(n.children,i,o,t);case za$1:a=8,i|=8;break;case Aa$1:return(e=Bg$1(12,n,t,2|i)).elementType=Aa$1,e.lanes=o,e;case Ea$1:return(e=Bg$1(13,n,t,i)).elementType=Ea$1,e.lanes=o,e;case Fa$1:return(e=Bg$1(19,n,t,i)).elementType=Fa$1,e.lanes=o,e;case Ia$1:return pj$1(n,i,o,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case Ba$1:a=10;break e;case Ca$1:a=9;break e;case Da$1:a=11;break e;case Ga$1:a=14;break e;case Ha$1:a=16,r=null;break e}throw Error(p$1(130,null==e?e:typeof e,""))}return(t=Bg$1(a,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function Tg$1(e,t,n,r){return(e=Bg$1(7,e,r,t)).lanes=n,e}function pj$1(e,t,n,r){return(e=Bg$1(22,e,r,t)).elementType=Ia$1,e.lanes=n,e.stateNode={isHidden:!1},e}function Qg$1(e,t,n){return(e=Bg$1(6,e,null,t)).lanes=n,e}function Sg$1(e,t,n){return(t=Bg$1(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function al$1(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc$1(0),this.expirationTimes=zc$1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc$1(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function bl$1(e,t,n,r,i,o,a,s,c){return e=new al$1(e,t,n,s,c),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Bg$1(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh$1(o),e}function cl$1(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:wa$1,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function dl$1(e){if(!e)return Vf$1;e:{if(Vb$1(e=e._reactInternals)!==e||1!==e.tag)throw Error(p$1(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Zf$1(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(p$1(171))}if(1===e.tag){var n=e.type;if(Zf$1(n))return bg$1(e,n,t)}return t}function el$1(e,t,n,r,i,o,a,s,c){return(e=bl$1(n,r,!0,e,i,o,a,s,c)).context=dl$1(null),n=e.current,(o=mh$1(r=R$1(),i=yi$1(n))).callback=null!=t?t:null,nh$1(n,o,i),e.current.lanes=i,Ac$1(e,i,r),Dk$1(e,r),e}function fl$1(e,t,n,r){var i=t.current,o=R$1(),a=yi$1(i);return n=dl$1(n),null===t.context?t.context=n:t.pendingContext=n,(t=mh$1(o,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=nh$1(i,t,a))&&(gi$1(e,i,a,o),oh$1(e,i,a)),a}function gl$1(e){return(e=e.current).child?e.child.stateNode:null}function hl$1(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function il$1(e,t){hl$1(e,t),(e=e.alternate)&&hl$1(e,t)}function jl$1(){return null}Vk$1=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Wf$1.current)dh$1=!0;else{if(!(e.lanes&n||128&t.flags))return dh$1=!1,yj$1(e,t,n);dh$1=!!(131072&e.flags)}else dh$1=!1,I$1&&1048576&t.flags&&ug$1(t,ng$1,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;ij$1(e,t),e=t.pendingProps;var i=Yf$1(t,H$1.current);ch$1(t,n),i=Nh$1(null,t,r,e,i,n);var o=Sh$1();return t.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Zf$1(r)?(o=!0,cg$1(t)):o=!1,t.memoizedState=null!=i.state?i.state:null,kh$1(t),i.updater=Ei$1,t.stateNode=i,i._reactInternals=t,Ii$1(t,r,e,n),t=jj$1(null,t,r,!0,o,n)):(t.tag=0,I$1&&o&&vg$1(t),Xi$1(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(ij$1(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=Zk$1(r),e=Ci$1(r,e),i){case 0:t=cj$1(null,t,r,e,n);break e;case 1:t=hj$1(null,t,r,e,n);break e;case 11:t=Yi$1(null,t,r,e,n);break e;case 14:t=$i$1(null,t,r,Ci$1(r.type,e),n);break e}throw Error(p$1(306,r,""))}return t;case 0:return i=t.pendingProps,cj$1(e,t,r=t.type,i=t.elementType===r?i:Ci$1(r,i),n);case 1:return i=t.pendingProps,hj$1(e,t,r=t.type,i=t.elementType===r?i:Ci$1(r,i),n);case 3:e:{if(kj$1(t),null===e)throw Error(p$1(387));r=t.pendingProps,i=(o=t.memoizedState).element,lh$1(e,t),qh$1(t,r,null,n);var a=t.memoizedState;if(r=a.element,o.isDehydrated){if(t.updateQueue.baseState=o={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.memoizedState=o,256&t.flags){t=lj$1(e,t,r,n,i=Ji$1(Error(p$1(423)),t));break e}if(r!==i){t=lj$1(e,t,r,n,i=Ji$1(Error(p$1(424)),t));break e}for(yg$1=Lf$1(t.stateNode.containerInfo.firstChild),xg$1=t,I$1=!0,zg$1=null,n=Vg$1(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Ig$1(),r===i){t=Zi$1(e,t,n);break e}Xi$1(e,t,r,n)}t=t.child}return t;case 5:return Ah$1(t),null===e&&Eg$1(t),o=null!==e?e.memoizedProps:null,a=(i=t.pendingProps).children,Ef$1(r=t.type,i)?a=null:null!==o&&Ef$1(r,o)&&(t.flags|=32),gj$1(e,t),Xi$1(e,t,a,n),t.child;case 6:return null===e&&Eg$1(t),null;case 13:return oj$1(e,t,n);case 4:return yh$1(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ug$1(t,null,r,n):Xi$1(e,t,r,n),t.child;case 11:return i=t.pendingProps,Yi$1(e,t,r=t.type,i=t.elementType===r?i:Ci$1(r,i),n);case 7:return Xi$1(e,t,t.pendingProps,n),t.child;case 8:case 12:return Xi$1(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(o=t.memoizedProps,a=(i=t.pendingProps).value,G$1(Wg$1,(r=t.type._context)._currentValue),r._currentValue=a,null!==o)if(He$1(o.value,a)){if(o.children===i.children&&!Wf$1.current){t=Zi$1(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var s=o.dependencies;if(null!==s){a=o.child;for(var c=s.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=mh$1(-1,n&-n)).tag=2;var u=o.updateQueue;if(null!==u){var l=(u=u.shared).pending;null===l?c.next=c:(c.next=l.next,l.next=c),u.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),bh$1(o.return,n,t),s.lanes|=n;break}c=c.next}}else if(10===o.tag)a=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(a=o.return))throw Error(p$1(341));a.lanes|=n,null!==(s=a.alternate)&&(s.lanes|=n),bh$1(a,n,t),a=o.sibling}else a=o.child;if(null!==a)a.return=o;else for(a=o;null!==a;){if(a===t){a=null;break}if(null!==(o=a.sibling)){o.return=a.return,a=o;break}a=a.return}o=a}Xi$1(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,ch$1(t,n),r=r(i=eh$1(i)),t.flags|=1,Xi$1(e,t,r,n),t.child;case 14:return i=Ci$1(r=t.type,t.pendingProps),$i$1(e,t,r,i=Ci$1(r.type,i),n);case 15:return bj$1(e,t,t.type,t.pendingProps,n);case 17:return i=t.pendingProps,i=t.elementType===(r=t.type)?i:Ci$1(r,i),ij$1(e,t),t.tag=1,Zf$1(r)?(e=!0,cg$1(t)):e=!1,ch$1(t,n),Gi$1(t,r,i),Ii$1(t,r,i,n),jj$1(null,t,r,!0,e,n);case 19:return xj$1(e,t,n);case 22:return dj$1(e,t,n)}throw Error(p$1(156,t.tag))};var kl$1="function"==typeof reportError?reportError:function(e){console.error(e)};function ll$1(e){this._internalRoot=e}function ml$1(e){this._internalRoot=e}function nl$1(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function ol$1(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function pl$1(){}function ql$1(e,t,n,r,i){if(i){if("function"==typeof r){var o=r;r=function(){var e=gl$1(a);o.call(e)}}var a=el$1(t,r,e,0,null,!1,!1,"",pl$1);return e._reactRootContainer=a,e[uf$1]=a.current,sf$1(8===e.nodeType?e.parentNode:e),Rk$1(),a}for(;i=e.lastChild;)e.removeChild(i);if("function"==typeof r){var s=r;r=function(){var e=gl$1(c);s.call(e)}}var c=bl$1(e,0,!1,null,null,!1,!1,"",pl$1);return e._reactRootContainer=c,e[uf$1]=c.current,sf$1(8===e.nodeType?e.parentNode:e),Rk$1(function(){fl$1(t,c,n,r)}),c}function rl$1(e,t,n,r,i){var o=n._reactRootContainer;if(o){var a=o;if("function"==typeof i){var s=i;i=function(){var e=gl$1(a);s.call(e)}}fl$1(t,a,e,i)}else a=ql$1(n,t,e,i,r);return gl$1(a)}ml$1.prototype.render=ll$1.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(p$1(409));fl$1(e,t,null,null)},ml$1.prototype.unmount=ll$1.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Rk$1(function(){fl$1(null,e,null,null)}),t[uf$1]=null}},ml$1.prototype.unstable_scheduleHydration=function(e){if(e){var t=Hc$1();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Qc$1.length&&0!==t&&t<Qc$1[n].priority;n++);Qc$1.splice(n,0,e),0===n&&Vc$1(e)}},Ec$1=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=tc$1(t.pendingLanes);0!==n&&(Cc$1(t,1|n),Dk$1(t,B$1()),!(6&K$1)&&(Gj$1=B$1()+500,jg$1()))}break;case 13:Rk$1(function(){var t=ih$1(e,1);if(null!==t){var n=R$1();gi$1(t,e,1,n)}}),il$1(e,1)}},Fc$1=function(e){if(13===e.tag){var t=ih$1(e,134217728);null!==t&&gi$1(t,e,134217728,R$1()),il$1(e,134217728)}},Gc$1=function(e){if(13===e.tag){var t=yi$1(e),n=ih$1(e,t);null!==n&&gi$1(n,e,t,R$1()),il$1(e,t)}},Hc$1=function(){return C$1},Ic$1=function(e,t){var n=C$1;try{return C$1=e,t()}finally{C$1=n}},yb$1=function(e,t,n){switch(t){case"input":if(bb$1(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Db$1(r);if(!i)throw Error(p$1(90));Wa$1(r),bb$1(r,i)}}}break;case"textarea":ib$1(e,n);break;case"select":null!=(t=n.value)&&fb$1(e,!!n.multiple,t,!1)}},Gb$1=Qk$1,Hb$1=Rk$1;var sl$1={usingClientEntryPoint:!1,Events:[Cb$1,ue$1,Db$1,Eb$1,Fb$1,Qk$1]},tl$1={findFiberByHostInstance:Wc$1,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul$1={bundleType:tl$1.bundleType,version:tl$1.version,rendererPackageName:tl$1.rendererPackageName,rendererConfig:tl$1.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua$1.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Zb$1(e))?null:e.stateNode},findFiberByHostInstance:tl$1.findFiberByHostInstance||jl$1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var vl$1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl$1.isDisabled&&vl$1.supportsFiber)try{kc$1=vl$1.inject(ul$1),lc$1=vl$1}catch(a){}}var __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl$1,createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!nl$1(t))throw Error(p$1(200));return cl$1(e,t,null,n)},createRoot=function(e,t){if(!nl$1(e))throw Error(p$1(299));var n=!1,r="",i=kl$1;return null!=t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=bl$1(e,1,!1,null,null,n,!1,r,i),e[uf$1]=t.current,sf$1(8===e.nodeType?e.parentNode:e),new ll$1(t)},findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(p$1(188));throw e=Object.keys(e).join(","),Error(p$1(268,e))}return null===(e=Zb$1(t))?null:e.stateNode},flushSync=function(e){return Rk$1(e)},hydrate=function(e,t,n){if(!ol$1(t))throw Error(p$1(200));return rl$1(null,e,t,!0,n)},hydrateRoot=function(e,t,n){if(!nl$1(e))throw Error(p$1(405));var r=null!=n&&n.hydratedSources||null,i=!1,o="",a=kl$1;if(null!=n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=el$1(t,null,e,1,null!=n?n:null,i,!1,o,a),e[uf$1]=t.current,sf$1(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new ml$1(t)},render=function(e,t,n){if(!ol$1(t))throw Error(p$1(200));return rl$1(null,e,t,!1,n)},unmountComponentAtNode=function(e){if(!ol$1(e))throw Error(p$1(40));return!!e._reactRootContainer&&(Rk$1(function(){rl$1(null,null,e,!1,function(){e._reactRootContainer=null,e[uf$1]=null})}),!0)},unstable_batchedUpdates=Qk$1,unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!ol$1(n))throw Error(p$1(200));if(null==e||void 0===e._reactInternals)throw Error(p$1(38));return rl$1(e,t,n,!1,r)},version="18.3.1-next-f1338f8080-20240426",reactDom_production_min={__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,createPortal:createPortal,createRoot:createRoot,findDOMNode:findDOMNode,flushSync:flushSync,hydrate:hydrate,hydrateRoot:hydrateRoot,render:render,unmountComponentAtNode:unmountComponentAtNode,unstable_batchedUpdates:unstable_batchedUpdates,unstable_renderSubtreeIntoContainer:unstable_renderSubtreeIntoContainer,version:version},reactDom_development=createCommonjsModule(function(e,t){"production"!==process.env.NODE_ENV&&function(){"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var e=react,n=scheduler,r=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,i=!1;function o(e){if(!i){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];s("warn",e,n)}}function a(e){if(!i){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];s("error",e,n)}}function s(e,t,n){var i=r.ReactDebugCurrentFrame.getStackAddendum();""!==i&&(t+="%s",n=n.concat([i]));var o=n.map(function(e){return String(e)});o.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,o)}var c=10,u=11,l=12,d=13,h=14,p=15,f=17,m=19,g=21,v=22,E=23,y=!1,_=new Set,b={},S={};function w(e,t){T(e,t),T(e+"Capture",t)}function T(e,t){b[e]&&a("EventRegistry: More than one plugin attempted to publish the same registration name, `%s`.",e),b[e]=t;var n=e.toLowerCase();S[n]=e,"onDoubleClick"===e&&(S.ondblclick=e);for(var r=0;r<t.length;r++)_.add(t[r])}var R=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),C=Object.prototype.hasOwnProperty;function I(e){return"function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object"}function O(e){try{return A(e),!1}catch(e){return!0}}function A(e){return""+e}function N(e,t){if(O(e))return a("The provided `%s` attribute is an unsupported type %s. This value must be coerced to a string before before using it here.",t,I(e)),A(e)}function k(e){if(O(e))return a("Form field values (value, checked, defaultValue, or defaultChecked props) must be strings, not %s. This value must be coerced to a string before before using it here.",I(e)),A(e)}var P=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",L=P+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",D=new RegExp("^["+P+"]["+L+"]*$"),M={},x={};function U(e){return!!C.call(x,e)||!C.call(M,e)&&(D.test(e)?(x[e]=!0,!0):(M[e]=!0,a("Invalid attribute name: `%s`",e),!1))}function F(e,t,n){return null!==t?0===t.type:!n&&e.length>2&&("o"===e[0]||"O"===e[0])&&("n"===e[1]||"N"===e[1])}function $(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":if(r)return!1;if(null!==n)return!n.acceptsBooleans;var i=e.toLowerCase().slice(0,5);return"data-"!==i&&"aria-"!==i;default:return!1}}function j(e,t,n,r){if(null==t)return!0;if($(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||t<1}return!1}function V(e){return G.hasOwnProperty(e)?G[e]:null}function B(e,t,n,r,i,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var G={};["children","dangerouslySetInnerHTML","defaultValue","defaultChecked","innerHTML","suppressContentEditableWarning","suppressHydrationWarning","style"].forEach(function(e){G[e]=new B(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];G[t]=new B(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){G[e]=new B(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){G[e]=new B(e,2,!1,e,null,!1,!1)}),["allowFullScreen","async","autoFocus","autoPlay","controls","default","defer","disabled","disablePictureInPicture","disableRemotePlayback","formNoValidate","hidden","loop","noModule","noValidate","open","playsInline","readOnly","required","reversed","scoped","seamless","itemScope"].forEach(function(e){G[e]=new B(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){G[e]=new B(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){G[e]=new B(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){G[e]=new B(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){G[e]=new B(e,5,!1,e.toLowerCase(),null,!1,!1)});var H=/[\-\:]([a-z])/g,W=function(e){return e[1].toUpperCase()};["accent-height","alignment-baseline","arabic-form","baseline-shift","cap-height","clip-path","clip-rule","color-interpolation","color-interpolation-filters","color-profile","color-rendering","dominant-baseline","enable-background","fill-opacity","fill-rule","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","glyph-name","glyph-orientation-horizontal","glyph-orientation-vertical","horiz-adv-x","horiz-origin-x","image-rendering","letter-spacing","lighting-color","marker-end","marker-mid","marker-start","overline-position","overline-thickness","paint-order","panose-1","pointer-events","rendering-intent","shape-rendering","stop-color","stop-opacity","strikethrough-position","strikethrough-thickness","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-anchor","text-decoration","text-rendering","underline-position","underline-thickness","unicode-bidi","unicode-range","units-per-em","v-alphabetic","v-hanging","v-ideographic","v-mathematical","vector-effect","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","writing-mode","xmlns:xlink","x-height"].forEach(function(e){var t=e.replace(H,W);G[t]=new B(t,1,!1,e,null,!1,!1)}),["xlink:actuate","xlink:arcrole","xlink:role","xlink:show","xlink:title","xlink:type"].forEach(function(e){var t=e.replace(H,W);G[t]=new B(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(H,W);G[t]=new B(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){G[e]=new B(e,1,!1,e.toLowerCase(),null,!1,!1)}),G.xlinkHref=new B("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){G[e]=new B(e,1,!1,e.toLowerCase(),null,!0,!0)});var q=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*\:/i,z=!1;function K(e){!z&&q.test(e)&&(z=!0,a("A future version of React will block javascript: URLs as a security precaution. Use event handlers instead if you can. If you need to generate unsafe HTML try using dangerouslySetInnerHTML instead. React was passed %s.",JSON.stringify(e)))}function Y(e,t,n,r){if(r.mustUseProperty)return e[r.propertyName];N(n,t),r.sanitizeURL&&K(""+n);var i=r.attributeName,o=null;if(4===r.type){if(e.hasAttribute(i)){var a=e.getAttribute(i);return""===a||(j(t,n,r,!1)?a:a===""+n?n:a)}}else if(e.hasAttribute(i)){if(j(t,n,r,!1))return e.getAttribute(i);if(3===r.type)return n;o=e.getAttribute(i)}return j(t,n,r,!1)?null===o?n:o:o===""+n?n:o}function X(e,t,n,r){if(U(t)){if(!e.hasAttribute(t))return void 0===n?void 0:null;var i=e.getAttribute(t);return N(n,t),i===""+n?n:i}}function J(e,t,n,r){var i=V(t);if(!F(t,i,r))if(j(t,n,i,r)&&(n=null),r||null===i){if(U(t)){var o=t;null===n?e.removeAttribute(o):(N(n,t),e.setAttribute(o,""+n))}}else if(i.mustUseProperty)e[i.propertyName]=null===n?3!==i.type&&"":n;else{var a=i.attributeName,s=i.attributeNamespace;if(null===n)e.removeAttribute(a);else{var c,u=i.type;3===u||4===u&&!0===n?c="":(N(n,a),c=""+n,i.sanitizeURL&&K(c.toString())),s?e.setAttributeNS(s,a,c):e.setAttribute(a,c)}}}var Q=Symbol.for("react.element"),Z=Symbol.for("react.portal"),ee=Symbol.for("react.fragment"),te=Symbol.for("react.strict_mode"),ne=Symbol.for("react.profiler"),re=Symbol.for("react.provider"),ie=Symbol.for("react.context"),oe=Symbol.for("react.forward_ref"),ae=Symbol.for("react.suspense"),se=Symbol.for("react.suspense_list"),ce=Symbol.for("react.memo"),ue=Symbol.for("react.lazy"),le=(Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode"),Symbol.for("react.offscreen")),de=(Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker"),Symbol.iterator);function he(e){if(null===e||"object"!=typeof e)return null;var t=de&&e[de]||e["@@iterator"];return"function"==typeof t?t:null}var pe,fe,me,ge,ve,Ee,ye,_e=Object.assign,be=0;function Se(){}Se.__reactDisabledLog=!0;var we,Te=r.ReactCurrentDispatcher;function Re(e,t,n){if(void 0===we)try{throw Error()}catch(e){var r=e.stack.trim().match(/\n( *(at )?)/);we=r&&r[1]||""}return"\n"+we+e}var Ce,Ie=!1,Oe="function"==typeof WeakMap?WeakMap:Map;function Ae(e,t){if(!e||Ie)return"";var n,r=Ce.get(e);if(void 0!==r)return r;Ie=!0;var i,o=Error.prepareStackTrace;Error.prepareStackTrace=void 0,i=Te.current,Te.current=null,function(){if(0===be){pe=console.log,fe=console.info,me=console.warn,ge=console.error,ve=console.group,Ee=console.groupCollapsed,ye=console.groupEnd;var e={configurable:!0,enumerable:!0,value:Se,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}be++}();try{if(t){var s=function(){throw Error()};if(Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(s,[])}catch(e){n=e}Reflect.construct(e,[],s)}else{try{s.call()}catch(e){n=e}e.call(s.prototype)}}else{try{throw Error()}catch(e){n=e}e()}}catch(t){if(t&&n&&"string"==typeof t.stack){for(var c=t.stack.split("\n"),u=n.stack.split("\n"),l=c.length-1,d=u.length-1;l>=1&&d>=0&&c[l]!==u[d];)d--;for(;l>=1&&d>=0;l--,d--)if(c[l]!==u[d]){if(1!==l||1!==d)do{if(l--,--d<0||c[l]!==u[d]){var h="\n"+c[l].replace(" at new "," at ");return e.displayName&&h.includes("<anonymous>")&&(h=h.replace("<anonymous>",e.displayName)),"function"==typeof e&&Ce.set(e,h),h}}while(l>=1&&d>=0);break}}}finally{Ie=!1,Te.current=i,function(){if(0==--be){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:_e({},e,{value:pe}),info:_e({},e,{value:fe}),warn:_e({},e,{value:me}),error:_e({},e,{value:ge}),group:_e({},e,{value:ve}),groupCollapsed:_e({},e,{value:Ee}),groupEnd:_e({},e,{value:ye})})}be<0&&a("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=o}var p=e?e.displayName||e.name:"",f=p?Re(p):"";return"function"==typeof e&&Ce.set(e,f),f}function Ne(e,t,n){return Ae(e,!1)}function ke(e,t,n){if(null==e)return"";if("function"==typeof e)return Ae(e,function(e){var t=e.prototype;return!(!t||!t.isReactComponent)}(e));if("string"==typeof e)return Re(e);switch(e){case ae:return Re("Suspense");case se:return Re("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case oe:return Ne(e.render);case ce:return ke(e.type,t,n);case ue:var r=e._payload,i=e._init;try{return ke(i(r),t,n)}catch(e){}}return""}function Pe(e){switch(e.tag){case 5:return Re(e.type);case 16:return Re("Lazy");case d:return Re("Suspense");case m:return Re("SuspenseList");case 0:case 2:case p:return Ne(e.type);case u:return Ne(e.type.render);case 1:return Ae(e.type,!0);default:return""}}function Le(e){try{var t="",n=e;do{t+=Pe(n),n=n.return}while(n);return t}catch(e){return"\nError generating stack: "+e.message+"\n"+e.stack}}function De(e){return e.displayName||"Context"}function Me(e){if(null==e)return null;if("number"==typeof e.tag&&a("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case ee:return"Fragment";case Z:return"Portal";case ne:return"Profiler";case te:return"StrictMode";case ae:return"Suspense";case se:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case ie:return De(e)+".Consumer";case re:return De(e._context)+".Provider";case oe:return function(e,t,n){var r=e.displayName;if(r)return r;var i=t.displayName||t.name||"";return""!==i?n+"("+i+")":n}(e,e.render,"ForwardRef");case ce:var t=e.displayName||null;return null!==t?t:Me(e.type)||"Memo";case ue:var n=e._payload,r=e._init;try{return Me(r(n))}catch(e){return null}}return null}function xe(e){return e.displayName||"Context"}function Ue(e){var t,n,r,i=e.type;switch(e.tag){case 24:return"Cache";case 9:return xe(i)+".Consumer";case c:return xe(i._context)+".Provider";case 18:return"DehydratedFragment";case u:return n="ForwardRef",r=(t=i.render).displayName||t.name||"",i.displayName||(""!==r?n+"("+r+")":n);case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Me(i);case 8:return i===te?"StrictMode":"Mode";case v:return"Offscreen";case l:return"Profiler";case g:return"Scope";case d:return"Suspense";case m:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case f:case 2:case h:case p:if("function"==typeof i)return i.displayName||i.name||null;if("string"==typeof i)return i}return null}Ce=new Oe;var Fe=r.ReactDebugCurrentFrame,$e=null,je=!1;function Ve(){if(null===$e)return null;var e=$e._debugOwner;return null!=e?Ue(e):null}function Be(){return null===$e?"":Le($e)}function Ge(){Fe.getCurrentStack=null,$e=null,je=!1}function He(e){Fe.getCurrentStack=null===e?null:Be,$e=e,je=!1}function We(e){je=e}function qe(e){return""+e}function ze(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return k(e),e;default:return""}}var Ke={button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0};function Ye(e,t){Ke[t.type]||t.onChange||t.onInput||t.readOnly||t.disabled||null==t.value||a("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`."),t.onChange||t.readOnly||t.disabled||null==t.checked||a("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")}function Xe(e){var t=e.type,n=e.nodeName;return n&&"input"===n.toLowerCase()&&("checkbox"===t||"radio"===t)}function Je(e){return e._valueTracker}function Qe(e){Je(e)||(e._valueTracker=function(e){var t=Xe(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);k(e[t]);var r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,o=n.set;Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){k(e),r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable});var a={getValue:function(){return r},setValue:function(e){k(e),r=""+e},stopTracking:function(){!function(e){e._valueTracker=null}(e),delete e[t]}};return a}}(e))}function Ze(e){if(!e)return!1;var t=Je(e);if(!t)return!0;var n=t.getValue(),r=function(e){var t="";return e?t=Xe(e)?e.checked?"true":"false":e.value:t}(e);return r!==n&&(t.setValue(r),!0)}function et(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var tt=!1,nt=!1,rt=!1,it=!1;function ot(e){return"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}function at(e,t){var n=t.checked;return _e({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function st(e,t){Ye(0,t),void 0===t.checked||void 0===t.defaultChecked||nt||(a("%s contains an input of type %s with both checked and defaultChecked props. Input elements must be either controlled or uncontrolled (specify either the checked prop, or the defaultChecked prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",Ve()||"A component",t.type),nt=!0),void 0===t.value||void 0===t.defaultValue||tt||(a("%s contains an input of type %s with both value and defaultValue props. Input elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",Ve()||"A component",t.type),tt=!0),e._wrapperState={initialChecked:null!=t.checked?t.checked:t.defaultChecked,initialValue:ze(null!=t.value?t.value:null==t.defaultValue?"":t.defaultValue),controlled:ot(t)}}function ct(e,t){var n=t.checked;null!=n&&J(e,"checked",n,!1)}function ut(e,t){var n=e,r=ot(t);n._wrapperState.controlled||!r||it||(a("A component is changing an uncontrolled input to be controlled. This is likely caused by the value changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),it=!0),!n._wrapperState.controlled||r||rt||(a("A component is changing a controlled input to be uncontrolled. This is likely caused by the value changing from a defined to undefined, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),rt=!0),ct(e,t);var i=ze(t.value),o=t.type;if(null!=i)"number"===o?(0===i&&""===n.value||n.value!=i)&&(n.value=qe(i)):n.value!==qe(i)&&(n.value=qe(i));else if("submit"===o||"reset"===o)return void n.removeAttribute("value");t.hasOwnProperty("value")?dt(n,t.type,i):t.hasOwnProperty("defaultValue")&&dt(n,t.type,ze(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(n.defaultChecked=!!t.defaultChecked)}function lt(e,t,n){var r=e;if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(("submit"===i||"reset"===i)&&null==t.value)return;var o=qe(r._wrapperState.initialValue);n||o!==r.value&&(r.value=o),r.defaultValue=o}var a=r.name;""!==a&&(r.name=""),r.defaultChecked=!r.defaultChecked,r.defaultChecked=!!r._wrapperState.initialChecked,""!==a&&(r.name=a)}function dt(e,t,n){"number"===t&&et(e.ownerDocument)===e||(null==n?e.defaultValue=qe(e._wrapperState.initialValue):e.defaultValue!==qe(n)&&(e.defaultValue=qe(n)))}var ht=!1,pt=!1,ft=!1;function mt(t,n){null==n.value&&("object"==typeof n.children&&null!==n.children?e.Children.forEach(n.children,function(e){null!=e&&"string"!=typeof e&&"number"!=typeof e&&(pt||(pt=!0,a("Cannot infer the option value of complex children. Pass a `value` prop or use a plain string as children to <option>.")))}):null!=n.dangerouslySetInnerHTML&&(ft||(ft=!0,a("Pass a `value` prop if you set dangerouslyInnerHTML so React knows which value should be selected.")))),null==n.selected||ht||(a("Use the `defaultValue` or `value` props on <select> instead of setting `selected` on <option>."),ht=!0)}var gt,vt=Array.isArray;function Et(e){return vt(e)}function yt(){var e=Ve();return e?"\n\nCheck the render method of `"+e+"`.":""}gt=!1;var _t=["value","defaultValue"];function bt(e,t,n,r){var i=e.options;if(t){for(var o=n,a={},s=0;s<o.length;s++)a["$"+o[s]]=!0;for(var c=0;c<i.length;c++){var u=a.hasOwnProperty("$"+i[c].value);i[c].selected!==u&&(i[c].selected=u),u&&r&&(i[c].defaultSelected=!0)}}else{for(var l=qe(ze(n)),d=null,h=0;h<i.length;h++){if(i[h].value===l)return i[h].selected=!0,void(r&&(i[h].defaultSelected=!0));null!==d||i[h].disabled||(d=i[h])}null!==d&&(d.selected=!0)}}function St(e,t){return _e({},t,{value:void 0})}function wt(e,t){var n=e;!function(e){Ye(0,e);for(var t=0;t<_t.length;t++){var n=_t[t];if(null!=e[n]){var r=Et(e[n]);e.multiple&&!r?a("The `%s` prop supplied to <select> must be an array if `multiple` is true.%s",n,yt()):!e.multiple&&r&&a("The `%s` prop supplied to <select> must be a scalar value if `multiple` is false.%s",n,yt())}}}(t),n._wrapperState={wasMultiple:!!t.multiple},void 0===t.value||void 0===t.defaultValue||gt||(a("Select elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled select element and remove one of these props. More info: https://reactjs.org/link/controlled-components"),gt=!0)}var Tt=!1;function Rt(e,t){var n=e;if(null!=t.dangerouslySetInnerHTML)throw new Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");return _e({},t,{value:void 0,defaultValue:void 0,children:qe(n._wrapperState.initialValue)})}function Ct(e,t){var n=e;Ye(0,t),void 0===t.value||void 0===t.defaultValue||Tt||(a("%s contains a textarea with both value and defaultValue props. Textarea elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled textarea and remove one of these props. More info: https://reactjs.org/link/controlled-components",Ve()||"A component"),Tt=!0);var r=t.value;if(null==r){var i=t.children,o=t.defaultValue;if(null!=i){if(a("Use the `defaultValue` or `value` props instead of setting children on <textarea>."),null!=o)throw new Error("If you supply `defaultValue` on a <textarea>, do not pass children.");if(Et(i)){if(i.length>1)throw new Error("<textarea> can only have at most one child.");i=i[0]}o=i}null==o&&(o=""),r=o}n._wrapperState={initialValue:ze(r)}}function It(e,t){var n=e,r=ze(t.value),i=ze(t.defaultValue);if(null!=r){var o=qe(r);o!==n.value&&(n.value=o),null==t.defaultValue&&n.defaultValue!==o&&(n.defaultValue=o)}null!=i&&(n.defaultValue=qe(i))}function Ot(e,t){var n=e.textContent;n===e._wrapperState.initialValue&&""!==n&&null!==n&&(e.value=n)}var At="http://www.w3.org/1999/xhtml",Nt="http://www.w3.org/2000/svg";function kt(e){switch(e){case"svg":return Nt;case"math":return"http://www.w3.org/1998/Math/MathML";default:return At}}function Pt(e,t){return null==e||e===At?kt(t):e===Nt&&"foreignObject"===t?At:e}var Lt,Dt,Mt=(Dt=function(e,t){if(e.namespaceURI!==Nt||"innerHTML"in e)e.innerHTML=t;else{(Lt=Lt||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>";for(var n=Lt.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;n.firstChild;)e.appendChild(n.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return Dt(e,t)})}:Dt),xt=function(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t},Ut={animation:["animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction"],background:["backgroundAttachment","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundSize"],backgroundPosition:["backgroundPositionX","backgroundPositionY"],border:["borderBottomColor","borderBottomStyle","borderBottomWidth","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRightColor","borderRightStyle","borderRightWidth","borderTopColor","borderTopStyle","borderTopWidth"],borderBlockEnd:["borderBlockEndColor","borderBlockEndStyle","borderBlockEndWidth"],borderBlockStart:["borderBlockStartColor","borderBlockStartStyle","borderBlockStartWidth"],borderBottom:["borderBottomColor","borderBottomStyle","borderBottomWidth"],borderColor:["borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"],borderImage:["borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth"],borderInlineEnd:["borderInlineEndColor","borderInlineEndStyle","borderInlineEndWidth"],borderInlineStart:["borderInlineStartColor","borderInlineStartStyle","borderInlineStartWidth"],borderLeft:["borderLeftColor","borderLeftStyle","borderLeftWidth"],borderRadius:["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"],borderRight:["borderRightColor","borderRightStyle","borderRightWidth"],borderStyle:["borderBottomStyle","borderLeftStyle","borderRightStyle","borderTopStyle"],borderTop:["borderTopColor","borderTopStyle","borderTopWidth"],borderWidth:["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth"],columnRule:["columnRuleColor","columnRuleStyle","columnRuleWidth"],columns:["columnCount","columnWidth"],flex:["flexBasis","flexGrow","flexShrink"],flexFlow:["flexDirection","flexWrap"],font:["fontFamily","fontFeatureSettings","fontKerning","fontLanguageOverride","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition","fontWeight","lineHeight"],fontVariant:["fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition"],gap:["columnGap","rowGap"],grid:["gridAutoColumns","gridAutoFlow","gridAutoRows","gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],gridArea:["gridColumnEnd","gridColumnStart","gridRowEnd","gridRowStart"],gridColumn:["gridColumnEnd","gridColumnStart"],gridColumnGap:["columnGap"],gridGap:["columnGap","rowGap"],gridRow:["gridRowEnd","gridRowStart"],gridRowGap:["rowGap"],gridTemplate:["gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],listStyle:["listStyleImage","listStylePosition","listStyleType"],margin:["marginBottom","marginLeft","marginRight","marginTop"],marker:["markerEnd","markerMid","markerStart"],mask:["maskClip","maskComposite","maskImage","maskMode","maskOrigin","maskPositionX","maskPositionY","maskRepeat","maskSize"],maskPosition:["maskPositionX","maskPositionY"],outline:["outlineColor","outlineStyle","outlineWidth"],overflow:["overflowX","overflowY"],padding:["paddingBottom","paddingLeft","paddingRight","paddingTop"],placeContent:["alignContent","justifyContent"],placeItems:["alignItems","justifyItems"],placeSelf:["alignSelf","justifySelf"],textDecoration:["textDecorationColor","textDecorationLine","textDecorationStyle"],textEmphasis:["textEmphasisColor","textEmphasisStyle"],transition:["transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction"],wordWrap:["overflowWrap"]},Ft={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$t=["Webkit","ms","Moz","O"];function jt(e,t,n){return null==t||"boolean"==typeof t||""===t?"":n||"number"!=typeof t||0===t||Ft.hasOwnProperty(e)&&Ft[e]?(function(e,t){O(e)&&(a("The provided `%s` CSS property is an unsupported type %s. This value must be coerced to a string before before using it here.",t,I(e)),A(e))}(t,e),(""+t).trim()):t+"px"}Object.keys(Ft).forEach(function(e){$t.forEach(function(t){Ft[function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}(t,e)]=Ft[e]})});var Vt=/([A-Z])/g,Bt=/^ms-/,Gt=/^(?:webkit|moz|o)[A-Z]/,Ht=/^-ms-/,Wt=/-(.)/g,qt=/;\s*$/,zt={},Kt={},Yt=!1,Xt=!1;function Jt(e){var t="",n="";for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];if(null!=i){var o=0===r.indexOf("--");t+=n+(o?r:r.replace(Vt,"-$1").toLowerCase().replace(Bt,"-ms-"))+":",t+=jt(r,i,o),n=";"}}return t||null}function Qt(e,t){var n,r,i=e.style;for(var o in t)if(t.hasOwnProperty(o)){var s=0===o.indexOf("--");s||(r=t[o],(n=o).indexOf("-")>-1?function(e){zt.hasOwnProperty(e)&&zt[e]||(zt[e]=!0,a("Unsupported style property %s. Did you mean %s?",e,e.replace(Ht,"ms-").replace(Wt,function(e,t){return t.toUpperCase()})))}(n):Gt.test(n)?function(e){zt.hasOwnProperty(e)&&zt[e]||(zt[e]=!0,a("Unsupported vendor-prefixed style property %s. Did you mean %s?",e,e.charAt(0).toUpperCase()+e.slice(1)))}(n):qt.test(r)&&function(e,t){Kt.hasOwnProperty(t)&&Kt[t]||(Kt[t]=!0,a('Style property values shouldn\'t contain a semicolon. Try "%s: %s" instead.',e,t.replace(qt,"")))}(n,r),"number"==typeof r&&(isNaN(r)?function(e){Yt||(Yt=!0,a("`NaN` is an invalid value for the `%s` css style property.",e))}(n):isFinite(r)||function(e){Xt||(Xt=!0,a("`Infinity` is an invalid value for the `%s` css style property.",e))}(n)));var c=jt(o,t[o],s);"float"===o&&(o="cssFloat"),s?i.setProperty(o,c):i[o]=c}}function Zt(e){var t={};for(var n in e)for(var r=Ut[n]||[n],i=0;i<r.length;i++)t[r[i]]=n;return t}var en=_e({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function tn(e,t){if(t){if(en[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw new Error(e+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw new Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://reactjs.org/link/dangerously-set-inner-html for more information.")}if(!t.suppressContentEditableWarning&&t.contentEditable&&null!=t.children&&a("A component is `contentEditable` and contains `children` managed by React. It is now your responsibility to guarantee that none of those nodes are unexpectedly modified or duplicated. This is probably not intentional."),null!=t.style&&"object"!=typeof t.style)throw new Error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.")}}function nn(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rn={accept:"accept",acceptcharset:"acceptCharset","accept-charset":"acceptCharset",accesskey:"accessKey",action:"action",allowfullscreen:"allowFullScreen",alt:"alt",as:"as",async:"async",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",capture:"capture",cellpadding:"cellPadding",cellspacing:"cellSpacing",challenge:"challenge",charset:"charSet",checked:"checked",children:"children",cite:"cite",class:"className",classid:"classID",classname:"className",cols:"cols",colspan:"colSpan",content:"content",contenteditable:"contentEditable",contextmenu:"contextMenu",controls:"controls",controlslist:"controlsList",coords:"coords",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",data:"data",datetime:"dateTime",default:"default",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",defer:"defer",dir:"dir",disabled:"disabled",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback",download:"download",draggable:"draggable",enctype:"encType",enterkeyhint:"enterKeyHint",for:"htmlFor",form:"form",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",headers:"headers",height:"height",hidden:"hidden",high:"high",href:"href",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",id:"id",imagesizes:"imageSizes",imagesrcset:"imageSrcSet",innerhtml:"innerHTML",inputmode:"inputMode",integrity:"integrity",is:"is",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",kind:"kind",label:"label",lang:"lang",list:"list",loop:"loop",low:"low",manifest:"manifest",marginwidth:"marginWidth",marginheight:"marginHeight",max:"max",maxlength:"maxLength",media:"media",mediagroup:"mediaGroup",method:"method",min:"min",minlength:"minLength",multiple:"multiple",muted:"muted",name:"name",nomodule:"noModule",nonce:"nonce",novalidate:"noValidate",open:"open",optimum:"optimum",pattern:"pattern",placeholder:"placeholder",playsinline:"playsInline",poster:"poster",preload:"preload",profile:"profile",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rel:"rel",required:"required",reversed:"reversed",role:"role",rows:"rows",rowspan:"rowSpan",sandbox:"sandbox",scope:"scope",scoped:"scoped",scrolling:"scrolling",seamless:"seamless",selected:"selected",shape:"shape",size:"size",sizes:"sizes",span:"span",spellcheck:"spellCheck",src:"src",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",start:"start",step:"step",style:"style",summary:"summary",tabindex:"tabIndex",target:"target",title:"title",type:"type",usemap:"useMap",value:"value",width:"width",wmode:"wmode",wrap:"wrap",about:"about",accentheight:"accentHeight","accent-height":"accentHeight",accumulate:"accumulate",additive:"additive",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",alphabetic:"alphabetic",amplitude:"amplitude",arabicform:"arabicForm","arabic-form":"arabicForm",ascent:"ascent",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",azimuth:"azimuth",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",bbox:"bbox",begin:"begin",bias:"bias",by:"by",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clip:"clip",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",color:"color",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",cursor:"cursor",cx:"cx",cy:"cy",d:"d",datatype:"datatype",decelerate:"decelerate",descent:"descent",diffuseconstant:"diffuseConstant",direction:"direction",display:"display",divisor:"divisor",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",dur:"dur",dx:"dx",dy:"dy",edgemode:"edgeMode",elevation:"elevation",enablebackground:"enableBackground","enable-background":"enableBackground",end:"end",exponent:"exponent",externalresourcesrequired:"externalResourcesRequired",fill:"fill",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filter:"filter",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",focusable:"focusable",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",format:"format",from:"from",fx:"fx",fy:"fy",g1:"g1",g2:"g2",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",hanging:"hanging",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",ideographic:"ideographic",imagerendering:"imageRendering","image-rendering":"imageRendering",in2:"in2",in:"in",inlist:"inlist",intercept:"intercept",k1:"k1",k2:"k2",k3:"k3",k4:"k4",k:"k",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",kerning:"kerning",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",local:"local",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",mask:"mask",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",mathematical:"mathematical",mode:"mode",numoctaves:"numOctaves",offset:"offset",opacity:"opacity",operator:"operator",order:"order",orient:"orient",orientation:"orientation",origin:"origin",overflow:"overflow",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder",panose1:"panose1","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",points:"points",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",prefix:"prefix",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",property:"property",r:"r",radius:"radius",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",resource:"resource",restart:"restart",result:"result",results:"results",rotate:"rotate",rx:"rx",ry:"ry",scale:"scale",security:"security",seed:"seed",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",slope:"slope",spacing:"spacing",specularconstant:"specularConstant",specularexponent:"specularExponent",speed:"speed",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stemh:"stemh",stemv:"stemv",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",string:"string",stroke:"stroke",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",to:"to",transform:"transform",typeof:"typeof",u1:"u1",u2:"u2",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicode:"unicode",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",values:"values",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",version:"version",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",visibility:"visibility",vmathematical:"vMathematical","v-mathematical":"vMathematical",vocab:"vocab",widths:"widths",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",x1:"x1",x2:"x2",x:"x",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang",xmlns:"xmlns","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",y1:"y1",y2:"y2",y:"y",ychannelselector:"yChannelSelector",z:"z",zoomandpan:"zoomAndPan"},on={"aria-current":0,"aria-description":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},an={},sn=new RegExp("^(aria)-["+L+"]*$"),cn=new RegExp("^(aria)[A-Z]["+L+"]*$");function un(e,t){if(C.call(an,t)&&an[t])return!0;if(cn.test(t)){var n="aria-"+t.slice(4).toLowerCase(),r=on.hasOwnProperty(n)?n:null;if(null==r)return a("Invalid ARIA attribute `%s`. ARIA attributes follow the pattern aria-* and must be lowercase.",t),an[t]=!0,!0;if(t!==r)return a("Invalid ARIA attribute `%s`. Did you mean `%s`?",t,r),an[t]=!0,!0}if(sn.test(t)){var i=t.toLowerCase(),o=on.hasOwnProperty(i)?i:null;if(null==o)return an[t]=!0,!1;if(t!==o)return a("Unknown ARIA attribute `%s`. Did you mean `%s`?",t,o),an[t]=!0,!0}return!0}var ln,dn=!1,hn={},pn=/^on./,fn=/^on[^A-Z]/,mn=new RegExp("^(aria)-["+L+"]*$"),gn=new RegExp("^(aria)[A-Z]["+L+"]*$");ln=function(e,t,n,r){if(C.call(hn,t)&&hn[t])return!0;var i=t.toLowerCase();if("onfocusin"===i||"onfocusout"===i)return a("React uses onFocus and onBlur instead of onFocusIn and onFocusOut. All React events are normalized to bubble, so onFocusIn and onFocusOut are not needed/supported by React."),hn[t]=!0,!0;if(null!=r){var o=r.possibleRegistrationNames;if(r.registrationNameDependencies.hasOwnProperty(t))return!0;var s=o.hasOwnProperty(i)?o[i]:null;if(null!=s)return a("Invalid event handler property `%s`. Did you mean `%s`?",t,s),hn[t]=!0,!0;if(pn.test(t))return a("Unknown event handler property `%s`. It will be ignored.",t),hn[t]=!0,!0}else if(pn.test(t))return fn.test(t)&&a("Invalid event handler property `%s`. React events use the camelCase naming convention, for example `onClick`.",t),hn[t]=!0,!0;if(mn.test(t)||gn.test(t))return!0;if("innerhtml"===i)return a("Directly setting property `innerHTML` is not permitted. For more information, lookup documentation on `dangerouslySetInnerHTML`."),hn[t]=!0,!0;if("aria"===i)return a("The `aria` attribute is reserved for future use in React. Pass individual `aria-` attributes instead."),hn[t]=!0,!0;if("is"===i&&null!=n&&"string"!=typeof n)return a("Received a `%s` for a string attribute `is`. If this is expected, cast the value to a string.",typeof n),hn[t]=!0,!0;if("number"==typeof n&&isNaN(n))return a("Received NaN for the `%s` attribute. If this is expected, cast the value to a string.",t),hn[t]=!0,!0;var c=V(t),u=null!==c&&0===c.type;if(rn.hasOwnProperty(i)){var l=rn[i];if(l!==t)return a("Invalid DOM property `%s`. Did you mean `%s`?",t,l),hn[t]=!0,!0}else if(!u&&t!==i)return a("React does not recognize the `%s` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `%s` instead. If you accidentally passed it from a parent component, remove it from the DOM element.",t,i),hn[t]=!0,!0;return"boolean"==typeof n&&$(t,n,c,!1)?(n?a('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.',n,t,t,n,t):a('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.',n,t,t,n,t,t,t),hn[t]=!0,!0):!!u||($(t,n,c,!1)?(hn[t]=!0,!1):("false"!==n&&"true"!==n||null===c||3!==c.type||(a("Received the string `%s` for the boolean attribute `%s`. %s Did you mean %s={%s}?",n,t,"false"===n?"The browser will interpret it as a truthy value.":'Although this works, it will not work as expected if you pass the string "false".',t,n),hn[t]=!0),!0))};var vn=null;function En(e){var t=e.target||e.srcElement||window;return t.correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}var yn=null,_n=null,bn=null;function Sn(e){var t=cu(e);if(t){if("function"!=typeof yn)throw new Error("setRestoreImplementation() needs to be called to handle a target for controlled events. This error is likely caused by a bug in React. Please file an issue.");var n=t.stateNode;if(n){var r=lu(n);yn(t.stateNode,t.type,r)}}}function wn(e){_n?bn?bn.push(e):bn=[e]:_n=e}function Tn(){if(_n){var e=_n,t=bn;if(_n=null,bn=null,Sn(e),t)for(var n=0;n<t.length;n++)Sn(t[n])}}var Rn=function(e,t){return e(t)},Cn=function(){},In=!1;function On(e,t,n){if(In)return e(t,n);In=!0;try{return Rn(e,t,n)}finally{In=!1,(null!==_n||null!==bn)&&(Cn(),Tn())}}function An(e,t){var n=e.stateNode;if(null===n)return null;var r=lu(n);if(null===r)return null;var i=r[t];if(function(e,t,n){switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":return!(!n.disabled||(r=t,"button"!==r&&"input"!==r&&"select"!==r&&"textarea"!==r));default:return!1}var r}(t,e.type,r))return null;if(i&&"function"!=typeof i)throw new Error("Expected `"+t+"` listener to be a function, instead got a value of `"+typeof i+"` type.");return i}var Nn=!1;if(R)try{var kn={};Object.defineProperty(kn,"passive",{get:function(){Nn=!0}}),window.addEventListener("test",kn,kn),window.removeEventListener("test",kn,kn)}catch(e){Nn=!1}function Pn(e,t,n,r,i,o,a,s,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(e){this.onError(e)}}var Ln=Pn;if("undefined"!=typeof window&&"function"==typeof window.dispatchEvent&&"undefined"!=typeof document&&"function"==typeof document.createEvent){var Dn=document.createElement("react");Ln=function(e,t,n,r,i,o,a,s,c){if("undefined"==typeof document||null===document)throw new Error("The `document` global was defined when React was initialized, but is not defined anymore. This can happen in a test environment if a component schedules an update from an asynchronous callback, but the test has already finished running. To solve this, you can either unmount the component at the end of your test (and ensure that any asynchronous operations get canceled in `componentWillUnmount`), or you can change the test itself to be asynchronous.");var u=document.createEvent("Event"),l=!1,d=!0,h=window.event,p=Object.getOwnPropertyDescriptor(window,"event");function f(){Dn.removeEventListener(b,v,!1),void 0!==window.event&&window.hasOwnProperty("event")&&(window.event=h)}var m,g=Array.prototype.slice.call(arguments,3);function v(){l=!0,f(),t.apply(n,g),d=!1}var E=!1,y=!1;function _(e){if(E=!0,null===(m=e.error)&&0===e.colno&&0===e.lineno&&(y=!0),e.defaultPrevented&&null!=m&&"object"==typeof m)try{m._suppressLogging=!0}catch(e){}}var b="react-"+(e||"invokeguardedcallback");if(window.addEventListener("error",_),Dn.addEventListener(b,v,!1),u.initEvent(b,!1,!1),Dn.dispatchEvent(u),p&&Object.defineProperty(window,"event",p),l&&d&&(E?y&&(m=new Error("A cross-origin error was thrown. React doesn't have access to the actual error object in development. See https://reactjs.org/link/crossorigin-error for more information.")):m=new Error("An error was thrown inside one of your components, but React doesn't know what it was. This is likely due to browser flakiness. React does its best to preserve the \"Pause on exceptions\" behavior of the DevTools, which requires some DEV-mode only tricks. It's possible that these don't work in your browser. Try triggering the error in production mode, or switching to a modern browser. If you suspect that this is actually an issue with React, please file an issue."),this.onError(m)),window.removeEventListener("error",_),!l)return f(),Pn.apply(this,arguments)}}var Mn=Ln,xn=!1,Un=null,Fn=!1,$n=null,jn={onError:function(e){xn=!0,Un=e}};function Vn(e,t,n,r,i,o,a,s,c){xn=!1,Un=null,Mn.apply(jn,arguments)}function Bn(){if(xn){var e=Un;return xn=!1,Un=null,e}throw new Error("clearCaughtError was called but no error was captured. This error is likely caused by a bug in React. Please file an issue.")}function Gn(e){return e._reactInternals}var Hn=128,Wn=256,qn=512,zn=1024,Kn=2048,Yn=4096,Xn=8192,Jn=16384,Qn=32768,Zn=65536,er=131072,tr=1048576,nr=2097152,rr=4194304,ir=16777216,or=33554432,ar=8772,sr=2064,cr=14680064,ur=r.ReactCurrentOwner;function lr(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{var r=t;do{4098&(t=r).flags&&(n=t.return),r=t.return}while(r)}return 3===t.tag?n:null}function dr(e){if(e.tag===d){var t=e.memoizedState;if(null===t){var n=e.alternate;null!==n&&(t=n.memoizedState)}if(null!==t)return t.dehydrated}return null}function hr(e){return 3===e.tag?e.stateNode.containerInfo:null}function pr(e){if(lr(e)!==e)throw new Error("Unable to find node on an unmounted component.")}function fr(e){var t=e.alternate;if(!t){var n=lr(e);if(null===n)throw new Error("Unable to find node on an unmounted component.");return n!==e?null:e}for(var r=e,i=t;;){var o=r.return;if(null===o)break;var a=o.alternate;if(null===a){var s=o.return;if(null!==s){r=i=s;continue}break}if(o.child===a.child){for(var c=o.child;c;){if(c===r)return pr(o),e;if(c===i)return pr(o),t;c=c.sibling}throw new Error("Unable to find node on an unmounted component.")}if(r.return!==i.return)r=o,i=a;else{for(var u=!1,l=o.child;l;){if(l===r){u=!0,r=o,i=a;break}if(l===i){u=!0,i=o,r=a;break}l=l.sibling}if(!u){for(l=a.child;l;){if(l===r){u=!0,r=a,i=o;break}if(l===i){u=!0,i=a,r=o;break}l=l.sibling}if(!u)throw new Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(r.alternate!==i)throw new Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(3!==r.tag)throw new Error("Unable to find node on an unmounted component.");return r.stateNode.current===r?e:t}function mr(e){var t=fr(e);return null!==t?gr(t):null}function gr(e){if(5===e.tag||6===e.tag)return e;for(var t=e.child;null!==t;){var n=gr(t);if(null!==n)return n;t=t.sibling}return null}function vr(e){var t=fr(e);return null!==t?Er(t):null}function Er(e){if(5===e.tag||6===e.tag)return e;for(var t=e.child;null!==t;){if(4!==t.tag){var n=Er(t);if(null!==n)return n}t=t.sibling}return null}var yr=n.unstable_scheduleCallback,_r=n.unstable_cancelCallback,br=n.unstable_shouldYield,Sr=n.unstable_requestPaint,wr=n.unstable_now,Tr=n.unstable_getCurrentPriorityLevel,Rr=n.unstable_ImmediatePriority,Cr=n.unstable_UserBlockingPriority,Ir=n.unstable_NormalPriority,Or=n.unstable_LowPriority,Ar=n.unstable_IdlePriority,Nr=n.unstable_yieldValue,kr=n.unstable_setDisableYieldValue,Pr=null,Lr=null,Dr=null,Mr=!1,xr="undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__;function Ur(e){if("function"==typeof Nr&&(kr(e),i=e),Lr&&"function"==typeof Lr.setStrictMode)try{Lr.setStrictMode(Pr,e)}catch(e){Mr||(Mr=!0,a("React instrumentation encountered an error: %s",e))}}function Fr(e){Dr=e}function $r(){for(var e=new Map,t=1,n=0;n<Zr;n++){var r=ki(t);e.set(t,r),t*=2}return e}function jr(){null!==Dr&&"function"==typeof Dr.markCommitStopped&&Dr.markCommitStopped()}function Vr(e){null!==Dr&&"function"==typeof Dr.markComponentRenderStarted&&Dr.markComponentRenderStarted(e)}function Br(){null!==Dr&&"function"==typeof Dr.markComponentRenderStopped&&Dr.markComponentRenderStopped()}function Gr(e){null!==Dr&&"function"==typeof Dr.markComponentLayoutEffectUnmountStarted&&Dr.markComponentLayoutEffectUnmountStarted(e)}function Hr(){null!==Dr&&"function"==typeof Dr.markComponentLayoutEffectUnmountStopped&&Dr.markComponentLayoutEffectUnmountStopped()}function Wr(e,t,n){null!==Dr&&"function"==typeof Dr.markComponentErrored&&Dr.markComponentErrored(e,t,n)}function qr(e){null!==Dr&&"function"==typeof Dr.markRenderStarted&&Dr.markRenderStarted(e)}function zr(){null!==Dr&&"function"==typeof Dr.markRenderStopped&&Dr.markRenderStopped()}function Kr(e,t){null!==Dr&&"function"==typeof Dr.markStateUpdateScheduled&&Dr.markStateUpdateScheduled(e,t)}var Yr=16,Xr=Math.clz32?Math.clz32:function(e){var t=e>>>0;return 0===t?32:31-(Jr(t)/Qr|0)|0},Jr=Math.log,Qr=Math.LN2,Zr=31,ei=1,ti=2,ni=4,ri=8,ii=16,oi=32,ai=4194240,si=1024,ci=2048,ui=4096,li=8192,di=16384,hi=32768,pi=65536,fi=131072,mi=262144,gi=524288,vi=1048576,Ei=2097152,yi=130023424,_i=4194304,bi=8388608,Si=16777216,wi=33554432,Ti=67108864,Ri=_i,Ci=134217728,Ii=268435455,Oi=268435456,Ai=536870912,Ni=1073741824;function ki(e){return e&ei?"Sync":e&ti?"InputContinuousHydration":e&ni?"InputContinuous":e&ri?"DefaultHydration":e&ii?"Default":e&oi?"TransitionHydration":e&ai?"Transition":e&yi?"Retry":e&Ci?"SelectiveHydration":e&Oi?"IdleHydration":e&Ai?"Idle":e&Ni?"Offscreen":void 0}var Pi=-1,Li=64,Di=_i;function Mi(e){switch(Hi(e)){case ei:return ei;case ti:return ti;case ni:return ni;case ri:return ri;case ii:return ii;case oi:return oi;case 64:case 128:case 256:case 512:case si:case ci:case ui:case li:case di:case hi:case pi:case fi:case mi:case gi:case vi:case Ei:return e&ai;case _i:case bi:case Si:case wi:case Ti:return e&yi;case Ci:return Ci;case Oi:return Oi;case Ai:return Ai;case Ni:return Ni;default:return a("Should have found matching lanes. This is a bug in React."),e}}function xi(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,a=n&Ii;if(0!==a){var s=a&~i;if(0!==s)r=Mi(s);else{var c=a&o;0!==c&&(r=Mi(c))}}else{var u=n&~i;0!==u?r=Mi(u):0!==o&&(r=Mi(o))}if(0===r)return 0;if(0!==t&&t!==r&&!(t&i)){var l=Hi(r),d=Hi(t);if(l>=d||l===ii&&d&ai)return t}r&ni&&(r|=n&ii);var h=e.entangledLanes;if(0!==h)for(var p=e.entanglements,f=r&h;f>0;){var m=qi(f);r|=p[m],f&=~(1<<m)}return r}function Ui(e,t){switch(e){case ei:case ti:case ni:return t+250;case ri:case ii:case oi:case 64:case 128:case 256:case 512:case si:case ci:case ui:case li:case di:case hi:case pi:case fi:case mi:case gi:case vi:case Ei:return t+5e3;case _i:case bi:case Si:case wi:case Ti:case Ci:case Oi:case Ai:case Ni:return Pi;default:return a("Should have found matching lanes. This is a bug in React."),Pi}}function Fi(e){var t=e.pendingLanes&~Ni;return 0!==t?t:t&Ni?Ni:0}function $i(e){return!!(e&Ii)}function ji(e){return(e&yi)===e}function Vi(e,t){return!!(t&(ti|ni|ri|ii))}function Bi(e){return!!(e&ai)}function Gi(){var e=Li;return(Li<<=1)&ai||(Li=64),e}function Hi(e){return e&-e}function Wi(e){return Hi(e)}function qi(e){return 31-Xr(e)}function zi(e){return qi(e)}function Ki(e,t){return!!(e&t)}function Yi(e,t){return(e&t)===t}function Xi(e,t){return e|t}function Ji(e,t){return e&~t}function Qi(e,t){return e&t}function Zi(e){for(var t=[],n=0;n<Zr;n++)t.push(e);return t}function eo(e,t,n){e.pendingLanes|=t,t!==Ai&&(e.suspendedLanes=0,e.pingedLanes=0),e.eventTimes[zi(t)]=n}function to(e,t,n){e.pingedLanes|=e.suspendedLanes&t}function no(e,t){for(var n=e.entangledLanes|=t,r=e.entanglements,i=n;i;){var o=qi(i),a=1<<o;a&t|r[o]&t&&(r[o]|=t),i&=~a}}function ro(e,t,n){if(xr)for(var r=e.pendingUpdatersLaneMap;n>0;){var i=zi(n),o=1<<i;r[i].add(t),n&=~o}}function io(e,t){if(xr)for(var n=e.pendingUpdatersLaneMap,r=e.memoizedUpdaters;t>0;){var i=zi(t),o=1<<i,a=n[i];a.size>0&&(a.forEach(function(e){var t=e.alternate;null!==t&&r.has(t)||r.add(e)}),a.clear()),t&=~o}}var oo,ao,so,co,uo,lo=ei,ho=ni,po=ii,fo=Ai,mo=0;function go(){return mo}function vo(e){mo=e}function Eo(e,t){return 0!==e&&e<t}function yo(e){var t=Hi(e);return Eo(lo,t)?Eo(ho,t)?$i(t)?po:fo:ho:lo}function _o(e){return e.current.memoizedState.isDehydrated}function bo(e){oo(e)}var So=!1,wo=[],To=null,Ro=null,Co=null,Io=new Map,Oo=new Map,Ao=[],No=["mousedown","mouseup","touchcancel","touchend","touchstart","auxclick","dblclick","pointercancel","pointerdown","pointerup","dragend","dragstart","drop","compositionend","compositionstart","keydown","keypress","keyup","input","textInput","copy","cut","paste","click","change","contextmenu","reset","submit"];function ko(e,t){switch(e){case"focusin":case"focusout":To=null;break;case"dragenter":case"dragleave":Ro=null;break;case"mouseover":case"mouseout":Co=null;break;case"pointerover":case"pointerout":Io.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Oo.delete(t.pointerId)}}function Po(e,t,n,r,i,o){if(null===e||e.nativeEvent!==o){var a=function(e,t,n,r,i){return{blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:i,targetContainers:[r]}}(t,n,r,i,o);if(null!==t){var s=cu(t);null!==s&&ao(s)}return a}e.eventSystemFlags|=r;var c=e.targetContainers;return null!==i&&-1===c.indexOf(i)&&c.push(i),e}function Lo(e){var t=su(e.target);if(null!==t){var n=lr(t);if(null!==n){var r=n.tag;if(r===d){var i=dr(n);if(null!==i)return e.blockedOn=i,void uo(e.priority,function(){so(n)})}else if(3===r&&_o(n.stateNode))return void(e.blockedOn=hr(n))}}e.blockedOn=null}function Do(e){if(null!==e.blockedOn)return!1;for(var t,n=e.targetContainers;n.length>0;){var r=qo(0,0,0,e.nativeEvent);if(null!==r){var i=cu(r);return null!==i&&ao(i),e.blockedOn=r,!1}var o=e.nativeEvent,s=new o.constructor(o.type,o);t=s,null!==vn&&a("Expected currently replaying event to be null. This error is likely caused by a bug in React. Please file an issue."),vn=t,o.target.dispatchEvent(s),null===vn&&a("Expected currently replaying event to not be null. This error is likely caused by a bug in React. Please file an issue."),vn=null,n.shift()}return!0}function Mo(e,t,n){Do(e)&&n.delete(t)}function xo(){So=!1,null!==To&&Do(To)&&(To=null),null!==Ro&&Do(Ro)&&(Ro=null),null!==Co&&Do(Co)&&(Co=null),Io.forEach(Mo),Oo.forEach(Mo)}function Uo(e,t){e.blockedOn===t&&(e.blockedOn=null,So||(So=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,xo)))}function Fo(e){if(wo.length>0){Uo(wo[0],e);for(var t=1;t<wo.length;t++){var n=wo[t];n.blockedOn===e&&(n.blockedOn=null)}}null!==To&&Uo(To,e),null!==Ro&&Uo(Ro,e),null!==Co&&Uo(Co,e);var r=function(t){return Uo(t,e)};Io.forEach(r),Oo.forEach(r);for(var i=0;i<Ao.length;i++){var o=Ao[i];o.blockedOn===e&&(o.blockedOn=null)}for(;Ao.length>0;){var a=Ao[0];if(null!==a.blockedOn)break;Lo(a),null===a.blockedOn&&Ao.shift()}}var $o=r.ReactCurrentBatchConfig,jo=!0;function Vo(e){jo=!!e}function Bo(e,t,n,r){var i=go(),o=$o.transition;$o.transition=null;try{vo(lo),Ho(e,t,n,r)}finally{vo(i),$o.transition=o}}function Go(e,t,n,r){var i=go(),o=$o.transition;$o.transition=null;try{vo(ho),Ho(e,t,n,r)}finally{vo(i),$o.transition=o}}function Ho(e,t,n,r){jo&&function(e,t,n,r){var i=qo(0,0,0,r);if(null===i)return Bs(e,t,r,Wo,n),void ko(e,r);if(function(e,t,n,r,i){switch(t){case"focusin":return To=Po(To,e,t,n,r,i),!0;case"dragenter":return Ro=Po(Ro,e,t,n,r,i),!0;case"mouseover":return Co=Po(Co,e,t,n,r,i),!0;case"pointerover":var o=i,a=o.pointerId;return Io.set(a,Po(Io.get(a)||null,e,t,n,r,o)),!0;case"gotpointercapture":var s=i,c=s.pointerId;return Oo.set(c,Po(Oo.get(c)||null,e,t,n,r,s)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(ko(e,r),4&t&&No.indexOf(e)>-1){for(;null!==i;){var o=cu(i);null!==o&&bo(o);var a=qo(0,0,0,r);if(null===a&&Bs(e,t,r,Wo,n),a===i)break;i=a}null!==i&&r.stopPropagation()}else Bs(e,t,r,null,n)}(e,t,n,r)}var Wo=null;function qo(e,t,n,r){Wo=null;var i=su(En(r));if(null!==i){var o=lr(i);if(null===o)i=null;else{var a=o.tag;if(a===d){var s=dr(o);if(null!==s)return s;i=null}else if(3===a){if(_o(o.stateNode))return hr(o);i=null}else o!==i&&(i=null)}}return Wo=i,null}function zo(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return lo;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return ho;case"message":switch(Tr()){case Rr:return lo;case Cr:return ho;case Ir:case Or:return po;case Ar:return fo;default:return po}default:return po}}var Ko=null,Yo=null,Xo=null;function Jo(){if(Xo)return Xo;var e,t,n=Yo,r=n.length,i=Qo(),o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===i[o-t];t++);return Xo=i.slice(e,t>1?1-t:void 0)}function Qo(){return"value"in Ko?Ko.value:Ko.textContent}function Zo(e){var t,n=e.keyCode;return"charCode"in e?0===(t=e.charCode)&&13===n&&(t=13):t=n,10===t&&(t=13),t>=32||13===t?t:0}function ea(){return!0}function ta(){return!1}function na(e){function t(t,n,r,i,o){for(var a in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)if(e.hasOwnProperty(a)){var s=e[a];this[a]=s?s(i):i[a]}return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?ea:ta,this.isPropagationStopped=ta,this}return _e(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ea)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ea)},persist:function(){},isPersistent:ea}),t}var ra,ia,oa,aa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},sa=na(aa),ca=_e({},aa,{view:0,detail:0}),ua=na(ca),la=_e({},ca,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sa,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(function(e){e!==oa&&(oa&&"mousemove"===e.type?(ra=e.screenX-oa.screenX,ia=e.screenY-oa.screenY):(ra=0,ia=0),oa=e)}(e),ra)},movementY:function(e){return"movementY"in e?e.movementY:ia}}),da=na(la),ha=na(_e({},la,{dataTransfer:0})),pa=na(_e({},ca,{relatedTarget:0})),fa=na(_e({},aa,{animationName:0,elapsedTime:0,pseudoElement:0})),ma=na(_e({},aa,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),ga=na(_e({},aa,{data:0})),va=ga,Ea={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ya={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_a={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ba(e){var t=this.nativeEvent;if(t.getModifierState)return t.getModifierState(e);var n=_a[e];return!!n&&!!t[n]}function Sa(e){return ba}var wa=na(_e({},ca,{key:function(e){if(e.key){var t=Ea[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"===e.type){var n=Zo(e);return 13===n?"Enter":String.fromCharCode(n)}return"keydown"===e.type||"keyup"===e.type?ya[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sa,charCode:function(e){return"keypress"===e.type?Zo(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Zo(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Ta=na(_e({},la,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Ra=na(_e({},ca,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sa})),Ca=na(_e({},aa,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ia=na(_e({},la,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Oa=[9,13,27,32],Aa=229,Na=R&&"CompositionEvent"in window,ka=null;R&&"documentMode"in document&&(ka=document.documentMode);var Pa=R&&"TextEvent"in window&&!ka,La=R&&(!Na||ka&&ka>8&&ka<=11),Da=32,Ma=String.fromCharCode(Da),xa=!1;function Ua(e,t){switch(e){case"keyup":return-1!==Oa.indexOf(t.keyCode);case"keydown":return t.keyCode!==Aa;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fa(e){var t=e.detail;return"object"==typeof t&&"data"in t?t.data:null}function $a(e){return"ko"===e.locale}var ja=!1,Va={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ba(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Va[e.type]:"textarea"===t}function Ga(e,t,n,r){wn(r);var i=Hs(t,"onChange");if(i.length>0){var o=new sa("onChange","change",null,n,r);e.push({event:o,listeners:i})}}var Ha=null,Wa=null;function qa(e){Ms(e,0)}function za(e){if(Ze(uu(e)))return e}function Ka(e,t){if("change"===e)return t}var Ya=!1;function Xa(){Ha&&(Ha.detachEvent("onpropertychange",Ja),Ha=null,Wa=null)}function Ja(e){"value"===e.propertyName&&za(Wa)&&function(e){var t=[];Ga(t,Wa,e,En(e)),On(qa,t)}(e)}function Qa(e,t,n){"focusin"===e?(Xa(),function(e,t){Wa=t,(Ha=e).attachEvent("onpropertychange",Ja)}(t,n)):"focusout"===e&&Xa()}function Za(e,t){if("selectionchange"===e||"keyup"===e||"keydown"===e)return za(Wa)}function es(e,t){if("click"===e)return za(t)}function ts(e,t){if("input"===e||"change"===e)return za(t)}R&&(Ya=function(){if(!R)return!1;var e="oninput",t=e in document;if(!t){var n=document.createElement("div");n.setAttribute(e,"return;"),t="function"==typeof n[e]}return t}()&&(!document.documentMode||document.documentMode>9));var ns="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function rs(e,t){if(ns(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++){var o=n[i];if(!C.call(t,o)||!ns(e[o],t[o]))return!1}return!0}function is(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function os(e){for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}function as(e,t){for(var n=is(e),r=0,i=0;n;){if(3===n.nodeType){if(i=r+n.textContent.length,r<=t&&i>=t)return{node:n,offset:t-r};r=i}n=is(os(n))}}function ss(e){return e&&3===e.nodeType}function cs(e,t){return!(!e||!t)&&(e===t||!ss(e)&&(ss(t)?cs(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function us(e){return e&&e.ownerDocument&&cs(e.ownerDocument.documentElement,e)}function ls(e){try{return"string"==typeof e.contentWindow.location.href}catch(e){return!1}}function ds(){for(var e=window,t=et();t instanceof e.HTMLIFrameElement;){if(!ls(t))return t;t=et((e=t.contentWindow).document)}return t}function hs(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var ps=R&&"documentMode"in document&&document.documentMode<=11,fs=null,ms=null,gs=null,vs=!1;function Es(e,t,n){var r,i=(r=n).window===r?r.document:9===r.nodeType?r:r.ownerDocument;if(!vs&&null!=fs&&fs===et(i)){var o=function(e){if("selectionStart"in e&&hs(e))return{start:e.selectionStart,end:e.selectionEnd};var t=(e.ownerDocument&&e.ownerDocument.defaultView||window).getSelection();return{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}}(fs);if(!gs||!rs(gs,o)){gs=o;var a=Hs(ms,"onSelect");if(a.length>0){var s=new sa("onSelect","select",null,t,n);e.push({event:s,listeners:a}),s.target=fs}}}}function ys(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var _s={animationend:ys("Animation","AnimationEnd"),animationiteration:ys("Animation","AnimationIteration"),animationstart:ys("Animation","AnimationStart"),transitionend:ys("Transition","TransitionEnd")},bs={},Ss={};function ws(e){if(bs[e])return bs[e];if(!_s[e])return e;var t=_s[e];for(var n in t)if(t.hasOwnProperty(n)&&n in Ss)return bs[e]=t[n];return e}R&&(Ss=document.createElement("div").style,"AnimationEvent"in window||(delete _s.animationend.animation,delete _s.animationiteration.animation,delete _s.animationstart.animation),"TransitionEvent"in window||delete _s.transitionend.transition);var Ts=ws("animationend"),Rs=ws("animationiteration"),Cs=ws("animationstart"),Is=ws("transitionend"),Os=new Map,As=["abort","auxClick","cancel","canPlay","canPlayThrough","click","close","contextMenu","copy","cut","drag","dragEnd","dragEnter","dragExit","dragLeave","dragOver","dragStart","drop","durationChange","emptied","encrypted","ended","error","gotPointerCapture","input","invalid","keyDown","keyPress","keyUp","load","loadedData","loadedMetadata","loadStart","lostPointerCapture","mouseDown","mouseMove","mouseOut","mouseOver","mouseUp","paste","pause","play","playing","pointerCancel","pointerDown","pointerMove","pointerOut","pointerOver","pointerUp","progress","rateChange","reset","resize","seeked","seeking","stalled","submit","suspend","timeUpdate","touchCancel","touchEnd","touchStart","volumeChange","scroll","toggle","touchMove","waiting","wheel"];function Ns(e,t){Os.set(e,t),w(t,[e])}!function(){for(var e=0;e<As.length;e++){var t=As[e];Ns(t.toLowerCase(),"on"+(t[0].toUpperCase()+t.slice(1)))}Ns(Ts,"onAnimationEnd"),Ns(Rs,"onAnimationIteration"),Ns(Cs,"onAnimationStart"),Ns("dblclick","onDoubleClick"),Ns("focusin","onFocus"),Ns("focusout","onBlur"),Ns(Is,"onTransitionEnd")}(),T("onMouseEnter",["mouseout","mouseover"]),T("onMouseLeave",["mouseout","mouseover"]),T("onPointerEnter",["pointerout","pointerover"]),T("onPointerLeave",["pointerout","pointerover"]),w("onChange",["change","click","focusin","focusout","input","keydown","keyup","selectionchange"]),w("onSelect",["focusout","contextmenu","dragend","focusin","keydown","keyup","mousedown","mouseup","selectionchange"]),w("onBeforeInput",["compositionend","keypress","textInput","paste"]),w("onCompositionEnd",["compositionend","focusout","keydown","keypress","keyup","mousedown"]),w("onCompositionStart",["compositionstart","focusout","keydown","keypress","keyup","mousedown"]),w("onCompositionUpdate",["compositionupdate","focusout","keydown","keypress","keyup","mousedown"]);var ks=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","resize","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],Ps=new Set(["cancel","close","invalid","load","scroll","toggle"].concat(ks));function Ls(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,o,a,s,c){if(Vn.apply(this,arguments),xn){var u=Bn();Fn||(Fn=!0,$n=u)}}(r,t,void 0,e),e.currentTarget=null}function Ds(e,t,n){var r;if(n)for(var i=t.length-1;i>=0;i--){var o=t[i],a=o.instance,s=o.currentTarget,c=o.listener;if(a!==r&&e.isPropagationStopped())return;Ls(e,c,s),r=a}else for(var u=0;u<t.length;u++){var l=t[u],d=l.instance,h=l.currentTarget,p=l.listener;if(d!==r&&e.isPropagationStopped())return;Ls(e,p,h),r=d}}function Ms(e,t){for(var n=!!(4&t),r=0;r<e.length;r++){var i=e[r];Ds(i.event,i.listeners,n)}!function(){if(Fn){var e=$n;throw Fn=!1,$n=null,e}}()}function xs(e,t){Ps.has(e)||a('Did not expect a listenToNonDelegatedEvent() call for "%s". This is a bug in React. Please file an issue.',e);var n,r,i=(void 0===(r=(n=t)[eu])&&(r=n[eu]=new Set),r),o=function(e){return e+"__bubble"}(e);i.has(o)||(js(t,e,2,!1),i.add(o))}function Us(e,t,n){Ps.has(e)&&!t&&a('Did not expect a listenToNativeEvent() call for "%s" in the bubble phase. This is a bug in React. Please file an issue.',e);var r=0;t&&(r|=4),js(n,e,r,t)}var Fs="_reactListening"+Math.random().toString(36).slice(2);function $s(e){if(!e[Fs]){e[Fs]=!0,_.forEach(function(t){"selectionchange"!==t&&(Ps.has(t)||Us(t,!1,e),Us(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null!==t&&(t[Fs]||(t[Fs]=!0,Us("selectionchange",!1,t)))}}function js(e,t,n,r,i){var o=function(e,t,n){var r;switch(zo(t)){case lo:r=Bo;break;case ho:r=Go;break;default:r=Ho}return r.bind(null,t,n,e)}(e,t,n),a=void 0;Nn&&("touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0)),r?void 0!==a?function(e,t,n,r){e.addEventListener(t,n,{capture:!0,passive:r})}(e,t,o,a):function(e,t,n){e.addEventListener(t,n,!0)}(e,t,o):void 0!==a?function(e,t,n,r){e.addEventListener(t,n,{passive:r})}(e,t,o,a):function(e,t,n){e.addEventListener(t,n,!1)}(e,t,o)}function Vs(e,t){return e===t||8===e.nodeType&&e.parentNode===t}function Bs(e,t,n,r,i){var o=r;if(!(1&t||2&t)){var a=i;if(null!==r){var s=r;e:for(;;){if(null===s)return;var c=s.tag;if(3===c||4===c){var u=s.stateNode.containerInfo;if(Vs(u,a))break;if(4===c)for(var l=s.return;null!==l;){var d=l.tag;if((3===d||4===d)&&Vs(l.stateNode.containerInfo,a))return;l=l.return}for(;null!==u;){var h=su(u);if(null===h)return;var p=h.tag;if(5===p||6===p){s=o=h;continue e}u=u.parentNode}}s=s.return}}}On(function(){return function(e,t,n,r){var i=[];(function(e,t,n,r,i,o){(function(e,t,n,r,i,o){var a=Os.get(t);if(void 0!==a){var s=sa,c=t;switch(t){case"keypress":if(0===Zo(r))return;case"keydown":case"keyup":s=wa;break;case"focusin":c="focus",s=pa;break;case"focusout":c="blur",s=pa;break;case"beforeblur":case"afterblur":s=pa;break;case"click":if(2===r.button)return;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":s=da;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":s=ha;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":s=Ra;break;case Ts:case Rs:case Cs:s=fa;break;case Is:s=Ca;break;case"scroll":s=ua;break;case"wheel":s=Ia;break;case"copy":case"cut":case"paste":s=ma;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":s=Ta}var u=!!(4&o),l=function(e,t,n,r,i){for(var o=r?null!==t?t+"Capture":null:t,a=[],s=e,c=null;null!==s;){var u=s.stateNode;if(5===s.tag&&null!==u&&(c=u,null!==o)){var l=An(s,o);null!=l&&a.push(Gs(s,l,c))}if(i)break;s=s.return}return a}(n,a,0,u,!u&&"scroll"===t);if(l.length>0){var d=new s(a,c,null,r,i);e.push({event:d,listeners:l})}}})(e,t,n,r,i,o),!(7&o)&&(function(e,t,n,r,i){var o="mouseover"===t||"pointerover"===t,a="mouseout"===t||"pointerout"===t;if(o&&r!==vn){var s=r.relatedTarget||r.fromElement;if(s&&(su(s)||au(s)))return}if(a||o){var c,u,l;if(i.window===i)c=i;else{var d=i.ownerDocument;c=d?d.defaultView||d.parentWindow:window}if(a){var h=r.relatedTarget||r.toElement;u=n,null!==(l=h?su(h):null)&&(l!==lr(l)||5!==l.tag&&6!==l.tag)&&(l=null)}else u=null,l=n;if(u!==l){var p=da,f="onMouseLeave",m="onMouseEnter",g="mouse";"pointerout"!==t&&"pointerover"!==t||(p=Ta,f="onPointerLeave",m="onPointerEnter",g="pointer");var v=null==u?c:uu(u),E=null==l?c:uu(l),y=new p(f,g+"leave",u,r,i);y.target=v,y.relatedTarget=E;var _=null;if(su(i)===n){var b=new p(m,g+"enter",l,r,i);b.target=E,b.relatedTarget=v,_=b}!function(e,t,n,r,i){var o=r&&i?function(e,t){for(var n=e,r=t,i=0,o=n;o;o=Ws(o))i++;for(var a=0,s=r;s;s=Ws(s))a++;for(;i-a>0;)n=Ws(n),i--;for(;a-i>0;)r=Ws(r),a--;for(var c=i;c--;){if(n===r||null!==r&&n===r.alternate)return n;n=Ws(n),r=Ws(r)}return null}(r,i):null;null!==r&&qs(e,t,r,o,!1),null!==i&&null!==n&&qs(e,n,i,o,!0)}(e,y,_,u,l)}}}(e,t,n,r,i),function(e,t,n,r,i){var o,a,s,c,u,l,d=n?uu(n):window;if("select"===(c=(s=d).nodeName&&s.nodeName.toLowerCase())||"input"===c&&"file"===s.type?o=Ka:Ba(d)?Ya?o=ts:(o=Za,a=Qa):function(e){var t=e.nodeName;return t&&"input"===t.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)}(d)&&(o=es),o){var h=o(t,n);if(h)return void Ga(e,h,r,i)}a&&a(t,d,n),"focusout"===t&&(l=(u=d)._wrapperState)&&l.controlled&&"number"===u.type&&dt(u,"number",u.value)}(e,t,n,r,i),function(e,t,n,r,i){var o=n?uu(n):window;switch(t){case"focusin":(Ba(o)||"true"===o.contentEditable)&&(fs=o,ms=n,gs=null);break;case"focusout":fs=null,ms=null,gs=null;break;case"mousedown":vs=!0;break;case"contextmenu":case"mouseup":case"dragend":vs=!1,Es(e,r,i);break;case"selectionchange":if(ps)break;case"keydown":case"keyup":Es(e,r,i)}}(e,t,n,r,i),function(e,t,n,r,i){(function(e,t,n,r,i){var o,a;if(Na?o=function(e){switch(e){case"compositionstart":return"onCompositionStart";case"compositionend":return"onCompositionEnd";case"compositionupdate":return"onCompositionUpdate"}}(t):ja?Ua(t,r)&&(o="onCompositionEnd"):function(e,t){return"keydown"===e&&t.keyCode===Aa}(t,r)&&(o="onCompositionStart"),!o)return null;La&&!$a(r)&&(ja||"onCompositionStart"!==o?"onCompositionEnd"===o&&ja&&(a=Jo()):ja=function(e){return Ko=e,Yo=Qo(),!0}(i));var s=Hs(n,o);if(s.length>0){var c=new ga(o,t,null,r,i);if(e.push({event:c,listeners:s}),a)c.data=a;else{var u=Fa(r);null!==u&&(c.data=u)}}})(e,t,n,r,i),function(e,t,n,r,i){var o;if(!(o=Pa?function(e,t){switch(e){case"compositionend":return Fa(t);case"keypress":return t.which!==Da?null:(xa=!0,Ma);case"textInput":var n=t.data;return n===Ma&&xa?null:n;default:return null}}(t,r):function(e,t){if(ja){if("compositionend"===e||!Na&&Ua(e,t)){var n=Jo();return Ko=null,Yo=null,Xo=null,ja=!1,n}return null}switch(e){case"paste":default:return null;case"keypress":if(!function(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}(t)){if(t.char&&t.char.length>1)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return La&&!$a(t)?null:t.data}}(t,r)))return null;var a=Hs(n,"onBeforeInput");if(a.length>0){var s=new va("onBeforeInput","beforeinput",null,r,i);e.push({event:s,listeners:a}),s.data=o}}(e,t,n,r,i)}(e,t,n,r,i))})(i,e,r,n,En(n),t),Ms(i,t)}(e,t,n,o)})}function Gs(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hs(e,t){for(var n=t+"Capture",r=[],i=e;null!==i;){var o=i.stateNode;if(5===i.tag&&null!==o){var a=o,s=An(i,n);null!=s&&r.unshift(Gs(i,s,a));var c=An(i,t);null!=c&&r.push(Gs(i,c,a))}i=i.return}return r}function Ws(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qs(e,t,n,r,i){for(var o=t._reactName,a=[],s=n;null!==s&&s!==r;){var c=s.alternate,u=s.stateNode,l=s.tag;if(null!==c&&c===r)break;if(5===l&&null!==u){var d=u;if(i){var h=An(s,o);null!=h&&a.unshift(Gs(s,h,d))}else if(!i){var p=An(s,o);null!=p&&a.push(Gs(s,p,d))}}s=s.return}0!==a.length&&e.push({event:t,listeners:a})}var zs,Ks,Ys,Xs,Js,Qs,Zs,ec=!1,tc="dangerouslySetInnerHTML",nc="suppressContentEditableWarning",rc="suppressHydrationWarning",ic="autoFocus",oc="children",ac="style",sc="__html";zs={dialog:!0,webview:!0},Ks=function(e,t){(function(e,t){nn(e,t)||function(e,t){var n=[];for(var r in t)un(0,r)||n.push(r);var i=n.map(function(e){return"`"+e+"`"}).join(", ");1===n.length?a("Invalid aria prop %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",i,e):n.length>1&&a("Invalid aria props %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",i,e)}(e,t)})(e,t),function(e,t){"input"!==e&&"textarea"!==e&&"select"!==e||null==t||null!==t.value||dn||(dn=!0,a("select"===e&&t.multiple?"`value` prop on `%s` should not be null. Consider using an empty array when `multiple` is set to `true` to clear the component or `undefined` for uncontrolled components.":"`value` prop on `%s` should not be null. Consider using an empty string to clear the component or `undefined` for uncontrolled components.",e))}(e,t),function(e,t,n){nn(e,t)||function(e,t,n){var r=[];for(var i in t)ln(0,i,t[i],n)||r.push(i);var o=r.map(function(e){return"`"+e+"`"}).join(", ");1===r.length?a("Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",o,e):r.length>1&&a("Invalid values for props %s on <%s> tag. Either remove them from the element, or pass a string or number value to keep them in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",o,e)}(e,t,n)}(e,t,{registrationNameDependencies:b,possibleRegistrationNames:S})},Qs=R&&!document.documentMode,Ys=function(e,t,n){if(!ec){var r=lc(n),i=lc(t);i!==r&&(ec=!0,a("Prop `%s` did not match. Server: %s Client: %s",e,JSON.stringify(i),JSON.stringify(r)))}},Xs=function(e){if(!ec){ec=!0;var t=[];e.forEach(function(e){t.push(e)}),a("Extra attributes from the server: %s",t)}},Js=function(e,t){!1===t?a("Expected `%s` listener to be a function, instead got `false`.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.",e,e,e):a("Expected `%s` listener to be a function, instead got a value of `%s` type.",e,typeof t)},Zs=function(e,t){var n=e.namespaceURI===At?e.ownerDocument.createElement(e.tagName):e.ownerDocument.createElementNS(e.namespaceURI,e.tagName);return n.innerHTML=t,n.innerHTML};var cc=/\r\n?/g,uc=/\u0000|\uFFFD/g;function lc(e){return O(t=e)&&(a("The provided HTML markup uses a value of unsupported type %s. This value must be coerced to a string before before using it here.",I(t)),A(t)),("string"==typeof e?e:""+e).replace(cc,"\n").replace(uc,"");var t}function dc(e,t,n,r){var i=lc(t),o=lc(e);if(o!==i&&(r&&(ec||(ec=!0,a('Text content did not match. Server: "%s" Client: "%s"',o,i))),n))throw new Error("Text content does not match server-rendered HTML.")}function hc(e){return 9===e.nodeType?e:e.ownerDocument}function pc(){}function fc(e){e.onclick=pc}function mc(e,t){ec||(ec=!0,a("Did not expect server HTML to contain a <%s> in <%s>.",t.nodeName.toLowerCase(),e.nodeName.toLowerCase()))}function gc(e,t){ec||(ec=!0,a('Did not expect server HTML to contain the text node "%s" in <%s>.',t.nodeValue,e.nodeName.toLowerCase()))}function vc(e,t,n){ec||(ec=!0,a("Expected server HTML to contain a matching <%s> in <%s>.",t,e.nodeName.toLowerCase()))}function Ec(e,t){""!==t&&(ec||(ec=!0,a('Expected server HTML to contain a matching text node for "%s" in <%s>.',t,e.nodeName.toLowerCase())))}var yc,_c,bc=["address","applet","area","article","aside","base","basefont","bgsound","blockquote","body","br","button","caption","center","col","colgroup","dd","details","dir","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","isindex","li","link","listing","main","marquee","menu","menuitem","meta","nav","noembed","noframes","noscript","object","ol","p","param","plaintext","pre","script","section","select","source","style","summary","table","tbody","td","template","textarea","tfoot","th","thead","title","tr","track","ul","wbr","xmp"],Sc=["applet","caption","html","table","td","th","marquee","object","template","foreignObject","desc","title"],wc=Sc.concat(["button"]),Tc=["dd","dt","li","option","optgroup","p","rp","rt"],Rc={current:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null};_c=function(e,t){var n=_e({},e||Rc),r={tag:t};return-1!==Sc.indexOf(t)&&(n.aTagInScope=null,n.buttonTagInScope=null,n.nobrTagInScope=null),-1!==wc.indexOf(t)&&(n.pTagInButtonScope=null),-1!==bc.indexOf(t)&&"address"!==t&&"div"!==t&&"p"!==t&&(n.listItemTagAutoclosing=null,n.dlItemTagAutoclosing=null),n.current=r,"form"===t&&(n.formTag=r),"a"===t&&(n.aTagInScope=r),"button"===t&&(n.buttonTagInScope=r),"nobr"===t&&(n.nobrTagInScope=r),"p"===t&&(n.pTagInButtonScope=r),"li"===t&&(n.listItemTagAutoclosing=r),"dd"!==t&&"dt"!==t||(n.dlItemTagAutoclosing=r),n};var Cc={};yc=function(e,t,n){var r=(n=n||Rc).current,i=r&&r.tag;null!=t&&(null!=e&&a("validateDOMNesting: when childText is passed, childTag should be null"),e="#text");var o=function(e,t){switch(t){case"select":return"option"===e||"optgroup"===e||"#text"===e;case"optgroup":return"option"===e||"#text"===e;case"option":return"#text"===e;case"tr":return"th"===e||"td"===e||"style"===e||"script"===e||"template"===e;case"tbody":case"thead":case"tfoot":return"tr"===e||"style"===e||"script"===e||"template"===e;case"colgroup":return"col"===e||"template"===e;case"table":return"caption"===e||"colgroup"===e||"tbody"===e||"tfoot"===e||"thead"===e||"style"===e||"script"===e||"template"===e;case"head":return"base"===e||"basefont"===e||"bgsound"===e||"link"===e||"meta"===e||"title"===e||"noscript"===e||"noframes"===e||"style"===e||"script"===e||"template"===e;case"html":return"head"===e||"body"===e||"frameset"===e;case"frameset":return"frame"===e;case"#document":return"html"===e}switch(e){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return"h1"!==t&&"h2"!==t&&"h3"!==t&&"h4"!==t&&"h5"!==t&&"h6"!==t;case"rp":case"rt":return-1===Tc.indexOf(t);case"body":case"caption":case"col":case"colgroup":case"frameset":case"frame":case"head":case"html":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return null==t}return!0}(e,i)?null:r,s=o?null:function(e,t){switch(e){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return t.pTagInButtonScope;case"form":return t.formTag||t.pTagInButtonScope;case"li":return t.listItemTagAutoclosing;case"dd":case"dt":return t.dlItemTagAutoclosing;case"button":return t.buttonTagInScope;case"a":return t.aTagInScope;case"nobr":return t.nobrTagInScope}return null}(e,n),c=o||s;if(c){var u=c.tag,l=!!o+"|"+e+"|"+u;if(!Cc[l]){Cc[l]=!0;var d=e,h="";if("#text"===e?/\S/.test(t)?d="Text nodes":(d="Whitespace text nodes",h=" Make sure you don't have any extra whitespace between tags on each line of your source code."):d="<"+e+">",o){var p="";"table"===u&&"tr"===e&&(p+=" Add a <tbody>, <thead> or <tfoot> to your code to match the DOM tree generated by the browser."),a("validateDOMNesting(...): %s cannot appear as a child of <%s>.%s%s",d,u,h,p)}else a("validateDOMNesting(...): %s cannot appear as a descendant of <%s>.",d,u)}}};var Ic="suppressHydrationWarning",Oc="$",Ac="/$",Nc="$?",kc="$!",Pc=null,Lc=null;function Dc(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Mc="function"==typeof setTimeout?setTimeout:void 0,xc="function"==typeof clearTimeout?clearTimeout:void 0,Uc="function"==typeof Promise?Promise:void 0,Fc="function"==typeof queueMicrotask?queueMicrotask:void 0!==Uc?function(e){return Uc.resolve(null).then(e).catch($c)}:Mc;function $c(e){setTimeout(function(){throw e})}function jc(e){xt(e,"")}function Vc(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType){var o=i.data;if(o===Ac){if(0===r)return e.removeChild(i),void Fo(t);r--}else o!==Oc&&o!==Nc&&o!==kc||r++}n=i}while(n);Fo(t)}function Bc(e){var t=e.style;"function"==typeof t.setProperty?t.setProperty("display","none","important"):t.display="none"}function Gc(e,t){var n=t.style,r=null!=n&&n.hasOwnProperty("display")?n.display:null;e.style.display=jt("display",r)}function Hc(e,t){e.nodeValue=t}function Wc(e){return e.data===Nc}function qc(e){return e.data===kc}function zc(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){var n=e.data;if(n===Oc||n===kc||n===Nc)break;if(n===Ac)return null}}return e}function Kc(e){return zc(e.nextSibling)}function Yc(e){for(var t=e.previousSibling,n=0;t;){if(8===t.nodeType){var r=t.data;if(r===Oc||r===kc||r===Nc){if(0===n)return t;n--}else r===Ac&&n++}t=t.previousSibling}return null}var Xc=Math.random().toString(36).slice(2),Jc="__reactFiber$"+Xc,Qc="__reactProps$"+Xc,Zc="__reactContainer$"+Xc,eu="__reactEvents$"+Xc,tu="__reactListeners$"+Xc,nu="__reactHandles$"+Xc;function ru(e,t){t[Jc]=e}function iu(e,t){t[Zc]=e}function ou(e){e[Zc]=null}function au(e){return!!e[Zc]}function su(e){var t=e[Jc];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Zc]||n[Jc]){var r=t.alternate;if(null!==t.child||null!==r&&null!==r.child)for(var i=Yc(e);null!==i;){var o=i[Jc];if(o)return o;i=Yc(i)}return t}n=(e=n).parentNode}return null}function cu(e){var t=e[Jc]||e[Zc];return!t||5!==t.tag&&6!==t.tag&&t.tag!==d&&3!==t.tag?null:t}function uu(e){if(5===e.tag||6===e.tag)return e.stateNode;throw new Error("getNodeFromInstance: Invalid argument.")}function lu(e){return e[Qc]||null}function du(e,t){e[Qc]=t}var hu={},pu=r.ReactDebugCurrentFrame;function fu(e){if(e){var t=e._owner,n=ke(e.type,e._source,t?t.type:null);pu.setExtraStackFrame(n)}else pu.setExtraStackFrame(null)}function mu(e,t,n,r,i){var o=Function.call.bind(C);for(var s in e)if(o(e,s)){var c=void 0;try{if("function"!=typeof e[s]){var u=Error((r||"React class")+": "+n+" type `"+s+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[s]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw u.name="Invariant Violation",u}c=e[s](t,s,r,n,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(e){c=e}!c||c instanceof Error||(fu(i),a("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",r||"React class",n,s,typeof c),fu(null)),c instanceof Error&&!(c.message in hu)&&(hu[c.message]=!0,fu(i),a("Failed %s type: %s",n,c.message),fu(null))}}var gu,vu=[];gu=[];var Eu,yu=-1;function _u(e){return{current:e}}function bu(e,t){yu<0?a("Unexpected pop."):(t!==gu[yu]&&a("Unexpected Fiber popped."),e.current=vu[yu],vu[yu]=null,gu[yu]=null,yu--)}function Su(e,t,n){yu++,vu[yu]=e.current,gu[yu]=n,e.current=t}Eu={};var wu={};Object.freeze(wu);var Tu=_u(wu),Ru=_u(!1),Cu=wu;function Iu(e,t,n){return n&&ku(t)?Cu:Tu.current}function Ou(e,t,n){var r=e.stateNode;r.__reactInternalMemoizedUnmaskedChildContext=t,r.__reactInternalMemoizedMaskedChildContext=n}function Au(e,t){var n=e.type.contextTypes;if(!n)return wu;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={};for(var o in n)i[o]=t[o];return mu(n,i,"context",Ue(e)||"Unknown"),r&&Ou(e,t,i),i}function Nu(){return Ru.current}function ku(e){return null!=e.childContextTypes}function Pu(e){bu(Ru,e),bu(Tu,e)}function Lu(e){bu(Ru,e),bu(Tu,e)}function Du(e,t,n){if(Tu.current!==wu)throw new Error("Unexpected context found on stack. This error is likely caused by a bug in React. Please file an issue.");Su(Tu,t,e),Su(Ru,n,e)}function Mu(e,t,n){var r=e.stateNode,i=t.childContextTypes;if("function"!=typeof r.getChildContext){var o=Ue(e)||"Unknown";return Eu[o]||(Eu[o]=!0,a("%s.childContextTypes is specified but there is no getChildContext() method on the instance. You can either define getChildContext() on %s or remove childContextTypes from it.",o,o)),n}var s=r.getChildContext();for(var c in s)if(!(c in i))throw new Error((Ue(e)||"Unknown")+'.getChildContext(): key "'+c+'" is not defined in childContextTypes.');return mu(i,s,"child context",Ue(e)||"Unknown"),_e({},n,s)}function xu(e){var t=e.stateNode;return Cu=Tu.current,Su(Tu,t&&t.__reactInternalMemoizedMergedChildContext||wu,e),Su(Ru,Ru.current,e),!0}function Uu(e,t,n){var r=e.stateNode;if(!r)throw new Error("Expected to have an instance by this point. This error is likely caused by a bug in React. Please file an issue.");if(n){var i=Mu(e,t,Cu);r.__reactInternalMemoizedMergedChildContext=i,bu(Ru,e),bu(Tu,e),Su(Tu,i,e),Su(Ru,n,e)}else bu(Ru,e),Su(Ru,n,e)}var Fu=null,$u=!1,ju=!1;function Vu(e){null===Fu?Fu=[e]:Fu.push(e)}function Bu(){$u&&Gu()}function Gu(){if(!ju&&null!==Fu){ju=!0;var e=0,t=go();try{var n=Fu;for(vo(lo);e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Fu=null,$u=!1}catch(t){throw null!==Fu&&(Fu=Fu.slice(e+1)),yr(Rr,Gu),t}finally{vo(t),ju=!1}}return null}var Hu=[],Wu=0,qu=null,zu=0,Ku=[],Yu=0,Xu=null,Ju=1,Qu="";function Zu(e,t){il(),Hu[Wu++]=zu,Hu[Wu++]=qu,qu=e,zu=t}function el(e,t,n){il(),Ku[Yu++]=Ju,Ku[Yu++]=Qu,Ku[Yu++]=Xu,Xu=e;var r=Ju,i=Qu,o=nl(r)-1,a=r&~(1<<o),s=n+1,c=nl(t)+o;if(c>30){var u=o-o%5,l=(a&(1<<u)-1).toString(32),d=a>>u,h=o-u,p=nl(t)+h;Ju=1<<p|s<<h|d,Qu=l+i}else Ju=1<<c|s<<o|a,Qu=i}function tl(e){il(),null!==e.return&&(Zu(e,1),el(e,1,0))}function nl(e){return 32-Xr(e)}function rl(e){for(;e===qu;)qu=Hu[--Wu],Hu[Wu]=null,zu=Hu[--Wu],Hu[Wu]=null;for(;e===Xu;)Xu=Ku[--Yu],Ku[Yu]=null,Qu=Ku[--Yu],Ku[Yu]=null,Ju=Ku[--Yu],Ku[Yu]=null}function il(){Tl()||a("Expected to be hydrating. This is a bug in React. Please file an issue.")}var ol=null,al=null,sl=!1,cl=!1,ul=null;function ll(){cl=!0}function dl(e,t){switch(e.tag){case 3:!function(e,t){1===t.nodeType?mc(e,t):8===t.nodeType||gc(e,t)}(e.stateNode.containerInfo,t);break;case 5:!function(e,t,n,r,i){(i||!0!==t[Ic])&&(1===r.nodeType?mc(n,r):8===r.nodeType||gc(n,r))}(0,e.memoizedProps,e.stateNode,t,!!(1&e.mode));break;case d:var n=e.memoizedState;null!==n.dehydrated&&function(e,t){var n=e.parentNode;null!==n&&(1===t.nodeType?mc(n,t):8===t.nodeType||gc(n,t))}(n.dehydrated,t)}}function hl(e,t){dl(e,t);var n,r=((n=UE(5,null,null,0)).elementType="DELETED",n);r.stateNode=t,r.return=e;var i=e.deletions;null===i?(e.deletions=[r],e.flags|=16):i.push(r)}function pl(e,t){if(!cl)switch(e.tag){case 3:var n=e.stateNode.containerInfo;switch(t.tag){case 5:!function(e,t){vc(e,t)}(n,t.type);break;case 6:!function(e,t){Ec(e,t)}(n,t.pendingProps)}break;case 5:var r=e.memoizedProps,i=e.stateNode;switch(t.tag){case 5:!function(e,t,n,r,i,o){(o||!0!==t[Ic])&&vc(n,r)}(0,r,i,t.type,0,!!(1&e.mode));break;case 6:!function(e,t,n,r,i){(i||!0!==t[Ic])&&Ec(n,r)}(0,r,i,t.pendingProps,!!(1&e.mode))}break;case d:var o=e.memoizedState.dehydrated;if(null!==o)switch(t.tag){case 5:!function(e,t){var n=e.parentNode;null!==n&&vc(n,t)}(o,t.type);break;case 6:!function(e,t){var n=e.parentNode;null!==n&&Ec(n,t)}(o,t.pendingProps)}break;default:return}}function fl(e,t){t.flags=-4097&t.flags|2,pl(e,t)}function ml(e,t){switch(e.tag){case 5:var n=function(e,t){return 1!==e.nodeType||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e}(t,e.type);return null!==n&&(e.stateNode=n,ol=e,al=zc(n.firstChild),!0);case 6:var r=function(e,t){return""===t||3!==e.nodeType?null:e}(t,e.pendingProps);return null!==r&&(e.stateNode=r,ol=e,al=null,!0);case d:var i=function(e){return 8!==e.nodeType?null:e}(t);if(null!==i){var o={dehydrated:i,treeContext:(il(),null!==Xu?{id:Ju,overflow:Qu}:null),retryLane:Ni};e.memoizedState=o;var a=function(e){var t=UE(18,null,null,0);return t.stateNode=e,t}(i);return a.return=e,e.child=a,ol=e,al=null,!0}return!1;default:return!1}}function gl(e){return!(!(1&e.mode)||e.flags&Hn)}function vl(e){throw new Error("Hydration failed because the initial UI does not match what was rendered on the server.")}function El(e){if(sl){var t=al;if(!t)return gl(e)&&(pl(ol,e),vl()),fl(ol,e),sl=!1,void(ol=e);var n=t;if(!ml(e,t)){gl(e)&&(pl(ol,e),vl()),t=Kc(n);var r=ol;if(!t||!ml(e,t))return fl(ol,e),sl=!1,void(ol=e);hl(r,n)}}}function yl(e){for(var t=e.return;null!==t&&5!==t.tag&&3!==t.tag&&t.tag!==d;)t=t.return;ol=t}function _l(e){if(e!==ol)return!1;if(!sl)return yl(e),sl=!0,!1;if(3!==e.tag&&(5!==e.tag||"head"!==(n=e.type)&&"body"!==n&&!Dc(e.type,e.memoizedProps))){var t=al;if(t)if(gl(e))bl(e),vl();else for(;t;)hl(e,t),t=Kc(t)}var n;return yl(e),al=e.tag===d?function(e){var t=e.memoizedState,n=null!==t?t.dehydrated:null;if(!n)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");return function(e){for(var t=e.nextSibling,n=0;t;){if(8===t.nodeType){var r=t.data;if(r===Ac){if(0===n)return Kc(t);n--}else r!==Oc&&r!==kc&&r!==Nc||n++}t=t.nextSibling}return null}(n)}(e):ol?Kc(e.stateNode):null,!0}function bl(e){for(var t=al;t;)dl(e,t),t=Kc(t)}function Sl(){ol=null,al=null,sl=!1,cl=!1}function wl(){null!==ul&&(Uv(ul),ul=null)}function Tl(){return sl}function Rl(e){null===ul?ul=[e]:ul.push(e)}var Cl=r.ReactCurrentBatchConfig,Il={recordUnsafeLifecycleWarnings:function(e,t){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(e,t){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}},Ol=function(e){var t=[];return e.forEach(function(e){t.push(e)}),t.sort().join(", ")},Al=[],Nl=[],kl=[],Pl=[],Ll=[],Dl=[],Ml=new Set;Il.recordUnsafeLifecycleWarnings=function(e,t){Ml.has(e.type)||("function"==typeof t.componentWillMount&&!0!==t.componentWillMount.__suppressDeprecationWarning&&Al.push(e),8&e.mode&&"function"==typeof t.UNSAFE_componentWillMount&&Nl.push(e),"function"==typeof t.componentWillReceiveProps&&!0!==t.componentWillReceiveProps.__suppressDeprecationWarning&&kl.push(e),8&e.mode&&"function"==typeof t.UNSAFE_componentWillReceiveProps&&Pl.push(e),"function"==typeof t.componentWillUpdate&&!0!==t.componentWillUpdate.__suppressDeprecationWarning&&Ll.push(e),8&e.mode&&"function"==typeof t.UNSAFE_componentWillUpdate&&Dl.push(e))},Il.flushPendingUnsafeLifecycleWarnings=function(){var e=new Set;Al.length>0&&(Al.forEach(function(t){e.add(Ue(t)||"Component"),Ml.add(t.type)}),Al=[]);var t=new Set;Nl.length>0&&(Nl.forEach(function(e){t.add(Ue(e)||"Component"),Ml.add(e.type)}),Nl=[]);var n=new Set;kl.length>0&&(kl.forEach(function(e){n.add(Ue(e)||"Component"),Ml.add(e.type)}),kl=[]);var r=new Set;Pl.length>0&&(Pl.forEach(function(e){r.add(Ue(e)||"Component"),Ml.add(e.type)}),Pl=[]);var i=new Set;Ll.length>0&&(Ll.forEach(function(e){i.add(Ue(e)||"Component"),Ml.add(e.type)}),Ll=[]);var s=new Set;Dl.length>0&&(Dl.forEach(function(e){s.add(Ue(e)||"Component"),Ml.add(e.type)}),Dl=[]),t.size>0&&a("Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move code with side effects to componentDidMount, and set initial state in the constructor.\n\nPlease update the following components: %s",Ol(t)),r.size>0&&a("Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state\n\nPlease update the following components: %s",Ol(r)),s.size>0&&a("Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n\nPlease update the following components: %s",Ol(s)),e.size>0&&o("componentWillMount has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move code with side effects to componentDidMount, and set initial state in the constructor.\n* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",Ol(e)),n.size>0&&o("componentWillReceiveProps has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state\n* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",Ol(n)),i.size>0&&o("componentWillUpdate has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",Ol(i))};var xl,Ul,Fl,$l,jl,Vl,Bl=new Map,Gl=new Set;function Hl(e,t,n){var r,i,o=n.ref;if(null!==o&&"function"!=typeof o&&"object"!=typeof o){if((!n._owner||!n._self||n._owner.stateNode===n._self)&&(!n._owner||1===n._owner.tag)&&("function"!=typeof n.type||(r=n.type).prototype&&r.prototype.isReactComponent)&&n._owner){var s=Ue(e)||"Component";Fl[s]||(a('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. We recommend using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',s,o),Fl[s]=!0)}if(n._owner){var c,u=n._owner;if(u){var l=u;if(1!==l.tag)throw new Error("Function components cannot have string refs. We recommend using useRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref");c=l.stateNode}if(!c)throw new Error("Missing owner for string ref "+o+". This error is likely caused by a bug in React. Please file an issue.");var d=c;O(i=o)&&(a("The provided `%s` prop is an unsupported type %s. This value must be coerced to a string before before using it here.","ref",I(i)),A(i));var h=""+o;if(null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===h)return t.ref;var p=function(e){var t=d.refs;null===e?delete t[h]:t[h]=e};return p._stringRef=h,p}if("string"!=typeof o)throw new Error("Expected ref to be a function, a string, an object returned by React.createRef(), or null.");if(!n._owner)throw new Error("Element ref was specified as a string ("+o+") but no owner was set. This could happen for one of the following reasons:\n1. You may be adding a ref to a function component\n2. You may be adding a ref to a component that was not created inside a component's render method\n3. You have multiple copies of React loaded\nSee https://reactjs.org/link/refs-must-have-owner for more information.")}return o}function Wl(e,t){var n=Object.prototype.toString.call(t);throw new Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(t).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.")}function ql(e){var t=Ue(e)||"Component";jl[t]||(jl[t]=!0,a("Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it."))}function zl(e){return(0,e._init)(e._payload)}function Kl(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(var i=r;null!==i;)t(n,i),i=i.sibling;return null}function r(e,t){for(var n=new Map,r=t;null!==r;)n.set(null!==r.key?r.key:r.index,r),r=r.sibling;return n}function i(e,t){var n=$E(e,t);return n.index=0,n.sibling=null,n}function o(t,n,r){if(t.index=r,!e)return t.flags|=tr,n;var i=t.alternate;if(null!==i){var o=i.index;return o<n?(t.flags|=2,n):o}return t.flags|=2,n}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function c(e,t,n,r){if(null===t||6!==t.tag){var o=WE(n,e.mode,r);return o.return=e,o}var a=i(t,n);return a.return=e,a}function u(e,t,n,r){var o=n.type;if(o===ee)return d(e,t,n.props.children,r,n.key);if(null!==t&&(t.elementType===o||kE(t,n)||"object"==typeof o&&null!==o&&o.$$typeof===ue&&zl(o)===t.type)){var a=i(t,n.props);return a.ref=Hl(e,t,n),a.return=e,a._debugSource=n._source,a._debugOwner=n._owner,a}var s=BE(n,e.mode,r);return s.ref=Hl(e,t,n),s.return=e,s}function l(e,t,n,r){if(null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation){var o=qE(n,e.mode,r);return o.return=e,o}var a=i(t,n.children||[]);return a.return=e,a}function d(e,t,n,r,o){if(null===t||7!==t.tag){var a=GE(n,e.mode,r,o);return a.return=e,a}var s=i(t,n);return s.return=e,s}function h(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t){var r=WE(""+t,e.mode,n);return r.return=e,r}if("object"==typeof t&&null!==t){switch(t.$$typeof){case Q:var i=BE(t,e.mode,n);return i.ref=Hl(e,null,t),i.return=e,i;case Z:var o=qE(t,e.mode,n);return o.return=e,o;case ue:return h(e,(0,t._init)(t._payload),n)}if(Et(t)||he(t)){var a=GE(t,e.mode,n,null);return a.return=e,a}Wl(0,t)}return"function"==typeof t&&ql(e),null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:c(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case Q:return n.key===i?u(e,t,n,r):null;case Z:return n.key===i?l(e,t,n,r):null;case ue:return p(e,t,(0,n._init)(n._payload),r)}if(Et(n)||he(n))return null!==i?null:d(e,t,n,r,null);Wl(0,n)}return"function"==typeof n&&ql(e),null}function f(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return c(t,e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case Q:return u(t,e.get(null===r.key?n:r.key)||null,r,i);case Z:return l(t,e.get(null===r.key?n:r.key)||null,r,i);case ue:return f(e,t,n,(0,r._init)(r._payload),i)}if(Et(r)||he(r))return d(t,e.get(n)||null,r,i,null);Wl(0,r)}return"function"==typeof r&&ql(t),null}function m(e,t,n){if("object"!=typeof e||null===e)return t;switch(e.$$typeof){case Q:case Z:Vl(e,n);var r=e.key;if("string"!=typeof r)break;if(null===t){(t=new Set).add(r);break}if(!t.has(r)){t.add(r);break}a("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted  the behavior is unsupported and could change in a future version.",r);break;case ue:m((0,e._init)(e._payload),t,n)}return t}return function c(u,l,d,g){if("object"==typeof d&&null!==d&&d.type===ee&&null===d.key&&(d=d.props.children),"object"==typeof d&&null!==d){switch(d.$$typeof){case Q:return s(function(e,r,o,a){for(var s=o.key,c=r;null!==c;){if(c.key===s){var u=o.type;if(u===ee){if(7===c.tag){n(e,c.sibling);var l=i(c,o.props.children);return l.return=e,l._debugSource=o._source,l._debugOwner=o._owner,l}}else if(c.elementType===u||kE(c,o)||"object"==typeof u&&null!==u&&u.$$typeof===ue&&zl(u)===c.type){n(e,c.sibling);var d=i(c,o.props);return d.ref=Hl(e,c,o),d.return=e,d._debugSource=o._source,d._debugOwner=o._owner,d}n(e,c);break}t(e,c),c=c.sibling}if(o.type===ee){var h=GE(o.props.children,e.mode,a,o.key);return h.return=e,h}var p=BE(o,e.mode,a);return p.ref=Hl(e,r,o),p.return=e,p}(u,l,d,g));case Z:return s(function(e,r,o,a){for(var s=o.key,c=r;null!==c;){if(c.key===s){if(4===c.tag&&c.stateNode.containerInfo===o.containerInfo&&c.stateNode.implementation===o.implementation){n(e,c.sibling);var u=i(c,o.children||[]);return u.return=e,u}n(e,c);break}t(e,c),c=c.sibling}var l=qE(o,e.mode,a);return l.return=e,l}(u,l,d,g));case ue:return c(u,l,(0,d._init)(d._payload),g)}if(Et(d))return function(i,a,s,c){for(var u=null,l=0;l<s.length;l++)u=m(s[l],u,i);for(var d=null,g=null,v=a,E=0,y=0,_=null;null!==v&&y<s.length;y++){v.index>y?(_=v,v=null):_=v.sibling;var b=p(i,v,s[y],c);if(null===b){null===v&&(v=_);break}e&&v&&null===b.alternate&&t(i,v),E=o(b,E,y),null===g?d=b:g.sibling=b,g=b,v=_}if(y===s.length)return n(i,v),Tl()&&Zu(i,y),d;if(null===v){for(;y<s.length;y++){var S=h(i,s[y],c);null!==S&&(E=o(S,E,y),null===g?d=S:g.sibling=S,g=S)}return Tl()&&Zu(i,y),d}for(var w=r(0,v);y<s.length;y++){var T=f(w,i,y,s[y],c);null!==T&&(e&&null!==T.alternate&&w.delete(null===T.key?y:T.key),E=o(T,E,y),null===g?d=T:g.sibling=T,g=T)}return e&&w.forEach(function(e){return t(i,e)}),Tl()&&Zu(i,y),d}(u,l,d,g);if(he(d))return function(i,s,c,u){var l=he(c);if("function"!=typeof l)throw new Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");"function"==typeof Symbol&&"Generator"===c[Symbol.toStringTag]&&(Ul||a("Using Generators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. Keep in mind you might need to polyfill these features for older browsers."),Ul=!0),c.entries===l&&(xl||a("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),xl=!0);var d=l.call(c);if(d)for(var g=null,v=d.next();!v.done;v=d.next())g=m(v.value,g,i);var E=l.call(c);if(null==E)throw new Error("An iterable object provided no iterator.");for(var y=null,_=null,b=s,S=0,w=0,T=null,R=E.next();null!==b&&!R.done;w++,R=E.next()){b.index>w?(T=b,b=null):T=b.sibling;var C=p(i,b,R.value,u);if(null===C){null===b&&(b=T);break}e&&b&&null===C.alternate&&t(i,b),S=o(C,S,w),null===_?y=C:_.sibling=C,_=C,b=T}if(R.done)return n(i,b),Tl()&&Zu(i,w),y;if(null===b){for(;!R.done;w++,R=E.next()){var I=h(i,R.value,u);null!==I&&(S=o(I,S,w),null===_?y=I:_.sibling=I,_=I)}return Tl()&&Zu(i,w),y}for(var O=r(0,b);!R.done;w++,R=E.next()){var A=f(O,i,w,R.value,u);null!==A&&(e&&null!==A.alternate&&O.delete(null===A.key?w:A.key),S=o(A,S,w),null===_?y=A:_.sibling=A,_=A)}return e&&O.forEach(function(e){return t(i,e)}),Tl()&&Zu(i,w),y}(u,l,d,g);Wl(0,d)}return"string"==typeof d&&""!==d||"number"==typeof d?s(function(e,t,r,o){if(null!==t&&6===t.tag){n(e,t.sibling);var a=i(t,r);return a.return=e,a}n(e,t);var s=WE(r,e.mode,o);return s.return=e,s}(u,l,""+d,g)):("function"==typeof d&&ql(u),n(u,l))}}Il.recordLegacyContextWarning=function(e,t){var n=function(e){for(var t=null,n=e;null!==n;)8&n.mode&&(t=n),n=n.return;return t}(e);if(null!==n){if(!Gl.has(e.type)){var r=Bl.get(n);(null!=e.type.contextTypes||null!=e.type.childContextTypes||null!==t&&"function"==typeof t.getChildContext)&&(void 0===r&&Bl.set(n,r=[]),r.push(e))}}else a("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue.")},Il.flushLegacyContextWarning=function(){Bl.forEach(function(e,t){if(0!==e.length){var n=e[0],r=new Set;e.forEach(function(e){r.add(Ue(e)||"Component"),Gl.add(e.type)});var i=Ol(r);try{He(n),a("Legacy context API has been detected within a strict-mode tree.\n\nThe old API will be supported in all 16.x releases, but applications using it should migrate to the new version.\n\nPlease update the following components: %s\n\nLearn more about this warning here: https://reactjs.org/link/legacy-context",i)}finally{Ge()}}})},Il.discardPendingWarnings=function(){Al=[],Nl=[],kl=[],Pl=[],Ll=[],Dl=[],Bl=new Map},xl=!1,Ul=!1,Fl={},$l={},jl={},Vl=function(e,t){if(null!==e&&"object"==typeof e&&e._store&&!e._store.validated&&null==e.key){if("object"!=typeof e._store)throw new Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");e._store.validated=!0;var n=Ue(t)||"Component";$l[n]||($l[n]=!0,a('Each child in a list should have a unique "key" prop. See https://reactjs.org/link/warning-keys for more information.'))}};var Yl=Kl(!0),Xl=Kl(!1);function Jl(e,t){for(var n=e.child;null!==n;)jE(n,t),n=n.sibling}var Ql,Zl=_u(null);Ql={};var ed=null,td=null,nd=null,rd=!1;function id(){ed=null,td=null,nd=null,rd=!1}function od(){rd=!0}function ad(){rd=!1}function sd(e,t,n){Su(Zl,t._currentValue,e),t._currentValue=n,null!=t._currentRenderer&&t._currentRenderer!==Ql&&a("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),t._currentRenderer=Ql}function cd(e,t){var n=Zl.current;bu(Zl,t),e._currentValue=n}function ud(e,t,n){for(var r=e;null!==r;){var i=r.alternate;if(Yi(r.childLanes,t)?null===i||Yi(i.childLanes,t)||(i.childLanes=Xi(i.childLanes,t)):(r.childLanes=Xi(r.childLanes,t),null!==i&&(i.childLanes=Xi(i.childLanes,t))),r===n)break;r=r.return}r!==n&&a("Expected to find the propagation root when scheduling context work. This error is likely caused by a bug in React. Please file an issue.")}function ld(e,t){ed=e,td=null,nd=null;var n=e.dependencies;null!==n&&null!==n.firstContext&&(Ki(n.lanes,t)&&mm(),n.firstContext=null)}function dd(e){rd&&a("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");var t=e._currentValue;if(nd===e);else{var n={context:e,memoizedValue:t,next:null};if(null===td){if(null===ed)throw new Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");td=n,ed.dependencies={lanes:0,firstContext:n}}else td=td.next=n}return t}var hd=null;function pd(e){null===hd?hd=[e]:hd.push(e)}function fd(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,pd(t)):(n.next=i.next,i.next=n),t.interleaved=n,vd(e,r)}function md(e,t){return vd(e,t)}var gd=vd;function vd(e,t){e.lanes=Xi(e.lanes,t);var n=e.alternate;null!==n&&(n.lanes=Xi(n.lanes,t)),null===n&&4098&e.flags&&gE(e);for(var r=e,i=e.return;null!==i;)i.childLanes=Xi(i.childLanes,t),null!==(n=i.alternate)?n.childLanes=Xi(n.childLanes,t):4098&i.flags&&gE(e),r=i,i=i.return;return 3===r.tag?r.stateNode:null}var Ed,yd,_d=!1;function bd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Sd(e,t){var n=e.updateQueue;t.updateQueue===n&&(t.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function wd(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Td(e,t,n){var r=e.updateQueue;if(null===r)return null;var i=r.shared;if(yd!==i||Ed||(a("An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback."),Ed=!0),(qg&Ug)!==xg){var o=i.pending;return null===o?t.next=t:(t.next=o.next,o.next=t),i.pending=t,gd(e,n)}return function(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,pd(t)):(n.next=i.next,i.next=n),t.interleaved=n,vd(e,r)}(e,i,t,n)}function Rd(e,t,n){var r=t.updateQueue;if(null!==r){var i=r.shared;if(Bi(n)){var o=i.lanes,a=Xi(o=Qi(o,e.pendingLanes),n);i.lanes=a,no(e,a)}}}function Cd(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r){var i=r.updateQueue;if(n===i){var o=null,a=null,s=n.firstBaseUpdate;if(null!==s){var c=s;do{var u={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};null===a?o=a=u:(a.next=u,a=u),c=c.next}while(null!==c);null===a?o=a=t:(a.next=t,a=t)}else o=a=t;return void(e.updateQueue=n={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:a,shared:i.shared,effects:i.effects})}}var l=n.lastBaseUpdate;null===l?n.firstBaseUpdate=t:l.next=t,n.lastBaseUpdate=t}function Id(e,t,n,r,i,o){switch(n.tag){case 1:var a=n.payload;if("function"==typeof a){od();var s=a.call(o,r,i);if(8&e.mode){Ur(!0);try{a.call(o,r,i)}finally{Ur(!1)}}return ad(),s}return a;case 3:e.flags=-65537&e.flags|Hn;case 0:var c,u=n.payload;if("function"==typeof u){if(od(),c=u.call(o,r,i),8&e.mode){Ur(!0);try{u.call(o,r,i)}finally{Ur(!1)}}ad()}else c=u;return null==c?r:_e({},r,c);case 2:return _d=!0,r}return r}function Od(e,t,n,r){var i=e.updateQueue;_d=!1,yd=i.shared;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var c=s,u=c.next;c.next=null,null===a?o=u:a.next=u,a=c;var l=e.alternate;if(null!==l){var d=l.updateQueue,h=d.lastBaseUpdate;h!==a&&(null===h?d.firstBaseUpdate=u:h.next=u,d.lastBaseUpdate=c)}}if(null!==o){for(var p=i.baseState,f=0,m=null,g=null,v=null,E=o;;){var y=E.lane,_=E.eventTime;if(Yi(r,y)){if(null!==v&&(v=v.next={eventTime:_,lane:0,tag:E.tag,payload:E.payload,callback:E.callback,next:null}),p=Id(e,0,E,p,t,n),null!==E.callback&&0!==E.lane){e.flags|=64;var b=i.effects;null===b?i.effects=[E]:b.push(E)}}else{var S={eventTime:_,lane:y,tag:E.tag,payload:E.payload,callback:E.callback,next:null};null===v?(g=v=S,m=p):v=v.next=S,f=Xi(f,y)}if(null===(E=E.next)){if(null===(s=i.shared.pending))break;var w=s,T=w.next;w.next=null,E=T,i.lastBaseUpdate=w,i.shared.pending=null}}null===v&&(m=p),i.baseState=m,i.firstBaseUpdate=g,i.lastBaseUpdate=v;var R=i.shared.interleaved;if(null!==R){var C=R;do{f=Xi(f,C.lane),C=C.next}while(C!==R)}else null===o&&(i.shared.lanes=0);Yv(f),e.lanes=f,e.memoizedState=p}yd=null}function Ad(e,t){if("function"!=typeof e)throw new Error("Invalid argument passed as callback. Expected a function. Instead received: "+e);e.call(t)}function Nd(){_d=!1}function kd(){return _d}function Pd(e,t,n){var r=t.effects;if(t.effects=null,null!==r)for(var i=0;i<r.length;i++){var o=r[i],a=o.callback;null!==a&&(o.callback=null,Ad(a,n))}}Ed=!1,yd=null;var Ld={},Dd=_u(Ld),Md=_u(Ld),xd=_u(Ld);function Ud(e){if(e===Ld)throw new Error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue.");return e}function Fd(){return Ud(xd.current)}function $d(e,t){Su(xd,t,e),Su(Md,e,e),Su(Dd,Ld,e);var n=function(e){var t,n,r=e.nodeType;switch(r){case 9:case 11:t=9===r?"#document":"#fragment";var i=e.documentElement;n=i?i.namespaceURI:Pt(null,"");break;default:var o=8===r?e.parentNode:e;n=Pt(o.namespaceURI||null,t=o.tagName)}var a=t.toLowerCase();return{namespace:n,ancestorInfo:_c(null,a)}}(t);bu(Dd,e),Su(Dd,n,e)}function jd(e){bu(Dd,e),bu(Md,e),bu(xd,e)}function Vd(){return Ud(Dd.current)}function Bd(e){Ud(xd.current);var t,n,r=Ud(Dd.current),i={namespace:Pt((n=r).namespace,t=e.type),ancestorInfo:_c(n.ancestorInfo,t)};r!==i&&(Su(Md,e,e),Su(Dd,i,e))}function Gd(e){Md.current===e&&(bu(Dd,e),bu(Md,e))}var Hd=_u(0);function Wd(e,t){return!!(e&t)}function qd(e){return 1&e}function zd(e,t){return 1&e|t}function Kd(e,t){Su(Hd,t,e)}function Yd(e){bu(Hd,e)}function Xd(e,t){var n=e.memoizedState;return null===n||null!==n.dehydrated}function Jd(e){for(var t=e;null!==t;){if(t.tag===d){var n=t.memoizedState;if(null!==n){var r=n.dehydrated;if(null===r||Wc(r)||qc(r))return t}}else if(t.tag===m&&void 0!==t.memoizedProps.revealOrder){if(t.flags&Hn)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)return null;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Qd=[];function Zd(){for(var e=0;e<Qd.length;e++)Qd[e]._workInProgressVersionPrimary=null;Qd.length=0}function eh(e,t){var n=(0,t._getVersion)(t._source);null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)}var th,nh,rh=r.ReactCurrentDispatcher,ih=r.ReactCurrentBatchConfig;th=new Set;var oh=0,ah=null,sh=null,ch=null,uh=!1,lh=!1,dh=0,hh=0,ph=null,fh=null,mh=-1,gh=!1;function vh(){null===fh?fh=[ph]:fh.push(ph)}function Eh(){null!==fh&&(mh++,fh[mh]!==ph&&function(e){var t=Ue(ah);if(!th.has(t)&&(th.add(t),null!==fh)){for(var n="",r=0;r<=mh;r++){for(var i=fh[r],o=r===mh?e:i,s=r+1+". "+i;s.length<30;)s+=" ";n+=s+=o+"\n"}a("React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://reactjs.org/link/rules-of-hooks\n\n   Previous render            Next render\n   ------------------------------------------------------\n%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",t,n)}}(ph))}function yh(e){null==e||Et(e)||a("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",ph,typeof e)}function _h(){throw new Error("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.")}function bh(e,t){if(gh)return!1;if(null===t)return a("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",ph),!1;e.length!==t.length&&a("The final argument passed to %s changed size between renders. The order and size of this array must remain constant.\n\nPrevious: %s\nIncoming: %s",ph,"["+t.join(", ")+"]","["+e.join(", ")+"]");for(var n=0;n<t.length&&n<e.length;n++)if(!ns(e[n],t[n]))return!1;return!0}function Sh(e,t,n,r,i,o){oh=o,ah=t,fh=null!==e?e._debugHookTypes:null,mh=-1,gh=null!==e&&e.type!==t.type,t.memoizedState=null,t.updateQueue=null,t.lanes=0,rh.current=null!==e&&null!==e.memoizedState?Cp:null!==fh?Rp:Tp;var s=n(r,i);if(lh){var c=0;do{if(lh=!1,dh=0,c>=25)throw new Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");c+=1,gh=!1,sh=null,ch=null,t.updateQueue=null,mh=-1,rh.current=Ip,s=n(r,i)}while(lh)}rh.current=wp,t._debugHookTypes=fh;var u=null!==sh&&null!==sh.next;if(oh=0,ah=null,sh=null,ch=null,ph=null,fh=null,mh=-1,null!==e&&(e.flags&cr)!=(t.flags&cr)&&1&e.mode&&a("Internal React error: Expected static flag was missing. Please notify the React team."),uh=!1,u)throw new Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");return s}function wh(){var e=0!==dh;return dh=0,e}function Th(e,t,n){t.updateQueue=e.updateQueue,t.flags&=t.mode&Yr?-50333701:-2053,e.lanes=Ji(e.lanes,n)}function Rh(){if(rh.current=wp,uh){for(var e=ah.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}uh=!1}oh=0,ah=null,sh=null,ch=null,fh=null,mh=-1,ph=null,fp=!1,lh=!1,dh=0}function Ch(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ch?ah.memoizedState=ch=e:ch=ch.next=e,ch}function Ih(){var e,t;if(null===sh){var n=ah.alternate;e=null!==n?n.memoizedState:null}else e=sh.next;if(null!==(t=null===ch?ah.memoizedState:ch.next))t=(ch=t).next,sh=e;else{if(null===e)throw new Error("Rendered more hooks than during the previous render.");var r={memoizedState:(sh=e).memoizedState,baseState:sh.baseState,baseQueue:sh.baseQueue,queue:sh.queue,next:null};null===ch?ah.memoizedState=ch=r:ch=ch.next=r}return ch}function Oh(e,t){return"function"==typeof t?t(e):t}function Ah(e,t,n){var r,i=Ch();r=void 0!==n?n(t):t,i.memoizedState=i.baseState=r;var o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r};i.queue=o;var a=o.dispatch=vp.bind(null,ah,o);return[i.memoizedState,a]}function Nh(e,t,n){var r=Ih(),i=r.queue;if(null===i)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");i.lastRenderedReducer=e;var o=sh,s=o.baseQueue,c=i.pending;if(null!==c){if(null!==s){var u=s.next;s.next=c.next,c.next=u}o.baseQueue!==s&&a("Internal error: Expected work-in-progress queue to be a clone. This is a bug in React."),o.baseQueue=s=c,i.pending=null}if(null!==s){var l=s.next,d=o.baseState,h=null,p=null,f=null,m=l;do{var g=m.lane;if(Yi(oh,g))null!==f&&(f=f.next={lane:0,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null}),d=m.hasEagerState?m.eagerState:e(d,m.action);else{var v={lane:g,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null};null===f?(p=f=v,h=d):f=f.next=v,ah.lanes=Xi(ah.lanes,g),Yv(g)}m=m.next}while(null!==m&&m!==l);null===f?h=d:f.next=p,ns(d,r.memoizedState)||mm(),r.memoizedState=d,r.baseState=h,r.baseQueue=f,i.lastRenderedState=d}var E=i.interleaved;if(null!==E){var y=E;do{var _=y.lane;ah.lanes=Xi(ah.lanes,_),Yv(_),y=y.next}while(y!==E)}else null===s&&(i.lanes=0);return[r.memoizedState,i.dispatch]}function kh(e,t,n){var r=Ih(),i=r.queue;if(null===i)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");i.lastRenderedReducer=e;var o=i.dispatch,a=i.pending,s=r.memoizedState;if(null!==a){i.pending=null;var c=a.next,u=c;do{s=e(s,u.action),u=u.next}while(u!==c);ns(s,r.memoizedState)||mm(),r.memoizedState=s,null===r.baseQueue&&(r.baseState=s),i.lastRenderedState=s}return[s,o]}function Ph(e,t,n){var r,i=ah,o=Ch();if(Tl()){if(void 0===n)throw new Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");r=n(),nh||r!==n()&&(a("The result of getServerSnapshot should be cached to avoid an infinite loop"),nh=!0)}else{if(r=t(),!nh){var s=t();ns(r,s)||(a("The result of getSnapshot should be cached to avoid an infinite loop"),nh=!0)}if(null===Nv())throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");Vi(0,oh)||Dh(i,t,r)}o.memoizedState=r;var c={value:r,getSnapshot:t};return o.queue=c,zh(xh.bind(null,i,c,e),[e]),i.flags|=Kn,Bh(9,Mh.bind(null,i,c,r,t),void 0,null),r}function Lh(e,t,n){var r=ah,i=Ih(),o=t();if(!nh){var s=t();ns(o,s)||(a("The result of getSnapshot should be cached to avoid an infinite loop"),nh=!0)}var c=!ns(i.memoizedState,o);c&&(i.memoizedState=o,mm());var u=i.queue;if(Kh(xh.bind(null,r,u,e),[e]),u.getSnapshot!==t||c||null!==ch&&1&ch.memoizedState.tag){if(r.flags|=Kn,Bh(9,Mh.bind(null,r,u,o,t),void 0,null),null===Nv())throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");Vi(0,oh)||Dh(r,t,o)}return o}function Dh(e,t,n){e.flags|=Jn;var r={getSnapshot:t,value:n},i=ah.updateQueue;if(null===i)ah.updateQueue=i={lastEffect:null,stores:null},i.stores=[r];else{var o=i.stores;null===o?i.stores=[r]:o.push(r)}}function Mh(e,t,n,r){t.value=n,t.getSnapshot=r,Uh(t)&&Fh(e)}function xh(e,t,n){return n(function(){Uh(t)&&Fh(e)})}function Uh(e){var t=e.getSnapshot,n=e.value;try{var r=t();return!ns(n,r)}catch(e){return!0}}function Fh(e){var t=md(e,ei);null!==t&&Lv(t,e,ei,Pi)}function $h(e){var t=Ch();"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e;var n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Oh,lastRenderedState:e};t.queue=n;var r=n.dispatch=Ep.bind(null,ah,n);return[t.memoizedState,r]}function jh(e){return Nh(Oh)}function Vh(e){return kh(Oh)}function Bh(e,t,n,r){var i={tag:e,create:t,destroy:n,deps:r,next:null},o=ah.updateQueue;if(null===o)ah.updateQueue=o={lastEffect:null,stores:null},o.lastEffect=i.next=i;else{var a=o.lastEffect;if(null===a)o.lastEffect=i.next=i;else{var s=a.next;a.next=i,i.next=s,o.lastEffect=i}}return i}function Gh(e){var t={current:e};return Ch().memoizedState=t,t}function Hh(e){return Ih().memoizedState}function Wh(e,t,n,r){var i=Ch(),o=void 0===r?null:r;ah.flags|=e,i.memoizedState=Bh(1|t,n,void 0,o)}function qh(e,t,n,r){var i=Ih(),o=void 0===r?null:r,a=void 0;if(null!==sh){var s=sh.memoizedState;if(a=s.destroy,null!==o&&bh(o,s.deps))return void(i.memoizedState=Bh(t,n,a,o))}ah.flags|=e,i.memoizedState=Bh(1|t,n,a,o)}function zh(e,t){return Wh(ah.mode&Yr?41945088:8390656,8,e,t)}function Kh(e,t){return qh(Kn,8,e,t)}function Yh(e,t){return Wh(4,2,e,t)}function Xh(e,t){return qh(4,2,e,t)}function Jh(e,t){var n=4;return n|=rr,ah.mode&Yr&&(n|=ir),Wh(n,4,e,t)}function Qh(e,t){return qh(4,4,e,t)}function Zh(e,t){if("function"==typeof t){var n=t,r=e();return n(r),function(){n(null)}}if(null!=t){var i=t;i.hasOwnProperty("current")||a("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(i).join(", ")+"}");var o=e();return i.current=o,function(){i.current=null}}}function ep(e,t,n){"function"!=typeof t&&a("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",null!==t?typeof t:"null");var r=null!=n?n.concat([e]):null,i=4;return i|=rr,ah.mode&Yr&&(i|=ir),Wh(i,4,Zh.bind(null,t,e),r)}function tp(e,t,n){"function"!=typeof t&&a("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",null!==t?typeof t:"null");var r=null!=n?n.concat([e]):null;return qh(4,4,Zh.bind(null,t,e),r)}function np(e,t){return Ch().memoizedState=[e,void 0===t?null:t],e}function rp(e,t){var n=Ih(),r=void 0===t?null:t,i=n.memoizedState;return null!==i&&null!==r&&bh(r,i[1])?i[0]:(n.memoizedState=[e,r],e)}function ip(e,t){var n=Ch(),r=void 0===t?null:t,i=e();return n.memoizedState=[i,r],i}function op(e,t){var n=Ih(),r=void 0===t?null:t,i=n.memoizedState;if(null!==i&&null!==r&&bh(r,i[1]))return i[0];var o=e();return n.memoizedState=[o,r],o}function ap(e){return Ch().memoizedState=e,e}function sp(e){return up(Ih(),sh.memoizedState,e)}function cp(e){var t=Ih();return null===sh?(t.memoizedState=e,e):up(t,sh.memoizedState,e)}function up(e,t,n){if(oh&(ei|ni|ii)){if(!ns(n,t)){var r=Gi();ah.lanes=Xi(ah.lanes,r),Yv(r),e.baseState=!0}return t}return e.baseState&&(e.baseState=!1,mm()),e.memoizedState=n,n}function lp(e,t,n){var r=go();vo(function(e,t){return 0!==e&&e<t?e:t}(r,ho)),e(!0);var i=ih.transition;ih.transition={};var a=ih.transition;ih.transition._updatedFibers=new Set;try{e(!1),t()}finally{vo(r),ih.transition=i,null===i&&a._updatedFibers&&(a._updatedFibers.size>10&&o("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),a._updatedFibers.clear())}}function dp(){var e=$h(!1),t=e[0],n=lp.bind(null,e[1]);return Ch().memoizedState=n,[t,n]}function hp(){return[jh()[0],Ih().memoizedState]}function pp(){return[Vh()[0],Ih().memoizedState]}var fp=!1;function mp(){var e,t,n=Ch(),r=Nv().identifierPrefix;if(Tl()){e=":"+r+"R"+(t=Qu,(Ju&~function(e){return 1<<nl(e)-1}(Ju)).toString(32)+t);var i=dh++;i>0&&(e+="H"+i.toString(32)),e+=":"}else e=":"+r+"r"+(hh++).toString(32)+":";return n.memoizedState=e,e}function gp(){return Ih().memoizedState}function vp(e,t,n){"function"==typeof arguments[3]&&a("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var r=Pv(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(yp(e))_p(t,i);else{var o=fd(e,t,i,r);null!==o&&(Lv(o,e,r,kv()),bp(o,t,r))}Sp(e,r)}function Ep(e,t,n){"function"==typeof arguments[3]&&a("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var r=Pv(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(yp(e))_p(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)){var s=t.lastRenderedReducer;if(null!==s){var c;c=rh.current,rh.current=Ap;try{var u=t.lastRenderedState,l=s(u,n);if(i.hasEagerState=!0,i.eagerState=l,ns(l,u))return void function(e,t,n){var r=t.interleaved;null===r?(n.next=n,pd(t)):(n.next=r.next,r.next=n),t.interleaved=n}(0,t,i)}catch(e){}finally{rh.current=c}}}var d=fd(e,t,i,r);null!==d&&(Lv(d,e,r,kv()),bp(d,t,r))}Sp(e,r)}function yp(e){var t=e.alternate;return e===ah||null!==t&&t===ah}function _p(e,t){lh=uh=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function bp(e,t,n){if(Bi(n)){var r=t.lanes,i=Xi(r=Qi(r,e.pendingLanes),n);t.lanes=i,no(e,i)}}function Sp(e,t,n){Kr(e,t)}var wp={readContext:dd,useCallback:_h,useContext:_h,useEffect:_h,useImperativeHandle:_h,useInsertionEffect:_h,useLayoutEffect:_h,useMemo:_h,useReducer:_h,useRef:_h,useState:_h,useDebugValue:_h,useDeferredValue:_h,useTransition:_h,useMutableSource:_h,useSyncExternalStore:_h,useId:_h,unstable_isNewReconciler:y},Tp=null,Rp=null,Cp=null,Ip=null,Op=null,Ap=null,Np=null,kp=function(){a("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")},Pp=function(){a("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://reactjs.org/link/rules-of-hooks")};Tp={readContext:function(e){return dd(e)},useCallback:function(e,t){return ph="useCallback",vh(),yh(t),np(e,t)},useContext:function(e){return ph="useContext",vh(),dd(e)},useEffect:function(e,t){return ph="useEffect",vh(),yh(t),zh(e,t)},useImperativeHandle:function(e,t,n){return ph="useImperativeHandle",vh(),yh(n),ep(e,t,n)},useInsertionEffect:function(e,t){return ph="useInsertionEffect",vh(),yh(t),Yh(e,t)},useLayoutEffect:function(e,t){return ph="useLayoutEffect",vh(),yh(t),Jh(e,t)},useMemo:function(e,t){ph="useMemo",vh(),yh(t);var n=rh.current;rh.current=Op;try{return ip(e,t)}finally{rh.current=n}},useReducer:function(e,t,n){ph="useReducer",vh();var r=rh.current;rh.current=Op;try{return Ah(e,t,n)}finally{rh.current=r}},useRef:function(e){return ph="useRef",vh(),Gh(e)},useState:function(e){ph="useState",vh();var t=rh.current;rh.current=Op;try{return $h(e)}finally{rh.current=t}},useDebugValue:function(e,t){ph="useDebugValue",vh()},useDeferredValue:function(e){return ph="useDeferredValue",vh(),ap(e)},useTransition:function(){return ph="useTransition",vh(),dp()},useMutableSource:function(e,t,n){ph="useMutableSource",vh()},useSyncExternalStore:function(e,t,n){return ph="useSyncExternalStore",vh(),Ph(e,t,n)},useId:function(){return ph="useId",vh(),mp()},unstable_isNewReconciler:y},Rp={readContext:function(e){return dd(e)},useCallback:function(e,t){return ph="useCallback",Eh(),np(e,t)},useContext:function(e){return ph="useContext",Eh(),dd(e)},useEffect:function(e,t){return ph="useEffect",Eh(),zh(e,t)},useImperativeHandle:function(e,t,n){return ph="useImperativeHandle",Eh(),ep(e,t,n)},useInsertionEffect:function(e,t){return ph="useInsertionEffect",Eh(),Yh(e,t)},useLayoutEffect:function(e,t){return ph="useLayoutEffect",Eh(),Jh(e,t)},useMemo:function(e,t){ph="useMemo",Eh();var n=rh.current;rh.current=Op;try{return ip(e,t)}finally{rh.current=n}},useReducer:function(e,t,n){ph="useReducer",Eh();var r=rh.current;rh.current=Op;try{return Ah(e,t,n)}finally{rh.current=r}},useRef:function(e){return ph="useRef",Eh(),Gh(e)},useState:function(e){ph="useState",Eh();var t=rh.current;rh.current=Op;try{return $h(e)}finally{rh.current=t}},useDebugValue:function(e,t){ph="useDebugValue",Eh()},useDeferredValue:function(e){return ph="useDeferredValue",Eh(),ap(e)},useTransition:function(){return ph="useTransition",Eh(),dp()},useMutableSource:function(e,t,n){ph="useMutableSource",Eh()},useSyncExternalStore:function(e,t,n){return ph="useSyncExternalStore",Eh(),Ph(e,t,n)},useId:function(){return ph="useId",Eh(),mp()},unstable_isNewReconciler:y},Cp={readContext:function(e){return dd(e)},useCallback:function(e,t){return ph="useCallback",Eh(),rp(e,t)},useContext:function(e){return ph="useContext",Eh(),dd(e)},useEffect:function(e,t){return ph="useEffect",Eh(),Kh(e,t)},useImperativeHandle:function(e,t,n){return ph="useImperativeHandle",Eh(),tp(e,t,n)},useInsertionEffect:function(e,t){return ph="useInsertionEffect",Eh(),Xh(e,t)},useLayoutEffect:function(e,t){return ph="useLayoutEffect",Eh(),Qh(e,t)},useMemo:function(e,t){ph="useMemo",Eh();var n=rh.current;rh.current=Ap;try{return op(e,t)}finally{rh.current=n}},useReducer:function(e,t,n){ph="useReducer",Eh();var r=rh.current;rh.current=Ap;try{return Nh(e)}finally{rh.current=r}},useRef:function(e){return ph="useRef",Eh(),Hh()},useState:function(e){ph="useState",Eh();var t=rh.current;rh.current=Ap;try{return jh()}finally{rh.current=t}},useDebugValue:function(e,t){return ph="useDebugValue",void Eh()},useDeferredValue:function(e){return ph="useDeferredValue",Eh(),sp(e)},useTransition:function(){return ph="useTransition",Eh(),hp()},useMutableSource:function(e,t,n){ph="useMutableSource",Eh()},useSyncExternalStore:function(e,t,n){return ph="useSyncExternalStore",Eh(),Lh(e,t)},useId:function(){return ph="useId",Eh(),gp()},unstable_isNewReconciler:y},Ip={readContext:function(e){return dd(e)},useCallback:function(e,t){return ph="useCallback",Eh(),rp(e,t)},useContext:function(e){return ph="useContext",Eh(),dd(e)},useEffect:function(e,t){return ph="useEffect",Eh(),Kh(e,t)},useImperativeHandle:function(e,t,n){return ph="useImperativeHandle",Eh(),tp(e,t,n)},useInsertionEffect:function(e,t){return ph="useInsertionEffect",Eh(),Xh(e,t)},useLayoutEffect:function(e,t){return ph="useLayoutEffect",Eh(),Qh(e,t)},useMemo:function(e,t){ph="useMemo",Eh();var n=rh.current;rh.current=Np;try{return op(e,t)}finally{rh.current=n}},useReducer:function(e,t,n){ph="useReducer",Eh();var r=rh.current;rh.current=Np;try{return kh(e)}finally{rh.current=r}},useRef:function(e){return ph="useRef",Eh(),Hh()},useState:function(e){ph="useState",Eh();var t=rh.current;rh.current=Np;try{return Vh()}finally{rh.current=t}},useDebugValue:function(e,t){return ph="useDebugValue",void Eh()},useDeferredValue:function(e){return ph="useDeferredValue",Eh(),cp(e)},useTransition:function(){return ph="useTransition",Eh(),pp()},useMutableSource:function(e,t,n){ph="useMutableSource",Eh()},useSyncExternalStore:function(e,t,n){return ph="useSyncExternalStore",Eh(),Lh(e,t)},useId:function(){return ph="useId",Eh(),gp()},unstable_isNewReconciler:y},Op={readContext:function(e){return kp(),dd(e)},useCallback:function(e,t){return ph="useCallback",Pp(),vh(),np(e,t)},useContext:function(e){return ph="useContext",Pp(),vh(),dd(e)},useEffect:function(e,t){return ph="useEffect",Pp(),vh(),zh(e,t)},useImperativeHandle:function(e,t,n){return ph="useImperativeHandle",Pp(),vh(),ep(e,t,n)},useInsertionEffect:function(e,t){return ph="useInsertionEffect",Pp(),vh(),Yh(e,t)},useLayoutEffect:function(e,t){return ph="useLayoutEffect",Pp(),vh(),Jh(e,t)},useMemo:function(e,t){ph="useMemo",Pp(),vh();var n=rh.current;rh.current=Op;try{return ip(e,t)}finally{rh.current=n}},useReducer:function(e,t,n){ph="useReducer",Pp(),vh();var r=rh.current;rh.current=Op;try{return Ah(e,t,n)}finally{rh.current=r}},useRef:function(e){return ph="useRef",Pp(),vh(),Gh(e)},useState:function(e){ph="useState",Pp(),vh();var t=rh.current;rh.current=Op;try{return $h(e)}finally{rh.current=t}},useDebugValue:function(e,t){ph="useDebugValue",Pp(),vh()},useDeferredValue:function(e){return ph="useDeferredValue",Pp(),vh(),ap(e)},useTransition:function(){return ph="useTransition",Pp(),vh(),dp()},useMutableSource:function(e,t,n){ph="useMutableSource",Pp(),vh()},useSyncExternalStore:function(e,t,n){return ph="useSyncExternalStore",Pp(),vh(),Ph(e,t,n)},useId:function(){return ph="useId",Pp(),vh(),mp()},unstable_isNewReconciler:y},Ap={readContext:function(e){return kp(),dd(e)},useCallback:function(e,t){return ph="useCallback",Pp(),Eh(),rp(e,t)},useContext:function(e){return ph="useContext",Pp(),Eh(),dd(e)},useEffect:function(e,t){return ph="useEffect",Pp(),Eh(),Kh(e,t)},useImperativeHandle:function(e,t,n){return ph="useImperativeHandle",Pp(),Eh(),tp(e,t,n)},useInsertionEffect:function(e,t){return ph="useInsertionEffect",Pp(),Eh(),Xh(e,t)},useLayoutEffect:function(e,t){return ph="useLayoutEffect",Pp(),Eh(),Qh(e,t)},useMemo:function(e,t){ph="useMemo",Pp(),Eh();var n=rh.current;rh.current=Ap;try{return op(e,t)}finally{rh.current=n}},useReducer:function(e,t,n){ph="useReducer",Pp(),Eh();var r=rh.current;rh.current=Ap;try{return Nh(e)}finally{rh.current=r}},useRef:function(e){return ph="useRef",Pp(),Eh(),Hh()},useState:function(e){ph="useState",Pp(),Eh();var t=rh.current;rh.current=Ap;try{return jh()}finally{rh.current=t}},useDebugValue:function(e,t){return ph="useDebugValue",Pp(),void Eh()},useDeferredValue:function(e){return ph="useDeferredValue",Pp(),Eh(),sp(e)},useTransition:function(){return ph="useTransition",Pp(),Eh(),hp()},useMutableSource:function(e,t,n){ph="useMutableSource",Pp(),Eh()},useSyncExternalStore:function(e,t,n){return ph="useSyncExternalStore",Pp(),Eh(),Lh(e,t)},useId:function(){return ph="useId",Pp(),Eh(),gp()},unstable_isNewReconciler:y},Np={readContext:function(e){return kp(),dd(e)},useCallback:function(e,t){return ph="useCallback",Pp(),Eh(),rp(e,t)},useContext:function(e){return ph="useContext",Pp(),Eh(),dd(e)},useEffect:function(e,t){return ph="useEffect",Pp(),Eh(),Kh(e,t)},useImperativeHandle:function(e,t,n){return ph="useImperativeHandle",Pp(),Eh(),tp(e,t,n)},useInsertionEffect:function(e,t){return ph="useInsertionEffect",Pp(),Eh(),Xh(e,t)},useLayoutEffect:function(e,t){return ph="useLayoutEffect",Pp(),Eh(),Qh(e,t)},useMemo:function(e,t){ph="useMemo",Pp(),Eh();var n=rh.current;rh.current=Ap;try{return op(e,t)}finally{rh.current=n}},useReducer:function(e,t,n){ph="useReducer",Pp(),Eh();var r=rh.current;rh.current=Ap;try{return kh(e)}finally{rh.current=r}},useRef:function(e){return ph="useRef",Pp(),Eh(),Hh()},useState:function(e){ph="useState",Pp(),Eh();var t=rh.current;rh.current=Ap;try{return Vh()}finally{rh.current=t}},useDebugValue:function(e,t){return ph="useDebugValue",Pp(),void Eh()},useDeferredValue:function(e){return ph="useDeferredValue",Pp(),Eh(),cp(e)},useTransition:function(){return ph="useTransition",Pp(),Eh(),pp()},useMutableSource:function(e,t,n){ph="useMutableSource",Pp(),Eh()},useSyncExternalStore:function(e,t,n){return ph="useSyncExternalStore",Pp(),Eh(),Lh(e,t)},useId:function(){return ph="useId",Pp(),Eh(),gp()},unstable_isNewReconciler:y};var Lp=n.unstable_now,Dp=0,Mp=-1,xp=-1,Up=-1,Fp=!1,$p=!1;function jp(){return Fp}function Vp(){return Dp}function Bp(){Dp=Lp()}function Gp(e){xp=Lp(),e.actualStartTime<0&&(e.actualStartTime=Lp())}function Hp(e){xp=-1}function Wp(e,t){if(xp>=0){var n=Lp()-xp;e.actualDuration+=n,t&&(e.selfBaseDuration=n),xp=-1}}function qp(e){if(Mp>=0){var t=Lp()-Mp;Mp=-1;for(var n=e.return;null!==n;){switch(n.tag){case 3:case l:return void(n.stateNode.effectDuration+=t)}n=n.return}}}function zp(e){if(Up>=0){var t=Lp()-Up;Up=-1;for(var n=e.return;null!==n;){switch(n.tag){case 3:var r=n.stateNode;return void(null!==r&&(r.passiveEffectDuration+=t));case l:var i=n.stateNode;return void(null!==i&&(i.passiveEffectDuration+=t))}n=n.return}}}function Kp(){Mp=Lp()}function Yp(){Up=Lp()}function Xp(e){for(var t=e.child;t;)e.actualDuration+=t.actualDuration,t=t.sibling}function Jp(e,t){if(e&&e.defaultProps){var n=_e({},t),r=e.defaultProps;for(var i in r)void 0===n[i]&&(n[i]=r[i]);return n}return t}var Qp,Zp,ef,tf,nf,rf,of,af,sf,cf,uf,lf={};Qp=new Set,Zp=new Set,ef=new Set,tf=new Set,af=new Set,nf=new Set,sf=new Set,cf=new Set,uf=new Set;var df=new Set;function hf(e,t,n,r){var i=e.memoizedState,o=n(r,i);if(8&e.mode){Ur(!0);try{o=n(r,i)}finally{Ur(!1)}}rf(t,o);var a=null==o?i:_e({},i,o);e.memoizedState=a,0===e.lanes&&(e.updateQueue.baseState=a)}of=function(e,t){if(null!==e&&"function"!=typeof e){var n=t+"_"+e;df.has(n)||(df.add(n),a("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",t,e))}},rf=function(e,t){if(void 0===t){var n=Me(e)||"Component";nf.has(n)||(nf.add(n),a("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",n))}},Object.defineProperty(lf,"_processChildContext",{enumerable:!1,value:function(){throw new Error("_processChildContext is not available in React 16+. This likely means you have multiple copies of React and are attempting to nest a React 15 tree inside a React 16 tree using unstable_renderSubtreeIntoContainer, which isn't supported. Try to make sure you have only one copy of React (and ideally, switch to ReactDOM.createPortal).")}}),Object.freeze(lf);var pf={isMounted:function(e){var t=ur.current;if(null!==t&&1===t.tag){var n=t.stateNode;n._warnedAboutRefsInRender||a("%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",Ue(t)||"A component"),n._warnedAboutRefsInRender=!0}var r=Gn(e);return!!r&&lr(r)===r},enqueueSetState:function(e,t,n){var r=Gn(e),i=kv(),o=Pv(r),a=wd(i,o);a.payload=t,null!=n&&(of(n,"setState"),a.callback=n);var s=Td(r,a,o);null!==s&&(Lv(s,r,o,i),Rd(s,r,o)),Kr(r,o)},enqueueReplaceState:function(e,t,n){var r=Gn(e),i=kv(),o=Pv(r),a=wd(i,o);a.tag=1,a.payload=t,null!=n&&(of(n,"replaceState"),a.callback=n);var s=Td(r,a,o);null!==s&&(Lv(s,r,o,i),Rd(s,r,o)),Kr(r,o)},enqueueForceUpdate:function(e,t){var n=Gn(e),r=kv(),i=Pv(n),o=wd(r,i);o.tag=2,null!=t&&(of(t,"forceUpdate"),o.callback=t);var a=Td(n,o,i);null!==a&&(Lv(a,n,i,r),Rd(a,n,i)),function(e,t){null!==Dr&&"function"==typeof Dr.markForceUpdateScheduled&&Dr.markForceUpdateScheduled(e,t)}(n,i)}};function ff(e,t,n,r,i,o,s){var c=e.stateNode;if("function"==typeof c.shouldComponentUpdate){var u=c.shouldComponentUpdate(r,o,s);if(8&e.mode){Ur(!0);try{u=c.shouldComponentUpdate(r,o,s)}finally{Ur(!1)}}return void 0===u&&a("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",Me(t)||"Component"),u}return!(t.prototype&&t.prototype.isPureReactComponent&&rs(n,r)&&rs(i,o))}function mf(e,t){t.updater=pf,e.stateNode=t,t._reactInternals=e,t._reactInternalInstance=lf}function gf(e,t,n){var r,i=!1,o=wu,s=wu,c=t.contextType;!("contextType"in t)||null===c||void 0!==c&&c.$$typeof===ie&&void 0===c._context||cf.has(t)||(cf.add(t),r=void 0===c?" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":"object"!=typeof c?" However, it is set to a "+typeof c+".":c.$$typeof===re?" Did you accidentally pass the Context.Provider instead?":void 0!==c._context?" Did you accidentally pass the Context.Consumer instead?":" However, it is set to an object with keys {"+Object.keys(c).join(", ")+"}.",a("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",Me(t)||"Component",r)),"object"==typeof c&&null!==c?s=dd(c):(o=Iu(0,t,!0),s=(i=null!=t.contextTypes)?Au(e,o):wu);var u=new t(n,s);if(8&e.mode){Ur(!0);try{u=new t(n,s)}finally{Ur(!1)}}var l=e.memoizedState=null!=u.state?u.state:null;if(mf(e,u),"function"==typeof t.getDerivedStateFromProps&&null===l){var d=Me(t)||"Component";Zp.has(d)||(Zp.add(d),a("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",d,null===u.state?"null":"undefined",d))}if("function"==typeof t.getDerivedStateFromProps||"function"==typeof u.getSnapshotBeforeUpdate){var h=null,p=null,f=null;if("function"==typeof u.componentWillMount&&!0!==u.componentWillMount.__suppressDeprecationWarning?h="componentWillMount":"function"==typeof u.UNSAFE_componentWillMount&&(h="UNSAFE_componentWillMount"),"function"==typeof u.componentWillReceiveProps&&!0!==u.componentWillReceiveProps.__suppressDeprecationWarning?p="componentWillReceiveProps":"function"==typeof u.UNSAFE_componentWillReceiveProps&&(p="UNSAFE_componentWillReceiveProps"),"function"==typeof u.componentWillUpdate&&!0!==u.componentWillUpdate.__suppressDeprecationWarning?f="componentWillUpdate":"function"==typeof u.UNSAFE_componentWillUpdate&&(f="UNSAFE_componentWillUpdate"),null!==h||null!==p||null!==f){var m=Me(t)||"Component",g="function"==typeof t.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";tf.has(m)||(tf.add(m),a("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n%s uses %s but also contains the following legacy lifecycles:%s%s%s\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://reactjs.org/link/unsafe-component-lifecycles",m,g,null!==h?"\n  "+h:"",null!==p?"\n  "+p:"",null!==f?"\n  "+f:""))}}return i&&Ou(e,o,s),u}function vf(e,t,n,r){var i=t.state;if("function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==i){var o=Ue(e)||"Component";Qp.has(o)||(Qp.add(o),a("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",o)),pf.enqueueReplaceState(t,t.state,null)}}function Ef(e,t,n,r){!function(e,t,n){var r=e.stateNode,i=Me(t)||"Component";r.render||a(t.prototype&&"function"==typeof t.prototype.render?"%s(...): No `render` method found on the returned component instance: did you accidentally return an object from the constructor?":"%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`.",i),!r.getInitialState||r.getInitialState.isReactClassApproved||r.state||a("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",i),r.getDefaultProps&&!r.getDefaultProps.isReactClassApproved&&a("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",i),r.propTypes&&a("propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",i),r.contextType&&a("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",i),!t.childContextTypes||uf.has(t)||8&e.mode||(uf.add(t),a("%s uses the legacy childContextTypes API which is no longer supported and will be removed in the next major release. Use React.createContext() instead\n\n.Learn more about this warning here: https://reactjs.org/link/legacy-context",i)),!t.contextTypes||uf.has(t)||8&e.mode||(uf.add(t),a("%s uses the legacy contextTypes API which is no longer supported and will be removed in the next major release. Use React.createContext() with static contextType instead.\n\nLearn more about this warning here: https://reactjs.org/link/legacy-context",i)),r.contextTypes&&a("contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",i),t.contextType&&t.contextTypes&&!sf.has(t)&&(sf.add(t),a("%s declares both contextTypes and contextType static properties. The legacy contextTypes property will be ignored.",i)),"function"==typeof r.componentShouldUpdate&&a("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",i),t.prototype&&t.prototype.isPureReactComponent&&void 0!==r.shouldComponentUpdate&&a("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",Me(t)||"A pure component"),"function"==typeof r.componentDidUnmount&&a("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",i),"function"==typeof r.componentDidReceiveProps&&a("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",i),"function"==typeof r.componentWillRecieveProps&&a("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",i),"function"==typeof r.UNSAFE_componentWillRecieveProps&&a("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",i),void 0!==r.props&&r.props!==n&&a("%s(...): When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",i,i),r.defaultProps&&a("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",i,i),"function"!=typeof r.getSnapshotBeforeUpdate||"function"==typeof r.componentDidUpdate||ef.has(t)||(ef.add(t),a("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",Me(t))),"function"==typeof r.getDerivedStateFromProps&&a("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",i),"function"==typeof r.getDerivedStateFromError&&a("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",i),"function"==typeof t.getSnapshotBeforeUpdate&&a("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",i);var o=r.state;o&&("object"!=typeof o||Et(o))&&a("%s.state: must be set to an object or null",i),"function"==typeof r.getChildContext&&"object"!=typeof t.childContextTypes&&a("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",i)}(e,t,n);var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},bd(e);var o=t.contextType;if("object"==typeof o&&null!==o)i.context=dd(o);else{var s=Iu(0,t,!0);i.context=Au(e,s)}if(i.state===n){var c=Me(t)||"Component";af.has(c)||(af.add(c),a("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",c))}8&e.mode&&Il.recordLegacyContextWarning(e,i),Il.recordUnsafeLifecycleWarnings(e,i),i.state=e.memoizedState;var u=t.getDerivedStateFromProps;if("function"==typeof u&&(hf(e,t,u,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(function(e,t){var n=t.state;"function"==typeof t.componentWillMount&&t.componentWillMount(),"function"==typeof t.UNSAFE_componentWillMount&&t.UNSAFE_componentWillMount(),n!==t.state&&(a("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",Ue(e)||"Component"),pf.enqueueReplaceState(t,t.state,null))}(e,i),Od(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount){var l=4;l|=rr,e.mode&Yr&&(l|=ir),e.flags|=l}}function yf(e,t){return{value:e,source:t,stack:Le(t),digest:null}}function _f(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function bf(e,t){try{var n=t.value,r=t.source,i=t.stack,o=null!==i?i:"";if(null!=n&&n._suppressLogging){if(1===e.tag)return;console.error(n)}var a,s=r?Ue(r):null,c=s?"The above error occurred in the <"+s+"> component:":"The above error occurred in one of your React components:";a=3===e.tag?"Consider adding an error boundary to your tree to customize error handling behavior.\nVisit https://reactjs.org/link/error-boundaries to learn more about error boundaries.":"React will try to recreate this component tree from scratch using the error boundary you provided, "+(Ue(e)||"Anonymous")+".",console.error(c+"\n"+o+"\n\n"+a)}catch(e){setTimeout(function(){throw e})}}var Sf="function"==typeof WeakMap?WeakMap:Map;function wf(e,t,n){var r=wd(Pi,n);r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){oE(i),bf(e,t)},r}function Tf(e,t,n){var r=wd(Pi,n);r.tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var o=t.value;r.payload=function(){return i(o)},r.callback=function(){PE(e),bf(e,t)}}var s=e.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(r.callback=function(){PE(e),bf(e,t),"function"!=typeof i&&(null===fv?fv=new Set([this]):fv.add(this));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""}),"function"!=typeof i&&(Ki(e.lanes,ei)||a("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",Ue(e)||"Unknown"))}),r}function Rf(e,t,n){var r,i=e.pingCache;if(null===i?(i=e.pingCache=new Sf,r=new Set,i.set(t,r)):void 0===(r=i.get(t))&&(r=new Set,i.set(t,r)),!r.has(n)){r.add(n);var o=cE.bind(null,e,t,n);xr&&yE(e,n),t.then(o,o)}}function Cf(e){var t=e;do{if(t.tag===d&&Xd(t))return t;t=t.return}while(null!==t);return null}function If(e,t,n,r,i){if(!(1&e.mode)){if(e===t)e.flags|=Zn;else{if(e.flags|=Hn,n.flags|=er,n.flags&=-52805,1===n.tag)if(null===n.alternate)n.tag=f;else{var o=wd(Pi,ei);o.tag=2,Td(n,o,ei)}n.lanes=Xi(n.lanes,ei)}return e}return e.flags|=Zn,e.lanes=i,e}function Of(e,t,n,r,i){if(n.flags|=Qn,xr&&yE(e,i),null!==r&&"object"==typeof r&&"function"==typeof r.then){var o=r;!function(e){var t=e.tag;if(!(1&e.mode||0!==t&&t!==u&&t!==p)){var n=e.alternate;n?(e.updateQueue=n.updateQueue,e.memoizedState=n.memoizedState,e.lanes=n.lanes):(e.updateQueue=null,e.memoizedState=null)}}(n),Tl()&&1&n.mode&&ll();var a=Cf(t);if(null!==a)return a.flags&=-257,If(a,t,n,0,i),1&a.mode&&Rf(e,o,i),void function(e,t,n){var r=e.updateQueue;if(null===r){var i=new Set;i.add(n),e.updateQueue=i}else r.add(n)}(a,0,o);if(!(i&ei))return Rf(e,o,i),void Xv();r=new Error("A component suspended while responding to synchronous input. This will cause the UI to be replaced with a loading indicator. To fix, updates that suspend should be wrapped with startTransition.")}else if(Tl()&&1&n.mode){ll();var s=Cf(t);if(null!==s)return s.flags&Zn||(s.flags|=Wn),If(s,t,n,0,i),void Rl(yf(r,n))}!function(e){Qg!==Gg&&(Qg=Vg),null===rv?rv=[e]:rv.push(e)}(r=yf(r,n));var c=t;do{switch(c.tag){case 3:var l=r;c.flags|=Zn;var d=Wi(i);return c.lanes=Xi(c.lanes,d),void Cd(c,wf(c,l,d));case 1:var h=r,f=c.stateNode;if(!(c.flags&Hn||"function"!=typeof c.type.getDerivedStateFromError&&(null===f||"function"!=typeof f.componentDidCatch||iE(f)))){c.flags|=Zn;var m=Wi(i);return c.lanes=Xi(c.lanes,m),void Cd(c,Tf(c,h,m))}}c=c.return}while(null!==c)}var Af,Nf,kf,Pf,Lf,Df,Mf,xf,Uf,Ff=r.ReactCurrentOwner,$f=!1;function jf(e,t,n,r){t.child=null===e?Xl(t,null,n,r):Yl(t,e.child,n,r)}function Vf(e,t,n,r,i){if(t.type!==t.elementType){var o=n.propTypes;o&&mu(o,r,"prop",Me(n))}var a,s,c=n.render,u=t.ref;if(ld(t,i),Vr(t),Ff.current=t,We(!0),a=Sh(e,t,c,r,u,i),s=wh(),8&t.mode){Ur(!0);try{a=Sh(e,t,c,r,u,i),s=wh()}finally{Ur(!1)}}return We(!1),Br(),null===e||$f?(Tl()&&s&&tl(t),t.flags|=1,jf(e,t,a,i),t.child):(Th(e,t,i),vm(e,t,i))}function Bf(e,t,n,r,i){if(null===e){var o,s=n.type;if(function(e){return"function"==typeof e&&!FE(e)&&void 0===e.defaultProps}(s)&&null===n.compare&&void 0===n.defaultProps)return o=OE(s),t.tag=p,t.type=o,Jf(t,s),Gf(e,t,o,r,i);var c=s.propTypes;if(c&&mu(c,r,"prop",Me(s)),void 0!==n.defaultProps){var u=Me(s)||"Unknown";Uf[u]||(a("%s: Support for defaultProps will be removed from memo components in a future major release. Use JavaScript default parameters instead.",u),Uf[u]=!0)}var l=VE(n.type,null,r,t,t.mode,i);return l.ref=t.ref,l.return=t,t.child=l,l}var d=n.type,h=d.propTypes;h&&mu(h,r,"prop",Me(d));var f=e.child;if(!Em(e,i)){var m=n.compare;if((m=null!==m?m:rs)(f.memoizedProps,r)&&e.ref===t.ref)return vm(e,t,i)}t.flags|=1;var g=$E(f,r);return g.ref=t.ref,g.return=t,t.child=g,g}function Gf(e,t,n,r,i){if(t.type!==t.elementType){var o=t.elementType;if(o.$$typeof===ue){var a=o._payload,s=o._init;try{o=s(a)}catch(e){o=null}var c=o&&o.propTypes;c&&mu(c,r,"prop",Me(o))}}if(null!==e){var u=e.memoizedProps;if(rs(u,r)&&e.ref===t.ref&&t.type===e.type){if($f=!1,t.pendingProps=r=u,!Em(e,i))return t.lanes=e.lanes,vm(e,t,i);e.flags&er&&($f=!0)}}return qf(e,t,n,r,i)}function Hf(e,t,n){var r,i=t.pendingProps,o=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(1&t.mode){var s;if(!Ki(n,Ni))return s=null!==a?Xi(a.baseLanes,n):n,t.lanes=t.childLanes=Ni,t.memoizedState={baseLanes:s,cachePool:null,transitions:null},t.updateQueue=null,Gv(t,s),null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Gv(t,null!==a?a.baseLanes:n)}else t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Gv(t,n);else null!==a?(r=Xi(a.baseLanes,n),t.memoizedState=null):r=n,Gv(t,r);return jf(e,t,o,n),t.child}function Wf(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=qn,t.flags|=nr)}function qf(e,t,n,r,i){if(t.type!==t.elementType){var o=n.propTypes;o&&mu(o,r,"prop",Me(n))}var a,s,c;if(a=Au(t,Iu(0,n,!0)),ld(t,i),Vr(t),Ff.current=t,We(!0),s=Sh(e,t,n,r,a,i),c=wh(),8&t.mode){Ur(!0);try{s=Sh(e,t,n,r,a,i),c=wh()}finally{Ur(!1)}}return We(!1),Br(),null===e||$f?(Tl()&&c&&tl(t),t.flags|=1,jf(e,t,s,i),t.child):(Th(e,t,i),vm(e,t,i))}function zf(e,t,n,r,i){switch(gy(t)){case!1:var o=t.stateNode,s=new(0,t.type)(t.memoizedProps,o.context);o.updater.enqueueSetState(o,s.state,null);break;case!0:t.flags|=Hn,t.flags|=Zn;var c=new Error("Simulated error coming from DevTools"),u=Wi(i);t.lanes=Xi(t.lanes,u),Cd(t,Tf(t,yf(c,t),u))}if(t.type!==t.elementType){var l=n.propTypes;l&&mu(l,r,"prop",Me(n))}var d,h;ku(n)?(d=!0,xu(t)):d=!1,ld(t,i),null===t.stateNode?(gm(e,t),gf(t,n,r),Ef(t,n,r,i),h=!0):h=null===e?function(e,t,n,r){var i=e.stateNode,o=e.memoizedProps;i.props=o;var a,s=i.context,c=t.contextType;a="object"==typeof c&&null!==c?dd(c):Au(e,Iu(0,t,!0));var u=t.getDerivedStateFromProps,l="function"==typeof u||"function"==typeof i.getSnapshotBeforeUpdate;l||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||o===n&&s===a||vf(e,i,n,a),Nd();var d=e.memoizedState,h=i.state=d;if(Od(e,n,i,r),h=e.memoizedState,o===n&&d===h&&!Nu()&&!kd()){if("function"==typeof i.componentDidMount){var p=4;p|=rr,e.mode&Yr&&(p|=ir),e.flags|=p}return!1}"function"==typeof u&&(hf(e,t,u,n),h=e.memoizedState);var f=kd()||ff(e,t,o,n,d,h,a);if(f){if(l||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||("function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"==typeof i.componentDidMount){var m=4;m|=rr,e.mode&Yr&&(m|=ir),e.flags|=m}}else{if("function"==typeof i.componentDidMount){var g=4;g|=rr,e.mode&Yr&&(g|=ir),e.flags|=g}e.memoizedProps=n,e.memoizedState=h}return i.props=n,i.state=h,i.context=a,f}(t,n,r,i):function(e,t,n,r,i){var o=t.stateNode;Sd(e,t);var a=t.memoizedProps,s=t.type===t.elementType?a:Jp(t.type,a);o.props=s;var c,u=t.pendingProps,l=o.context,d=n.contextType;c="object"==typeof d&&null!==d?dd(d):Au(t,Iu(0,n,!0));var h=n.getDerivedStateFromProps,p="function"==typeof h||"function"==typeof o.getSnapshotBeforeUpdate;p||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||a===u&&l===c||vf(t,o,r,c),Nd();var f=t.memoizedState,m=o.state=f;if(Od(t,r,o,i),m=t.memoizedState,a===u&&f===m&&!Nu()&&!kd())return"function"==typeof o.componentDidUpdate&&(a===e.memoizedProps&&f===e.memoizedState||(t.flags|=4)),"function"==typeof o.getSnapshotBeforeUpdate&&(a===e.memoizedProps&&f===e.memoizedState||(t.flags|=zn)),!1;"function"==typeof h&&(hf(t,n,h,r),m=t.memoizedState);var g=kd()||ff(t,n,s,r,f,m,c)||!1;return g?(p||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(r,m,c),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,m,c)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=zn)):("function"==typeof o.componentDidUpdate&&(a===e.memoizedProps&&f===e.memoizedState||(t.flags|=4)),"function"==typeof o.getSnapshotBeforeUpdate&&(a===e.memoizedProps&&f===e.memoizedState||(t.flags|=zn)),t.memoizedProps=r,t.memoizedState=m),o.props=r,o.state=m,o.context=c,g}(e,t,n,r,i);var p=Kf(e,t,n,h,d,i);return h&&t.stateNode.props!==r&&(Df||a("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",Ue(t)||"a component"),Df=!0),p}function Kf(e,t,n,r,i,o){Wf(e,t);var a=!!(t.flags&Hn);if(!r&&!a)return i&&Uu(t,n,!1),vm(e,t,o);var s,c=t.stateNode;if(Ff.current=t,a&&"function"!=typeof n.getDerivedStateFromError)s=null,Hp();else{if(Vr(t),We(!0),s=c.render(),8&t.mode){Ur(!0);try{c.render()}finally{Ur(!1)}}We(!1),Br()}return t.flags|=1,null!==e&&a?function(e,t,n,r){t.child=Yl(t,e.child,null,r),t.child=Yl(t,null,n,r)}(e,t,s,o):jf(e,t,s,o),t.memoizedState=c.state,i&&Uu(t,n,!0),t.child}function Yf(e){var t=e.stateNode;t.pendingContext?Du(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Du(e,t.context,!1),$d(e,t.containerInfo)}function Xf(e,t,n,r,i){return Sl(),Rl(i),t.flags|=Wn,jf(e,t,n,r),t.child}function Jf(e,t){if(t&&t.childContextTypes&&a("%s(...): childContextTypes cannot be defined on a function component.",t.displayName||t.name||"Component"),null!==e.ref){var n="",r=Ve();r&&(n+="\n\nCheck the render method of `"+r+"`.");var i=r||"",o=e._debugSource;o&&(i=o.fileName+":"+o.lineNumber),Lf[i]||(Lf[i]=!0,a("Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s",n))}if(void 0!==t.defaultProps){var s=Me(t)||"Unknown";Uf[s]||(a("%s: Support for defaultProps will be removed from function components in a future major release. Use JavaScript default parameters instead.",s),Uf[s]=!0)}if("function"==typeof t.getDerivedStateFromProps){var c=Me(t)||"Unknown";Pf[c]||(a("%s: Function components do not support getDerivedStateFromProps.",c),Pf[c]=!0)}if("object"==typeof t.contextType&&null!==t.contextType){var u=Me(t)||"Unknown";kf[u]||(a("%s: Function components do not support contextType.",u),kf[u]=!0)}}Af={},Nf={},kf={},Pf={},Lf={},Df=!1,Mf={},xf={},Uf={};var Qf={dehydrated:null,treeContext:null,retryLane:0};function Zf(e){return{baseLanes:e,cachePool:null,transitions:null}}function em(e,t,n){var r=t.pendingProps;vy(t)&&(t.flags|=Hn);var i=Hd.current,o=!1,s=!!(t.flags&Hn);if(s||function(e,t){return(null===t||null!==t.memoizedState)&&Wd(e,2)}(i,e)?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),Kd(t,i=qd(i)),null===e){El(t);var c=t.memoizedState;if(null!==c){var u=c.dehydrated;if(null!==u)return function(e,t){return 1&e.mode?e.lanes=qc(t)?ri:Ni:(a("Cannot hydrate Suspense in legacy mode. Switch from ReactDOM.hydrate(element, container) to ReactDOMClient.hydrateRoot(container, <App />).render(element) or remove the Suspense components from the server rendered components."),e.lanes=ei),null}(t,u)}var l=r.children;if(o){var d=function(e,t,n,r){var i,o,a=e.mode,s=e.child,c={mode:"hidden",children:t};return 1&a||null===s?(i=nm(c,a),o=GE(n,a,r,null)):((i=s).childLanes=0,i.pendingProps=c,2&e.mode&&(i.actualDuration=0,i.actualStartTime=-1,i.selfBaseDuration=0,i.treeBaseDuration=0),o=GE(n,a,r,null)),i.return=e,o.return=e,i.sibling=o,e.child=i,o}(t,l,r.fallback,n);return t.child.memoizedState=Zf(n),t.memoizedState=Qf,d}return tm(t,l)}var h=e.memoizedState;if(null!==h){var p=h.dehydrated;if(null!==p)return function(e,t,n,r,i,o,s){if(n){if(t.flags&Wn)return t.flags&=-257,im(e,t,s,_f(new Error("There was an error while hydrating this Suspense boundary. Switched to client rendering.")));if(null!==t.memoizedState)return t.child=e.child,t.flags|=Hn,null;var c=function(e,t,n,r,i){var o=t.mode,a=nm({mode:"visible",children:n},o),s=GE(r,o,i,null);return s.flags|=2,a.return=t,s.return=t,a.sibling=s,t.child=a,!(1&t.mode)||Yl(t,e.child,null,i),s}(e,t,r.children,r.fallback,s);return t.child.memoizedState=Zf(s),t.memoizedState=Qf,c}if(sl&&a("We should not be hydrating here. This is a bug in React. Please file a bug."),!(1&t.mode))return im(e,t,s,null);if(qc(i)){var u,l,d,h=function(e){var t,n,r,i=e.nextSibling&&e.nextSibling.dataset;return i&&(t=i.dgst,n=i.msg,r=i.stck),{message:n,digest:t,stack:r}}(i);return u=h.digest,d=h.stack,im(e,t,s,_f((l=h.message)?new Error(l):new Error("The server could not finish this Suspense boundary, likely due to an error during server rendering. Switched to client rendering."),u,d))}var p=Ki(s,e.childLanes);if($f||p){var f=Nv();if(null!==f){var m=function(e,t){var n;switch(Hi(t)){case ni:n=ti;break;case ii:n=ri;break;case 64:case 128:case 256:case 512:case si:case ci:case ui:case li:case di:case hi:case pi:case fi:case mi:case gi:case vi:case Ei:case _i:case bi:case Si:case wi:case Ti:n=oi;break;case Ai:n=Oi;break;default:n=0}return n&(e.suspendedLanes|t)?0:n}(f,s);0!==m&&m!==o.retryLane&&(o.retryLane=m,md(e,m),Lv(f,e,m,-1))}return Xv(),im(e,t,s,_f(new Error("This Suspense boundary received an update before it finished hydrating. This caused the boundary to switch to client rendering. The usual way to fix this is to wrap the original update in startTransition.")))}if(Wc(i)){t.flags|=Hn,t.child=e.child;var g=lE.bind(null,e);return i._reactRetry=g,null}!function(e,t,n){al=zc(t.nextSibling),ol=e,sl=!0,ul=null,cl=!1,null!==n&&function(e,t){il(),Ku[Yu++]=Ju,Ku[Yu++]=Qu,Ku[Yu++]=Xu,Ju=t.id,Qu=t.overflow,Xu=e}(e,n)}(t,i,o.treeContext);var v=tm(t,r.children);return v.flags|=Yn,v}(e,t,s,r,p,h,n)}if(o){var f=function(e,t,n,r,i){var o,a,s=t.mode,c=e.child,u=c.sibling,l={mode:"hidden",children:n};return 1&s||t.child===c?(o=rm(c,l)).subtreeFlags=c.subtreeFlags&cr:((o=t.child).childLanes=0,o.pendingProps=l,2&t.mode&&(o.actualDuration=0,o.actualStartTime=-1,o.selfBaseDuration=c.selfBaseDuration,o.treeBaseDuration=c.treeBaseDuration),t.deletions=null),null!==u?a=$E(u,r):(a=GE(r,s,i,null)).flags|=2,a.return=t,o.return=t,o.sibling=a,t.child=o,a}(e,t,r.children,r.fallback,n),m=t.child,g=e.child.memoizedState;return m.memoizedState=null===g?Zf(n):function(e,t){return{baseLanes:Xi(e.baseLanes,t),cachePool:null,transitions:e.transitions}}(g,n),m.childLanes=function(e,t){return Ji(e.childLanes,t)}(e,n),t.memoizedState=Qf,f}var v=function(e,t,n,r){var i=e.child,o=i.sibling,a=rm(i,{mode:"visible",children:n});if(1&t.mode||(a.lanes=r),a.return=t,a.sibling=null,null!==o){var s=t.deletions;null===s?(t.deletions=[o],t.flags|=16):s.push(o)}return t.child=a,a}(e,t,r.children,n);return t.memoizedState=null,v}function tm(e,t,n){var r=nm({mode:"visible",children:t},e.mode);return r.return=e,e.child=r,r}function nm(e,t,n){return HE(e,t,0,null)}function rm(e,t){return $E(e,t)}function im(e,t,n,r){null!==r&&Rl(r),Yl(t,e.child,null,n);var i=tm(t,t.pendingProps.children);return i.flags|=2,t.memoizedState=null,i}function om(e,t,n){e.lanes=Xi(e.lanes,t);var r=e.alternate;null!==r&&(r.lanes=Xi(r.lanes,t)),ud(e.return,t,n)}function am(e,t){var n=Et(e),r=!n&&"function"==typeof he(e);if(n||r){var i=n?"array":"iterable";return a("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",i,t,i),!1}return!0}function sm(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function cm(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail,s=r.children;!function(e){if(void 0!==e&&"forwards"!==e&&"backwards"!==e&&"together"!==e&&!Mf[e])if(Mf[e]=!0,"string"==typeof e)switch(e.toLowerCase()){case"together":case"forwards":case"backwards":a('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',e,e.toLowerCase());break;case"forward":case"backward":a('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',e,e.toLowerCase());break;default:a('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',e)}else a('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',e)}(i),function(e,t){void 0===e||xf[e]||("collapsed"!==e&&"hidden"!==e?(xf[e]=!0,a('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',e)):"forwards"!==t&&"backwards"!==t&&(xf[e]=!0,a('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',e)))}(o,i),function(e,t){if(("forwards"===t||"backwards"===t)&&null!=e&&!1!==e)if(Et(e)){for(var n=0;n<e.length;n++)if(!am(e[n],n))return}else{var r=he(e);if("function"==typeof r){var i=r.call(e);if(i)for(var o=i.next(),s=0;!o.done;o=i.next()){if(!am(o.value,s))return;s++}}else a('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',t)}}(s,i),jf(e,t,s,n);var c=Hd.current;if(Wd(c,2)?(c=zd(c,2),t.flags|=Hn):(null!==e&&!!(e.flags&Hn)&&function(e,t,n){for(var r=t;null!==r;){if(r.tag===d)null!==r.memoizedState&&om(r,n,e);else if(r.tag===m)om(r,n,e);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)return;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}}(t,t.child,n),c=qd(c)),Kd(t,c),1&t.mode)switch(i){case"forwards":var u,l=function(e){for(var t=e,n=null;null!==t;){var r=t.alternate;null!==r&&null===Jd(r)&&(n=t),t=t.sibling}return n}(t.child);null===l?(u=t.child,t.child=null):(u=l.sibling,l.sibling=null),sm(t,!1,u,l,o);break;case"backwards":var h=null,p=t.child;for(t.child=null;null!==p;){var f=p.alternate;if(null!==f&&null===Jd(f)){t.child=p;break}var g=p.sibling;p.sibling=h,h=p,p=g}sm(t,!0,h,null,o);break;case"together":sm(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}var um,lm,dm,hm,pm=!1,fm=!1;function mm(){$f=!0}function gm(e,t){1&t.mode||null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function vm(e,t,n){return null!==e&&(t.dependencies=e.dependencies),Hp(),Yv(t.lanes),Ki(n,t.childLanes)?(function(e,t){if(null!==e&&t.child!==e.child)throw new Error("Resuming work not yet implemented.");if(null!==t.child){var n=t.child,r=$E(n,n.pendingProps);for(t.child=r,r.return=t;null!==n.sibling;)(r=r.sibling=$E(n=n.sibling,n.pendingProps)).return=t;r.sibling=null}}(e,t),t.child):null}function Em(e,t){return!!Ki(e.lanes,t)}function ym(e,t,n){if(t._debugNeedsRemount&&null!==e)return function(e,t,n){var r=t.return;if(null===r)throw new Error("Cannot swap the root fiber.");if(e.alternate=null,t.alternate=null,n.index=t.index,n.sibling=t.sibling,n.return=t.return,n.ref=t.ref,t===r.child)r.child=n;else{var i=r.child;if(null===i)throw new Error("Expected parent to have a child.");for(;i.sibling!==t;)if(null===(i=i.sibling))throw new Error("Expected to find the previous sibling.");i.sibling=n}var o=r.deletions;return null===o?(r.deletions=[e],r.flags|=16):o.push(e),n.flags|=2,n}(e,t,VE(t.type,t.key,t.pendingProps,t._debugOwner||null,t.mode,t.lanes));if(null!==e)if(e.memoizedProps!==t.pendingProps||Nu()||t.type!==e.type)$f=!0;else{if(!(Em(e,n)||t.flags&Hn))return $f=!1,function(e,t,n){switch(t.tag){case 3:Yf(t),Sl();break;case 5:Bd(t);break;case 1:ku(t.type)&&xu(t);break;case 4:$d(t,t.stateNode.containerInfo);break;case c:sd(t,t.type._context,t.memoizedProps.value);break;case l:Ki(n,t.childLanes)&&(t.flags|=4);var r=t.stateNode;r.effectDuration=0,r.passiveEffectDuration=0;break;case d:var i=t.memoizedState;if(null!==i){if(null!==i.dehydrated)return Kd(t,qd(Hd.current)),t.flags|=Hn,null;if(Ki(n,t.child.childLanes))return em(e,t,n);Kd(t,qd(Hd.current));var o=vm(e,t,n);return null!==o?o.sibling:null}Kd(t,qd(Hd.current));break;case m:var a=!!(e.flags&Hn),s=Ki(n,t.childLanes);if(a){if(s)return cm(e,t,n);t.flags|=Hn}var u=t.memoizedState;if(null!==u&&(u.rendering=null,u.tail=null,u.lastEffect=null),Kd(t,Hd.current),s)break;return null;case v:case E:return t.lanes=0,Hf(e,t,n)}return vm(e,t,n)}(e,t,n);$f=!!(e.flags&er)}else if($f=!1,Tl()&&function(e){return il(),!!(e.flags&tr)}(t)){var r=t.index;el(t,(il(),zu),r)}switch(t.lanes=0,t.tag){case 2:return function(e,t,n,r){gm(e,t);var i,o,s,c=t.pendingProps;if(i=Au(t,Iu(0,n,!1)),ld(t,r),Vr(t),n.prototype&&"function"==typeof n.prototype.render){var u=Me(n)||"Unknown";Af[u]||(a("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",u,u),Af[u]=!0)}if(8&t.mode&&Il.recordLegacyContextWarning(t,null),We(!0),Ff.current=t,o=Sh(null,t,n,c,i,r),s=wh(),We(!1),Br(),t.flags|=1,"object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof){var l=Me(n)||"Unknown";Nf[l]||(a("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",l,l,l),Nf[l]=!0)}if("object"==typeof o&&null!==o&&"function"==typeof o.render&&void 0===o.$$typeof){var d=Me(n)||"Unknown";Nf[d]||(a("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",d,d,d),Nf[d]=!0),t.tag=1,t.memoizedState=null,t.updateQueue=null;var h=!1;return ku(n)?(h=!0,xu(t)):h=!1,t.memoizedState=null!=o.state?o.state:null,bd(t),mf(t,o),Ef(t,n,c,r),Kf(null,t,n,!0,h,r)}if(t.tag=0,8&t.mode){Ur(!0);try{o=Sh(null,t,n,c,i,r),s=wh()}finally{Ur(!1)}}return Tl()&&s&&tl(t),jf(null,t,o,r),Jf(t,n),t.child}(e,t,t.type,n);case 16:return function(e,t,n,r){gm(e,t);var i=t.pendingProps,o=(0,n._init)(n._payload);t.type=o;var a=t.tag=function(e){if("function"==typeof e)return FE(e)?1:0;if(null!=e){var t=e.$$typeof;if(t===oe)return u;if(t===ce)return h}return 2}(o),s=Jp(o,i);switch(a){case 0:return Jf(t,o),t.type=o=OE(o),qf(null,t,o,s,r);case 1:return t.type=o=AE(o),zf(null,t,o,s,r);case u:return t.type=o=NE(o),Vf(null,t,o,s,r);case h:if(t.type!==t.elementType){var c=o.propTypes;c&&mu(c,s,"prop",Me(o))}return Bf(null,t,o,Jp(o.type,s),r)}var l="";throw null!==o&&"object"==typeof o&&o.$$typeof===ue&&(l=" Did you wrap a component in React.lazy() more than once?"),new Error("Element type is invalid. Received a promise that resolves to: "+o+". Lazy element type must resolve to a class or function."+l)}(e,t,t.elementType,n);case 0:var i=t.type,o=t.pendingProps;return qf(e,t,i,t.elementType===i?o:Jp(i,o),n);case 1:var s=t.type,y=t.pendingProps;return zf(e,t,s,t.elementType===s?y:Jp(s,y),n);case 3:return function(e,t,n){if(Yf(t),null===e)throw new Error("Should have a current fiber. This is a bug in React.");var r=t.pendingProps,i=t.memoizedState,o=i.element;Sd(e,t),Od(t,r,null,n);var a,s=t.memoizedState,c=s.element;if(i.isDehydrated){var u={element:c,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions};if(t.updateQueue.baseState=u,t.memoizedState=u,t.flags&Wn)return Xf(e,t,c,n,yf(new Error("There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering."),t));if(c!==o)return Xf(e,t,c,n,yf(new Error("This root received an early update, before anything was able hydrate. Switched the entire root to client rendering."),t));al=zc((a=t).stateNode.containerInfo.firstChild),ol=a,sl=!0,ul=null,cl=!1;var l=Xl(t,null,c,n);t.child=l;for(var d=l;d;)d.flags=-3&d.flags|Yn,d=d.sibling}else{if(Sl(),c===o)return vm(e,t,n);jf(e,t,c,n)}return t.child}(e,t,n);case 5:return function(e,t,n){Bd(t),null===e&&El(t);var r=t.type,i=t.pendingProps,o=null!==e?e.memoizedProps:null,a=i.children;return Dc(r,i)?a=null:null!==o&&Dc(r,o)&&(t.flags|=32),Wf(e,t),jf(e,t,a,n),t.child}(e,t,n);case 6:return function(e,t){return null===e&&El(t),null}(e,t);case d:return em(e,t,n);case 4:return function(e,t,n){$d(t,t.stateNode.containerInfo);var r=t.pendingProps;return null===e?t.child=Yl(t,null,r,n):jf(e,t,r,n),t.child}(e,t,n);case u:var _=t.type,b=t.pendingProps;return Vf(e,t,_,t.elementType===_?b:Jp(_,b),n);case 7:return function(e,t,n){return jf(e,t,t.pendingProps,n),t.child}(e,t,n);case 8:return function(e,t,n){return jf(e,t,t.pendingProps.children,n),t.child}(e,t,n);case l:return function(e,t,n){t.flags|=4;var r=t.stateNode;return r.effectDuration=0,r.passiveEffectDuration=0,jf(e,t,t.pendingProps.children,n),t.child}(e,t,n);case c:return function(e,t,n){var r=t.type._context,i=t.pendingProps,o=t.memoizedProps,s=i.value;"value"in i||pm||(pm=!0,a("The `value` prop is required for the `<Context.Provider>`. Did you misspell it or forget to pass it?"));var u=t.type.propTypes;if(u&&mu(u,i,"prop","Context.Provider"),sd(t,r,s),null!==o)if(ns(o.value,s)){if(o.children===i.children&&!Nu())return vm(e,t,n)}else!function(e,t,n){!function(e,t,n){var r=e.child;for(null!==r&&(r.return=e);null!==r;){var i=void 0,o=r.dependencies;if(null!==o){i=r.child;for(var a=o.firstContext;null!==a;){if(a.context===t){if(1===r.tag){var s=Wi(n),u=wd(Pi,s);u.tag=2;var l=r.updateQueue;if(null===l);else{var d=l.shared,h=d.pending;null===h?u.next=u:(u.next=h.next,h.next=u),d.pending=u}}r.lanes=Xi(r.lanes,n);var p=r.alternate;null!==p&&(p.lanes=Xi(p.lanes,n)),ud(r.return,n,e),o.lanes=Xi(o.lanes,n);break}a=a.next}}else if(r.tag===c)i=r.type===e.type?null:r.child;else if(18===r.tag){var f=r.return;if(null===f)throw new Error("We just came from a parent so we must have had a parent. This is a bug in React.");f.lanes=Xi(f.lanes,n);var m=f.alternate;null!==m&&(m.lanes=Xi(m.lanes,n)),ud(f,n,e),i=r.sibling}else i=r.child;if(null!==i)i.return=r;else for(i=r;null!==i;){if(i===e){i=null;break}var g=i.sibling;if(null!==g){g.return=i.return,i=g;break}i=i.return}r=i}}(e,t,n)}(t,r,n);return jf(e,t,i.children,n),t.child}(e,t,n);case 9:return function(e,t,n){var r=t.type;void 0===r._context?r!==r.Consumer&&(fm||(fm=!0,a("Rendering <Context> directly is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?"))):r=r._context;var i=t.pendingProps.children;"function"!=typeof i&&a("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),ld(t,n);var o,s=dd(r);return Vr(t),Ff.current=t,We(!0),o=i(s),We(!1),Br(),t.flags|=1,jf(e,t,o,n),t.child}(e,t,n);case h:var S=t.type,w=Jp(S,t.pendingProps);if(t.type!==t.elementType){var T=S.propTypes;T&&mu(T,w,"prop",Me(S))}return Bf(e,t,S,w=Jp(S.type,w),n);case p:return Gf(e,t,t.type,t.pendingProps,n);case f:var R=t.type,C=t.pendingProps;return function(e,t,n,r,i){var o;return gm(e,t),t.tag=1,ku(n)?(o=!0,xu(t)):o=!1,ld(t,i),gf(t,n,r),Ef(t,n,r,i),Kf(null,t,n,!0,o,i)}(e,t,R,t.elementType===R?C:Jp(R,C),n);case m:return cm(e,t,n);case g:break;case v:return Hf(e,t,n)}throw new Error("Unknown unit of work tag ("+t.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function _m(e){e.flags|=4}function bm(e){e.flags|=qn,e.flags|=nr}function Sm(e,t){if(!Tl())switch(e.tailMode){case"hidden":for(var n=e.tail,r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":for(var i=e.tail,o=null;null!==i;)null!==i.alternate&&(o=i),i=i.sibling;null===o?t||null===e.tail?e.tail=null:e.tail.sibling=null:o.sibling=null}}function wm(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t){if(2&e.mode){for(var i=e.selfBaseDuration,o=e.child;null!==o;)n=Xi(n,Xi(o.lanes,o.childLanes)),r|=o.subtreeFlags&cr,r|=o.flags&cr,i+=o.treeBaseDuration,o=o.sibling;e.treeBaseDuration=i}else for(var a=e.child;null!==a;)n=Xi(n,Xi(a.lanes,a.childLanes)),r|=a.subtreeFlags&cr,r|=a.flags&cr,a.return=e,a=a.sibling;e.subtreeFlags|=r}else{if(2&e.mode){for(var s=e.actualDuration,c=e.selfBaseDuration,u=e.child;null!==u;)n=Xi(n,Xi(u.lanes,u.childLanes)),r|=u.subtreeFlags,r|=u.flags,s+=u.actualDuration,c+=u.treeBaseDuration,u=u.sibling;e.actualDuration=s,e.treeBaseDuration=c}else for(var l=e.child;null!==l;)n=Xi(n,Xi(l.lanes,l.childLanes)),r|=l.subtreeFlags,r|=l.flags,l.return=e,l=l.sibling;e.subtreeFlags|=r}return e.childLanes=n,t}function Tm(e,t,n){var r,i,o=t.pendingProps;switch(rl(t),t.tag){case 2:case 16:case p:case 0:case u:case 7:case 8:case l:case 9:case h:return wm(t),null;case 1:return ku(t.type)&&Pu(t),wm(t),null;case 3:var s=t.stateNode;return jd(t),Lu(t),Zd(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(null===e||null===e.child)&&(_l(t)?_m(t):null!==e&&(!e.memoizedState.isDehydrated||t.flags&Wn)&&(t.flags|=zn,wl())),lm(e,t),wm(t),null;case 5:Gd(t);var y=Fd(),_=t.type;if(null!==e&&null!=t.stateNode)dm(e,t,_,o,y),e.ref!==t.ref&&bm(t);else{if(!o){if(null===t.stateNode)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return wm(t),null}var S=Vd();if(_l(t))i=function(e,t,n,r,i,o,a){return ru(o,e),du(e,n),function(e,t,n,r,i,o,a){var s,c;switch(s=nn(t,n),Ks(t,n),t){case"dialog":xs("cancel",e),xs("close",e);break;case"iframe":case"object":case"embed":xs("load",e);break;case"video":case"audio":for(var u=0;u<ks.length;u++)xs(ks[u],e);break;case"source":xs("error",e);break;case"img":case"image":case"link":xs("error",e),xs("load",e);break;case"details":xs("toggle",e);break;case"input":st(e,n),xs("invalid",e);break;case"option":mt(0,n);break;case"select":wt(e,n),xs("invalid",e);break;case"textarea":Ct(e,n),xs("invalid",e)}tn(t,n),c=new Set;for(var l=e.attributes,d=0;d<l.length;d++)switch(l[d].name.toLowerCase()){case"value":case"checked":case"selected":break;default:c.add(l[d].name)}var h,p=null;for(var f in n)if(n.hasOwnProperty(f)){var m=n[f];if(f===oc)"string"==typeof m?e.textContent!==m&&(!0!==n[rc]&&dc(e.textContent,m,o,a),p=[oc,m]):"number"==typeof m&&e.textContent!==""+m&&(!0!==n[rc]&&dc(e.textContent,m,o,a),p=[oc,""+m]);else if(b.hasOwnProperty(f))null!=m&&("function"!=typeof m&&Js(f,m),"onScroll"===f&&xs("scroll",e));else if(a&&"boolean"==typeof s){var g=void 0,v=V(f);if(!0===n[rc]);else if(f===nc||f===rc||"value"===f||"checked"===f||"selected"===f);else if(f===tc){var E=e.innerHTML,y=m?m[sc]:void 0;if(null!=y){var _=Zs(e,y);_!==E&&Ys(f,E,_)}}else if(f===ac){if(c.delete(f),Qs){var S=Jt(m);S!==(g=e.getAttribute("style"))&&Ys(f,g,S)}}else if(s)c.delete(f.toLowerCase()),m!==(g=X(e,f,m))&&Ys(f,g,m);else if(!F(f,v,s)&&!j(f,m,v,s)){var w=!1;if(null!==v)c.delete(v.attributeName),g=Y(e,f,m,v);else{var T=r;if(T===At&&(T=kt(t)),T===At)c.delete(f.toLowerCase());else{var R=(h=f.toLowerCase(),rn.hasOwnProperty(h)&&rn[h]||null);null!==R&&R!==f&&(w=!0,c.delete(R)),c.delete(f)}g=X(e,f,m)}m===g||w||Ys(f,g,m)}}}switch(a&&c.size>0&&!0!==n[rc]&&Xs(c),t){case"input":Qe(e),lt(e,n,!0);break;case"textarea":Qe(e),Ot(e);break;case"select":case"option":break;default:"function"==typeof n.onClick&&fc(e)}return p}(e,t,n,i.namespace,0,!!(1&o.mode),a)}((r=t).stateNode,r.type,r.memoizedProps,0,S,r,!cl),r.updateQueue=i,null!==i&&_m(t);else{var w=function(e,t,n,r,i){var o=r;if(yc(e,null,o.ancestorInfo),"string"==typeof t.children||"number"==typeof t.children){var s=""+t.children,c=_c(o.ancestorInfo,e);yc(null,s,c)}var u=function(e,t,n,r){var i,o,s=hc(n),c=r;if(c===At&&(c=kt(e)),c===At){if((i=nn(e,t))||e===e.toLowerCase()||a("<%s /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.",e),"script"===e){var u=s.createElement("div");u.innerHTML="<script><\/script>",o=u.removeChild(u.firstChild)}else if("string"==typeof t.is)o=s.createElement(e,{is:t.is});else if(o=s.createElement(e),"select"===e){var l=o;t.multiple?l.multiple=!0:t.size&&(l.size=t.size)}}else o=s.createElementNS(c,e);return c===At&&(i||"[object HTMLUnknownElement]"!==Object.prototype.toString.call(o)||C.call(zs,e)||(zs[e]=!0,a("The tag <%s> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.",e))),o}(e,t,n,o.namespace);return ru(i,u),du(u,t),u}(_,o,y,S,t);um(w,t,!1,!1),t.stateNode=w,function(e,t,n){switch(function(e,t,n){var r,i=nn(t,n);switch(Ks(t,n),t){case"dialog":xs("cancel",e),xs("close",e),r=n;break;case"iframe":case"object":case"embed":xs("load",e),r=n;break;case"video":case"audio":for(var o=0;o<ks.length;o++)xs(ks[o],e);r=n;break;case"source":xs("error",e),r=n;break;case"img":case"image":case"link":xs("error",e),xs("load",e),r=n;break;case"details":xs("toggle",e),r=n;break;case"input":st(e,n),r=at(e,n),xs("invalid",e);break;case"option":mt(0,n),r=n;break;case"select":wt(e,n),r=St(0,n),xs("invalid",e);break;case"textarea":Ct(e,n),r=Rt(e,n),xs("invalid",e);break;default:r=n}switch(tn(t,r),function(e,t,n,r,i){for(var o in r)if(r.hasOwnProperty(o)){var a=r[o];if(o===ac)a&&Object.freeze(a),Qt(t,a);else if(o===tc){var s=a?a[sc]:void 0;null!=s&&Mt(t,s)}else o===oc?"string"==typeof a?("textarea"!==e||""!==a)&&xt(t,a):"number"==typeof a&&xt(t,""+a):o===nc||o===rc||o===ic||(b.hasOwnProperty(o)?null!=a&&("function"!=typeof a&&Js(o,a),"onScroll"===o&&xs("scroll",t)):null!=a&&J(t,o,a,i))}}(t,e,0,r,i),t){case"input":Qe(e),lt(e,n,!1);break;case"textarea":Qe(e),Ot(e);break;case"option":!function(e,t){null!=t.value&&e.setAttribute("value",qe(ze(t.value)))}(e,n);break;case"select":!function(e,t){var n=e;n.multiple=!!t.multiple;var r=t.value;null!=r?bt(n,!!t.multiple,r,!1):null!=t.defaultValue&&bt(n,!!t.multiple,t.defaultValue,!0)}(e,n);break;default:"function"==typeof r.onClick&&fc(e)}}(e,t,n),t){case"button":case"input":case"select":case"textarea":return!!n.autoFocus;case"img":return!0;default:return!1}}(w,_,o)&&_m(t)}null!==t.ref&&bm(t)}return wm(t),null;case 6:var T=o;if(e&&null!=t.stateNode)hm(e,t,e.memoizedProps,T);else{if("string"!=typeof T&&null===t.stateNode)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");var R=Fd(),I=Vd();_l(t)?function(e){var t=e.stateNode,n=e.memoizedProps,r=function(e,t,n){return ru(n,e),function(e,t){return e.nodeValue!==t}(e,t)}(t,n,e);if(r){var i=ol;if(null!==i)switch(i.tag){case 3:!function(e,t,n,r){dc(t.nodeValue,n,r,!0)}(0,t,n,!!(1&i.mode));break;case 5:!function(e,t,n,r,i,o){!0!==t[Ic]&&dc(r.nodeValue,i,o,!0)}(0,i.memoizedProps,0,t,n,!!(1&i.mode))}}return r}(t)&&_m(t):t.stateNode=function(e,t,n,r){yc(null,e,n.ancestorInfo);var i=function(e,t){return hc(t).createTextNode(e)}(e,t);return ru(r,i),i}(T,R,I,t)}return wm(t),null;case d:Yd(t);var O=t.memoizedState;if((null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated)&&!function(e,t,n){if(sl&&null!==al&&1&t.mode&&!(t.flags&Hn))return bl(t),Sl(),t.flags|=98560,!1;var r=_l(t);if(null!==n&&null!==n.dehydrated){if(null===e){if(!r)throw new Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(function(e){var t=e.memoizedState,n=null!==t?t.dehydrated:null;if(!n)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");!function(e,t){ru(t,e)}(n,e)}(t),wm(t),2&t.mode&&null!==n){var i=t.child;null!==i&&(t.treeBaseDuration-=i.treeBaseDuration)}return!1}if(Sl(),t.flags&Hn||(t.memoizedState=null),t.flags|=4,wm(t),2&t.mode&&null!==n){var o=t.child;null!==o&&(t.treeBaseDuration-=o.treeBaseDuration)}return!1}return wl(),!0}(e,t,O))return t.flags&Zn?t:null;if(t.flags&Hn)return t.lanes=n,2&t.mode&&Xp(t),t;var A=null!==O;if(A!==(null!==e&&null!==e.memoizedState)&&A&&(t.child.flags|=Xn,1&t.mode&&(null===e||Wd(Hd.current,1)?Qg===$g&&(Qg=Bg):Xv())),null!==t.updateQueue&&(t.flags|=4),wm(t),2&t.mode&&A){var N=t.child;null!==N&&(t.treeBaseDuration-=N.treeBaseDuration)}return null;case 4:return jd(t),lm(e,t),null===e&&$s(t.stateNode.containerInfo),wm(t),null;case c:return cd(t.type._context,t),wm(t),null;case f:return ku(t.type)&&Pu(t),wm(t),null;case m:Yd(t);var k=t.memoizedState;if(null===k)return wm(t),null;var P=!!(t.flags&Hn),L=k.rendering;if(null===L)if(P)Sm(k,!1);else{if(Qg!==$g||null!==e&&e.flags&Hn)for(var D=t.child;null!==D;){var M=Jd(D);if(null!==M){P=!0,t.flags|=Hn,Sm(k,!1);var x=M.updateQueue;return null!==x&&(t.updateQueue=x,t.flags|=4),t.subtreeFlags=0,Jl(t,n),Kd(t,zd(Hd.current,2)),t.child}D=D.sibling}null!==k.tail&&wr()>dv()&&(t.flags|=Hn,P=!0,Sm(k,!1),t.lanes=Ri)}else{if(!P){var U=Jd(L);if(null!==U){t.flags|=Hn,P=!0;var $=U.updateQueue;if(null!==$&&(t.updateQueue=$,t.flags|=4),Sm(k,!0),null===k.tail&&"hidden"===k.tailMode&&!L.alternate&&!Tl())return wm(t),null}else 2*wr()-k.renderingStartTime>dv()&&n!==Ni&&(t.flags|=Hn,P=!0,Sm(k,!1),t.lanes=Ri)}if(k.isBackwards)L.sibling=t.child,t.child=L;else{var B=k.last;null!==B?B.sibling=L:t.child=L,k.last=L}}if(null!==k.tail){var G=k.tail;k.rendering=G,k.tail=G.sibling,k.renderingStartTime=wr(),G.sibling=null;var H=Hd.current;return Kd(t,H=P?zd(H,2):qd(H)),G}return wm(t),null;case g:break;case v:case E:Hv(t);var W=null!==t.memoizedState;return null!==e&&null!==e.memoizedState!==W&&(t.flags|=Xn),W&&1&t.mode?Ki(Xg,Ni)&&(wm(t),6&t.subtreeFlags&&(t.flags|=Xn)):wm(t),null;case 24:case 25:return null}throw new Error("Unknown unit of work tag ("+t.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function Rm(e,t,n){switch(rl(t),t.tag){case 1:ku(t.type)&&Pu(t);var r=t.flags;return r&Zn?(t.flags=-65537&r|Hn,2&t.mode&&Xp(t),t):null;case 3:jd(t),Lu(t),Zd();var i=t.flags;return i&Zn&&!(i&Hn)?(t.flags=-65537&i|Hn,t):null;case 5:return Gd(t),null;case d:Yd(t);var o=t.memoizedState;if(null!==o&&null!==o.dehydrated){if(null===t.alternate)throw new Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");Sl()}var a=t.flags;return a&Zn?(t.flags=-65537&a|Hn,2&t.mode&&Xp(t),t):null;case m:return Yd(t),null;case 4:return jd(t),null;case c:return cd(t.type._context,t),null;case v:case E:return Hv(t),null;default:return null}}function Cm(e,t,n){switch(rl(t),t.tag){case 1:null!=t.type.childContextTypes&&Pu(t);break;case 3:jd(t),Lu(t),Zd();break;case 5:Gd(t);break;case 4:jd(t);break;case d:case m:Yd(t);break;case c:cd(t.type._context,t);break;case v:case E:Hv(t)}}um=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4===i.tag);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)return;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},lm=function(e,t){},dm=function(e,t,n,r,i){var o=e.memoizedProps;if(o!==r){var s=function(e,t,n,r,i,o){if(typeof r.children!=typeof n.children&&("string"==typeof r.children||"number"==typeof r.children)){var s=""+r.children,c=_c(o.ancestorInfo,t);yc(null,s,c)}return function(e,t,n,r){Ks(t,r);var i,o,s,c,u=null;switch(t){case"input":i=at(e,n),o=at(e,r),u=[];break;case"select":i=St(0,n),o=St(0,r),u=[];break;case"textarea":i=Rt(e,n),o=Rt(e,r),u=[];break;default:o=r,"function"!=typeof(i=n).onClick&&"function"==typeof o.onClick&&fc(e)}tn(t,o);var l=null;for(s in i)if(!o.hasOwnProperty(s)&&i.hasOwnProperty(s)&&null!=i[s])if(s===ac){var d=i[s];for(c in d)d.hasOwnProperty(c)&&(l||(l={}),l[c]="")}else s===tc||s===oc||s===nc||s===rc||s===ic||(b.hasOwnProperty(s)?u||(u=[]):(u=u||[]).push(s,null));for(s in o){var h=o[s],p=null!=i?i[s]:void 0;if(o.hasOwnProperty(s)&&h!==p&&(null!=h||null!=p))if(s===ac)if(h&&Object.freeze(h),p){for(c in p)!p.hasOwnProperty(c)||h&&h.hasOwnProperty(c)||(l||(l={}),l[c]="");for(c in h)h.hasOwnProperty(c)&&p[c]!==h[c]&&(l||(l={}),l[c]=h[c])}else l||(u||(u=[]),u.push(s,l)),l=h;else if(s===tc){var f=h?h[sc]:void 0;null!=f&&(p?p[sc]:void 0)!==f&&(u=u||[]).push(s,f)}else s===oc?"string"!=typeof h&&"number"!=typeof h||(u=u||[]).push(s,""+h):s===nc||s===rc||(b.hasOwnProperty(s)?(null!=h&&("function"!=typeof h&&Js(s,h),"onScroll"===s&&xs("scroll",e)),u||p===h||(u=[])):(u=u||[]).push(s,h))}return l&&(function(e,t){if(t){var n,r=Zt(e),i=Zt(t),o={};for(var s in r){var c=r[s],u=i[s];if(u&&c!==u){var l=c+","+u;if(o[l])continue;o[l]=!0,a("%s a style property during rerender (%s) when a conflicting property is set (%s) can lead to styling bugs. To avoid this, don't mix shorthand and non-shorthand properties for the same value; instead, replace the shorthand with separate values.",null==(n=e[c])||"boolean"==typeof n||""===n?"Removing":"Updating",c,u)}}}}(l,o[ac]),(u=u||[]).push(ac,l)),u}(e,t,n,r)}(t.stateNode,n,o,r,0,Vd());t.updateQueue=s,s&&_m(t)}},hm=function(e,t,n,r){n!==r&&_m(t)};var Im=null;Im=new Set;var Om=!1,Am=!1,Nm="function"==typeof WeakSet?WeakSet:Set,km=null,Pm=null,Lm=null,Dm=function(e,t){if(t.props=e.memoizedProps,t.state=e.memoizedState,2&e.mode)try{Kp(),t.componentWillUnmount()}finally{qp(e)}else t.componentWillUnmount()};function Mm(e,t){try{Gm(4,e)}catch(n){sE(e,t,n)}}function xm(e,t,n){try{Dm(e,n)}catch(n){sE(e,t,n)}}function Um(e,t){try{zm(e)}catch(n){sE(e,t,n)}}function Fm(e,t){var n=e.ref;if(null!==n)if("function"==typeof n){var r;try{if(2&e.mode)try{Kp(),r=n(null)}finally{qp(e)}else r=n(null)}catch(n){sE(e,t,n)}"function"==typeof r&&a("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",Ue(e))}else n.current=null}function $m(e,t,n){try{n()}catch(n){sE(e,t,n)}}function jm(){for(;null!==km;){var e=km;He(e);try{Vm(e)}catch(t){sE(e,e.return,t)}Ge();var t=e.sibling;if(null!==t)return t.return=e.return,void(km=t);km=e.return}}function Vm(e){var t,n=e.alternate;if(e.flags&zn){switch(He(e),e.tag){case 0:case u:case p:break;case 1:if(null!==n){var r=n.memoizedProps,i=n.memoizedState,o=e.stateNode;e.type!==e.elementType||Df||(o.props!==e.memoizedProps&&a("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ue(e)||"instance"),o.state!==e.memoizedState&&a("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ue(e)||"instance"));var s=o.getSnapshotBeforeUpdate(e.elementType===e.type?r:Jp(e.type,r),i),c=Im;void 0!==s||c.has(e.type)||(c.add(e.type),a("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",Ue(e))),o.__reactInternalSnapshotBeforeUpdate=s}break;case 3:1===(t=e.stateNode.containerInfo).nodeType?t.textContent="":9===t.nodeType&&t.documentElement&&t.removeChild(t.documentElement);break;case 5:case 6:case 4:case f:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}Ge()}}function Bm(e,t,n){var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var o=i.next,a=o;do{if((a.tag&e)===e){var s=a.destroy;a.destroy=void 0,void 0!==s&&(8&e?null!==Dr&&"function"==typeof Dr.markComponentPassiveEffectUnmountStarted&&Dr.markComponentPassiveEffectUnmountStarted(t):4&e&&Gr(t),2&e&&TE(!0),$m(t,n,s),2&e&&TE(!1),8&e?null!==Dr&&"function"==typeof Dr.markComponentPassiveEffectUnmountStopped&&Dr.markComponentPassiveEffectUnmountStopped():4&e&&Hr())}a=a.next}while(a!==o)}}function Gm(e,t){var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next,o=i;do{if((o.tag&e)===e){8&e?null!==Dr&&"function"==typeof Dr.markComponentPassiveEffectMountStarted&&Dr.markComponentPassiveEffectMountStarted(t):4&e&&null!==Dr&&"function"==typeof Dr.markComponentLayoutEffectMountStarted&&Dr.markComponentLayoutEffectMountStarted(t);var s=o.create;2&e&&TE(!0),o.destroy=s(),2&e&&TE(!1),8&e?null!==Dr&&"function"==typeof Dr.markComponentPassiveEffectMountStopped&&Dr.markComponentPassiveEffectMountStopped():4&e&&null!==Dr&&"function"==typeof Dr.markComponentLayoutEffectMountStopped&&Dr.markComponentLayoutEffectMountStopped();var c,u=o.destroy;void 0!==u&&"function"!=typeof u&&a("%s must not return anything besides a function, which is used for clean-up.%s",c=4&o.tag?"useLayoutEffect":2&o.tag?"useInsertionEffect":"useEffect",null===u?" You returned null. If your effect does not require clean up, return undefined (or nothing).":"function"==typeof u.then?"\n\nIt looks like you wrote "+c+"(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:\n\n"+c+"(() => {\n  async function fetchData() {\n    // You can await here\n    const response = await MyAPI.getData(someId);\n    // ...\n  }\n  fetchData();\n}, [someId]); // Or [] if effect doesn't need props or state\n\nLearn more about data fetching with Hooks: https://reactjs.org/link/hooks-data-fetching":" You returned: "+u)}o=o.next}while(o!==i)}}function Hm(e,t){if(4&t.flags&&t.tag===l){var n=t.stateNode.passiveEffectDuration,r=t.memoizedProps,i=r.id,o=r.onPostCommit,a=Vp(),s=null===t.alternate?"mount":"update";jp()&&(s="nested-update"),"function"==typeof o&&o(i,s,n,a);var c=t.return;e:for(;null!==c;){switch(c.tag){case 3:case l:c.stateNode.passiveEffectDuration+=n;break e}c=c.return}}}function Wm(e,t,n,r){if(n.flags&ar)switch(n.tag){case 0:case u:case p:if(!Am)if(2&n.mode)try{Kp(),Gm(5,n)}finally{qp(n)}else Gm(5,n);break;case 1:var i=n.stateNode;if(4&n.flags&&!Am)if(null===t)if(n.type!==n.elementType||Df||(i.props!==n.memoizedProps&&a("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ue(n)||"instance"),i.state!==n.memoizedState&&a("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ue(n)||"instance")),2&n.mode)try{Kp(),i.componentDidMount()}finally{qp(n)}else i.componentDidMount();else{var o=n.elementType===n.type?t.memoizedProps:Jp(n.type,t.memoizedProps),s=t.memoizedState;if(n.type!==n.elementType||Df||(i.props!==n.memoizedProps&&a("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ue(n)||"instance"),i.state!==n.memoizedState&&a("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ue(n)||"instance")),2&n.mode)try{Kp(),i.componentDidUpdate(o,s,i.__reactInternalSnapshotBeforeUpdate)}finally{qp(n)}else i.componentDidUpdate(o,s,i.__reactInternalSnapshotBeforeUpdate)}var c=n.updateQueue;null!==c&&(n.type!==n.elementType||Df||(i.props!==n.memoizedProps&&a("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",Ue(n)||"instance"),i.state!==n.memoizedState&&a("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",Ue(n)||"instance")),Pd(0,c,i));break;case 3:var h=n.updateQueue;if(null!==h){var y=null;if(null!==n.child)switch(n.child.tag){case 5:case 1:y=n.child.stateNode}Pd(0,h,y)}break;case 5:null===t&&4&n.flags&&function(e,t,n){switch(t){case"button":case"input":case"select":case"textarea":return void(n.autoFocus&&e.focus());case"img":n.src&&(e.src=n.src)}}(n.stateNode,n.type,n.memoizedProps);break;case 6:case 4:break;case l:var _=n.memoizedProps,b=_.onCommit,S=_.onRender,w=n.stateNode.effectDuration,T=Vp(),R=null===t?"mount":"update";jp()&&(R="nested-update"),"function"==typeof S&&S(n.memoizedProps.id,R,n.actualDuration,n.treeBaseDuration,n.actualStartTime,T),"function"==typeof b&&b(n.memoizedProps.id,R,w,T),Ev.push(n),mv||(mv=!0,bE(Ir,function(){return rE(),null}));var C=n.return;e:for(;null!==C;){switch(C.tag){case 3:case l:C.stateNode.effectDuration+=w;break e}C=C.return}break;case d:!function(e,t){if(null===t.memoizedState){var n=t.alternate;if(null!==n){var r=n.memoizedState;if(null!==r){var i=r.dehydrated;null!==i&&function(e){Fo(e)}(i)}}}}(0,n);break;case m:case f:case g:case v:case E:case 25:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}Am||n.flags&qn&&zm(n)}function qm(e){switch(e.tag){case 0:case u:case p:if(2&e.mode)try{Kp(),Mm(e,e.return)}finally{qp(e)}else Mm(e,e.return);break;case 1:var t=e.stateNode;"function"==typeof t.componentDidMount&&function(e,t,n){try{n.componentDidMount()}catch(n){sE(e,t,n)}}(e,e.return,t),Um(e,e.return);break;case 5:Um(e,e.return)}}function zm(e){var t,n=e.ref;if(null!==n)if(t=e.stateNode,"function"==typeof n){var r;if(2&e.mode)try{Kp(),r=n(t)}finally{qp(e)}else r=n(t);"function"==typeof r&&a("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",Ue(e))}else n.hasOwnProperty("current")||a("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().",Ue(e)),n.current=t}function Km(e){var t,n=e.alternate;if(null!==n&&(e.alternate=null,Km(n)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag){var r=e.stateNode;null!==r&&(delete(t=r)[Jc],delete t[Qc],delete t[eu],delete t[tu],delete t[nu])}e.stateNode=null,e._debugOwner=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Ym(e){return 5===e.tag||3===e.tag||4===e.tag}function Xm(e){var t=e;e:for(;;){for(;null===t.sibling;){if(null===t.return||Ym(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&18!==t.tag;){if(2&t.flags)continue e;if(null===t.child||4===t.tag)continue e;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function Jm(e){var t=function(e){for(var t=e.return;null!==t;){if(Ym(t))return t;t=t.return}throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.")}(e);switch(t.tag){case 5:var n=t.stateNode;32&t.flags&&(jc(n),t.flags&=-33),Zm(e,Xm(e),n);break;case 3:case 4:var r=t.stateNode.containerInfo;Qm(e,Xm(e),r);break;default:throw new Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}}function Qm(e,t,n){var r=e.tag;if(5===r||6===r){var i=e.stateNode;t?function(e,t,n){8===e.nodeType?e.parentNode.insertBefore(t,n):e.insertBefore(t,n)}(n,i,t):function(e,t){var n;8===e.nodeType?(n=e.parentNode).insertBefore(t,e):(n=e).appendChild(t),null==e._reactRootContainer&&null===n.onclick&&fc(n)}(n,i)}else if(4===r);else{var o=e.child;if(null!==o){Qm(o,t,n);for(var a=o.sibling;null!==a;)Qm(a,t,n),a=a.sibling}}}function Zm(e,t,n){var r=e.tag;if(5===r||6===r){var i=e.stateNode;t?function(e,t,n){e.insertBefore(t,n)}(n,i,t):function(e,t){e.appendChild(t)}(n,i)}else if(4===r);else{var o=e.child;if(null!==o){Zm(o,t,n);for(var a=o.sibling;null!==a;)Zm(a,t,n),a=a.sibling}}}var eg=null,tg=!1;function ng(e,t,n){var r,i,o=t;e:for(;null!==o;){switch(o.tag){case 5:eg=o.stateNode,tg=!1;break e;case 3:case 4:eg=o.stateNode.containerInfo,tg=!0;break e}o=o.return}if(null===eg)throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");ig(e,t,n),eg=null,tg=!1,null!==(i=(r=n).alternate)&&(i.return=null),r.return=null}function rg(e,t,n){for(var r=n.child;null!==r;)ig(e,t,r),r=r.sibling}function ig(e,t,n){switch(function(e){if(Lr&&"function"==typeof Lr.onCommitFiberUnmount)try{Lr.onCommitFiberUnmount(Pr,e)}catch(e){Mr||(Mr=!0,a("React instrumentation encountered an error: %s",e))}}(n),n.tag){case 5:Am||Fm(n,t);case 6:var r=eg,i=tg;return eg=null,rg(e,t,n),tg=i,void(null!==(eg=r)&&(tg?(S=n.stateNode,8===(b=eg).nodeType?b.parentNode.removeChild(S):b.removeChild(S)):function(e,t){e.removeChild(t)}(eg,n.stateNode)));case 18:return void(null!==eg&&(tg?function(e,t){8===e.nodeType?Vc(e.parentNode,t):1===e.nodeType&&Vc(e,t),Fo(e)}(eg,n.stateNode):Vc(eg,n.stateNode)));case 4:var o=eg,s=tg;return eg=n.stateNode.containerInfo,tg=!0,rg(e,t,n),eg=o,void(tg=s);case 0:case u:case h:case p:if(!Am){var c=n.updateQueue;if(null!==c){var l=c.lastEffect;if(null!==l){var d=l.next,f=d;do{var m=f.destroy,E=f.tag;void 0!==m&&(2&E?$m(n,t,m):4&E&&(Gr(n),2&n.mode?(Kp(),$m(n,t,m),qp(n)):$m(n,t,m),Hr())),f=f.next}while(f!==d)}}}return void rg(e,t,n);case 1:if(!Am){Fm(n,t);var y=n.stateNode;"function"==typeof y.componentWillUnmount&&xm(n,t,y)}return void rg(e,t,n);case g:return void rg(e,t,n);case v:if(1&n.mode){var _=Am;Am=_||null!==n.memoizedState,rg(e,t,n),Am=_}else rg(e,t,n);break;default:return void rg(e,t,n)}var b,S}function og(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Nm),t.forEach(function(t){var r=dE.bind(null,e,t);if(!n.has(t)){if(n.add(t),xr){if(null===Pm||null===Lm)throw Error("Expected finished root and lanes to be set. This is a bug in React.");yE(Lm,Pm)}t.then(r,r)}})}}function ag(e,t,n){var r=t.deletions;if(null!==r)for(var i=0;i<r.length;i++){var o=r[i];try{ng(e,t,o)}catch(e){sE(o,t,e)}}var a=$e;if(12854&t.subtreeFlags)for(var s=t.child;null!==s;)He(s),sg(s,e),s=s.sibling;He(a)}function sg(e,t,n){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case u:case h:case p:if(ag(t,e),cg(e),4&i){try{Bm(3,e,e.return),Gm(3,e)}catch(t){sE(e,e.return,t)}if(2&e.mode){try{Kp(),Bm(5,e,e.return)}catch(t){sE(e,e.return,t)}qp(e)}else try{Bm(5,e,e.return)}catch(t){sE(e,e.return,t)}}return;case 1:return ag(t,e),cg(e),void(i&qn&&null!==r&&Fm(r,r.return));case 5:if(ag(t,e),cg(e),i&qn&&null!==r&&Fm(r,r.return),32&e.flags){var o=e.stateNode;try{jc(o)}catch(t){sE(e,e.return,t)}}if(4&i){var a=e.stateNode;if(null!=a){var s=e.memoizedProps,c=null!==r?r.memoizedProps:s,l=e.type,f=e.updateQueue;if(e.updateQueue=null,null!==f)try{!function(e,t,n,r,i){(function(e,t,n,r,i){switch("input"===n&&"radio"===i.type&&null!=i.name&&ct(e,i),nn(n,r),function(e,t,n,r){for(var i=0;i<t.length;i+=2){var o=t[i],a=t[i+1];o===ac?Qt(e,a):o===tc?Mt(e,a):o===oc?xt(e,a):J(e,o,a,r)}}(e,t,0,nn(n,i)),n){case"input":ut(e,i);break;case"textarea":It(e,i);break;case"select":!function(e,t){var n=e,r=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!t.multiple;var i=t.value;null!=i?bt(n,!!t.multiple,i,!1):r!==!!t.multiple&&(null!=t.defaultValue?bt(n,!!t.multiple,t.defaultValue,!0):bt(n,!!t.multiple,t.multiple?[]:"",!1))}(e,i)}})(e,t,n,r,i),du(e,i)}(a,f,l,c,s)}catch(t){sE(e,e.return,t)}}}return;case 6:if(ag(t,e),cg(e),4&i){if(null===e.stateNode)throw new Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");var y=e.stateNode,_=e.memoizedProps;try{!function(e,t,n){e.nodeValue=n}(y,0,_)}catch(t){sE(e,e.return,t)}}return;case 3:if(ag(t,e),cg(e),4&i&&null!==r&&r.memoizedState.isDehydrated)try{Fo(t.containerInfo)}catch(t){sE(e,e.return,t)}return;case 4:return ag(t,e),void cg(e);case d:ag(t,e),cg(e);var b=e.child;if(b.flags&Xn){var S=null!==b.memoizedState;b.stateNode.isHidden=S,S&&(null!==b.alternate&&null!==b.alternate.memoizedState||(ov=wr()))}return void(4&i&&og(e));case v:var w=null!==r&&null!==r.memoizedState;if(1&e.mode){var T=Am;Am=T||w,ag(t,e),Am=T}else ag(t,e);if(cg(e),i&Xn){var R=null!==e.memoizedState,C=e;if(e.stateNode.isHidden=R,R&&!w&&1&C.mode){km=C;for(var I=C.child;null!==I;)km=I,hg(I),I=I.sibling}!function(e,t){for(var n=null,r=e;;){if(5===r.tag){if(null===n){n=r;try{t?Bc(r.stateNode):Gc(r.stateNode,r.memoizedProps)}catch(t){sE(e,e.return,t)}}}else if(6===r.tag){if(null===n)try{var i=r.stateNode;t?i.nodeValue="":Hc(i,r.memoizedProps)}catch(t){sE(e,e.return,t)}}else if((r.tag!==v&&r.tag!==E||null===r.memoizedState||r===e)&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)return;for(;null===r.sibling;){if(null===r.return||r.return===e)return;n===r&&(n=null),r=r.return}n===r&&(n=null),r.sibling.return=r.return,r=r.sibling}}(C,R)}return;case m:return ag(t,e),cg(e),void(4&i&&og(e));case g:return;default:return ag(t,e),void cg(e)}}function cg(e){var t=e.flags;if(2&t){try{Jm(e)}catch(t){sE(e,e.return,t)}e.flags&=-3}t&Yn&&(e.flags&=-4097)}function ug(e,t,n){Pm=n,Lm=t,km=e,lg(e,t,n),Pm=null,Lm=null}function lg(e,t,n){for(var r=!!(1&e.mode);null!==km;){var i=km,o=i.child;if(i.tag===v&&r){var a=null!==i.memoizedState||Om;if(a){dg(e);continue}var s=i.alternate,c=Om,u=Am;Om=a,(Am=null!==s&&null!==s.memoizedState||Am)&&!u&&(km=i,fg(i));for(var l=o;null!==l;)km=l,lg(l,t,n),l=l.sibling;km=i,Om=c,Am=u,dg(e)}else i.subtreeFlags&ar&&null!==o?(o.return=i,km=o):dg(e)}}function dg(e,t,n){for(;null!==km;){var r=km;if(r.flags&ar){var i=r.alternate;He(r);try{Wm(0,i,r)}catch(e){sE(r,r.return,e)}Ge()}if(r===e)return void(km=null);var o=r.sibling;if(null!==o)return o.return=r.return,void(km=o);km=r.return}}function hg(e){for(;null!==km;){var t=km,n=t.child;switch(t.tag){case 0:case u:case h:case p:if(2&t.mode)try{Kp(),Bm(4,t,t.return)}finally{qp(t)}else Bm(4,t,t.return);break;case 1:Fm(t,t.return);var r=t.stateNode;"function"==typeof r.componentWillUnmount&&xm(t,t.return,r);break;case 5:Fm(t,t.return);break;case v:if(null!==t.memoizedState){pg(e);continue}}null!==n?(n.return=t,km=n):pg(e)}}function pg(e){for(;null!==km;){var t=km;if(t===e)return void(km=null);var n=t.sibling;if(null!==n)return n.return=t.return,void(km=n);km=t.return}}function fg(e){for(;null!==km;){var t=km.child;km.tag===v&&null!==km.memoizedState||null===t?mg(e):(t.return=km,km=t)}}function mg(e){for(;null!==km;){var t=km;He(t);try{qm(t)}catch(e){sE(t,t.return,e)}if(Ge(),t===e)return void(km=null);var n=t.sibling;if(null!==n)return n.return=t.return,void(km=n);km=t.return}}function gg(e,t,n,r){for(;null!==km;){var i=km;if(i.flags&Kn){He(i);try{vg(0,i)}catch(e){sE(i,i.return,e)}Ge()}if(i===e)return void(km=null);var o=i.sibling;if(null!==o)return o.return=i.return,void(km=o);km=i.return}}function vg(e,t,n,r){switch(t.tag){case 0:case u:case p:if(2&t.mode){Yp();try{Gm(9,t)}finally{zp(t)}}else Gm(9,t)}}function Eg(){for(;null!==km;){var e=km;e.flags&Kn&&(He(e),yg(e),Ge());var t=e.sibling;if(null!==t)return t.return=e.return,void(km=t);km=e.return}}function yg(e){switch(e.tag){case 0:case u:case p:2&e.mode?(Yp(),Bm(9,e,e.return),zp(e)):Bm(9,e,e.return)}}function _g(e,t){for(;null!==km;){var n=km;He(n),Sg(n,t),Ge();var r=n.child;null!==r?(r.return=n,km=r):bg(e)}}function bg(e){for(;null!==km;){var t=km,n=t.sibling,r=t.return;if(Km(t),t===e)return void(km=null);if(null!==n)return n.return=r,void(km=n);km=r}}function Sg(e,t){switch(e.tag){case 0:case u:case p:2&e.mode?(Yp(),Bm(8,e,t),zp(e)):Bm(8,e,t)}}function wg(e){switch(e.tag){case 0:case u:case p:try{Gm(5,e)}catch(t){sE(e,e.return,t)}break;case 1:var t=e.stateNode;try{t.componentDidMount()}catch(t){sE(e,e.return,t)}}}function Tg(e){switch(e.tag){case 0:case u:case p:try{Gm(9,e)}catch(t){sE(e,e.return,t)}}}function Rg(e){switch(e.tag){case 0:case u:case p:try{Bm(5,e,e.return)}catch(t){sE(e,e.return,t)}break;case 1:var t=e.stateNode;"function"==typeof t.componentWillUnmount&&xm(e,e.return,t)}}function Cg(e){switch(e.tag){case 0:case u:case p:try{Bm(9,e,e.return)}catch(t){sE(e,e.return,t)}}}if("function"==typeof Symbol&&Symbol.for){var Ig=Symbol.for;Ig("selector.component"),Ig("selector.has_pseudo_class"),Ig("selector.role"),Ig("selector.test_id"),Ig("selector.text")}var Og=[],Ag=r.ReactCurrentActQueue;function Ng(){var e="undefined"!=typeof IS_REACT_ACT_ENVIRONMENT?IS_REACT_ACT_ENVIRONMENT:void 0;return e||null===Ag.current||a("The current testing environment is not configured to support act(...)"),e}var kg=Math.ceil,Pg=r.ReactCurrentDispatcher,Lg=r.ReactCurrentOwner,Dg=r.ReactCurrentBatchConfig,Mg=r.ReactCurrentActQueue,xg=0,Ug=2,Fg=4,$g=0,jg=1,Vg=2,Bg=3,Gg=4,Hg=5,Wg=6,qg=xg,zg=null,Kg=null,Yg=0,Xg=0,Jg=_u(0),Qg=$g,Zg=null,ev=0,tv=0,nv=0,rv=null,iv=null,ov=0,av=500,sv=Infinity,cv=500,uv=null;function lv(){sv=wr()+cv}function dv(){return sv}var hv=!1,pv=null,fv=null,mv=!1,gv=null,vv=0,Ev=[],yv=50,_v=0,bv=null,Sv=!1,wv=!1,Tv=50,Rv=0,Cv=null,Iv=Pi,Ov=0,Av=!1;function Nv(){return zg}function kv(){return(qg&(Ug|Fg))!==xg?wr():Iv!==Pi?Iv:Iv=wr()}function Pv(e){if(!(1&e.mode))return ei;if((qg&Ug)!==xg&&0!==Yg)return Wi(Yg);if(null!==Cl.transition){if(null!==Dg.transition){var t=Dg.transition;t._updatedFibers||(t._updatedFibers=new Set),t._updatedFibers.add(e)}return 0===Ov&&(Ov=Gi()),Ov}var n,r=go();return 0!==r?r:void 0===(n=window.event)?po:zo(n.type)}function Lv(e,t,n,r){!function(){if(_v>yv)throw _v=0,bv=null,new Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");Rv>Tv&&(Rv=0,Cv=null,a("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render."))}(),Av&&a("useInsertionEffect must not schedule updates."),Sv&&(wv=!0),eo(e,n,r),qg&Ug&&e===zg?function(e){if(je&&!fp)switch(e.tag){case 0:case u:case p:var t=Kg&&Ue(Kg)||"Unknown",n=t;vE.has(n)||(vE.add(n),a("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://reactjs.org/link/setstate-in-render",Ue(e)||"Unknown",t,t));break;case 1:EE||(a("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),EE=!0)}}(t):(xr&&ro(e,t,n),function(e){if(1&e.mode){if(!Ng())return}else{if(t="undefined"!=typeof IS_REACT_ACT_ENVIRONMENT?IS_REACT_ACT_ENVIRONMENT:void 0,"undefined"==typeof jest||!1===t)return;if(qg!==xg)return;if(0!==e.tag&&e.tag!==u&&e.tag!==p)return}var t;if(null===Mg.current){var n=$e;try{He(e),a("An update to %s inside a test was not wrapped in act(...).\n\nWhen testing, code that causes React state updates should be wrapped into act(...):\n\nact(() => {\n  /* fire events that update state */\n});\n/* assert on the output */\n\nThis ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act",Ue(e))}finally{n?He(e):Ge()}}}(t),e===zg&&((qg&Ug)===xg&&(tv=Xi(tv,n)),Qg===Gg&&Fv(e,Yg)),Dv(e,r),n!==ei||qg!==xg||1&t.mode||Mg.isBatchingLegacy||(lv(),Bu()))}function Dv(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;o>0;){var a=qi(o),s=1<<a,c=i[a];c===Pi?s&n&&!(s&r)||(i[a]=Ui(s,t)):c<=t&&(e.expiredLanes|=s),o&=~s}}(e,t);var r=xi(e,e===zg?Yg:0);if(0===r)return null!==n&&SE(n),e.callbackNode=null,void(e.callbackPriority=0);var i=Hi(r),o=e.callbackPriority;if(o!==i||null!==Mg.current&&n!==_E){var s,c;if(null!=n&&SE(n),i===ei)0===e.tag?(null!==Mg.isBatchingLegacy&&(Mg.didScheduleLegacyUpdate=!0),c=$v.bind(null,e),$u=!0,Vu(c)):Vu($v.bind(null,e)),null!==Mg.current?Mg.current.push(Gu):Fc(function(){(qg&(Ug|Fg))===xg&&Gu()}),s=null;else{var u;switch(yo(r)){case lo:u=Rr;break;case ho:u=Cr;break;case po:u=Ir;break;case fo:u=Ar;break;default:u=Ir}s=bE(u,Mv.bind(null,e))}e.callbackPriority=i,e.callbackNode=s}else null==n&&o!==ei&&a("Expected scheduled callback to exist. This error is likely caused by a bug in React. Please file an issue.")}function Mv(e,t){if(Fp=!1,$p=!1,Iv=Pi,Ov=0,(qg&(Ug|Fg))!==xg)throw new Error("Should not already be working.");var n=e.callbackNode;if(rE()&&e.callbackNode!==n)return null;var r=xi(e,e===zg?Yg:0);if(0===r)return null;var i=!Vi(0,r)&&!function(e,t){return!!(t&e.expiredLanes)}(e,r)&&!t,o=i?function(e,t){var n=qg;qg|=Ug;var r=zv();if(zg!==e||Yg!==t){if(xr){var i=e.memoizedUpdaters;i.size>0&&(yE(e,Yg),i.clear()),io(e,t)}uv=null,lv(),Wv(e,t)}for(qr(t);;)try{Zv();break}catch(t){qv(e,t)}return id(),Kv(r),qg=n,null!==Kg?(null!==Dr&&"function"==typeof Dr.markRenderYielded&&Dr.markRenderYielded(),$g):(zr(),zg=null,Yg=0,Qg)}(e,r):Jv(e,r);if(o!==$g){if(o===Vg){var a=Fi(e);0!==a&&(r=a,o=xv(e,a))}if(o===jg){var s=Zg;throw Wv(e,0),Fv(e,r),Dv(e,wr()),s}if(o===Wg)Fv(e,r);else{var c=!Vi(0,r),u=e.current.alternate;if(c&&!function(e){for(var t=e;;){if(t.flags&Jn){var n=t.updateQueue;if(null!==n){var r=n.stores;if(null!==r)for(var i=0;i<r.length;i++){var o=r[i],a=o.getSnapshot,s=o.value;try{if(!ns(a(),s))return!1}catch(e){return!1}}}}var c=t.child;if(t.subtreeFlags&Jn&&null!==c)c.return=t,t=c;else{if(t===e)return!0;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(u)){if((o=Jv(e,r))===Vg){var l=Fi(e);0!==l&&(r=l,o=xv(e,l))}if(o===jg){var d=Zg;throw Wv(e,0),Fv(e,r),Dv(e,wr()),d}}e.finishedWork=u,e.finishedLanes=r,function(e,t,n){switch(t){case $g:case jg:throw new Error("Root did not complete. This is a bug in React.");case Vg:nE(e,iv);break;case Bg:if(Fv(e,n),ji(n)&&!wE()){var r=ov+av-wr();if(r>10){if(0!==xi(e,0))break;var i=e.suspendedLanes;if(!Yi(i,n)){kv(),to(e,i);break}e.timeoutHandle=Mc(nE.bind(null,e,iv,uv),r);break}}nE(e,iv);break;case Gg:if(Fv(e,n),function(e){return(e&ai)===e}(n))break;if(!wE()){var o=function(e,t){for(var n=e.eventTimes,r=Pi;t>0;){var i=qi(t),o=n[i];o>r&&(r=o),t&=~(1<<i)}return r}(e,n),a=o,s=wr()-a,c=((u=s)<120?120:u<480?480:u<1080?1080:u<1920?1920:u<3e3?3e3:u<4320?4320:1960*kg(u/1960))-s;if(c>10){e.timeoutHandle=Mc(nE.bind(null,e,iv,uv),c);break}}nE(e,iv);break;case Hg:nE(e,iv);break;default:throw new Error("Unknown root exit status.")}var u}(e,o,r)}}return Dv(e,wr()),e.callbackNode===n?Mv.bind(null,e):null}function xv(e,t){var n=rv;_o(e)&&(Wv(e,t).flags|=Wn,a("An error occurred during hydration. The server HTML was replaced with client content in <%s>.",e.containerInfo.nodeName.toLowerCase()));var r=Jv(e,t);if(r!==Vg){var i=iv;iv=n,null!==i&&Uv(i)}return r}function Uv(e){null===iv?iv=e:iv.push.apply(iv,e)}function Fv(e,t){t=Ji(t,nv),function(e,t){e.suspendedLanes|=t,e.pingedLanes&=~t;for(var n=e.expirationTimes,r=t;r>0;){var i=qi(r),o=1<<i;n[i]=Pi,r&=~o}}(e,t=Ji(t,tv))}function $v(e){if(Fp=$p,$p=!1,(qg&(Ug|Fg))!==xg)throw new Error("Should not already be working.");rE();var t=xi(e,0);if(!Ki(t,ei))return Dv(e,wr()),null;var n=Jv(e,t);if(0!==e.tag&&n===Vg){var r=Fi(e);0!==r&&(t=r,n=xv(e,r))}if(n===jg){var i=Zg;throw Wv(e,0),Fv(e,t),Dv(e,wr()),i}if(n===Wg)throw new Error("Root did not complete. This is a bug in React.");return e.finishedWork=e.current.alternate,e.finishedLanes=t,nE(e,iv),Dv(e,wr()),null}function jv(e,t){var n=qg;qg|=1;try{return e(t)}finally{(qg=n)!==xg||Mg.isBatchingLegacy||(lv(),Bu())}}function Vv(e){null!==gv&&0===gv.tag&&(qg&(Ug|Fg))===xg&&rE();var t=qg;qg|=1;var n=Dg.transition,r=go();try{return Dg.transition=null,vo(lo),e?e():void 0}finally{vo(r),Dg.transition=n,((qg=t)&(Ug|Fg))===xg&&Gu()}}function Bv(){return(qg&(Ug|Fg))!==xg}function Gv(e,t){Su(Jg,Xg,e),Xg=Xi(Xg,t)}function Hv(e){Xg=Jg.current,bu(Jg,e)}function Wv(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,xc(n)),null!==Kg)for(var r=Kg.return;null!==r;)Cm(0,r),r=r.return;zg=e;var i=$E(e.current,null);return Kg=i,Yg=Xg=t,Qg=$g,Zg=null,ev=0,tv=0,nv=0,rv=null,iv=null,function(){if(null!==hd){for(var e=0;e<hd.length;e++){var t=hd[e],n=t.interleaved;if(null!==n){t.interleaved=null;var r=t.pending;if(null!==r){var i=r.next;r.next=n.next,n.next=i}t.pending=n}}hd=null}}(),Il.discardPendingWarnings(),i}function qv(e,t){for(;;){var n=Kg;try{if(id(),Rh(),Ge(),Lg.current=null,null===n||null===n.return)return Qg=jg,Zg=t,void(Kg=null);2&n.mode&&Wp(n,!0),Br(),null!==t&&"object"==typeof t&&"function"==typeof t.then?null!==Dr&&"function"==typeof Dr.markComponentSuspended&&Dr.markComponentSuspended(n,t,Yg):Wr(n,t,Yg),Of(e,n.return,n,t,Yg),tE(n)}catch(e){t=e,Kg===n&&null!==n?Kg=n=n.return:n=Kg;continue}return}}function zv(){var e=Pg.current;return Pg.current=wp,null===e?wp:e}function Kv(e){Pg.current=e}function Yv(e){ev=Xi(e,ev)}function Xv(){Qg!==$g&&Qg!==Bg&&Qg!==Vg||(Qg=Gg),null!==zg&&($i(ev)||$i(tv))&&Fv(zg,Yg)}function Jv(e,t){var n=qg;qg|=Ug;var r=zv();if(zg!==e||Yg!==t){if(xr){var i=e.memoizedUpdaters;i.size>0&&(yE(e,Yg),i.clear()),io(e,t)}uv=null,Wv(e,t)}for(qr(t);;)try{Qv();break}catch(t){qv(e,t)}if(id(),qg=n,Kv(r),null!==Kg)throw new Error("Cannot commit an incomplete root. This error is likely caused by a bug in React. Please file an issue.");return zr(),zg=null,Yg=0,Qg}function Qv(){for(;null!==Kg;)eE(Kg)}function Zv(){for(;null!==Kg&&!br();)eE(Kg)}function eE(e){var t,n=e.alternate;He(e),2&e.mode?(Gp(e),t=fE(n,e,Xg),Wp(e,!0)):t=fE(n,e,Xg),Ge(),e.memoizedProps=e.pendingProps,null===t?tE(e):Kg=t,Lg.current=null}function tE(e){var t=e;do{var n=t.alternate,r=t.return;if(t.flags&Qn){var i=Rm(0,t);if(null!==i)return i.flags&=32767,void(Kg=i);if(2&t.mode){Wp(t,!1);for(var o=t.actualDuration,a=t.child;null!==a;)o+=a.actualDuration,a=a.sibling;t.actualDuration=o}if(null===r)return Qg=Wg,void(Kg=null);r.flags|=Qn,r.subtreeFlags=0,r.deletions=null}else{He(t);var s=void 0;if(2&t.mode?(Gp(t),s=Tm(n,t,Xg),Wp(t,!1)):s=Tm(n,t,Xg),Ge(),null!==s)return void(Kg=s)}var c=t.sibling;if(null!==c)return void(Kg=c);Kg=t=r}while(null!==t);Qg===$g&&(Qg=Hg)}function nE(e,t,n){var r=go(),i=Dg.transition;try{Dg.transition=null,vo(lo),function(e,t,n,r){do{rE()}while(null!==gv);if(Il.flushLegacyContextWarning(),Il.flushPendingUnsafeLifecycleWarnings(),(qg&(Ug|Fg))!==xg)throw new Error("Should not already be working.");var i=e.finishedWork,o=e.finishedLanes;if(function(e){null!==Dr&&"function"==typeof Dr.markCommitStarted&&Dr.markCommitStarted(e)}(o),null===i)return jr(),null;if(0===o&&a("root.finishedLanes should not be empty during a commit. This is a bug in React."),e.finishedWork=null,e.finishedLanes=0,i===e.current)throw new Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");e.callbackNode=null,e.callbackPriority=0;var s,c,u,l,d,h,p,f=Xi(i.lanes,i.childLanes);if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t;for(var r=e.entanglements,i=e.eventTimes,o=e.expirationTimes,a=n;a>0;){var s=qi(a),c=1<<s;r[s]=0,i[s]=Pi,o[s]=Pi,a&=~c}}(e,f),e===zg&&(zg=null,Kg=null,Yg=0),(i.subtreeFlags&sr||i.flags&sr)&&(mv||(mv=!0,bE(Ir,function(){return rE(),null}))),15990&i.subtreeFlags||15990&i.flags){var m=Dg.transition;Dg.transition=null;var g=go();vo(lo);var v=qg;qg|=Fg,Lg.current=null,s=i,Pc=jo,c=ds(),Lc={focusedElem:c,selectionRange:hs(c)?(u=c,("selectionStart"in u?{start:u.selectionStart,end:u.selectionEnd}:(p=(h=(d=(l=u).ownerDocument)&&d.defaultView||window).getSelection&&h.getSelection())&&0!==p.rangeCount?function(e,t,n,r,i){var o=0,a=-1,s=-1,c=0,u=0,l=e,d=null;e:for(;;){for(var h=null;l!==t||0!==n&&3!==l.nodeType||(a=o+n),l!==r||0!==i&&3!==l.nodeType||(s=o+i),3===l.nodeType&&(o+=l.nodeValue.length),null!==(h=l.firstChild);)d=l,l=h;for(;;){if(l===e)break e;if(d===t&&++c===n&&(a=o),d===r&&++u===i&&(s=o),null!==(h=l.nextSibling))break;d=(l=d).parentNode}l=h}return-1===a||-1===s?null:{start:a,end:s}}(l,p.anchorNode,p.anchorOffset,p.focusNode,p.focusOffset):null)||{start:0,end:0}):null},Vo(!1),km=s,function(){for(;null!==km;){var e=km.child;1028&km.subtreeFlags&&null!==e?(e.return=km,km=e):jm()}}(),Bp(),function(e,t,n){Pm=n,Lm=e,He(t),sg(t,e),He(t),Pm=null,Lm=null}(e,i,o),function(e){var t,n,r,i,o=ds(),a=e.focusedElem,s=e.selectionRange;if(o!==a&&us(a)){null!==s&&hs(a)&&(r=(n=s).start,void 0===(i=n.end)&&(i=r),"selectionStart"in(t=a)?(t.selectionStart=r,t.selectionEnd=Math.min(i,t.value.length)):function(e,t){var n=e.ownerDocument||document,r=n&&n.defaultView||window;if(r.getSelection){var i=r.getSelection(),o=e.textContent.length,a=Math.min(t.start,o),s=void 0===t.end?a:Math.min(t.end,o);if(!i.extend&&a>s){var c=s;s=a,a=c}var u=as(e,a),l=as(e,s);if(u&&l){if(1===i.rangeCount&&i.anchorNode===u.node&&i.anchorOffset===u.offset&&i.focusNode===l.node&&i.focusOffset===l.offset)return;var d=n.createRange();d.setStart(u.node,u.offset),i.removeAllRanges(),a>s?(i.addRange(d),i.extend(l.node,l.offset)):(d.setEnd(l.node,l.offset),i.addRange(d))}}}(t,n));for(var c=[],u=a;u=u.parentNode;)1===u.nodeType&&c.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"==typeof a.focus&&a.focus();for(var l=0;l<c.length;l++){var d=c[l];d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}}(Lc),Vo(Pc),Pc=null,Lc=null,e.current=i,function(e){null!==Dr&&"function"==typeof Dr.markLayoutEffectsStarted&&Dr.markLayoutEffectsStarted(e)}(o),ug(i,e,o),null!==Dr&&"function"==typeof Dr.markLayoutEffectsStopped&&Dr.markLayoutEffectsStopped(),Sr(),qg=v,vo(g),Dg.transition=m}else e.current=i,Bp();var E=mv;if(mv?(mv=!1,gv=e,vv=o):(Rv=0,Cv=null),0===(f=e.pendingLanes)&&(fv=null),E||hE(e.current,!1),function(e,t){if(Lr&&"function"==typeof Lr.onCommitFiberRoot)try{var n,r=(e.current.flags&Hn)===Hn;switch(t){case lo:n=Rr;break;case ho:n=Cr;break;case po:n=Ir;break;case fo:n=Ar;break;default:n=Ir}Lr.onCommitFiberRoot(Pr,e,n,r)}catch(e){Mr||(Mr=!0,a("React instrumentation encountered an error: %s",e))}}(i.stateNode,r),xr&&e.memoizedUpdaters.clear(),Og.forEach(function(e){return e()}),Dv(e,wr()),null!==t)for(var y=e.onRecoverableError,_=0;_<t.length;_++){var b=t[_];y(b.value,{componentStack:b.stack,digest:b.digest})}if(hv){hv=!1;var S=pv;throw pv=null,S}Ki(vv,ei)&&0!==e.tag&&rE(),Ki(f=e.pendingLanes,ei)?($p=!0,e===bv?_v++:(_v=0,bv=e)):_v=0,Gu(),jr()}(e,t,0,r)}finally{Dg.transition=i,vo(r)}return null}function rE(){if(null!==gv){var e=yo(vv),t=function(e,t){return 0===e||e>t?e:t}(po,e),n=Dg.transition,r=go();try{return Dg.transition=null,vo(t),function(){if(null===gv)return!1;var e=gv,t=vv;if(gv=null,vv=0,(qg&(Ug|Fg))!==xg)throw new Error("Cannot flush passive effects while already rendering.");Sv=!0,wv=!1,function(e){null!==Dr&&"function"==typeof Dr.markPassiveEffectsStarted&&Dr.markPassiveEffectsStarted(e)}(t);var n,r=qg;qg|=Fg,km=e.current,function(){for(;null!==km;){var e=km,t=e.child;if(16&km.flags){var n=e.deletions;if(null!==n){for(var r=0;r<n.length;r++){var i=n[r];km=i,_g(i,e)}var o=e.alternate;if(null!==o){var a=o.child;if(null!==a){o.child=null;do{var s=a.sibling;a.sibling=null,a=s}while(null!==a)}}km=e}}e.subtreeFlags&sr&&null!==t?(t.return=e,km=t):Eg()}}(),km=n=e.current,function(e){for(;null!==km;){var t=km.child;km.subtreeFlags&sr&&null!==t?(t.return=km,km=t):gg(e)}}(n);var i=Ev;Ev=[];for(var o=0;o<i.length;o++)Hm(0,i[o]);null!==Dr&&"function"==typeof Dr.markPassiveEffectsStopped&&Dr.markPassiveEffectsStopped(),hE(e.current,!0),qg=r,Gu(),wv?e===Cv?Rv++:(Rv=0,Cv=e):Rv=0,Sv=!1,wv=!1,function(e){if(Lr&&"function"==typeof Lr.onPostCommitFiberRoot)try{Lr.onPostCommitFiberRoot(Pr,e)}catch(e){Mr||(Mr=!0,a("React instrumentation encountered an error: %s",e))}}(e);var s=e.current.stateNode;return s.effectDuration=0,s.passiveEffectDuration=0,!0}()}finally{vo(r),Dg.transition=n}}return!1}function iE(e){return null!==fv&&fv.has(e)}var oE=function(e){hv||(hv=!0,pv=e)};function aE(e,t,n){var r=Td(e,wf(e,yf(n,t),ei),ei),i=kv();null!==r&&(eo(r,ei,i),Dv(r,i))}function sE(e,t,n){if(function(e){Vn(null,function(){throw e}),Bn()}(n),TE(!1),3!==e.tag){var r=null;for(r=t;null!==r;){if(3===r.tag)return void aE(r,e,n);if(1===r.tag){var i=r.stateNode;if("function"==typeof r.type.getDerivedStateFromError||"function"==typeof i.componentDidCatch&&!iE(i)){var o=Td(r,Tf(r,yf(n,e),ei),ei),s=kv();return void(null!==o&&(eo(o,ei,s),Dv(o,s)))}}r=r.return}a("Internal React error: Attempted to capture a commit phase error inside a detached tree. This indicates a bug in React. Likely causes include deleting the same fiber more than once, committing an already-finished tree, or an inconsistent return pointer.\n\nError message:\n\n%s",n)}else aE(e,e,n)}function cE(e,t,n){var r=e.pingCache;null!==r&&r.delete(t);var i=kv();to(e,n),function(e){0!==e.tag&&Ng()&&null===Mg.current&&a("A suspended resource finished loading inside a test, but the event was not wrapped in act(...).\n\nWhen testing, code that resolves suspended data should be wrapped into act(...):\n\nact(() => {\n  /* finish loading suspended data */\n});\n/* assert on the output */\n\nThis ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act")}(e),zg===e&&Yi(Yg,n)&&(Qg===Gg||Qg===Bg&&ji(Yg)&&wr()-ov<av?Wv(e,0):nv=Xi(nv,n)),Dv(e,i)}function uE(e,t){var n;0===t&&(t=1&e.mode?(n=Di,(Di<<=1)&yi||(Di=_i),n):ei);var r=kv(),i=md(e,t);null!==i&&(eo(i,t,r),Dv(i,r))}function lE(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),uE(e,n)}function dE(e,t){var n,r=0;switch(e.tag){case d:n=e.stateNode;var i=e.memoizedState;null!==i&&(r=i.retryLane);break;case m:n=e.stateNode;break;default:throw new Error("Pinged unknown suspense boundary type. This is probably a bug in React.")}null!==n&&n.delete(t),uE(e,r)}function hE(e,t){He(e),pE(e,ir,Rg),t&&pE(e,or,Cg),pE(e,ir,wg),t&&pE(e,or,Tg),Ge()}function pE(e,t,n){for(var r=e,i=null;null!==r;)r!==i&&null!==r.child&&r.subtreeFlags&t?r=r.child:(r.flags&t&&n(r),r=null!==r.sibling?r.sibling:i=r.return)}var fE,mE=null;function gE(e){if((qg&Ug)===xg&&1&e.mode){var t=e.tag;if(2===t||3===t||1===t||0===t||t===u||t===h||t===p){var n=Ue(e)||"ReactComponent";if(null!==mE){if(mE.has(n))return;mE.add(n)}else mE=new Set([n]);var r=$e;try{He(e),a("Can't perform a React state update on a component that hasn't mounted yet. This indicates that you have a side-effect in your render function that asynchronously later calls tries to update the component. Move this work to useEffect instead.")}finally{r?He(e):Ge()}}}}fE=function(e,t,n){var r=zE(null,t);try{return ym(e,t,n)}catch(o){if(cl||null!==o&&"object"==typeof o&&"function"==typeof o.then)throw o;if(id(),Rh(),Cm(0,t),zE(t,r),2&t.mode&&Gp(t),Vn(null,ym,null,e,t,n),xn){var i=Bn();"object"==typeof i&&null!==i&&i._suppressLogging&&"object"==typeof o&&null!==o&&!o._suppressLogging&&(o._suppressLogging=!0)}throw o}};var vE,EE=!1;function yE(e,t){xr&&e.memoizedUpdaters.forEach(function(n){ro(e,n,t)})}vE=new Set;var _E={};function bE(e,t){var n=Mg.current;return null!==n?(n.push(t),_E):yr(e,t)}function SE(e){if(e!==_E)return _r(e)}function wE(){return null!==Mg.current}function TE(e){Av=e}var RE,CE=null,IE=null;function OE(e){if(null===CE)return e;var t=CE(e);return void 0===t?e:t.current}function AE(e){return OE(e)}function NE(e){if(null===CE)return e;var t=CE(e);if(void 0===t){if(null!=e&&"function"==typeof e.render){var n=OE(e.render);if(e.render!==n){var r={$$typeof:oe,render:n};return void 0!==e.displayName&&(r.displayName=e.displayName),r}}return e}return t.current}function kE(e,t){if(null===CE)return!1;var n=e.elementType,r=t.type,i=!1,o="object"==typeof r&&null!==r?r.$$typeof:null;switch(e.tag){case 1:"function"==typeof r&&(i=!0);break;case 0:("function"==typeof r||o===ue)&&(i=!0);break;case u:(o===oe||o===ue)&&(i=!0);break;case h:case p:(o===ce||o===ue)&&(i=!0);break;default:return!1}if(i){var a=CE(n);if(void 0!==a&&a===CE(r))return!0}return!1}function PE(e){null!==CE&&"function"==typeof WeakSet&&(null===IE&&(IE=new WeakSet),IE.add(e))}function LE(e,t,n){var r=e.alternate,i=e.child,o=e.sibling,a=e.tag,s=e.type,c=null;switch(a){case 0:case p:case 1:c=s;break;case u:c=s.render}if(null===CE)throw new Error("Expected resolveFamily to be set during hot reload.");var l=!1,d=!1;if(null!==c){var h=CE(c);void 0!==h&&(n.has(h)?d=!0:t.has(h)&&(1===a?d=!0:l=!0))}if(null!==IE&&(IE.has(e)||null!==r&&IE.has(r))&&(d=!0),d&&(e._debugNeedsRemount=!0),d||l){var f=md(e,ei);null!==f&&Lv(f,e,ei,Pi)}null===i||d||LE(i,t,n),null!==o&&LE(o,t,n)}function DE(e,t,n){var r=e.child,i=e.sibling,o=e.type,a=null;switch(e.tag){case 0:case p:case 1:a=o;break;case u:a=o.render}var s=!1;null!==a&&t.has(a)&&(s=!0),s?function(e,t){var n=function(e,t){for(var n=e,r=!1;;){if(5===n.tag)r=!0,t.add(n.stateNode);else if(null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)return r;for(;null===n.sibling;){if(null===n.return||n.return===e)return r;n=n.return}n.sibling.return=n.return,n=n.sibling}return!1}(e,t);if(!n)for(var r=e;;){switch(r.tag){case 5:return void t.add(r.stateNode);case 4:case 3:return void t.add(r.stateNode.containerInfo)}if(null===r.return)throw new Error("Expected to reach root first.");r=r.return}}(e,n):null!==r&&DE(r,t,n),null!==i&&DE(i,t,n)}RE=!1;try{var ME=Object.preventExtensions({});new Map([[ME,null]]),new Set([ME])}catch(e){RE=!0}function xE(e,t,n,r){this.tag=e,this.key=n,this.elementType=null,this.type=null,this.stateNode=null,this.return=null,this.child=null,this.sibling=null,this.index=0,this.ref=null,this.pendingProps=t,this.memoizedProps=null,this.updateQueue=null,this.memoizedState=null,this.dependencies=null,this.mode=r,this.flags=0,this.subtreeFlags=0,this.deletions=null,this.lanes=0,this.childLanes=0,this.alternate=null,this.actualDuration=Number.NaN,this.actualStartTime=Number.NaN,this.selfBaseDuration=Number.NaN,this.treeBaseDuration=Number.NaN,this.actualDuration=0,this.actualStartTime=-1,this.selfBaseDuration=0,this.treeBaseDuration=0,this._debugSource=null,this._debugOwner=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,RE||"function"!=typeof Object.preventExtensions||Object.preventExtensions(this)}var UE=function(e,t,n,r){return new xE(e,t,n,r)};function FE(e){var t=e.prototype;return!(!t||!t.isReactComponent)}function $E(e,t){var n=e.alternate;null===n?((n=UE(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n._debugSource=e._debugSource,n._debugOwner=e._debugOwner,n._debugHookTypes=e._debugHookTypes,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null,n.actualDuration=0,n.actualStartTime=-1),n.flags=e.flags&cr,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue;var r=e.dependencies;switch(n.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.selfBaseDuration=e.selfBaseDuration,n.treeBaseDuration=e.treeBaseDuration,n._debugNeedsRemount=e._debugNeedsRemount,n.tag){case 2:case 0:case p:n.type=OE(e.type);break;case 1:n.type=AE(e.type);break;case u:n.type=NE(e.type)}return n}function jE(e,t){e.flags&=14680066;var n=e.alternate;if(null===n)e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null,e.selfBaseDuration=0,e.treeBaseDuration=0;else{e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type;var r=n.dependencies;e.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext},e.selfBaseDuration=n.selfBaseDuration,e.treeBaseDuration=n.treeBaseDuration}return e}function VE(e,t,n,r,i,o){var s=2,p=e;if("function"==typeof e)FE(e)?(s=1,p=AE(p)):p=OE(p);else if("string"==typeof e)s=5;else e:switch(e){case ee:return GE(n.children,i,o,t);case te:s=8,1&(i|=8)&&(i|=Yr);break;case ne:return function(e,t,n,r){"string"!=typeof e.id&&a('Profiler must specify an "id" of type `string` as a prop. Received the type `%s` instead.',typeof e.id);var i=UE(l,e,r,2|t);return i.elementType=ne,i.lanes=n,i.stateNode={effectDuration:0,passiveEffectDuration:0},i}(n,i,o,t);case ae:return function(e,t,n,r){var i=UE(d,e,r,t);return i.elementType=ae,i.lanes=n,i}(n,i,o,t);case se:return function(e,t,n,r){var i=UE(m,e,r,t);return i.elementType=se,i.lanes=n,i}(n,i,o,t);case le:return HE(n,i,o,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case re:s=c;break e;case ie:s=9;break e;case oe:s=u,p=NE(p);break e;case ce:s=h;break e;case ue:s=16,p=null;break e}var f="";(void 0===e||"object"==typeof e&&null!==e&&0===Object.keys(e).length)&&(f+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var g=r?Ue(r):null;throw g&&(f+="\n\nCheck the render method of `"+g+"`."),new Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: "+(null==e?e:typeof e)+"."+f)}var v=UE(s,n,t,i);return v.elementType=e,v.type=p,v.lanes=o,v._debugOwner=r,v}function BE(e,t,n){var r=VE(e.type,e.key,e.props,e._owner,t,n);return r._debugSource=e._source,r._debugOwner=e._owner,r}function GE(e,t,n,r){var i=UE(7,e,r,t);return i.lanes=n,i}function HE(e,t,n,r){var i=UE(v,e,r,t);return i.elementType=le,i.lanes=n,i.stateNode={isHidden:!1},i}function WE(e,t,n){var r=UE(6,e,null,t);return r.lanes=n,r}function qE(e,t,n){var r=UE(4,null!==e.children?e.children:[],e.key,t);return r.lanes=n,r.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},r}function zE(e,t){return null===e&&(e=UE(2,null,null,0)),e.tag=t.tag,e.key=t.key,e.elementType=t.elementType,e.type=t.type,e.stateNode=t.stateNode,e.return=t.return,e.child=t.child,e.sibling=t.sibling,e.index=t.index,e.ref=t.ref,e.pendingProps=t.pendingProps,e.memoizedProps=t.memoizedProps,e.updateQueue=t.updateQueue,e.memoizedState=t.memoizedState,e.dependencies=t.dependencies,e.mode=t.mode,e.flags=t.flags,e.subtreeFlags=t.subtreeFlags,e.deletions=t.deletions,e.lanes=t.lanes,e.childLanes=t.childLanes,e.alternate=t.alternate,e.actualDuration=t.actualDuration,e.actualStartTime=t.actualStartTime,e.selfBaseDuration=t.selfBaseDuration,e.treeBaseDuration=t.treeBaseDuration,e._debugSource=t._debugSource,e._debugOwner=t._debugOwner,e._debugNeedsRemount=t._debugNeedsRemount,e._debugHookTypes=t._debugHookTypes,e}function KE(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.pendingChildren=null,this.current=null,this.pingCache=null,this.finishedWork=null,this.timeoutHandle=-1,this.context=null,this.pendingContext=null,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Zi(0),this.expirationTimes=Zi(Pi),this.pendingLanes=0,this.suspendedLanes=0,this.pingedLanes=0,this.expiredLanes=0,this.mutableReadLanes=0,this.finishedLanes=0,this.entangledLanes=0,this.entanglements=Zi(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null,this.effectDuration=0,this.passiveEffectDuration=0,this.memoizedUpdaters=new Set;for(var o=this.pendingUpdatersLaneMap=[],a=0;a<Zr;a++)o.push(new Set);switch(t){case 1:this._debugRootType=n?"hydrateRoot()":"createRoot()";break;case 0:this._debugRootType=n?"hydrate()":"render()"}}function YE(e,t,n,r,i,o,a,s,c,u){var l=new KE(e,t,n,s,c),d=function(e,t){var n;return 1===e?(n=1,!0===t&&(n|=8,n|=Yr)):n=0,xr&&(n|=2),UE(3,null,null,n)}(t,o);return l.current=d,d.stateNode=l,d.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},bd(d),l}var XE,JE,QE="18.3.1";function ZE(e){if(!e)return wu;var t=Gn(e),n=function(e){if(!function(e){return lr(e)===e}(e)||1!==e.tag)throw new Error("Expected subtree parent to be a mounted class component. This error is likely caused by a bug in React. Please file an issue.");var t=e;do{switch(t.tag){case 3:return t.stateNode.context;case 1:if(ku(t.type))return t.stateNode.__reactInternalMemoizedMergedChildContext}t=t.return}while(null!==t);throw new Error("Found unexpected detached subtree parent. This error is likely caused by a bug in React. Please file an issue.")}(t);if(1===t.tag){var r=t.type;if(ku(r))return Mu(t,r,n)}return n}function ey(e,t,n,r,i,o,a,s){return YE(e,t,!1,null,0,r,0,o,a)}function ty(e,t,n,r,i,o,a,s,c,u){var l=YE(n,r,!0,e,0,o,0,s,c);l.context=ZE(null);var d=l.current,h=kv(),p=Pv(d),f=wd(h,p);return f.callback=null!=t?t:null,Td(d,f,p),function(e,t,n){e.current.lanes=t,eo(e,t,n),Dv(e,n)}(l,p,h),l}function ny(e,t,n,r){!function(e,t){if(Lr&&"function"==typeof Lr.onScheduleFiberRoot)try{Lr.onScheduleFiberRoot(Pr,e,t)}catch(e){Mr||(Mr=!0,a("React instrumentation encountered an error: %s",e))}}(t,e);var i=t.current,o=kv(),s=Pv(i);!function(e){null!==Dr&&"function"==typeof Dr.markRenderScheduled&&Dr.markRenderScheduled(e)}(s);var c=ZE(n);null===t.context?t.context=c:t.pendingContext=c,je&&null!==$e&&!XE&&(XE=!0,a("Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.\n\nCheck the render method of %s.",Ue($e)||"Unknown"));var u=wd(o,s);u.payload={element:e},null!==(r=void 0===r?null:r)&&("function"!=typeof r&&a("render(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",r),u.callback=r);var l=Td(i,u,s);return null!==l&&(Lv(l,i,s,o),Rd(l,i,s)),s}function ry(e){var t=e.current;return t.child?t.child.stateNode:null}function iy(e,t){var n=e.memoizedState;null!==n&&null!==n.dehydrated&&(n.retryLane=function(e,t){return 0!==e&&e<t?e:t}(n.retryLane,t))}function oy(e,t){iy(e,t);var n=e.alternate;n&&iy(n,t)}function ay(e){var t=vr(e);return null===t?null:t.stateNode}XE=!1,JE={};var sy,cy,uy,ly,dy,hy,py,fy,my,gy=function(e){return null},vy=function(e){return!1},Ey=function(e,t,n){var r=t[n],i=Et(e)?e.slice():_e({},e);return n+1===t.length?(Et(i)?i.splice(r,1):delete i[r],i):(i[r]=Ey(e[r],t,n+1),i)},yy=function(e,t){return Ey(e,t,0)},_y=function(e,t,n,r){var i=t[r],o=Et(e)?e.slice():_e({},e);return r+1===t.length?(o[n[r]]=o[i],Et(o)?o.splice(i,1):delete o[i]):o[i]=_y(e[i],t,n,r+1),o},by=function(e,t,n){if(t.length===n.length){for(var r=0;r<n.length-1;r++)if(t[r]!==n[r])return void o("copyWithRename() expects paths to be the same except for the deepest key");return _y(e,t,n,0)}o("copyWithRename() expects paths of the same length")},Sy=function(e,t,n,r){if(n>=t.length)return r;var i=t[n],o=Et(e)?e.slice():_e({},e);return o[i]=Sy(e[i],t,n+1,r),o},wy=function(e,t,n){return Sy(e,t,0,n)},Ty=function(e,t){for(var n=e.memoizedState;null!==n&&t>0;)n=n.next,t--;return n};sy=function(e,t,n,r){var i=Ty(e,t);if(null!==i){var o=wy(i.memoizedState,n,r);i.memoizedState=o,i.baseState=o,e.memoizedProps=_e({},e.memoizedProps);var a=md(e,ei);null!==a&&Lv(a,e,ei,Pi)}},cy=function(e,t,n){var r=Ty(e,t);if(null!==r){var i=yy(r.memoizedState,n);r.memoizedState=i,r.baseState=i,e.memoizedProps=_e({},e.memoizedProps);var o=md(e,ei);null!==o&&Lv(o,e,ei,Pi)}},uy=function(e,t,n,r){var i=Ty(e,t);if(null!==i){var o=by(i.memoizedState,n,r);i.memoizedState=o,i.baseState=o,e.memoizedProps=_e({},e.memoizedProps);var a=md(e,ei);null!==a&&Lv(a,e,ei,Pi)}},ly=function(e,t,n){e.pendingProps=wy(e.memoizedProps,t,n),e.alternate&&(e.alternate.pendingProps=e.pendingProps);var r=md(e,ei);null!==r&&Lv(r,e,ei,Pi)},dy=function(e,t){e.pendingProps=yy(e.memoizedProps,t),e.alternate&&(e.alternate.pendingProps=e.pendingProps);var n=md(e,ei);null!==n&&Lv(n,e,ei,Pi)},hy=function(e,t,n){e.pendingProps=by(e.memoizedProps,t,n),e.alternate&&(e.alternate.pendingProps=e.pendingProps);var r=md(e,ei);null!==r&&Lv(r,e,ei,Pi)},py=function(e){var t=md(e,ei);null!==t&&Lv(t,e,ei,Pi)},fy=function(e){gy=e},my=function(e){vy=e};var Ry="function"==typeof reportError?reportError:function(e){console.error(e)};function Cy(e){this._internalRoot=e}function Iy(e){this._internalRoot=e}function Oy(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Ay(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Ny(e){1===e.nodeType&&e.tagName&&"BODY"===e.tagName.toUpperCase()&&a("createRoot(): Creating roots directly with document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try using a container element created for your app."),au(e)&&a(e._reactRootContainer?"You are calling ReactDOMClient.createRoot() on a container that was previously passed to ReactDOM.render(). This is not supported.":"You are calling ReactDOMClient.createRoot() on a container that has already been passed to createRoot() before. Instead, call root.render() on the existing root instead if you want to update it.")}Iy.prototype.render=Cy.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw new Error("Cannot update an unmounted root.");"function"==typeof arguments[1]?a("render(...): does not support the second callback argument. To execute a side effect after rendering, declare it in a component body with useEffect()."):Oy(arguments[1])?a("You passed a container to the second argument of root.render(...). You don't need to pass it again since you already passed it to create the root."):void 0!==arguments[1]&&a("You passed a second argument to root.render(...) but it only accepts one argument.");var n=t.containerInfo;if(8!==n.nodeType){var r=ay(t.current);r&&r.parentNode!==n&&a("render(...): It looks like the React-rendered content of the root container was removed without using React. This is not supported and will cause errors. Instead, call root.unmount() to empty a root's container.")}ny(e,t,null,null)},Iy.prototype.unmount=Cy.prototype.unmount=function(){"function"==typeof arguments[0]&&a("unmount(...): does not support a callback argument. To execute a side effect after rendering, declare it in a component body with useEffect().");var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;Bv()&&a("Attempted to synchronously unmount a root while React was already rendering. React cannot finish unmounting the root until the current render has completed, which may lead to a race condition."),Vv(function(){ny(null,e,null,null)}),ou(t)}},Iy.prototype.unstable_scheduleHydration=function(e){e&&function(e){for(var t=co(),n={blockedOn:null,target:e,priority:t},r=0;r<Ao.length&&Eo(t,Ao[r].priority);r++);Ao.splice(r,0,n),0===r&&Lo(n)}(e)};var ky,Py=r.ReactCurrentOwner;function Ly(e){return e?9===e.nodeType?e.documentElement:e.firstChild:null}function Dy(){}function My(e,t,n,r,i){ky(n),function(e){null!==e&&"function"!=typeof e&&a("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.","render",e)}(void 0===i?null:i);var o,s=n._reactRootContainer;if(s){if("function"==typeof i){var c=i;i=function(){var e=ry(o);c.call(e)}}ny(t,o=s,e,i)}else o=function(e,t,n,r,i){if(i){if("function"==typeof r){var o=r;r=function(){var e=ry(a);o.call(e)}}var a=ty(t,r,e,0,0,!1,0,"",Dy);return e._reactRootContainer=a,iu(a.current,e),$s(8===e.nodeType?e.parentNode:e),Vv(),a}for(var s;s=e.lastChild;)e.removeChild(s);if("function"==typeof r){var c=r;r=function(){var e=ry(u);c.call(e)}}var u=ey(e,0,0,!1,0,"",Dy);return e._reactRootContainer=u,iu(u.current,e),$s(8===e.nodeType?e.parentNode:e),Vv(function(){ny(t,u,n,r)}),u}(n,t,e,i,r);return ry(o)}ky=function(e){if(e._reactRootContainer&&8!==e.nodeType){var t=ay(e._reactRootContainer.current);t&&t.parentNode!==e&&a("render(...): It looks like the React-rendered content of this container was removed without using React. This is not supported and will cause errors. Instead, call ReactDOM.unmountComponentAtNode to empty a container.")}var n=!!e._reactRootContainer,r=Ly(e);!(!r||!cu(r))&&!n&&a("render(...): Replacing React-rendered children with a new root component. If you intended to update the children of this node, you should instead have the existing children update their state and render the new components instead of calling ReactDOM.render."),1===e.nodeType&&e.tagName&&"BODY"===e.tagName.toUpperCase()&&a("render(): Rendering components directly into document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try rendering into a container element created for your app.")};var xy=!1,Uy=!1;oo=function(e){switch(e.tag){case 3:var t=e.stateNode;if(_o(t)){var n=function(e){return Mi(e.pendingLanes)}(t);!function(e,t){0!==t&&(no(e,Xi(t,ei)),Dv(e,wr()),(qg&(Ug|Fg))===xg&&(lv(),Gu()))}(t,n)}break;case d:Vv(function(){var t=md(e,ei);if(null!==t){var n=kv();Lv(t,e,ei,n)}}),oy(e,ei)}},ao=function(e){if(e.tag===d){var t=Ci,n=md(e,t);null!==n&&Lv(n,e,t,kv()),oy(e,t)}},so=function(e){if(e.tag===d){var t=Pv(e),n=md(e,t);null!==n&&Lv(n,e,t,kv()),oy(e,t)}},function(e){co=e}(go),uo=function(e,t){var n=mo;try{return mo=e,t()}finally{mo=n}},"function"==typeof Map&&null!=Map.prototype&&"function"==typeof Map.prototype.forEach&&"function"==typeof Set&&null!=Set.prototype&&"function"==typeof Set.prototype.clear&&"function"==typeof Set.prototype.forEach||a("React depends on Map and Set built-in types. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),yn=function(e,t,n){switch(t){case"input":return void function(e,t){var n=e;ut(n,t),function(e,t){var n=t.name;if("radio"===t.type&&null!=n){for(var r=e;r.parentNode;)r=r.parentNode;N(n,"name");for(var i=r.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),o=0;o<i.length;o++){var a=i[o];if(a!==e&&a.form===e.form){var s=lu(a);if(!s)throw new Error("ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported.");Ze(a),ut(a,s)}}}}(n,t)}(e,n);case"textarea":return void function(e,t){It(e,t)}(e,n);case"select":return void function(e,t){var n=t.value;null!=n&&bt(e,!!t.multiple,n,!1)}(e,n)}},Rn=jv,Cn=Vv;var Fy,$y={usingClientEntryPoint:!1,Events:[cu,uu,lu,wn,Tn,jv]};if(!function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled)return!0;if(!t.supportsFiber)return a("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://reactjs.org/link/react-devtools"),!0;try{e=_e({},e,{getLaneLabelMap:$r,injectProfilingHooks:Fr}),Pr=t.inject(e),Lr=t}catch(e){a("React instrumentation encountered an error: %s.",e)}return!!t.checkDCE}({bundleType:(Fy={findFiberByHostInstance:su,bundleType:1,version:QE,rendererPackageName:"react-dom"}).bundleType,version:Fy.version,rendererPackageName:Fy.rendererPackageName,rendererConfig:Fy.rendererConfig,overrideHookState:sy,overrideHookStateDeletePath:cy,overrideHookStateRenamePath:uy,overrideProps:ly,overridePropsDeletePath:dy,overridePropsRenamePath:hy,setErrorHandler:fy,setSuspenseHandler:my,scheduleUpdate:py,currentDispatcherRef:r.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){var t=mr(e);return null===t?null:t.stateNode},findFiberByHostInstance:Fy.findFiberByHostInstance||function(e){return null},findHostInstancesForRefresh:function(e,t){var n=new Set,r=new Set(t.map(function(e){return e.current}));return DE(e.current,r,n),n},scheduleRefresh:function(e,t){if(null!==CE){var n=t.staleFamilies,r=t.updatedFamilies;rE(),Vv(function(){LE(e.current,r,n)})}},scheduleRoot:function(e,t){e.context===wu&&(rE(),Vv(function(){ny(t,e,null,null)}))},setRefreshHandler:function(e){CE=e},getCurrentFiber:function(){return $e},reconcilerVersion:QE})&&R&&window.top===window.self&&(navigator.userAgent.indexOf("Chrome")>-1&&-1===navigator.userAgent.indexOf("Edge")||navigator.userAgent.indexOf("Firefox")>-1)){var jy=window.location.protocol;/^(https?|file):$/.test(jy)&&console.info("%cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools"+("file:"===jy?"\nYou might need to use a local HTTP server (instead of file://): https://reactjs.org/link/react-devtools-faq":""),"font-weight:bold")}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$y,t.createPortal=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Oy(t))throw new Error("Target container is not a DOM element.");return function(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return O(r=i)&&(a("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",I(r)),A(r)),{$$typeof:Z,key:null==i?null:""+i,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){return $y.usingClientEntryPoint||a('You are importing createRoot from "react-dom" which is not supported. You should instead import it from "react-dom/client".'),function(e,t){if(!Oy(e))throw new Error("createRoot(...): Target container is not a DOM element.");Ny(e);var n=!1,r="",i=Ry;null!=t&&(t.hydrate?o("hydrate through createRoot is deprecated. Use ReactDOMClient.hydrateRoot(container, <App />) instead."):"object"==typeof t&&null!==t&&t.$$typeof===Q&&a("You passed a JSX element to createRoot. You probably meant to call root.render instead. Example usage:\n\n  let root = createRoot(domContainer);\n  root.render(<App />);"),!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError));var s=ey(e,1,0,n,0,r,i);return iu(s.current,e),$s(8===e.nodeType?e.parentNode:e),new Cy(s)}(e,t)},t.findDOMNode=function(e){xy||(xy=!0,a("findDOMNode is deprecated and will be removed in the next major release. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node"));var t=Py.current;return null!==t&&null!==t.stateNode&&(t.stateNode._warnedAboutRefsInRender||a("%s is accessing findDOMNode inside its render(). render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",Me(t.type)||"A component"),t.stateNode._warnedAboutRefsInRender=!0),null==e?null:1===e.nodeType?e:function(e,t){var n=Gn(e);if(void 0===n){if("function"==typeof e.render)throw new Error("Unable to find node on an unmounted component.");var r=Object.keys(e).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+r)}var i=mr(n);if(null===i)return null;if(8&i.mode){var o=Ue(n)||"Component";if(!JE[o]){JE[o]=!0;var s=$e;try{He(i),a(8&n.mode?"%s is deprecated in StrictMode. %s was passed an instance of %s which is inside StrictMode. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node":"%s is deprecated in StrictMode. %s was passed an instance of %s which renders StrictMode children. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",t,t,o)}finally{s?He(s):Ge()}}}return i.stateNode}(e,"findDOMNode")},t.flushSync=function(e){return Bv()&&a("flushSync was called from inside a lifecycle method. React cannot flush when React is already rendering. Consider moving this call to a scheduler task or micro task."),Vv(e)},t.hydrate=function(e,t,n){if(a("ReactDOM.hydrate is no longer supported in React 18. Use hydrateRoot instead. Until you switch to the new API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!Ay(t))throw new Error("Target container is not a DOM element.");return au(t)&&void 0===t._reactRootContainer&&a("You are calling ReactDOM.hydrate() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call hydrateRoot(container, element)?"),My(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){return $y.usingClientEntryPoint||a('You are importing hydrateRoot from "react-dom" which is not supported. You should instead import it from "react-dom/client".'),function(e,t,n){if(!Oy(e))throw new Error("hydrateRoot(...): Target container is not a DOM element.");Ny(e),void 0===t&&a("Must provide initial children as second argument to hydrateRoot. Example usage: hydrateRoot(domContainer, <App />)");var r=null!=n&&n.hydratedSources||null,i=!1,o="",s=Ry;null!=n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError));var c=ty(t,null,e,1,0,i,0,o,s);if(iu(c.current,e),$s(e),r)for(var u=0;u<r.length;u++)eh(c,r[u]);return new Iy(c)}(e,t,n)},t.render=function(e,t,n){if(a("ReactDOM.render is no longer supported in React 18. Use createRoot instead. Until you switch to the new API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!Ay(t))throw new Error("Target container is not a DOM element.");return au(t)&&void 0===t._reactRootContainer&&a("You are calling ReactDOM.render() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call root.render(element)?"),My(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(Uy||(Uy=!0,a("unmountComponentAtNode is deprecated and will be removed in the next major release. Switch to the createRoot API. Learn more: https://reactjs.org/link/switch-to-createroot")),!Ay(e))throw new Error("unmountComponentAtNode(...): Target container is not a DOM element.");if(au(e)&&void 0===e._reactRootContainer&&a("You are calling ReactDOM.unmountComponentAtNode() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call root.unmount()?"),e._reactRootContainer){var t=Ly(e);return t&&!cu(t)&&a("unmountComponentAtNode(): The node you're attempting to unmount was rendered by another copy of React."),Vv(function(){My(null,null,e,!1,function(){e._reactRootContainer=null,ou(e)})}),!0}var n=Ly(e),r=!(!n||!cu(n)),i=1===e.nodeType&&Ay(e.parentNode)&&!!e.parentNode._reactRootContainer;return r&&a("unmountComponentAtNode(): The node you're attempting to unmount was rendered by React and is not a top-level container. %s",i?"You may have accidentally passed in a React root node instead of its container.":"Instead, have the parent component update its state and rerender in order to remove this component."),!1},t.unstable_batchedUpdates=jv,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){return function(e,t,n,r){if(a("ReactDOM.unstable_renderSubtreeIntoContainer() is no longer supported in React 18. Consider using a portal instead. Until you switch to the createRoot API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!Ay(n))throw new Error("Target container is not a DOM element.");if(null==e||void 0===e._reactInternals)throw new Error("parentComponent must be a valid React Component");return My(e,t,n,!1,r)}(e,t,n,r)},t.version=QE,"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()}),reactDom=createCommonjsModule(function(e){"production"===process.env.NODE_ENV?(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE){if("production"!==process.env.NODE_ENV)throw new Error("^_^");try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}}(),e.exports=reactDom_production_min):e.exports=reactDom_development}),client=createCommonjsModule(function(e,t){if("production"===process.env.NODE_ENV)t.createRoot=reactDom.createRoot,t.hydrateRoot=reactDom.hydrateRoot;else{var n=reactDom.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;t.createRoot=function(e,t){n.usingClientEntryPoint=!0;try{return reactDom.createRoot(e,t)}finally{n.usingClientEntryPoint=!1}},t.hydrateRoot=function(e,t,r){n.usingClientEntryPoint=!0;try{return reactDom.hydrateRoot(e,t,r)}finally{n.usingClientEntryPoint=!1}}}});function e(e,t){return t.forEach(function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(e)}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var n=function(e){try{return!!e()}catch(e){return!0}},r=!n(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),o=r,s=Function.prototype,a=s.call,c=o&&s.bind.bind(a,a),d=o?c:function(e){return function(){return a.apply(e,arguments)}},l=d({}.isPrototypeOf),u=function(e){return e&&e.Math==Math&&e},h$1=u("object"==typeof globalThis&&globalThis)||u("object"==typeof window&&window)||u("object"==typeof self&&self)||u("object"==typeof t&&t)||function(){return this}()||t||Function("return this")(),p=r,_=Function.prototype,E=_.apply,f=_.call,m="object"==typeof Reflect&&Reflect.apply||(p?f.bind(E):function(){return f.apply(E,arguments)}),T=d,S=T({}.toString),g=T("".slice),R=function(e){return g(S(e),8,-1)},C=R,I=d,v=function(e){if("Function"===C(e))return I(e)},y="object"==typeof document&&document.all,A={all:y,IS_HTMLDDA:void 0===y&&void 0!==y},b=A.all,w=A.IS_HTMLDDA?function(e){return"function"==typeof e||e===b}:function(e){return"function"==typeof e},O={},N=!n(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),D=r,P=Function.prototype.call,L=D?P.bind(P):function(){return P.apply(P,arguments)},k={},M={}.propertyIsEnumerable,U=Object.getOwnPropertyDescriptor,x=U&&!M.call({1:2},1);k.f=x?function(e){var t=U(this,e);return!!t&&t.enumerable}:M;var V,F,B=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},j=n,G=R,W=Object,H=d("".split),K=j(function(){return!W("z").propertyIsEnumerable(0)})?function(e){return"String"==G(e)?H(e,""):W(e)}:W,Y=function(e){return null==e},q=Y,z=TypeError,J=function(e){if(q(e))throw z("Can't call method on "+e);return e},X=K,Q=J,Z=function(e){return X(Q(e))},$=w,ee=A.all,te=A.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:$(e)||e===ee}:function(e){return"object"==typeof e?null!==e:$(e)},ie={},ne=ie,re=h$1,oe=w,se=function(e){return oe(e)?e:void 0},ae=function(e,t){return arguments.length<2?se(ne[e])||se(re[e]):ne[e]&&ne[e][t]||re[e]&&re[e][t]},ce="undefined"!=typeof navigator&&String(navigator.userAgent)||"",de=h$1,le=ce,ue=de.process,he=de.Deno,pe=ue&&ue.versions||he&&he.version,_e=pe&&pe.v8;_e&&(F=(V=_e.split("."))[0]>0&&V[0]<4?1:+(V[0]+V[1])),!F&&le&&(!(V=le.match(/Edge\/(\d+)/))||V[1]>=74)&&(V=le.match(/Chrome\/(\d+)/))&&(F=+V[1]);var Ee=F,fe=Ee,me=n,Te=h$1.String,Se=!!Object.getOwnPropertySymbols&&!me(function(){var e=Symbol();return!Te(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&fe&&fe<41}),ge=Se&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Re=ae,Ce=w,Ie=l,ve=Object,ye=ge?function(e){return"symbol"==typeof e}:function(e){var t=Re("Symbol");return Ce(t)&&Ie(t.prototype,ve(e))},Ae=String,be=function(e){try{return Ae(e)}catch(e){return"Object"}},we=w,Oe=be,Ne=TypeError,De=function(e){if(we(e))return e;throw Ne(Oe(e)+" is not a function")},Pe=De,Le=Y,ke=function(e,t){var n=e[t];return Le(n)?void 0:Pe(n)},Me=L,Ue=w,xe=te,Ve=TypeError,Fe={exports:{}},Be=h$1,je=Object.defineProperty,Ge=function(e,t){try{je(Be,e,{value:t,configurable:!0,writable:!0})}catch(n){Be[e]=t}return t},We="__core-js_shared__",He=h$1[We]||Ge(We,{}),Ke=He;(Fe.exports=function(e,t){return Ke[e]||(Ke[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ye=Fe.exports,qe=J,ze=Object,Je=function(e){return ze(qe(e))},Xe=Je,Qe=d({}.hasOwnProperty),Ze=Object.hasOwn||function(e,t){return Qe(Xe(e),t)},$e=d,et=0,tt=Math.random(),it=$e(1..toString),nt=function(e){return"Symbol("+(void 0===e?"":e)+")_"+it(++et+tt,36)},rt=Ye,ot=Ze,st=nt,at=Se,ct=ge,dt=h$1.Symbol,lt=rt("wks"),ut=ct?dt.for||dt:dt&&dt.withoutSetter||st,ht=function(e){return ot(lt,e)||(lt[e]=at&&ot(dt,e)?dt[e]:ut("Symbol."+e)),lt[e]},pt=L,_t=te,Et=ye,ft=ke,mt=function(e,t){var n,r;if("string"===t&&Ue(n=e.toString)&&!xe(r=Me(n,e)))return r;if(Ue(n=e.valueOf)&&!xe(r=Me(n,e)))return r;if("string"!==t&&Ue(n=e.toString)&&!xe(r=Me(n,e)))return r;throw Ve("Can't convert object to primitive value")},Tt=TypeError,St=ht("toPrimitive"),gt=function(e,t){if(!_t(e)||Et(e))return e;var n,r=ft(e,St);if(r){if(void 0===t&&(t="default"),n=pt(r,e,t),!_t(n)||Et(n))return n;throw Tt("Can't convert object to primitive value")}return void 0===t&&(t="number"),mt(e,t)},Rt=ye,Ct=function(e){var t=gt(e,"string");return Rt(t)?t:t+""},It=te,vt=h$1.document,yt=It(vt)&&It(vt.createElement),At=function(e){return yt?vt.createElement(e):{}},bt=At,wt=!N&&!n(function(){return 7!=Object.defineProperty(bt("div"),"a",{get:function(){return 7}}).a}),Ot=N,Nt=L,Dt=k,Pt=B,Lt=Z,kt=Ct,Mt=Ze,Ut=wt,xt=Object.getOwnPropertyDescriptor;O.f=Ot?xt:function(e,t){if(e=Lt(e),t=kt(t),Ut)try{return xt(e,t)}catch(e){}if(Mt(e,t))return Pt(!Nt(Dt.f,e,t),e[t])};var Vt=n,Ft=w,Bt=/#|\.prototype\./,jt=function(e,t){var n=Wt[Gt(e)];return n==Kt||n!=Ht&&(Ft(t)?Vt(t):!!t)},Gt=jt.normalize=function(e){return String(e).replace(Bt,".").toLowerCase()},Wt=jt.data={},Ht=jt.NATIVE="N",Kt=jt.POLYFILL="P",Yt=jt,qt=De,zt=r,Jt=v(v.bind),Xt=function(e,t){return qt(e),void 0===t?e:zt?Jt(e,t):function(){return e.apply(t,arguments)}},Qt={},Zt=N&&n(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),$t=te,ei=String,ti=TypeError,ii=function(e){if($t(e))return e;throw ti(ei(e)+" is not an object")},ni=N,ri=wt,oi=Zt,si=ii,ai=Ct,ci=TypeError,di=Object.defineProperty,li=Object.getOwnPropertyDescriptor,ui="enumerable",hi="configurable",pi="writable";Qt.f=ni?oi?function(e,t,n){if(si(e),t=ai(t),si(n),"function"==typeof e&&"prototype"===t&&"value"in n&&pi in n&&!n[pi]){var r=li(e,t);r&&r[pi]&&(e[t]=n.value,n={configurable:hi in n?n[hi]:r[hi],enumerable:ui in n?n[ui]:r[ui],writable:!1})}return di(e,t,n)}:di:function(e,t,n){if(si(e),t=ai(t),si(n),ri)try{return di(e,t,n)}catch(e){}if("get"in n||"set"in n)throw ci("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var _i=Qt,Ei=B,fi=N?function(e,t,n){return _i.f(e,t,Ei(1,n))}:function(e,t,n){return e[t]=n,e},mi=h$1,Ti=m,Si=v,gi=w,Ri=O.f,Ci=Yt,Ii=ie,vi=Xt,yi=fi,Ai=Ze,bi=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return Ti(e,this,arguments)};return t.prototype=e.prototype,t},wi=function(e,t){var n,r,i,o,a,s,c,u,l,d=e.target,h=e.global,p=e.stat,f=e.proto,m=h?mi:p?mi[d]:(mi[d]||{}).prototype,g=h?Ii:Ii[d]||yi(Ii,d,{})[d],v=g.prototype;for(o in t)r=!(n=Ci(h?o:d+(p?".":"#")+o,e.forced))&&m&&Ai(m,o),s=g[o],r&&(c=e.dontCallGetSet?(l=Ri(m,o))&&l.value:m[o]),a=r&&c?c:t[o],r&&typeof s==typeof a||(u=e.bind&&r?vi(a,mi):e.wrap&&r?bi(a):f&&gi(a)?Si(a):a,(e.sham||a&&a.sham||s&&s.sham)&&yi(u,"sham",!0),yi(g,o,u),f&&(Ai(Ii,i=d+"Prototype")||yi(Ii,i,{}),yi(Ii[i],o,a),e.real&&v&&(n||!v[o])&&yi(v,o,a)))},Oi=Math.ceil,Ni=Math.floor,Di=Math.trunc||function(e){var t=+e;return(t>0?Ni:Oi)(t)},Pi=Di,Li=function(e){var t=+e;return t!=t||0===t?0:Pi(t)},ki=Li,Mi=Math.max,Ui=Math.min,xi=function(e,t){var n=ki(e);return n<0?Mi(n+t,0):Ui(n,t)},Vi=Li,Fi=Math.min,Bi=function(e){return e>0?Fi(Vi(e),9007199254740991):0},ji=Bi,Gi=function(e){return ji(e.length)},Wi=Z,Hi=xi,Ki=Gi,Yi=function(e){return function(t,n,r){var i,o=Wi(t),a=Ki(o),s=Hi(r,a);if(e&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},qi={includes:Yi(!0),indexOf:Yi(!1)},zi=qi.includes;wi({target:"Array",proto:!0,forced:n(function(){return!Array(1).includes()})},{includes:function(e){return zi(this,e,arguments.length>1?arguments[1]:void 0)}});var Ji=ie,Xi=function(e){return Ji[e+"Prototype"]},Qi=Xi("Array").includes,Zi=te,$i=R,en=ht("match"),tn=function(e){var t;return Zi(e)&&(void 0!==(t=e[en])?!!t:"RegExp"==$i(e))},nn=tn,rn=TypeError,on={};on[ht("toStringTag")]="z";var sn="[object z]"===String(on),an=sn,cn=w,dn=R,ln=ht("toStringTag"),un=Object,hn="Arguments"==dn(function(){return arguments}()),pn=an?dn:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=un(e),ln))?n:hn?dn(t):"Object"==(r=dn(t))&&cn(t.callee)?"Arguments":r},_n=pn,En=String,fn=function(e){if("Symbol"===_n(e))throw TypeError("Cannot convert a Symbol value to a string");return En(e)},mn=ht("match"),Tn=wi,Sn=function(e){if(nn(e))throw rn("The method doesn't accept regular expressions");return e},gn=J,Rn=fn,Cn=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[mn]=!1,"/./"[e](t)}catch(e){}}return!1},In=d("".indexOf);Tn({target:"String",proto:!0,forced:!Cn("includes")},{includes:function(e){return!!~In(Rn(gn(this)),Rn(Sn(e)),arguments.length>1?arguments[1]:void 0)}});var vn=Xi("String").includes,yn=l,An=Qi,bn=vn,wn=Array.prototype,On=String.prototype,Nn=function(e){var t=e.includes;return e===wn||yn(wn,e)&&t===wn.includes?An:"string"==typeof e||e===On||yn(On,e)&&t===On.includes?bn:t},Dn=i(Nn),Pn=De,Ln=Je,kn=K,Mn=Gi,Un=TypeError,xn=function(e){return function(t,n,r,i){Pn(n);var o=Ln(t),a=kn(o),s=Mn(o),c=e?s-1:0,u=e?-1:1;if(r<2)for(;;){if(c in a){i=a[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw Un("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in a&&(i=n(i,a[c],c,o));return i}},Vn={left:xn(!1),right:xn(!0)},Fn=n,Bn=function(e,t){var n=[][e];return!!n&&Fn(function(){n.call(null,t||function(){return 1},1)})},jn="undefined"!=typeof process&&"process"==R(process),Gn=Vn.left;wi({target:"Array",proto:!0,forced:!jn&&Ee>79&&Ee<83||!Bn("reduce")},{reduce:function(e){var t=arguments.length;return Gn(this,e,t,t>1?arguments[1]:void 0)}});var Wn=Xi("Array").reduce,Hn=l,Kn=Wn,Yn=Array.prototype,qn=function(e){var t=e.reduce;return e===Yn||Hn(Yn,e)&&t===Yn.reduce?Kn:t},zn=qn,Jn=i(zn);let Xn=!0,Qn=!0;function Zn(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function $n(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function er(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Xn=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function tr(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Qn=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function ir(){if("object"==typeof window){if(Xn)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function nr(e,t){Qn&&console.warn(e+" is deprecated, please use "+t+" instead.")}function rr(e){return"[object Object]"===Object.prototype.toString.call(e)}function or(e){var t;return rr(e)?Jn(t=Object.keys(e)).call(t,function(t,n){const r=rr(e[n]),i=r?or(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})},{}):e}function sr(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach(r=>{r.endsWith("Id")?sr(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach(t=>{sr(e,e.get(t),n)})}))}function ar(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach(e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(t=>{e.forEach(n=>{n.type===r&&n.trackId===t.id&&sr(e,n,i)})}),i}var cr=nt,dr=Ye("keys"),lr=function(e){return dr[e]||(dr[e]=cr(e))},ur=!n(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),hr=Ze,pr=w,_r=Je,Er=ur,fr=lr("IE_PROTO"),mr=Object,Tr=mr.prototype,Sr=Er?mr.getPrototypeOf:function(e){var t=_r(e);if(hr(t,fr))return t[fr];var n=t.constructor;return pr(n)&&t instanceof n?n.prototype:t instanceof mr?Tr:null},gr=d,Rr=De,Cr=w,Ir=String,vr=TypeError,yr=function(e,t,n){try{return gr(Rr(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(e){}},Ar=ii,br=function(e){if("object"==typeof e||Cr(e))return e;throw vr("Can't set "+Ir(e)+" as a prototype")},wr=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=yr(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return Ar(n),br(r),t?e(n,r):n.__proto__=r,n}}():void 0),Or={},Nr={},Dr=Ze,Pr=Z,Lr=qi.indexOf,kr=Nr,Mr=d([].push),Ur=function(e,t){var n,r=Pr(e),i=0,o=[];for(n in r)!Dr(kr,n)&&Dr(r,n)&&Mr(o,n);for(;t.length>i;)Dr(r,n=t[i++])&&(~Lr(o,n)||Mr(o,n));return o},xr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Vr=Ur,Fr=xr.concat("length","prototype");Or.f=Object.getOwnPropertyNames||function(e){return Vr(e,Fr)};var Br={};Br.f=Object.getOwnPropertySymbols;var jr=ae,Gr=Or,Wr=Br,Hr=ii,Kr=d([].concat),Yr=jr("Reflect","ownKeys")||function(e){var t=Gr.f(Hr(e)),n=Wr.f;return n?Kr(t,n(e)):t},qr=Ze,zr=Yr,Jr=O,Xr=Qt,Qr={},Zr=Ur,$r=xr,eo=Object.keys||function(e){return Zr(e,$r)},to=N,io=Zt,no=Qt,ro=ii,oo=Z,so=eo;Qr.f=to&&!io?Object.defineProperties:function(e,t){ro(e);for(var n,r=oo(t),i=so(t),o=i.length,a=0;o>a;)no.f(e,n=i[a++],r[n]);return e};var ao,co=ae("document","documentElement"),lo=ii,uo=Qr,ho=xr,po=Nr,_o=co,Eo=At,fo="prototype",mo="script",To=lr("IE_PROTO"),So=function(){},go=function(e){return"<"+mo+">"+e+"</"+mo+">"},Ro=function(e){e.write(go("")),e.close();var t=e.parentWindow.Object;return e=null,t},Co=function(){try{ao=new ActiveXObject("htmlfile")}catch(e){}var e,t,n;Co="undefined"!=typeof document?document.domain&&ao?Ro(ao):(t=Eo("iframe"),n="java"+mo+":",t.style.display="none",_o.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(go("document.F=Object")),e.close(),e.F):Ro(ao);for(var r=ho.length;r--;)delete Co[fo][ho[r]];return Co()};po[To]=!0;var Io=Object.create||function(e,t){var n;return null!==e?(So[fo]=lo(e),n=new So,So[fo]=null,n[To]=e):n=Co(),void 0===t?n:uo.f(n,t)},vo=te,yo=fi,Ao=Error,bo=d("".replace),wo=String(Ao("zxcasd").stack),Oo=/\n\s*at [^:]*:[^\n]*/,No=Oo.test(wo),Do=B,Po=!n(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Do(1,7)),7!==e.stack)}),Lo=fi,ko=function(e,t){if(No&&"string"==typeof e&&!Ao.prepareStackTrace)for(;t--;)e=bo(e,Oo,"");return e},Mo=Po,Uo=Error.captureStackTrace,xo={},Vo=xo,Fo=ht("iterator"),Bo=Array.prototype,jo=function(e){return void 0!==e&&(Vo.Array===e||Bo[Fo]===e)},Go=pn,Wo=ke,Ho=Y,Ko=xo,Yo=ht("iterator"),qo=function(e){if(!Ho(e))return Wo(e,Yo)||Wo(e,"@@iterator")||Ko[Go(e)]},zo=L,Jo=De,Xo=ii,Qo=be,Zo=qo,$o=TypeError,es=function(e,t){var n=arguments.length<2?Zo(e):t;if(Jo(n))return Xo(zo(n,e));throw $o(Qo(e)+" is not iterable")},ts=L,is=ii,ns=ke,rs=function(e,t,n){var r,i;is(e);try{if(!(r=ns(e,"return"))){if("throw"===t)throw n;return n}r=ts(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return is(r),n},os=Xt,ss=L,as=ii,cs=be,ds=jo,ls=Gi,us=l,hs=es,ps=qo,_s=rs,Es=TypeError,fs=function(e,t){this.stopped=e,this.result=t},ms=fs.prototype,Ts=function(e,t,n){var r,i,o,a,s,c,u,l=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_RECORD),h=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),f=os(t,n&&n.that),m=function(e){return r&&_s(r,"normal",e),new fs(!0,e)},g=function(e){return l?(as(e),p?f(e[0],e[1],m):f(e[0],e[1])):p?f(e,m):f(e)};if(d)r=e.iterator;else if(h)r=e;else{if(!(i=ps(e)))throw Es(cs(e)+" is not iterable");if(ds(i)){for(o=0,a=ls(e);a>o;o++)if((s=g(e[o]))&&us(ms,s))return s;return new fs(!1)}r=hs(e,i)}for(c=d?e.next:r.next;!(u=ss(c,r)).done;){try{s=g(u.value)}catch(e){_s(r,"throw",e)}if("object"==typeof s&&s&&us(ms,s))return s}return new fs(!1)},Ss=fn,gs=wi,Rs=l,Cs=Sr,Is=wr,vs=function(e,t,n){for(var r=zr(t),i=Xr.f,o=Jr.f,a=0;a<r.length;a++){var s=r[a];qr(e,s)||n&&qr(n,s)||i(e,s,o(t,s))}},ys=Io,As=fi,bs=B,ws=function(e,t){vo(t)&&"cause"in t&&yo(e,"cause",t.cause)},Os=function(e,t,n,r){Mo&&(Uo?Uo(e,t):Lo(e,"stack",ko(n,r)))},Ns=Ts,Ds=function(e,t){return void 0===e?arguments.length<2?"":t:Ss(e)},Ps=ht("toStringTag"),Ls=Error,ks=[].push,Ms=function(e,t){var n,r=Rs(Us,this);Is?n=Is(Ls(),r?Cs(this):Us):(n=r?this:ys(Us),As(n,Ps,"Error")),void 0!==t&&As(n,"message",Ds(t)),Os(n,Ms,n.stack,1),arguments.length>2&&ws(n,arguments[2]);var i=[];return Ns(e,ks,{that:i}),As(n,"errors",i),n};Is?Is(Ms,Ls):vs(Ms,Ls,{name:!0});var Us=Ms.prototype=ys(Ls.prototype,{constructor:bs(1,Ms),message:bs(1,""),name:bs(1,"AggregateError")});gs({global:!0,constructor:!0,arity:2},{AggregateError:Ms});var xs,Vs,Fs,Bs=w,js=h$1.WeakMap,Gs=Bs(js)&&/native code/.test(String(js)),Ws=h$1,Hs=te,Ks=fi,Ys=Ze,qs=He,zs=lr,Js=Nr,Xs="Object already initialized",Qs=Ws.TypeError,Zs=Ws.WeakMap;if(Gs||qs.state){var $s=qs.state||(qs.state=new Zs);$s.get=$s.get,$s.has=$s.has,$s.set=$s.set,xs=function(e,t){if($s.has(e))throw Qs(Xs);return t.facade=e,$s.set(e,t),t},Vs=function(e){return $s.get(e)||{}},Fs=function(e){return $s.has(e)}}else{var ea=zs("state");Js[ea]=!0,xs=function(e,t){if(Ys(e,ea))throw Qs(Xs);return t.facade=e,Ks(e,ea,t),t},Vs=function(e){return Ys(e,ea)?e[ea]:{}},Fs=function(e){return Ys(e,ea)}}var ta,ia,na,ra={set:xs,get:Vs,has:Fs,enforce:function(e){return Fs(e)?Vs(e):xs(e,{})},getterFor:function(e){return function(t){var n;if(!Hs(t)||(n=Vs(t)).type!==e)throw Qs("Incompatible receiver, "+e+" required");return n}}},oa=N,sa=Ze,aa=Function.prototype,ca=oa&&Object.getOwnPropertyDescriptor,da=sa(aa,"name"),la={EXISTS:da,PROPER:da&&"something"===function(){}.name,CONFIGURABLE:da&&(!oa||oa&&ca(aa,"name").configurable)},ua=fi,ha=function(e,t,n,r){return r&&r.enumerable?e[t]=n:ua(e,t,n),e},pa=n,_a=w,Ea=te,fa=Io,ma=Sr,Ta=ha,Sa=ht("iterator"),ga=!1;[].keys&&("next"in(na=[].keys())?(ia=ma(ma(na)))!==Object.prototype&&(ta=ia):ga=!0);var Ra=!Ea(ta)||pa(function(){var e={};return ta[Sa].call(e)!==e});_a((ta=Ra?{}:fa(ta))[Sa])||Ta(ta,Sa,function(){return this});var Ca={IteratorPrototype:ta,BUGGY_SAFARI_ITERATORS:ga},Ia=pn,va=sn?{}.toString:function(){return"[object "+Ia(this)+"]"},ya=sn,Aa=Qt.f,ba=fi,wa=Ze,Oa=va,Na=ht("toStringTag"),Da=function(e,t,n,r){if(e){var i=n?e:e.prototype;wa(i,Na)||Aa(i,Na,{configurable:!0,value:t}),r&&!ya&&ba(i,"toString",Oa)}},Pa=Ca.IteratorPrototype,La=Io,ka=B,Ma=Da,Ua=xo,xa=function(){return this},Va=function(e,t,n,r){var i=t+" Iterator";return e.prototype=La(Pa,{next:ka(+!r,n)}),Ma(e,i,!1,!0),Ua[i]=xa,e},Fa=wi,Ba=L,ja=la,Ga=Va,Wa=Sr,Ha=Da,Ka=ha,Ya=xo,qa=Ca,za=ja.PROPER,Ja=qa.BUGGY_SAFARI_ITERATORS,Xa=ht("iterator"),Qa="keys",Za="values",$a="entries",ec=function(){return this},tc=function(e,t,n,r,i,o,a){Ga(n,t,r);var s,c,u,l=function(e){if(e===i&&m)return m;if(!Ja&&e in p)return p[e];switch(e){case Qa:case Za:case $a:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",h=!1,p=e.prototype,f=p[Xa]||p["@@iterator"]||i&&p[i],m=!Ja&&f||l(i),g="Array"==t&&p.entries||f;if(g&&(s=Wa(g.call(new e)))!==Object.prototype&&s.next&&(Ha(s,d,!0,!0),Ya[d]=ec),za&&i==Za&&f&&f.name!==Za&&(h=!0,m=function(){return Ba(f,this)}),i)if(c={values:l(Za),keys:o?m:l(Qa),entries:l($a)},a)for(u in c)(Ja||h||!(u in p))&&Ka(p,u,c[u]);else Fa({target:t,proto:!0,forced:Ja||h},c);return a&&p[Xa]!==m&&Ka(p,Xa,m,{name:i}),Ya[t]=m,c},ic=function(e,t){return{value:e,done:t}},nc=Z,rc=xo,oc=ra,sc=tc,ac=ic,cc="Array Iterator",dc=oc.set,lc=oc.getterFor(cc);sc(Array,"Array",function(e,t){dc(this,{type:cc,target:nc(e),index:0,kind:t})},function(){var e=lc(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,ac(void 0,!0)):ac("keys"==n?r:"values"==n?t[r]:[r,t[r]],!1)},"values"),rc.Arguments=rc.Array;var uc=Qt,hc=function(e,t,n){return uc.f(e,t,n)},pc=ae,_c=hc,Ec=N,fc=ht("species"),mc=l,Tc=TypeError,Sc=function(e,t){if(mc(t,e))return e;throw Tc("Incorrect invocation")},gc=w,Rc=He,Cc=d(Function.toString);gc(Rc.inspectSource)||(Rc.inspectSource=function(e){return Cc(e)});var Ic=Rc.inspectSource,vc=d,yc=n,Ac=w,bc=pn,wc=Ic,Oc=function(){},Nc=[],Dc=ae("Reflect","construct"),Pc=/^\s*(?:class|function)\b/,Lc=vc(Pc.exec),kc=!Pc.exec(Oc),Mc=function(e){if(!Ac(e))return!1;try{return Dc(Oc,Nc,e),!0}catch(e){return!1}},Uc=function(e){if(!Ac(e))return!1;switch(bc(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return kc||!!Lc(Pc,wc(e))}catch(e){return!0}};Uc.sham=!0;var xc,Vc,Fc,Bc,jc=!Dc||yc(function(){var e;return Mc(Mc.call)||!Mc(Object)||!Mc(function(){e=!0})||e})?Uc:Mc,Gc=jc,Wc=be,Hc=TypeError,Kc=ii,Yc=function(e){if(Gc(e))return e;throw Hc(Wc(e)+" is not a constructor")},qc=Y,zc=ht("species"),Jc=function(e,t){var n,r=Kc(e).constructor;return void 0===r||qc(n=Kc(r)[zc])?t:Yc(n)},Xc=d([].slice),Qc=TypeError,Zc=function(e,t){if(e<t)throw Qc("Not enough arguments");return e},$c=/(?:ipad|iphone|ipod).*applewebkit/i.test(ce),ed=h$1,td=m,id=Xt,nd=w,rd=Ze,od=n,sd=co,ad=Xc,cd=At,dd=Zc,ld=$c,ud=jn,hd=ed.setImmediate,pd=ed.clearImmediate,_d=ed.process,Ed=ed.Dispatch,fd=ed.Function,md=ed.MessageChannel,Td=ed.String,Sd=0,gd={},Rd="onreadystatechange";od(function(){xc=ed.location});var Cd=function(e){if(rd(gd,e)){var t=gd[e];delete gd[e],t()}},Id=function(e){return function(){Cd(e)}},vd=function(e){Cd(e.data)},yd=function(e){ed.postMessage(Td(e),xc.protocol+"//"+xc.host)};hd&&pd||(hd=function(e){dd(arguments.length,1);var t=nd(e)?e:fd(e),n=ad(arguments,1);return gd[++Sd]=function(){td(t,void 0,n)},Vc(Sd),Sd},pd=function(e){delete gd[e]},ud?Vc=function(e){_d.nextTick(Id(e))}:Ed&&Ed.now?Vc=function(e){Ed.now(Id(e))}:md&&!ld?(Bc=(Fc=new md).port2,Fc.port1.onmessage=vd,Vc=id(Bc.postMessage,Bc)):ed.addEventListener&&nd(ed.postMessage)&&!ed.importScripts&&xc&&"file:"!==xc.protocol&&!od(yd)?(Vc=yd,ed.addEventListener("message",vd,!1)):Vc=Rd in cd("script")?function(e){sd.appendChild(cd("script"))[Rd]=function(){sd.removeChild(this),Cd(e)}}:function(e){setTimeout(Id(e),0)});var Ad={set:hd,clear:pd},bd=function(){this.head=null,this.tail=null};bd.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var wd,Od,Nd,Dd,Pd,Ld=bd,kd=/ipad|iphone|ipod/i.test(ce)&&"undefined"!=typeof Pebble,Md=/web0s(?!.*chrome)/i.test(ce),Ud=h$1,xd=Xt,Vd=O.f,Fd=Ad.set,Bd=Ld,jd=$c,Gd=kd,Wd=Md,Hd=jn,Kd=Ud.MutationObserver||Ud.WebKitMutationObserver,Yd=Ud.document,qd=Ud.process,zd=Ud.Promise,Jd=Vd(Ud,"queueMicrotask"),Xd=Jd&&Jd.value;if(!Xd){var Qd=new Bd,Zd=function(){var e,t;for(Hd&&(e=qd.domain)&&e.exit();t=Qd.get();)try{t()}catch(e){throw Qd.head&&wd(),e}e&&e.enter()};jd||Hd||Wd||!Kd||!Yd?!Gd&&zd&&zd.resolve?((Dd=zd.resolve(void 0)).constructor=zd,Pd=xd(Dd.then,Dd),wd=function(){Pd(Zd)}):Hd?wd=function(){qd.nextTick(Zd)}:(Fd=xd(Fd,Ud),wd=function(){Fd(Zd)}):(Od=!0,Nd=Yd.createTextNode(""),new Kd(Zd).observe(Nd,{characterData:!0}),wd=function(){Nd.data=Od=!Od}),Xd=function(e){Qd.head||wd(),Qd.add(e)}}var $d=Xd,el=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},tl=h$1.Promise,il="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,nl=!il&&!jn&&"object"==typeof window&&"object"==typeof document,rl=h$1,ol=tl,sl=w,al=Yt,cl=Ic,dl=ht,ll=nl,ul=il,hl=Ee,pl=ol&&ol.prototype,_l=dl("species"),El=!1,fl=sl(rl.PromiseRejectionEvent),ml=al("Promise",function(){var e=cl(ol),t=e!==String(ol);if(!t&&66===hl)return!0;if(!pl.catch||!pl.finally)return!0;if(!hl||hl<51||!/native code/.test(e)){var n=new ol(function(e){e(1)}),r=function(e){e(function(){},function(){})};if((n.constructor={})[_l]=r,!(El=n.then(function(){})instanceof r))return!0}return!t&&(ll||ul)&&!fl}),Tl={CONSTRUCTOR:ml,REJECTION_EVENT:fl,SUBCLASSING:El},Sl={},gl=De,Rl=TypeError,Cl=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw Rl("Bad Promise constructor");t=e,n=r}),this.resolve=gl(t),this.reject=gl(n)};Sl.f=function(e){return new Cl(e)};var Il,vl,yl=wi,Al=jn,bl=h$1,wl=L,Ol=ha,Nl=Da,Dl=function(e){var t=pc(e);Ec&&t&&!t[fc]&&_c(t,fc,{configurable:!0,get:function(){return this}})},Pl=De,Ll=w,kl=te,Ml=Sc,Ul=Jc,xl=Ad.set,Vl=$d,Fl=function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}},Bl=el,jl=Ld,Gl=ra,Wl=tl,Hl=Tl,Kl=Sl,Yl="Promise",ql=Hl.CONSTRUCTOR,zl=Hl.REJECTION_EVENT,Jl=Gl.getterFor(Yl),Xl=Gl.set,Ql=Wl&&Wl.prototype,Zl=Wl,$l=Ql,eu=bl.TypeError,tu=bl.document,iu=bl.process,nu=Kl.f,ru=nu,ou=!!(tu&&tu.createEvent&&bl.dispatchEvent),su="unhandledrejection",au=function(e){var t;return!(!kl(e)||!Ll(t=e.then))&&t},cu=function(e,t){var n,r,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{s?(a||(2===t.rejection&&pu(t),t.rejection=1),!0===s?n=o:(l&&l.enter(),n=s(o),l&&(l.exit(),i=!0)),n===e.promise?u(eu("Promise-chain cycle")):(r=au(n))?wl(r,n,c,u):c(n)):u(o)}catch(e){l&&!i&&l.exit(),u(e)}},du=function(e,t){e.notified||(e.notified=!0,Vl(function(){for(var n,r=e.reactions;n=r.get();)cu(n,e);e.notified=!1,t&&!e.rejection&&uu(e)}))},lu=function(e,t,n){var r,i;ou?((r=tu.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),bl.dispatchEvent(r)):r={promise:t,reason:n},!zl&&(i=bl["on"+e])?i(r):e===su&&Fl("Unhandled promise rejection",n)},uu=function(e){wl(xl,bl,function(){var t,n=e.facade,r=e.value;if(hu(e)&&(t=Bl(function(){Al?iu.emit("unhandledRejection",r,n):lu(su,n,r)}),e.rejection=Al||hu(e)?2:1,t.error))throw t.value})},hu=function(e){return 1!==e.rejection&&!e.parent},pu=function(e){wl(xl,bl,function(){var t=e.facade;Al?iu.emit("rejectionHandled",t):lu("rejectionhandled",t,e.value)})},_u=function(e,t,n){return function(r){e(t,r,n)}},Eu=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,du(e,!0))},fu=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw eu("Promise can't be resolved itself");var r=au(t);r?Vl(function(){var n={done:!1};try{wl(r,t,_u(fu,n,e),_u(Eu,n,e))}catch(t){Eu(n,t,e)}}):(e.value=t,e.state=1,du(e,!1))}catch(t){Eu({done:!1},t,e)}}};ql&&($l=(Zl=function(e){Ml(this,$l),Pl(e),wl(Il,this);var t=Jl(this);try{e(_u(fu,t),_u(Eu,t))}catch(e){Eu(t,e)}}).prototype,(Il=function(e){Xl(this,{type:Yl,done:!1,notified:!1,parent:!1,reactions:new jl,rejection:!1,state:0,value:void 0})}).prototype=Ol($l,"then",function(e,t){var n=Jl(this),r=nu(Ul(this,Zl));return n.parent=!0,r.ok=!Ll(e)||e,r.fail=Ll(t)&&t,r.domain=Al?iu.domain:void 0,0==n.state?n.reactions.add(r):Vl(function(){cu(r,n)}),r.promise}),vl=function(){var e=new Il,t=Jl(e);this.promise=e,this.resolve=_u(fu,t),this.reject=_u(Eu,t)},Kl.f=nu=function(e){return e===Zl||void 0===e?new vl(e):ru(e)}),yl({global:!0,constructor:!0,wrap:!0,forced:ql},{Promise:Zl}),Nl(Zl,Yl,!1,!0),Dl(Yl);var mu=ht("iterator"),Tu=!1;try{var Su=0,gu={next:function(){return{done:!!Su++}},return:function(){Tu=!0}};gu[mu]=function(){return this},Array.from(gu,function(){throw 2})}catch(e){}var Ru=tl,Cu=function(e,t){if(!t&&!Tu)return!1;var n=!1;try{var r={};r[mu]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Iu=Tl.CONSTRUCTOR||!Cu(function(e){Ru.all(e).then(void 0,function(){})}),vu=L,yu=De,Au=Sl,bu=el,wu=Ts;wi({target:"Promise",stat:!0,forced:Iu},{all:function(e){var t=this,n=Au.f(t),r=n.resolve,i=n.reject,o=bu(function(){var n=yu(t.resolve),o=[],a=0,s=1;wu(e,function(e){var c=a++,u=!1;s++,vu(n,t,e).then(function(e){u||(u=!0,o[c]=e,--s||r(o))},i)}),--s||r(o)});return o.error&&i(o.value),n.promise}});var Ou=wi,Nu=Tl.CONSTRUCTOR;Ou({target:"Promise",proto:!0,forced:Nu,real:!0},{catch:function(e){return this.then(void 0,e)}});var Du=L,Pu=De,Lu=Sl,ku=el,Mu=Ts;wi({target:"Promise",stat:!0,forced:Iu},{race:function(e){var t=this,n=Lu.f(t),r=n.reject,i=ku(function(){var i=Pu(t.resolve);Mu(e,function(e){Du(i,t,e).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var Uu=L,xu=Sl;wi({target:"Promise",stat:!0,forced:Tl.CONSTRUCTOR},{reject:function(e){var t=xu.f(this);return Uu(t.reject,void 0,e),t.promise}});var Vu=ii,Fu=te,Bu=Sl,ju=function(e,t){if(Vu(e),Fu(t)&&t.constructor===e)return t;var n=Bu.f(e);return(0,n.resolve)(t),n.promise},Gu=wi,Wu=tl,Hu=Tl.CONSTRUCTOR,Ku=ju,Yu=ae("Promise"),qu=!Hu;Gu({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Ku(qu&&this===Yu?Wu:this,e)}});var zu=L,Ju=De,Xu=Sl,Qu=el,Zu=Ts;wi({target:"Promise",stat:!0,forced:Iu},{allSettled:function(e){var t=this,n=Xu.f(t),r=n.resolve,i=n.reject,o=Qu(function(){var n=Ju(t.resolve),i=[],o=0,a=1;Zu(e,function(e){var s=o++,c=!1;a++,zu(n,t,e).then(function(e){c||(c=!0,i[s]={status:"fulfilled",value:e},--a||r(i))},function(e){c||(c=!0,i[s]={status:"rejected",reason:e},--a||r(i))})}),--a||r(i)});return o.error&&i(o.value),n.promise}});var $u=L,eh=De,th=ae,ih=Sl,nh=el,rh=Ts,oh="No one promise resolved";wi({target:"Promise",stat:!0,forced:Iu},{any:function(e){var t=this,n=th("AggregateError"),r=ih.f(t),i=r.resolve,o=r.reject,a=nh(function(){var r=eh(t.resolve),a=[],s=0,c=1,u=!1;rh(e,function(e){var l=s++,d=!1;c++,$u(r,t,e).then(function(e){d||u||(u=!0,i(e))},function(e){d||u||(d=!0,a[l]=e,--c||o(new n(a,oh)))})}),--c||o(new n(a,oh))});return a.error&&o(a.value),r.promise}});var sh=wi,ah=tl,ch=n,dh=ae,lh=w,uh=Jc,hh=ju,ph=ah&&ah.prototype;sh({target:"Promise",proto:!0,real:!0,forced:!!ah&&ch(function(){ph.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=uh(this,dh("Promise")),n=lh(e);return this.then(n?function(n){return hh(t,e()).then(function(){return n})}:e,n?function(n){return hh(t,e()).then(function(){throw n})}:e)}});var _h=d,Eh=Li,fh=fn,mh=J,Th=_h("".charAt),Sh=_h("".charCodeAt),gh=_h("".slice),Rh=function(e){return function(t,n){var r,i,o=fh(mh(t)),a=Eh(n),s=o.length;return a<0||a>=s?e?"":void 0:(r=Sh(o,a))<55296||r>56319||a+1===s||(i=Sh(o,a+1))<56320||i>57343?e?Th(o,a):r:e?gh(o,a,a+2):i-56320+(r-55296<<10)+65536}},Ch={codeAt:Rh(!1),charAt:Rh(!0)},Ih=Ch.charAt,vh=fn,yh=ra,Ah=tc,bh=ic,wh="String Iterator",Oh=yh.set,Nh=yh.getterFor(wh);Ah(String,"String",function(e){Oh(this,{type:wh,string:vh(e),index:0})},function(){var e,t=Nh(this),n=t.string,r=t.index;return r>=n.length?bh(void 0,!0):(e=Ih(n,r),t.index+=e.length,bh(e,!1))});var Dh=ie.Promise,Ph={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Lh=h$1,kh=pn,Mh=fi,Uh=xo,xh=ht("toStringTag");for(var Vh in Ph){var Fh=Lh[Vh],Bh=Fh&&Fh.prototype;Bh&&kh(Bh)!==xh&&Mh(Bh,xh,Vh),Uh[Vh]=Uh.Array}var jh=Dh,Gh=i(jh);const Wh=ir;function Hh(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach(n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const a=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then(n=>{let a=(n=n.filter(e=>"videoinput"===e.kind)).find(e=>t.some(t=>{var n;return Dn(n=e.label.toLowerCase()).call(n,t)}));return!a&&n.length&&Dn(t).call(t,"back")&&(a=n[n.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=r(e.video),Wh("chrome: "+JSON.stringify(e)),i(e)})}e.video=r(e.video)}return Wh("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,e=>{n.webkitGetUserMedia(e,t,e=>{r&&r(o(e))})})}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>Gh.reject(o(e))))}}}function Kh(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Yh(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.track.id):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),t.stream.getTracks().forEach(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(e=>e.track&&e.track.id===n.id):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else $n(e,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function qh(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===t.kind?e.createDTMFSender(t):null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach(e=>{this._senders.push(t(this,e))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(e=>{const t=this._senders.find(t=>t.track===e);t&&this._senders.splice(this._senders.indexOf(t),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function zh(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t[n.id]=n}),t},o=function(e){return new Map(Object.keys(e).map(t=>[t,e[t]]))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new Gh((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])}).then(n,r)}}function Jh(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>ar(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),$n(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then(t=>ar(t,e.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach(n=>{n.track===e&&(t?r=!0:t=n)}),this.getReceivers().forEach(t=>(t.track===e&&(n?r=!0:n=t),t.track===e)),r||t&&n?Gh.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Gh.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Xh(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(e=>this._shimmedLocalStreams[e][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter(e=>-1===t.indexOf(e));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function Qh(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Xh(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(e=>this._reverseStreams[e.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach(e=>{if(this.getSenders().find(t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t];n=n.replace(new RegExp(e._streams[r.id].id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find(e=>e.track===t);if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),Gh.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find(e=>e.track===t)},["createOffer","createAnswer"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then(e=>o(this,e))}};e.RTCPeerConnection.prototype[t]=r[t]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const s=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=s.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach(n=>{this._streams[n].getTracks().find(t=>e.track===t)&&(t=this._streams[n])}),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Zh(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]})}function $h(e,t){$n(e,"negotiationneeded",e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e})}var ep=Object.freeze({__proto__:null,fixNegotiationNeeded:$h,shimAddTrackRemoveTrack:Qh,shimAddTrackRemoveTrackWithNative:Xh,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:n.video&&n.video.frameRate||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:qh,shimGetStats:zh,shimGetUserMedia:Hh,shimMediaStream:Kh,shimOnTrack:Yh,shimPeerConnection:Zh,shimSenderReceiverGetStats:Jh});function tp(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){nr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function ip(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function np(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then(e=>{if(t.version<53&&!i)try{e.forEach(e=>{e.type=n[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))})}return e}).then(i,o)}}function rp(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Gh.resolve(new Map)}}function op(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach(e=>e._pc=this),e}),$n(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function sp(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){nr("removeStream","removeTrack"),this.getSenders().forEach(t=>{var n;t.track&&Dn(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)})})}function ap(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function cp(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach(e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then(()=>{delete t.sendEncodings}).catch(()=>{delete t.sendEncodings})))}return r})}function dp(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function lp(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Gh.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function up(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Gh.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var hp=Object.freeze({__proto__:null,shimAddTransceiver:cp,shimCreateAnswer:up,shimCreateOffer:lp,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Gh.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:dp,shimGetUserMedia:tp,shimOnTrack:ip,shimPeerConnection:np,shimRTCDataChannel:ap,shimReceiverGetStats:op,shimRemoveStream:sp,shimSenderGetStats:rp});function pp(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n;this._localStreams||(this._localStreams=[]),Dn(n=this._localStreams).call(n,e)||this._localStreams.push(e),e.getAudioTracks().forEach(n=>t.call(this,n,e)),e.getVideoTracks().forEach(n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach(e=>{var t;this._localStreams?Dn(t=this._localStreams).call(t,e)||this._localStreams.push(e):this._localStreams=[e]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach(e=>{Dn(n).call(n,e.track)&&this.removeTrack(e)})})}}function _p(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach(e=>{var t;if(this._remoteStreams||(this._remoteStreams=[]),Dn(t=this._remoteStreams).call(t,e))return;this._remoteStreams.push(e);const n=new Event("addstream");n.stream=e,this.dispatchEvent(n)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)})}),t.apply(e,arguments)}}}function Ep(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const r=n.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return t?(r.then(e,t),Gh.resolve()):r},t.createAnswer=function(e,t){const n=r.apply(this,[arguments.length>=2?arguments[2]:arguments[0]]);return t?(n.then(e,t),Gh.resolve()):n};let s=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Gh.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Gh.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){const r=a.apply(this,[e]);return n?(r.then(t,n),Gh.resolve()):r},t.addIceCandidate=s}function fp(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(mp(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function mp(e){return e&&void 0!==e.video?Object.assign({},e,{video:or(e.video)}):e}function Tp(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(nr("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Sp(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gp(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find(e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find(e=>"video"===e.receiver.track.kind);!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Rp(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Cp=Object.freeze({__proto__:null,shimAudioContext:Rp,shimCallbacksAPI:Ep,shimConstraints:mp,shimCreateOfferLegacy:gp,shimGetUserMedia:fp,shimLocalStreamsAPI:pp,shimRTCIceServerUrls:Tp,shimRemoteStreamsAPI:_p,shimTrackEventTransceiver:Sp}),Ip="\t\n\v\f\r \u2028\u2029\ufeff",vp=J,yp=fn,Ap=Ip,bp=d("".replace),wp=RegExp("^["+Ap+"]+"),Op=RegExp("(^|[^"+Ap+"])["+Ap+"]+$"),Np=function(e){return function(t){var n=yp(vp(t));return 1&e&&(n=bp(n,wp,"")),2&e&&(n=bp(n,Op,"$1")),n}},Dp={start:Np(1),end:Np(2),trim:Np(3)},Pp=la.PROPER,Lp=n,kp=Ip,Mp=Dp.trim;wi({target:"String",proto:!0,forced:function(e){return Lp(function(){return!!kp[e]()||""!==""[e]()||Pp&&kp[e].name!==e})}("trim")},{trim:function(){return Mp(this)}});var Up=Xi("String").trim,xp=l,Vp=Up,Fp=String.prototype,Bp=function(e){var t=e.trim;return"string"==typeof e||e===Fp||xp(Fp,e)&&t===Fp.trim?Vp:t},jp=i(Bp),Gp={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(e=>e.trim())},t.splitSections=function(e){return e.split("\nm=").map((e,t)=>(t>0?"m="+e:e).trim()+"\r\n")},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(e=>0===e.indexOf(n))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;t.push("rtp"===n?1:"rtcp"===n?2:n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)n=r[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach(t=>{r.push(void 0!==e.parameters[t]?t+"="+e.parameters[t]:t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(e=>parseInt(e,10))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substring(12),password:i.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let i=3;i<r.length;i++){const o=r[i],a=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){const r=t.parseRtpMap(a),i=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(r.parameters=i.length?t.parseFmtp(i[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach(e=>{n.headerExtensions.push(t.parseExtmap(e))});const i=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(e=>{i.forEach(t=>{e.rtcpFeedback.find(e=>e.type===t.type&&e.parameter===t.parameter)||e.rtcpFeedback.push(t)})}),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map(e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)});let i=0;return n.codecs.forEach(e=>{e.maxptime>i&&(i=e.maxptime)}),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach(e=>{r+=t.writeExtmap(e)}),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute),s=a.length>0&&a[0].ssrc;let c;const u=t.matchPrefix(e,"a=ssrc-group:FID").map(e=>e.substring(17).split(" ").map(e=>parseInt(e,10)));u.length>0&&u[0].length>1&&u[0][0]===s&&(c=u[0][1]),r.codecs.forEach(e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},n.push(t))}}),0===n.length&&s&&n.push({ssrc:s});let l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substring(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substring(5),10)*.95-16e3:void 0,n.forEach(e=>{e.maxBitrate=l})),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"cname"===e.attribute)[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map(e=>t.parseSsrcMedia(e)).filter(e=>"msid"===e.attribute);return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substring(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:i};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}(Gp);var Wp=Gp.exports,Hp=i(Wp),Kp=e({__proto__:null,default:Hp},[Wp]);function Yp(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Hp.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,$n(e,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}function qp(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||$n(e,"icecandidate",e=>{if(e.candidate){const t=Hp.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function zp(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},r=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=Hp.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Hp.splitSections(e.sdp);return t.shift(),t.some(e=>{const t=Hp.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),t=n(e),i=r(arguments[0],e);let o;o=0===t&&0===i?Number.POSITIVE_INFINITY:0===t||0===i?Math.max(t,i):Math.min(t,i);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>o}),this._sctp=a}return i.apply(this,arguments)}}function Jp(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0];if("open"===e.readyState&&t.sctp&&(r.length||r.size||r.byteLength)>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},$n(e,"datachannel",e=>(t(e.channel,e.target),e))}function Xp(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function Qp(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter(e=>"a=extmap-allow-mixed"!==jp(e).call(e)).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function Zp(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Gh.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Gh.resolve())})}function $p(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then(e=>n.apply(this,[e]))})}var e_=Object.freeze({__proto__:null,removeExtmapAllowMixed:Qp,shimAddIceCandidateNullOrEmpty:Zp,shimConnectionState:Xp,shimMaxMessageSize:zp,shimParameterlessSetLocalDescription:$p,shimRTCIceCandidate:Yp,shimRTCIceCandidateRelayProtocol:qp,shimSendThrowTypeError:Jp});!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=ir,r=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Zn(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Zn(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Zn(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),i={browserDetails:r,commonShim:e_,extractVersion:Zn,disableLog:er,disableWarnings:tr,sdp:Kp};switch(r.browser){case"chrome":if(!ep||!Zh||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=ep,Zp(e,r),$p(e),Hh(e,r),Kh(e),Zh(e,r),Yh(e),Qh(e,r),qh(e),zh(e),Jh(e),$h(e,r),Yp(e),qp(e),Xp(e),zp(e,r),Jp(e),Qp(e,r);break;case"firefox":if(!hp||!np||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=hp,Zp(e,r),$p(e),tp(e,r),np(e,r),ip(e),sp(e),rp(e),op(e),ap(e),cp(e),dp(e),lp(e),up(e),Yp(e),Xp(e),zp(e,r),Jp(e);break;case"safari":if(!Cp||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=Cp,Zp(e,r),$p(e),Tp(e),gp(e),Ep(e),pp(e),_p(e),Sp(e),fp(e),Rp(e),Yp(e),qp(e),zp(e,r),Jp(e),Qp(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var t_=Xi("Array").keys,i_=pn,n_=Ze,r_=l,o_=t_,s_=Array.prototype,a_={DOMTokenList:!0,NodeList:!0},c_=function(e){var t=e.keys;return e===s_||r_(s_,e)&&t===s_.keys||n_(a_,i_(e))?o_:t},d_=i(c_),l_=be,u_=TypeError,h_=Ct,p_=Qt,__=B,E_=function(e,t,n){var r=h_(t);r in e?p_.f(e,r,__(0,n)):e[r]=n},f_=xi,m_=Gi,T_=E_,S_=Array,g_=Math.max,R_=function(e,t,n){for(var r=m_(e),i=f_(t,r),o=f_(void 0===n?r:n,r),a=S_(g_(o-i,0)),s=0;i<o;i++,s++)T_(a,s,e[i]);return a.length=s,a},C_=R_,I_=Math.floor,v_=function(e,t){var n=e.length,r=I_(n/2);return n<8?y_(e,t):A_(e,v_(C_(e,0,r),t),v_(C_(e,r),t),t)},y_=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},A_=function(e,t,n,r){for(var i=t.length,o=n.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?r(t[a],n[s])<=0?t[a++]:n[s++]:a<i?t[a++]:n[s++];return e},b_=v_,w_=ce.match(/firefox\/(\d+)/i),O_=!!w_&&+w_[1],N_=/MSIE|Trident/.test(ce),D_=ce.match(/AppleWebKit\/(\d+)\./),P_=!!D_&&+D_[1],L_=wi,k_=d,M_=De,U_=Je,x_=Gi,V_=function(e,t){if(!delete e[t])throw u_("Cannot delete property "+l_(t)+" of "+l_(e))},F_=fn,B_=n,j_=b_,G_=Bn,W_=O_,H_=N_,K_=Ee,Y_=P_,q_=[],z_=k_(q_.sort),J_=k_(q_.push),X_=B_(function(){q_.sort(void 0)}),Q_=B_(function(){q_.sort(null)}),Z_=G_("sort"),$_=!B_(function(){if(K_)return K_<70;if(!(W_&&W_>3)){if(H_)return!0;if(Y_)return Y_<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)q_.push({k:t+r,v:n})}for(q_.sort(function(e,t){return t.v-e.v}),r=0;r<q_.length;r++)t=q_[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}});L_({target:"Array",proto:!0,forced:X_||!Q_||!Z_||!$_},{sort:function(e){void 0!==e&&M_(e);var t=U_(this);if($_)return void 0===e?z_(t):z_(t,e);var n,r,i=[],o=x_(t);for(r=0;r<o;r++)r in t&&J_(i,t[r]);for(j_(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:F_(t)>F_(n)?1:-1}}(e)),n=x_(i),r=0;r<n;)t[r]=i[r++];for(;r<o;)V_(t,r++);return t}});var eE,tE,iE=Xi("Array").sort,nE=l,rE=iE,oE=Array.prototype,sE=function(e){var t=e.sort;return e===oE||nE(oE,e)&&t===oE.sort?rE:t},aE=i(sE),cE={exports:{}};eE=cE,tE=cE.exports,function(e,t){var n="function",r="undefined",i="object",o="string",a="major",s="model",c="name",u="type",l="vendor",d="version",h="architecture",p="console",f="mobile",m="tablet",g="smarttv",v="wearable",E="embedded",y="Amazon",_="Apple",b="ASUS",S="BlackBerry",w="Browser",T="Chrome",R="Firefox",C="Google",I="Huawei",O="LG",A="Microsoft",N="Motorola",k="Opera",P="Samsung",L="Sharp",D="Sony",M="Xiaomi",x="Zebra",U="Facebook",F="Chromium OS",$="Mac OS",j=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},V=function(e,t){return typeof e===o&&-1!==B(t).indexOf(B(e))},B=function(e){return e.toLowerCase()},G=function(e,t){if(typeof e===o)return e=e.replace(/^\s\s*/,""),typeof t===r?e:e.substring(0,350)},H=function(e,r){for(var o,a,s,c,u,l,d=0;d<r.length&&!u;){var h=r[d],p=r[d+1];for(o=a=0;o<h.length&&!u&&h[o];)if(u=h[o++].exec(e))for(s=0;s<p.length;s++)l=u[++a],typeof(c=p[s])===i&&c.length>0?2===c.length?this[c[0]]=typeof c[1]==n?c[1].call(this,l):c[1]:3===c.length?this[c[0]]=typeof c[1]!==n||c[1].exec&&c[1].test?l?l.replace(c[1],c[2]):t:l?c[1].call(this,l,c[2]):t:4===c.length&&(this[c[0]]=l?c[3].call(this,l.replace(c[1],c[2])):t):this[c]=l||t;d+=2}},W=function(e,n){for(var r in n)if(typeof n[r]===i&&n[r].length>0){for(var o=0;o<n[r].length;o++)if(V(n[r][o],e))return"?"===r?t:r}else if(V(n[r],e))return"?"===r?t:r;return e},q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},z={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[d,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[d,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,d],[/opios[\/ ]+([\w\.]+)/i],[d,[c,k+" Mini"]],[/\bopr\/([\w\.]+)/i],[d,[c,k]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[c,d],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[d,[c,"UC"+w]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[d,[c,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[d,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[d,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[d,[c,"IE"]],[/yabrowser\/([\w\.]+)/i],[d,[c,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+w],d],[/\bfocus\/([\w\.]+)/i],[d,[c,R+" Focus"]],[/\bopt\/([\w\.]+)/i],[d,[c,k+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[d,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[d,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[d,[c,k+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[d,[c,"MIUI "+w]],[/fxios\/([-\w\.]+)/i],[d,[c,R]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c,"360 "+w]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1 "+w],d],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],d],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c,d],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,U],d],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c,d],[/\bgsa\/([\w\.]+) .*safari\//i],[d,[c,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[d,[c,T+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,T+" WebView"],d],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[d,[c,"Android "+w]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,d],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[d,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[d,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[d,W,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c,d],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],d],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[d,[c,R+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c,d],[/(cobalt)\/([\w\.]+)/i],[c,[d,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,B]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",B]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,B]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[s,[l,P],[u,m]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[s,[l,P],[u,f]],[/\((ip(?:hone|od)[\w ]*);/i],[s,[l,_],[u,f]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[s,[l,_],[u,m]],[/(macintosh);/i],[s,[l,_]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[s,[l,L],[u,f]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[s,[l,I],[u,m]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[s,[l,I],[u,f]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[s,/_/g," "],[l,M],[u,f]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[s,/_/g," "],[l,M],[u,m]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[s,[l,"OPPO"],[u,f]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[s,[l,"Vivo"],[u,f]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[s,[l,"Realme"],[u,f]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[s,[l,N],[u,f]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[s,[l,N],[u,m]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[s,[l,O],[u,m]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[s,[l,O],[u,f]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[s,[l,"Lenovo"],[u,m]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[s,/_/g," "],[l,"Nokia"],[u,f]],[/(pixel c)\b/i],[s,[l,C],[u,m]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[s,[l,C],[u,f]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[l,D],[u,f]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[s,"Xperia Tablet"],[l,D],[u,m]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[s,[l,"OnePlus"],[u,f]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[s,[l,y],[u,m]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[s,/(.+)/g,"Fire Phone $1"],[l,y],[u,f]],[/(playbook);[-\w\),; ]+(rim)/i],[s,l,[u,m]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[s,[l,S],[u,f]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[s,[l,b],[u,m]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[s,[l,b],[u,f]],[/(nexus 9)/i],[s,[l,"HTC"],[u,m]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[l,[s,/_/g," "],[u,f]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[s,[l,"Acer"],[u,m]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[s,[l,"Meizu"],[u,f]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[l,s,[u,f]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[l,s,[u,m]],[/(surface duo)/i],[s,[l,A],[u,m]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[s,[l,"Fairphone"],[u,f]],[/(u304aa)/i],[s,[l,"AT&T"],[u,f]],[/\bsie-(\w*)/i],[s,[l,"Siemens"],[u,f]],[/\b(rct\w+) b/i],[s,[l,"RCA"],[u,m]],[/\b(venue[\d ]{2,7}) b/i],[s,[l,"Dell"],[u,m]],[/\b(q(?:mv|ta)\w+) b/i],[s,[l,"Verizon"],[u,m]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[s,[l,"Barnes & Noble"],[u,m]],[/\b(tm\d{3}\w+) b/i],[s,[l,"NuVision"],[u,m]],[/\b(k88) b/i],[s,[l,"ZTE"],[u,m]],[/\b(nx\d{3}j) b/i],[s,[l,"ZTE"],[u,f]],[/\b(gen\d{3}) b.+49h/i],[s,[l,"Swiss"],[u,f]],[/\b(zur\d{3}) b/i],[s,[l,"Swiss"],[u,m]],[/\b((zeki)?tb.*\b) b/i],[s,[l,"Zeki"],[u,m]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[l,"Dragon Touch"],s,[u,m]],[/\b(ns-?\w{0,9}) b/i],[s,[l,"Insignia"],[u,m]],[/\b((nxa|next)-?\w{0,9}) b/i],[s,[l,"NextBook"],[u,m]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[l,"Voice"],s,[u,f]],[/\b(lvtel\-)?(v1[12]) b/i],[[l,"LvTel"],s,[u,f]],[/\b(ph-1) /i],[s,[l,"Essential"],[u,f]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[s,[l,"Envizen"],[u,m]],[/\b(trio[-\w\. ]+) b/i],[s,[l,"MachSpeed"],[u,m]],[/\btu_(1491) b/i],[s,[l,"Rotor"],[u,m]],[/(shield[\w ]+) b/i],[s,[l,"Nvidia"],[u,m]],[/(sprint) (\w+)/i],[l,s,[u,f]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[l,A],[u,f]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[s,[l,x],[u,m]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[s,[l,x],[u,f]],[/smart-tv.+(samsung)/i],[l,[u,g]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[l,P],[u,g]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[l,O],[u,g]],[/(apple) ?tv/i],[l,[s,_+" TV"],[u,g]],[/crkey/i],[[s,T+"cast"],[l,C],[u,g]],[/droid.+aft(\w)( bui|\))/i],[s,[l,y],[u,g]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[s,[l,L],[u,g]],[/(bravia[\w ]+)( bui|\))/i],[s,[l,D],[u,g]],[/(mitv-\w{5}) bui/i],[s,[l,M],[u,g]],[/Hbbtv.*(technisat) (.*);/i],[l,s,[u,g]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[l,G],[s,G],[u,g]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,g]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[l,s,[u,p]],[/droid.+; (shield) bui/i],[s,[l,"Nvidia"],[u,p]],[/(playstation [345portablevi]+)/i],[s,[l,D],[u,p]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[s,[l,A],[u,p]],[/((pebble))app/i],[l,s,[u,v]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[s,[l,_],[u,v]],[/droid.+; (glass) \d/i],[s,[l,C],[u,v]],[/droid.+; (wt63?0{2,3})\)/i],[s,[l,x],[u,v]],[/(quest( 2| pro)?)/i],[s,[l,U],[u,v]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[l,[u,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[s,[u,f]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[s,[u,m]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,m]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,f]],[/(android[-\w\. ]{0,9});.+buil/i],[s,[l,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[d,[c,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[d,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[c,d],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[d,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,d],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c,[d,W,q]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c,"Windows"],[d,W,q]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[d,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,$],[d,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[d,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,d],[/\(bb(10);/i],[d,[c,S]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[d,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[d,[c,R+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[d,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[d,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[d,[c,T+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,F],d],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,d],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],d],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[c,d]]},K=function(p,g){if(typeof p===i&&(g=p,p=t),!(this instanceof K))return new K(p,g).getResult();var v=typeof e!==r&&e.navigator?e.navigator:t,E=p||(v&&v.userAgent?v.userAgent:""),y=v&&v.userAgentData?v.userAgentData:t,_=g?function(e,t){var n={};for(var r in e)n[r]=t[r]&&t[r].length%2==0?t[r].concat(e[r]):e[r];return n}(z,g):z;return this.getBrowser=function(){var e={};return e[c]=t,e[d]=t,H.call(e,E,_.browser),e[a]=function(e){return typeof e===o?e.replace(/[^\d\.]/g,"").split(".")[0]:t}(e[d]),v&&v.brave&&typeof v.brave.isBrave==n&&(e[c]="Brave"),e},this.getCPU=function(){var e={};return e[h]=t,H.call(e,E,_.cpu),e},this.getDevice=function(){var e={};return e[l]=t,e[s]=t,e[u]=t,H.call(e,E,_.device),!e[u]&&y&&y.mobile&&(e[u]=f),"Macintosh"==e[s]&&v&&typeof v.standalone!==r&&v.maxTouchPoints&&v.maxTouchPoints>2&&(e[s]="iPad",e[u]=m),e},this.getEngine=function(){var e={};return e[c]=t,e[d]=t,H.call(e,E,_.engine),e},this.getOS=function(){var e={};return e[c]=t,e[d]=t,H.call(e,E,_.os),!e[c]&&y&&"Unknown"!=y.platform&&(e[c]=y.platform.replace(/chrome os/i,F).replace(/macos/i,$)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return E},this.setUA=function(e){return E=typeof e===o&&e.length>350?G(e,350):e,this},this.setUA(E),this};K.VERSION="0.7.34",K.BROWSER=j([c,d,a]),K.CPU=j([h]),K.DEVICE=j([s,l,u,p,f,g,m,v,E]),K.ENGINE=K.OS=j([c,d]),eE.exports&&(tE=eE.exports=K),tE.UAParser=K;var Y=typeof e!==r&&(e.jQuery||e.Zepto);if(Y&&!Y.ua){var X=new K;Y.ua=X.getResult(),Y.ua.get=function(){return X.getUA()},Y.ua.set=function(e){X.setUA(e);var t=X.getResult();for(var n in t)Y.ua[n]=t[n]}}}("object"==typeof window?window:t);var dE=i(cE.exports),lE=pn,uE=Ze,hE=Y,pE=xo,_E=ht("iterator"),EE=Object,fE=function(e){if(hE(e))return!1;var t=EE(e);return void 0!==t[_E]||"@@iterator"in t||uE(pE,lE(t))},mE=i(fE),TE=h$1;wi({global:!0,forced:TE.globalThis!==TE},{globalThis:TE});var SE=i(h$1),gE=Ad.clear;wi({global:!0,bind:!0,enumerable:!0,forced:h$1.clearImmediate!==gE},{clearImmediate:gE});var RE="function"==typeof Bun&&Bun&&"string"==typeof Bun.version,CE=h$1,IE=m,vE=w,yE=RE,AE=ce,bE=Xc,wE=Zc,OE=CE.Function,NE=/MSIE .\./.test(AE)||yE&&function(){var e=CE.Bun.version.split(".");return e.length<3||0==e[0]&&(e[1]<3||3==e[1]&&0==e[2])}(),DE=wi,PE=h$1,LE=Ad.set,kE=function(e,t){var n=t?2:1;return NE?function(r,i){var o=wE(arguments.length,1)>n,a=vE(r)?r:OE(r),s=o?bE(arguments,n):[],c=o?function(){IE(a,this,s)}:a;return t?e(c,i):e(c)}:e},ME=PE.setImmediate?kE(LE,!1):LE;DE({global:!0,bind:!0,enumerable:!0,forced:PE.setImmediate!==ME},{setImmediate:ME});var UE=i(ie.setImmediate),xE=wi,VE=$d,FE=De,BE=Zc,jE=jn,GE=h$1.process;xE({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(e){BE(arguments.length,1),FE(e);var t=jE&&GE.domain;VE(t?t.bind(e):e)}});var WE=i(ie.queueMicrotask);function HE(e,t){return function(){return e.apply(t,arguments)}}const{toString:KE}=Object.prototype,{getPrototypeOf:YE}=Object,qE=(zE=Object.create(null),e=>{const t=KE.call(e);return zE[t]||(zE[t]=t.slice(8,-1).toLowerCase())});var zE;const JE=e=>(e=e.toLowerCase(),t=>qE(t)===e),XE=e=>t=>typeof t===e,{isArray:QE}=Array,ZE=XE("undefined"),$E=JE("ArrayBuffer"),ef=XE("string"),tf=XE("function"),nf=XE("number"),rf=e=>null!==e&&"object"==typeof e,of=e=>{if("object"!==qE(e))return!1;const t=YE(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||mE(e))},sf=JE("Date"),af=JE("File"),cf=JE("Blob"),df=JE("FileList"),lf=JE("URLSearchParams"),[uf,hf,pf,_f]=["ReadableStream","Request","Response","Headers"].map(JE);function Ef(e,t){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=e)if("object"!=typeof e&&(e=[e]),QE(e))for(n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else{const r=i?Object.getOwnPropertyNames(e):Object.keys(e),o=r.length;let a;for(n=0;n<o;n++)a=r[n],t.call(null,e[a],a,e)}}function ff(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,i=n.length;for(;i-- >0;)if(r=n[i],t===r.toLowerCase())return r;return null}const mf=void 0!==SE?SE:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Tf=e=>!ZE(e)&&e!==mf,Sf=(gf="undefined"!=typeof Uint8Array&&YE(Uint8Array),e=>gf&&e instanceof gf);var gf;const Rf=JE("HTMLFormElement"),Cf=(e=>{let{hasOwnProperty:t}=e;return(e,n)=>t.call(e,n)})(Object.prototype),If=JE("RegExp"),vf=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};Ef(n,(n,i)=>{let o;!1!==(o=t(n,i,e))&&(r[i]=o||n)}),Object.defineProperties(e,r)},yf="abcdefghijklmnopqrstuvwxyz",Af="0123456789",bf={DIGIT:Af,ALPHA:yf,ALPHA_DIGIT:yf+yf.toUpperCase()+Af},wf=JE("AsyncFunction"),Of=(Nf="function"==typeof UE,Df=tf(mf.postMessage),Nf?UE:Df?(Pf="axios@".concat(Math.random()),Lf=[],mf.addEventListener("message",e=>{let{source:t,data:n}=e;t===mf&&n===Pf&&Lf.length&&Lf.shift()()},!1),e=>{Lf.push(e),mf.postMessage(Pf,"*")}):e=>setTimeout(e));var Nf,Df,Pf,Lf;const kf=void 0!==WE?WE.bind(mf):"undefined"!=typeof process&&process.nextTick||Of;var Mf={isArray:QE,isArrayBuffer:$E,isBuffer:function(e){return null!==e&&!ZE(e)&&null!==e.constructor&&!ZE(e.constructor)&&tf(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&("function"==typeof FormData&&e instanceof FormData||tf(e.append)&&("formdata"===(t=qE(e))||"object"===t&&tf(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&$E(e.buffer),t},isString:ef,isNumber:nf,isBoolean:e=>!0===e||!1===e,isObject:rf,isPlainObject:of,isReadableStream:uf,isRequest:hf,isResponse:pf,isHeaders:_f,isUndefined:ZE,isDate:sf,isFile:af,isBlob:cf,isRegExp:If,isFunction:tf,isStream:e=>rf(e)&&tf(e.pipe),isURLSearchParams:lf,isTypedArray:Sf,isFileList:df,forEach:Ef,merge:function e(){const{caseless:t}=Tf(this)&&this||{},n={},r=(r,i)=>{const o=t&&ff(n,i)||i;n[o]=of(n[o])&&of(r)?e(n[o],r):of(r)?e({},r):QE(r)?r.slice():r};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&Ef(arguments[e],r);return n},extend:function(e,t,n){let{allOwnKeys:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Ef(t,(t,r)=>{e[r]=n&&tf(t)?HE(t,n):t},{allOwnKeys:r}),e},trim:e=>jp(e)?jp(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let i,o,a;const s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)a=i[o],r&&!r(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=!1!==n&&YE(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:qE,kindOfTest:JE,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length);const r=e.indexOf(t,n-=t.length);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(QE(e))return e;let t=e.length;if(!nf(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:Rf,hasOwnProperty:Cf,hasOwnProp:Cf,reduceDescriptors:vf,freezeMethods:e=>{vf(e,(t,n)=>{if(tf(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;tf(e[n])&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach(e=>{n[e]=!0})};return QE(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:ff,global:mf,isContextDefined:Tf,ALPHABET:bf,generateString:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bf.ALPHA_DIGIT,n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&tf(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(rf(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const i=QE(e)?[]:{};return Ef(e,(e,t)=>{const o=n(e,r+1);!ZE(o)&&(i[t]=o)}),t[r]=void 0,i}}return e};return n(e,0)},isAsyncFn:wf,isThenable:e=>e&&(rf(e)||tf(e))&&tf(e.then)&&tf(e.catch),setImmediate:Of,asap:kf};function Uf(e,t,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}Mf.inherits(Uf,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Mf.toJSONObject(this.config),code:this.code,status:this.status}}});const xf=Uf.prototype,Vf={};function Ff(e){return Mf.isPlainObject(e)||Mf.isArray(e)}function Bf(e){return Mf.endsWith(e,"[]")?e.slice(0,-2):e}function jf(e,t,n){return e?e.concat(t).map(function(e,t){return e=Bf(e),!n&&t?"["+e+"]":e}).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Vf[e]={value:e}}),Object.defineProperties(Uf,Vf),Object.defineProperty(xf,"isAxiosError",{value:!0}),Uf.from=(e,t,n,r,i,o)=>{const a=Object.create(xf);return Mf.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e),Uf.call(a,e.message,t,n,r,i),a.cause=e,a.name=e.name,o&&Object.assign(a,o),a};const Gf=Mf.toFlatObject(Mf,{},null,function(e){return/^is[A-Z]/.test(e)});function Wf(e,t,n){if(!Mf.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=Mf.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!Mf.isUndefined(t[e])})).metaTokens,i=n.visitor||u,o=n.dots,a=n.indexes,s=(n.Blob||"undefined"!=typeof Blob&&Blob)&&Mf.isSpecCompliantForm(t);if(!Mf.isFunction(i))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(Mf.isDate(e))return e.toISOString();if(!s&&Mf.isBlob(e))throw new Uf("Blob is not supported. Use a Buffer instead.");return Mf.isArrayBuffer(e)||Mf.isTypedArray(e)?s&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function u(e,n,i){let s=e;if(e&&!i&&"object"==typeof e)if(Mf.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(Mf.isArray(e)&&function(e){return Mf.isArray(e)&&!e.some(Ff)}(e)||(Mf.isFileList(e)||Mf.endsWith(n,"[]"))&&(s=Mf.toArray(e)))return n=Bf(n),s.forEach(function(e,r){!Mf.isUndefined(e)&&null!==e&&t.append(!0===a?jf([n],r,o):null===a?n:n+"[]",c(e))}),!1;return!!Ff(e)||(t.append(jf(i,n,o),c(e)),!1)}const l=[],d=Object.assign(Gf,{defaultVisitor:u,convertValue:c,isVisitable:Ff});if(!Mf.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!Mf.isUndefined(n)){if(-1!==l.indexOf(n))throw Error("Circular reference detected in "+r.join("."));l.push(n),Mf.forEach(n,function(n,o){!0===(!(Mf.isUndefined(n)||null===n)&&i.call(t,n,Mf.isString(o)?jp(o).call(o):o,r,d))&&e(n,r?r.concat(o):[o])}),l.pop()}}(e),t}function Hf(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Kf(e,t){this._pairs=[],e&&Wf(e,this,t)}const Yf=Kf.prototype;function qf(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zf(e,t,n){if(!t)return e;const r=n&&n.encode||qf,i=n&&n.serialize;let o;if(o=i?i(t,n):Mf.isURLSearchParams(t)?t.toString():new Kf(t,n).toString(r),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}Yf.append=function(e,t){this._pairs.push([e,t])},Yf.toString=function(e){const t=e?function(t){return e.call(this,t,Hf)}:Hf;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};var Jf=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Mf.forEach(this.handlers,function(t){null!==t&&e(t)})}},Xf={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Qf={exports:{}},Zf=wi,$f=N,em=Qt.f;Zf({target:"Object",stat:!0,forced:Object.defineProperty!==em,sham:!$f},{defineProperty:em});var tm=ie.Object,im=Qf.exports=function(e,t,n){return tm.defineProperty(e,t,n)};tm.defineProperty.sham&&(im.sham=!0);var nm=i(Qf.exports),rm=R,om=Array.isArray||function(e){return"Array"==rm(e)},sm=TypeError,am=om,cm=jc,dm=te,lm=ht("species"),um=Array,hm=function(e){var t;return am(e)&&(cm(t=e.constructor)&&(t===um||am(t.prototype))||dm(t)&&null===(t=t[lm]))&&(t=void 0),void 0===t?um:t},pm=function(e,t){return new(hm(e))(0===t?0:t)},_m=n,Em=Ee,fm=ht("species"),mm=function(e){return Em>=51||!_m(function(){var t=[];return(t.constructor={})[fm]=function(){return{foo:1}},1!==t[e](Boolean).foo})},Tm=wi,Sm=n,gm=om,Rm=te,Cm=Je,Im=Gi,vm=function(e){if(e>9007199254740991)throw sm("Maximum allowed index exceeded");return e},ym=E_,Am=pm,bm=mm,wm=Ee,Om=ht("isConcatSpreadable"),Nm=wm>=51||!Sm(function(){var e=[];return e[Om]=!1,e.concat()[0]!==e}),Dm=function(e){if(!Rm(e))return!1;var t=e[Om];return void 0!==t?!!t:gm(e)};Tm({target:"Array",proto:!0,arity:1,forced:!Nm||!bm("concat")},{concat:function(e){var t,n,r,i,o,a=Cm(this),s=Am(a,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(Dm(o=-1===t?a:arguments[t]))for(i=Im(o),vm(c+i),n=0;n<i;n++,c++)n in o&&ym(s,c,o[n]);else vm(c+1),ym(s,c++,o);return s.length=c,s}});var Pm={},Lm=R,km=Z,Mm=Or.f,Um=R_,xm="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Pm.f=function(e){return xm&&"Window"==Lm(e)?function(e){try{return Mm(e)}catch(e){return Um(xm)}}(e):Mm(km(e))};var Vm={},Fm=ht;Vm.f=Fm;var Bm=ie,jm=Ze,Gm=Vm,Wm=Qt.f,Hm=function(e){var t=Bm.Symbol||(Bm.Symbol={});jm(t,e)||Wm(t,e,{value:Gm.f(e)})},Km=L,Ym=ae,qm=ht,zm=ha,Jm=function(){var e=Ym("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,r=qm("toPrimitive");t&&!t[r]&&zm(t,r,function(e){return Km(n,this)},{arity:1})},Xm=Xt,Qm=K,Zm=Je,$m=Gi,eT=pm,tT=d([].push),iT=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,l,d){for(var h,p,f=Zm(c),m=Qm(f),g=Xm(u,l),v=$m(m),E=0,y=d||eT,_=t?y(c,v):n||a?y(c,0):void 0;v>E;E++)if((s||E in m)&&(p=g(h=m[E],E,f),e))if(t)_[E]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return E;case 2:tT(_,h)}else switch(e){case 4:return!1;case 7:tT(_,h)}return o?-1:r||i?i:_}},nT={forEach:iT(0),map:iT(1),filter:iT(2),some:iT(3),every:iT(4),find:iT(5),findIndex:iT(6),filterReject:iT(7)},rT=wi,oT=h$1,sT=L,aT=d,cT=N,dT=Se,lT=n,uT=Ze,hT=l,pT=ii,_T=Z,ET=Ct,fT=fn,mT=B,TT=Io,ST=eo,gT=Or,RT=Pm,CT=Br,IT=O,vT=Qt,yT=Qr,AT=k,bT=ha,wT=hc,OT=Ye,NT=Nr,DT=nt,PT=ht,LT=Vm,kT=Hm,MT=Jm,UT=Da,xT=ra,VT=nT.forEach,FT=lr("hidden"),BT="Symbol",jT="prototype",GT=xT.set,WT=xT.getterFor(BT),HT=Object[jT],KT=oT.Symbol,YT=KT&&KT[jT],qT=oT.TypeError,zT=oT.QObject,JT=IT.f,XT=vT.f,QT=RT.f,ZT=AT.f,$T=aT([].push),eS=OT("symbols"),tS=OT("op-symbols"),iS=OT("wks"),nS=!zT||!zT[jT]||!zT[jT].findChild,rS=cT&&lT(function(){return 7!=TT(XT({},"a",{get:function(){return XT(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=JT(HT,t);r&&delete HT[t],XT(e,t,n),r&&e!==HT&&XT(HT,t,r)}:XT,oS=function(e,t){var n=eS[e]=TT(YT);return GT(n,{type:BT,tag:e,description:t}),cT||(n.description=t),n},sS=function(e,t,n){e===HT&&sS(tS,t,n),pT(e);var r=ET(t);return pT(n),uT(eS,r)?(n.enumerable?(uT(e,FT)&&e[FT][r]&&(e[FT][r]=!1),n=TT(n,{enumerable:mT(0,!1)})):(uT(e,FT)||XT(e,FT,mT(1,{})),e[FT][r]=!0),rS(e,r,n)):XT(e,r,n)},aS=function(e,t){pT(e);var n=_T(t),r=ST(n).concat(uS(n));return VT(r,function(t){cT&&!sT(cS,n,t)||sS(e,t,n[t])}),e},cS=function(e){var t=ET(e),n=sT(ZT,this,t);return!(this===HT&&uT(eS,t)&&!uT(tS,t))&&(!(n||!uT(this,t)||!uT(eS,t)||uT(this,FT)&&this[FT][t])||n)},dS=function(e,t){var n=_T(e),r=ET(t);if(n!==HT||!uT(eS,r)||uT(tS,r)){var i=JT(n,r);return!i||!uT(eS,r)||uT(n,FT)&&n[FT][r]||(i.enumerable=!0),i}},lS=function(e){var t=QT(_T(e)),n=[];return VT(t,function(e){uT(eS,e)||uT(NT,e)||$T(n,e)}),n},uS=function(e){var t=e===HT,n=QT(t?tS:_T(e)),r=[];return VT(n,function(e){!uT(eS,e)||t&&!uT(HT,e)||$T(r,eS[e])}),r};dT||(bT(YT=(KT=function(){if(hT(YT,this))throw qT("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?fT(arguments[0]):void 0,t=DT(e),n=function(e){this===HT&&sT(n,tS,e),uT(this,FT)&&uT(this[FT],t)&&(this[FT][t]=!1),rS(this,t,mT(1,e))};return cT&&nS&&rS(HT,t,{configurable:!0,set:n}),oS(t,e)})[jT],"toString",function(){return WT(this).tag}),bT(KT,"withoutSetter",function(e){return oS(DT(e),e)}),AT.f=cS,vT.f=sS,yT.f=aS,IT.f=dS,gT.f=RT.f=lS,CT.f=uS,LT.f=function(e){return oS(PT(e),e)},cT&&wT(YT,"description",{configurable:!0,get:function(){return WT(this).description}})),rT({global:!0,constructor:!0,wrap:!0,forced:!dT,sham:!dT},{Symbol:KT}),VT(ST(iS),function(e){kT(e)}),rT({target:BT,stat:!0,forced:!dT},{useSetter:function(){nS=!0},useSimple:function(){nS=!1}}),rT({target:"Object",stat:!0,forced:!dT,sham:!cT},{create:function(e,t){return void 0===t?TT(e):aS(TT(e),t)},defineProperty:sS,defineProperties:aS,getOwnPropertyDescriptor:dS}),rT({target:"Object",stat:!0,forced:!dT},{getOwnPropertyNames:lS}),MT(),UT(KT,BT),NT[FT]=!0;var hS=Se&&!!Symbol.for&&!!Symbol.keyFor,pS=wi,_S=ae,ES=Ze,fS=fn,mS=Ye,TS=hS,SS=mS("string-to-symbol-registry"),gS=mS("symbol-to-string-registry");pS({target:"Symbol",stat:!0,forced:!TS},{for:function(e){var t=fS(e);if(ES(SS,t))return SS[t];var n=_S("Symbol")(t);return SS[t]=n,gS[n]=t,n}});var RS=wi,CS=Ze,IS=ye,vS=be,yS=hS,AS=Ye("symbol-to-string-registry");RS({target:"Symbol",stat:!0,forced:!yS},{keyFor:function(e){if(!IS(e))throw TypeError(vS(e)+" is not a symbol");if(CS(AS,e))return AS[e]}});var bS=om,wS=w,OS=R,NS=fn,DS=d([].push),PS=wi,LS=ae,kS=m,MS=L,US=d,xS=n,VS=w,FS=ye,BS=Xc,jS=function(e){if(wS(e))return e;if(bS(e)){for(var t=e.length,n=[],r=0;r<t;r++){var i=e[r];"string"==typeof i?DS(n,i):"number"!=typeof i&&"Number"!=OS(i)&&"String"!=OS(i)||DS(n,NS(i))}var o=n.length,a=!0;return function(e,t){if(a)return a=!1,t;if(bS(this))return t;for(var r=0;r<o;r++)if(n[r]===e)return t}}},GS=Se,WS=String,HS=LS("JSON","stringify"),KS=US(/./.exec),YS=US("".charAt),qS=US("".charCodeAt),zS=US("".replace),JS=US(1..toString),XS=/[\uD800-\uDFFF]/g,QS=/^[\uD800-\uDBFF]$/,ZS=/^[\uDC00-\uDFFF]$/,$S=!GS||xS(function(){var e=LS("Symbol")();return"[null]"!=HS([e])||"{}"!=HS({a:e})||"{}"!=HS(Object(e))}),eg=xS(function(){return'"\\udf06\\ud834"'!==HS("\udf06\ud834")||'"\\udead"'!==HS("\udead")}),tg=function(e,t){var n=BS(arguments),r=jS(t);if(VS(r)||void 0!==e&&!FS(e))return n[1]=function(e,t){if(VS(r)&&(t=MS(r,this,WS(e),t)),!FS(t))return t},kS(HS,null,n)},ig=function(e,t,n){var r=YS(n,t-1),i=YS(n,t+1);return KS(QS,e)&&!KS(ZS,i)||KS(ZS,e)&&!KS(QS,r)?"\\u"+JS(qS(e,0),16):e};HS&&PS({target:"JSON",stat:!0,arity:3,forced:$S||eg},{stringify:function(e,t,n){var r=BS(arguments),i=kS($S?tg:HS,null,r);return eg&&"string"==typeof i?zS(i,XS,ig):i}});var ng=Br,rg=Je;wi({target:"Object",stat:!0,forced:!Se||n(function(){ng.f(1)})},{getOwnPropertySymbols:function(e){var t=ng.f;return t?t(rg(e)):[]}}),Hm("asyncIterator"),Hm("hasInstance"),Hm("isConcatSpreadable"),Hm("iterator"),Hm("match"),Hm("matchAll"),Hm("replace"),Hm("search"),Hm("species"),Hm("split");var og=Jm;Hm("toPrimitive"),og();var sg=ae,ag=Da;Hm("toStringTag"),ag(sg("Symbol"),"Symbol"),Hm("unscopables"),Da(h$1.JSON,"JSON",!0);var cg=ie.Symbol,dg=ht,lg=Qt.f,ug=dg("metadata"),hg=Function.prototype;void 0===hg[ug]&&lg(hg,ug,{value:null}),Hm("dispose"),Hm("metadata");var pg=cg;Hm("asyncDispose");var _g=d,Eg=ae("Symbol"),fg=Eg.keyFor,mg=_g(Eg.prototype.valueOf),Tg=Eg.isRegisteredSymbol||function(e){try{return void 0!==fg(mg(e))}catch(e){return!1}};wi({target:"Symbol",stat:!0},{isRegisteredSymbol:Tg});for(var Sg=Ye,gg=ae,Rg=d,Cg=ye,Ig=ht,vg=gg("Symbol"),yg=vg.isWellKnownSymbol,Ag=gg("Object","getOwnPropertyNames"),bg=Rg(vg.prototype.valueOf),wg=Sg("wks"),Og=0,Ng=Ag(vg),Dg=Ng.length;Og<Dg;Og++)try{var Pg=Ng[Og];Cg(vg[Pg])&&Ig(Pg)}catch(e){}var Lg=function(e){if(yg&&yg(e))return!0;try{for(var t=bg(e),n=0,r=Ag(wg),i=r.length;n<i;n++)if(wg[r[n]]==t)return!0}catch(e){}return!1};wi({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Lg}),Hm("matcher"),Hm("observable"),wi({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Tg}),wi({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Lg}),Hm("metadataKey"),Hm("patternMatch"),Hm("replaceAll");var kg=i(pg),Mg=i(Vm.f("iterator"));function Ug(e){return Ug="function"==typeof kg&&"symbol"==typeof Mg?function(e){return typeof e}:function(e){return e&&"function"==typeof kg&&e.constructor===kg&&e!==kg.prototype?"symbol":typeof e},Ug(e)}var xg=i(Vm.f("toPrimitive"));function Vg(e){var t=function(e){if("object"!==Ug(e)||null===e)return e;var t=e[xg];if(void 0!==t){var n=t.call(e,"string");if("object"!==Ug(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===Ug(t)?t:String(t)}function Fg(e,t,n){return(t=Vg(t))in e?nm(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Bg=n,jg=ht("iterator"),Gg=!Bg(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2"),r="";return e.pathname="c%20d",t.forEach(function(e,n){t.delete("b"),r+=n+e}),n.delete("a",2),!e.toJSON||!n.has("a",1)||n.has("a",2)||!t.size&&!0||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[jg]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://").host||"#%D0%B1"!==new URL("http://a#").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host}),Wg=ha,Hg=wi,Kg=h$1,Yg=L,qg=d,zg=N,Jg=Gg,Xg=ha,Qg=hc,Zg=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:Wg(e,r,t[r],n);return e},$g=Da,eR=Va,tR=ra,iR=Sc,nR=w,rR=Ze,oR=Xt,sR=pn,aR=ii,cR=te,dR=fn,lR=Io,uR=B,hR=es,pR=qo,_R=Zc,ER=b_,fR=ht("iterator"),mR="URLSearchParams",TR=mR+"Iterator",SR=tR.set,gR=tR.getterFor(mR),RR=tR.getterFor(TR),CR=Object.getOwnPropertyDescriptor,IR=function(e){if(!zg)return Kg[e];var t=CR(Kg,e);return t&&t.value},vR=IR("fetch"),yR=IR("Request"),AR=IR("Headers"),bR=yR&&yR.prototype,wR=AR&&AR.prototype,OR=Kg.RegExp,NR=Kg.TypeError,DR=Kg.decodeURIComponent,PR=Kg.encodeURIComponent,LR=qg("".charAt),kR=qg([].join),MR=qg([].push),UR=qg("".replace),xR=qg([].shift),VR=qg([].splice),FR=qg("".split),BR=qg("".slice),jR=/\+/g,GR=Array(4),WR=function(e){return GR[e-1]||(GR[e-1]=OR("((?:%[\\da-f]{2}){"+e+"})","gi"))},HR=function(e){try{return DR(e)}catch(t){return e}},KR=function(e){var t=UR(e,jR," "),n=4;try{return DR(t)}catch(e){for(;n;)t=UR(t,WR(n--),HR);return t}},YR=/[!'()~]|%20/g,qR={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},zR=function(e){return qR[e]},JR=function(e){return UR(PR(e),YR,zR)},XR=eR(function(e,t){SR(this,{type:TR,iterator:hR(gR(e).entries),kind:t})},"Iterator",function(){var e=RR(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n},!0),QR=function(e){this.entries=[],this.url=null,void 0!==e&&(cR(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===LR(e,0)?BR(e,1):e:dR(e)))};QR.prototype={type:mR,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,r,i,o,a,s,c=pR(e);if(c)for(n=(t=hR(e,c)).next;!(r=Yg(n,t)).done;){if(o=(i=hR(aR(r.value))).next,(a=Yg(o,i)).done||(s=Yg(o,i)).done||!Yg(o,i).done)throw NR("Expected sequence with length 2");MR(this.entries,{key:dR(a.value),value:dR(s.value)})}else for(var u in e)rR(e,u)&&MR(this.entries,{key:u,value:dR(e[u])})},parseQuery:function(e){if(e)for(var t,n,r=FR(e,"&"),i=0;i<r.length;)(t=r[i++]).length&&(n=FR(t,"="),MR(this.entries,{key:KR(xR(n)),value:KR(kR(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],r=0;r<t.length;)e=t[r++],MR(n,JR(e.key)+"="+JR(e.value));return kR(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ZR=function(){iR(this,$R);var e=SR(this,new QR(arguments.length>0?arguments[0]:void 0));zg||(this.size=e.entries.length)},$R=ZR.prototype;if(Zg($R,{append:function(e,t){var n=gR(this);_R(arguments.length,2),MR(n.entries,{key:dR(e),value:dR(t)}),zg||this.length++,n.updateURL()},delete:function(e){for(var t=gR(this),n=_R(arguments.length,1),r=t.entries,i=dR(e),o=n<2?void 0:arguments[1],a=void 0===o?o:dR(o),s=0;s<r.length;){var c=r[s];if(c.key!==i||void 0!==a&&c.value!==a)s++;else if(VR(r,s,1),void 0!==a)break}zg||(this.size=r.length),t.updateURL()},get:function(e){var t=gR(this).entries;_R(arguments.length,1);for(var n=dR(e),r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){var t=gR(this).entries;_R(arguments.length,1);for(var n=dR(e),r=[],i=0;i<t.length;i++)t[i].key===n&&MR(r,t[i].value);return r},has:function(e){for(var t=gR(this).entries,n=_R(arguments.length,1),r=dR(e),i=n<2?void 0:arguments[1],o=void 0===i?i:dR(i),a=0;a<t.length;){var s=t[a++];if(s.key===r&&(void 0===o||s.value===o))return!0}return!1},set:function(e,t){var n=gR(this);_R(arguments.length,1);for(var r,i=n.entries,o=!1,a=dR(e),s=dR(t),c=0;c<i.length;c++)(r=i[c]).key===a&&(o?VR(i,c--,1):(o=!0,r.value=s));o||MR(i,{key:a,value:s}),zg||(this.size=i.length),n.updateURL()},sort:function(){var e=gR(this);ER(e.entries,function(e,t){return e.key>t.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,n=gR(this).entries,r=oR(e,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new XR(this,"keys")},values:function(){return new XR(this,"values")},entries:function(){return new XR(this,"entries")}},{enumerable:!0}),Xg($R,fR,$R.entries,{name:"entries"}),Xg($R,"toString",function(){return gR(this).serialize()},{enumerable:!0}),zg&&Qg($R,"size",{get:function(){return gR(this).entries.length},configurable:!0,enumerable:!0}),$g(ZR,mR),Hg({global:!0,constructor:!0,forced:!Jg},{URLSearchParams:ZR}),!Jg&&nR(AR)){var eC=qg(wR.has),tC=qg(wR.set),iC=function(e){if(cR(e)){var t,n=e.body;if(sR(n)===mR)return t=e.headers?new AR(e.headers):new AR,eC(t,"content-type")||tC(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),lR(e,{body:uR(0,dR(n)),headers:uR(0,t)})}return e};if(nR(vR)&&Hg({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return vR(e,arguments.length>1?iC(arguments[1]):{})}}),nR(yR)){var nC=function(e){return iR(this,bR),new yR(e,arguments.length>1?iC(arguments[1]):{})};bR.constructor=nC,nC.prototype=bR,Hg({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:nC})}}var rC={URLSearchParams:ZR,getState:gR},oC=i(ie.URLSearchParams),sC={isBrowser:!0,classes:{URLSearchParams:void 0!==oC?oC:Kf,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]};const aC="undefined"!=typeof window&&"undefined"!=typeof document,cC="object"==typeof navigator&&navigator||void 0,dC=aC&&(!cC||["ReactNative","NativeScript","NS"].indexOf(cC.product)<0),lC="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,uC=aC&&window.location.href||"http://localhost";function hC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hC(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hC(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var _C=pC(pC({},Object.freeze({__proto__:null,hasBrowserEnv:aC,hasStandardBrowserEnv:dC,hasStandardBrowserWebWorkerEnv:lC,navigator:cC,origin:uC})),sC),EC=ii,fC=L,mC=Ze,TC=l,SC=function(){var e=EC(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},gC=RegExp.prototype,RC=function(e){var t=e.flags;return void 0!==t||"flags"in gC||mC(e,"flags")||!TC(gC,e)?t:fC(SC,e)},CC=Ch.charAt,IC=L,vC=ii,yC=w,AC=R,bC=/./.exec,wC=TypeError,OC=wi,NC=L,DC=v,PC=Va,LC=ic,kC=J,MC=Bi,UC=fn,xC=ii,VC=Y,FC=R,BC=tn,jC=RC,GC=ke,WC=n,HC=Jc,KC=function(e,t,n){return t+(n?CC(e,t).length:1)},YC=function(e,t){var n=e.exec;if(yC(n)){var r=IC(n,e,t);return null!==r&&vC(r),r}if("RegExp"===AC(e))return IC(bC,e,t);throw wC("RegExp#exec called on incompatible receiver")},qC=ra,zC=ht("matchAll"),JC="RegExp String",XC=JC+" Iterator",QC=qC.set,ZC=qC.getterFor(XC),$C=TypeError,eI=DC("".indexOf),tI=DC("".matchAll),iI=!!tI&&!WC(function(){tI("a",/./)}),nI=PC(function(e,t,n,r){QC(this,{type:XC,regexp:e,string:t,global:n,unicode:r,done:!1})},JC,function(){var e=ZC(this);if(e.done)return LC(void 0,!0);var t=e.regexp,n=e.string,r=YC(t,n);return null===r?(e.done=!0,LC(void 0,!0)):e.global?(""===UC(r[0])&&(t.lastIndex=KC(n,MC(t.lastIndex),e.unicode)),LC(r,!1)):(e.done=!0,LC(r,!1))}),rI=function(e){var t,n,r,i=xC(this),o=UC(e),a=HC(i,RegExp),s=UC(jC(i));return t=new a(a===RegExp?i.source:i,s),n=!!~eI(s,"g"),r=!!~eI(s,"u"),t.lastIndex=MC(i.lastIndex),new nI(t,o,n,r)};OC({target:"String",proto:!0,forced:iI},{matchAll:function(e){var t,n,r,i,o=kC(this);if(VC(e)){if(iI)return tI(o,e)}else{if(BC(e)&&(t=UC(kC(jC(e))),!~eI(t,"g")))throw $C("`.matchAll` does not allow non-global regexes");if(iI)return tI(o,e);if(void 0===(r=GC(e,zC))&&"RegExp"==FC(e)&&(r=rI),r)return NC(r,e,o)}return n=UC(o),i=new RegExp(e,"g"),NC(rI,i,n)}});var oI=Xi("String").matchAll,sI=l,aI=oI,cI=String.prototype,dI=function(e){var t=e.matchAll;return"string"==typeof e||e===cI||sI(cI,e)&&t===cI.matchAll?aI:t},lI=i(dI);function uI(e){function t(e,n,r,i){let o=e[i++];if("__proto__"===o)return!0;const a=Number.isFinite(+o),s=i>=e.length;return o=!o&&Mf.isArray(r)?r.length:o,s?(r[o]=Mf.hasOwnProp(r,o)?[r[o],n]:n,!a):(r[o]&&Mf.isObject(r[o])||(r[o]=[]),t(e,n,r[o],i)&&Mf.isArray(r[o])&&(r[o]=function(e){const t={},n=Object.keys(e);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],t[o]=e[o];return t}(r[o])),!a)}if(Mf.isFormData(e)&&Mf.isFunction(e.entries)){const n={};return Mf.forEachEntry(e,(e,r)=>{t(function(e){return lI(Mf).call(Mf,/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),r,n,0)}),n}return null}const hI={transitional:Xf,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,i=Mf.isObject(e);if(i&&Mf.isHTMLForm(e)&&(e=new FormData(e)),Mf.isFormData(e))return r?JSON.stringify(uI(e)):e;if(Mf.isArrayBuffer(e)||Mf.isBuffer(e)||Mf.isStream(e)||Mf.isFile(e)||Mf.isBlob(e)||Mf.isReadableStream(e))return e;if(Mf.isArrayBufferView(e))return e.buffer;if(Mf.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Wf(e,new _C.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return _C.isNode&&Mf.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=Mf.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Wf(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||r?(t.setContentType("application/json",!1),function(e){if(Mf.isString(e))try{return(0,JSON.parse)(e),jp(Mf).call(Mf,e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||hI.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(Mf.isResponse(e)||Mf.isReadableStream(e))return e;if(e&&Mf.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw Uf.from(e,Uf.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:_C.classes.FormData,Blob:_C.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Mf.forEach(["delete","get","head","post","put","patch"],e=>{hI.headers[e]={}});var pI=hI;const _I=Mf.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),EI=Symbol("internals");function fI(e){var t;return e&&jp(t=String(e)).call(t).toLowerCase()}function mI(e){return!1===e||null==e?e:Mf.isArray(e)?e.map(mI):String(e)}function TI(e,t,n,r,i){return Mf.isFunction(r)?r.call(this,t,n):(i&&(t=n),Mf.isString(t)?Mf.isString(r)?-1!==t.indexOf(r):Mf.isRegExp(r)?r.test(t):void 0:void 0)}class SI{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function i(e,t,n){const i=fI(t);if(!i)throw new Error("header name must be a non-empty string");const o=Mf.findKey(r,i);(!o||void 0===r[o]||!0===n||void 0===n&&!1!==r[o])&&(r[o||t]=mI(e))}const o=(e,t)=>Mf.forEach(e,(e,n)=>i(e,n,t));if(Mf.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(Mf.isString(e)&&(e=jp(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(jp(a=e).call(a)))o((e=>{const t={};let n,r,i;return e&&e.split("\n").forEach(function(e){var o,a;i=e.indexOf(":"),n=jp(o=e.substring(0,i)).call(o).toLowerCase(),r=jp(a=e.substring(i+1)).call(a),!n||t[n]&&_I[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)}),t})(e),t);else if(Mf.isHeaders(e))for(const[t,r]of e.entries())i(r,t,n);else null!=e&&i(t,e,n);var a;return this}get(e,t){if(e=fI(e)){const n=Mf.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(Mf.isFunction(t))return t.call(this,e,n);if(Mf.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=fI(e)){const n=Mf.findKey(this,e);return!(!n||void 0===this[n]||t&&!TI(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function i(e){if(e=fI(e)){const i=Mf.findKey(n,e);!i||t&&!TI(0,n[i],i,t)||(delete n[i],r=!0)}}return Mf.isArray(e)?e.forEach(i):i(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const i=t[n];e&&!TI(0,this[i],i,e,!0)||(delete this[i],r=!0)}return r}normalize(e){const t=this,n={};return Mf.forEach(this,(r,i)=>{var o;const a=Mf.findKey(n,i);if(a)return t[a]=mI(r),void delete t[i];const s=e?function(e){return jp(e).call(e).toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}(i):jp(o=String(i)).call(o);s!==i&&delete t[i],t[s]=mI(r),n[s]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return Mf.forEach(this,(n,r)=>{null!=n&&!1!==n&&(t[r]=e&&Mf.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[EI]=this[EI]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=fI(e);t[r]||(function(e,t){const n=Mf.toCamelCase(" "+t);["get","set","has"].forEach(r=>{Object.defineProperty(e,r+n,{value:function(e,n,i){return this[r].call(this,t,e,n,i)},configurable:!0})})}(n,e),t[r]=!0)}return Mf.isArray(e)?e.forEach(r):r(e),this}}SI.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Mf.reduceDescriptors(SI.prototype,(e,t)=>{let{value:n}=e,r=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(e){this[r]=e}}}),Mf.freezeMethods(SI);var gI=SI;function RI(e,t){const n=this||pI,r=t||n,i=gI.from(r.headers);let o=r.data;return Mf.forEach(e,function(e){o=e.call(n,o,i.normalize(),t?t.status:void 0)}),i.normalize(),o}function CI(e){return!(!e||!e.__CANCEL__)}function II(e,t,n){Uf.call(this,null==e?"canceled":e,Uf.ERR_CANCELED,t,n),this.name="CanceledError"}function vI(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Uf("Request failed with status code "+n.status,[Uf.ERR_BAD_REQUEST,Uf.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Mf.inherits(II,Uf,{__CANCEL__:!0});const yI=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=0;const i=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let i,o=0,a=0;return t=void 0!==t?t:1e3,function(s){const c=Date.now(),u=r[a];i||(i=c),n[o]=s,r[o]=c;let l=a,d=0;for(;l!==o;)d+=n[l++],l%=e;if(o=(o+1)%e,o===a&&(a=(a+1)%e),c-i<t)return;const h=u&&c-u;return h?Math.round(1e3*d/h):void 0}}(50,250);return function(e,t){let n,r,i=0,o=1e3/t;const a=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=o,n=null,r&&(clearTimeout(r),r=null),e.apply(null,t)};return[function(){const e=Date.now(),t=e-i;for(var s=arguments.length,c=new Array(s),u=0;u<s;u++)c[u]=arguments[u];t>=o?a(c,e):(n=c,r||(r=setTimeout(()=>{r=null,a(n)},o-t)))},()=>n&&a(n)]}(n=>{const o=n.loaded,a=n.lengthComputable?n.total:void 0,s=o-r,c=i(s);r=o,e({loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:c||void 0,estimated:c&&a&&o<=a?(a-o)/c:void 0,event:n,lengthComputable:null!=a,[t?"download":"upload"]:!0})},n)},AI=(e,t)=>{const n=null!=e;return[r=>t[0]({lengthComputable:n,total:e,loaded:r}),t[1]]},bI=e=>function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Mf.asap(()=>e(...n))};var wI=_C.hasStandardBrowserEnv?function(){const e=_C.navigator&&/(msie|trident)/i.test(_C.navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=Mf.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0},OI=_C.hasStandardBrowserEnv?{write(e,t,n,r,i,o){const a=[e+"="+encodeURIComponent(t)];Mf.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),Mf.isString(r)&&a.push("path="+r),Mf.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function NI(e,t){return e&&!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}function DI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}const PI=e=>e instanceof gI?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?DI(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DI(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},e):e;function LI(e,t){t=t||{};const n={};function r(e,t,n){return Mf.isPlainObject(e)&&Mf.isPlainObject(t)?Mf.merge.call({caseless:n},e,t):Mf.isPlainObject(t)?Mf.merge({},t):Mf.isArray(t)?t.slice():t}function i(e,t,n){return Mf.isUndefined(t)?Mf.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function o(e,t){if(!Mf.isUndefined(t))return r(void 0,t)}function a(e,t){return Mf.isUndefined(t)?Mf.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function s(n,i,o){return o in t?r(n,i):o in e?r(void 0,n):void 0}const c={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(e,t)=>i(PI(e),PI(t),!0)};return Mf.forEach(Object.keys(Object.assign({},e,t)),function(r){const o=c[r]||i,a=o(e[r],t[r],r);Mf.isUndefined(a)&&o!==s||(n[r]=a)}),n}var kI=e=>{const t=LI({},e);let n,{data:r,withXSRFToken:i,xsrfHeaderName:o,xsrfCookieName:a,headers:s,auth:c}=t;if(t.headers=s=gI.from(s),t.url=zf(NI(t.baseURL,t.url),e.params,e.paramsSerializer),c&&s.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),Mf.isFormData(r))if(_C.hasStandardBrowserEnv||_C.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if(!1!==(n=s.getContentType())){const[e,...t]=n?n.split(";").map(e=>jp(e).call(e)).filter(Boolean):[];s.setContentType([e||"multipart/form-data",...t].join("; "))}if(_C.hasStandardBrowserEnv&&(i&&Mf.isFunction(i)&&(i=i(t)),i||!1!==i&&wI(t.url))){const e=o&&a&&OI.read(a);e&&s.set(o,e)}return t},MI="undefined"!=typeof XMLHttpRequest&&function(e){return new Gh(function(t,n){const r=kI(e);let i=r.data;const o=gI.from(r.headers).normalize();let a,s,c,u,l,{responseType:d,onUploadProgress:h,onDownloadProgress:p}=r;function f(){u&&u(),l&&l(),r.cancelToken&&r.cancelToken.unsubscribe(a),r.signal&&r.signal.removeEventListener("abort",a)}let m=new XMLHttpRequest;function g(){if(!m)return;const r=gI.from("getAllResponseHeaders"in m&&m.getAllResponseHeaders());vI(function(e){t(e),f()},function(e){n(e),f()},{data:d&&"text"!==d&&"json"!==d?m.response:m.responseText,status:m.status,statusText:m.statusText,headers:r,config:e,request:m}),m=null}m.open(r.method.toUpperCase(),r.url,!0),m.timeout=r.timeout,"onloadend"in m?m.onloadend=g:m.onreadystatechange=function(){m&&4===m.readyState&&(0!==m.status||m.responseURL&&0===m.responseURL.indexOf("file:"))&&setTimeout(g)},m.onabort=function(){m&&(n(new Uf("Request aborted",Uf.ECONNABORTED,e,m)),m=null)},m.onerror=function(){n(new Uf("Network Error",Uf.ERR_NETWORK,e,m)),m=null},m.ontimeout=function(){let t=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";r.timeoutErrorMessage&&(t=r.timeoutErrorMessage),n(new Uf(t,(r.transitional||Xf).clarifyTimeoutError?Uf.ETIMEDOUT:Uf.ECONNABORTED,e,m)),m=null},void 0===i&&o.setContentType(null),"setRequestHeader"in m&&Mf.forEach(o.toJSON(),function(e,t){m.setRequestHeader(t,e)}),Mf.isUndefined(r.withCredentials)||(m.withCredentials=!!r.withCredentials),d&&"json"!==d&&(m.responseType=r.responseType),p&&([c,l]=yI(p,!0),m.addEventListener("progress",c)),h&&m.upload&&([s,u]=yI(h),m.upload.addEventListener("progress",s),m.upload.addEventListener("loadend",u)),(r.cancelToken||r.signal)&&(a=t=>{m&&(n(!t||t.type?new II(null,e,m):t),m.abort(),m=null)},r.cancelToken&&r.cancelToken.subscribe(a),r.signal&&(r.signal.aborted?a():r.signal.addEventListener("abort",a)));const v=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(r.url);v&&-1===_C.protocols.indexOf(v)?n(new Uf("Unsupported protocol "+v+":",Uf.ERR_BAD_REQUEST,e)):m.send(i||null)})},UI=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let n,r=new AbortController;const i=function(e){if(!n){n=!0,a();const t=e instanceof Error?e:this.reason;r.abort(t instanceof Uf?t:new II(t instanceof Error?t.message:t))}};let o=t&&setTimeout(()=>{o=null,i(new Uf("timeout ".concat(t," of ms exceeded"),Uf.ETIMEDOUT))},t);const a=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:s}=r;return s.unsubscribe=()=>Mf.asap(a),s}},xI=jh,VI=Sl;wi({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=VI.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var FI=Sl,BI=el;wi({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=FI.f(this),n=BI(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var jI=i(xI),GI=Vm.f("asyncIterator"),WI=i(GI);function HI(e,t){this.v=e,this.k=t}function KI(e){var t,n;function r(t,n){try{var o=e[t](n),a=o.value,s=a instanceof HI;jI.resolve(s?a.v:a).then(function(n){if(s){var c="return"===t?"return":"next";if(!a.k||n.done)return r(c,n);n=e[c](n).value}i(o.done?"return":"normal",n)},function(e){r("throw",e)})}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new jI(function(o,a){var s={key:e,arg:i,resolve:o,reject:a,next:null};n?n=n.next=s:(t=n=s,r(e,i))})},"function"!=typeof e.return&&(this.return=void 0)}function YI(e){return function(){return new KI(e.apply(this,arguments))}}function qI(e){return new HI(e,0)}function zI(e){var t={},n=!1;function r(t,r){return n=!0,{done:!1,value:new HI(r=new jI(function(n){n(e[t](r))}),1)}}return t[void 0!==kg&&Mg||"@@iterator"]=function(){return this},t.next=function(e){return n?(n=!1,e):r("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(n)throw n=!1,e;return r("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return n?(n=!1,e):r("return",e)}),t}KI.prototype["function"==typeof kg&&WI||"@@asyncIterator"]=function(){return this},KI.prototype.next=function(e){return this._invoke("next",e)},KI.prototype.throw=function(e){return this._invoke("throw",e)},KI.prototype.return=function(e){return this._invoke("return",e)};var JI=i(GI);function XI(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=JI,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new QI(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function QI(e){function t(e){if(Object(e)!==e)return Gh.reject(new TypeError(e+" is not an object."));var t=e.done;return Gh.resolve(e.value).then(function(e){return{value:e,done:t}})}return QI=function(e){this.s=e,this.n=e.next},QI.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Gh.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Gh.reject(e):t(n.apply(this.s,arguments))}},new QI(e)}const ZI=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let r,i=0;for(;i<n;)r=i+t,yield e.slice(i,r),i=r},$I=function(){var e=YI(function*(e,t){var n,r=!1,i=!1;try{for(var o,a=XI(ev(e));r=!(o=yield qI(a.next())).done;r=!1){const e=o.value;yield*zI(XI(ZI(e,t)))}}catch(e){i=!0,n=e}finally{try{r&&null!=a.return&&(yield qI(a.return()))}finally{if(i)throw n}}});return function(t,n){return e.apply(this,arguments)}}(),ev=function(){var e=YI(function*(e){if(e[JI])return void(yield*zI(XI(e)));const t=e.getReader();try{for(;;){const{done:e,value:n}=yield qI(t.read());if(e)break;yield n}}finally{yield qI(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),tv=(e,t,n,r)=>{const i=$I(e,t);let o,a=0,s=e=>{o||(o=!0,r&&r(e))};return new ReadableStream({async pull(e){try{const{done:t,value:r}=await i.next();if(t)return s(),void e.close();if(n){let e=a+=r.byteLength;n(e)}e.enqueue(new Uint8Array(r))}catch(e){throw s(e),e}},cancel:e=>(s(e),i.return())},{highWaterMark:2})};function iv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function nv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?iv(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iv(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const rv="function"==typeof fetch&&"function"==typeof Request&&"function"==typeof Response,ov=rv&&"function"==typeof ReadableStream,sv=rv&&("function"==typeof TextEncoder?(av=new TextEncoder,e=>av.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var av;const cv=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return!!e(...n)}catch(e){return!1}},dv=ov&&cv(()=>{let e=!1;const t=new Request(_C.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),lv=ov&&cv(()=>Mf.isReadableStream(new Response("").body)),uv={stream:lv&&(e=>e.body)};var hv;rv&&(hv=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!uv[e]&&(uv[e]=Mf.isFunction(hv[e])?t=>t[e]():(t,n)=>{throw new Uf("Response type '".concat(e,"' is not supported"),Uf.ERR_NOT_SUPPORT,n)})}));const pv=async(e,t)=>{const n=Mf.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(Mf.isBlob(e))return e.size;if(Mf.isSpecCompliantForm(e)){const t=new Request(_C.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return Mf.isArrayBufferView(e)||Mf.isArrayBuffer(e)?e.byteLength:(Mf.isURLSearchParams(e)&&(e+=""),Mf.isString(e)?(await sv(e)).byteLength:void 0)})(t):n};var _v=rv&&(async e=>{let{url:t,method:n,data:r,signal:i,cancelToken:o,timeout:a,onDownloadProgress:s,onUploadProgress:c,responseType:u,headers:l,withCredentials:d="same-origin",fetchOptions:h}=kI(e);u=u?(u+"").toLowerCase():"text";let p,f=UI([i,o&&o.toAbortSignal()],a);const m=f&&f.unsubscribe&&(()=>{f.unsubscribe()});let g;try{if(c&&dv&&"get"!==n&&"head"!==n&&0!==(g=await pv(l,r))){let e,n=new Request(t,{method:"POST",body:r,duplex:"half"});if(Mf.isFormData(r)&&(e=n.headers.get("content-type"))&&l.setContentType(e),n.body){const[e,t]=AI(g,yI(bI(c)));r=tv(n.body,65536,e,t)}}Mf.isString(d)||(d=d?"include":"omit");const i="credentials"in Request.prototype;p=new Request(t,nv(nv({},h),{},{signal:f,method:n.toUpperCase(),headers:l.normalize().toJSON(),body:r,duplex:"half",credentials:i?d:void 0}));let o=await fetch(p);const a=lv&&("stream"===u||"response"===u);if(lv&&(s||a&&m)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=o[t]});const t=Mf.toFiniteNumber(o.headers.get("content-length")),[n,r]=s&&AI(t,yI(bI(s),!0))||[];o=new Response(tv(o.body,65536,n,()=>{r&&r(),m&&m()}),e)}u=u||"text";let v=await uv[Mf.findKey(uv,u)||"text"](o,e);return!a&&m&&m(),await new Gh((t,n)=>{vI(t,n,{data:v,headers:gI.from(o.headers),status:o.status,statusText:o.statusText,config:e,request:p})})}catch(t){if(m&&m(),t&&"TypeError"===t.name&&/fetch/i.test(t.message))throw Object.assign(new Uf("Network Error",Uf.ERR_NETWORK,e,p),{cause:t.cause||t});throw Uf.from(t,t&&t.code,e,p)}});const Ev={http:null,xhr:MI,fetch:_v};Mf.forEach(Ev,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}});const fv=e=>"- ".concat(e),mv=e=>Mf.isFunction(e)||null===e||!1===e;var Tv={getAdapter:e=>{e=Mf.isArray(e)?e:[e];const{length:t}=e;let n,r;const i={};for(let o=0;o<t;o++){let t;if(n=e[o],r=n,!mv(n)&&(r=Ev[(t=String(n)).toLowerCase()],void 0===r))throw new Uf("Unknown adapter '".concat(t,"'"));if(r)break;i[t||"#"+o]=r}if(!r){const e=Object.entries(i).map(e=>{let[t,n]=e;return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")});throw new Uf("There is no suitable adapter to dispatch the request "+(t?e.length>1?"since :\n"+e.map(fv).join("\n"):" "+fv(e[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:Ev};function Sv(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new II(null,e)}function gv(e){return Sv(e),e.headers=gI.from(e.headers),e.data=RI.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Tv.getAdapter(e.adapter||pI.adapter)(e).then(function(t){return Sv(e),t.data=RI.call(e,e.transformResponse,t),t.headers=gI.from(t.headers),t},function(t){return CI(t)||(Sv(e),t&&t.response&&(t.response.data=RI.call(e,e.transformResponse,t.response),t.response.headers=gI.from(t.response.headers))),Gh.reject(t)})}const Rv="1.7.7",Cv={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Cv[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});const Iv={};Cv.transitional=function(e,t,n){function r(e,t){return"[Axios v"+Rv+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,i,o)=>{if(!1===e)throw new Uf(r(i," has been removed"+(t?" in "+t:"")),Uf.ERR_DEPRECATED);return t&&!Iv[i]&&(Iv[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};var vv={assertOptions:function(e,t,n){if("object"!=typeof e)throw new Uf("options must be an object",Uf.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let i=r.length;for(;i-- >0;){const o=r[i],a=t[o];if(a){const t=e[o],n=void 0===t||a(t,o,e);if(!0!==n)throw new Uf("option "+o+" must be "+n,Uf.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new Uf("Unknown option "+o,Uf.ERR_BAD_OPTION)}},validators:Cv};const yv=vv.validators;let Av=class{constructor(e){this.defaults=e,this.interceptors={request:new Jf,response:new Jf}}async request(e,t){try{return await this._request(e,t)}catch(e){if(e instanceof Error){let t;Error.captureStackTrace?Error.captureStackTrace(t={}):t=new Error;const n=t.stack?t.stack.replace(/^.+\n/,""):"";try{e.stack?n&&!String(e.stack).endsWith(n.replace(/^.+\n.+\n/,""))&&(e.stack+="\n"+n):e.stack=n}catch(e){}}throw e}}_request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=LI(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:i}=t;void 0!==n&&vv.assertOptions(n,{silentJSONParsing:yv.transitional(yv.boolean),forcedJSONParsing:yv.transitional(yv.boolean),clarifyTimeoutError:yv.transitional(yv.boolean)},!1),null!=r&&(Mf.isFunction(r)?t.paramsSerializer={serialize:r}:vv.assertOptions(r,{encode:yv.function,serialize:yv.function},!0)),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&Mf.merge(i.common,i[t.method]);i&&Mf.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=gI.concat(o,i);const a=[];let s=!0;this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,a.unshift(e.fulfilled,e.rejected))});const c=[];let u;this.interceptors.response.forEach(function(e){c.push(e.fulfilled,e.rejected)});let l,d=0;if(!s){const e=[gv.bind(this),void 0];for(e.unshift.apply(e,a),e.push.apply(e,c),l=e.length,u=Gh.resolve(t);d<l;)u=u.then(e[d++],e[d++]);return u}l=a.length;let h=t;for(d=0;d<l;){const t=a[d++],n=a[d++];try{h=t(h)}catch(e){n.call(this,e);break}}try{u=gv.call(this,h)}catch(e){return Gh.reject(e)}for(d=0,l=c.length;d<l;)u=u.then(c[d++],c[d++]);return u}getUri(e){return zf(NI((e=LI(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};Mf.forEach(["delete","get","head","options"],function(e){Av.prototype[e]=function(t,n){return this.request(LI(n||{},{method:e,url:t,data:(n||{}).data}))}}),Mf.forEach(["post","put","patch"],function(e){function t(t){return function(n,r,i){return this.request(LI(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Av.prototype[e]=t(),Av.prototype[e+"Form"]=t(!0)});var bv=Av;class wv{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Gh(function(e){t=e});const n=this;this.promise.then(e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null}),this.promise.then=e=>{let t;const r=new Gh(e=>{n.subscribe(e),t=e}).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e(function(e,r,i){n.reason||(n.reason=new II(e,r,i),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new wv(function(t){e=t}),cancel:e}}}var Ov=wv;const Nv={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Nv).forEach(e=>{let[t,n]=e;Nv[n]=t});var Dv=Nv;const Pv=function e(t){const n=new bv(t),r=HE(bv.prototype.request,n);return Mf.extend(r,bv.prototype,n,{allOwnKeys:!0}),Mf.extend(r,n,null,{allOwnKeys:!0}),r.create=function(n){return e(LI(t,n))},r}(pI);Pv.Axios=bv,Pv.CanceledError=II,Pv.CancelToken=Ov,Pv.isCancel=CI,Pv.VERSION=Rv,Pv.toFormData=Wf,Pv.AxiosError=Uf,Pv.Cancel=Pv.CanceledError,Pv.all=function(e){return Gh.all(e)},Pv.spread=function(e){return function(t){return e.apply(null,t)}},Pv.isAxiosError=function(e){return Mf.isObject(e)&&!0===e.isAxiosError},Pv.mergeConfig=LI,Pv.AxiosHeaders=gI,Pv.formToJSON=e=>uI(Mf.isHTMLForm(e)?new FormData(e):e),Pv.getAdapter=Tv.getAdapter,Pv.HttpStatusCode=Dv,Pv.default=Pv;var Lv=Pv;const kv=()=>{};function Mv(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:kv};return e.promise=new Gh((t,n)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=t=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(t))}}),e}const Uv=new Map,xv=new Map,Vv=new Map;let Fv=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Bv=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const jv=new dE;let Gv=jv.getResult(),Wv=null;function Hv(e){if(!Wv){e&&jv.setUA(e),Gv=jv.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return Bv.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Bv.CHROME;case"Safari":case"Mobile Safari":return Bv.SAFARI;case"Edge":return Bv.EDGE;case"Firefox":return Bv.FIREFOX;case"QQ":case"QQBrowser":return Bv.QQ;case"Opera":return Bv.OPERA;case"WeChat":return Bv.WECHAT;default:return e.browser.name||""}}(Gv),n=Kv(Gv),r="Windows"===Gv.os.name?Gv.os.version?Gv.os.name+" "+Gv.os.version:Gv.os.name:Gv.os.name||"",i=Gv.os.version,o=Kv(Gv,!1),a=Gv.device.type;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i,browserVersion:o,deviceType:a};Wv={name:t,version:n,os:r,osVersion:i,browserVersion:o,deviceType:a}}return Wv}function Kv(e){let t;return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",arguments.length>1&&void 0!==arguments[1]&&!arguments[1]?t:t.split(".")[0]}function Yv(){return Hv().os}function qv(){const e=Hv();return"".concat(e.os," ").concat(e.osVersion)}function zv(){const e=Hv();return!!("WebKit"===Gv.engine.name&&e.os===Fv.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Bv.SAFARI||$v()&&e.name!==Bv.SAFARI)}function Jv(){return Hv().name===Bv.CHROME}function Xv(){return Hv().name===Bv.SAFARI}function Qv(){return Hv().name===Bv.EDGE}function Zv(){return Hv().name===Bv.FIREFOX}function $v(){return Hv().os===Fv.IOS}function ey(e){const t=Hv();return!(t.name!==Bv.CHROME||!t.osVersion)&&Number(t.version)>=e}function ty(e){const t=Hv();return!(t.name!==Bv.CHROME||!t.osVersion)&&Number(t.version)<e}function iy(e){const t=Hv();return!(t.name!==Bv.EDGE||!t.osVersion)&&Number(t.version)>=e}function ny(e){const t=Hv();return!(t.name!==Bv.SAFARI||!t.osVersion)&&Number(t.version)>=e}function ry(e,t,n){const r=Hv();if(r.os!==Fv.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function oy(e,t,n){const r=Hv();if(r.name!==Bv.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function sy(e){const t=Hv();return!(t.name!==Bv.OPERA||!t.osVersion)&&Number(t.version)>=e}function ay(){const e=Hv();if(e.os!==Fv.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function cy(){const e=Hv();if(e.os!==Fv.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function dy(){const e=Hv();if(e.os!==Fv.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function ly(){const e=Hv();if(e.os!==Fv.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function uy(){return Xv()&&navigator.maxTouchPoints>0}function hy(){return Hv().name===Bv.WECHAT}function py(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function _y(){const e=Yv();return function(){const{deviceType:e}=Hv();return"mobile"===e||"tablet"===e}()||e===Fv.ANDROID||e===Fv.IOS||e===Fv.HARMONY_OS}function Ey(){const e=Hv();return e.name!==Bv.EDGE&&e.name!==Bv.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function fy(){return Yv()===Fv.ANDROID}function my(){const e=Hv();return fy()&&(e.name===Bv.CHROME||e.name===Bv.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Ty(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function gy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sy(Object(n),!0).forEach(function(t){Ty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sy(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let Ry=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Cy=class extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),Ty(this,"code",void 0),Ty(this,"message",void 0),Ty(this,"data",void 0),Ty(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return"error"===e&&(t||console).error(this.toString()),"warning"===e&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Iy(e,t){if("boolean"!=typeof e)throw new Cy(Ry.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function vy(e,t,n){if(!Dn(n).call(n,e))throw new Cy(Ry.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function yy(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(e<n||e>r||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(e){return"number"==typeof e&&e%1==0}(e))throw new Cy(Ry.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function Ay(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new Cy(Ry.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&yy(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&yy(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&yy(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&yy(e.ideal,"".concat(t,".ideal"),1,1/0)}else yy(e,t,1,1/0)}function by(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new Cy(Ry.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!Ny(e,n,r,i))throw new Cy(Ry.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function wy(e,t){if(!Array.isArray(e))throw new Cy(Ry.INVALID_PARAMS,"".concat(t," should be an array"))}function Oy(e){return null==e}function Ny(e){return"string"==typeof e&&e.length<=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:255)&&e.length>=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)&&(!(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])||function(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}(e))}var Dy=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Dy||{}),Py=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(Py||{});const Ly=new class{constructor(){Ty(this,"_clientSize",null),Ty(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ty(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ty(this,"getStyle",e=>window.getComputedStyle(e,null)),Ty(this,"checkCssVisibleProperty",e=>{var t;let n=!0;const r=this.getStyle(e),{display:i,visibility:o,opacity:a,filter:s}=r;return("none"===i||Dn(t=["hidden","collapse"]).call(t,o)||Number(a)<.1)&&(n=!1),!!n&&(s&&s.split(" ").filter(e=>{var t;const n=e.split("(")[0];return Dn(t=["brightness","blur","opacity"]).call(t,n)}).map(e=>{const[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]}).forEach(e=>{const[t,r]=e;switch(t){case"brightness":(r<.1||r>3)&&(n=!1);break;case"blur":r>3&&(n=!1);break;case"opacity":r<.1&&(n=!1)}}),n)}),Ty(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const i=e=>t(e);let o=e;for(;o&&r;)i(o)||(n=!1,r=!1),o=o.parentElement,o||(r=!1);return n}),Ty(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Ty(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:i,top:o,bottom:a}=e.getBoundingClientRect(),s=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:o,bottom:a,clientWidth:s,clientHeight:c,clientMin:Math.min(s,c)}}),Ty(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),Ty(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),Ty(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return null!==r&&r!==n}),Ty(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,o=t/6,a=[],s=10**6;for(let e=0;e<5;e++)for(let t=0;t<5;t++)a.push({x:(n*s+(0===e?.1:4===e?(i*e*s-1e5)/s:i*e)*s)/s,y:(r*s+(0===t?.1:4===t?(o*t*s-1e5)/s:o*t)*s)/s});return[...a]}),Ty(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(e=>!!e).length>6),Ty(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),Ty(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:o,clientMin:a}=this._clientSize;let s,c,u,l;if(e<0)s=0;else{if(!(e<o))return!1;s=e}if(t<0)return!1;if(c=t<o?t:o,n<0)u=0;else{if(!(n<i))return!1;u=n}return!(r<0)&&(l=r<i?r:i,this.checkSizeIsVisible(c-s,l-u,a))}),Ty(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Ty(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Dy.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(Dy.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Dy.SIZE)}}return this.returnHiddenResult(Dy.STYLE)}return this.returnHiddenResult(Py.UNMOUNTED)}return this.returnHiddenResult(Py.INVALID_HTML_ELEMENT)}),Ty(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))}};function ky(e){return(new TextEncoder).encode(e)}const My=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Uy=async e=>function(e){let t="";return new Uint8Array(e).forEach(e=>{t+=e.toString(16).padStart(2,"0")}),t}(await crypto.subtle.digest("SHA-256",ky(e)));class xy{constructor(){Ty(this,"_events",{}),Ty(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map(e=>e);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let n=0;n<t.length;n+=1){const i=t[n];i.once&&this.off(e,i.listener),i.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach(t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(t){console.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}let Vy=null;function Fy(){if(Vy)return Vy;if(window.electron)return Vy=window.electron;if(!window.require)return null;try{return Vy=window.require("electron"),Vy}catch(e){return null}}let By=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e}({}),jy=function(e){return e.TRACER="tracer",e}({});function Gy(e){return yy(e.timeout,"config.timeout",0,1e5),yy(e.timeoutFactor,"config.timeoutFactor",0,100,!1),yy(e.maxRetryCount,"config.maxRetryConfig",0,1/0),yy(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Wy=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Hy=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Ky(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(e=>{if(!e.urls)throw Error()})}catch(e){return!1}return!0}function Yy(e){return by(e.turnServerURL,"turnServerURL"),by(e.username,"username"),by(e.password,"password"),e.udpport&&yy(e.udpport,"udpport",1,99999,!0),e.forceturn&&Iy(e.forceturn,"forceturn"),e.security&&Iy(e.security,"security"),e.tcpport&&yy(e.tcpport,"tcpport",1,99999,!0),!0}function qy(e){return void 0!==e.level&&vy(e.level,"level",[1,2,3]),void 0!==e.delay&&yy(e.delay,"delay",0,3e3,!0),!0}let zy=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Jy=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e}({}),Xy=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Qy=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Zy(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?Gh.reject(new Cy(Ry.UNEXPECTED_ERROR,"can not emit promise")):new Gh((n,i)=>{e.emit(t,...r,n,i)})}function $y(e,t){if(0===e.getListeners(t).length)return Gh.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Zy(e,t,...r)}function eA(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return tA(e,t,...r)}function tA(e,t){let n=null,r=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];if(e.emit(t,...o,e=>{n=e},e=>{r=e}),null!==r)throw r;if(null===n)throw new Cy(Ry.UNEXPECTED_ERROR,"handler is not sync");return n}const iA=new class extends xy{set networkState(e){this.emit(Qy.NETWORK_STATE_CHANGE,e,this._networkState),e===Xy.ONLINE?this.emit(Qy.ONLINE):e===Xy.OFFLINE&&(this.onlineWaiter=new Gh(e=>{this.once(Qy.ONLINE,()=>{this.onlineWaiter=void 0,e(Xy.ONLINE)})}),this.emit(Qy.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Xy.ONLINE}constructor(){super(),Ty(this,"_moduleName","network-indicator"),Ty(this,"_networkState",Xy.ONLINE),Ty(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Xy.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Xy.OFFLINE})}};function nA(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function rA(e){const t=[];return e.forEach(e=>{-1===t.indexOf(e)&&t.push(e)}),t}function oA(e){void 0!==Gh?Gh.resolve().then(e):setTimeout(e,0)}function sA(e){return JSON.parse(JSON.stringify(e))}function aA(e){try{return sA(e)}catch(t){return e}}const cA={};function dA(e,t){cA[t]||(cA[t]=!0,e())}function lA(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let e=0;e<t.length;e+=1)n[e]=t.charCodeAt(e);return n}function uA(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function hA(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,n=(new TextEncoder).encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const e=new Uint8Array(t);e.set(n),n=e}return n}function pA(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=Jn(t).call(t,(e,t)=>e+t.length,0),i=new Uint8Array(new ArrayBuffer(r));let o=0;return t.forEach(e=>{i.set(e,o),o+=e.length}),i}function _A(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function EA(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(e=>{t+="string"==typeof e?_A(e):e.size}),t+138}function fA(e){const t=new Cy(Ry.TIMEOUT,"timeout");return new Gh((n,r)=>{window.setTimeout(()=>r(t),e)})}function mA(e){return new Gh(t=>{window.setTimeout(t,e)})}function TA(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+TA(e-n.length,"")}function SA(){return TA(32,"").toUpperCase()}const gA=()=>{},RA=new class{constructor(){Ty(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,o=new Array(i>4?i-4:0),a=4;a<i;a++)o[a-4]=arguments[a];if(this.fnMap.has(t)){const i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);const a=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:a,args:o,skipFn:r})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,gy(gy({},i),{},{fn:e,args:o,skipFn:r}))}else{const i=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:o,skipFn:r})}}},CA=RA.throttleByKey.bind(RA);function IA(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}function vA(e,t){if(!IA(e)||!IA(t))return t;if(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let r=0;r<t.length;r++)n[r]=vA(e[r],t[r]);return n}{const n=gy({},e);for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=Object.prototype.hasOwnProperty.call(e,r)?vA(e[r],t[r]):t[r]);return n}}function yA(e,t){let n=[0];if(t&&(n=new Array(t).fill(0)),0===e)return n;let r=0;for(;e>0&&(n[r]=255&e,e>>=8,r++,!t||r!==t););return n}function AA(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function bA(e){const t="0123456789abcdef";function n(e){let n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,o,a){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,a)),o),n)}function o(e,t,n,r,o,a,s){return i(t&n|~t&r,e,t,o,a,s)}function a(e,t,n,r,o,a,s){return i(t&r|n&~r,e,t,o,a,s)}function s(e,t,n,r,o,a,s){return i(t^n^r,e,t,o,a,s)}function c(e,t,n,r,o,a,s){return i(n^(t|~r),e,t,o,a,s)}const u=function(e){let t;const n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e);let l,d,h,p,f,m=1732584193,g=-271733879,v=-1732584194,E=271733878;for(l=0;l<u.length;l+=16)d=m,h=g,p=v,f=E,m=o(m,g,v,E,u[l+0],7,-680876936),E=o(E,m,g,v,u[l+1],12,-389564586),v=o(v,E,m,g,u[l+2],17,606105819),g=o(g,v,E,m,u[l+3],22,-1044525330),m=o(m,g,v,E,u[l+4],7,-176418897),E=o(E,m,g,v,u[l+5],12,1200080426),v=o(v,E,m,g,u[l+6],17,-1473231341),g=o(g,v,E,m,u[l+7],22,-45705983),m=o(m,g,v,E,u[l+8],7,1770035416),E=o(E,m,g,v,u[l+9],12,-1958414417),v=o(v,E,m,g,u[l+10],17,-42063),g=o(g,v,E,m,u[l+11],22,-1990404162),m=o(m,g,v,E,u[l+12],7,1804603682),E=o(E,m,g,v,u[l+13],12,-40341101),v=o(v,E,m,g,u[l+14],17,-1502002290),g=o(g,v,E,m,u[l+15],22,1236535329),m=a(m,g,v,E,u[l+1],5,-165796510),E=a(E,m,g,v,u[l+6],9,-1069501632),v=a(v,E,m,g,u[l+11],14,643717713),g=a(g,v,E,m,u[l+0],20,-373897302),m=a(m,g,v,E,u[l+5],5,-701558691),E=a(E,m,g,v,u[l+10],9,38016083),v=a(v,E,m,g,u[l+15],14,-660478335),g=a(g,v,E,m,u[l+4],20,-405537848),m=a(m,g,v,E,u[l+9],5,568446438),E=a(E,m,g,v,u[l+14],9,-1019803690),v=a(v,E,m,g,u[l+3],14,-187363961),g=a(g,v,E,m,u[l+8],20,1163531501),m=a(m,g,v,E,u[l+13],5,-1444681467),E=a(E,m,g,v,u[l+2],9,-51403784),v=a(v,E,m,g,u[l+7],14,1735328473),g=a(g,v,E,m,u[l+12],20,-1926607734),m=s(m,g,v,E,u[l+5],4,-378558),E=s(E,m,g,v,u[l+8],11,-2022574463),v=s(v,E,m,g,u[l+11],16,1839030562),g=s(g,v,E,m,u[l+14],23,-35309556),m=s(m,g,v,E,u[l+1],4,-1530992060),E=s(E,m,g,v,u[l+4],11,1272893353),v=s(v,E,m,g,u[l+7],16,-155497632),g=s(g,v,E,m,u[l+10],23,-1094730640),m=s(m,g,v,E,u[l+13],4,681279174),E=s(E,m,g,v,u[l+0],11,-358537222),v=s(v,E,m,g,u[l+3],16,-722521979),g=s(g,v,E,m,u[l+6],23,76029189),m=s(m,g,v,E,u[l+9],4,-640364487),E=s(E,m,g,v,u[l+12],11,-421815835),v=s(v,E,m,g,u[l+15],16,530742520),g=s(g,v,E,m,u[l+2],23,-995338651),m=c(m,g,v,E,u[l+0],6,-198630844),E=c(E,m,g,v,u[l+7],10,1126891415),v=c(v,E,m,g,u[l+14],15,-1416354905),g=c(g,v,E,m,u[l+5],21,-57434055),m=c(m,g,v,E,u[l+12],6,1700485571),E=c(E,m,g,v,u[l+3],10,-1894986606),v=c(v,E,m,g,u[l+10],15,-1051523),g=c(g,v,E,m,u[l+1],21,-2054922799),m=c(m,g,v,E,u[l+8],6,1873313359),E=c(E,m,g,v,u[l+15],10,-30611744),v=c(v,E,m,g,u[l+6],15,-1560198380),g=c(g,v,E,m,u[l+13],21,1309151649),m=c(m,g,v,E,u[l+4],6,-145523070),E=c(E,m,g,v,u[l+11],10,-1120210379),v=c(v,E,m,g,u[l+2],15,718787259),g=c(g,v,E,m,u[l+9],21,-343485551),m=r(m,d),g=r(g,h),v=r(v,p),E=r(E,f);return n(m)+n(g)+n(v)+n(E)}let wA=1,OA=console,NA=class{static setLogger(e){OA=e}constructor(e){Ty(this,"lockingPromise",Gh.resolve()),Ty(this,"locks",0),Ty(this,"name",""),Ty(this,"lockId",void 0),this.lockId=wA++,e&&(this.name=e),OA.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,OA.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:""));const n=new Gh(n=>{t=()=>{this.locks-=1,OA.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:"")),n()}}),r=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function DA(e,t){return function(n,r,i){const o=i.value;if("function"!=typeof o)throw new Error("Cannot use mutex on object property.");return i.value=async function(){const n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const i=await n.lock("From ".concat(e,".").concat(r));try{for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return await o.apply(this,s)}finally{i()}},i}}const PA={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function LA(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function kA(e,t,n,r){const i=Object.assign({},PA,r);let o=i.timeout;const a=async()=>{await function(e){return new Gh(t=>{window.setTimeout(t,e)})}(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)};let s=!1;const c=new Gh(async(r,o)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(s)return o(new Cy(Ry.OPERATION_ABORTED));try{const n=await e();if(!t(n,c))return r(n);if(c+1===i.maxRetryCount)return r(n);await a()}catch(e){if(!n(e,c))return o(e);if(c+1===i.maxRetryCount)return o(e);await a()}}});return c.cancel=()=>s=!0,c}class MA{constructor(e){Ty(this,"input",[]),Ty(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:Jn(e=this.input).call(e,(e,t)=>e+t)/this.input.length}}let UA,xA=0,VA=0;function FA(e,t,n,r){return new Gh((i,o)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),xA+=_A(t.data)):n&&(t.data.size?xA+=t.data.size:t.data instanceof FormData?xA+=EA(t.data):xA+=_A(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Lv.request(t).then(e=>{"string"==typeof e.data?VA+=_A(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?VA+=e.data.byteLength:VA+=_A(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)}).catch(e=>{Lv.isCancel(e)?o(new Cy(Ry.OPERATION_ABORTED,"cancel token canceled")):o("ECONNABORTED"===e.code?new Cy(Ry.NETWORK_TIMEOUT,e.message):e.response?new Cy(Ry.NETWORK_RESPONSE_ERROR,e.response.status):new Cy(Ry.NETWORK_ERROR,e.message))})})}async function BA(e,t){const n=new Blob([t.data],{type:"buffer"});return await FA(e,gy(gy({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const jA=()=>void 0!==window.isSecureContext,GA=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[2];return"".concat(t[1],".").concat(e)}return"4.0.0.999"}("4.22.1"),WA=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}();let HA=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const KA=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let e=0;e<6;e++)i.push("1");const o=i.join(""),a={};return a[e]=r,a[t]=o,Object.assign(a,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=KA;const YA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},qA="v4.22.1-0-g1c8e27e9(9/19/2024, 2:23:30 PM)",zA=gy(gy({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:YA,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0,DISABLE_SCREEN_SHARE_REMB:!1},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0});function JA(e,t,n){var r,i,o;Dn(r=Object.keys(zA)).call(r,e)&&(!n&&Dn(i=Object.keys(QA)).call(i,e)||(zA[e]=t,"ENABLE_VIDEO_SEI"===e&&!0===t&&(zA.ENABLE_ENCODED_TRANSFORM=!0),"USE_NEW_NETWORK_CONFIG"===e&&t&&(zA.USE_NEW_NETWORK_CONFIG=o=!!t,o&&(zA.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],zA.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],zA.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],zA.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],zA.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",zA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",zA.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),"ENABLE_PRE_SUB"===e&&t&&(zA.ENABLE_INSTANT_VIDEO=!0,zA.ENABLE_PREALLOC_PC=!0),"ENABLE_SVC"===e&&t&&(zA.ENABLE_AUT_CC=!0)))}function XA(e){return zA[e]}WA||(zA.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],zA.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],zA.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],zA.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],zA.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],zA.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],zA.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",zA.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",zA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",zA.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",zA.AREAS=["NORTH_AMERICA","OVERSEA"]);const QA={};var ZA=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(ZA||{});class $A{constructor(e,t,n,r){Ty(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:HA.Default}}dispatch(e){this.state=function(e,t){switch(t.type){case ZA.SET_SESSION_ID:return gy(gy({},e),{},{sessionId:t.sessionId});case ZA.SET_P2P_ID:return gy(gy({},e),{},{p2pId:t.p2pId});case ZA.SET_UID:return gy(gy({},e),{},{uid:t.uid});case ZA.SET_INT_UID:return gy(gy({},e),{},{intUid:t.intUid});case ZA.SET_PUB_ID:return gy(gy({},e),{},{pubId:t.pubId});case ZA.KEY_METRIC_CLIENT_CREATED:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{clientCreated:t.metric})});case ZA.KEY_METRIC_JOIN_START:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{joinStart:t.metric})});case ZA.AVOID_JOIN_START:return gy(gy({},e),{},{avoidJoinStart:t.avoidJoinStart});case ZA.KEY_METRIC_JOIN_END:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{joinEnd:t.metric})});case ZA.KEY_METRIC_REQUEST_AP_START:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{requestAPStart:t.metric})});case ZA.KEY_METRIC_REQUEST_AP_END:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{requestAPEnd:t.metric})});case ZA.KEY_METRIC_JOIN_GATEWAY_START:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case ZA.KEY_METRIC_JOIN_GATEWAY_END:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case ZA.KEY_METRIC_PEER_CONNECTION_START:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case ZA.KEY_METRIC_PEER_CONNECTION_END:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case ZA.KEY_METRIC_DESCRIPTION_START:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{descriptionStart:t.metric})});case ZA.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case ZA.KEY_METRIC_ICE_CONNECTION_END:return gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case ZA.KEY_METRIC_PUBLISH:{const n=e.keyMetrics.publish,r=n.findIndex(e=>e.trackId===t.metric.trackId);return-1!==r?(n[r]=gy(gy({},n[r]),t.metric),gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{publish:[...n]})})):gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case ZA.KEY_METRIC_SUBSCRIBE:{const n=e.keyMetrics.subscribe,r=n.findIndex(e=>e.userId===t.metric.userId&&e.type===t.metric.type);return-1!==r?(n[r]=gy(gy({},n[r]),t.metric),gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{subscribe:[...n]})})):gy(gy({},e),{},{keyMetrics:gy(gy({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case ZA.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case ZA.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=gy(gy({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case ZA.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case ZA.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case ZA.SET_USE_P2P:return gy(gy({},e),{},{useP2P:t.val});case ZA.SET_TRANSPORT_TYPE:return gy(gy({},e),{},{p2pTransport:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:ZA.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:ZA.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:ZA.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:ZA.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:ZA.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:ZA.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:ZA.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:ZA.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:ZA.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:ZA.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ZA.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ZA.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ZA.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ZA.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ZA.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ZA.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ZA.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ZA.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ZA.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ZA.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ZA.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:ZA.KEY_METRIC_PUBLISH,metric:gy(gy({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,i,o,a){this.dispatch({type:ZA.KEY_METRIC_SUBSCRIBE,metric:gy(gy(gy(gy(gy({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}massSubscribe(e,t,n,r){e.forEach(e=>{this.dispatch({type:ZA.KEY_METRIC_SUBSCRIBE,metric:gy(gy(gy({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map(e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return"number"!=typeof t?(this.dispatch({type:ZA.RECORD_JOIN_CHANNEL_SERVICE,record:gy(gy({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ZA.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ZA.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ZA.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:ZA.AVOID_JOIN_START,avoidJoinStart:e})}}let eb=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});!function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"}({});const tb=128,ib=96,nb=1e3,rb=10;let ob=0;function sb(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ab(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function cb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ab(Object(n),!0).forEach(function(t){sb(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ab(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const db=new class extends xy{constructor(){super(...arguments),sb(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class lb{constructor(e){sb(this,"logger",void 0),sb(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function ub(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function hb(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const pb={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},_b=Date.now(),Eb=e=>{for(const t in pb)if(Object.prototype.hasOwnProperty.call(pb,t)&&pb[t]===e)return t;return"DEFAULT"},fb=new class{constructor(){sb(this,"proxyServerURL",void 0),sb(this,"logLevel",pb.DEBUG),sb(this,"uploadState","collecting"),sb(this,"uploadLogWaitingList",[]),sb(this,"uploadLogUploadingList",[]),sb(this,"uploadErrorCount",0),sb(this,"currentLogID",0),sb(this,"url",void 0),sb(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[pb.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[pb.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[pb.WARNING].concat(t);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[pb.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[pb.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){JA("UPLOAD_LOG",!0)}disableLogUpload(){JA("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new lb(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-_b<100)return void setTimeout(()=>{this.log(...t)},Date.now()-_b);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=ub()+" Agora-SDK [".concat(Eb(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=ub()+" %cAgora-SDK [".concat(Eb(r),"]:");let o=[];if(!XA("USE_NEW_LOG"))switch(r){case pb.DEBUG:o=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case pb.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case pb.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case pb.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-_b<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-_b);const r=Math.max(0,Math.min(4,t[0]));t[0]=ub()+" Agora-SDK [".concat(Eb(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!XA("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=hb()+" Agora-SDK [".concat(Eb(e),"]:"):n[0]=hb()+" Agora-SDK [".concat(Eb(e),"]:");let i="";n.forEach(e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:GA,process_id:XA("PROCESS_ID"),payload:JSON.stringify(e)};return kA(async()=>{const e=await Lv.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(XA("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(XA("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}},()=>(this.uploadLogUploadingList=[],!1),t=>{const n={status:-1,message:t.message,errorRange:e.map(e=>e.log_item_id)};return t.response?(n.status=t.response.status,n.data=t.response.data,n.headers=t.response.headers):t.request&&(n.status=t.request.status),db.reportLogUploadError(n),!0},{timeout:XA("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:XA("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,XA("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),XA("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),XA("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),XA("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var mb;function Tb(e){return by(e.reportId,"params.reportId",0,100,!1),by(e.category,"params.category",0,100,!1),by(e.event,"params.event",0,100,!1),by(e.label,"params.label",0,100,!1),yy(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(mb={}).FREE="free",mb.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const Sb={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let gb=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e}({}),Rb=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e}({});!function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}({});let Cb=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ib(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){const i=r.value;if("function"==typeof i){const o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];let s=r;if(e.argsMap)try{s=e.argsMap(this,...r)}catch(e){fb.warning(e),s=[]}try{JSON.stringify(s)}catch(e){fb.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),s=[]}const c=(e.report||vb).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(String(n)),options:s,tag:jy.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=i.apply(this,r);return t instanceof Gh?t.then(t=>(c.onSuccess(e.reportResult&&t),t)).catch(e=>{throw c.onError(e),e}):(c.onSuccess(e.reportResult&&t),t)}catch(e){throw c.onError(e),e}}}return r}}const vb=new class{constructor(){sb(this,"baseInfoMap",new Map),sb(this,"proxyServer",void 0),sb(this,"eventUploadTimer",void 0),sb(this,"setSessionIdTimer",void 0),sb(this,"url",void 0),sb(this,"sids",new Set),sb(this,"backupUrl",void 0),sb(this,"_appId",void 0),sb(this,"keyEventUploadPendingItems",[]),sb(this,"normalEventUploadPendingItems",[]),sb(this,"apiInvokeUploadPendingItems",[]),sb(this,"apiInvokeCount",0),sb(this,"ltsList",[]),sb(this,"lastSendNormalEventTime",Date.now()),sb(this,"customReportCounterTimer",void 0),sb(this,"customReportCount",0),sb(this,"extApiInvoke",async e=>{for(const t of e){const e=cb(cb({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:jy.TRACER});this.sendApiInvoke(e)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),XA("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),XA("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void fb.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),n=Date.now(),r=t.startTime;t.startTime=n,fb.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,o=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null}),a=!!XA("SHOW_REPORT_INVOKER_LOG");a&&fb.info("".concat(t.name," start"),t.options);let s=!1;mA(t.timeout).then(()=>{s||(this.sendApiInvoke(cb(cb({},o()),{},{error:Ry.API_INVOKE_TIMEOUT,success:!1})),fb.debug("".concat(t.name," timeout")))});const c=new Cy(Ry.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const r=()=>{if(s)throw c;return s=!0,this.sendApiInvoke(cb(cb({},o()),{},{success:!0},t.reportResult&&{result:e})),a&&fb.info("".concat(t.name," onSuccess")),e};return n?CA(r,t.name+"Success",n,()=>s=!0):r()},onError:e=>{const r=()=>{if(s)throw e;s=!0,this.sendApiInvoke(cb(cb({},o()),{},{success:!1,error:e})),a&&fb.info("".concat(t.name," onFailure"),e.toString())};return n?CA(r,t.name+"Error",n,()=>s=!0):r()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:XA("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:WA?"global":"oversea",areas:XA("AREAS")&&XA("AREAS").join(",")},t.extend),{stringUid:o,channelProfile:a,channelMode:s,isABTestSuccess:c,lsid:u,clientRole:l}=t,d=Date.now(),h=cb(cb({},r),{},{eventType:gb.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:qA,lts:d,elapse:d-n,extend:JSON.stringify(i),mode:t.mode,process:XA("PROCESS_ID"),appType:XA("APP_TYPE"),success:!0,version:GA,stringUid:o,channelProfile:a,channelMode:s,isABTestSuccess:c,lsid:u,clientType:Dn(p=window.navigator.userAgent).call(p,"AgoraWebView")?42:20,clientRole:l,serviceId:XA("PROCESS_ID"),extensionID:XA("PLUGIN_INFO").join(",")||""});var p;this.send({type:Rb.SESSION,data:h},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb({},r),{},{eventType:gb.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:Rb.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb({},r),{},{eventType:gb.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Rb.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:o,avoidJoinStartTime:a}=t,s=i-(o&&a?a:n.startTime),c=cb(cb({},r),{},{eventType:gb.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:s,eventElapse:i-t.lts,firstSuccess:o,signalChannel:t.signalChannel,preload:t.preload?1:0});t.succ&&(n.lastJoinSuccessTime=i),this.send({type:Rb.JOIN_GATEWAY,data:c},!0)}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=cb(cb({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:Rb.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb({},r),{},{eventType:gb.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Rb.PUBLISH,data:o},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,o=Date.now(),a=cb(cb({},i),{},{eventType:gb.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?a.peerSuid=t.peerid:a.peer=t.peerid,this.send({type:Rb.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var t;const n=[...d_(t=this.baseInfoMap).call(t)],r=this.baseInfoMap.get(n.length?n[0]:"UnableToGetSid");if(!r)return;const i=r.info,o=Date.now(),a=cb(cb({},i),{},{eventType:gb.WS_COMPRESSOR_INIT,lts:o,eventElapse:e.eventElapse,elapse:o-r.startTime,status:e.status?1:2});this.send({type:Rb.WS_COMPRESSOR_INIT,data:a},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),s=cb(cb(cb({},o),r),{},{elapse:a-i.startTime,eventType:t,lts:a,firstDecodeFrame:Math.max((r.firstFrame||a)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:s},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),s=cb(cb(cb({},o),r),{},{elapse:a-i.startTime,eventType:t,lts:a});this.send({type:n,data:s},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb(cb({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:gb.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:Rb.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb(cb({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),eventType:gb.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:Rb.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,a=Date.now(),s=cb(cb(cb({},o),r),{},{eventType:t,lts:a});this.send({type:n,data:s},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb({},r),{},{eventType:gb.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:Rb.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb({},r),{},{eventType:gb.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Rb.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb({},r),{},{eventType:gb.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Rb.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,fb.debug(e?"reportProxyServerurl: ".concat(e):"disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Rb.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(e,t){const n=e[t];if(!n||"string"!=typeof n)return[e];e[t]="";const r=_A(JSON.stringify(e));let i=0;const o=[];let a=0;for(let s=0;s<n.length;s++)a+=n.charCodeAt(s)<=127?1:3,a<=1300-r||(o[o.length]=gy(gy({},e),{},{[t]:n.substring(i,s)}),i=s,a=n.charCodeAt(s)<=127?1:3);return i!==n.length-1&&(o[o.length]=gy(gy({},e),{},{[t]:n.substring(i)})),o})(cb(cb(cb({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload").forEach(e=>this.send({type:Rb.WORKER_EVENT,data:e},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb(cb({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Rb.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb(cb({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:Rb.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=cb(cb(cb({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Rb.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>XA("CUSTOM_REPORT_LIMIT"))throw new Cy(Ry.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=t.map(t=>({type:Rb.USER_ANALYTICS,data:cb(cb({sid:e},t),{},{lts:n})}));try{XA("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(e){throw fb.error("send custom report message failed",e.toString()),new Cy(Ry.CUSTOM_REPORT_SEND_FAILED,e.message)}}sendApiInvoke(e){const t=XA("NOT_REPORT_EVENT");if(e.tag&&Dn(t)&&Dn(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:o}=n.info;let a;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Cy){const{code:t,message:n}=e.error;a=t||n||e.error.toString()}else a=e.error.toString();const s={invokeId:e.invokeId,sid:e.sid,cname:r,cid:o,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?a:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Rb.API_INVOKE,data:s},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(0===e.length)return;const t=Array.from(this.sids).find(e=>null!==e);t&&e.forEach(e=>{e&&(e.sid=t,this.sendApiInvoke(Object.assign({},e)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>XA("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const t=e.shift();n.length<20?n.push(t):r.push(t)}e.push(...r);for(const e of[...n]){var i;-1!==this.ltsList.indexOf(e.data.lts)?(e.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(e.data.lts)):(this.ltsList.push(e.data.lts),aE(i=this.ltsList).call(i,(e,t)=>e-t))}return t||(this.lastSendNormalEventTime=Date.now()),XA("ENABLE_EVENT_REPORT")?(n.length&&(XA("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{XA("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>XA("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-XA("NORMAL_EVENT_QUEUE_CAPACITY")),fb.warning("report: drop normal events"))))})(n)),e):e}async postDataToStatsCollector2(e){iA.networkState===Xy.OFFLINE&&await Gh.race([iA.onlineWaiter,mA(2*PA.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach(e=>{const n=ky(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(Rb).forEach(n=>{let[r,i]=n;i===e.type&&(t=Cb[r])}),t})(e),o=new DataView(r);o.setUint16(0,n.byteLength,!0),o.setUint8(2,255&i),o.setUint8(3,i>>>8&255),o.setUint8(4,i>>>16&255),t=My(t,new Uint8Array(r)),t=My(t,n)}),t},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(XA("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){1===i&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(XA("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await FA(r,{timeout:1e4,data:t(e),headers:cb(cb({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===i)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(e=>JSON.stringify(e)),vid:(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0])};iA.networkState===Xy.OFFLINE&&await Gh.race([iA.onlineWaiter,mA(2*PA.maxRetryTimeout)]);const r=t?"/events/proto-raws":"/events/messages";let i=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA("EVENT_REPORT_DOMAIN"),"&p=").concat(XA("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(XA("EVENT_REPORT_DOMAIN"),":").concat(XA("STATS_COLLECTOR_PORT")).concat(r));for(let e=0;e<2;e+=1){1===e&&(i=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(XA("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(XA("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(XA("STATS_COLLECTOR_PORT")).concat(r)));try{t?await BA(i,{timeout:1e4,data:n}):await FA(i,{timeout:1e4,data:n})}catch(t){if(1===e)throw t;continue}return}}createBaseInfo(e,t){const n=Object.assign({},Sb);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:jy.TRACER}).onSuccess()}};db.on("REPORT_LOG_UPLOAD",e=>{e.networkState=iA.networkState,vb.reportApiInvoke(null,{name:"logUploadError",options:e,tag:jy.TRACER}).onSuccess("logUploadError")});class yb extends Cy{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),sb(this,"name","AgoraRTCException")}print(){return super.print(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",fb)}throw(){super.throw(fb)}}const Ab=["CHINA","GLOBAL"],bb=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],wb=[];function Ob(e,t){return!!t&&wb.some(n=>n.uid===e&&n.channelName===t)}var Nb=nT.forEach,Db=Bn("forEach")?[].forEach:function(e){return Nb(this,e,arguments.length>1?arguments[1]:void 0)};wi({target:"Array",proto:!0,forced:[].forEach!=Db},{forEach:Db});var Pb=Xi("Array").forEach,Lb=pn,kb=Ze,Mb=l,Ub=Pb,xb=Array.prototype,Vb={DOMTokenList:!0,NodeList:!0},Fb=function(e){var t=e.forEach;return e===xb||Mb(xb,e)&&t===xb.forEach||kb(Vb,Lb(e))?Ub:t},Bb=i(Fb),jb=Je,Gb=eo;wi({target:"Object",stat:!0,forced:n(function(){Gb(1)})},{keys:function(e){return Gb(jb(e))}});var Wb=i(ie.Object.keys),Hb=i(zn),Kb=wi,Yb=om,qb=d([].reverse),zb=[1,2];Kb({target:"Array",proto:!0,forced:String(zb)===String(zb.reverse())},{reverse:function(){return Yb(this)&&(this.length=this.length),qb(this)}});var Jb=Xi("Array").reverse,Xb=l,Qb=Jb,Zb=Array.prototype,$b=function(e){var t=e.reverse;return e===Zb||Xb(Zb,e)&&t===Zb.reverse?Qb:t},ew=$b,tw=i(ew),iw=wi,nw=om,rw=jc,ow=te,sw=xi,aw=Gi,cw=Z,dw=E_,lw=ht,uw=Xc,hw=mm("slice"),pw=lw("species"),_w=Array,Ew=Math.max;iw({target:"Array",proto:!0,forced:!hw},{slice:function(e,t){var n,r,i,o=cw(this),a=aw(o),s=sw(e,a),c=sw(void 0===t?a:t,a);if(nw(o)&&((rw(n=o.constructor)&&(n===_w||nw(n.prototype))||ow(n)&&null===(n=n[pw]))&&(n=void 0),n===_w||void 0===n))return uw(o,s,c);for(r=new(void 0===n?_w:n)(Ew(c-s,0)),i=0;s<c;s++,i++)s in o&&dw(r,i,o[s]);return r.length=i,r}});var fw=Xi("Array").slice,mw=l,Tw=fw,Sw=Array.prototype,gw=function(e){var t=e.slice;return e===Sw||mw(Sw,e)&&t===Sw.slice?Tw:t},Rw=i(gw);function Cw(e,t,n,r,i){var o,a,s,c={};return Bb(o=Wb(r)).call(o,function(e){c[e]=r[e]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=Hb(a=tw(s=Rw(n).call(n)).call(s)).call(a,function(n,r){return r(e,t,n)||n},c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer&&(nm(e,t,c),c=null),c}let Iw=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),vw=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({}),yw=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),Aw=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),bw=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),ww=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Ow=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Nw=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Dw=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Pw=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),Lw=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),kw=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Mw=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Uw=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function xw(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw fb.error("Invalid Channel Name ".concat(e)),new yb(Ry.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Vw(e){if(!function(e){return"number"==typeof e&&Math.floor(e)===e&&0<=e&&e<=4294967295}(e)&&!Ny(e,1,255))throw new yb(Ry.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");"string"==typeof e&&fb.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Fw=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const Bw={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},jw={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Gw(e,t){by(e.url,"".concat(t,".url"),1,1e3,!1),Oy(e.x)||yy(e.x,"".concat(t,".x"),0,1e4),Oy(e.y)||yy(e.y,"".concat(t,".y"),0,1e4),Oy(e.width)||yy(e.width,"".concat(t,".width"),0,1e4),Oy(e.height)||yy(e.height,"".concat(t,".height"),0,1e4),Oy(e.zOrder)||yy(e.zOrder,"".concat(t,".zOrder"),0,255),Oy(e.alpha)||yy(e.alpha,"".concat(t,".alpha"),0,1,!1)}const Ww={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Hw=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),Kw=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Yw=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function qw(e){if(!e.channelName)throw new yb(Ry.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new yb(Ry.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&by(e.token,"info.token",1,2047),Vw(e.uid),xw(e.channelName),!0}let zw=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Jw=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Xw=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Qw=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Zw=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),$w=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e}({}),eO=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),tO=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),iO=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const nO=[iO.AFRICA,iO.ASIA,iO.CHINA,iO.EUROPE,iO.GLOBAL,iO.INDIA,iO.JAPAN,iO.NORTH_AMERICA,iO.OCEANIA,iO.OVERSEA,iO.SOUTH_AMERICA];let rO=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const oO={CHINA:{},ASIA:{CODE:rO.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:rO.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:rO.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:rO.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:rO.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:rO.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:rO.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:rO.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:rO.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:rO.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:rO.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:rO.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:rO.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};WA&&(oO.CHINA={CODE:rO.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let sO=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e}({});class aO extends xy{constructor(e,t){super(),Fg(this,"onICEConnectionStateChange",void 0),Fg(this,"onConnectionStateChange",void 0),Fg(this,"onDTLSTransportStateChange",void 0),Fg(this,"onDTLSTransportError",void 0),Fg(this,"onICETransportStateChange",void 0),Fg(this,"onFirstAudioReceived",void 0),Fg(this,"onFirstVideoReceived",void 0),Fg(this,"onFirstAudioDecoded",void 0),Fg(this,"onFirstVideoDecoded",void 0),Fg(this,"onFirstVideoDecodedTimeout",void 0),Fg(this,"onSelectedLocalCandidateChanged",void 0),Fg(this,"onSelectedRemoteCandidateChanged",void 0),Fg(this,"getLocalVideoStats",void 0)}}class cO extends aO{constructor(e,t){super(e,t),Fg(this,"establishPromise",void 0)}}let dO=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),lO=function(e){return e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY",e}({}),uO=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),hO=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),pO=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),_O=function(e){return e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),EO=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),fO=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),mO=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),TO=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),SO=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),gO=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),RO=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),CO=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),IO=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),vO=function(e){return e.ABORT="abort",e}({}),yO=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),AO=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const bO={[yw.ACCESS_POINT]:{[ww.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ww.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ww.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ww.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ww.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ww.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[yw.UNILBS]:{[bw.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[bw.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[bw.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[bw.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[bw.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[bw.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[bw.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[bw.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[bw.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[bw.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[bw.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[bw.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[yw.STRING_UID_ALLOCATOR]:{[Aw.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Aw.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Aw.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function wO(e){const t=bO[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===yw.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const OO={[Ow.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ow.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ow.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ow.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ow.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ow.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ow.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ow.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ow.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ow.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ow.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ow.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ow.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ow.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ow.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ow.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ow.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ow.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ow.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ow.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ow.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ow.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ow.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ow.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ow.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ow.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ow.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ow.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ow.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ow.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ow.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ow.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ow.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ow.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ow.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ow.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ow.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ow.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ow.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ow.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ow.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ow.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ow.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ow.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ow.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ow.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ow.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ow.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ow.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ow.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ow.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ow.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ow.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ow.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ow.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ow.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ow.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ow.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ow.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ow.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ow.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ow.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ow.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function NO(e){return OO[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function DO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function PO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?DO(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DO(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function LO(e){return e.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)}function kO(e,t){if("string"==typeof e)return e;const{proxy:n,host:r,port:i}=e;if(t){const e=XA("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===e?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(e,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const MO=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,UO=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,xO=/wss:\/\/(.+):([0-9]+)\/?/,VO=/wss:\/\/(.[^\/]+)\/?/;let FO=0;class BO{constructor(e,t){Fg(this,"id",0),Fg(this,"store",void 0),Fg(this,"recordIndex",void 0),Fg(this,"websockets",[]),Fg(this,"try443PortDuration",2e3),Fg(this,"forceCloseWSDuration",5e3),Fg(this,"try443PortTimeout",null),Fg(this,"forceCloseTimeout",null),Fg(this,"isTry443PortFailed",!1),Fg(this,"isNormalPortFailed",!1),Fg(this,"useDoubleDomain",!1),Fg(this,"useProxy",!1),Fg(this,"startTime",Date.now()),this.id=++FO,this.try443PortDuration=XA("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;const t=Date.now()-this.startTime;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];fb.debug("[choose-best-ws ".concat(null===(e=this.store)||void 0===e?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...r)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});const r=XA("GATEWAY_DOMAINS"),i=Date.now(),o=[],a=r.find(t=>{var n;return Dn(n=e.host).call(n,t)});a||(this.useDoubleDomain=!1);const s=[];if(this.useDoubleDomain)r.forEach(n=>{s.push(kO(PO(PO({},e),{},{host:e.host.replace(a,n)}),t))});else{const n=PO({},e);if(t&&a){const e=r.find(e=>e!==a);e&&(n.host=n.host.replace(a,e))}s.push(kO(n,t))}try{s.forEach(e=>{const t=new WebSocket(e);t.binaryType="arraybuffer",o.push(t),this.logger("ws is connecting:",t.url)})}catch(r){if(this.logger("ws create failed"),o.forEach(e=>e.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&443!==Number(e.port))return this.createWebSocket(e,!0,n);throw new yb(Ry.WS_ERR,"init websocket failed! Error: ".concat(r.toString()))}const c=Mv();return this.store&&this.store.recordJoinChannelService({urls:o.map(e=>e.url),service:"gateway"},this.recordIndex),o.forEach(e=>{e.onopen=()=>{this.logger("onopen: ws ".concat(e.url," open cost ").concat(Date.now()-i,"ms")),this.websockets.forEach(t=>{t!==e&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.close(),this.logger("close backup websocket: ".concat(t.url)))}),this.websockets.length=0,c.resolve(e)},e.onclose=n=>{this.logger("onclose: ws ".concat(e.url," closed cost ").concat(Date.now()-i,"ms state: ").concat(e.readyState)),t?this.isTry443PortFailed=LO(o):this.isNormalPortFailed=LO(o),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(t&&this.isTry443PortFailed||!t&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(n.reason)),c.reject({code:n.code,reason:eO.A_ROUND_WS_FAILED}))},e.onmessage=t=>this.logger("".concat(e.url," onmessage: ").concat(t.data))}),this.websockets.push(...o),n||(()=>{const n=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.websockets.forEach(e=>e.readyState!==WebSocket.OPEN&&e.close())};if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",c.isResolved),c.isResolved)return n();Hv().os===Fv.MAC_OS&&Zv()&&n(),this.createWebSocket(e,!0,!0).then(e=>c.resolve(e)).catch(e=>{this.isNormalPortFailed&&c.reject(e),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration)},this.try443PortDuration)})(),c.promise}chooseBestWebsocket(e,t,n,r){return this.useDoubleDomain=!!t,"string"==typeof e&&(e=function(e){let t,n,r;return[,t,n,r]=e.match(MO)||[],t||([,n,r]=e.match(UO)||[]),n&&r||([,n,r]=e.match(xO)||[]),n&&r||([,n]=e.match(VO)||[]),n||fb.warning("un-destructible url: ",e),{proxy:t,host:n,port:r||"443"}}(e)),this.recordIndex=r,this.useProxy=!!e.proxy,n&&this.useProxy&&(fb.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally(()=>this.clearTimeout())}}function jO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}class GO extends xy{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Dn(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(Uw.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Uw.CONNECTED):"closed"===this._state?this.emit(Uw.CLOSED):"failed"===this._state&&this.emit(Uw.FAILED))}resetReconnectCount(e){fb.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),Fg(this,"connectionID",0),Fg(this,"currentURLIndex",0),Fg(this,"urls",[]),Fg(this,"_reconnectMode","tryNext"),Fg(this,"reconnectReason",void 0),Fg(this,"_initMutex",new NA("websocket")),Fg(this,"name",void 0),Fg(this,"_state","closed"),Fg(this,"reconnectInterrupter",void 0),Fg(this,"websocket",void 0),Fg(this,"retryConfig",void 0),Fg(this,"reconnectCount",0),Fg(this,"forceCloseTimeout",5e3),Fg(this,"onlineReconnectListener",void 0),Fg(this,"useCompress",void 0),Fg(this,"tryDoubleDomain",!1),Fg(this,"use443PortOnly",!1),Fg(this,"wsInflateLength",0),Fg(this,"wsDeflateLength",0),Fg(this,"closeEstablishingWs",()=>{}),Fg(this,"store",void 0),Fg(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jO(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jO(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},t),this.useCompress=n,this.tryDoubleDomain=r,this.use443PortOnly=i;const{timeout:a,timeoutFactor:s}=t,c=Math.max(300,Math.floor(3*a/5)),u=Math.max(1.2,Math.floor(8*s)/10);Xy.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=u),iA.on(Qy.NETWORK_STATE_CHANGE,(e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===Xy.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=u):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=s))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=await this._initMutex.lock();this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{const e=Mv(),t=this.urls[this.currentURLIndex];XA("ENABLE_PREALLOC_PC")&&this.emit(TO.PRE_CONNECT_PC),this.createWebSocketConnection(t).then(e.resolve).catch(e.reject),this.once(Uw.CLOSED,()=>{e.reject(new Cy(Ry.WS_DISCONNECT))}),this.once(Uw.CONNECTED,e.resolve),await e.promise}catch(e){}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout(()=>e.close(),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void fb.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==e&&(this.reconnectMode=e),fb.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Cy(Ry.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new Cy(Ry.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;const n=Mv();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const r=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),fb.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},i=async e=>{var t;if(fb.debug("[".concat(this.name,"] websocket close ").concat(null===(t=this.websocket)||void 0===t?void 0:t.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new Cy(Ry.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=eA(this,Uw.WILL_RECONNECT,this.reconnectMode,e.reason)||this.reconnectMode,r=await this.reconnectWithAction(t);if("closed"===this.state)return void fb.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!r)return n.reject(new Cy(Ry.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),this.close(!0);n.resolve()}},o=e=>{this.emit(Uw.ON_MESSAGE,e)},a=e=>{fb.warn("[".concat(this.connectionID,"] ws open error ").concat(e))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),XA("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=XA("GATEWAY_WSS_ADDRESS")),fb.debug("[".concat(this.name,"] start connect, url:"),e);const s=null===(t=this.store)||void 0===t?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;const t=await this.chooseBestWebsocketConnection(e);this.websocket=t,r&&r(this.websocket.url),this.websocket.onclose=i,this.websocket.onmessage=o,this.websocket.onerror=a,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},s),this.joinGatewayRecordIndex=s}catch(e){const t="closed"===this.state,r=e instanceof Cy,o=r&&e.code===Ry.WS_ABORT,a=r&&e.code===Ry.WS_ERR,c=r?e.message:e&&(e.reason||e.toString());fb.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:o?"aborted":"error",errors:[e]},s),t||a?(n.reject(t?new Cy(Ry.WS_DISCONNECT,"websocket is closed: ".concat(c)):new Cy(Ry.WS_ERR,"init websocket failed: ".concat(c))),a&&fb.error("[".concat(this.name,"] init websocket failed: ").concat(c))):i&&i(e)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(0===this.urls.length)return!1;if("closed"===this.state)return!1;fb.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||iA.isOnline||!iA.onlineWaiter||(this.onlineReconnectListener=iA.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){const t=LA(this.reconnectCount,this.retryConfig);fb.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await Gh.race([mA(t),this.onlineReconnectListener||new Gh(()=>{})])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;const r=async(e,t)=>{this.emit(Uw.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e)this.emit(Uw.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e);else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);fb.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Uw.RECONNECT_WAITTING_FINISH,e),await r(this.urls[this.currentURLIndex],e)}else"recover"===e&&(fb.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Uw.RECONNECT_WAITTING_FINISH,e),this.urls=await Zy(this,Uw.REQUEST_NEW_URLS),this.currentURLIndex=0,await r(this.urls[this.currentURLIndex],e))}catch(n){var i;fb.error("[".concat(this.name,"] reconnect failed ").concat(n&&n.toString()));const r=null==n||null===(i=n.data)||void 0===i?void 0:i.desc;return Array.isArray(r)&&Dn(r).call(r,"dynamic key expired")?(this.emit(Uw.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class WO extends GO{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){const n=Mv(),r=function(e,t){return new BO(e,t)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{fb.debug("[choose-best-ws] close establishing websockets"),r.closeAllWebsockets(),n.reject(new Cy(Ry.WS_ABORT,"choose best websocket aborted"))};const i=XA("GATEWAY_DOMAINS");return fb.debug("[choose-best-ws] currentDomain: ",e,", domains: ",i,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),r.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class HO extends GO{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new Gh((n,r)=>{let i=!1;const o=[];this.closeEstablishingWs=()=>{fb.debug("[choose-best-ws] close establishing websockets"),o.forEach(e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()}),r(new Cy(Ry.WS_ABORT,"choose best websocket aborted"))};const a=XA("GATEWAY_DOMAINS");let s;const c=e.indexOf("?h="),u=a.find(t=>-1!==c?Dn(e).call(e,t,c):Dn(e).call(e,t));fb.debug("[choose-best-ws] currentDomain: ",u,", domains: ",a);let l=!this.tryDoubleDomain||!u;if(!l&&u){var d;const h=Date.now();try{a.forEach(t=>{const n=-1===c?e.replace(u,t):e.substr(0,c)+e.substr(c).replace(u,t),r=new WebSocket(n);r.binaryType="arraybuffer",o.push(r),fb.debug("[choose-best-ws] ws is connecting:",r.url)})}catch(e){for(fb.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach(e=>e.close());o.length;)o.pop();l=!0}null===(d=this.store)||void 0===d||d.recordJoinChannelService({urls:o.map(e=>e.url),service:"gateway"},t),o.forEach(e=>{e.onopen=()=>{if(i)return;const t=Date.now()-h;fb.debug("[choose-best-ws] ws open cost ".concat(t,"ms")),o.filter(t=>t!==e).forEach(e=>{fb.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()}),i=!0,n(e)},e.onclose=e=>{s=e,i||o.find(e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING))||(fb.debug("[choose-best-ws] all websocket is closed"),i=!0,r(s))},e.onmessage=t=>{fb.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}}),mA(this.forceCloseTimeout).then(()=>{o.forEach(e=>{e.readyState!==WebSocket.OPEN&&e.close()})})}if(l){var h;let i;fb.debug("[choose-best-ws] use single url: ",e),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[e],service:"gateway"},t);try{i=new WebSocket(e),o.push(i),i.binaryType="arraybuffer"}catch(e){const t=new Cy(Ry.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return fb.error("[".concat(this.name,"]").concat(t)),void r(t)}i.onopen=()=>{n(i)},i.onclose=e=>{r(e)},i.onmessage=e=>{fb.debug("[choose-best-ws]".concat(i.url," onmessage: ").concat(e.data))},mA(this.forceCloseTimeout).then(()=>{i&&i.readyState!==WebSocket.OPEN&&i.close()})}}).then(e=>(this.closeEstablishingWs=void 0,e)).catch(e=>{throw this.closeEstablishingWs=void 0,e})}}class KO extends xy{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Nw.CONNECTED?this.emit(Dw.WS_CONNECTED):e===Nw.RECONNECTING?this.emit(Dw.WS_RECONNECTING,this._websocketReconnectReason):e===Nw.CLOSED&&this.emit(Dw.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),Fg(this,"_disconnectedReason",void 0),Fg(this,"_websocketReconnectReason",void 0),Fg(this,"_connectionState",Nw.CLOSED),Fg(this,"reconnectToken",void 0),Fg(this,"websocket",void 0),Fg(this,"openConnectionTime",void 0),Fg(this,"clientId",void 0),Fg(this,"lastMsgTime",Date.now()),Fg(this,"uploadCache",[]),Fg(this,"uploadCacheInterval",void 0),Fg(this,"rttRolling",new MA(5)),Fg(this,"pingpongTimer",void 0),Fg(this,"wsInflateDataTimer",void 0),Fg(this,"pingpongTimeoutCount",0),Fg(this,"joinResponse",void 0),Fg(this,"multiIpOption",void 0),Fg(this,"initError",void 0),Fg(this,"spec",void 0),Fg(this,"store",void 0),Fg(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(Dw.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===kw.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===kw.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(Hy.UID_BANNED);break;case 15:this.close(Hy.IP_BANNED);break;case 16:this.close(Hy.CHANNEL_BANNED)}if(t._type===kw.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case Ow.ERR_LICENSE_MISSING:this.close(Hy.LICENSE_MISSING);break;case Ow.ERR_LICENSE_EXPIRED:this.close(Hy.LICENSE_EXPIRED);break;case Ow.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Hy.LICENSE_MINUTES_EXCEEDED);break;case Ow.ERR_LICENSE_PERIOD_INVALID:this.close(Hy.LICENSE_PERIOD_INVALID);break;case Ow.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Hy.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ow.ERR_LICENSE_ILLEGAL:this.close(Hy.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new WO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,XA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),XA("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Nw.CONNECTED&&this.reconnect("retry",Jy.OFFLINE)})}async request(e,t,n,r){const i=TA(6,""),o={_id:i,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new Gh((t,n)=>{if(this.connectionState===Nw.CONNECTED)return t();const r=()=>{this.off(Dw.WS_CLOSED,i),t()},i=()=>{this.off(Dw.WS_CONNECTED,r),n(new yb(Ry.WS_ABORT))};this.once(Dw.WS_CONNECTED,r),this.once(Dw.WS_CLOSED,i),e!==Pw.PUBLISH&&e!==Pw.PUBLISH_DATASTREAM&&e!==Pw.SUBSCRIBE&&e!==Pw.SUBSCRIBE_DATASTREAM&&e!==Pw.UNSUBSCRIBE&&e!==Pw.UNSUBSCRIBE_DATASTREAM&&e!==Pw.UNPUBLISH&&e!==Pw.UNPUBLISH_DATASTREAM&&e!==Pw.CONTROL&&e!==Pw.RESTART_ICE||this.once(Dw.DISCONNECT_P2P,()=>{n(new yb(Ry.DISCONNECT_P2P))}),e!==Pw.PUBLISH&&e!==Pw.RESTART_ICE||this.once(Dw.ABORT_P2P_EXECUTION,()=>{n(new yb(Ry.DISCONNECT_P2P))})});if(this.connectionState!==Nw.CONNECTING&&this.connectionState!==Nw.RECONNECTING||e===Pw.JOIN||e===Pw.REJOIN||await s(),this.websocket.sendMessage(o,!0),r)return;const c=new Gh((n,r)=>{let o=!1;const s=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(Dw.WS_CLOSED,c),this.off(Dw.WS_RECONNECTING,c),this.emit(Dw.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);const c=()=>{r(new yb(Ry.WS_ABORT,"type: ".concat(e))),this.off(Dw.WS_CLOSED,c),this.off(Dw.WS_RECONNECTING,c),this.off("res-@".concat(i),s)};this.once(Dw.WS_CLOSED,c),this.once(Dw.WS_RECONNECTING,c),mA(XA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||o||(fb.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Dw.REQUEST_TIMEOUT,e,t))})});let u=null;try{u=await c}catch(r){if(this.connectionState===Nw.CLOSED||e===Pw.LEAVE)throw new yb(Ry.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===Pw.JOIN||e===Pw.REJOIN?null:(await s(),await this.request(e,t))}if(u.isSuccess)return u.message;const l=Number(u.message.error_code||u.message.code),d=NO(l),h=new yb(Ry.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(u.message.error_str),{code:l,data:u.message,desc:d.desc});return"success"===d.action?u.message:(fb.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(d.desc,", action: ").concat(d.action)),l===Ow.ERR_TOO_MANY_BROADCASTERS?e===Pw.JOIN||e===Pw.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(l===Ow.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,fb.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Jy.MULTI_IP)):this.reconnect(d.action,Jy.SERVER_ERROR),e===Pw.JOIN||e===Pw.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Gh(n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void fb.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Lw.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=XA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Nw.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},XA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){this.websocket.sendMessage({_type:e,_message:t})}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Gh((t,n)=>{this.once(Dw.WS_CONNECTED,()=>t(this.joinResponse)),this.once(Dw.WS_CLOSED,()=>n(this.initError||new yb(Ry.WS_ABORT))),this.connectionState=Nw.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Hy.LEAVE,this.connectionState=Nw.CLOSED,fb.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Dw.ABORT_P2P_EXECUTION);const e=await Zy(this,Dw.REQUEST_JOIN_INFO),t=await this.request(Pw.JOIN,e);if(!t)return this.emit(Dw.REPORT_JOIN_GATEWAY,eO.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(Dw.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Nw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new yb(Ry.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=tA(this,Dw.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request(Pw.REJOIN,e);return!!t&&(this.connectionState=Nw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(e=>{this.emit(kw.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(kw.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(kw.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),this.emit(e.audio_mute?kw.MUTE_AUDIO:kw.UNMUTE_AUDIO,{uid:e.uid}),this.emit(e.video_mute?kw.MUTE_VIDEO:kw.UNMUTE_VIDEO,{uid:e.uid}),this.emit(e.audio_enable_local?kw.ENABLE_LOCAL_AUDIO:kw.DISABLE_LOCAL_AUDIO,{uid:e.uid}),this.emit(e.video_enable_local?kw.ENABLE_LOCAL_VIDEO:kw.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(kw.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){fb.debug("[".concat(this.clientId,"] receive notification: "),e);const t=NO(e.code);if(28===e.code&&"detail"in e&&(fb.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(Dw.RECOVER_NOTIFICATION,e.detail)),"success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(Hy.UID_BANNED),void this.close()):void this.reconnect(t.action,Jy.SERVER_ERROR);fb.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=XA("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(fb.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>XA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Jy.TIMEOUT):this.request(Pw.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),XA("REPORT_STATS")&&this.send(Pw.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(Lw.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Uw.RECONNECT_WAITTING_FINISH,e=>{this.emit(Dw.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(Uw.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Dw.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Uw.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Uw.CLOSED,()=>{this.connectionState=Nw.CLOSED}),this.websocket.on(Uw.FAILED,()=>{this._disconnectedReason=Hy.NETWORK_ERROR,this.connectionState=Nw.CLOSED}),this.websocket.on(Uw.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState=this.connectionState===Nw.CONNECTED?Nw.RECONNECTING:Nw.CONNECTING}),this.websocket.on(Uw.WILL_RECONNECT,(e,t,n)=>{const r=tA(this,Dw.IS_P2P_DISCONNECTED),i=r||"retry"!==e;r&&"retry"===e&&(fb.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=eO.P2P_DISCONNECTED),i&&(fb.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(Dw.REPORT_JOIN_GATEWAY,t||eO.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Dw.DISCONNECT_P2P)),n(e)}),this.websocket.on(Uw.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{fb.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Jy.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(Dw.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof yb){if(e.code===Ry.UNEXPECTED_RESPONSE&&e.data.code===Ow.ERR_NO_AUTHORIZED)return this.initError=new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),fb.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Jy.SERVER_ERROR);fb.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Jy.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(Uw.REQUEST_NEW_URLS,(e,t)=>{Zy(this,Dw.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Uw.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(kw.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(TO.PRE_CONNECT_PC,()=>{this.emit(Dw.PRE_CONNECT_PC)})}}let YO=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function qO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function zO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qO(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qO(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function JO(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(XA("TURN_DOMAIN")):(fb.info("Unidentified as ip: ".concat(e,", use as host")),e)}function XO(e,t){e.addresses||(e.addresses=[]);const n=function(e,t){if(XA("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return e.map(e=>{let{ip:t,port:n}=e;return{address:"".concat(t,":").concat(n)}});const n=XA("GATEWAY_DOMAINS");let r=n[1]&&Dn(t).call(t,n[1])?1:0;return e.map(e=>{let{domain_prefix:t,port:i,ip:o}=e;if(t)return{address:"".concat(t,".").concat(n[r++%n.length],":").concat(i)};const a=/^[\.\:\d]+$/.test(o),s=a?"".concat(o.replace(/[^\d]/g,"-"),".").concat(n[r++%n.length],":").concat(i):"".concat(o,":").concat(i);return a||fb.info("Unidentified as ip: ".concat(o,", use as host")),{ip:o,port:i,address:s}})}(e.addresses,t),r=Array.isArray(e.detail)&&e.detail[18];if(r&&"string"==typeof r){const e=r.split(";");for(let t=0;t<e.length;t++){var i;const r=jp(i=e[t]).call(i);n[t]&&r&&(n[t].ip6=r)}}const o=e.detail&&e.detail.candidate;let a;if(o){const[e,t]=o.split(":");e&&t&&(a={port:Number(t),ip:e,address:"".concat(e,":").concat(t)})}return{gatewayAddrs:n,apGatewayAddress:a,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function QO(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function ZO(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(QO(t.width),"x").concat(QO(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function $O(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function eN(e,t){let n,r,i;switch(t){case YO.CHOOSE_SERVER:r=4096,i="choose server";break;case YO.CLOUD_PROXY:r=1048576,i="proxy";break;case YO.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case YO.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new yb(Ry.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(t=>{t.buffer&&t.buffer.flag===r&&(n={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map(e=>zO(zO({},e),{},{ticket:t.buffer.cert})),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:zO(zO({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})}),!n)throw new yb(Ry.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function tN(e,t){return await Gh.all(e.addresses.map(async e=>({address:JO(e.ip),tcpport:e.port,udpport:e.port,username:t&&XA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():KA.username,password:t&&XA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Uy(t.toString()):KA.password})))}function iN(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),r=t.videoHeight||n.height,i=t.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(QO(e.height),QO(e.width)),1):(fb.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function nN(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:o,protocol:a}=e;return"local-candidate"===r?{candidateType:t,relayProtocol:n,protocol:a}:{candidateType:t,relayProtocol:n,address:i,port:o,protocol:a}}var rN,oN=i(ew),sN=Xi("Array").values,aN=pn,cN=Ze,dN=l,lN=sN,uN=Array.prototype,hN={DOMTokenList:!0,NodeList:!0},pN=function(e){var t=e.values;return e===uN||dN(uN,e)&&t===uN.values||cN(hN,aN(e))?lN:t},_N=i(pN),EN=N,fN=d,mN=L,TN=n,SN=eo,gN=Br,RN=k,CN=Je,IN=K,vN=Object.assign,yN=Object.defineProperty,AN=fN([].concat),bN=!vN||TN(function(){if(EN&&1!==vN({b:1},vN(yN({},"a",{enumerable:!0,get:function(){yN(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=vN({},e)[n]||SN(vN({},t)).join("")!=r})?function(e,t){for(var n=CN(e),r=arguments.length,i=1,o=gN.f,a=RN.f;r>i;)for(var s,c=IN(arguments[i++]),u=o?AN(SN(c),o(c)):SN(c),l=u.length,d=0;l>d;)s=u[d++],EN&&!mN(a,c,s)||(n[s]=c[s]);return n}:vN,wN=ii,ON=rs,NN=Xt,DN=L,PN=Je,LN=function(e,t,n,r){try{return r?t(wN(n)[0],n[1]):t(n)}catch(t){ON(e,"throw",t)}},kN=jo,MN=jc,UN=Gi,xN=E_,VN=es,FN=qo,BN=Array,jN=d,GN=2147483647,WN=/[^\0-\u007E]/,HN=/[.\u3002\uFF0E\uFF61]/g,KN="Overflow: input needs wider integers to process",YN=RangeError,qN=jN(HN.exec),zN=Math.floor,JN=String.fromCharCode,XN=jN("".charCodeAt),QN=jN([].join),ZN=jN([].push),$N=jN("".replace),eD=jN("".split),tD=jN("".toLowerCase),iD=function(e){return e+22+75*(e<26)},nD=function(e,t,n){var r=0;for(e=n?zN(e/700):e>>1,e+=zN(e/t);e>455;)e=zN(e/35),r+=36;return zN(r+36*e/(e+38))},rD=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=XN(e,n++);if(i>=55296&&i<=56319&&n<r){var o=XN(e,n++);56320==(64512&o)?ZN(t,((1023&i)<<10)+(1023&o)+65536):(ZN(t,i),n--)}else ZN(t,i)}return t}(e);var n,r,i=e.length,o=128,a=0,s=72;for(n=0;n<e.length;n++)(r=e[n])<128&&ZN(t,JN(r));var c=t.length,u=c;for(c&&ZN(t,"-");u<i;){var l=GN;for(n=0;n<e.length;n++)(r=e[n])>=o&&r<l&&(l=r);var d=u+1;if(l-o>zN((GN-a)/d))throw YN(KN);for(a+=(l-o)*d,o=l,n=0;n<e.length;n++){if((r=e[n])<o&&++a>GN)throw YN(KN);if(r==o){for(var h=a,p=36;;){var f=p<=s?1:p>=s+26?26:p-s;if(h<f)break;var m=h-f,g=36-f;ZN(t,JN(iD(f+m%g))),h=zN(m/g),p+=36}ZN(t,JN(iD(h))),s=nD(a,d,u==c),a=0,u++}}a++,o++}return QN(t,"")},oD=wi,sD=N,aD=Gg,cD=h$1,dD=Xt,lD=d,uD=ha,hD=hc,pD=Sc,_D=Ze,ED=bN,fD=function(e){var t=PN(e),n=MN(this),r=arguments.length,i=r>1?arguments[1]:void 0,o=void 0!==i;o&&(i=NN(i,r>2?arguments[2]:void 0));var a,s,c,u,l,d,h=FN(t),p=0;if(!h||this===BN&&kN(h))for(a=UN(t),s=n?new this(a):BN(a);a>p;p++)d=o?i(t[p],p):t[p],xN(s,p,d);else for(l=(u=VN(t,h)).next,s=n?new this:[];!(c=DN(l,u)).done;p++)d=o?LN(u,i,[c.value,p],!0):c.value,xN(s,p,d);return s.length=p,s},mD=R_,TD=Ch.codeAt,SD=function(e){var t,n,r=[],i=eD($N(tD(e),HN,"."),".");for(t=0;t<i.length;t++)ZN(r,qN(WN,n=i[t])?"xn--"+rD(n):n);return QN(r,".")},gD=fn,RD=Da,CD=Zc,ID=rC,vD=ra,yD=vD.set,AD=vD.getterFor("URL"),bD=ID.URLSearchParams,wD=ID.getState,OD=cD.URL,ND=cD.TypeError,DD=cD.parseInt,PD=Math.floor,LD=Math.pow,kD=lD("".charAt),MD=lD(/./.exec),UD=lD([].join),xD=lD(1..toString),VD=lD([].pop),FD=lD([].push),BD=lD("".replace),jD=lD([].shift),GD=lD("".split),WD=lD("".slice),HD=lD("".toLowerCase),KD=lD([].unshift),YD="Invalid scheme",qD="Invalid host",zD="Invalid port",JD=/[a-z]/i,XD=/[\d+-.a-z]/i,QD=/\d/,ZD=/^0x/i,$D=/^[0-7]+$/,eP=/^\d+$/,tP=/^[\da-f]+$/i,iP=/[\0\t\n\r #%/:<>?@[\\\]^|]/,nP=/[\0\t\n\r #/:<>?@[\\\]^|]/,rP=/^[\u0000-\u0020]+/,oP=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,sP=/[\t\n\r]/g,aP=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)KD(t,e%256),e=PD(e/256);return UD(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,o=0;o<8;o++)0!==e[o]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=o),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=xD(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},cP={},dP=ED({},cP,{" ":1,'"':1,"<":1,">":1,"`":1}),lP=ED({},dP,{"#":1,"?":1,"{":1,"}":1}),uP=ED({},lP,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),hP=function(e,t){var n=TD(e,0);return n>32&&n<127&&!_D(t,e)?e:encodeURIComponent(e)},pP={ftp:21,file:null,http:80,https:443,ws:80,wss:443},_P=function(e,t){var n;return 2==e.length&&MD(JD,kD(e,0))&&(":"==(n=kD(e,1))||!t&&"|"==n)},EP=function(e){var t;return e.length>1&&_P(WD(e,0,2))&&(2==e.length||"/"===(t=kD(e,2))||"\\"===t||"?"===t||"#"===t)},fP=function(e){return"."===e||"%2e"===HD(e)},mP={},TP={},SP={},gP={},RP={},CP={},IP={},vP={},yP={},AP={},bP={},wP={},OP={},NP={},DP={},PP={},LP={},kP={},MP={},UP={},xP={},VP=function(e,t,n){var r,i,o,a=gD(e);if(t){if(i=this.parse(a))throw ND(i);this.searchParams=null}else{if(void 0!==n&&(r=new VP(n,!0)),i=this.parse(a,null,r))throw ND(i);(o=wD(new bD)).bindURL(this),this.searchParams=o}};VP.prototype={type:"URL",parse:function(e,t,n){var r,i,o,a,s,c=this,u=t||mP,l=0,d="",h=!1,p=!1,f=!1;for(e=gD(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=BD(e,rP,""),e=BD(e,oP,"$1")),e=BD(e,sP,""),r=fD(e);l<=r.length;){switch(i=r[l],u){case mP:if(!i||!MD(JD,i)){if(t)return YD;u=SP;continue}d+=HD(i),u=TP;break;case TP:if(i&&(MD(XD,i)||"+"==i||"-"==i||"."==i))d+=HD(i);else{if(":"!=i){if(t)return YD;d="",u=SP,l=0;continue}if(t&&(c.isSpecial()!=_D(pP,d)||"file"==d&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=d,t)return void(c.isSpecial()&&pP[c.scheme]==c.port&&(c.port=null));d="","file"==c.scheme?u=NP:c.isSpecial()&&n&&n.scheme==c.scheme?u=gP:c.isSpecial()?u=vP:"/"==r[l+1]?(u=RP,l++):(c.cannotBeABaseURL=!0,FD(c.path,""),u=MP)}break;case SP:if(!n||n.cannotBeABaseURL&&"#"!=i)return YD;if(n.cannotBeABaseURL&&"#"==i){c.scheme=n.scheme,c.path=mD(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,u=xP;break}u="file"==n.scheme?NP:CP;continue;case gP:if("/"!=i||"/"!=r[l+1]){u=CP;continue}u=yP,l++;break;case RP:if("/"==i){u=AP;break}u=kP;continue;case CP:if(c.scheme=n.scheme,i==rN)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=mD(n.path),c.query=n.query;else if("/"==i||"\\"==i&&c.isSpecial())u=IP;else if("?"==i)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=mD(n.path),c.query="",u=UP;else{if("#"!=i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=mD(n.path),c.path.length--,u=kP;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=mD(n.path),c.query=n.query,c.fragment="",u=xP}break;case IP:if(!c.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,u=kP;continue}u=AP}else u=yP;break;case vP:if(u=yP,"/"!=i||"/"!=kD(d,l+1))continue;l++;break;case yP:if("/"!=i&&"\\"!=i){u=AP;continue}break;case AP:if("@"==i){h&&(d="%40"+d),h=!0,o=fD(d);for(var m=0;m<o.length;m++){var g=o[m];if(":"!=g||f){var v=hP(g,uP);f?c.password+=v:c.username+=v}else f=!0}d=""}else if(i==rN||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()){if(h&&""==d)return"Invalid authority";l-=fD(d).length+1,d="",u=bP}else d+=i;break;case bP:case wP:if(t&&"file"==c.scheme){u=PP;continue}if(":"!=i||p){if(i==rN||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()){if(c.isSpecial()&&""==d)return qD;if(t&&""==d&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(d))return a;if(d="",u=LP,t)return;continue}"["==i?p=!0:"]"==i&&(p=!1),d+=i}else{if(""==d)return qD;if(a=c.parseHost(d))return a;if(d="",u=OP,t==wP)return}break;case OP:if(!MD(QD,i)){if(i==rN||"/"==i||"?"==i||"#"==i||"\\"==i&&c.isSpecial()||t){if(""!=d){var E=DD(d,10);if(E>65535)return zD;c.port=c.isSpecial()&&E===pP[c.scheme]?null:E,d=""}if(t)return;u=LP;continue}return zD}d+=i;break;case NP:if(c.scheme="file","/"==i||"\\"==i)u=DP;else{if(!n||"file"!=n.scheme){u=kP;continue}if(i==rN)c.host=n.host,c.path=mD(n.path),c.query=n.query;else if("?"==i)c.host=n.host,c.path=mD(n.path),c.query="",u=UP;else{if("#"!=i){EP(UD(mD(r,l),""))||(c.host=n.host,c.path=mD(n.path),c.shortenPath()),u=kP;continue}c.host=n.host,c.path=mD(n.path),c.query=n.query,c.fragment="",u=xP}}break;case DP:if("/"==i||"\\"==i){u=PP;break}n&&"file"==n.scheme&&!EP(UD(mD(r,l),""))&&(_P(n.path[0],!0)?FD(c.path,n.path[0]):c.host=n.host),u=kP;continue;case PP:if(i==rN||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&_P(d))u=kP;else if(""==d){if(c.host="",t)return;u=LP}else{if(a=c.parseHost(d))return a;if("localhost"==c.host&&(c.host=""),t)return;d="",u=LP}continue}d+=i;break;case LP:if(c.isSpecial()){if(u=kP,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=rN&&(u=kP,"/"!=i))continue}else c.fragment="",u=xP;else c.query="",u=UP;break;case kP:if(i==rN||"/"==i||"\\"==i&&c.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(s=HD(s=d))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(c.shortenPath(),"/"==i||"\\"==i&&c.isSpecial()||FD(c.path,"")):fP(d)?"/"==i||"\\"==i&&c.isSpecial()||FD(c.path,""):("file"==c.scheme&&!c.path.length&&_P(d)&&(c.host&&(c.host=""),d=kD(d,0)+":"),FD(c.path,d)),d="","file"==c.scheme&&(i==rN||"?"==i||"#"==i))for(;c.path.length>1&&""===c.path[0];)jD(c.path);"?"==i?(c.query="",u=UP):"#"==i&&(c.fragment="",u=xP)}else d+=hP(i,lP);break;case MP:"?"==i?(c.query="",u=UP):"#"==i?(c.fragment="",u=xP):i!=rN&&(c.path[0]+=hP(i,cP));break;case UP:t||"#"!=i?i!=rN&&("'"==i&&c.isSpecial()?c.query+="%27":c.query+="#"==i?"%23":hP(i,cP)):(c.fragment="",u=xP);break;case xP:i!=rN&&(c.fragment+=hP(i,dP))}l++}},parseHost:function(e){var t,n,r;if("["==kD(e,0)){if("]"!=kD(e,e.length-1))return qD;if(t=function(e){var t,n,r,i,o,a,s,c=[0,0,0,0,0,0,0,0],u=0,l=null,d=0,h=function(){return kD(e,d)};if(":"==h()){if(":"!=kD(e,1))return;d+=2,l=++u}for(;h();){if(8==u)return;if(":"!=h()){for(t=n=0;n<4&&MD(tP,h());)t=16*t+DD(h(),16),d++,n++;if("."==h()){if(0==n)return;if(d-=n,u>6)return;for(r=0;h();){if(i=null,r>0){if(!("."==h()&&r<4))return;d++}if(!MD(QD,h()))return;for(;MD(QD,h());){if(o=DD(h(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;d++}c[u]=256*c[u]+i,2!=++r&&4!=r||u++}if(4!=r)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;c[u++]=t}else{if(null!==l)return;d++,l=++u}}if(null!==l)for(a=u-l,u=7;0!=u&&a>0;)s=c[u],c[u--]=c[l+a-1],c[l+--a]=s;else if(8!=u)return;return c}(WD(e,1,-1)),!t)return qD;this.host=t}else if(this.isSpecial()){if(e=SD(e),MD(iP,e))return qD;if(t=function(e){var t,n,r,i,o,a,s,c=GD(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=c[r]))return e;if(o=10,i.length>1&&"0"==kD(i,0)&&(o=MD(ZD,i)?16:8,i=WD(i,8==o?1:2)),""===i)a=0;else{if(!MD(10==o?eP:8==o?$D:tP,i))return e;a=DD(i,o)}FD(n,a)}for(r=0;r<t;r++)if(a=n[r],r==t-1){if(a>=LD(256,5-t))return null}else if(a>255)return null;for(s=VD(n),r=0;r<n.length;r++)s+=n[r]*LD(256,3-r);return s}(e),null===t)return qD;this.host=t}else{if(MD(nP,e))return qD;for(t="",n=fD(e),r=0;r<n.length;r++)t+=hP(n[r],cP);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return _D(pP,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&_P(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,a=e.path,s=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",e.includesCredentials()&&(u+=n+(r?":"+r:"")+"@"),u+=aP(i),null!==o&&(u+=":"+o)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+UD(a,"/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},setHref:function(e){var t=this.parse(e);if(t)throw ND(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new FP(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+aP(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(gD(e)+":",mP)},getUsername:function(){return this.username},setUsername:function(e){var t=fD(gD(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=hP(t[n],uP)}},getPassword:function(){return this.password},setPassword:function(e){var t=fD(gD(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=hP(t[n],uP)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?aP(e):aP(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,bP)},getHostname:function(){var e=this.host;return null===e?"":aP(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,wP)},getPort:function(){var e=this.port;return null===e?"":gD(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=gD(e))?this.port=null:this.parse(e,OP))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+UD(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,LP))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=gD(e))?this.query=null:("?"==kD(e,0)&&(e=WD(e,1)),this.query="",this.parse(e,UP)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=gD(e))?("#"==kD(e,0)&&(e=WD(e,1)),this.fragment="",this.parse(e,xP)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var FP=function(e){var t=pD(this,BP),n=CD(arguments.length,1)>1?arguments[1]:void 0,r=yD(t,new VP(e,!1,n));sD||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},BP=FP.prototype,jP=function(e,t){return{get:function(){return AD(this)[e]()},set:t&&function(e){return AD(this)[t](e)},configurable:!0,enumerable:!0}};if(sD&&(hD(BP,"href",jP("serialize","setHref")),hD(BP,"origin",jP("getOrigin")),hD(BP,"protocol",jP("getProtocol","setProtocol")),hD(BP,"username",jP("getUsername","setUsername")),hD(BP,"password",jP("getPassword","setPassword")),hD(BP,"host",jP("getHost","setHost")),hD(BP,"hostname",jP("getHostname","setHostname")),hD(BP,"port",jP("getPort","setPort")),hD(BP,"pathname",jP("getPathname","setPathname")),hD(BP,"search",jP("getSearch","setSearch")),hD(BP,"searchParams",jP("getSearchParams")),hD(BP,"hash",jP("getHash","setHash"))),uD(BP,"toJSON",function(){return AD(this).serialize()},{enumerable:!0}),uD(BP,"toString",function(){return AD(this).serialize()},{enumerable:!0}),OD){var GP=OD.createObjectURL,WP=OD.revokeObjectURL;GP&&uD(FP,"createObjectURL",dD(GP,OD)),WP&&uD(FP,"revokeObjectURL",dD(WP,OD))}RD(FP,"URL"),oD({global:!0,constructor:!0,forced:!aD,sham:!sD},{URL:FP});var HP=wi,KP=n,YP=Zc,qP=fn,zP=Gg,JP=ae("URL");HP({target:"URL",stat:!0,forced:!(zP&&KP(function(){JP.canParse()}))},{canParse:function(e){var t=YP(arguments.length,1),n=qP(e),r=t<2||void 0===arguments[1]?void 0:qP(arguments[1]);try{return!!new JP(n,r)}catch(e){return!1}}});var XP=i(ie.URL);const QP={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ZP(){return QP}function $P(){return"setSinkId"in HTMLAudioElement.prototype&&(!XA("RESTRICTION_SET_PLAYBACK_DEVICE")||(Jv()||Qv())&&!_y())}function eL(){return!QP.supportUnifiedPlan||XA("CHROME_FORCE_PLAN_B")&&Ey()}let tL=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function iL(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function nL(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function rL(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function oL(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const sL={"90p":nL(160,90),"90p_1":nL(160,90),"120p":nL(160,120,15,30,65),"120p_1":nL(160,120,15,30,65),"120p_3":nL(120,120,15,30,50),"120p_4":nL(212,120),"180p":nL(320,180,15,30,140),"180p_1":nL(320,180,15,30,140),"180p_3":nL(180,180,15,30,100),"180p_4":nL(240,180,15,30,120),"240p":nL(320,240,15,40,200),"240p_1":nL(320,240,15,40,200),"240p_3":nL(240,240,15,40,140),"240p_4":nL(424,240,15,40,220),"360p":nL(640,360,15,80,400),"360p_1":nL(640,360,15,80,400),"360p_3":nL(360,360,15,80,260),"360p_4":nL(640,360,30,80,600),"360p_6":nL(360,360,30,80,400),"360p_7":nL(480,360,15,80,320),"360p_8":nL(480,360,30,80,490),"360p_9":nL(640,360,15,80,800),"360p_10":nL(640,360,24,80,800),"360p_11":nL(640,360,24,80,1e3),"480p":nL(640,480,15,100,500),"480p_1":nL(640,480,15,100,500),"480p_2":nL(640,480,30,100,1e3),"480p_3":nL(480,480,15,100,400),"480p_4":nL(640,480,30,100,750),"480p_6":nL(480,480,30,100,600),"480p_8":nL(848,480,15,100,610),"480p_9":nL(848,480,30,100,930),"480p_10":nL(640,480,10,100,400),"720p":nL(1280,720,15,120,1130),"720p_auto":nL(1280,720,30,900,3e3),"720p_1":nL(1280,720,15,120,1130),"720p_2":nL(1280,720,30,120,2e3),"720p_3":nL(1280,720,30,120,1710),"720p_5":nL(960,720,15,120,910),"720p_6":nL(960,720,30,120,1380),"1080p":nL(1920,1080,15,120,2080),"1080p_1":nL(1920,1080,15,120,2080),"1080p_2":nL(1920,1080,30,120,3e3),"1080p_3":nL(1920,1080,30,120,3150),"1080p_5":nL(1920,1080,60,120,4780),"1440p":nL(2560,1440,30,120,4850),"1440p_1":nL(2560,1440,30,120,4850),"1440p_2":nL(2560,1440,60,120,7350),"4k":nL(3840,2160,30,120,8910),"4k_1":nL(3840,2160,30,120,8910),"4k_3":nL(3840,2160,60,120,13500)},aL={"480p":rL(640,480,5),"480p_1":rL(640,480,5),"480p_2":rL(640,480,30),"480p_3":rL(640,480,15),"720p":rL(1280,720,5),"720p_auto":nL(1280,720,30,900,3e3),"720p_1":rL(1280,720,5),"720p_2":rL(1280,720,30),"720p_3":rL(1280,720,15),"1080p":rL(1920,1080,5),"1080p_1":rL(1920,1080,5),"1080p_2":rL(1920,1080,30),"1080p_3":rL(1920,1080,15)},cL={"1SL1TL":oL(1,1),"3SL3TL":oL(3,3),"2SL3TL":oL(2,3)};function dL(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},sL[e]):e}function lL(e){return"string"==typeof e?Object.assign({},aL[e]):e}function uL(e){return"string"==typeof e?Object.assign({},cL[e]):e}const hL={speech_low_quality:iL(16e3,!1),speech_standard:iL(32e3,!1,18),music_standard:iL(48e3,!1),standard_stereo:iL(48e3,!0,56),high_quality:iL(48e3,!1,128),high_quality_stereo:iL(48e3,!0,192)};function pL(e){return"string"==typeof e?Object.assign({},hL[e]):e}const _L=[];function EL(e){return vy(e,"mediaSource",["screen","window","application"]),!0}let fL=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),mL=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),TL=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),SL=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),gL=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),RL=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),CL=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),IL=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),vL=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),yL=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});const AL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},bL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},wL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},OL={uplinkNetworkQuality:0,downlinkNetworkQuality:0},NL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let DL=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),PL=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),LL=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),kL=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),ML=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),UL=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const xL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let VL=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function FL(e,t,n,r,i){var o,a,s={};return Object.keys(r).forEach(function(e){s[e]=r[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=Jn(o=oN(a=n.slice()).call(a)).call(o,function(n,r){return r(e,t,n)||n},s),i&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(i):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}function BL(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function jL(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function GL(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jL(Object(n),!0).forEach(function(t){BL(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jL(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class WL extends xy{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(RL.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),BL(this,"trackMediaType",void 0),BL(this,"_ID",void 0),BL(this,"_rtpTransceiver",void 0),BL(this,"_lowRtpTransceiver",void 0),BL(this,"_hints",[]),BL(this,"_isClosed",!1),BL(this,"_originMediaStreamTrack",void 0),BL(this,"mediaStreamTrack",void 0),BL(this,"_external",{}),this._ID=t||TA(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(e){Dn(_L).call(_L,e)||_L.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||dA(()=>{var e;vb.reportApiInvoke(null,{name:By.GET_MEDIA_STREAM_TRACK,options:[],tag:jy.TRACER}).onSuccess((null===(e=this._mediaStreamTrack)||void 0===e?void 0:e.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===TL.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=_L.indexOf(e);-1!==t&&_L.splice(t,1)}(this),this.emit(CL.CLOSED),this.removeAllListeners(RL.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===TL.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(RL.TRANSCEIVER_UPDATED,e,t)}}class HL extends WL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),BL(this,"_enabled",!0),BL(this,"_muted",!1),BL(this,"_isExternalTrack",!1),BL(this,"_isClosed",!1),BL(this,"_enabledMutex",void 0),BL(this,"processor",void 0),BL(this,"_processorContext",void 0),BL(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new NA("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,fb.debug("[".concat(this.getTrackId(),"] close")),this.emit(fL.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){this._isExternalTrack=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,fL.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){fb.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(CL.TRACK_ENDED)}stateCheck(e,t){if(fb.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),Iy(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new Cy(Ry.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",fb);if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new Cy(Ry.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",fb)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Gh.resolve([])}}const KL=window.AudioContext||window.webkitAudioContext;let YL=null;const qL=new class extends xy{constructor(){super(...arguments),BL(this,"prevState",void 0),BL(this,"curState",void 0),BL(this,"currentTime",void 0),BL(this,"currentTimeStuckAt",void 0),BL(this,"interruptDetectorTrack",void 0),BL(this,"onLocalAudioTrackMute",()=>{fb.info("ios15-interruption-start"),this.emit(tL.IOS_15_16_INTERRUPTION_START)}),BL(this,"onLocalAudioTrackUnmute",async()=>{fb.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?fb.info("ios15-interruption-end-canceled"):(YL&&await YL.suspend(),this.emit(tL.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){fb.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){fb.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function zL(){if(!YL){if(function(){if(!KL)return void fb.error("your browser is not support web audio");fb.info("create audio context");const e=GL({},XA("WEBAUDIO_INIT_OPTIONS"));fb.debug("audio context init option:",JSON.stringify(e)),YL=new KL(e),qL.curState=YL.state,YL.onstatechange=()=>{qL.prevState=qL.curState,qL.curState=YL?YL.state:void 0;const{prevState:e,curState:t}=qL,n="running"===t,r="interrupted"===t,i="running"===e,o="suspended"===e,a="interrupted"===e,s=Hv().osVersion;($v()||uy())&&i&&r&&(fb.info("ios".concat(s,"-interruption-start")),qL.emit(tL.IOS_INTERRUPTION_START)),($v()||uy())&&(o||a)&&n&&(fb.info("ios".concat(s,"-interruption-end")),qL.emit(tL.IOS_INTERRUPTION_END)),e!==t&&qL.emit(tL.STATE_CHANGE,t,e)},setInterval(()=>{var e;const t=null===(e=YL)||void 0===e?void 0:e.currentTime;qL.currentTime!==t?(qL.currentTimeStuckAt&&(fb.debug("AudioContext current time resume at ".concat(t)),qL.currentTimeStuckAt=void 0),qL.currentTime=t):(t!==qL.currentTimeStuckAt&&(vb.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:jy.TRACER}).onSuccess(),fb.warning("AudioContext current time stuck at ".concat(t))),qL.currentTimeStuckAt=t)},5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,r=!1,i=!1,o=!1;function a(t){"running"===e.state?s(!1):$v()||uy()?"suspended"===e.state&&(s(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(s(!0),t&&e.resume().then(c,c))}function s(e){if(r!==e){r=e;for(let n=0,r=t;n<r.length;n+=1){const t=r[n];e?window.addEventListener(t,u,{capture:!0,passive:!0}):window.removeEventListener(t,u,{capture:!0,passive:!0})}}}function c(){a(!1)}function u(){a(!0)}function l(e){if(!o)if(n.paused)if(e){let t;d(!1),o=!0;try{t=n.play(),t?t.then(h,h):(n.addEventListener("playing",h),n.addEventListener("abort",h),n.addEventListener("error",h))}catch(e){h()}}else d(!0);else d(!1)}function d(e){if(i!==e){i=e;for(let n=0,r=t;n<r.length;n++){const t=r[n];e?window.addEventListener(t,p,{capture:!0,passive:!0}):window.removeEventListener(t,p,{capture:!0,passive:!0})}}}function h(){n.removeEventListener("playing",h),n.removeEventListener("abort",h),n.removeEventListener("error",h),o=!1,l(!1)}function p(){l(!0)}if($v()){const t=e.createMediaStreamDestination(),r=document.createElement("div");r.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=r.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=t.stream,l(!0)}qL.on(tL.STATE_CHANGE,function(){a(!0)}),a(!1)}(YL)}(),!YL)throw new Cy(Ry.NOT_SUPPORTED,"can not create audio context");return YL}return YL}function JL(e){if(function(){if(null!==XL)return XL;const e=zL(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),XL=i,i}())return;const t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var o;return e._inputNodes||(e._inputNodes=[]),Dn(o=e._inputNodes).call(o,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,o)=>{n.call(e),r?nA(e._inputNodes,r):e._inputNodes=[];for(const n of e._inputNodes)t.call(e,n)}}let XL=null;function QL(e,t){let n=!1;const r=1/t;if(XA("DISABLE_WEBAUDIO")){const t=window.setInterval(()=>{n?window.clearInterval(t):e(performance.now()/1e3)},1e3*r)}else{const t=zL();let i=t.createGain();i.gain.value=0,i.connect(t.destination);const o=()=>{if(n)return void(i=null);const a=t.createOscillator();a.onended=o,a.connect(i),a.start(0),a.stop(t.currentTime+r),e(t.currentTime)};o()}return()=>{n=!0}}class ZL{constructor(){BL(this,"context",void 0),BL(this,"analyserNode",void 0),BL(this,"sourceNode",void 0),this.context=zL(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||$v()||uy()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}const t=Jn(e).call(e,(e,t)=>e+t*t,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){fb.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class $L extends xy{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),BL(this,"outputNode",void 0),BL(this,"outputTrack",void 0),BL(this,"isPlayed",!1),BL(this,"sourceNode",void 0),BL(this,"context",void 0),BL(this,"audioBufferNode",void 0),BL(this,"destNode",void 0),BL(this,"audioOutputLevel",0),BL(this,"volumeLevelAnalyser",void 0),BL(this,"_processedNode",void 0),BL(this,"playNode",void 0),BL(this,"isDestroyed",!1),BL(this,"onNoAudioInput",void 0),BL(this,"isNoAudioInput",!1),BL(this,"_noAudioInputCount",0),this.context=zL(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),JL(this.outputNode),this.volumeLevelAnalyser=new ZL}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(yL.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ZP().webAudioMediaStreamDest)throw new Cy(Ry.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&oA(()=>{qL.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;$v()||uy()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let r=!1;for(let e=0;e<n.length;e++)0!==n[e]&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await mA(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ek extends $L{get isFreeze(){return!1}constructor(e,t,n){var r;if(super(),BL(this,"sourceNode",void 0),BL(this,"track",void 0),BL(this,"clonedTrack",void 0),BL(this,"audioElement",void 0),BL(this,"isCurrentTrackCloned",!1),BL(this,"isRemoteTrack",!1),BL(this,"originVolumeLevelAnalyser",void 0),BL(this,"rebuildWebAudio",async()=>{if(fb.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void fb.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>fb.info("resume success")),fb.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),JL(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),JL(this.outputNode),this.emit(yL.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),"audio"!==e.kind)throw new Cy(Ry.UNEXPECTED_ERROR);this.track=e;const i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),JL(this.sourceNode),n){const e=n.clone();e.enabled=!0,this.clonedTrack=e,fb.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));JL(t),this.originVolumeLevelAnalyser=new ZL,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;const o=Hv();t&&o.os===Fv.IOS&&Number(null===(r=o.osVersion)||void 0===r?void 0:r.split(".")[0])<15&&(qL.on(tL.STATE_CHANGE,()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),JL(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(yL.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),qL.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),fb.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([t]));JL(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function tk(e,t,n){const r=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:r(t.height,1080),maxWidth:r(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function ik(e,t){const n=await nk(e.mediaSource),{sourceId:r,audio:i}=await function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Gh((n,r)=>{const i=document.createElement("div");i.innerText="share screen",i.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const o=document.createElement("div");o.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const a=document.createElement("div");a.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",a.setAttribute("style","height: 12%;");const s=document.createElement("div");s.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const u=document.createElement("button");u.innerHTML="cancel",u.setAttribute("style","width: 85px;"),u.onclick=()=>{document.body.removeChild(h);const e=new Error("NotAllowedError");e.name="NotAllowedError",r(e)};let l=t;const d=document.createElement("div");if(t){const e=document.createElement("input");e.setAttribute("type","checkbox");const t=document.createElement("span");e.setAttribute("style","margin-right: 6px;"),t.innerText="Share audio",e.checked=l,e.onchange=()=>{l=e.checked},d.appendChild(e),d.appendChild(t)}c.appendChild(d),c.appendChild(u),o.appendChild(a),o.appendChild(s),o.appendChild(c);const h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(i),h.appendChild(o),document.body.appendChild(h),e.map(e=>{if(e.id){const t=document.createElement("div");t.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=e.thumbnail;try{const{width:e}=r.getSize();e>1920&&(r=r.resize({width:1920}))}catch(e){throw e&&e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),e}t.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,function(e){return"&#"+e.charCodeAt(0)+";"})+"</span>",t.onclick=()=>{document.body.removeChild(h),n({sourceId:e.id,audio:l})},s.appendChild(t)}})})}(n,t);return await tk(r,e,i)}async function nk(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=Fy();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new Cy(Ry.ELECTRON_IS_NULL);let r=null;try{var i;r=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){r=null}r&&r.then||(r=new Gh((e,r)=>{n.desktopCapturer.getSources({types:t},(t,n)=>{t?r(t):e(n)})}));try{return await r}catch(e){throw new Cy(Ry.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}const rk=new NA("safari");let ok=!1,sk=!1;async function ak(e,t){let n=0,r=null;for(;n<2;)try{r=await ck(e,t,n>0);break}catch(e){if(e instanceof Cy)throw fb.error("[".concat(t,"] ").concat(e.toString())),e;const r=dk(e.name||e.code||e,e.message);if(r.code===Ry.MEDIA_OPTION_INVALID){fb.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await mA(500);continue}throw fb.error("[".concat(t,"] ").concat(r.toString())),r}if(!r)throw new Cy(Ry.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function ck(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Cy(Ry.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=ZP(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return fb.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(Fy())lk(i,e.screen.sourceId?await tk(e.screen.sourceId,e.screen,e.screenAudio):await ik(e.screen,e.screenAudio));else if(Jv()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new Cy(Ry.NOT_SUPPORTED,"This browser does not support screen sharing");fb.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const n=await(a=e.screen.extensionId,s=t,new Gh((e,t)=>{try{chrome.runtime.sendMessage(a,{getStream:!0},n=>{if(!n||!n.streamId)return fb.error("[".concat(s,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new Cy(Ry.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)})}catch(e){fb.error("[".concat(s,"] AgoraRTC screensharing plugin is not accessible(").concat(a,")"),e.toString()),t(new Cy(Ry.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=n,lk(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var o;e.screen.mediaSource&&EL(e.screen.mediaSource);const n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(o=e.screen.displaySurface)&&void 0!==o?o:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:r,surfaceSwitching:a,systemAudio:s}=e.screen,c={selfBrowserSurface:r,surfaceSwitching:a,systemAudio:s};!r&&delete c.selfBrowserSurface,!a&&delete c.surfaceSwitching,!s&&delete c.systemAudio,fb.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:!!e.screenAudio,controls:c})),lk(i,await navigator.mediaDevices.getDisplayMedia(GL({video:n,audio:!!e.screenAudio},c)))}else{if(!Zv())throw fb.error("[".concat(t,"] This browser does not support screenSharing")),new Cy(Ry.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&EL(e.screen.mediaSource);const n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};fb.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),lk(i,await navigator.mediaDevices.getUserMedia(n))}}var a,s;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},u=XA("MEDIA_DEVICE_CONSTRAINTS");if(u)try{"string"==typeof u&&(u=JSON.parse(u)),c=vA(c,u)}catch(e){}fb.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),Hv();let l,d=null;(Xv()||$v()||zv())&&(d=await rk.lock());try{l=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw d&&d(),e}return c.audio&&(ok=!0),c.video&&(sk=!0),lk(i,l),d&&d(),i}function dk(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Cy(Ry.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Cy(Ry.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Cy(Ry.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Cy(Ry.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Cy(Ry.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Cy(Ry.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return fb.error("getUserMedia unexpected error",e),new Cy(Ry.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function lk(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(r&&e.removeTrack(r),e.addTrack(o)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const uk=new class extends xy{get state(){return this._state}set state(e){e!==this._state&&(this.emit(kL.STATE_CHANGE,e),this._state=e)}constructor(){super(),BL(this,"_state",LL.IDLE),BL(this,"isAccessMicrophonePermission",!1),BL(this,"isAccessCameraPermission",!1),BL(this,"lastAccessMicrophonePermission",!1),BL(this,"lastAccessCameraPermission",!1),BL(this,"checkdeviceMatched",!1),BL(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(XA("ENUMERATE_DEVICES_INTERVAL")||(fy()||Yv()===Fv.HARMONY_OS)&&Ey())&&this.updateDevicesInfo()},XA("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>fb.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Cy(Ry.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let o=!this.isAccessMicrophonePermission&&e,a=!this.isAccessCameraPermission&&t;i.audio&&(o=!1),i.video&&(a=!1);let s=null,c=null,u=null;if(!n&&(o||a)){if(rk.isLocked&&(fb.debug("[device manager] wait GUM lock"),(await rk.lock())(),fb.debug("[device manager] GUM unlock")),ok&&(o=!1,this.isAccessMicrophonePermission=!0),sk&&(a=!1,this.isAccessCameraPermission=!0),fb.debug("[device manager] check media device permissions",e,t,o,a),o&&a){try{u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=dk(e.name||e.code||e,e.message);if(t.code===Ry.PERMISSION_DENIED)throw t;fb.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{s=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=dk(e.name||e.code||e,e.message);if(t.code===Ry.PERMISSION_DENIED)throw t;fb.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(a){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=dk(e.name||e.code||e,e.message);if(t.code===Ry.PERMISSION_DENIED)throw t;fb.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}fb.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return s&&s.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),u&&u.getTracks().forEach(e=>e.stop()),s=null,c=null,u=null,e}catch(e){return s&&s.getTracks().forEach(e=>e.stop()),c&&c.getTracks().forEach(e=>e.stop()),u&&u.getTracks().forEach(e=>e.stop()),s=null,c=null,u=null,new Cy(Ry.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audioinput"===e.kind)}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(e=>"videoinput"===e.kind)}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(e=>"audiooutput"===e.kind)}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(t=>t.deviceId===e);if(!t)throw new Cy(Ry.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=LL.INITING;try{await this.updateDevicesInfo(),this.state=LL.INITEND}catch(e){throw fb.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=LL.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new Cy(Ry.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find(e=>"audioinput"===e.kind&&"default"===e.deviceId),n=e.find(e=>"audiooutput"===e.kind&&"default"===e.deviceId);t&&n?n.groupId===t.groupId?fb.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):fb.warning("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):fb.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(e=>{if(!e.deviceId)return;const r=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(r?r.state:"INACTIVE")){const r={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),r),n.push(r)}r&&(r.updateAt=t)}),this.deviceInfoMap.forEach((e,r)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))}),this.state!==LL.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(kL.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(kL.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(kL.PLAYOUT_DEVICE_CHANGED,e)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter(e=>"audioinput"===e.kind),n=e.filter(e=>"videoinput"===e.kind),r={audio:!1,video:!1};for(const e of t)if(e.label&&e.deviceId){r.audio=!0;break}for(const e of n)if(e.label&&e.deviceId){r.video=!0;break}return r}};let hk=!1;const pk=new class extends xy{constructor(){super(...arguments),BL(this,"onAutoplayFailed",void 0),BL(this,"onAudioAutoplayFailed",void 0)}};function _k(){if(Hv(),!hk){const e=t=>{t.preventDefault(),hk=!1,my()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};hk=!0,my()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),fb.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),pk.onAutoplayFailed?pk.onAutoplayFailed():fb.warning(pk.onAudioAutoplayFailed?"AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .":"We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),pk.emit("autoplay-failed")}}function Ek(e,t,n,r){if(!e)return;const i=vb.getBaseInfoBySessionId(e);if(!i)return;const o=i.info,a=Date.now(),s=GL(GL({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:a,elapse:a-i.startTime,cbRegistered:pk.onAutoplayFailed||pk.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});vb.send({type:Rb.AUTOPLAY_FAILED,data:s},!0)}const fk=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],mk=new class{constructor(){BL(this,"onAutoplayFailed",void 0),BL(this,"elementMap",new Map),BL(this,"elementStateMap",new Map),BL(this,"elementsNeedToResume",[]),BL(this,"sinkIdMap",new Map),BL(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[n,r]=t;const i=this.elementStateMap.get(n),o=r.srcObject.getAudioTracks()[0],a=o&&o.readyState;if(fb.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(a," ").concat(e)),"live"===a){if(e)return r.pause(),void r.play();if("running"===qL.curState)return cy()?(r.pause(),void r.play()):void(i&&"paused"===i&&r.play())}})}),BL(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(fb.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),qL.on(tL.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qL.on(tL.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),qL.on(tL.STATE_CHANGE,()=>{$v()&&"suspended"===qL.prevState&&"running"===qL.curState&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new Cy(Ry.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,ML.INIT),this.setVolume(t,n);const o=this.sinkIdMap.get(t);if(o)try{i.setSinkId(o).catch(e=>{fb.warning("[".concat(t,"] set sink id failed"),e.toString())})}catch(e){fb.warning("[".concat(t,"] set sink id failed"),e.toString())}const a=i.play();a&&a.then&&a.catch(e=>{r&&Ek(r,"audio",e.message,t),fb.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(fb.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),oA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),_k()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){fk.forEach(n=>{t.addEventListener(n,n=>{const r=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(fb.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(i)),"error"===n.type){const n=null==t?void 0:t.error;n&&fb.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(e=>{fb.debug("Auto resume audio element success")}).catch(e=>{fb.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new Gh(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{my()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Tk(){return function(e,t,n){const r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new Cy(Ry.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",fb);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=r.apply(this,t);return i instanceof Gh?new Gh((e,t)=>{i.then(e).catch(t)}):i}),n}}class Sk extends xy{constructor(e){super(),BL(this,"name","VideoProcessorDestination"),BL(this,"ID","0"),BL(this,"_source",void 0),BL(this,"videoContext",void 0),BL(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Cy(Ry.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Cy(Ry.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(DL.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(DL.ON_TRACK,void 0)}}class gk extends xy{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),BL(this,"constraintsMap",new Map),BL(this,"statsRegistry",[]),BL(this,"usageRegistry",[]),BL(this,"trackId",void 0),BL(this,"direction",void 0),BL(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await Zy(this,PL.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return fb.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),$y(this,PL.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return fb.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),$y(this,PL.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t);-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){fb.error(new Cy(Ry.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof Gh&&(n=await n),e.push(GL(GL({},n),{},{direction:this.direction}))}catch(e){fb.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class Rk extends xy{constructor(e){super(),BL(this,"name","AudioProcessorDestination"),BL(this,"ID","0"),BL(this,"inputTrack",void 0),BL(this,"inputNode",void 0),BL(this,"audioProcessorContext",void 0),BL(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Cy(Ry.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Cy(Ry.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(DL.ON_TRACK,void 0),this.emit(DL.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(DL.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(DL.ON_NODE,this.inputNode))}}class Ck extends xy{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),BL(this,"constraintsMap",new Map),BL(this,"statsRegistry",[]),BL(this,"audioContext",void 0),BL(this,"trackId",void 0),BL(this,"direction",void 0),BL(this,"usageRegistry",[]),BL(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return Zy(this,PL.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return fb.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),$y(this,PL.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),$y(this,PL.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t);-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){fb.error(new Cy(Ry.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find(t=>t.processorID===e.ID&&t.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex(t=>t.processorID===e.ID&&t.processorName===e.name);-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof Gh&&(n=await n),e.push(GL(GL({},n),{},{direction:this.direction}))}catch(e){fb.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class Ik extends xy{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),BL(this,"context",void 0),BL(this,"processSourceNode",void 0),BL(this,"outputTrack",void 0),BL(this,"processedNode",void 0),BL(this,"clonedTrack",void 0),BL(this,"outputNode",void 0),this.outputNode=new vk}setVolume(){}createOutputTrack(){throw new Cy(Ry.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class vk{disconnect(){}connect(){}}function yk(e){return new Gh((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const o=$v()?"canplay":"playing";i.addEventListener(o,()=>{const e=i.videoWidth,n=i.videoHeight;!e&&Zv()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))}),i.srcObject=new MediaStream([e]),i.play().catch(gA),setTimeout(()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function Ak(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=dL(e.encoderConfig);return null!=n.width&&(t.width=n.width),null!=n.height&&(t.height=n.height),!py()&&n.frameRate&&(t.frameRate=n.frameRate),Qv()&&"object"==typeof t.frameRate&&(t.frameRate.max=60),Zv()&&(t.frameRate={ideal:30,max:30}),t}function bk(e){const t={};if(py()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,Jv()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=pL(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),fy()&&(t.sampleRate=void 0),t}const wk=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:r,height:i}=e.getMediaStreamTrackSettings();let{frameRate:o=n,width:a=r,height:s=i}=t;if(!o||!a||!s)return;a=AA(a),s=AA(s),o=AA(o);const{max:c,min:u}=function(e,t,n){const r=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75);return{min:Math.floor(r),max:Math.floor(4*r)}}(a,s,o),{bitrateMax:l,bitrateMin:d}=t||{};l||fb.debug("calculate bitrate: [w: ".concat(a,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(l,", brMin: ").concat(d,"]"));const{maxFramerate:h}=XA("ENCODER_CONFIG_LIMIT");return h&&"number"==typeof h&&(o=Math.min(o,h)),{frameRate:o,bitrateMax:l||c,bitrateMin:d||u,scaleResolutionDownBy:1,scale:0}},Ok=async(e,t,n)=>await(async(e,t,n)=>{const r=function(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(bA(""+t+n)).slice(0,16),i=r.slice(0,12),o=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,e))})(e.buffer,t,n),Nk=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Gh((n,r)=>{t.toBlob(async e=>{if(t.remove(),e){const r=await Dk(e);n({buffer:r,width:t.width,height:t.height})}else r(new Cy(Ry.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},Dk=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var Pk,Lk,kk,Mk,Uk,xk,Vk,Fk,Bk,jk,Gk,Wk,Hk,Kk,Yk,qk,zk,Jk,Xk,Qk,Zk,$k,eM,tM,iM,nM,rM,oM,sM,aM,cM,dM,lM,uM,hM,pM,_M,EM,fM,mM;let TM=(Pk=Ib({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),Lk=Ib({argsMap:(e,t)=>[e.getTrackId(),t]}),kk=Tk(),Mk=DA("LocalAudioTrack","_enabledMutex"),Uk=Ib({argsMap:(e,t)=>[e.getTrackId(),t]}),xk=Tk(),Vk=DA("LocalAudioTrack","_enabledMutex"),Fk=Ib({argsMap:(e,t)=>[e.getTrackId(),t]}),Bk=Tk(),jk=Tk(),Gk=Tk(),Wk=Ib({argsMap:e=>[e.getTrackId()]}),Hk=Tk(),Kk=Ib({argsMap:e=>[e.getTrackId()]}),Yk=Tk(),qk=Ib({argsMap:e=>[e.getTrackId()]}),zk=Ib({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Jk=Ib({argsMap:e=>[e.getTrackId()]}),FL((Xk=class extends HL{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?mk.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r){super(e,n),BL(this,"trackMediaType",vL.AUDIO),BL(this,"_encoderConfig",void 0),BL(this,"_trackSource",void 0),BL(this,"_enabled",!0),BL(this,"_volume",100),BL(this,"_useAudioElement",!0),BL(this,"_bypassWebAudio",!1),BL(this,"processor",void 0),BL(this,"_processorContext",void 0),BL(this,"_processorDestination",void 0),BL(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r,this._trackSource=new Ik,XA("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),XA("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Xv()&&!YL?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){yy(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&mk.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void fb.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,$y(this,fL.NEED_REPLACE_TRACK,this).then(()=>{fb.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(e=>{fb.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)}))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!$P())throw new Cy(Ry.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mk.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(fb.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await $y(this,fL.NEED_ENABLE_TRACK,this),fb.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw n||(this._enabled=!1),fb.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await $y(this,fL.NEED_DISABLE_TRACK,this)}catch(e){throw n||(this._enabled=!0),fb.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,fb.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await $y(this,fL.NEED_MUTE_TRACK,this):await $y(this,fL.NEED_UNMUTE_TRACK,this))}getStats(){return dA(()=>{fb.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),eA(this,fL.GET_STATS)||GL({},AL)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(yL.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(yL.ON_AUDIO_BUFFER),this._source.on(yL.ON_AUDIO_BUFFER,t=>e(t))}play(){fb.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(fb.debug("[".concat(this.getTrackId(),"] start audio playback in element")),mk.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){fb.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?mk.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];fb.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mk.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,fL.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Gh.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Cy(Ry.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Cy(Ry.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(DL.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await $y(this,fL.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,fL.NEED_REPLACE_TRACK,this))}),e.on(DL.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(e){e.removeAllListeners(DL.ON_TRACK),e.removeAllListeners(DL.ON_NODE)}bindProcessorContextEvents(e){e.on(PL.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(PL.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Ik&&(this._trackSource=new ek(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new Ck(this._source.context,this.getTrackId(),"local"),t=new Rk(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(yL.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(mk.stop(this.getTrackId()),this._source.play()),$y(this,fL.NEED_REPLACE_MIXING_TRACK,this).then(()=>{fb.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(e=>{fb.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),e)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[Pk],Object.getOwnPropertyDescriptor(Xk.prototype,"setVolume"),Xk.prototype),FL(Xk.prototype,"setPlaybackDevice",[Lk,kk],Object.getOwnPropertyDescriptor(Xk.prototype,"setPlaybackDevice"),Xk.prototype),FL(Xk.prototype,"setEnabled",[Mk,Uk,xk],Object.getOwnPropertyDescriptor(Xk.prototype,"setEnabled"),Xk.prototype),FL(Xk.prototype,"setMuted",[Vk,Fk,Bk],Object.getOwnPropertyDescriptor(Xk.prototype,"setMuted"),Xk.prototype),FL(Xk.prototype,"getStats",[jk],Object.getOwnPropertyDescriptor(Xk.prototype,"getStats"),Xk.prototype),FL(Xk.prototype,"setAudioFrameCallback",[Gk],Object.getOwnPropertyDescriptor(Xk.prototype,"setAudioFrameCallback"),Xk.prototype),FL(Xk.prototype,"play",[Wk,Hk],Object.getOwnPropertyDescriptor(Xk.prototype,"play"),Xk.prototype),FL(Xk.prototype,"stop",[Kk,Yk],Object.getOwnPropertyDescriptor(Xk.prototype,"stop"),Xk.prototype),FL(Xk.prototype,"close",[qk],Object.getOwnPropertyDescriptor(Xk.prototype,"close"),Xk.prototype),FL(Xk.prototype,"pipe",[zk],Object.getOwnPropertyDescriptor(Xk.prototype,"pipe"),Xk.prototype),FL(Xk.prototype,"unpipe",[Jk],Object.getOwnPropertyDescriptor(Xk.prototype,"unpipe"),Xk.prototype),Xk),SM=(Qk=Ib({argsMap:(e,t)=>[e.getTrackId(),t]}),Zk=Tk(),$k=DA("MicrophoneAudioTrack","_enabledMutex"),eM=Ib({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),tM=Tk(),iM=Ib({argsMap:e=>[e.getTrackId()]}),FL((nM=class extends TM{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?pL(t.encoderConfig):{},r,XA("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),BL(this,"_config",void 0),BL(this,"_deviceName","default"),BL(this,"_constraints",void 0),BL(this,"_originalConstraints",void 0),BL(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(cy()||dy())&&qL.bindInterruptDetectorTrack(this)}async setDevice(e){if(fb.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await uk.getDeviceById(e),n={};n.audio=GL({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await ak(n,this.getTrackId())}catch(e){throw fb.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await ak({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw fb.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await uk.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw fb.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}fb.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return fb.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(fb.info("[".concat(this.getTrackId(),"] start setEnabled"),e),XA("AUTO_RESET_AUDIO_ROUTE")&&($v()||uy())){const t=navigator.audioSession;t&&(e||(t.type="playback"),t.type="auto")}if(!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(r=this._source.clonedTrack)||void 0===r||r.stop(),n||(this._enabled=!1);try{await $y(this,fL.NEED_DISABLE_TRACK,this)}catch(e){throw fb.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const i=GL({},this._constraints),o=uk.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{n||(this._enabled=!0);const e=await ak({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await $y(this,fL.NEED_ENABLE_TRACK,this)}catch(e){throw n||(this._enabled=!1),fb.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}fb.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(cy()||dy())&&qL.unbindInterruptDetectorTrack(this)}onTrackEnded(){if(($v()||uy())&&this._enabled&&!this._isClosed&&qL.duringInterruption){const e=async()=>{qL.off(tL.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(fb.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};qL.on(tL.IOS_INTERRUPTION_END,e)}else fb.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(CL.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=uk.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await ak({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(PL.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(PL.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Qk,Zk],Object.getOwnPropertyDescriptor(nM.prototype,"setDevice"),nM.prototype),FL(nM.prototype,"setEnabled",[$k,eM,tM],Object.getOwnPropertyDescriptor(nM.prototype,"setEnabled"),nM.prototype),FL(nM.prototype,"close",[iM],Object.getOwnPropertyDescriptor(nM.prototype,"close"),nM.prototype),nM),gM=(rM=Ib({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),oM=Tk(),sM=Ib({argsMap:e=>[e.getTrackId()]}),aM=Tk(),cM=Ib({argsMap:e=>[e.getTrackId()]}),dM=Tk(),lM=Ib({argsMap:e=>[e.getTrackId()]}),uM=Tk(),hM=Ib({argsMap:e=>[e.getTrackId()]}),pM=Tk(),_M=Ib({argsMap:e=>[e.getTrackId()]}),EM=Ib({argsMap:e=>[e.getTrackId()]}),fM=Tk(),FL((mM=class extends TM{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),BL(this,"source",void 0),BL(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(yL.AUDIO_SOURCE_STATE_CHANGE,e=>{this.safeEmit(CL.SOURCE_STATE_CHANGE,e)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){yy(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[rM,oM],Object.getOwnPropertyDescriptor(mM.prototype,"startProcessAudioBuffer"),mM.prototype),FL(mM.prototype,"pauseProcessAudioBuffer",[sM,aM],Object.getOwnPropertyDescriptor(mM.prototype,"pauseProcessAudioBuffer"),mM.prototype),FL(mM.prototype,"seekAudioBuffer",[cM,dM],Object.getOwnPropertyDescriptor(mM.prototype,"seekAudioBuffer"),mM.prototype),FL(mM.prototype,"resumeProcessAudioBuffer",[lM,uM],Object.getOwnPropertyDescriptor(mM.prototype,"resumeProcessAudioBuffer"),mM.prototype),FL(mM.prototype,"stopProcessAudioBuffer",[hM,pM],Object.getOwnPropertyDescriptor(mM.prototype,"stopProcessAudioBuffer"),mM.prototype),FL(mM.prototype,"close",[_M],Object.getOwnPropertyDescriptor(mM.prototype,"close"),mM.prototype),FL(mM.prototype,"setAudioBufferPlaybackSpeed",[EM,fM],Object.getOwnPropertyDescriptor(mM.prototype,"setAudioBufferPlaybackSpeed"),mM.prototype),mM);class RM extends TM{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=zL().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,TA(8,"track-mix-")),BL(this,"trackList",void 0),BL(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(fb.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):fb.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){fb.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}nA(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(t=>{t instanceof RM?t.emit(RL.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)}))}}class CM extends $L{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(yL.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),BL(this,"audioBuffer",void 0),BL(this,"sourceNode",void 0),BL(this,"startPlayTime",0),BL(this,"startPlayOffset",0),BL(this,"pausePlayTime",0),BL(this,"options",void 0),BL(this,"currentLoopCount",0),BL(this,"currentPlaybackSpeed",100),BL(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.playbackSpeed/100*(this.context.currentTime-this.startPlayTime)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):fb.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const IM=new Map;class vM{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/(this.renderStats.curTs-this.renderStats.lastTs);return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,e}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(fb.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,null===(t=this.onVideoStateChanged)||void 0===t||t.call(this,this.videoState))}constructor(e){BL(this,"trackId",void 0),BL(this,"config",void 0),BL(this,"onFirstVideoFrameDecoded",void 0),BL(this,"onVideoStateChanged",void 0),BL(this,"freezeTimeCounterList",[]),BL(this,"renderFreezeAccTime",0),BL(this,"isKeepLastFrame",!1),BL(this,"timeUpdatedCount",0),BL(this,"freezeTime",0),BL(this,"playbackTime",0),BL(this,"lastTimeUpdatedTime",0),BL(this,"autoplayFailed",!1),BL(this,"videoTrack",void 0),BL(this,"videoElement",void 0),BL(this,"cacheVideoElement",void 0),BL(this,"renderStats",void 0),BL(this,"_videoState",UL.VideoStateStopped),BL(this,"videoElementCheckInterval",void 0),BL(this,"videoElementFreezeTimeout",void 0),BL(this,"_videoElementStatus",ML.NONE),BL(this,"isGettingVideoDimensions",!1),BL(this,"startGetVideoDimensions",()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return fb.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()}),BL(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===qL.curState&&(fb.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(qv())),ly()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),BL(this,"handleVideoEvents",e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=ML.PLAYING;break;case"loadeddata":if(this.videoState=UL.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ML.CANPLAY;break;case"stalled":this.videoElementStatus=ML.STALLED;break;case"suspend":this.videoElementStatus=ML.SUSPEND;break;case"pause":this.videoElementStatus=ML.PAUSED,$v()||uy()||Xv()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(fb.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ML.WAITING;break;case"abort":this.videoElementStatus=ML.ABORT;break;case"ended":this.videoElementStatus=ML.ENDED;break;case"emptied":this.videoElementStatus=ML.EMPTIED;break;case"error":{const e=this.videoElement.error,t=e?"".concat(e.message," (").concat(e.code,")"):"";e&&(this.videoElementStatus=ML.ERROR),fb.error("[".concat(this.trackId,"] media error: ").concat(t," "));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,yU.lastVisibleTime<yU.lastHiddenTime||n<yU.lastHiddenTime||n<yU.lastVisibleTime)return;for(t>XA("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),BL(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(fb.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(qv())),ly()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,this.videoElement=e.element instanceof HTMLVideoElement?e.element:document.createElement("video"),qL.on(tL.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qL.on(tL.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch(t=>{e&&Ek(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(fb.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):fb.warning("[".concat(this.trackId,"] play warning: "),t)});const n=Hv();if(("Safari"===n.name&&15===Number(n.version)||cy())&&t&&t.then){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return fb.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new Gh((r,i)=>{n.toBlob(async e=>{if(n.remove(),e){const t=await Dk(e);r({buffer:t,width:n.width,height:n.height})}else i(new Cy(Ry.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await Nk(e)}destroy(){this.renderStats=void 0,qL.off(tL.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qL.off(tL.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=UL.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ML.INIT,!this.videoElementCheckInterval&&(yM.forEach(e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(e){return e!==document.body&&document.body.contains(e)})(this.videoElement)||(this.videoElementStatus=ML.DESTROYED)},1e3),XA("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n;const r=()=>{"visible"===document.visibilityState&&(document.removeEventListener("visibilitychange",r),this.videoElementFreezeTimeout=window.setTimeout(i,XA("VIDEO_FREEZE_DURATION")))},i=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===UL.VideoStateDecoding&&("visible"===document.visibilityState?this.videoState=UL.VideoStateFrozen:document.addEventListener("visibilitychange",r))},o=(e,t)=>{if(this.videoElementStatus===ML.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=t.mediaTime):this.renderStats={lastTs:t.mediaTime,curTs:t.mediaTime,lastRenderNum:0,renderNum:0},n){const e=t.presentationTime-n.presentationTime;this.videoState===UL.VideoStateStarting&&(this.videoState=UL.VideoStateDecoding),this.videoState===UL.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(i,XA("VIDEO_FREEZE_DURATION"))),e<XA("VIDEO_FREEZE_DURATION")&&this.videoState===UL.VideoStateFrozen&&(this.videoState=UL.VideoStateDecoding),e>XA("VIDEO_FREEZE_DURATION")&&yU.lastVisibleTime>=yU.lastHiddenTime&&n.timestamp>yU.lastVisibleTime&&n.timestamp>yU.lastHiddenTime&&(this.renderFreezeAccTime+=e)}n=GL(GL({},t),{},{timestamp:e})}var r,a;XA("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(r=(a=this.videoElement).requestVideoFrameCallback)||void 0===r||r.call(a,o))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,o)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),fy()&&!XA("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const n=Hv();"Safari"===n.name&&15===Number(n.version)||cy()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Zv()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Zv()&&this.videoElement.load());const r=this.videoElement.play();void 0!==r&&r.catch(e=>{fb.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())})}resetVideoElement(){yM.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ML.NONE}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{fb.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(e=>{fb.error(e)}),this.autoplayFailed=!1,my()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};my()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),_k()}}const yM=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class AM extends vM{constructor(e){super(e),BL(this,"container",void 0),BL(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await Nk(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",XA("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var bM,wM,OM,NM,DM,PM,LM,kM,MM,UM,xM,VM,FM,BM,jM,GM,WM,HM,KM,YM,qM,zM,JM,XM,QM,ZM,$M,eU,tU,iU,nU,rU,oU,sU;let aU=(bM=Ib({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),wM=Tk(),OM=Ib({argsMap:e=>[e.getTrackId()]}),NM=DA("LocalVideoTrack","_enabledMutex"),DM=Ib({argsMap:(e,t)=>[e.getTrackId(),t]}),PM=Tk(),LM=DA("LocalVideoTrack","_enabledMutex"),kM=Ib({argsMap:(e,t)=>[e.getTrackId(),t]}),MM=Tk(),UM=Ib({argsMap:(e,t)=>[e.getTrackId(),t]}),xM=Tk(),VM=Tk(),FM=Ib({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),BM=Tk(),jM=Tk(),GM=Tk(),WM=Tk(),HM=Tk(),KM=Tk(),YM=Tk(),qM=Ib({argsMap:(e,t)=>[e.getTrackId(),t.name]}),zM=Ib({argsMap:e=>[e.getTrackId()]}),JM=Ib({argsMap:e=>[e.getTrackId()]}),XM=Ib({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),QM=class e extends HL{get videoHeight(){if(Xv()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(Xv()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ML.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,r,i,o){if(super(e,i),BL(this,"trackMediaType",vL.VIDEO),BL(this,"_player",void 0),BL(this,"isUseScaleResolutionDownBy",!1),BL(this,"_videoVisibleTimer",null),BL(this,"_previousVideoVisibleStatus",void 0),BL(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),BL(this,"_encoderConfig",void 0),BL(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),BL(this,"_optimizationMode",void 0),BL(this,"_videoHeight",void 0),BL(this,"_videoWidth",void 0),BL(this,"_forceBitrateLimit",void 0),BL(this,"_enabled",!0),BL(this,"_processorDestination",void 0),BL(this,"_processorContext",void 0),Xv()){const{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=t,this._scalabilityMode=n,this._optimizationMode=r,this._hints=o||[],-1===this._hints.indexOf(mL.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(e){const t=Hv();return!(t.name!==e||!t.osVersion)&&115===Number(t.version)}(Bv.CHROME)&&-1!==Yv().indexOf("Windows")){const t=function(e){if("VideoFrame"in window&&"TransformStream"in window&&ZP().supportWebRTCInsertableStream){const t=new MediaStreamTrackProcessor(e),n=new MediaStreamTrackGenerator({kind:"video"});let r,i,o=Date.now();const a=()=>{s&&(clearInterval(s),s=void 0),r&&(r.close(),r=void 0),e.stop(),i=void 0,n.removeEventListener("ended",a)};let s=window.setInterval(()=>{if(i&&r&&Date.now()-o>1e3)try{"live"===n.readyState?i.enqueue(r.clone()):a()}catch(e){a()}},1e3);const c=new TransformStream({transform:(e,t)=>{"live"===n.readyState?(i=t,o=Date.now(),void 0===r?(r=e,t.enqueue(e.clone())):(t.enqueue(r),r=e)):e.close()}});return n.addEventListener("ended",a),t.readable.pipeThrough(c).pipeTo(n.writable),n}}(e);t&&(fb.info("local screen video track begin to inject frame"),this._mediaStreamTrack=t)}t&&-1!==this._hints.indexOf(mL.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this._processorContext=new gk(this.getTrackId(),"local"),this._processorDestination=new Sk(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(fb.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}fb.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=GL(GL(GL({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(this._player=e instanceof HTMLVideoElement?new vM(n):new AM(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(CL.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},XA("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,fb.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(fb.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await $y(this,fL.NEED_DISABLE_TRACK,this)}catch(e){throw fb.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void fb.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await $y(this,fL.NEED_ENABLE_TRACK,this)}catch(e){throw fb.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}fb.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,fb.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await $y(this,fL.NEED_MUTE_TRACK,this):await $y(this,fL.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new Cy(Ry.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=dL(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=Ak({encoderConfig:e});(Xv()||$v()||uy())&&(t.deviceId=void 0),fb.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new Cy(Ry.UNEXPECTED_ERROR,e.toString());throw fb.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(mL.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await $y(this,fL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(fb)}}getStats(){return dA(()=>{fb.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),eA(this,fL.GET_STATS)||GL({},bL)}async setBeautyEffect(e){fb.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){return this._player?this._player.getCurrentFrameToUint8Array(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1):await Nk(e)}async setBitrateLimit(e){if(fb.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate,this._encoderConfig.bitrateMin=e.min_bitrate);try{await $y(this,fL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(fb)}}}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void fb.error(Ry.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await $y(this,fL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(e){throw this._optimizationMode=t,fb.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}fb.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return fb.error(Ry.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,fb.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){yk(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(gA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new Cy(Ry.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");fb.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=dL(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,-1===this._hints.indexOf(mL.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await $y(this,fL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(fb)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;const{bitrateMax:r,bitrateMin:i}=this._encoderConfig;if(null==i||null==r){const{max:o,min:a}=function(e,t,n,r,i){const o=XA("BITRATE_ADAPTER_TYPE");if("DEFAULT_BITRATE"===o)return{min:r,max:i};if(void 0===i){var a;const s=Math.floor(200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75));i="STANDARD_BITRATE"===o?4*s:2*s,r=null!==(a=r)&&void 0!==a?a:s}else{var s;r=null!==(s=r)&&void 0!==s?s:Math.floor(i/10)}return{min:r,max:i}}(e,t,n,i,r);this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,fb.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]"))}}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=Ly.checkOneElementVisible(i),t=Object.assign({},e);return t.visible!==this._previousVideoVisibleStatus&&(this._previousVideoVisibleStatus=t.visible,vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(t.visible?"Video is visible":"Invisible because of ".concat(t.reason))),t}return}catch(e){throw new Cy(Ry.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new Cy(Ry.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=GL(GL({},r),dL(t))),r=aA(r);const i=TA(8,"track-video-cloned-"),o=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,aA(this._scalabilityMode),this._optimizationMode,i,aA(this._hints));return t&&r&&o.setEncoderConfiguration(r),fb.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new Cy(Ry.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new Cy(Ry.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(dA(()=>{vb.reportApiInvoke(null,{name:By.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:jy.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!XA("ENABLE_VIDEO_SEI")||!XA("ENABLE_ENCODED_TRANSFORM"))return void fb.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new Cy(Ry.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const t=this.getRTCRtpTransceiver();if(!t)return void fb.warning("Video track is not published, SEI can not be send");const n=t.sender.getParameters();if(0===n.codecs.length)return;const r=n.codecs[0].mimeType.toLocaleLowerCase();"video/h264"===r?this.safeEmit("sei-to-send",e):fb.warning("SEI is not supported by ".concat(r))}bindProcessorDestinationEvents(){this.processorDestination.on(DL.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await $y(this,fL.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,fL.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(DL.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(PL.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(PL.REQUEST_CONSTRAINTS)}},FL(QM.prototype,"play",[bM,wM],Object.getOwnPropertyDescriptor(QM.prototype,"play"),QM.prototype),FL(QM.prototype,"stop",[OM],Object.getOwnPropertyDescriptor(QM.prototype,"stop"),QM.prototype),FL(QM.prototype,"setEnabled",[NM,DM,PM],Object.getOwnPropertyDescriptor(QM.prototype,"setEnabled"),QM.prototype),FL(QM.prototype,"setMuted",[LM,kM,MM],Object.getOwnPropertyDescriptor(QM.prototype,"setMuted"),QM.prototype),FL(QM.prototype,"setEncoderConfiguration",[UM,xM],Object.getOwnPropertyDescriptor(QM.prototype,"setEncoderConfiguration"),QM.prototype),FL(QM.prototype,"getStats",[VM],Object.getOwnPropertyDescriptor(QM.prototype,"getStats"),QM.prototype),FL(QM.prototype,"setBeautyEffect",[FM,BM],Object.getOwnPropertyDescriptor(QM.prototype,"setBeautyEffect"),QM.prototype),FL(QM.prototype,"getCurrentFrameData",[jM],Object.getOwnPropertyDescriptor(QM.prototype,"getCurrentFrameData"),QM.prototype),FL(QM.prototype,"getCurrentFrameImage",[GM],Object.getOwnPropertyDescriptor(QM.prototype,"getCurrentFrameImage"),QM.prototype),FL(QM.prototype,"setBitrateLimit",[WM],Object.getOwnPropertyDescriptor(QM.prototype,"setBitrateLimit"),QM.prototype),FL(QM.prototype,"setOptimizationMode",[HM],Object.getOwnPropertyDescriptor(QM.prototype,"setOptimizationMode"),QM.prototype),FL(QM.prototype,"setScalabiltyMode",[KM],Object.getOwnPropertyDescriptor(QM.prototype,"setScalabiltyMode"),QM.prototype),FL(QM.prototype,"updateMediaStreamTrackResolution",[YM],Object.getOwnPropertyDescriptor(QM.prototype,"updateMediaStreamTrackResolution"),QM.prototype),FL(QM.prototype,"pipe",[qM],Object.getOwnPropertyDescriptor(QM.prototype,"pipe"),QM.prototype),FL(QM.prototype,"unpipe",[zM],Object.getOwnPropertyDescriptor(QM.prototype,"unpipe"),QM.prototype),FL(QM.prototype,"close",[JM],Object.getOwnPropertyDescriptor(QM.prototype,"close"),QM.prototype),FL(QM.prototype,"replaceTrack",[XM],Object.getOwnPropertyDescriptor(QM.prototype,"replaceTrack"),QM.prototype),QM),cU=(ZM=Ib({argsMap:(e,t)=>[e.getTrackId(),t]}),$M=Tk(),eU=DA("CameraVideoTrack","_enabledMutex"),tU=Ib({argsMap:(e,t)=>[e.getTrackId(),t]}),iU=Tk(),nU=Ib({argsMap:(e,t)=>[e.getTrackId(),t]}),rU=Tk(),oU=Ib({argsMap:e=>[e.getTrackId()]}),sU=class e extends aU{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,i,o){super(e,dL(t.encoderConfig),r,i,o),BL(this,"_config",void 0),BL(this,"_originalConstraints",void 0),BL(this,"_constraints",void 0),BL(this,"_enabled",!0),BL(this,"_deviceName","default"),BL(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(cy()||dy())&&!function(){const e=Hv();if(e.os!==Fv.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&hy()&&this._enabled&&!this._isClosed&&(fb.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=dL(this._config.encoderConfig),qL.on(tL.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),qL.on(tL.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return"string"==typeof e?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(fb.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await uk.getDeviceById(e),n={};n.video=GL({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await ak(n,this.getTrackId())}catch(e){throw fb.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await ak({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw fb.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await uk.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw fb.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}fb.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){fb.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const t={video:GL(GL({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let e=null;try{e=await ak(t,this.getTrackId())}catch(t){throw fb.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),t.toString()),e=await ak({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=GL({},t.video),fb.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(fb.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await ak({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await $y(this,fL.NEED_ENABLE_TRACK,this)}catch(e){throw fb.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),fb.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await $y(this,fL.NEED_DISABLE_TRACK,this)}catch(e){throw fb.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}fb.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new Cy(Ry.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=dL(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const n=sA(this._config);n.encoderConfig=e;const r=Ak(n);(Xv()||$v()||uy())&&(r.deviceId=void 0),fb.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(e){const t=new Cy(Ry.UNEXPECTED_ERROR,e.toString());throw fb.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,-1===this._hints.indexOf(mL.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await $y(this,fL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw(fb)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if(($v()||uy())&&this._enabled&&!this._isClosed&&qL.duringInterruption){const e=async()=>{qL.off(tL.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(fb.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};qL.on(tL.IOS_INTERRUPTION_END,e)}else fb.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(CL.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=uk.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const e=await ak({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),qL.off(tL.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),qL.off(tL.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this._encoderConfig;t&&(r=GL(GL({},r),dL(t))),r=aA(r);const i=TA(8,"track-cam-cloned-"),o=new e(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,aA(GL(GL({},this._config),{},{encoderConfig:r})),aA(this._constraints),aA(this._scalabilityMode),this._optimizationMode,i);return t&&r&&o.setEncoderConfiguration(r),fb.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}bindProcessorContextEvents(){this.processorContext.on(PL.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}}),this.processorContext.on(PL.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},FL(sU.prototype,"setDevice",[ZM,$M],Object.getOwnPropertyDescriptor(sU.prototype,"setDevice"),sU.prototype),FL(sU.prototype,"setEnabled",[eU,tU,iU],Object.getOwnPropertyDescriptor(sU.prototype,"setEnabled"),sU.prototype),FL(sU.prototype,"setEncoderConfiguration",[nU,rU],Object.getOwnPropertyDescriptor(sU.prototype,"setEncoderConfiguration"),sU.prototype),FL(sU.prototype,"close",[oU],Object.getOwnPropertyDescriptor(sU.prototype,"close"),sU.prototype),sU);function dU(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=GL(GL({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?fb.debug("[".concat(e,"] set content hint to"),n.optimizationMode):fb.debug("[".concat(e,"] set content hint failed")))):fb.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var lU,uU,hU,pU,_U,EU,fU,mU,TU,SU,gU,RU;class CU extends WL{getUserId(){return this._userId}constructor(e,t,n,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(TA(5,""))),BL(this,"_userId",void 0),BL(this,"_uintId",void 0),BL(this,"_isDestroyed",!1),BL(this,"store",void 0),BL(this,"processor",void 0),BL(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,fb.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let IU=(lU=Ib({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),uU=Ib({argsMap:e=>[e.getTrackId()]}),hU=Ib({argsMap:(e,t)=>[e.getTrackId(),t.name]}),pU=Ib({argsMap:e=>[e.getTrackId()]}),FL((_U=class extends CU{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ML.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),BL(this,"_videoVisibleTimer",null),BL(this,"_previousVideoVisibleStatus",void 0),BL(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),BL(this,"trackMediaType",vL.VIDEO),BL(this,"_videoWidth",void 0),BL(this,"_videoHeight",void 0),BL(this,"_player",void 0),BL(this,"processorDestination",void 0),BL(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new gk(this.getTrackId(),"remote"),this.processorDestination=new Sk(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return dA(()=>{fb.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),eA(this,fL.GET_STATS)||GL({},NL)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(fb.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}fb.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=GL(GL({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(this._player=e instanceof HTMLVideoElement?new vM(n):new AM(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(IL.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=e=>{this.safeEmit(IL.VIDEO_STATE_CHANGED,e)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(IL.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}},XA("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,fb.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){yk(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(gA)}_updatePlayerSource(){fb.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=Ly.checkOneElementVisible(i),t=Object.assign({},e);return t.visible!==this._previousVideoVisibleStatus&&(this._previousVideoVisibleStatus=t.visible,vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]}).onSuccess(t.visible?"Video is visible":"Invisible because of ".concat(t.reason))),t}return}catch(e){throw new Cy(Ry.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Cy(Ry.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(DL.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(DL.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(RL.SEI_RECEIVED,e)}}).prototype,"play",[lU],Object.getOwnPropertyDescriptor(_U.prototype,"play"),_U.prototype),FL(_U.prototype,"stop",[uU],Object.getOwnPropertyDescriptor(_U.prototype,"stop"),_U.prototype),FL(_U.prototype,"pipe",[hU],Object.getOwnPropertyDescriptor(_U.prototype,"pipe"),_U.prototype),FL(_U.prototype,"unpipe",[pU],Object.getOwnPropertyDescriptor(_U.prototype,"unpipe"),_U.prototype),_U),vU=(EU=Ib({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),fU=Ib({argsMap:(e,t)=>[e.getTrackId(),t]}),mU=Ib({argsMap:e=>[e.getTrackId()]}),TU=Ib({argsMap:e=>[e.getTrackId()]}),SU=Ib({argsMap:(e,t)=>[e.getTrackId(),t.name]}),gU=Ib({argsMap:e=>[e.getTrackId()]}),FL((RU=class extends CU{get isPlaying(){return this._useAudioElement?mk.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),BL(this,"trackMediaType",vL.AUDIO),BL(this,"_source",void 0),BL(this,"_useAudioElement",!0),BL(this,"_volume",100),BL(this,"processorContext",void 0),BL(this,"processorDestination",void 0),BL(this,"_played",!1),BL(this,"_bypassWebAudio",!1),XA("DISABLE_WEBAUDIO")?(this._source=new Ik,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ek(e,!0),XA("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(yL.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(IL.FIRST_FRAME_DECODED)}),this.processorContext=new Ck(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Rk(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(yL.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(yL.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(yL.ON_AUDIO_BUFFER),this._source.on(yL.ON_AUDIO_BUFFER,t=>e(t))}setVolume(e){this._volume=e,this._useAudioElement?mk.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!$P())throw new Cy(Ry.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mk.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return dA(()=>{fb.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),eA(this,fL.GET_STATS)||GL({},wL)}play(){fb.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(fb.debug("[".concat(this.getTrackId(),"] use audio element to play")),mk.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){fb.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?mk.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];fb.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mk.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Cy(Ry.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Cy(Ry.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Cy(Ry.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(DL.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(DL.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(DL.ON_TRACK),this.processorDestination.removeAllListeners(DL.ON_NODE)}}).prototype,"setVolume",[EU],Object.getOwnPropertyDescriptor(RU.prototype,"setVolume"),RU.prototype),FL(RU.prototype,"setPlaybackDevice",[fU],Object.getOwnPropertyDescriptor(RU.prototype,"setPlaybackDevice"),RU.prototype),FL(RU.prototype,"play",[mU],Object.getOwnPropertyDescriptor(RU.prototype,"play"),RU.prototype),FL(RU.prototype,"stop",[TU],Object.getOwnPropertyDescriptor(RU.prototype,"stop"),RU.prototype),FL(RU.prototype,"pipe",[SU],Object.getOwnPropertyDescriptor(RU.prototype,"pipe"),RU.prototype),FL(RU.prototype,"unpipe",[gU],Object.getOwnPropertyDescriptor(RU.prototype,"unpipe"),RU.prototype),RU);const yU=new class extends xy{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),BL(this,"_lastHiddenTime",0),BL(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),fb.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class AU extends xy{constructor(e,t){super(),BL(this,"trackMediaType",vL.DATA),BL(this,"_version",1),BL(this,"_type",3),BL(this,"_config",void 0),BL(this,"_originDataChannel",void 0),BL(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),BL(this,"_dataStreamPacketHandler",{serialize:e=>e,deserialize:e=>e}),BL(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return XA("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.readyState)&&void 0!==e?e:"connecting"}get _originDataChannelId(){var e,t;return null!==(e=null===(t=this._originDataChannel)||void 0===t?void 0:t.id)&&void 0!==e?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Gh((e,t)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&e();const n=setTimeout(()=>{var e;t(new Cy(Ry.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(e=this._originDataChannel)||void 0===e?void 0:e.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new Cy(Ry.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new Cy(Ry.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[VL.OPEN,VL.CLOSE,VL.ERROR].forEach(t=>{const n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[n,r]=t;e.removeEventListener(n,r)}),this._datachannelEventMap.clear()}}class bU extends AU{constructor(e){super(e),BL(this,"_messageListener",void 0),this._messageListener=e=>{if(e.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const t=e.data.slice(0,this._dataStreamPacketHeader.byteLength),n=new DataView(t).getUint8(3);if(n!==this.id)return void(XA("SHOW_DATASTREAM2_LOG")&&fb.debug("invalid datachannel id: ".concat(n," !== ").concat(this.id)));let r=e.data.slice(this._dataStreamPacketHeader.byteLength);r=this._dataStreamPacketHandler.deserialize(r),this.emit(VL.MESSAGE,r)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class wU extends AU{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function OU(){const e=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>XP.revokeObjectURL(e),0),new Worker(XP.createObjectURL(e))}const NU=new Map,DU=new Map;function PU(e,t,n){let r=new Uint8Array(e,t,n),i=[],o=0;for(;i.length<n;)o+3<n&&0===r[o]&&0===r[o+1]&&3===r[o+2]&&(0===r[o+3]||1===r[o+3]||2===r[o+3]||3===r[o+3])?(i.push(r[o],r[o+1],r[o+3]),o+=4):(i.push(r[o]),o++);return new Uint8Array(i)}const LU=new Map;async function kU(e,t){if(!ZP().supportWebRTCEncodedTransform)return void fb.warning("browser not support video encoded transform");if(LU.has(e))return;if(!e.track)return;const n={track:e.track};if(Jv()){if(!e.createEncodedStreams)return void fb.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(e){return void fb.error("create video-encoded-streams error",e&&e.message)}let o=[];t.on("sei-to-send",e=>{o.push(e)});const a=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(fb.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const a=o.shift();a&&(t.data=function(e,t){const n=function(e){const t=e.length;let n=[],r=0;for(;r<t;)r+2<t&&0===e[r]&&0===e[r+1]&&(0===e[r+2]||1===e[r+2]||2===e[r+2]||3===e[r+2])?(n.push(e[r],e[r+1],3,e[r+2]),r+=3):(n.push(e[r]),r++);return new Uint8Array(n)}(t),r=n.length,i=Math.floor(r/255),o=r%255,a=new Uint8Array(6+i+1+r+e.byteLength);a[0]=0,a[1]=0,a[2]=0,a[3]=1,a[4]=6,a[5]=101;let s=0;for(;s<i;)a[6+s]=255,s++;return a[6+s]=o,s++,a.set(n,6+s),a.set(new Uint8Array(e),6+s+r),a.buffer}(t.data,a)),i.enqueue(t)}});i.readable.pipeThrough(a).pipeTo(i.writable)}else{if(!Xv())return;{if("undefined"==typeof RTCRtpScriptTransform)return void fb.warning("browser not support RTCRtpScriptTransform");const i=OU(),o=new MessageChannel;await new Gh(e=>i.onmessage=t=>{"registered"===t.data&&e(void 0)});const a=new RTCRtpScriptTransform(i,{name:"tx",port:o.port2},[o.port2]);e.transform=a,await new Gh(e=>i.onmessage=t=>{"started"===t.data&&e(void 0)}),t.on("sei-to-send",e=>{o.port1.postMessage({sei:e})}),o.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id&&(fb.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}const t=LU.get(e);if(t){LU.delete(e);try{var n,i;null===(n=t.controller)||void 0===n||n.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){fb.warning(e&&e.message)}}}LU.set(e,n),e.track.addEventListener("ended",r)}const MU=new Map;!function(){const e=Hv();QP.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),QP.getStreamFromExtension=e.name===Bv.CHROME&&Number(e.version)>34,QP.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),QP.supportMinBitrate=e.name===Bv.CHROME||e.name===Bv.EDGE,QP.supportSetRtpSenderParameters=function(){const e=Hv();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ey()||!(!Xv()&&!zv())||e.name===Bv.FIREFOX&&Number(e.version)>=64)}(),e.name===Bv.SAFARI&&(QP.supportDualStream=Number(e.version)>=14),QP.webAudioMediaStreamDest=function(){const e=Hv();return!(e.name===Bv.SAFARI&&Number(e.version)<12)}(),QP.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,QP.supportWebGL="undefined"!=typeof WebGLRenderingContext,QP.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ey()||(QP.webAudioWithAEC=!0),QP.supportShareAudio=function(){const e=Hv();return(e.os===Fv.WIN_10||e.os===Fv.WIN_81||e.os===Fv.WIN_7||e.os===Fv.LINUX||e.os===Fv.MAC_OS||e.os===Fv.CHROMIUM_OS)&&e.name===Bv.CHROME&&Number(e.version)>=74}(),QP.supportDataChannel=!!(ey(76)||function(){const e=Hv();return!(e.name!==Bv.FIREFOX||!e.osVersion)&&Number(e.version)>=68}()||ny(14)),QP.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!Zv()&&!!e&&e.prototype.setConfiguration instanceof Function}(),QP.supportWebRTCEncodedTransform=function(){const e=Hv();return"Chrome"===e.name&&Number(e.version)>=86||"Safari"===e.name&&Number(e.version)>=15}(),QP.supportWebRTCInsertableStream=function(){const e=Hv();return(e.name===Bv.CHROME||e.name===Bv.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),QP.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,QP.supportWebCrypto="undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle,oA(()=>{QP.supportDualStreamEncoding=function(){const e=Hv();return!!XA("DISABLE_WEBAUDIO")||"Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&XA("CHROME_DUAL_STREAM_USE_ENCODING"))}(),fb.info("browser compatibility",JSON.stringify(QP),JSON.stringify(e))})}();class UU extends xy{constructor(e,t){super(),Fg(this,"signal",void 0),Fg(this,"token",void 0),Fg(this,"tokenTimeout",void 0),Fg(this,"tokenInterval",void 0),Fg(this,"_sequence",0),Fg(this,"userMap",new Map),Fg(this,"encoder",new TextEncoder),this.signal=e,this.token=t;const n=()=>{this.signal.connectionState===Nw.CONNECTED&&this.check(),this.tokenInterval=0===this.userMap.size?window.setTimeout(n,1e3):window.setTimeout(n,3*XA("P2P_TOKEN_INTERVAL"))};n()}async send(e,t,n,r,i){var o,a,s;if(0===this.userMap.size)return;const c=Array.from(_N(o=this.userMap).call(o))[0].token;"string"!=typeof t&&(t=JSON.stringify(t)),r=null!==(a=r)&&void 0!==a?a:TA(6,""),i=null!==(s=i)&&void 0!==s?s:this._sequence++;const u={_id:r,_type:e,_seq:i,_message:t,token:"".concat(this.token,"_").concat(c)};XA("SHOW_P2P_LOG")&&fb.debug("send message",u,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(u)).forEach(e=>{this.signal.request(Pw.DATA_STREAM,{payload:uA(this.encoder.encode(e))})});const l=new Gh((t,i)=>{const o=window.setTimeout(()=>{this.off("res-@".concat(r,"_ack"),a),this.off("res-@".concat(r),c),this.off(vO.ABORT,s),fb.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(r)),i(new Cy(0===this.userMap.size?Ry.INVALID_REMOTE_USER:Ry.TIMEOUT))},XA("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),a=()=>{o&&window.clearTimeout(o),this.off(vO.ABORT,s),n&&t()},s=()=>{o&&window.clearTimeout(o),this.off("res-@".concat(r,"_ack"),a),this.off("res-@".concat(r),c),i(new Cy(Ry.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(r)))};this.once(vO.ABORT,s),this.once("res-@".concat(r,"_ack"),a);const c=(n,c)=>{l=!0,o&&window.clearTimeout(o),this.off("res-@".concat(r,"_ack"),a),this.off(vO.ABORT,s),"success"===n?t(c):i(new Cy(Ry.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(r)))};let l=!1;n||(this.once("res-@".concat(r),c),mA(XA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{l||fb.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(r,", ").concat(u))}))});try{return await l}catch(o){if(o.code===Ry.TIMEOUT)return await this.send(e,t,n,r,i);throw o}}onMessage(e){var t;const{_uid:n}=e;let r,i=this.userMap.get(n);if(i)r=i.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==IO.CHECK)return;const{token:t}=e;r=new Map,i={uid:n,isStart:!0,token:t,splitMessageMap:r,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,i),this.signal.emit(kw.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in e&&"total"in e){var o;const{id:t,total:i}=e,a=null!==(o=r.get(t))&&void 0!==o?o:[];if(a.push(e),r.has(t)||r.set(t,a),a.length!==i)return;{const i=aE(a).call(a,(e,t)=>e.index-t.index).map(e=>e.payload).join("");r.delete(t),(e=JSON.parse(i))._uid=n}}const{_type:a,token:s}=e;if(Dn(t=[IO.ACK,IO.CHECK]).call(t,a))return a===IO.CHECK&&this.handleCheckToken(i,s),void this.receiveMessage(e);s==="".concat(i.token,"_").concat(this.token)?this.handleReceivedMessage(e):fb.debug('Receive unexpected message", '.concat(s,", cur_token: ").concat(i.token,"_").concat(this.token),e)}check(){const e={_id:TA(6,""),token:this.token,_type:IO.CHECK};XA("SHOW_P2P_LOG")&&fb.debug("send message",e),this.signal.request(Pw.DATA_STREAM,{payload:uA(this.encoder.encode(JSON.stringify(e)))})}ack(e){const t={_id:e,_type:IO.ACK,token:this.token};XA("SHOW_P2P_LOG")&&fb.debug("send message",t),this.signal.request(Pw.DATA_STREAM,{payload:uA(this.encoder.encode(JSON.stringify(t)))})}response(e,t,n){this.send(IO.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){const t=()=>{this.userMap.forEach(e=>{const{receivedMessagesMap:t,nextExpectedSequenceNumber:n}=e;for(;t.has(n);){const r=t.get(n);t.delete(n),this.receiveMessage(r),e.nextExpectedSequenceNumber++}})};if(!e)return void t();const{_uid:n,_seq:r}=e,i=this.userMap.get(n),{receivedMessagesMap:o,isStart:a,nextExpectedSequenceNumber:s}=i;if(r<s)return this.ack(e._id),void fb.debug("[external-signal] receive old message, seq: ".concat(r,", ").concat(e._message));o.set(r,e),a&&r===s&&(this.receiveMessage(e),o.delete(s),i.nextExpectedSequenceNumber++,t())}receiveMessage(e){const{_id:t,_type:n,_message:r,_uid:i}=e;if(XA("SHOW_P2P_LOG")&&fb.debug("receive message",e),t){let o;switch(e._type!==IO.ACK&&(r&&(o=JSON.parse(r)),this.ack(e._id)),e._type){case IO.CANDIDATE:case IO.CONTROL:this.signal.emit(n,o,i);break;case IO.PUBLISH:case IO.UNPUBLISH:case IO.RESTART_ICE:case IO.CALL:o.uid=i,Zy(this.signal,n,o).then(t=>{this.response(e._id,t)}).catch(()=>{this.response(e._id,void 0,!0)});break;case IO.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case IO.RESPONSE:{const{success:e,message:n}=o;this.emit("res-@".concat(t),e?"success":"failed",n);break}}}}splitMessage(e){if(e.length<UU.MAX_MESSAGE_SIZE)return[e];const t=[],{remoteToken:n}=JSON.parse(e),r=TA(6,"");let i=0,o=800;const a=Math.ceil(e.length/o);for(;e.length>0;){i++;const s={id:r,index:i,total:a,payload:e.slice(0,o),token:"".concat(this.token,"_").concat(n)};JSON.stringify(s).length>UU.MAX_MESSAGE_SIZE?o-=50:(t.push(s),e=e.slice(o))}return t.map(e=>JSON.stringify(e))}handleCheckToken(e,t){return e.token!==t?(fb.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{fb.debug("token timeout, ".concat(t)),this.reset(e.uid)},XA("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await Zy(this.signal,IO.CALL,void 0),t=await this.send(IO.CALL,e);this.signal.emit(Dw.P2P_CONNECTION,t,!0)}async reset(e,t){const n=this.userMap.get(e);n&&(this.emit(vO.ABORT),this.signal.emit(kw.ON_USER_OFFLINE,{uid:n.uid,reason:AO.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(fb.debug("change local token from ".concat(t," to ").concat(t)),this.token=TA(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(vO.ABORT)}}Fg(UU,"MAX_SIZE",1),Fg(UU,"MAX_MESSAGE_SIZE",1024);class xU extends xy{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Nw.CONNECTED?this.emit(Dw.WS_CONNECTED):e===Nw.RECONNECTING?this.emit(Dw.WS_RECONNECTING,this._websocketReconnectReason):e===Nw.CLOSED&&this.emit(Dw.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),Fg(this,"_disconnectedReason",void 0),Fg(this,"_websocketReconnectReason",void 0),Fg(this,"_connectionState",Nw.CLOSED),Fg(this,"reconnectToken",void 0),Fg(this,"p2pToken",void 0),Fg(this,"websocket",void 0),Fg(this,"openConnectionTime",void 0),Fg(this,"clientId",void 0),Fg(this,"lastMsgTime",Date.now()),Fg(this,"uploadCache",[]),Fg(this,"uploadCacheInterval",void 0),Fg(this,"rttRolling",new MA(5)),Fg(this,"pingpongTimer",void 0),Fg(this,"pingpongTimeoutCount",0),Fg(this,"joinResponse",void 0),Fg(this,"multiIpOption",void 0),Fg(this,"initError",void 0),Fg(this,"spec",void 0),Fg(this,"store",void 0),Fg(this,"_external_signal",void 0),Fg(this,"onWebsocketMessage",e=>{if(e.data instanceof ArrayBuffer)return void this.emit(Dw.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){switch(t._type){case kw.ON_DATA_STREAM:return void this.handleDataStream(t._message);case kw.MUTE_AUDIO:case kw.MUTE_VIDEO:case kw.ON_P2P_LOST:case kw.ON_USER_ONLINE:return;case kw.ON_USER_OFFLINE:const{uid:e}=t._message;return fb.debug("[".concat(this.clientId,"] user-offline uid: ").concat(e)),void this._external_signal.reset(e)}if(this.emit(t._type,t._message),t._type===kw.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===kw.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(Hy.UID_BANNED);break;case 15:this.close(Hy.IP_BANNED);break;case 16:this.close(Hy.CHANNEL_BANNED)}if(t._type===kw.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case Ow.ERR_LICENSE_MISSING:this.close(Hy.LICENSE_MISSING);break;case Ow.ERR_LICENSE_EXPIRED:this.close(Hy.LICENSE_EXPIRED);break;case Ow.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Hy.LICENSE_MINUTES_EXCEEDED);break;case Ow.ERR_LICENSE_PERIOD_INVALID:this.close(Hy.LICENSE_PERIOD_INVALID);break;case Ow.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Hy.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ow.ERR_LICENSE_ILLEGAL:this.close(Hy.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new WO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,XA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),XA("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Nw.CONNECTED&&this.reconnect("retry",Jy.OFFLINE)}),this.p2pToken=TA(6,""),this._external_signal=new UU(this,this.p2pToken)}async request(e,t,n,r){const i=TA(6,""),o={_id:i,_type:e,_message:t},a=this.websocket.connectionID,s=()=>new Gh((e,t)=>{if(this.connectionState===Nw.CONNECTED)return e();const n=()=>{this.off(Dw.WS_CLOSED,r),e()},r=()=>{this.off(Dw.WS_CONNECTED,n),t(new Cy(Ry.WS_ABORT))};this.once(Dw.WS_CONNECTED,n),this.once(Dw.WS_CLOSED,r)});if(this.connectionState!==Nw.CONNECTING&&this.connectionState!==Nw.RECONNECTING||e===Pw.JOIN||e===Pw.REJOIN||await s(),this.websocket.sendMessage(o,!0),r)return;const c=new Gh((n,r)=>{let o=!1;const s=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(Dw.WS_CLOSED,c),this.off(Dw.WS_RECONNECTING,c),this.emit(Dw.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),s);const c=()=>{r(new Cy(Ry.WS_ABORT,"type: ".concat(e))),this.off(Dw.WS_CLOSED,c),this.off(Dw.WS_RECONNECTING,c),this.off("res-@".concat(i),s)};this.once(Dw.WS_CLOSED,c),this.once(Dw.WS_RECONNECTING,c),mA(XA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||o||(fb.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Dw.REQUEST_TIMEOUT,e,t))})});let u=null;try{u=await c}catch(r){if(this.connectionState===Nw.CLOSED||e===Pw.LEAVE)throw new Cy(Ry.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===Pw.JOIN||e===Pw.REJOIN?null:(await s(),await this.request(e,t))}if(u.isSuccess)return u.message;const l=Number(u.message.error_code||u.message.code),d=NO(l),h=new Cy(Ry.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(u.message.error_str),{code:l,data:u.message,desc:d.desc});return"success"===d.action?u.message:(fb.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(d.desc,", action: ").concat(d.action)),l===Ow.ERR_TOO_MANY_BROADCASTERS?e===Pw.JOIN||e===Pw.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(l===Ow.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,fb.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Jy.MULTI_IP)):this.reconnect(d.action,Jy.SERVER_ERROR),e===Pw.JOIN||e===Pw.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Gh(n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)})}uploadWRTCStats(e){if(!this.store.sessionId)return void fb.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Lw.WRTC_STATS,t)}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=XA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Nw.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)},XA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){this.websocket.sendMessage({_type:e,_message:t})}async sendExtensionMessage(e,t,n){return await this._external_signal.send(e,t,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Gh((t,n)=>{this.once(Dw.WS_CONNECTED,()=>t(this.joinResponse)),this.once(Dw.WS_CLOSED,()=>n(this.initError||new Cy(Ry.WS_ABORT))),this.connectionState=Nw.CONNECTING,this.websocket.init(e).catch(n)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Hy.LEAVE,this.connectionState=Nw.CLOSED,fb.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=TA(6,""),this._external_signal.clear(),this._external_signal=new UU(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Dw.ABORT_P2P_EXECUTION);const e=await Zy(this,Dw.REQUEST_JOIN_INFO),t=await this.request(Pw.JOIN,e);if(!t)return this.emit(Dw.REPORT_JOIN_GATEWAY,Ry.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(Dw.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Nw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleDataStream(e){try{var t;const n=lA(e.payload),r=(new TextDecoder).decode(n),i=JSON.parse(r);"total"in i&&"id"in i||Dn(t=Object.values(IO)).call(t,i._type)?(i._uid=e.uid,this._external_signal.onMessage(i)):this.emit(kw.ON_DATA_STREAM,e)}catch(t){this.emit(kw.ON_DATA_STREAM,e)}}handleNotification(e){fb.debug("[".concat(this.clientId,"] receive notification: "),e);const t=NO(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(Hy.UID_BANNED),void this.close()):void this.reconnect(t.action,Jy.SERVER_ERROR);fb.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=XA("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(fb.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>XA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Jy.TIMEOUT):this.request(Pw.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),XA("REPORT_STATS")&&this.send(Pw.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}handleWebsocketEvents(){this.websocket.on(Uw.RECONNECT_WAITTING_FINISH,e=>{this.emit(Dw.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(Uw.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Dw.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Uw.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Uw.CLOSED,()=>{this.connectionState=Nw.CLOSED}),this.websocket.on(Uw.FAILED,()=>{this._disconnectedReason=Hy.NETWORK_ERROR,this.connectionState=Nw.CLOSED}),this.websocket.on(Uw.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState=this.connectionState===Nw.CONNECTED?Nw.RECONNECTING:Nw.CONNECTING}),this.websocket.on(Uw.WILL_RECONNECT,(e,t,n)=>{"retry"!==e?(fb.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):fb.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)}),this.websocket.on(Uw.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(Dw.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof Cy&&e.code===Ry.UNEXPECTED_RESPONSE&&e.data.code===Ow.ERR_NO_AUTHORIZED)return fb.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Jy.SERVER_ERROR);fb.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Jy.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Uw.REQUEST_NEW_URLS,(e,t)=>{Zy(this,Dw.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Uw.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(kw.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var VU={exports:{}};VU.exports=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>S,Printer:()=>I,parse:()=>k,print:()=>P});const r="\n",i="".concat("\r").concat(r),o=" ";let a;function s(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function u(e){return c(e)||e>=""&&e<=""}function l(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function d(e){return e>="1"&&e<="9"}function h(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function p(e){return"d"===e||"h"===e||"m"===e||"s"===e}function f(e){return e>""&&e<"\t"||e>"\v"&&e<"\f"||e>""&&e<""}function m(e){return h(e)||s(e)||"+"===e||"/"===e}function g(e){return s(e)||h(e)||"+"===e||"/"===e||"-"===e||"_"===e}function v(e){return h(e)||s(e)||"+"===e||"/"===e}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){_(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(a||(a={}));class b{consumeText(e,t){let n=t;for(;n<e.length;){const t=e[n];if("\0"===t||"\r"===t||t===r)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,o)}consumeOneOrMore(e,t,n){let r=t;for(;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}consumeSpace(e,t){if(e[t]===o)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let t=0;t<4;t++)if(n=this.consumeDecimalUChar(e,n),3!==t){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let t=0;t<3&&s(e[n]);t++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");const r=parseInt(e.slice(t,n));if(r>=0&&r<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n),n):n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((r=e[t+n])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===n)throw new Error("Invalid hex 4");break}var r;return t+n}consumeFQDN(e,t){let n=t;for(;s(e[n])||h(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,u)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3;const r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let t=0;t<3;t++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!d(e[t]))throw new Error("Invalid integer.");for(t+=1;s(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!d(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&s(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,l)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(d(e[n])&&(n+=1);s(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,o)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,s),p(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!d(e[t]))throw new Error("Invalid repeat interval");for(t+=1;s(e[t]);)t+=1;return p(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,s)}consume(e,t,n){for(let r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}consumeTill(e,t,n){let r=t;for(;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}class S extends b{constructor(){super(),_(this,"records",[]),_(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter(e=>!!jp(e).call(e)).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),o=this.parseInformation(),a=this.parseUri(),s=this.parseEmail(),c=this.parsePhone(),u=this.parseConnection(),l=this.parseBandWidth(),d=this.parseTimeFields(),h=this.parseKey(),p=this.parseSessionAttribute(),f=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:o,uri:a,emails:s,phones:c,connection:u,bandwidths:l,timeFields:d,key:h,attributes:p,mediaDescriptions:f}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===r)return"\r"===e[t-1]?i:r;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new T;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,e=>l(e)&&":"!==e),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,f)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new R(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==a.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,e=>l(e)&&":"!==e),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,f)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===a.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===a.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);const i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:r})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.REPEAT)break;{const n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==a.BANDWIDTH)break;{const n=this.extractOneOrMore(t,l);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const r=this.extractOneOrMore(t,s);e.push({bwtype:n,bandwidth:r}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==a.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,s));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==a.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,s);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const o=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:r,nettype:i,addrtype:o,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===a.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==a.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===a.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==a.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===a.CONNECTION){const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");const i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===a.TIME;){const t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.MEDIA;){const t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),o=this.parseKey(),a=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:o,attributes:a})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===a.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const o=t.call(this,e.value,e.cur,...r),a=e.value.slice(e.cur,o);return e.cur=o,a}extractOneOrMore(e,t){const n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}consumeSpaceForRecord(e){if(e.value[e.cur]!==o)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class w extends b{constructor(){super(...arguments),_(this,"attributes",void 0),_(this,"digested",!1)}extractOneOrMore(e,t,n){const r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),[o,a]=n||[];if("number"==typeof o&&i.length<o)throw new Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof a&&i.length>a)throw new Error("error in length, should be less or equal than ".concat(a," characters."));return e._cur=r,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==o)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t){if(!e.attValue)throw new Error("Nothing to extract from attValue.");for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];const o=t.call(this,e.attValue,e._cur,...r),a=e.attValue.slice(e._cur,o);return e._cur=o,a}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,m,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,m,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,m));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){const t=this.extractOneOrMore(e,s);let n;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),n=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,o),i=y(y({entry:parseInt(t,10)},n&&{direction:n}),{},{extensionName:r});this.peekChar(e)===o&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class T extends w{constructor(){super(...arguments),_(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,g)}parseIdentity(e){const t=this.extractOneOrMore(e,v),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const r=this.extractOneOrMore(e,e=>e!==o&&f(e));n.push({name:t,value:r})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===o&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const n=this.extract(e,this.consumeTill,o);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class R extends w{constructor(e){super(),_(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,m,[1,32]);this.consumeAttributeSpace(e);const n=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const i=this.extractOneOrMore(e,s,[1,10]);this.consumeAttributeSpace(e);const a=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const u=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const l={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:a,port:u,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),l.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),l.relPort=this.extract(e,this.consumePort));this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),l.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(l)}parseRemoteCandidate(e){const t=[];for(;;){const n=this.extractOneOrMore(e,s,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const r={encodingName:n,clockRate:this.extractOneOrMore(e,s)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const i=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,s);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,":");let r;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),r=this.extract(e,this.consumeTill));const i=this.attributes.ssrcs.find(e=>e.ssrcId===parseInt(t,10));i?i.attributes[n]=r:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[n]:r}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,o);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill),r={};n.split(";").forEach(e=>{let[t,n]=e.split("=");t=jp(t).call(t);const i="string"==typeof n?jp(n).call(n):null;"string"==typeof t&&t.length>0&&(r[t]=i)});const i=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}parseFmtParameters(e){const t={},n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){const n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");t[n]=r}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,o),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,o);let r;if("trr-int"===n)r={type:n,interval:this.extract(e,this.consumeTill)};else{const t={type:n};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===o&&(t.additional=this.extract(e,this.consumeTill))),r=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(r);else{const e=this.attributes.payloads.find(e=>e.payloadType===parseInt(t,10));e?e.rtcpFeedbacks.push(r):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[r]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,l,[1,64])};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,l,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,e=>h(e)||s(e)||"_"===e||"-"===e);this.consumeAttributeSpace(e);const n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===o){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=t,this.peekChar(e)===o&&this.extract(e,this.consume,o)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const r={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(r);break}default:{const r={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),r.val=this.extract(e,this.consumeTill,";")),n.params.push(r)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,s,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,s,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class I{constructor(){C(this,"eol",i)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map(e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime)).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(const n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new A(this.eol).print(e)}printMediaAttributes(e){return new N(this.eol).print(e)}}class O{constructor(e){C(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(o)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map(e=>"a=fingerprint:".concat(e.hashFunction).concat(o).concat(e.fingerprint)).join(this.eol)+this.eol:""}printExtmap(e){return e.map(e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(o).concat(e.extensionName).concat(e.extensionAttributes?"".concat(o).concat(e.extensionAttributes):"").concat(this.eol)).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map(e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol)).join("")}}class A extends O{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map(e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map(e=>"".concat(o).concat(e)).join("")).concat(this.eol)).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map(e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map(e=>"".concat(o).concat(e.name).concat(e.value?"=".concat(e.value):"")))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(o,"*"):e.identifierList.length>0&&(t+=e.identifierList.map(e=>"".concat(o).concat(e))),t+this.eol}}class N extends O{print(e){const t=e.attributes;let n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map(e=>"a=candidate:".concat(e.foundation).concat(o).concat(e.componentId).concat(o).concat(e.transport).concat(o).concat(e.priority).concat(o).concat(e.connectionAddress).concat(o).concat(e.port).concat(o,"typ").concat(o).concat(e.type).concat(e.relAddr?"".concat(o,"raddr").concat(o).concat(e.relAddr):"").concat(e.relPort?"".concat(o,"rport").concat(o).concat(e.relPort):"").concat(Object.keys(e.extension).map(t=>"".concat(o).concat(t).concat(o).concat(e.extension[t])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(e){return e.map(e=>"a=remote-candidates:".concat(e.join(o)).concat(this.eol)).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let n="";n+=e.rtcpFeedbackWildcards.map(e=>this.printRTCPFeedback("*",e)).join("");for(const e of t)n+=this.printRtpMap(e.payloadType,e.rtpMap),n+=this.printFmtp(e.payloadType,e.fmtp),n+=e.rtcpFeedbacks.map(t=>this.printRTCPFeedback(e.payloadType,t)).join("");return n}printFmtp(e,t){if(!t)return"";const n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(o).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(o).concat(Object.keys(t.parameters).map(e=>"".concat(e,"=").concat(t.parameters[e])).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(o).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(o),r=t;return"trr-int"===r.type?n+="ttr-int".concat(o).concat(r.interval):(n+="".concat(r.type),r.parameter&&(n+="".concat(o).concat(r.parameter),r.additional&&(n+="".concat(o).concat(r.additional)))),n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map(e=>Object.keys(e.attributes).map(t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(o).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol)).join("")).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(o).concat(e.netType)),e.addressType&&(t+="".concat(o).concat(e.addressType)),e.address&&(t+="".concat(o).concat(e.address)),t+this.eol}printMSId(e){return e.map(e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(o).concat(e.appdata):"").concat(this.eol)).join("")}printImageattr(e){return e.map(e=>"a=imageattr:".concat(e).concat(this.eol)).join("")}printRid(e){return e.map(e=>{let t="a=rid:".concat(e.id).concat(o).concat(e.direction);return e.payloads&&(t+="".concat(o,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(o).concat(e.params.map(e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val)).join(";"))),t+this.eol}).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map(e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map(e=>"".concat(o).concat(e.toString(10))).join("")).concat(this.eol)).join("")}}function k(e){return(new S).parse(e)}function P(e,t){return(new I).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})();var FU=VU.exports;function BU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:XA("SVC_MODE");if(XA("ENABLE_SVC"))return function(e){return e in Iw}(e)?e:Iw.L1T3}function jU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function GU(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jU(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jU(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function WU(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:o,filterAudioFec:a,filterAudioCodec:s,filterVideoCodec:c}=t,{useXR:u}=n;let l=[],d=[],h=[],p=[],f=!1,m=!1;if(FU.parse(e).mediaDescriptions.forEach(e=>{r&&r!==e.attributes.direction||("video"!==e.media.mediaType||f||(d=e.attributes.payloads,p=e.attributes.extmaps,f=!0),"audio"!==e.media.mediaType||m||(l=e.attributes.payloads,h=e.attributes.extmaps,m=!0))}),!p||0===d.length)throw new Error("Cannot get video capabilities from SDP.");if(!h||0===l.length)throw new Error("Cannot get audio capabilities from SDP.");if(d.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})}),l.forEach(e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate)),u&&e.rtcpFeedbacks.push({type:"rrtr"})}),i&&(l=l.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}),d=d.filter(e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),o&&(d=d.filter(e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")})),a&&(l=l.filter(e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")})),s&&(null==s?void 0:s.length)>0&&(l=l.filter(e=>{var t;return Dn(s).call(s,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")})),c&&(null==c?void 0:c.length)>0){const e=d.filter(e=>{var t;return Dn(c).call(c,(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")});d=e.concat(i?[]:ax(e,d))}const g=XA("UNSUPPORTED_VIDEO_CODEC");return g&&g.length>0&&(d=d.filter(e=>!(e.rtpMap&&Dn(g).call(g,e.rtpMap.encodingName.toLowerCase())))),{audioCodecs:l,videoCodecs:d,audioExtensions:h,videoExtensions:p}}function HU(e){const t=FU.parse(e);let n,r;for(const e of t.mediaDescriptions){if(!n){const t=e.attributes.iceUfrag,r=e.attributes.icePwd;if(!t||!r)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:t,icePwd:r}}if(!r){const t=e.attributes.fingerprints;t.length>0&&(r={fingerprints:t})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function KU(e,t){const n=[],r=e.attributes.ssrcGroups.filter(e=>"FID"===e.semantic),i=e.attributes.ssrcGroups.find(e=>"SIM"===e.semantic),o=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(e=>{var i;const o=null===(i=r.find(t=>t.ssrcIds[0]===e))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?o:void 0})});else if(r.length>0)n.push({ssrcId:r[0].ssrcIds[0],rtx:t?r[0].ssrcIds[1]:void 0});else{if(0===o.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function YU(e,t,n){const{cname:r}=e;let i=[];t&&(i=qU(t)),0===i.length&&(i=e.iceParameters.candidates.map(e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})),fb.debug("Using candidates from gateway."));const o={fingerprints:e.dtlsParameters.fingerprints.map(e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let s;switch(e.dtlsParameters.role){case"server":s="passive";break;case"client":s="active";break;case"auto":s="actpass"}const c=rx(e.rtpCapabilities),u=[];return Array.isArray(n)&&n.length>0&&n.forEach(e=>{u.push({kind:dO.VIDEO,ssrcId:e.v,rtx:e.v_rtx,mslabel:"".concat(e.v,"_").concat(e.a)},{kind:dO.AUDIO,ssrcId:e.a,mslabel:"".concat(e.v,"_").concat(e.a)})}),{dtlsParameters:o,iceParameters:a,candidates:i,rtpCapabilities:c,setup:s,cname:r,preSSRCs:u}}function qU(e){let t=[];return e.ip&&"number"==typeof e.port&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],fb.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),fb.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function zU(e,t,n){const r=[],i=[];return e.forEach(e=>{let{ssrcId:o,rtx:a}=e;const s=TA(8,"track-"),c={ssrcId:o,attributes:GU({label:s,mslabel:n=n||TA(10,""),msid:"".concat(n," ").concat(s)},t&&{cname:t})};if(r.push(c),void 0!==a){const e={ssrcId:a,attributes:GU({label:s,mslabel:n,msid:"".concat(n," ").concat(s)},t&&{cname:t})};r.push(e),i.push({semantic:"FID",ssrcIds:[o,a]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(e=>{let{ssrcId:t}=e;return t})}),{ssrcs:r,ssrcGroups:i}}function JU(e,t){t instanceof TM&&e.attributes.payloads.forEach(e=>{var n;const r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const i=t._encoderConfig;i&&"pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!Zv()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))})}function XU(e){const t=e.attributes.unrecognized.findIndex(e=>"x-google-flag"===e.attField&&"conference"===e.attValue);-1!==t&&e.attributes.unrecognized.splice(t,1)}function QU(e,t){var n;if(!(t instanceof aU&&t._encoderConfig&&-1===t._hints.indexOf(mL.SCREEN_TRACK)))return;const r=t._encoderConfig;ZP().supportMinBitrate&&r.bitrateMin&&e.attributes.payloads.forEach(e=>{var t,n;Dn(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),ZP().supportMinBitrate&&!Dn(n=t._hints).call(n,mL.LOW_STREAM)&&r.bitrateMax&&e.attributes.payloads.forEach(e=>{var t,n;Dn(t=["h264","h265","vp8","vp9","av1"]).call(t,(null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(XA("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function ZU(e){if("video"!==e.media.mediaType)return;const t=Hv();if(t.name!==Bv.SAFARI&&t.os!==Fv.IOS)return;const n=e.attributes.extmaps.findIndex(e=>/video-orientation/g.test(e.extensionName));-1!==n&&e.attributes.extmaps.splice(n,1)}function $U(e,t,n){if(!t)return;let r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){const t=r.find(e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName);if(t){e.attributes.extmaps.find(e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName)||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"});const n=function(e,t){return t.filter(t=>!!e.find(e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)))}(i,e.attributes.payloads);n.forEach(e=>{e.rtcpFeedbacks.find(e=>"transport-cc"===e.type)||e.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex(e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName);-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}if(!0===t.remb){const t=r.find(e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName);if(t){e.attributes.extmaps.find(e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName)||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"});const n=function(e,t){return t.filter(t=>!!e.find(e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)))}(i,e.attributes.payloads);n.forEach(e=>{e.rtcpFeedbacks.find(e=>"goog-remb"===e.type)||e.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex(e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName);-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"goog-remb"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}}function ex(e,t,n){if(Zv())return;if("video"!==e.media.mediaType)return;if(!(t instanceof aU))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!XA("SIMULCAST"))return;if("vp9"===n&&XA("ENABLE_SVC"))return;if(void 0===t._scalabilityMode||t._scalabilityMode.numSpatialLayers<=1)return;const r="vp8"===n?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find(e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId),a={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let t=1;t<r;t++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+t,attributes:sA(i.attributes)}),a.ssrcIds.push(i.ssrcId+t),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+t,attributes:sA(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+t,o.ssrcIds[1]+t]}));e.attributes.ssrcGroups.unshift(a)}async function tx(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:o,sendrecv:a}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=WU(n,e,t,"sendonly"),i=WU(n,e,t,"recvonly"),o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nx(r,i,"videoExtensions",o,a,s),nx(r,i,"videoCodecs",o,a,s),nx(r,i,"audioExtensions",o,a,s),nx(r,i,"audioCodecs",o,a,s),XA("RAISE_H264_BASELINE_PRIORITY")){const e=s.videoCodecs.findIndex(e=>{var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"===(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])});if(-1!==e){const t=s.videoCodecs.findIndex(e=>{var t;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())});if(t<e){fb.debug("raising H264 baseline profile priority");const n=s.videoCodecs[e];s.videoCodecs.splice(e,1),s.videoCodecs.splice(t,0,n)}-1!==t&&(a.videoCodecs=a.videoCodecs.filter(e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))})),-1!==t&&XA("FILTER_SEND_H264_BASELINE")&&(o.videoCodecs=o.videoCodecs.filter(e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))}))}}return{send:o,recv:a,sendrecv:s}}(e,t,r);try{n.close()}catch(e){}return{send:i,recv:o,sendrecv:a}}function ix(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=WU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nx(e,t,"videoExtensions",n,r,i),nx(e,t,"videoCodecs",n,r,i),nx(e,t,"audioExtensions",n,r,i),nx(e,t,"audioCodecs",n,r,i),XA("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){const t=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){fb.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&(r.videoCodecs=r.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:n,recv:r,sendrecv:i}}function nx(e,t,n,r,i,o){if("videoExtensions"===n||"audioExtensions"===n){const a=[];return e[n].forEach(e=>{t[n].some((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return a.push(n),!0})?o[n].push(e):r[n].push(e)}),void t[n].forEach((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)})}if("videoCodecs"===n||"audioCodecs"===n){const a=[];return e[n].forEach(e=>{t[n].some((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return a.push(n),!0})?o[n].push(e):r[n].push(e)}),void t[n].forEach((e,t)=>{-1===a.indexOf(t)&&i[n].push(e)})}}function rx(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,o;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...r.audioCodecs],o.videoCodecs=[...n.videoCodecs,...r.videoCodecs],o.audioExtensions=[...n.audioExtensions,...r.audioExtensions],o.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):o=r,{send:i,recv:o}}function ox(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter(e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function sx(e,t,n,r){let i=[];if(e===dO.VIDEO){if(XA("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(i=t.videoCodecs.filter(e=>{var t;return Dn(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)&&e&&e.fmtp&&e.fmtp.parameters["profile-level-id"]===XA("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||0===i.length){let e=[];const o=[],a=[],s=[];if(n.videoCodecs.forEach(t=>{const n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"";Dn(n).call(n,r)?e.push(t):Dn(n).call(n,"vp9")?o.push(t):Dn(n).call(n,"vp8")?a.push(t):Dn(n).call(n,"h264")&&s.push(t)}),0===e.length){let t="";0!==o.length?(e=o,t="vp9"):0!==a.length?(e=a,t="vp8"):0!==s.length&&(e=s,t="h264"),fb.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t))}0!==e.length&&(i=t.videoCodecs.filter(t=>e.some(e=>e.payloadType===t.payloadType)))}if(0===i.length&&(fb.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),XA("USE_PUB_RTX")||XA("USE_SUB_RTX")){const e=ax(i,t.videoCodecs);i=[...i,...e]}}else i=t.audioCodecs.filter(e=>{var t;return Dn(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,r)}),0===i.length&&(fb.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(e=>{var t;return Dn(t=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(t,"opus")}));return i}function ax(e,t){const n=e.map(e=>e.payloadType.toString());return t.filter(e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&e.fmtp&&e.fmtp.parameters.apt&&Dn(n).call(n,e.fmtp&&e.fmtp.parameters.apt))}async function cx(e,t,n){const r=t.toString(),i=lx(r,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:r});const o=await e.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let a=o.sdp;a=dx(a,n||{}),null==i||i(a||""),await e.setLocalDescription({type:"answer",sdp:a})}function dx(e,t,n){const r=FU.parse(e),{useXR:i}=t;return r.mediaDescriptions.forEach(e=>{var t;e.attributes.mid&&(Array.isArray(n)&&!Dn(n).call(n,e.attributes.mid)||("audio"===e.media.mediaType&&ox(e),i&&Dn(t=["audio","video"]).call(t,e.media.mediaType)&&e.attributes.payloads.forEach(e=>{-1===e.rtcpFeedbacks.findIndex(e=>"rrtr"===e.type)&&e.rtcpFeedbacks.push({type:"rrtr"})})))}),FU.print(r)}function lx(e,t,n,r){if(XA("SDP_LOGGING"))return fb.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{lx(e,"answer","local"===n?"remote":"local",r)}:void 0}function ux(e,t){return typeof XA(e)===t?XA(e):void 0}function hx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function px(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hx(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hx(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const _x=new Map;class Ex extends xy{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit($w.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit($w.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){fb.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),Fg(this,"store",void 0),Fg(this,"joinInfo",void 0),Fg(this,"key",void 0),Fg(this,"ntpOffset",0),Fg(this,"signal",void 0),Fg(this,"role",void 0),Fg(this,"inChannelInfo",{joinAt:null,duration:0}),Fg(this,"spec",void 0),Fg(this,"_state","DISCONNECTED"),Fg(this,"_statsCollector",void 0),Fg(this,"_disconnectedReason",void 0),Fg(this,"isSignalRecover",!1),Fg(this,"hasChangeBGPAddress",!1),Fg(this,"trafficStatsInterval",void 0),Fg(this,"networkQualityInterval",void 0),Fg(this,"_joinGatewayStartTime",0),Fg(this,"_signalTimeout",!1),Fg(this,"_clientRoleOptions",void 0),Fg(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?new xU(px(px({},t),{},{retryConfig:t.websocketRetryConfig}),e):new KO(px(px({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const r=Date.now();let i=_x.get(e.cname);if(i||(i=new Map,_x.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){const t=new yb(Ry.UID_CONFLICT);throw vb.joinGateway(e.sid,{lts:r,succ:!1,ec:t.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=r;const a=e.proxyServer;try{fb.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const t=e.gatewayAddrs.map(t=>{let{address:n}=t;const[r,i]=n.split(":"),o={host:r,port:i};return e.proxyServer&&(o.proxy=e.proxyServer),o});o=(await this.signal.init(t,n)).uid,fb.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){var s;throw fb.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),vb.joinGateway(e.sid,{lts:r,succ:!1,ec:(null===(s=t.data)||void 0===s?void 0:s.desc)||t.code,errorMsg:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,i.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),fb.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(e=>{fb.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit($w.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this.emit($w.NETWORK_QUALITY,this._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===this.state&&this._statsCollector.trafficStats?{uplinkNetworkQuality:$O(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:$O(this._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==Hy.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Nw.CONNECTED||await function(e){return Gh.race([e,fA(3e3)])}(this.signal.request(Pw.LEAVE,void 0,!0))}catch(e){fb.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==Hy.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new yb(Ry.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:XA("PUB_EXTEND"),twcc:!!XA("PUBLISH_TWCC"),rtx:!!XA("USE_PUB_RTX")};try{return(await this.signal.request(Pw.PUBLISH,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===Ow.ERR_PUBLISH_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),r.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw r}}async publishDataChannel(e,t,n){var r;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new yb(Ry.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:null!==(r=t.maxRetransmits)&&void 0!==r?r:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(Pw.PUBLISH_DATASTREAM,i,!0)}catch(r){if(n&&r.data&&r.data.code===Ow.ERR_PUBLISH_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),r.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw r}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new yb(Ry.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Pw.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){fb.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async unpublishDataChannel(e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new yb(Ry.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Gh.all(e.map(e=>this.signal.request(Pw.UNPUBLISH_DATASTREAM,{channel_id:e},!0)))}catch(e){fb.warning("unpublish datachannels warning: ",e)}}async presubscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new yb(Ry.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!XA("SUBSCRIBE_TWCC"),rtx:!!XA("USE_SUB_RTX")||void 0,extend:XA("SUB_EXTEND"),svc:Array.isArray(XA("SVC"))&&0!==XA("SVC").length?XA("SVC"):void 0};try{return await this.signal.request(Pw.PRE_SUBSCRIBE,r,!0)}catch(r){if(n&&r.data&&r.data.code===Ow.ERR_SUBSCRIBE_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),r.toString()),this.presubscribe(e,t,!1);throw r}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new yb(Ry.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!XA("SUBSCRIBE_TWCC"),rtx:!!XA("USE_SUB_RTX"),extend:XA("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(XA("SVC"))&&0!==XA("SVC").length?XA("SVC"):void 0};try{return(await this.signal.request(Pw.SUBSCRIBE,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===Ow.ERR_SUBSCRIBE_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),r.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw r}}async subscribeDataChannel(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new yb(Ry.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const r={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(Pw.SUBSCRIBE_DATASTREAM,r,!0)}catch(r){if(n&&r.data&&r.data.code===Ow.ERR_SUBSCRIBE_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),r.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw r}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new yb(Ry.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!XA("USE_SUB_RTX"),twcc:!!XA("SUBSCRIBE_TWCC"),svc:Array.isArray(XA("SVC"))&&0!==XA("SVC").length?XA("SVC"):void 0};try{return await this.signal.request(Pw.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(t&&n.data&&n.data.code===Ow.ERR_SUBSCRIBE_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request(Pw.SET_VIDEO_PROFILE,t);fb.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(Pw.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){fb.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async unsubscribeDataChannel(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new yb(Ry.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Gh.all(e.map(e=>this.signal.request(Pw.UNSUBSCRIBE_DATASTREAM,{stream_id:e,uid:t},!0)))}catch(e){fb.warning("unsubscribeDataChannel warning: ",e)}}async massUnsubscribe(e){try{await this.signal.request(Pw.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){fb.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request(Pw.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Pw.GATEWAY_INFO)}async renewToken(e){await this.signal.request(Pw.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),"CONNECTED"!==this.state)return void(this.role=e);let n,r=0;"audience"===e?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,r=1):r=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:r=0,await this.signal.request(Pw.SET_CLIENT_ROLE,{role:e,level:r,delay:n,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(Pw.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(Pw.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(Pw.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(Pw.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(Pw.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.signal instanceof xU)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),px({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Pw.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=_x.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:KA.username,password:KA.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(px(px({},KA),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request(Pw.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),null!=e.ntp_offset&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(t=>t.peer_uid===e.peer_uid);t&&t.B_st!==e.B_st&&oA(()=>{this.emit($w.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new yb(Ry.UNEXPECTED_ERROR,"can not generate join message, no join info");const t=Object.assign({},this.joinInfo.apResponse);let n=XA("REPORT_APP_SCENARIO");if("string"!=typeof n)try{n=JSON.stringify(n)}catch(e){n=void 0}n&&n.length>128&&(n=void 0);const r=!(Zv()||ty(87)||eL())&&"boolean"==typeof XA("ENABLE_PRE_SUB")&&XA("ENABLE_PRE_SUB"),i=!eL()&&ux("ENABLE_PREALLOC_PC","boolean"),o=px({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:GA,browser:navigator.userAgent,process_id:XA("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:XA("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:{enablePublishedUserList:XA("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:XA("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof XA("SUBSCRIBE_AUDIO_FILTER_TOPN")?XA("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof XA("ENABLE_PUBLISH_AUDIO_FILTER")?XA("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof XA("ENABLE_USER_LICENSE_CHECK")?XA("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===XA("USE_PUB_RTX")||!0===XA("USE_SUB_RTX")||void 0,disableFEC:XA("DISABLE_FEC"),enableNTPReport:!!XA("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!XA("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!XA("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:ux("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!XA("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:"number"==typeof this.joinInfo.rtmFlag?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!XA("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:ux("USE_XR","boolean"),enableLossbasedBwe:ux("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!XA("ENABLE_AUT_CC")||void 0,enableCCFallback:ux("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:i,preSubNum:r?ux("PRE_SUB_NUM","number"):void 0,enablePubTWCC:ux("PUBLISH_TWCC","boolean"),enableSubTWCC:ux("SUBSCRIBE_TWCC","boolean"),enablePubRTX:ux("USE_PUB_RTX","boolean"),enableSubRTX:ux("USE_SUB_RTX","boolean"),enableSubSVC:XA("ENABLE_SVC")?XA("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(XA("SVC"))&&0!==XA("SVC").length?XA("SVC"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,XA("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),void 0!==this.joinInfo.defaultVideoStream&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new yb(Ry.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Dw.WS_RECONNECT_WAITTING_FINISH,e=>{var t;Dn(t=["tryNext","recover"]).call(t,e)&&this.joinInfo&&vb.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(Dw.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Dw.WS_RECONNECTING,e=>{this.joinInfo&&vb.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Jy.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",vb.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:"live"===this.spec.mode?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:"audience"===this.role?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Dw.WS_CLOSED,e=>{let t;switch(e){case Hy.LEAVE:t=Jy.LEAVE;break;case Hy.UID_BANNED:case Hy.IP_BANNED:case Hy.CHANNEL_BANNED:case Hy.SERVER_ERROR:t=Jy.SERVER_ERROR;break;case Hy.FALLBACK:t=Jy.FALLBACK;break;case Hy.LICENSE_MISSING:case Hy.LICENSE_EXPIRED:case Hy.LICENSE_MINUTES_EXCEEDED:case Hy.LICENSE_PERIOD_INVALID:case Hy.LICENSE_MULTIPLE_SDK_SERVICE:case Hy.LICENSE_ILLEGAL:case Hy.TOKEN_EXPIRE:t=e;break;default:t=Jy.NETWORK_ERROR}fb.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+Jy.NETWORK_ERROR)),this.joinInfo&&vb.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Hy.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==Hy.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Dw.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(fb.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),vb.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void fb.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));JA("EVENT_REPORT_DOMAIN",e[1]),JA("EVENT_REPORT_BACKUP_DOMAIN",e[1]),JA("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}),this.signal.on(kw.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(Dw.REQUEST_RECOVER,(e,t,n)=>{if(!this.joinInfo)return n(new yb(Ry.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Zy(this,$w.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)}),this.signal.on(Dw.REQUEST_JOIN_INFO,async e=>{var t;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=await Zy(this,$w.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(t=this.joinInfo)||void 0===t?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i,version:"2"}}))}),this.signal.on(Dw.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(Dw.REPORT_JOIN_GATEWAY,(e,t)=>{if(!this.joinInfo)return;let n,r="";var i;e instanceof yb?(n=(null===(i=e.data)||void 0===i?void 0:i.desc)||e.code,r=e.message):n=e,vb.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:r,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(Dw.IS_P2P_DISCONNECTED,e=>{e(tA(this,$w.IS_P2P_DISCONNECTED))}),this.signal.on(Dw.DISCONNECT_P2P,()=>{this.emit($w.DISCONNECT_P2P)}),this.signal.on(Dw.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Dw.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Dw.JOIN_RESPONSE,e=>{const t=this.getCurrentGatewayAddress();this.emit($w.JOIN_RESPONSE,e,t)}),this.signal.on(Dw.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),t=XA("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&t){const n=qU(e);this.emit($w.PRE_CONNECT_PC,{candidates:n,fingerprint:t})}}}),this.signal.on(Dw.RECOVER_NOTIFICATION,e=>{this.joinInfo&&"string"==typeof XA("AP_REQUEST_DETAIL")&&(this.joinInfo.apRequestDetail="".concat(XA("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(Pw.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw fb.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(Pw.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(e){throw fb.warning("unsubscribe datachannel warning",e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(Pw.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw fb.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(Pw.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(e){throw fb.warning("unpublish datastream warning: ",e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map(e=>({stream_id:e.stream_id,stream_type:e.stream_type}))};try{await this.signal.request(Pw.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw fb.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const n={action:e.find(e=>e.stream_type===Zw.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Pw.CONTROL,n,!0,!0)}catch(e){throw fb.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const n={action:e.find(e=>e.stream_type===Zw.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(Pw.CONTROL,n,!0,!0)}catch(e){throw fb.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}async muteRemote(e,t){const n={action:e===dO.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(Pw.CONTROL,n,!0,!0)}catch(e){throw fb.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),e),e}}async unmuteRemote(e,t){const n={action:e===dO.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(Pw.CONTROL,n,!0,!0)}catch(e){throw fb.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),e),e}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(Pw.RESTART_ICE,t,!0)}catch(e){throw fb.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,Jy.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!XA("GATEWAY_WSS_ADDRESS"))return XA("USE_CANDIDATE_FROM_AP_DETAIL")&&null!==(e=this.joinInfo)&&void 0!==e&&e.apGatewayAddress?(fb.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(Pw.SET_PARAMETER,{enablePublishAudioFilter:e})}}let fx=0,mx=0;function Tx(e,t,n,r){return new Gh((i,o)=>{t.timeout=t.timeout||XA("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),fx+=_A(t.data)):n&&(t.data.size?fx+=t.data.size:t.data instanceof FormData?fx+=EA(t.data):fx+=_A(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Lv.request(t).then(e=>{"string"==typeof e.data?mx+=_A(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?mx+=e.data.byteLength:mx+=_A(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)}).catch(e=>{Lv.isCancel(e)?o(new yb(Ry.OPERATION_ABORTED,"cancel token canceled")):o("ECONNABORTED"===e.code?new yb(Ry.NETWORK_TIMEOUT,e.message):e.response?new yb(Ry.NETWORK_RESPONSE_ERROR,e.response.status):new yb(Ry.NETWORK_ERROR,e.message))})})}!function(){var e;function n(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},o=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof t&&t];for(var n=0;n<e.length;++n){var r=e[n];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var n=o;e=e.split(".");for(var r=0;r<e.length-1;r++){var a=e[r];if(!(a in n))break e;n=n[a]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}function s(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:n(e)}}if(a("Symbol",function(e){function t(e,t){this.A=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function e(i){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(i||"")+"_"+r++,i)}}),a("Symbol.iterator",function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<t.length;r++){var a=o[t[r]];"function"==typeof a&&"function"!=typeof a.prototype[e]&&i(a.prototype,e,{configurable:!0,writable:!0,value:function(){return s(n(this))}})}return e}),"function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var u;e:{var l={};try{l.__proto__={a:!0},u=l.a;break e}catch(e){}u=!1}r=u?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var d=r;function h(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function p(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function f(e,t){return e.h=3,{value:t}}function m(e){this.g=new h,this.G=e}function g(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var o=i.value}catch(t){return e.g.j=null,e.g.s(t),v(e)}return e.g.j=null,r.call(e.g,o),v(e)}function v(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function E(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){p(e.g);var n=e.g.j;return n?g(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),v(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function y(e,t){return t=new E(new m(t)),d&&e.prototype&&d(t,e.prototype),t}if(h.prototype.o=function(e){this.v=e},h.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},h.prototype.return=function(e){this.l={return:e},this.h=this.u},m.prototype.o=function(e){return p(this.g),this.g.j?g(this,this.g.j.next,e,this.g.o):(this.g.o(e),v(this))},m.prototype.s=function(e){return p(this.g),this.g.j?g(this,this.g.j.throw,e,this.g.o):(this.g.s(e),v(this))},a("Array.prototype.entries",function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(e,t){return[e,t]})}}),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var _=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},b=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},S=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},w=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},T="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,R=T.FormData,C=T.XMLHttpRequest&&T.XMLHttpRequest.prototype.send,I=T.Request&&T.fetch,O=T.navigator&&T.navigator.sendBeacon,A=T.Element&&T.Element.prototype,N=T.Symbol&&Symbol.toStringTag;N&&(Blob.prototype[N]||(Blob.prototype[N]="Blob"),"File"in T&&!File.prototype[N]&&(File.prototype[N]="File"));try{new File([],"")}catch(e){T.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),N&&Object.defineProperty(e,N,{value:"File"}),e}}var k=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},P=function(e){this.i=[];var t=this;e&&_(e.elements,function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];_(n,function(n){t.append(e.name,n)})}else"select-multiple"===e.type||"select-one"===e.type?_(e.options,function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)}):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?b(e.value):e.value,t.append(e.name,n))})};if((e=P.prototype).append=function(e,t,n){w(arguments,2),this.i.push(S(e,t,n))},e.delete=function(e){w(arguments,1);var t=[];e=String(e),_(this.i,function(n){n[0]!==e&&t.push(n)}),this.i=t},e.entries=function e(){var t,n=this;return y(e,function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=f(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2})},e.forEach=function(e,t){w(arguments,1);for(var n=c(this),r=n.next();!r.done;r=n.next()){var i=c(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},e.get=function(e){w(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},e.getAll=function(e){w(arguments,1);var t=[];return e=String(e),_(this.i,function(n){n[0]===e&&t.push(n[1])}),t},e.has=function(e){w(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},e.keys=function e(){var t,n,r=this;return y(e,function(e){if(1==e.h&&(t=c(r),n=t.next()),3!=e.h)return n.done?void(e.h=0):f(e,c(n.value).next().value);n=t.next(),e.h=2})},e.set=function(e,t,n){w(arguments,2),e=String(e);var r=[],i=S(e,t,n),o=!0;_(this.i,function(t){t[0]===e?o&&(o=!r.push(i)):r.push(t)}),o&&r.push(i),this.i=r},e.values=function e(){var t,n,r,i=this;return y(e,function(e){if(1==e.h&&(t=c(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):((r=c(n.value)).next(),f(e,r.next().value));n=t.next(),e.h=2})},P.prototype._asNative=function(){for(var e=new R,t=c(this),n=t.next();!n.done;n=t.next()){var r=c(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},P.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach(function(e,r){return"string"==typeof e?t.push(n+k(b(r))+'"\r\n\r\n'+b(e)+"\r\n"):t.push(n+k(b(r))+'"; filename="'+k(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")}),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},P.prototype[Symbol.iterator]=function(){return this.entries()},P.prototype.toString=function(){return"[object FormData]"},A&&!A.matches&&(A.matches=A.matchesSelector||A.mozMatchesSelector||A.msMatchesSelector||A.oMatchesSelector||A.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),N&&(P.prototype[N]="FormData"),C){var L=T.XMLHttpRequest.prototype.setRequestHeader;T.XMLHttpRequest.prototype.setRequestHeader=function(e,t){L.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},T.XMLHttpRequest.prototype.send=function(e){e instanceof P?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),C.call(this,e)):C.call(this,e)}}I&&(T.fetch=function(e,t){return t&&t.body&&t.body instanceof P&&(t.body=t.body._blob()),I.call(this,e,t)}),O&&(T.navigator.sendBeacon=function(e,t){return t instanceof P&&(t=t._asNative()),O.call(this,e,t)}),T.FormData=P}}();const Sx=()=>{const e=XA("AREAS");return 0===e.length&&e.push(iO.GLOBAL),Jn(e).call(e,(e,t,n)=>{const r=gx(t);return r?0===n?r:"".concat(e,",").concat(r):e},"")},gx=e=>e===iO.OVERSEA?"".concat(rO.ASIA,",").concat(rO.EUROPE,",").concat(rO.AFRICA,",").concat(rO.NORTH_AMERICA,",").concat(rO.SOUTH_AMERICA,",").concat(rO.OCEANIA):rO[e],Rx=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(e=>{const n=oO[e],r=Object.keys(n);r&&r.map(e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))})}),t},Cx={GLOBAL:{ASIA:[iO.CHINA,iO.JAPAN,iO.INDIA,iO.KOREA,iO.HKMC],EUROPE:[],NORTH_AMERICA:[iO.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Ix=Object.keys(Cx[iO.GLOBAL]),vx=[iO.CHINA,iO.NORTH_AMERICA,iO.EUROPE,iO.ASIA,iO.JAPAN,iO.INDIA,iO.OCEANIA,iO.SOUTH_AMERICA,iO.AFRICA,iO.KOREA,iO.HKMC,iO.US],yx=function(e,t){let n=[];if(Dn(e).call(e,iO.GLOBAL)){const i=[iO.GLOBAL,iO.OVERSEA],o=Object.keys(oO);if(t===iO.GLOBAL)throw new yb(Ry.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===iO.CHINA)n=[iO.OVERSEA];else if(r=t,Dn(Ix).call(Ix,r)){const e=Cx[iO.GLOBAL][t]||[],r=[...i,t,...e];n=o.filter(e=>!Dn(r).call(r,e))}else if(function(e){let t=!1;return Ix.forEach(n=>{var r;Dn(r=Cx[iO.GLOBAL][n]).call(r,e)&&(t=!0)}),t}(t)){const e=function(e){let t;return Ix.forEach(n=>{var r;Dn(r=Cx[iO.GLOBAL][n]).call(r,e)&&(t=n)}),t}(t),r=[...i,e,t];n=o.filter(e=>!Dn(r).call(r,e))}else n=e;n=function(e){const t=[];return vx.forEach(n=>{Dn(e).call(e,n)&&t.push(n)}),t.concat(e.filter(e=>!Dn(vx).call(vx,e)))}(n)}else n=e;var r;return n};function Ax(e){var t,n;if(!e&&Dn(t=XA("AREAS")).call(t,iO.EXTENSIONS))return fb.debug("update area from ap : reset"),void bx(Ab,!0);if(!Dn(n=XA("AREAS")).call(n,iO.GLOBAL)||!e)return;let r=oO.EXTENSIONS;r&&(r={CODE:gx(iO.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},fb.debug("update area from ap success: ".concat(e,",config is "),r),JA("AREAS",[iO.EXTENSIONS],!0),Object.keys(r).map(e=>{JA(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])}))}function bx(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=vb.reportApiInvoke(null,{name:By.SET_AREA,options:e,tag:jy.TRACER});try{let r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach(e=>{if(!Dn(nO).call(nO,e))throw new yb(Ry.INVALID_PARAMS,"invalid area code")}),r=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:n}=e;if(!t)throw new yb(Ry.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),r=n?yx(i,n):i}if(!t){if(QA.AREAS){const e=new yb(Ry.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void fb.warning("setArea is prohibited because of config-distribute")}if(Dn(r).call(r,iO.GLOBAL)&&XA("AREAS")===iO.EXTENSIONS){const e=new yb(Ry.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void fb.warning("setArea is prohibited because of ap extensions")}}JA("AREAS",r,t);const i=Rx(r);Object.keys(i).map(e=>{JA(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])}),fb.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function wx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ox(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wx(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wx(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let Nx=1;function Dx(e,t,n,r,i){Nx+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:Nx,requestId:Nx,version:GA,cname:n.cname},a={service_name:t,json_body:JSON.stringify(o)};let s,c,u=e[0];return kA(async()=>{s=Date.now();const e=await Tx(u,{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-s,0!==e.code){const t=new yb(Ry.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw fb.error(t.toString()),t}const n=JSON.parse(e.json_body);if(200!==n.code){const e=new yb(Ry.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw fb.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new yb(Ry.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw fb.error(e.toString()),e}const i=function(e,t){return{addressList:e.servers.map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(XA("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t))),workerToken:e.workerToken,vid:e.vid}}(n,t);return XA("LIVE_STREAMING_ADDRESS")&&(i.addressList=XA("LIVE_STREAMING_ADDRESS")instanceof Array?XA("LIVE_STREAMING_ADDRESS"):[XA("LIVE_STREAMING_ADDRESS")]),Ox(Ox({},i),{},{responseTime:c})},(r,i)=>(vb.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:c,serverIp:e[i%e.length]}),!1),(r,i)=>(vb.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:c,serverIp:e[i%e.length]}),!!(r.code!==Ry.OPERATION_ABORTED&&r.code!==Ry.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(u=e[(i+1)%e.length],!0)),i)}let Px=1;function Lx(e,t,n,r){let{url:i,areaCode:o}=e;const{clientId:a,sid:s}=t,c=Date.now();let u;const[l,d]=Vx(t,o,[YO.CHOOSE_SERVER]);let h=iA.networkState;return kA(async()=>{h&&iA.networkState===Xy.OFFLINE&&iA.onlineWaiter&&await Gh.race([iA.onlineWaiter,mA(r&&r.maxRetryTimeout||PA.maxRetryTimeout)]),h=iA.networkState;const{data:e,headers:o}=await Tx(i,{data:l,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u="1"===o.http3?1:-1,vb.reportResourceTiming(i,s),Mx(e,i,t,c,[YO.CHOOSE_SERVER],u);const a=eN(e,YO.CHOOSE_SERVER);return Ux(a),XO(a,i)},e=>(e&&vb.joinChooseServer(s,{lts:c,succ:!0,csAddr:i,opid:d,serverList:e.gatewayAddrs.map(e=>e.address),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[YO.CHOOSE_SERVER].toString(),isHttp3:u,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.res.detail&&e.res.detail[38]}),!1),e=>e.code!==Ry.OPERATION_ABORTED&&(e.code===Ry.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(vb.joinChooseServer(s,{lts:c,succ:!1,csAddr:i,serverList:null,opid:d,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[YO.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h}),isHttp3:u,corssRegionTagReq:t.apRequestDetail}),fb.warning("[".concat(a||"sid-".concat(s.slice(0,6)),"] Choose server network error, retry"),e),!0)),r)}function kx(e,t,n,r){let i,{url:o,areaCode:a,serviceIds:s}=e;const c=Date.now(),[u,l]=Vx(t,a,s);let d;return kA(async()=>{d&&iA.networkState===Xy.OFFLINE&&iA.onlineWaiter&&await Gh.race([iA.onlineWaiter,mA(r&&r.maxRetryTimeout||PA.maxRetryTimeout)]),d=iA.networkState;const{data:e,headers:a}=await Tx(o,{data:u,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===a.http3?1:-1,vb.reportResourceTiming(o,t.sid),Mx(e,o,t,c,s,i);const l=eN(e,YO.CHOOSE_SERVER),h=eN(e,"proxy5"===t.cloudProxyServer?YO.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?YO.CLOUD_PROXY:YO.CLOUD_PROXY_FALLBACK);return Ux(l),{gatewayInfo:XO(l,o),proxyInfo:h,url:o}},e=>(e.gatewayInfo&&vb.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:o,serverList:e.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,opid:l,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:s.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:e.gatewayInfo.res.detail&&e.gatewayInfo.res.detail[38]}),e.proxyInfo&&vb.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:o,turnServerAddrList:e.proxyInfo.addresses.map(e=>e.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:s.toString()}),!1),e=>e.code!==Ry.OPERATION_ABORTED&&(e.code===Ry.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(vb.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:s.toString(),extend:JSON.stringify({networkState:d})}),fb.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0)),r)}const Mx=(e,t,n,r,i,o)=>{const{sid:a,clientId:s,cloudProxyServer:c}=n,u=[],l=s=>{4096===s.flag?vb.joinChooseServer(a,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:s.error.message,csIp:s.error.data&&s.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o,corssRegionTagReq:n.apRequestDetail}):1048576!==s.flag&&4194304!==s.flag&&4194310!==s.flag||vb.joinWebProxyAP(a,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:s.error.code,eventType:c,unilbsServerIds:i.toString()})};if(e.response_body.forEach(t=>{const n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)fb.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const n={error:new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};u.push(n),l(n)}if(0!==n){const r=wO(n),i={error:new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?fb.warning(i.error.toString()):u.push(i),l(i)}}),u.length)throw fb.warning("[".concat(s||"sid-".concat(a.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(u.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry)).join(" | "))),new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,u.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!u.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(u.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})},Ux=e=>{var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(XA("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?Ax(e.detail[23].toLowerCase()):Ax()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const t=e.detail[19],n=null==t?void 0:t.split(";");for(let t=0;t<n.length;t++){var o;const r=jp(o=n[t]).call(o);e.addresses[t]&&n&&(e.addresses[t].fingerprint=r)}}if(XA("GATEWAY_ADDRESS")&&XA("GATEWAY_ADDRESS").length>0){fb.debug("assign gateway address to",XA("GATEWAY_ADDRESS"));const t=XA("GATEWAY_ADDRESS").map(t=>{var n,r;const i=null!==(n=null===(r=e.addresses.find(e=>e.ip===t.ip&&e.port===t.port))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}});e.addresses=t}},xx=(e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=wO(t.buffer.code);throw new yb(Ry.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw fb.debug("update ticket request received ap response without response body:",t),new yb(Ry.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Vx=(e,t,n)=>{const r=Math.floor(Math.random()*10**12),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Ox(Ox({6:e.stringUid,11:t,12:XA("USE_NEW_TOKEN")?"1":void 0,22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};i.request_bodies.forEach(t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const o=new FormData;return o.append("request",JSON.stringify(i)),[o,r]},Fx=(e,t)=>{const n=Math.floor(Math.random()*10**12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(e=>({ip:e.ip,port:e.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let Bx=0;function jx(e){return Gh.all(e.map(e=>e.then(e=>{throw e},e=>e))).then(e=>{throw e},e=>e)}const Gx=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:o}=e,a=0;const s=t;let c,u=0;const l=async()=>{const e=(()=>{const e=a*s;return n.slice(e,e+s).map(r)})();o&&o.push(...e);try{c=await jx(e)}catch(e){if(u+=s,a++,!(u>=n.length))return void await l();i(e)}e.forEach(e=>e.cancel())};return await l(),c},Wx=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:r}=e;const i=t.length;let o=0;const a=async()=>{const e=n(t.shift());try{return await e}catch(e){if(o++,o>=i||null!=r&&r(e))throw e;return a()}};return a()};async function Hx(e,t,n,r){const i=async function(e,t,n,r){let i=null;const o=[],a=async()=>{const i=XA("WEBCS_DOMAIN").slice(0,XA("AJAX_REQUEST_CONCURRENT")).map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:Sx()})),a=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map(e=>e.url)}),s=await Gx({fragementLength:XA("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(fb.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),Lx(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),s},s=async()=>{if(await mA(1e3),null!==i)return i;const a=XA("WEBCS_DOMAIN_BACKUP_LIST").map(t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:Sx()})),s=r.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:a.map(e=>e.url)}),c=await Gx({fragementLength:XA("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:r=>(fb.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),Lx(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c};try{return i=await jx([a(),s()]),o.length&&o.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),i}catch(e){throw e[0]}}(e,t,n,r);return{gatewayInfo:await i}}async function Kx(e,t,n,r,i){const o=e.cloudProxyServer;if("disabled"===o){if(!r)return;if(e.useLocalAccessPoint)return await Hx(e,t,n,i);if(XA("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:r,proxyInfo:o}=await Xx(e,t,n,i);if(e.turnServer&&"auto"!==e.turnServer.mode)return{gatewayInfo:r};const s=o.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||KA.tcpport,udpport:e.udpport||KA.udpport,username:e.username||KA.username,password:e.password||KA.password,forceturn:!1,security:!0}));if(i.useP2P){var a;const t=null!==(a=e.uid)&&void 0!==a?a:r.uid,n="glb:".concat(t.toString()),i=await Uy(n),c=o.map(e=>({turnServerURL:e.address,tcpport:e.tcpport||KA.tcpport,udpport:e.udpport||KA.udpport,username:n,password:i,forceturn:!1,security:!0}));s.push(...c)}return e.turnServer={mode:"manual",servers:s},{gatewayInfo:r}}return await Hx(e,t,n,i)}const{proxyInfo:s,gatewayInfo:c}=await Xx(e,t,n,i),u={gatewayInfo:c},l=s.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport?e.tcpport:KA.tcpport,udpport:"proxy4"===o?void 0:e.udpport?e.udpport:KA.udpport,username:e.username||KA.username,password:e.password||KA.password,forceturn:"proxy4"!==o,security:"proxy5"===o}));if(i.useP2P){var d;const t=null!==(d=e.uid)&&void 0!==d?d:c.uid,n="glb:".concat(t.toString()),r=await Uy(n),i=s.map(e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport||KA.tcpport,udpport:"proxy4"===o?void 0:e.udpport||KA.udpport,username:n,password:r,forceturn:"proxy4"!==o,security:"proxy5"===o}));l.push(...i)}return e.turnServer={mode:"manual",servers:l},fb.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),u}async function Yx(e,t,n,r,i){let o=[];o=XA("ACCOUNT_REGISTER").slice(0,XA("AJAX_REQUEST_CONCURRENT")).map(t.proxyServer?e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"):e=>"https://".concat(e,"/api/v1"));const a=null==i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const s=await async function(e,t,n,r,i){const o=Date.now(),a={sid:n.sid,opid:10,appid:n.appId,string_uid:t};let s=e[0];const c=await kA(()=>Tx(s+"".concat(-1===s.indexOf("?")?"?":"&","action=stringuid"),{data:a,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(n,r)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw fb.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),vb.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:Ry.INVALID_UINT_UID_FROM_STRING_UID,extend:a}),new yb(Ry.INVALID_UINT_UID_FROM_STRING_UID);return vb.reqUserAccount(a.sid,{lts:o,success:!0,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:null,extend:a}),!1}const i=wO(n.code);return i.retry&&(s=e[(r+1)%e.length]),vb.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:n.uid,errorCode:i.desc,extend:a}),i.retry},(t,n)=>t.code!==Ry.OPERATION_ABORTED&&(vb.reqUserAccount(a.sid,{lts:o,success:!1,serverAddr:s,stringUid:a.string_uid,uid:null,errorCode:t.code,extend:a}),s=e[(n+1)%e.length],!0),i);if(0!==c.code){const e=wO(c.code);throw new yb(Ry.UNEXPECTED_RESPONSE,e.desc)}return c}(o,e,t,n,r);return null==i||i.recordJoinChannelService({status:"success",endTs:Date.now()},a),s.uid}catch(e){throw null==i||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},a),e}}async function qx(e,t,n){let r=[];r=XA("ACCOUNT_REGISTER").map(t.proxyServer?e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"):e=>"https://".concat(e,"/api/v1"));try{const i=await Wx({referenceList:r,asyncMapHandler:r=>async function(e,t,n,r){const i=Date.now(),o={sid:n.sid,opid:10,appid:n.appId,string_uid:t};try{const t=await Tx(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(0!==t.code){const e=wO(t.code);throw new yb(Ry.UNEXPECTED_RESPONSE,"preload sua error:".concat(e.desc),e)}if(t.uid<=0||t.uid>=Math.pow(2,32))throw new yb(Ry.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:i,url:e,req:o,uid:t.uid,elapse:Date.now()-i}}catch(e){throw e}}(r,e,t,n),closeFn:e=>e.code===Ry.OPERATION_ABORTED||e.code===Ry.UNEXPECTED_RESPONSE&&!e.data.retry});return i}catch(e){throw e}}async function zx(e,t,n){const r=XA("CDS_AP").slice(0,XA("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config")),i=r.map(r=>function(e,t,n,r){const i=Hv(),o={flag:64,cipher_method:0,features:{device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:GA,cname:t.cname,sid:t.sid,session_id:t.sid,detail:"",proxyServer:t.proxyServer}};return kA(()=>Tx(e,{data:o,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,e=>e.code!==Ry.OPERATION_ABORTED,r)}(r,e,t,n));let o=null,a=null,s={};try{o=await jx(i)}catch(e){if(e.code===Ry.OPERATION_ABORTED)throw e;a=e}if(i.forEach(e=>e.cancel()),vb.reportApiInvoke(e.sid,{name:By.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:o}}).onSuccess(),o&&o.test_tags)try{s=function(e){if(!e.test_tags)return{};const t=e.test_tags,n=Object.keys(t),r={};return n.forEach(e=>{var n;const i=jp(n=e.slice(4)).call(n),o=JSON.parse(t[e])[1];r[i]=o}),r}(o)}catch(e){}return s}async function Jx(e,t){const n=XA("WEBCS_DOMAIN").concat(XA("WEBCS_DOMAIN_BACKUP_LIST")).map(e=>({url:"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:Sx(),serviceIds:[YO.CHOOSE_SERVER,YO.CLOUD_PROXY_FALLBACK]}));try{const r=await Wx({referenceList:n,asyncMapHandler:n=>async function(e,t,n){let r,{url:i,areaCode:o,serviceIds:a}=e;const s=Date.now(),[c,u]=Vx(t,o,a);let l=iA.networkState;try{l&&iA.networkState===Xy.OFFLINE&&iA.onlineWaiter&&await Gh.race([iA.onlineWaiter,mA(PA.maxRetryTimeout)]),l=iA.networkState;const{data:e,headers:t}=await Tx(i,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r="1"===t.http3?1:-1;const o=e=>{const t=[];if(e.response_body.forEach(n=>{const r=n.buffer.code;if(23===n.uri&&0===r&&!n.buffer.edges_services)if(4194310===n.buffer.flag)n.buffer.edges_services=[];else{const r={error:new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:n.buffer.flag};t.push(r)}if(0!==r){const i=wO(r),o={error:new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:e.detail[502]}),flag:n.buffer.flag};4194310===n.buffer.flag?fb.warning(o.error.toString()):t.push(o)}}),t.length)throw new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,t.map(e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message)).join(" | "),{retry:!!t.find(e=>e.error.data.retry),csIp:e.detail[502],desc:[...new Set(t.map(e=>{var t;return null==e||null===(t=e.error)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.desc}).filter(e=>!!e))]})};o(e);const a=eN(e,YO.CHOOSE_SERVER),d=eN(e,YO.CLOUD_PROXY_FALLBACK);return Ux(a),{gatewayInfo:XO(a,i),proxyInfo:d,opid:u,requestTime:s,url:i,isHttp3:r,elapse:Date.now()-s}}catch(e){throw e}}(n,e,t),closeFn:e=>e.code===Ry.OPERATION_ABORTED||e.code===Ry.CAN_NOT_GET_GATEWAY_SERVER&&!e.data.retry});return r}catch(e){throw e}}async function Xx(e,t,n,r){const i=XA("PROXY_SERVER_TYPE3"),o=(e,t,n)=>{let r=n||i;return Array.isArray(r)&&(r=t%2==0?i[1]:i[0]),"https://".concat(r,"/ap/?url=").concat(e)};let a=null;const s=[],c=async()=>{const i=XA("WEBCS_DOMAIN").slice(0,XA("AJAX_REQUEST_CONCURRENT")).map((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:Sx(),serviceIds:[YO.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?YO.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?YO.CLOUD_PROXY:YO.CLOUD_PROXY_FALLBACK]}}),a=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map(e=>e.url)}),c=await Gx({fragementLength:XA("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(fb.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),kx(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:s});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c},u=async()=>{if(await mA(1e3),null!==a)return a;const i=XA("WEBCS_DOMAIN_BACKUP_LIST").map((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:Sx(),serviceIds:[YO.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?YO.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?YO.CLOUD_PROXY:YO.CLOUD_PROXY_FALLBACK]}}),c=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map(e=>e.url)}),u=await Gx({fragementLength:XA("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(fb.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),kx(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:s});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},c),u};let l,d,h;try{({gatewayInfo:l,proxyInfo:d,url:h}=await jx([c(),u()]))}catch(e){throw e[0]}if(s.length&&s.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),!l||!d)throw new yb(Ry.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,"disabled"!==e.cloudProxyServer&&Array.isArray(i)&&h){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];Dn(i).call(i,t)&&(e.proxyServer=t,fb.setProxyServer(t),vb.setProxyServer(t))}return a={gatewayInfo:l,proxyInfo:await tN(d,l.uid)},a}async function Qx(e,t,n){const r=XA("UAP_AP").slice(0,XA("AJAX_REQUEST_CONCURRENT")).map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap")),i=r.map(r=>function(e,t,n,r){const i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:GA,cname:t.cname,uid:t.uid.toString(),requestId:Px,seq:Px};Px+=1;const o={service_name:"tele_channel",json_body:JSON.stringify(i)};return kA(async()=>{const t=await Tx(e,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new yb(Ry.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw fb.error(e.toString()),e}const r=JSON.parse(t.json_body);if(200!==r.code){const e=new yb(Ry.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(r.code,", reason: ").concat(r.reason));throw fb.error(e.toString()),e}if(!r.servers||0===r.servers.length){const e=new yb(Ry.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw fb.error(e.toString()),e}return{vid:r.vid,workerToken:r.workerToken,addressList:(XA("CHANNEL_MEDIA_RELAY_SERVERS")||r.servers).map(e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(XA("WORKER_DOMAIN"),":").concat(e.wss))}},void 0,e=>!!(e.code!==Ry.OPERATION_ABORTED&&e.code!==Ry.UNEXPECTED_RESPONSE||e.data&&e.data.retry),r)}(r,e,t,n));try{const e=await jx(i);return i.forEach(e=>e.cancel()),e}catch(e){throw e[0]}}async function Zx(e,t,n){let r=null;const i=[],o=async o=>{const a=XA(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"));return o&&(await mA(1e3),null!==r)?r:await Gx({fragementLength:XA("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:r=>(fb.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),r),function(e,t,n,r){const[i]=Fx(t,[YO.CHOOSE_SERVER]);let o=iA.networkState;return kA(async()=>{o&&iA.networkState===Xy.OFFLINE&&iA.onlineWaiter&&await Gh.race([iA.onlineWaiter,mA(r&&r.maxRetryTimeout||PA.maxRetryTimeout)]),o=iA.networkState;const t=await Tx(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);return xx(t,e)},()=>!1,e=>e.code!==Ry.OPERATION_ABORTED&&(e.code===Ry.UPDATE_TICKET_FAILED?e.data.retry:(fb.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0)),r)}(r,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return r=await jx([o(!1),o(!0)]),i.length&&i.forEach(e=>e.cancel&&"function"==typeof e.cancel&&e.cancel()),r}catch(e){throw e[0]}}function $x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$x(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$x(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class tV extends xy{get isSuccess(){return!!this.configs}constructor(){super(),Fg(this,"configs",void 0),Fg(this,"joinInfo",void 0),Fg(this,"cancelToken",void 0),Fg(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Fg(this,"interval",void 0),Fg(this,"mutex",new NA("config-distribute")),Fg(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),XA("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},XA("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,vb.reportApiInvoke(null,{options:void 0,name:By.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:jy.TRACER}).onSuccess(JSON.stringify(QA))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void fb.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await zx(this.joinInfo,this.cancelToken,this.retryConfig),fb.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(e){const t=new yb(Ry.NETWORK_RESPONSE_ERROR,e);fb.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&void 0!==t.uplink.max_bitrate&&void 0!==t.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(sO.UPDATE_BITRATE_LIMIT,e):this.emit(sO.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&eV({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;const n=aE(t=Object.keys(e).filter(e=>/^webrtc_ng_global_parameter/.test(e))).call(t);for(let t=0;t<n.length;t++)for(let r=n.length-1;r>t;r--){const t=n[r];if("number"==typeof e[t].__priority){const i=n[r-1];if("number"==typeof e[i].__priority){if(!(e[t].__priority>e[i].__priority))continue;{const e=t;n[r]=n[r-1],n[r-1]=e}}else{const e=t;n[r]=n[r-1],n[r-1]=e}}}const r={};n.forEach(t=>{const n=e[t],i=n.__expires;Object.keys(n).forEach(e=>{"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(r,e)||(r[e]=eV({value:n[e]},i&&{expires:i}))})});try{!function(e){try{const t=Date.now();Object.keys(e).forEach(n=>{switch(n){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(zA,n)){const{value:r,expires:i}=e[n];if(i&&i<=t)return;QA[n]=r,zA[n]=r,fb.debug("Update global parameters from config distribute",n,r)}}})}catch(t){fb.error("Error update config immediately: ".concat(e),t.message)}}(r);const e=JSON.stringify(r),t=window.btoa(e);window.localStorage.setItem("websdk_ng_global_parameter",t),fb.debug("Caching global parameters ".concat(e))}catch(e){fb.error("Error caching global parameters:",e.message)}}}class iV extends xy{constructor(){super(...arguments),Fg(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(XA("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){var i;const n=Dn(i=r.result).call(i,!0);r.isPrevNormal&&!n&&this.emit("exception",nV[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",nV[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof RM&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=QO(t._encoderConfig.frameRate));const r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof RM&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const nV={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},rV=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};var oV=i(ie.Object.getOwnPropertySymbols),sV=wi,aV=qi.indexOf,cV=Bn,dV=v([].indexOf),lV=!!dV&&1/dV([1],1,-0)<0;sV({target:"Array",proto:!0,forced:lV||!cV("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return lV?dV(this,e,t)||0:aV(this,e,t)}});var uV=Xi("Array").indexOf,hV=l,pV=uV,_V=Array.prototype,EV=function(e){var t=e.indexOf;return e===_V||hV(_V,e)&&t===_V.indexOf?pV:t},fV=i(EV);function mV(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Wb(e);for(r=0;r<o.length;r++)n=o[r],fV(t).call(t,n)>=0||(i[n]=e[n]);return i}(e,t);if(oV){var o=oV(e);for(r=0;r<o.length;r++)n=o[r],fV(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function TV(e){if(Array.isArray(e))return e.map(e=>e);if(!SV(e))return e;const t={};for(const n in e){const r=e[n];t[n]=SV(r)||Array.isArray(r)?TV(r):r}return t}function SV(e){return!("object"!=typeof e||Array.isArray(e)||!e)}class gV{constructor(e){Fg(this,"input",[]),Fg(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const RV={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},CV={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:RV,remoteCandidate:RV}},IV={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},vV={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},yV={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},AV={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function bV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function wV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bV(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class OV{constructor(e,t){Fg(this,"onFirstVideoReceived",void 0),Fg(this,"onFirstVideoDecoded",void 0),Fg(this,"onFirstAudioReceived",void 0),Fg(this,"onFirstVideoDecodedTimeout",void 0),Fg(this,"onFirstAudioDecoded",void 0),Fg(this,"onSelectedLocalCandidateChanged",void 0),Fg(this,"onSelectedRemoteCandidateChanged",void 0),Fg(this,"videoIsReady",!1),Fg(this,"videoIsReady2",{}),Fg(this,"pc",void 0),Fg(this,"options",void 0),Fg(this,"intervalTimer",void 0),Fg(this,"stats",TV(CV)),Fg(this,"isFirstVideoReceived",{}),Fg(this,"isFirstVideoDecoded",{}),Fg(this,"isFirstAudioReceived",{}),Fg(this,"isFirstAudioDecoded",{}),Fg(this,"isFirstVideoDecodedTimeout",{}),Fg(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Gh(e=>{e({local:wV({},RV),remote:wV({},RV)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,o=0,a=0;for(const s of n)e[s].forEach((e,n)=>{if(!this.lossRateWindowStats[t-1][s][n]||!this.lossRateWindowStats[0][s][n])return;const c=this.lossRateWindowStats[t-1][s][n].packets-this.lossRateWindowStats[0][s][n].packets,u=this.lossRateWindowStats[t-1][s][n].packetsLost-this.lossRateWindowStats[0][s][n].packetsLost;"videoSend"===s||"audioSend"===s?(r+=c,o+=u):(i+=c,a+=u),e.packetLostRate=Number.isNaN(c)||Number.isNaN(c)||c<=0||u<=0?0:u/(c+u)});e.sendPacketLossRate=r<=0||o<=0?0:o/(r+o),e.recvPacketLossRate=i<=0||a<=0?0:a/(i+a)}}function NV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function DV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?NV(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class PV extends OV{constructor(){super(...arguments),Fg(this,"_stats",CV),Fg(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=TV(CV);const n=t.filter(e=>"ssrc"===e.type);this.processSSRCStats(n);const r=t.find(e=>"VideoBwe"===e.type);r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(e=>{var t;const n=Dn(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{const t=TV(vV);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=TV(IV),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){const r=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:DV({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=TV(AV);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=TV(yV);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}})}_getStats(){return new Gh((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){const t=[];return e.result().forEach(e=>{const n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach(t=>{n[t]=e.stat(t)}),t.push(n)}),t}}function LV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function kV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?LV(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class MV extends OV{constructor(){super(...arguments),Fg(this,"_stats",CV),Fg(this,"report",void 0),Fg(this,"lastDecodeVideoReceiverStats",new Map),Fg(this,"lastVideoFramesRecv",new Map),Fg(this,"lastVideoFramesSent",new Map),Fg(this,"lastVideoFramesDecode",new Map),Fg(this,"lastVideoFramesOutput",new Map),Fg(this,"lastVideoJBDelay",new Map),Fg(this,"lastAudioJBDelay",new Map),Fg(this,"mediaBytesSent",new Map),Fg(this,"mediaBytesRetransmit",new Map),Fg(this,"mediaBytesTargetEncode",new Map),Fg(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=TV(CV),this.report.forEach(e=>{switch(e.type){case vw.OUTBOUND:case vw.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,r=!t&&!("frameWidth"in e);e.type===vw.OUTBOUND?"audio"===t||r?this.processAudioOutboundStats(e):("video"===t||n)&&this.processVideoOutboundStats(e):e.type===vw.INBOUND&&("audio"===t||r?this.processAudioInboundStats(e):("video"===t||n)&&this.processVideoInboundStats(e));break}case vw.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case vw.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:kV({},RV),remote:kV({},RV)};return e.forEach(n=>{let r;if(n.type===vw.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===vw.CANDIDATE_PAIR&&n.selected&&(r=n),r){const n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){const i=e.get(r.localCandidateId);i&&n(t.local,i)}if(r.remoteCandidateId){const i=e.get(r.remoteCandidateId);i&&n(t.remote,i)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===vw.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===vw.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===vw.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(kV({},t),kV({},this.stats.selectedCandidatePair.localCandidate)),e.type===vw.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(kV({},t),kV({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(t=>t.ssrc===e.ssrc);t||(t=TV(AV),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find(t=>t.ssrc===e.ssrc);t||(t=TV(IV),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame?t.decodedFrame.width:0,t.decodedFrame?t.decodedFrame.height:0),this.isFirstVideoDecoded[t.ssrc]=!0),n){const r=n.stats,i=o-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&i>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(t.qpSumPerFrame=n.stats.framesDecodeCount>e.framesDecoded?e.qpSum/e.framesDecoded:(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}r&&o-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((o-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&o-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:kV({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(t=>t.ssrc===e.ssrc);t||(t=TV(vV),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const t=new gV(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new gV(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new gV(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){const n=this.lastEncoderMs.get(e.ssrc);t.avgEncodeMs=!n||n.lastFrameCount>e.framesEncoded?1e3*e.totalEncodeTime/e.framesEncoded:1e3*(e.totalEncodeTime-n.lastEncoderTime)/(e.framesEncoded-n.lastFrameCount)}if(e.framesEncoded&&e.qpSum){const n=this.lastEncoderMs.get(e.ssrc);t.qpSumPerFrame=!n||n.lastFrameCount>e.framesEncoded?e.qpSum/e.framesEncoded:(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,vw.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(t=>t.ssrc===e.ssrc);if(t||(t=TV(yV),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,vw.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(_N(n=this.report).call(n)).find(n=>n.type===t&&n.ssrc===e);return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,o,a;const s=t?this.report.get(t):void 0,c=null!==(r=null==s?void 0:s.framesSent)&&void 0!==r?r:e.framesSent;if("number"!=typeof c)return;let u=null!==(i=null==s?void 0:s.frameWidth)&&void 0!==i?i:e.frameWidth,l=null!==(o=null==s?void 0:s.frameHeight)&&void 0!==o?o:e.frameHeight,d=null!==(a=null==s?void 0:s.framesPerSecond)&&void 0!==a?a:e.framesPerSecond;if("number"==typeof u&&"number"==typeof l||(u=0,l=0),null==d){const e=Date.now(),t=this.lastVideoFramesSent.get(n.ssrc);t&&e-t.lts>=800?(d=Math.round((c-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:d})):t?d=t.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:e,rate:0})}n.sentFrame={width:u,height:l,frameRate:Math.max(0,d)}}processVideoTrackReceiverStats(e,t,n){var r,i,o,a,s;const c=t?this.report.get(t):void 0,u=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,l=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,d=null!==(o=null==c?void 0:c.frameHeight)&&void 0!==o?o:e.frameHeight,h=null!==(a=null==c?void 0:c.jitterBufferDelay)&&void 0!==a?a:e.jitterBufferDelay,p=null!==(s=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount;if("number"==typeof u){const e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=u;let r=0;e&&t-e.lts>=800?(r=Math.round((u-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:t,rate:r})):e?r=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:t,rate:0}),n.receivedFrame={width:l||0,height:d||0,frameRate:r||0},n.decodedFrame={width:l||0,height:d||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:l||0,height:d||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(h&&p){const e=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=p-e.jitterBufferEmittedCount;r>0&&(t=1e3*(h-e.jitterBufferDelay)/r),n.jitterBufferMs=t,n.currentDelayMs=Math.round(t),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:p,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var r,i,o,a;const s=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==s?void 0:s.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,u=null!==(o=null!==(a=null==s?void 0:s.echoReturnLossEnhancement)&&void 0!==a?a:e.echoReturnLossEnhancement)&&void 0!==o?o:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=u}processAudioTrackReceiverStats(e,t,n){var r,i,o,a,s,c,u;const l=t?this.report.get(t):void 0,d=null!==(r=null==l?void 0:l.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,h=null!==(i=null==l?void 0:l.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,p=null!==(o=null==l?void 0:l.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,f=null!==(a=null==l?void 0:l.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount,m=null!==(s=null==l?void 0:l.audioLevel)&&void 0!==s?s:null==e?void 0:e.audioLevel,g=null!==(c=null==l?void 0:l.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,v=null!==(u=null==l?void 0:l.concealedSamples)&&void 0!==u?u:e.concealedSamples;if(d&&h&&(n.accelerateRate=d/h),p&&f){const e=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let t=e.jitterBufferMs;const r=f-e.jitterBufferEmittedCount;r>0&&(t=1e3*(p-e.jitterBufferDelay)/r),n.jitterBufferMs=Math.round(t),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:f,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=m;let E=1920;g&&h&&(E=h/g/50,n.receivedFrames=Math.round(h/E)),v&&(n.droppedFrames=Math.round(v/E))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach(t=>{e+=t.diffMean()}),this.mediaBytesRetransmit.forEach(e=>{t=null===t?e.diffMean():t+e.diffMean()}),this.mediaBytesTargetEncode.forEach(e=>{n=null===n?e.diffMean():n+e.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==t?e-t:e)/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}}class UV extends OV{updateStats(){return Gh.resolve()}}function xV(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const o=function(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}();return o?o<76?new PV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new MV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(e){if(!window.RTCStatsReport)return!1;const t=e.getStats();return!!(t instanceof Gh||function(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}(t))}(e)?new MV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new UV(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}let VV=class{get localCapabilities(){return sA(this._localCapabilities)}get rtpCapabilities(){return sA(this._rtpCapabilities)}get candidates(){return sA(this._candidates)}get iceParameters(){return sA(this._iceParameters)}get dtlsParameters(){return sA(this._dtlsParameters)}constructor(e){Fg(this,"sessionDesc",void 0),Fg(this,"_localCapabilities",void 0),Fg(this,"_rtpCapabilities",void 0),Fg(this,"_candidates",void 0),Fg(this,"_iceParameters",void 0),Fg(this,"_dtlsParameters",void 0),Fg(this,"setup",void 0),Fg(this,"currentMidIndex",void 0),Fg(this,"cname","o/i14u9pJrxRKAsu"),Fg(this,"firefoxSsrcMidMap",new Map),e=sA(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:o,direction:a,setup:s,videoCodec:c,audioCodec:u}=e;let l;this.setup=s,l=FU.parse(a===Mw.RECEIVE_ONLY?"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n":"v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=extmap-allow-mixed\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=recvonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n"),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=o;const d=a===Mw.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=a===Mw.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=a===Mw.RECEIVE_ONLY?i.send.videoCodecs:sx(dO.VIDEO,d,h,c),f=a===Mw.RECEIVE_ONLY?i.send.audioCodecs:sx(dO.AUDIO,d,h,u);for(const e of l.mediaDescriptions)e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=this.setup,"application"===e.media.mediaType&&(e.attributes.sctpPort="5000"),"video"===e.media.mediaType&&(e.media.fmts=p.map(e=>e.payloadType.toString(10)),e.attributes.payloads=p,e.attributes.extmaps=d.videoExtensions),"audio"===e.media.mediaType&&(e.media.fmts=f.map(e=>e.payloadType.toString(10)),e.attributes.payloads=f,e.attributes.extmaps=d.audioExtensions,ox(e));this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return FU.print(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:o,ssrcGroups:a}=zU(t,this.cname,XA("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(o);if(s){if(Zv()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,s.attributes.mid),i&&(i.twcc||i.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,i),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,o,r);let n;return-1===t?(n=this.createOrRecycleSendMedia(e,o,a,"sendonly",r,i),this.updateBundleMids()):(n=sA(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=o,n.attributes.ssrcGroups=a,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,i)),Zv()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,n.attributes.mid),{needExchangeSDP:!0,mid:n.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{e.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,n){const r=[];return e.forEach(e=>{const i=this.findAvailableRecvMediaIndex(e._mediaStreamTrack.kind);let o,a=!1;-1===i?(a=!0,o=this.createOrRecycleRecvMedia(e,[],"recvonly",t,n),this.updateBundleMids()):(o=sA(this.sessionDesc.mediaDescriptions[i]),o.attributes.direction="recvonly"),r.push({mid:o.attributes.mid,needCreateTransceiver:a})}),r}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:r,port:i,type:o,relatedAddress:a,relatedPort:s,priority:c}=new RTCIceCandidate(e),u={foundation:null!=t?t:"",componentId:"1",transport:null!=n?n:"",priority:c?c+"":"",connectionAddress:null!=r?r:"",port:i?i+"":"",type:o?o+"":"",relAddr:null!=a?a:"",relPort:s?s+"":"",extension:{}};this.candidates.some(e=>e.priority===u.priority&&e.connectionAddress===u.connectionAddress&&e.port===u.port)||(this._candidates.push(u),this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,r,i){const o=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,s=sx(o,a,this.localCapabilities.send,o===dO.AUDIO?i:r),c=o===dO.VIDEO?a.videoExtensions:a.audioExtensions,u="".concat(++this.currentMidIndex);let l={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};l=this.mungRecvMediaDsec(l,e);const d=this.findFirstClosedMedia(o);if(d){const e=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[e]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dn(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dn(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&"0"!==r.media.port&&("sendonly"===r.attributes.direction||"sendrecv"===r.attributes.direction)&&0===r.attributes.ssrcs.length;if(Zv()){if(i){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==r.attributes.mid&&"1"!==r.attributes.mid)||!(!e||e!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>"0"!==t.attributes.mid&&"1"!==t.attributes.mid&&t.media.mediaType===e&&"0"!==t.media.port&&("recvonly"===t.attributes.direction||"sendrecv"===t.attributes.direction))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=sA(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,n,r,i,o){const a=this.rtpCapabilities.send,s=e===dO.VIDEO?a.videoCodecs:a.audioCodecs,c=e===dO.VIDEO?a.videoExtensions:a.audioExtensions;Zv()&&(i="".concat(++this.currentMidIndex));let u={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};u=this.mungSendMediaDesc(u,o);const l=this.findFirstClosedMedia(e);if(l){const e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}mungRecvMediaDsec(e,t,n){const r=sA(e);return XU(r),JU(r,t),QU(r,t),ZU(r),$U(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=sA(e);return $U(n,t,this.localCapabilities.recv),ox(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Zv()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}};const FV=["sdp"];var BV;function jV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function GV(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jV(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let WV=(BV=class e extends aO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,r){super(t,n),Fg(this,"direction",void 0),Fg(this,"name",void 0),Fg(this,"store",void 0),Fg(this,"spec",void 0),Fg(this,"peerConnection",void 0),Fg(this,"initialOffer",void 0),Fg(this,"transport",void 0),Fg(this,"statsFilter",void 0),Fg(this,"localCandidateCount",0),Fg(this,"_isInRestartIce",!1),Fg(this,"mutex",new NA("P2PConnection-mutex")),Fg(this,"onLocalCandidate",void 0),Fg(this,"remoteSDP",void 0),Fg(this,"pendingCandidates",[]),Fg(this,"localCapabilities",void 0),Fg(this,"isReady",!1),Fg(this,"restartCnt",0),Fg(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=null!=r?r:Mw.SEND_ONLY,this.name=this.direction===Mw.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=xV(this.peerConnection,XA("STATS_UPDATE_INTERVAL"),void 0,Zv()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const t=await tx();if(this.localCapabilities=rx(t),e){const{sdp:t}=e,n=mV(e,FV),r=function(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=WU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},"sendonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nx(t,e,"videoExtensions",n,r,i),nx(t,e,"videoCodecs",n,r,i),nx(t,e,"audioExtensions",n,r,i),nx(t,e,"audioCodecs",n,r,i),XA("RAISE_H264_BASELINE_PRIORITY")){const e=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"===e.fmtp.parameters["profile-level-id"]);if(-1!==e){const t=i.videoCodecs.findIndex(e=>e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase());if(t<e){fb.debug("raising H264 baseline profile priority");const n=i.videoCodecs[e];i.videoCodecs.splice(e,1),i.videoCodecs.splice(t,0,n)}-1!==t&&XA("FILTER_SEND_H264_BASELINE")&&(n.videoCodecs=n.videoCodecs.filter(e=>!(e.rtpMap&&"h264"===e.rtpMap.encodingName.toLocaleLowerCase()&&e.fmtp&&"42001f"!==e.fmtp.parameters["profile-level-id"])))}}return{send:n,recv:r,sendrecv:i}}({},{},t);this.remoteSDP=new VV({remoteIceParameters:n.iceParameters,remoteDtlsParameters:n.dtlsParameters,candidates:[],remoteRTPCapabilities:r,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const o=HU(i.sdp);await this.peerConnection.setLocalDescription(i);const a=await ix({},{},i.sdp);this.localCapabilities=rx(a);const s=this.peerConnection.getTransceivers()[0];return null!=s&&s.receiver&&s.receiver.transport&&this.tryBindTransportEvents(s.receiver.transport),GV(GV({},o),{},{sdp:i.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=HU(e.sdp);return this.initialOffer=e,GV(GV({},t),{},{sdp:e.sdp})}}catch(e){throw new Cy(Ry.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:t,iceParameters:n,dtlsParameters:r}=e,i=await ix({},{},t);this.remoteSDP=new VV({remoteIceParameters:n,remoteDtlsParameters:r,candidates:[],remoteRTPCapabilities:i,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];null!=o&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(e=>{this.peerConnection.addIceCandidate(e)}),this.pendingCandidates=[])}catch(e){throw new Cy(Ry.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return YI(function*(){const i=yield qI(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const i=[],o=r.remoteSDP.receive(e,t,n);e.forEach((e,t)=>{if(o[t].needCreateTransceiver){const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});i.push(t),e._updateRtpTransceiver(t)}else{const n=r.peerConnection.getTransceivers().find(e=>e.mid===o[t].mid);if(!n)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(o[t].mid));i.push(n),e._updateRtpTransceiver(n)}}),Zv()&&!0===XA("SIMULCAST")&&(yield qI(r.applySimulcastForFirefox(i,e)));const a=o.map(e=>e.mid),s=yield qI(r.peerConnection.createOffer()),c=r.mungSendOfferSDP(s.sdp,e,a),u=FU.parse(c),l=a.map(e=>{const t=u.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return KU(t,XA("USE_PUB_RTX"))}),d=i.map((e,t)=>({localSSRC:l[t],id:a[t]}));yield qI(r.peerConnection.setLocalDescription({type:"offer",sdp:c}));try{yield d}catch(e){const t=r.remoteSDP.toString();throw yield qI(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield qI(r.peerConnection.setRemoteDescription({type:"answer",sdp:t})),yield qI(r.stopSending(a,!0)),e}yield qI(r.applySimulcastEncodings(i,e)),yield qI(r.applySendEncodings(i,e));const h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return null==p||p(h),yield qI(r.setRemoteDescription({type:"answer",sdp:h})),i.map((e,t)=>({localSSRC:l[t],id:a[t]}))}catch(e){throw e instanceof Cy?e:new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}})()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length (".concat(t.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));t.map(e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),fb.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else fb.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find(e=>e.mid===i);if(!a||null===a.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async mockReceive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),fb.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else fb.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===HA.Auto&&(this.store.p2pTransport=HA.SdRtn,ZP().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,ZP().supportPCSetConfiguration&&this.peerConnection.setConfiguration(e.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const e=await this.peerConnection.createOffer({iceRestart:!0});if(!e.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:t}=HU(e.sdp);return this.store.descriptionStart(),this.direction===Mw.SEND_ONLY&&await this.peerConnection.setLocalDescription(e),t}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Mw.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const e=await this.peerConnection.createAnswer();if(!e.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:t}=HU(e.sdp);return await this.peerConnection.setLocalDescription(e),t}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===n.length&&(this.isVP8Simulcast(t)?Zv()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find(e=>e.mid===t);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:GV(GV({},RV),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:GV(GV({},RV),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;Dn(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;"connected"===this.peerConnection.connectionState&&(this.restartCnt=0),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{var t;e.candidate?(e.candidate.candidate&&(null===(t=this.onLocalCandidate)||void 0===t||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1):fb.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i={iceServers:[]};var o;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Ky(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers,n,r)),XA("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,r)),Dn(o=[HA.Relay,HA.SdRtn]).call(o,n)&&(i.iceTransportPolicy="relay"),XA("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(i.iceTransportPolicy="relay")}))),XA("ENABLE_ENCODED_TRANSFORM")&&ZP().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),fb.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=[],i=e.filter(e=>e.tcpport);fb.debug("P2PConnection turnServers is ".concat(i,", current index is ").concat(n));const o=i.length>n?i[n]:i[0];switch(t){case HA.SdRtn:const t=e.filter(e=>{var t;return Dn(t=e.username).call(t,"glb:")&&e.turnServerURL==e.turnServerURL}),i=t.length>n?t[n]:t[0];i&&(r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(JO(i.turnServerURL),":").concat(i.tcpport,"?transport=udp")}),r.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(JO(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}));break;case HA.Relay:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(JO(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(JO(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),r.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return r}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const t=e.iceTransport;t&&(t.onstatechange=()=>{const t=null==e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){const{local:e,remote:n}=t.getSelectedCandidatePair();fb.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find(t=>t.track===e._mediaStreamTrack)),!t)return fb.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return fb.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ZP().supportSetRtpSenderParameters)return fb.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const r={},i={};switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(e._encoderConfig){var o;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(i.maxBitrate=1e3*t),Dn(o=e._hints).call(o,mL.LOW_STREAM)&&(n&&(i.maxFramerate=QO(n)),r&&r>=1&&(i.scaleResolutionDownBy=r))}if(XA("DSCP_TYPE")&&Ey()){var a;const e=XA("DSCP_TYPE");Dn(a=["very-low","low","medium","high"]).call(a,e)&&(i.networkPriority=e)}const s=t.getParameters(),c=null===(n=s.encodings)||void 0===n?void 0:n[0];Zv()&&!c&&(r.encodings=[i]),c&&Object.assign(c,i),Object.assign(s,r),fb.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(s.encodings))),await t.setParameters(s)}async applySendEncodings(e,t){try{if(!ZP().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof aU&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){fb.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=FU.parse(e);return t.forEach((e,t)=>{const i=n[t],o=r.mediaDescriptions.find(e=>e.attributes.mid===i);o&&(JU(o,e),ex(o,e,this.store.codec))}),FU.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,o,a;const c=e[s],u=t[s];if(u instanceof aU&&!Dn(n=u._hints).call(n,mL.LOW_STREAM)&&null!==(r=u._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=u._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=u._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(a=u._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!Zv()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof aU&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof aU&&XA("SIMULCAST")&&"vp8"===this.store.codec&&!Dn(t=e._hints).call(t,mL.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(XA("SDP_LOGGING"))return fb.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async e=>{e.direction="sendonly"});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}async getRemoteSSRC(e,t){var n,r;if(t=null!==(n=t)&&void 0!==n?n:null===(r=this.currentRemoteDescription)||void 0===r?void 0:r.sdp){var i;const n=null===(i=FU.parse(t).mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===i?void 0:i.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),Dn(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,n){const r=FU.parse(e),i=r.mediaDescriptions.find(e=>e.attributes.mid===t);return i&&n===dO.AUDIO&&"audio"===i.media.mediaType&&ox(i),FU.print(r)}},Cw(BV.prototype,"establish",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"establish"),BV.prototype),Cw(BV.prototype,"connect",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"connect"),BV.prototype),Cw(BV.prototype,"receive",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"receive"),BV.prototype),Cw(BV.prototype,"mockReceive",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"mockReceive"),BV.prototype),Cw(BV.prototype,"stopReceiving",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"stopReceiving"),BV.prototype),Cw(BV.prototype,"restartICE",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"restartICE"),BV.prototype),Cw(BV.prototype,"close",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"close"),BV.prototype),Cw(BV.prototype,"updateEncoderConfig",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"updateEncoderConfig"),BV.prototype),Cw(BV.prototype,"updateSendParameters",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"updateSendParameters"),BV.prototype),Cw(BV.prototype,"replaceTrack",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"replaceTrack"),BV.prototype),Cw(BV.prototype,"muteLocal",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"muteLocal"),BV.prototype),Cw(BV.prototype,"unmuteLocal",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"unmuteLocal"),BV.prototype),BV);function HV(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}function KV(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=QO(t.width),r.height=QO(t.height);const i=QO(t.framerate||15);document.body.append(n),document.body.append(r);let o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const a=r.getContext("2d");if(!a)throw new yb(Ry.UNEXPECTED_ERROR,"can not get canvas context");const s=ZP(),c=r.captureStream(s.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const e=r.width*(n.videoHeight/n.videoWidth);Math.abs(e-r.height)>=2&&(fb.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(e)),r.height=e)}a.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))},r.stopCapture=QL(()=>r.startCapture&&r.startCapture(),i);const u=c.stop;return c.stop=()=>{u.call(c),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),fb.debug("clean low stream renderer")},c}var YV=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(YV||{}),qV=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e}(qV||{}),zV=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(zV||{}),JV=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e}(JV||{}),XV=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(XV||{}),QV=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(QV||{}),ZV=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e}(ZV||{}),$V=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e}($V||{}),eF=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(eF||{}),tF=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e}(tF||{});const iF=1e3,nF=3;function rF(e,t,n){null!=n&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function oF(e){const t={[tF.CONN_TYPE]:0,[tF.RTT]:e.rtt};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t[tF.CONN_TYPE]=1),"tcp"===n&&(t[tF.CONN_TYPE]=3),"tls"===n&&(t[tF.CONN_TYPE]=4);break}case"srflx":t[tF.CONN_TYPE]=2}return t}function sF(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class aF extends xy{constructor(e){super(),Fg(this,"store",void 0),Fg(this,"uploadWRTCStatsTimer",void 0),Fg(this,"uploadOutboundDenoiserStatsTimer",void 0),Fg(this,"uploadExtStatsTimer",void 0),Fg(this,"uploadExtUsageStatsTimer",void 0),Fg(this,"uploadInboundExtStatsTimer",void 0),Fg(this,"requestStats",void 0),Fg(this,"requestTransportStats",void 0),Fg(this,"requestLocalMedia",void 0),Fg(this,"requestRemoteMedia",void 0),Fg(this,"requestAllTracks",void 0),Fg(this,"requestVideoIsReady",void 0),Fg(this,"requestUploadStats",void 0),Fg(this,"requestUpload",void 0),Fg(this,"uploadOutboundStarted",!1),Fg(this,"uploadInboundStarted",!1),Fg(this,"uploadTransportStarted",!1),Fg(this,"uploadExtensionUsageStarted",!1),Fg(this,"lastRecvStats",void 0),Fg(this,"lastSendStats",void 0),Fg(this,"lastFullRecvStats",void 0),Fg(this,"lastFullSendStats",void 0),Fg(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let t,n;if(this.uploadTransportStarted&&(t=this.requestStats(),this.store.useP2P&&(n=this.requestStats(!0))),!t&&this.uploadOutboundStarted&&(t=this.requestStats()),!n&&this.uploadInboundStarted&&(n=this.requestStats(!0)),t||n){const r={};if(this.uploadTransportStarted&&t){const i=this.getTransportStats(t,n,e);i&&(r.misc=[i])}if(this.uploadOutboundStarted&&t){const n=this.getOutboundStats(t,e?this.lastSendStats:this.lastFullSendStats,e);n&&(r.outbound=[n])}if(this.uploadInboundStarted&&n){const t=this.getInboundStats(n,e?this.lastRecvStats:this.lastFullRecvStats,e);t&&(r.inbound=t)}this.requestUploadStats(r)}this.lastRecvStats=n,this.lastSendStats=t,e||(this.lastFullRecvStats=n,this.lastFullSendStats=t)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==nF),++e===nF+1&&(e=1)},iF)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,t,n){if(!this.requestStats)return;if(n)return null==e.rtt?void 0:{addition:{[tF.RTT]:e.rtt,[tF.CONN_TYPE]:void 0}};const r=oF(e);if(this.store.useP2P){if(t){const e=oF(t);r[tF.CONN_TYPE]+=e[tF.CONN_TYPE]<<3}r[tF.CONN_TYPE]+=110}else r[tF.CONN_TYPE]+=100;return{addition:r}}getOutboundStats(e,t,n){if(!this.requestUploadStats||!this.requestLocalMedia)return;const r=this.requestLocalMedia();if(!r||0===r.length)return;let i,o,a;return r.forEach(r=>{let[s,{track:c,ssrcs:u}]=r;switch(s){case hO.LocalVideoLowTrack:case hO.LocalVideoTrack:if(s===hO.LocalVideoTrack){const r=function(e,t,n,r,i){const o=t.videoSend.find(t=>t.ssrc===e);if(!o)return;const a={},{sentFrame:s,inputFrame:c}=o;if(c&&s&&(a[qV.FREEZE]=function(e,t){let n=!0;return n=!(e<=5)&&(e<=10?t<3:e<=20?t<4:t<5),n}(c.frameRate,s.frameRate)?1:0),rF(a,qV.QP_SUM,o.qpSumPerFrame),i)return a;switch(s&&(rF(a,qV.HEIGHT,s.height),rF(a,qV.WIDTH,s.width),rF(a,qV.FRAME_RATE,s.frameRate)),a[qV.DISABLED]=r._originMediaStreamTrack&&!r._originMediaStreamTrack.enabled||r._mediaStreamTrack&&!r._mediaStreamTrack.enabled?1:0,o.adaptionChangeReason){case"none":a[qV.ADAPTATION]=0;break;case"cpu":a[qV.ADAPTATION]=1;break;case"bandwidth":a[qV.ADAPTATION]=2;break;case"other":a[qV.ADAPTATION]=3}let u=0;o.adaptionChangeReason&&(u+=sF(o.adaptionChangeReason)),t.qualityLimitationReason&&(u+=sF(t.qualityLimitationReason)<<3),a[qV.ADAPTATION]=u,a[qV.PLAYER_STATUS]=xL[r._player?r._player.videoElementStatus:"uninit"],rF(a,qV.NACKS,o.nacksCount),rF(a,qV.PLIS,o.plisCount),rF(a,qV.FIRS,o.firsCount),rF(a,qV.AVG_ENCODE,o.avgEncodeMs);const l=n&&n.videoSend.find(t=>t.ssrc===e);if(l){let e=i?iF:iF*nF;l.timestamp&&o.timestamp&&(e=o.timestamp-l.timestamp),null!=l.packets&&null!=o.packets&&rF(a,qV.PACKAGE_RATE,1e3*(o.packets-l.packets)/e),null!=o.packetsLost&&null!=l.packetsLost&&rF(a,qV.PACKAGE_LOST,o.packetsLost-l.packetsLost),null!=l.bytes&&null!=o.bytes&&rF(a,qV.BITRATE,8*(o.bytes-l.bytes)/e)}return a}(u[0].ssrcId,e,t,c,n),i=n?null:function(e,t,n){const r=t.videoSend.find(t=>t.ssrc===e);if(!r)return null;const i={},o=r.inputFrame,a=o&&o.width||n&&n.videoWidth||0,s=o&&o.frameRate||0;return rF(i,YV.HEIGHT,o&&o.height||n&&n.videoHeight||0),rF(i,YV.WIDTH,a),rF(i,YV.FRAME_RATE,s),i}(u[0].ssrcId,e,c),a=n?null:function(e){const t={};return rF(t,qV.RETRANSMIT,e.bitrate.retransmit),rF(t,qV.TARGET_ENCODED,e.bitrate.targetEncoded),rF(t,qV.ACTUAL_ENCODED,e.bitrate.actualEncoded),rF(t,qV.TRANSMIT,e.bitrate.transmit),rF(t,qV.BANDWIDTH,e.sendBandwidth),t}(e);o=Object.assign({},r,i,a)}else a=n?void 0:function(e,t,n){const r=t.videoSend.find(t=>t.ssrc===e);if(!r)return;const i={},o=r.sentFrame;if(o&&(rF(i,zV.HEIGHT,o.height),rF(i,zV.WIDTH,o.width),rF(i,zV.FRAME_RATE,o.frameRate)),n){const t=n.videoSend.find(t=>t.ssrc===e);if(t){let e=iF*nF;t.timestamp&&r.timestamp&&(e=r.timestamp-t.timestamp),null!=t.packets&&null!=r.packets&&rF(i,zV.PACKAGE_RATE,1e3*(r.packets-t.packets)/e),null!=r.packetsLost&&null!=t.packetsLost&&rF(i,zV.PACKAGE_LOST,r.packetsLost-t.packetsLost),null!=t.bytes&&null!=r.bytes&&rF(i,zV.BITRATE,8*(r.bytes-t.bytes)/e)}}return i}(u[0].ssrcId,e,t);break;case hO.LocalAudioTrack:i=n?void 0:function(e,t,n,r){const i=t.audioSend.find(t=>t.ssrc===e);if(!i)return;const o={};o[ZV.DISABLED]=r._originMediaStreamTrack&&!r._originMediaStreamTrack.enabled||r._mediaStreamTrack&&!r._mediaStreamTrack.enabled?1:0;const a=100*r._source.getAccurateVolumeLevel(),s=i.inputLevel;if(null!=s){const e=Math.ceil(50*Math.log10(100*s+1));rF(o,ZV.LEVEL,e)}else rF(o,ZV.LEVEL,a);rF(o,QV.PCM_LEVEL,a),rF(o,ZV.AEC_RETURN_LOSS,i.aecReturnLoss),rF(o,ZV.AEC_RETURN_LOSS_ENH,i.aecReturnLossEnhancement),o[ZV.FREEZE]=0;const c=n&&n.audioSend.find(t=>t.ssrc===e);if(c){let e=iF*nF;c.timestamp&&i.timestamp&&(e=i.timestamp-c.timestamp),null!=c.bytes&&null!=i.bytes&&rF(o,ZV.BITRATE,8*(i.bytes-c.bytes)/e),null!=c.packets&&null!=i.packets&&rF(o,ZV.PACKAGE_RATE,1e3*(i.packets-c.packets)/e)}return o}(u[0].ssrcId,e,t,c)}}),{high:o,low:a,audio:i}}getInboundStats(e,t,n){if(!this.requestRemoteMedia)return;const r=this.requestRemoteMedia()||[],i=[];return r.forEach(r=>{let[o,a]=r;const s={peer:o.uid};if(a.has(dO.VIDEO)&&o.videoTrack){const r=o._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(o._videoSSRC)||!1,i=o.videoTrack?function(e,t,n,r,i,o,a){var s;const c=t.videoRecv.find(t=>t.ssrc===e);if(!c)return;const u={},{receivedFrame:l,outputFrame:d,decodeFrameRate:h}=c,p=n&&n.videoRecv.find(t=>t.ssrc===e);if(u[JV.FREEZE]=i&&DF.isRemoteVideoFreeze(r,c,p)?1:0,rF(u,XV.FRAME_RATE_DECODE,h),rF(u,JV.QP_SUM,c.qpSumPerFrame),c.framesRateFirefox&&rF(u,JV.FRAME_RATE,c.framesRateFirefox),l&&rF(u,JV.FRAME_RATE,l.frameRate),p){const e=t.timestamp-n.timestamp||(a?iF:nF*iF);null!=c.packetsLost&&null!=p.packetsLost&&rF(u,JV.PACKAGE_LOST,c.packetsLost-p.packetsLost),null!=p.bytes&&null!=c.bytes&&rF(u,JV.BITRATE,8*(c.bytes-p.bytes)/e),null!=p.packets&&null!=c.packets&&rF(u,JV.PACKAGE_RATE,1e3*(c.packets-p.packets)/e)}if(a)return u;l?(rF(u,JV.HEIGHT,l.height),rF(u,JV.WIDTH,l.width)):r&&(rF(u,JV.HEIGHT,r._videoHeight||0),rF(u,JV.WIDTH,r._videoWidth||0)),d&&rF(u,XV.FRAME_RATE_OUTPUT,d.frameRate);const f=null===(s=r._player)||void 0===s?void 0:s.rendFrameRate.toFixed(0);if(f&&rF(u,XV.FRAME_RATE_RENDER,+f),rF(u,JV.JITTER_BUFFER,c.jitterBufferMs),rF(u,JV.CURRENT_DELAY,c.currentDelayMs),rF(u,JV.FIRS,c.firsCount),rF(u,JV.NACKS,c.nacksCount),rF(u,JV.PLIS,c.plisCount),r){u[JV.DISABLED]=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?0:1;const e=r._player;if(e){const{freezeTimeCounterList:t,renderFreezeAccTime:n,videoElementStatus:r}=e;if(t&&t.length>0&&rF(u,XV.FREEZE_TIME,t.splice(0,1)[0]),o&&"visible"===yU.visibility&&r===ML.PLAYING&&ZP().supportRequestVideoFrameCallback){const t=Math.min(6e3,n);e.renderFreezeAccTime=Math.max(0,n-t),rF(u,XV.FREEZE_TIME_RENDER,t)}"number"==typeof c.totalFreezesDuration&&rF(u,XV.FREEZE_DURATION,1e3*(p&&p.totalFreezesDuration?c.totalFreezesDuration-p.totalFreezesDuration:c.totalFreezesDuration))}}if(u[JV.PLAYER_STATUS]=xL[r._player?r._player.videoElementStatus:"uninit"],p&&void 0!==c.totalInterFrameDelay&&void 0!==c.totalSquaredInterFrameDelay&&void 0!==p.totalInterFrameDelay&&void 0!==p.totalSquaredInterFrameDelay){const e=c.totalInterFrameDelay-p.totalInterFrameDelay,t=c.framesDecodeCount-p.framesDecodeCount,n=e/t*1e3,r=Math.round(1e3*Math.sqrt((c.totalSquaredInterFrameDelay-p.totalSquaredInterFrameDelay-Math.pow(e,2)/t)/t));!isNaN(r)&&n+r>Math.max(3*n,n+150)&&(u[JV.I_FRAME_DELAY]=r)}return u}(o._videoSSRC,e,t,o.videoTrack,!0===r,this.needUploadRenderFreezeTime,n):void 0;i&&(s.video=i)}if(a.has(dO.AUDIO)&&o.audioTrack){const r=o.audioTrack?function(e,t,n,r,i){const o=t.audioRecv.find(t=>t.ssrc===e);if(!o)return;const a={},s=n&&n.audioRecv.find(t=>t.ssrc===e),{receivedFrames:c,droppedFrames:u}=o;var l;if(rF(a,$V.JITTER,o.jitterMs),null!=c&&null!=u&&(a[$V.FREEZE]=0===(l=c)||100*u/l>20?1:0),s){const e=t.timestamp-n.timestamp||(i?iF:iF*nF);null!=o.packets&&null!=s.packets&&rF(a,$V.PACKAGE_RATE,1e3*(o.packets-s.packets)/e),null!=s.bytes&&null!=o.bytes&&rF(a,$V.BITRATE,8*(o.bytes-s.bytes)/e),null!=o.packetsLost&&null!=s.packetsLost&&rF(a,$V.PACKAGE_LOST,o.packetsLost-s.packetsLost)}if(i)return a;const d=100*r._source.getAccurateVolumeLevel(),h=o.outputLevel;if(null!=h){const e=Math.ceil(50*Math.log10(100*h+1));rF(a,eF.LEVEL,e)}if(rF(a,$V.PCM_LEVEL,d),r&&(a[$V.DISABLED]=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?0:1),rF(a,$V.JITTER_BUFFER,o.jitterBufferMs),rF(a,$V.CURRENT_DELAY,o.jitterBufferMs),a[$V.PLAYER_STATUS]=xL[mk.getPlayerState(r.getTrackId())],s){const e=o.concealedSamples-s.concealedSamples;e>0&&rF(a,$V.CONCEALED_SAMPLES,e)}return a}(o._audioSSRC,e,t,o.audioTrack,n):void 0;r&&(s.audio=r)}(s.video||s.audio)&&i.push(s)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,i}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(e=>e instanceof SM);if(e&&e._external.getDenoiserStats){const t=e._external.getDenoiserStats();t&&this.requestUpload(Lw.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{this.requestAllTracks&&this.requestUpload&&this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{this.requestUpload&&this.requestRemoteMedia&&(this.requestRemoteMedia()||[]).forEach(e=>{let[t,n]=e;n.has(dO.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)}),n.has(dO.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(e=>{this.requestUpload&&this.requestUpload(e.type,e.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const t=Date.now(),n={connectionInterval:XA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t};let r=[];const i=this.requestAllTracks&&this.requestAllTracks()||[];for(const e of i)!e.muted&&e.enabled&&(r=r.concat(await e.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[e,t]of o)t.has(dO.VIDEO)&&e.videoTrack&&(r=r.concat(await e.videoTrack.getProcessorUsage())),t.has(dO.AUDIO)&&e.audioTrack&&(r=r.concat(await e.audioTrack.getProcessorUsage()));if(0===r.length)return;n.details=function(e,t){const n={};for(const{id:a,value:s,level:c,direction:u}of e){var r;const e=null!==(r=t.get(a))&&void 0!==r?r:0,l=2===s?e+XA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,o;t.set(a,l),n[a]?(2===s&&(n[a].value=s),c>n[a].level&&(n[a].level=c),"remote"===u&&(n[a].remoteUidCount+=1),n[a].totalTs=null!==(i=t.get(a))&&void 0!==i?i:0):n[a]={value:s,level:c,remoteUidCount:"local"===u?0:1,totalTs:null!==(o=t.get(a))&&void 0!==o?o:0}}return Object.keys(n).map(e=>{const{level:t,value:r,totalTs:i}=n[e];return{id:e,level:t,value:r,totalTs:i}})}(r,e);const a=Date.now();this.requestUpload&&this.requestUpload(Lw.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:a>t?a:t+1})},XA("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class cF{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){Fg(this,"uid",void 0),Fg(this,"_uintid",void 0),Fg(this,"_trust_in_room_",!0),Fg(this,"_trust_audio_enabled_state_",!0),Fg(this,"_trust_video_enabled_state_",!0),Fg(this,"_trust_audio_mute_state_",!0),Fg(this,"_trust_video_mute_state_",!0),Fg(this,"_audio_muted_",!1),Fg(this,"_video_muted_",!1),Fg(this,"_audio_enabled_",!0),Fg(this,"_video_enabled_",!0),Fg(this,"_audio_added_",!1),Fg(this,"_video_added_",!1),Fg(this,"_is_pre_created",!1),Fg(this,"_video_pre_subscribed",!1),Fg(this,"_audio_pre_subscribed",!1),Fg(this,"_trust_video_stream_added_state_",!0),Fg(this,"_trust_audio_stream_added_state_",!0),Fg(this,"_audioTrack",void 0),Fg(this,"_videoTrack",void 0),Fg(this,"_dataChannels",[]),Fg(this,"_audioSSRC",void 0),Fg(this,"_videoSSRC",void 0),Fg(this,"_audioOrtc",void 0),Fg(this,"_videoOrtc",void 0),Fg(this,"_cname",void 0),Fg(this,"_rtxSsrcId",void 0),Fg(this,"_videoMid",void 0),Fg(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}let dF=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});function lF(e,t){var n;let r;switch(t){case hO.LocalAudioTrack:r=Zw.Audio;break;case hO.LocalVideoTrack:r=Dn(n=e._hints).call(n,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:r=Zw.Low}return r}function uF(e){const t=ZP();if(e.some(e=>e._bypassWebAudio))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function hF(e,t){uF(e);const n=t||new RM;return e.forEach(e=>n.addAudioTrack(e)),n}var pF,_F,EF,fF,mF,TF,SF,gF,RF,CF,IF,vF;function yF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function AF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yF(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let bF=(pF=wF(dF.SEND_ONLY),_F=wF(dF.SEND_ONLY),EF=wF(),fF=wF(dF.RECEIVE_ONLY),mF=wF(dF.RECEIVE_ONLY),TF=wF(dF.RECEIVE_ONLY),SF=wF(dF.RECEIVE_ONLY),gF=wF(dF.RECEIVE_ONLY),RF=wF(dF.RECEIVE_ONLY),CF=wF(),IF=wF(dF.RECEIVE_ONLY),vF=class extends xy{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(_O.StateChange,t,this._state)}constructor(e,t){super(),Fg(this,"isPlanB",!1),Fg(this,"store",void 0),Fg(this,"statsUploader",void 0),Fg(this,"sendConnection",void 0),Fg(this,"recvConnection",void 0),Fg(this,"localTrackMap",new Map),Fg(this,"remoteUserMap",new Map),Fg(this,"localDataChannels",[]),Fg(this,"pendingLocalTracks",[]),Fg(this,"pendingRemoteTracks",[]),Fg(this,"statsCollector",void 0),Fg(this,"dtlsFailedCount",0),Fg(this,"sendMutex",new NA("P2PChannel2-send-mutex")),Fg(this,"recvMutex",new NA("P2PChannel2-recv-mutex")),Fg(this,"_state",pO.Disconnected),Fg(this,"_restartStates",["disconnected","failed"]),Fg(this,"reconnectInterval",void 0),Fg(this,"uploadUnplinkStarted",!1),Fg(this,"uploadDownlinkStarted",!1),Fg(this,"uplinkStateUploadInterval",void 0),Fg(this,"downlinkStatsUploadInterval",void 0),Fg(this,"handleMuteLocalTrack",async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==pO.Connected)return void n(new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const a=r.find(e=>"videoLowTrack"===e[0]);a&&a[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(r.map(e=>{let[,{id:t}]=e;return t}));let s=!1;var i,o;s="video"===e.trackMediaType?!(null===(i=this.localTrackMap.get(hO.LocalAudioTrack))||void 0===i||!i.track._muted):void 0===(null===(o=this.localTrackMap.get(hO.LocalVideoTrack))||void 0===o?void 0:o.id);const c=this.createMuteMessage(r);await $y(this,_O.RequestMuteLocal,c);const u="video"===e.trackMediaType?yO.MUTE_LOCAL_VIDEO:yO.MUTE_LOCAL_AUDIO;await $y(this,_O.RequestP2PMuteLocal,{action:u,message:c,isMuteAll:s}),t()}catch(e){n(e)}finally{r()}}),Fg(this,"handleUnmuteLocalTrack",async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==pO.Connected)return void n(new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();await this.sendConnection.unmuteLocal(r.map(e=>{let[,{id:t}]=e;return t}));const i=this.createUnmuteMessage(r),o="video"===e.trackMediaType?yO.UNMUTE_LOCAL_VIDEO:yO.UNMUTE_LOCAL_AUDIO;await $y(this,_O.RequestP2PMuteLocal,{action:o,message:i}),t()}catch(e){n(e)}finally{r()}}),Fg(this,"handleUpdateVideoEncoder",async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const n=this.localTrackMap.get(hO.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==pO.Connected)return void t();const{id:r,track:i}=n;r&&(await this.sendConnection.updateSendParameters(r,i),await this.sendConnection.updateEncoderConfig(r,i),this.emit(_O.UpdateVideoEncoder,i)),t()}catch(e){n(e)}finally{r()}}),Fg(this,"handleUpdateVideoSendParameters",async(e,t,n)=>{const r=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(hO.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==e||this.state!==pO.Connected)return void t();const{id:r,track:i}=n;r&&await this.sendConnection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}}),Fg(this,"handleReplaceTrack",async(e,t,n,r)=>{let i;fb.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!this.sendConnection||!n||void 0===n[1].id||this.state!==pO.Connected)return void t();if(await(null===(o=this.sendConnection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),n[0]===hO.LocalVideoTrack&&ZP().supportDualStreamEncoding){const t=this.localTrackMap.get(hO.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new Gh((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}t()}catch(e){n(e)}finally{var a;null===(a=i)||void 0===a||a()}}),Fg(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),Fg(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),Fg(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),Fg(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new aF(e),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(e=>{e&&("disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))})},XA("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(fb.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new WV(e,this.store,Mw.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(t);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=pO.New,this.sendConnection&&(fb.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new WV(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const t=await this.sendConnection.establish();return{iceParameters:t.iceParameters,dtlsParameters:t.dtlsParameters,sdp:t.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=pO.Connected}async addRemoteCandidate(e,t){if(t===Mw.RECEIVE_ONLY){if(!this.sendConnection)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var r=this;return YI(function*(){const i=yield qI(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==pO.Connected){r.throwIfTrackTypeNotMatch(e);const t=e.filter(e=>-1===r.pendingLocalTracks.indexOf(e));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,rV.markPublishStart(r.store.clientId,r.store.pubId);const i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield qI(r.tryToUnmuteAudio(e)));i.forEach(e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===hO.LocalAudioTrack?"audio":"video",i)}),r.bindLocalTrackEvents(i);const o=yield qI(r.sendConnection.send(i.map(e=>{let{track:t}=e;return t}),r.store.codec,r.store.audioCodec)),a=(yield qI(o.next())).value,s=r.createGatewayPublishMessage(i,a);try{yield s}catch(e){throw o.throw(e),(null==e?void 0:e.code)===Ry.WS_ABORT&&i.forEach(e=>{let{track:t}=e;-1===r.pendingLocalTracks.indexOf(t)&&r.pendingLocalTracks.push(t)}),r.unbindLocalTrackEvents(i),e}yield qI(o.next()),i.forEach(e=>{let{type:t}=e;r.statsCollector.addLocalStats(t)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(i,a),i.forEach(e=>{let{track:t,type:n}=e;const i=Date.now();r.store.publish(t.getTrackId(),n===hO.LocalAudioTrack?"audio":"video",void 0,i)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==pO.Connected)return void(0===e.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(t=>!Dn(e).call(e,t)));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find(e=>"videoLowTrack"===e[0]);n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:n}]=e;return{type:t,track:n}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===pO.Connected)return n&&n[1].track.close(),r;e.forEach(e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const e=[],t=[];Array.from(this.localTrackMap.entries()).forEach(n=>{let[r,{track:i,ssrcs:o}]=n;const a={stream_type:lF(i,r),ssrcs:o};i._muted||!i._enabled?e.push(a):t.push(a)}),e.length>0&&e.forEach(e=>{$y(this,_O.RequestMuteLocal,[e])}),t.length>0&&t.forEach(e=>{$y(this,_O.RequestUnmuteLocal,[e])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return YI(function*(){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(fb.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Zy(this,_O.RequestRePublish,this.pendingLocalTracks),this.emit(_O.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,r){var i;if(!this.recvConnection)throw new Cy(Ry.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(i=this.remoteUserMap.get(e))&&void 0!==i&&i.has(t))return;const{track:o,mid:a,transceiver:s}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),r);t===dO.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new vU(o,e.uid,e._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),s&&e._audioTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new IU(o,e.uid,e._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),s&&e._videoTrack._updateRtpTransceiver(s),this.bindRemoteTrackEvents(e,e._videoTrack));const c=this.remoteUserMap.get(e);c?c.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const u=this.pendingRemoteTracks.findIndex(n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i});-1!==u&&(this.pendingRemoteTracks.splice(u,1),this.emit(_O.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,r){if(!this.recvConnection)throw new Cy(Ry.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),r)}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid});if(r.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.recvConnection||n||r.forEach(t=>{let{kind:n}=t;var r;if(n===dO.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===dO.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(e,t);0!==i.length&&(await this.recvConnection.stopReceiving(i.map(e=>{let[,{id:t}]=e;return t})),this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(e=>{let[t,{kind:r}]=e;var i,o;if(r===dO.VIDEO&&t._videoSSRC&&(null===(i=this.recvConnection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===dO.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===dO.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}}),i.forEach(e=>{let[,{kind:t}]=e;$y(this,_O.RequestP2PMuteRemote,t)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,t]=e;[dO.VIDEO,dO.AUDIO].forEach(e=>{t.has(e)?$y(this,_O.RequestP2PUnmuteRemote,e):$y(this,_O.RequestP2PMuteRemote,e)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void fb.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void fb.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===dO.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||fb.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):fb.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(hO.LocalAudioTrack);if((null==t?void 0:t.track)instanceof RM){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==hO.LocalAudioTrack}).filter(t=>{let[n]=t;return!(e&&n===hO.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[n]=t;return!(e&&n===hO.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(hO.LocalAudioTrack),o=this.localTrackMap.get(r?hO.LocalVideoLowTrack:hO.LocalVideoTrack);vb.publish(this.store.sessionId,{eventElapse:rV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(mL.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const a=n.find(e=>e instanceof TM),s=r?null===(o=this.localTrackMap.get(hO.LocalVideoTrack))||void 0===o?void 0:o.track:n.find(e=>e instanceof aU);vb.publish(this.store.sessionId,{eventElapse:rV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==s?void 0:s.getTrackLabel(),screenshare:-1!==(null==s?void 0:s._hints.indexOf(mL.SCREEN_TRACK)),audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===dO.VIDEO?n._videoSSRC:n._audioSSRC;i&&vb.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===dO.VIDEO,audio:r===dO.AUDIO,peerid:n.uid,subscribeRequestid:r===dO.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:rV.measureFromSubscribeStart(this.store.clientId,i)})}reset(){fb.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new NA("P2PChannel2-send-mutex"),this.sendMutex=new NA("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(hO.LocalAudioTrack);if((null==e?void 0:e.track)instanceof RM){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=pO.Disconnected}getStats(e){var t,n;return e?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(t=this.sendConnection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.recvConnection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(hO.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(hO.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof aU||t&&t.track instanceof TM?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(d_(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(hO.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=aE(e).call(e,(e,t)=>e.level-t.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(fb.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=pO.Reconnecting,XA("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case hO.LocalVideoTrack:Dn(t=r._hints).call(t,mL.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case hO.LocalAudioTrack:r instanceof RM?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r)}}),this.emit(_O.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(d_(n).call(n)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(_O.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),fb.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof cF?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,r;if(e===Mw.SEND_ONLY){if(!this.sendConnection)throw new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(t){const e=await r.restartICE(t);return r.isInRestartIce=!1,e}{const e=await r.restartICE();if(e){const t=await Zy(this,_O.RequestP2PRestartICE,{direction:Mw.RECEIVE_ONLY,iceParameter:e});await r.restartICE(t),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(hO.LocalVideoTrack),n=this.localTrackMap.get(hO.LocalAudioTrack),r=e.videoSend.find(e=>{var n;return e.ssrc===(null==t||null===(n=t.ssrcs)||void 0===n?void 0:n[0].ssrcId)}),i=e.audioSend.find(e=>{var t;return e.ssrc===(null==n||null===(t=n.ssrcs)||void 0===t?void 0:t[0].ssrcId)});if(!r||!i)return 1;const o=eA(this,_O.NeedSignalRTT),a=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=a&&s?(a+s)/2:a||s,u=100*e.sendPacketLossRate*.7/50+.3*((c&&o?(c+o)/2:c||o)||0)/1500,l=u<.17?1:u<.36?2:u<.59?3:u<.1?4:5,d=null==t?void 0:t.track;if(d&&d._encoderConfig&&-1===d._hints.indexOf(mL.SCREEN_TRACK)){const t=d._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return bb[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][l]}}return l}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===i),s=e.videoRecv.find(e=>e.ssrc===o);if(!a&&!s)return void(t+=1);const c=eA(this,_O.NeedSignalRTT),u=e.rtt,l=(u&&c?(u+c)/2:u||c)||0,d=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*l/1500;d&&(p=.6*h*100/50+.2*l/1500+.2*d/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Gh((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],i=ZP(),o=this.getAllTracks();e=rA(e=e.filter(e=>-1===o.indexOf(e)));let a=!1,s=!1;for(const o of e){if(o instanceof aU&&(this.localTrackMap.has(hO.LocalVideoTrack)||a?new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:o,type:hO.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(o,n);r.push({track:e,type:hO.LocalVideoLowTrack})}if(o instanceof TM){const e=this.localTrackMap.get(hO.LocalAudioTrack);if(e){if(!(e.track instanceof RM))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(o._bypassWebAudio)throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(o),this.bindLocalAudioTrackEvents(o,!0)}else if(s){const e=r.find(e=>{let{type:t}=e;return t===hO.LocalAudioTrack});if(!(e.track instanceof RM))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(o._bypassWebAudio)throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(o)}else{if(!i.webAudioMediaStreamDest||o instanceof RM||o._bypassWebAudio)r.push({track:o,type:hO.LocalAudioTrack});else{const e=new RM;e.addAudioTrack(o),r.push({track:e,type:hO.LocalAudioTrack})}s=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=rA(e=e.filter(e=>-1!==n.indexOf(e)));for(const n of e){if(n instanceof TM){const e=this.localTrackMap.get(hO.LocalAudioTrack);if(!e)continue;e.track instanceof RM?(e.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),0===e.track.trackList.length&&(t.push([hO.LocalAudioTrack,e]),e.track.close())):t.push([hO.LocalAudioTrack,e])}if(n instanceof aU){const e=this.localTrackMap.get(hO.LocalVideoTrack);if(!e)continue;t.push([hO.LocalVideoTrack,e]);const n=this.localTrackMap.get(hO.LocalVideoLowTrack);n&&t.push([hO.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:n}=e;switch(n){case hO.LocalVideoTrack:t.addListener(fL.GET_STATS,this.handleGetLocalVideoStats),t.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(fL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(fL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO.LocalAudioTrack:this.bindLocalAudioTrackEvents(t)}})}bindLocalAudioTrackEvents(e,t){e instanceof RM?e.trackList.forEach(e=>{e.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(fL.GET_STATS,this.handleGetLocalAudioStats),e.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(fL.GET_STATS,this.handleGetLocalAudioStats),e.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:n}]=e;return{track:n,type:t}})),e.forEach(e=>{let{track:t,type:n}=e;switch(n){case hO.LocalVideoTrack:t.off(fL.GET_STATS,this.handleGetLocalVideoStats),t.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(fL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(fL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t)}})}unbindLocalAudioTrackEvents(e){e instanceof RM?e.trackList.forEach(e=>{e.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(fL.GET_STATS,this.handleGetLocalAudioStats),e.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(fL.GET_STATS,this.handleGetLocalAudioStats),e.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof IU&&t.addListener(fL.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof vU&&t.addListener(fL.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(fL.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(dO.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(dO.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,n)=>{var r;let i,{track:o,type:a}=e;switch(a){case hO.LocalAudioTrack:i=Zw.Audio;break;case hO.LocalVideoTrack:i=Dn(r=o._hints).call(r,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:i=Zw.Low}return{kind:a===hO.LocalAudioTrack?dO.AUDIO:dO.VIDEO,stream_type:i,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:o.muted||!o.enabled}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case hO.LocalVideoTrack:n=Dn(t=i._hints).call(t,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalAudioTrack:n=Zw.Audio;break;case hO.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:o,mid:a}})}assignLocalTracks(e,t){e.forEach((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(_O.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(e.isInRestartIce=!1),Dn(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&("disconnected"===t&&await mA(800),"disconnected"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),vb.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:jy.TRACER}).onSuccess(),this.emit(_O.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(d_(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(IL.FIRST_FRAME_DECODED),vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_AUDIO_DECODE,Rb.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(d_(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);n&&vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_AUDIO_RECEIVED,Rb.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(d_(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);n&&vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_VIDEO_RECEIVED,Rb.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType;"unknown"!==t.candidateType&&n===("relay"===t.candidateType)||this.emit(_O.ConnectionTypeChange,n),fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(nN(t))," -> ").concat(JSON.stringify(nN(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(nN(t))," -> ").concat(JSON.stringify(nN(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(_O.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Mw.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,fb.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Mw.SEND_ONLY?this.restartICE(e):Zy(this,_O.RequestP2PRestartICE,{direction:Mw.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(hO.LocalAudioTrack);if(e instanceof TM&&(null==n?void 0:n.track)instanceof RM)return n.track.isActive||t.push([hO.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(r&&(t.push(r),r[0]===hO.LocalVideoTrack)){const e=this.localTrackMap.get(hO.LocalVideoLowTrack);e&&t.push([hO.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(hO.LocalAudioTrack);if(e instanceof TM&&(null==n?void 0:n.track)instanceof RM)return n.track.isActive&&t.push([hO.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(r)if(r[0]===hO.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(hO.LocalVideoLowTrack);e&&t.push([hO.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case hO.LocalAudioTrack:n=Zw.Audio;break;case hO.LocalVideoTrack:n=Dn(t=i._hints).call(t,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:o,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case hO.LocalAudioTrack:n=Zw.Audio;break;case hO.LocalVideoTrack:n=Dn(t=i._hints).call(t,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:o,mid:a}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(e=>{let[n,{kind:r}]=e;switch(r){case dO.VIDEO:return void(n._videoSSRC&&t.push({stream_type:dO.VIDEO,ssrcId:n._videoSSRC}));case dO.AUDIO:return void(n._audioSSRC&&t.push({stream_type:dO.AUDIO,ssrcId:n._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(hO.LocalVideoTrack),n=this.localTrackMap.get(hO.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return!this.sendConnection||!this.recvConnection||"connected"!==this.sendConnection.peerConnectionState&&"connected"!==this.recvConnection.peerConnectionState}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof TM){const n=this.filterTobeUnmutedTracks(e[t]);if(0===n.length)continue;const r=this.createUnmuteMessage(n);return void await $y(this,_O.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.recvConnection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(_O.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(_O.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await mA(LA(this.dtlsFailedCount,PA)),this.emit(_O.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(hO.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof aU)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof aU).length>1)throw new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof TM).length>1&&(e.some(e=>e instanceof TM&&e._bypassWebAudio)||!ZP().webAudioMediaStreamDest))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof aU&&this.pendingLocalTracks.some(e=>e instanceof aU))throw new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof TM&&this.pendingLocalTracks.some(e=>e instanceof TM)&&(!ZP().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof TM&&e._bypassWebAudio)))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding,r=AF(AF({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():KV(e,r);const o=TA(8,"track-low-"),a=new aU(i,AF(AF({},n&&{scaleResolutionDownBy:iN(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return a.on(RL.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,TL.LOW_STREAM)}),a._hints.push(mL.LOW_STREAM),e.addListener(fL.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(d_(i=this.remoteUserMap).call(i)).find(t=>t._videoSSRC===e);if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,a=i.subscribe.find(e=>e.userId===o.uid&&"video"===e.type);vb.firstRemoteVideoDecode(this.store.sessionId,gb.FIRST_VIDEO_DECODE,Rb.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.recvConnection.getRemoteSSRC(i);return void 0!==o&&o!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Cy(Ry.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Cy(Ry.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Cy(Ry.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Cy(Ry.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Cy(Ry.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Cy(Ry.NOT_SUPPORTED)}async preConnect(e){throw new Cy(Ry.NOT_SUPPORTED)}getEstablishParams(){throw new Cy(Ry.NOT_SUPPORTED)}async reSubscribe(e){throw new Cy(Ry.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new Cy(Ry.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===hO.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,TL.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Cw(vF.prototype,"p2pConnect",[pF],Object.getOwnPropertyDescriptor(vF.prototype,"p2pConnect"),vF.prototype),Cw(vF.prototype,"unpublish",[_F],Object.getOwnPropertyDescriptor(vF.prototype,"unpublish"),vF.prototype),Cw(vF.prototype,"unpublishLowStream",[EF],Object.getOwnPropertyDescriptor(vF.prototype,"unpublishLowStream"),vF.prototype),Cw(vF.prototype,"subscribe",[fF],Object.getOwnPropertyDescriptor(vF.prototype,"subscribe"),vF.prototype),Cw(vF.prototype,"mockSubscribe",[mF],Object.getOwnPropertyDescriptor(vF.prototype,"mockSubscribe"),vF.prototype),Cw(vF.prototype,"unsubscribe",[TF],Object.getOwnPropertyDescriptor(vF.prototype,"unsubscribe"),vF.prototype),Cw(vF.prototype,"muteRemote",[SF],Object.getOwnPropertyDescriptor(vF.prototype,"muteRemote"),vF.prototype),Cw(vF.prototype,"unmuteRemote",[gF],Object.getOwnPropertyDescriptor(vF.prototype,"unmuteRemote"),vF.prototype),Cw(vF.prototype,"hasRemoteMediaWithLock",[RF],Object.getOwnPropertyDescriptor(vF.prototype,"hasRemoteMediaWithLock"),vF.prototype),Cw(vF.prototype,"disconnectForReconnect",[CF],Object.getOwnPropertyDescriptor(vF.prototype,"disconnectForReconnect"),vF.prototype),Cw(vF.prototype,"remoteMediaSsrcChanged",[IF],Object.getOwnPropertyDescriptor(vF.prototype,"remoteMediaSsrcChanged"),vF.prototype),vF);function wF(e){return function(t,n,r){const i=t[n];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];switch(e){case dF.SEND_ONLY:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}case dF.RECEIVE_ONLY:{const e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e()}}default:{const e=await this.sendMutex.lock("From P2PChannel2.".concat(n)),t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,r)}finally{e(),t()}}}},r}}function OF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function NF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?OF(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):OF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class DF{constructor(e){Fg(this,"store",void 0),Fg(this,"onStatsException",void 0),Fg(this,"onUploadPublishDuration",void 0),Fg(this,"onStatsChanged",void 0),Fg(this,"localStats",new Map),Fg(this,"remoteStats",new Map),Fg(this,"updateStatsInterval",void 0),Fg(this,"trafficStats",void 0),Fg(this,"trafficStatsPeerList",[]),Fg(this,"uplinkStats",void 0),Fg(this,"exceptionMonitor",void 0),Fg(this,"p2pChannel",void 0),Fg(this,"scalabilityMode",Iw.L1T1),Fg(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new iV,this.exceptionMonitor.on("exception",(e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(hO.LocalAudioTrack)||NF({},AL)}getLocalVideoTrackStats(){return this.localStats.get(hO.LocalVideoTrack)||NF({},bL)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[r,{audioStats:i}]=e;i&&(n[r]=t(r,i))});return n}getRemoteNetworkQualityStats(e){const t={};if(e){var n;const r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach(e=>{let[n,{networkStats:r}]=e;r&&(t[n]=r)});return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find(t=>t.peer_uid===e);return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach(e=>{let[r,{videoStats:i}]=e;i&&(n[r]=t(r,i))});return n}getRTCStats(){let e=0,t=0,n=0,r=0;const i=this.localStats.get(hO.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);const o=this.localStats.get(hO.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);const a=this.localStats.get(hO.LocalVideoLowTrack);a&&(e+=a.sendBytes,t+=a.sendBitrate),this.remoteStats.forEach(e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)});let s=1;return this.trafficStats&&(s+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:s,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(e=>void 0!==e.B_ppad||void 0!==e.B_ppvd),e.peer_delay.filter(e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid)).forEach(e=>{var t;const n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),r=null!=n&&n.videoSSRC?rV.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?rV.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>i?r:i),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&fb.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){return!!e&&(!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime||!(!n||t.framesDecodeCount>n.framesDecodeCount))}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(t=>{let[n,r]=t;switch(n){case hO.LocalVideoTrack:case hO.LocalVideoLowTrack:{const t=r,o=NF({},bL),a=e.getStats(),s=e.getLocalMedia(n);if(a){const n=a.videoSend.find(e=>e.ssrc===(null==s?void 0:s.ssrcs[0].ssrcId));if(n){const r=e.getLocalVideoSize(),i=e.getEncoderConfig(hO.LocalVideoTrack);"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(o.codecType=n.codec),o.sendBytes=n.bytes,o.sendBitrate=t?8*Math.max(0,o.sendBytes-t.sendBytes):0,n.inputFrame?(o.captureFrameRate=n.inputFrame.frameRate,o.captureResolutionHeight=n.inputFrame.height,o.captureResolutionWidth=n.inputFrame.width):r&&(o.captureResolutionWidth=r.width,o.captureResolutionHeight=r.height),n.sentFrame?(o.sendFrameRate=n.sentFrame.frameRate,o.sendResolutionHeight=n.sentFrame.height,o.sendResolutionWidth=n.sentFrame.width):r&&(o.sendResolutionWidth=r.width,o.sendResolutionHeight=r.height),n.avgEncodeMs&&(o.encodeDelay=n.avgEncodeMs),i&&i.bitrateMax&&(o.targetSendBitrate=1e3*i.bitrateMax),o.sendPackets=n.packets,o.sendPacketsLost=n.packetsLost,o.sendJitterMs=n.jitterMs,o.sendRttMs=n.rttMs,o.totalDuration=t?t.totalDuration+1:1,o.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(o.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(fb.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(o.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var i;this.localStats.set(n,o),((null==t?void 0:t.sendResolutionWidth)!==o.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==o.sendResolutionHeight)&&(null===(i=this.onStatsChanged)||void 0===i||i.call(this,"resolution",{width:o.sendResolutionWidth,height:o.sendResolutionHeight})),o&&s&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,s.track,o);break}case hO.LocalAudioTrack:{const t=r,i=NF({},AL),o=e.getStats(),a=e.getLocalMedia(n);if(o){const n=o.audioSend.find(e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendJitterMs=n.jitterMs,i.sendRttMs=n.rttMs,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(hO.LocalAudioTrack,i),i&&a&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,a.track,i);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(t=>{var n,r;let[i,{videoStats:o,audioStats:a,videoPcStats:s}]=t;const c=a,u=o,l=s,d=NF({},wL),h=NF({},NL),p=NF({},OL),{audioTrack:f,videoTrack:m,audioSSRC:g,videoSSRC:v}=e.getRemoteMedia(i);let E;E=e instanceof bF?e.getStats(!0):e.getStats();const y=null===(n=E)||void 0===n?void 0:n.audioRecv.find(e=>e.ssrc===g),_=null===(r=E)||void 0===r?void 0:r.videoRecv.find(e=>e.ssrc===v),b=this.trafficStats&&this.trafficStats.peer_delay.find(e=>e.peer_uid===i);if(y&&("opus"!==y.codec&&"aac"!==y.codec&&"PCMU"!==y.codec&&"PCMA"!==y.codec&&"G722"!==y.codec||(d.codecType=y.codec),y.outputLevel?d.receiveLevel=Math.round(32767*y.outputLevel):f&&(d.receiveLevel=Math.round(32767*f.getVolumeLevel())),d.receiveBytes=y.bytes,d.receivePackets=y.packets,d.receivePacketsLost=y.packetsLost,d.receivePacketsDiscarded=y.packetsDiscarded,d.packetLossRate=d.receivePacketsLost/(d.receivePackets+d.receivePacketsLost),d.receiveBitrate=c?8*Math.max(0,d.receiveBytes-c.receiveBytes):0,d.totalDuration=c?c.totalDuration+1:1,d.totalFreezeTime=c?c.totalFreezeTime:0,d.freezeRate=d.totalFreezeTime/d.totalDuration,d.receiveDelay=y.jitterBufferMs,d.totalDuration>10&&DF.isRemoteAudioFreeze(f)&&(d.totalFreezeTime+=1)),_){"H264"!==_.codec&&"H265"!==_.codec&&"VP8"!==_.codec&&"VP9"!==_.codec&&"AV1X"!==_.codec&&"AV1"!==_.codec||(h.codecType=_.codec),h.receiveBytes=_.bytes,h.receiveBitrate=u?8*Math.max(0,h.receiveBytes-u.receiveBytes):0,h.decodeFrameRate=_.decodeFrameRate<0?0:_.decodeFrameRate,h.renderFrameRate=_.decodeFrameRate<0?0:_.decodeFrameRate,_.outputFrame&&(h.renderFrameRate=_.outputFrame.frameRate),_.receivedFrame?(h.receiveFrameRate=_.receivedFrame.frameRate,h.receiveResolutionHeight=_.receivedFrame.height,h.receiveResolutionWidth=_.receivedFrame.width):m&&(h.receiveResolutionHeight=m._videoHeight||0,h.receiveResolutionWidth=m._videoWidth||0),void 0!==_.framesRateFirefox&&(h.receiveFrameRate=Math.round(_.framesRateFirefox)),h.receivePackets=_.packets,h.receivePacketsLost=_.packetsLost,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost),h.totalDuration=u?u.totalDuration+1:1,h.totalFreezeTime=u?u.totalFreezeTime:0,h.receiveDelay=_.jitterBufferMs||0;const t=!!v&&e.getRemoteVideoIsReady(v);m&&t&&DF.isRemoteVideoFreeze(m,_,l)&&(h.totalFreezeTime+=1),h.freezeRate=h.totalFreezeTime/h.totalDuration}b&&(d.end2EndDelay=b.B_ad,h.end2EndDelay=b.B_vd,d.transportDelay=b.B_ed,h.transportDelay=b.B_ed,d.currentPacketLossRate=b.B_ealr4/100,h.currentPacketLossRate=b.B_evlr4/100,p.uplinkNetworkQuality=b.B_punq?b.B_punq:0,p.downlinkNetworkQuality=b.B_pdnq?b.B_pdnq:0),this.remoteStats.set(i,{audioStats:d,videoStats:h,videoPcStats:_,networkStats:p}),f&&this.exceptionMonitor.setRemoteAudioStats(f,d),m&&this.exceptionMonitor.setRemoteVideoStats(m,h)})}}class PF{constructor(){Fg(this,"destChannelMediaInfos",new Map),Fg(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){qw(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){qw(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){xw(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function LF(e){if(!(e instanceof PF))return new yb(Ry.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new yb(Ry.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new yb(Ry.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}function kF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function MF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kF(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var UF;function xF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function VF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xF(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let FF=(UF=class e extends cO{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Dn(t=Object.keys(eb)).call(t,e)}))]}constructor(t,n){super(t,n),Fg(this,"store",void 0),Fg(this,"peerConnection",void 0),Fg(this,"remoteSDP",void 0),Fg(this,"initialOffer",void 0),Fg(this,"statsFilter",void 0),Fg(this,"useRTX",!1),Fg(this,"localCapabilities",void 0),Fg(this,"localCandidateCount",0),Fg(this,"allCandidatesReceived",!1),Fg(this,"establishPromise",void 0),Fg(this,"mutex",new NA("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=xV(this.peerConnection,XA("STATS_UPDATE_INTERVAL"),void 0,Zv()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=HU(e.sdp),n=WU(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:XA("FILTER_VIDEO_FEC"),filterAudioFec:XA("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,VF(VF({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new Cy(Ry.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(e){Fg(this,"sessionDesc",void 0),Fg(this,"localCapabilities",void 0),Fg(this,"rtpCapabilities",void 0),Fg(this,"candidates",void 0),Fg(this,"iceParameters",void 0),Fg(this,"dtlsParameters",void 0),Fg(this,"setup",void 0),Fg(this,"currentMidIndex",void 0),Fg(this,"cname",void 0),e=sA(e);const{iceParameters:t,dtlsParameters:n,candidates:r,rtpCapabilities:i,setup:o,localCapabilities:a,sdkCodec:s,cname:c}=e,u=FU.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=r,this.iceParameters=t,this.dtlsParameters=n,this.setup=o,this.localCapabilities=a,this.cname=c;for(let e=0;e<u.mediaDescriptions.length;e++){const a=u.mediaDescriptions[e];if(a.attributes.iceUfrag=t.iceUfrag,a.attributes.icePwd=t.icePwd,a.attributes.fingerprints=n.fingerprints,a.attributes.candidates=r,a.attributes.setup=o,"video"===a.media.mediaType){a.media.fmts=i.videoCodecs.map(e=>e.payloadType.toString(10));let e=i.videoCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Dn(n=t.encodingName.toLowerCase()).call(n,s)});0===e.length&&(e=i.videoCodecs),a.attributes.payloads=e,a.attributes.extmaps=i.videoExtensions}"audio"===a.media.mediaType&&(a.media.fmts=i.audioCodecs.map(e=>e.payloadType.toString(10)),a.attributes.payloads=i.audioCodecs,a.attributes.extmaps=i.audioExtensions),u.mediaDescriptions[e]=this.mungMediaDesc(a)}this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1}toString(){return FU.print(this.sessionDesc)}send(e,t,n){const{ssrcs:r,ssrcGroups:i}=zU(t,this.cname),o=this.sessionDesc.mediaDescriptions.find(t=>e===dO.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType),a=r[0].attributes.label,s=r[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(r),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(i),{id:a,mslabel:s}}batchSend(e){return e.map(e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(t=>{const n=[],r=[],i=[];t.attributes.ssrcs.forEach(t=>{Dn(e).call(e,t.attributes.label||"")?i.push(t):n.push(t)}),t.attributes.ssrcGroups.forEach(e=>{var t;Dn(t=i.map(e=>e.ssrcId)).call(t,e.ssrcIds[0])||r.push(e)}),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r})}mute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach((e,t)=>{const n=e._mediaStreamTrack,r=this.sessionDesc.mediaDescriptions.findIndex(e=>e.attributes.mid===n.kind),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=i})}stopReceiving(e){}updateCandidates(e){e===lO.TCP?this.candidates.forEach(e=>{-1===this.candidates.findIndex(t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port)&&this.candidates.push(MF(MF({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))}):this.candidates=this.candidates.filter(e=>"tcp"!==e.transport);for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}restartICE(e){e=sA(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){const n=sA(e);return JU(n,t),QU(n,t),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){const r=this.sessionDesc.mediaDescriptions.find(t=>e===dO.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid);if(r){const e=r.attributes.ssrcs.find(e=>e.attributes.label===t);var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){const t=sA(e);return XU(t),function(e){const t=e.attributes.extmaps.find(e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName);t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach(e=>{const t=e.rtcpFeedbacks.findIndex(e=>"transport-cc"===e.type);-1!==t&&e.rtcpFeedbacks.splice(t,1)})}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}(VF(VF({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new Cy(Ry.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var n=this;return YI(function*(){const r=yield qI(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=e.map(e=>n.peerConnection.addTrack(e._mediaStreamTrack)),i=yield qI(n.peerConnection.createOffer()),o=FU.parse(i.sdp),a=e.map(e=>{const t=e._mediaStreamTrack,r=o.mediaDescriptions.find(e=>e.attributes.mid===t.kind);if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){const r=e.attributes.ssrcs.filter(e=>e.attributes.label===t),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){const e=i.find(e=>-1!==e.ssrcIds.indexOf(r[0].ssrcId));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)});let s;try{s=yield a}catch(e){throw r.forEach(e=>{Xv()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)}),e}const c=n.mungSendOfferSDP(i.sdp,e);n.remoteSDP.receive(e,t,s);const u=n.remoteSDP.toString();return yield qI(n.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield qI(n.applySendEncodings(r,e)),yield qI(n.peerConnection.setRemoteDescription({type:"answer",sdp:u})),e.map((e,t)=>({localSSRC:a[t],id:e._mediaStreamTrack.id}))}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{r()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{Xv()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:n,mslabel:i}=this.remoteSDP.send(e,t,r),o=new Gh((t,r)=>{const o=setTimeout(()=>{r(new Error("Cannot receive track, id: ".concat(n)))},1e4),a=r=>{const s=Hv();if(("Safari"===s.name&&11===Number(s.version)||$v())&&r.track.id!==n&&r.streams[0].id===i){var c;const i=r.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,r.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(o),void t(i)}if(r.track.id===n)return this.peerConnection.removeEventListener("track",a),clearTimeout(o),void t(r.track)};this.peerConnection.addEventListener("track",a)}),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),{track:await o,id:n}}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map(e=>{if(Xv()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach(e=>e.active=!1),e.setParameters(t)}})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter(t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")});if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map(async e=>{if(Xv()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach(e=>e.active=!0),await e.setParameters(t)}});const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YI(function*(){const n=yield qI(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ZP().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===lO.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(fb.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===lO.RELAY)return;e!==lO.RELAY&&t.remoteSDP.updateCandidates(e);const n=yield qI(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=HU(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const o=t.remoteSDP.toString();yield qI(t.peerConnection.setLocalDescription(n)),yield qI(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){fb.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}})()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getSenders().filter(t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e});1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getSenders().find(e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t});n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new Cy(Ry.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new Cy(Ry.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,fb.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,fb.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},XA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Ky(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),XA("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find(t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e._mediaStreamTrack.id})),!t)return fb.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!ZP().supportSetRtpSenderParameters)return fb.warn("Browser not support set rtp-sender parameters");const r={},i={};if(e instanceof aU)switch(e._optimizationMode){case"motion":r.degradationPreference="maintain-framerate";break;case"detail":r.degradationPreference="maintain-resolution";break;default:r.degradationPreference="balanced"}if(XA("DSCP_TYPE")&&Ey()){var o;const e=XA("DSCP_TYPE");Dn(o=["very-low","low","medium","high"]).call(o,e)&&(i.networkPriority=e)}const a=t.getParameters(),s=null===(n=a.encodings)||void 0===n?void 0:n[0];s&&Object.assign(s,i),Object.assign(a,r),fb.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await t.setParameters(a)}async applySendEncodings(e,t){try{if(!ZP().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];r&&i&&await this.updateRtpSenderEncodings(i,r)}}catch(e){fb.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const n=FU.parse(e);return t.forEach((e,t)=>{const r=e._mediaStreamTrack,i=n.mediaDescriptions.find(e=>e.attributes.mid===r.kind);i&&JU(i,e)}),FU.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map((t,n)=>{let{id:r,mslabel:i}=t;const{kind:o}=e[n];return new Gh((e,t)=>{const n=setTimeout(()=>{t(new Error("Cannot receive track, id: ".concat(r)))},1e4),a=t=>{const s=Hv();if("Safari"===s.name&&11===Number(s.version)&&t.track.id!==r&&t.streams[0].id===i){var c;const i=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(o,r,t.track.id),this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:i,id:r})}if(t.track.id===r)return this.peerConnection.removeEventListener("track",a),clearTimeout(n),void e({track:t.track,id:r})};this.peerConnection.addEventListener("track",a)})}),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await Gh.all(t)}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(ZP().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Cw(UF.prototype,"connect",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"connect"),UF.prototype),Cw(UF.prototype,"stopSending",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"stopSending"),UF.prototype),Cw(UF.prototype,"receive",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"receive"),UF.prototype),Cw(UF.prototype,"stopReceiving",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"stopReceiving"),UF.prototype),Cw(UF.prototype,"muteRemote",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"muteRemote"),UF.prototype),Cw(UF.prototype,"unmuteRemote",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"unmuteRemote"),UF.prototype),Cw(UF.prototype,"muteLocal",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"muteLocal"),UF.prototype),Cw(UF.prototype,"unmuteLocal",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"unmuteLocal"),UF.prototype),Cw(UF.prototype,"close",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"close"),UF.prototype),Cw(UF.prototype,"updateEncoderConfig",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"updateEncoderConfig"),UF.prototype),Cw(UF.prototype,"updateSendParameters",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"updateSendParameters"),UF.prototype),Cw(UF.prototype,"replaceTrack",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"replaceTrack"),UF.prototype),Cw(UF.prototype,"getRemoteSSRC",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"getRemoteSSRC"),UF.prototype),UF);function BF(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}function jF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function GF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jF(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const WF="9",HF=4e4;class KF{get localCapabilities(){return sA(this._localCapabilities)}get rtpCapabilities(){return sA(this._rtpCapabilities)}get candidates(){return sA(this._candidates)}get iceParameters(){return sA(this._iceParameters)}get dtlsParameters(){return sA(this._dtlsParameters)}constructor(e){Fg(this,"sessionDesc",void 0),Fg(this,"_localCapabilities",void 0),Fg(this,"_rtpCapabilities",void 0),Fg(this,"_candidates",void 0),Fg(this,"_iceParameters",void 0),Fg(this,"_dtlsParameters",void 0),Fg(this,"setup",void 0),Fg(this,"currentMidIndex",void 0),Fg(this,"cname",void 0),Fg(this,"firefoxSsrcMidMap",new Map),e=sA(e);const{iceParameters:t,dtlsParameters:n,candidates:r,rtpCapabilities:i,setup:o,localCapabilities:a,cname:s}=e;this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=a,this.setup=o,this.cname=s,this.sessionDesc=this.updateRemoteRTPCapabilities(i),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){const t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;let o=this.sessionDesc.mediaDescriptions.length-1;for(let a=1;a<e;a++){const e=2*a+2e4,s=2*a+HF,{ssrcs:c,ssrcGroups:u}=zU([{ssrcId:e}],this.cname),{ssrcs:l,ssrcGroups:d}=zU([{ssrcId:s,rtx:XA("USE_SUB_RTX")?s+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:WF,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:d,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:WF,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:c,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return FU.print(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:o}=zU(t,this.cname,XA("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(i);if(a){if(Zv()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,a.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(a,r),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||1===t&&(Xv()||function(){const e=Hv();return!(e.name!==Bv.CHROME||!e.osVersion)&&Number(e.version)<=90}())||0===t&&XA("USE_SUB_RTX")||ay()?(n=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(n=sA(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),Zv()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:t}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:t}}batchSend(e){const t=e.map(e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)}),n=[];let r=!1;return t.forEach(e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)}),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(e=>{"0"===e.attributes.mid||Zv()||ay()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")}),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dn(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="inactive"})}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>Dn(e).call(e,t.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(e=>{e.attributes.direction="recvonly"})}receive(e,t,n,r){e.forEach((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])}),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter(t=>-1!==e.indexOf(t.attributes.mid));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(e=>{e.media.port="0",e.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const t=this.sessionDesc||FU.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=e;const n=this.rtpCapabilities.send,r=this.localCapabilities.send;for(const e of t.mediaDescriptions){if(e.attributes.iceUfrag=this._iceParameters.iceUfrag,e.attributes.icePwd=this._iceParameters.icePwd,e.attributes.fingerprints=this._dtlsParameters.fingerprints,e.attributes.candidates=this._candidates,e.attributes.setup=this.setup,"application"===e.media.mediaType&&(e.attributes.sctpPort="5000"),"video"===e.media.mediaType)if(0===n.videoCodecs.length){const t=r.videoCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Dn(n=t.encodingName.toLowerCase()).call(n,"vp8")})||[r.videoCodecs[0]];e.media.fmts=t.map(e=>e.payloadType.toString(10)),e.attributes.payloads=t,e.attributes.extmaps=[]}else if(e.media.fmts=n.videoCodecs.map(e=>e.payloadType.toString(10)),e.attributes.payloads=n.videoCodecs,e.attributes.extmaps=n.videoExtensions,XA("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:t,ssrcGroups:n}=zU([{ssrcId:HF,rtx:XA("USE_SUB_RTX")?40001:void 0}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}if("audio"===e.media.mediaType)if(0===n.audioCodecs.length){const t=r.audioCodecs.filter(e=>{var t,n;return null===(t=e.rtpMap)||void 0===t?void 0:Dn(n=t.encodingName.toLowerCase()).call(n,"opus")})||[r.audioCodecs[0]];e.media.fmts=t.map(e=>e.payloadType.toString(10)),e.attributes.payloads=t,e.attributes.extmaps=[]}else if(e.media.fmts=n.audioCodecs.map(e=>e.payloadType.toString(10)),e.attributes.payloads=n.audioCodecs,e.attributes.extmaps=n.audioExtensions,ox(e),XA("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:t,ssrcGroups:n}=zU([{ssrcId:2e4}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}}return this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){const t=this._candidates.filter(e=>"udp"===e.transport);if(e===lO.TCP){if(0===t.length)return;if(XA("TCP_CANDIDATE_ONLY")){const e=this._candidates.filter(e=>"tcp"===e.transport);t.forEach(t=>{-1===e.findIndex(e=>e.connectionAddress===t.connectionAddress)&&e.push(GF(GF({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))}),this._candidates=e}else{const e=[];t.forEach(t=>{e.push(GF(GF({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))}),this._candidates=[...t,...e]}}else if(e===lO.RELAY){if(0!==t.length)return;{const e=this._candidates.filter(e=>"tcp"===e.transport);e.forEach(e=>{t.push(GF(GF({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))}),this._candidates=[...t,...e]}}else 0===t.length?(this._candidates.filter(e=>"tcp"===e.transport).forEach(e=>{t.push(GF(GF({},e),{},{foundation:"udpcandidate",priority:Number(e.priority)+1+"",transport:"udp",port:Number(e.port)-90+""}))}),this._candidates=t):this._candidates=this._candidates.filter(e=>"tcp"!==e.transport);for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}restartICE(e){e=sA(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(Zv()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r})}createOrRecycleDataChannel(){for(const e of this.sessionDesc.mediaDescriptions)if("application"===e.media.mediaType)return{mediaDesc:e,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),t={media:{mediaType:"application",port:WF,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(t),{mediaDesc:t,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,t,n,r,i,o){const a=e._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,c=sx(a,s,this.localCapabilities.send,a===dO.VIDEO?r:i),u=a===dO.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;const l="".concat(this.currentMidIndex);let d={media:{mediaType:a,port:WF,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,e,o);const h=this.findFirstClosedMedia(a);if(h){const e=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[e]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteCodec(e,t,n){const r=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Dn(t=Object.keys(eb)).call(t,e)}))],i=new Set(t);if(r.every(e=>i.has(e)))return fb.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(t)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter(e=>t.some(t=>{var n;return Dn(n=e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").call(n,t)}));if(0===o.length)return fb.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(r," codecs: ").concat(t)),!1;const a=[...new Set(o.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||""))];let s;if(fb.debug("updateRemoteCodec, from ".concat(r," to ").concat(a)),0===e.length)s=this.sessionDesc.mediaDescriptions.filter(e=>"video"===e.media.mediaType&&"recvonly"===e.attributes.direction);else if(s=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&Dn(e).call(e,t.attributes.mid)&&"recvonly"===t.attributes.direction),s.length!==e.length)return fb.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(t)),!1;if(XA("USE_PUB_RTX")||XA("USE_SUB_RTX")){const e=ax(o,this.rtpCapabilities.recv.videoCodecs);o.push(...e)}this._rtpCapabilities.recv.videoCodecs=o;const c=sx(dO.VIDEO,this.rtpCapabilities.recv,this.localCapabilities.send,n);return s.forEach(e=>{const t=c.map(e=>e.payloadType.toString(10));fb.debug("updateRemoteCodec mid: ".concat(e.attributes.mid,", from ").concat(e.attributes.payloads," to ").concat(c)),e.attributes.payloads=c,e.media.fmts=t}),!0}createOrRecycleSendMedia(e,t,n,r,i){const o=this.rtpCapabilities.send,a=e===dO.VIDEO?o.videoCodecs:o.audioCodecs,s=e===dO.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let u={media:{mediaType:e,port:WF,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(e=>e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:s,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};u=this.mungSendMediaDesc(u,i);const l=this.findFirstClosedMedia(e);if(l){const e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>"0"!==e.media.port).map(e=>e.attributes.mid)}mungRecvMediaDsec(e,t,n){const r=sA(e);return XU(r),JU(r,t),QU(r,t),ZU(r),$U(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=sA(e);return $U(n,t,this.localCapabilities.recv),ox(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex(t=>t.attributes.mid===e);if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Zv()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var n;return(null===(n=t.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===e[0].ssrcId})}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find(t=>t.attributes.mid===e))||void 0===t?void 0:t.attributes.ssrcs}}function YF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function qF(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?YF(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YF(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let zF=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({});var JF=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(JF||{});const XF=new Map;function QF(e,t,n,r){let{scale:i}=e;if(0===i&&r===JF.UP||i>=t.length-1&&r===JF.DOWN)return e;let o=qF(qF({},e),{},{scale:r===JF.DOWN?++i:--i});switch(n){case"maintain-framerate":o=qF(qF({},o),t[i].motion);break;case"maintain-resolution":o=qF(qF({},o),t[i].detail);break;case"balanced":o=qF(qF({},o),t[i].balanced)}return o}function ZF(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:$F(t)};XF.set(e,n)}else XF.delete(e)}function $F(e){const t=qF({},e),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:o}=t,{MIN_FRAME_RATE:a,MAX_THRESHOLD_FRAMERATE:s,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:u,BITRATE_MAX_THRESHOLD:l,BWE_SCALE_UP_THRESHOLD:d,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:f,BALANCE_BITRATE_FACTOR:m,BALANCE_FRAMERATE_FACTOR:g,BALANCE_RESOLUTION_FACTOR:v,MOTION_RESOLUTION_FACTOR:E,MOTION_BITRATE_FACTOR:y,DETAIL_FRAMERATE_FACTOR:_,DETAIL_BITRATE_FACTOR:b}=YA,S=Math.min(t.frameRate,s),w=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(p,1)*S),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o}}];for(let e=1;e<=c;e++){const t={bwe_up:Math.round(Math.pow(d,e)*n),bwe_down:Math.round(Math.pow(h,e+1)*n),fps_up:Math.round(Math.pow(f,e)*S),fps_down:Math.round(Math.pow(p,e+1)*S)},s={scaleResolutionDownBy:i/Math.pow(v,e),frameRate:Math.max(Math.round(Math.pow(g,e)*r),a),bitrateMax:Math.max(Math.round(Math.pow(m,e)*n),l),bitrateMin:Math.max(Math.round(Math.pow(m,e)*o),u)},c={scaleResolutionDownBy:i/Math.pow(E,e),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(y,e)*n),l),bitrateMin:Math.max(Math.round(Math.pow(y,e)*o),u)},T={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_,e)*r),a),bitrateMax:Math.max(Math.round(Math.pow(b,e)*n),l),bitrateMin:Math.max(Math.round(Math.pow(b,e)*o),u)};w.push({scale:e,threshold:t,balanced:s,motion:c,detail:T})}return w}function eB(e,t,n,r,i,o){const a=XF.get(e)||{overUse:0,underUse:0,adaptationList:$F(i)},{adaptationList:s}=a;XF.set(e,a);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:u}=YA,{scale:l}=r;let d,h;return"number"==typeof t&&t>0&&function(e,t,n,r){if(t>=n.length)return!1;let{threshold:{fps_down:i}}=n[t];return XA("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[0].threshold.fps_down),e<i}(t,l,s,o)&&(a.overUse++,h=zF.CPU,a.overUse>c)||"number"==typeof n&&n>0&&function(e,t,n){if(t>=n.length)return!1;const{threshold:{bwe_down:r}}=n[t];return e<r}(n,l,s)&&(a.overUse++,h=zF.BANDWIDTH,a.overUse>c)?(a.overUse=0,a.underUse=0,d=QF(r,s,o,JF.DOWN),[d,h]):("number"==typeof t&&t>0&&"number"==typeof n&&n>0&&function(e,t,n,r){if(0===t)return;let{threshold:{fps_up:i}}=n[t];return XA("FORCE_AG_HIGH_FRAMERATE")&&"maintain-framerate"===r&&(i=n[1].threshold.fps_up),e>i}(t,l,s,o)&&function(e,t,n){if(0===t)return;const{threshold:{bwe_up:r}}=n[t];return e>r}(n,l,s)&&(a.underUse++,a.underUse>u&&(a.overUse=0,a.underUse=0,d=QF(r,s,o,JF.UP),0===d.scale&&(h=zF.NONE))),[d,h])}function tB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function iB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tB(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function nB(e){var t;return!(!XA("ENABLE_AG_ADAPTATION")||!(e instanceof cU||Dn(t=e._hints).call(t,mL.CUSTOM_TRACK))||!XA("FORCE_SUPPORT_AG_ADAPTATION")&&!(function(){const e=Hv();if(e.os!==Fv.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])>=14}()&&ry(17,4,!0)||ny(14)&&oy(17,4,!0)))}const rB=new Map;function oB(e,t){const n=rB.get(e);if(n){const{timer:t}=n;window.clearTimeout(t),rB.delete(e)}t.qualityLimitationReason=zF.NONE,ZF(e)}var sB;function aB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function cB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?aB(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let dB=(sB=class e extends cO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(t=t.transport)||void 0===t?void 0:t.state)&&void 0!==e?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Dn(t=Object.keys(eb)).call(t,e)}))]}constructor(t,n){super(t,n),Fg(this,"store",void 0),Fg(this,"peerConnection",void 0),Fg(this,"id",TA(5,"connection-")),Fg(this,"remoteSDP",void 0),Fg(this,"initialOffer",void 0),Fg(this,"transportEventReceiver",void 0),Fg(this,"statsFilter",void 0),Fg(this,"extension",{useXR:XA("USE_XR")}),Fg(this,"localCapabilities",void 0),Fg(this,"remoteCodecs",void 0),Fg(this,"localCandidateCount",0),Fg(this,"allCandidatesReceived",!1),Fg(this,"isPreallocation",!1),Fg(this,"preSSRCMap",new Map),Fg(this,"dataStreamChannelMap",new Map),Fg(this,"establishPromise",void 0),Fg(this,"recoveredDataChannelIds",[]),Fg(this,"currentDataChannelId",1),Fg(this,"mutex",new NA("P2PConnection-mutex")),Fg(this,"qualityLimitationReason",zF.NONE),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=xV(this.peerConnection,XA("STATS_UPDATE_INTERVAL"),void 0,Zv()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const t=this.preSSRCMap.get(e);if(void 0!==t){const e=this.peerConnection.getTransceivers().find(e=>e.mid===t);if(e)return{transceiver:e,track:e.receiver.track,id:t}}}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){const e=await this.peerConnection.createOffer(),t=this.logSDPExchange(e.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(e);const n=this.remoteSDP.toString();null==t||t(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else fb.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else fb.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=HU(e.sdp),n=await tx({filterRTX:!XA("USE_PUB_RTX")&&!XA("USE_SUB_RTX"),filterVideoFec:XA("FILTER_VIDEO_FEC"),filterAudioFec:XA("FILTER_AUDIO_FEC"),filterVideoCodec:XA("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=rx(n),this.initialOffer=e,cB(cB({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(e){throw new Cy(Ry.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new KF(cB(cB({},e),{},{localCapabilities:this.localCapabilities})),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const t=this.remoteSDP.toString(),n=dx(this.initialOffer.sdp,this.extension),r=this.logSDPExchange(n||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),null==r||r(t),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t});const i=this.peerConnection.getTransceivers()[0];if(null!=i&&i.receiver&&this.tryBindTransportEvents(i.receiver),XA("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(XA("PRELOAD_MEDIA_COUNT"));const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t)}const{preSSRCs:o}=e;if(Array.isArray(o)&&o.length>0){const{mids:e}=this.remoteSDP.batchSend(o.map(e=>({kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel})));e.forEach((e,t)=>{this.preSSRCMap.set(o[t].ssrcId,e)}),await cx(this.peerConnection,this.remoteSDP,this.extension),fb.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:t}=e;this.remoteSDP.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:n}=e;if(Array.isArray(n)&&n.length>0){const{mids:e}=this.remoteSDP.batchSend(n.map(e=>Object.assign({},{kind:e.kind,ssrcMsg:[{ssrcId:e.ssrcId,rtx:e.rtx}],mslabel:e.mslabel})));e.forEach((e,t)=>{this.preSSRCMap.set(n[t].ssrcId,e)})}await cx(this.peerConnection,this.remoteSDP,this.extension),fb.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return YI(function*(){const i=yield qI(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[];e.forEach(e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(t),e._updateRtpTransceiver(t)}),Zv()&&!0===XA("SIMULCAST")&&(yield qI(r.applySimulcastForFirefox(o,e)));const a=yield qI(r.peerConnection.createOffer()),s=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(a.sdp,e,s),u=FU.parse(c),l=s.map(e=>{const t=u.mediaDescriptions.find(t=>t.attributes.mid===e);if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return KU(t,XA("USE_PUB_RTX"))});let d;try{d=yield l}catch(i){d=[],r.remoteSDP.receive(e,t,n,d);const o=r.remoteSDP.toString();throw yield qI(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield qI(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield qI(r.stopSending(s,!0)),i}r.remoteSDP.receive(e,t,n,d);const h=r.remoteSDP.toString(),p=r.logSDPExchange(c,"offer","local","send");return yield qI(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield qI(r.applySimulcastEncodings(o,e)),yield qI(r.applySendEncodings(o,e)),null==p||p(h),yield qI(r.peerConnection.setRemoteDescription({type:"answer",sdp:h})),o.map((e,t)=>({localSSRC:l[t],id:s[t],transceiver:e}))}catch(e){throw e instanceof Cy?e:new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}})()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&"open"===n.readyState)fb.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const t=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if("number"!=typeof t)throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:t,negotiated:!0,ordered:!1,maxRetransmits:XA("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}t.forEach(e=>{e._updateOriginDataChannel(n)});const{needExchangeSDP:r}=this.remoteSDP.sendDataChannel();if(r){const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),fb.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else fb.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(e){throw e instanceof Cy?e:new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(e.toString()))}}async stopDataChannels(e){try{const t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(e){throw e instanceof Cy?e:new Cy(Ry.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(e.toString()))}}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter(t=>-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(e=>{var t;oB(this.id+e.mid,this),e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);o&&(await cx(this.peerConnection,this.remoteSDP,this.extension),fb.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const a=this.peerConnection.getTransceivers().find(e=>e.mid===i);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:i,transceiver:a}}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);return n&&(await cx(this.peerConnection,this.remoteSDP,this.extension),fb.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map(e=>{const t=this.peerConnection.getTransceivers().find(t=>t.mid===e);if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(e=>{Array.from(this.preSSRCMap.entries()).some(t=>{let[n,r]=t;if(r===e)return this.preSSRCMap.delete(n),!0})}),this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(e=>{e.direction="inactive"});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter(t=>t.mid&&-1!==e.indexOf(t.mid));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async(e,t)=>{e.direction="sendonly"});const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return YI(function*(){const n=yield qI(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ZP().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===lO.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(fb.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===lO.RELAY)return;t.remoteSDP.updateCandidates(e);const n=yield qI(t.peerConnection.createOffer({iceRestart:!0}));if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=HU(n.sdp),{remoteIceParameters:i}=yield r.iceParameters;t.remoteSDP.restartICE(i);const o=t.remoteSDP.toString(),a=t.logSDPExchange(n.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield qI(t.peerConnection.setLocalDescription(n)),null==a||a(o),yield qI(t.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(e){fb.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}})()}close(){var e;this.peerConnection.getTransceivers().forEach(e=>{oB(this.id+e.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return cB(cB({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Cy(Ry.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter(t=>t.mid===e);1===n.length&&(this.isVP8Simulcast(t)?Zv()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find(e=>e.mid===t);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:cB(cB({},RV),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:cB(cB({},RV),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,fb.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,fb.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},XA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(Ky(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),XA("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),XA("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(e=>{e.forceturn&&(n.iceTransportPolicy="relay")}))),XA("ENABLE_ENCODED_TRANSFORM")&&ZP().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach(e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(JO(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!XA("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))}),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair();fb.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n,r;if(!t){const n=this.peerConnection.getSenders();t=n.find(t=>t.track===e._mediaStreamTrack)}if(!t)return fb.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return fb.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ZP().supportSetRtpSenderParameters)return fb.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},o={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;case"balanced":i.degradationPreference="balanced"}const a=function(e,t){return e.getTransceivers().find(e=>e.sender.track===t||e.receiver.track===t)}(this.peerConnection,e._mediaStreamTrack),s=wk(e);if(nB(e)&&a&&t&&s&&this.getLocalVideoStats&&Dn(n=["vp8","vp9"]).call(n,this.store.codec)){var c;const n=i.degradationPreference||(Dn(c=e._hints).call(c,mL.CUSTOM_TRACK)?XA("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");!function(e,t,n,r,i,o){if(oB(e,n),i(t),"balanced"!==r&&"maintain-framerate"!==r&&"maintain-resolution"!==r)return;let a=-1;ZF(e,t);const s=window.setInterval(()=>{const s=rB.get(e);if(!XA("ENABLE_AG_ADAPTATION")||!s)return oB(e,n),void i(t);const c=o();if(c.sendPackets>0&&c.OutgoingAvailableBandwidth>0){if(-1===a)return void(a=Date.now());if(Date.now()-a<1e3)return;const o=c.sendFrameRate,u=c.OutgoingAvailableBandwidth,[l,d]=eB(e,o,u,s.adaptationConfig,t,r);d&&(n.qualityLimitationReason=d),l&&s.adaptationConfig.scale!==l.scale&&(fb.debug("[".concat(e,"] applyAdaptation: ").concat(n.qualityLimitationReason,"\n           sendFps ").concat(o,", bwe ").concat(u,", switch from ").concat(s.adaptationConfig.scale," to ").concat(l.scale," ")),s.adaptationConfig=iB(iB({},s.adaptationConfig),l),i(l))}},XA("CHECK_LOCAL_STATS_INTERVAL")),c=iB({},t);rB.set(e,{timer:s,adaptationConfig:c,originConfig:t,adaptationFunc:i}),fb.debug("[".concat(e,"] start adaptation, originConfig: ").concat(JSON.stringify(t),", degradationPreference: ").concat(r))}(this.id+a.mid,s,this,n,e=>{t&&this.updateAdaptation(t,e)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var u;const{bitrateMax:t,frameRate:n,scaleResolutionDownBy:r}=e._encoderConfig;t&&(o.maxBitrate=1e3*t),(Dn(u=e._hints).call(u,mL.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(n&&(o.maxFramerate=QO(n)),r&&r>=1&&(o.scaleResolutionDownBy=r))}const{maxFramerate:l}=XA("ENCODER_CONFIG_LIMIT");if(l&&"number"==typeof l&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,l):l),XA("DSCP_TYPE")&&Ey()){var d;const e=XA("DSCP_TYPE");Dn(d=["very-low","low","medium","high"]).call(d,e)&&(o.networkPriority=e)}const h=t.getParameters(),p=null===(r=h.encodings)||void 0===r?void 0:r[0];Zv()&&!p&&(i.encodings=[o]),p&&Object.assign(p,o),Object.assign(h,i),fb.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await t.setParameters(h),await async function(e,t,n){try{var r;if(!ZP().supportSetRtpSenderParameters)return;if(!function(e){return"vp9"===e}(e)||!XA("ENABLE_SVC"))return;const i={},o={},a=t.getParameters(),s=null===(r=a.encodings)||void 0===r?void 0:r[0];o.scalabilityMode=BU(n),s&&Object.assign(s,o),Object.assign(a,i),await t.setParameters(a),fb.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(a.encodings)))}catch(e){fb.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",e)}}(this.store.codec,t,XA("SVC_MODE"))}async updateAdaptation(e,t){var n,r;if(!e)return fb.debug("[updateAdaptation] no rtpSender found");if(!ZP().supportSetRtpSenderParameters)return fb.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const i={},{bitrateMax:o,frameRate:a,scaleResolutionDownBy:s}=t;o&&(i.maxBitrate=1e3*o),a&&(i.maxFramerate=QO(a)),s&&s>=1&&Dn(n=["vp8","vp9"]).call(n,this.store.codec)&&(i.scaleResolutionDownBy=s);const c=e.getParameters(),u=null===(r=c.encodings)||void 0===r?void 0:r[0];u&&Object.assign(u,i),Object.assign(c,{});try{await e.setParameters(c),fb.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(c.encodings)))}catch(t){!("transport"in e)||e.transport&&"connected"===e.transport.state?"connected"!==this.peerConnectionState?fb.debug("[updateAdaptation] peerConnection not connected}"):fb.debug("[updateAdaptation] updateRtpSenderEncodings failed",t):fb.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!ZP().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let n=0;n<e.length;n++){const r=e[n],i=t[n];i instanceof aU&&!this.isVP8Simulcast(i)&&await this.updateRtpSenderEncodings(i,r.sender)}}catch(e){fb.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=FU.parse(e);return t.forEach((e,t)=>{const i=n[t],o=r.mediaDescriptions.find(e=>e.attributes.mid===i);o&&(JU(o,e),ex(o,e,this.store.codec))}),FU.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,o,a;const c=e[s],u=t[s];if(u instanceof aU&&!Dn(n=u._hints).call(n,mL.LOW_STREAM)&&null!==(r=u._encoderConfig)&&void 0!==r&&r.bitrateMax&&(null===(i=u._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(o=u._scalabilityMode)&&void 0!==o&&o.numSpatialLayers&&(null===(a=u._scalabilityMode)||void 0===a?void 0:a.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(u._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!Zv()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof aU&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const a=t.sender.getParameters();await t.sender.setParameters(Object.assign(a,i))}}}isVP8Simulcast(e){var t,n,r,i,o;return!!(e instanceof aU&&XA("SIMULCAST")&&"vp8"===this.store.codec&&!Dn(t=e._hints).call(t,mL.LOW_STREAM)&&null!==(n=e._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=e._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=e._scalabilityMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=e._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(XA("SDP_LOGGING"))return fb.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return t&&0!==t.length?t[0].ssrcId:void 0}setConfiguration(t){if(ZP().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},Cw(sB.prototype,"updateRemoteRTPCapabilities",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"updateRemoteRTPCapabilities"),sB.prototype),Cw(sB.prototype,"connect",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"connect"),sB.prototype),Cw(sB.prototype,"updateRemoteConnect",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"updateRemoteConnect"),sB.prototype),Cw(sB.prototype,"createDataChannels",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"createDataChannels"),sB.prototype),Cw(sB.prototype,"receive",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"receive"),sB.prototype),Cw(sB.prototype,"batchReceive",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"batchReceive"),sB.prototype),Cw(sB.prototype,"stopReceiving",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"stopReceiving"),sB.prototype),Cw(sB.prototype,"muteRemote",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"muteRemote"),sB.prototype),Cw(sB.prototype,"unmuteRemote",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"unmuteRemote"),sB.prototype),Cw(sB.prototype,"muteLocal",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"muteLocal"),sB.prototype),Cw(sB.prototype,"unmuteLocal",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"unmuteLocal"),sB.prototype),Cw(sB.prototype,"close",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"close"),sB.prototype),Cw(sB.prototype,"updateEncoderConfig",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"updateEncoderConfig"),sB.prototype),Cw(sB.prototype,"updateSendParameters",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"updateSendParameters"),sB.prototype),Cw(sB.prototype,"replaceTrack",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"replaceTrack"),sB.prototype),Cw(sB.prototype,"updateAdaptation",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"updateAdaptation"),sB.prototype),Cw(sB.prototype,"getRemoteSSRC",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"getRemoteSSRC"),sB.prototype),sB);function lB(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}var uB;function hB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function pB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hB(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _B(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=JI,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new EB(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function EB(e){function t(e){if(Object(e)!==e)return Gh.reject(new TypeError(e+" is not an object."));var t=e.done;return Gh.resolve(e.value).then(function(e){return{value:e,done:t}})}return EB=function(e){this.s=e,this.n=e.next},EB.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Gh.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Gh.reject(e):t(n.apply(this.s,arguments))}},new EB(e)}let fB=(uB=class extends xy{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(_O.StateChange,t,this._state)}constructor(e,t){super(),Fg(this,"isPlanB",void 0),Fg(this,"store",void 0),Fg(this,"statsUploader",void 0),Fg(this,"connection",void 0),Fg(this,"localTrackMap",new Map),Fg(this,"remoteUserMap",new Map),Fg(this,"localDataChannels",[]),Fg(this,"remoteDataChannelMap",new Map),Fg(this,"pendingLocalTracks",[]),Fg(this,"pendingRemoteTracks",[]),Fg(this,"pendingLocalDataChannels",[]),Fg(this,"pendingRemoteDataChannels",[]),Fg(this,"statsCollector",void 0),Fg(this,"shouldForwardP2PCreation",void 0),Fg(this,"iceFailedCount",0),Fg(this,"dtlsFailedCount",0),Fg(this,"mutex",new NA("P2PChannel-mutex")),Fg(this,"_state",pO.Disconnected),Fg(this,"_pcStatsUploadType",XA("NEW_ICE_RESTART")?uO.FIRST_CONNECTION:uO.OLD_FIRST_CONNECTION),Fg(this,"_isInRestartIce",!1),Fg(this,"_isStartRestartIce",!1),Fg(this,"_restartStates",["disconnected","failed"]),Fg(this,"_restartTimer",void 0),Fg(this,"_isFirstConnected",!0),Fg(this,"handleMuteLocalTrack",async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==pO.Connected)return void n(new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const r=this.filterTobeMutedTracks(e);if(0===r.length)return void t();const i=r.find(e=>"videoLowTrack"===e[0]);i&&i[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(r.map(e=>{let[,{id:t}]=e;return t}));const o=this.createMuteMessage(r);await $y(this,_O.RequestMuteLocal,o),t()}catch(e){n(e)}finally{r()}}),Fg(this,"handleUnmuteLocalTrack",async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==pO.Connected)return void n(new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const r=this.filterTobeUnmutedTracks(e);if(0===r.length)return void t();const i=r.find(e=>"videoLowTrack"===e[0]);if(i){const t=i[1];if(t.track._originMediaStreamTrack.stop(),!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding){const n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{const n=KV(e,tA(this,_O.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new Gh((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}await this.connection.unmuteLocal(r.map(e=>{let[,{id:t}]=e;return t}));const o=this.createUnmuteMessage(r);await $y(this,_O.RequestUnmuteLocal,o),t()}catch(e){n(e)}finally{r()}}),Fg(this,"handleUpdateVideoEncoder",async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const n=this.localTrackMap.get(hO.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==pO.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),await this.connection.updateEncoderConfig(r,i),this.emit(_O.UpdateVideoEncoder,i),t()}catch(e){n(e)}finally{r()}}),Fg(this,"handleUpdateVideoSendParameters",async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const n=this.localTrackMap.get(hO.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==pO.Connected)return void t();const{id:r,track:i}=n;await this.connection.updateSendParameters(r,i),t()}catch(e){n(e)}finally{r()}}),Fg(this,"handleReplaceMixingTrack",async(e,t,n,r)=>{if(!this.connection||this.state!==pO.Connected)return void t();const i=hF([e]);let o;fb.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(i.getTrackId(),"]")),"boolean"==typeof r&&r||(o=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(e,i),t()}catch(e){n(e)}finally{var a;null===(a=o)||void 0===a||a()}}),Fg(this,"handleReplaceTrack",async(e,t,n,r)=>{let i;fb.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!this.connection||!n||this.state!==pO.Connected)return void t();if(await(null===(o=this.connection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),this.isPlanB){const t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===hO.LocalVideoTrack&&!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding){const t=this.localTrackMap.get(hO.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new Gh((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}t()}catch(e){n(e)}finally{var a;null===(a=i)||void 0===a||a()}}),Fg(this,"handleGetRTCStats",e=>{e(this.statsCollector.getRTCStats())}),Fg(this,"handleGetLocalVideoStats",e=>{e(this.statsCollector.getLocalVideoTrackStats())}),Fg(this,"handleGetLocalAudioStats",e=>{e(this.statsCollector.getLocalAudioTrackStats())}),Fg(this,"handleGetRemoteVideoStats",e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid]),Fg(this,"handleGetRemoteAudioStats",e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new aF(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!ZP().supportUnifiedPlan||XA("CHROME_FORCE_PLAN_B")&&Ey(),this.shouldForwardP2PCreation=XA("FORWARD_P2P_CREATION")&&ZP().supportPCSetConfiguration&&_y(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new FF({},this.store):new dB({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=pO.New;const n=this.shouldForwardP2PCreation&&"closed"===(null===(t=this.connection)||void 0===t?void 0:t.peerConnectionState);if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(fb.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new FF(e,this.store):new dB(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=XA("NEW_ICE_RESTART")?uO.FIRST_CONNECTION:uO.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");XA("ENABLE_PREALLOC_PC")&&this.state===pO.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=pO.Connected)}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter(e=>{var t;let[n]=e;return Dn(t=[hO.LocalVideoLowTrack,hO.LocalVideoTrack]).call(t,n)}),n=t.map(e=>{let[,{id:t}]=e;return t}),r=t.map(e=>{let[t]=e;return t});if(this.connection instanceof dB){if(vb.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Dn(e).call(e,this.store.codec)){const t=["vp9","vp8","h264"].find(t=>Dn(e).call(e,t));t&&(this.store.codec=t,fb.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(t,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof dB&&"closed"!==this.connection.peerConnectionState&&Dn(e=[pO.New,pO.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==pO.Connected){if(this.state===pO.Disconnected)throw new Cy(Ry.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(e=>{var t;Dn(t=this.pendingLocalDataChannels).call(t,e)||this.pendingLocalDataChannels.push(e)}),[]}const t=this.filterTobePublishedDataChannels(e);return 0===t.length?[]:(t.forEach(e=>{const t=Date.now();this.store.publish(e.id.toString(),"datachannel",t)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(e=>{this.localDataChannels.push(e);const t=Date.now();this.store.publish(e.id+"","datachannel",void 0,t)}),e.map(e=>({streamId:e.id,ordered:e.ordered,maxRetransmits:e.maxRetransmits,metadata:e.metadata,channelId:e._originDataChannelId})))}publish(e,t,n){var r=this;return YI(function*(){const i=yield qI(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==pO.Connected){if(r.state===pO.Disconnected)throw new Cy(Ry.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const t=e.filter(e=>-1===r.pendingLocalTracks.indexOf(e));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,rV.markPublishStart(r.store.clientId,r.store.pubId);const i=r.filterTobePublishedTracks(e,t,n);if(0===i.length)return void(yield qI(r.tryToUnmuteAudio(e)));yield*zI(_B(r.doPublish(r.connection,i)))}finally{i()}})()}doPublish(e,t){var n=this;return YI(function*(){t.forEach(e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===hO.LocalAudioTrack?"audio":"video",i)}),n.bindLocalTrackEvents(t);const r=t.map(e=>{let{track:t}=e;return t}),i=yield qI(e.send(r,n.store.codec,n.store.audioCodec)),o=(yield qI(i.next())).value,a=n.createGatewayPublishMessage(t,o);let s;try{s=yield a}catch(e){throw i.throw(e),(null==e?void 0:e.code)===Ry.WS_ABORT&&t.forEach(e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)}),n.unbindLocalTrackEvents(t),e}const c=n.mapPubResToRemoteConfig(a,s,r),u=(yield qI(i.next(c))).value,l=XA("ENABLE_VIDEO_SEI");r.forEach(async e=>{const t=e.getRTCRtpTransceiver();t&&l&&(e.trackMediaType===dO.VIDEO?await kU(t.sender,e):e.trackMediaType===dO.AUDIO&&await async function(e){if(!ZP().supportWebRTCEncodedTransform)return void fb.warning("browser not support audio encoded transform");if(NU.has(e))return;if(!e.track)return;const t={track:e.track};if(Jv()){if(!e.createEncodedStreams)return void fb.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(e){return void fb.error("create audio-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(r,i){t.controller||(t.controller=i),e.track&&e.track.id!==t.track.id&&(fb.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n)),i.enqueue(r)}});r.readable.pipeThrough(i).pipeTo(r.writable)}else if(Xv()){if("undefined"==typeof RTCRtpScriptTransform)return void fb.warning("browser not support RTCRtpScriptTransform");const r=OU(),i=new MessageChannel;await new Gh(e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)});const o=new RTCRtpScriptTransform(r,{name:"tx",port:i.port2},[i.port2]);e.transform=o,await new Gh(e=>r.onmessage=t=>{"started"===t.data&&e(void 0)}),i.port1.onmessage=r=>{var i;r.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==t.track.id&&(fb.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n))},t.worker=r}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}const t=NU.get(e);if(t){NU.delete(e);try{var r,i;null===(r=t.controller)||void 0===r||r.terminate(),null===(i=t.worker)||void 0===i||i.terminate()}catch(e){fb.warning(e&&e.message)}}}NU.set(e,t),e.track.addEventListener("ended",n)}(t.sender))}),t.forEach(e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)}),n.assignLocalTracks(t,u),n.statsUploader.startUploadOutboundStats(),t.forEach(e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===hO.LocalAudioTrack?"audio":"video",void 0,i)})})()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n)return;if(!(n.track instanceof aU))return fb.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof dB||this.connection instanceof FF))return fb.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:r}=n,i=function(e,t){const n={};return e.height&&e.width&&(n.scaleResolutionDownBy=iN(e,t)),n.maxFramerate=e.framerate?QO(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}(e,r);if(r._encoderConfig||(r._encoderConfig={}),t!==hO.LocalVideoLowTrack||!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding)null!=i.scaleResolutionDownBy&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const t=r._originMediaStreamTrack;if(!t.canvas)return fb.warn("[".concat(r.getTrackId(),"] no canvas on track"));!function(e,t){const n=e.canvas;t.width&&(n.width=QO(t.width)),t.height&&(n.height=QO(t.height)),t.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=QL(()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()},QO(t.framerate)))}(t,e)}null!=i.maxBitrate&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),null!=i.maxFramerate&&(r._encoderConfig.frameRate&&"object"==typeof r._encoderConfig.frameRate?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),fb.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(e){var t=this;return YI(function*(){if(!t.connection||t.state!==pO.Connected)return;const n=yield qI(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const n=t.localTrackMap.get(hO.LocalVideoTrack);if(!n)throw new Cy(Ry.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(hO.LocalVideoLowTrack))throw new Cy(Ry.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const i=[{track:t.getLowVideoTrack(n.track,e),type:hO.LocalVideoLowTrack}];if(yield*zI(_B(t.doPublish(t.connection,i))),n.track.muted||!n.track.enabled){var r;const e=null===(r=t.localTrackMap.get(hO.LocalVideoLowTrack))||void 0===r?void 0:r.id;void 0!==e&&(yield qI(t.connection.muteLocal([e])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(fb.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Zy(this,_O.RequestRePublish,this.pendingLocalTracks),this.emit(_O.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(fb.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Zy(this,_O.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(e){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:t,kind:n}=this.pendingRemoteTracks[e];(n!==dO.AUDIO||t._audio_added_&&t._audioSSRC)&&(n!==dO.VIDEO||t._video_added_&&t._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(e)await Zy(this,_O.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:t}of this.pendingRemoteTracks)await this.subscribe(e,t,t===dO.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:t}=e;this.emit(_O.MediaReconnectEnd,t.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==pO.Connected)return void e.forEach(e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)});const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find(e=>"videoLowTrack"===e[0]);return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==pO.Connected)return void e.forEach(e=>{const t=this.pendingLocalDataChannels.indexOf(e);-1!==t&&this.pendingLocalDataChannels.splice(t,1)});const t=this.filterTobeUnpublishedDataChannels(e);return 0!==t.length?(t.forEach(e=>{const t=this.localDataChannels.indexOf(e);-1!==t&&this.localDataChannels.splice(t,1)}),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),t.map(e=>e.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==pO.Connected)return;const e=this.localTrackMap.get(hO.LocalVideoLowTrack);return e?(e.track.close(),this.doUnpublish(this.connection,[[hO.LocalVideoLowTrack,e]])):void 0}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(e=>{let[,{id:t}]=e;return t})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(e=>{let[t,{track:n}]=e;return{type:t,track:n}})),t.forEach(e=>{let[t]=e;this.statsCollector.removeLocalStats(t)}),0===this.localTrackMap.size&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==pO.Connected)throw new Cy(Ry.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter(t=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(e))&&void 0!==n&&n.get(t.id))});if(0!==n.length)return await this.connection.createDataChannels(e.uid,n),n.forEach(t=>{var n;this.remoteDataChannelMap.has(e)?null===(n=this.remoteDataChannelMap.get(e))||void 0===n||n.set(t.id,t):this.remoteDataChannelMap.set(e,new Map([[t.id,t]]));const r=this.pendingRemoteDataChannels.findIndex(n=>{let{user:r,id:i}=n;return r.uid===e.uid&&i===t.id});-1!==r&&this.pendingRemoteDataChannels.splice(r,1)}),n.map(e=>e.id)}async subscribe(e,t,n,r,i){var o;if(!this.connection||this.state!==pO.Connected)throw new Cy(Ry.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(o=this.remoteUserMap.get(e))&&void 0!==o&&o.has(t))return;let a,s,c;const u=this.connection.getPreMedia(n);if(u)fb.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),c=u.transceiver,a=u.track,s=u.id;else if(i){const n=i.find(e=>{let{stream_type:n}=e;return n===t});if(!n)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const r=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof dB&&(c=r.transceiver),a=r.track,s=r.id}else{const i=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof dB&&(c=i.transceiver),a=i.track,s=i.id}t===dO.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(a):(e._audioTrack=new vU(a,e.uid,e._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(a):(e._videoTrack=new IU(a,e.uid,e._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack)),XA("ENABLE_VIDEO_SEI")&&c&&(t==dO.VIDEO?await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!ZP().supportWebRTCEncodedTransform)return void fb.warning("browser not support video encoded transform");if(!e.track)return;if(MU.has(e)){const n=MU.get(e);return void(n&&(n.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(Jv()){if(!e.createEncodedStreams)return void fb.warning("browser not support createEncodedStreams() API");let t=null;try{t=e.createEncodedStreams()}catch(e){return void fb.error("create video-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(t,i){n.controller||(n.controller=i),e.track&&e.track.id!==n.track.id&&(fb.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r));const o=function(e){const t=new DataView(e.data);let n=0;for(;n+4<e.data.byteLength;){if(0===t.getUint8(n+0)&&0===t.getUint8(n+1)&&0===t.getUint8(n+2)&&1===t.getUint8(n+3)&&6===t.getUint8(n+4)){let r=n+6,i=0,o=0;for(;255===(o=t.getUint8(r++));)i+=255;i+=o;const a=PU(e.data,r,i);return new Uint8Array(a)}n++}return null}(t);o&&n.onSei&&n.onSei(o),i.enqueue(t)}});t.readable.pipeThrough(i).pipeTo(t.writable)}else if(Xv()){if("undefined"==typeof RTCRtpScriptTransform)return void fb.warning("browser not support RTCRtpScriptTransform");const t=OU(),i=new MessageChannel;await new Gh(e=>t.onmessage=t=>{"registered"===t.data&&e(void 0)});const o=new RTCRtpScriptTransform(t,{name:"rx",port:i.port2},[i.port2]);e.transform=o,await new Gh(e=>t.onmessage=t=>{"started"===t.data&&e(void 0)}),i.port1.onmessage=t=>{var i;t.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==n.track.id?(fb.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",r),n.track=e.track,n.track.addEventListener("ended",r)):t.data.sei&&n.onSei&&n.onSei(t.data.sei)},n.worker=t}function r(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",r)}!function(e){const t=MU.get(e);if(t){MU.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){fb.warning(e&&e.message)}}}(e)}MU.set(e,n),e.track.addEventListener("ended",r)}(c.receiver,{onSei:t=>{var n;null===(n=e._videoTrack)||void 0===n||n._onSei(t)}}):t==dO.AUDIO&&await async function(e){if(!ZP().supportWebRTCEncodedTransform)return void fb.warning("browser not support audio encoded transform");if(DU.has(e))return;const t={track:e.track};if(Jv()){if(!e.createEncodedStreams)return void fb.warning("browser not support createEncodedStreams() API");let r=null;try{r=e.createEncodedStreams()}catch(e){return void fb.error("create audio-encoded-streams error",e&&e.message)}const i=new TransformStream({transform(r,i){t.controller||(t.controller=i),e.track&&e.track.id!==t.track.id&&(fb.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n)),i.enqueue(r)}});r.readable.pipeThrough(i).pipeTo(r.writable)}else if(Xv()){if("undefined"==typeof RTCRtpScriptTransform)return void fb.warning("browser not support RTCRtpScriptTransform");const r=OU(),i=new MessageChannel;await new Gh(e=>r.onmessage=t=>{"registered"===t.data&&e(void 0)});const o=new RTCRtpScriptTransform(r,{name:"rx",port:i.port2},[i.port2]);e.transform=o,await new Gh(e=>r.onmessage=t=>{"started"===t.data&&e(void 0)}),i.port1.onmessage=r=>{var i;r.data.transformed&&e.track&&(null===(i=e.track)||void 0===i?void 0:i.id)!==t.track.id&&(fb.debug("audio track changed: ".concat(t.track.id," => ").concat(e.track.id)),t.track.removeEventListener("ended",n),t.track=e.track,t.track.addEventListener("ended",n))},t.worker=r}function n(){e.track.removeEventListener("ended",n),function(e){const t=DU.get(e);if(t){DU.delete(e);try{var n,r;null===(n=t.controller)||void 0===n||n.terminate(),null===(r=t.worker)||void 0===r||r.terminate()}catch(e){fb.warning(e&&e.message)}}}(e)}DU.set(e,t),e.track.addEventListener("ended",n)}(c.receiver));const l=this.remoteUserMap.get(e);l?l.set(t,s):this.remoteUserMap.set(e,new Map([[t,s]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const d=this.pendingRemoteTracks.findIndex(n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i});-1!==d&&(this.pendingRemoteTracks.splice(d,1),this.emit(_O.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==pO.Connected)throw new Cy(Ry.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(e=>{var t;let{user:n,mediaType:r}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(r))});const t=[],n=new Map;e.forEach(e=>{if(!this.connection)return;const r=this.connection.getPreMedia(e.ssrcId);r?n.set(e.ssrcId,r):t.push(e)});const r=await this.connection.batchReceive(t.map(e=>{let{user:t,mediaType:n,ssrcId:r,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:r,rtx:i}],mslabel:String(t._uintid)}}));t.forEach((e,t)=>{n.set(e.ssrcId,r[t])}),e.forEach(e=>{let{user:t,mediaType:r,ssrcId:i}=e;const o=n.get(i);if(!o)return void fb.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(t.uid," subscribe data,").concat(r,", ").concat(i));const{track:a,id:s,transceiver:c}=o;r===dO.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(a):(t._audioTrack=new vU(a,t.uid,t._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),c&&t._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(a):(t._videoTrack=new IU(a,t.uid,t._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),c&&t._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(t,t._videoTrack));const u=this.remoteUserMap.get(t);u?u.set(r,s):this.remoteUserMap.set(t,new Map([[r,s]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const l=this.pendingRemoteTracks.findIndex(e=>{let{user:n,kind:i}=e;return n.uid===t.uid&&r===i});-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(_O.MediaReconnectEnd,t.uid))})}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid});if(r.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),this.connection&&this.state===pO.Connected||n||r.forEach(t=>{let{kind:n}=t;var r;if(n===dO.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===dO.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==pO.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map(e=>{let[,{id:t}]=e;return t}));const o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),i.forEach(e=>{let[t,{kind:r}]=e;var i,o;if(r===dO.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===dO.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===dO.AUDIO){var a;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(a=t._audioTrack)||void 0===a||a._destroy(),t._audioTrack=void 0)}}),o}async unsubscribeDataChannel(e,t){if(t.forEach(e=>{const t=this.pendingRemoteDataChannels.findIndex(t=>t.id===e.id);-1!==t&&this.pendingRemoteDataChannels.splice(t,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(0===n.length)return;t.forEach(e=>{e._close()});const r=this.remoteDataChannelMap.get(e);return n.forEach(e=>{r&&r.delete(e.id)}),r&&0===r.size&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map(e=>e.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:n,mediaType:r}of e){const e=this.pendingRemoteTracks.filter(e=>{let{user:t,kind:i}=e;return void 0!==r?t.uid===n.uid&&r===i:t.uid===n.uid});e.forEach(e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)}),t=t.concat(e)}if(!this.connection||this.state!==pO.Connected)return void t.forEach(e=>{let{user:t,kind:n}=e;var r;if(n===dO.AUDIO)null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0;else if(n===dO.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}});const n=Jn(e).call(e,(e,t)=>{let{user:n,mediaType:r}=t;const i=this.filterTobeUnSubscribedTracks(n,r);return e.concat(i)},[]);if(0===n.length)return;await this.connection.stopReceiving(n.map(e=>{let[,{id:t}]=e;return t}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadInboundStats(),n.forEach(e=>{let[t,{kind:n}]=e;var r,i;if(n===dO.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===dO.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===dO.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0}}),r}isPreSubScribe(e){return!(!this.connection||this.state!==pO.Connected||!this.connection.getPreMedia(e))}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void fb.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void fb.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===dO.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||fb.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):fb.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get(hO.LocalAudioTrack);if((null==t?void 0:t.track)instanceof RM){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(e=>{let[t]=e;return t!==hO.LocalAudioTrack}).filter(t=>{let[n]=t;return!(e&&n===hO.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[n]=t;return!(e&&n===hO.LocalVideoLowTrack)}).map(e=>{let[,{track:t}]=e;return t})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get(hO.LocalAudioTrack),o=this.localTrackMap.get(r?hO.LocalVideoLowTrack:hO.LocalVideoTrack);vb.publish(this.store.sessionId,{eventElapse:rV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(mL.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const a=n.find(e=>e instanceof TM),s=r?null===(o=this.localTrackMap.get(hO.LocalVideoTrack))||void 0===o?void 0:o.track:n.find(e=>e instanceof aU);vb.publish(this.store.sessionId,{eventElapse:rV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==a?void 0:a.getTrackLabel(),videoName:null==s?void 0:s.getTrackLabel(),screenshare:-1!==(null==s?void 0:s._hints.indexOf(mL.SCREEN_TRACK)),audio:!!a,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===dO.VIDEO?n._videoSSRC:n._audioSSRC;i&&vb.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===dO.VIDEO,audio:r===dO.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:rV.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){fb.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new NA("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new FF({},this.store):new dB({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(hO.LocalAudioTrack);if((null==e?void 0:e.track)instanceof RM){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(e=>{t.removeAudioTrack(e)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=pO.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(hO.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(hO.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof aU||t&&t.track instanceof TM?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(d_(t=this.remoteUserMap).call(t)).find(t=>t.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(hO.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=aE(e).call(e,(e,t)=>e.level-t.level),e}async disconnectForReconnect(){this.connection&&(fb.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=pO.Reconnecting,XA("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new FF({},this.store):new dB({},this.store),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[n,{track:r}]=e;switch(n){case hO.LocalVideoTrack:Dn(t=r._hints).call(t,mL.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case hO.LocalAudioTrack:r instanceof RM?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r)}}),this.emit(_O.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(d_(n).call(n)).forEach(e=>{this.setPendingRemoteMedia(t,e)}),this.emit(_O.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,n]=e;Array.from(d_(n).call(n)).forEach(e=>{this.setPendingRemoteDataChannel(t,e)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),fb.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((e instanceof cF?e.uid:e)===r.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof cF?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return YI(function*(){if(!t.connection||t.state!==pO.Connected)return;const n=yield qI(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield qI(t.connection.restartICE(e));const n=yield qI(r.next());if(n.done)return;const i=n.value,o=yield i;switch(t.reportPCDisconnectedOrFailed(e),e){case lO.TCP:t._pcStatsUploadType=uO.TCP_RESTART;break;case lO.RELAY:t._pcStatsUploadType=uO.RELAY_RESTART;break;default:t._pcStatsUploadType=uO.OLD_RESTART}t._isInRestartIce=!0,r.next(o)}catch(e){var i;null===(i=r)||void 0===i||i.throw(e)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(hO.LocalVideoTrack),n=this.localTrackMap.get(hO.LocalAudioTrack),r=e.videoSend.find(e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId)),i=e.audioSend.find(e=>e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId));if(!r||!i)return 1;const o=eA(this,_O.NeedSignalRTT),a=r?r.rttMs:void 0,s=i?i.rttMs:void 0,c=a&&s?(a+s)/2:a||s,u=100*e.sendPacketLossRate*.7/50+.3*((c&&o?(c+o)/2:c||o)||0)/1500,l=u<.17?1:u<.36?2:u<.59?3:u<.1?4:5,d=null==t?void 0:t.track;if(d&&d._encoderConfig&&-1===d._hints.indexOf(mL.SCREEN_TRACK)){const t=d._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return bb[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][l]}}return l}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,a=e.audioRecv.find(e=>e.ssrc===i),s=e.videoRecv.find(e=>e.ssrc===o);if(!a&&!s)return void(t+=1);const c=eA(this,_O.NeedSignalRTT),u=e.rtt,l=(u&&c?(u+c)/2:u||c)||0,d=a?a.jitterMs:void 0,h=e.recvPacketLossRate;let p=.7*h*100/50+.3*l/1500;d&&(p=.6*h*100/50+.2*l/1500+.2*d/400),t+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Gh((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}async replaceTrack(e,t){var n;if(fb.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==pO.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(!r)return;const i=r[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),r[1].track=t),await(null===(n=this.connection)||void 0===n?void 0:n.replaceTrack(t,r[1].id)),this.isPlanB){const e=r[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,e)}if(i===hO.LocalVideoTrack&&!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding){const t=this.localTrackMap.get(hO.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new Gh((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)})}}}filterTobePublishedTracks(e,t,n){const r=[],i=this.getAllTracks();e=rA(e=e.filter(e=>-1===i.indexOf(e)));let o,a=!1;const s=this.localTrackMap.get(hO.LocalAudioTrack);for(const i of e){if(i instanceof aU&&(this.localTrackMap.has(hO.LocalVideoTrack)||a?new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:i,type:hO.LocalVideoTrack}),a=!0),t)){const e=this.getLowVideoTrack(i,n);r.push({track:e,type:hO.LocalVideoLowTrack})}if(i instanceof TM)if(s){const e=s.track;if(e instanceof RM)uF([i]),e.addAudioTrack(i),this.bindLocalAudioTrackEvents(i,!0);else{const t=hF([e,i]);fb.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(t.getTrackId(),"]")),this.replaceTrack(e,t)}}else o instanceof RM?(uF([i]),o.addAudioTrack(i)):o=o||!i._useAudioElement&&ZP().webAudioMediaStreamDest&&!i._bypassWebAudio?hF(o?[i,o]:[i]):i}return o&&(fb.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),r.push({track:o,type:hO.LocalAudioTrack})),r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=rA(e=e.filter(e=>-1!==n.indexOf(e)));for(const n of e){if(n instanceof TM){const e=this.localTrackMap.get(hO.LocalAudioTrack);if(!e)continue;e.track instanceof RM?(e.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),0===e.track.trackList.length&&(t.push([hO.LocalAudioTrack,e]),e.track.close())):t.push([hO.LocalAudioTrack,e])}if(n instanceof aU){const e=this.localTrackMap.get(hO.LocalVideoTrack);if(!e)continue;t.push([hO.LocalVideoTrack,e]);const n=this.localTrackMap.get(hO.LocalVideoLowTrack);n&&t.push([hO.LocalVideoLowTrack,n])}}return t}filterTobePublishedDataChannels(e){return(e=rA(e)).filter(e=>-1===this.localDataChannels.findIndex(t=>t.id===e.id))}filterTobeUnpublishedDataChannels(e){return(e=(e=rA(e)).filter(e=>-1!==this.localDataChannels.indexOf(e))).filter(e=>e._originDataChannel)}bindLocalTrackEvents(e){e.forEach(e=>{let{track:t,type:n}=e;switch(n){case hO.LocalVideoTrack:t.addListener(fL.GET_STATS,this.handleGetLocalVideoStats),t.addListener(fL.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(fL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(fL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO.LocalAudioTrack:this.bindLocalAudioTrackEvents(t)}})}bindLocalAudioTrackEvents(e,t){e instanceof RM?e.trackList.forEach(e=>{e.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(fL.GET_STATS,this.handleGetLocalAudioStats),e.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(fL.GET_STATS,this.handleGetLocalAudioStats),e.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(fL.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:n}]=e;return{track:n,type:t}})),e.forEach(e=>{let{track:t,type:n}=e;switch(n){case hO.LocalVideoTrack:t.off(fL.GET_STATS,this.handleGetLocalVideoStats),t.off(fL.GET_RTC_STATS,this.handleGetRTCStats),t.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(fL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(fL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t)}})}unbindLocalAudioTrackEvents(e){e instanceof RM?e.trackList.forEach(e=>{e.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(fL.GET_STATS,this.handleGetLocalAudioStats),e.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(fL.GET_STATS,this.handleGetLocalAudioStats),e.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(fL.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof IU&&t.addListener(fL.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(e))}),t instanceof vU&&t.addListener(fL.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(fL.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(dO.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(dO.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((e,n)=>{var r;let i,o,{track:a,type:s}=e;switch(s){case hO.LocalAudioTrack:i=Zw.Audio,o={dtx:a instanceof SM&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case hO.LocalVideoTrack:i=Dn(r=a._hints).call(r,mL.SCREEN_TRACK)?Zw.Screen:Zw.High,o=pB(pB({},ZO(a)),{},{codec:this.store.codec,svc_mode:BU()});break;case hO.LocalVideoLowTrack:i=Zw.Low,o=pB(pB({},ZO(a)),{},{codec:this.store.codec,svc_mode:BU()})}return{stream_type:i,attributes:o,ssrcs:t[n]}})}createGatewayUnpublishMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case hO.LocalVideoTrack:n=Dn(t=i._hints).call(t,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalAudioTrack:n=Zw.Audio;break;case hO.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:o,mid:a}})}assignLocalTracks(e,t){e.forEach((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(_O.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),XA("NEW_ICE_RESTART")){var n;if(Dn(n=this._restartStates).call(n,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(fb.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(t)),"CONNECTED"===eA(this,_O.QueryClientConnectionState)&&this.emit(_O.RequestRestartICE,t))},n=()=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),fb.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(_O.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},r=XA("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(XA("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ZP().supportPCSetConfiguration)t(lO.RELAY),this._restartTimer=window.setTimeout(n,r);else if(Zv())t(lO.UDP),this._restartTimer=window.setTimeout(n,4e3);else{if(t(lO.TCP),ZP().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{t(lO.RELAY),this._restartTimer=window.setTimeout(n,r)},r));this._restartTimer=window.setTimeout(n,r)}},800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout(()=>{"disconnected"===e.iceConnectionState&&XA("ICE_RESTART")&&"CONNECTED"===eA(this,_O.QueryClientConnectionState)&&this.emit(_O.RequestRestartICE)},800),void setTimeout(()=>{"disconnected"===e.peerConnectionState&&(fb.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(_O.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);"failed"===t&&(fb.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(_O.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),vb.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:jy.TRACER}).onSuccess(),this.emit(_O.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(d_(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(IL.FIRST_FRAME_DECODED),vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_AUDIO_DECODE,Rb.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(d_(t=this.remoteUserMap).call(t)).find(t=>t._audioSSRC===e);n&&vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_AUDIO_RECEIVED,Rb.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(d_(t=this.remoteUserMap).call(t)).find(t=>t._videoSSRC===e);n&&vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_VIDEO_RECEIVED,Rb.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType;"unknown"!==t.candidateType&&n===("relay"===t.candidateType)||this.emit(_O.ConnectionTypeChange,n),fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(nN(t))," -> ").concat(JSON.stringify(nN(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(nN(t))," -> ").concat(JSON.stringify(nN(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return pB(pB({},e),t)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get(hO.LocalAudioTrack);if(e instanceof TM&&(null==n?void 0:n.track)instanceof RM)return n.track.isActive||t.push([hO.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(r&&(t.push(r),r[0]===hO.LocalVideoTrack)){const e=this.localTrackMap.get(hO.LocalVideoLowTrack);e&&t.push([hO.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(hO.LocalAudioTrack);if(e instanceof TM&&(null==n?void 0:n.track)instanceof RM)return n.track.isActive&&t.push([hO.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(t=>{let[,{track:n}]=t;return e===n});if(r)if(r[0]===hO.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get(hO.LocalVideoLowTrack);e&&t.push([hO.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case hO.LocalAudioTrack:n=Zw.Audio;break;case hO.LocalVideoTrack:n=Dn(t=i._hints).call(t,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:o,mid:a}})}createUnmuteMessage(e){return e.map(e=>{var t;let n,[r,{track:i,ssrcs:o,id:a}]=e;switch(r){case hO.LocalAudioTrack:n=Zw.Audio;break;case hO.LocalVideoTrack:n=Dn(t=i._hints).call(t,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:o,mid:a}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach(t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])});return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach(t=>{var r;null!==(r=this.remoteDataChannelMap.get(e))&&void 0!==r&&r.has(t.id)&&n.push(t)}),n}createUnsubscribeMessage(e){const t=[];return e.forEach(e=>{let[n,{kind:r}]=e;switch(r){case dO.VIDEO:return void(n._videoSSRC&&t.push({stream_type:dO.VIDEO,ssrcId:n._videoSSRC}));case dO.AUDIO:return void(n._audioSSRC&&t.push({stream_type:dO.AUDIO,ssrcId:n._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(e=>{let[n,{kind:r}]=e;if(t.has(n)){let e=t.get(n);e|=r===dO.VIDEO?tO.Video:tO.Audio,t.set(n,e)}else t.set(n,r===dO.VIDEO?tO.Video:tO.Audio)}),{users:Array.from(t.entries()).map(e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}})}}withdrawRemoteTracks(e){e.forEach(e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(hO.LocalVideoTrack),n=this.localTrackMap.get(hO.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t,n){return e.map((e,r)=>{var i;let{stream_type:o}=e;const a=null===(i=t.find(e=>{let{stream_type:t}=e;return o===t}))||void 0===i?void 0:i.attributes;if(a&&XA("DISABLE_SCREEN_SHARE_REMB")){const e=n[r]._hints;(Dn(e).call(e,mL.SCREEN_TRACK)||Dn(e).call(e,mL.SCREEN_LOW_TRACK))&&(a.remb=!1,fb.debug("disable remb for screen share, hints:",e))}return a})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof TM){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(0===r.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(r.map(e=>{let[,{id:t}]=e;return t})));const i=this.createUnmuteMessage(r);return void await $y(this,_O.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(_O.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(_O.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await mA(LA(this.dtlsFailedCount,PA)),this.emit(_O.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Zy(this,_O.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(_O.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(hO.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof aU)}throwIfTrackTypeNotMatch(e){if(e.filter(e=>e instanceof aU).length>1)throw new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(e=>e instanceof TM).length>1&&(e.some(e=>e instanceof TM&&e._bypassWebAudio)||!ZP().webAudioMediaStreamDest))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof aU&&this.pendingLocalTracks.some(e=>e instanceof aU))throw new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof TM&&this.pendingLocalTracks.some(e=>e instanceof TM)&&(!ZP().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(e=>e instanceof TM&&e._bypassWebAudio)))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const r=!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding,i=pB(pB({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=r?e._mediaStreamTrack.clone():KV(e,i);const a=TA(8,"track-low-"),s=new aU(o,pB(pB({},r&&{scaleResolutionDownBy:iN(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,a);return s.on(RL.TRANSCEIVER_UPDATED,t=>{e._updateRtpTransceiver(t,TL.LOW_STREAM)}),s._hints.push(mL.LOW_STREAM),Dn(n=e._hints).call(n,mL.SCREEN_TRACK)&&s._hints.push(mL.SCREEN_LOW_TRACK),e.on("sei-to-send",e=>{s.emit("sei-to-send",e)}),e.addListener(fL.NEED_CLOSE,()=>{s.close()}),s}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof dB){var i,o,a,s;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u,dtlsTransportState:l,peerConnectionState:d}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();vb.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:u,dtlsstate:l,connectionstate:d,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:null!==(i=null==h?void 0:h.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(o=h.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(a=p.protocol)&&void 0!==a?a:"",selectedRemoteCandidateType:null!==(s=p.candidateType)&&void 0!==s?s:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:n,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(d_(i=this.remoteUserMap).call(i)).find(t=>t._videoSSRC===e);if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,a=i.subscribe.find(e=>e.userId===o.uid&&"video"===e.type);vb.firstRemoteVideoDecode(this.store.sessionId,gb.FIRST_VIDEO_DECODE,Rb.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==a?void 0:a.subscribeEnd)||0,subscriberStart:(null==a?void 0:a.subscribeStart)||0,videoAddNotify:(null==a?void 0:a.streamAdded)||0,state:r?1:0,firstFrame:(null==a?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.connection.getRemoteSSRC(i);return void 0!==o&&o!==n}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===hO.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,TL.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof dB&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this.reportPCStats(Date.now(),!1,this._pcStatsUploadType===uO.TCP_RESTART&&e===lO.RELAY?this._pcStatsUploadType:uO.DISCONNECTED_OR_FAILED)))}},Cw(uB.prototype,"startP2PConnection",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"startP2PConnection"),uB.prototype),Cw(uB.prototype,"connect",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"connect"),uB.prototype),Cw(uB.prototype,"updateRemoteRTPCapabilities",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"updateRemoteRTPCapabilities"),uB.prototype),Cw(uB.prototype,"publishDataChannel",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"publishDataChannel"),uB.prototype),Cw(uB.prototype,"unpublish",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unpublish"),uB.prototype),Cw(uB.prototype,"unpublishDataChannel",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unpublishDataChannel"),uB.prototype),Cw(uB.prototype,"unpublishLowStream",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unpublishLowStream"),uB.prototype),Cw(uB.prototype,"subscribeDataChannel",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"subscribeDataChannel"),uB.prototype),Cw(uB.prototype,"subscribe",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"subscribe"),uB.prototype),Cw(uB.prototype,"massSubscribe",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"massSubscribe"),uB.prototype),Cw(uB.prototype,"unsubscribe",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unsubscribe"),uB.prototype),Cw(uB.prototype,"unsubscribeDataChannel",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unsubscribeDataChannel"),uB.prototype),Cw(uB.prototype,"massUnsubscribe",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"massUnsubscribe"),uB.prototype),Cw(uB.prototype,"muteRemote",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"muteRemote"),uB.prototype),Cw(uB.prototype,"unmuteRemote",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unmuteRemote"),uB.prototype),Cw(uB.prototype,"hasRemoteMediaWithLock",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"hasRemoteMediaWithLock"),uB.prototype),Cw(uB.prototype,"disconnectForReconnect",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"disconnectForReconnect"),uB.prototype),Cw(uB.prototype,"updateBitrateLimit",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"updateBitrateLimit"),uB.prototype),Cw(uB.prototype,"remoteMediaSsrcChanged",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"remoteMediaSsrcChanged"),uB.prototype),uB);function mB(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return await r.apply(this,o)}finally{n()}},n}const TB={};function SB(e){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&fb.debug("install service ".concat(e.name)),TB[e.name]=e}function gB(e){const t=TB[e];if(!t)throw new Cy(Ry.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function RB(e,t){return gB("DataStream").create(e,t)}function CB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function IB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CB(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const vB=Date.now(),yB=20,AB=new Map,bB=new Map;async function wB(e){const t=AB.get(e),n=Array.isArray(t)&&t[t.length-1],r=bB.get(e);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};0===r.firstRecvTs&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const o=n.sendTs-r.firstSendTs,a=o-(Date.now()-r.firstRecvTs);a>0&&(r.firstRecvTs=Date.now()-o);let s=n.mediaDelay+a;s<=0?(t.pop(),OB(n.context,i),s=0):s=Math.min(s,yB),setTimeout(()=>t.length&&wB(e),s)}function OB(e,t){e.safeEmit(zy.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function NB(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return OB(n,{uid:e.uid,payload:e.payload});const r="".concat(n.id,"-").concat(e.uid),i=AB.get(r)||[],o=i.findIndex(t=>e.sendTs>=t.sendTs),a=IB(IB({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});-1===o?i.push(a):i.splice(o,0,a),AB.set(r,i);let s=!1;var c;bB.has(r)?s=!(null===(c=bB.get(r))||void 0===c||!c.isSyncing):bB.set(r,{isSyncing:s,firstRecvTs:0,firstSendTs:0}),s||wB(r)}const DB=Hv().name;function PB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function LB(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?PB(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PB(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const kB="websdk_ng_cache_parameter",MB=XA("MAX_PRELOAD_ASYNC_LENGTH"),UB=1e4,xB=new Map,VB=[];let FB=null,BB=0,jB=0;const GB=new Map,WB=function(e,t){const n=[];let r=0;const i=async()=>{const e=n.shift();e&&await e(),n.length>0&&r<t?i():r--};return async function(){for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return new Gh(async(o,s)=>{n.push(async()=>{try{const t=await e(...a);o(t)}catch(e){s(e)}}),r<t&&(r++,i())})}}(KB,MB),HB=Lv.CancelToken.source();async function KB(e,t,n,r,i,o){try{if(!XA("ENABLE_PRELOAD"))return;if(!ZP().supportWebCrypto)return void dA(()=>{fb.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&null!==n)throw new Cy(Ry.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&by(n,"token",1,2047),by(e,"appid",1,2047),xw(t),r&&Vw(r);const a=SA();fb.debug("preload channel ".concat(t,", uid is ").concat(r));const s={appId:e,cname:t,token:n||e,uid:"string"!=typeof r?r:null,sid:a,proxyServer:i};let c,u;"string"==typeof r?(s.stringUid=r,[u,c]=await Gh.all([qx(r,{sid:a,appId:e},HB.token),Jx(LB(LB({},s),{},{token:n||e,uid:0}),HB.token)]),s.uid=u.uid,c.gatewayInfo.uid=s.uid,c.gatewayInfo.res.uid=s.uid):(o&&(s.stringUid=o),c=await Jx(s,HB.token));const l={sid:a,appId:e,cname:t,token:n||e,uid:s.stringUid||r,intUid:s.uid||c.gatewayInfo.uid,stringUid:s.stringUid,ts:Date.now(),sua:u,ap:c};await async function(e){let t;try{e.uid&&qB({appId:e.appId,cname:e.cname,token:e.token,uid:e.uid,stringUid:e.stringUid});const n=$B(e),r=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",hA(t),"AES-GCM",!1,["encrypt"]),r=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,lA(window.btoa(JSON.stringify(e))));return uA(new Uint8Array(r))}catch(e){return}}(e,e.token||e.appId);if(!r)return;t=QB(kB);const i=t?JSON.parse(t):[];i.push({[n]:r}),i.length>XA("AP_CACHE_NUM")&&i.shift(),ZB(kB,JSON.stringify(i))}catch(e){fb.warn("Error caching server parameters:",e.message),ZB(kB,"")}}(l),BB++}catch(e){throw jB++,function(e){FB||(FB=window.setTimeout(()=>{let t="";GB.forEach((e,n)=>{t+="".concat(n,": ").concat(e," ;")}),vb.reportApiInvoke(null,{name:By.PRELOAD,options:{success:BB,failed:jB,err:t}}).onError(e),BB=0,jB=0,GB.clear(),FB=null},UB));const t=GB.get(e.code)||0;GB.set(e.code,t+1)}(e),e}}async function YB(e){try{if(XA("AP_REQUEST_DETAIL"))return;const t=qB(e);if(!t||"disabled"!==e.cloudProxyServer)return;const n=await async function(e,t){try{const n=await window.crypto.subtle.importKey("raw",hA(t),"AES-GCM",!1,["decrypt"]),r=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},n,lA(e));return JSON.parse(window.atob(uA(new Uint8Array(r))))}catch(e){return}}(t,e.token||e.appId);if(!n)return;if(!function(e,t){return!(e.cname!==t.cname||e.appId!==t.appId||e.token!==t.token)&&(t.stringUid?e.stringUid===t.stringUid:"number"==typeof t.uid?e.uid===t.uid:e.uid==t.uid)}(n,e))return;if(n&&Date.now()-n.ts<XA("AP_CACHE_LIFETIME"))return n}catch(e){fb.warn("Error get preloadInfo",e.message)}}function qB(e){let t;try{if(t=QB(kB),!t)return;const n=JSON.parse(t),r=$B(e),i=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(n,e=>r in e);if(-1===i)return;const o=n.splice(i,1)[0];return ZB(kB,JSON.stringify(n)),o[r]}catch(e){fb.warn("Error delete preload info: ".concat(t),e.message),ZB(kB,"")}}function zB(e){if(e){let t=xB.get(e);t&&(window.clearTimeout(t),t=null,xB.delete(e)),Dn(VB).call(VB,e)||"disabled"!==e.cloudProxyServer||VB.push(e)}if(xB.size<XA("AP_CACHE_NUM")&&VB.length>0){const e=VB.shift();xB.set(e,window.setTimeout(async()=>{const{appId:t,cname:n,token:r,stringUid:i,uid:o,proxyServer:a}=e;try{await WB(t,n,r,o,a,i),xB.has(e)&&zB(e)}catch(t){fb.warn("update preload failed",t.message),JB(e)}},XA("AP_UPDATE_INTERVAL")))}}function JB(e){const t=VB.indexOf(e);-1!==t&&VB.splice(t,1);let n=xB.get(e);n&&(window.clearTimeout(n),n=null,xB.delete(e),zB())}function XB(e,t){const n=e.sua,r=e.ap;t&&n&&vb.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),vb.reportResourceTiming(e.ap.url,e.sid),vb.joinWebProxyAP(e.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(e=>e.ip).join(","),eventType:"disabled",unilbsServerIds:[YO.CHOOSE_SERVER,YO.CLOUD_PROXY_FALLBACK].toString()}),vb.joinChooseServer(e.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(e=>e.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[YO.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function QB(e){return window.atob(window.localStorage.getItem(e)||"")}function ZB(e,t){window.localStorage.setItem(e,window.btoa(t))}function $B(e){let t="".concat(e.appId,"_").concat(e.cname);return"string"==typeof e.uid&&(t+="_s_".concat(e.uid)),"number"==typeof e.uid&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),bA(t)}function ej(e){let t=function(){const e=rj.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(Ej(t,10),uj(t,n));let r=e.cid;void 0!==r&&(Ej(t,16),Ej(t,r));let i=e.cname;void 0!==i&&(Ej(t,26),uj(t,i));let o=e.deviceId;void 0!==o&&(Ej(t,34),uj(t,o));let a=e.elapse;void 0!==a&&(Ej(t,40),mj(t,a));let s=e.fileSize;void 0!==s&&(Ej(t,48),mj(t,nj(s)));let c=e.height;void 0!==c&&(Ej(t,56),mj(t,nj(c)));let u=e.jpg;void 0!==u&&(Ej(t,66),Ej(t,u.length),dj(t,u));let l=e.networkType;void 0!==l&&(Ej(t,72),mj(t,nj(l)));let d=e.osType;void 0!==d&&(Ej(t,80),mj(t,nj(d)));let h=e.requestId;void 0!==h&&(Ej(t,90),uj(t,h));let p=e.sdkVersion;void 0!==p&&(Ej(t,98),uj(t,p));let f=e.sequence;void 0!==f&&(Ej(t,104),mj(t,nj(f)));let m=e.sid;void 0!==m&&(Ej(t,114),uj(t,m));let g=e.timestamp;void 0!==g&&(Ej(t,120),mj(t,g));let v=e.uid;void 0!==v&&(Ej(t,128),Ej(t,v));let E=e.vid;void 0!==E&&(Ej(t,136),Ej(t,E));let y=e.width;void 0!==y&&(Ej(t,144),mj(t,nj(y)));let _=e.service;void 0!==_&&(Ej(t,152),Ej(t,_));let b=e.callbackData;void 0!==b&&(Ej(t,162),Ej(t,b.length),dj(t,b));let S=e.ticket;void 0!==S&&(Ej(t,170),uj(t,S));let w=e.vendorConfigs;void 0!==w&&(Ej(t,178),uj(t,w))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function tj(e){return function(e){let t={};e:for(;!sj(e);){let n=_j(e);switch(n>>>3){case 0:break e;case 1:t.code=_j(e);break;case 2:t.msg=lj(e,_j(e));break;case 3:t.requestId=lj(e,_j(e));break;case 4:t.timestamp=fj(e,!1);break;default:ij(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function ij(e,t){switch(t){case 0:for(;128&hj(e););break;case 2:oj(e,_j(e));break;case 5:oj(e,4);break;case 1:oj(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function nj(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let rj=[];function oj(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function sj(e){return e.offset>=e.limit}function aj(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function cj(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function dj(e,t){let n=aj(e,t.length);e.bytes.set(t,n)}function lj(e,t){let n=cj(e,t),r=String.fromCharCode,i=e.bytes,o="",a="";for(let e=0;e<t;e++){let s,c,u,l,d=i[e+n];128&d?192==(224&d)?e+1>=t?a+=o:(s=i[e+n+1],128!=(192&s)?a+=o:(l=(31&d)<<6|63&s,l<128?a+=o:(a+=r(l),e++))):224==(240&d)?e+2>=t?a+=o:(s=i[e+n+1],c=i[e+n+2],32896!=(49344&(s|c<<8))?a+=o:(l=(15&d)<<12|(63&s)<<6|63&c,l<2048||l>=55296&&l<=57343?a+=o:(a+=r(l),e+=2))):240==(248&d)?e+3>=t?a+=o:(s=i[e+n+1],c=i[e+n+2],u=i[e+n+3],8421504!=(12632256&(s|c<<8|u<<16))?a+=o:(l=(7&d)<<18|(63&s)<<12|(63&c)<<6|63&u,l<65536||l>1114111?a+=o:(l-=65536,a+=r(55296+(l>>10),56320+(1023&l)),e+=3))):a+=o:a+=r(d)}return a}function uj(e,t){let n=t.length,r=0;for(let e=0;e<n;e++){let i=t.charCodeAt(e);i>=55296&&i<=56319&&e+1<n&&(i=(i<<10)+t.charCodeAt(++e)-56613888),r+=i<128?1:i<2048?2:i<65536?3:4}Ej(e,r);let i=aj(e,r),o=e.bytes;for(let e=0;e<n;e++){let r=t.charCodeAt(e);r>=55296&&r<=56319&&e+1<n&&(r=(r<<10)+t.charCodeAt(++e)-56613888),r<128?o[i++]=r:(r<2048?o[i++]=r>>6&31|192:(r<65536?o[i++]=r>>12&15|224:(o[i++]=r>>18&7|240,o[i++]=r>>12&63|128),o[i++]=r>>6&63|128),o[i++]=63&r|128)}}function hj(e){return e.bytes[cj(e,1)]}function pj(e,t){let n=aj(e,1);e.bytes[n]=t}function _j(e){let t,n=0,r=0;do{t=hj(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function Ej(e,t){for(t>>>=0;t>=128;)pj(e,127&t|128),t>>>=7;pj(e,t)}function fj(e,t){let n,r=0,i=0,o=0;return n=hj(e),r=127&n,128&n&&(n=hj(e),r|=(127&n)<<7,128&n&&(n=hj(e),r|=(127&n)<<14,128&n&&(n=hj(e),r|=(127&n)<<21,128&n&&(n=hj(e),i=127&n,128&n&&(n=hj(e),i|=(127&n)<<7,128&n&&(n=hj(e),i|=(127&n)<<14,128&n&&(n=hj(e),i|=(127&n)<<21,128&n&&(n=hj(e),o=127&n,128&n&&(n=hj(e),o|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|o<<24,unsigned:t}}function mj(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=aj(e,o),s=e.bytes;switch(o){case 10:s[a+9]=i>>>7&1;case 9:s[a+8]=9!==o?128|i:127&i;case 8:s[a+7]=8!==o?r>>>21|128:r>>>21&127;case 7:s[a+6]=7!==o?r>>>14|128:r>>>14&127;case 6:s[a+5]=6!==o?r>>>7|128:r>>>7&127;case 5:s[a+4]=5!==o?128|r:127&r;case 4:s[a+3]=4!==o?n>>>21|128:n>>>21&127;case 3:s[a+2]=3!==o?n>>>14|128:n>>>14&127;case 2:s[a+1]=2!==o?n>>>7|128:n>>>7&127;case 1:s[a]=1!==o?128|n:127&n}}const Tj={},Sj={},gj=4294967296,Rj=gj*gj,Cj=Rj/2,Ij=wj(0,!0),vj=wj(0),yj=Oj(0,-2147483648,!1),Aj=Oj(-1,2147483647,!1),bj=Oj(-1,-1,!0);function wj(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=Sj[e],r)?r:(n=Oj(e,0,!0),i&&(Sj[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=Tj[e],r)?r:(n=Oj(e,e<0?-1:0,!1),i&&(Tj[e]=n),n)}function Oj(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function Nj(e,t){if(isNaN(e))return t?Ij:vj;if(t){if(e<0)return Ij;if(e>=Rj)return bj}else{if(e<=-Cj)return yj;if(e+1>=Cj)return Aj}return e<0?t?Ij:vj:Oj(e%gj|0,e/gj|0,t)}function Dj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}class Pj extends xy{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(RO.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var t;super(),Fg(this,"name","AgoraRTCImageModeration"),Fg(this,"_connectionState",gO.CONNECTING),Fg(this,"_sequence",0),Fg(this,"_moderationStartTime",void 0),Fg(this,"_workerConnection",void 0),Fg(this,"_workerMessageLengthLimit",void 0),Fg(this,"_qualityRatio",void 0),Fg(this,"_connectInfo",void 0),Fg(this,"_cancelTokenSource",Lv.CancelToken.source()),Fg(this,"_retryConfig",void 0),Fg(this,"_moderationInterval",void 0),Fg(this,"_moderationTimer",null),Fg(this,"_moderationMode",1),Fg(this,"_quality",1),Fg(this,"_qualityTimer",null),Fg(this,"_ticket",void 0),Fg(this,"_moderationIntervalMinimum",void 0),Fg(this,"_uploadFailedNum",0),Fg(this,"_uploadNum",0),Fg(this,"_uploadTimer",null),Fg(this,"_extraInfo",void 0),Fg(this,"_vendor",""),Fg(this,"_encoder",new TextEncoder),Fg(this,"_moderationId",void 0),Fg(this,"inspectImage",()=>{if(this.connectionState!==gO.CONNECTED)throw new yb(Ry.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===gO.CONNECTED?this.requestToInspectImage():fb.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=TA(5,"image-moderation-"),this._workerMessageLengthLimit=XA("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=XA("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=XA("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new HO("worker-"+this._moderationId,PA),this.on(RO.STATE_CHANGE,(e,t)=>{fb.debug("[".concat(this._moderationId,"] Moderation operation :").concat(CO[e]," ").concat(t||""))}),this.handleWorkerEvents()}async init(e,t){this.emit(RO.STATE_CHANGE,CO.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new Gh((r,i)=>{this.on(RO.CONNECTION_STATE_CHANGE,(e,t)=>{e===gO.CONNECTED&&r()}),this.requestAP(e,n,t).then(e=>{this.connectWorker(e)}).catch(e=>{i(e)})})}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),fb.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===gO.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){const r=XA("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:a,sid:s,token:c,uid:u}=t;Bx++;const l="moderation_plugin",d={service_name:l,json_body:JSON.stringify({appId:i,areaCode:o,cname:a,command:"allocateEdge",requestId:Bx,seq:Bx,sid:s,appToken:c,ts:Date.now(),uid:u+""})};let h,p,f=e[0];return kA(async()=>{h=Date.now();const e=await Tx(f,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new yb(Ry.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:p});throw fb.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new yb(Ry.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw fb.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new yb(Ry.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:p});throw fb.error(e.toString()),e}if(!t.servers.some(e=>!!e.wss)){const e=new yb(Ry.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:p});throw fb.error(e.toString()),e}const r=XA("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map(e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(n,"/moderation")}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:p}},(t,n)=>(vb.apworkerEvent(s,{success:!0,sc:200,serviceName:l,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1),(t,n)=>(vb.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:l,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==Ry.OPERATION_ABORTED&&t.code!==Ry.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0)),r)}(r,e,t,n);this.emit(RO.STATE_CHANGE,CO.AP_CONNECTED);const{addressList:o,ticket:a}=i;return this._ticket=a,o}async connectWorker(e){this.emit(RO.STATE_CHANGE,CO.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Uw.CONNECTED,async()=>{this.emit(RO.STATE_CHANGE,CO.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=gO.CONNECTED}),this._workerConnection.on(Uw.CLOSED,()=>{this.connectionState=gO.CLOSED}),this._workerConnection.on(Uw.FAILED,()=>{this.connectionState=gO.CLOSED}),this._workerConnection.on(Uw.RECONNECTING,()=>{this.connectionState=this.connectionState===gO.CONNECTED?gO.RECONNECTING:gO.CONNECTING}),this._workerConnection.on(Uw.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const t=tj(new Uint8Array(e.data));XA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&fb.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,fb.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{vb.reportApiInvoke(this._connectInfo.sid||null,{name:By.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:jy.TRACER}).onError(new yb(Ry.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null},XA("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else fb.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Uw.WILL_RECONNECT,(e,t,n)=>{"recover"===e&&n(e),n("tryNext")}),this._workerConnection.on(Uw.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=eA(this,RO.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(XA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&fb.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else XA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&fb.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s}=t;const c=Date.now(),u=await e.getCurrentFrameImage("image/jpeg",this.quality),l=await Ok(u,n,r),d=this._sequence+"-"+i+"-"+s+"-"+c+"-"+TA(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:Pj.intToLong(Number(c-this._moderationStartTime)),fileSize:u.buffer.byteLength,height:u.height,width:u.width,jpg:l,networkType:6,osType:7,requestId:d,sdkVersion:"4.22.1",sequence:this._sequence,sid:a,timestamp:Nj(c),uid:s,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};void 0===this._extraInfo&&delete h.callbackData;const p=ej(h);if(p.byteLength<this._workerMessageLengthLimit){if(XA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dj(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dj(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},h);delete e.jpg,fb.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return p}return this.quality=this.quality*this._qualityRatio,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s})}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Lv.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=gO.CLOSED,this.emit(RO.STATE_CHANGE,CO.CLOSED)}}function Lj(e){if(yy(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new yb(Ry.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new yb(Ry.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const kj={name:"ImageModeration",create:function(e){let{config:t}=e;return Lj(t),new Pj(t)}};var Mj,Uj,xj,Vj,Fj,Bj,jj,Gj,Wj,Hj,Kj,Yj,qj,zj,Jj,Xj,Qj,Zj,$j,eG,tG,iG,nG,rG,oG,sG,aG,cG,dG,lG,uG,hG,pG,_G,EG,fG,mG,TG,SG,gG,RG;function CG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function IG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?CG(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):CG(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}NA.setLogger(fb);let vG=(Mj=Ib(),Uj=Ib({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof HL))return[t];t=[t]}return t.map(e=>e?Object(e).toString():"null")}}),xj=Ib({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==vL.DATA?(Array.isArray(t)||(t=[t]),t.map(e=>e.getTrackId())):[t.getChannelId()])}),Vj=Ib({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),Fj=Ib({argsMap:(e,t,n)=>[t,n]}),Bj=Ib({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:n}=e;return[null==t?void 0:t.uid,n]})}),jj=Ib({argsMap:(e,t,n,r)=>["object"==typeof t?t.uid:t,n,r]}),Gj=Ib({argsMap:(e,t)=>t.map(e=>{let{user:t,mediaType:n}=e;return{uid:null==t?void 0:t.uid,mediaType:n}})}),Wj=Ib(),Hj=Ib(),Kj=Ib(),Yj=Ib(),qj=Ib(),zj=Ib(),Jj=Ib(),Xj=Ib(),Qj=Ib(),Zj=Ib(),$j=Ib(),eG=Ib(),tG=Ib(),iG=Ib(),nG=Ib({argsMap:(e,t)=>[t]}),rG=Ib(),oG=Ib(),sG=Ib(),aG=Ib(),cG=Ib(),dG=Ib(),lG=Ib(),uG=Ib(),hG=Ib({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),pG=Ib(),_G=Ib(),EG=Ib(),fG=Ib(),mG=Ib(),TG=Ib(),SG=Ib({reportResult:!0}),gG=Ib(),RG=class extends xy{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),Fg(this,"store",void 0),Fg(this,"_uid",void 0),Fg(this,"_channelName",void 0),Fg(this,"_uintUid",void 0),Fg(this,"_users",[]),Fg(this,"_config",void 0),Fg(this,"_clientId",void 0),Fg(this,"_appId",void 0),Fg(this,"_sessionId",null),Fg(this,"_key",void 0),Fg(this,"_rtmConfig",{}),Fg(this,"_joinInfo",void 0),Fg(this,"_gateway",void 0),Fg(this,"_statsCollector",void 0),Fg(this,"_configDistribute",void 0),Fg(this,"_leaveMutex",new NA("client-leave")),Fg(this,"_publishMutex",new NA("client-publish")),Fg(this,"_renewTokenMutex",new NA("client-renewtoken")),Fg(this,"_subscribeMutex",new NA("client-subscribe")),Fg(this,"_encryptionMode","none"),Fg(this,"_encryptionSecret",null),Fg(this,"_encryptionSalt",null),Fg(this,"_encryptDataStream",!1),Fg(this,"_encryptDataStreamKey",null),Fg(this,"_encryptDataStreamIv",null),Fg(this,"_proxyServer",void 0),Fg(this,"_turnServer",{servers:[],mode:"auto"}),Fg(this,"_cloudProxyServerMode","disabled"),Fg(this,"_isDualStreamEnabled",!1),Fg(this,"_defaultStreamFallbackType",void 0),Fg(this,"_lowStreamParameter",void 0),Fg(this,"_streamFallbackTypeCacheMap",new Map),Fg(this,"_remoteStreamTypeCacheMap",new Map),Fg(this,"_axiosCancelSource",Lv.CancelToken.source()),Fg(this,"_audioVolumeIndicationInterval",void 0),Fg(this,"_networkQualityInterval",void 0),Fg(this,"_userOfflineTimeout",void 0),Fg(this,"_streamRemovedTimeout",void 0),Fg(this,"_liveTranscodeStreamingClient",void 0),Fg(this,"_liveRawStreamingClient",void 0),Fg(this,"_channelMediaRelayClient",void 0),Fg(this,"_networkQualitySensitivity","normal"),Fg(this,"_p2pChannel",void 0),Fg(this,"_useLocalAccessPoint",!1),Fg(this,"_setLocalAPVersion",void 0),Fg(this,"_joinAndNotLeaveYet",!1),Fg(this,"_numberOfJoinCount",0),Fg(this,"_remoteDefaultVideoStreamType",void 0),Fg(this,"_inspect",void 0),Fg(this,"_moderation",void 0),Fg(this,"_license",void 0),Fg(this,"_pendingPublishedUsers",[]),Fg(this,"ntpAlignErrorCount",0),Fg(this,"remoteInboundOffset",0),Fg(this,"_handleLocalTrackEnable",(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),Fg(this,"_handleLocalTrackDisable",(e,t,n)=>{this.unpublish(e).then(t).catch(n)}),Fg(this,"_handleUserOnline",e=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(e.uid,this.channelName))return void fb.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&fb.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find(t=>t.uid===e.uid);if(t)t._trust_in_room_=!0,t._is_pre_created&&(t._is_pre_created=!1,this.safeEmit(zy.USER_JOINED,t));else{const t=new cF(e.uid,e.uint_id||e.uid);this._users.push(t),fb.debug("[".concat(this._clientId,"] user online"),e.uid),this.safeEmit(zy.USER_JOINED,t)}}),Fg(this,"_handleUserOffline",e=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(e.uid,this.channelName))return;const t=this._users.find(t=>t.uid===e.uid);t&&(this._handleRemoveStream(e),this._handleRemoveDataChannels(e),t._audio_pre_subscribed||t._video_pre_subscribed?t._is_pre_created=!0:nA(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),fb.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(zy.USER_LEAVED,t,e.reason))}),Fg(this,"_handleAddAudioOrVideoStream",(e,t,n,r,i,o,a)=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(t,this.channelName))return;const s=this._users.find(e=>e.uid===t);if(!s)return void fb.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));fb.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(s.uid,e,void 0,void 0,void 0,Date.now());const c="audio"===e?s.hasAudio:s.hasVideo;s._uintid||(s._uintid=i||t),"audio"===e?s._trust_audio_stream_added_state_=!0:s._trust_video_stream_added_state_=!0,"audio"===e?(s._audio_added_=!0,void 0!==n&&(s._audioSSRC=n),void 0!==r&&(s._cname=r),o&&(s._audioOrtc=o)):(s._video_added_=!0,void 0!==n&&(s._videoSSRC=n),void 0!==r&&(s._cname=r),void 0!==a&&(s._rtxSsrcId=a),o&&(s._videoOrtc=o)),("audio"===e?s.hasAudio:s.hasVideo)&&!c&&(fb.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published ").concat(e)),this.safeEmit(zy.USER_PUBLISHED,s,e)),"video"===e?vb.onGatewayStream(this._sessionId,gb.ON_ADD_VIDEO_STREAM,Rb.ON_ADD_VIDEO_STREAM,{peer:i||t,ssrc:s._videoSSRC}):vb.onGatewayStream(this._sessionId,gb.ON_ADD_AUDIO_STREAM,Rb.ON_ADD_AUDIO_STREAM,{peer:i||t,ssrc:s._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(s,e,n).then(t=>{if(t&&(fb.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof fB))return this._p2pChannel.unsubscribe(s,e,!0).then(()=>this._subscribe(s,e,!0).catch(e=>{fb.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(s,e)&&(fb.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(s.uid," after reconnect.")),this._subscribe(s,e,!0).catch(e=>{fb.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),Fg(this,"_handleRemoveStream",e=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(e.uid,this.channelName))return;const t=this._users.find(t=>t.uid===e.uid);if(!t)return void fb.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));fb.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{fb.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(zy.USER_UNPUBLISHED,t,"audio"),fb.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(zy.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{fb.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(zy.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{fb.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(zy.USER_UNPUBLISHED,t,"audio")}),t._video_pre_subscribed||t._audio_pre_subscribed||(t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel instanceof fB&&this._p2pChannel.unsubscribe(t).then(e=>{if(e)return this._gateway.unsubscribe(e,t.uid)}),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0),vb.onGatewayStream(this._sessionId,gb.ON_REMOVE_STREAM,Rb.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()}),Fg(this,"_handleSetStreamLocalEnable",(e,t,n)=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(t,this.channelName))return;const r=this._users.find(e=>e.uid===t);if(!r)return void fb.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));fb.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));const i="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;const e=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===e)return;{const e=r._audio_enabled_?"enable-local-audio":"disable-local-audio";fb.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(zy.USER_INFO_UPDATED,t,e)}}else{r._trust_video_enabled_state_=!0;const e=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===e)return;{const e=r._video_enabled_?"enable-local-video":"disable-local-video";fb.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(zy.USER_INFO_UPDATED,t,e)}}const o="audio"===e?r.hasAudio:r.hasVideo;return i!==o?!i&&o?(fb.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(zy.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),this._p2pChannel.muteRemote(r,e),fb.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(zy.USER_UNPUBLISHED,r,e)):void 0}),Fg(this,"_handleMuteStream",(e,t,n)=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(e,this.channelName))return;fb.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);const r=this._users.find(t=>t.uid===e);if(!r)return void fb.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const i="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;const t=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===t)return;{const t=r._audio_muted_?"mute-audio":"unmute-audio";fb.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(zy.USER_INFO_UPDATED,e,t)}}else{r._trust_video_mute_state_=!0;const t=r._video_muted_;if(r._video_muted_=n,r._video_muted_===t)return;{const t=r._video_muted_?"mute-video":"unmute-video";fb.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(zy.USER_INFO_UPDATED,e,t)}}const o="audio"===t?r.hasAudio:r.hasVideo;if(i!==o){if(!i&&o)return("audio"===t?r._audioSSRC:r._videoSSRC)?(fb.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(zy.USER_PUBLISHED,r,t)):void fb.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&!r._video_pre_subscribed&&r._videoTrack._destroy(),this._p2pChannel.muteRemote(r,t),fb.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(zy.USER_UNPUBLISHED,r,t)}}),Fg(this,"_handleP2PLost",async e=>{fb.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():fb.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)}),Fg(this,"_handleTokenWillExpire",()=>{fb.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(zy.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Fg(this,"_handleBeforeUnload",e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),fb.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Fg(this,"_handleUpdateNetworkQuality",()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(zy.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(zy.NETWORK_QUALITY,e)}),Fg(this,"_handleP2PAddAudioOrVideoStream",(e,t,n,r)=>{const i=this._users.find(e=>e.uid===t);if(!i)return void fb.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));fb.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(i.uid,e,void 0,void 0,void 0,Date.now());const o="audio"===e?i.hasAudio:i.hasVideo;"audio"===e?i._trust_audio_stream_added_state_=!0:i._trust_video_stream_added_state_=!0,"audio"===e?(i._audio_added_=!0,void 0!==n&&(i._audioSSRC=n),void 0!==r&&(i._audioMid=r)):(i._video_added_=!0,void 0!==n&&(i._videoSSRC=n),void 0!==r&&(i._videoMid=r)),("audio"===e?i.hasAudio:i.hasVideo)&&!o&&(fb.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published ").concat(e)),this.safeEmit(zy.USER_PUBLISHED,i,e)),this._p2pChannel.hasPendingRemoteMedia(i,e)&&(fb.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(i.uid," after reconnect.")),this._subscribe(i,e,!0).catch(e=>{fb.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))}),this._config=e,this._clientId=TA(5,"client-"),this.store=new $A(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),fb.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(GA," build: ").concat(qA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{qy(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(e){fb.warning("[".concat(this._clientId,"] ").concat(e.toString()))}this._statsCollector=new DF(this.store),this._statsCollector.onStatsException=(e,t,n)=>{fb.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),this.safeEmit(zy.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{const i=this._users.find(t=>t.uid===e);i&&vb.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid})},this.store.useP2P="p2p"===e.mode,this._gateway=new Ex(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||PA,httpRetryConfig:e.httpRetryConfig||PA,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new tV,this.store.useP2P?(this._p2pChannel=new bF(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new fB(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,r,i){let o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];JA("JOIN_GATEWAY_USE_443PORT_ONLY",o),JA("JOIN_GATEWAY_USE_DUAL_DOMAIN",a);const s=this._gateway.signal.websocket;return s instanceof WO&&(s.use443PortOnly=o,s.tryDoubleDomain=a),async function(e,t,n){Uv.get(e)||Uv.set(e,[]),xv.get(e)||xv.set(e,t),Vv.get(e)||Vv.set(e,0);const r=Uv.get(e),i=xv.get(e);if(!r||!i)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Vv.get(e)===i){const e=Mv();r.push(e),await e.promise}Vv.set(e,Vv.get(e)+1);for(var o=arguments.length,a=new Array(o>3?o-3:0),s=3;s<o;s++)a[s-3]=arguments[s];const c=await n(...a);return Vv.set(e,Vv.get(e)-1),Vv.get(e)===i-1&&r.length>0&&(r[0].resolve(),r.shift()),0===Vv.get(e)&&(Uv.set(e,[]),xv.set(e,0),Vv.set(e,0)),c}("client.join",XA("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,r,i)}async join(e,t,n,r,i){const o=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const a="HTTPS"===(UA||UA||(UA=(window.location.protocol.split(":")[0]||"").toUpperCase(),UA)),s=jA()?window.isSecureContext:"Browser Not Support";(jA()||a)&&window.isSecureContext||fb.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),fb.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),vb.setAppId(e);try{if(!n&&null!==n)throw new yb(Ry.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&by(n,"token",1,2047),by(e,"appid",1,2047),xw(t),r&&Vw(r),i&&by(i,"optionalInfo",1,2047)}catch(i){throw vb.reportApiInvoke(SA(),{name:By.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:s},tag:jy.TRACER}).onError(i),i}if(this._leaveMutex.isLocked&&(fb.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),fb.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const i=new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw vb.reportApiInvoke(SA(),{name:By.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:s},tag:jy.TRACER}).onError(i),i}this._gateway.state="CONNECTING";const c=await YB({appId:e,cname:t,uid:r,stringUid:"string"==typeof r?r:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const u=(null==c?void 0:c.sid)||SA();fb.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._sessionId||(this._sessionId=u,this.store.sessionId=this._sessionId);const l=vb.reportApiInvoke(u,{name:By.JOIN,options:[e,t,n,r],states:{isHttps:a,isSecureContext:s},tag:jy.TRACER}),d=IG(IG(IG({},this._rtmConfig),{},{clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:XA("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(d.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof r&&(d.stringUid=r,this._uintUid?(d.uid=this._uintUid,this._uintUid=void 0):d.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(d.aesmode=this._encryptionMode,d.aespassword=await(async e=>{const t=function(){const e=window.atob("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t}(),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=ky(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r);return function(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}(new Uint8Array(i))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(d.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&("aes-128-gcm2"===this._encryptionMode||"aes-256-gcm2"===this._encryptionMode))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const e=new TextEncoder,t=XA("USE_PURE_ENCRYPTION_MASTER_KEY")?e.encode(d.appId+this._encryptionSecret+this._encryptionSecret):e.encode(d.appId+d.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256,o=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:nb,hash:"SHA-256",salt:n},r,i+ib);return new Uint8Array(o).subarray(i/8)}(this._encryptionMode,t,lA(this._encryptionSalt)),this._encryptDataStreamKey=await async function(e,t,n){const r=await window.crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveBits","deriveKey"]),i="aes-128-gcm2"===e?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:nb,hash:"SHA-256",salt:n},r,{name:"AES-GCM",length:i},!0,["encrypt","decrypt"])}(this._encryptionMode,t,lA(this._encryptionSalt))}else fb.warning("[".concat(this._clientId,s?"] encrypt datastream must be running in a secure context, fallback to plain data stream":"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,fb.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:d.stringUid});const h=this._sessionId;setTimeout(()=>{"CONNECTING"===this.connectionState&&h===this._sessionId&&vb.joinChannelTimeout(this._sessionId,5)},5e3);try{var p;let r;const i=d.cloudProxyServer;if(Dn(p=["proxy3","proxy4","proxy5"]).call(p,i)){const e=XA("PROXY_SERVER_TYPE3");d.proxyServer=Array.isArray(e)?e[0]:e}if(vb.setProxyServer(d.proxyServer),fb.setProxyServer(d.proxyServer),this.store.requestAPStart(),c){if(fb.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(d.stringUid?", ".concat(d.stringUid," => ").concat(c.intUid):""," ")),d.stringUid&&!d.uid&&(d.uid=c.intUid),r={gatewayInfo:c.ap.gatewayInfo},XA("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&"auto"===d.turnServer.mode)if(0===c.ap.proxyInfo.addresses.length)fb.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const e=(await tN(c.ap.proxyInfo,c.ap.gatewayInfo.uid)).map(e=>({turnServerURL:e.address,tcpport:e.tcpport||KA.tcpport,udpport:e.udpport||KA.udpport,username:e.username||KA.username,password:e.password||KA.password,forceturn:!1,security:!0}));d.turnServer={mode:"manual",servers:e}}XB(c,d.stringUid)}else{if(d.stringUid&&!d.uid){let e;[e,r]=await Gh.all([Yx(d.stringUid,d,this._axiosCancelSource.token,this._config.httpRetryConfig||PA,this.store),Kx(d,this._axiosCancelSource.token,this._config.httpRetryConfig||PA,!0,this.store)]),fb.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(d.stringUid," => ").concat(e)),d.uid=e,r.gatewayInfo.uid=e,r.gatewayInfo.res.uid=e}else r=await Kx(d,this._axiosCancelSource.token,this._config.httpRetryConfig||PA,!0,this.store);if(!this._joinAndNotLeaveYet)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(d,this._axiosCancelSource.token),this._configDistribute.on(sO.UPDATE_BITRATE_LIMIT,e=>{this._p2pChannel.updateBitrateLimit(e)})},0),this._key=n||e;const o=r.gatewayInfo,a=d.uid?d.uid:o.uid;this._joinInfo=IG(IG({},d),{},{cid:o.cid,uid:a,vid:o.vid,apResponse:o.res,apGatewayAddress:o.apGatewayAddress,uni_lbs_ip:o.uni_lbs_ip,gatewayAddrs:o.gatewayAddrs}),this.store.intUid=a;const s=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l.onSuccess(s),this._appId=e,this._channelName=d.cname,this._uid=s,this.store.uid=s,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Xv()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const u=d.stringUid?"string uid: ".concat(d.stringUid,",uid: ").concat(d.uid):"uid: ".concat(this._uid);return fb.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(u)),setTimeout(()=>{fb.startUpload()},5e3),this.store.joinEnd(),Dn(wb).call(wb,this)||wb.push(this),"disabled"===this._cloudProxyServerMode&&ZP().supportWebCrypto&&XA("ENABLE_PRELOAD")&&zB(this._joinInfo),s}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===Ry.OPERATION_ABORTED?fb.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t):fb.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t),t.code!==Ry.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),l.onError(t),t}}_joinGateway(){if(!this._joinInfo||!this._key)throw new yb(Ry.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!XA("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){fb.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Xv()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=wb.indexOf(e);-1!==t&&wb.splice(t,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return fb.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState),fb.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(e)){if(!(e instanceof HL))return this._publishDataChannel(e);e=[e]}if(0===e.length)throw new yb(Ry.INVALID_PARAMS,"param list is empty");const n=e;if("audience"===this._gateway.role)throw new yb(Ry.INVALID_OPERATION,"audience can not publish stream");for(const e of n){if(!(e instanceof HL))throw new yb(Ry.INVALID_PARAMS,"parameter is not local track");if(!e._enabled&&t)throw new yb(Ry.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(e.getTrackId()))}fb.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(e=>"".concat(e.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach(e=>{const t=this._configDistribute.getBitrateLimit();e instanceof aU&&t&&e.setBitrateLimit(t.uplink)});try{await this._publishHighStream(n),fb.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(e=>"".concat(e.getTrackId()," "))))}catch(e){throw fb.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{r()}}async _publishDataChannel(e){yy(e.id,"id",0,65535,!0),Iy(e.ordered,"ordered"),by(e.metadata,"metadata",0,512),fb.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex(t=>t.id===e.id))throw new yb(Ry.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new yb(Ry.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&XA("FORCE_TURN")&&!XA("TURN_ENABLE_TCP")&&!XA("TURN_ENABLE_UDP"))throw new yb(Ry.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const t=function(e){return RB(e,!1)}(e),n=await this._p2pChannel.publishDataChannel([t]);if(n.length>0){if("number"!=typeof t._originDataChannelId)throw fb.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new yb(Ry.CREATE_DATACHANNEL_ERROR);try{await Gh.all(n.map(e=>this._uid&&this._gateway.publishDataChannel(this._uid,e,!0))),await t._waitTillOpen()}catch(e){if(e.code!==Ry.DISCONNECT_P2P)throw e}}return fb.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(e){throw fb.error("[".concat(this._clientId,"] publish datachannels error"),e.toString()),e}finally{t()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new yb(Ry.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof HL))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);fb.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(e=>"".concat(e.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof bF){const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.sendExtensionMessage(IO.UNPUBLISH,{unpubMsg:e},!0)}else{const e=await this._p2pChannel.unpublish(t);e&&await this._gateway.unpublish(e,this._uid),fb.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(e=>"".concat(e.getTrackId()))))}}catch(e){throw fb.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{n&&n()}}async _unpublishDataChannel(e){void 0!==e&&0!==e.length||(e=this._p2pChannel.getAllDataChannels()),fb.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(e=>"".concat(e.id," "))," "));const t=await this._publishMutex.lock();try{const t=await this._p2pChannel.unpublishDataChannel(e);t&&await this._gateway.unpublishDataChannel(t),fb.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(e=>"".concat(e.id))))}catch(e){throw fb.error("[".concat(this._clientId,"] unpublish dataChannel error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof cF)){const t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");e=t}return"datachannel"===t?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(vy(t,"mediaType",["audio","video"]),this._p2pChannel instanceof bF)throw new yb(Ry.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"can't presub when not join");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===dO.AUDIO,r=t===dO.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:i,ortc:o,rtxSsrcId:a,cname:s,uint_id:c}=await this._gateway.presubscribe(e,t,!0);if(null==i)throw new yb(Ry.UNEXPECTED_RESPONSE,"no ssrc id");let u=this._users.find(t=>t.uid===e);u||(u=new cF(e,c||e),u._is_pre_created=!0,this._users.push(u)),s&&(u._cname=s),u._uintid||(u._uintid=c||e),n&&(u._audioSSRC=i,u._audio_pre_subscribed=!0,o&&(u._audioOrtc=o)),r&&(u._videoSSRC=i,u._video_pre_subscribed=!0,o&&(u._videoOrtc=o),null!=a&&(u._rtxSsrcId=a)),fb.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(i)),await this._p2pChannel.subscribe(u,t,i,a,o);const l=n?u._audioTrack:u._videoTrack;if(!l)throw new yb(Ry.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(u._trust_audio_stream_added_state_=!0,u._audio_added_=!0),r&&(u._trust_video_stream_added_state_=!0,u._video_added_=!0),l}catch(t){throw fb.error("[".concat(this._clientId,"] presub user ").concat(e," error"),t),t}finally{i()}}async _subscribeDataChannel(e,t){var n;if(yy(t,"channelId",0,65535,!0),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));const r=this._users.find(t=>t===e);if(!r)throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&0===e._dataChannels.length)throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new yb(Ry.INVALID_REMOTE_USER,"user is not published");const i=null===(n=e._dataChannels)||void 0===n?void 0:n.find(e=>e.id===t);if(!i)throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new yb(Ry.REMOTE_USER_IS_NOT_PUBLISHED);const o=await this._subscribeMutex.lock();fb.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const n=await this._p2pChannel.subscribeDataChannel(e,[i]);if(n&&Dn(n).call(n,i.id))try{var a;if("number"!=typeof i._originDataChannelId)throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new yb(Ry.CREATE_DATACHANNEL_ERROR);const t={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:null!==(a=i.metadata)&&void 0!==a?a:""};await this._gateway.subscribeDataChannel(e.uid,t,!0),await i._waitTillOpen()}catch(t){if((null==t?void 0:t.code)!==Ry.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[i]),t;await this._p2pChannel.unsubscribeDataChannel(e,[i]),this._p2pChannel.setPendingRemoteDataChannel(e,i.id)}return fb.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),i}finally{o()}}async _p2pSubscribe(e,t,n){if(vy(t,"mediaType",["audio","video"]),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find(t=>t===e);if(!r){const t=new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new yb(Ry.INVALID_REMOTE_USER,"user is not published");throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!n&&("audio"===t&&!e.hasAudio||"video"===t&&!e.hasVideo)){const n=new yb(Ry.REMOTE_USER_IS_NOT_PUBLISHED);throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}const i=await this._subscribeMutex.lock();fb.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const n="audio"===t?e._audioSSRC:e._videoSSRC,r="audio"===t?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this._p2pChannel instanceof bF&&await this._p2pChannel.subscribe(e,t,n,r)}catch(e){throw e}fb.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{fb.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});const n="audio"===t?e._audioTrack:e._videoTrack;if(!n)throw new yb(Ry.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(t){throw fb.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{i()}}async _subscribe(e,t,n){if(this._p2pChannel instanceof bF)return this._p2pSubscribe(e,t);if(vy(t,"mediaType",["audio","video"]),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=this._users.find(t=>t===e);if(!r){const t=new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new yb(Ry.INVALID_REMOTE_USER,"user is not published");throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const n=new yb(Ry.REMOTE_USER_IS_NOT_PUBLISHED);throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}let i="audio"===t?e._audioSSRC:e._videoSSRC,o="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,s={stream_type:"audio"===t?dO.AUDIO:dO.VIDEO,ssrcId:i};const c=await this._subscribeMutex.lock();fb.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const r="audio"===t?e._audioSSRC:e._videoSSRC;void 0!==r&&r!==i&&(i=r,o="audio"===t?e._audioOrtc:e._videoOrtc,a="video"===t?e._rtxSsrcId:void 0,s={stream_type:"audio"===t?dO.AUDIO:dO.VIDEO,ssrcId:i}),rV.markSubscribeStart(this.store.clientId,i),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,i,a,o);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(e.uid,s,!0)}catch(n){if((null==n?void 0:n.code)!==Ry.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),n;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,e,t),n}fb.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(e=>{fb.warning("[".concat(this._clientId,"] auto set fallback failed"),e)});const r="audio"===t?e._audioTrack:e._videoTrack;if(!r)throw new yb(Ry.UNEXPECTED_ERROR,"can not find remote track in user object");return r}catch(t){throw fb.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{c()}}async massSubscribe(e){if(wy(e,"subscribeList"),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();fb.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)}).join("; ")));const i=(e=[...e]).map(e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}}),o=await this._p2pChannel.globalLock();try{var a;for(let t=e.length-1;t>=0;t--){const r=e[t],{user:o,mediaType:a}=r;if(vy(a,"mediaType",["audio","video"]),!o){const e=new yb(Ry.INVALID_PARAMS,"user property does not exist in subscribeList item");throw fb.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}const s=this._users.find(e=>e===o);if(!s){const n=new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");fb.error("[".concat(this._clientId,"] can not massSubscribe ").concat(o.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===a&&(!o.hasAudio||void 0===o._audioSSRC)||"video"===a&&(!o.hasVideo||void 0===o._videoSSRC)){const n=new yb(Ry.REMOTE_USER_IS_NOT_PUBLISHED);fb.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(a,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}const c=tO.Video|tO.LwoVideo,u=n.get(o);if(u){if("video"===a?u&c:u&tO.Audio){e.splice(t,1),fb.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(o.uid,", mediaType:").concat(a," twice"));continue}n.set(o,u|("video"===a?c:tO.Audio))}else n.set(o,"video"===a?c:tO.Audio)}for(let t=e.length-1;t>=0;t--){const r=e[t],{user:i,mediaType:o}=r,a=tO.Video|tO.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,o)){await this._p2pChannel.unmuteRemoteNoLock(i,o);const r=n.get(i);n.set(i,"video"===o?r^a:r^tO.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map(e=>({userId:e.user.uid,type:e.mediaType})),t);let r=Jn(a=Array.from(n.entries())).call(a,(e,t)=>{let[n,r]=t;if(0===r)return e;const i={stream_id:n.uid,stream_type:r};return r&tO.Audio&&(i.audio_ssrc=n._audioSSRC),r&tO.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===dO.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===dO.VIDEO?t._rtxSsrcId:void 0}}));const n=new Map;if(r=r.filter(e=>e.video_ssrc&&!this._p2pChannel.isPreSubScribe(e.video_ssrc)||e.audio_ssrc&&!this._p2pChannel.isPreSubScribe(e.audio_ssrc)||!e.video_ssrc&&!e.audio_ssrc),r.length>0){const e=await this._gateway.subscribeAll(r,!0);((null==e?void 0:e.users)||[]).forEach(e=>{let{stream_id:t,video_error_code:r,audio_error_code:i,error_code:o}=e;(r||i||o)&&n.set(t,{video_error_code:r,audio_error_code:i,error_code:o})})}if(Array.from(n.entries()).length>0){const e=[];Array.from(n.entries()).forEach(t=>{let[n,r]=t;const i=this.remoteUsers.find(e=>e.uid===n);if(i){let t;r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=dO.VIDEO:r.audio_error_code&&(t=dO.AUDIO),e.push({user:i,mediaType:t})}}),e.length>0&&await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of i){const t=n.get(e.user.uid);if(t){const n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){const t=NO(n);fb.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new yb(Ry.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||(e.track="video"===e.mediaType?e.user.videoTrack:e.user.audioTrack)}return this.store.massSubscribe(i.filter(e=>!e.error).map(e=>({userId:e.user.uid,type:e.mediaType})),void 0,Date.now()),i.forEach(e=>{var n;vb.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===dO.VIDEO,audio:e.mediaType===dO.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===dO.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(e.user._videoSSRC)},!0)}),fb.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)}).join("; "))),i}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{o(),r()}}async unsubscribe(e,t,n){if(!(e instanceof cF)){const t=this.remoteUsers.find(t=>t.uid===e);if(!t)throw new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");e=t}if(t||this.store.useP2P){if("datachannel"===t)return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&vy(t,"mediaType",["audio","video"]),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");const r=this._users.find(t=>t===e);if(!r){const t=new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");throw fb.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}fb.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const i=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof bF)await this._p2pChannel.unsubscribe(e,t);else{const n=await this._p2pChannel.unsubscribe(e,t);n&&await this._gateway.unsubscribe(n,e.uid),t&&"audio"!==t||(e._audio_pre_subscribed=!1),t&&"video"!==t||(e._video_pre_subscribed=!1),e._is_pre_created&&nA(this._users,e),fb.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(t){if(t.code===Ry.DISCONNECT_P2P)return void fb.warning("disconnecting p2p, abort unsubscribe request.");throw fb.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{i()}}async _unsubscribeDataChannel(e,t){if(t&&yy(t,"id",0,65535,!0),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");const n=this._users.find(t=>t===e);if(!n){const t=new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");throw fb.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}let r;if("number"==typeof t){const n=e._dataChannels.find(e=>e.id===t);n&&(r=[n])}else r=e._dataChannels;if(void 0===r){const n=new yb(Ry.REMOTE_USER_IS_NOT_PUBLISHED);throw fb.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}fb.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(e=>e.id)));try{const t=await this._p2pChannel.unsubscribeDataChannel(e,r);t&&await this._gateway.unsubscribeDataChannel(t,e.uid),fb.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(t))}catch(t){if(t.code===Ry.DISCONNECT_P2P)return void fb.warning("disconnecting p2p, abort unsubscribe request.");throw fb.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}}async massUnsubscribe(e){if(wy(e,"unsubscribeList"),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");fb.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const e=new yb(Ry.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw fb.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}vy(i,"mediaType",["video","audio",void 0]);const o=this._users.find(e=>e===r);if(!o){fb.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const a=tO.Video|tO.LwoVideo;if(t.has(r)){const o=t.get(r);let s;switch(i){case"video":s=o&a;break;case"audio":s=o&tO.Audio;break;default:s=o&(tO.Audio|a)}if(s){fb.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?"audio"===i?t.set(r,o|tO.Audio):"video"===i&&t.set(r,o|a):t.set(r,o|tO.Audio|a)}else i?"audio"===i?t.set(r,tO.Audio):"video"===i&&t.set(r,a):t.set(r,tO.Audio|a)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),fb.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")}).join()))}catch(e){if(e.code===Ry.DISCONNECT_P2P)return void fb.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw fb.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}async setLowStreamParameter(e){!function(e){if(!e)throw new Cy(Ry.INVALID_PARAMS);Oy(e.width)||Ay(e.width,"streamParameter.width"),Oy(e.height)||Ay(e.height,"streamParameter.height"),Oy(e.framerate)||Ay(e.framerate,"streamParameter.framerate"),Oy(e.bitrate)||yy(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&fb.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),fb.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,hO.LocalVideoLowTrack)}async enableDualStream(){if(!ZP().supportDualStream)throw vb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new yb(Ry.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new yb(Ry.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw vb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,vb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),fb.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(hO.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw vb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,vb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),fb.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){vy(e,"role",["audience","host"])}(e),t&&qy(t),"rtc"===this.mode||"p2p"===this.mode)throw fb.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new yb(Ry.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&"host"===e)throw new yb(Ry.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new yb(Ry.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,fb.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}getRemoteInboundOffset(){var e;const t=null===(e=this._p2pChannel.getStats())||void 0===e?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(by(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new yb(Ry.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,vb.setProxyServer(this._proxyServer),fb.setProxyServer(this._proxyServer),fb.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new yb(Ry.INVALID_OPERATION,"You have already set the proxy")}if(Ky(e))return this._turnServer={servers:e,mode:"original-manual"},void fb.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(e=>e.urls).join(","),"."));e.forEach(e=>Yy(e)),this._turnServer={servers:e,mode:"manual"},fb.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"you should set license before join channel");if(by(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new yb(Ry.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,fb.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new yb(Ry.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new yb(Ry.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new yb(Ry.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,fb.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"Stop proxy server after leave channel");vb.setProxyServer(),fb.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",fb.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new yb(Ry.INVALID_PARAMS,"accessPoints is required.");wy(e.accessPoints.serverList,"accessPoints.serverList"),by(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{yy(e,t,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new yb(Ry.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");XA("CLOSE_AFB_FOR_LOCAL_AP")&&(JA("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),JA("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,o=e.accessPoints.serverList.map(e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e),a=o.map(e=>"".concat(e,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,JA("WEBCS_DOMAIN",a),JA("WEBCS_DOMAIN_BACKUP_LIST",a),JA("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(wy(e.report.hostname,"report.hostname"),JA("EVENT_REPORT_DOMAIN",e.report.hostname[0]),JA("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(JA("EVENT_REPORT_DOMAIN",o[0]),JA("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let s=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),s=e.report.port),JA("STATS_COLLECTOR_PORT",s),JA("ENABLE_EVENT_REPORT",!!e.report);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(wy(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let u=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),u=e.log.port),JA("LOG_UPLOAD_SERVER","".concat(c,":").concat(u));let l=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(wy(e.cds.hostname,"cds.hostname"),l=e.cds.hostname):l=o;let d=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),d=e.cds.port),JA("CDS_AP",l.map(e=>"".concat(e,":").concat(d))),JA("ENABLE_CONFIG_DISTRIBUTE",!!e.cds),fb.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(wy(e,"serverList"),by(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new yb(Ry.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,JA("WEBCS_DOMAIN",e),JA("WEBCS_DOMAIN_BACKUP_LIST",e),JA("GATEWAY_DOMAINS",[t]),JA("EVENT_REPORT_DOMAIN",e[0]),JA("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),JA("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),fb.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(vy(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw fb.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else fb.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){vy(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const t=this._users.find(t=>t.uid===e);t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(e){throw fb.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}fb.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){vy(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw fb.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}fb.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,r){!function(e){vy(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),by(t,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Dn(i).call(i,e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new yb(Ry.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new yb(Ry.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Iy(r,"encryptDataStream"),!Dn(i).call(i,e))throw new yb(Ry.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||fb.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=uA(n))}async renewToken(e){if(by(e,"token",1,2047),!this._key||!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(XA("USE_NEW_TOKEN")){fb.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await Zx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||PA);fb.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else fb.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});fb.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,fb.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?fb.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(zy.VOLUME_INDICATOR,e)},XA("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new yb(Ry.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new yb(Ry.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new yb(Ry.LIVE_STREAMING_TASK_CONFLICT);const n=t?Fw.TRANSCODE:Fw.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Fw.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(t=>t&&t.hasUrl(e));if(!t.length)throw new yb(Ry.INVALID_PARAMS,"can not find live streaming url to stop");await Gh.all(t.map(t=>t&&t.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){LF(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){LF(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof e||e instanceof Uint8Array)&&(e={payload:e}),"string"==typeof e.payload){const t=new TextEncoder;e.payload=t.encode(e.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dn(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(r=!0,e.payload=await async function(e,t,n){var r;const i=Jn(r=Array.from(n)).call(r,(e,t)=>e+t,0),o={serverTs:0,seq:ob++,length:n.length,checkSum:i},a=new Uint8Array(yA(i,2)),s=new ArrayBuffer(rb),c=new DataView(s);c.setUint32(0,o.serverTs),c.setUint16(4,o.seq),c.setUint16(6,o.length),c.setUint16(8,o.checkSum),n=pA(n,new Uint8Array(16-n.length%16));const u=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e,tagLength:tb,additionalData:a},t,n);return pA(new Uint8Array(s),new Uint8Array(u))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new yb(Ry.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Pw.DATA_STREAM,{payload:uA(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-vB},!n)}sendMetadata(e){if(!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new yb(Ry.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Pw.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:uA(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Tb),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"can not send custom report, not joined");await vb.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){vy(t.spatialLayer,"spatialLayer",[0,1,2,3]),vy(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw fb.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(Iy(t,"apRTM"),yy(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,fb.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),("CONNECTED"===this.connectionState||"RECONNECTING"===this.connectionState)&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(fb.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Lv.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&JB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&vb.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(e=>e._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new NA("client-publish"),this._subscribeMutex=new NA("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){var n;const r=e||SA();fb.debug(e?"[".concat(this._clientId,"] new Session ").concat(r):"[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=e?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,vb.addSid(r);const o={lts:(new Date).getTime(),mode:this.mode,buildFormat:2,stringUid:(null==t?void 0:t.stringUid)||(null===(n=this._joinInfo)||void 0===n?void 0:n.stringUid),channelProfile:"live"===this.mode?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:"audience"===this.role?2:1};vb.sessionInit(this._sessionId,IG({cname:t.channel,appid:t.appId},o)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new yb(Ry.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&XA("FORCE_TURN")&&!XA("TURN_ENABLE_TCP")&&!XA("TURN_ENABLE_UDP"))throw new yb(Ry.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");fb.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof bF){const t=(await n.next()).value;if(t){try{await this._gateway.sendExtensionMessage(IO.PUBLISH,t,!0)}catch(e){throw n.throw(e),e}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(e){if(e.code!==Ry.DISCONNECT_P2P)throw n.throw(e),e}await n.next((null===(t=i)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof aU&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===Ry.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new yb(Ry.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));fb.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(t){if(t.code!==Ry.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=r)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===Ry.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new yb(Ry.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=(t={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},gB("LiveStreaming").create(t));var t;return e.onLiveStreamError=(e,t)=>{vb.reportApiInvoke(this._sessionId,{name:By.ON_LIVE_STREAM_ERROR,options:[e,t],tag:jy.TRACER}).onSuccess(),this.safeEmit(zy.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{vb.reportApiInvoke(this._sessionId,{name:By.ON_LIVE_STREAM_WARNING,options:[e,t],tag:jy.TRACER}).onSuccess(),this.safeEmit(zy.LIVE_STREAMING_WARNING,e,t)},e.on(Kw.REQUEST_WORKER_MANAGER_LIST,(e,t,n)=>{if(!this._joinInfo)return n(new yb(Ry.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(e,t,n,r){const i=XA("UAP_AP").slice(0,XA("AJAX_REQUEST_CONCURRENT")).map(e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap"));return await Dx(i,e,t,n,r)})(e,this._joinInfo,this._axiosCancelSource.token,PA).then(t).catch(n)}),e};return e===Fw.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new yb(Ry.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},gB("ChannelMediaRelay").create(e));r.on("state",e=>{e===Xw.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(zy.CHANNEL_MEDIA_RELAY_STATE,e)}),r.on("event",e=>{this.safeEmit(zy.CHANNEL_MEDIA_RELAY_EVENT,e)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:r}=e,i=[];if(t){const e=[];this._users.forEach(t=>{t._dataChannels.forEach(r=>{n.every(e=>e.uid!==t._uintid||e.stream_id!==r.id)&&e.push({uid:t._uintid,stream_id:r.id,ordered:r.ordered,max_retrans_times:r.maxRetransmits,metadata:r.metadata})})}),e.length>0&&this._handleUpdateDataChannel({added:[],deleted:e})}Array.isArray(n)&&n.length>0&&n.forEach(e=>{const{uid:n,stream_id:r,ordered:o,max_retrans_times:a,metadata:s}=e,c=this._users.find(e=>e._uintid===n);if(c){if(fb.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),Dn(i).call(i,c)||i.push(c),c._uintid||(c._uintid=n),-1===c._dataChannels.findIndex(t=>t.id===e.stream_id)){const e={id:r,ordered:!!o,maxRetransmits:a,metadata:s},n=function(e){return RB(e,!0)}(e);c._dataChannels.push(n),fb.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),t||this.safeEmit(zy.USER_PUBLISHED,c,"datachannel",e)}this._p2pChannel.hasPendingRemoteDataChannel(c,e.stream_id)&&(fb.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,e.stream_id).catch(e=>{fb.error("[".concat(this._clientId,"] resubscribe datachannel error"),e.toString())}))}else fb.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))}),t&&(this.safeEmit(zy.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(e=>{const{uid:t}=e,n=this._users.find(e=>e._uintid===t);if(!n)return void fb.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const r=n._dataChannels.find(t=>t.id===e.stream_id);r&&(fb.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(t)),this._p2pChannel.unsubscribeDataChannel(n,[r]).then(e=>{if(n._dataChannels=n._dataChannels.filter(e=>e!==r),e)return this._gateway.unsubscribeDataChannel(e,n.uid)}),fb.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished datachannel ,id:").concat(r.id)),this.safeEmit(zy.USER_UNPUBLISHED,n,"datachannel",r._config))})}_handleRemoveDataChannels(e){const t=this._users.find(t=>t.uid===e.uid);if(t){if(void 0!==t._dataChannels&&t._dataChannels.length>0){fb.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{fb.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(e=>{this.safeEmit(zy.USER_UNPUBLISHED,t,"datachannel",e._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(e=>{if(e)return this._gateway.unsubscribeDataChannel(e,t.uid)}),n()}}else fb.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on($w.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on($w.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===Hy.FALLBACK)return;const i=()=>{this.safeEmit(zy.CONNECTION_STATE_CHANGE,e,t,n)};if(vb.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:By.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:jy.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),fb.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach(e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._is_pre_created||(e._audio_pre_subscribed||(e._audioSSRC=void 0,e._audioOrtc=void 0),e._video_pre_subscribed||(e._videoSSRC=void 0,e._videoOrtc=void 0,e._rtxSsrcId=void 0),e._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var o;this._streamFallbackTypeCacheMap.forEach((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch(e=>{fb.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)})}),this._remoteStreamTypeCacheMap.forEach((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch(e=>{fb.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)})}),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(o=this._joinInfo)||void 0===o?void 0:o.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{fb.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(e=>{fb.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter(e=>!e._trust_in_room_).forEach(e=>{fb.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach(e=>{e._trust_audio_mute_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,dO.AUDIO,!1)),e._trust_video_mute_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,dO.VIDEO,!1)),e._trust_audio_enabled_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(fb.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))}))},1e3))}i()}),this._gateway.on($w.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new yb(Ry.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t;const n=await YB(IG(IG({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(t=n.ap,XB(n),this._joinInfo.preload=!0):(t=await Hx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||PA,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);const r=[];t.gatewayInfo.gatewayAddrs.forEach(e=>{let{address:t}=e;const[n,i]=t.split(":");r.push(this._joinInfo&&this._joinInfo.proxyServer?{proxy:this._joinInfo.proxyServer,host:n,port:i}:{host:n,port:i})}),e(r)}catch(e){t(e)}}),this._gateway.on($w.NETWORK_QUALITY,e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(zy.NETWORK_QUALITY,e)}),this._gateway.on($w.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(zy.STREAM_TYPE_CHANGED,e,t),vb.reportApiInvoke(this._sessionId,{name:By.STREAM_TYPE_CHANGE,options:[e,t],tag:jy.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on($w.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on($w.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{let n=await this._p2pChannel.getEstablishParams();XA("ENABLE_PREALLOC_PC")&&n||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(e){n(e)}}),this._gateway.on($w.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;const n=YU(e.ortc,t,e.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(n)}),this._gateway.on($w.PRE_CONNECT_PC,async e=>{const{candidates:t,fingerprint:n}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var r;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:e,cid:i}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(i,"_").concat(e),icePwd:"".concat(i,"_").concat(e)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(r=XA("FINGERPRINT"))&&void 0!==r?r:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(kw.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(kw.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(kw.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(kw.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(kw.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(kw.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(kw.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(kw.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(kw.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,dO.AUDIO,!0)),this._gateway.signal.on(kw.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,dO.AUDIO,!1)),this._gateway.signal.on(kw.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,dO.VIDEO,!0)),this._gateway.signal.on(kw.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,dO.VIDEO,!1)),this._gateway.signal.on(kw.RECEIVE_METADATA,e=>{const t=lA(e.metadata);this.safeEmit(zy.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(kw.ON_DATA_STREAM,async e=>{var t;if(!e)return;let n=lA(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dn(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<rb)throw new yb(Ry.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(rb));const t=await async function(e,t,n){const r=n.subarray(0,rb),i=r.slice(8,rb),o=(i[0]<<8)+i[1],a=(r[6]<<8)+r[7],s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:e,tagLength:tb,additionalData:new Uint8Array(yA(o,2))},t,n.subarray(rb));return new Uint8Array(s).subarray(0,a)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n);n=t}let r=0;if(e.ordered||e.syncWithAudio){const t=this._p2pChannel.getStats(),n=this.remoteUsers.find(t=>t.uid===e.uid),i=null==t?void 0:t.audioRecv.find(e=>e.ssrc===(null==n?void 0:n._audioSSRC));r=null==i?void 0:i.jitterBufferMs}null==r&&(r=0),NB(IG(IG({},e),{},{payload:n}),r,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(kw.ON_CRYPT_ERROR,()=>{dA(()=>{fb.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(zy.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(kw.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(kw.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{fb.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Hy.TOKEN_EXPIRE),this.safeEmit(zy.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(kw.ON_STREAM_FALLBACK_UPDATE,e=>{fb.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(zy.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")}),this._gateway.signal.on(kw.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),fb.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(kw.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(kw.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Dw.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Pw.PUBLISH:{if(!t)return;const e=t.ortc;if(e){var n,r;const i=e.some(e=>{let{stream_type:t}=e;return t===Zw.Audio}),o=e.some(e=>{let{stream_type:t}=e;return t!==Zw.Audio}),a=e.some(e=>{let{stream_type:t}=e;return t===Zw.Screen||t===Zw.ScreenLow});"offer"===t.state&&vb.publish(this._joinInfo.sid,{eventElapse:rV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Ry.TIMEOUT,audio:i,video:o,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:i?null===(n=e.find(e=>{let{stream_type:t}=e;return t===Zw.Audio}))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:o?null===(r=e.find(e=>{let{stream_type:t}=e;return t!==Zw.Audio}))||void 0===r||null===(r=r.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0})}break}case Pw.SUBSCRIBE:t&&vb.subscribe(this._joinInfo.sid,{succ:!1,ec:Ry.TIMEOUT,audio:t.stream_type===dO.AUDIO,video:t.stream_type===dO.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:rV.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(kw.ON_P2P_OK,e=>{}),this._gateway.signal.on(kw.ON_PUBLISHED_USER_LIST,e=>{if(null==e||!e.users)return;XA("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(e=>!Ob(e.string_id||e.stream_id,this.channelName)));const t=[],n=[];for(const r of e.users){let e=this._users.find(e=>e._uintid===r.stream_id);e?e._trust_in_room_=!0:(e=new cF(r.string_id||r.stream_id,r.stream_id),this._users.push(e),0===this.getListeners(zy.PUBLISHED_USER_LIST).length&&(fb.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(zy.USER_JOINED,e)));const i=tO.Audio&r.stream_type,o=(tO.Video|tO.LwoVideo)&r.stream_type,a=!!(65280&r.stream_type),s=i&&e.hasAudio,c=o&&e.hasVideo;o&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=r.video_ssrc,e._rtxSsrcId=r.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=r.audio_ssrc),i&&!s&&0===this.getListeners(zy.PUBLISHED_USER_LIST).length&&(fb.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(zy.USER_PUBLISHED,e,"audio")),o&&!c&&0===this.getListeners(zy.PUBLISHED_USER_LIST).length&&(fb.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(zy.USER_PUBLISHED,e,"video")),(i&&!s||o&&!c||a)&&t.push(e),o&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(fb.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(e=>{fb.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())})),this.getListeners(zy.PUBLISHED_USER_LIST).length>0?XA("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(fb.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(e=>e.uid).join(", "))),this.safeEmit(zy.PUBLISHED_USER_LIST,t)):fb.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(e=>e.uid).join(", ")))}),this._gateway.signal.on(kw.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:t}=e;this._p2pChannel instanceof fB&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(e=>e.toLowerCase()).filter(e=>{var t;return Dn(t=Object.keys(eb)).call(t,e)}))})}_handleP2PEvents(){this._gateway.signal.on(kw.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(IO.PUBLISH,(e,t,n)=>{const{uid:r}=e;e.forEach(e=>{const{kind:i,ssrcs:o,mid:a,isMuted:s}=e;this._handleP2PAddAudioOrVideoStream(i,r,o[0].ssrcId,a);const c=this._users.find(e=>e.uid===r);return c&&this._p2pChannel instanceof bF?this._p2pChannel.mockSubscribe(c,i,o[0].ssrcId,a).then(()=>{t()}).catch(n):t(),this._handleMuteStream(r,i,!!s)})}),this._gateway.signal.on(IO.CALL,async(e,t,n)=>{if(this._p2pChannel instanceof bF)try{var r;t(await this._p2pChannel.startP2P({turnServer:null===(r=this._joinInfo)||void 0===r?void 0:r.turnServer},e))}catch(e){n(e)}}),this._gateway.signal.on(Dw.P2P_CONNECTION,async e=>{this._p2pChannel instanceof bF&&await this._p2pChannel.p2pConnect(e)}),this._gateway.signal.on(IO.UNPUBLISH,async(e,t,n)=>{if(this._p2pChannel instanceof bF){const{unpubMsg:r,uid:i}=e,o=this._users.find(e=>e.uid===i);if(!o)return fb.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{r.forEach(async e=>{let{stream_type:t}=e;const n=t===Zw.Audio?dO.AUDIO:dO.VIDEO;await this._p2pChannel.unsubscribe(o,n),this._handleMuteStream(i,n,!0)}),t()}catch(e){n(e)}}}),this._gateway.signal.on(IO.CONTROL,async(e,t)=>{const{action:n}=e;switch(n){case yO.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,dO.VIDEO,!0);break;case yO.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,dO.AUDIO,!0);break;case yO.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,dO.VIDEO,!1);break;case yO.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,dO.AUDIO,!1)}}),this._gateway.signal.on(IO.RESTART_ICE,async(e,t,n)=>{if(this._p2pChannel instanceof bF)try{const{direction:n,iceParameter:r}=e;n!==Mw.SEND_ONLY||r?t(await this._p2pChannel.restartICE(n,r)):(this._p2pChannel.handleDisconnect(n),t())}catch(e){n(e)}}),this._gateway.signal.on(IO.CANDIDATE,e=>{if(this._p2pChannel instanceof bF){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}}),this._p2pChannel.on(_O.RequestP2PRestartICE,async(e,t,n)=>{try{const{direction:n}=e;t(await this._gateway.sendExtensionMessage(IO.RESTART_ICE,e,n===Mw.SEND_ONLY))}catch(e){n(e)}}),this._p2pChannel.on(_O.LocalCandidate,e=>{this._gateway.sendExtensionMessage(IO.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(_O.RequestP2PMuteLocal,async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(IO.CONTROL,e,!0),t()}catch(e){n(e)}}),this._p2pChannel.on(_O.RequestP2PUnmuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===Ry.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(_O.RequestP2PMuteRemote,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===Ry.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(_O.StateChange,(e,t)=>{t===pO.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(_O.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===Ry.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(_O.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===Ry.DISCONNECT_P2P?t():n(e)}else t()}),this._p2pChannel.on(_O.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(_O.RequestRePublishDataChannel,(e,t,n)=>{Gh.all(e.map(async e=>{const t=await this._p2pChannel.publishDataChannel([e]);try{t.forEach(e=>{this._uid&&this._gateway.publishDataChannel(this._uid,e,!0)})}catch(e){if(e.code!==Ry.DISCONNECT_P2P)throw e}})).then(t).catch(n)}),this._p2pChannel.on(_O.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:t,kind:n}of e)n===dO.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){n(e)}}),this._p2pChannel.on(_O.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(_O.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(_O.MediaReconnectStart,e=>{this.safeEmit(zy.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(_O.MediaReconnectEnd,e=>{this.safeEmit(zy.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(_O.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(_O.RequestRestartICE,async e=>{if(this._p2pChannel instanceof bF)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(e){return void t.throw(e)}const{iceParameters:o}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(i);await t.next({remoteIceParameters:o})}),this._p2pChannel.on(_O.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(_O.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),a=YU(i,o);await this._p2pChannel.connect(a),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(_O.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(_O.P2PLost,()=>{this.safeEmit(zy.P2P_LOST,this.store.uid)}),this._p2pChannel.on(_O.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(_O.ConnectionTypeChange,e=>{this.safeEmit(zy.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(_O.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(_O.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||"CONNECTED"!==this.connectionState)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},gB("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:o,token:a,uid:s,cid:c,vid:u}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:o,token:a,uid:s,cid:c,vid:u?Number(u):0},PA)}catch(e){throw Array.isArray(e)?e[0]:e}var t}handleVideoInspectEvents(e){e.on(mO.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(zy.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===EO.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(zy.CONTENT_INSPECT_ERROR,new yb(Ry.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(mO.INSPECT_RESULT,(e,t)=>{var n;if((null==t?void 0:t.code)===Ry.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return fb.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(zy.CONTENT_INSPECT_RESULT,e,t)}),e.on(mO.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}async disableContentInspect(){if(!this._inspect)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Iy(e,"enabled"),e){if(!t)throw new yb(Ry.INVALID_PARAMS,"config is required");if(Lj(t),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const e=(n={config:t},gB("ImageModeration").create(n));this._moderation=e,this.handleImageModerationEvents(e);const{appId:r,cname:i,sid:o,token:a,uid:s,cid:c,vid:u}=this._joinInfo;await e.init({appId:r,areaCode:"",cname:i,sid:o,token:a,uid:s,cid:c,vid:u?Number(u):0},PA)}}catch(e){throw Array.isArray(e)?e[0]:e}}else{var n;if(!this._moderation)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(RO.CONNECTION_STATE_CHANGE,(t,n)=>{if(this.safeEmit(zy.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===gO.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new yb(Ry.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(RO.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(e=>"video"===e.trackMediaType)[0])})}setP2PTransport(e){if(function(e){vy(e,"transport",["default","auto","relay","sd-rtn"])}(e),"p2p"!==this.mode)throw new yb(Ry.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,fb.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return fb.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Iy(e,"enabled"),JA("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Cw(RG.prototype,"leave",[Mj],Object.getOwnPropertyDescriptor(RG.prototype,"leave"),RG.prototype),Cw(RG.prototype,"publish",[Uj],Object.getOwnPropertyDescriptor(RG.prototype,"publish"),RG.prototype),Cw(RG.prototype,"unpublish",[xj],Object.getOwnPropertyDescriptor(RG.prototype,"unpublish"),RG.prototype),Cw(RG.prototype,"subscribe",[Vj],Object.getOwnPropertyDescriptor(RG.prototype,"subscribe"),RG.prototype),Cw(RG.prototype,"presubscribe",[Fj],Object.getOwnPropertyDescriptor(RG.prototype,"presubscribe"),RG.prototype),Cw(RG.prototype,"massSubscribe",[Bj],Object.getOwnPropertyDescriptor(RG.prototype,"massSubscribe"),RG.prototype),Cw(RG.prototype,"unsubscribe",[jj],Object.getOwnPropertyDescriptor(RG.prototype,"unsubscribe"),RG.prototype),Cw(RG.prototype,"massUnsubscribe",[Gj],Object.getOwnPropertyDescriptor(RG.prototype,"massUnsubscribe"),RG.prototype),Cw(RG.prototype,"setLowStreamParameter",[Wj],Object.getOwnPropertyDescriptor(RG.prototype,"setLowStreamParameter"),RG.prototype),Cw(RG.prototype,"enableDualStream",[Hj],Object.getOwnPropertyDescriptor(RG.prototype,"enableDualStream"),RG.prototype),Cw(RG.prototype,"disableDualStream",[Kj],Object.getOwnPropertyDescriptor(RG.prototype,"disableDualStream"),RG.prototype),Cw(RG.prototype,"setClientRole",[Yj],Object.getOwnPropertyDescriptor(RG.prototype,"setClientRole"),RG.prototype),Cw(RG.prototype,"setProxyServer",[qj],Object.getOwnPropertyDescriptor(RG.prototype,"setProxyServer"),RG.prototype),Cw(RG.prototype,"setTurnServer",[zj],Object.getOwnPropertyDescriptor(RG.prototype,"setTurnServer"),RG.prototype),Cw(RG.prototype,"setLicense",[Jj],Object.getOwnPropertyDescriptor(RG.prototype,"setLicense"),RG.prototype),Cw(RG.prototype,"startProxyServer",[Xj],Object.getOwnPropertyDescriptor(RG.prototype,"startProxyServer"),RG.prototype),Cw(RG.prototype,"stopProxyServer",[Qj],Object.getOwnPropertyDescriptor(RG.prototype,"stopProxyServer"),RG.prototype),Cw(RG.prototype,"setLocalAccessPointsV2",[Zj],Object.getOwnPropertyDescriptor(RG.prototype,"setLocalAccessPointsV2"),RG.prototype),Cw(RG.prototype,"setLocalAccessPoints",[$j],Object.getOwnPropertyDescriptor(RG.prototype,"setLocalAccessPoints"),RG.prototype),Cw(RG.prototype,"setRemoteDefaultVideoStreamType",[eG],Object.getOwnPropertyDescriptor(RG.prototype,"setRemoteDefaultVideoStreamType"),RG.prototype),Cw(RG.prototype,"setRemoteVideoStreamType",[tG],Object.getOwnPropertyDescriptor(RG.prototype,"setRemoteVideoStreamType"),RG.prototype),Cw(RG.prototype,"setStreamFallbackOption",[iG],Object.getOwnPropertyDescriptor(RG.prototype,"setStreamFallbackOption"),RG.prototype),Cw(RG.prototype,"setEncryptionConfig",[nG],Object.getOwnPropertyDescriptor(RG.prototype,"setEncryptionConfig"),RG.prototype),Cw(RG.prototype,"renewToken",[rG],Object.getOwnPropertyDescriptor(RG.prototype,"renewToken"),RG.prototype),Cw(RG.prototype,"enableAudioVolumeIndicator",[oG],Object.getOwnPropertyDescriptor(RG.prototype,"enableAudioVolumeIndicator"),RG.prototype),Cw(RG.prototype,"startLiveStreaming",[sG],Object.getOwnPropertyDescriptor(RG.prototype,"startLiveStreaming"),RG.prototype),Cw(RG.prototype,"setLiveTranscoding",[aG],Object.getOwnPropertyDescriptor(RG.prototype,"setLiveTranscoding"),RG.prototype),Cw(RG.prototype,"stopLiveStreaming",[cG],Object.getOwnPropertyDescriptor(RG.prototype,"stopLiveStreaming"),RG.prototype),Cw(RG.prototype,"startChannelMediaRelay",[dG],Object.getOwnPropertyDescriptor(RG.prototype,"startChannelMediaRelay"),RG.prototype),Cw(RG.prototype,"updateChannelMediaRelay",[lG],Object.getOwnPropertyDescriptor(RG.prototype,"updateChannelMediaRelay"),RG.prototype),Cw(RG.prototype,"stopChannelMediaRelay",[uG],Object.getOwnPropertyDescriptor(RG.prototype,"stopChannelMediaRelay"),RG.prototype),Cw(RG.prototype,"sendCustomReportMessage",[hG],Object.getOwnPropertyDescriptor(RG.prototype,"sendCustomReportMessage"),RG.prototype),Cw(RG.prototype,"pickSVCLayer",[pG],Object.getOwnPropertyDescriptor(RG.prototype,"pickSVCLayer"),RG.prototype),Cw(RG.prototype,"setRTMConfig",[_G],Object.getOwnPropertyDescriptor(RG.prototype,"setRTMConfig"),RG.prototype),Cw(RG.prototype,"enableContentInspect",[EG],Object.getOwnPropertyDescriptor(RG.prototype,"enableContentInspect"),RG.prototype),Cw(RG.prototype,"disableContentInspect",[fG],Object.getOwnPropertyDescriptor(RG.prototype,"disableContentInspect"),RG.prototype),Cw(RG.prototype,"setImageModeration",[mG],Object.getOwnPropertyDescriptor(RG.prototype,"setImageModeration"),RG.prototype),Cw(RG.prototype,"setP2PTransport",[TG],Object.getOwnPropertyDescriptor(RG.prototype,"setP2PTransport"),RG.prototype),Cw(RG.prototype,"getJoinChannelServiceRecords",[SG],Object.getOwnPropertyDescriptor(RG.prototype,"getJoinChannelServiceRecords"),RG.prototype),Cw(RG.prototype,"setPublishAudioFilterEnabled",[gG],Object.getOwnPropertyDescriptor(RG.prototype,"setPublishAudioFilterEnabled"),RG.prototype),RG);class yG{constructor(e,t){Fg(this,"id",0),Fg(this,"element",void 0),Fg(this,"peerPair",void 0),Fg(this,"context",void 0),Fg(this,"audioPlayerElement",void 0),Fg(this,"audioTrack",void 0),yG.count+=1,this.id=yG.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new Gh(t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}})},t=async(e,t)=>await e.setRemoteDescription(t);try{const n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);const r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(e){throw new yb(Ry.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new yb(Ry.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new yb(Ry.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){fb.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var AG,bG;Fg(yG,"count",0);const wG=window.AudioContext||window.webkitAudioContext,OG=new(AG=Ib({report:vb}),Cw((bG=class{constructor(){Fg(this,"units",[]),Fg(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return fb.debug("the system does not need to process local aec"),-1;this.context||(this.context=new wG);let t=this.units.find(t=>t&&t.getElement()===e);return t||(t=new yG(e,this.context),this.units.push(t)),t.startEchoCancellation(),fb.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return Hv().name!==Bv.SAFARI}}).prototype,"processExternalMediaAEC",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"processExternalMediaAEC"),bG.prototype),bG);function NG(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function DG(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?NG(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):NG(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const PG=window||document;function LG(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!PG)return;const n=nq._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=e=>{if(!(e&&e.blockedURI&&(nq.onSecurityPolicyViolation||nq.getListeners(SO.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;XA("CSP_DETECTED_HOSTNAME_LIST").some(e=>Dn(t).call(t,e))&&(nq.onSecurityPolicyViolation&&"function"==typeof nq.onSecurityPolicyViolation&&nq.onSecurityPolicyViolation(e),nq.getListeners(SO.SECURITY_POLICY_VIOLATION).length>0&&nq.safeEmit(SO.SECURITY_POLICY_VIOLATION,e))};n&&PG.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||nq.getListeners(SO.SECURITY_POLICY_VIOLATION).length>0)&&PG.addEventListener("securitypolicyviolation",r),nq._cspEventHandlerPointer=r}var kG=l,MG=RC,UG=RegExp.prototype,xG=function(e){return e===UG||kG(UG,e)?MG(e):e.flags},VG=i(xG);function FG(e){let t=e.length;for(;--t>=0;)e[t]=0}const BG=256,jG=286,GG=30,WG=15,HG=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),KG=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),YG=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),qG=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zG=new Array(576);FG(zG);const JG=new Array(60);FG(JG);const XG=new Array(512);FG(XG);const QG=new Array(256);FG(QG);const ZG=new Array(29);FG(ZG);const $G=new Array(GG);function eW(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}let tW,iW,nW;function rW(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}FG($G);const oW=e=>e<256?XG[e]:XG[256+(e>>>7)],sW=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},aW=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,sW(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},cW=(e,t,n)=>{aW(e,n[2*t],n[2*t+1])},dW=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},lW=(e,t,n)=>{const r=new Array(16);let i,o,a=0;for(i=1;i<=WG;i++)a=a+n[i-1]<<1,r[i]=a;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=dW(r[t]++,t))}},uW=e=>{let t;for(t=0;t<jG;t++)e.dyn_ltree[2*t]=0;for(t=0;t<GG;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},hW=e=>{e.bi_valid>8?sW(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},pW=(e,t,n,r)=>{const i=2*t,o=2*n;return e[i]<e[o]||e[i]===e[o]&&r[t]<=r[n]},_W=(e,t,n)=>{const r=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&pW(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!pW(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},EW=(e,t,n)=>{let r,i,o,a,s=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+s++],r+=(255&e.pending_buf[e.sym_buf+s++])<<8,i=e.pending_buf[e.sym_buf+s++],0===r?cW(e,i,t):(o=QG[i],cW(e,o+BG+1,t),a=HG[o],0!==a&&(i-=ZG[o],aW(e,i,a)),r--,o=oW(r),cW(e,o,n),a=KG[o],0!==a&&(r-=$G[o],aW(e,r,a)))}while(s<e.sym_next);cW(e,256,t)},fW=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let a,s,c,u=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<o;a++)0!==n[2*a]?(e.heap[++e.heap_len]=u=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=u<2?++u:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=r[2*c+1]);for(t.max_code=u,a=e.heap_len>>1;a>=1;a--)_W(e,n,a);c=o;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],_W(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,n[2*c]=n[2*a]+n[2*s],e.depth[c]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,n[2*a+1]=n[2*s+1]=c,e.heap[1]=c++,_W(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,r=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,c=t.stat_desc.max_length;let u,l,d,h,p,f,m=0;for(h=0;h<=WG;h++)e.bl_count[h]=0;for(n[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)l=e.heap[u],h=n[2*n[2*l+1]+1]+1,h>c&&(h=c,m++),n[2*l+1]=h,l>r||(e.bl_count[h]++,p=0,l>=s&&(p=a[l-s]),f=n[2*l],e.opt_len+=f*(h+p),o&&(e.static_len+=f*(i[2*l+1]+p)));if(0!==m){do{for(h=c-1;0===e.bl_count[h];)h--;e.bl_count[h]--,e.bl_count[h+1]+=2,e.bl_count[c]--,m-=2}while(m>0);for(h=c;0!==h;h--)for(l=e.bl_count[h];0!==l;)d=e.heap[--u],d>r||(n[2*d+1]!==h&&(e.opt_len+=(h-n[2*d+1])*n[2*d],n[2*d+1]=h),l--)}})(e,t),lW(n,u,e.bl_count)},mW=(e,t,n)=>{let r,i,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++s<c&&i===a||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4))},TW=(e,t,n)=>{let r,i,o=-1,a=t[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++s<c&&i===a)){if(s<u)do{cW(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(cW(e,i,e.bl_tree),s--),cW(e,16,e.bl_tree),aW(e,s-3,2)):s<=10?(cW(e,17,e.bl_tree),aW(e,s-3,3)):(cW(e,18,e.bl_tree),aW(e,s-11,7));s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4)}};let SW=!1;const gW=(e,t,n,r)=>{aW(e,0+(r?1:0),3),hW(e),sW(e,n),sW(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var RW=e=>{SW||((()=>{let e,t,n,r,i;const o=new Array(16);for(n=0,r=0;r<28;r++)for(ZG[r]=n,e=0;e<1<<HG[r];e++)QG[n++]=r;for(QG[n-1]=r,i=0,r=0;r<16;r++)for($G[r]=i,e=0;e<1<<KG[r];e++)XG[i++]=r;for(i>>=7;r<GG;r++)for($G[r]=i<<7,e=0;e<1<<KG[r]-7;e++)XG[256+i++]=r;for(t=0;t<=WG;t++)o[t]=0;for(e=0;e<=143;)zG[2*e+1]=8,e++,o[8]++;for(;e<=255;)zG[2*e+1]=9,e++,o[9]++;for(;e<=279;)zG[2*e+1]=7,e++,o[7]++;for(;e<=287;)zG[2*e+1]=8,e++,o[8]++;for(lW(zG,287,o),e=0;e<GG;e++)JG[2*e+1]=5,JG[2*e]=dW(e,5);tW=new eW(zG,HG,257,jG,WG),iW=new eW(JG,KG,0,GG,WG),nW=new eW(new Array(0),YG,0,19,7)})(),SW=!0),e.l_desc=new rW(e.dyn_ltree,tW),e.d_desc=new rW(e.dyn_dtree,iW),e.bl_desc=new rW(e.bl_tree,nW),e.bi_buf=0,e.bi_valid=0,uW(e)},CW=(e,t,n,r)=>{let i,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<BG;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),fW(e,e.l_desc),fW(e,e.d_desc),a=(e=>{let t;for(mW(e,e.dyn_ltree,e.l_desc.max_code),mW(e,e.dyn_dtree,e.d_desc.max_code),fW(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*qG[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=n+5,n+4<=i&&-1!==t?gW(e,t,n,r):4===e.strategy||o===i?(aW(e,2+(r?1:0),3),EW(e,zG,JG)):(aW(e,4+(r?1:0),3),((e,t,n,r)=>{let i;for(aW(e,t-257,5),aW(e,n-1,5),aW(e,r-4,4),i=0;i<r;i++)aW(e,e.bl_tree[2*qG[i]+1],3);TW(e,e.dyn_ltree,t-1),TW(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),EW(e,e.dyn_ltree,e.dyn_dtree)),uW(e),r&&hW(e)},IW=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(QG[n]+BG+1)]++,e.dyn_dtree[2*oW(t)]++),e.sym_next===e.sym_end),vW=e=>{aW(e,2,3),cW(e,256,zG),(e=>{16===e.bi_valid?(sW(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},yW={_tr_init:RW,_tr_stored_block:gW,_tr_flush_block:CW,_tr_tally:IW,_tr_align:vW},AW=(e,t,n,r)=>{let i=65535&e,o=e>>>16&65535,a=0;for(;0!==n;){a=n>2e3?2e3:n,n-=a;do{i=i+t[r++]|0,o=o+i|0}while(--a);i%=65521,o%=65521}return i|o<<16};const bW=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var wW=(e,t,n,r)=>{const i=bW,o=r+n;e^=-1;for(let n=r;n<o;n++)e=e>>>8^i[255&(e^t[n])];return~e},OW={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},NW={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:DW,_tr_stored_block:PW,_tr_flush_block:LW,_tr_tally:kW,_tr_align:MW}=yW,{Z_NO_FLUSH:UW,Z_PARTIAL_FLUSH:xW,Z_FULL_FLUSH:VW,Z_FINISH:FW,Z_BLOCK:BW,Z_OK:jW,Z_STREAM_END:GW,Z_STREAM_ERROR:WW,Z_DATA_ERROR:HW,Z_BUF_ERROR:KW,Z_DEFAULT_COMPRESSION:YW,Z_FILTERED:qW,Z_HUFFMAN_ONLY:zW,Z_RLE:JW,Z_FIXED:XW,Z_DEFAULT_STRATEGY:QW,Z_UNKNOWN:ZW,Z_DEFLATED:$W}=NW,eH=286,tH=30,iH=19,nH=2*eH+1,rH=15,oH=258,sH=262,aH=42,cH=113,dH=666,lH=(e,t)=>(e.msg=OW[t],t),uH=e=>2*e-(e>4?9:0),hH=e=>{let t=e.length;for(;--t>=0;)e[t]=0},pH=e=>{let t,n,r,i=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);t=i,r=t;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)};let _H=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const EH=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},fH=(e,t)=>{LW(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,EH(e.strm)},mH=(e,t)=>{e.pending_buf[e.pending++]=t},TH=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},SH=(e,t,n,r)=>{let i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=AW(e.adler,t,i,n):2===e.state.wrap&&(e.adler=wW(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},gH=(e,t)=>{let n,r,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match;const c=e.strstart>e.w_size-sH?e.strstart-(e.w_size-sH):0,u=e.window,l=e.w_mask,d=e.prev,h=e.strstart+oH;let p=u[o+a-1],f=u[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(n=t,u[n+a]===f&&u[n+a-1]===p&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<h);if(r=oH-(h-o),o=h-oH,r>a){if(e.match_start=t,a=r,r>=s)break;p=u[o+a-1],f=u[o+a]}}}while((t=d[t&l])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead},RH=e=>{const t=e.w_size;let n,r,i;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-sH)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),pH(e),r+=t),0===e.strm.avail_in)break;if(n=SH(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=_H(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=_H(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<sH&&0!==e.strm.avail_in)},CH=(e,t)=>{let n,r,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,s=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<o&&(0===n&&t!==FW||t===UW||n!==r+e.strm.avail_in))break;a=t===FW&&n===r+e.strm.avail_in?1:0,PW(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,EH(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(SH(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===a);return s-=e.strm.avail_in,s&&(s>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=s&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-s,e.strm.next_in),e.strstart),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==UW&&t!==FW&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(SH(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,r=e.strstart-e.block_start,(r>=o||(r||t===FW)&&t!==UW&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,a=t===FW&&0===e.strm.avail_in&&n===r?1:0,PW(e,e.block_start,n,a),e.block_start+=n,EH(e.strm)),a?3:1)},IH=(e,t)=>{let n,r;for(;;){if(e.lookahead<sH){if(RH(e),e.lookahead<sH&&t===UW)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=_H(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-sH&&(e.match_length=gH(e,n)),e.match_length>=3)if(r=kW(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=_H(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=_H(e,e.ins_h,e.window[e.strstart+1]);else r=kW(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(fH(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===FW?(fH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(fH(e,!1),0===e.strm.avail_out)?1:2},vH=(e,t)=>{let n,r,i;for(;;){if(e.lookahead<sH){if(RH(e),e.lookahead<sH&&t===UW)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=_H(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-sH&&(e.match_length=gH(e,n),e.match_length<=5&&(e.strategy===qW||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=kW(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=_H(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(fH(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(r=kW(e,0,e.window[e.strstart-1]),r&&fH(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=kW(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===FW?(fH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(fH(e,!1),0===e.strm.avail_out)?1:2};function yH(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}const AH=[new yH(0,0,0,0,CH),new yH(4,4,8,4,IH),new yH(4,5,16,8,IH),new yH(4,6,32,32,IH),new yH(4,4,16,16,vH),new yH(8,16,32,32,vH),new yH(8,16,128,128,vH),new yH(8,32,128,256,vH),new yH(32,128,258,1024,vH),new yH(32,258,258,4096,vH)];function bH(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$W,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*nH),this.dyn_dtree=new Uint16Array(2*(2*tH+1)),this.bl_tree=new Uint16Array(2*(2*iH+1)),hH(this.dyn_ltree),hH(this.dyn_dtree),hH(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(rH+1),this.heap=new Uint16Array(2*eH+1),hH(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*eH+1),hH(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const wH=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==aH&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==cH&&t.status!==dH?1:0},OH=e=>{if(wH(e))return lH(e,WW);e.total_in=e.total_out=0,e.data_type=ZW;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?aH:cH,e.adler=2===t.wrap?0:1,t.last_flush=-2,DW(t),jW},NH=e=>{const t=OH(e);return t===jW&&(e=>{e.window_size=2*e.w_size,hH(e.head),e.max_lazy_match=AH[e.level].max_lazy,e.good_match=AH[e.level].good_length,e.nice_match=AH[e.level].nice_length,e.max_chain_length=AH[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},DH=(e,t,n,r,i,o)=>{if(!e)return WW;let a=1;if(t===YW&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||n!==$W||r<8||r>15||t<0||t>9||o<0||o>XW||8===r&&1!==a)return lH(e,WW);8===r&&(r=9);const s=new bH;return e.state=s,s.strm=e,s.status=aH,s.wrap=a,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new Uint8Array(2*s.w_size),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new Uint8Array(s.pending_buf_size),s.sym_buf=s.lit_bufsize,s.sym_end=3*(s.lit_bufsize-1),s.level=t,s.strategy=o,s.method=n,NH(e)};var PH=(e,t)=>{if(wH(e)||t>BW||t<0)return e?lH(e,WW):WW;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===dH&&t!==FW)return lH(e,0===e.avail_out?KW:WW);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(EH(e),0===e.avail_out)return n.last_flush=-1,jW}else if(0===e.avail_in&&uH(t)<=uH(r)&&t!==FW)return lH(e,KW);if(n.status===dH&&0!==e.avail_in)return lH(e,KW);if(n.status===aH&&0===n.wrap&&(n.status=cH),n.status===aH){let t=$W+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=zW||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,TH(n,t),0!==n.strstart&&(TH(n,e.adler>>>16),TH(n,65535&e.adler)),e.adler=1,n.status=cH,EH(e),0!==n.pending)return n.last_flush=-1,jW}if(57===n.status)if(e.adler=0,mH(n,31),mH(n,139),mH(n,8),n.gzhead)mH(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),mH(n,255&n.gzhead.time),mH(n,n.gzhead.time>>8&255),mH(n,n.gzhead.time>>16&255),mH(n,n.gzhead.time>>24&255),mH(n,9===n.level?2:n.strategy>=zW||n.level<2?4:0),mH(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(mH(n,255&n.gzhead.extra.length),mH(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=wW(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(mH(n,0),mH(n,0),mH(n,0),mH(n,0),mH(n,0),mH(n,9===n.level?2:n.strategy>=zW||n.level<2?4:0),mH(n,3),n.status=cH,EH(e),0!==n.pending)return n.last_flush=-1,jW;if(69===n.status){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=wW(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,EH(e),0!==n.pending)return n.last_flush=-1,jW;t=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=wW(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=wW(e.adler,n.pending_buf,n.pending-r,r)),EH(e),0!==n.pending)return n.last_flush=-1,jW;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,mH(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=wW(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=wW(e.adler,n.pending_buf,n.pending-r,r)),EH(e),0!==n.pending)return n.last_flush=-1,jW;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,mH(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=wW(e.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(EH(e),0!==n.pending))return n.last_flush=-1,jW;mH(n,255&e.adler),mH(n,e.adler>>8&255),e.adler=0}if(n.status=cH,EH(e),0!==n.pending)return n.last_flush=-1,jW}if(0!==e.avail_in||0!==n.lookahead||t!==UW&&n.status!==dH){let r=0===n.level?CH(n,t):n.strategy===zW?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(RH(e),0===e.lookahead)){if(t===UW)return 1;break}if(e.match_length=0,n=kW(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(fH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===FW?(fH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(fH(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===JW?((e,t)=>{let n,r,i,o;const a=e.window;for(;;){if(e.lookahead<=oH){if(RH(e),e.lookahead<=oH&&t===UW)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,r=a[i],r===a[++i]&&r===a[++i]&&r===a[++i])){o=e.strstart+oH;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<o);e.match_length=oH-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=kW(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=kW(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(fH(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===FW?(fH(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(fH(e,!1),0===e.strm.avail_out)?1:2})(n,t):AH[n.level].func(n,t);if(3!==r&&4!==r||(n.status=dH),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),jW;if(2===r&&(t===xW?MW(n):t!==BW&&(PW(n,0,0,!1),t===VW&&(hH(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),EH(e),0===e.avail_out))return n.last_flush=-1,jW}return t!==FW?jW:n.wrap<=0?GW:(2===n.wrap?(mH(n,255&e.adler),mH(n,e.adler>>8&255),mH(n,e.adler>>16&255),mH(n,e.adler>>24&255),mH(n,255&e.total_in),mH(n,e.total_in>>8&255),mH(n,e.total_in>>16&255),mH(n,e.total_in>>24&255)):(TH(n,e.adler>>>16),TH(n,65535&e.adler)),EH(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?jW:GW)},LH=(e,t)=>{let n=t.length;if(wH(e))return WW;const r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==aH||r.lookahead)return WW;if(1===i&&(e.adler=AW(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(hH(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const o=e.avail_in,a=e.next_in,s=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,RH(r);r.lookahead>=3;){let e=r.strstart,t=r.lookahead-2;do{r.ins_h=_H(r,r.ins_h,r.window[e+3-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=2,RH(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=a,e.input=s,e.avail_in=o,r.wrap=i,jW},kH={deflateInit:(e,t)=>DH(e,t,$W,15,8,QW),deflateInit2:DH,deflateReset:NH,deflateResetKeep:OH,deflateSetHeader:(e,t)=>wH(e)||2!==e.state.wrap?WW:(e.state.gzhead=t,jW),deflate:PH,deflateEnd:e=>{if(wH(e))return WW;const t=e.state.status;return e.state=null,t===cH?lH(e,HW):jW},deflateSetDictionary:LH,deflateInfo:"pako deflate (from Nodeca project)"};const MH=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var UH={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)MH(n,t)&&(e[t]=n[t])}}return e},flattenChunks:e=>{let t=0;for(let n=0,r=e.length;n<r;n++)t+=e[n].length;const n=new Uint8Array(t);for(let t=0,r=0,i=e.length;t<i;t++){let i=e[t];n.set(i,r),r+=i.length}return n}};let xH=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){xH=!1}const VH=new Uint8Array(256);for(let e=0;e<256;e++)VH[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;VH[254]=VH[254]=1;var FH={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,i,o,a=e.length,s=0;for(i=0;i<a;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(s),o=0,i=0;o<s;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<a&&(r=e.charCodeAt(i+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,i;const o=new Array(2*n);for(i=0,r=0;r<n;){let t=e[r++];if(t<128){o[i++]=t;continue}let a=VH[t];if(a>4)o[i++]=65533,r+=a-1;else{for(t&=2===a?31:3===a?15:7;a>1&&r<n;)t=t<<6|63&e[r++],a--;a>1?o[i++]=65533:t<65536?o[i++]=t:(t-=65536,o[i++]=55296|t>>10&1023,o[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&xH)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+VH[e[n]]>t?n:t}},BH=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const jH=Object.prototype.toString,{Z_NO_FLUSH:GH,Z_SYNC_FLUSH:WH,Z_FULL_FLUSH:HH,Z_FINISH:KH,Z_OK:YH,Z_STREAM_END:qH,Z_DEFAULT_COMPRESSION:zH,Z_DEFAULT_STRATEGY:JH,Z_DEFLATED:XH}=NW;function QH(e){this.options=UH.assign({level:zH,method:XH,chunkSize:16384,windowBits:15,memLevel:8,strategy:JH},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BH,this.strm.avail_out=0;let n=kH.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==YH)throw new Error(OW[n]);if(t.header&&kH.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?FH.string2buf(t.dictionary):"[object ArrayBuffer]"===jH.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=kH.deflateSetDictionary(this.strm,e),n!==YH)throw new Error(OW[n]);this._dict_set=!0}}function ZH(e,t){const n=new QH(t);if(n.push(e,!0),n.err)throw n.msg||OW[n.err];return n.result}QH.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?KH:GH,n.input="string"==typeof e?FH.string2buf(e):"[object ArrayBuffer]"===jH.call(e)?new Uint8Array(e):e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(o===WH||o===HH)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=kH.deflate(n,o),i===qH)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=kH.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===YH;if(0!==n.avail_out){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},QH.prototype.onData=function(e){this.chunks.push(e)},QH.prototype.onEnd=function(e){e===YH&&(this.result=UH.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var $H={Deflate:QH,deflate:ZH,deflateRaw:function(e,t){return(t=t||{}).raw=!0,ZH(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,ZH(e,t)},constants:NW};const eK=16209;var tK=function(e,t){let n,r,i,o,a,s,c,u,l,d,h,p,f,m,g,v,E,y,_,b,S,w,T,R;const C=e.state;n=e.next_in,T=e.input,r=n+(e.avail_in-5),i=e.next_out,R=e.output,o=i-(t-e.avail_out),a=i+(e.avail_out-257),s=C.dmax,c=C.wsize,u=C.whave,l=C.wnext,d=C.window,h=C.hold,p=C.bits,f=C.lencode,m=C.distcode,g=(1<<C.lenbits)-1,v=(1<<C.distbits)-1;e:do{p<15&&(h+=T[n++]<<p,p+=8,h+=T[n++]<<p,p+=8),E=f[h&g];t:for(;;){if(y=E>>>24,h>>>=y,p-=y,y=E>>>16&255,0===y)R[i++]=65535&E;else{if(!(16&y)){if(!(64&y)){E=f[(65535&E)+(h&(1<<y)-1)];continue t}if(32&y){C.mode=16191;break e}e.msg="invalid literal/length code",C.mode=eK;break e}_=65535&E,y&=15,y&&(p<y&&(h+=T[n++]<<p,p+=8),_+=h&(1<<y)-1,h>>>=y,p-=y),p<15&&(h+=T[n++]<<p,p+=8,h+=T[n++]<<p,p+=8),E=m[h&v];n:for(;;){if(y=E>>>24,h>>>=y,p-=y,y=E>>>16&255,!(16&y)){if(!(64&y)){E=m[(65535&E)+(h&(1<<y)-1)];continue n}e.msg="invalid distance code",C.mode=eK;break e}if(b=65535&E,y&=15,p<y&&(h+=T[n++]<<p,p+=8,p<y&&(h+=T[n++]<<p,p+=8)),b+=h&(1<<y)-1,b>s){e.msg="invalid distance too far back",C.mode=eK;break e}if(h>>>=y,p-=y,y=i-o,b>y){if(y=b-y,y>u&&C.sane){e.msg="invalid distance too far back",C.mode=eK;break e}if(S=0,w=d,0===l){if(S+=c-y,y<_){_-=y;do{R[i++]=d[S++]}while(--y);S=i-b,w=R}}else if(l<y){if(S+=c+l-y,y-=l,y<_){_-=y;do{R[i++]=d[S++]}while(--y);if(S=0,l<_){y=l,_-=y;do{R[i++]=d[S++]}while(--y);S=i-b,w=R}}}else if(S+=l-y,y<_){_-=y;do{R[i++]=d[S++]}while(--y);S=i-b,w=R}for(;_>2;)R[i++]=w[S++],R[i++]=w[S++],R[i++]=w[S++],_-=3;_&&(R[i++]=w[S++],_>1&&(R[i++]=w[S++]))}else{S=i-b;do{R[i++]=R[S++],R[i++]=R[S++],R[i++]=R[S++],_-=3}while(_>2);_&&(R[i++]=R[S++],_>1&&(R[i++]=R[S++]))}break}}break}}while(n<r&&i<a);_=p>>3,n-=_,p-=_<<3,h&=(1<<p)-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<a?a-i+257:257-(i-a),C.hold=h,C.bits=p};const iK=15,nK=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),rK=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),oK=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),sK=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var aK=(e,t,n,r,i,o,a,s)=>{const c=s.bits;let u,l,d,h,p,f,m=0,g=0,v=0,E=0,y=0,_=0,b=0,S=0,w=0,T=0,R=null;const C=new Uint16Array(16),I=new Uint16Array(16);let O,A,N,k=null;for(m=0;m<=iK;m++)C[m]=0;for(g=0;g<r;g++)C[t[n+g]]++;for(y=c,E=iK;E>=1&&0===C[E];E--);if(y>E&&(y=E),0===E)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(v=1;v<E&&0===C[v];v++);for(y<v&&(y=v),S=1,m=1;m<=iK;m++)if(S<<=1,S-=C[m],S<0)return-1;if(S>0&&(0===e||1!==E))return-1;for(I[1]=0,m=1;m<iK;m++)I[m+1]=I[m]+C[m];for(g=0;g<r;g++)0!==t[n+g]&&(a[I[t[n+g]]++]=g);if(0===e?(R=k=a,f=20):1===e?(R=nK,k=rK,f=257):(R=oK,k=sK,f=0),T=0,g=0,m=v,p=o,_=y,b=0,d=-1,w=1<<y,h=w-1,1===e&&w>852||2===e&&w>592)return 1;for(;;){O=m-b,a[g]+1<f?(A=0,N=a[g]):a[g]>=f?(A=k[a[g]-f],N=R[a[g]-f]):(A=96,N=0),u=1<<m-b,l=1<<_,v=l;do{l-=u,i[p+(T>>b)+l]=O<<24|A<<16|N}while(0!==l);for(u=1<<m-1;T&u;)u>>=1;if(0!==u?(T&=u-1,T+=u):T=0,g++,0==--C[m]){if(m===E)break;m=t[n+a[g]]}if(m>y&&(T&h)!==d){for(0===b&&(b=y),p+=v,_=m-b,S=1<<_;_+b<E&&(S-=C[_+b],!(S<=0));)_++,S<<=1;if(w+=1<<_,1===e&&w>852||2===e&&w>592)return 1;d=T&h,i[d]=y<<24|_<<16|p-o}}return 0!==T&&(i[p+T]=m-b<<24|64<<16),s.bits=y,0};const{Z_FINISH:cK,Z_BLOCK:dK,Z_TREES:lK,Z_OK:uK,Z_STREAM_END:hK,Z_NEED_DICT:pK,Z_STREAM_ERROR:_K,Z_DATA_ERROR:EK,Z_MEM_ERROR:fK,Z_BUF_ERROR:mK,Z_DEFLATED:TK}=NW,SK=16180,gK=16190,RK=16191,CK=16192,IK=16194,vK=16199,yK=16200,AK=16206,bK=16209,wK=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function OK(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const NK=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<SK||t.mode>16211?1:0},DK=e=>{if(NK(e))return _K;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=SK,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,uK},PK=e=>{if(NK(e))return _K;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,DK(e)},LK=(e,t)=>{let n;if(NK(e))return _K;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?_K:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,PK(e))},kK=(e,t)=>{if(!e)return _K;const n=new OK;e.state=n,n.strm=e,n.window=null,n.mode=SK;const r=LK(e,t);return r!==uK&&(e.state=null),r};let MK,UK,xK=!0;const VK=e=>{if(xK){MK=new Int32Array(512),UK=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(aK(1,e.lens,0,288,MK,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;aK(2,e.lens,0,32,UK,0,e.work,{bits:5}),xK=!1}e.lencode=MK,e.lenbits=9,e.distcode=UK,e.distbits=5},FK=(e,t,n,r)=>{let i;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>r&&(i=r),o.window.set(t.subarray(n-r,n-r+i),o.wnext),(r-=i)?(o.window.set(t.subarray(n-r,n),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var BK=(e,t)=>{let n,r,i,o,a,s,c,u,l,d,h,p,f,m,g,v,E,y,_,b,S,w,T=0;const R=new Uint8Array(4);let C,I;const O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(NK(e)||!e.output||!e.input&&0!==e.avail_in)return _K;n=e.state,n.mode===RK&&(n.mode=CK),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,s=e.avail_in,u=n.hold,l=n.bits,d=s,h=c,w=uK;e:for(;;)switch(n.mode){case SK:if(0===n.wrap){n.mode=CK;break}for(;l<16;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}if(2&n.wrap&&35615===u){0===n.wbits&&(n.wbits=15),n.check=0,R[0]=255&u,R[1]=u>>>8&255,n.check=wW(n.check,R,2,0),u=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=bK;break}if((15&u)!==TK){e.msg="unknown compression method",n.mode=bK;break}if(u>>>=4,l-=4,S=8+(15&u),0===n.wbits&&(n.wbits=S),S>15||S>n.wbits){e.msg="invalid window size",n.mode=bK;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&u?16189:RK,u=0,l=0;break;case 16181:for(;l<16;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}if(n.flags=u,(255&VG(n))!==TK){e.msg="unknown compression method",n.mode=bK;break}if(57344&VG(n)){e.msg="unknown header flags set",n.mode=bK;break}n.head&&(n.head.text=u>>8&1),512&VG(n)&&4&n.wrap&&(R[0]=255&u,R[1]=u>>>8&255,n.check=wW(n.check,R,2,0)),u=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}n.head&&(n.head.time=u),512&VG(n)&&4&n.wrap&&(R[0]=255&u,R[1]=u>>>8&255,R[2]=u>>>16&255,R[3]=u>>>24&255,n.check=wW(n.check,R,4,0)),u=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&VG(n)&&4&n.wrap&&(R[0]=255&u,R[1]=u>>>8&255,n.check=wW(n.check,R,2,0)),u=0,l=0,n.mode=16184;case 16184:if(1024&VG(n)){for(;l<16;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&VG(n)&&4&n.wrap&&(R[0]=255&u,R[1]=u>>>8&255,n.check=wW(n.check,R,2,0)),u=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&VG(n)&&(p=n.length,p>s&&(p=s),p&&(n.head&&(S=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(o,o+p),S)),512&VG(n)&&4&n.wrap&&(n.check=wW(n.check,r,p,o)),s-=p,o+=p,n.length-=p),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&VG(n)){if(0===s)break e;p=0;do{S=r[o+p++],n.head&&S&&n.length<65536&&(n.head.name+=String.fromCharCode(S))}while(S&&p<s);if(512&VG(n)&&4&n.wrap&&(n.check=wW(n.check,r,p,o)),s-=p,o+=p,S)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&VG(n)){if(0===s)break e;p=0;do{S=r[o+p++],n.head&&S&&n.length<65536&&(n.head.comment+=String.fromCharCode(S))}while(S&&p<s);if(512&VG(n)&&4&n.wrap&&(n.check=wW(n.check,r,p,o)),s-=p,o+=p,S)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&VG(n)){for(;l<16;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}if(4&n.wrap&&u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=bK;break}u=0,l=0}n.head&&(n.head.hcrc=VG(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=RK;break;case 16189:for(;l<32;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}e.adler=n.check=wK(u),u=0,l=0,n.mode=gK;case gK:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=l,pK;e.adler=n.check=1,n.mode=RK;case RK:if(t===dK||t===lK)break e;case CK:if(n.last){u>>>=7&l,l-=7&l,n.mode=AK;break}for(;l<3;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}switch(n.last=1&u,u>>>=1,l-=1,3&u){case 0:n.mode=16193;break;case 1:if(VK(n),n.mode=vK,t===lK){u>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=bK}u>>>=2,l-=2;break;case 16193:for(u>>>=7&l,l-=7&l;l<32;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=bK;break}if(n.length=65535&u,u=0,l=0,n.mode=IK,t===lK)break e;case IK:n.mode=16195;case 16195:if(p=n.length,p){if(p>s&&(p=s),p>c&&(p=c),0===p)break e;i.set(r.subarray(o,o+p),a),s-=p,o+=p,c-=p,a+=p,n.length-=p;break}n.mode=RK;break;case 16196:for(;l<14;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=bK;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}n.lens[O[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[O[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},w=aK(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,w){e.msg="invalid code lengths set",n.mode=bK;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;T=n.lencode[u&(1<<n.lenbits)-1],g=T>>>24,v=T>>>16&255,E=65535&T,!(g<=l);){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}if(E<16)u>>>=g,l-=g,n.lens[n.have++]=E;else{if(16===E){for(I=g+2;l<I;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}if(u>>>=g,l-=g,0===n.have){e.msg="invalid bit length repeat",n.mode=bK;break}S=n.lens[n.have-1],p=3+(3&u),u>>>=2,l-=2}else if(17===E){for(I=g+3;l<I;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}u>>>=g,l-=g,S=0,p=3+(7&u),u>>>=3,l-=3}else{for(I=g+7;l<I;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}u>>>=g,l-=g,S=0,p=11+(127&u),u>>>=7,l-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=bK;break}for(;p--;)n.lens[n.have++]=S}}if(n.mode===bK)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=bK;break}if(n.lenbits=9,C={bits:n.lenbits},w=aK(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,w){e.msg="invalid literal/lengths set",n.mode=bK;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},w=aK(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,w){e.msg="invalid distances set",n.mode=bK;break}if(n.mode=vK,t===lK)break e;case vK:n.mode=yK;case yK:if(s>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=l,tK(e,h),a=e.next_out,i=e.output,c=e.avail_out,o=e.next_in,r=e.input,s=e.avail_in,u=n.hold,l=n.bits,n.mode===RK&&(n.back=-1);break}for(n.back=0;T=n.lencode[u&(1<<n.lenbits)-1],g=T>>>24,v=T>>>16&255,E=65535&T,!(g<=l);){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}if(v&&!(240&v)){for(y=g,_=v,b=E;T=n.lencode[b+((u&(1<<y+_)-1)>>y)],g=T>>>24,v=T>>>16&255,E=65535&T,!(y+g<=l);){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=g,l-=g,n.back+=g,n.length=E,0===v){n.mode=16205;break}if(32&v){n.back=-1,n.mode=RK;break}if(64&v){e.msg="invalid literal/length code",n.mode=bK;break}n.extra=15&v,n.mode=16201;case 16201:if(n.extra){for(I=n.extra;l<I;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;T=n.distcode[u&(1<<n.distbits)-1],g=T>>>24,v=T>>>16&255,E=65535&T,!(g<=l);){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}if(!(240&v)){for(y=g,_=v,b=E;T=n.distcode[b+((u&(1<<y+_)-1)>>y)],g=T>>>24,v=T>>>16&255,E=65535&T,!(y+g<=l);){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=g,l-=g,n.back+=g,64&v){e.msg="invalid distance code",n.mode=bK;break}n.offset=E,n.extra=15&v,n.mode=16203;case 16203:if(n.extra){for(I=n.extra;l<I;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=bK;break}n.mode=16204;case 16204:if(0===c)break e;if(p=h-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=bK;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),m=n.window}else m=i,f=a-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{i[a++]=m[f++]}while(--p);0===n.length&&(n.mode=yK);break;case 16205:if(0===c)break e;i[a++]=n.length,c--,n.mode=yK;break;case AK:if(n.wrap){for(;l<32;){if(0===s)break e;s--,u|=r[o++]<<l,l+=8}if(h-=c,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=VG(n)?wW(n.check,i,h,a-h):AW(n.check,i,h,a-h)),h=c,4&n.wrap&&(VG(n)?u:wK(u))!==n.check){e.msg="incorrect data check",n.mode=bK;break}u=0,l=0}n.mode=16207;case 16207:if(n.wrap&&VG(n)){for(;l<32;){if(0===s)break e;s--,u+=r[o++]<<l,l+=8}if(4&n.wrap&&u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=bK;break}u=0,l=0}n.mode=16208;case 16208:w=hK;break e;case bK:w=EK;break e;case 16210:return fK;default:return _K}return e.next_out=a,e.avail_out=c,e.next_in=o,e.avail_in=s,n.hold=u,n.bits=l,(n.wsize||h!==e.avail_out&&n.mode<bK&&(n.mode<AK||t!==cK))&&FK(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=VG(n)?wW(n.check,i,h,e.next_out-h):AW(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===RK?128:0)+(n.mode===vK||n.mode===IK?256:0),(0===d&&0===h||t===cK)&&w===uK&&(w=mK),w},jK={inflateReset:PK,inflateReset2:LK,inflateResetKeep:DK,inflateInit:e=>kK(e,15),inflateInit2:kK,inflate:BK,inflateEnd:e=>{if(NK(e))return _K;let t=e.state;return t.window&&(t.window=null),e.state=null,uK},inflateGetHeader:(e,t)=>{if(NK(e))return _K;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,uK):_K},inflateSetDictionary:(e,t)=>{const n=t.length;let r,i,o;return NK(e)?_K:(r=e.state,0!==r.wrap&&r.mode!==gK?_K:r.mode===gK&&(i=1,i=AW(i,t,n,0),i!==r.check)?EK:(o=FK(e,t,n,n),o?(r.mode=16210,fK):(r.havedict=1,uK)))},inflateInfo:"pako inflate (from Nodeca project)"},GK=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const WK=Object.prototype.toString,{Z_NO_FLUSH:HK,Z_FINISH:KK,Z_OK:YK,Z_STREAM_END:qK,Z_NEED_DICT:zK,Z_STREAM_ERROR:JK,Z_DATA_ERROR:XK,Z_MEM_ERROR:QK}=NW;function ZK(e){this.options=UH.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BH,this.strm.avail_out=0;let n=jK.inflateInit2(this.strm,t.windowBits);if(n!==YK)throw new Error(OW[n]);if(this.header=new GK,jK.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=FH.string2buf(t.dictionary):"[object ArrayBuffer]"===WK.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=jK.inflateSetDictionary(this.strm,t.dictionary),n!==YK)))throw new Error(OW[n])}function $K(e,t){const n=new ZK(t);if(n.push(e),n.err)throw n.msg||OW[n.err];return n.result}ZK.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let o,a,s;if(this.ended)return!1;for(a=t===~~t?t:!0===t?KK:HK,n.input="[object ArrayBuffer]"===WK.call(e)?new Uint8Array(e):e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),o=jK.inflate(n,a),o===zK&&i&&(o=jK.inflateSetDictionary(n,i),o===YK?o=jK.inflate(n,a):o===XK&&(o=zK));n.avail_in>0&&o===qK&&n.state.wrap>0&&0!==e[n.next_in];)jK.inflateReset(n),o=jK.inflate(n,a);switch(o){case JK:case XK:case zK:case QK:return this.onEnd(o),this.ended=!0,!1}if(s=n.avail_out,n.next_out&&(0===n.avail_out||o===qK))if("string"===this.options.to){let e=FH.utf8border(n.output,n.next_out),t=n.next_out-e,i=FH.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==YK||0!==s){if(o===qK)return o=jK.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},ZK.prototype.onData=function(e){this.chunks.push(e)},ZK.prototype.onEnd=function(e){e===YK&&(this.result="string"===this.options.to?this.chunks.join(""):UH.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var eY={Inflate:ZK,inflate:$K,inflateRaw:function(e,t){return(t=t||{}).raw=!0,$K(e,t)},ungzip:$K,constants:NW};const{deflate:iY}=$H,{inflate:sY}=eY;var dY=iY,lY=sY,uY=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(uY||{});class hY{constructor(){Fg(this,"_sequence",0),Fg(this,"_startTime",Date.now()),Fg(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const n=new Uint8Array(4);n.set([1,0,0,0]);const r={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[{id:0,length:4,data:n.buffer}]};t.commonPacketHeader.extension=1,t.extension=r,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;XA("SHOW_DATASTREAM2_LOG")&&fb.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));const n=new ArrayBuffer(t.commonPacketHeader.length),r=new Uint8Array(n),i=new DataView(n);let o=0;if(i.setUint16(o,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),o+=2,i.setUint32(o,t.commonPacketHeader.sequence,!0),o+=4,i.setUint16(o,t.commonStreamHeader,!0),o+=2,t.extension){const e=this.serializeExtension(t.extension);r.set(new Uint8Array(e),o),o+=e.byteLength}if(r.set(new Uint8Array(t.payload),o),o+=t.payload.byteLength,o!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const t=new DataView(e);let n=0;const r=t.getUint16(n,!0);n+=2;const i={length:16383&r,reserved:(16384&r)>>14,extension:(32768&r)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)};let o,a;if(n+=4,XA("SHOW_DATASTREAM2_LOG")&&fb.debug("receive data header: ".concat(JSON.stringify(i))),t.getUint16(n,!0),n+=2,i.extension){a=this.deserializeExtension(e.slice(n)),n+=2+a.length,o=e.slice(n);let t=!1;if(a.datas.length>0){const e=a.datas.find(e=>0===e.id);e&&(t=!(1&~new DataView(e.data).getUint32(0,!0)))}o=t?this.decompress(o):o}else o=e.slice(8);return o}serializeExtension(e){const{profile:t,length:n,datas:r}=e,i=new ArrayBuffer(n+2),o=new Uint8Array(i),a=new DataView(i);let s=0;if(a.setUint8(s++,t),a.setUint8(s++,n),r.forEach(e=>{t?(a.setUint8(s++,e.id),a.setUint8(s++,e.length),o.set(new Uint8Array(e.data),s),s+=e.data.byteLength):(a.setUint8(s++,e.id|e.length<<4),o.set(new Uint8Array(e.data),s),s+=e.data.byteLength)}),s!==n+2)throw Error("serialize extension error, is ".concat(s,"!==").concat(n+2));return i}deserializeExtension(e){const t=new DataView(e);let n=0;const r=t.getUint8(n);n++;const i=t.getUint8(n);n++;const o=r===uY.TWO_BYTE,a=[],s=new DataView(e,2);let c=0;for(;c<i;){let e=0,t=0,n=new ArrayBuffer(0);o?(e=s.getUint8(c),c++,t=s.getUint8(c),c++):(e=15&s.getUint8(c),t=s.getUint8(c)>>4,c++),t>0&&(n=s.buffer.slice(c+2,c+2+t),c+=n.byteLength),a.push({id:e,length:t,data:n})}if(c!==i)throw Error("parse error");return{profile:r,length:i,datas:a}}decompress(e){return lY(new Uint8Array(e))}compress(e){return dY(new Uint8Array(e))}}const pY={name:"DataStream",create:(e,t)=>{const n=t?new bU(e):new wU(e);return n.useDataStream(new hY),n}};class _Y extends xy{constructor(e,t,n){super(),Fg(this,"ws",void 0),Fg(this,"requestId",1),Fg(this,"heartBeatTimer",void 0),Fg(this,"joinInfo",void 0),Fg(this,"clientId",void 0),Fg(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Fg(this,"onClose",e=>{this.emit("close"),this.dispose()}),Fg(this,"onMessage",e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)}),this.joinInfo=e,this.clientId=t,this.ws=new HO("cross-channel-".concat(this.clientId),n),this.ws.on(Uw.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Uw.CONNECTED,this.onOpen),this.ws.on(Uw.ON_MESSAGE,this.onMessage),this.ws.on(Uw.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new Gh((t,n)=>{const r=window.setTimeout(()=>{n(new yb(Ry.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new yb(Ry.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),n(new yb(Ry.WS_ABORT))})})}async request(e){if("closed"===this.ws.state)throw new yb(Ry.WS_DISCONNECT);"connected"!==this.ws.state&&await(()=>new Gh((e,t)=>{this.ws.once(Uw.CLOSED,()=>t(new yb(Ry.WS_ABORT))),this.ws.once(Uw.CONNECTED,e)}))();const t=this.sendMessage(e),n=new Gh((e,n)=>{const r=()=>{n(new yb(Ry.WS_ABORT))};this.ws.once(Uw.RECONNECTING,r),this.ws.once(Uw.CLOSED,r),this.once("req_".concat(t),e),mA(3e3).then(()=>{this.removeAllListeners("req_".concat(t)),this.ws.off(Uw.RECONNECTING,r),this.ws.off(Uw.CLOSED,r),n(new yb(Ry.TIMEOUT,"cross channel ws request timeout"))})}),r=await n;if(!r||200!==r.code)throw new yb(Ry.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(r)));return r}async connect(e){this.ws.removeAllListeners(Uw.REQUEST_NEW_URLS),this.ws.on(Uw.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class EY extends xy{set state(e){e!==this._state&&(e!==Xw.RELAY_STATE_FAILURE&&(this.errorCode=Qw.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,r,i){super(),Fg(this,"joinInfo",void 0),Fg(this,"sid",void 0),Fg(this,"clientId",void 0),Fg(this,"cancelToken",Lv.CancelToken.source()),Fg(this,"workerToken",void 0),Fg(this,"requestId",0),Fg(this,"signal",void 0),Fg(this,"prevChannelMediaConfig",void 0),Fg(this,"httpRetryConfig",void 0),Fg(this,"_resolution",void 0),Fg(this,"_state",Xw.RELAY_STATE_IDLE),Fg(this,"errorCode",Qw.RELAY_OK),Fg(this,"onStatus",e=>{fb.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",Jw.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",Jw.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=Qw.SRC_TOKEN_EXPIRED,this.state=Xw.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=Qw.DEST_TOKEN_EXPIRED,this.state=Xw.RELAY_STATE_FAILURE))}),Fg(this,"onReconnect",async()=>{fb.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Jw.NETWORK_DISCONNECTED),this.state=Xw.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(e=>{this.state!==Xw.RELAY_STATE_IDLE&&(fb.error("auto restart channel media relay failed",e.toString()),this.errorCode=Qw.SERVER_CONNECTION_LOST,this.state=Xw.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=SA(),this.signal=new _Y(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==Xw.RELAY_STATE_IDLE)throw new yb(Ry.INVALID_OPERATION);this.state=Xw.RELAY_STATE_CONNECTING,await this.connect(),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new yb(Ry.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new yb(Ry.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new yb(Ry.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Xw.RELAY_STATE_RUNNING)throw new yb(Ry.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Xw.RELAY_STATE_RUNNING)throw new yb(Ry.INVALID_OPERATION);const t=this.genMessage(zw.SetVideoProfile);await this.signal.request(t),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),fb.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Xw.RELAY_STATE_IDLE,this.dispose()}dispose(){fb.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Lv.CancelToken.source(),this.state=Xw.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await Qx(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Jw.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage(zw.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage(zw.SetSdkProfile,e);await this.signal.request(n),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(zw.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Jw.PACKET_JOINED_SRC_CHANNEL),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage(zw.SetSourceUserId,e);await this.signal.request(i),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(zw.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Jw.PACKET_JOINED_DEST_CHANNEL),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage(zw.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",Jw.PACKET_SENT_TO_DEST_CHANNEL),this.state=Xw.RELAY_STATE_RUNNING,fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage(zw.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",Jw.PACKET_UPDATE_DEST_CHANNEL),fb.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(zw.StopPacketTransfer);await this.signal.request(e),fb.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const n=[],r=[],i=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:GA,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.22.1"===o.sdkVersion&&(o.sdkVersion="0.0.1");let a=null,s=null;switch(e){case zw.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case zw.SetSourceChannel:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new yb(Ry.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:s.channelName,token:s.token||this.joinInfo.appId},o;case zw.SetSourceUserId:if(s=t&&t.getSrcChannelMediaInfo(),!s)throw new yb(Ry.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:s.uid+""},o;case zw.SetDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new yb(Ry.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},o;case zw.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case zw.Reconnect:return o.clientRequest={command:"Reconnect"},o;case zw.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case zw.UpdateDestChannel:if(a=t&&t.getDestChannelMediaInfo(),!a)throw new yb(Ry.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},o;case zw.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const fY={name:"ChannelMediaRelay",create:function(e){return new EY(e.joinInfo,e.clientId,e.websocketRetryConfig||PA,e.httpRetryConfig||PA,e.resolution)}};function mY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function TY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mY(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class SY extends xy{constructor(e,t,n,r){super(),Fg(this,"spec",void 0),Fg(this,"token",void 0),Fg(this,"websocket",void 0),Fg(this,"pingpongTimer",void 0),Fg(this,"reconnectMode","retry"),Fg(this,"serviceMode",void 0),Fg(this,"reqId",0),Fg(this,"commandReqId",0),Fg(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Fg(this,"handleWebSocketMessage",e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):(vb.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===Fw.TRANSCODE?1:2}),this.emit(Hw.PUBLISH_STREAM_STATUS,t))}),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new HO("live-streaming",n),this.websocket.on(Uw.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Uw.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Uw.REQUEST_NEW_URLS,(e,t)=>{Zy(this,Hw.REQUEST_NEW_ADDRESS).then(e).catch(t)}),this.websocket.on(Uw.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const i=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new yb(Ry.UNEXPECTED_ERROR);const a=TY({command:e,sdkVersion:"4.22.1"===GA?"0.0.1":GA,seq:o,requestId:o,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new yb(Ry.WS_DISCONNECT);const s=()=>new Gh((e,t)=>{this.websocket.once(Uw.CLOSED,()=>t(new yb(Ry.WS_ABORT))),this.websocket.once(Uw.CONNECTED,e)});"connected"!==this.websocket.state&&await s(),a.clientRequest&&(a.clientRequest.workerToken=this.token);const c=new Gh((e,t)=>{const n=()=>{t(new yb(Ry.WS_ABORT))};this.websocket.once(Uw.RECONNECTING,n),this.websocket.once(Uw.CLOSED,n),this.once("@".concat(o,"-").concat(this.spec.sid),t=>{e(t)})});r&&vb.workerEvent(this.spec.sid,TY(TY({},r),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const u=Date.now();this.websocket.sendMessage(a);let l=null;try{l=await c}catch(r){if("closed"===this.websocket.state)throw r;return await s(),await this.request(e,t,n)}return r&&vb.workerEvent(this.spec.sid,TY(TY({},r),{},{requestId:i,actionType:"response",payload:JSON.stringify(l.serverResponse),serverCode:l.code,success:200===l.code,responseTime:Date.now()-u})),200!==l.code&&this.handleResponseError(l),l}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.22.1"===GA?"0.0.1":GA;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Yw.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void fb.warning("live stream response already exists stream");case Yw.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Yw.LIVE_STREAM_RESPONSE_BAD_STREAM:case Yw.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new yb(Ry.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Yw.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command)return;throw new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Yw.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new yb(Ry.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Yw.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new yb(Ry.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Hw.WARNING,t,e.serverResponse.url)}case Yw.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new yb(Ry.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Hw.WARNING,t,e.serverResponse.url)}case Yw.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Yw.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new yb(Ry.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Yw.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new yb(Ry.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Hw.WARNING,t,e.serverResponse.url)}case Yw.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Yw.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Yw.LIVE_STREAM_RESPONSE_WORKER_LOST:case Yw.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command)return;throw new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Yw.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Yw.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new yb(Ry.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(gA)},6e3)}}function gY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function RY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gY(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}class CY extends xy{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:PA,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:PA;super(),Fg(this,"onLiveStreamWarning",void 0),Fg(this,"onLiveStreamError",void 0),Fg(this,"spec",void 0),Fg(this,"retryTimeout",1e4),Fg(this,"connection",void 0),Fg(this,"httpRetryConfig",void 0),Fg(this,"wsRetryConfig",void 0),Fg(this,"streamingTasks",new Map),Fg(this,"isStartingStreamingTask",!1),Fg(this,"taskMutex",new NA("live-streaming")),Fg(this,"cancelToken",Lv.CancelToken.source()),Fg(this,"transcodingConfig",void 0),Fg(this,"uapResponse",void 0),Fg(this,"lastTaskId",1),Fg(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=RY(RY({},Ww),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(fb.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(e=>RY(RY(RY({},Bw),e),{},{zOrder:e.zOrder?e.zOrder+1:1}))),function(e){Oy(e.width)||yy(e.width,"config.width",0,1e4),Oy(e.height)||yy(e.height,"config.height",0,1e4),Oy(e.videoBitrate)||yy(e.videoBitrate,"config.videoBitrate",1,1e6),Oy(e.videoFrameRate)||yy(e.videoFrameRate,"config.videoFrameRate"),Oy(e.lowLatency)||Iy(e.lowLatency,"config.lowLatency"),Oy(e.audioSampleRate)||vy(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Oy(e.audioBitrate)||yy(e.audioBitrate,"config.audioBitrate",1,128),Oy(e.audioChannels)||vy(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),Oy(e.videoGop)||yy(e.videoGop,"config.videoGop"),Oy(e.videoCodecProfile)||vy(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Oy(e.userCount)||yy(e.userCount,"config.userCount",0,17),Oy(e.backgroundColor)||yy(e.backgroundColor,"config.backgroundColor",0,16777215),Oy(e.userConfigExtraInfo)||by(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!Oy(e.transcodingUsers)&&(wy(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach((e,t)=>{Vw(e.uid),Oy(e.x)||yy(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),Oy(e.y)||yy(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),Oy(e.width)||yy(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),Oy(e.height)||yy(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),Oy(e.zOrder)||yy(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),Oy(e.alpha)||yy(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)})),Oy(e.watermark)||Gw(e.watermark,"watermark"),Oy(e.backgroundImage)||Gw(e.backgroundImage,"backgroundImage"),e.images&&!Oy(e.images)&&(wy(e.images,"config.images"),e.images.forEach((e,t)=>{Gw(e,"images[".concat(t,"]"))}))}(t);const n=[];t.images&&n.push(...t.images.map(e=>RY(RY(RY({},jw),e),{},{zOrder:255}))),t.backgroundImage&&(n.push(RY(RY(RY({},jw),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(RY(RY(RY({},jw),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(e=>RY({},e)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const r=(t.userConfigs||[]).map(e=>"number"==typeof e.uid?Gh.resolve(e.uid):Yx(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Gh.all(r)).forEach((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)}),this.transcodingConfig=t,this.connection)try{var i;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(_N(i=this.streamingTasks).call(i)).map(e=>e.taskId).join("#")});fb.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(t=>{fb.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then(()=>{fb.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))}).catch(e=>{fb.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)})})}}async startLiveStreamingTask(e,t,n){if(!this.transcodingConfig&&t===Fw.TRANSCODE)throw new yb(Ry.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const r={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};fb.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const i=await this.taskMutex.lock();if(!this.connection&&n)return void i();if(this.streamingTasks.get(e)&&!n)return i(),new yb(Ry.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw i(),e}t===Fw.TRANSCODE&&(r.transcodingConfig=RY({},this.transcodingConfig)),this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const a=new Gh((t,r)=>{mA(this.retryTimeout).then(()=>{if(n)return r(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0})}),s=await Gh.race([this.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:t===Fw.TRANSCODE?1:2,requestByUser:!n,tid:o.toString()}),a]);this.isStartingStreamingTask=!1,fb.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(s.code)),this.streamingTasks.set(e,{clientRequest:r,mode:t,url:e,taskId:o}),i()}catch(r){if(i(),this.isStartingStreamingTask=!1,!r.data||!r.data.retry||n)throw r;return r.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,r)):await this.startLiveStreamingTask(e,t,r)}}stopLiveStreamingTask(e){return new Gh((t,n)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new yb(Ry.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const i=r.mode;r.abortTask=()=>{fb.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===Fw.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(n=>{fb.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&(this.connection&&this.connection.close(),this.connection=void 0),t()}).catch(n)})}resetAllTask(){var e;const t=Array.from(_N(e=this.streamingTasks).call(e));this.terminate();for(const e of t)this.startLiveStreamingTask(e.url,e.mode).catch(t=>{this.onLiveStreamError&&this.onLiveStreamError(e.url,t)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Lv.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new yb(Ry.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await Zy(this,Kw.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new SY(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Hw.WARNING,(e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)),this.connection.on(Hw.PUBLISH_STREAM_STATUS,e=>this.handlePublishStreamServer(e)),this.connection.on(Hw.REQUEST_NEW_ADDRESS,(t,n)=>{if(!this.connection)return n(new yb(Ry.UNEXPECTED_ERROR,"can not get new live streaming address list"));Zy(this,Kw.REQUEST_WORKER_MANAGER_LIST,e).then(e=>{this.uapResponse=e,t(e.addressList)}).catch(n)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case Yw.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const r=new yb(Ry.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return fb.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)return;this.statusError.set(t,r)}case Yw.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new yb(Ry.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case Yw.LIVE_STREAM_RESPONSE_WORKER_LOST:case Yw.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(_N(i=this.streamingTasks).call(i));for(const n of t)n.abortTask?n.abortTask():(fb.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{fb.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)}).catch(e=>{fb.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const IY={name:"LiveStreaming",create:function(e){return new CY(e.joinInfo,e.websocketRetryConfig||PA,e.httpRetryConfig||PA)}};function vY(e){let t=MY();return function(e,t){let n=e.appId;void 0!==n&&(JY(t,10),GY(t,n));let r=e.cid;void 0!==r&&(JY(t,16),JY(t,r));let i=e.cname;void 0!==i&&(JY(t,26),GY(t,i));let o=e.deviceId;void 0!==o&&(JY(t,34),GY(t,o));let a=e.elapse;void 0!==a&&(JY(t,40),XY(t,a));let s=e.fileSize;void 0!==s&&(JY(t,48),XY(t,LY(s)));let c=e.height;void 0!==c&&(JY(t,56),XY(t,LY(c)));let u=e.jpg;void 0!==u&&(JY(t,66),JY(t,u.length),function(e,t){let n=FY(e,t.length);e.bytes.set(t,n)}(t,u));let l=e.networkType;void 0!==l&&(JY(t,72),XY(t,LY(l)));let d=e.osType;void 0!==d&&(JY(t,80),XY(t,LY(d)));let h=e.requestId;void 0!==h&&(JY(t,90),GY(t,h));let p=e.sdkVersion;void 0!==p&&(JY(t,98),GY(t,p));let f=e.sequence;void 0!==f&&(JY(t,104),XY(t,LY(f)));let m=e.sid;void 0!==m&&(JY(t,114),GY(t,m));let g=e.timestamp;void 0!==g&&(JY(t,120),XY(t,g));let v=e.uid;void 0!==v&&(JY(t,128),JY(t,v));let E=e.vid;void 0!==E&&(JY(t,136),JY(t,E));let y=e.width;void 0!==y&&(JY(t,144),XY(t,LY(y)));let _=e.service;void 0!==_&&(JY(t,152),JY(t,_));let b=e.callbackData;void 0!==b&&(JY(t,162),GY(t,b));let S=e.jpgEncryption;void 0!==S&&(JY(t,168),JY(t,S));let w=e.requestType;void 0!==w&&(JY(t,176),JY(t,w));let T=e.scorePorn;void 0!==T&&(JY(t,185),qY(t,T));let R=e.scoreSexy;void 0!==R&&(JY(t,193),qY(t,R));let C=e.scoreNeutral;void 0!==C&&(JY(t,201),qY(t,C));let I=e.scene;void 0!==I&&(JY(t,208),JY(t,I));let O=e.ossFilePrefix;void 0!==O&&(JY(t,218),GY(t,O));let A=e.serviceVendor;if(void 0!==A)for(let e of A){JY(t,226);let n=MY();bY(e,n),JY(t,n.limit),WY(t,n),UY(n)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}function yY(e){return function(e){let t={};e:for(;!VY(e);){let n=zY(e);switch(n>>>3){case 0:break e;case 1:t.code=zY(e);break;case 2:t.msg=jY(e,zY(e));break;case 3:{let n=wY(e);t.data=AY(e),e.limit=n;break}default:OY(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}function AY(e){let t={};e:for(;!VY(e);){let n=zY(e);switch(n>>>3){case 0:break e;case 1:t.requestId=jY(e,zY(e));break;case 2:t.requestType=zY(e)>>>0;break;case 3:t.scorePorn=YY(e);break;case 4:t.scoreSexy=YY(e);break;case 5:t.scoreNeutral=YY(e);break;case 6:t.requestScene=zY(e)>>>0;break;case 7:t.scene=zY(e)>>>0;break;default:OY(e,7&n)}}return t}function bY(e,t){let n=e.service;void 0!==n&&(JY(t,8),JY(t,n));let r=e.vendor;void 0!==r&&(JY(t,16),JY(t,r));let i=e.token;void 0!==i&&(JY(t,26),GY(t,i));let o=e.callbackUrl;void 0!==o&&(JY(t,34),GY(t,o))}function wY(e){let t=zY(e),n=e.limit;return e.limit=e.offset+t,n}function OY(e,t){switch(t){case 0:for(;128&HY(e););break;case 2:xY(e,zY(e));break;case 5:xY(e,4);break;case 1:xY(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let DY=new Float64Array(1),PY=new Uint8Array(DY.buffer);function LY(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let kY=[];function MY(){const e=kY.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function UY(e){kY.push(e)}function xY(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function VY(e){return e.offset>=e.limit}function FY(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function BY(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function jY(e,t){let n=BY(e,t),r=String.fromCharCode,i=e.bytes,o="",a="";for(let e=0;e<t;e++){let s,c,u,l,d=i[e+n];128&d?192==(224&d)?e+1>=t?a+=o:(s=i[e+n+1],128!=(192&s)?a+=o:(l=(31&d)<<6|63&s,l<128?a+=o:(a+=r(l),e++))):224==(240&d)?e+2>=t?a+=o:(s=i[e+n+1],c=i[e+n+2],32896!=(49344&(s|c<<8))?a+=o:(l=(15&d)<<12|(63&s)<<6|63&c,l<2048||l>=55296&&l<=57343?a+=o:(a+=r(l),e+=2))):240==(248&d)?e+3>=t?a+=o:(s=i[e+n+1],c=i[e+n+2],u=i[e+n+3],8421504!=(12632256&(s|c<<8|u<<16))?a+=o:(l=(7&d)<<18|(63&s)<<12|(63&c)<<6|63&u,l<65536||l>1114111?a+=o:(l-=65536,a+=r(55296+(l>>10),56320+(1023&l)),e+=3))):a+=o:a+=r(d)}return a}function GY(e,t){let n=t.length,r=0;for(let e=0;e<n;e++){let i=t.charCodeAt(e);i>=55296&&i<=56319&&e+1<n&&(i=(i<<10)+t.charCodeAt(++e)-56613888),r+=i<128?1:i<2048?2:i<65536?3:4}JY(e,r);let i=FY(e,r),o=e.bytes;for(let e=0;e<n;e++){let r=t.charCodeAt(e);r>=55296&&r<=56319&&e+1<n&&(r=(r<<10)+t.charCodeAt(++e)-56613888),r<128?o[i++]=r:(r<2048?o[i++]=r>>6&31|192:(r<65536?o[i++]=r>>12&15|224:(o[i++]=r>>18&7|240,o[i++]=r>>12&63|128),o[i++]=r>>6&63|128),o[i++]=63&r|128)}}function WY(e,t){let n=FY(e,t.limit),r=e.bytes,i=t.bytes;for(let e=0,o=t.limit;e<o;e++)r[e+n]=i[e]}function HY(e){return e.bytes[BY(e,1)]}function KY(e,t){let n=FY(e,1);e.bytes[n]=t}function YY(e){let t=BY(e,8),n=e.bytes;return PY[0]=n[t++],PY[1]=n[t++],PY[2]=n[t++],PY[3]=n[t++],PY[4]=n[t++],PY[5]=n[t++],PY[6]=n[t++],PY[7]=n[t++],DY[0]}function qY(e,t){let n=FY(e,8),r=e.bytes;DY[0]=t,r[n++]=PY[0],r[n++]=PY[1],r[n++]=PY[2],r[n++]=PY[3],r[n++]=PY[4],r[n++]=PY[5],r[n++]=PY[6],r[n++]=PY[7]}function zY(e){let t,n=0,r=0;do{t=HY(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function JY(e,t){for(t>>>=0;t>=128;)KY(e,127&t|128),t>>>=7;KY(e,t)}function XY(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,a=FY(e,o),s=e.bytes;switch(o){case 10:s[a+9]=i>>>7&1;case 9:s[a+8]=9!==o?128|i:127&i;case 8:s[a+7]=8!==o?r>>>21|128:r>>>21&127;case 7:s[a+6]=7!==o?r>>>14|128:r>>>14&127;case 6:s[a+5]=6!==o?r>>>7|128:r>>>7&127;case 5:s[a+4]=5!==o?128|r:127&r;case 4:s[a+3]=4!==o?n>>>21|128:n>>>21&127;case 3:s[a+2]=3!==o?n>>>14|128:n>>>14&127;case 2:s[a+1]=2!==o?n>>>7|128:n>>>7&127;case 1:s[a]=1!==o?128|n:127&n}}function QY(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}const ZY=new Map([["moderation",1],["supervise",2]]);function $Y(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}class eq extends xy{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(mO.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=Jn(t=e.map(e=>ZY.get(e)||0)).call(t,(e,t)=>e+t),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),Fg(this,"name","AgoraRTCVideoContentInspect"),Fg(this,"_connectionState",EO.CONNECTING),Fg(this,"_innerConnectionState",void 0),Fg(this,"sequence",0),Fg(this,"inspectStartTime",void 0),Fg(this,"workerManagerConnection",void 0),Fg(this,"workerConnection",void 0),Fg(this,"workerMessageLengthLimit",void 0),Fg(this,"inspectIntervalMinimum",void 0),Fg(this,"qualityRatio",void 0),Fg(this,"_connectInfo",void 0),Fg(this,"_cancelTokenSource",Lv.CancelToken.source()),Fg(this,"_retryConfig",void 0),Fg(this,"wmSequence",0),Fg(this,"inspectInterval",void 0),Fg(this,"inspectTimer",null),Fg(this,"ossFilePrefix",void 0),Fg(this,"extraInfo",void 0),Fg(this,"_inspectType",void 0),Fg(this,"_inspectMode",void 0),Fg(this,"_quality",1),Fg(this,"qualityTimer",null),Fg(this,"_inspectId",void 0),Fg(this,"_needWorkUrlOnly",!1),Fg(this,"inspectImage",()=>{if(this.connectionState!==EO.CONNECTED)throw new yb(Ry.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===EO.CONNECTED?this.requestToInspectImage():fb.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=TA(5,"inspect-"),this.workerMessageLengthLimit=XA("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=XA("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=XA("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new HO("worker-manager-"+this._inspectId,PA),this.on(mO.STATE_CHANGE,(e,t)=>{this._innerConnectionState=e,fb.debug("[".concat(this._inspectId,"] Inspect operation :").concat(fO[e]," ").concat(t||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new HO("worker-"+this._inspectId,PA),this.handleWorkerEvents()}async init(e,t){this.emit(mO.STATE_CHANGE,fO.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new Gh((r,i)=>{this.on(mO.CONNECTION_STATE_CHANGE,(e,t)=>{t===EO.CONNECTED&&r()}),this.requestAP(e,n,t).then(e=>{this.connectWorkerManager(e)}).catch(e=>{i(e)})})}async requestAP(e,t,n){const r=XA("WEBCS_DOMAIN").map(e=>"https://".concat(e,"/api/v1")),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:a,sid:s,token:c,uid:u}=t;Bx++;const l="image_moderation_api",d={service_name:l,json_body:JSON.stringify({appId:i,areaCode:o,cname:a,command:"allocateEdge",requestId:Bx,seq:Bx,sid:s,token:c,ts:Date.now(),uid:u+""})};let h,p,f=e[0];return kA(async()=>{h=Date.now();const e=await Tx(f,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(p=Date.now()-h,0!==e.code){const t=new yb(Ry.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:p});throw fb.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new yb(Ry.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:p});throw fb.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new yb(Ry.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:p});throw fb.error(e.toString()),e}const r=XA("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=XA("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map(e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(i||n)}).filter(e=>!!e),workerToken:t.workerToken,vid:t.vid,responseTime:p}},(t,n)=>(vb.apworkerEvent(s,{success:!0,sc:200,serviceName:l,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:p,serverIp:e[n%e.length]}),!1),(t,n)=>(vb.apworkerEvent(s,{success:!1,sc:t.data&&t.data.code||200,serviceName:l,responseTime:p,serverIp:e[n%e.length]}),!!(t.code!==Ry.OPERATION_ABORTED&&t.code!==Ry.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(f=e[(n+1)%e.length],!0)),r)}(r,e,t,n);this.emit(mO.STATE_CHANGE,fO.AP_CONNECTED);const{addressList:o}=i;return this.wmSequence++,o}async connectWorkerManager(e){this._needWorkUrlOnly=arguments.length>1&&void 0!==arguments[1]&&arguments[1],this.emit(mO.STATE_CHANGE,fO.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Uw.CONNECTED,async()=>{this.emit(mO.STATE_CHANGE,fO.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Uw.CLOSED,()=>{this._innerConnectionState<fO.GET_WORKER_MANAGER_RESPONSE&&fb.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Uw.FAILED,()=>{this._innerConnectionState<fO.GET_WORKER_MANAGER_RESPONSE&&fb.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Uw.RECONNECTING,()=>{this._innerConnectionState<fO.GET_WORKER_MANAGER_RESPONSE&&fb.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Uw.ON_MESSAGE,async e=>{this.emit(mO.STATE_CHANGE,fO.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(200!==n.code)throw fb.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new yb(Ry.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw fb.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new yb(Ry.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const e=XA("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,r=t.replace(/:\d+\/?$/,":".concat(e));this.emit(mO.STATE_CHANGE,fO.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(mO.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}}),this.workerManagerConnection.on(Uw.WILL_RECONNECT,(e,t,n)=>{n(e)}),this.workerManagerConnection.on(Uw.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(Uw.CONNECTED,async()=>{this.emit(mO.STATE_CHANGE,fO.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=EO.CONNECTED}),this.workerConnection.on(Uw.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=yY(new Uint8Array(e.data));if(XA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&fb.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(mO.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;const e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},r=Jn(t=Object.keys(e)).call(t,(t,n)=>e[t]>e[n]?t:n,"porn"),i=Object.keys(e).find(e=>e===r);this.emit(mO.INSPECT_RESULT,i)}else this.emit(mO.INSPECT_RESULT,void 0,new yb(Ry.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(mO.INSPECT_RESULT,void 0,new yb(Ry.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else fb.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(mO.INSPECT_RESULT,void 0,new yb(Ry.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Uw.CLOSED,()=>{this.connectionState=EO.CLOSED}),this.workerConnection.on(Uw.FAILED,()=>{this.connectionState=EO.CLOSED}),this.workerConnection.on(Uw.RECONNECTING,()=>{this.connectionState=this.connectionState===EO.CONNECTED?EO.RECONNECTING:EO.CONNECTING}),this.workerConnection.on(Uw.WILL_RECONNECT,(e,t,n)=>{"recover"===e&&n(e),n("tryNext")}),this.workerConnection.on(Uw.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(mO.REQUEST_NEW_WORKER_URL,t=>{e([t])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e=>{this.connectWorkerManager(e,!0)}).catch(e=>{t(e)})})}async requestToInspectImage(){this.sequence++;const e=eA(this,mO.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(mO.INSPECT_RESULT,void 0,new yb(Ry.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(mO.INSPECT_RESULT,void 0,new yb(Ry.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s}=t;const c=Date.now(),u=await e.getCurrentFrameImage("image/jpeg",this.quality),l=await Ok(u,n,r),d=this.sequence+"-"+i+"-"+s+"-"+c+"-"+TA(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:$Y(Number(c-this.inspectStartTime)),fileSize:l.byteLength,jpgEncryption:2,height:u.height,width:u.width,jpg:l,networkType:6,osType:7,requestId:d,sdkVersion:"4.22.1",sequence:this.sequence,sid:a,timestamp:$Y(c),uid:s,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;const p=vY(h);if(p.byteLength<this.workerMessageLengthLimit){if(XA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?QY(Object(n),!0).forEach(function(t){Fg(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):QY(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},h);delete e.jpg,fb.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return p}return this.quality=this.quality*this.qualityRatio,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:a,uid:s})}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Lv.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=EO.CLOSED,this.emit(mO.STATE_CHANGE,fO.CLOSED)}}const tq={name:"ContentInspect",create:function(e){let{config:t}=e;return function(e){if(!e)throw new yb(Ry.INVALID_PARAMS,"inspectConfig is necessary.");if(!e.inspectType||!Array.isArray(e.inspectType))throw new yb(Ry.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const t=[...new Set(e.inspectType)];t.forEach(e=>{var t;if(!Dn(t=["supervise","moderation"]).call(t,e))throw new yb(Ry.INVALID_PARAMS,"".concat(e," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new yb(Ry.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new eq(t)}};JA("PROCESS_ID","process-".concat(TA(8,""),"-").concat(TA(4,""),"-").concat(TA(4,""),"-").concat(TA(4,""),"-").concat(TA(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void fb.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();fb.debug("Loading global parameters from cache",t),Object.keys(t).forEach(e=>{if(Object.prototype.hasOwnProperty.call(zA,e)){const{value:r,expires:i}=t[e];if(i&&i<=n)return;QA[e]=r,zA[e]=r}})}catch(t){fb.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(QA.AREAS)&&QA.AREAS.length>0&&bx(QA.AREAS,!0);const iq=(e,t,n)=>{fb.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),JA(e,t,n)};SB(fY,!1),SB(IY,!1),SB(kj,!1),SB(tq,!1),SB(pY,!1);const nq=function(e){const t=new xy,n=e,r={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===SO.SECURITY_POLICY_VIOLATION&&LG(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return DG(DG({},n),r)}({__TRACK_LIST__:_L,VERSION:GA,BUILD:qA,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:iq,getParameter:XA,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await async function(e){let t;return ZP().supportUnifiedPlan?(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"}),t=(await e.createOffer()).sdp):t=(await e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,t}(t);if(!n)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(e){throw new yb(Ry.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=vb.reportApiInvoke(null,{name:By.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:jy.TRACER});let t=!1;try{const e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(e&&n&&r),t&&_y()&&ty(75)&&(new e).close()}catch(e){return fb.error("check system requirement failed: ",e),!1}let n=!1;const r=Hv();r.name===Bv.CHROME&&Number(r.version)>=58&&("WebKit"!==Gv.engine.name||function(){const e=Hv();if(zv()){if(e.os===Fv.MAC_OS)return!0;if(e.os===Fv.IOS){const e=Gv.os.version&&Gv.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}())&&(n=!0),(r.name===Bv.FIREFOX&&Number(r.version)>=56||r.name===Bv.OPERA&&Number(r.version)>=45||r.name===Bv.SAFARI&&Number(r.version)>=11||"WebKit"===r.name&&($v()||uy())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||hy()||Hv().name===Bv.QQ)&&(n=!0),fb.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return uk.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return uk.getRecordingDevices(e)},getCameras:function(e){return uk.getCamerasDevices(e)},getElectronScreenSources:nk,getPlaybackDevices:function(e){return uk.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=vb.reportApiInvoke(null,{name:By.CREATE_CLIENT,options:[t],tag:jy.TRACER});try{!function(e){vy(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),vy(e.mode,"config.mode",["rtc","live","p2p"]),void 0!==e.audioCodec&&vy(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&by(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&Yy(e.turnServer),void 0!==e.httpRetryConfig&&Gy(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&Gy(e.websocketRetryConfig)}(t)}catch(e){throw n.onError(e),e}return(ry(16,0,!0)||oy(16,0,!0))&&("vp9"===t.codec&&(t.codec="vp8",fb.debug("browser not support vp9, force use vp8")),JA("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),n.onSuccess(),new vG(IG(IG({forceWaitGatewayResponse:!0},t),{},{role:Dn(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=XA("CAMERA_CAPTURE_CONFIG"),n=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_CAM_VIDEO_TRACK,options:[GL({},e),t]});t&&(e.encoderConfig=t);const r=Ak(e),i=TA(8,"track-cam-");let o=null;fb.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{o=(await ak({video:r},i)).getVideoTracks()[0]||null}catch(e){throw n.onError(e),e}if(!o){const e=new Cy(Ry.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(fb)}e.optimizationMode&&dU(i,o,e,dL(e.encoderConfig));const a=new cU(o,e,r,e.scalabiltyMode?uL(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return n.onSuccess(a.getTrackId()),fb.info("create camera video success, trackId:",i),a},createCustomVideoTrack:function(e){const t=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new aU(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?uL(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,TA(8,"track-cus-"),[mL.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),fb.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_SCREEN_VIDEO_TRACK,options:[GL({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const r=function(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&Jv()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:i,systemAudio:o}=e;(ey(107)||iy(107)||sy(93))&&(n&&(vy(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(vy(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(vy(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(ey(105)||iy(105)||sy(91))&&o&&(vy(o,"systemAudio",["exclude","include"]),t.systemAudio=o),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const a=e.encoderConfig?lL(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:a?a.width:void 0,maxHeight:a?a.height:void 0},a&&(a.frameRate&&("number"==typeof a.frameRate?(t.mandatory.maxFrameRate=a.frameRate,t.mandatory.minFrameRate=a.frameRate):(t.mandatory.maxFrameRate=a.frameRate.max||a.frameRate.ideal||a.frameRate.exact||void 0,t.mandatory.minFrameRate=a.frameRate.min||a.frameRate.ideal||a.frameRate.exact||void 0),t.frameRate=a.frameRate),a.width&&(t.width=a.width),a.height&&(t.height=a.height)),t}(e),i=TA(8,"track-scr-v-");let o=null,a=null;const s=ZP();if(!s.supportShareAudio&&"enable"===t){const e=new Cy(Ry.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(e),e.throw(fb)}fb.info("start create screen video track with config",e,"withAudio",t,"trackId",i);try{const e=await ak({screen:r,screenAudio:"auto"===t?s.supportShareAudio:"enable"===t},i);o=e.getVideoTracks()[0]||null,a=e.getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!o){const e=new Cy(Ry.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw(fb)}if(!a&&"enable"===t){o&&o.stop();const e=new Cy(Ry.SHARE_AUDIO_NOT_ALLOWED);return n.onError(e),e.throw(fb)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(dU(i,o,e,e.encoderConfig&&lL(e.encoderConfig)||void 0),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const c=new aU(o,e.encoderConfig?lL(e.encoderConfig):{},e.scalabiltyMode?uL(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[mL.SCREEN_TRACK]);if(!a)return n.onSuccess(c.getTrackId()),fb.info("create screen video track success","video:",c.getTrackId()),c;const u=new TM(a,void 0,TA(8,"track-scr-a-"),!1);return n.onSuccess([c.getTrackId(),u.getTrackId()]),fb.info("create screen video track success","video:",c.getTrackId(),"audio:",u.getTrackId()),[c,u]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=XA("CAMERA_CAPTURE_CONFIG"),r=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const i=Ak(t),o=bk(e),a=TA(8,"track-mic-"),s=TA(8,"track-cam-");let c=null,u=null;fb.info("start create camera video track(".concat(s,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await ak({audio:o,video:i},"".concat(a,"-").concat(s));c=e.getAudioTracks()[0],u=e.getVideoTracks()[0]}catch(e){throw r.onError(e),e}if(!c||!u){const e=new Cy(Ry.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(e),e.throw(fb)}t.optimizationMode&&dU(s,u,t,dL(t.encoderConfig));const l=new SM(c,e,o,a),d=new cU(u,t,i,t.scalabiltyMode?uL(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return r.onSuccess([l.getTrackId(),d.getTrackId()]),fb.info("create camera video track(".concat(s,") and microphone audio track(").concat(a,") success")),[l,d]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=bk(e),r=TA(8,"track-mic-");let i=null;fb.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{i=(await ak({audio:n},r)).getAudioTracks()[0]||null}catch(e){throw t.onError(e),e}if(!i){const e=new Cy(Ry.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(e),e.throw(fb)}const o=new SM(i,e,n,r);return t.onSuccess(o.getTrackId()),fb.info("create microphone audio track success, trackId:",r),o},createCustomAudioTrack:function(e){const t=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new TM(e.mediaStreamTrack,e.encoderConfig?pL(e.encoderConfig):{},TA(8,"track-cus-"),!1);return fb.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:r}=e;let{source:i}=e;const o={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?null!==(t=File.name)&&void 0!==t?t:"File":i,cacheOnlineFile:n,encoderConfig:r},a=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(XA("DISABLE_WEBAUDIO"))throw new Cy(Ry.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const s=TA(8,"track-buf-");fb.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",s);const c=i;if(!(i instanceof AudioBuffer))try{i=await async function(e,t){let n=null;if("string"==typeof e){const t=IM.get(e);if(t)return fb.debug("use cached audio resource: ",e),t;try{n=(await kA(()=>Lv.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new Cy(Ry.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new Gh((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new Cy(Ry.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new Cy(Ry.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)});n=await t}const r=await function(e){const t=zL();return new Gh((n,r)=>{t.decodeAudioData(e,e=>{n(e)},e=>{r(new Cy(Ry.DECODE_AUDIO_FILE_FAILED,e.toString()))})})}(n);return"string"==typeof e&&t&&IM.set(e,r),r}(i,n)}catch(e){return a.onError(e),e.throw(fb)}const u=new CM(i),l=new gM(c,u,r?pL(r):{},s);return fb.info("create buffer source audio track success, trackId:",s),a.onSuccess(l.getTrackId()),l},setAppType:function(e){if(fb.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw fb.debug("Invalid appType"),new yb(Ry.INVALID_PARAMS,"invalid app type",e);JA("APP_TYPE",Math.floor(e))},setLogLevel:function(e){fb.setLogLevel(e)},enableLogUpload:function(){XA("USE_NEW_LOG")?JA("UPLOAD_LOG",!0):fb.enableLogUpload()},disableLogUpload:function(){XA("USE_NEW_LOG")?JA("UPLOAD_LOG",!1):fb.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new PF},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof TM||e instanceof vU)){const e=new yb(Ry.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof TM?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let o=i,a=i;const s=Date.now();return new Gh(i=>{const c=setInterval(()=>{const u=e.getVolumeLevel();o=u>o?u:o,a=u<a?u:a;const l=o-a>1e-4,d=Date.now()-s;if(l||d>t){clearInterval(c);const t=l,a={duration:d,deviceLabel:r,maxVolumeLevel:o,result:t};fb.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(a))),n.onSuccess(a),i(t)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof aU||e instanceof IU)){const e=new yb(Ry.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof aU?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(Xv()||zv())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([i]),o.play();const a=document.createElement("canvas");a.width=160,a.height=120;let s=0,c=0;try{const e=Date.now();s=await function(e,t,n){let r,i=0,o=null;return new Gh((a,s)=>{setTimeout(()=>{r&&(r(),a(i))},t),r=QL(()=>{!function(){i>4&&r&&(r(),a(i));const t=n.getContext("2d");if(!t){const e=new yb(Ry.UNEXPECTED_ERROR,"can not get canvas 2d context.");return fb.error(e.toString()),void s(e)}t.drawImage(e,0,0,160,120);const c=t.getImageData(0,0,n.width,n.height),u=Math.floor(c.data.length/3);if(o){for(let e=0;e<u;e+=3)if(c.data[e]!==o[e])return i+=1,void(o=c.data);o=c.data}else o=c.data}()},30)})}(o,t,a),c=Date.now()-e}catch(e){throw n.onError(e),e}DB===Bv.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;const u=s>4,l={duration:c,changedPicNum:s,deviceLabel:r,result:u};return fb.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(l))),n.onSuccess(l),u},setArea:bx,audioElementPlayCenter:mk,resumeAudioContext:function(){mk.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){OG.processExternalMediaAEC(e)},registerExtensions:function(e){const t=XA("PLUGIN_INFO")||[];e.forEach(e=>{"name"in e&&!Dn(t).call(t,e.name)&&t.push(e.name);const n=e;n.__registered__=!0,n.logger.hookLog=fb.extLog,n.reporter.hookApiInvoke=vb.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(e=>{n.parameters[e]=XA(e)})}),iq("PLUGIN_INFO",t)},ChannelMediaRelayError:Qw,ChannelMediaRelayEvent:Jw,ChannelMediaRelayState:Xw,RemoteStreamFallbackType:gL,RemoteStreamType:SL,ConnectionDisconnectedReason:Hy,AudienceLatencyLevelType:Wy,AREAS:iO,preload:async function(e,t,n,r){return KB(e,t,n,r)}});function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(i[n]=e[n]);return i}var AgoraRTCErrorCode;Object.defineProperties(nq,{onAudioAutoplayFailed:{get:()=>pk.onAudioAutoplayFailed,set:e=>{pk.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>pk.onAutoplayFailed,set:e=>{pk.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>nq._onSecurityPolicyViolation,set(e){nq._onSecurityPolicyViolation=e,LG(e)}},__CLIENT_LIST__:{get:()=>XA("SHOW_GLOBAL_CLIENT_LIST")?wb:[]}}),uk.on(kL.CAMERA_DEVICE_CHANGED,e=>{fb.info("camera device changed",JSON.stringify(e)),nq.onCameraChanged&&nq.onCameraChanged(e),nq.safeEmit(SO.CAMERA_CHANGED,e)}),uk.on(kL.RECORDING_DEVICE_CHANGED,e=>{fb.info("microphone device changed",JSON.stringify(e)),nq.onMicrophoneChanged&&nq.onMicrophoneChanged(e),nq.safeEmit(SO.MICROPHONE_CHANGED,e)}),uk.on(kL.PLAYOUT_DEVICE_CHANGED,e=>{fb.debug("playout device changed",JSON.stringify(e)),nq.onPlaybackDeviceChanged&&nq.onPlaybackDeviceChanged(e),nq.safeEmit(SO.PLAYBACK_DEVICE_CHANGED,e)}),mk.onAutoplayFailed=()=>{fb.info("detect audio element autoplay failed"),pk.onAudioAutoplayFailed&&pk.onAudioAutoplayFailed()},qL.on("autoplay-failed",()=>{fb.info("detect webaudio autoplay failed"),pk.onAudioAutoplayFailed&&pk.onAudioAutoplayFailed(),nq.safeEmit(SO.AUTOPLAY_FAILED)}),qL.on(tL.STATE_CHANGE,(e,t)=>{fb.info("audio context state changed: ".concat(t," => ").concat(e)),nq.onAudioContextStateChanged&&nq.onAudioContextStateChanged(e,t),nq.safeEmit(SO.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),iA.on(Qy.NETWORK_STATE_CHANGE,(e,t)=>{fb.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=nq),function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"}(AgoraRTCErrorCode||(AgoraRTCErrorCode={}));var createClient=function(e){var t;return function(){return t||(t=nq.createClient(e)),t}};function createMicrophoneAndCameraTracks(e,t){var n=null;return function(){var r=react.useState(!1),i=r[0],o=r[1],a=react.useState(null),s=a[0],c=a[1],u=react.useRef(n);return react.useEffect(function(){return null===u.current?function(){try{return Promise.resolve(nq.createMicrophoneAndCameraTracks(e,t)).then(function(e){return n=e})}catch(e){return Promise.reject(e)}}().then(function(e){u.current=e,o(!0)},function(e){c(e)}):o(!0),function(){n=null}},[]),{ready:i,tracks:u.current,error:s}}}var AgoraVideoPlayer=function(e){var t=react.useRef(null),n=e.videoTrack,r=e.config,i=_objectWithoutPropertiesLoose(e,["videoTrack","config"]);return react.useLayoutEffect(function(){return null!==t.current&&n.play(t.current,r),function(){n.stop()}},[n]),react.createElement("div",Object.assign({},i,{ref:t}))},agoraRtmSdk=createCommonjsModule(function(module,exports){!function(e,t){module.exports=t()}(0,function(){function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ua(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach(function(t){m(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function sl(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function J(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){function o(e){sl(s,r,i,o,a,"next",e)}function a(e){sl(s,r,i,o,a,"throw",e)}var s=e.apply(t,n);o(void 0)})}}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ha(e,t,n){return t&&tl(e.prototype,t),n&&tl(e,n),e}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function la(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&df(e,t)}function wd(e){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function df(e,t){return(df=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ul(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Sh(e,t,n){return(Sh=ul()?Reflect.construct:function(e,t,n){var r=[null];return r.push.apply(r,t),e=new(Function.bind.apply(e,r)),n&&df(e,n.prototype),e}).apply(null,arguments)}function ef(e){var t="function"==typeof Map?new Map:void 0;return(ef=function(e){function n(){return Sh(e,arguments,wd(this).constructor)}if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),df(n,e)})(e)}function ff(e,t){if(null==e)return{};if(null==e)var n={};else{n={};var r,i=Object.keys(e);for(r=0;r<i.length;r++){var o=i[r];0<=t.indexOf(o)||(n[o]=e[o])}}if(Object.getOwnPropertySymbols)for(r=Object.getOwnPropertySymbols(e),o=0;o<r.length;o++)0<=t.indexOf(i=r[o])||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i]);return n}function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ma(e){var t=ul();return function(){var r=wd(e);if(t){var i=wd(this).constructor;r=Reflect.construct(r,arguments,i)}else r=r.apply(this,arguments);return!r||"object"!=typeof r&&"function"!=typeof r?n(this):r}}function Th(e,t,n){return(Th="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wd(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}function ra(e,t){var n=Array.isArray(e)?e:void 0;if(!n)if(null==(n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"])))n=void 0;else{var r,i=[],o=!0,a=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){a=!0;var s=e}finally{try{o||null==n.return||n.return()}finally{if(a)throw s}}n=i}if(!(e=n||vl(e,t)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function G(e){var t=Array.isArray(e)?Uh(e):void 0;if(t||(t="undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"]?Array.from(e):void 0),!(e=t||vl(e)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function vl(e,t){if(e){if("string"==typeof e)return Uh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Uh(e,t)}}function Uh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function fa(e,t,n,r,i){var o={};return Object.keys(r).forEach(function(e){o[e]=r[e]}),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce(function(n,r){return r(e,t,n)||n},o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function $a(e){var t={exports:{}};return e(t,t.exports),t.exports}function wl(e,t){var n,r=3>arguments.length?e:arguments[2];return va(e)===r?e[t]:(n=Fb.f(e,t))?Q(n,"value")?n.value:void 0===n.get?void 0:n.get.call(r):ha(n=Vb(e))?wl(n,t,r):void 0}function rs(e){var t=e.charCodeAt(0)<<24,n=0|ss(~t),r=0,i=0|e.length,o="";if(5>n&&i>=n){for(t=t<<n>>>24+n,r=1;r<n;r=r+1|0)t=t<<6|63&e.charCodeAt(r);65535>=t?o+=xd(t):1114111>=t?o+=xd(55296+((t=t-65536|0)>>10)|0,56320+(1023&t)|0):r=0}for(;r<i;r=r+1|0)o+="";return o}function xl(){}function ts(e){var t=0|e.charCodeAt(0);if(55296<=t&&56319>=t){var n=0|e.charCodeAt(1);if(!(n==n&&56320<=n&&57343>=n))return xd(239,191,189);if(65535<(t=(t-55296<<10)+n-56320+65536|0))return xd(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}return 127>=t?e:2047>=t?xd(192|t>>>6,128|63&t):xd(224|t>>>12,128|t>>>6&63,128|63&t)}function yl(){}function ea(){ea.init.call(this)}function ng(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+X(e))}function zl(e,t,n,r){ng(n);var i=e._events;if(void 0===i)i=e._events=Object.create(null),e._eventsCount=0;else{void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events);var o=i[t]}return void 0===o?(i[t]=n,++e._eventsCount):("function"==typeof o?o=i[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),0<(n=void 0===e._maxListeners?ea.defaultMaxListeners:e._maxListeners)&&o.length>n&&!o.warned&&(o.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=o.length,console&&console.warn&&console.warn(n))),e}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(e,t,n){return(t=us.bind(e={fired:!1,wrapFn:void 0,target:e,type:t,listener:n})).listener=n,e.wrapFn=t}function Bl(e,t,n){if(void 0===(e=e._events))return[];if(void 0===(t=e[t]))return[];if("function"==typeof t)return n?[t.listener||t]:[t];if(n)for(n=Array(t.length),e=0;e<n.length;++e)n[e]=t[e].listener||t[e];else n=Cl(t,t.length);return n}function Dl(e){var t=this._events;if(void 0!==t){if("function"==typeof(e=t[e]))return 1;if(void 0!==e)return e.length}return 0}function Cl(e,t){for(var n=Array(t),r=0;r<t;++r)n[r]=e[r];return n}function vs(e,t,n){"function"==typeof e.on&&El(e,"error",t,n)}function El(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(e));e.addEventListener(t,function i(o){r.once&&e.removeEventListener(t,i),n(o)})}}function ws(e){return e?G(e):xs(function(){return[]},function(e,t){return e.push(t),e})}function Fl(e,t){var n,r,i;return w.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:n=Gl(e)([Hl,Hl,function(e,t){return t}])[2],r=0;case 2:if(!(r<t.length)){o.next=17;break}if(!((i=n(Vh,t[r]))instanceof og)){o.next=11;break}if((i=Wh(i.deref()))===Vh){o.next=10;break}return o.next=10,i;case 10:return o.abrupt("return");case 11:if(i===Vh){o.next=14;break}return o.next=14,i;case 14:r++,o.next=2;break;case 17:case"end":return o.stop()}},ys)}function pg(e,t){return null!=t&&"function"==typeof t[Symbol.iterator]?Fl(pg(e),t):function(t){var n=t[2];return zs(t,function(t,r){return n(t,e(r))})}}function Ac(e){return Object.prototype.toString.call(e).slice(8,-1)}function yd(e){return"Object"===Ac(e)&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Il(e){var t;return(t="Boolean"===Ac(e)||"Null"===Ac(e)||"Undefined"===Ac(e))||(t="Number"===Ac(e)&&!isNaN(e)),t||"String"===Ac(e)||"Symbol"===Ac(e)}function zd(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ce(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function de(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function gf(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new qg;++t<n;)this.add(e[t])}function ee(e){this.size=(this.__data__=new rg(e)).size}function fe(e,t,n,r,i,o){var a,s=1&t,c=2&t,u=4&t;if(n&&(a=i?n(e,r,i,o):n(e)),void 0!==a)return a;if(!lb(e))return e;if(r=Va(e)){if(a=As(e),!s)return Xh(e,a)}else{var l=hf(e),d="[object Function]"==l||"[object GeneratorFunction]"==l;if(jf(e))return Jl(e,s);if("[object Object]"==l||"[object Arguments]"==l||d&&!i){if(a=c||d?{}:Kl(e),!s)return c?Bs(e,Cs(a,e)):Ds(e,Es(a,e))}else{if(!wa[l])return i?e:{};a=Fs(e,l,s)}}if(o||(o=new ge),i=o.get(e))return i;o.set(e,a),Gs(e)?e.forEach(function(r){a.add(fe(r,t,n,r,e,o))}):Hs(e)&&e.forEach(function(r,i){a.set(i,fe(r,t,n,i,e,o))}),c=u?c?Ll:Yh:c?kf:Ad;var h=r?void 0:c(e);return Is(h||e,function(r,i){h&&(r=e[i=r]),Ml(a,i,fe(r,t,n,i,e,o))}),a}function Zh(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;return o.has(i)?o.get(i):(r=e.apply(this,r),n.cache=o.set(i,r)||o,r)};return n.cache=new(Zh.Cache||qg),n}function Nl(e){if("string"==typeof e)return e;if(Va(e))return he(e,Nl)+"";if(ie(e))return Ol?Ol.call(e):"";var t=e+"";return"0"==t&&1/e==-Js?"-0":t}function $h(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=Ks),i||(i=[]);++o<a;){var s=e[o];0<t&&n(s)?1<t?$h(s,t-1,n,r,i):ai(i,s):r||(i[i.length]=s)}return i}function je(e,t,n,r,i){if(e===t)t=!0;else if(null==e||null==t||!gc(e)&&!gc(t))t=e!=e&&t!=t;else e:{var o=Va(e),a=Va(t),s=o?"[object Array]":hf(e),c=a?"[object Array]":hf(t),u="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s);if(a="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),(c=s==c)&&jf(e)){if(!jf(t)){t=!1;break e}o=!0,u=!1}if(c&&!u)i||(i=new ge),t=o||bi(e)?Pl(e,t,n,r,je,i):Ls(e,t,s,n,r,je,i);else{if(!(1&n)&&(o=u&&Ql.call(e,"__wrapped__"),s=a&&Ql.call(t,"__wrapped__"),o||s)){e=o?e.value():e,t=s?t.value():t,i||(i=new ge),t=je(e,t,n,r,i);break e}if(c)t:if(i||(i=new ge),o=1&n,s=Yh(e),a=s.length,c=Yh(t).length,a==c||o){for(c=a;c--;){var l=s[c];if(!(o?l in t:Ms.call(t,l))){t=!1;break t}}if(u=i.get(e),l=i.get(t),u&&l)t=u==t&&l==e;else{u=!0,i.set(e,t),i.set(t,e);for(var d=o;++c<a;){var h=e[l=s[c]],p=t[l];if(r)var f=o?r(p,h,l,t,e,i):r(h,p,l,e,t,i);if(void 0===f?h!==p&&!je(h,p,n,r,i):!f){u=!1;break}d||(d="constructor"==l)}u&&!d&&(n=e.constructor)!=(r=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(u=!1),i.delete(e),i.delete(t),t=u}}else t=!1;else t=!1}}return t}function xa(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function mb(e){return!0===(e&&e.__isLong__)}function Bd(e,t){var n;if(t){if((t=0<=(e>>>=0)&&256>e)&&(n=Rl[e]))return n;n=ya(e,0>(0|e)?-1:0,!0),t&&(Rl[e]=n)}else{if((t=-128<=(e|=0)&&128>e)&&(n=Sl[e]))return n;n=ya(e,0>e?-1:0,!1),t&&(Sl[e]=n)}return n}function Gb(e,t){if(isNaN(e))return t?Cd:Hb;if(t){if(0>e)return Cd;if(e>=Tl)return Ul}else{if(e<=-Vl)return nb;if(e+1>=Vl)return Wl}return 0>e?Gb(-e,t).neg():ya(e%ke|0,e/ke|0,t)}function ya(e,t,n){return new xa(e,t,n)}function ci(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return Hb;if("number"==typeof t?(n=t,t=!1):t=!!t,2>(n=n||10)||36<n)throw RangeError("radix");var r;if(0<(r=e.indexOf("-")))throw Error("interior hyphen");if(0===r)return ci(e.substring(1),t,n).neg();r=Gb(sg(n,8));for(var i=Hb,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),s=parseInt(e.substring(o,o+a),n);8>a?(a=Gb(sg(n,a)),i=i.mul(a).add(Gb(s))):i=(i=i.mul(r)).add(Gb(s))}return i.unsigned=t,i}function Wb(e,t){return"number"==typeof e?Gb(e,t):"string"==typeof e?ci(e,t):ya(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}function O(e,t){function n(){this.constructor=e}di(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function le(e){return"function"==typeof e}function me(e){setTimeout(function(){throw e},0)}function ei(e){return null!==e&&"object"===X(e)}function Xl(e){return e.reduce(function(e,t){return e.concat(t instanceof lf?t.errors:t)},[])}function fi(e){for(;e;){var t=e.destination;if(e.closed||e.isStopped)return!1;e=t&&t instanceof ia?t:null}return!0}function Yc(e){return e}function gi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Yl(e)}function Yl(e){return 0===e.length?Yc:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}function Zl(e){if(e||(e=Ib.Promise||Promise),!e)throw Error("no Promise impl found");return e}function $l(){return function(e){return e.lift(new Ns(e))}}function mf(e){return e?Os(e):vb}function Os(e){return new Y(function(t){return e.schedule(function(){return t.complete()})})}function Zc(e){return e&&"function"==typeof e.schedule}function hi(e,t){return new Y(function(n){var r=new Oa,i=0;return r.add(t.schedule(function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||r.add(this.schedule()))})),r})}function nf(e,t){return t?hi(e,t):new Y(am(e))}function bb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Zc(t=e[e.length-1])?(e.pop(),hi(e,t)):nf(e)}function Z(e,t){return new Y(t?function(n){return t.schedule(Ps,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function Ps(e){e.subscriber.error(e.error)}function Qs(e,t){return void 0===t&&(t=0),function(n){return n.lift(new Rs(e,t))}}function bm(e){return e in ii&&(delete ii[e],!0)}function hc(){}function ba(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Ss(e,t))}}function cm(e,t,n){if(t){if(!Zc(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return cm(e,n).apply(void 0,r).pipe(ba(function(e){return Jb(e)?t.apply(void 0,e):t(e)}))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i,o=this,a={context:o,subject:i,callbackFunc:e,scheduler:n};return new Y(function(r){if(n)return n.schedule(Ts,0,{args:t,subscriber:r,params:a});if(!i){i=new of;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.next(1>=e.length?e[0]:e),i.complete()}]))}catch(e){fi(i)?i.error(e):console.warn(e)}}return i.subscribe(r)})}}function Ts(e){var t=this,n=e.args,r=e.subscriber,i=e.params;e=i.callbackFunc;var o=i.context,a=i.scheduler,s=i.subject;if(!s){s=i.subject=new of,i=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.add(a.schedule(Us,0,{value:1>=e.length?e[0]:e,subject:s}))};try{e.apply(o,n.concat([i]))}catch(e){s.error(e)}}this.add(s.subscribe(r))}function Us(e){var t=e.subject;t.next(e.value),t.complete()}function dm(e,t,n){if(t){if(!Zc(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return dm(e,n).apply(void 0,r).pipe(ba(function(e){return Jb(e)?t.apply(void 0,e):t(e)}))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new Y(function(r){var o=i.context,a=i.subject;if(n)return n.schedule(Vs,0,{params:i,subscriber:r,context:o});if(!a){a=i.subject=new of;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(t=e.shift())?a.error(t):(a.next(1>=e.length?e[0]:e),a.complete())}]))}catch(e){fi(a)?a.error(e):console.warn(e)}}return a.subscribe(r)})}}function Vs(e){var t=this,n=e.params,r=e.subscriber;e=e.context;var i=n.callbackFunc,o=n.args,a=n.scheduler,s=n.subject;if(!s){s=n.subject=new of,n=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(n=e.shift())?t.add(a.schedule(em,0,{err:n,subject:s})):t.add(a.schedule(Ws,0,{value:1>=e.length?e[0]:e,subject:s}))};try{i.apply(e,o.concat([n]))}catch(e){this.add(a.schedule(em,0,{err:e,subject:s}))}}this.add(s.subscribe(r))}function Ws(e){var t=e.subject;t.next(e.value),t.complete()}function em(e){e.subject.error(e.err)}function fm(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}function ji(e,t,n,r,i){if(void 0===i&&(i=new Xs(e,n,r)),!i.closed)return t instanceof Y?t.subscribe(i):pf(t)(i)}function Ys(e,t){return new Y(function(n){var r=new Oa;return r.add(t.schedule(function(){var i=e[ne]();r.add(i.subscribe({next:function(e){r.add(t.schedule(function(){return n.next(e)}))},error:function(e){r.add(t.schedule(function(){return n.error(e)}))},complete:function(){r.add(t.schedule(function(){return n.complete()}))}}))})),r})}function Zs(e,t){return new Y(function(n){var r=new Oa;return r.add(t.schedule(function(){return e.then(function(e){r.add(t.schedule(function(){n.next(e),r.add(t.schedule(function(){return n.complete()}))}))},function(e){r.add(t.schedule(function(){return n.error(e)}))})})),r})}function $s(e,t){if(!e)throw Error("Iterable cannot be null");return new Y(function(n){var r,i=new Oa;return i.add(function(){r&&"function"==typeof r.return&&r.return()}),i.add(t.schedule(function(){r=e[$c](),i.add(t.schedule(function(){if(!n.closed){try{var e=r.next(),t=e.value,i=e.done}catch(e){return void n.error(e)}i?n.complete():(n.next(t),this.schedule())}}))})),i})}function gm(e,t){if(null!=e){if(e&&"function"==typeof e[ne])return Ys(e,t);if(fm(e))return Zs(e,t);if(hm(e))return hi(e,t);if(e&&"function"==typeof e[$c]||"string"==typeof e)return $s(e,t)}throw new TypeError((null!==e&&X(e)||e)+" is not observable")}function Kb(e,t){return t?gm(e,t):e instanceof Y?e:new Y(pf(e))}function ic(e,t){if(!t.closed){if(e instanceof Y)return e.subscribe(t);try{var n=pf(e)(t)}catch(e){t.error(e)}return n}}function cb(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(cb(function(n,r){return Kb(e(n,r)).pipe(ba(function(e,i){return t(n,e,r,i)}))},n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new at(e,n))})}function tg(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),cb(Yc,e)}function im(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return tg(1)(bb.apply(void 0,e))}function ad(e){return new Y(function(t){try{var n=e()}catch(e){return void t.error(e)}return(n?Kb(n):mf()).subscribe(t)})}function jm(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(Jb(n))return ug(n,null);if(ei(n)&&Object.getPrototypeOf(n)===Object.prototype)return ug((e=Object.keys(n)).map(function(e){return n[e]}),e)}if("function"==typeof e[e.length-1]){var r=e.pop();return ug(e=1===e.length&&Jb(e[0])?e[0]:e,null).pipe(ba(function(e){return r.apply(void 0,e)}))}return ug(e,null)}function ug(e,t){return new Y(function(n){var r=e.length;if(0===r)n.complete();else for(var i=Array(r),o=0,a=0,s=function(s){var c=Kb(e[s]),u=!1;n.add(c.subscribe({next:function(e){u||(u=!0,a++),i[s]=e},error:function(e){return n.error(e)},complete:function(){++o!==r&&u||(a===r&&n.next(t?t.reduce(function(e,t,n){return e[t]=i[n],e},{}):i),n.complete())}}))},c=0;c<r;c++)s(c)})}function gb(e,t,n,r){return le(n)&&(r=n,n=void 0),r?gb(e,t,n).pipe(ba(function(e){return Jb(e)?r.apply(void 0,e):r(e)})):new Y(function(r){km(e,t,function(e){r.next(1<arguments.length?Array.prototype.slice.call(arguments):e)},r,n)})}function km(e,t,n,r,i){if(e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener){e.addEventListener(t,n,i);var o=function(){return e.removeEventListener(t,n,i)}}else if(e&&"function"==typeof e.on&&"function"==typeof e.off)e.on(t,n),o=function(){return e.off(t,n)};else if(e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener)e.addListener(t,n),o=function(){return e.removeListener(t,n)};else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var a=0,s=e.length;a<s;a++)km(e[a],t,n,r,i)}r.add(o)}function lm(e,t,n){return n?lm(e,t).pipe(ba(function(e){return Jb(e)?n.apply(void 0,e):n(e)})):new Y(function(n){var r=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{var i=e(r)}catch(e){return void n.error(e)}if(le(t))return function(){return t(r,i)}})}function bt(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}try{var i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function ki(e){return!Jb(e)&&0<=e-parseFloat(e)+1}function mm(e,t){return void 0===e&&(e=0),void 0===t&&(t=bd),(!ki(e)||0>e)&&(e=0),t&&"function"==typeof t.schedule||(t=bd),new Y(function(n){return n.add(t.schedule(ct,e,{subscriber:n,counter:0,period:e})),n})}function ct(e){var t=e.subscriber,n=e.counter;e=e.period,t.next(n),this.schedule({subscriber:t,counter:n+1,period:e},e)}function Xb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];t=Number.POSITIVE_INFINITY;var n=null,r=e[e.length-1];return Zc(r)?(n=e.pop(),1<e.length&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof r&&(t=e.pop()),null===n&&1===e.length&&e[0]instanceof Y?e[0]:tg(t)(nf(e,n))}function li(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return vb;var n=e[0],r=e.slice(1);return 1===e.length&&Jb(n)?li.apply(void 0,n):new Y(function(e){var t=function(){return e.add(li.apply(void 0,r).subscribe(e))};return Kb(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})})}function dt(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription;if(e=e.obj,!r.closed)if(n<t.length){var o=t[n];r.next([o,e[o]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:e}))}else r.complete()}function et(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}function wb(e,t){return function(n){return n.lift(new ft(e,t))}}function Ca(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!Jb(e[0]))return e[0];e=e[0]}return nf(e,void 0).lift(new gt)}function ht(e){var t=e.start,n=e.index,r=e.subscriber;n>=e.count?r.complete():(r.next(t),r.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}function Bc(e,t,n){void 0===e&&(e=0);var r=-1;return ki(t)?r=1>Number(t)?1:Number(t):Zc(t)&&(n=t),Zc(n)||(n=bd),new Y(function(t){var i=ki(e)?e:+e-n.now();return n.schedule(it,i,{index:0,period:r,subscriber:t})})}function it(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function mi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"function"==typeof(t=e[e.length-1])&&e.pop(),nf(e,void 0).lift(new jt(t))}function Ga(e){return function(t){var n=new kt(e);return t=t.lift(n),n.caught=t}}function ni(e,t){return cb(e,t,1)}function nm(e){return void 0===e&&(e=null),function(t){return t.lift(new lt(e))}}function cd(e,t){void 0===t&&(t=bd);var n=e instanceof Date&&!isNaN(+e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new mt(n,t))}}function om(e,t){return function(n){return n.lift(new nt(e,t))}}function Dd(e){return void 0===e&&(e=ot),function(t){return t.lift(new pt(e))}}function ot(){return new vg}function Ka(e){return function(t){return 0===e?mf():t.lift(new qt(e))}}function pm(e,t){return t?function(n){return n.pipe(pm(function(n,r){return Kb(e(n,r)).pipe(ba(function(e,i){return t(n,e,r,i)}))}))}:function(t){return t.lift(new rt(e))}}function wg(e){return function(t){return t.lift(new st(e))}}function aa(e,t){var n=2<=arguments.length;return function(r){return r.pipe(e?wb(function(t,n){return e(t,n,r)}):Yc,Ka(1),n?nm(t):Dd(function(){return new vg}))}}function tt(){return function(e){return e.lift(new ut)}}function qm(e){return function(t){return 0===e?mf():t.lift(new vt(e))}}function qf(e){return function(t){return t.lift(new wt(e))}}function xg(e,t){var n=!1;return 2<=arguments.length&&(n=!0),function(r){return r.lift(new xt(e,t,n))}}function rm(e,t){return 2<=arguments.length?function(n){return gi(xg(e,t),qm(1),nm(t))(n)}:function(t){return gi(xg(function(t,n,r){return e(t,n,r+1)}),qm(1))(t)}}function yt(e,t){return function(n){var r="function"==typeof e?e:function(){return e};if("function"==typeof t)return n.lift(new zt(r,t));var i=Object.create(n,At);return i.source=n,i.subjectFactory=r,i}}function oe(e){return function(t){return t.lift(new Bt(e,t))}}function Ct(){return new Pa}function pe(){return function(e){return $l()(yt(Ct)(e))}}function sm(e,t,n){var r=e&&"object"===X(e)?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n};return function(e){return e.lift(Dt(r))}}function Dt(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=void 0===(r=e.windowTime)?Number.POSITIVE_INFINITY:r,a=e.refCount,s=e.scheduler,c=0,u=!1,l=!1;return function(e){if(c++,!t||u){u=!1;var r=(t=new qe(i,o,s)).subscribe(this);n=e.subscribe({next:function(e){t.next(e)},error:function(e){u=!0,t.error(e)},complete:function(){l=!0,n=void 0,t.complete()}}),l&&(n=void 0)}else r=t.subscribe(this);this.add(function(){c--,r.unsubscribe(),r=void 0,n&&!l&&a&&0===c&&(n.unsubscribe(),t=n=void 0)})}}function Cc(e,t){return"function"==typeof t?function(n){return n.pipe(Cc(function(n,r){return Kb(e(n,r)).pipe(ba(function(e,i){return t(n,e,r,i)}))}))}:function(t){return t.lift(new Et(e))}}function ob(e){return function(t){return t.lift(new Ft(e))}}function Gt(e,t){return void 0===t&&(t=!1),function(n){return n.lift(new Ht(e,t))}}function ca(e,t,n){return function(r){return r.lift(new It(e,t,n))}}function Jt(e,t,n){return void 0===t&&(t=bd),void 0===n&&(n=Kt),function(r){return r.lift(new Lt(e,t,n.leading,n.trailing))}}function Mt(e){e.subscriber.clearThrottle()}function Nt(e,t,n){return void 0===n&&(n=bd),function(r){var i=e instanceof Date&&!isNaN(+e),o=i?+e-n.now():Math.abs(e);return r.lift(new Ot(o,i,t,n))}}function hb(e,t){return void 0===t&&(t=bd),Nt(e,Z(new pb),t)}function Pt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;return"function"==typeof e[e.length-1]&&(n=e.pop()),t.lift(new Qt(e,n))}}function tm(e,t,n,r,i){e!==t&&um(t,function(o,a){if(i||(i=new ge),lb(o)){o=i;var s=oi(e,a),c=oi(t,a),u=o.get(c);if(u)pi(e,a,u);else{var l=void 0===(u=r?r(s,c,a+"",e,t,o):void 0);if(l){var d=Va(c),h=!d&&jf(c),p=!d&&!h&&bi(c);u=c,d||h||p?Va(s)?u=s:gc(s)&&Ed(s)?u=Xh(s):h?(l=!1,u=Jl(c,!0)):p?(l=!1,u=vm(c,!0)):u=[]:wm(c)||rf(c)?(u=s,rf(s)?u=re(s,kf(s)):lb(s)&&!qi(s)||(u=Kl(c))):l=!1}l&&(o.set(c,u),tm(u,c,n,r,o),o.delete(c)),pi(e,a,u)}}else void 0===(s=r?r(oi(e,a),o,a+"",e,t,i):void 0)&&(s=o),pi(e,a,s)},kf)}function Rt(e){var t=1,n=ri;1==(1>=arguments.length?0:arguments.length-1)?"number"==typeof(1>=arguments.length?void 0:arguments[1])?t=1>=arguments.length?void 0:arguments[1]:n=1>=arguments.length?void 0:arguments[1]:2==(1>=arguments.length?0:arguments.length-1)&&(t=1>=arguments.length?void 0:arguments[1],n=2>=arguments.length?void 0:arguments[2]);var r=t||1;return function(t){return t.pipe(xg(function(t,i){var o=n.now(),a=o-e;if((t=t.filter(function(e){return e.until>a})).length>=r){var s=t[t.length-1],c=t[0].until+e*Math.floor(t.length/r);t.push({delay:s.until<o?c-o:c-s.until,until:c,value:i})}else t.push({delay:0,until:o,value:i});return t},[]),ba(function(e){return e[e.length-1]}),ni(function(e){var t=bb(e.value);return e.delay?t.pipe(cd(e.delay,n)):t}))}}function St(e,t){var n=(t=void 0===t?{protocols:xm,makeWebSocket:ym}:t).protocols,r=void 0===n?xm:n,i=void 0===(t=t.makeWebSocket)?ym:t;return new Y(function(t){var n,o=new Pa,a=i(e,r),s=!1,c=!1,u=function(e){if(n)throw s=!0,e=Error("Web socket message factory function called more than once"),t.error(e),e;return n=e.subscribe(function(e){a.send(e)}),o};return a.onopen=function(){c?(s=!0,a.close()):t.next(u)},a.onmessage=function(e){o.next(e.data)},a.onerror=function(e){s=!0,t.error(Error(e.message))},a.onclose=function(e){s||(s=!0,c?(t.complete(),o.complete()):t.error(Error(1e3===e.code?"Normal closure":e.reason)))},function(){c=!0,n&&n.unsubscribe(),s||(s=!0,a.close())}})}function yg(){this._listeners={}}function zm(e){return"undefined"!=typeof Float32Array?function(){function t(e,t,n){o[0]=e,t[n]=a[0],t[n+1]=a[1],t[n+2]=a[2],t[n+3]=a[3]}function n(e,t,n){o[0]=e,t[n]=a[3],t[n+1]=a[2],t[n+2]=a[1],t[n+3]=a[0]}function r(e,t){return a[0]=e[t],a[1]=e[t+1],a[2]=e[t+2],a[3]=e[t+3],o[0]}function i(e,t){return a[3]=e[t],a[2]=e[t+1],a[1]=e[t+2],a[0]=e[t+3],o[0]}var o=new Float32Array([-0]),a=new Uint8Array(o.buffer),s=128===a[3];e.writeFloatLE=s?t:n,e.writeFloatBE=s?n:t,e.readFloatLE=s?r:i,e.readFloatBE=s?i:r}():function(){function t(e,t,n,r){var i=0>t?1:0;if(i&&(t=-t),0===t)e(0<1/t?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(34028234663852886e22<t)e((i<<31|2139095040)>>>0,n,r);else if(11754943508222875e-54>t)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){return n=e(t,n),e=2*(n>>31)+1,t=n>>>23&255,n&=8388607,255===t?n?NaN:1/0*e:0===t?1401298464324817e-60*e*n:e*Math.pow(2,t-150)*(n+8388608)}e.writeFloatLE=t.bind(null,Am),e.writeFloatBE=t.bind(null,Bm),e.readFloatLE=n.bind(null,Cm),e.readFloatBE=n.bind(null,Dm)}(),"undefined"!=typeof Float64Array?function(){function t(e,t,n){o[0]=e,t[n]=a[0],t[n+1]=a[1],t[n+2]=a[2],t[n+3]=a[3],t[n+4]=a[4],t[n+5]=a[5],t[n+6]=a[6],t[n+7]=a[7]}function n(e,t,n){o[0]=e,t[n]=a[7],t[n+1]=a[6],t[n+2]=a[5],t[n+3]=a[4],t[n+4]=a[3],t[n+5]=a[2],t[n+6]=a[1],t[n+7]=a[0]}function r(e,t){return a[0]=e[t],a[1]=e[t+1],a[2]=e[t+2],a[3]=e[t+3],a[4]=e[t+4],a[5]=e[t+5],a[6]=e[t+6],a[7]=e[t+7],o[0]}function i(e,t){return a[7]=e[t],a[6]=e[t+1],a[5]=e[t+2],a[4]=e[t+3],a[3]=e[t+4],a[2]=e[t+5],a[1]=e[t+6],a[0]=e[t+7],o[0]}var o=new Float64Array([-0]),a=new Uint8Array(o.buffer),s=128===a[7];e.writeDoubleLE=s?t:n,e.writeDoubleBE=s?n:t,e.readDoubleLE=s?r:i,e.readDoubleBE=s?i:r}():function(){function t(e,t,n,r,i,o){var a=0>r?1:0;if(a&&(r=-r),0===r)e(0,i,o+t),e(0<1/r?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(17976931348623157e292<r)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+n);else if(22250738585072014e-324>r)e((r/=5e-324)>>>0,i,o+t),e((a<<31|r/4294967296)>>>0,i,o+n);else{var s=Math.floor(Math.log(r)/Math.LN2);1024===s&&(s=1023),e(4503599627370496*(r*=Math.pow(2,-s))>>>0,i,o+t),e((a<<31|s+1023<<20|1048576*r&1048575)>>>0,i,o+n)}}function n(e,t,n,r,i){return t=e(r,i+t),r=e(r,i+n),e=2*(r>>31)+1,t=4294967296*(1048575&r)+t,2047==(n=r>>>20&2047)?t?NaN:1/0*e:0===n?5e-324*e*t:e*Math.pow(2,n-1075)*(t+4503599627370496)}e.writeDoubleLE=t.bind(null,Am,0,4),e.writeDoubleBE=t.bind(null,Bm,4,0),e.readDoubleLE=n.bind(null,Cm,0,4),e.readDoubleBE=n.bind(null,Dm,4,0)}(),e}function Am(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function Bm(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function Cm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function Dm(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function Wa(e,t){this.lo=e>>>0,this.hi=t>>>0}function sf(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function si(){}function Tt(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(e,t,n){t[n]=255&e}function ui(e,t){this.len=e,this.next=void 0,this.val=t}function vi(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[n++]=127&e.lo|128,e.lo>>>=7;t[n++]=e.lo}function wi(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function jc(){xi.call(this)}function Ut(e,t,n){40>e.length?V.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}function Yb(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function La(e){this.buf=e,this.pos=0,this.len=e.length}function yi(){var e=new Em(0,0),t=0;if(!(4<this.len-this.pos)){for(;3>t;++t){if(this.pos>=this.len)throw Yb(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;4>t;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(t=0,4<this.len-this.pos){for(;5>t;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>t;++t){if(this.pos>=this.len)throw Yb(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function zg(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(e){zi.call(this,e)}function tf(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}function za(e){return"string"==typeof e&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&"null"!==e}function Gm(e){try{var t=e.split(".").map(function(e){return Number(e)})}catch(e){return!1}if(4!==t.length||0===t[0])return!1;for(e=0;e<t.length;e++){var n=t[e];if(!Number.isInteger(n)||0>n||255<n)return!1}return!0}function Hm(e,t){if(!Array.isArray(t)||0===t.length||32<t.length||t.some(function(e){return 0===e.length||32<e.length}))throw new I("arguments is not valid",Ja);if(!za(e))throw new I("ID is invalid",Ja)}function uf(e){var t=e.attributes,n=e.attrSizeMap,r=e.maxAttrsCount,i=e.maxAttrValueSize;if(e=e.maxTotalSize,!yd(t))throw new I("attributes must be an object",Ja);if(Object.keys(t).length>r)throw new ib("Exceed the limit of ".concat(r," attributes"),se);if(0===Object.keys(t).length)throw new I("The attributes is an empty object",Ja);var o=0,a=0;for(t=Object.entries(t);a<t.length;a++){var s=ra(t[a],2),c=s[1];s=new Blob([s[0]]).size;var u=new Blob([c]).size;if(0===s||32<s)throw new I("Invalid attribute key",Ja);if(u>i)throw new ib("Invalid attribute value, over the limit of ".concat(i," bytes"),se);if("string"!=typeof c||0===c.length)throw new I("Invalid attribute value",Ja);o+=s,o+=u}if(o>e)throw new ib("The attributes size overflow",se);if(void 0!==n){if(Object.keys(n).length>r)throw new ib("Exceed the limit of ".concat(r," attributes"),se);for(o=r=0,n=Object.entries(n);o<n.length;o++){if(a=(t=ra(n[o],2))[1],0===(t=new Blob([t[0]]).size))throw new I("Invalid attribute key",Ja);if(a>i)throw new ib("Invalid attribute value, over the limit of ".concat(i," bytes"),se);r+=t,r+=a}if(r>e)throw new ib("The attributes size overflow",se)}}function Ag(e,t){return Math.floor(Math.random()*(Math.floor(t)-Math.ceil(e)+1))+e}function Bg(){var e=Ag(0,4294967295),t=Ag(1,4294967295);return new U(e,t,!0)}function Xa(e){return e.toString().padEnd(32,"0")}function Im(e,t){return new TypeError("Unexpected ".concat(e,": ").concat(t))}function Jm(e,t){return e=e.split(".").map(function(e){return Number(e)}),t=t.split(".").map(function(e){return Number(e)}),Math.sqrt(1e3*Math.pow(e[0]-t[0],2)+100*Math.pow(e[1]-t[1],2)+10*Math.pow(e[2]-t[2],2)+1*Math.pow(e[3]-t[3],2))}function Km(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}function Ai(e,t){t="".concat(e).concat(t||"");var n=Lm.get(t)||1;return Lm.set(t,n+1),"".concat(e).concat(n)}function Mm(e,t){var n="number"==typeof t?t:void 0!==t&&"string"!=typeof t?t.code:void 0;return t="number"!=typeof t&&"string"!=typeof t&&void 0!==t&&void 0!==t.serverCode?t.serverCode:void 0,n="".concat(void 0!==n?" Error Code ".concat(n):"").concat(void 0!==t?", server Code ".concat(t):""),e="string"==typeof e&&e?Cg(e):Array.isArray(e)&&"string"==typeof e[0]&&e[0]?Cg(Nm.apply(void 0,[e[0]].concat(G(e.slice(1))))):"","".concat(""===n?"":"".concat(n," - ")).concat(e)}function Om(e){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark(function e(t){return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){setTimeout(function(){e()},t)}));case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Pm(e){return e instanceof Blob||"[object Blob]"===Object.prototype.toString.call(e)}function Dg(e){var t=255&e,n=e>>8&255,r=e>>16&255;return"".concat(e>>24&255,".").concat(r,".").concat(n,".").concat(t)}function te(e,t,n){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark(function e(t,n,r){var i,o,a,s,c,u,l,d,h,p,f,m,g,v,E,y,_,b,S,T,R,C;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.body,a=void 0===(o=n.headers)?{}:o,c=void 0===(s=n.timeout)?1e4:s,u=n.signal,d=void 0!==(l=n.withCredentials)&&l,p=void 0!==(h=(r||{}).useBinaryResponse)&&h,(f=new XMLHttpRequest).open("POST",t,!0),f.responseType=p?"arraybuffer":"text",f.withCredentials=d,f.timeout=c,m=i instanceof FormData,g=i instanceof Uint8Array,!(1<(v=Object.keys(a).filter(function(e){return"content-type"===e.toLowerCase()})).length)){e.next=14;break}throw new RangeError("multiple content-type");case 14:0===v.length&&(g?a["Content-Type"]="application/octet-stream":m||(a["Content-Type"]="application/json"));case 15:if("setRequestHeader"in f){e.next=46;break}return f.abort(),e.next=19,fetch(t,{body:m||g?i:JSON.stringify(i),cache:"no-cache",credentials:d?"include":"same-origin",headers:a,method:"POST",mode:"cors",referrer:"no-referrer",signal:u});case 19:if(!(200<=(y=(E=e.sent).status)&&300>y||304===y)){e.next=31;break}if(!p){e.next=27;break}return e.next=25,E.arrayBuffer();case 25:return e.abrupt("return",{status:y,responseData:e.sent});case 27:return e.next=29,E.text();case 29:return e.abrupt("return",{status:y,responseText:e.sent});case 31:return _=new da(["Post XHR failure, status %d",y]),e.prev=32,e.next=35,E.text();case 35:throw b=e.sent,_.statusCode=y,_.message=b||"Request failed, status ".concat(y),_;case 41:throw e.prev=41,e.t0=e.catch(32),_.statusCode=y,_.message="Request failed, status ".concat(y),_;case 46:if(0!==Object.keys(a).length)for(S=0,T=Object.entries(a);S<T.length;S++)R=ra(T[S],2),f.setRequestHeader(R[0],R[1]);return void 0!==u&&(C=function e(){f.abort(),u.removeEventListener("abort",e)},u.addEventListener("abort",C)),f.send(m||g?i:JSON.stringify(i)),e.abrupt("return",new Promise(function(e,t){f.onload=function(){var n=f.status;if(200<=n&&300>n||304===n)e(p?{status:n,responseData:f.response}:{status:n,responseText:f.responseText});else{var r=new da(["Post XHR failure, status %d",n]);r.statusCode=n,r.message=f.response||"Request failed, status ".concat(f.status),t(r)}},f.ontimeout=function(e){t(new db(["XHR request timed out after %d ms",c],{originalError:e}))},f.onerror=function(){var e=new da(["Post XHR failure, status %d",f.status]);e.statusCode=f.status,e.message=f.response||"Request failed, status ".concat(f.status),t(e)},f.onabort=function(){try{t(new DOMException("The request aborted.","AbortError"))}catch(n){var e=Error("The request aborted.");e.name="AbortError",t(e)}}}));case 50:case"end":return e.stop()}},e,null,[[32,41]])}))).apply(this,arguments)}function Rm(e){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark(function e(t){var n;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new Image).src=t,e.abrupt("return",new Promise(function(e,t){n.onload=function(){e({width:n.width,height:n.height})},n.onerror=t}));case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Xt(e,t){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark(function e(t,n){var r,i,o,a,s,c,u,l,d,h;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=void 0===(o=t.thumbnailWidth)?0:o,c=void 0===(s=t.width)?0:s,l=void 0===(u=t.height)?0:u,d=t.thumbnail,h=[],"number"==typeof(i=void 0===(r=t.thumbnailHeight)?0:r)&&"number"==typeof a&&"number"==typeof c&&"number"==typeof l){e.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=c&&0>=l&&h.push(Rm(Sm(n)).then(function(e){c=e.width,l=e.height})),0>=a&&0>=i&&void 0!==d&&h.push(Ji(d).then(function(){var e=J(w.mark(function e(t){var n;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Rm(Sm(t));case 2:a=(n=e.sent).width,i=n.height;case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())),e.next=9,Promise.all(h).catch(function(){});case 9:return e.abrupt("return",{width:c,height:l,thumbnailWidth:a,thumbnailHeight:i});case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Tm(e,t){if(!yd(e))throw new I("message object is not a plain object",t);if(void 0===e.messageType)if(e.rawMessage instanceof Uint8Array){if(e.messageType="RAW",void 0!==e.text)throw new I("Raw messages cannot have text property. Use description instead",t)}else{if("string"!=typeof e.text)throw new I("messageType is undefined",t);if(e.messageType="TEXT",void 0!==e.rawMessage)throw new I("Text messages cannot have rawMessage property",t)}}function Gg(e){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark(function e(t){var n,r,i,o,a,s,c,u,l,d,h,p,f,m,g,v,E,y,_,b,S;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.message,r=t.peerId,i=t.toPeer,a=t.errorCodes,s=t.diff,c=t.logger,u=t.options,void 0!==(o=t.session)){e.next=3;break}throw new K("The client is not logged in. Cannot do the operation",a.NOT_LOGGED_IN);case 3:if(l=!1,"TEXT"!==n.messageType||!n.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!i){e.next=11;break}if(d=n.text.split("_"),h=ra(d,3),p=h[0],f=h[1],void 0!==h[2]&&za(f)&&"AgoraRTMLegacyEndcallCompatibleMessagePrefix"===p){e.next=10;break}throw new I("Message is not valid",ve);case 10:l=!0;case 11:if(m=Date.now(),!((v=o.messageSentTimes[g=o.messageSentTimes.length-1])&&v+3e3<m)){e.next=18;break}o.messageSentTimes=[m],e.next=29;break;case 18:E=g;case 19:if(!(0<=E)){e.next=28;break}if(!(o.messageSentTimes[E]+3e3<m)){e.next=23;break}return o.messageSentTimes=o.messageSentTimes.slice(E+1,g+1),e.abrupt("break",28);case 23:if(!(180<=g-E+1)){e.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",a.TOO_OFTEN);case 25:E--,e.next=19;break;case 28:o.messageSentTimes.push(m);case 29:e.t0=n.messageType,e.next="TEXT"===e.t0?32:"RAW"===e.t0?37:"FILE"===e.t0||"IMAGE"===e.t0?39:40;break;case 32:if(!l){e.next=36;break}return y=n.text.split("_"),_=ra(y,3),b=_[1],S=_[2],c.info("[rtm-API] EndCall message send api is called"),e.abrupt("return",o.sendInvitationMessage({peerId:r,type:"CallCancel",extra:S,channelId:b,callId:"0"}));case 36:return e.abrupt("return",o.sendTextMessage(n.text,r,i,u,1e4-s));case 37:return void 0===n.description&&(n.description=""),e.abrupt("return",o.sendRawMessage(n.rawMessage,n.description,r,i,u,1e4-s));case 39:return e.abrupt("return",o.sendMediaMessage(n.messageType,n,r,i,u,1e4-s));case 40:throw new I("Invalid message type",ve);case 41:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Yt(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=e.replace(/(https?:\/\/)?(www.)?/i,"");return t||(n=n.split(".").slice(e.length-2).join(".")),-1!==n.indexOf("/")?n.split("/")[0]:n}function oa(e){if("string"!=typeof e)return"[Sensitive Info]";var t=Math.floor(.7*e.length),n=e.length;return Um(e,t,n,"*".repeat(n-t))}function Vm(e,t,n){function r(i){if(void 0===e)return e;if(Il(i))return i;if(Array.isArray(i))return i.map(r);var o={},a=0;for(i=Hg(i);a<i.length;a++){var s=ra(i[a],2),c=s[0];if("string"==typeof(s=s[1])&&n.includes(c)){o[c]="string"==typeof s?oa(s):"[Sensitive Info]";break}o[c]=t.includes(c)?"[Hidden Info]":null==s?s:n.includes(c)?"[Sensitive Info]":r(s)}return o}return Array.isArray(e)?e.map(r):r(e)}function Wm(e){return Object.getOwnPropertyNames(e).forEach(function(t){"object"==X(t=e[t])&&null!==t&&Wm(t)}),Object.freeze(e)}function pa(e){return new TextDecoder("utf-8").decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function Ig(e){return(new TextEncoder).encode(e).length}function Xm(){for(var e=0,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e+=n[t].length;for(e=new Uint8Array(e),r=t=0;r<n.length;r++){var i=n[r];e.set(i,t),t+=i.length}return e}function we(e,t,n){var r=e.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e=null==r?void 0:r[1],r=null==r?void 0:r[2]){var i;for(r=r.substr(1).split("&"),i=0;i<r.length;i++)if(r[i].split("=")[0]==t){r[i]=t+"="+encodeURIComponent(n);break}return i==r.length&&r.push(t+"="+encodeURIComponent(n)),e+"?"+r.join("&")}return e+"?"+t+"="+encodeURIComponent(n)}function Ji(e){return new Promise(function(t,n){var r=new FileReader;r.onloadend=function(){var e=r.result||new ArrayBuffer(0);t(e)},r.onerror=n,r.readAsArrayBuffer(e)})}function Zt(e,t){e=e=[e],"string"==typeof(t=t||{})&&(t={type:t});try{var n=new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder);for(var r=0;r<e.length;r+=1)n.append(e[r]);n=n.getBlob(t.type)}return n}function Um(e,t,n,r){return"string"!=typeof e?"[Sensitive Info]":e.substring(0,t)+r+e.substring(n)}function Ym(e){var t=[];return function e(n){if(null===n||"object"!==X(n))return n;if(-1!==t.indexOf(n))return"[Circular]";if(t.push(n),"function"==typeof n.toJSON)try{var r=e(n.toJSON());return t.pop(),r}catch(e){return"[Throws: "+(e?e.message:"?")+"]"}return Array.isArray(n)?(r=n.map(e),t.pop(),r):(r=Object.keys(n).reduce(function(t,r){e:{if($t.call(n,r))try{var i=n[r];break e}catch(e){i="[Throws: "+(e?e.message:"?")+"]";break e}i=n[r]}return t[r]=e(i),t},{}),t.pop(),r)}(e)}function au(e){if(!(100<(e=String(e)).length)&&(e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e))){var t=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*t;case"weeks":case"week":case"w":return 6048e5*t;case"days":case"day":case"d":return 864e5*t;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*t;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*t;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t}}}function Jg(e,t,n,r){return Math.round(e/n)+" "+r+(t>=1.5*n?"s":"")}function bu(e){var t=e.areas,n=e.excludedArea;if(1===t.length&&t[0]===F.GLOBAL&&n===F.CHINA)return xe([F.OVERSEA]);if(t.includes(F.GLOBAL)){if(e=xf(Kg).filter(function(e){return e!==F.GLOBAL&&e!==F.OVERSEA}),n in yf){var r=[].concat(G(null!=(t=yf[n])?t:[]),[n]);return xe(e.filter(function(e){return!r.includes(e)}))}if(Zm(n)){var i=cu(n);return xe(e.filter(function(e){return e!==n&&e!==i}))}}if(Zm(n)||n in yf)return xe(t);throw new I("Invalid excludedArea area config")}function Ma(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map(function(){return"%o"})):"%s"),this.name,t].concat(G(i.map(ye))));try{var a=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map(function(){return"%o"})):""),t].concat(G(i.map(ye)))),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var s=Date.now();return J(w.mark(function n(){var r,o;return w.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,a;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map(function(){return"%o"})):""),t].concat(G(i.map(ye)))),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==a?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-s):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-s,ye(r)):"Object"!==Ac(r)||yd(r)?e.resultTracker("%s result is %o",t,ye(r)):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}},n,null,[[0,6]])}))(),a},n}function Nb(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map(function(){return"%o"})):"%s"),this.name,t].concat(i));try{var a=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map(function(){return"%o"})):""),t].concat(i)),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var s=Date.now();return J(w.mark(function n(){var r,o;return w.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,a;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map(function(){return"%o"})):""),t].concat(i)),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==a?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-s):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-s,r):"Object"!==Ac(r)||yd(r)?e.resultTracker("%s result is %o",t,r):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}},n,null,[[0,6]])}))(),a},n}function du(e,t){var n="".concat(e,"Uri");if("number"!=typeof(n=Li[n])||0===n)throw new TypeError("Got Unknown URI Name");return t=new(e=$m[e])(t),t=e.encode(t).finish(),new eu({uri:n,data:t})}function an(e,t){return"".concat(e.split(".").join("-"),".edge.").concat(t?"sd-rtn.com":"agora.io")}function eb(e,t,n){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark(function e(t,n,r){var i,o;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.next=2;break;case 2:return i=fu[t].encode(n).finish(),o=function(){var e=J(w.mark(function e(n){var a,s,c,u=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(3<(s=1<u.length&&void 0!==u[1]?u[1]:0))){e.next=3;break}return e.abrupt("return");case 3:return c=we(c=r?"https://".concat(null!==(a=null==M?void 0:M.PROXY_NGINX[0])&&void 0!==a?a:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(n,"&p=6443&d=events/proto-raw"):"https://".concat(n,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),c=we(c,"id",gu[t].toString()),e.next=8,te(c,{body:i,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(e){return o(n,s+1)});case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),e.prev=4,e.next=7,o((null==M?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(4),e.next=13,o(M&&bn(1<(null==M?void 0:M.EVENT_REPORT_DOMAIN.length)?null==M?void 0:M.EVENT_REPORT_DOMAIN.slice(1):null==M?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return e.stop()}},e,null,[[4,9]])}))).apply(this,arguments)}function fb(e){return U.fromNumber(void 0===e?0:Date.now()-e)}function hu(e){return btoa(String.fromCharCode.apply({},e.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map(function(e){return parseInt(e,16)}))).replace(/={1,2}$/,"")}function Lg(e,t){return U.fromValue(e).eq(t)}function Mg(e,t){var n=void 0===t?e.val:t,r=e.isBoolean,i=e.oneof,o=e.len;if(2!==[r,t=e.isNumber,i].filter(function(e){return!e}).length)throw new TypeError("invalid field type");if(void 0!==n&&(e=!1,void 0!==i&&(i=Ni(i),iu(i,Lg).length===i.length&&void 0!==ju(i,function(e){return Lg(n,e)})&&(e=!0)),r=void 0!==r&&(0===n||1===n)&&1===o,t=void 0!==t&&n.toString(2).length<=o,!(e||r||t)))throw Error("invalid field value")}function cn(e){return function(){var t=e();if(!t)throw new K("Client is not logged in. Cannot do the operation");return t}}var Ya="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{},Ng=function(e){return e&&e.Math==Math&&e},y=Ng("object"==typeof globalThis&&globalThis)||Ng("object"==typeof window&&window)||Ng("object"==typeof self&&self)||Ng("object"==typeof Ya&&Ya)||function(){return this}()||Function("return this")(),R=function(e){try{return!!e()}catch(e){return!0}},ka=!R(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(e){return!!(e=en(this,e))&&e.enumerable}:dn,dd=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ku={}.toString,Zb=function(e){return ku.call(e).slice(8,-1)},lu="".split,Af=R(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==Zb(e)?lu.call(e,""):Object(e)}:Object,jb=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},qb=function(e){return Af(jb(e))},ha=function(e){return"object"==typeof e?null!==e:"function"==typeof e},lc=function(e,t){if(!ha(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!ha(r=n.call(e))||"function"==typeof(n=e.valueOf)&&!ha(r=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!ha(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},Qa=function(e){return Object(jb(e))},mu={}.hasOwnProperty,Q=function(e,t){return mu.call(Qa(e),t)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R(function(){return 7!=Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a}),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(e,t){if(e=qb(e),t=lc(t,!0),fn)try{return gn(e,t)}catch(e){}if(Q(e,t))return dd(!zf.call(e,t),e[t])}},va=function(e){if(!ha(e))throw TypeError(String(e)+" is not an object");return e},hn=Object.defineProperty,Ra={f:ka?hn:function(e,t,n){if(va(e),t=lc(t,!0),va(n),fn)try{return hn(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},Na=ka?function(e,t,n){return Ra.f(e,t,dd(1,n))}:function(e,t,n){return e[t]=n,e},Oi=function(e,t){try{Na(y,e,t)}catch(n){y[e]=t}return t},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;"function"!=typeof ed.inspectSource&&(ed.inspectSource=function(e){return nu.call(e)});var Pi=ed.inspectSource,jn=y.WeakMap,ou="function"==typeof jn&&/native code/.test(Pi(jn)),fd=$a(function(e){(e.exports=function(e,t){return ed[e]||(ed[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:" 2021 Denis Pushkarev (zloirock.ru)"})}),pu=0,qu=Math.random(),Ae=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(e){return kn[e]||(kn[e]=Ae(e))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(e,t){if(ln.call(Gd,e))throw new TypeError("Object already initialized");return t.facade=e,tu.call(Gd,e,t),t},Qg=function(e){return su.call(Gd,e)||{}},Ri=function(e){return ln.call(Gd,e)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(e,t){if(Q(e,Ce))throw new TypeError("Object already initialized");return t.facade=e,Na(e,Ce,t),t},Qg=function(e){return Q(e,Ce)?e[Ce]:{}},Ri=function(e){return Q(e,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(e){return Ri(e)?Qg(e):Qi(e,{})},getterFor:function(e){return function(t){var n;if(!ha(t)||(n=Qg(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Ta=$a(function(e){var t=Za.get,n=Za.enforce,r=String(String).split("String");(e.exports=function(e,t,i,o){var a=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable;if(o=!!o&&!!o.noTargetGet,"function"==typeof i){"string"!=typeof t||Q(i,"name")||Na(i,"name",t);var c=n(i);c.source||(c.source=r.join("string"==typeof t?t:""))}e===y?s?e[t]=i:Oi(t,i):(a?!o&&e[t]&&(s=!0):delete e[t],s?e[t]=i:Na(e,t,i))})(Function.prototype,"toString",function(){return"function"==typeof this&&t(this).source||Pi(this)})}),mn=function(e){return"function"==typeof e?e:void 0},mc=function(e,t){return 2>arguments.length?mn(y[e])||mn(y[e]):y[e]&&y[e][t]||y[e]&&y[e][t]},uu=Math.ceil,vu=Math.floor,$b=function(e){return isNaN(e=+e)?0:(0<e?vu:uu)(e)},wu=Math.min,ta=function(e){return 0<e?wu($b(e),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(e,t){return 0>(e=$b(e))?xu(e+t,0):yu(e,t)},nn=function(e){return function(t,n,r){t=qb(t);var i=ta(t.length);if(r=xb(r,i),e&&n!=n){for(;i>r;)if((n=t[r++])!=n)return!0}else for(;i>r;r++)if((e||r in t)&&t[r]===n)return e||r||0;return!e&&-1}},on=nn(!0),Si=nn(!1),pn=function(e,t){e=qb(e);var n,r=0,i=[];for(n in e)!Q(Be,n)&&Q(e,n)&&i.push(n);for(;t.length>r;)Q(e,n=t[r++])&&(~Si(i,n)||i.push(n));return i},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(e){return pn(e,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(e){var t=Hd.f(va(e)),n=Bf.f;return n?t.concat(n(e)):t},rn=function(e,t){for(var n=qn(t),r=Ra.f,i=Fb.f,o=0;o<n.length;o++){var a=n[o];Q(e,a)||r(e,a,i(t,a))}},Au=/#|\.prototype\./,nc=function(e,t){return(e=Bu[Cu(e)])==Du||e!=Eu&&("function"==typeof t?R(t):!!t)},Cu=nc.normalize=function(e){return String(e).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(e,t){var n,r,i,o=e.target,a=e.global,s=e.stat;if(r=a?y:s?y[o]||Oi(o,{}):(y[o]||{}).prototype)for(i in t){var c=t[i],u=e.noTargetGet?(n=Fu(r,i))&&n.value:r[i];if(!(n=nc(a?i:o+(s?".":"#")+i,e.forced))&&void 0!==u){if(typeof c==typeof u)continue;rn(c,u)}(e.sham||u&&u.sham)&&Na(c,"sham",!0);try{Ta(r,i,c,e)}catch(e){}}},yb=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Id=function(e,t,n){if(yb(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},gd=Array.isArray||function(e){return"Array"==Zb(e)},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R(function(){return!String(Symbol())||!Symbol.sham&&id&&41>id}),vn=oc&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(e){return Q(Cf,e)&&(oc||"string"==typeof Cf[e])||(Cf[e]=oc&&Q(Df,e)?Df[e]:Gu("Symbol."+e)),Cf[e]},Hu=qa("species"),Sg=function(e,t){if(gd(e)){var n=e.constructor;"function"!=typeof n||n!==Array&&!gd(n.prototype)?ha(n)&&null===(n=n[Hu])&&(n=void 0):n=void 0}return new(void 0===n?Array:n)(0===t?0:t)},wn=[].push,jd=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(c,u,l,d){var h=Qa(c),p=Af(h);u=Id(u,l,3),l=ta(p.length);var f,m=0;for(d=d||Sg,c=t?d(c,l):n||a?d(c,0):void 0;l>m;m++)if((s||m in p)&&(f=u(d=p[m],m,h),e))if(t)c[m]=f;else if(f)switch(e){case 3:return!0;case 5:return d;case 6:return m;case 2:wn.call(c,d)}else switch(e){case 4:return!1;case 7:wn.call(c,d)}return o?-1:r||i?i:c}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6),Ku=qa("species"),Ef=function(e){return 51<=id||!R(function(){var t=[];return(t.constructor={})[Ku]=function(){return{foo:1}},1!==t[e](Boolean).foo})},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(e){return yn(this,e,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(e){return pn(e,Rg)},Mu=R(function(){Dc(1)});N({target:"Object",stat:!0,forced:Mu},{keys:function(e){return Dc(Qa(e))}});var Ee=function(e,t){var n=[][e];return!!n&&R(function(){n.call(null,t||function(){throw 1},1)})},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(e){return Nu.call(qb(this),void 0===e?",":e)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(e){return xn(this,e,1<arguments.length?arguments[1]:void 0)}});var Ui=function(e){var t=e.return;if(void 0!==t)return va(t.call(e)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(e){return void 0!==e&&(Fe.Array===e||Su[Ru]===e)},Ge=function(e,t,n){(t=lc(t))in e?Ra.f(e,t,dd(0,n)):e[t]=n},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi="[object z]"===String(Bn),Uu=qa("toStringTag"),Vu="Arguments"==Zb(function(){return arguments}()),Ff=Wi?Zb:function(e){var t;if(void 0===e)var n="Undefined";else{if(null===e)var r="Null";else{e:{var i=e=Object(e);try{r=i[Uu];break e}catch(e){}r=void 0}r="string"==typeof(n=r)?n:Vu?Zb(e):"Object"==(t=Zb(e))&&"function"==typeof e.callee?"Arguments":t}n=r}return n},Wu=qa("iterator"),Xi=function(e){if(null!=e)return e[Wu]||e["@@iterator"]||Fe[Ff(e)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,function(){throw 2})}catch(c){}var Tg=function(e,t){if(!t&&!Dn)return!1;var n=!1;try{(t={})[Cn]=function(){return{next:function(){return{done:n=!0}}}},e(t)}catch(e){}return n},Yu=!Tg(function(e){Array.from(e)});N({target:"Array",stat:!0,forced:Yu},{from:function(e){var t,n=Qa(e),r="function"==typeof this?this:Array,i=arguments.length,o=1<i?arguments[1]:void 0,a=void 0!==o,s=Xi(n),c=0;if(a&&(o=Id(o,2<i?arguments[2]:void 0,2)),null==s||r==Array&&Vi(s)){var u=ta(n.length);for(r=new r(u);u>c;c++)s=a?o(n[c],c):n[c],Ge(r,c,s)}else for(i=(n=s.call(n)).next,r=new r;!(t=i.call(n)).done;c++){if(a){s=n;var l=o;t=[t.value,c];try{u=l(va(t)[0],t[1])}catch(e){throw Ui(s),e}}else u=t.value;Ge(r,c,s=u)}return r.length=c,r}});var Fn=function(e){return function(t,n){t=String(jb(t)),n=$b(n);var r,i=t.length;if(0>n||n>=i)return e?"":void 0;var o=t.charCodeAt(n);return 55296>o||56319<o||n+1===i||56320>(r=t.charCodeAt(n+1))||57343<r?e?t.charAt(n):o:e?t.slice(n,n+2):r-56320+(o-55296<<10)+65536}},Gn=Fn(!0),Hn=!R(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(e){return e=Qa(e),Q(e,In)?e[In]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(null==Kd||R(function(){var e={};return Kd[Yi].call(e)!==e}))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(e,t){va(e);for(var n,r=Dc(t),i=r.length,o=0;i>o;)Ra.f(e,n=r[o++],t[n]);return e},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch(e){}if(aj){var e=aj;e.write("<script><\/script>"),e.close(),e=e.parentWindow.Object}else(e=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),e=e.F;for(Wg=e,e=Rg.length;e--;)delete Wg.prototype[Rg[e]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(e,t){if(null!==e){$i.prototype=va(e);var n=new $i;$i.prototype=null,n[Mn]=e}else n=Wg();return void 0===t?n:av(n,t)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(e,t,n){e&&!Q(e=n?e:e.prototype,Nn)&&bv(e,Nn,{configurable:!0,value:t})},cv=function(){return this},dv=function(e,t,n){return t+=" Iterator",e.prototype=ac(Ug,{next:dd(1,n)}),Ec(e,t,!1),Fe[t]=cv,e},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,t={};try{var n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;n.call(t,[]),e=t instanceof Array}catch(e){}return function(t,r){if(va(t),!ha(r)&&null!==r)throw TypeError("Can't set "+String(r)+" as a prototype");return e?n.call(t,r):t.__proto__=r,t}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(e,t,n,r,i,o,a){dv(n,t,r),r=function(e){if(e===i&&h)return h;if(!Vg&&e in l)return l[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}};var s,c=t+" Iterator",u=!1,l=e.prototype,d=l[Gf]||l["@@iterator"]||i&&l[i],h=!Vg&&d||r(i),p="Array"==t&&l.entries||d;if(p&&(e=Vb(p.call(new e)),Ug!==Object.prototype&&e.next&&(Vb(e)!==Ug&&(Ua?Ua(e,Ug):"function"!=typeof e[Gf]&&Na(e,Gf,ev)),Ec(e,c,!0))),"values"==i&&d&&"values"!==d.name&&(u=!0,h=function(){return d.call(this)}),l[Gf]!==h&&Na(l,Gf,h),Fe[t]=h,i){var f={values:r("values"),keys:o?h:r("keys"),entries:r("entries")};if(a)for(s in f)!Vg&&!u&&s in l||Ta(l,s,f[s]);else N({target:t,proto:!0,forced:Vg||u},f)}return f},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",function(e){fv(this,{type:"String Iterator",string:String(e),index:0})},function(){var e=gv(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(t=Gn(t,n),e.index+=t.length,{value:t,done:!1})});var cj=qa("unscopables"),dj=Array.prototype;null==dj[cj]&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(e){dj[cj][e]=!0},On=!0;"find"in[]&&Array(1).find(function(){On=!1}),N({target:"Array",proto:!0,forced:On},{find:function(e){return zn(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(e){var t=String(jb(this)),n="";if(0>(e=$b(e))||1/0==e)throw RangeError("Wrong number of repetitions");for(;0<e;(e>>>=1)&&(t+=t))1&e&&(n+=t);return n};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(e,t,n){for(var r in t)Ta(e,r,t[r],n);return e},Qn=qa("species"),If=function(e){e=mc(e),ka&&e&&!e[Qn]&&(0,Ra.f)(e,Qn,{configurable:!0,get:function(){return this}})},Gc=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Jf=function(e,t){this.stopped=e,this.result=t},Xg=function(e,t,n){var r,i=!(!n||!n.AS_ENTRIES),o=!(!n||!n.IS_ITERATOR),a=!(!n||!n.INTERRUPTED),s=Id(t,n&&n.that,1+i+a),c=function(e){return u&&Ui(u),new Jf(!0,e)};if(t=function(e){return i?(va(e),a?s(e[0],e[1],c):s(e[0],e[1])):a?s(e,c):s(e)},o)var u=e;else{if("function"!=typeof(o=Xi(e)))throw TypeError("Target is not iterable");if(Vi(o)){for(o=0,n=ta(e.length);n>o;o++)if((r=t(e[o]))&&r instanceof Jf)return r;return new Jf(!1)}u=o.call(e)}for(e=u.next;!(o=e.call(u)).done;){try{r=t(o.value)}catch(e){throw Ui(u),e}if("object"==typeof r&&r&&r instanceof Jf)return r}return new Jf(!1)},iv=qa("species"),kd=function(e,t){var n;return void 0===(e=va(e).constructor)||null==(n=va(e)[iv])?t:yb(n)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc="process"==Zb(y.process),Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(e){if(Kf.hasOwnProperty(e)){var t=Kf[e];delete Kf[e],t()}},ij=function(e){return function(){hj(e)}},Un=function(e){hj(e.data)},Vn=function(e){y.postMessage(e+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Kf[++gj]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Lf(gj),gj},Sn=function(e){delete Kf[e]},Hc)var Lf=function(e){jv.nextTick(ij(e))};else if(fj&&fj.now)Lf=function(e){fj.now(ij(e))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&"function"==typeof postMessage&&!y.importScripts&&Yg&&"file:"!==Yg.protocol&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(e){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(e)}}:function(e){setTimeout(ij(e),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var e;for(Hc&&(e=$n.domain)&&e.exit();Md;){var t=Md.fn;Md=Md.next;try{t()}catch(e){throw Md?$g():Mf=void 0,e}}Mf=void 0,e&&e.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(e){e={fn:e,next:void 0},Mf&&(Mf.next=e),Md||(Md=e,$g()),Mf=e},nv=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=yb(t),this.reject=yb(n)},lj={f:function(e){return new nv(e)}},mj=function(e,t){return va(e),ha(t)&&t.constructor===e?t:((0,(e=lj.f(e)).resolve)(t),e.promise)},ov=function(e,t){var n=y.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},nj=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},pv="object"==typeof window,qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io="function"==typeof PromiseRejectionEvent,jo=!1,Nf=nc("Promise",function(){var e=Pi(zb)!==String(zb);if(!e&&66===id)return!0;if(51<=id&&/native code/.test(zb))return!1;var t=new zb(function(e){e(1)}),n=function(e){e(function(){},function(){})};return(t.constructor={})[qv]=n,!(jo=t.then(function(){})instanceof n)||!e&&pv&&!io}),vv=Nf||!Tg(function(e){zb.all(e).catch(function(){})}),ko=function(e){var t;return!(!ha(e)||"function"!=typeof(t=e.then))&&t},qj=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;fo(function(){for(var r=e.value,i=1==e.state,o=0;n.length>o;){var a,s=n[o++],c=i?s.ok:s.fail,u=s.resolve,l=s.reject,d=s.domain;try{if(c){if(i||(2===e.rejection&&wv(e),e.rejection=1),!0===c)var h=r;else if(d&&d.enter(),h=c(r),d){d.exit();var p=!0}h===s.promise?l(ho("Promise-chain cycle")):(a=ko(h))?a.call(h,u,l):u(h)}else l(r)}catch(e){d&&!p&&d.exit(),l(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&xv(e)})}},lo=function(e,t,n){var r;if(uv){var i=oj.createEvent("Event");i.promise=t,i.reason=n,i.initEvent(e,!1,!0),y.dispatchEvent(i)}else i={promise:t,reason:n};!io&&(r=y["on"+e])?r(i):"unhandledrejection"===e&&ov("Unhandled promise rejection",n)},xv=function(e){jj.call(y,function(){var t=e.facade,n=e.value;if(1!==e.rejection&&!e.parent){var r=nj(function(){Hc?pj.emit("unhandledRejection",n,t):lo("unhandledrejection",t,n)});if(e.rejection=Hc||1!==e.rejection&&!e.parent?2:1,r.error)throw r.value}})},wv=function(e){jj.call(y,function(){var t=e.facade;Hc?pj.emit("rejectionHandled",t):lo("rejectionhandled",t,e.value)})},Ie=function(e,t,n){return function(r){e(t,r,n)}},Je=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,qj(e,!0))},rj=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw ho("Promise can't be resolved itself");var r=ko(t);r?fo(function(){var n={done:!1};try{r.call(t,Ie(rj,n,e),Ie(Je,n,e))}catch(t){Je(n,t,e)}}):(e.value=t,e.state=1,qj(e,!1))}catch(t){Je({done:!1},t,e)}}};if(Nf){zb=function(e){Gc(this,zb,"Promise"),yb(e),sj.call(this);var t=go(this);try{e(Ie(rj,t),Ie(Je,t))}catch(e){Je(t,e)}},bh=zb.prototype;var sj=function(e){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(e,t){var n=sv(this),r=He(kd(this,zb));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Hc?pj.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&qj(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}});var yv=function(){var e=new sj,t=go(e);this.promise=e,this.resolve=Ie(rj,t),this.reject=Ie(Je,t)};if(lj.f=He=function(e){return e===zb||e===zv?new yv(e):tv(e)},"function"==typeof Fc&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",function(e,t){var n=this;return new zb(function(e,t){Av.call(n,e,t)}).then(e,t)},{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch(c){}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(e){var t=He(this);return t.reject.call(void 0,e),t.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(e){return mj(this,e)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(e){var t=this,n=He(t),r=n.resolve,i=n.reject,o=nj(function(){var n=yb(t.resolve),o=[],a=0,s=1;Xg(e,function(e){var c=a++,u=!1;o.push(void 0),s++,n.call(t,e).then(function(e){u||(u=!0,o[c]=e,--s||r(o))},i)}),--s||r(o)});return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=He(t),r=n.reject,i=nj(function(){var i=yb(t.resolve);Xg(e,function(e){i.call(t,e).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(e){return no?mo.apply(this,arguments)||0:Si(this,e,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var e=va(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},pc=R(function(){var e=RegExp("a","y");return e.lastIndex=2,null!=e.exec("abcd")}),Cv=R(function(){var e=RegExp("^r","gy");return e.lastIndex=2,null!=e.exec("str")}),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),0!==c.lastIndex||0!==a.lastIndex),po=pc||Cv,vj=void 0!==/()??/.exec("")[1],c,a;(uj||vj||po)&&(oo=function(e){var t,n=po&&this.sticky,r=tj.call(this),i=this.source,o=0,a=e;if(n){-1===(r=r.replace("y","")).indexOf("g")&&(r+="g"),a=String(e).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&"\n"!==e[this.lastIndex-1])&&(i="(?: "+i+")",a=" "+a,o++);var s=new RegExp("^(?:"+i+")",r)}if(vj&&(s=new RegExp("^"+i+"$(?!\\s)",r)),uj)var c=this.lastIndex;var u=ch.call(n?s:this,a);return n?u?(u.input=u.input.slice(o),u[0]=u[0].slice(o),u.index=this.lastIndex,this.lastIndex+=u[0].length):this.lastIndex=0:uj&&u&&(this.lastIndex=this.global?u.index+u[0].length:c),vj&&u&&1<u.length&&Dv.call(u[0],s,function(){for(t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(u[t]=void 0)}),u});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}),qo="$0"==="a".replace(/./,"$0"),ro=qa("replace"),so=!!/./[ro]&&""===/./[ro]("a","$0"),Gv=!R(function(){var e=/(?:)/,t=e.exec;return e.exec=function(){return t.apply(this,arguments)},2!==(e="ab".split(e)).length||"a"!==e[0]||"b"!==e[1]}),dh=function(e,t,n,r){var i=qa(e),o=!R(function(){var t={};return t[i]=function(){return 7},7!=""[e](t)}),a=o&&!R(function(){var t=!1,n=/a/;return"split"===e&&((n={constructor:{}}).constructor[Ev]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t});if(!o||!a||"replace"===e&&(!Fv||!qo||so)||"split"===e&&!Gv){var s=/./[i],c=(n=n(i,""[e],function(e,t,n,r,i){var a=t.exec;return a===Of||a===wj.exec?o&&!i?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}},{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,e,n[0]),Ta(wj,i,2==t?function(e,t){return c.call(e,this,t)}:function(e){return c.call(e,this)})}r&&Na(wj[i],"sham",!0)},xj=function(e,t,n){return t+(n?Gn(e,t).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(e,t,n,r,i,o){var a=n+e.length,s=r.length,c=Kv;return void 0!==i&&(i=Qa(i),c=Jv),Iv.call(o,c,function(o,c){switch(c.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(a);case"<":o=i[c.slice(1,-1)];break;default:var u=+c;if(0===u)return o;if(u>s)return 0===(u=Hv(u/10))?o:u<=s?void 0===r[u-1]?c.charAt(1):r[u-1]+c.charAt(1):o;o=r[u-1]}return void 0===o?"":o})},Ke=function(e,t){var n=e.exec;if("function"==typeof n){if("object"!=typeof(e=n.call(e,t)))throw TypeError("RegExp exec method returned something other than an Object or null");return e}if("RegExp"!==Zb(e))throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(e,t)},Mv=Math.max,Nv=Math.min,Ov=function(e){return void 0===e?e:String(e)};dh("replace",2,function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=r.REPLACE_KEEPS_$0,a=i?"$":"$0";return[function(n,r){var i=jb(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&o||"string"==typeof r&&-1===r.indexOf(a)){var s=n(t,e,this,r);if(s.done)return s.value}var c=va(e);e=String(this),(s="function"==typeof r)||(r=String(r));var u=c.global;if(u){var l=c.unicode;c.lastIndex=0}for(var d=[];;){var h=Ke(c,e);if(null===h)break;if(d.push(h),!u)break;""===String(h[0])&&(c.lastIndex=xj(e,ta(c.lastIndex),l))}for(l="",u=c=0;u<d.length;u++){h=d[u];for(var p=String(h[0]),f=Mv(Nv($b(h.index),e.length),0),m=[],g=1;g<h.length;g++)m.push(Ov(h[g]));h=h.groups,s?(m=[p].concat(m,f,e),void 0!==h&&m.push(h),h=String(r.apply(void 0,m))):h=Lv(p,e,f,m,h,r),f>=c&&(l+=e.slice(c,f)+h,c=f+p.length)}return l+e.slice(c)}]});var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(e,t){var n=qb(this),r=ta(n.length);if(e=xb(e,r),t=xb(void 0===t?r:t,r),gd(n)){var i=n.constructor;if("function"!=typeof i||i!==Array&&!gd(i.prototype)?ha(i)&&null===(i=i[Qv])&&(i=void 0):i=void 0,i===Array||void 0===i)return Rv.call(n,e,t)}for(i=new(void 0===i?Array:i)(Sv(t-e,0)),r=0;e<t;e++,r++)e in n&&Ge(i,r,n[e]);return i.length=r,i}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",function(e,t){Tv(this,{type:"Array Iterator",target:qb(e),index:0,kind:t})},function(){var e=Uv(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Le=function(e){if(void 0===e)return 0;e=$b(e);var t=ta(e);if(e!==t)throw RangeError("Wrong length or index");return t},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(e){var t=Qa(this),n=ta(t.length),r=arguments.length,i=xb(1<r?arguments[1]:void 0,n);for(n=void 0===(r=2<r?arguments[2]:void 0)?n:xb(r,n);n>i;)t[i++]=e;return t},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(e,t,n){var r,i=Array(n),o=(1<<(n=8*n-t-1))-1,a=o>>1,s=23===t?Ic(2,-24)-Ic(2,-77):0,c=0>e||0===e&&0>1/e?1:0,u=0;if((e=Vv(e))!=e||1/0===e){e=e!=e?1:0;var l=o}else l=Wv(Xv(e)/Yv),1>e*(r=Ic(2,-l))&&(l--,r*=2),2<=(e=1<=l+a?e+s/r:e+s*Ic(2,1-a))*r&&(l++,r/=2),l+a>=o?(e=0,l=o):1<=l+a?(e=(e*r-1)*Ic(2,t),l+=a):(e=e*Ic(2,a-1)*Ic(2,t),l=0);for(;8<=t;i[u++]=255&e,e/=256,t-=8);for(l=l<<t|e,n+=t;0<n;i[u++]=255&l,l/=256,n-=8);return i[--u]|=128*c,i},xo=function(e,t){var n=e.length,r=8*n-t-1,i=(1<<r)-1,o=i>>1;r-=7,--n;var a=e[n--],s=127&a;for(a>>=7;0<r;s=256*s+e[n],n--,r-=8);var c=s&(1<<-r)-1;for(s>>=-r,r+=t;0<r;c=256*c+e[n],n--,r-=8);if(0===s)s=1-o;else{if(s===i)return c?NaN:a?-1/0:1/0;c+=Ic(2,t),s-=o}return(a?-1:1)*c*Ic(2,s-t)},yo=function(e){return[255&e]},zo=function(e){return[255&e,e>>8&255]},Ao=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Bo=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},aw=function(e){return wo(e,23,4)},bw=function(e){return wo(e,52,8)},gh=function(e,t){$v(e.prototype,t,{get:function(){return Me(this)[t]}})},md=function(e,t,n,r){n=Le(n);var i=Me(e);if(n+t>i.byteLength)throw fh("Wrong index");return t=(e=Me(i.buffer).bytes).slice(n+=i.byteOffset,n+t),r?t:t.reverse()},nd=function(e,t,n,r,i,o){n=Le(n);var a=Me(e);if(n+t>a.byteLength)throw fh("Wrong index");for(e=Me(a.buffer).bytes,n+=a.byteOffset,r=r(+i),i=0;i<t;i++)e[n+i]=r[o?i:t-i-1]};if(to){if(!R(function(){bc(1)})||!R(function(){new bc(-1)})||R(function(){return new bc,new bc(1.5),new bc(NaN),"ArrayBuffer"!=bc.name})){Ab=function(e){return Gc(this,Ab),new bc(Le(e))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(e,t){Eo.call(this,e,t<<24>>24)},setUint8:function(e,t){Eo.call(this,e,t<<24>>24)}},{unsafe:!0})}else Ab=function(e){Gc(this,Ab,"ArrayBuffer"),e=Le(e),uo(this,{bytes:yj.call(Array(e),0),byteLength:e}),ka||(this.byteLength=e)},cc=function(e,t,n){Gc(this,cc,"DataView"),Gc(e,Ab,"DataView");var r=Me(e).byteLength;if(0>(t=$b(t))||t>r)throw fh("Wrong offset");if(t+(n=void 0===n?r-t:ta(n))>r)throw fh("Wrong length");uo(this,{buffer:e,byteLength:n,byteOffset:t}),ka||(this.buffer=e,this.byteLength=n,this.byteOffset=t)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(e){return md(this,1,e)[0]<<24>>24},getUint8:function(e){return md(this,1,e)[0]},getInt16:function(e){var t=md(this,2,e,1<arguments.length?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=md(this,2,e,1<arguments.length?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return xo(md(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return xo(md(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,t){nd(this,1,e,yo,t)},setUint8:function(e,t){nd(this,1,e,yo,t)},setInt16:function(e,t){nd(this,2,e,zo,t,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,t){nd(this,2,e,zo,t,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,t){nd(this,4,e,Ao,t,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,t){nd(this,4,e,Ao,t,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,t){nd(this,4,e,aw,t,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,t){nd(this,8,e,bw,t,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R(function(){return!new Aj(2).slice(1,void 0).byteLength});N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(e,t){if(void 0!==Go&&void 0===t)return Go.call(va(this),e);var n=va(this).byteLength;e=xb(e,n),t=xb(void 0===t?n:t,n),n=new(kd(this,Aj))(ta(t-e));for(var r=new Fo(this),i=new Fo(n),o=0;e<t;)i.setUint8(o++,r.getUint8(e++));return n}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&"Opera"!==Ff(y.opera),Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(e){return!!ha(e)&&(e=Ff(e),Q(rc,e)||Q(fw,e))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||"function"!=typeof qc||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(e){if(jh(e))return e;throw TypeError("Target is not a typed array")},Ne=function(e){if(Ua){if(Ko.call(qc,e))return e}else for(var t in rc)if(Q(rc,Bb)){var n=y[t];if(n&&(e===n||Ko.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},Aa=function(e,t,n){if(ka){if(n)for(var r in rc){var i=y[r];if(i&&Q(i.prototype,e))try{delete i.prototype[e]}catch(e){}}dc[e]&&!n||Ta(dc,e,n?t:Jc&&Bj[e]||t)}},Oo=function(e,t,n){var r,i;if(ka){if(Ua){if(n)for(r in rc)if((i=y[r])&&Q(i,e))try{delete i[e]}catch(e){}if(qc[e]&&!n)return;try{return Ta(qc,e,n?t:Jc&&qc[e]||t)}catch(e){}}for(r in rc)!(i=y[r])||i[e]&&!n||Ta(i,e,t)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R(function(){Od(1)})||!R(function(){new Od(-1)})||!Tg(function(e){new Od,new Od(null),new Od(1.5),new Od(e)},!0)||R(function(){return 1!==new Od(new gw(2),1,void 0).length}),kh=function(e,t){if(0>(e=$b(e)))throw RangeError("The argument can't be less than 0");if(e%t)throw RangeError("Wrong offset");return e},Ej=function(e){var t=Qa(e),n=arguments.length,r=1<n?arguments[1]:void 0,i=void 0!==r,o=Xi(t);if(null!=o&&!Vi(o)){var a=o.call(t),s=a.next;for(t=[];!(o=s.call(a)).done;)t.push(o.value)}for(i&&2<n&&(r=Id(r,arguments[2],2)),o=ta(t.length),a=new(Ne(this))(o),n=0;o>n;n++)a[n]=i?r(t[n],n):t[n];return a},lh=function(e,t,n){var r,i;return Ua&&"function"==typeof(r=t.constructor)&&r!==n&&ha(i=r.prototype)&&i!==n.prototype&&Ua(e,i),e},Sf=$a(function(e){var t=Hd.f,n=Za.get,r=Za.set,i=Ra.f,o=Fb.f,a=Math.round,s=y.RangeError,c=Pf.ArrayBuffer,u=Pf.DataView,l=function(e,t){var n=0,r=t.length;for(e=new(Ne(e))(r);r>n;)e[n]=t[n++];return e},d=function(e,t){i(e,t,{get:function(){return n(this)[t]}})},h=function(e){var t;return e instanceof c||"ArrayBuffer"==(t=Ff(e))||"SharedArrayBuffer"==t},p=function(e,t){return jh(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},f=function(e,t){return p(e,t=lc(t,!0))?dd(2,e[t]):o(e,t)},m=function(e,t,n){return!(p(e,t=lc(t,!0))&&ha(n)&&Q(n,"value"))||Q(n,"get")||Q(n,"set")||n.configurable||Q(n,"writable")&&!n.writable||Q(n,"enumerable")&&!n.enumerable?i(e,t,n):(e[t]=n.value,e)};ka?(Qf||(Fb.f=f,Ra.f=m,d(Rf,"buffer"),d(Rf,"byteOffset"),d(Rf,"byteLength"),d(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:f,defineProperty:m}),e.exports=function(e,o,d){var p=e.match(/\d+$/)[0]/8,f=e+(d?"Clamped":"")+"Array",m="get"+e,g="set"+e,v=y[f],E=v;e=E&&E.prototype;var _={},b=function(e,t){i(e,t,{get:function(){var e=n(this);return e.view[m](t*p+e.byteOffset,!0)},set:function(e){var r=n(this);d&&(e=0>(e=a(e))?0:255<e?255:255&e),r.view[g](t*p+r.byteOffset,e,!0)},enumerable:!0})};Qf?Dj&&(E=o(function(e,t,n,r){return Gc(e,E,f),lh(ha(t)?h(t)?void 0!==r?new v(t,kh(n,p),r):void 0!==n?new v(t,kh(n,p)):new v(t):jh(t)?l(E,t):Ej.call(E,t):new v(Le(t)),e,E)}),Ua&&Ua(E,Po),Jd(t(v),function(e){e in E||Na(E,e,v[e])}),E.prototype=e):(E=o(function(e,t,n,i){Gc(e,E,f);var o=0,a=0;if(ha(t)){if(!h(t))return jh(t)?l(E,t):Ej.call(E,t);var d=t;if(a=kh(n,p),t=t.byteLength,void 0===i){if(t%p)throw s("Wrong length");if(0>(i=t-a))throw s("Wrong length")}else if((i=ta(i)*p)+a>t)throw s("Wrong length");t=i/p}else t=Le(t),d=new c(i=t*p);for(r(e,{buffer:d,byteOffset:a,byteLength:i,length:t,view:new u(d)});o<t;)b(e,o++)}),Ua&&Ua(E,Po),e=E.prototype=ac(Rf)),e.constructor!==E&&Na(e,"constructor",E),No&&Na(e,No,f),_[f]=E,N({global:!0,forced:E!=v,sham:!Qf},_),"BYTES_PER_ELEMENT"in E||Na(E,"BYTES_PER_ELEMENT",p),"BYTES_PER_ELEMENT"in e||Na(e,"BYTES_PER_ELEMENT",p),If(f)}):e.exports=function(){}});Sf("Uint8",function(e){return function(t,n,r){return e(this,t,n,r)}});var hw=Math.min,iw=[].copyWithin||function(e,t){var n=Qa(this),r=ta(n.length),i=xb(e,r),o=xb(t,r),a=2<arguments.length?arguments[2]:void 0;for(r=hw((void 0===a?r:xb(a,r))-o,r-i),a=1,o<i&&i<o+r&&(a=-1,o+=r-1,i+=r-1);0<r--;)o in n?n[i]=n[o]:delete n[i],i+=a,o+=a;return n};Aa("copyWithin",function(e,t){return iw.call(Da(this),e,t,2<arguments.length?arguments[2]:void 0)}),Aa("every",function(e){return Ju(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("fill",function(e){return yj.apply(Da(this),arguments)}),Aa("filter",function(e){var t=yn(Da(this),e,1<arguments.length?arguments[1]:void 0),n=kd(this,this.constructor),r=0,i=t.length;for(n=new(Ne(n))(i);i>r;)n[r]=t[r++];return n}),Aa("find",function(e){return zn(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("findIndex",function(e){return An(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("forEach",function(e){Jd(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("includes",function(e){return on(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("indexOf",function(e){return Si(Da(this),e,1<arguments.length?arguments[1]:void 0)});var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&("values"==Fj.name||null==Fj.name),To=function(){return jw.call(Da(this))};Aa("entries",function(){return lw.call(Da(this))}),Aa("keys",function(){return kw.call(Da(this))}),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",function(e){return mw.apply(Da(this),arguments)});var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(e){if(Uo)return Gj.apply(this,arguments)||0;var t=qb(this),n=ta(t.length),r=n-1;for(1<arguments.length&&(r=nw(r,$b(arguments[1]))),0>r&&(r=n+r);0<=r;r--)if(r in t&&t[r]===e)return r||0;return-1}:Gj;Aa("lastIndexOf",function(e){return pw.apply(Da(this),arguments)}),Aa("map",function(e){return xn(Da(this),e,1<arguments.length?arguments[1]:void 0,function(e,t){return new(Ne(kd(e,e.constructor)))(t)})});var Vo=function(e){return function(t,n,r,i){yb(n),t=Qa(t);var o=Af(t),a=ta(t.length),s=e?a-1:0,c=e?-1:1;if(2>r)for(;;){if(s in o){i=o[s],s+=c;break}if(s+=c,e?0>s:a<=s)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=s:a>s;s+=c)s in o&&(i=n(i,o[s],s,t));return i}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",function(e){return Wo(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)}),Aa("reduceRight",function(e){return qw(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)});var rw=Math.floor;Aa("reverse",function(){for(var e,t=Da(this).length,n=rw(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this});var sw=R(function(){new Int8Array(1).set({})});Aa("set",function(e){Da(this);var t=kh(1<arguments.length?arguments[1]:void 0,1),n=this.length,r=Qa(e),i=ta(r.length),o=0;if(i+t>n)throw RangeError("Wrong length");for(;o<i;)this[t+o]=r[o++]},sw);var tw=[].slice,uw=R(function(){new Int8Array(1).slice()});Aa("slice",function(e,t){e=tw.call(Da(this),e,t);var n=kd(this,this.constructor);t=0;var r=e.length;for(n=new(Ne(n))(r);r>t;)n[t]=e[t++];return n},uw),Aa("some",function(e){return Iu(Da(this),e,1<arguments.length?arguments[1]:void 0)});var vw=[].sort;Aa("sort",function(e){return vw.call(Da(this),e)}),Aa("subarray",function(e,t){var n=Da(this),r=n.length;return e=xb(e,r),new(kd(n,n.constructor))(n.buffer,n.byteOffset+e*n.BYTES_PER_ELEMENT,ta((void 0===t?r:xb(t,r))-e))});var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R(function(){Xo.call(new mh(1))}),yw=R(function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()})||!R(function(){mh.prototype.toLocaleString.call([1,2])});Aa("toLocaleString",function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)},yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R(function(){nh.call({})})&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch(e){return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R(function(){return"/a/b"!=ap.call({source:"a",flags:"b"})}),Fw="toString"!=ap.name;(Ew||Fw)&&Ta(RegExp.prototype,"toString",function(){var e=va(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in $o)?tj.call(e):n)},{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(e,t){var n,r,i=Qa(this),o=ta(i.length),a=xb(e,o),s=arguments.length;if(0===s?s=n=0:1===s?(s=0,n=o-a):(s-=2,n=Iw(Hw($b(t),0),o-a)),9007199254740991<o+s-n)throw TypeError("Maximum allowed length exceeded");var c=Sg(i,n);for(r=0;r<n;r++){var u=a+r;u in i&&Ge(c,r,i[u])}if(c.length=n,s<n){for(r=a;r<o-n;r++){var l=r+s;(u=r+n)in i?i[l]=i[u]:delete i[l]}for(r=o;r>o-n+s;r--)delete i[r-1]}else if(s>n)for(r=o-n;r>a;r--)l=r+s-1,(u=r+n-1)in i?i[l]=i[u]:delete i[l];for(r=0;r<s;r++)i[r+a]=arguments[r+2];return i.length=o-n+s,c}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch(c){Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh])for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch(c){Kc[Oe]=ld[Oe]}}}var dp=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};dh("search",1,function(e,t,n){return[function(t){var n=jb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;e=va(e);var i=String(this);return dp(r=e.lastIndex,0)||(e.lastIndex=0),i=Ke(e,i),dp(e.lastIndex,r)||(e.lastIndex=r),null===i?-1:i.index}]}),$a(function(e){!function(t,n){e.exports?e.exports=n(t):n(t)}("undefined"!=typeof self?self:Ya,function(e){function t(e){return btoa(e).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(e){return e=(e+="===").slice(0,-e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))}function r(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function i(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),String.fromCharCode.apply(String,e)}function o(e){var t={name:(e.name||e||"").toUpperCase().replace("V","v")};switch(t.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":e.length&&(t.length=e.length);break;case"HMAC":e.hash&&(t.hash=o(e.hash)),e.length&&(t.length=e.length);break;case"RSAES-PKCS1-v1_5":e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":e.hash&&(t.hash=o(e.hash)),e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return t}function a(e){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[e.name][(e.hash||{}).name||e.length||""]}function s(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&(e=JSON.parse(decodeURIComponent(escape(i(e)))));var t={kty:e.kty,alg:e.alg,ext:e.ext||e.extractable};switch(t.kty){case"oct":t.k=e.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(n){n in e&&(t[n]=e[n])});break;default:throw new TypeError("Unsupported key type")}return t}function c(e){var n=u(e),r=!1;if("1.2.840.113549.1.1.1"!==(2<n.length&&(r=!0,n.shift()),e={ext:!0},n[0][0]))throw new TypeError("Unsupported key type");var o="n e d p q dp dq qi".split(" ");for(n=u(n[1]),r&&n.shift(),r=0;r<n.length;r++)n[r][0]||(n[r]=n[r].subarray(1)),e[o[r]]=t(i(n[r]));return e.kty="RSA",e}function u(e,t){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t||(t={pos:0,end:e.length}),2>t.end-t.pos||t.end>e.length)throw new RangeError("Malformed DER");var n=e[t.pos++],r=e[t.pos++];if(128<=r){if(t.end-t.pos<(r&=127))throw new RangeError("Malformed DER");for(var o=0;r--;)o<<=8,o|=e[t.pos++];r=o}if(t.end-t.pos<r)throw new RangeError("Malformed DER");switch(n){case 2:n=e.subarray(t.pos,t.pos+=r);break;case 3:if(e[t.pos++])throw Error("Unsupported bit string");r--;case 4:n=new Uint8Array(e.subarray(t.pos,t.pos+=r)).buffer;break;case 5:n=null;break;case 6:if(!((e=btoa(i(e.subarray(t.pos,t.pos+=r))))in b))throw Error("Unsupported OBJECT ID "+e);n=b[e];break;case 48:for(n=[],r=t.pos+r;t.pos<r;)n.push(u(e,t));break;default:throw Error("Unsupported DER tag 0x"+n.toString(16))}return n}function l(e,t){t||(t=[]);var n=t.length+2;if(t.push(0,0),e instanceof Uint8Array)for(var i=2,o=e.length,a=0;a<o;a++)t.push(e[a]);else if(e instanceof ArrayBuffer)for(i=4,o=e.byteLength,e=new Uint8Array(e),a=0;a<o;a++)t.push(e[a]);else if(null===e)i=5,o=0;else if("string"==typeof e&&e in S)for(i=6,o=(e=r(atob(S[e]))).length,a=0;a<o;a++)t.push(e[a]);else if(e instanceof Array){for(a=0;a<e.length;a++)l(e[a],t);i=48,o=t.length-n}else{if(!("object"===X(e)&&3===e.tag&&e.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+e);for(i=3,o=(e=new Uint8Array(e.value)).byteLength,t.push(0),a=0;a<o;a++)t.push(e[a]);o++}if(128<=o){for(a=o,o=4,t.splice(n,0,a>>24&255,a>>16&255,a>>8&255,255&a);1<o&&!(a>>24);)a<<=8,o--;4>o&&t.splice(n,4-o),o|=128}return t.splice(n-2,2,i,o),t}function d(e,t,n,r){Object.defineProperties(this,{_key:{value:e},type:{value:e.type,enumerable:!0},extractable:{value:void 0===n?e.extractable:n,enumerable:!0},algorithm:{value:void 0===t?e.algorithm:t,enumerable:!0},usages:{value:void 0===r?e.usages:r,enumerable:!0}})}function h(e){return"verify"===e||"encrypt"===e||"wrapKey"===e}function p(e){return"sign"===e||"decrypt"===e||"unwrapKey"===e}if("function"!=typeof Promise)throw"Promise support required";var f=e.crypto||e.msCrypto;if(f){var m=f.subtle||f.webkitSubtle;if(m){var g=e.Crypto||f.constructor||Object,v=e.SubtleCrypto||m.constructor||Object,E=-1<e.navigator.userAgent.indexOf("Edge/"),y=!!e.msCrypto&&!E,_=!f.subtle&&!!f.webkitSubtle;if(y||_){var b={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},S={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(e){var t=m[e];m[e]=function(i,u,l){var g=[].slice.call(arguments);switch(e){case"generateKey":var v=o(i),E=u,b=l;break;case"importKey":v=o(l),E=g[3],b=g[4],"jwk"===i&&((u=s(u)).alg||(u.alg=a(v)),u.key_ops||(u.key_ops="oct"!==u.kty?b.filter("d"in u?p:h):b.slice()),g[1]=function(e){return e=s(e),y&&(e.extractable=e.ext,delete e.ext),r(unescape(encodeURIComponent(JSON.stringify(e)))).buffer}(u));break;case"unwrapKey":v=g[4],E=g[5],b=g[6],g[2]=l._key}if("generateKey"===e&&"HMAC"===v.name&&v.hash)return v.length=v.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[v.hash.name],m.importKey("raw",f.getRandomValues(new Uint8Array(v.length+7>>3)),v,E,b);if(_&&"generateKey"===e&&"RSASSA-PKCS1-v1_5"===v.name&&(!v.modulusLength||2048<=v.modulusLength))return(i=o(i)).name="RSAES-PKCS1-v1_5",delete i.hash,m.generateKey(i,!0,["encrypt","decrypt"]).then(function(e){return Promise.all([m.exportKey("jwk",e.publicKey),m.exportKey("jwk",e.privateKey)])}).then(function(e){return e[0].alg=e[1].alg=a(v),e[0].key_ops=b.filter(h),e[1].key_ops=b.filter(p),Promise.all([m.importKey("jwk",e[0],v,!0,e[0].key_ops),m.importKey("jwk",e[1],v,E,e[1].key_ops)])}).then(function(e){return{publicKey:e[0],privateKey:e[1]}});if((_||y&&"SHA-1"===(v.hash||{}).name)&&"importKey"===e&&"jwk"===i&&"HMAC"===v.name&&"oct"===u.kty)return m.importKey("raw",r(n(u.k)),l,g[3],g[4]);if(_&&"importKey"===e&&("spki"===i||"pkcs8"===i))return m.importKey("jwk",c(u),l,g[3],g[4]);if(y&&"unwrapKey"===e)return m.decrypt(g[3],l,u).then(function(e){return m.importKey(i,e,g[4],g[5],g[6])});try{var S=t.apply(m,g)}catch(e){return Promise.reject(e)}return y&&(S=new Promise(function(e,t){S.onabort=S.onerror=function(e){t(e)},S.oncomplete=function(t){e(t.target.result)}})),S=S.then(function(e){return"HMAC"!==v.name||v.length||(v.length=8*e.algorithm.length),0==v.name.search("RSA")&&(v.modulusLength||(v.modulusLength=(e.publicKey||e).algorithm.modulusLength),v.publicExponent||(v.publicExponent=(e.publicKey||e).algorithm.publicExponent)),e.publicKey&&e.privateKey?{publicKey:new d(e.publicKey,v,E,b.filter(h)),privateKey:new d(e.privateKey,v,E,b.filter(p))}:new d(e,v,E,b)})}}),["exportKey","wrapKey"].forEach(function(e){var o=m[e];m[e]=function(c,u,d){var f=[].slice.call(arguments);switch(e){case"exportKey":f[1]=u._key;break;case"wrapKey":f[1]=u._key,f[2]=d._key}if((_||y&&"SHA-1"===(u.algorithm.hash||{}).name)&&"exportKey"===e&&"jwk"===c&&"HMAC"===u.algorithm.name&&(f[0]="raw"),!_||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(f[0]="jwk"),y&&"wrapKey"===e)return m.exportKey(c,u).then(function(e){return"jwk"===c&&(e=r(unescape(encodeURIComponent(JSON.stringify(s(e)))))),m.encrypt(f[3],d,e)});try{var g=o.apply(m,f)}catch(e){return Promise.reject(e)}return y&&(g=new Promise(function(e,t){g.onabort=g.onerror=function(e){t(e)},g.oncomplete=function(t){e(t.target.result)}})),"exportKey"===e&&"jwk"===c&&(g=g.then(function(e){return(_||y&&"SHA-1"===(u.algorithm.hash||{}).name)&&"HMAC"===u.algorithm.name?{kty:"oct",alg:a(u.algorithm),key_ops:u.usages.slice(),ext:!0,k:t(i(e))}:((e=s(e)).alg||(e.alg=a(u.algorithm)),e.key_ops||(e.key_ops="public"===u.type?u.usages.filter(h):"private"===u.type?u.usages.filter(p):u.usages.slice()),e)})),!_||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(g=g.then(function(e){var t=[["",null]],i=!1;if("RSA"!==(e=s(e)).kty)throw new TypeError("Unsupported key type");for(var o="n e d p q dp dq qi".split(" "),a=[],c=0;c<o.length&&o[c]in e;c++){var u=a[c]=r(n(e[o[c]]));128&u[0]&&(a[c]=new Uint8Array(u.length+1),a[c].set(u,1))}return 2<a.length&&(i=!0,a.unshift(new Uint8Array([0]))),t[0][0]="1.2.840.113549.1.1.1",t.push(new Uint8Array(l(a)).buffer),i?t.unshift(new Uint8Array([0])):t[1]={tag:3,value:t[1]},new Uint8Array(l(t)).buffer})),g}}),["encrypt","decrypt","sign","verify"].forEach(function(e){var t=m[e];m[e]=function(n,r,i,a){if(y&&(!i.byteLength||a&&!a.byteLength))throw Error("Empty input is not allowed");var s=[].slice.call(arguments),c=o(n);if(!y||"sign"!==e&&"verify"!==e||"RSASSA-PKCS1-v1_5"!==n&&"HMAC"!==n||(s[0]={name:n}),y&&r.algorithm.hash&&(s[0].hash=s[0].hash||r.algorithm.hash),y&&"decrypt"===e&&"AES-GCM"===c.name){var u=n.tagLength>>3;s[2]=(i.buffer||i).slice(0,i.byteLength-u),n.tag=(i.buffer||i).slice(i.byteLength-u)}y&&"AES-GCM"===c.name&&void 0===s[0].tagLength&&(s[0].tagLength=128),s[1]=r._key;try{var l=t.apply(m,s)}catch(e){return Promise.reject(e)}return y&&(l=new Promise(function(t,n){l.onabort=l.onerror=function(e){n(e)},l.oncomplete=function(n){if(n=n.target.result,"encrypt"===e&&n instanceof AesGcmEncryptResult){var r=n.ciphertext,i=n.tag;(n=new Uint8Array(r.byteLength+i.byteLength)).set(new Uint8Array(r),0),n.set(new Uint8Array(i),r.byteLength),n=n.buffer}t(n)}})),l}}),y){var w=m.digest;m.digest=function(e,t){if(!t.byteLength)throw Error("Empty input is not allowed");try{var n=w.call(m,e,t)}catch(e){return Promise.reject(e)}return n=new Promise(function(e,t){n.onabort=n.onerror=function(e){t(e)},n.oncomplete=function(t){e(t.target.result)}})},e.crypto=Object.create(f,{getRandomValues:{value:function(e){return f.getRandomValues(e)}},subtle:{value:m}}),e.CryptoKey=d}_&&(f.subtle=m,e.Crypto=g,e.SubtleCrypto=v,e.CryptoKey=d)}}}})});var Jw=qa("match"),Lj=function(e){var t;return ha(e)&&(void 0!==(t=e[Jw])?!!t:"RegExp"==Zb(e))},Kw=[].push,Lw=Math.min;dh("split",2,function(e,t,n){var r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(e,n){var r=String(jb(this));if(0==(n=void 0===n?4294967295:n>>>0))return[];if(void 0===e)return[r];if(!Lj(e))return t.call(r,e,n);var i,o,a,s=[],c=0;for(e=new RegExp(e.source,(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":"")+"g");(i=Of.call(e,r))&&!((o=e.lastIndex)>c&&(s.push(r.slice(c,i.index)),1<i.length&&i.index<r.length&&Kw.apply(s,i.slice(1)),a=i[0].length,c=o,s.length>=n));)e.lastIndex===i.index&&e.lastIndex++;return c===r.length?(a||!e.test(""))&&s.push(""):s.push(r.slice(c)),s.length>n?s.slice(0,n):s}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t;return[function(t,n){var i=jb(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var a=va(e);e=String(this);var s=kd(a,RegExp);if(o=a.unicode,a=new s(pc?"^(?:"+a.source+")":a,(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(pc?"g":"y")),0==(i=void 0===i?4294967295:i>>>0))return[];if(0===e.length)return null===Ke(a,e)?[e]:[];var c=0,u=0;for(s=[];u<e.length;){a.lastIndex=pc?0:u;var l,d=Ke(a,pc?e.slice(u):e);if(null===d||(l=Lw(ta(a.lastIndex+(pc?u:0)),e.length))===c)u=xj(e,u,o);else{if(s.push(e.slice(c,u)),s.length===i)return s;for(c=1;c<=d.length-1;c++)if(s.push(d[c]),s.length===i)return s;u=c=l}}return s.push(e.slice(c)),s}]},pc),function(e){e.console||(e.console={}),e=e.console;for(var t,n=function(){},r=["memory"],i="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");t=r.pop();)e[t]||(e[t]={});for(;t=i.pop();)e[t]||(e[t]=n)}("undefined"==typeof window?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R(function(){Vb(1)});N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(e){return Vb(Qa(e))}});var ep=[].slice,Mj={},Nw=Function.bind||function(e){var t=yb(this),n=ep.call(arguments,1),r=function(){var i=n.concat(ep.call(arguments));if(this instanceof r){var o=i.length;if(!(o in Mj)){for(var a=[],s=0;s<o;s++)a[s]="a["+s+"]";Mj[o]=Function("C,a","return new C("+a.join(",")+")")}i=Mj[o](t,i)}else i=t.apply(e,i);return i};return ha(t.prototype)&&(r.prototype=t.prototype),r},Nj=mc("Reflect","construct"),fp=R(function(){function e(){}return!(Nj(function(){},[],e)instanceof e)}),gp=!R(function(){Nj(function(){})}),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(e,t){yb(e),va(t);var n=3>arguments.length?e:yb(arguments[2]);if(gp&&!fp)return Nj(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}return(n=[null]).push.apply(n,t),new(Nw.apply(e,n))}n=ac(ha(n=n.prototype)?n:Object.prototype);var r=Function.apply.call(e,n,t);return ha(r)?r:n}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R(function(){ip(1)});N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(e,t){return ip(qb(e),t)}});var jp=Hd.f,Pw={}.toString,kp="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(e){if(kp&&"[object Window]"==Pw.call(e))try{var t=jp(e)}catch(e){t=kp.slice()}else t=jp(qb(e));return t},lp={f:qa},Qw=Ra.f,ph=function(e){var t=y.Symbol||(y.Symbol={});Q(t,e)||Qw(t,e,{value:lp.f(e)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R(function(){return 7!=ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=op(Ob,t);r&&delete Ob[t],od(e,t,n),r&&e!==Ob&&od(Ob,t,r)}:od,Uj=function(e,t){var n=Lc[e]=ac(sb.prototype);return Rw(n,{type:"Symbol",tag:e,description:t}),ka||(n.description=t),n},Vj=vn?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof sb},qh=function(e,t,n){return e===Ob&&qh(Uf,t,n),va(e),t=lc(t,!0),va(n),Q(Lc,t)?(n.enumerable?(Q(e,rb)&&e[rb][t]&&(e[rb][t]=!1),n=ac(n,{enumerable:dd(0,!1)})):(Q(e,rb)||od(e,rb,dd(1,{})),e[rb][t]=!0),Tj(e,t,n)):od(e,t,n)},qp=function(e,t){va(e);var n=qb(t);return t=Dc(n).concat(Wj(n)),Jd(t,function(t){ka&&!Xj.call(n,t)||qh(e,t,n[t])}),e},Xj=function(e){e=lc(e,!0);var t=Sw.call(this,e);return!(this===Ob&&Q(Lc,e)&&!Q(Uf,e))&&(!(t||!Q(this,e)||!Q(Lc,e)||Q(this,rb)&&this[rb][e])||t)},rp=function(e,t){if(e=qb(e),t=lc(t,!0),e!==Ob||!Q(Lc,t)||Q(Uf,t)){var n=op(e,t);return!n||!Q(Lc,t)||Q(e,rb)&&e[rb][t]||(n.enumerable=!0),n}},sp=function(e){e=pp(qb(e));var t=[];return Jd(e,function(e){Q(Lc,e)||Q(Be,e)||t.push(e)}),t},Wj=function(e){var t=e===Ob;e=pp(t?Uf:qb(e));var n=[];return Jd(e,function(e){!Q(Lc,e)||t&&!Q(Ob,e)||n.push(Lc[e])}),n};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=Ae(e),n=function(e){this===Ob&&n.call(Uf,e),Q(this,rb)&&Q(this[rb],t)&&(this[rb][t]=!1),Tj(this,t,dd(1,e))};return ka&&Sj&&Tj(Ob,t,{configurable:!0,set:n}),Uj(t,e)},Ta(sb.prototype,"toString",function(){return np(this).tag}),Ta(sb,"withoutSetter",function(e){return Uj(Ae(e),e)}),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(e){return Uj(qa(e),e)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),function(e){ph(e)}),N({target:"Symbol",stat:!0,forced:!oc},{for:function(e){if(e=String(e),Q(Pj,e))return Pj[e];var t=sb(e);return Pj[e]=t,Qj[t]=e,t},keyFor:function(e){if(!Vj(e))throw TypeError(e+" is not a symbol");if(Q(Qj,e))return Qj[e]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(e,t){return void 0===t?ac(e):qp(ac(e),t)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R(function(){Bf.f(1)})},{getOwnPropertySymbols:function(e){return Bf.f(Qa(e))}}),Tf){var Uw=!oc||R(function(){var e=sb();return"[null]"!=Tf([e])||"{}"!=Tf({a:e})||"{}"!=Tf(Object(e))});N({target:"JSON",stat:!0,forced:Uw},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(ha(t)||void 0!==e)&&!Vj(e))return gd(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Vj(t))return t}),i[1]=t,Tf.apply(null,i)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&"function"==typeof Mc&&(!("description"in Mc.prototype)||void 0!==Mc().description)){var tp={},Vf=function(){var e=1>arguments.length||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Vf?new Mc(e):void 0===e?Mc():Mc(e);return""===e&&(tp[t]=!0),t};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw="Symbol(test)"==String(Mc("test")),Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var e=ha(this)?this.valueOf():this,t=Ww.call(e);return Q(tp,e)?"":""===(e=Xw?t.slice(7,-1):t.replace(Yw,"$1"))?void 0:e}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=i(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}var c=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n(t,[{key:"addEventListener",value:function(e,t,n){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:n})}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=0,r=(e=this.listeners[e]).length;n<r;n++)if(e[n].callback===t){e.splice(n,1);break}}},{key:"dispatchEvent",value:function(e){if(e.type in this.listeners){for(var t=this.listeners[e.type].slice(),n=0,r=t.length;n<r;n++){var i=t[n];try{i.callback.call(this,e)}catch(e){Promise.resolve().then(function(){throw e})}i.options&&i.options.once&&this.removeEventListener(e.type,i.callback)}return!e.defaultPrevented}}}]),t}(),u=function(t){function o(){e(this,o);var t=u.call(this);return t.listeners||c.call(a(t)),Object.defineProperty(a(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(a(t),"onabort",{value:null,writable:!0,configurable:!0}),t}r(o,t);var u=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n=i(e);if(t){var r=i(this).constructor;n=Reflect.construct(n,arguments,r)}else n=n.apply(this,arguments);return!n||"object"!==X(n)&&"function"!=typeof n?a(this):n}}(o);return n(o,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),s(i(o.prototype),"dispatchEvent",this).call(this,e)}}]),o}(c),l=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new u,writable:!0,configurable:!0})}return n(t,[{key:"abort",value:function(){try{var e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(l.prototype[Symbol.toStringTag]="AbortController",u.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var t=!0}else t="function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController;t&&(e.AbortController=l,e.AbortSignal=u)}("undefined"!=typeof self?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-Zw($w(e+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(e){return 31-bx(e>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(e){if(up.call(e=e&&e.buffer||e)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var t="",n=0,r=0|(e=Zj?new ak(e):e).length;n<r;n=n+32768|0)t+=xd.apply(0,e[Zj?"slice":"subarray"](n,n+32768|0));return t.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(e){for(var t=0|(e=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,n=new ak(t),r=0;r<t;r=r+1|0)n[r]=e.charCodeAt(r);return n},window.TextEncoder||(window.TextEncoder=yl),function(e){var t,n,r,i,o,a,s,c,u,l,d;!function(e){e.LOGIN="LOGIN",e.LOGIN_SUCCESS="LOGIN_SUCCESS",e.LOGIN_FAILURE="LOGIN_FAILURE",e.LOGIN_TIMEOUT="LOGIN_TIMEOUT",e.INTERRUPTED="INTERRUPTED",e.LOGOUT="LOGOUT",e.BANNED_BY_SERVER="BANNED_BY_SERVER",e.REMOTE_LOGIN="REMOTE_LOGIN"}(t||(t={})),e.ConnectionChangeReason=t,function(e){e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECTING="RECONNECTING",e.ABORTED="ABORTED"}(n||(n={})),e.ConnectionState=n,function(e){e.IDLE="IDLE",e.SENT_TO_REMOTE="SENT_TO_REMOTE",e.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",e.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",e.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(r||(r={})),e.LocalInvitationState=r,function(e){e.INVITATION_RECEIVED="INVITATION_RECEIVED",e.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",e.REFUSED="REFUSED",e.ACCEPTED="ACCEPTED",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(i||(i={})),e.RemoteInvitationState=i,function(e){e.UNKNOWN="UNKNOWN",e.PEER_NO_RESPONSE="PEER_NO_RESPONSE",e.INVITATION_EXPIRE="INVITATION_EXPIRE",e.PEER_OFFLINE="PEER_OFFLINE",e.NOT_LOGGEDIN="NOT_LOGGEDIN"}(o||(o={})),e.LocalInvitationFailureReason=o,function(e){e.UNKNOWN="UNKNOWN",e.PEER_OFFLINE="PEER_OFFLINE",e.ACCEPT_FAILURE="ACCEPT_FAILURE",e.INVITATION_EXPIRE="INVITATION_EXPIRE"}(a||(a={})),e.RemoteInvitationFailureReason=a,function(e){e.ONLINE="ONLINE",e.UNREACHABLE="UNREACHABLE",e.OFFLINE="OFFLINE"}(s||(s={})),e.PeerOnlineState=s,(c||(c={})).ONLINE_STATUS="ONLINE_STATUS",e.PeerSubscriptionOption=c,function(e){e.TEXT="TEXT",e.RAW="RAW",e.IMAGE="IMAGE",e.FILE="FILE"}(u||(u={})),e.MessageType=u,function(e){e.CN="CN",e.NA="NA",e.EU="EU",e.AS="AS",e.JP="JP",e.IN="IN",e.GLOB="GLOB",e.OC="OC",e.SA="SA",e.AF="AF",e.OVS="OVS"}(l||(l={})),e.LegacyAreaCode=l,function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(d||(d={})),e.AreaCode=d}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(e){return on(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(e){if(Lj(e))throw TypeError("The method doesn't accept regular expressions");return e},ex=qa("match"),dk=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[ex]=!1,"/./"[e](t)}catch(e){}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(e){return!!~String(jb(this)).indexOf(ck(e),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(e){return Jd(this,e,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch(c){rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a(function(e){e=function(e){function t(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function n(e,t,n,o){return t=Object.create((t&&t.prototype instanceof i?t:i).prototype),o=new h(o||[]),t._invoke=function(e,t,n){var i=S;return function(o,a){if(i===T)throw Error("Generator is already running");if(i===R){if("throw"===o)throw a;return f()}for(n.method=o,n.arg=a;;){if((o=n.delegate)&&(o=u(o,n))){if(o===C)continue;return o}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===S)throw i=R,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);if(i=T,"normal"===(o=r(e,t,n)).type){if(i=n.done?R:w,o.arg===C)continue;return{value:o.arg,done:n.done}}"throw"===o.type&&(i=R,n.method="throw",n.arg=o.arg)}}}(e,n,o),t}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function a(){}function s(e){["next","throw","return"].forEach(function(n){t(e,n,function(e){return this._invoke(n,e)})})}function c(e,t){function n(i,o,a,s){if("throw"!==(i=r(e[i],e,o)).type){var c=i.arg;return(i=c.value)&&"object"===X(i)&&v.call(i,"__await")?t.resolve(i.__await).then(function(e){n("next",e,a,s)},function(e){n("throw",e,a,s)}):t.resolve(i).then(function(e){c.value=e,a(c)},function(e){return n("throw",e,a,s)})}s(i.arg)}var i;this._invoke=function(e,r){function o(){return new t(function(t,i){n(e,r,t,i)})}return i=i?i.then(o,o):o()}}function u(e,t){var n=e.iterator[t.method];if(n===m){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=m,u(e,t),"throw"===t.method))return C;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return C}return"throw"===(n=r(n,e.iterator,t.arg)).type?(t.method="throw",t.arg=n.arg,t.delegate=null,C):(n=n.arg)?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,C):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,C)}function l(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function d(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(l,this),this.reset(!0)}function p(e){if(e){var t=e[y];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1;return(t=function t(){for(;++n<e.length;)if(v.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=m,t.done=!0,t}).next=t}}return{next:f}}function f(){return{value:m,done:!0}}var m,g=Object.prototype,v=g.hasOwnProperty,E="function"==typeof Symbol?Symbol:{},y=E.iterator||"@@iterator",_=E.asyncIterator||"@@asyncIterator",b=E.toStringTag||"@@toStringTag";try{t({},"")}catch(e){t=function(e,t,n){return e[t]=n}}e.wrap=n;var S="suspendedStart",w="suspendedYield",T="executing",R="completed",C={};t(E={},y,function(){return this});var I=Object.getPrototypeOf;(I=I&&I(I(p([]))))&&I!==g&&v.call(I,y)&&(E=I);var O=a.prototype=i.prototype=Object.create(E);return o.prototype=a,t(O,"constructor",a),t(a,"constructor",o),o.displayName=t(a,b,"GeneratorFunction"),e.isGeneratorFunction=function(e){return!!(e="function"==typeof e&&e.constructor)&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,a):(e.__proto__=a,t(e,b,"GeneratorFunction")),e.prototype=Object.create(O),e},e.awrap=function(e){return{__await:e}},s(c.prototype),t(c.prototype,_,function(){return this}),e.AsyncIterator=c,e.async=function(t,r,i,o,a){void 0===a&&(a=Promise);var s=new c(n(t,r,i,o),a);return e.isGeneratorFunction(r)?s:s.next().then(function(e){return e.done?e.value:s.next()})},s(O),t(O,b,"Generator"),t(O,y,function(){return this}),t(O,"toString",function(){return"[object Generator]"}),e.keys=function(e){var t,n=[];for(t in e)n.push(t);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=p,h.prototype={constructor:h,reset:function(e){if(this.next=this.prev=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(d),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return o.type="throw",o.arg=e,n.next=t,r&&(n.method="next",n.arg=m),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var a=v.call(i,"catchLoc"),s=v.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&v.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}return i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null),(n=i?i.completion:{}).type=e,n.arg=t,i?(this.method="next",this.next=i.finallyLoc,C):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),C},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),d(n),C}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.tryLoc===e){if("throw"===(e=n.completion).type){var r=e.arg;d(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:p(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=m),C}},e}(e.exports);try{regeneratorRuntime=e}catch(t){"object"===("undefined"==typeof globalThis?"undefined":X(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}),yp=!R(function(){return Object.isExtensible(Object.preventExtensions({}))}),fk=$a(function(e){var t=Ra.f,n=Ae("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},a=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!ha(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Q(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!Q(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return yp&&a.REQUIRED&&i(e)&&!Q(e,n)&&o(e),e}};Be[n]=!0}),zp=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",a=y[e],s=a&&a.prototype,c=a,u={},l=function(e){var t=s[e];Ta(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!ha(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!ha(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!ha(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(nc(e,"function"!=typeof a||!(i||s.forEach&&!R(function(){(new a).entries().next()}))))c=n.getConstructor(t,e,r,o),fk.REQUIRED=!0;else if(nc(e,!0)){var d=new c,h=d[o](i?{}:-0,1)!=d,p=R(function(){d.has(1)}),f=Tg(function(e){new a(e)}),m=!i&&R(function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)});f||((c=t(function(t,n){return Gc(t,c,e),t=lh(new a,t,c),null!=n&&Xg(n,t[o],{that:t,AS_ENTRIES:r}),t})).prototype=s,s.constructor=c),(p||m)&&(l("delete"),l("has"),r&&l("get")),(m||h)&&l(o),i&&s.clear&&delete s.clear}return u[e]=c,N({global:!0,forced:c!=a},u),Ec(c,e),i||n.setStrong(c,e,r),c},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(e,t,n,r){var i=e(function(e,o){Gc(e,i,t),Bp(e,{type:t,index:ac(null),first:void 0,last:void 0,size:0}),ka||(e.size=0),null!=o&&Xg(o,e[r],{that:e,AS_ENTRIES:n})}),o=gk(t),a=function(e,t,n){var r,i=o(e),a=s(e,t);return a?a.value=n:(i.last=a={index:r=Ap(t,!0),key:t,value:n,previous:t=i.last,next:void 0,removed:!1},i.first||(i.first=a),t&&(t.next=a),ka?i.size++:e.size++,"F"!==r&&(i.index[r]=a)),e},s=function(e,t){e=o(e);var n=Ap(t);if("F"!==n)return e.index[n];for(e=e.first;e;e=e.next)if(e.key==t)return e};return Hf(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,ka?e.size=0:this.size=0},delete:function(e){var t=o(this);if(e=s(this,e)){var n=e.next,r=e.previous;delete t.index[e.index],e.removed=!0,r&&(r.next=n),n&&(n.previous=r),t.first==e&&(t.first=n),t.last==e&&(t.last=r),ka?t.size--:this.size--}return!!e},forEach:function(e){for(var t,n=o(this),r=Id(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),Hf(i.prototype,n?{get:function(e){return(e=s(this,e))&&e.value},set:function(e,t){return a(this,0===e?0:e,t)}}:{add:function(e){return a(this,e=0===e?0:e,e)}}),ka&&gx(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=gk(t),o=gk(r);bj(e,t,function(e,t){Bp(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})},n?"entries":"values",!n,!0),If(t)}};zp("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(e){return function(t){return t=String(jb(t)),1&e&&(t=t.replace(hx,"")),2&e&&(t=t.replace(ix,"")),t}},ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=8!==sh("\t\n\v\f\r \u2028\u2029\ufeff08")||22!==sh("\t\n\v\f\r \u2028\u2029\ufeff0x16")?function(e,t){return e=ik(String(e)),sh(e,t>>>0||(jx.test(e)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx="Number"==Zb(ac(th)),Ep=function(e){var t,n=lc(e,!1);if("string"==typeof n&&2<n.length)if(43===(e=(n=ik(n)).charCodeAt(0))||45===e){if(88===(e=n.charCodeAt(2))||120===e)return NaN}else if(48===e){switch(n.charCodeAt(1)){case 66:case 98:e=2;var r=49;break;case 79:case 111:e=8,r=55;break;default:return+n}var i=(n=n.slice(2)).length;for(t=0;t<i;t++){var o=n.charCodeAt(t);if(48>o||o>r)return NaN}return parseInt(n,e)}return+n};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(e){var t=1>arguments.length?0:e,n=this;return n instanceof Pd&&(nx?R(function(){th.valueOf.call(n)}):"Number"!=Zb(n))?lh(new pd(Ep(t)),n,Pd):Ep(t)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R(function(){var e=[];return e[Gp]=!1,e.concat()[0]!==e}),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(e){var t,n=Qa(this),r=Sg(n,0),i=0,o=-1;for(t=arguments.length;o<t;o++){var a=-1===o?n:arguments[o],s=a;if(ha(s)){var c=s[Gp];s=void 0!==c?!!c:gd(s)}else s=!1;if(s){if(9007199254740991<i+(c=ta(a.length)))throw TypeError("Maximum allowed index exceeded");for(s=0;s<c;s++,i++)s in a&&Ge(r,i,a[s])}else{if(9007199254740991<=i)throw TypeError("Maximum allowed index exceeded");Ge(r,i++,a)}}return r.length=i,r}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R(function(){kk(function(){})});N({target:"Reflect",stat:!0,forced:rx},{apply:function(e,t,n){return yb(e),va(n),kk?kk(e,t,n):qx.call(e,t,n)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R(function(){return!Object.getOwnPropertyNames(1)});N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe="object"===("undefined"==typeof Reflect?"undefined":X(Reflect))?Reflect:null,Hp=Pe&&"function"==typeof Pe.apply?Pe.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},ux=Pe&&"function"==typeof Pe.ownKeys?Pe.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},Ip=Number.isNaN||function(e){return e!=e};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(e){if("number"!=typeof e||0>e||Ip(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Jp=e}}),ea.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||Ip(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ea.prototype.getMaxListeners=function(){return void 0===this._maxListeners?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);n="error"===e;var r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var i;if(0<t.length&&(i=t[0]),i instanceof Error)throw i;throw(t=Error("Unhandled error."+(i?" ("+i.message+")":""))).context=i,t}if(void 0===(n=r[e]))return!1;if("function"==typeof n)Hp(n,this,t);else for(r=Cl(n,i=n.length),n=0;n<i;++n)Hp(r[n],this,t);return!0},ea.prototype.addListener=function(e,t){return zl(this,e,t,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(e,t){return zl(this,e,t,!0)},ea.prototype.once=function(e,t){return ng(t),this.on(e,Al(this,e,t)),this},ea.prototype.prependOnceListener=function(e,t){return ng(t),this.prependListener(e,Al(this,e,t)),this},ea.prototype.removeListener=function(e,t){var n;ng(t);var r=this._events;if(void 0===r)return this;var i=r[e];if(void 0===i)return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){var o=-1;for(n=i.length-1;0<=n;n--)if(i[n]===t||i[n].listener===t){var a=i[n].listener;o=n;break}if(0>o)return this;if(0===o)i.shift();else{for(;o+1<i.length;o++)i[o]=i[o+1];i.pop()}1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(e){var t=this._events;if(void 0===t)return this;if(void 0===t.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==t[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete t[e]),this;if(0===arguments.length){var n=Object.keys(t);for(t=0;t<n.length;++t){var r=n[t];"removeListener"!==r&&this.removeAllListeners(r)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=t[e]))this.removeListener(e,n);else if(void 0!==n)for(t=n.length-1;0<=t;t--)this.removeListener(e,n[t]);return this},ea.prototype.listeners=function(e){return Bl(this,e,!0)},ea.prototype.rawListeners=function(e){return Bl(this,e,!1)},ea.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Dl.call(e,t)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(e,t){return new Promise(function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}El(e,t,o,{once:!0}),"error"!==t&&vs(e,i,{once:!0})})};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R(function(){if(ka&&1!==Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(e){t[e]=e}),7!=Qe({},e)[n]||"abcdefghijklmnopqrst"!=Dc(Qe({},t)).join("")})?function(e,t){for(var n=Qa(e),r=arguments.length,i=1,o=Bf.f,a=zf;r>i;)for(var s,c=Af(arguments[i++]),u=o?Dc(c).concat(o(c)):Dc(c),l=u.length,d=0;l>d;)s=u[d++],(!ka||a.call(c,s))&&(n[s]=c[s]);return n}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(e){return vx(e)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R(function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||"/a/i"!=sc(Wf,"i")}))){for(var Oc=function(e,t){var n,r=this instanceof Oc,i=Lj(e),o=void 0===t;return!r&&i&&e.constructor===Oc&&o||(nk?i&&!o&&(e=e.source):e instanceof Oc&&(o&&(t=tj.call(e)),e=e.source),pc&&(n=!!t&&-1<t.indexOf("y"))&&(t=t.replace(/y/g,"")),e=lh(nk?new sc(e,t):sc(e,t),r?this:lk,Oc),pc&&n&&(zx(e).sticky=!0)),e},Bx=function(e){e in Oc||xx(Oc,e,{configurable:!0,get:function(){return sc[e]},set:function(t){sc[e]=t}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",function(e){return function(t,n,r){return e(this,t,n,r)}}),Sf("Float64",function(e){return function(t,n,r){return e(this,t,n,r)}}),Sf("Uint32",function(e){return function(t,n,r){return e(this,t,n,r)}}),Sf("Uint16",function(e){return function(t,n,r){return e(this,t,n,r)}});var ok=function(e,t){return e===t?0:null==e?null==t?0:-1:null==t?null==e?0:1:"function"==typeof e.compare?e.compare(t):"function"==typeof t.compare?-t.compare(e):e<t?-1:e>t?1:0},pk=[],Op=pk.sort,Cx=R(function(){pk.sort(void 0)}),Dx=R(function(){pk.sort(null)}),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(e){return void 0===e?Op.call(Qa(this)):Op.call(Qa(this),yb(e))}});var Pp=Object.getPrototypeOf({}),Xf=function(e,t){var n;return e===t||(null==e?e==t:"function"===X(e.equiv)?e.equiv(t):null==t?e==t:"function"===X(t.equiv)?t.equiv(e):"string"!==X(e)&&"string"!==X(t)&&(null!=(n=Object.getPrototypeOf(e))&&n!==Pp||null!=(n=Object.getPrototypeOf(t))&&n!==Pp?"function"!==X(e)&&void 0!==e.length&&"function"!==X(t)&&void 0!==t.length?Gx(e,t):e instanceof Set&&t instanceof Set?Hx(e,t):e instanceof Map&&t instanceof Map?Ix(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:Fx(e,t)))},Gx=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf,r=e.length;if(r===t.length)for(;0<=--r&&n(e[r],t[r]););return 0>r},Hx=function(e,t){return e.size===t.size&&(2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf)(G(e.keys()).sort(),G(t.keys()).sort())},Ix=function(e,t){return e.size===t.size&&(2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf)(G(e).sort(),G(t).sort())},Fx=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Xf;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(!t.hasOwnProperty(r)||!n(e[r],t[r]))return!1;return!0},Qp=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return void 0!==e?": "+e:""};return function(n){function r(n){return W(this,r),i.call(this,e(n)+t(n))}la(r,n);var i=ma(r);return r}(ef(Error))},Jx=Qp(function(){return"illegal argument(s)"}),vh=function(e){throw new Jx(e)},qk=Qp(function(){return"index out of bounds"}),Rp=1/4294967295,Kx=function(){function e(){W(this,e)}return Ha(e,[{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.int()*Rp*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(this.int()*Rp-.5)*e}},{key:"minmax",value:function(e,t){return this.float()*(t-e)+e}}]),e}(),rk=Math.random,Lx=new(function(e){function t(){return W(this,t),n.apply(this,arguments)}la(t,e);var n=ma(t);return Ha(t,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return rk()*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(rk()-.5)*e}}]),t}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R(function(){sk(1)});N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(e){return sk&&ha(e)?sk(Mx(e)):e}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(e){return Wo(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(e){return null!=e&&"function"==typeof e.xform?e.xform():e},og=function(){function e(t){W(this,e),this.value=t}return Ha(e,[{key:"deref",value:function(){return this.value}}]),e}(),Wh=function(e){return e instanceof og?e.deref():e},xs=function(e,t){return[e,function(e){return e},t]},Qx=w.mark(function(e,t){var n,r,i,o,a;return w.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:n=Gl(e)(ws()),r=n[1],i=n[2],o=0;case 4:if(!(o<t.length)){s.next=15;break}if(!((a=i([],t[o]))instanceof og)){s.next=10;break}return s.delegateYield(Wh(r(a.deref())),"t0",9);case 9:return s.abrupt("return");case 10:if(!a.length){s.next=12;break}return s.delegateYield(a,"t1",12);case 12:o++,s.next=4;break;case 15:return s.delegateYield(Wh(r([])),"t2",16);case 16:case"end":return s.stop()}},Qx)}),ys=w.mark(Fl),zs=function(e,t){return[e[0],e[1],t]},Sp=!0;"findIndex"in[]&&Array(1).findIndex(function(){Sp=!1}),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(e){return An(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function e(t){W(this,e),this._length=0,t&&this.into(t)}return Ha(e,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e(this)}},{key:"empty",value:function(){return new e}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var e,t=this.head;t;)e=t.next,delete t.value,delete t.prev,delete t.next,t=e;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(e){var t=this._length;if(t<e._length)return-1;if(t>e._length)return 1;if(0===t)return 0;t=this.head,e=e.head;for(var n=0;t&&0==n;)n=ok(t.value,e.value),t=t.next,e=e.next;return n}},{key:"equiv",value:function(t){if(!(t instanceof e||null!=t&&"function"!=typeof t&&void 0!==t.length)||this._length!==t.length)return!1;if(!this._length||this===t)return!0;for(var n=this.head,r=0;r<t.length;r++){if(!Xf(n.value,t[r]))return!1;n=n.next}return!0}},{key:Symbol.iterator,value:w.mark(function e(){var t;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.head;case 1:if(!t){e.next=7;break}return e.next=4,t.value;case 4:t=t.next,e.next=1;break;case 7:case"end":return e.stop()}},e,this)})},{key:"seq",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;if(!(e>=t||0>e)){e=this.nthCell(e);var n=this.nthCell(t-1);return t=function e(t){return{first:function(){return t.value},next:function(){return t!==n&&t.next?e(t.next):void 0}}},e?t(e):void 0}}},{key:"cycle",value:w.mark(function e(){return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this,"t0",2);case 2:e.next=0;break;case 4:case"end":return e.stop()}},e,this)})},{key:"$reduce",value:function(e,t){for(var n=this.head;n&&!(t instanceof og);)t=e(t,n.value),n=n.next;return t}},{key:"drop",value:function(){var e=this.head;if(e)return(this.head=e.next)?delete this.head.prev:delete this.tail,this._length--,e.value}},{key:"cons",value:function(e){return e={value:e,next:this.head},this.head?this.head.prev=e:this.tail=e,this.head=e,this._length++,this}},{key:"insertBefore",value:function(e,t){return e||vh("cell is undefined"),t={value:t,next:e,prev:e.prev},e.prev?e.prev.next=t:this.head=t,e.prev=t,this._length++,this}},{key:"insertAfter",value:function(e,t){return e||vh("cell is undefined"),t={value:t,next:e.next,prev:e},e.next?e.next.prev=t:this.tail=t,e.next=t,this._length++,this}},{key:"insertBeforeNth",value:function(e,t){if(0>e&&(e+=this._length),0>=e)return this.cons(t);if(0>e||e>=this._length)throw new qk(e);return this.insertBefore(this.nthCellUnsafe(e),t)}},{key:"insertAfterNth",value:function(e,t){if(0>e&&(e+=this._length),e>=this._length-1)return this.push(t);if(0>e||e>=this._length)throw new qk(e);return this.insertAfter(this.nthCellUnsafe(e),t)}},{key:"insertSorted",value:function(e,t){t=t||ok;for(var n=this.head;n;){if(0>=t(e,n.value))return this.insertBefore(n,e);n=n.next}return this.push(e)}},{key:"find",value:function(e){for(var t=this.head;t;){if(t.value===e)return t;t=t.next}}},{key:"findWith",value:function(e){for(var t=this.head;t;){if(e(t.value))return t;t=t.next}}},{key:"concat",value:function(){for(var e=this.copy(),t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e.into(n[t]);return e}},{key:"into",value:function(e){for(var t=0;t<e.length;t++)this.push(e[t])}},{key:"slice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;n=0>n?n+this._length:n,(0>(t=0>t?t+this._length:t)||0>n)&&vh("invalid indices: ${from} / ${to}");for(var r=new e,i=this.nthCell(t);i&&++t<=n;)r.push(i.value),i=i.next;return r}},{key:"splice",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length?arguments[2]:void 0;if("number"==typeof t){if(0>t&&(t+=this._length),0>t||t>=this._length)throw new qk(t);var i=this.nthCellUnsafe(t)}else i=t;var o=new e;if(0<n)for(;i&&0<n--;)this.remove(i),o.push(i.value),i=i.next;else i&&(i=i.next);if(r)if(i)for(n=0;n<r.length;n++)this.insertBefore(i,r[n]);else for(i=0;i<r.length;i++)this.push(r[i]);return o}},{key:"remove",value:function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,this._length--,this}},{key:"swap",value:function(e,t){if(e!==t){var n=e.value;e.value=t.value,t.value=n}return this}},{key:"push",value:function(e){return this.tail?(this.tail=this.tail.next=e={value:e,prev:this.tail},this._length++,this):this.cons(e)}},{key:"pop",value:function(){var e=this.tail;if(e)return(this.tail=e.prev)?delete this.tail.next:delete this.head,this._length--,e.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(e){return this.head?(this.head.value=e,this):this.cons(e)}},{key:"setTail",value:function(e){return this.tail?(this.tail.value=e,this):this.push(e)}},{key:"setNth",value:function(e,t){var n=this.nthCell(e);return!n&&vh("index out of bounds: ".concat(e)),n.value=t,this}},{key:"nth",value:function(e,t){return(e=this.nthCell(e))?e.value:t}},{key:"nthCell",value:function(e){if(0>e&&(e+=this._length),!(0>e||e>=this._length))return this.nthCellUnsafe(e)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var e=this.peek();return this.pop(),this.cons(e)}}},{key:"map",value:function(t){for(var n=new e,r=this.head;r;)n.push(t(r.value)),r=r.next;return n}},{key:"filter",value:function(t){for(var n=new e,r=this.head;r;)t(r.value)&&n.push(r.value),r=r.next;return n}},{key:"reduce",value:function(e,t){for(var n=this.head;n;)t=e(t,n.value),n=n.next;return t}},{key:"shuffle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Lx;if(2>this._length)return this;for(e=null!=e?e:Math.ceil(1.5*Math.log2(this._length));0<e;e--)for(var n=this.head;n;){var r=n.next;.5>t.float()?this.asHead(n):this.asTail(n),n=r}return this}},{key:"sort",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:ok;if(!this._length)return this;for(var t=1;;){var n=this.head;this.tail=this.head=void 0;for(var r=0;n;){r++;for(var i=n,o=0,a=0;a<t&&(o++,i=i.next);a++);for(a=t;0<o||0<a&&i;){if(0===o){var s=i;i=i.next,a--}else i&&0!==a?0>=e(n.value,i.value)?(s=n,n=n.next,o--):(s=i,i=i.next,a--):(s=n,n=n.next,o--);this.tail?this.tail.next=s:this.head=s,s.prev=this.tail,this.tail=s}n=i}if(this.tail.next=void 0,1>=r)return this;t*=2}}},{key:"reverse",value:function(){for(var e=this.head,t=this.tail,n=(this._length>>>1)+(1&this._length);e&&t&&0<n;){var r=e.value;e.value=t.value,t.value=r,e=e.next,t=t.prev,n--}return this}},{key:"asHead",value:function(e){return e===this.head||(this.remove(e),this.head.prev=e,e.next=this.head,e.prev=void 0,this.head=e,this._length++),this}},{key:"asTail",value:function(e){return e===this.tail||(this.remove(e),this.tail.next=e,e.prev=this.tail,e.next=void 0,this.tail=e,this._length++),this}},{key:"toString",value:function(){for(var e=[],t=this.head;t;)e.push(String(t.value)),t=t.next;return e.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(e){if(e<=this._length>>1)var t=this.head,n="next";else t=this.tail,n="prev",e=this._length-e-1;for(;0<e--&&t;)t=t[n];return t}}]),e}(),tc=function(){function e(t,n){W(this,e),n=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},n),this.map=n.map(),this.items=new Rx,this._size=0,this.opts=n,t&&this.into(t)}return Ha(e,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg(function(e){return[e.k,e]},this.items)}},{key:"keys",value:function(){return pg(function(e){return e.k},this.items)}},{key:"values",value:function(){return pg(function(e){return e.v},this.items)}},{key:"copy",value:function(){var e=this.empty();e.items=this.items.copy();for(var t=e.items.head;t;)e.map.set(t.value.k,t),t=t.next;return e}},{key:"empty",value:function(){return new e(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var e=this.opts.release;if(e){for(var t;t=this.items.drop();)e(t.k,t.v);return!0}return this.items.release()}},{key:"has",value:function(e){return this.map.has(e)}},{key:"get",value:function(e,t){return(e=this.map.get(e))?this.resetEntry(e):t}},{key:"set",value:function(e,t){var n=this.opts.ksize(e)+this.opts.vsize(t),r=this.map.get(e);return this._size+=Math.max(0,n-(r?r.value.s:0)),this.ensureSize()&&this.doSetEntry(r,e,t,n),t}},{key:"into",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.set(n[0],n[1])}return this}},{key:"getSet",value:function(e,t){var n=this,r=this.map.get(e);return r?Promise.resolve(this.resetEntry(r)):t().then(function(t){return n.set(e,t)})}},{key:"delete",value:function(e){return!!(e=this.map.get(e))&&(this.removeEntry(e),!0)}},{key:"resetEntry",value:function(e){return this.items.asTail(e),e.value.v}},{key:"ensureSize",value:function(){for(var e=this.opts.release,t=this.opts.maxsize,n=this.opts.maxlen;this._size>t||this.length>=n;){var r=this.items.drop();if(!r)return!1;this.map.delete(r.k),e&&e(r.k,r.v),this._size-=r.s}return!0}},{key:"removeEntry",value:function(e){var t=e.value;this.map.delete(t.k),this.items.remove(e),this.opts.release&&this.opts.release(t.k,t.v),this._size-=t.s}},{key:"doSetEntry",value:function(e,t,n,r){e?(e.value.v=n,e.value.s=r,this.items.asTail(e)):(this.items.push({k:t,v:n,s:r}),this.map.set(t,this.items.tail))}}]),e}(),Sx=function(e){function t(e,r){return W(this,t),r=Object.assign({ttl:36e5},r),n.call(this,e,r)}la(t,e);var n=ma(t);return Ha(t,[{key:"empty",value:function(){return new t(null,this.opts)}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"get",value:function(e,t){if(e=this.map.get(e)){if(e.value.t>=Date.now())return this.resetEntry(e);this.removeEntry(e)}return t}},{key:"set",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,r=this.opts.ksize(e)+this.opts.vsize(t),i=this.map.get(e);return this._size+=Math.max(0,r-(i?i.value.s:0)),this.ensureSize()&&(n=Date.now()+n,i?(i.value.v=t,i.value.s=r,i.value.t=n,this.items.asTail(i)):(this.items.push({k:e,v:t,s:r,t:n}),this.map.set(e,this.items.tail))),t}},{key:"getSet",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,i=this.get(e);return i?Promise.resolve(i):t().then(function(t){return n.set(e,t,r)})}},{key:"prune",value:function(){for(var e=Date.now(),t=this.items.head;t;)t.value.t<e&&this.removeEntry(t),t=t.next}},{key:"ensureSize",value:function(){for(var e=this.opts.maxsize,n=this.opts.maxlen,r=Date.now(),i=this.items.head;i&&(this._size>e||this.length>=n);)i.value.t<r&&this.removeEntry(i),i=i.next;return Th(wd(t.prototype),"ensureSize",this).call(this)}}]),t}(tc),Tp="object"==X(Ya)&&Ya&&Ya.Object===Object&&Ya,Tx="object"==("undefined"==typeof self?"undefined":X(self))&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(e){if(null==e)e=void 0===e?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(e)){var t=Ux.call(e,Yf),n=e[Yf];try{e[Yf]=void 0;var r=!0}catch(e){}var i=Vx.call(e);r&&(t?e[Yf]=n:delete e[Yf]),e=i}else e=Wx.call(e);return e},lb=function(e){var t=X(e);return null!=e&&("object"==t||"function"==t)},qi=function(e){return!!lb(e)&&("[object Function]"==(e=Qd(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)},tk=Cb["__core-js_shared__"],Wp=function(){var e=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Xx=Function.prototype.toString,Rd=function(e){if(null!=e){try{return Xx.call(e)}catch(e){}return e+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(e,t){return!lb(e=null==e?void 0:e[t])||Wp&&Wp in e||!(qi(e)?Zx:Yx).test(Rd(e))?void 0:e},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},zd.prototype.get=function(e){var t=this.__data__;return Zf?"__lodash_hash_undefined__"===(e=t[e])?void 0:e:$x.call(t,e)?t[e]:void 0},zd.prototype.has=function(e){var t=this.__data__;return Zf?void 0!==t[e]:ay.call(t,e)},zd.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Zf&&void 0===t?"__lodash_hash_undefined__":t,this};var $f=function(e,t){return e===t||e!=e&&t!=t},wh=function(e,t){for(var n=e.length;n--;)if($f(e[n][0],t))return n;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(e){var t=this.__data__;return!(0>(e=wh(t,e))||(e==t.length-1?t.pop():by.call(t,e,1),--this.size,0))},ce.prototype.get=function(e){var t=this.__data__;return 0>(e=wh(t,e))?void 0:t[e][1]},ce.prototype.has=function(e){return-1<wh(this.__data__,e)},ce.prototype.set=function(e,t){var n=this.__data__,r=wh(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(e,t){e=e.__data__;var n=X(t);return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(e){return e=xh(this,e).delete(e),this.size-=e?1:0,e},de.prototype.get=function(e){return xh(this,e).get(e)},de.prototype.has=function(e){return xh(this,e).has(e)},de.prototype.set=function(e,t){var n=xh(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},gf.prototype.has=function(e){return this.__data__.has(e)};var Xp=function(e,t,n,r){var i=e.length;for(n+=r?1:-1;r?n--:++n<i;)if(t(e[n],n,e))return n;return-1},cy=function(e){return e!=e},dy=function(e,t){var n;if(n=!(null==e||!e.length)){if(t==t)e:{n=-1;for(var r=e.length;++n<r;)if(e[n]===t){e=n;break e}e=-1}else e=Xp(e,cy,0);n=-1<e}return n},ey=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1},fy=function(e,t){return e.has(t)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(e){return new Re(e)}:gy,vk=function(e,t,n){var r=-1,i=dy,o=e.length,a=!0,s=[],c=s;if(n)a=!1,i=ey;else if(200<=o){if(i=t?null:iy(e))return uk(i);a=!1,i=fy,c=new gf}else c=t?[]:s;e:for(;++r<o;){var u=e[r],l=t?t(u):u;if(u=n||0!==u?u:0,a&&l==l){for(var d=c.length;d--;)if(c[d]===l)continue e;t&&c.push(l),s.push(u)}else i(c,l,n)||(c!==s&&c.push(l),s.push(u))}return s},Yp=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},he=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(e){var t=this.__data__;return e=t.delete(e),this.size=t.size,e},ee.prototype.get=function(e){return this.__data__.get(e)},ee.prototype.has=function(e){return this.__data__.has(e)},ee.prototype.set=function(e,t){var n=this.__data__;if(n instanceof rg){var r=n.__data__;if(!ag||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new qg(r)}return n.set(e,t),this.size=n.size,this};var ge=ee,Is=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},yh=function(){try{var e=Sd(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),bg=function(e,t,n){"__proto__"==t&&yh?yh(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},jy=Object.prototype.hasOwnProperty,Ml=function(e,t,n){var r=e[t];jy.call(e,t)&&$f(r,n)&&(void 0!==n||t in e)||bg(e,t,n)},re=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=r?r(n[s],e[s],s,n,e):void 0;void 0===c&&(c=e[s]),i?bg(n,s,c):Ml(n,s,c)}return n},gc=function(e){return null!=e&&"object"==X(e)},Zp=function(e){return gc(e)&&"[object Arguments]"==Qd(e)},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(e){return gc(e)&&ky.call(e,"callee")&&!ly.call(e,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a(function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e;e.exports=((t=n&&n.exports===t?Cb.Buffer:void 0)?t.isBuffer:void 0)||my}),ny=/^(?:0|[1-9]\d*)$/,wk=function(e,t){var n=X(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&ny.test(e))&&-1<e&&0==e%1&&e<t},xk=function(e){return"number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(e){return gc(e)&&xk(e.length)&&!!Ea[Qd(e)]},zh=function(e){return function(t){return e(t)}},Se=$a(function(e,t){var n=t&&!t.nodeType&&t;n=(t=n&&e&&!e.nodeType&&e)&&t.exports===n&&Tp.process;e:{try{var r=t&&t.require&&t.require("util").types;if(r){var i=r;break e}i=n&&n.binding&&n.binding("util");break e}catch(e){}i=void 0}e.exports=i}),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(e,t){var n=Va(e),r=!n&&rf(e),i=!n&&!r&&jf(e),o=!n&&!r&&!i&&bi(e);if(n=n||r||i||o){r=e.length;for(var a=String,s=-1,c=Array(r);++s<r;)c[s]=a(s);r=c}else r=[];for(var u in a=r.length,e)!t&&!py.call(e,u)||n&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||wk(u,a))||r.push(u);return r},qy=Object.prototype,yk=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||qy)},cq=function(e,t){return function(n){return e(t(n))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(e){return null!=e&&xk(e.length)&&!qi(e)},Ad=function(e){if(Ed(e))e=bq(e);else if(yk(e)){var t,n=[];for(t in Object(e))sy.call(e,t)&&"constructor"!=t&&n.push(t);e=n}else e=ry(e);return e},Es=function(e,t){return e&&re(t,Ad(t),e)},ty=Object.prototype.hasOwnProperty,kf=function(e){if(Ed(e))e=bq(e,!0);else if(lb(e)){var t=yk(e),n=[];for(r in e)("constructor"!=r||!t&&ty.call(e,r))&&n.push(r);e=n}else{var r=[];if(null!=e)for(t in Object(e))r.push(t);e=r}return e},Cs=function(e,t){return e&&re(t,kf(t),e)},Jl=$a(function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e,r=(t=n&&n.exports===t?Cb.Buffer:void 0)?t.allocUnsafe:void 0;e.exports=function(e,t){return t?e.slice():(t=e.length,t=r?r(t):new e.constructor(t),e.copy(t),t)}}),Xh=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},uy=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(e){return null==e?[]:(e=Object(e),uy(eq(e),function(t){return vy.call(e,t)}))}:dq,Ds=function(e,t){return re(e,zk(e),t)},ai=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)ai(t,zk(e)),e=Ak(e);return t}:dq,Bs=function(e,t){return re(e,fq(e),t)},gq=function(e,t,n){return t=t(e),Va(e)?t:ai(t,n(e))},Yh=function(e){return gq(e,Ad,zk)},Ll=function(e){return gq(e,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&"[object DataView]"!=Td(new Bk(new ArrayBuffer(1)))||ag&&"[object Map]"!=Td(new ag)||Ck&&"[object Promise]"!=Td(Ck.resolve())||Re&&"[object Set]"!=Td(new Re)||Dk&&"[object WeakMap]"!=Td(new Dk))&&(Td=function(e){var t=Qd(e);if(e=(e="[object Object]"==t?e.constructor:void 0)?Rd(e):"")switch(e){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return t});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&By.call(e,"index")&&(n.index=e.index,n.input=e.input),n},Ah=Cb.Uint8Array,Ek=function(e){var t=new e.constructor(e.byteLength);return new Ah(t).set(new Ah(e)),t},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(e,t){return t=t?Ek(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.length)},Fs=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Ek(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return t=n?Ek(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return(t=new e.constructor(e.source,Cy.exec(e))).lastIndex=e.lastIndex,t;case"[object Symbol]":return iq?Object(iq.call(e)):{}}},jq=Object.create,Dy=function(){function e(){}return function(t){return lb(t)?jq?jq(t):(e.prototype=t,t=new e,e.prototype=void 0,t):{}}}(),Kl=function(e){return"function"!=typeof e.constructor||yk(e)?{}:Dy(Ak(e))},Ey=function(e){return gc(e)&&"[object Map]"==hf(e)},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(e){return gc(e)&&"[object Set]"==hf(e)},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(e){return"symbol"==X(e)||gc(e)&&"[object Symbol]"==Qd(e)},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(e,t){if(Va(e))return!1;var n=X(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!ie(e))||Hy.test(e)||!Gy.test(e)||null!=t&&e in Object(t)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(e){var t=(e=Zh(e,function(e){return 500===t.size&&t.clear(),e})).cache;return e}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Iy,function(e,n,r,i){t.push(r?i.replace(Jy,"$1"):n||e)}),t}),Js=1/0,mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(e,t){return Va(e)?e:Fk(e,t)?[e]:Ky(null==e?"":Nl(e))},Ly=1/0,cg=function(e){if("string"==typeof e||ie(e))return e;var t=e+"";return"0"==t&&1/e==-Ly?"-0":t},Ch=function(e,t){for(var n=0,r=(t=Bh(t,e)).length;null!=e&&n<r;)e=e[cg(t[n++])];return n&&n==r?e:void 0},My=function(e,t){if(!(2>(t=Bh(t,e)).length)){var n=t,r=0,i=-1,o=-1,a=n.length;for(0>r&&(r=-r>a?0:a+r),0>(i=i>a?a:i)&&(i+=a),a=r>i?0:i-r>>>0,r>>>=0,i=Array(a);++o<a;)i[o]=n[o+r];e=Ch(e,i)}return(n=null==e)||(n=delete e[cg((n=null==t?0:t.length)?t[n-1]:void 0)]),n},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(e){return!(!gc(e)||"[object Object]"!=Qd(e))&&(null===(e=Ak(e))||"function"==typeof(e=Ny.call(e,"constructor")&&e.constructor)&&e instanceof e&&nq.call(e)==Oy)},Py=function(e){return wm(e)?void 0:e},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(e){return Va(e)||rf(e)||!!(oq&&e&&e[oq])},Qy=function(e){return null!=e&&e.length?$h(e,1):[]},Ry=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},pq=Math.max,qq=function(e,t,n){return t=pq(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=pq(r.length-t,0),a=Array(o);++i<o;)a[i]=r[t+i];for(i=-1,o=Array(t+1);++i<t;)o[i]=r[i];return o[t]=n(a),Ry(e,this,o)}},Sy=function(e){return function(){return e}},Dh=function(e){return e},Ty=Date.now,rq=function(e){var t=0,n=0;return function(){var r=Ty(),i=16-(r-n);if(n=r,0<i){if(800<=++t)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(yh?function(e,t){return yh(e,"toString",{configurable:!0,enumerable:!1,value:Sy(t),writable:!0})}:Dh),Gk=function(e){return rq(qq(e,void 0,Qy),e+"")}(function(e,t){var n={};if(null==e)return n;var r=!1;t=he(t,function(t){return t=Bh(t,e),r||(r=1<t.length),t}),re(e,Ll(e),n),r&&(n=fe(n,7,Py));for(var i=t.length;i--;)My(n,t[i]);return n}),Uy=function(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(r,a,n(a),e)}return r},um=function(e,t,n){for(var r=-1,i=Object(e),o=(n=n(e)).length;o--;){var a=n[++r];if(!1===t(i[a],a,i))break}return e},sq=function(e,t){return e&&um(e,t,Ad)},Hk=function(e,t){return function(t,n){if(null==t)return t;if(!Ed(t))return e(t,n);for(var r=t.length,i=-1,o=Object(t);++i<r&&!1!==n(o[i],i,o););return t}}(sq),Vy=function(e,t,n,r){return Hk(e,function(e,i,o){t(r,e,n(e),o)}),r},tq=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},Pl=function(e,t,n,r,i,o){var a=1&n,s=e.length,c=t.length;if(s!=c&&!(a&&c>s))return!1;c=o.get(e);var u=o.get(t);if(c&&u)return c==t&&u==e;c=-1,u=!0;var l=2&n?new gf:void 0;for(o.set(e,t),o.set(t,e);++c<s;){var d=e[c],h=t[c];if(r)var p=a?r(h,d,c,t,e,o):r(d,h,c,e,t,o);if(void 0!==p){if(p)continue;u=!1;break}if(l){if(!tq(t,function(e,t){if(!l.has(t)&&(d===e||i(d,e,n,r,o)))return l.push(t)})){u=!1;break}}else if(d!==h&&!i(d,h,n,r,o)){u=!1;break}}return o.delete(e),o.delete(t),u},Wy=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(e,t,n,r,i,o,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!o(new Ah(e),new Ah(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=Wy;case"[object Set]":if(s||(s=uk),e.size!=t.size&&!(1&r))break;return(n=a.get(e))?n==t:(r|=2,a.set(e,t),t=Pl(s(e),s(t),r,i,o,a),a.delete(e),t);case"[object Symbol]":if(Ik)return Ik.call(e)==Ik.call(t)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=Object(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var c=(s=n[i])[0],u=e[c],l=s[1];if(a&&s[2]){if(void 0===u&&!(c in e))return!1}else{if(s=new ge,r)var d=r(u,l,c,e,t,s);if(void 0===d?!je(l,u,3,r,s):!d)return!1}}return!0},Yy=function(e){for(var t=Ad(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,i==i&&!lb(i)]}return t},vq=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},Zy=function(e){var t=Yy(e);return 1==t.length&&t[0][2]?vq(t[0][0],t[0][1]):function(n){return n===e||Xy(n,e,t)}},$y=function(e,t){return Fk(e)&&t==t&&!lb(t)?vq(cg(e),t):function(n){var r=null==n?void 0:Ch(n,e);if(void 0===(r=void 0===r?void 0:r)&&r===t){if(r=null!=n){for(var i=-1,o=(r=Bh(r=e,n)).length,a=!1;++i<o;){var s=cg(r[i]);if(!(a=null!=n&&null!=n&&s in Object(n)))break;n=n[s]}r=a||++i!=o?a:!!(o=null==n?0:n.length)&&xk(o)&&wk(s,o)&&(Va(n)||rf(n))}s=r}else s=je(t,r,3);return s}},az=function(e){return function(t){return null==t?void 0:t[e]}},bz=function(e){return function(t){return Ch(t,e)}},Te=function(e){return"function"==typeof e?e:null==e?Dh:"object"==X(e)?Va(e)?$y(e[0],e[1]):Zy(e):Fk(e)?az(cg(e)):bz(e)},Jk=function(e,t){return function(t,n){return(Va(t)?Uy:Vy)(t,e,Te(n),{})}}(function(e,t,n){bg(e,n,t)}),uc=function(e,t){var n={};return t=Te(t),sq(e,function(e,r,i){bg(n,r,t(e,r,i))}),n};N({target:"String",proto:!0,forced:R(function(){var e="".sub('"');return e!==e.toLowerCase()||3<e.split('"').length})},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(c){}Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(e){if(2>(e=e||10)||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var t=Gb(e),n=this.div(t);return t=n.mul(t).sub(this),n.toString(e)+t.toInt().toString(e)}return"-"+this.neg().toString(e)}n=Gb(sg(e,6),this.unsigned),t=this;for(var r="";;){var i=t.div(n),o=(t.sub(i.mul(n)).toInt()>>>0).toString(e);if((t=i).isZero())return o+r;for(;6>o.length;)o="0"+o;r=""+o+r}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},D.isZero=function(){return 0===this.high&&0===this.low},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return!(1&~this.low)},D.isEven=function(){return!(1&this.low)},D.equals=function(e){return mb(e)||(e=Wb(e)),(this.unsigned===e.unsigned||1!=this.high>>>31||1!=e.high>>>31)&&this.high===e.high&&this.low===e.low},D.eq=D.equals,D.notEquals=function(e){return!this.eq(e)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(e){return 0>this.comp(e)},D.lt=D.lessThan,D.lessThanOrEqual=function(e){return 0>=this.comp(e)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(e){return 0<this.comp(e)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(e){return 0<=this.comp(e)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(e){if(mb(e)||(e=Wb(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(e){mb(e)||(e=Wb(e));var t=this.high>>>16,n=this.low>>>16,r=e.high>>>16,i=65535&e.high,o=e.low>>>16;return n=(o=((e=(65535&this.low)+(65535&e.low))>>>16)+(n+o))>>>16,ya((65535&o)<<16|65535&e,(t=((n+=(65535&this.high)+i)>>>16)+(t+r)&65535)<<16|65535&n,this.unsigned)},D.subtract=function(e){return mb(e)||(e=Wb(e)),this.add(e.neg())},D.sub=D.subtract,D.multiply=function(e){if(this.isZero())return Hb;if(mb(e)||(e=Wb(e)),Qb){var t=Qb.mul(this.low,this.high,e.low,e.high);return ya(t,Qb.get_high(),this.unsigned)}if(e.isZero())return Hb;if(this.eq(nb))return e.isOdd()?nb:Hb;if(e.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(wq)&&e.lt(wq))return Gb(this.toNumber()*e.toNumber(),this.unsigned);var n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,a=65535&e.high,s=e.low>>>16,c=i*(e=65535&e.low),u=(c>>>16)+r*e,l=u>>>16;l+=(u=(65535&u)+i*s)>>>16;var d=(l+=n*e)>>>16;return ya((65535&u)<<16|65535&c,(d=(d+=(l=(65535&l)+r*s)>>>16)+((l=(65535&l)+i*a)>>>16)+((t=this.high>>>16)*e+n*s+r*a+i*o)&65535)<<16|65535&l,this.unsigned)},D.mul=D.multiply,D.divide=function(e){if(mb(e)||(e=Wb(e)),e.isZero())throw Error("division by zero");if(Qb)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?ya(e=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Cd;if(e.gt(this.shru(1)))return xq;var t=Cd}else{if(this.eq(nb)){if(e.eq(Ue)||e.eq(Kk))return nb;if(e.eq(nb))return Ue;var n=this.shr(1).div(e).shl(1);if(n.eq(Hb))return e.isNegative()?Ue:Kk;var r=this.sub(e.mul(n));return n.add(r.div(e))}if(e.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();t=Hb}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));var i=Math.ceil(Math.log(n)/Math.LN2);i=48>=i?1:sg(2,i-48);for(var o=Gb(n),a=o.mul(e);a.isNegative()||a.gt(r);)a=(o=Gb(n-=i,this.unsigned)).mul(e);o.isZero()&&(o=Ue),t=t.add(o),r=r.sub(a)}return t},D.div=D.divide,D.modulo=function(e){return mb(e)||(e=Wb(e)),Qb?ya(e=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(e){return mb(e)||(e=Wb(e)),ya(this.low&e.low,this.high&e.high,this.unsigned)},D.or=function(e){return mb(e)||(e=Wb(e)),ya(this.low|e.low,this.high|e.high,this.unsigned)},D.xor=function(e){return mb(e)||(e=Wb(e)),ya(this.low^e.low,this.high^e.high,this.unsigned)},D.shiftLeft=function(e){return mb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?ya(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ya(0,this.low<<e-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(e){return mb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?ya(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ya(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(e){if(mb(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return 32>e?ya(this.low>>>e|t<<32-e,t>>>e,this.unsigned):ya(32===e?t:t>>>e-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},D.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},xa.fromBytes=function(e,t,n){return n?xa.fromBytesLE(e,t):xa.fromBytesBE(e,t)},xa.fromBytesLE=function(e,t){return new xa(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},xa.fromBytesBE=function(e,t){return new xa(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var di=function(e,t){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e?console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=e},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(e){},error:function(e){if(Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)},complete:function(){}},Jb=Array.isArray||function(e){return e&&"number"==typeof e.length},lf=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),Oa=function(){function e(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){if(!this.closed){var t=this._parentOrParents,n=this._ctorUnsubscribe,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,t instanceof e)t.remove(this);else if(null!==t)for(var o=0;o<t.length;++o)t[o].remove(this);if(le(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(e){var a=e instanceof lf?Xl(e.errors):[e]}}if(Jb(i))for(o=-1,t=i.length;++o<t;)if(ei(n=i[o]))try{n.unsubscribe()}catch(e){a=a||[],e instanceof lf?a=a.concat(Xl(e.errors)):a.push(e)}if(a)throw new lf(a)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(X(t)){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof e||(t=n,(n=new e)._subscriptions=[t]);break;default:throw Error("unrecognized teardown "+t+" added to Subscription.")}if(null===(t=n._parentOrParents))n._parentOrParents=this;else if(t instanceof e){if(t===this)return n;n._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return n;t.push(this)}return null===(t=this._subscriptions)?this._subscriptions=[n]:t.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;t&&-1!==(e=t.indexOf(e))&&t.splice(e,1)},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),Fh="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=Eh;break;case 1:if(!n){o.destination=Eh;break}if("object"===X(n)){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new yq(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new yq(o,n,r,i)}return o}return O(t,e),t.prototype[Fh]=function(){return this},t.create=function(e,n,r){return(e=new t(e,n,r)).syncErrorThrowable=!1,e},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=e,this},t}(Oa),yq=function(e){function t(t,n,r,i){var o=e.call(this)||this;if(o._parentSubscriber=t,t=o,le(n))var a=n;else n&&(a=n.next,r=n.error,i=n.complete,n!==Eh&&(le((t=Object.create(n)).unsubscribe)&&o.add(t.unsubscribe.bind(t)),t.unsubscribe=o.unsubscribe.bind(o)));return o._context=t,o._next=a,o._error=r,o._complete=i,o}return O(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?this.__tryOrSetError(t,this._error,e):this.__tryOrUnsub(this._error,e),this.unsubscribe();else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):me(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;me(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};Ib.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,n):this.__tryOrUnsub(n)}this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{t.call(this._context,n)}catch(t){return Ib.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0):me(t),!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._parentSubscriber=this._context=null,e.unsubscribe()},t}(ia),ne="function"==typeof Symbol&&Symbol.observable||"@@observable",Y=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator;e:{if(e){if(e instanceof ia)break e;if(e[Fh]){e=e[Fh]();break e}}e=e||t||n?new ia(e,t,n):new ia(Eh)}if(e.add(r?r.call(e,this.source):this.source||Ib.useDeprecatedSynchronousErrorHandling&&!e.syncErrorThrowable?this._subscribe(e):this._trySubscribe(e)),Ib.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable&&(e.syncErrorThrowable=!1,e.syncErrorThrown))throw e.syncErrorValue;return e},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){Ib.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),fi(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Zl(t))(function(t,r){var i=n.subscribe(function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}},r,t)})},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[ne]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Yl(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Zl(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}(),qd=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),zq=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return O(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;this.subject=null,!t||0===t.length||e.isStopped||e.closed||-1!==(e=t.indexOf(this.subscriber))&&t.splice(e,1)}},t}(Oa),Aq=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return O(t,e),t}(ia),Pa=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return O(t,e),t.prototype[Fh]=function(){return new Aq(this)},t.prototype.lift=function(e){var t=new Bq(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new qd;if(!this.isStopped){var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].next(e)}},t.prototype.error=function(e){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=e,this.isStopped=!0;var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var e=this.observers,t=e.length;e=e.slice();for(var n=0;n<t;n++)e[n].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new qd;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new qd;return this.hasError?(e.error(this.thrownError),Oa.EMPTY):this.isStopped?(e.complete(),Oa.EMPTY):(this.observers.push(e),new zq(this,e))},t.prototype.asObservable=function(){var e=new Y;return e.source=this,e},t.create=function(e,t){return new Bq(e,t)},t}(Y),Bq=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return O(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):Oa.EMPTY},t}(Pa),Ns=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;return n._refCount++,e=new cz(e,n),t=t.subscribe(e),e.closed||(e.connection=n.connect()),t},e}(),cz=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return O(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null},t}(ia),Cq=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return O(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),e.closed&&(this._connection=null,e=Oa.EMPTY)),e},t.prototype.refCount=function(){return $l()(this)},t}(Y),At=function(){var e=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),dz=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return O(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(Aq);!function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}O(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null}}(ia),function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).keySelector=n,t.elementSelector=r,t.durationSelector=i,t.subjectSelector=o,t.groups=null,t.attemptedToUnsubscribe=!1,t.count=0,t}O(t,e),t.prototype._next=function(e){try{var t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r=n.get(t);if(this.elementSelector)try{var i=this.elementSelector(e)}catch(e){this.error(e)}else i=e;if(!r&&(r=this.subjectSelector?this.subjectSelector():new Pa,n.set(t,r),e=new Mk(t,r,this),this.destination.next(e),this.durationSelector)){e=void 0;try{e=this.durationSelector(new Mk(t,r))}catch(e){return void this.error(e)}this.add(e.subscribe(new ez(t,r,this)))}r.closed||r.next(i)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach(function(t,n){t.error(e)}),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach(function(e,t){e.complete()}),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))}}(ia);var ez=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return O(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(ia),Mk=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return O(t,e),t.prototype._subscribe=function(e){var t=new Oa,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new fz(n)),t.add(r.subscribe(e)),t},t}(Y),fz=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return O(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),--t.count,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(Oa),gz=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return O(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Pa),dg=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return O(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.scheduler;return null!=(e=this.id)&&(this.id=this.recycleAsyncId(n,e,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(e=this._execute(e,t))?e:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},t.prototype._execute=function(e,t){t=!1;var n=void 0;try{this.work(e)}catch(e){t=!0,n=!!e&&e||Error(e)}if(t)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return O(t,e),t.prototype.schedule=function(e,t){return this},t}(Oa)),hz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),0<n?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return 0<n||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(dg),Nk=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),eg=function(e){function t(n,r){void 0===r&&(r=Nk.now);var i=e.call(this,n,function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()})||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return O(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(Nk),fg=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t}(eg))(hz),vb=new Y(function(e){return e.complete()}),am=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}},Ok;!function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(Ok||(Ok={}));var Ve=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Rs=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new Dq(e,this.scheduler,this.delay))},e}(),Dq=function(e){function t(t,n,r){return void 0===r&&(r=0),(t=e.call(this,t)||this).scheduler=n,t.delay=r,t}return O(t,e),t.dispatch=function(e){e.notification.observe(e.destination),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new iz(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(Ve.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(Ve.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},t}(ia),iz=function(e,t){this.notification=e,this.destination=t},qe=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=1>t?1:t,i._windowTime=1>n?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return O(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new jz(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t=this._infiniteTimeWindow,n=t?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var o=Oa.EMPTY;else this.observers.push(e),o=new zq(this,e);if(r&&e.add(e=new Dq(e,r)),t)for(t=0;t<i&&!e.closed;t++)e.next(n[t]);else for(t=0;t<i&&!e.closed;t++)e.next(n[t].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),o},t.prototype._getNow=function(){return(this.scheduler||fg).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),0<o&&r.splice(0,o),r},t}(Pa),jz=function(e,t){this.time=e,this.value=t},of=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return O(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),Oa.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(e){var t=kz++;return ii[t]=!0,lz.then(function(){return bm(t)&&e()}),t},clearImmediate:function(e){bm(e)}},mz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=Eq.setImmediate(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(Eq.clearImmediate(n),t.scheduled=void 0)},t}(dg),ri=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return O(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(function(){return t.flush(null)})))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(dg),Fq=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(eg))(oz),pz=function(e){function t(t,n){void 0===t&&(t=Gq),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,function(){return r.frame})||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return O(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(eg),Gq=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return O(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),this.delay=e.frame+r,(e=e.actions).push(this),e.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(dg),Qk=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),vg=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),pb=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),Ss=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new qz(e,this.project,this.thisArg))},e}(),qz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).project=n,t.count=0,t.thisArg=r||t,t}return O(t,e),t.prototype._next=function(e){try{var t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ia),Rk=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(ia),Xs=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return O(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(ia),rz=function(e){return function(t){return e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,me),t}},$c="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(e){return function(t){for(var n=e[$c]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add(function(){n.return&&n.return()}),t}},tz=function(e){return function(t){var n=e[ne]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}},hm=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},pf=function(e){if(e&&"function"==typeof e[ne])return tz(e);if(hm(e))return am(e);if(fm(e))return rz(e);if(e&&"function"==typeof e[$c])return sz(e);throw e=ei(e)?"an invalid object":"'"+e+"'",new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new uz(e,this.resultSelector))},e}(),uz=function(e){function t(t,n){return(t=e.call(this,t)||this).resultSelector=n,t.active=0,t.values=[],t.observables=[],t}return O(t,e),t.prototype._next=function(e){this.values.push(Hq),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.toRespond=this.active=t;for(var n=0;n<t;n++)this.add(ji(this,e[n],void 0,n))}},t.prototype.notifyComplete=function(e){0==--this.active&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=(e=this.values)[n];r=this.toRespond?r===Hq?--this.toRespond:this.toRespond:0,e[n]=t,0===r&&(this.resultSelector?this._tryResultSelector(e):this.destination.next(e.slice()))},t.prototype._tryResultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Rk),vc=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return O(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(ia);!function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i}O(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(ia);var wc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(ia);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}O(t,e),t.prototype.notifyNext=function(e,t,n,r){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()}}(ia);var at=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new wz(e,this.project,this.concurrent))},e}(),wz=function(e){function t(t,n,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),(t=e.call(this,t)||this).project=n,t.concurrent=r,t.hasCompleted=!1,t.buffer=[],t.active=0,t.index=0,t}return O(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new vc(this),n=this.destination;n.add(t),(e=ic(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,0<e.length?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(wc),Sk=y.parseFloat,Iq=-1/0!=1/Sk("\t\n\v\f\r \u2028\u2029\ufeff-0")?function(e){e=ik(String(e));var t=Sk(e);return 0===t&&"-"==e.charAt(0)?-0:t}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new xz(e,this.predicate,this.thisArg))},e}(),xz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.thisArg=r,t.count=0,t}return O(t,e),t.prototype._next=function(e){try{var t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(ia),gt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new yz(e))},e}(),yz=function(e){function t(t){return(t=e.call(this,t)||this).hasFirst=!1,t.observables=[],t.subscriptions=[],t}return O(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=ji(this,e[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){for(this.hasFirst=!0,e=0;e<this.subscriptions.length;e++)if(e!==n){var r=this.subscriptions[e];r.unsubscribe(),this.remove(r)}this.subscriptions=null}this.destination.next(t)},t}(Rk),jt=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new zz(e,this.resultSelector))},e}(),zz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).resultSelector=n,t.iterators=[],t.active=0,t.resultSelector="function"==typeof n?n:void 0,t}return O(t,e),t.prototype._next=function(e){var t=this.iterators;Jb(e)?t.push(new Az(e)):t.push("function"==typeof e[$c]?new Bz(e[$c]()):new Cz(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0===t)this.destination.complete();else{this.active=t;for(var n=0;n<t;n++){var r=e[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){var i=e[r];if("function"==typeof i.hasValue&&!i.hasValue())return}var o=!1,a=[];for(r=0;r<t;r++){var s=(i=e[r]).next();if(i.hasCompleted()&&(o=!0),s.done)return void n.complete();a.push(s.value)}this.resultSelector?this._tryresultSelector(a):n.next(a),o&&n.complete()},t.prototype._tryresultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(ia),Bz=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return!(!e||!e.done)},e}(),Az=function(){function e(e){this.array=e,this.length=this.index=0,this.length=e.length}return e.prototype[$c]=function(){return this},e.prototype.next=function(e){return(e=this.index++)<this.length?{value:this.array[e],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),Cz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).parent=n,t.observable=r,t.stillUnsubscribed=!0,t.buffer=[],t.isComplete=!1,t}return O(t,e),t.prototype[$c]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return 0<this.buffer.length},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return ic(this.observable,new vc(this))},t}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(e){return!!e&&(e instanceof Y||"function"==typeof e.lift&&"function"==typeof e.subscribe)},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=t=void 0;return Zc(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&Jb(e[0])&&(e=e[0]),nf(e,n).lift(new vz(t))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(e,t,n,r,i){if(1==arguments.length){var o=e.initialState;t=e.condition,n=e.iterate;var a=e.resultSelector||Yc;i=e.scheduler}else void 0===r||Zc(r)?(o=e,a=Yc,i=r):(o=e,a=r);return new Y(function(e){var r=o;if(i)return i.schedule(bt,0,{subscriber:e,iterate:n,condition:t,resultSelector:a,state:r});for(;;){if(t){var s=void 0;try{s=t(r)}catch(t){e.error(t);break}if(!s){e.complete();break}}s=void 0;try{s=a(r)}catch(t){e.error(t);break}if(e.next(s),e.closed)break;try{r=n(r)}catch(t){e.error(t);break}}})},iif:function(e,t,n){return void 0===t&&(t=vb),void 0===n&&(n=vb),ad(function(){return e()?t:n})},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(e,t){return new Y(t?function(n){var r=Object.keys(e),i=new Oa;return i.add(t.schedule(dt,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i}:function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})},partition:function(e,t,n){return[wb(t,n)(new Y(pf(e))),wb(et(t,n))(new Y(pf(e)))]},race:Ca,range:function(e,t,n){return void 0===e&&(e=0),new Y(function(r){void 0===t&&(t=e,e=0);var i=0,o=e;if(n)return n.schedule(ht,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(o++),r.closed)break}})},throwError:Z,timer:Bc,using:function(e,t){return new Y(function(n){try{var r=e()}catch(e){return void n.error(e)}try{var i=t(r)}catch(e){return void n.error(e)}var o=(i?Kb(i):vb).subscribe(n);return function(){o.unsubscribe(),r&&r.unsubscribe()}})},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ez(e,this.selector,this.caught))},e}(),Ez=function(e){function t(t,n,r){return(t=e.call(this,t)||this).selector=n,t.caught=r,t}return O(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle(),t=new vc(this),this.add(t),(n=ic(n,t))!==t&&this.add(n)}},t}(wc),lt=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new Fz(e,this.defaultValue))},e}(),Fz=function(e){function t(t,n){return(t=e.call(this,t)||this).defaultValue=n,t.isEmpty=!0,t}return O(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(ia),mt=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Gz(e,this.delay,this.scheduler))},e}(),Gz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).delay=n,t.scheduler=r,t.queue=[],t.active=!1,t.errored=!1,t}return O(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;0<n.length&&0>=n[0].time-r.now();)n.shift().notification.observe(i);0<n.length?(t=Math.max(0,n[0].time-r.now()),this.schedule(e,t)):(this.unsubscribe(),t.active=!1)},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler;e=new Hz(t.now()+this.delay,e),this.queue.push(e),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(Ve.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},t}(ia),Hz=function(e,t){this.time=e,this.notification=t},nt=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new Iz(e,this.keySelector,this.flushes))},e}(),Iz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).keySelector=n,t.values=new Set,r&&t.add(ic(r,new vc(t))),t}return O(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t=this.destination;try{var n=this.keySelector(e)}catch(e){return void t.error(e)}this._finalizeNext(n,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(wc),pt=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new Jz(e,this.errorFactory))},e}(),Jz=function(e){function t(t,n){return(t=e.call(this,t)||this).errorFactory=n,t.hasValue=!1,t}return O(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(ia),qt=function(){function e(e){if(this.total=e,0>this.total)throw new Qk}return e.prototype.call=function(e,t){return t.subscribe(new Kz(e,this.total))},e}(),Kz=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.count=0,t}return O(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(ia),rt=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Lz(e,this.project))},e}(),Lz=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.hasSubscription=!1,t.hasCompleted=!1,t.index=0,t}return O(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.hasSubscription=!0,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new vc(this),n=this.destination;n.add(t),(e=ic(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(wc),st=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new Mz(e,this.callback))},e}(),Mz=function(e){function t(t,n){return(t=e.call(this,t)||this).add(new Oa(n)),t}return O(t,e),t}(ia),ut=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Nz(e))},e}(),Nz=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return O(t,e),t.prototype._next=function(e){},t}(ia),vt=function(){function e(e){if(this.total=e,0>this.total)throw new Qk}return e.prototype.call=function(e,t){return t.subscribe(new Oz(e,this.total))},e}(),Oz=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.ring=[],t.count=0,t}return O(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(0<t)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()},t}(ia),wt=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new Pz(e,this.value))},e}(),Pz=function(e){function t(t,n){return(t=e.call(this,t)||this).value=n,t}return O(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(ia),xt=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new Qz(e,this.accumulator,this.seed,this.hasSeed))},e}(),Qz=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this).accumulator=n,t._seed=r,t.hasSeed=i,t.index=0,t}return O(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.accumulator(this.seed,e,t)}catch(e){this.destination.error(e)}this.seed=n,this.destination.next(n)},t}(ia),zt=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory();return(e=n(r).subscribe(e)).add(t.subscribe(r)),e},e}(),Bt=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Rz(e,this.notifier,this.source))},e}(),Rz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).notifier=n,t.source=r,t}return O(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.retriesSubscription=this.errors=void 0;else{n=new Pa;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}i=ic(r,new vc(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(wc),Et=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Sz(e,this.project))},e}(),Sz=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.index=0,t}return O(t,e),t.prototype._next=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this._innerSub(n)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe(),t=new vc(this);var n=this.destination;n.add(t),this.innerSubscription=ic(e,t),this.innerSubscription!==t&&n.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(wc),Ft=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){e=new Tz(e);var n=ic(this.notifier,new vc(e));return n&&!e.seenValue?(e.add(n),t.subscribe(e)):e},e}(),Tz=function(e){function t(t){return(t=e.call(this,t)||this).seenValue=!1,t}return O(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(wc),Ht=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new Uz(e,this.predicate,this.inclusive))},e}(),Uz=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.inclusive=r,t.index=0,t}return O(t,e),t.prototype._next=function(e){var t=this.destination;try{var n=this.predicate(e,this.index++)}catch(e){return void t.error(e)}this.nextOrComplete(e,n)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;t?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(ia),It=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new Vz(e,this.nextOrObserver,this.error,this.complete))},e}(),Vz=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this)._tapNext=hc,t._tapError=hc,t._tapComplete=hc,t._tapError=r||hc,t._tapComplete=i||hc,le(n)?(t._context=t,t._tapNext=n):n&&(t._context=n,t._tapNext=n.next||hc,t._tapError=n.error||hc,t._tapComplete=n.complete||hc),t}return O(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(ia),Kt={leading:!0,trailing:!1};!function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}O(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._sendValue;this._hasValue&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=void 0},t.prototype.throttle=function(e){(e=this.tryDurationSelector(e))&&this.add(this._throttled=ic(e,new vc(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()}}(wc);for(var Lt=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new Wz(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),Wz=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).duration=n,t.scheduler=r,t.leading=i,t.trailing=o,t._hasTrailingValue=!1,t._trailingValue=null,t}return O(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(ia),Ot=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new Xz(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Xz=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).absoluteTimeout=n,t.waitFor=r,t.withObservable=i,t.scheduler=o,t.scheduleTimeout(),t}return O(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(ic(t,new vc(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},t}(wc),Qt=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new Yz(e,this.observables,this.project))},e}(),Yz=function(e){function t(t,n,r){(t=e.call(this,t)||this).observables=n,t.project=r,t.toRespond=[],r=n.length,t.values=Array(r);for(var i=0;i<r;i++)t.toRespond.push(i);for(i=0;i<r;i++)t.add(ji(t,n[i],void 0,i));return t}return O(t,e),t.prototype.notifyNext=function(e,t,n){this.values[n]=t,0<(e=this.toRespond).length&&-1!==(n=e.indexOf(n))&&e.splice(n,1)},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){0===this.toRespond.length&&(e=[e].concat(this.values),this.project?this._tryProject(e):this.destination.next(e))},t.prototype._tryProject=function(e){try{var t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Rk),Jq=$a(function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=Array(16);e.exports=function(){for(var e,t=0;16>t;t++)!(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}}),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(e,t){return t=t||0,[ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],"-",ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]],ab[e[t++]]].join("")},Ud=function(e,t,n){if(n=t&&n||0,"string"==typeof e&&(t="binary"===e?Array(16):null,e=null),(e=(e=e||{}).random||(e.rng||Jq)())[6]=15&e[6]|64,e[8]=63&e[8]|128,t)for(var r=0;16>r;++r)t[n+r]=e[r];return t||Kq(e)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;!function(e){e[e.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e[e.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e[e.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e[e.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e[e.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"}(Pc||(Pc={})),function(e){e[e.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e[e.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e[e.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e[e.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e[e.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e[e.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(e){e[e.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(e){e[e.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(e){e[e.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e[e.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e[e.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e[e.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e[e.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e[e.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(e){e[e.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e[e.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e[e.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e[e.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e[e.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(e){e[e.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e[e.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e[e.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e[e.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e[e.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e[e.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e[e.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(e){e[e.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e[e.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e[e.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e[e.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(e){e[e.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e[e.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e[e.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e[e.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e[e.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e[e.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e[e.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e[e.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e[e.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e[e.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e[e.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(e){e[e.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(e){e[e.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e[e.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e[e.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e[e.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e[e.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e[e.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e[e.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(e){e[e.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(e){e[e.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e[e.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e[e.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e[e.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e[e.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e[e.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e[e.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e[e.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(e){e[e.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(e){e[e.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e[e.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e[e.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e[e.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(e){e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(e){e[e.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",e[e.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",e[e.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",e[e.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",e[e.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(e){e[e.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",e[e.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",e[e.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",e[e.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",e[e.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW,Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE,ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT,Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT,Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT,aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED,dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE,hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED,Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED,kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT,oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT,pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT,sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT,vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT,gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN,lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(e,t){var n;return Hk(e,function(e,r,i){return!(n=t(e,r,i))}),!!n},Mh=function(e,t,n){if(!lb(n))return!1;var r=X(t);return!!("number"==r?Ed(n)&&wk(t,n.length):"string"==r&&t in n)&&$f(n[t],e)},dl=function(e,t,n){var r=Va(e)?tq:DA;return n&&Mh(e,t,n)&&(t=void 0),r(e,Te(t))},EA=function(e,t){var n=-1,r=Ed(e)?Array(e.length):[];return Hk(e,function(e,i,o){r[++n]=t(e,i,o)}),r},FA=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e},GA=function(e,t,n){t=t.length?he(t,function(e){return Va(e)?function(t){return Ch(t,1===e.length?e[0]:e)}:e}):[Dh];var r=-1;return t=he(t,zh(Te)),e=EA(e,function(e,n,i){return{criteria:he(t,function(t){return t(e)}),index:++r,value:e}}),FA(e,function(e,t){e:{for(var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;++r<a;){t:{var c=i[r],u=o[r];if(c!==u){var l=void 0!==c,d=null===c,h=c==c,p=ie(c),f=void 0!==u,m=null===u,g=u==u,v=ie(u);if(!m&&!v&&!p&&c>u||p&&f&&g&&!m&&!v||d&&f&&g||!l&&g||!h){c=1;break t}if(!d&&!p&&!v&&c<u||v&&l&&h&&!d&&!p||m&&l&&h||!f&&h||!g){c=-1;break t}}c=0}if(c){e=r>=s?c:c*("desc"==n[r]?-1:1);break e}}e=e.index-t.index}return e})},jr=function(e,t){return rq(qq(e,t,Dh),e+"")},kr=jr(function(e,t){if(null==e)return[];var n=t.length;return 1<n&&Mh(e,t[0],t[1])?t=[]:2<n&&Mh(t[0],t[1],t[2])&&(t=[t[0]]),GA(e,$h(t,1),[])}),lr=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}),t}(Dz),mr=$a(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=[],r=function(e,t){return new WebSocket(e,t)};t.normalClosureMessage="Normal closure",t.default=function(e,i){var o=(i=void 0===i?{protocols:n,makeWebSocket:r}:i).protocols,a=void 0===o?n:o,s=void 0===(i=i.makeWebSocket)?r:i;return new lr.Observable(function(n){var r,i=new lr.Subject,o=s(e,a),c=!1,u=!1,l=function(e){if(r)throw c=!0,e=Error("Web socket message factory function called more than once"),n.error(e),e;return r=e.subscribe(function(e){o.send(e)}),i};return o.onopen=function(){u?(c=!0,o.close()):n.next(l)},o.onmessage=function(e){i.next(e.data)},o.onerror=function(e){c=!0,n.error(Error(e.message))},o.onclose=function(e){c||(c=!0,u?(n.complete(),i.complete()):n.error(Error(1e3===e.code?t.normalClosureMessage:e.reason)))},function(){u=!0,r&&r.unsubscribe(),c||(c=!0,o.close())}})}});!function(e){e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")}(mr);var pi=function(e,t,n){(void 0===n||$f(e[t],n))&&(void 0!==n||t in e)||bg(e,t,n)},oi=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},HA=function(e){return jr(function(t,n){var r=-1,i=n.length,o=1<i?n[i-1]:void 0,a=2<i?n[2]:void 0;for(o=3<e.length&&"function"==typeof o?(i--,o):void 0,a&&Mh(n[0],n[1],a)&&(o=3>i?void 0:o,i=1),t=Object(t);++r<i;)(a=n[r])&&e(t,a,r,o);return t})}(function(e,t,n,r){tm(e,t,n,r)}),IA=Math.floor,JA=Math.random,nr=function(e,t){return e+IA(JA()*(t-e+1))},or=function(e){var t=e.length;return t?e[nr(0,t-1)]:void 0},KA=function(e,t){return he(t,function(t){return e[t]})},Ni=function(e){return null==e?[]:KA(e,Ad(e))},LA=function(e){return or(Ni(e))},bn=function(e){return(Va(e)?or:LA)(e)},xm=[],ym=function(e,t){return new WebSocket(e,t)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(e){return!ha(e)&&isFinite(e)&&MA(e)===e}}),Oo("from",Ej,Dj);var NA=function(e,t){for(var n=Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise(function(i,a){n[r]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,a(e))}})},OA=$a(function(e,t){t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;1<--t%4&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};var n=Array(64),r=Array(123);for(e=0;64>e;)r[n[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;t.encode=function(e,t,r){for(var i,o=null,a=[],s=0,c=0;t<r;){var u=e[t++];switch(c){case 0:a[s++]=n[u>>2],i=(3&u)<<4,c=1;break;case 1:a[s++]=n[i|u>>4],i=(15&u)<<2,c=2;break;case 2:a[s++]=n[i|u>>6],a[s++]=n[63&u],c=0}8191<s&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return c&&(a[s++]=n[i],a[s++]=61,1===c&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))},t.decode=function(e,t,n){for(var i,o=n,a=0,s=0;s<e.length;){var c=e.charCodeAt(s++);if(61===c&&1<a)break;if(void 0===(c=r[c]))throw Error("invalid encoding");switch(a){case 0:i=c,a=1;break;case 1:t[n++]=i<<2|(48&c)>>4,i=c,a=2;break;case 2:t[n++]=(15&i)<<4|(60&c)>>2,i=c,a=3;break;case 3:t[n++]=(3&i)<<6|c,a=0}}if(1===a)throw Error("invalid encoding");return n-o},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});yg.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},yg.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else{e=this._listeners[e];for(var n=0;n<e.length;)e[n].fn===t?e.splice(n,1):++n}return this},yg.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(e){}return null},RA=$a(function(e,t){t.length=function(e){for(var t,n=0,r=0;r<e.length;++r)128>(t=e.charCodeAt(r))?n+=1:2048>t?n+=2:55296==(64512&t)&&56320==(64512&e.charCodeAt(r+1))?(++r,n+=4):n+=3;return n},t.read=function(e,t,n){if(1>n-t)return"";for(var r,i=null,o=[],a=0;t<n;)128>(r=e[t++])?o[a++]=r:191<r&&224>r?o[a++]=(31&r)<<6|63&e[t++]:239<r&&365>r?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(r>>10),o[a++]=56320+(1023&r)):o[a++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],8191<a&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},t.write=function(e,t,n){for(var r,i,o=n,a=0;a<e.length;++a)128>(r=e.charCodeAt(a))?t[n++]=r:(2048>r?t[n++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(a+1)))?(++a,t[n++]=(r=65536+((1023&r)<<10)+(1023&i))>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-o}}),SA=function(e,t,n){var r=n||8192,i=r>>>1,o=null,a=r;return function(n){return 1>n||n>i?e(n):(a+n>r&&(o=e(r),a=0),n=t.call(o,a,a+=n),7&a&&(a=1+(7|a)),n)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(e){if(0===e)return Xd;var t=0>e;t&&(e=-e);var n=e>>>0;return e=(e-n)/4294967296>>>0,t&&(e=~e>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++e&&(e=0))),new Wa(n,e)},Wa.from=function(e){if("number"==typeof e)return Wa.fromNumber(e);if(V.isString(e)){if(!V.Long)return Wa.fromNumber(parseInt(e,10));e=V.Long.fromString(e)}return e.low||e.high?new Wa(e.low>>>0,e.high>>>0):Xd},Wa.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.hi>>>0;return(e=1+~this.lo>>>0)||(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(e){return V.Long?new V.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var td=String.prototype.charCodeAt;Wa.fromHash=function(e){return e===TA?Xd:new Wa((td.call(e,0)|td.call(e,1)<<8|td.call(e,2)<<16|td.call(e,3)<<24)>>>0,(td.call(e,4)|td.call(e,5)<<8|td.call(e,6)<<16|td.call(e,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},Wa.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},Wa.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?16384>e?128>e?1:2:2097152>e?3:4:16384>t?128>t?5:6:2097152>t?7:8:128>n?9:10};var V=$a(function(e,t){function n(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function r(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=NA,t.base64=OA,t.EventEmitter=yg,t.float=PA,t.inquire=QA,t.utf8=RA,t.pool=SA,t.LongBits=Wa,t.isNode=!!(void 0!==Ya&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),t.global=t.isNode&&Ya||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||Ya,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"===X(e)},t.isset=t.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==X(n)||0<(Array.isArray(n)?n.length:Object.keys(n).length))},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,n){return e=t.LongBits.fromHash(e),t.Long?t.Long.fromBits(e.lo,e.hi,n):e.toNumber(!!n)},t.merge=n,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=r,t.ProtocolError=r("ProtocolError"),t.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;-1<n;--n)if(1===t[e[n]]&&null!=this[e[n]])return e[n]}},t.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}}),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(e){return new V.Array(e)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(e,t,n){return this.tail=this.tail.next=new sf(e,t,n),this.len+=t,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(e,t,n){for(;127<e;)t[n++]=127&e|128,e>>>=7;t[n]=e},ja.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new ui(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},ja.prototype.int32=function(e){return 0>e?this._push(vi,10,Nh.fromNumber(e)):this.uint32(e)},ja.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ja.prototype.uint64=function(e){return e=Nh.from(e),this._push(vi,e.length(),e)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(e){return e=Nh.from(e).zzEncode(),this._push(vi,e.length(),e)},ja.prototype.bool=function(e){return this._push(ti,1,e?1:0)},ja.prototype.fixed32=function(e){return this._push(wi,4,e>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(e){return e=Nh.from(e),this._push(wi,4,e.lo)._push(wi,4,e.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(e){return this._push(V.float.writeFloatLE,4,e)},ja.prototype.double=function(e){return this._push(V.float.writeDoubleLE,8,e)};var UA=V.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};ja.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(ti,1,0);if(V.isString(e)){var n=ja.alloc(t=pr.length(e));pr.decode(e,n,0),e=n}return this.uint32(t)._push(UA,t,e)},ja.prototype.string=function(e){var t=qr.length(e);return t?this.uint32(t)._push(qr.write,t,e):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},ja.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},ja._configure=function(e){el=e,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&"set"===V.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},jc.prototype.bytes=function(e){V.isString(e)&&(e=V._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(jc.writeBytesBuffer,t,e),this},jc.prototype.string=function(e){var t=V.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Ut,t,e),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new La(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new La(e);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(e){return(La.create=function(e){return V.Buffer.isBuffer(e)?new fl(e):sr(e)})(e)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return e}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},La.prototype.bool=function(){return 0!==this.uint32()},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var e=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var e=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},La.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Yb(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},La.prototype.string=function(){var e=this.bytes();return VA.read(e,0,e.length)},La.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw Yb(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw Yb(this)}while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},La._configure=function(e){fl=e,La.create=tr(),fl._configure();var t=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[t](!1)},uint64:function(){return yi.call(this)[t](!0)},sint64:function(){return yi.call(this).zzDecode()[t](!1)},fixed64:function(){return Fm.call(this)[t](!0)},sfixed64:function(){return Fm.call(this)[t](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function e(t,n,r,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return V.asPromise(e,a,t,n,r,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof r))try{n=r[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)})}catch(e){a.emit("error",e,t),setTimeout(function(){o(e)},0)}else setTimeout(function(){o(Error("already ended"))},0)},tf.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a(function(e,t){t.Service=tf}),XA={},fc=$a(function(e,t){function n(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}var r=t;r.build="minimal",r.Writer=xi,r.BufferWriter=jc,r.Reader=zi,r.BufferReader=Fd,r.util=V,r.rpc=WA,r.roots=XA,r.configure=n,n()});fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var e={},t=Object.create(e);return t[e[0]="Unknown"]=0,t[e[1]="PingUri"]=1,t[e[2]="PongUri"]=2,t[e[11]="UserJoinUri"]=11,t[e[12]="UserRespUri"]=12,t[e[21]="UserQuitUri"]=21,t[e[22]="UserDropUri"]=22,t[e[31]="GroupEnterUri"]=31,t[e[32]="GroupLeaveUri"]=32,t[e[33]="GroupReplyUri"]=33,t[e[36]="GroupEnterNoticeUri"]=36,t[e[37]="GroupLeaveNoticeUri"]=37,t[e[38]="GroupEventNoticeUri"]=38,t[e[39]="GroupCountNoticeUri"]=39,t[e[41]="UserStatusListUri"]=41,t[e[42]="UserStatusResultUri"]=42,t[e[51]="GroupStatusListUri"]=51,t[e[52]="GroupStatusResultUri"]=52,t[e[55]="GroupAllUsersListUri"]=55,t[e[56]="GroupAllUsersResultUri"]=56,t[e[100]="MessageUri"]=100,t[e[101]="AckUri"]=101,t[e[115]="FileUploadIndexGetUri"]=115,t[e[116]="FileUploadIndexRetUri"]=116,t[e[117]="FileUploadIndexSetUri"]=117,t[e[118]="FileUploadIndexFinUri"]=118,t[e[119]="FileUploadIndexErrUri"]=119,t[e[125]="FileDownloadIndexGetUri"]=125,t[e[126]="FileDownloadIndexRetUri"]=126,t[e[127]="FileDownloadIndexErrUri"]=127,t[e[201]="UserJoinNoticeUri"]=201,t[e[202]="UserQuitNoticeUri"]=202,t[e[203]="UserWaitNoticeUri"]=203,t[e[301]="UserAttributeGetUri"]=301,t[e[302]="UserAttributeRetUri"]=302,t[e[303]="UserAttributeSetUri"]=303,t[e[304]="UserAttributeModUri"]=304,t[e[305]="UserAttributeDelUri"]=305,t[e[307]="UserAttributeRspUri"]=307,t[e[308]="UserAttributeErrUri"]=308,t[e[311]="UserAttributeKeysGetUri"]=311,t[e[312]="UserAttributeKeysRetUri"]=312,t[e[351]="GroupAttributeGetUri"]=351,t[e[352]="GroupAttributeRetUri"]=352,t[e[353]="GroupAttributeSetUri"]=353,t[e[354]="GroupAttributeModUri"]=354,t[e[355]="GroupAttributeDelUri"]=355,t[e[356]="GroupAttributeAltUri"]=356,t[e[357]="GroupAttributeRspUri"]=357,t[e[358]="GroupAttributeErrUri"]=358,t[e[361]="GroupAttributeKeysGetUri"]=361,t[e[362]="GroupAttributeKeysRetUri"]=362,t[e[401]="SubscribeUserStatusUri"]=401,t[e[402]="UnsubscribeUserStatusUri"]=402,t[e[499]="SubscribeResponseUri"]=499,t}(),Oh=t.Wrapper=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.uri=0,e.prototype.data=q.newBuffer([]),e.encode=function(e,t){return t||(t=L.create()),null!=e.uri&&Object.hasOwnProperty.call(e,"uri")&&t.uint32(8).int32(e.uri),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Wrapper;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.uri=e.int32();break;case 2:r.data=e.bytes();break;default:e.skipType(7&i)}}return r},e}(),ZA=t.Ping=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ping;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),$A=t.Pong=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Pong;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),aB=t.UserJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.opt&&Object.hasOwnProperty.call(e,"opt")&&t.uint32(16).uint64(e.opt),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(24).uint64(e.instance),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(34).string(e.account),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(42).string(e.ticket),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.opt=e.uint64();break;case 3:r.instance=e.uint64();break;case 4:r.account=e.string();break;case 5:r.ticket=e.string();break;default:e.skipType(7&i)}}return r},e}(),bB=t.UserResp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserResp;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),cB=t.UserQuit=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.encode=function(e,t){return t||(t=L.create()),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuit;e.pos<n;){var i=e.uint32();e.skipType(7&i)}return r},e}(),dB=t.UserDrop=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(8).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserDrop;e.pos<n;){var i=e.uint32();i>>>3==1?r.code=e.uint32():e.skipType(7&i)}return r},e}(),eB=t.GroupEnter=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnter;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),fB=t.GroupLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeave;e.pos<n;){var i=e.uint32();i>>>3==1?r.account=e.string():e.skipType(7&i)}return r},e}(),gB=t.GroupReply=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupReply;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),ur=t.GroupLeaveNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupLeaveNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),vr=t.GroupEnterNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupEnterNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.user=e.string();break;case 3:r.group=e.string();break;case 4:r.instance=e.uint64();break;case 5:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),wr=t.Message=function(){function e(e){if(this.MiscMap={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=q.newBuffer([]),e.prototype.MiscMap=q.emptyObject,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){if(t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.options&&Object.hasOwnProperty.call(e,"options")&&t.uint32(32).uint64(e.options),null!=e.src&&Object.hasOwnProperty.call(e,"src")&&t.uint32(42).string(e.src),null!=e.dst&&Object.hasOwnProperty.call(e,"dst")&&t.uint32(50).string(e.dst),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(58).bytes(e.payload),null!=e.MiscMap&&Object.hasOwnProperty.call(e,"MiscMap"))for(var n=Object.keys(e.MiscMap),r=0;r<n.length;++r)t.uint32(66).fork().uint32(10).string(n[r]).uint32(18).bytes(e.MiscMap[n[r]]).ldelim();return null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(72).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r,i,o=new t.Message;e.pos<n;)switch(r=e.uint32(),r>>>3){case 1:o.instance=e.uint64();break;case 2:o.dialogue=e.uint64();break;case 3:o.sequence=e.uint64();break;case 4:o.options=e.uint64();break;case 5:o.src=e.string();break;case 6:o.dst=e.string();break;case 7:o.payload=e.bytes();break;case 8:o.MiscMap===q.emptyObject&&(o.MiscMap={});var a=e.uint32()+e.pos;for(r="",i=[];e.pos<a;){var s=e.uint32();switch(s>>>3){case 1:r=e.string();break;case 2:i=e.bytes();break;default:e.skipType(7&s)}}o.MiscMap[r]=i;break;case 9:o.ms=e.uint64();break;default:e.skipType(7&r)}return o},e}(),xr=t.Ack=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(32).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.Ack;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.dialogue=e.uint64();break;case 3:r.sequence=e.uint64();break;case 4:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),hB=t.FileUploadIndexGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(18).bytes(e.hash),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(24).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),iB=t.FileUploadIndexRet=function(){function e(e){if(this.servers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(16).uint32(e.unit),null!=e.servers&&e.servers.length){t.uint32(26).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),jB=t.FileUploadIndexSet=function(){function e(e){if(this.servers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(18).bytes(e.hash),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(24).uint32(e.unit),null!=e.servers&&e.servers.length){t.uint32(34).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.hash=e.bytes();break;case 3:r.unit=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),kB=t.FileUploadIndexFin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.unit=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(16).uint32(e.zone),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(24).uint32(e.unit),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexFin;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),lB=t.FileUploadIndexErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileUploadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),mB=t.FileDownloadIndexGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.prototype.unit=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(16).uint32(e.zone),null!=e.hash&&Object.hasOwnProperty.call(e,"hash")&&t.uint32(26).bytes(e.hash),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(40).uint32(e.unit),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.zone=e.uint32();break;case 3:r.hash=e.bytes();break;case 4:r.size=e.uint32();break;case 5:r.unit=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),nB=t.FileDownloadIndexRet=function(){function e(e){if(this.servers=[],this.backups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.zone=0,e.prototype.servers=q.emptyArray,e.prototype.backups=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.unit&&Object.hasOwnProperty.call(e,"unit")&&t.uint32(16).uint32(e.unit),null!=e.zone&&Object.hasOwnProperty.call(e,"zone")&&t.uint32(24).uint32(e.zone),null!=e.servers&&e.servers.length){t.uint32(34).fork();for(var n=0;n<e.servers.length;++n)t.uint32(e.servers[n]);t.ldelim()}if(null!=e.backups&&e.backups.length){for(t.uint32(42).fork(),n=0;n<e.backups.length;++n)t.uint32(e.backups[n]);t.ldelim()}return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.unit=e.uint32();break;case 3:r.zone=e.uint32();break;case 4:if(r.servers&&r.servers.length||(r.servers=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.servers.push(e.uint32());else r.servers.push(e.uint32());break;case 5:if(r.backups&&r.backups.length||(r.backups=[]),2==(7&i))for(i=e.uint32()+e.pos;e.pos<i;)r.backups.push(e.uint32());else r.backups.push(e.uint32());break;default:e.skipType(7&i)}}return r},e}(),oB=t.FileDownloadIndexErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.FileDownloadIndexErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),pB=t.GroupAllUsersList=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&t.uint32(24).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&t.uint32(32).uint32(e.pageNumber),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.pageSize=e.uint32();break;case 4:r.pageNumber=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),qB=t.GroupAllUsersResult=function(){function e(e){if(this.memberInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.totalSize&&Object.hasOwnProperty.call(e,"totalSize")&&n.uint32(24).uint32(e.totalSize),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&n.uint32(32).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&n.uint32(40).uint32(e.pageNumber),null!=e.memberInfos&&e.memberInfos.length)for(var r=0;r<e.memberInfos.length;++r)t.GroupAllUsersResult.MemberInfo.encode(e.memberInfos[r],n.uint32(50).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.totalSize=e.uint32();break;case 4:r.pageSize=e.uint32();break;case 5:r.pageNumber=e.uint32();break;case 6:r.memberInfos&&r.memberInfos.length||(r.memberInfos=[]),r.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.MemberInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAllUsersResult.MemberInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),rB=t.UserStatusList=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),sB=t.UserStatusResult=function(){function e(e){if(this.userInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.userInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.userInfos&&e.userInfos.length)for(var r=0;r<e.userInfos.length;++r)t.UserStatusResult.UserStatusInfo.encode(e.userInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.userInfos&&r.userInfos.length||(r.userInfos=[]),r.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.UserStatusInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserStatusResult.UserStatusInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.ts=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),tB=t.UserAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),uB=t.UserAttributeRet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeRet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),vB=t.UserAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),wB=t.UserAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&n.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.UserAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(26).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),xB=t.UserAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),yB=t.UserAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),zB=t.UserAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.account=e.string();break;default:e.skipType(7&i)}}return r},e}(),AB=t.UserAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),BB=t.UserAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserAttributeRsp;e.pos<n;){var i=e.uint32();i>>>3==1?r.seq=e.uint64():e.skipType(7&i)}return r},e}(),CB=t.GroupStatusList=function(){function e(e){if(this.groups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groups=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.groups&&e.groups.length)for(var n=0;n<e.groups.length;++n)t.uint32(18).string(e.groups[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusList;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groups&&r.groups.length||(r.groups=[]),r.groups.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),DB=t.GroupStatusResult=function(){function e(e){if(this.groupInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.groupInfos&&e.groupInfos.length)for(var r=0;r<e.groupInfos.length;++r)t.GroupStatusResult.GroupInfo.encode(e.groupInfos[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.groupInfos&&r.groupInfos.length||(r.groupInfos=[]),r.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.GroupInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.group="",e.prototype.memberCount=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(10).string(e.group),null!=e.memberCount&&Object.hasOwnProperty.call(e,"memberCount")&&t.uint32(16).uint32(e.memberCount),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupStatusResult.GroupInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.group=e.string();break;case 2:r.memberCount=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),EB=t.GroupCountNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupCountNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.group=e.string();break;case 4:r.size=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),FB=t.GroupAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),GB=t.GroupAttributeRet=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeRet.AttributeMap.encode(e.attributeMaps[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRet.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),HB=t.GroupAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeSet.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeSet.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),IB=t.GroupAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&n.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var r=0;r<e.attributeInfos.length;++r)t.GroupAttributeMod.AttributeInfo.encode(e.attributeInfos[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributeInfos&&r.attributeInfos.length||(r.attributeInfos=[]),r.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeMod.AttributeInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;default:e.skipType(7&i)}}return r},e}(),e}(),JB=t.GroupAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(34).string(e.attributes[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeDel;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.broadcast=e.bool();break;case 4:r.attributes&&r.attributes.length||(r.attributes=[]),r.attributes.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),KB=t.GroupAttributeAlt=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&n.uint32(18).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&n.uint32(24).uint64(e.instance),null!=e.attributeMaps&&e.attributeMaps.length)for(var r=0;r<e.attributeMaps.length;++r)t.GroupAttributeAlt.AttributeMap.encode(e.attributeMaps[r],n.uint32(34).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;case 3:r.instance=e.uint64();break;case 4:r.attributeMaps&&r.attributeMaps.length||(r.attributeMaps=[]),r.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeAlt.AttributeMap;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.key=e.string();break;case 2:r.value=e.string();break;case 3:r.origin=e.string();break;case 4:r.ms=e.uint64();break;default:e.skipType(7&i)}}return r},e}(),e}(),LB=t.GroupAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeRsp;e.pos<n;){var i=e.uint32();i>>>3==1?r.seq=e.uint64():e.skipType(7&i)}return r},e}(),MB=t.GroupAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeErr;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),NB=t.GroupAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(e,t){return t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysGet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.group=e.string();break;default:e.skipType(7&i)}}return r},e}(),OB=t.GroupAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.GroupAttributeKeysRet;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.keys&&r.keys.length||(r.keys=[]),r.keys.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),PB=t.SubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),QB=t.UnsubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(e,t){if(t||(t=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UnsubscribeUserStatus;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.users&&r.users.length||(r.users=[]),r.users.push(e.string());break;default:e.skipType(7&i)}}return r},e}(),RB=t.UserJoinNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserJoinNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),SB=t.UserQuitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserQuitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),TB=t.UserWaitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=L.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.UserWaitNotice;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.instance=e.uint64();break;case 2:r.seq=e.uint64();break;case 3:r.user=e.string();break;default:e.skipType(7&i)}}return r},e}(),UB=t.SubscribeResponse=function(){function e(e){if(this.errors=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.errors=q.emptyArray,e.encode=function(e,n){if(n||(n=L.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&n.uint32(8).uint64(e.seq),null!=e.errors&&e.errors.length)for(var r=0;r<e.errors.length;++r)t.SubscribeResponse.SubscribeErrorsType.encode(e.errors[r],n.uint32(18).fork()).ldelim();return n},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.seq=e.uint64();break;case 2:r.errors&&r.errors.length||(r.errors=[]),r.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return r},e.SubscribeErrorsType=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=L.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,n){e instanceof u||(e=u.create(e)),n=void 0===n?e.len:e.pos+n;for(var r=new t.SubscribeResponse.SubscribeErrorsType;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.account=e.string();break;case 2:r.code=e.uint32();break;default:e.skipType(7&i)}}return r},e}(),e}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(e){return function(t,n,r){var i=(t=String(jb(t))).length;return r=void 0===r?" ":String(r),(n=ta(n))<=i||""==r?t:((i=Pn.call(r,WB((n-=i)/r.length))).length>n&&(i=i.slice(0,n)),e?t+i:i+t)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(e){return YB(this,e,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(e){return function(t){t=qb(t);for(var n,r=Dc(t),i=r.length,o=0,a=[];i>o;)n=r[o++],ka&&!ZB.call(t,n)||a.push(e?[n,t[n]]:t[n]);return a}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(e){return $B(e)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var e=bC(String.prototype,"endsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(e){var t=String(jb(this));ck(e);var n=1<arguments.length?arguments[1]:void 0,r=ta(t.length);return n=void 0===n?r:cC(ta(n),r),r=String(e),Br?Br.call(t,r,n):t.slice(n-r.length,n)===r}}),dh("match",1,function(e,t,n){return[function(t){var n=jb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;if(e=va(e),r=String(this),!e.global)return Ke(e,r);var i=e.unicode;e.lastIndex=0;for(var o,a=[],s=0;null!==(o=Ke(e,r));)o=String(o[0]),a[s]=o,""===o&&(e.lastIndex=xj(r,ta(e.lastIndex),i)),s++;return 0===s?null:a}]});var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var e=eC(String.prototype,"startsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(e){var t=String(jb(this));ck(e);var n=ta(fC(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return Dr?Dr.call(t,r,n):t.slice(n,n+r.length)===r}});var Nm=function(e){var t=Array.prototype.slice.call(arguments,1);return t.length&&(e=e.replace(/(%?)(%([jds]))/g,function(e,n,r,i){switch(r=t.shift(),i){case"s":r=""+r;break;case"d":r=Number(r);break;case"j":r=JSON.stringify(r)}return n?(t.unshift(r),e):r})),t.length&&(e+=" "+t.join(" ")),""+e.replace(/%{2,2}/g,"%")},hC=/\s/,iC=function(e){for(var t=e.length;t--&&hC.test(e.charAt(t)););return t},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(e){if("number"==typeof e)return e;if(ie(e))return Fr;if(lb(e)&&(e="function"==typeof e.valueOf?e.valueOf():e,e=lb(e)?e+"":e),"string"!=typeof e)return 0===e?e:+e;e=e?e.slice(0,iC(e)+1).replace(jC,""):e;var t=lC.test(e);return t||mC.test(e)?nC(e.slice(2),t?2:8):kC.test(e)?Fr:+e},oC=Math.max,pC=Math.min,qC=function(e,t,n){function r(t){var n=c,r=u;return c=u=void 0,p=t,l=e.apply(r,n)}function i(e){var n=e-h;return e-=p,void 0===h||n>=t||0>n||m&&e>=v}function o(){var e=Cb.Date.now();if(i(e))return a(e);var n=setTimeout,r=e-p;e=t-(e-h),r=m?pC(e,v-r):e,d=n(o,r)}function a(e){return d=void 0,g&&c?r(e):(c=u=void 0,l)}function s(){var e=Cb.Date.now(),n=i(e);if(c=arguments,u=this,h=e,n){if(void 0===d)return p=e=h,d=setTimeout(o,t),f?r(e):l;if(m)return clearTimeout(d),d=setTimeout(o,t),r(h)}return void 0===d&&(d=setTimeout(o,t)),l}var c,u,l,d,h,p=0,f=!1,m=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");if(t=gl(t)||0,lb(n)){f=!!n.leading;var v=(m="maxWait"in n)?oC(gl(n.maxWait)||0,t):v;g="trailing"in n?!!n.trailing:g}return s.cancel=function(){void 0!==d&&clearTimeout(d),p=0,c=h=u=d=void 0},s.flush=function(){return void 0===d?l:a(Cb.Date.now())},s},yc=function(e){function t(e,i){return W(this,t),m(n(e=r.call(this,Mm(e,i))),"originalError",void 0),m(n(e),"code",void 0),m(n(e),"serverCode",void 0),"number"==typeof i?e.code=i:"string"==typeof i?e.name=i:void 0!==i&&(i.originalError&&(e.originalError=i.originalError),void 0!==i.code&&(e.code=i.code),void 0!==i.serverCode&&(e.serverCode=i.serverCode)),e}la(t,e);var r=ma(t);return t}(ef(Error)),Ia=function(e){function t(e,i){return W(this,t),m(n(e=r.call(this,Mm(e,i))),"name","RtmInternalError"),m(n(e),"code",void 0),e.code=i,e}la(t,e);var r=ma(t);return t}(ef(Error)),Ph=function(){return function(e){function t(e){W(this,t);var r=Object.keys(e);return n.call(this,e[r[0]],r[0])}la(t,e);var n=ma(t);return t}(Ia)},Fa=Ph(),db=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmTimeoutError"),e}la(t,e);var r=ma(t);return t}(yc),I=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvalidArgumentError"),e}la(t,e);var r=ma(t);return t}(yc),K=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvalidStatusError"),e}la(t,e);var r=ma(t);return t}(yc),hl=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInterruptedError"),e}la(t,e);var r=ma(t);return t}(yc),ib=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmLimitExceededError"),e}la(t,e);var r=ma(t);return t}(yc),rC=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmInvokeTooOftenError"),e}la(t,e);var r=ma(t);return t}(yc),da=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnavailableError"),m(n(e),"serverCode",void 0),m(n(e),"statusCode",void 0),e}la(t,e);var r=ma(t);return t}(yc),Ye=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnauthenticatedError"),m(n(e),"serverCode",void 0),e}la(t,e);var r=ma(t);return t}(yc),Wc=function(e){function t(){W(this,t);for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return m(n(e=r.call.apply(r,[this].concat(i))),"name","RtmUnknownError"),e}la(t,e);var r=ma(t);return t}(yc),Sa=function(e){return e instanceof db||e instanceof pb},sa=function(e){return e instanceof yc},Yd=function(e,t,n){return['Executing "%s.%s" timed out after %ds',e,t,n/1e3]},Lm=new Map,sC=function(){var e=new Date;return"".concat(e.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(e){return"string"==typeof e?e.endsWith(".")?e:"".concat(e,"."):e},Sm=function(e){for(var t="",n=(e=new Uint8Array(e)).byteLength,r=-1;++r<n;)t+=String.fromCharCode(e[r]);return t=btoa(t),"data:;base64,".concat(t)},tC=R(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})});N({target:"Date",proto:!0,forced:tC},{toJSON:function(e){e=Qa(this);var t=lc(e);return"number"!=typeof t||isFinite(t)?e.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(e,t,n){return JSON.stringify(Ym(e),t,n)};Gr.ensureProperties=Ym;var uC=function(e,t){t=t||{};var n=X(e);if("string"===n&&0<e.length)return au(e);if("number"===n&&isFinite(e))return t.long?864e5<=(t=Math.abs(e))?Jg(e,t,864e5,"day"):36e5<=t?Jg(e,t,36e5,"hour"):6e4<=t?Jg(e,t,6e4,"minute"):1e3<=t?Jg(e,t,1e3,"second"):e+" ms":864e5<=(t=Math.abs(e))?Math.round(e/864e5)+"d":36e5<=t?Math.round(e/36e5)+"h":6e4<=t?Math.round(e/6e4)+"m":1e3<=t?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},vC=function(e){function t(e){function r(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];if(r.enabled){e=Number(new Date),r.diff=e-(i||e),r.prev=i,i=r.curr=e,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var a=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,function(e,i){return"%%"===e?"%":(a++,"function"==typeof(i=t.formatters[i])&&(e=i.call(r,n[a]),n.splice(a,1),a--),e)}),t.formatArgs.call(r,n),(r.log||t.log).apply(r,n)}}var i,o=null;return r.namespace=e,r.useColors=t.useColors(),r.color=t.selectColor(e),r.extend=n,r.destroy=t.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:function(){return null===o?t.enabled(e):o},set:function(e){o=e}}),"function"==typeof t.init&&t.init(r),r}function n(e,n){return(e=t(this.namespace+(void 0===n?":":n)+e)).log=this.log,e}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat(G(t.names.map(r)),G(t.skips.map(r).map(function(e){return"-"+e}))).join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var n,r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r=0;for(n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=uC,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(function(n){t[n]=e[n]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t},Hr=$a(function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))}),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){try{var e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};e:{try{var n=localStorage;break e}catch(e){}n=void 0}t.storage=n,t.destroy=function(){var e=!1;return function(){e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),t.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),t.log=console.debug||console.log||function(){},e.exports=vC(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function e(t){W(this,e),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=t.processId,this.sdkVersion=t.sdkVersion,this.rtmConfig=t.rtmConfig,this.uploadRequest=t.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(e,[{key:"upload",value:function(e){this.LogCache.push(e),this.uploadState===Ze.Free&&(this.LogsToPost=this.LogCache.splice(0,40>this.LogCache.length?this.LogCache.length:40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(e){var t=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark(function n(){var r,i,o;return w.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r={sdk_version:t.sdkVersion,process_id:t.processId,payload:JSON.stringify(e)},n.prev=1,n.next=4,t.uploadRequest(r,null!==(i=t.rtmConfig.enableCloudProxy)&&void 0!==i&&i);case 4:if(!Uk){n.next=6;break}throw Error("RTM is busy");case 6:n.next=13;break;case 8:return n.prev=8,n.t0=n.catch(1),o=2>t.uploadResendCount++?2e3:1e4,setTimeout(function(){return t.postLog(t.LogsToPost)},o),n.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),0!==t.LogCache.length){n.next=17;break}return t.uploadState=Ze.Free,n.abrupt("return");case 17:t.uploadResendCount=0,t.LogsToPost=t.LogCache.splice(0,40>t.LogCache.length?t.LogCache.length:40),t.postLog(t.LogsToPost);case 20:case"end":return n.stop()}},n,null,[[1,8]])})),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e}(),Jr=function(e,t,n,r,i,o,a,s){var c=0;for(a=!!a&&Id(a,s,3);c<r;){if(c in n){if(s=a?a(n[c],c,t):n[c],0<o&&gd(s))i=Jr(e,t,s,ta(s.length),i,o-1)-1;else{if(9007199254740991<=i)throw TypeError("Exceed the acceptable array length");e[i]=s}i++}c++}return i},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=Qa(this),n=ta(t.length),r=Sg(t,0);return r.length=xC(r,t,t,n,0,void 0===e?1:$b(e)),r}}),N({target:"Object",stat:!0},{values:function(e){return aC(e)}});var yC=["CODE"],Db,ud,F;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(e){return Object.values(yf).flat().includes(e)},cu=function(e){var t;return null===(t=Hg(yf).find(function(t){return(t=ra(t,2))[1].includes(e)}))||void 0===t?void 0:t[0]},AC=function(e){return e.sort(function(e,t){return Kr.indexOf(e)-Kr.indexOf(t)})},xe=function(e){var t=new Set;if(0===(e=AC(e).slice(0,3).map(function(e){var n=Kg[e];if(void 0===n)throw new Ia("invalid area key");return e=n.CODE,n=ff(n,yC),t.add(e),n})).length)throw new Ia("areas cannot be empty");return ua({CODES:t},e.reduce(function(e,t){for(var n=0,r=Hg(e);n<r.length;n++){var i=ra(r[n],2),o=i[0];i=i[1],e[o]=Array.from(new Set([].concat(G(t[o]),G(i))))}return e}))},M,Lr=function(){var e=J(w.mark(function e(t,n){var r,i,o,a,s,c=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(2<(i=2<c.length&&void 0!==c[2]?c[2]:0))){e.next=3;break}return e.abrupt("return");case 3:return o={withCredentials:!0,body:t,timeout:2e4},a=0<i?(null==M?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(null==M?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",s=n?"https://".concat(null!==(r=null==M?void 0:M.PROXY_NGINX[0])&&void 0!==r?r:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(a,"&p=443&d=upload/v1"):"https://".concat(a,"/upload/v1"),e.next=8,te(s,o).catch(function(e){return Lr(t,n,i+1)});case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(e){if("string"==typeof e)return oa(e);if(Array.isArray(e)&&e.every(function(e){return"string"==typeof e}))return e.map(function(e){return oa(e)});if(!Il(e)){for(var t={},n=0;n<Or.length;n++){var r=Or[n];r in e&&(t[r]=e[r])}if(0<Object.keys(t).length)return t;if(5>Object.keys(e).length){for(n=0,e=Object.entries(e);n<e.length;n++){var i=ra(e[n],2);r=i[0],i=i[1],il.includes(r)?t[r]="[Hidden Info]":t[oa(r)]="string"==typeof i?oa(i):"[Sensitive Info]"}return t}return"[Sensitive Info]"}return e},Pr=function(e){return"object"===X(e)?yd(e)?Vm(fe(e,5),il,Nr):e.constructor&&e.constructor.name:e},Qr=function(e,t){return e instanceof Error?e.message:"string"!=typeof e?JSON.stringify(Vm(fe(e,5),il,Nr)):(t=t.map(function(e){return e instanceof Error?e.message:"object"===X(e)?Gr(Array.isArray(e)?e.map(Pr):Pr(e)):e}),Nm.apply(void 0,[e.replace(/%[%Oo]/g,function(e){return"%%"===e?"%":"%o"===e||"%O"===e?"%s":e})].concat(G(t))))},CC=1,Rr=function(e,t,n){var r=Hr(e);return r.enabled=!0,r.log=n,r.useColors=!1,function(n){for(var i=arguments.length,o=Array(1<i?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];if(t.enableLogUpload){i=Cg(n);var s=Qr(i,o);Mr.upload({log_item_id:"".concat(CC++),log_level:e,payload_str:"[".concat(sC(),"] ").concat(e," - ").concat(256<s.length?s.slice(0,256):s)})}switch(i=function(e){var t=s||Qr(Cg(n),o),i=Nc.LOG_HANDLER;"function"==typeof i&&i({level:e,message:t}),r(t)},e){case"RTM:INFO":t.logFilter.info&&i("log");break;case"RTM:WARN":t.logFilter.warn&&i("warning");break;case"RTM:ERROR":t.logFilter.error&&i("error");break;case"RTM:TRACK":t.logFilter.track&&i("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":case"RTM:DEBUG":t.logFilter.debug&&i("debug")}}},jl,Sr=function(e){return function(t){var n=1===jl||void 0===e?"":"Ins#".concat(e," ");return"".concat(n).concat(t)}},kl=function(e,t,n){var r=Sr(jl);return Rr("RTM:".concat(t),n,function(t){return e(r(t))})},tb=function(){return function(e){function t(e,i){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];W(this,t);var a=r.call(this);if(m(n(a),"logError",void 0),m(n(a),"invokeTracker",void 0),m(n(a),"resultTracker",void 0),m(n(a),"errorTracker",void 0),m(n(a),"eventTracker",void 0),m(n(a),"info",void 0),m(n(a),"warn",void 0),m(n(a),"log",void 0),m(n(a),"genLogger",void 0),m(n(a),"loggerId",void 0),m(n(a),"logger",void 0),m(n(a),"name",void 0),a.logger=e,a.name=i,a.loggerId=e.loggerId,a.info=e.info,a.warn=e.warn,a.logError=e.logError,a.genLogger=e.genLogger,a.log=e.genLogger("RTM:DEBUG","<".concat(i,"> ")),a.invokeTracker=e.genTracker("Invoke"),a.eventTracker=e.genTracker("Event"),a.resultTracker=e.genTracker("Result"),a.errorTracker=e.genTracker("Error"),o){var s=a.emit.bind(n(a));a.emit=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];e=t[0],n=t.slice(1);var r=BC.includes(e);a.eventTracker.apply(a,["%s: ".concat(0<n.length?"%s emitted with args: ".concat(n.map(function(){return"%o"})):"%s emitted"),i,e].concat(G(r?n.map(ye):n)));try{s.apply(void 0,t)}catch(t){a.logError("Caught in the callback function of the event %s",e,t)}}}return a}la(t,e);var r=ma(t);return t}(ea)},DC=function(e){return kl(console.log.bind(console),"INFO",e)},EC=function(e){return kl(console.warn.bind(console),"WARN",e)},FC=function(e){return kl(console.error.bind(console),"ERROR",e)},Tr=function(e,t){return function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=Sr(e),o=console.debug.bind(console),a=Rr(n,t,function(e){return o(i(e))});return function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return a.apply(void 0,[r+e].concat(n))}}},GC=function(e,t){return function(n){return Tr(e,t)("RTM:TRACK","[".concat(n,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(e,t){var n=-1,r=e.length,i=r-1;for(t=void 0===t?r:t;++n<t;){var o=e[r=nr(n,i)];e[r]=e[n],e[n]=o}return e.length=t,e},IC=function(e){return Ur(Xh(e))},JC=function(e){return Ur(Ni(e))},$e=function(e){return(Va(e)?IC:JC)(e)},af={0:9591,1:9593},$d=function(e){return"https://".concat(e,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(e){function t(e,i,o,a,s,c){W(this,t);var u=r.call(this,s,Ai("Socket-",s.loggerId));if(m(n(u),"isActiveClose",!1),m(n(u),"loggedIn",!1),m(n(u),"useNewDomain",void 0),m(n(u),"receivedPacket",new Pa),m(n(u),"open$",void 0),m(n(u),"input$",new Pa),m(n(u),"userJoin$",new Pa),m(n(u),"attemptsSinceLastError",0),m(n(u),"message$",new Pa),m(n(u),"socket$",void 0),m(n(u),"toClose",new Pa),m(n(u),"toReconnect",new Pa),m(n(u),"sendLogger",void 0),m(n(u),"receiveLogger",void 0),m(n(u),"ip",void 0),m(n(u),"env",void 0),m(n(u),"ticket",void 0),m(n(u),"context",void 0),m(n(u),"getDomain",function(){return an(u.ip,u.useNewDomain)}),m(n(u),"socketReconnector",function(e){var t=function(e){return u.attemptsSinceLastError+=1,u.warn("The %s of Env %d reconnecting %s",u.name,u.env,e.message),Bc(3e3)};return e.pipe(Ga(function(e){return u.log("socket connection closed"),u.loggedIn=!1,2<=u.attemptsSinceLastError?(u.warn("socket connection failure"),u.emit("connectionFailure"),u.close(),Z(e)):u.isActiveClose?vb:(u.emit("reconnect"),u.useNewDomain=!u.useNewDomain,Z(e))}),oe(function(e){return e.pipe(Cc(t))}))}),u.ip=e,u.env=i,u.ticket=o,u.context=a,u.useNewDomain=null!=c?c:.5<=Math.random(),u.sendLogger=u.genLogger("RTM:MSG:SEND"),u.receiveLogger=u.genLogger("RTM:MSG:RECV"),0!==i&&1!==i)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(e))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var l=af[i];u.log("Opening websocket address %s for the Env %d",u.ip,u.env);var d=Xb(u.input$,u.userJoin$.pipe(Rt(2)),u.message$).pipe(ba(function(e){return Oh.encode(e).finish()}));return e=Xb(St("",{protocols:[],makeWebSocket:function(){if(u.context.config.enableCloudProxy){if(0===u.context.cloudProxyServers.length)throw u.logError("No cloud proxy server to connect"),new da;var e="wss://".concat(an(bn(u.context.cloudProxyServers),!1),"/");e=we(e,"sid",u.context.sid),e=we(e,"remote_port",l.toString()),e=we(e,"remote_ip",u.ip),e=we(e,"token",u.context.key),e=new WebSocket(e)}else e=new WebSocket("wss://".concat(u.getDomain(),":").concat(l));return e.binaryType="arraybuffer",e}}),u.toReconnect),u.socket$=Ca(e,Tk.pipe(hb(15e3),Ga(function(e){return Sa(e)&&u.warn("socket open timed out"),Z(e)}))).pipe(ba(function(e){if(e instanceof Error)throw u.warn("Env_%d: Force reconnect the socket",u.env),e;return e(d).pipe(ba(function(e){return Oh.decode(new Uint8Array(e))}))}),u.socketReconnector),u.open$=u.socket$.pipe(ca(function(e){u.log("Websocket opened",u.name),e.subscribe(function(e){var t=e.data;e=Li[e.uri].slice(0,-3),t=$m[e].decode(t);var n=HA({},Gk(t,"toJSON"),function(e,t){return t instanceof U?Km(t):t}),r=!1;if((t instanceof vr||t instanceof ur)&&t.instance.lessThanOrEqual(4294967295)&&(r=!0),t instanceof wr||t instanceof xr){var i=t.instance,o=t.sequence;(t.dialogue.lessThanOrEqual(4294967295)||i.lessThanOrEqual(4294967295)||o.lessThan(1))&&(r=!0)}r?u.warn("Env_%d: Illegal %s, abandoned %o",u.env,e,n):("Pong"!==e&&u.receiveLogger("Env_%d: %s %o",u.env,e,n),u.receivedPacket.next([e,t]))},function(){})}),qf(void 0),ob(u.toClose),pe()),u}la(t,e);var r=ma(t);return Ha(t,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(e,t){if("Ping"!==e){var n=uc(t,function(e){return e instanceof U?Km(e):e});this.sendLogger("Env_%d: %s %o",this.env,e,n)}t=du(e,t),"UserJoin"===e?this.userJoin$.next(t):"Message"===e?this.message$.next(t):this.input$.next(t)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(e){var t=this;return this.receivedPacket.pipe(ca(function(e){var n=ra(e,2);e=n[0],n=n[1],"UserResp"===e&&(t.attemptsSinceLastError=0,t.loggedIn=!0),"UserDrop"===e&&t.emit("socketUserDrop",n)}),wb(function(t){return ra(t,1)[0]===e}),ba(function(e){return ra(e,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),t}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(e){return XB(this,e,1<arguments.length?arguments[1]:void 0)}});var OC=function(e){var t=xf(Kg);e=Yt(e);for(var n=0;n<t.length;n++){var r=Kg[t[n]];if(null!=r&&r.AP_DOMAINS.includes(e)||null!=r&&r.AP_BACKUP_DOMAINS.includes(e)||null!=r&&r.PROXY_AP.includes(e))return[r.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(e){function t(e,i){var o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];W(this,t);var a=r.call(this,i,"AccessPoint");return m(n(a),"handleUniLbsError",function(e,t){var n=e;if(4<e.toString().length){var r=e.toString().padStart(8,"0"),i=parseInt(r.slice(0,4),10);if(r=parseInt(r.slice(4,8),10),201===i)n=r;else if(101===i&&!QC.includes(r))return Z(Error("service is currently unavailable"))}if(i=n.toString(),!Object.keys(Vr).includes(i))return(e=new da(["Login is rejected by the server. The response code is %d",e],jg)).serverCode=n,Z(e);switch(n=PC[i=Vr[i]],i){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(t=new Ye(n,$q)).serverCode=e,Z(t);case"INVALID_USER_ID":return(t=new Ye(n,Jh)).serverCode=e,Z(t);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(t=new Ye(n,Kh)).serverCode=e,Z(t);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(t=new Ye(n,ar)).serverCode=e,Z(t);case"CANNOT_MEET_AREA_DEMAND":return(t=OC(t)).forEach(function(e){return a.failedAreas.add(e)}),a.failedAreas.size===(void 0===M?2:M.CODES.size)?((t=new I(n,jg)).serverCode=e,Z(t)):Z(Error("ap ".concat(t.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(t=new da(n,jg)).serverCode=e,Z(t);default:return Z(Im("ApResErrType",i))}}),m(n(a),"getApEdgeInfo$",void 0),m(n(a),"getApEdgeInfoEndFirst$",void 0),m(n(a),"apFinish$",new Pa),m(n(a),"retryCount",0),m(n(a),"failedAreas",new Set),m(n(a),"usedUrl",[]),m(n(a),"newDomainUsed",!1),m(n(a),"backupNewDomainUsed",!1),m(n(a),"genUrl",function(){return void 0===M?mi.apply(void 0,G($e([KC,LC]))).pipe(ni(function(e){return bb.apply(void 0,G(e))})):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))}),m(n(a),"genBackupUrl",function(){return void 0===M?mi.apply(void 0,G($e([MC,NC]))).pipe(ni(function(e){return bb.apply(void 0,G(e))})):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))}),m(n(a),"getApUrl$",function(e){var n,r;return a.genUrl().pipe(wb(function(e){return!(a.newDomainUsed&&e.includes("sd-rtn.com")||(e.includes("sd-rtn.com")&&(a.newDomainUsed=!0),dl(a.usedUrl,function(t){var n;return t===(null===(n=e.match(Qh))||void 0===n?void 0:n[1])})))}),ca(function(e){var t;void 0===M&&"string"==typeof(e=null===(t=e.match(Qh))||void 0===t?void 0:t[1])&&a.usedUrl.push(e)}),Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:0):null!==(r=null==M?void 0:M.CODES.size)&&void 0!==r?r:2),Dd(function(){return t.runOutOfUrlSymbol}),Ga(function(e,n){return a.newDomainUsed=!1,e===t.runOutOfUrlSymbol?(a.usedUrl=[],n):Z(e)}))}),m(n(a),"getBackupApUrl$",function(e){var n,r;return a.genBackupUrl().pipe(wb(function(e){return!(a.backupNewDomainUsed&&e.includes("sd-rtn.com")||(e.includes("sd-rtn.com")&&(a.backupNewDomainUsed=!0),dl(a.usedUrl,function(t){var n;return t===(null===(n=e.match(Qh))||void 0===n?void 0:n[1])})))}),ca(function(e){var t;void 0===M&&"string"==typeof(e=null===(t=e.match(Qh))||void 0===t?void 0:t[1])&&a.usedUrl.push(e)}),Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:0):null!==(r=null==M?void 0:M.CODES.size)&&void 0!==r?r:2),Dd(function(){return t.runOutOfUrlSymbol}),Ga(function(e,n){return a.backupNewDomainUsed=!1,e===t.runOutOfUrlSymbol?(a.usedUrl=[],n):Z(e)}))}),m(n(a),"getProxyApUrl$",function(e){var t,n;return bb.apply(void 0,G(((null==M?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(e?Math.max(Nc.RECONNECTING_AP_NUM,null!==(t=null==M?void 0:M.CODES.size)&&void 0!==t?t:0):null!==(n=null==M?void 0:M.CODES.size)&&void 0!==n?n:2))}),m(n(a),"context",void 0),m(n(a),"fetchCloudProxy",function(e,t){var n=Ai("AP-",a.loggerId);a.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;return a.apFinish$.pipe(Ka(1)).subscribe(function(){return r.abort()}),ad(J(w.mark(function i(){var o;return w.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o=Ag(0,Number.MAX_SAFE_INTEGER),a.log("%s request opid: %d",n,o),i.abrupt("return",te(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:a.context.sid,opid:o,appid:a.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:null!=t?t:a.context.key,cname:a.context.uid,uid:0,detail:ua({},void 0===M?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(e){return e===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):e}).join(",")})}}]},signal:r.signal}));case 3:case"end":return i.stop()}},i)}))).pipe(Ga(function(t){return"AbortError"!==t.name&&(a.logError(t),a.warn("The AP server %s request failure",e,t)),vb}),cb(function(){var t=J(w.mark(function t(r){var i,o,s,c,u,l,d,h,p,f,m,g,v,E,y,_,b,S;return w.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=JSON.parse(r.responseText),a.log("The %s response is %o",n,i),(void 0===(o=i.response_body)||0===o.length||o.some(function(e){var t;return void 0===(null===(t=e.buffer)||void 0===t?void 0:t.code)||23!==e.uri}))&&Z(new da("cloud proxy response_body not valid",jg)),0===(s=o.filter(function(e){return 0!==e.buffer.code})).length){t.next=14;break}if(void 0===(c=s.find(function(e){return 128===e.buffer.flag}))){t.next=12;break}return t.abrupt("return",a.handleUniLbsError(c.buffer.code,e));case 12:return a.logError("cloud proxy error response"),t.abrupt("return",a.handleUniLbsError(s[0].buffer.code,e));case 14:for(u=[],l=0;l<o.length;l++)if(262144===(null==(p=o[l])||null===(d=p.buffer)||void 0===d?void 0:d.flag))null===(f=p.buffer)||void 0===f||null===(m=f.edges_services)||void 0===m||null===(g=m.forEach)||void 0===g||g.call(m,function(e){Gm(e=e.ip)&&-1===a.context.cloudProxyServers.indexOf(e)&&(a.log("got cloud proxy server: %s",e),a.context.cloudProxyServers.push(e))});else if(128===(null==p||null===(h=p.buffer)||void 0===h?void 0:h.flag)){for(_=function(e,t){var n=t[e];u.some(function(e){return e.ip===n.ip})||u.push({ip:n.ip,ticket:p.buffer.cert})},b=0,S=p.buffer.edges_services;b<S.length;b++)_(b,S);a.context.rtmArea=null!==(v=null===(E=p.buffer)||void 0===E||null===(y=E.detail)||void 0===y?void 0:y[9])&&void 0!==v?v:""}return t.abrupt("return",bb.apply(void 0,G(u).concat([fg])));case 19:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),Ga(function(e){return sa(e)?Z(e):vb}),tg(),wb(function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket}))}),m(n(a),"fetchAp",function(e,t){var n=Ai("AP-",a.loggerId);a.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;return a.apFinish$.pipe(Ka(1)).subscribe(function(){return r.abort()}),ad(J(w.mark(function i(){var o;return w.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return o=Ag(0,Number.MAX_SAFE_INTEGER),a.log("%s request opid: %d",n,o),i.abrupt("return",te(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:o,key:t||a.context.key,cname:a.context.uid,detail:ua({},void 0===M?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(e){return e===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):e}).join(",")}),uid:0,sid:a.context.sid},signal:r.signal}));case 3:case"end":return i.stop()}},i)}))).pipe(Ga(function(t){return"AbortError"!==t.name&&(a.logError(t),a.warn("The AP server %s request failure",e,t)),vb}),cb(function(){var t=J(w.mark(function t(r){var i,o,s,c,u,l;return w.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=JSON.parse(r.responseText),a.log("The %s response is %o",n,i),s=(o=i).code,c=o.addresses,u=o.detail,0===s){t.next=6;break}return t.abrupt("return",a.handleUniLbsError(s,e));case 6:if(0!==(l=c).length){t.next=11;break}return t.abrupt("return",Z(Error("No available edge address to connect")));case 11:return a.context.rtmArea=null==u?void 0:u[9],t.abrupt("return",bb.apply(void 0,G(l).concat([fg])));case 13:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),tg(),Ga(function(e){return sa(e)?Z(e):vb}),wb(function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket}))}),a.context=e,a.getApEdgeInfoEndFirst$=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return Bc(0,e||o?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca(function(){a.retryCount+=1}),cb(function(){return a.context.config.enableCloudProxy?a.getProxyApUrl$(e||o):(4<=a.retryCount&&(a.retryCount=0),3>=a.retryCount?a.getApUrl$(e||o):a.getBackupApUrl$(e||o))}),cb(function(e){return a.context.config.enableCloudProxy?a.fetchCloudProxy(e):a.fetchAp(e)}),Ga(function(e){return e instanceof pb&&a.warn("AP request timeout"),Z(e)}),om(function(e){return e.ip}),ob(a.apFinish$))},a.getApEdgeInfo$=function(e){return Bc(0,e||o?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca(function(){a.retryCount+=1}),cb(function(){return a.context.config.enableCloudProxy?a.getProxyApUrl$(e||o):3>=a.retryCount?a.getApUrl$(e||o):a.getBackupApUrl$(e||o)}),cb(function(e){return(a.context.config.enableCloudProxy?a.fetchCloudProxy(e):a.fetchAp(e)).pipe()}),Ga(function(e){return e instanceof pb&&a.warn("AP request timeout"),Z(e)}),om(function(e){return e.ip}),ob(a.apFinish$))},a}la(t,e);var r=ma(t);return Ha(t,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),t}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(e){function t(e,i,o){W(this,t);var a=r.call(this,i,"Connection");m(n(a),"apClient",void 0),m(n(a),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(a),"curOpenSockets",[void 0,void 0]),m(n(a),"ipIterator",0),m(n(a),"firstEnv",.5<=Math.random()?1:0),m(n(a),"firstSocketOpener",void 0),m(n(a),"secondSocketOpener",void 0),m(n(a),"firstOpenKeeperSubject",new Pa),m(n(a),"secondOpenKeeperSubject",new Pa),m(n(a),"edgeInfoReplayed",void 0),m(n(a),"firstEnvOpenSocket",void 0),m(n(a),"firstOpenKeeperSub",void 0),m(n(a),"secondOpenKeeperSub",void 0),m(n(a),"context",void 0),m(n(a),"logger",void 0),a.context=e,a.logger=i,a.apClient=new Wr(a.context,i),a.apClient.apFinish$.subscribe(function(){a.log("Ap client fetch finished")});var s,c=[];return a.edgeInfoReplayed=a.apClient.getApEdgeInfo$(o).pipe(oe(function(e){return e.pipe(ca(function(e){if(sa(e))throw e}),cd(o?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))}),wb(function(e){return!dl(c,e)}),Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),ca(function(e){c.push(e),a.log("An edge info got %o",e)}),ca({error:function(e){a.emit("connectionInitFailure",e)}}),wg(function(){a.apClient.clearUp()}),sm()),a.firstEnvOpenSocket=a.edgeInfoReplayed.pipe(cb(function(e){if(void 0===e)return Z(Error("Invalid edge info"));var t=new ml(e.ip,a.firstEnv,e.ticket,a.context,i,s);return a.firstEnv=1===a.firstEnv?0:1,t.on("connectionFailure",function(){return a.onSocketConnectionFailure(t)}),s=!t.useNewDomain,t.open$.pipe(qf(t))}),ca(function(e){a.log("The websocket of ENV_%d opened to %s:%d",e.env,e.ip,af[e.env]),a.curOpenSockets[e.env]=e,a.lastOpenSockets[e.env].next(e),a.firstEnv=e.env,a.openSecondSocket(e.env,e.ip,e.useNewDomain)}),Ka(1),pe()),a.firstSocketOpener=a.firstEnvOpenSocket.pipe(cb(function(e){return e.open$.pipe(ca(function(){a.log("The websocket of first ENV_%d re-opened to %s:%d",e.env,e.ip,af[e.env]),a.curOpenSockets[e.env]=e,a.lastOpenSockets[e.env].next(e)}))})),e=a.firstOpenKeeperSubject.pipe(Cc(Yc)),a.firstOpenKeeperSub=e.subscribe({error:a.logError}),a}la(t,e);var r=ma(t);return Ha(t,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(e,t){if(![0,1].includes(e))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var n=e===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var r=this.curOpenSockets[e];this.curOpenSockets[e]=void 0,r&&(r.isActiveClose=!0,setTimeout(function(){r.close()},t)),void 0!==n&&setTimeout(function(){null==n||n.unsubscribe()},t)}},{key:"waitClosing",value:function(e){var t=this;return e.isActiveClose=!0,e.open$.pipe(tt(),Ga(function(e){return e.message===mr.normalClosureMessage?vb:Z(e)}),hb(5e3),Ga(function(n){return n instanceof pb?(t.warn("Force closing the ENV_%d connection",e.env),vb):Z(n)}))}},{key:"onSocketConnectionFailure",value:function(e){var t=[0,1].filter(function(t){return t!==e.env})[0];(t=this.curOpenSockets[t])&&t.loggedIn?this.reopenSocketWithApRequest(e.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(e,t,n){var r=this,i=1===e?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm(function(e,t){return[].concat(G(e),[t])},[]),ba(function(e){return kr(e,function(e){return Jm(t,e.ip)}).slice(-1)[0]}),Ka(1),cb(function(e){if(void 0===e)return Z(Error("Invalid edge info"));var t=new ml(e.ip,i,e.ticket,r.context,r.logger,n);return t.on("connectionFailure",function(){return r.onSocketConnectionFailure(t)}),t.open$.pipe(ca(function(){r.lastOpenSockets[i].next(t),r.curOpenSockets[i]=t}))}),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(e){var t=this,n=[0,1].filter(function(t){return t!==e})[0];if(void 0!==(n=this.curOpenSockets[n])){var r,i=n.ip;n=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),oe(function(e){return e.pipe(ca(function(e){if(e.code===Kh)t.emit("tokenExpired"),t.apClient.apFinish$.next(void 0);else if(sa(e))throw e}),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))}),ca(function(e){t.log("An edge info got %o",e)}),wg(function(){t.apClient.clearUp()})).pipe(rm(function(e,t){return[].concat(G(e),[t])},[]),ba(function(e){return(e=kr(e,function(e){return Jm(i,e.ip)})).length-1>=t.ipIterator?e.slice(-t.ipIterator++-1)[0]:(t.ipIterator=0,e.slice(-1)[0])}),Dd(),cb(function(n){if(void 0===n)return Z(Error("Invalid edge info"));var i=new ml(n.ip,e,n.ticket,t.context,t.logger,r);return i.on("connectionFailure",function(){return t.onSocketConnectionFailure(i)}),r=!i.useNewDomain,i.open$.pipe(qf(i))}),ca(function(n){t.log("The websocket of ENV_%d re-opened to %s:%d using ap",n.env,n.ip,af[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)}),cb(function(n){return n.open$.pipe(ca(function(){t.log("The websocket of ENV_%d re-opened to %s:%d",n.env,n.ip,af[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)}))}),pe()),e===this.firstEnv?this.firstOpenKeeperSubject.next(n):this.secondOpenKeeperSubject.next(n)}}}]),t}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.appId&&Object.hasOwnProperty.call(e,"appId")&&t.uint32(42).string(e.appId),null!=e.ver&&Object.hasOwnProperty.call(e,"ver")&&t.uint32(50).string(e.ver),null!=e.buildno&&Object.hasOwnProperty.call(e,"buildno")&&t.uint32(56).int32(e.buildno),null!=e.installId&&Object.hasOwnProperty.call(e,"installId")&&t.uint32(66).string(e.installId),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(128).int32(e.os),null!=e.did&&Object.hasOwnProperty.call(e,"did")&&t.uint32(138).string(e.did),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&zc.Session.CommonIndex.encode(e.index,t.uint32(162).fork()).ldelim(),null!=e.token&&Object.hasOwnProperty.call(e,"token")&&t.uint32(170).string(e.token),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(176).int32(e.version),null!=e.subVersion&&Object.hasOwnProperty.call(e,"subVersion")&&t.uint32(184).int32(e.subVersion),t},e.CommonIndex=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.index1="",e.prototype.index2="",e.prototype.index3="",e.encode=function(e,t){return t||(t=Xc.create()),null!=e.index1&&Object.hasOwnProperty.call(e,"index1")&&t.uint32(10).string(e.index1),null!=e.index2&&Object.hasOwnProperty.call(e,"index2")&&t.uint32(18).string(e.index2),null!=e.index3&&Object.hasOwnProperty.call(e,"index3")&&t.uint32(26).string(e.index3),t},e}(),e}(),SC=zc.Link=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.ec&&Object.hasOwnProperty.call(e,"ec")&&t.uint32(40).int32(e.ec),null!=e.sc&&Object.hasOwnProperty.call(e,"sc")&&t.uint32(48).int32(e.sc),null!=e.destServerIp&&Object.hasOwnProperty.call(e,"destServerIp")&&t.uint32(58).string(e.destServerIp),null!=e.ackedServerIp&&Object.hasOwnProperty.call(e,"ackedServerIp")&&t.uint32(66).string(e.ackedServerIp),null!=e.responseTime&&Object.hasOwnProperty.call(e,"responseTime")&&t.uint32(72).int32(e.responseTime),t},e}(),TC=zc.Logout=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),t},e}(),UC=zc.KickedOff=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.linkId&&Object.hasOwnProperty.call(e,"linkId")&&t.uint32(48).int32(e.linkId),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(56).int32(e.code),null!=e.server&&Object.hasOwnProperty.call(e,"server")&&t.uint32(66).string(e.server),null!=e.serverCode&&Object.hasOwnProperty.call(e,"serverCode")&&t.uint32(72).int32(e.serverCode),t},e}(),VC=zc.ChnJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),WC=zc.ChnJoinRes=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),null!=e.serverErrCode&&Object.hasOwnProperty.call(e,"serverErrCode")&&t.uint32(64).int32(e.serverErrCode),t},e}(),XC=zc.ChnLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),YC=zc.ConnectionStateChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(e,t){return t||(t=Xc.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.oldState&&Object.hasOwnProperty.call(e,"oldState")&&t.uint32(40).int32(e.oldState),null!=e.newState&&Object.hasOwnProperty.call(e,"newState")&&t.uint32(48).int32(e.newState),null!=e.reason&&Object.hasOwnProperty.call(e,"reason")&&t.uint32(56).int32(e.reason),null!=e.reconnId&&Object.hasOwnProperty.call(e,"reconnId")&&t.uint32(64).int32(e.reconnId),t},e}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(e){function t(e,i,o){return W(this,t),m(n(o=r.call(this,o,"Context")),"_token",void 0),m(n(o),"config",void 0),m(n(o),"_uid",void 0),m(n(o),"_sid",void 0),m(n(o),"_area","CN"),m(n(o),"appId",void 0),m(n(o),"enableCloudProxy",!1),m(n(o),"cloudProxyServers",[]),o.appId=e,o.config=i,o}la(t,e);var r=ma(t);return Ha(t,[{key:"token",set:function(e){this._token="string"==typeof e&&e?e:void 0}},{key:"uid",get:function(){if("string"==typeof this._uid&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(e){if(this.log("The user ID is set to %s",oa(e)),!za(e))throw new Ia;this._uid=e}},{key:"key",get:function(){if("string"==typeof this._token&&this._token)return this._token;if("string"==typeof this.appId&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if("string"==typeof this._sid&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(e){if(this.log("sid is set to %s",e),"string"!=typeof e||!e)throw new Ia;this._sid=e}},{key:"rtmArea",get:function(){if("string"==typeof this._area&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(e){this.log("area is set to %s",e),"string"==typeof e&&e?this._area=e:this.warn("set area failed")}}]),t}(tb()),$C=!!Fc&&R(function(){Fc.prototype.finally.call({then:function(){}},function(){})});if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(e){var t=kd(this,mc("Promise")),n="function"==typeof e;return this.then(n?function(n){return mj(t,e()).then(function(){return n})}:e,n?function(n){return mj(t,e()).then(function(){throw n})}:e)}}),"function"==typeof Fc){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var e=J(w.mark(function e(t){return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Uint8Array,e.next=3,crypto.subtle.digest("SHA-256",t);case 3:return e.t1=e.sent,e.abrupt("return",new e.t0(e.t1));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),$r=function(e){return Array.from(e).map(function(e){return e.toString(16).padStart(2,"0")}).join("")},bD=function(e){if("string"!=typeof e)throw new TypeError("Expected input to be a string");if(0!=e.length%2)throw new RangeError("Expected string to be an even number of characters");for(var t=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)t[n/2]=parseInt(e.substring(n,n+2),16);return t},as=function(e){return btoa(String.fromCharCode.apply(String,G(e))).replace(/={1,2}$/,"")},bs=function(){var e=J(w.mark(function e(t){var n;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,crypto.subtle.digest("SHA-1",t);case 3:n=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),n=sha1.arrayBuffer(t);case 9:return e.abrupt("return",as(new Uint8Array(n)));case 10:case"end":return e.stop()}},e,null,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),cs=function(e,t,n,r){r[t]=!0,n.has(e)?n.get(e).add(t):n.set(e,new Set([t]))},cD=function(e){switch(e){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(e){function t(e,i,o,a){W(this,t);var s=r.call(this,o,"ChunkDownloadManager");if(m(n(s),"abortController",new AbortController),m(n(s),"downloadedSize",0),m(n(s),"successCount",0),m(n(s),"timer",void 0),m(n(s),"chunks",[]),m(n(s),"retUnit",void 0),m(n(s),"singleThread",!1),m(n(s),"initialized",!1),m(n(s),"ee",void 0),m(n(s),"chunkCount",void 0),m(n(s),"aborted",!1),m(n(s),"serverToIndices",new Map),m(n(s),"backupToIndices",new Map),m(n(s),"indexToBackupServers",[]),m(n(s),"busyBackupServers",new Map),m(n(s),"downloadingChunks",new Set),m(n(s),"metaInfo",void 0),m(n(s),"transHandler",void 0),s.metaInfo=e,s.transHandler=i,s.ee=void 0===a?new ea:a,o=e.size,e=e.unit,0===o)throw new Ia("size cannot be 0");return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",function(){s.abortController.abort()},{once:!0}),s.abortController.signal.addEventListener("abort",function(){s.aborted=!0},{once:!0}),s.chunkCount=Math.ceil(o/(32768*e)),s}la(t,e);var r=ma(t);return Ha(t,[{key:"setInfoByResponse",value:function(e){var t=this,n=e.serverList,r=e.backupList;if(e=e.unit,n.length<this.chunkCount&&r.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var i=Array(this.chunkCount).fill(!1);if(n.forEach(function(e,n){return e.forEach(function(e){return cs(e,n,t.serverToIndices,i)})}),r.forEach(function(e,n){return e.forEach(function(e){return cs(e,n,t.backupToIndices,i)})}),i.some(function(){return!1}))throw new da("Not enough servers to download",mg);this.indexToBackupServers=r.map(function(e){return new Set(e)}),this.retUnit=e}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):1===this.serverToIndices.size&&0===Array.from(this.serverToIndices.keys())[0]?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(e){var t=this,n=this.downloadedSize+e;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=n,void 0!==this.timer&&0!==e&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&this.successCount!==this.chunkCount&&(this.timer=setTimeout(function(){t.ee.emit("timedOut"),t.abortController.abort()},12e4)),this.initialized&&0===e||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var e=0,t=0,n=this.chunks;t<n.length;t++)e+=n[t].byteLength;if(e!==this.metaInfo.size)throw new Ia("invalid chunks total size");e=new Uint8Array(e),n=t=0;for(var r=this.chunks;n<r.length;n++){var i=r[n];e.set(new Uint8Array(i),t),t+=i.byteLength}return t=Array.from(e.subarray(0,4)).map(function(e){return e.toString(16)}).join("").toUpperCase(),Zt(e.buffer,cD(t))}},{key:"getDownloadUrl",value:function(e){var t=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(e).split(".").join("-"),".edge.").concat(t,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var e=J(w.mark(function e(t){var n,r=this,i=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=1<i.length&&void 0!==i[1]&&i[1],e.next=3,Promise.all(Array.from(t.entries()).map(function(e){return e=ra(e,2),r.postDownloadRequest(e[0],Array.from(e[1]),n).catch(function(e){404===e.statusCode?(r.ee.emit("notExist"),r.abortController.abort()):"AbortError"!==e.name&&(Sa(e)?r.singleThread?(r.abortController.abort(),r.ee.emit("timedOut")):(r.warn("%d download timed out after %d, retrying use single thread",e.index,r.singleThread?6e4:3e4),r.abortController.abort(),r.singleThread=!0,r.ee.emit("multiTimeOut")):(r.ee.emit("error",e),r.abortController.abort()))})}));case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var e=J(w.mark(function e(t,n,r){var i,o,a,s,c,u,l,d,h,p=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(h=function(){return(h=J(w.mark(function e(o){var a,h,p,f,m,g,v,E;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,void 0!==o||0!==t){e.next=5;break}throw new Ia("Invalid serverIp");case 5:a=void 0===o?l.getDownloadUrl(t):o;case 6:return l.downloadingChunks.add(i),e.next=9,u(a);case 9:return h=e.sent.responseData,l.downloadingChunks.delete(i),e.abrupt("return",h);case 15:if(e.prev=15,e.t0=e.catch(0),l.downloadingChunks.delete(i),n.unshift(i),l.metaInfo.useNewDomain=!1,"AbortError"!==e.t0.name){e.next=22;break}throw e.t0;case 22:if(!Sa(e.t0)){e.next=25;break}throw e.t0.index=i,e.t0;case 25:if(p=s,s+=1,!(2>p)){e.next=30;break}return e.t0 instanceof Ia||l.warn("%o, %d download failed, retrying",e.t0,i),e.abrupt("return",d());case 30:if(504!==e.t0.statusCode){e.next=34;break}throw(f=new db("download server timed out",{originalError:e.t0,serverCode:504})).index=i,f;case 34:if(!r||2!==p||0===c[0]){e.next=45;break}return e.t0 instanceof Ia||l.warn("%d download failed, using backup: %d, %o",i,c[0],e.t0),e.next=38,l.busyBackupServers.get(c[0]);case 38:return m=d(l.getDownloadUrl(c[0])),l.busyBackupServers.set(c[0],m),e.next=42,m;case 42:return g=e.sent,l.busyBackupServers.delete(c[0]),e.abrupt("return",g);case 45:if(!(r&&2<p&&void 0!==c[1]&&0!==c[1])){e.next=56;break}return l.warn("%d download failed, using backup 1: %d",i,c[1]),e.next=49,l.busyBackupServers.get(c[1]);case 49:return v=d(l.getDownloadUrl(c[1])),l.busyBackupServers.set(c[1],v),e.next=53,v;case 53:return E=e.sent,l.busyBackupServers.delete(c[1]),e.abrupt("return",E);case 56:throw e.t0.index=i,e.t0;case 58:case"end":return e.stop()}},e,null,[[0,15]])}))).apply(this,arguments)},d=function(e){return h.apply(this,arguments)},!this.aborted){e.next=4;break}throw new Ia("download already aborted");case 4:if(void 0!==(i=n.shift())){e.next=8;break}return this.log("%s download finished",t),e.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){e.next=10;break}return e.abrupt("return");case 10:if(!this.downloadingChunks.has(i)){e.next=13;break}return this.log("%s already downloading, return",i),e.abrupt("return");case 13:if(void 0===this.chunks[i]){e.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",i),e.next=18,this.postDownloadRequest(t,n,r);case 18:return e.abrupt("return");case 19:return o=new FormData,a={hash:hu(this.metaInfo.hashHexStr),unit:void 0===this.retUnit?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:i},o.append("parameter",JSON.stringify(a)),s=0,c=Array.from(this.indexToBackupServers[i]),u=function(e){return te(e,{body:o,signal:p.abortController.signal,timeout:p.singleThread?12e4:3e4},{useBinaryResponse:!0})},l=this,e.next=28,d().then(function(e){return void 0!==p.chunks[i]?p.log("chunk %d download duplicated",i):(p.chunks[i]=e,p.log("chunk %d downloaded",i),p.successCount+=1,p.updateProgress(p.chunks[i].byteLength)),p.successCount===p.chunkCount&&(p.log("chunks all download"),p.ee.emit("finished")),p.singleThread?(p.downloadChunks(),Promise.resolve()):p.postDownloadRequest(t,n,r)});case 28:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()}]),t}(tb()),es=function(e){function t(e,i,o,a){W(this,t);var s=r.call(this,o,"ChunkUploadManager");if(m(n(s),"chunkCount",0),m(n(s),"chunks",[]),m(n(s),"uploadedChunks",[]),m(n(s),"totalFailures",0),m(n(s),"timer",void 0),m(n(s),"initState","uninitialized"),m(n(s),"ee",void 0),m(n(s),"unit",0),m(n(s),"uploadedSize",0),m(n(s),"singleThread",!1),m(n(s),"abortController",new AbortController),m(n(s),"servers",[]),m(n(s),"aborted",!1),m(n(s),"metaInfo",void 0),m(n(s),"transHandler",void 0),s.metaInfo=e,s.transHandler=i,s.ee=void 0===a?new ea:a,0===e.file.length)throw new I("file not found or is empty",wf);return void 0!==i.cancelSignal&&i.cancelSignal.addEventListener("abort",function(){s.abortController.abort()},{once:!0}),s.abortController.signal.addEventListener("abort",function(){s.aborted=!0},{once:!0}),s}la(t,e);var r=ma(t);return Ha(t,[{key:"initChunks",value:function(){var e=J(w.mark(function e(t){var n,r,i,o,a,s=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("initialized"!==this.initState&&"initializing"!==this.initState){e.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=t,n=this.sliceFile(t,this.metaInfo.file),this.chunkCount=n.length,r=[],i=function(e,t){var n=(e=ra(t[e],2))[0],i=e[1];e=bs(i).then(function(e){s.chunks[n]={payload:i,sha1:e,uploadedTo:void 0,index:n,processed:!1}}),r.push(e)},o=0,a=Array.from(n.entries());o<a.length;o++)i(o,a);return e.next=11,Promise.all(r);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var e=this;if(!this.aborted){for(var t=this.chunks.filter(function(e){return!e.processed}),n=function(n){var r=t[n],i=e.servers.filter(function(e){return!e.isUploading}).sort(function(e,t){return e.successCount-t.successCount}).sort(function(e,t){return e.failureCount-t.failureCount})[0];if(void 0===i||1<i.failureCount)return e.log("Upload server not available, waiting"),e.ee.emit("serverUsedUp"),Om(1e3).then(function(){e.totalFailures>2*e.chunkCount&&e.ee.emit("error"),e.totalFailures+=1,void 0!==i&&(i.failureCount=0),e.uploadToServers()}).catch(function(){}),"break";r.processed=!0,i.isUploading=!0,e.log("uploading chunk %d to server %s",r.index,Dg(i.ip));var o=e.getUploadUrl(i.ip);return J(w.mark(function t(){var n;return w.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.postChunk(r.payload,o,r.index);case 3:n=e.chunks.findIndex(function(e){return e===r}),r.uploadedTo=i.ip,e.chunks.splice(n,1),e.uploadedChunks.push(r),i.successCount+=1,i.isUploading=!1,e.updateProgress(r.payload.byteLength),e.log("upload chunk %d successfully",r.index),t.next=31;break;case 13:if(t.prev=13,t.t0=t.catch(0),i.isUploading=!1,r.processed=!1,504!==t.t0.statusCode&&!Sa(t.t0)){t.next=27;break}if(e.singleThread){t.next=24;break}return e.warn("%d upload timed out after %d, retrying use single thread",r.index,e.singleThread?12e4:3e4),e.abortController.abort(),e.singleThread=!0,e.ee.emit("multiTimeOut"),t.abrupt("return");case 24:return e.ee.emit("timedOut"),e.abortController.abort(),t.abrupt("return");case 27:return e.metaInfo.useNewDomain=!1,i.failureCount+=1,t.next=31,Om(1e3);case 31:e.uploadedChunks.length===e.chunkCount?(e.log("chunks uploaded"),e.ee.emit("finished")):(e.singleThread||1===e.chunks.filter(function(e){return!e.processed}).length)&&e.uploadToServers();case 32:case"end":return t.stop()}},t,null,[[0,13]])}))(),e.singleThread?"break":void 0},r=0;r<t.length&&"break"!==n(r);r++);0===t.length&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var e=!0,t=[],n=G(this.uploadedChunks).sort(function(e,t){return e.index-t.index}),r=0;for(n=Array.from(n.values());r<n.length;r++){var i=n[r].uploadedTo;if(void 0===i){e=!1;break}t.push(i)}if(!e)throw new Ia("some chunks not uploaded, cannot get upload server ips");return t}},{key:"addServers",value:function(e){var t=this;e.forEach(function(e){var n=t.servers.findIndex(function(t){return t.ip===e});-1!==n?t.servers[n].failureCount=0:(t.log("server %s added",Dg(e)),t.servers.push({successCount:0,isUploading:!1,ip:e,failureCount:0}))})}},{key:"updateProgress",value:function(e){var t=this,n=void 0!==e?this.uploadedSize+e:this.metaInfo.file.length;n>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=n,void 0!==this.timer&&0!==e&&(clearTimeout(this.timer),this.timer=void 0),void 0===this.timer&&void 0!==e&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout(function(){t.ee.emit("timedOut"),t.abortController.abort()},12e4)),"initialized"===this.initState&&0===e||void 0===this.transHandler.onOperationProgress||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(e,t){var n=0,r=[],i=t.length;for(e*=32768;n<i;)r.push(t.slice(n,n+e)),n+=e;return this.log("chunks split into %d",r.length),r}},{key:"postChunk",value:function(){var e=J(w.mark(function e(t,n,r){var i,o,a,s,c,u,l;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.aborted){e.next=2;break}throw new Ia("upload already aborted");case 2:if(void 0!==this.unit){e.next=4;break}throw new Ia("unit is undefined");case 4:return o=(i=this.metaInfo).ticket,a=i.instance,s=i.loginOpt,c=i.hashStr,e.t0=r,e.t1=c,e.next=9,bs(t);case 9:return e.t2=e.sent,e.t3=this.unit,e.t4=o,e.t5=a,e.t6=s,u={index:e.t0,hash:e.t1,sha1:e.t2,unit:e.t3,ticket:e.t4,instance:e.t5,loginOpt:e.t6},(l=new FormData).append("parameter",JSON.stringify(u)),l.append("payload",new Blob([t])),e.next=20,te(n,{headers:{Accept:"application/json"},body:l,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(201===e.sent.status){e.next=24;break}throw new da("uploading chunk ".concat(r," failed"));case 24:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(e){var t=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(e).split(".").join("-"),".edge.").concat(t,":9601/api/v1/chuck/upload")}}]),t}(tb()),fs=function(e){function t(e){W(this,t);var i=r.call(this,e,"MediaTaskManager");return m(n(i),"isProcessing",!1),m(n(i),"authInfo",void 0),m(n(i),"taskFinishers",{}),m(n(i),"mediaTasks",new Map),m(n(i),"ongoingTask",void 0),i.on("connectionStateChanged",function(e){if(e===S.ConnectionState.ABORTED||e===S.ConnectionState.DISCONNECTED){void 0!==i.ongoingTask&&i.cancelTask(i.ongoingTask),e=0;for(var t=Array.from(i.mediaTasks.entries());e<t.length;e++){var n=ra(t[e],2)[1];i.cancelTask(n)}i.mediaTasks.clear(),i.taskFinishers={}}else e===S.ConnectionState.RECONNECTING?void 0!==i.ongoingTask&&i.ongoingTask.manager.abortController.abort():e===S.ConnectionState.CONNECTED&&void 0!==i.ongoingTask&&i.ongoingTask.manager.ee.emit("reconnected")}),i}la(t,e);var r=ma(t);return Ha(t,[{key:"setAuthInfo",value:function(e){this.authInfo=e}},{key:"waitMediaTask",value:function(e){var t=this;return new Promise(function(n,r){t.taskFinishers[e]={resolve:n,reject:r},t.isProcessing||t.processMediaTask()}).finally(function(){void 0!==t.ongoingTask&&void 0!==t.ongoingTask.manager.timer&&clearTimeout(t.ongoingTask.manager.timer),delete t.taskFinishers[e],0!==t.mediaTasks.size?t.processMediaTask():t.isProcessing=!1})}},{key:"addUploadTask",value:function(e,n,r,i){var o=e.file;if(e=e.hash,void 0===this.authInfo)throw new Ia("session not found");if(this.mediaTasks.size>=t.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return i=new es({hashStr:as(e),file:o,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},i,this.logger),o=Ud(),this.mediaTasks.set(o,{type:"UPLOAD",manager:i,hash:e,setter:r,fetcher:n,taskId:o}),o}},{key:"addDownloadTask",value:function(e,n,r){var i=e.hashHexStr,o=e.size,a=e.unit;if(e=e.zone,void 0===this.authInfo)throw new Ia("session not found");if(this.mediaTasks.size>=t.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return r=new ds({hashHexStr:i,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:o,zone:e,unit:a},r,this.logger),i=Ud(),this.mediaTasks.set(i,{type:"DOWNLOAD",manager:r,fetcher:n,taskId:i}),i}},{key:"doDownloadTaskImpl",value:function(){var e=J(w.mark(function e(t,n){var r,i,o,a,s,c,u,l,d=this,h=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=i=t.manager,(r=2<h.length&&void 0!==h[2]&&h[2])&&(i=new ds(o.metaInfo,o.transHandler,this.logger,o.ee)),a=t.fetcher,e.next=7,a();case 7:if(c=(s=e.sent).serverList,u=s.backupList,l=s.unit,!r||l===o.retUnit){e.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:r&&(t.manager=i,i.downloadedSize=o.downloadedSize,i.successCount=o.successCount,i.timer=o.timer,i.chunks=o.chunks,i.initialized=o.initialized,i.singleThread=o.singleThread,i.updateProgress(0)),i.ee.once("reconnected",function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(t,n,!0).catch(function(e){n.reject(e)})}),i.ee.once("multiTimeOut",function(){i.ee.removeAllListeners(),d.doDownloadTaskImpl(t,n,!0).catch(function(e){n.reject(e)})}),i.ee.once("error",function(e){i.ee.removeAllListeners(),n.reject(new da(["download file file, index %d",e.index],{code:mg,originalError:e}))}),i.ee.once("notExist",function(){i.abortController.abort(),i.ee.removeAllListeners(),n.reject(new da("download file not found",AA))}),i.ee.once("timedOut",function(){i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new db("download timed out",zA))}),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",function(){n.reject(new hl("Downloading canceled",ir))},{once:!0}),i.ee.once("finished",function(){n.resolve({type:"DOWNLOAD",payload:i.getPayload()})}),i.setInfoByResponse({serverList:c,backupList:u,unit:l}),i.downloadChunks();case 23:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return r||(this.mediaTasks.delete(e.taskId),this.ongoingTask=e),new Promise(function(i,o){n.doDownloadTaskImpl(e,t,r).then(i).catch(o)})}},{key:"doUploadTaskImpl",value:function(){var e=J(w.mark(function e(t,n){var r,i,o,a,s,c,u,l,d=this,h=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=i=t.manager,(r=2<h.length&&void 0!==h[2]&&h[2])&&(i=new es(o.metaInfo,o.transHandler,this.logger,o.ee)),a=t.fetcher,s=new Pa,u=new Promise(function(e,u){var l=a(),d=l.ret,h=l.err,p=l.timeout;l.fin.pipe(ob(s)).subscribe({next:function(e){n.resolve({type:"UPLOAD",retUnit:e.unit,zone:e.zone})},complete:function(){e({hasExist:!0}),s.next(),s.complete()}}),d.pipe(ob(s),cb(function(){var e=J(w.mark(function e(a){var s,u;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=a.servers,u=a.unit,r&&o.unit!==u?n.reject(new da("upload unit is different, reject to continue",lg)):r&&(t.manager=i,i.chunkCount=o.chunkCount,i.chunks=o.chunks,i.totalFailures=o.totalFailures,i.uploadedChunks=o.uploadedChunks,i.timer=o.timer,i.initState=o.initState,i.unit=o.unit,i.uploadedSize=o.uploadedSize,i.singleThread=o.singleThread,i.updateProgress(0)),i.addServers(s),"uninitialized"!==i.initState){e.next=7;break}return c=i.initChunks(u),e.next=7,c;case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())).subscribe({complete:function(){return e({hasExist:!1})},error:u}),l=function(t){"uninitialized"!==i.initState&&c?e(c.then(function(){return{hasExist:!1}})):u(t)},h.pipe(ob(s)).subscribe({error:l}),p.pipe(ob(s)).subscribe({error:l})}),e.next=9,u;case 9:if(!e.sent.hasExist){e.next=15;break}return i.updateProgress(),this.log("file already exists, skipping upload"),e.abrupt("return");case 15:s.next(),s.complete(),this.log("chunks initialization promise resolved"),l=gb(i.ee,"serverUsedUp").pipe(Gt(function(){return i.chunkCount!==i.uploadedChunks.length}),Jt(5e3,void 0,{leading:!1}),pm(function(){return a().ret})).subscribe(function(e){i.addServers(e.servers)}),i.ee.once("reconnected",function(){i.ee.removeAllListeners(),d.doUploadTask(t,n,!0).catch(function(e){n.reject(e)})}),i.ee.once("multiTimeOut",function(){i.ee.removeAllListeners(),d.doUploadTask(t,n,!0).catch(function(e){n.reject(e)})}),i.ee.once("timedOut",function(){l.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(new db("upload timed out",Lh))}),i.ee.once("error",function(e){l.unsubscribe(),i.ee.removeAllListeners(),i.abortController.abort(),n.reject(e||new da("upload error",lg))}),void 0!==i.transHandler.cancelSignal&&i.transHandler.cancelSignal.addEventListener("abort",function(){n.reject(new hl("Uploading canceled",hr))},{once:!0}),i.ee.once("finished",J(w.mark(function e(){var r,o,a;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.unsubscribe(),e.next=3,t.setter(i.unit,i.getUploadServerIPs());case 3:o=(r=e.sent).zone,a=r.unit,i.ee.removeAllListeners(),n.resolve({type:"UPLOAD",retUnit:a,zone:o});case 8:case"end":return e.stop()}},e)}))),i.uploadToServers();case 26:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"doUploadTask",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return r||(this.mediaTasks.delete(e.taskId),this.ongoingTask=e),new Promise(function(i,o){n.doUploadTaskImpl(e,t,r).then(i).catch(o)})}},{key:"processMediaTask",value:function(){var e=J(w.mark(function e(){var t,n,r;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.mediaTasks.size){e.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,t=this.mediaTasks.keys().next().value,void 0!==(n=this.taskFinishers[t])){e.next=7;break}throw Error("top task not found");case 7:if(void 0!==(r=this.mediaTasks.get(t))){e.next=10;break}throw new Ia("task invalid");case 10:if("UPLOAD"!==r.type){e.next=15;break}return e.next=13,this.doUploadTask(r,n).catch(function(e){r.manager.ee.removeAllListeners(),n.reject(e)});case 13:e.next=18;break;case 15:if("DOWNLOAD"!==r.type){e.next=18;break}return e.next=18,this.doDownloadTask(r,n).catch(function(e){r.manager.ee.removeAllListeners(),n.reject(e)});case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cancelTask",value:function(e){var t="DOWNLOAD"===e.type?ir:hr;e.manager.ee.removeAllListeners(),e.manager.abortController.abort(),void 0!==this.taskFinishers[e.taskId]&&this.taskFinishers[e.taskId].reject(new hl("User logged out or kicked off, media task canceled",t))}}]),t}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",function(){for(var e=0,t=arguments.length,n=new(Ne(this))(t);t>e;)n[e]=arguments[e++];return n},Dj);var gs=1/0,dD=Math.max,ju=function(e,t,n){var r=Object(e);if(!Ed(e)){var i=Te(t);e=Ad(e),t=function(e){return i(r[e],e,r)}}return-1<(t=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;if(null==n)n=0;else{var i=(n=n?(n=gl(n))===gs||n===-gs?17976931348623157e292*(0>n?-1:1):n==n?n:0:0===n?n:0)%1;n=n==n?i?n-i:n:0}return 0>n&&(n=dD(r+n,0)),Xp(e,Te(t),n)}(e,t,n))?r[i?e[t]:t]:void 0},iu=function(e,t){return e&&e.length?vk(e,void 0,"function"==typeof t?t:void 0):[]},hs=function(){function e(){W(this,e),m(this,"size",0),m(this,"fields",new Map)}return Ha(e,[{key:"define",value:function(e,t,n){if(this.size+=n,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(t={val:0,isNumber:"number"===t,isBoolean:"boolean"===t,oneof:"number"===t||"boolean"===t?void 0:t,len:n}),this.fields.set(e,t)}},{key:"set",value:function(e,t){if(!(e=this.fields.get(e)))throw Error("field not found");var n=e.oneof;if(!U.isLong(t)&&"number"!=typeof t)if("boolean"==typeof t)t=t?1:0;else{if(void 0===n)throw Error("invalid field type");if(void 0===(t=n[t]))throw Error("field type not found")}Mg(e,t),e.val=t}},{key:"toNumber",value:function(){for(var e=0,t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e+=U.fromValue(i).shiftLeft(t).toNumber(),t+=o)}return e}},{key:"toLong",value:function(){for(var e=U.fromNumber(0,!0),t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e=U.fromValue(i).shiftLeft(t).add(e),t+=o)}return e}},{key:"assert",value:function(e,t){function n(e){if(!U.isLong(e)&&"number"!=typeof e)if("boolean"==typeof e)e=e?1:0;else{if(void 0===i)throw Error("invalid field type");if(void 0===(e=i[e]))throw Error("field type not found")}return Mg(r,e),Lg(e,r.val)}var r=this.fields.get(e);if(!r)throw Error("field not found");var i=r.oneof;if(!Array.isArray(t))return n(t);if(1===t.length)return n(t[0]);if(t.every(function(e){return"string"==typeof e})&&void 0!==i)return t.some(function(e){return n(e)});throw Error("invalid valueTypes")}},{key:"from",value:function(e){e=U.fromValue(e);for(var t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=ra(r[n],2)[1],o=i.len,a=U.fromNumber(Math.pow(2,o)-1,!0).shiftLeft(t);Mg(i,a=e.and(a).shiftRightUnsigned(t)),i.val=a,t+=o}}},{key:"typeOf",value:function(e){if(void 0!==(e=this.fields.get(e))){var t=e.oneof;if(e=e.val,void 0!==t){var n=0;for(t=Object.entries(t);n<t.length;n++){var r=ra(t[n],2),i=r[0];if(Lg(e,r[1]))return i}}}throw new TypeError("can only get type of oneof type")}}]),e}(),is=function(e){function t(e){W(this,t);var r=n.call(this);return r.define("Rejoin","boolean",1),r.define("Unused","number",31),r.define("Platform","number",8),r.define("Version","number",12),r.define("Subversion","number",12),r.set("Platform",7),r.set("Version",4),r.set("Subversion",203),r.set("Rejoin",e),r}la(t,e);var n=ma(t);return t}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(e){function t(e){W(this,t);var r=n.call(this);if(r.define("MessageType",fD,8),r.define("BroadcastJumps","number",2),r.define("ToCache","boolean",1),r.define("FromCache","boolean",1),r.define("CompressionMethod",gD,2),r.define("IterationNumber","number",4),r.define("BufferedMessage","boolean",1),r.define("ToArchive","boolean",1),r.define("FromArchive","boolean",1),"number"==typeof e||U.isLong(e))r.from(e);else if(void 0!==e){var i=0;for(e=Hg(e);i<e.length;i++){var o=ra(e[i],2);r.set(o[0],o[1])}}return r}la(t,e);var n=ma(t);return Ha(t,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(e){var t=this;return void 0!==e?this.assert("MessageType",e):xf(js).some(function(e){return t.assert("MessageType",e)})}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),t}(hs),hD=function(e){function t(e){return W(this,t),m(n(e=r.call(this,e,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),e}la(t,e);var r=ma(t);return Ha(t,[{key:"getChatInfo",value:function(e){var t=this.dialogueLru.get(e);if(this.dialogueLru.prune(),t){var n=t.dialogue,r={dialogue:n,sequence:t=t.sequence.add(1)};return this.dialogueLru.set(e,{dialogue:n,sequence:t}),r}return n={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(e,n),n}}]),t}(tb()),v={};"object"==X(module)&&(module.exports=v),v.parse=function(e,t){var n,r=v.bin.readUshort,i=v.bin.readUint,o={};for(n=(e=new Uint8Array(e)).length-4;101010256!=i(e,n);)n--;var a=r(e,n=n+4+4);r(e,n+=2),i(e,n+=2),n=i(e,n+=4);for(var s=0;s<a;s++){i(e,n),n+=4,n+=4,n+=4,i(e,n+=4);var c=i(e,n+=4),u=i(e,n+=4),l=r(e,n+=4),d=r(e,n+2),h=r(e,n+4);n+=6;var p=i(e,n+=8);n+=4,n+=l+d+h,v._readLocal(e,p,o,c,u,t)}return o},v._readLocal=function(e,t,n,r,i,o){var a=v.bin.readUshort,s=v.bin.readUint;s(e,t),a(e,t+=4),a(e,t+=2);var c=a(e,t+=2);s(e,t+=2),s(e,t+=4),s=a(e,t=t+4+8);var u=a(e,t+=2);if(a=v.bin.readUTF8(e,t+=2,s),t=t+s+u,o)n[a]={size:i,csize:r};else if(e=new Uint8Array(e.buffer,t),0==c)n[a]=new Uint8Array(e.buffer.slice(t,t+r));else{if(8!=c)throw"unknown compression method: "+c;t=new Uint8Array(i),v.inflateRaw(e,t),n[a]=t}},v.inflateRaw=function(e,t){return v.F.inflate(e,t)},v.inflate=function(e,t){return v.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-2),t)},v.deflate=function(e,t){null==t&&(t={level:6});var n=0,r=new Uint8Array(50+Math.floor(1.1*e.length));return r[n]=120,r[n+1]=156,n=v.F.deflateRaw(e,r,n+2,t.level),e=v.adler(e,0,e.length),r[n+0]=e>>>24&255,r[n+1]=e>>>16&255,r[n+2]=e>>>8&255,r[n+3]=e>>>0&255,new Uint8Array(r.buffer,0,n+4)},v.deflateRaw=function(e,t){null==t&&(t={level:6});var n=new Uint8Array(50+Math.floor(1.1*e.length)),r=v.F.deflateRaw(e,n,r,t.level);return new Uint8Array(n.buffer,0,r)},v.encode=function(e,t){null==t&&(t=!1);var n,r=0,i=v.bin.writeUint,o=v.bin.writeUshort,a={};for(n in e){var s=!v._noNeed(n)&&!t,c=e[n],u=v.crc.crc(c,0,c.length);a[n]={cpr:s,usize:c.length,crc:u,file:s?v.deflateRaw(c):c}}for(n in a)r+=a[n].file.length+30+46+2*v.bin.sizeUTF8(n);for(n in e=new Uint8Array(r+22),t=0,c=[],a)u=a[n],c.push(t),t=v._writeHeader(e,t,n,u,0);for(n in r=0,s=t,a)u=a[n],c.push(t),t=v._writeHeader(e,t,n,u,1,c[r++]);return a=t-s,i(e,t,101010256),o(e,t=t+4+4,r),o(e,t+=2,r),i(e,t+=2,a),i(e,t+4,s),e.buffer},v._noNeed=function(e){return e=e.split(".").pop().toLowerCase(),-1!="png,jpg,jpeg,zip".indexOf(e)},v._writeHeader=function(e,t,n,r,i,o){var a=v.bin.writeUint,s=v.bin.writeUshort,c=r.file;return a(e,t,0==i?67324752:33639248),t+=4,1==i&&(t+=2),s(e,t,20),s(e,t+=2,0),s(e,t+=2,r.cpr?8:0),a(e,t+=2,0),a(e,t+=4,r.crc),a(e,t+=4,c.length),a(e,t+=4,r.usize),s(e,t+=4,v.bin.sizeUTF8(n)),s(e,t+=2,0),t+=2,1==i&&(a(e,t=t+2+2+6,o),t+=4),t+=n=v.bin.writeUTF8(e,t,n),0==i&&(e.set(c,t),t+=c.length),t},v.crc={table:function(){for(var e=new Uint32Array(256),t=0;256>t;t++){for(var n=t,r=0;8>r;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}(),update:function(e,t,n,r){for(var i=0;i<r;i++)e=v.crc.table[255&(e^t[n+i])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^v.crc.update(4294967295,e,t,n)}},v.adler=function(e,t,n){var r=1,i=0,o=t;for(t+=n;o<t;){for(n=Math.min(o+5552,t);o<n;)i+=r+=e[o++];r%=65521,i%=65521}return i<<16|r},v.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},readASCII:function(e,t,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(e,t,n){for(var r,i="",o=0;o<n;o++)i+="%"+v.bin.pad(e[t+o].toString(16));try{r=decodeURIComponent(i)}catch(r){return v.bin.readASCII(e,t,n)}return r},writeUTF8:function(e,t,n){for(var r=n.length,i=0,o=0;o<r;o++){var a=n.charCodeAt(o);if(4294967168&a)if(4294965248&a)if(4294901760&a){if(4292870144&a)throw"e";e[t+i]=240|a>>18,e[t+i+1]=128|a>>12&63,e[t+i+2]=128|a>>6&63,e[t+i+3]=128|63&a,i+=4}else e[t+i]=224|a>>12,e[t+i+1]=128|a>>6&63,e[t+i+2]=128|63&a,i+=3;else e[t+i]=192|a>>6,e[t+i+1]=128|63&a,i+=2;else e[t+i]=a,i++}return i},sizeUTF8:function(e){for(var t=e.length,n=0,r=0;r<t;r++){var i=e.charCodeAt(r);if(4294967168&i)if(4294965248&i)if(4294901760&i){if(4292870144&i)throw"e";n+=4}else n+=3;else n+=2;else n++}return n}},v.F={},v.F.deflateRaw=function(e,t,n,r){var i=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][r],o=v.F.U,a=v.F._goodIndex,s=v.F._putsE,c=0;n<<=3;var u=0,l=e.length;if(0==r){for(;c<l;){var d=Math.min(65535,l-c);s(t,n,c+d==l?1:0),n=v.F._copyExact(e,c,d,t,n+8),c+=d}return n>>>3}s=o.lits,r=o.strt;var h=o.prev,p=0,f=0,m=0,g=0,E=0;for(2<l&&(r[E=v.F._hash(e,0)]=0),c=0;c<l;c++){if(d=E,c+1<l-2){E=v.F._hash(e,c+1);var y=c+1&32767;h[y]=r[E],r[E]=y}if(u<=c){if((14e3<p||26697<f)&&100<l-c&&(u<c&&(s[p]=c-u,p+=2,u=c),n=v.F._writeBlock(c==l-1||u==l?1:0,s,p,g,e,m,c-m,t,n),p=f=g=0,m=c),y=0,c<l-2&&(y=v.F._bestMatch(e,c,h,d,Math.min(i[2],l-c),i[3])),0!=y){d=y>>>16,y&=65535;var _=a(d,o.of0);o.lhst[257+_]++;var b=a(y,o.df0);o.dhst[b]++,g+=o.exb[_]+o.dxb[b],s[p]=d<<23|c-u,s[p+1]=y<<16|_<<8|b,p+=2,u=c+d}else o.lhst[e[c]]++;f++}}for(m==c&&0!=e.length||(u<c&&(s[p]=c-u,p+=2),n=v.F._writeBlock(1,s,p,g,e,m,c-m,t,n));7&n;)n++;return n>>>3},v.F._bestMatch=function(e,t,n,r,i,o){var a=32767&t,s=n[a],c=a-s+32768&32767;if(s==a||r!=v.F._hash(e,t-c))return 0;for(var u=r=0,l=Math.min(32767,t);c<=l&&0!=--o&&s!=a;){if((0==r||e[t+r]==e[t+r-c])&&(a=v.F._howLong(e,t,c))>r){if(u=c,(r=a)>=i)break;c+2<a&&(a=c+2);for(var d=0,h=0;h<a-2;h++){var p=t-c+h+32768&32767,f=p-n[p]+32768&32767;f>d&&(d=f,s=p)}}c+=(a=s)-(s=n[a])+32768&32767}return r<<16|u},v.F._howLong=function(e,t,n){if(e[t]!=e[t-n]||e[t+1]!=e[t+1-n]||e[t+2]!=e[t+2-n])return 0;var r=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]==e[t-n];)t++;return t-r},v.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(e,t,n,r,i,o,a,s,c){var u=v.F.U,l=v.F._putsF,d=v.F._putsE;u.lhst[256]++;var h=v.F.getTrees(),p=h[0],f=h[1],m=h[2],g=h[3],E=h[4],y=h[5],_=h[6];h=h[7];var b=32+(c+3&7?8-(c+3&7):0)+(a<<3),S=r+v.F.contSize(u.fltree,u.lhst)+v.F.contSize(u.fdtree,u.dhst);r=r+v.F.contSize(u.ltree,u.lhst)+v.F.contSize(u.dtree,u.dhst),r+=14+3*y+v.F.contSize(u.itree,u.ihst)+(2*u.ihst[16]+3*u.ihst[17]+7*u.ihst[18]);for(var w=0;286>w;w++)u.lhst[w]=0;for(w=0;30>w;w++)u.dhst[w]=0;for(w=0;19>w;w++)u.ihst[w]=0;if(b=b<S&&b<r?0:S<r?1:2,l(s,c,e),l(s,c+1,b),c+=3,0==b){for(;7&c;)c++;c=v.F._copyExact(i,o,a,s,c)}else{if(1==b)var T=u.fltree,R=u.fdtree;if(2==b){for(v.F.makeCodes(u.ltree,p),v.F.revCodes(u.ltree,p),v.F.makeCodes(u.dtree,f),v.F.revCodes(u.dtree,f),v.F.makeCodes(u.itree,m),v.F.revCodes(u.itree,m),T=u.ltree,R=u.dtree,d(s,c,g-257),d(s,c+=5,E-1),d(s,c+=5,y-4),c+=4,e=0;e<y;e++)d(s,c+3*e,u.itree[1+(u.ordr[e]<<1)]);c=v.F._codeTiny(_,u.itree,s,c+3*y),c=v.F._codeTiny(h,u.itree,s,c)}for(y=0;y<n;y+=2){for(_=(e=t[y])>>>23,e=o+(8388607&e);o<e;)c=v.F._writeLit(i[o++],T,s,c);0!=_&&(e=(p=t[y+1])>>16,a=p>>8&255,p&=255,d(s,c=v.F._writeLit(257+a,T,s,c),_-u.of0[a]),l(s,c=v.F._writeLit(p,R,s,c+=u.exb[a]),e-u.df0[p]),c+=u.dxb[p],o+=_)}c=v.F._writeLit(256,T,s,c)}return c},v.F._copyExact=function(e,t,n,r,i){var o=i>>>3;return r[o]=n,r[o+1]=n>>>8,r[o+2]=255-r[o],r[o+3]=255-r[o+1],o+=4,r.set(new Uint8Array(e.buffer,t,n),o),i+(n+4<<3)},v.F.getTrees=function(){for(var e=v.F.U,t=v.F._hufTree(e.lhst,e.ltree,15),n=v.F._hufTree(e.dhst,e.dtree,15),r=[],i=v.F._lenCodes(e.ltree,r),o=[],a=v.F._lenCodes(e.dtree,o),s=0;s<r.length;s+=2)e.ihst[r[s]]++;for(s=0;s<o.length;s+=2)e.ihst[o[s]]++;s=v.F._hufTree(e.ihst,e.itree,7);for(var c=19;4<c&&0==e.itree[1+(e.ordr[c-1]<<1)];)c--;return[t,n,s,i,a,c,r,o]},v.F.getSecond=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(e[n+1]);return t},v.F.nonZero=function(e){for(var t="",n=0;n<e.length;n+=2)0!=e[n+1]&&(t+=(n>>1)+",");return t},v.F.contSize=function(e,t){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[1+(r<<1)];return n},v.F._codeTiny=function(e,t,n,r){for(var i=0;i<e.length;i+=2){var o=e[i],a=e[i+1];r=v.F._writeLit(o,t,n,r);var s=16==o?2:17==o?3:7;15<o&&(v.F._putsE(n,r,a,s),r+=s)}return r},v.F._lenCodes=function(e,t){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var r=0;r<n;r+=2){var i=e[r+1],o=r+3<n?e[r+3]:-1,a=r+5<n?e[r+5]:-1,s=0==r?-1:e[r-1];if(0==i&&o==i&&a==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;11>(i=Math.min(o+1-r>>>1,138))?t.push(17,i-3):t.push(18,i-11),r+=2*i-2}else if(i==s&&o==i&&a==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;i=Math.min(o+1-r>>>1,6),t.push(16,i-3),r+=2*i-2}else t.push(i,0)}return n>>>1},v.F._hufTree=function(e,t,n){var r=[],i=e.length,o=t.length,a=0;for(a=0;a<o;a+=2)t[a]=0,t[a+1]=0;for(a=0;a<i;a++)0!=e[a]&&r.push({lit:a,f:e[a]});if(e=r.length,i=r.slice(0),0==e)return 0;if(1==e)return t[1+((n=r[0].lit)<<1)]=1,t[1+((0==n?1:0)<<1)]=1;r.sort(function(e,t){return e.f-t.f});var s=0,c=1,u=2;for(r[0]={lit:-1,f:(a=r[0]).f+(o=r[1]).f,l:a,r:o,d:0};c!=e-1;)a=s!=c&&(u==e||r[s].f<r[u].f)?r[s++]:r[u++],o=s!=c&&(u==e||r[s].f<r[u].f)?r[s++]:r[u++],r[c++]={lit:-1,f:a.f+o.f,l:a,r:o};for((r=v.F.setDepth(r[c-1],0))>n&&(v.F.restrictDepth(i,n,r),r=n),a=0;a<e;a++)t[1+(i[a].lit<<1)]=i[a].d;return r},v.F.setDepth=function(e,t){return-1!=e.lit?e.d=t:Math.max(v.F.setDepth(e.l,t+1),v.F.setDepth(e.r,t+1))},v.F.restrictDepth=function(e,t,n){var r=0,i=1<<n-t,o=0;for(e.sort(function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d}),r=0;r<e.length&&e[r].d>t;r++){var a=e[r].d;e[r].d=t,o+=i-(1<<n-a)}for(o>>>=n-t;0<o;)(a=e[r].d)<t?(e[r].d++,o-=1<<t-a-1):r++;for(;0<=r;r--)e[r].d==t&&0>o&&(e[r].d--,o++);0!=o&&console.log("debt left")},v.F._goodIndex=function(e,t){var n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n},v.F._writeLit=function(e,t,n,r){return v.F._putsF(n,r,t[e<<1]),r+t[1+(e<<1)]},v.F.inflate=function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var r=v.F,i=r._bitsF,o=r._bitsE,a=r._decodeTiny,s=r.makeCodes,c=r.codes2map,u=r._get17,l=r.U,d=null==t;d&&(t=new n(e.length>>>2<<3));for(var h,p,f,m,g=0,E=0,y=p=0,_=0;0==g;)if(g=i(e,_,1),h=i(e,_+1,2),_+=3,0==h)!!(7&_)&&(_+=8-(7&_)),h=e[(_=4+(_>>>3))-4]|e[_-3]<<8,d&&(t=v.F._check(t,y+h)),t.set(new n(e.buffer,e.byteOffset+_,h),y),_=_+h<<3,y+=h;else{if(d&&(t=v.F._check(t,y+131072)),1==h&&(f=l.flmap,m=l.fdmap,E=511,p=31),2==h){for(p=o(e,_,5)+257,h=o(e,_+5,5)+1,f=o(e,_+10,4)+4,_+=14,m=0;38>m;m+=2)l.itree[m]=0,l.itree[m+1]=0;for(E=1,m=0;m<f;m++){var b=o(e,_+3*m,3);l.itree[1+(l.ordr[m]<<1)]=b,b>E&&(E=b)}_+=3*f,s(l.itree,E),c(l.itree,E,l.imap),f=l.lmap,m=l.dmap,_=a(l.imap,(1<<E)-1,p+h,e,_,l.ttree),E=(1<<(b=r._copyOut(l.ttree,0,p,l.ltree)))-1,p=(1<<(h=r._copyOut(l.ttree,p,h,l.dtree)))-1,s(l.ltree,b),c(l.ltree,b,f),s(l.dtree,h),c(l.dtree,h,m)}for(;;)if(_+=15&(h=f[u(e,_)&E]),0==(b=h>>>4)>>>8)t[y++]=b;else{if(256==b)break;h=y+b-254,264<b&&(h=y+((b=l.ldef[b-257])>>>3)+o(e,_,7&b),_+=7&b),_+=15&(b=m[u(e,_)&p]);var S=((b=l.ddef[b>>>4])>>>4)+i(e,_,15&b);for(_+=15&b,d&&(t=v.F._check(t,y+131072));y<h;)t[y]=t[y++-S],t[y]=t[y++-S],t[y]=t[y++-S],t[y]=t[y++-S];y=h}}return t.length==y?t:t.slice(0,y)},v.F._check=function(e,t){var n=e.length;return t<=n?e:((t=new Uint8Array(Math.max(n<<1,t))).set(e,0),t)},v.F._decodeTiny=function(e,t,n,r,i,o){for(var a=v.F._bitsE,s=v.F._get17,c=0;c<n;){var u=e[s(r,i)&t];i+=15&u;var l=u>>>4;if(15>=l)o[c]=l,c++;else{var d=u=0;for(16==l?(d=3+a(r,i,2),i+=2,u=o[c-1]):17==l?(d=3+a(r,i,3),i+=3):18==l&&(d=11+a(r,i,7),i+=7),l=c+d;c<l;)o[c]=u,c++}}return i},v.F._copyOut=function(e,t,n,r){for(var i=0,o=0,a=r.length>>>1;o<n;){var s=e[o+t];r[o<<1]=0,r[1+(o<<1)]=s,s>i&&(i=s),o++}for(;o<a;)r[o<<1]=0,r[1+(o<<1)]=0,o++;return i},v.F.makeCodes=function(e,t){var n,r,i=v.F.U,o=e.length,a=i.bl_count;for(n=0;n<=t;n++)a[n]=0;for(n=1;n<o;n+=2)a[e[n]]++;for(i=i.next_code,n=0,a[0]=0,r=1;r<=t;r++)i[r]=n=n+a[r-1]<<1;for(t=0;t<o;t+=2)0!=(a=e[t+1])&&(e[t]=i[a],i[a]++)},v.F.codes2map=function(e,t,n){for(var r=e.length,i=v.F.U.rev15,o=0;o<r;o+=2)if(0!=e[o+1]){var a=e[o+1],s=o>>1<<4|a,c=t-a;for(c=(a=e[o]<<c)+(1<<c);a!=c;)n[i[a]>>>15-t]=s,a++}},v.F.revCodes=function(e,t){for(var n=v.F.U.rev15,r=15-t,i=0;i<e.length;i+=2)e[i]=n[e[i]<<t-e[i+1]]>>>r},v.F._putsE=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8},v.F._putsF=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8,e[t+2]|=n>>>16},v.F._bitsE=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},v.F._bitsF=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},v.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},v.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},v.F.U=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}(),function(){function e(e,t,n){for(;0!=t--;)e.push(0,n)}for(var t=v.F.U,n=0;32768>n;n++){var r=n;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,t.rev15[n]=(r>>>16|r<<16)>>>17}for(n=0;32>n;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];e(t.fltree,144,8),e(t.fltree,112,9),e(t.fltree,24,7),e(t.fltree,8,8),v.F.makeCodes(t.fltree,9),v.F.codes2map(t.fltree,9,t.flmap),v.F.revCodes(t.fltree,9),e(t.fdtree,32,5),v.F.makeCodes(t.fdtree,5),v.F.codes2map(t.fdtree,5,t.fdmap),v.F.revCodes(t.fdtree,5),e(t.itree,19,0),e(t.ltree,286,0),e(t.dtree,30,0),e(t.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(e){function t(e,i,o,a){W(this,t);var s=r.call(this,a,"Session");return m(n(s),"chatManager",void 0),m(n(s),"joinedChannels",new Set),m(n(s),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(s),"startTime",Date.now()),m(n(s),"seq",U.fromNumber(1,!0)),m(n(s),"userJoinOptions",new is(!1)),m(n(s),"seqSentStatuses",[!1,!1]),m(n(s),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(s),"loggedOut",!1),m(n(s),"messageSentTimes",[]),m(n(s),"curLoginSockets",[void 0,void 0]),m(n(s),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(s),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(s),"dialPendingMsgSubjectMap",new Map),m(n(s),"context",void 0),m(n(s),"connection",void 0),m(n(s),"instanceId",void 0),m(n(s),"registerSocketsFailureListener",function(){s.connection.once("socketsFailure",function(){s.log("socketsFailure, creating a new connection"),ad(function(){return s.connection.removeAllListeners(),s.connection=new Yr(s.context,s.logger,!0),s.loginHandler(15e3,!0)}).pipe(oe(function(e){return e.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))}),ob(s.connection.apClient.apFinish$)).subscribe(function(){s.log("new connection connected")})}),0===s.connection.listenerCount("tokenExpired")&&s.connection.on("tokenExpired",function(){s.emit("tokenExpired")})}),s.context=e,s.connection=i,s.instanceId=o,s.chatManager=new hD(a),s.log("The instanceId is %s",s.instanceId.toString()),s}la(t,e);var r=ma(t);return Ha(t,[{key:"fetchFileUploadIndexGet",value:function(e){var n=e.hash,r=e.size;if(0===(e=this.getLoginSockets()).length)throw new K("Client is not logged in");var i=this.incGetSeq();return e.forEach(function(e){e.sendPacket("FileUploadIndexGet",{seq:i,hash:n,size:r})}),{ret:Ca.apply(void 0,G(e.map(function(e){return e.fromReceived("FileUploadIndexRet").pipe(aa(function(e){return i.eq(e.seq)}))}))),fin:Ca.apply(void 0,G(e.map(function(e){return e.fromReceived("FileUploadIndexFin").pipe(aa(function(e){return i.eq(e.seq)}))}))),err:Xb.apply(void 0,G(e.map(function(e){return e.fromReceived("FileUploadIndexErr").pipe(aa(function(e){return i.eq(e.seq)}),ba(function(e){throw new da(["The media message upload failure, code %d",e.code],lg)}))}))),timeout:t.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(e){var n=e.hash,r=e.unit,i=e.servers;if(0===(e=this.getLoginSockets()).length)throw new K("Client is not logged in");var o=this.incGetSeq();return e.forEach(function(e){e.sendPacket("FileUploadIndexSet",{seq:o,servers:i,hash:n,unit:r})}),Ca.apply(void 0,[t.genTimeoutError(Lh)].concat(G(e.map(function(e){return e.fromReceived("FileUploadIndexErr").pipe(aa(function(e){return o.eq(e.seq)}),ba(function(e){throw new da(["FileUploadIndexSet failure, code %d",e.code],lg)}))})),G(e.map(function(e){return e.fromReceived("FileUploadIndexFin").pipe(aa(function(e){return o.eq(e.seq)}))}))))}},{key:"requestFileDownloadIndexGet",value:function(e){var n=e.size,r=e.zone,i=e.unit,o=e.hash,a=this.getLoginSockets();if(0===a.length)throw new K("Client is not logged in");var s=this.incGetSeq();return a.forEach(function(e){e.sendPacket("FileDownloadIndexGet",{seq:s,size:n,zone:r,unit:i,hash:o})}),e=Ca.apply(void 0,G(a.map(function(e){return e.fromReceived("FileDownloadIndexRet").pipe(aa(function(e){return s.eq(e.seq)}))}))).pipe(ba(function(e){var t=e.backups,n=e.servers;return e=ff(e,iD),ua({backupList:t.map(function(e){return[e]}),serverList:n.map(function(e){return[e]})},e)}),cd(500)),a=jm(a.map(function(e){return e.fromReceived("FileDownloadIndexRet").pipe(aa(function(e){return s.eq(e.seq)}))})),Ca(e,a.pipe(ba(function(e){return e.reduce(function(e,t){var n=e.backupList,r=e.serverList;e=t.backups;var i=t.servers;return t=ff(t,jD),ua({backupList:e.map(function(e,t){return[e].concat(G(void 0!==n&&Array.isArray(n[t])?n[t]:[]))}),serverList:i.map(function(e,t){return[e].concat(G(void 0!==n&&Array.isArray(r[t])?r[t]:[]))})},t)},{})})),t.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2e4,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this.loggedOut&&n)throw new K("Already logged out, request ignored");n&&this.registerSocketsFailureListener(),this.connection.initConnection();var r=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),i=Date.now();return r.forEach(function(t,r){var o=e.loginSocketSubs[r].login;void 0!==o&&o.unsubscribe(),e.loginSocketSubs[r].login=t.pipe(ca(function(t){var o;e.curLoginSockets[r]=t;var a=Date.now();eb("Link",{ackedServerIp:t.address,destServerIp:t.ip,ec:0,sc:0,elapse:fb(e.startTime),lts:U.fromNumber(a),responseTime:i-a,sid:Xa(e.instanceId),userId:e.context.uid},null!==(o=e.context.config.enableCloudProxy)&&void 0!==o&&o),e.emit("userJoined",t.env),n&&e.connection.apClient.apFinish$.next(void 0)})).subscribe(e.lastLoginSockets[r])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(r).concat([gb(this.connection,"connectionInitFailure").pipe(ca(function(e){if(sa(e)||Sa(e))throw e;throw new da("Login failure",{code:Zq,originalError:e})}))])).pipe(Ka(1),hb(t),Ga(function(t){return t instanceof pb&&e.warn("Client login timeout"),t&&t.code===Kh&&(e.connection.emit("tokenExpired"),e.connection.apClient.apFinish$.next(void 0)),e.clearSockets(0,n),Z(t)}),ca(function(){n||e.registerSocketsFailureListener()}),wg(function(){n||e.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:function(){var e=J(w.mark(function e(){var t,n,r,i=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),t=this.getLoginSockets(),n=t.map(function(e){return e.sendPacket("UserQuit",{}),i.connection.waitClosing(e)}),this.clearSockets(5e3),r=t.map(function(e){return e.env}),[0,1].filter(function(e){return!r.includes(e)}).forEach(function(e){i.connection.closeSocket(e,0)}),e.abrupt("return",Xb.apply(void 0,G(n)).toPromise());case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var e=J(w.mark(function e(t,n){var r,i,o,a=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.getLoginSockets().length){e.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return r=gb(this,"channelLeft").pipe(wb(function(e){return e===t}),Ka(1)),i=this.incGetSeq(),(o=this.lastLoginSockets.map(function(e){return e.pipe(Cc(function(e,t){0!==t&&a.incSeqIfNeeded(e.env);var r=0===t?i:a.seq;return e.sendPacket("GroupEnter",{account:n,seq:r}),e.fromReceived("GroupReply").pipe(aa(function(e){return r.eq(e.seq)}),ca(function(e){if(0!==(e=e.code))throw new da(["Channel join failure. The response code is %d",e],Rq)}))}),ob(r),pe())})).forEach(function(e,n){var r=function(){return a.loginSocketSubs[n].channels.delete(t.channelId)};a.loginSocketSubs[n].channels.set(t.channelId,e.subscribe({error:r,complete:r}))}),e.next=8,Xb.apply(void 0,G(o)).pipe(Ka(1),hb(1e4),Ga(function(e){return e instanceof pb&&a.warn("Channel join timeout"),Z(e)})).toPromise();case 8:this.joinedChannels.add(t);case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(e,t){this.emit("channelLeft",e),this.joinedChannels.delete(e),this.getLoginSockets().forEach(function(e){e.sendPacket("GroupLeave",{account:t})})}},{key:"requestChannelMemberList",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in. Cannot get the channel members",cA);var r=this.incGetSeq();return n.forEach(function(t){t.sendPacket("GroupAllUsersList",{group:e,pageNumber:0,pageSize:200,seq:r})}),Ca.apply(void 0,[t.genTimeoutError(Pq)].concat(G(n.map(function(t){return t.fromReceived("GroupAllUsersResult").pipe(aa(function(t){return t.group===e&&r.eq(t.seq)}))}))))}},{key:"requestPeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach(function(t){t.sendPacket("UserStatusList",{users:e,seq:r})}),Ca.apply(void 0,[t.genTimeoutError(oA)].concat(G(n.map(function(e){return e.fromReceived("UserStatusResult").pipe(aa(function(e){return r.eq(e.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(e,n){var r=this,i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach(function(t,i){void 0!==n&&i!==n||t.sendPacket("UserAttributeSet",{account:r.context.uid,attributeInfos:Object.entries(e).map(function(e){return{key:(e=ra(e,2))[0],value:e[1]}}),seq:o})}),Ca.apply(void 0,G(i.map(function(e){return e.fromReceived("UserAttributeErr").pipe(aa(function(e){return o.eq(e.seq)}),ba(function(e){throw new da(["The user attributes set failure, code %d",e.code],Sb)}))})).concat([t.genTimeoutError(Tb)],G(i.map(function(e){return e.fromReceived("UserAttributeRsp").pipe(aa(function(e){return o.eq(e.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach(function(t){t.sendPacket("GroupAttributeSet",{broadcast:r,group:e,attributeInfos:Object.entries(n).map(function(e){return{key:(e=ra(e,2))[0],value:e[1]}}),seq:o})}),Ca.apply(void 0,G(i.map(function(e){return e.fromReceived("GroupAttributeErr").pipe(aa(function(e){return o.eq(e.seq)}),ba(function(e){throw new da(["The group attributes set failure, code %d",e.code],Sb)}))})).concat([t.genTimeoutError(Tb)],G(i.map(function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa(function(e){return o.eq(e.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach(function(t){t.sendPacket("UserAttributeMod",{account:n.context.uid,attributeInfos:Object.entries(e).map(function(e){return{key:(e=ra(e,2))[0],value:e[1]}}),seq:i})}),Ca.apply(void 0,G(r.map(function(e){return e.fromReceived("UserAttributeErr").pipe(aa(function(e){return i.eq(e.seq)}),ba(function(e){throw new da(["The user attributes add or update failure, code %d",e.code],Sb)}))})).concat([t.genTimeoutError(Tb)],G(r.map(function(e){return e.fromReceived("UserAttributeRsp").pipe(aa(function(e){return i.eq(e.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach(function(t){t.sendPacket("GroupAttributeMod",{broadcast:r,group:e,attributeInfos:Object.entries(n).map(function(e){return{key:(e=ra(e,2))[0],value:e[1]}}),seq:o})}),Ca.apply(void 0,G(i.map(function(e){return e.fromReceived("GroupAttributeErr").pipe(aa(function(e){return o.eq(e.seq)}),ba(function(e){throw new da(["The group attributes add or update failure, code %d",e.code],Sb)}))})).concat([t.genTimeoutError(Tb)],G(i.map(function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa(function(e){return o.eq(e.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach(function(t){t.sendPacket("UserAttributeDel",{account:n.context.uid,attributes:e,seq:i})}),Ca.apply(void 0,G(r.map(function(e){return e.fromReceived("UserAttributeErr").pipe(aa(function(e){return i.eq(e.seq)}),ba(function(e){throw new da(["The user attributes delete failure, code %d",e.code],Sb)}))})).concat([t.genTimeoutError(Tb)],G(r.map(function(e){return e.fromReceived("UserAttributeRsp").pipe(aa(function(e){return i.eq(e.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new K("Client is not logged in");var o=this.incGetSeq();return i.forEach(function(t){t.sendPacket("GroupAttributeDel",{group:e,broadcast:r,attributes:n,seq:o})}),Ca.apply(void 0,G(i.map(function(e){return e.fromReceived("GroupAttributeErr").pipe(aa(function(e){return o.eq(e.seq)}),ba(function(e){throw new da(["The channel attributes delete failure, code %d",e.code],Sb)}))})).concat([t.genTimeoutError(Tb)],G(i.map(function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa(function(e){return o.eq(e.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var e=this,n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach(function(t){t.sendPacket("UserAttributeSet",{account:e.context.uid,seq:r,attributeInfos:[]})}),Ca.apply(void 0,G(n.map(function(e){return e.fromReceived("UserAttributeErr").pipe(aa(function(e){return r.eq(e.seq)}),ba(function(e){throw new da(["The user attributes clear failure, code %d",e.code],Sb)}))})).concat([t.genTimeoutError(Tb)],G(n.map(function(e){return e.fromReceived("UserAttributeRsp").pipe(aa(function(e){return r.eq(e.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach(function(t){t.sendPacket("GroupAttributeSet",{group:e,seq:i,attributeInfos:[],broadcast:n})}),Ca.apply(void 0,G(r.map(function(e){return e.fromReceived("GroupAttributeErr").pipe(aa(function(e){return i.eq(e.seq)}),ba(function(e){throw new da(["The channel attributes clear failure, code %d",e.code],Sb)}))})).concat([t.genTimeoutError(Tb)],G(r.map(function(e){return e.fromReceived("GroupAttributeRsp").pipe(aa(function(e){return i.eq(e.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach(function(t){t.sendPacket("UserAttributeGet",{account:e,seq:i,attributes:n})}),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(r.map(function(e){return e.fromReceived("UserAttributeErr").pipe(aa(function(e){return i.eq(e.seq)}),ba(function(e){if(10008===(e=e.code))throw new da("The user requested is not online",Lq);throw new Wc(["User attribute operation unknown error code: %d",e],Sb)}))})),G(r.map(function(e){return e.fromReceived("UserAttributeRet").pipe(aa(function(e){return i.eq(e.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new K("Client is not logged in");var i=this.incGetSeq();return r.forEach(function(t){t.sendPacket("GroupAttributeGet",{group:e,seq:i,attributes:n})}),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(r.map(function(e){return e.fromReceived("GroupAttributeErr").pipe(aa(function(e){return i.eq(e.seq)}),ba(function(e){throw new da(["The channel attributes get failure, code %d",e.code],Sb)}))})),G(r.map(function(e){return e.fromReceived("GroupAttributeRet").pipe(aa(function(e){return i.eq(e.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach(function(t){t.sendPacket("UserAttributeKeysGet",{account:e,seq:r})}),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(n.map(function(e){return e.fromReceived("UserAttributeErr").pipe(aa(function(e){return r.eq(e.seq)}),ba(function(e){if(10008===(e=e.code))throw new da("The user requested is not online",Lq);throw new Wc(["User attribute operation unknown error code: %d",e],Sb)}))})),G(n.map(function(e){return e.fromReceived("UserAttributeKeysRet").pipe(aa(function(e){return r.eq(e.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach(function(t){t.sendPacket("GroupAttributeKeysGet",{group:e,seq:r})}),Ca.apply(void 0,[t.genTimeoutError(Tb)].concat(G(n.map(function(e){return e.fromReceived("GroupAttributeErr").pipe(aa(function(e){return r.eq(e.seq)}),ba(function(e){throw new Wc(["Channel attribute operation unknown error code: %d",e.code],Sb)}))})),G(n.map(function(e){return e.fromReceived("GroupAttributeKeysRet").pipe(aa(function(e){return r.eq(e.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach(function(t){t.sendPacket("GroupStatusList",{groups:e,seq:r})}),Ca.apply(void 0,[t.genTimeoutError(Pq)].concat(G(n.map(function(e){return e.fromReceived("GroupStatusResult").pipe(aa(function(e){return r.eq(e.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new K("Client is not logged in");var r=this.incGetSeq();return n.forEach(function(t){t.sendPacket("SubscribeUserStatus",{seq:r,users:e})}),Ca.apply(void 0,[t.genTimeoutError(vA)].concat(G(n.map(function(e){return e.fromReceived("SubscribeResponse").pipe(aa(function(e){return r.eq(e.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(e){var t=this.getLoginSockets();if(0===t.length)throw new K("Client is not logged in");var n=this.incGetSeq();t.forEach(function(t){t.sendPacket("UnsubscribeUserStatus",{seq:n,users:e})})}},{key:"sendInvitationMessage",value:function(){var e=J(w.mark(function e(t){var n,r,i,o,a,s,c,u,l,d=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.peerId,r=t.extra,o=t.channelId,a=t.type,s={callId:t.callId},void 0===(i=t.isAcceptAck)){e.next=6;break}if("CallAccept"===a){e.next=5;break}throw Error("invalid invitation type");case 5:s.type=i?"ack":"request";case 6:return s.channel=o,("CallInvite"===a||"CallCancel"===a||"CallReject"===a||"CallAccept"===a&&!1===i)&&void 0!==r&&(s.extra=r),c=Bg(),this.log("The sent invitation body is %o",s),u=function(e){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:c,instance:d.instanceId,dst:n,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,MessageType:a}).toLong(),payload:(new TextEncoder).encode(JSON.stringify(s)),src:d.context.uid}},e.next=14,Kb(this.sendMessageToRetry(u,!0)).pipe(hb(1e4),Ga(function(e){return e instanceof pb&&d.warn("Send invitation timeout"),Z(e)})).toPromise();case 14:return e.abrupt("return",{hasPeerReceived:0===(l=e.sent).code,hasReSent:0!==l.retryTimes});case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var e=J(w.mark(function e(t,n,r,i,o,a){var s,c,u,l,d,h,p,f,g,v,E,y,_,b,S,T,R,C,O,A,N,k,P,L,D,M,x,F,$=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=void 0===(c=n.width)?0:c,d=void 0===(l=n.height)?0:l,p=void 0===(h=n.fileName)?"":h,g=void 0===(f=n.description)?"":f,E=void 0===(v=n.thumbnail)?new Blob:v,_=void 0===(y=n.thumbnailHeight)?0:y,S=void 0===(b=n.thumbnailWidth)?0:b,R=void 0===(T=n.size)?0:T,C=n.mediaId,O=o.enableOfflineMessaging,A=o.enableHistoricalMessaging,za(r)){e.next=4;break}throw new I("The send message arguments are not valid",i?$k:hg);case 4:if(!(32768<new Blob([p,E,g]).size)){e.next=6;break}throw new I("The size of message overflowed ",i?ve:Hh);case 6:return N=this.chatManager.getChatInfo(r),k=N.dialogue,P=N.sequence,this.log('A%s media message is sending to %s: "'.concat(L=this.instanceId,"-").concat(k,"#").concat(P,'"'),i?" peer":" channel",oa(r)),m(s={},"media_description",g),m(s,"media_width",u),m(s,"media_height",d),m(s,"media_thumbnailwidth",S),m(s,"media_thumbnailheight",_),m(s,"media_size",R),m(s,"media_id",C),m(s,"media_filename",p),D=uc(s,function(e){return(new TextEncoder).encode(e.toString())}),e.t0=Uint8Array,e.next=14,Ji(E);case 14:return e.t1=e.sent,D.media_thumbnail=new e.t0(e.t1),M=i&&"IMAGE"===t?"PeerImageMessage":i&&"FILE"===t?"PeerFileMessage":i||"IMAGE"!==t?"ChannelFileMessage":"ChannelImageMessage",x=function(e){return{MiscMap:D,sequence:P,dialogue:k,instance:L,dst:r,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:"Uncompressed",MessageType:M,ToCache:O,ToArchive:A}).toLong(),payload:new Uint8Array,src:$.context.uid}},e.next=20,Kb(this.sendMessageToRetry(x,!0)).pipe(hb(void 0===a?1e4:a),Ga(function(e){return e instanceof pb&&$.warn("Send message timeout"),Z(e)})).toPromise();case 20:if(2!==(F=e.sent.code)){e.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return e.abrupt("return",{hasPeerReceived:0===F});case 25:case"end":return e.stop()}},e,this)}));return function(t,n,r,i,o,a){return e.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var e=J(w.mark(function e(t,n,r,i,o,a){var s,c,u,l,d,h,p,f,m=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=o.enableOfflineMessaging,c=o.enableHistoricalMessaging,za(r)&&t instanceof Uint8Array&&"string"==typeof n){e.next=3;break}throw new I("The send message arguments are not valid",i?$k:hg);case 3:if(!(32768<t.byteLength+new Blob([n]).size)){e.next=5;break}throw new ib("The message size is over the 32KB limit",i?ve:Hh);case 5:return u=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=t.byteLength,l=this.chatManager.getChatInfo(r),d=l.dialogue,h=l.sequence,this.log('A%s %s raw message is sending to %s: "'.concat(p=this.instanceId,"-").concat(d,"#").concat(h,'"'),u?" compressed":"",i?"peer":"channel",oa(r)),f=function(e){return{MiscMap:{description:(new TextEncoder).encode(n)},sequence:h,dialogue:d,instance:p,dst:r,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:u?"Zlib":"Uncompressed",MessageType:i?"PeerRawMessage":"ChannelRawMessage",ToCache:s,ToArchive:c}).toLong(),payload:u?ks(t):t,src:m.context.uid}},e.next=12,Kb(this.sendMessageToRetry(f,!0)).pipe(hb(void 0===a?1e4:a),Ga(function(e){return e instanceof pb&&m.warn("Send message timeout"),Z(e)})).toPromise();case 12:return e.abrupt("return",{hasPeerReceived:0===e.sent.code});case 15:case"end":return e.stop()}},e,this)}));return function(t,n,r,i,o,a){return e.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var e=J(w.mark(function e(t,n,r,i,o){var a,s,c,u,l,d,h,p,f,m=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.enableOfflineMessaging,s=i.enableHistoricalMessaging,za(n)){e.next=3;break}throw new I("The send message arguments are not valid",r?$k:hg);case 3:if(!(32768<new Blob([t]).size)){e.next=5;break}throw new ib("The message size is over the 32KB limit",r?ve:Hh);case 5:return c=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([t]).size,u=this.chatManager.getChatInfo(n),l=u.dialogue,d=u.sequence,this.log('A%s %s message is sending to %s: "'.concat(h=this.instanceId,"-").concat(l,"#").concat(d,'"'),c?" compressed":"",r?"peer":"channel",oa(n)),p=(new TextEncoder).encode(t),f=function(e){return{MiscMap:{},sequence:d,dialogue:l,instance:h,dst:n,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:e,CompressionMethod:c?"Zlib":"Uncompressed",MessageType:r?"PeerTextMessage":"ChannelTextMessage",ToCache:a,ToArchive:s}).toLong(),payload:c?ks(p):p,src:m.context.uid}},e.next=13,Kb(this.sendMessageToRetry(f,!0)).pipe(hb(void 0===o?1e4:o),Ga(function(e){return e instanceof pb&&m.warn("Send message timeout"),Z(e)})).toPromise();case 13:return e.abrupt("return",{hasPeerReceived:0===e.sent.code});case 16:case"end":return e.stop()}},e,this)}));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(e,t){Object.entries(this.loginSocketSubs[e]).forEach(function(e){var n=(e=ra(e,2))[1];"channels"===e[0]&&t||(Array.isArray(n)||n instanceof Map?n.forEach(function(e){return e.unsubscribe()}):n&&n.unsubscribe())}),this.loginSocketSubs[e]={channels:t?this.loginSocketSubs[e].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var e=J(w.mark(function e(t,n){var r,i,o,a,s,c,u,l,d=this,h=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<h.length&&void 0!==h[2]?h[2]:0,this.log("Attempt to send the message ".concat(n?" with retrying, %o":"without retrying"),{retryTimes:r}),0!==(i=this.getLoginSockets()).length){e.next=5;break}throw Error("no logged-in sockets");case 5:return o=t(r),i.forEach(function(e){e.sendPacket("Message",o)}),a=o.dialogue,s=o.sequence,c=o.instance,u=i.map(function(e){return e.fromReceived("Ack").pipe(wb(function(e){return a.eq(e.dialogue)&&s.eq(e.sequence)&&c.eq(e.instance)}))}),e.prev=9,e.next=12,Xb.apply(void 0,G(u)).pipe(hb(6e3),Ga(function(e){return Sa(e)&&d.warn("Message send timeout, retry times %d",r),Z(e)}),Ka(1)).toPromise();case 12:return this.log("The message has been acked, %o",{code:l=e.sent.code}),e.abrupt("return",{code:l,retryTimes:r});case 18:if(e.prev=18,e.t0=e.catch(9),!(e.t0 instanceof pb&&n)){e.next=22;break}return e.abrupt("return",this.sendMessageToRetry(t,!1,r+1));case 22:throw e.t0;case 23:case"end":return e.stop()}},e,this,[[9,18]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var e=this;this.lastLoginSockets.map(function(t){return t.pipe(Cc(function(t){return Bc(0,2750).pipe(ca(function(){e.incSeqIfNeeded(t.env),t.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:e.seq})}))}))}).forEach(function(t,n){var r=e.loginSocketSubs[n].keepAlive;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAlive=t.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var e=this;this.lastLoginSockets.map(function(e){return e.pipe(Cc(function(e){var t,n=!1,r=e.userJoin$.pipe(ca(function(){n=!0})),i=e.input$.pipe(ca(function(e){"Ping"!==Li[e.uri].slice(0,-3)&&(n=!1)}));return Xb(Bc(15e3,1e4).pipe(Pt(e.receivedPacket),ca(function(r){r=ra(r,2),r=ra(r[1],2)[1],t!==r||n||e.forceReconnect(),t=r})),r,i)}))}).forEach(function(t,n){var r=e.loginSocketSubs[n].keepAliveReconnector;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAliveReconnector=t.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var e=this;this.lastLoginSockets.map(function(t){return t.pipe(Cc(function(t){return Xb(gb(t,"reconnect").pipe(ca(e.onSocketReconnect(t))),t.fromReceived("Message").pipe(ca(e.onMessage(t))),t.fromReceived("GroupEnterNotice").pipe(ca(e.onGroupEnterNotice())),t.fromReceived("GroupLeaveNotice").pipe(ca(e.onGroupLeaveNotice())),t.fromReceived("GroupCountNotice").pipe(ca(e.onGroupCountNotice())),t.fromReceived("GroupAttributeAlt").pipe(ca(e.onGroupAttributeAlt())),t.fromReceived("UserJoinNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.ONLINE))),t.fromReceived("UserQuitNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.OFFLINE))),t.fromReceived("UserWaitNotice").pipe(ca(e.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))}))}).forEach(function(t,n){e.loginSocketSubs[n].receivers.push(t.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(e,t,n){var r=this;return im(ad(function(){r.userJoinOptions=new is(t),e.sendPacket("UserJoin",{account:r.context.uid,instance:r.instanceId,opt:r.userJoinOptions.toLong(),seq:n,ticket:e.ticket})}),e.fromReceived("UserResp").pipe(aa(function(e){return n.eq(e.seq)}),ca(function(t){if(0!==(t=t.code))throw r.clearSockets(),r.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",t],jg);r.log("ENV_%d logged in",e.env)}),qf(e),hb(15e3))).pipe(wb(function(e){return void 0!==e}),Ga(function(e){return e instanceof pb&&r.warn("Login response timeout, rejoin: %s",t),Z(e)}))}},{key:"getSocketLoginObservables",value:function(e,t){var n=this;return e.map(function(e){return e.pipe(ca(function(e){0===e.listenerCount("socketUserDrop")&&e.on("socketUserDrop",function(t){return n.onUserDrop(t,e)})}),Cc(function(e,r){return n.incSeqIfNeeded(e.env),n.requestSocketLogin(e,0!==r,0===r?t:n.seq)}),pe())})}},{key:"incSeqIfNeeded",value:function(e){if(![0,1].includes(e))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[e]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[e]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var e=this.curLoginSockets,t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i}},{key:"emitMessage",value:function(e,n){var r=e.options,i=e.payload,o=e.src,a=e.dst,s=e.instance,c=e.dialogue,u=e.sequence,l=e.ms,d=e.MiscMap;this.dialogueSequenceLru.set(c.toString(),u),s="".concat(s,"-").concat(c,"#").concat(u),this.msgDedupLru.has(s)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",n,s):(this.msgDedupLru.set(s,void 0),n=new ae(r),this.lastLoginSockets.forEach(function(){var n=J(w.mark(function n(r){return w.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.pipe(Ka(1)).toPromise();case 2:t.sendMessageAck(e,n.sent);case 4:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()),r=n.isZlibCompressed(),n.isInvitation()?(a=pa(r?nl(Xm(i,Uint8Array.of(0,0,0,0))):i),a=JSON.parse(a),this.log("The received invitation body is %o",a),this.emit("invitationMessage",{body:a,type:n.getInvitationType(),peerId:o,serverReceivedTs:l.toNumber()})):n.isTextMessage()?(d=n.isPeerTextMessage(),i=pa(r?nl(Xm(i,Uint8Array.of(0,0,0,0))):i),this.info("Received a %s %s text message from %s to %s, %s",r?" compressed":"",d?"peer":"channel",oa(o),oa(a),s),d?(o={text:i,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerTextMessage",o)):this.emit("channelTextMessage",{channelId:a,memberId:o,text:i,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:!1}})):n.isRawMessage()?(c=n.isRawPeerMessage(),d=void 0===(d=d.description)?"":pa(d),i=r?nl(i):i,this.info("Received a %s %s raw message from %s to %s, %s",r?" compressed":"",c?"peer":"channel",oa(o),oa(a),s),c?(o={desc:d,raw:i,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}},this.emit("peerRawMessage",o)):this.emit("channelRawMessage",{desc:d,raw:i,channelId:a,memberId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:!1}})):(n.isImageMessage()||n.isFileMessage())&&(i=n.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",i?"peer":"channel",oa(o),oa(a),s),i?this.emit("peerMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,peerId:o,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}}):this.emit("channelMediaMessage",{messageType:n.isImageMessage()?"IMAGE":"FILE",details:d,memberId:o,channelId:a,properties:{serverReceivedTs:l.toNumber(),isOfflineMessage:n.isFromCache()}})))}},{key:"onSocketReconnect",value:function(e){var t=this;return function(){var n=[0,1].filter(function(t){return t!==e.env})[0];(n=t.connection.curOpenSockets[n])&&!n.loggedIn&&t.emit("connectionLost")}}},{key:"onUserDrop",value:function(e,t){var n;e=e.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(t.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:t.address,serverCode:e,sid:Xa(this.instanceId),userId:this.context.uid},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),10006===e||10001===e?this.warn("Login too often and kicked off, reconnect and login"):10009===e?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(e)&&(this.emit("userDrop",e),this.clearSockets())}},{key:"clearSockets",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];[0,1].forEach(function(r){e.cleanLoginSubs(r,n),e.connection.closeSocket(r,t)})}},{key:"onMessage",value:function(e){var t=this;return function(n){var r=n.dialogue,i=n.instance,o=n.sequence,a=n.options;if(n.src===t.context.uid)t.log("The message is from the local account, ignored");else{var s=r.toString(),c=t.dialPendingMsgSubjectMap.get(s);if(r="".concat(i,"-").concat(r,"#").concat(o),c)c.next(n),t.log("Env_%d: The dialogue has pending messages, next: %s",e.env,r);else{var u=t.dialogueSequenceLru.get(s);if(c=!u&&o.eq(1),i=void 0!==u&&o.sub(u).eq(1),c||i)t.emitMessage(n,e.env);else{if(u){if(o.lte(u))return;t.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",e.env,r)}else t.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",e.env,r);o=new Pa,t.dialPendingMsgSubjectMap.set(s,o);var l=o.pipe(Qs(Pk),xg(function(e,t){return[].concat(G(e),[t])},[]),ba(function(e){return G(e).sort(function(e,t){return(e=e.sequence).eq(t=t.sequence)?0:e.gt(t)?1:-1})}),sm(1));a=!(a=new ae(a)).isFromCache()&&!a.isBufferedMessage(),l.pipe(ob(Bc(a?750:1500)),aa(function(e){if(2>e.length)return!1;for(var t=void 0===u?U.fromNumber(1,!0):u.add(1),n=0;n<e.length;t=t.add(1),n++)if(!e[n].sequence.eq(t))return!1;return!0}),wg(function(){t.dialPendingMsgSubjectMap.delete(s)})).subscribe(function(n){n.forEach(function(n){t.emitMessage(n,e.env),t.log("Env_%d: The message queue has fully ordered, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence))})},function(n){n instanceof vg&&l.pipe(Ka(1)).subscribe(function(n){return n.forEach(function(n){t.log("Env_%d: The message pending queue expired, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence)),t.emitMessage(n,e.env)})})}),o.next(n)}}}}}},{key:"onGroupEnterNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberJoined",size:t.size})}}},{key:"onGroupLeaveNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberLeft",size:t.size})}}},{key:"onGroupCountNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,type:"MemberCountUpdated",size:t.size})}}},{key:"onGroupAttributeAlt",value:function(){var e=this;return function(t){var n=t.group;t=ff(t,kD),e.emit("channelAttributesUpdated",ua({channelId:n},t))}}},{key:"onUserNotice",value:function(e){var t=this;return function(n){t.emit("peerOnlineStatusChanged",{peerId:n.user,instance:n.instance,seq:n.seq,state:e})}}}],[{key:"sendMessageAck",value:function(e,t){var n=new ae(e.options);(n.isInvitation()||n.isPeerMessage())&&t.sendPacket("Ack",{code:0,dialogue:e.dialogue,instance:e.instance,sequence:e.sequence})}}]),t}(tb());m(ls,"genTimeoutError",function(e,t){return bb(void 0).pipe(cd(void 0===t?1e4:t),ba(function(){throw new db(["Request timed out after %ds",void 0===t?1e4:t],e)}))});var ms,ol,pl=0,ql=0;Ud.v1=function(e,t,n){n=t&&n||0;var r=t||[],i=(e=e||{}).node||ms,o=void 0!==e.clockseq?e.clockseq:ol;if(null==i||null==o){var a=Jq();null==i&&(i=ms=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==o&&(o=ol=16383&(a[6]<<8|a[7]))}a=void 0!==e.msecs?e.msecs:(new Date).getTime();var s=void 0!==e.nsecs?e.nsecs:ql+1,c=a-pl+(s-ql)/1e4;if(0>c&&void 0===e.clockseq&&(o=o+1&16383),(0>c||a>pl)&&void 0===e.nsecs&&(s=0),1e4<=s)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=a,ql=s,ol=o,e=(1e4*(268435455&(a+=122192928e5))+s)%4294967296,r[n++]=e>>>24&255,r[n++]=e>>>16&255,r[n++]=e>>>8&255,r[n++]=255&e,r[n++]=(e=a/4294967296*1e4&268435455)>>>8&255,r[n++]=255&e,r[n++]=e>>>24&15|16,r[n++]=e>>>16&255,r[n++]=o>>>8|128,r[n++]=255&o,o=0;6>o;++o)r[n+o]=i[o];return t||Kq(r)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(e){function t(e,i,o){W(this,t);var a=r.call(this,o,"RtmLocalInvitation",!0);return m(n(a),"state",Ba.IDLE),m(n(a),"localInvitationEnd$",Ca(gb(n(a),"LocalInvitationAccepted"),gb(n(a),"LocalInvitationRefused"),gb(n(a),"LocalInvitationFailure"),gb(n(a),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(a),"callId",Ud.v4()),m(n(a),"_content",""),m(n(a),"_channelId",""),m(n(a),"_response",""),m(n(a),"calleeId",void 0),m(n(a),"logger",void 0),m(n(a),"getSession",void 0),a.calleeId=e,a.getSession=i,a.logger=o,a}la(t,e);var r=ma(t);return Ha(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=e)}},{key:"content",get:function(){return this._content},set:function(e){this.log("set content for %s",this.callId),this._content=e}},{key:"response",get:function(){return this._response},set:function(e){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var e,t=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark(function n(){var r,i,o;return w.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getSession().sendInvitationMessage({peerId:t.calleeId,callId:t.callId,extra:t._content,type:"CallInvite",channelId:t._channelId});case 2:if(i=(r=n.sent).hasPeerReceived,o=r.hasReSent,!t.isLocalInvitationEnd()){n.next=7;break}throw new db("send invitation timeout");case 7:if(t.log("The local invitation has sent to the callee"),i||o){n.next=11;break}throw e=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(i){n.next=14;break}throw e=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return n.stop()}},n)}))).pipe(oe(function(e){return e.pipe(ca(function(e){if(!(e instanceof rl))throw e}),cd(2e3))}),hb(3e4),Ga(function(e){return Sa(e)&&t.warn("local invitation ack timed out"),Z(e)}),ob(this.localInvitationEnd$)).subscribe({next:function(){t.state===Ba.RECEIVED_BY_REMOTE?t.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):t.state!==Ba.SENT_TO_REMOTE?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(t.info("The peer received the local invitation %s.",t.callId),t.state=Ba.RECEIVED_BY_REMOTE,t.emit("LocalInvitationReceivedByPeer"),t.localInvitationEnd$.pipe(hb(6e4),Ga(function(e){return Sa(e)&&t.warn("local invitation expired"),Z(e)})).subscribe({error:function(){t.state=Ba.FAILURE,t.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(n){t.isLocalInvitationEnd()?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(t.state=Ba.FAILURE,Sa(n)&&e?"PEER_NOT_ONLINE"===e.code?t.emit("LocalInvitationFailure",bf.PEER_OFFLINE):"RESENT_AND_OFFLINE"===e.code&&t.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(n)?t.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):t.emit("LocalInvitationFailure","RtmInvalidStatusError"===n.name?bf.NOT_LOGGEDIN:bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(e){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=e,this.emit("LocalInvitationAccepted",e))}}},{key:"onRefuseReceived",value:function(e){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=e,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",e)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),t}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(e){function t(e){var i=e.invitationChannel,o=e.extraContent,a=e.callId,s=e.callerId,c=e.logger;e=e.getSession,W(this,t);var u=r.call(this,c,"RtmRemoteInvitation",!0);return m(n(u),"state",kb.INVITATION_RECEIVED),m(n(u),"remoteInvitationEnd$",Ca(gb(n(u),"RemoteInvitationCanceled"),gb(n(u),"RemoteInvitationRefused"),gb(n(u),"RemoteInvitationAccepted"),gb(n(u),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(u),"callerId",void 0),m(n(u),"callId",void 0),m(n(u),"_getSession",void 0),m(n(u),"logger",void 0),m(n(u),"_content",void 0),m(n(u),"_channelId",void 0),m(n(u),"_response",""),u._channelId=i,u._content=o,u.callId=a,u.callerId=s,u._getSession=e,u.logger=c,u.remoteInvitationEnd$.pipe(hb(6e4),Ga(function(e){return Sa(e)&&u.warn("Remote invitation expired"),Z(e)})).subscribe({error:function(){u.state=kb.FAILURE,u.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),u}la(t,e);var r=ma(t);return Ha(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(e){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(e){this._response=e}},{key:"accept",value:function(){var e,t=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb(function(){return ad(J(w.mark(function e(){return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._getSession().sendInvitationMessage({peerId:t.callerId,callId:t.callId,extra:t.response,type:"CallAccept",isAcceptAck:!1,channelId:t.channelId}));case 1:case"end":return e.stop()}},e)})))}),wb(function(t){return e=t.hasPeerReceived}),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(n){if(t.logError(n),t.state=kb.FAILURE,Sa(n))switch(e){case void 0:case!0:return void t.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void t.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}t.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(e){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=e,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",e))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),t}(tb()),nD=function(e){function t(e,i){W(this,t);var o=r.call(this,i,"InvitationManager");return m(n(o),"getSession",void 0),m(n(o),"invitationDispatcher",new ea.EventEmitter),m(n(o),"outgoingLocalInvitations",new Map),m(n(o),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(o),"logger",void 0),o.getSession=cn(e),o.logger=i,o.invitationDispatcher.on("remoteInvitationToManager",function(e){var t=e.callId,n=e.extra,r=e.callerId;e=e.channelId,o.receivedRemoteInvitations.has(t)||((n=new mD({callerId:r,callId:t,getSession:o.getSession,logger:i,extraContent:n,invitationChannel:e})).remoteInvitationEnd$.subscribe(function(){o.receivedRemoteInvitations.delete(t)}),o.receivedRemoteInvitations.set(t,n),o.emit("remoteInvitationInstance",n))}),o.invitationDispatcher.on("acceptAckToRemoteInvitation",function(e){(e=o.receivedRemoteInvitations.get(e.callId))&&e.onAcceptAckReceived()}),o.invitationDispatcher.on("cancelToRemoteInvitation",function(e){var t=e.extra;(e=o.receivedRemoteInvitations.get(e.callId))&&e.onCancelReceived(t)}),o.invitationDispatcher.on("acceptToLocalInvitation",function(e){var t=e.extra;(e=o.outgoingLocalInvitations.get(e.callId))&&e.onAcceptReceived(t)}),o.invitationDispatcher.on("refuseToLocalInvitation",function(e){var t=e.extra;(e=o.outgoingLocalInvitations.get(e.callId))&&e.onRefuseReceived(t)}),o}la(t,e);var r=ma(t);return Ha(t,[{key:"invitationMessageHandler",value:function(e){var t=e.body,n=t.callId,r=t.extra;r=void 0===r?"":r;var i=t.type,o=void 0===(t=t.channel)?"":t,a=e.type;switch(t=e.peerId,e=e.serverReceivedTs,a){case"CallAccept":"ack"===i?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:n}):"request"===i&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:n,extra:r});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:n,callerId:t,extra:r,channelId:o});break;case"CallCancel":if("0"===n){n="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(o,"_").concat(r),this.getSession().emit("peerTextMessage",{peerId:t,properties:{serverReceivedTs:e,isOfflineMessage:!1},text:n});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:n,extra:r});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:n,extra:r});break;default:throw Im("invitationType",a)}}},{key:"genLocalInvitation",value:function(e){var t=this,n=new lD(e,this.getSession,this.logger);return n.localInvitationEnd$.subscribe(function(){t.outgoingLocalInvitations.delete(n.callId)}),this.outgoingLocalInvitations.set(n.callId,n),n}}]),t}(tb()),oD=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return lb(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),qC(e,t,{leading:r,maxWait:t,trailing:i})},ub,cf;!function(e){e[e.JOINED=0]="JOINED",e[e.LEFT=1]="LEFT"}(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(e){function t(e,i,o,a){W(this,t);var s=r.call(this,a,"RtmChannel",!0);return m(n(s),"onMemberCountUpdated",oD(function(e){e!==s.memberCount&&(s.memberCount=e,s.emit("MemberCountUpdated",e))},1e3)),m(n(s),"getSession",void 0),m(n(s),"memberCount",0),m(n(s),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(s),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(s),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(s),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(s),"channelId",void 0),m(n(s),"client",void 0),m(n(s),"onAttributesUpdated",function(e){var t=e.channelId,n=e.attributeMaps,r=e.seq;e=e.instance.toString();var i=s.attributesSeqLru.get(e);if((!i||r.greaterThan(i))&&(s.attributesSeqLru.set(e,r),t===s.channelId)){for(t={},r=0;r<n.length;r++){var o=n[r];e=o.key,i=o.ms;var a=o.value;if(o=o.origin,"string"!=typeof e||!U.isLong(i)||"string"!=typeof a||!za(o))break;t[e]={value:a,lastUpdateUserId:o,lastUpdateTs:i.toNumber()}}s.emit("AttributesUpdated",t)}}),m(n(s),"onChannelTextMessage",function(e){e.channelId===s.channelId&&s.emit("ChannelMessage",{text:e.text,messageType:S.MessageType.TEXT},e.memberId,e.properties)}),m(n(s),"onChannelMediaMessage",function(e){var t=e.memberId,n=e.properties,r=e.details,i=e.messageType;e.channelId===s.channelId&&("FILE"===i?s.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(r.media_size),10),description:pa(r.media_description),fileName:pa(r.media_filename),mediaId:pa(r.media_id),thumbnail:new Blob([r.media_thumbnail])},t,n):"IMAGE"===i&&s.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(r.media_size),10),description:pa(r.media_description),fileName:pa(r.media_filename),mediaId:pa(r.media_id),thumbnail:new Blob([r.media_thumbnail]),height:parseInt(pa(r.media_height),10),width:parseInt(pa(r.media_width),10),thumbnailHeight:parseInt(pa(r.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(r.media_thumbnailwidth),10)},t,n))}),m(n(s),"onChannelRawMessage",function(e){e.channelId===s.channelId&&s.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:e.raw,description:e.desc},e.memberId,e.properties)}),m(n(s),"onMemberNotice",function(e){var t=e.memberId,n=e.type,r=e.size;if(e.channelId===s.channelId){var i=e.instance.toString();e=e.seq.toString();var o={MemberLeft:s.memberLeftLru,MemberJoined:s.memberJoinedLru,MemberCountUpdated:void 0}[n];if(o){if(o.has(i+e))return void s.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",n,e,oa(s.channelId),oa(t||""));if(o.set(i+e,void 0),"string"!=typeof t)return;if(t!==s.getSession().context.uid){if((i=s.memberJoinStateLru.get(t))===cf.JOINED&&"MemberJoined"===n)return void s.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,oa(s.channelId),oa(t||""));if(i===cf.LEFT&&"MemberLeft"===n)return void s.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,oa(s.channelId),oa(t||""))}s.memberJoinStateLru.set(t,"MemberJoined"===n?cf.JOINED:cf.LEFT)}s.info("Channel %s - %s, memberId: %s",n,oa(s.channelId),"MemberCountUpdated"===n?"[unknown]":oa(t||"")),i=t===s.getSession().context.uid,"MemberLeft"===n&&za(t)||"MemberJoined"===n&&za(t)?(i||s.emit(n,t),s.onMemberCountUpdated(r)):"MemberCountUpdated"===n&&"number"==typeof r&&s.onMemberCountUpdated(r)}}),s.getSession=cn(i),s.channelId=e,s.client=o,s.info("A channel created, id %s",oa(e)),s}la(t,e);var r=ma(t);return Ha(t,[{key:"join",value:function(){var e=J(w.mark(function e(){var t,n,r,i,o,a,s;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(za(this.channelId)){e.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:e.prev=2,t=this.getSession(),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!t.joinedChannels.has(this)){e.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Uq,sid:Xa(t.instanceId)},null!==(n=this.client.context.config.enableCloudProxy)&&void 0!==n&&n),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(e.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){e.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Wq,sid:Xa(t.instanceId)},null!==(o=this.client.context.config.enableCloudProxy)&&void 0!==o&&o),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(20!==t.joinedChannels.size){e.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:Tq,sid:Xa(t.instanceId)},null!==(a=this.client.context.config.enableCloudProxy)&&void 0!==a&&a),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:t.context.uid,elapse:fb(t.startTime),errCode:0,sid:Xa(t.instanceId)},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),e.next=23,t.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(t.startTime),errCode:0,sid:Xa(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),this.info("The channel %s joined successfully",oa(this.channelId)),t.on("channelTextMessage",this.onChannelTextMessage),t.on("channelRawMessage",this.onChannelRawMessage),t.on("channelMediaMessage",this.onChannelMediaMessage),t.on("memberNotice",this.onMemberNotice),t.on("channelAttributesUpdated",this.onAttributesUpdated),e.next=41;break;case 32:if(e.prev=32,e.t1=e.catch(12),this.logError(e.t1),!sa(e.t1)){e.next=37;break}throw e.t1;case 37:if(!Sa(e.t1)){e.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(t.startTime),errCode:Sq,sid:Xa(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(s=this.client.context.config.enableCloudProxy)&&void 0!==s&&s),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:e.t1});case 41:case"end":return e.stop()}},e,this,[[2,6],[12,32]])}));return function(){return e.apply(this,arguments)}}()},{key:"leave",value:function(){var e=J(w.mark(function e(){var t,n,r,i;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=this.getSession(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(n.joinedChannels.has(this)){e.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:e.prev=9,n.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,n.removeListener("channelTextMessage",this.onChannelTextMessage),n.removeListener("channelRawMessage",this.onChannelRawMessage),n.removeListener("channelMediaMessage",this.onChannelMediaMessage),n.removeListener("memberNotice",this.onMemberNotice),n.removeListener("channelAttributesUpdated",this.onAttributesUpdated),e.next=32;break;case 23:if(e.prev=23,e.t1=e.catch(9),this.logError(e.t1),!sa(e.t1)){e.next=30;break}throw void 0===e.t1.code&&(e.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:Yq,sid:Xa(n.instanceId),userId:n.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),e.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:Xq,sid:Xa(n.instanceId),userId:n.context.uid},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),new Wc("The channel leave failure",{code:Xq,originalError:e.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(n.startTime),errCode:0,sid:Xa(n.instanceId),userId:n.context.uid},null!==(t=this.client.context.config.enableCloudProxy)&&void 0!==t&&t);case 33:case"end":return e.stop()}},e,this,[[0,4],[9,23]])}));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=J(w.mark(function e(t){var n,r,i,o,a=this,s=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=void 0!==(n=(1<s.length&&void 0!==s[1]?s[1]:{}).enableHistoricalMessaging)&&n,Tm(t,Hh),e.prev=2,i=this.getSession(),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(i.joinedChannels.has(this)){e.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){e.next=16;break}return o=Date.now(),e.next=15,new Promise(function(e,n){var i=function(){var i=J(w.mark(function i(){var c;return w.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return c=Date.now()-o,i.prev=1,i.next=4,Gg({message:t,peerId:a.channelId,toPeer:!1,session:a.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:c,logger:a.logger,options:{enableHistoricalMessaging:r,enableOfflineMessaging:!1}});case 4:e(),i.next=12;break;case 7:i.prev=7,i.t0=i.catch(1),Sa(i.t0)&&n(new db(Yd(a.name,"sendMessageToPeer",1e4),Yk)),sa(i.t0)&&n(i.t0),n(new da("Channel message send failure",{code:hg,originalError:i.t0}));case 12:return i.prev=12,clearTimeout(s),i.finish(12);case 15:case"end":return i.stop()}},i,null,[[1,7,12,15]])}));return function(){return i.apply(this,arguments)}}();a.client.internalEmitter.once("RECONNECTED",i);var s=setTimeout(function(){a.client.internalEmitter.off("RECONNECTED",i),n(new db(Yd(a.name,"sendMessageToPeer",1e4),Yk))},9e3)});case 15:return e.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){e.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return e.prev=18,e.next=21,Gg({message:t,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:r,enableOfflineMessaging:!1}});case 21:e.next=31;break;case 23:if(e.prev=23,e.t1=e.catch(18),!Sa(e.t1)){e.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(e.t1)){e.next=30;break}throw this.logError(e.t1),e.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return e.stop()}},e,this,[[2,6],[18,23]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getMembers",value:function(){var e=J(w.mark(function e(){var t,n,r;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.prev=1,t=this.getSession(),e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(t.joinedChannels.has(this)){e.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return n=this.getSession().requestChannelMemberList(this.channelId),e.next=13,n.pipe(ba(function(e){return e.memberInfos.map(function(e){return e.account})})).toPromise();case 13:return r=e.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),r.map(oa)),e.abrupt("return",r);case 18:if(e.prev=18,e.t1=e.catch(0),!sa(e.t1)){e.next=23;break}throw this.logError(e.t1),e.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return e.stop()}},e,this,[[0,18],[1,5]])}));return function(){return e.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var e=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some(function(t){return t.channelId===e.channelId})}}]),t}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(e){function t(e,i,o,a){W(this,t);var s=r.call(this,i,"RtmClient",!0);return m(n(s),"connectionState",T.DISCONNECTED),m(n(s),"internalEmitter",new ea),m(n(s),"context",void 0),m(n(s),"attributes",{}),m(n(s),"loginPromise",void 0),m(n(s),"attributeDrafts",new Set),m(n(s),"session",void 0),m(n(s),"lastLoginTime",void 0),m(n(s),"reconnId",0),m(n(s),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(s),"invitationManager",void 0),m(n(s),"subscribedPeerStatusCache",{}),m(n(s),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(s),"peerUnreachableTimers",{}),m(n(s),"mediaTaskManager",void 0),m(n(s),"setParameters",void 0),m(n(s),"updateConfig",void 0),m(n(s),"userDropHandler",function(e){if(s.connectionState!==T.ABORTED)switch(e){case 11:s.logError("Kicked off by remote session"),s.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:s.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[e])),s.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:s.logError("User kicked off for unknown code: ".concat(e)),s.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}}),s.context=new ZC(e,o,i),s.mediaTaskManager=new fs(i),s.context.config=o,s.internalEmitter.setMaxListeners(512),s.setParameters=a.bind(n(s)),s.updateConfig=a.bind(n(s)),s.invitationManager=new nD(function(){return s.session},i),s.invitationManager.on("remoteInvitationInstance",function(e){s.emit("RemoteInvitationReceived",e)}),s}la(t,e);var r=ma(t);return Ha(t,[{key:"renewToken",value:function(){var e=J(w.mark(function e(t){var n,r,i=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&0!==t.length){e.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){e.next=5;break}return e.next=5,new Promise(function(){});case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){e.next=7;break}throw new K("The client is not logged in",uA);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,n=this.context.token,this.context.token=t,e.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd(function(){return Error("No available edge address to connect")}),oe(function(e){return e.pipe(ca(function(e){if(sa(e))throw e}),cd(2500),Ka(4))}),Ka(1),hb(2e4),Ga(function(e){return Sa(e)&&i.warn("renewToken timed out"),Z(e)})).toPromise();case 14:r=e.sent.ticket,e.next=27;break;case 18:if(e.prev=18,e.t0=e.catch(9),this.context.token=n,e.t0.code!==$q&&e.t0.code!==ar){e.next=23;break}throw new Ye("Invalid token",tA);case 23:if(e.t0.code!==Kh){e.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(e.t0)){e.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter(function(e){return void 0!==e}).forEach(function(e){return e.ticket=r});case 28:case"end":return e.stop()}},e,this,[[9,18]])}));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var e=J(w.mark(function e(t){var n,r=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",pA);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(t)||0===t.length||t.some(function(e){return!za(e)})||256<t.length)){e.next=6;break}throw new I("invalid arguments",er);case 6:return e.next=8,this.session.requestPeersOnlineStatus(t).toPromise();case 8:return n=uc(Jk(e.sent.userInfos,"account"),function(e){return!!e.ts}),Object.keys(n).forEach(function(e){if(e in r.subscribedPeerStatusCache&&r.subscribedPeerStatusCache[e]!==S.PeerOnlineState.UNREACHABLE){var t=n[e]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;r.emit("PeersOnlineStatusChanged",m({},e,t)),r.subscribedPeerStatusCache[e]=t}}),e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var e=J(w.mark(function e(t){var n,r,i,o,a,s,c=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",aA);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&t.every(function(e){return"string"==typeof e})&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<t.length)){e.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:n=0;case 9:if(!(n<t.length)){e.next=16;break}if(za(r=t[n])){e.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",r],Oq);case 13:n++,e.next=9;break;case 16:return e.next=18,this.session.requestGetChannelMemberCount(t).toPromise();case 18:for(i=e.sent.groupInfos,o={},a=function(e){var t=(e=i[e]).group,n=e.memberCount;za(t)&&"number"==typeof n&&(c.session.joinedChannels.forEach(function(e){e.channelId===t&&e.onMemberCountUpdated(n)}),o[t]=n)},s=0;s<i.length;s++)a(s);return e.abrupt("return",o);case 24:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var e=J(w.mark(function e(t){var n,r;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(uf({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){e.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(void 0!==this.session){e.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return n=this.session.requestSetLocalUserAttributes(t).toPromise(),this.attributeDrafts.add(r={attribute:t,promise:n}),e.prev=8,e.next=11,n;case 11:this.attributes=t,e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(8),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return e.prev=19,this.attributeDrafts.delete(r),e.finish(19);case 22:case"end":return e.stop()}},e,this,[[8,14,19,22]])}));return function(t){return e.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var e=J(w.mark(function e(t,n){var r,i,o,a,s=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=void 0!==(r=(2<s.length&&void 0!==s[2]?s[2]:{}).enableNotificationToChannelMembers)&&r,uf({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return o=this.session.requestSetChannelAttributes(t,n,i).toPromise(),e.prev=7,e.next=10,o;case 10:a=uc(n,function(e){return new Blob([e]).size}),this.channelAttributesCacheLru.set(t,a),e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(7),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return e.stop()}},e,this,[[7,14]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var e=J(w.mark(function e(t){var n,r,i;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ua(ua({},this.attributes),t),uf({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){e.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(void 0!==this.session){e.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return r=this.session.requestAddOrUpdateLocalUserAttributes(t).toPromise(),this.attributeDrafts.add(i={attribute:n,promise:r}),e.prev=10,e.next=13,r;case 13:this.attributes=n,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",er);case 21:return e.prev=21,this.attributeDrafts.delete(i),e.finish(21);case 24:case"end":return e.stop()}},e,this,[[10,16,21,24]])}));return function(t){return e.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var e=J(w.mark(function e(t,n){var r,i,o,a,s,c,u=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=void 0!==(r=(2<u.length&&void 0!==u[2]?u[2]:{}).enableNotificationToChannelMembers)&&r,o=this.channelAttributesCacheLru.get(t,{}),a=uc(n,function(e){return new Blob([e]).size}),s=ua(ua({},o),a),uf({attributes:n,attrSizeMap:s,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){e.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return c=this.session.requestAddOrUpdateChannelAttributes(t,n,i).toPromise(),e.prev=10,e.next=13,c;case 13:this.channelAttributesCacheLru.set(t,s),e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return e.stop()}},e,this,[[10,16]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var e=J(w.mark(function e(t){var n,r,i;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&0!==t.length&&!t.some(function(e){return 0===e.length})){e.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return n=this.session.requestDeleteLocalUserAttributesByKeys(t).toPromise(),r={attribute:Gk(this.attributes,t),promise:n},this.attributeDrafts.add(r),e.prev=9,e.next=12,n;case 12:for(i=0;i<t.length;i++)delete this.attributes[t[i]];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(9),!sa(e.t0)){e.next=19;break}throw e.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return e.prev=20,this.attributeDrafts.delete(r),e.finish(20);case 23:case"end":return e.stop()}},e,this,[[9,15,20,23]])}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var e=J(w.mark(function e(t,n){var r,i,o,a,s,c=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=void 0!==(r=(2<c.length&&void 0!==c[2]?c[2]:{}).enableNotificationToChannelMembers)&&r,Array.isArray(n)&&0!==n.length&&za(t)&&!n.some(function(e){return 0===e.length||512<e.length})){e.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){e.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(void 0!==this.session){e.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return o=this.session.requestDeleteChannelAttributesByKeys(t,n,i).toPromise(),e.prev=8,e.next=11,o;case 11:if(a=this.channelAttributesCacheLru.get(t))for(s=0;s<n.length;s++)delete a[n[s]];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(8),!sa(e.t0)){e.next=19;break}throw e.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return e.stop()}},e,this,[[8,15]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var e=J(w.mark(function e(){var t,n;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return t=this.session.requestClearLocalUserAttributes().toPromise(),this.attributeDrafts.add(n={attribute:{},promise:t}),e.prev=7,e.next=10,t;case 10:this.attributes={},e.next=18;break;case 13:if(e.prev=13,e.t0=e.catch(7),!sa(e.t0)){e.next=17;break}throw e.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return e.prev=18,this.attributeDrafts.delete(n),e.finish(18);case 21:case"end":return e.stop()}},e,this,[[7,13,18,21]])}));return function(){return e.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var e=J(w.mark(function e(t){var n,r,i,o=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=void 0!==(n=(1<o.length&&void 0!==o[1]?o[1]:{}).enableNotificationToChannelMembers)&&n,this.connectionState===T.CONNECTED){e.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(void 0!==this.session){e.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return i=this.session.requestClearChannelAttributes(t,r).toPromise(),e.prev=6,e.next=9,i;case 9:this.channelAttributesCacheLru.delete(t),e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(6),!sa(e.t0)){e.next=16;break}throw e.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return e.stop()}},e,this,[[6,12]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var e=J(w.mark(function e(t){var n,r;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(za(t)){e.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetUserAttributeKeys(t).toPromise();case 9:return n=e.sent.keys,e.next=13,this.session.requestGetUserAttributesByKeys(t,n.slice(0,512)).toPromise();case 13:r=e.sent,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(6),!sa(e.t0)){e.next=20;break}throw e.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return e.abrupt("return",Yp(r.attributeInfos.map(function(e){return[e.key,e.value]})));case 22:case"end":return e.stop()}},e,this,[[6,16]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var e=J(w.mark(function e(t){var n,r,i,o,a,s,c,u,l;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(za(t)){e.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){e.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(void 0!==this.session){e.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetChannelAttributesKeys(t).toPromise();case 9:return n=e.sent.keys,e.next=13,this.session.requestGetChannelAttributesByKeys(t,n).toPromise();case 13:r=e.sent.attributeMaps,e.next=22;break;case 17:if(e.prev=17,e.t0=e.catch(6),!sa(e.t0)){e.next=21;break}throw e.t0;case 21:throw new I("arguments is not valid",Ja);case 22:i={},o=0;case 24:if(!(o<r.length)){e.next=32;break}if(c=(a=r[o]).ms,u=a.value,l=a.origin,"string"==typeof(s=a.key)&&U.isLong(c)&&"string"==typeof u&&za(l)){e.next=28;break}return e.abrupt("break",32);case 28:i[s]={value:u,lastUpdateUserId:l,lastUpdateTs:c.toNumber()};case 29:o++,e.next=24;break;case 32:return this.channelAttributesCacheLru.set(t,uc(i,function(e){return new Blob([e.value]).size})),e.abrupt("return",i);case 34:case"end":return e.stop()}},e,this,[[6,17]])}));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var e=J(w.mark(function e(t,n){var r,i,o,a,s,c,u,l,d;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(t,n),e.prev=5,e.next=8,this.session.requestGetChannelAttributesByKeys(t,n).toPromise();case 8:r=e.sent.attributeMaps,e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(5),!sa(e.t0)){e.next=16;break}throw e.t0;case 16:throw new I("arguments is not valid",Ja);case 17:i={},o=this.channelAttributesCacheLru.get(t,{}),a=0;case 20:if(!(a<r.length)){e.next=29;break}if(u=(s=r[a]).ms,l=s.value,d=s.origin,"string"==typeof(c=s.key)&&U.isLong(u)&&"string"==typeof l&&za(d)){e.next=24;break}return e.abrupt("break",29);case 24:o[c]=new Blob([l]).size,i[c]={value:l,lastUpdateUserId:d,lastUpdateTs:u.toNumber()};case 26:a++,e.next=20;break;case 29:return this.channelAttributesCacheLru.set(t,o),e.abrupt("return",i);case 31:case"end":return e.stop()}},e,this,[[5,12]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var e=J(w.mark(function e(t,n){var r;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(t,n),e.prev=5,e.next=8,this.session.requestGetUserAttributesByKeys(t,n).toPromise();case 8:r=e.sent,e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(5),!sa(e.t0)){e.next=15;break}throw e.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return e.abrupt("return",Yp(r.attributeInfos.map(function(e){return[e.key,e.value]})));case 17:case"end":return e.stop()}},e,this,[[5,11]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=J(w.mark(function e(t){var n,r,i,o,a=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Uk=!0,n=Bg(),r=t.token,t.token===this.context.appId&&(r=void 0),setTimeout(function(){var e;eb("Session",{appId:a.context.appId,did:navigator.userAgent,elapse:fb(a.session&&a.session.startTime),index:{index1:t.uid,index2:a.context.appId,index3:"enableLogUpload=".concat(a.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(n),token:r||"",userId:t.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},null!==(e=a.context.config.enableCloudProxy)&&void 0!==e&&e)},1e4),yd(t)&&za(t.uid)){e.next=7;break}throw new I("not a valid user id",Jh);case 7:if("string"!=typeof r||!r){e.next=11;break}this.context.token=r,e.next=13;break;case 11:if("string"==typeof r||null==r){e.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return i=Date.now(),this.context.sid=Xa(n),this.loginPromise=this.loginImpl({uid:t.uid,instanceId:n}),this.info("RTM Client logging in as ".concat(oa(t.uid))),e.prev=17,e.next=20,this.loginPromise;case 20:e.next=27;break;case 22:throw e.prev=22,e.t0=e.catch(17),sa(e.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:e.t0.code||1,sc:e.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-i,sid:Xa(n),userId:t.uid},null!==(o=this.context.config.enableCloudProxy)&&void 0!==o&&o),this.context.token=void 0,e.t0;case 27:return e.prev=27,this.loginPromise=void 0,e.finish(27);case 30:Uk=!1;case 31:case"end":return e.stop()}},e,this,[[17,22,27,30]])}));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=J(w.mark(function e(){var t;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loginPromise){e.next=3;break}return e.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){e.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){e.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),e.abrupt("return");case 10:if(void 0!==this.session){e.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),e.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},null!==(t=this.context.config.enableCloudProxy)&&void 0!==t&&t),e.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var e,t=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):void 0!==this.session&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},null!==(e=this.context.config.enableCloudProxy)&&void 0!==e&&e),this.session.logoutHandler().then(function(){t.log("Log out success")})),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var e=J(w.mark(function e(t,n){var r,i,o,a,s,c,u=this,l=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=void 0!==(i=(r=2<l.length&&void 0!==l[2]?l[2]:{}).enableOfflineMessaging)&&i,s=void 0!==(a=r.enableHistoricalMessaging)&&a,Tm(t,ve),this.connectionState!==T.RECONNECTING){e.next=5;break}return c=Date.now(),e.abrupt("return",new Promise(function(e,r){var i=function(){var i=J(w.mark(function i(){var l;return w.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0!==u.session){i.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return l=Date.now()-c,i.prev=3,i.t0=e,i.next=7,Gg({message:t,peerId:n,toPeer:!0,session:u.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:l,logger:u.logger,options:{enableHistoricalMessaging:s,enableOfflineMessaging:o}});case 7:i.t1=i.sent,(0,i.t0)(i.t1),i.next=16;break;case 11:i.prev=11,i.t2=i.catch(3),Sa(i.t2)&&r(new db(Yd(u.name,"sendMessageToPeer",1e4),Zk)),sa(i.t2)&&r(i.t2),r(new da("Peer-to-peer message send failure",{code:cr,originalError:i.t2}));case 16:return i.prev=16,clearTimeout(a),i.finish(16);case 19:case"end":return i.stop()}},i,null,[[3,11,16,19]])}));return function(){return i.apply(this,arguments)}}();u.internalEmitter.once("RECONNECTED",i);var a=setTimeout(function(){u.internalEmitter.off("RECONNECTED",i),r(new db(Yd(u.name,"sendMessageToPeer",1e4),Zk))},9e3)}));case 5:if(this.connectionState===T.CONNECTED){e.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(void 0!==this.session){e.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,e.next=12,Gg({message:t,peerId:n,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:s,enableOfflineMessaging:o}});case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(9),!Sa(e.t0)){e.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(e.t0)){e.next=21;break}throw e.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:e.t0});case 22:case"end":return e.stop()}},e,this,[[9,15]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"createChannel",value:function(e){var t=this;if(!za(e))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:e})[0]],Zz);return new pD(e,function(){return t.session},this,this.logger)}},{key:"createLocalInvitation",value:function(e){if(!za(e))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:e})[0]],xc);return this.invitationManager.genLocalInvitation(e)}},{key:"subscribePeersOnlineStatus",value:function(){var e=J(w.mark(function e(t){var n,r,i,o,a,s,c,u,l,d,h,p,f=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(za(r=t[n])){e.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",r],kg);case 11:n++,e.next=7;break;case 14:if(!(512<(i=t&&t.length?vk(t):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){e.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return e.next=19,this.session.requestSubscribePeersOnlineStatus(i).toPromise();case 19:o=e.sent.errors,a=[],s=[],c=0;case 24:if(!(c<o.length)){e.next=32;break}if(l=(u=o[c]).code,"string"==typeof(d=u.account)){e.next=28;break}throw new da("Returned account is invalid",fr);case 28:0!==l&&a.push(d);case 29:c++,e.next=24;break;case 32:for(h=0;h<i.length;h++)a.includes(p=i[h])||(s.push(p),this.subscribedPeerStatusCache[p]=void 0);if(this.session.requestPeersOnlineStatus(s).pipe(ba(function(e){return uc(Jk(e.userInfos,"account"),function(e){return!!e.ts})})).subscribe(function(e){e=uc(e,function(e,t){return f.subscribedPeerStatusCache[t]=e?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE}),f.emit("PeersOnlineStatusChanged",e)}),0===a.length){e.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var e=J(w.mark(function e(t){var n,r,i,o;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(void 0!==this.session){e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(za(r=t[n])){e.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",r],kg);case 11:n++,e.next=7;break;case 14:if(!(512<t.length)){e.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(i=t&&t.length?vk(t):[],this.session.requestUnsubscribePeersOnlineStatus(i),o=0;o<i.length;o++)delete this.subscribedPeerStatusCache[i[o]];case 19:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var e=J(w.mark(function e(t){return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===T.CONNECTED){e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(t!==S.PeerSubscriptionOption.ONLINE_STATUS){e.next=4;break}return e.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createMessage",value:function(e){return"IMAGE"===e.messageType?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},e):"FILE"===e.messageType?ua({fileName:"",description:"",thumbnail:new Blob,size:0},e):e}},{key:"downloadMedia",value:function(){var e=J(w.mark(function e(t){var n,r,i,o,a,s,c,u,l,d,h,p,f=this,m=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=1<m.length&&void 0!==m[1]?m[1]:{},"string"==typeof t){e.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(e.prev=3,r=t.split("z"),i=ra(r,3),a=i[1],s=i[2],c=(o=i[0]).slice(1,65),u=bD(c),l=parseInt(o.slice(65),10),d=parseInt(a,10),h=parseInt(s,10),!(Number.isNaN(l)||Number.isNaN(d)||Number.isNaN(h))){e.next=12;break}throw new I("Invalid mediaId content",cl);case 12:e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(3),!sa(e.t0)){e.next=18;break}throw e.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:e.t0});case 19:if(this.connectionState===T.CONNECTED){e.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(void 0!==this.session){e.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return p=this.mediaTaskManager.addDownloadTask({unit:d,zone:l,hashHexStr:c,size:h},function(){if(void 0===f.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return f.session.requestFileDownloadIndexGet({hash:u,zone:l,unit:d,size:h}).toPromise()},n),e.next=26,this.mediaTaskManager.waitMediaTask(p);case 26:return e.abrupt("return",e.sent.payload);case 29:case"end":return e.stop()}},e,this,[[3,14]])}));return function(t){return e.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var e=J(w.mark(function e(t){var n,r,i,o,a,s,c,u,l,d,h,p,f,m,g,v,E,y,_,b,S,R,C,O,A=this,N=arguments;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<N.length&&void 0!==N[2]?N[2]:{},yd(n=1<N.length&&void 0!==N[1]?N[1]:{})){e.next=4;break}throw new I("Invalid params",wf);case 4:if(i="thumbnailWidth"in n||"thumbnailHeight"in n||"width"in n||"height"in n,a=void 0===(o=n.messageType)?i?"IMAGE":"FILE":o,c=void 0===(s=n.description)?"":s,l=void 0===(u=n.fileName)?"":u,d=n.thumbnail,"string"==typeof n.messageType&&"string"==typeof c&&"string"==typeof l&&(Pm(d)||void 0===d)&&Pm(t)){e.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!i||"FILE"!==a){e.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(h=t.size))){e.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return e.next=15,Ji(t);case 15:return p=e.sent,e.next=18,aD(p);case 18:if(f=e.sent,this.connectionState===T.CONNECTED){e.next=21;break}throw new K("The client is not logged in",yA);case 21:if("IMAGE"!==a){e.next=29;break}return e.next=24,Xt(n,p);case 24:g=(m=e.sent).height,v=m.width,E=m.thumbnailWidth,y=m.thumbnailHeight;case 29:return _=this.mediaTaskManager.addUploadTask({file:new Uint8Array(p),hash:f},function(){if(void 0===A.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return A.session.fetchFileUploadIndexGet({hash:f,size:h})},function(e,t){if(void 0===A.session)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return A.session.requestFileUploadIndexSet({hash:f,unit:e,servers:t}).toPromise()},r),e.next=32,this.mediaTaskManager.waitMediaTask(_);case 32:if(S=(b=e.sent).zone,R=b.retUnit,"IMAGE"!==a){e.next=38;break}return C={height:g,width:v,fileName:l,size:h,description:c,thumbnail:d,messageType:a,thumbnailWidth:E,thumbnailHeight:y,mediaId:"0".concat($r(f)).concat(S,"z").concat(R,"z").concat(h,"z").concat(g,"z").concat(v)},e.abrupt("return",C);case 38:return O={fileName:l,size:h,description:c,mediaId:"0".concat($r(f)).concat(S,"z").concat(R,"z").concat(h),thumbnail:d,messageType:a},e.abrupt("return",O);case 40:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var e=J(w.mark(function e(t){var n,r,i,o=this;return w.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.uid,r=t.instanceId,!(void 0!==this.lastLoginTime&&500>Date.now()-this.lastLoginTime)){e.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){e.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:e.prev=6,this.context.uid=n,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:n})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=i=new ls(this.context,new Yr(this.context,this.logger,!1),r,this.logger),i.on("connectionLost",function(){o.connectionState===T.CONNECTED&&(o.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),o.session)&&o.session.once("userJoined",function(){o.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)})}),i.on("tokenExpired",function(){o.emit("TokenExpired")}),i.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(e){o.emit("MessageFromPeer",{text:e.text,messageType:S.MessageType.TEXT},e.peerId,e.properties)}),this.session.on("peerMediaMessage",function(e){var t=e.peerId,n=e.properties,r=e.messageType;e=e.details,"FILE"===r?o.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(e.media_size),10),description:pa(e.media_description),fileName:pa(e.media_filename),mediaId:pa(e.media_id),thumbnail:new Blob([e.media_thumbnail])},t,n):"IMAGE"===r&&o.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(e.media_size),10),description:pa(e.media_description),fileName:pa(e.media_filename),mediaId:pa(e.media_id),thumbnail:new Blob([e.media_thumbnail]),height:parseInt(pa(e.media_height),10),width:parseInt(pa(e.media_width),10),thumbnailHeight:parseInt(pa(e.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(e.media_thumbnailwidth),10)},t,n)}),this.session.on("peerRawMessage",function(e){o.emit("MessageFromPeer",{rawMessage:e.raw,description:e.desc,messageType:S.MessageType.RAW},e.peerId,e.properties)}),i.on("instanceChanged",function(e){return r=e}),i.on("peerOnlineStatusChanged",function(e){var t=e.instance.toString()+e.state,n=o.peerStatusSeqLru.get(t);!n||e.seq.greaterThan(n)?(o.peerStatusSeqLru.set(t,e.seq),e.state!==o.subscribedPeerStatusCache[e.peerId]&&o.emit("PeersOnlineStatusChanged",m({},e.peerId,e.state)),o.subscribedPeerStatusCache[e.peerId]=e.state,clearTimeout(o.peerUnreachableTimers[t]),e.state===S.PeerOnlineState.UNREACHABLE&&(o.peerUnreachableTimers[t]=setTimeout(function(){o.subscribedPeerStatusCache[e.peerId]===S.PeerOnlineState.UNREACHABLE&&(o.subscribedPeerStatusCache[e.peerId]=S.PeerOnlineState.ONLINE,o.emit("PeersOnlineStatusChanged",m({},e.peerId,S.PeerOnlineState.ONLINE)))},3e4))):o.log("peerOnlineStatusChanged dedup for %s, %d",t,e.seq.toNumber())}),i.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),i.on("channelAttributesUpdated",function(e){var t=e.channelId;e=e.attributeMaps;for(var n={},r=0;r<e.length;r++){var i=e[r],a=i.key,s=i.ms,c=i.value;if(i=i.origin,"string"!=typeof a||!U.isLong(s)||"string"!=typeof c||!za(i))break;n[a]=new Blob([c]).size}o.channelAttributesCacheLru.set(t,n)}),i.on("userJoined",function(e){if(0!==Object.keys(o.attributes).length){if(void 0===o.session)return;o.session.requestSetLocalUserAttributes(o.attributes,e).toPromise()}if(0!==o.attributeDrafts.size)for(var t=function(t,n){var r=(t=n[t]).attribute;t.promise.then(function(){void 0!==o.session&&o.session.requestSetLocalUserAttributes(r,e).toPromise()})},n=0,r=Array.from(o.attributeDrafts);n<r.length;n++)t(n,r);0!==Object.keys(o.subscribedPeerStatusCache).length&&i.requestSubscribePeersOnlineStatus(Object.keys(o.subscribedPeerStatusCache))}),this.lastLoginTime=Date.now(),e.prev=29,e.next=32,i.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:i.connection.curOpenSockets.filter(function(e){return void 0!==e})[0].ticket,instance:i.instanceId,useNewDomain:.5<=Math.random(),loginOpt:i.userJoinOptions.toLong()}),e.next=44;break;case 35:if(e.prev=35,e.t1=e.catch(29),!Sa(e.t1)){e.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(e.t1)){e.next=43;break}throw e.t1;case 43:throw new da("Login failure",{code:Zq,originalError:e.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return e.stop()}},e,this,[[6,10],[29,35]])}));return function(t){return e.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(e,t){var n,r=this;e===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[e],oldState:os[this.connectionState],reason:qD[t],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),this.connectionState===T.RECONNECTING&&e===T.CONNECTED&&(0!==Object.keys(this.subscribedPeerStatusCache).length&&void 0!==this.session&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba(function(e){return uc(Jk(e.userInfos,"account"),function(e){return!!e.ts})})).subscribe(function(e){e=uc(e,function(e,t){return r.subscribedPeerStatusCache[t]=e?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE}),r.emit("PeersOnlineStatusChanged",e)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=e,e!==T.ABORTED&&e!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",e),this.emit("ConnectionStateChanged",e,t)}}]),t}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e))throw new I(["The %s in the arguments is invalid",Object.keys({appId:e})[0]],Nq);var r=Object.keys(t).filter(function(e){return!(e in qs)});if(0!==r.length)throw new I("Invalid RTM config: ".concat(r.join(", ")),Nq);var i=ua(ua({},qs),t);if(void 0!==n&&(!Array.isArray(n)||0===n.length))throw new I("Invalid area config");if(null!=n){if(!n.every(function(e){return e in S.LegacyAreaCode}))throw new I("Invalid area codes: ".concat(n.filter(function(e){return!(e in S)}).join(", ")));M=xe(n.map(function(e){return zC[e]}))}n=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var o=DC(i);r=EC(i);var a=FC(i),s=GC(n,i),c=Tr(n,i),u=c("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=i,o("The Agora RTM Web SDK version is %s","1.4.3-203"),t.enableCloudProxy&&o("RTM cloud proxy enabled"),t.enableLogUpload&&o("Log upload enabled"),M&&u("Area is set to %s",Array.from(M.CODES).map(function(e){return xf(F).find(function(t){return F[t]===e})}).join(", ")),u("Creating an RtmClient instance"),u('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),u("The App ID is %s",Um(e,4,10,"*".repeat(6))),o("The process ID is %s",gg),u("The build is %s","v1.4.3-17-g1e27aa38"),u("NODE_ENV is %s","production"),new rD(e,{genLogger:c,genTracker:s,info:o,warn:r,logError:a,loggerId:n},i,function(e){for(var t=0,n=xf(e);t<n.length;t++){var r=n[t];try{var a=e[r];null!=a&&(e.enableCloudProxy&&o("RTM cloud proxy enabled"),e.enableLogUpload&&o("Log upload enabled"),i[r]=a)}catch(e){throw new I(["The %s in the arguments is invalid",r],void 0)}}})},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(e,t){Object.keys(Nc).includes(e)&&(Nc[e]=t)},getParameter:function(e){return Nc[e]},setArea:function(e){var t=e.areaCodes;if(e=e.excludedArea,!Array.isArray(t)||0===t.length||!t.every(function(e){return e in S.AreaCode}))throw new I("Invalid area config");if(void 0!==e&&e===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(void 0===e)M=xe(t.map(function(e){return F[e]}));else{if(t.includes(e))throw new I("Excluded area cannot be in areaCodes");if(!(e in F))throw new I("Invalid excludedArea:",e);M=bu({areas:t.map(function(e){return F[e]}),excludedArea:F[e]})}}});return Zd})}),AgoraRTM__default=/*@__PURE__*/getDefaultExportFromCjs(agoraRtmSdk),createLazyClient=function(){var e;return function(t,n,r){return function(t,n,r){return e||(e=AgoraRTM__default.createInstance(t,n,r)),e}(t,n,r)}},createLazyChannel=function(){var e;return function(t,n){return function(t,n){return e||(e=t.createChannel(n)),e}(t,n)}},AreaCode;function _extends(){return _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_extends.apply(this,arguments)}function _catch(e,t){try{var n=e()}catch(e){return t(e)}return n&&n.then?n.then(void 0,t):n}!function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(AreaCode||(AreaCode={})),"undefined"==typeof Symbol||Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")),"undefined"==typeof Symbol||Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator"));var RtcContext=react.createContext({}),RtcProvider=RtcContext.Provider,remoteTrackState,layout,ToggleState;!function(e){e[e.yes=0]="yes",e[e.subbed=1]="subbed",e[e.no=2]="no"}(remoteTrackState||(remoteTrackState={})),function(e){e[e.grid=0]="grid",e[e.pin=1]="pin"}(layout||(layout={})),function(e){e[e.disabled=0]="disabled",e[e.enabled=1]="enabled",e[e.disabling=2]="disabling",e[e.enabling=3]="enabling"}(ToggleState||(ToggleState={}));var initialValue={rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}},PropsContext=react.createContext(initialValue),PropsProvider=PropsContext.Provider,MaxUidContext=react.createContext([]),MaxUidProvider=MaxUidContext.Provider,MaxUidConsumer=MaxUidContext.Consumer,MinUidContext=react.createContext([]),MinUidProvider=MinUidContext.Provider,MinUidConsumer=MinUidContext.Consumer,TracksContext=react.createContext({}),TracksProvider=TracksContext.Provider,initState={max:[{uid:0,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}],min:[],isScreensharing:!1},reducer=function(e,t){var n=initState,r=[].concat(e.max,e.min).map(function(e){return e.uid});switch(t.type){case"Screensharing":n=_extends({},e,{isScreensharing:t.value[0]}),console.log("!Screensharingstate",e,n);break;case"update-user-video":n={min:e.min.map(function(e){return 0===e.uid?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:e}),max:e.max.map(function(e){return 0===e.uid?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:e}),isScreensharing:e.isScreensharing};break;case"user-joined":if(-1===r.indexOf(t.value[0].uid)){var i=[].concat(e.min,[{uid:t.value[0].uid,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}]);n=1===i.length&&0===e.max[0].uid?{max:i,min:e.max,isScreensharing:e.isScreensharing}:{min:i,max:e.max,isScreensharing:e.isScreensharing}}break;case"user-unpublished":if(e.max[0].uid===t.value[0].uid)n={max:[{uid:t.value[0].uid,hasAudio:"audio"===t.value[1]?remoteTrackState.no:e.max[0].hasAudio,hasVideo:"video"===t.value[1]?remoteTrackState.no:e.max[0].hasVideo}],min:e.min,isScreensharing:e.isScreensharing};else{var o=e.min.find(function(e){return e.uid===t.value[0].uid});o&&(n={min:[].concat(e.min.filter(function(e){return e.uid!==t.value[0].uid}),[{uid:t.value[0].uid,hasAudio:"audio"===t.value[1]?remoteTrackState.no:o.hasAudio,hasVideo:"video"===t.value[1]?remoteTrackState.no:o.hasVideo}]),max:e.max,isScreensharing:e.isScreensharing})}break;case"user-published":n=e.max[0].uid===t.value[0].uid?{max:[{uid:t.value[0].uid,hasAudio:"audio"===t.value[1]?remoteTrackState.subbed:e.max[0].hasAudio,hasVideo:"video"===t.value[1]?remoteTrackState.subbed:e.max[0].hasVideo}],min:e.min,isScreensharing:e.isScreensharing}:{min:e.min.map(function(e){return e.uid!==t.value[0].uid?e:{uid:e.uid,hasAudio:"audio"===t.value[1]?remoteTrackState.subbed:e.hasAudio,hasVideo:"video"===t.value[1]?remoteTrackState.subbed:e.hasVideo}}),max:e.max,isScreensharing:e.isScreensharing};break;case"user-left":if(e.max[0].uid===t.value[0].uid){var a=[].concat(e.min);n={max:[a.pop()],min:a,isScreensharing:e.isScreensharing}}else n={min:e.min.filter(function(e){return e.uid!==t.value[0].uid}),max:e.max,isScreensharing:e.isScreensharing};break;case"user-swap":e.max[0].uid===t.value[0].uid||(n={max:[t.value[0]],min:[].concat(e.min.filter(function(e){return e.uid!==t.value[0].uid}),[e.max[0]]),isScreensharing:e.isScreensharing});break;case"local-user-mute-video":n={min:e.min.map(function(e){return 0===e.uid?{uid:0,hasAudio:e.hasAudio,hasVideo:t.value[0]}:e}),max:e.max.map(function(e){return 0===e.uid?{uid:0,hasAudio:e.hasAudio,hasVideo:t.value[0]}:e}),isScreensharing:e.isScreensharing};break;case"local-user-mute-audio":n={min:e.min.map(function(e){return 0===e.uid?{uid:0,hasAudio:t.value[0],hasVideo:e.hasVideo}:e}),max:e.max.map(function(e){return 0===e.uid?{uid:0,hasAudio:t.value[0],hasVideo:e.hasVideo}:e}),isScreensharing:e.isScreensharing};break;case"remote-user-mute-video":n={min:e.min.map(function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasVideo:t.value[1],hasAudio:e.hasAudio}:e}),max:e.max.map(function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasVideo:t.value[1],hasAudio:e.hasAudio}:e}),isScreensharing:e.isScreensharing};break;case"remote-user-mute-audio":n={min:e.min.map(function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasAudio:t.value[1],hasVideo:e.hasVideo}:e}),max:e.max.map(function(e){return e.uid===t.value[0].uid?{uid:e.uid,hasAudio:t.value[1],hasVideo:e.hasVideo}:e}),isScreensharing:e.isScreensharing};break;case"leave-channel":n=initState;break;case"ActiveSpeaker":n=e.max[0].uid===t.value[0]?_extends({},e):{max:[e.min.find(function(e){return e.uid===t.value[0]})],min:[].concat(e.min.filter(function(e){return e.uid!==t.value[0]}),[e.max[0]]),isScreensharing:e.isScreensharing}}return console.log("!state-update",_extends({},e,n),n),_extends({},e,n)},startScreenshare=function(e,t,n,r,i,o,a){try{var s=nq.createClient({mode:"live",role:"host",codec:"vp8"}),c=0,u=i||1,l=!1;return stopScreenshare=function(){try{var e=_catch(function(){return n.close(),Promise.resolve(s.leave()).then(function(){s.removeAllListeners()})},function(e){console.log(e)});return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},Promise.resolve(function(){try{try{console.log(s),o&&(s.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(o+"/rtc/"+t+"/publisher/uid/"+u+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){s.renewToken(e.rtcToken)})})}catch(e){return Promise.reject(e)}}),s.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(o+"/rtc/"+t+"/publisher/uid/"+u+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){s.renewToken(e.rtcToken)})})}catch(e){return Promise.reject(e)}})),n.on("track-ended",function(){s.leave(),s.removeAllListeners()})}catch(e){console.log(e)}return Promise.resolve()}catch(e){return Promise.reject(e)}}()).then(function(){return Promise.resolve(function(){try{s.setClientRole("host");var n=function(){if(!o)return Promise.resolve(s.join(e,t,r||null,u||0)).then(function(e){c=e});var n=_catch(function(){return Promise.resolve(fetch(o+"/rtc/"+t+"/publisher/uid/"+u+"/")).then(function(n){return Promise.resolve(n.json()).then(function(n){return Promise.resolve(s.join(e,t,n.rtcToken,u)).then(function(e){c=e})})})},function(e){console.log(e)});return n&&n.then?n.then(function(){}):void 0}();return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}()).then(function(){return Promise.resolve(function(){try{var e=function(){var e=function(){if(n.enabled){var e=function(){if(!l)return Promise.resolve(s.publish([n]).then(function(){l=!0})).then(function(){})}();if(e&&e.then)return e.then(function(){})}}();if(e&&e.then)return e.then(function(){})},t=function(){if(a)return Promise.resolve(s.enableDualStream()).then(function(){})}();return Promise.resolve(t&&t.then?t.then(e):e())}catch(e){return Promise.reject(e)}}()).then(function(){c&&console.log(c)})})})}catch(e){return Promise.reject(e)}},stopScreenshare=function(){},useClient=createClient({codec:"vp8",mode:"live"}),RtcConfigure=function(e){var t=react.useRef(),n=react.useRef(),r=react.useRef(!1),i=react.useContext(TracksContext),o=i.localVideoTrack,a=i.localAudioTrack,s=react.useContext(PropsContext),c=s.callbacks,u=s.rtcProps,l=react.useState(!1),d=l[0],h=l[1],p=react.useState(!1),f=p[0],m=p[1],g=null,v=react.useRef(new Promise(function(e,t){g=e,console.log(t)})),E=useClient();u.customRtcClient&&(E.removeAllListeners(),E=u.customRtcClient);var y=!1,_=!1,b=react.useRef({}),S=e.callActive;void 0===S&&(S=!0);var w=react.useReducer(reducer,initState),T=w[0],R=w[1];return react.useEffect(function(){return g?(function(){try{try{if(console.log(E),E.on("user-joined",function(){try{for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];var o=n[0];return o.uid===e.screenshareUid&&r.current||1===o.uid&&r.current||(b.current[o.uid]={}),R({type:"user-joined",value:n}),Promise.resolve()}catch(e){return Promise.reject(e)}}),E.on("user-published",function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];try{var o=n[0],a=n[1];return console.log("user-published",o.uid),o.uid===e.screenshareUid&&r.current||1===o.uid&&r.current?R({type:"user-published",value:n}):E.subscribe(o,a).then(function(e){var t;b.current[o.uid][a+"Track"]=o[a+"Track"],"audio"===a?null===(t=o.audioTrack)||void 0===t||t.play():u.enableDualStream&&u.dualStreamMode&&E.setStreamFallbackOption(o.uid,u.dualStreamMode),R({type:"user-published",value:n})}).catch(function(e){return console.log(e)}),Promise.resolve()}catch(e){return Promise.reject(e)}}),E.on("user-unpublished",function(){try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r,i=t[0],o=t[1];return console.log("user-unpublished",i.uid),"audio"===o&&(null===(r=i.audioTrack)||void 0===r||r.stop()),R({type:"user-unpublished",value:t}),Promise.resolve()}catch(e){return Promise.reject(e)}}),E.on("connection-state-change",function(){try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];if(console.log("connection",t[1],i,t[2]),"CONNECTED"===i)m(!0);else if("DISCONNECTED"===i){try{stopScreenshare(),r.current=!1}catch(e){console.log("stopscreenshare",e)}R({type:"leave-channel",value:null})}else m(!1);return Promise.resolve()}catch(e){return Promise.reject(e)}}),E.on("user-left",function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];R({type:"user-left",value:t})}),u.tokenUrl){var t=u.tokenUrl,n=u.channel,i=u.uid;E.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(t+"/rtc/"+n+"/publisher/uid/"+(i||0)+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){E.renewToken(e.rtcToken)})})}catch(e){return Promise.reject(e)}}),E.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(t+"/rtc/"+n+"/publisher/uid/"+(i||0)+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){E.renewToken(e.rtcToken)})})}catch(e){return Promise.reject(e)}})}c&&Object.keys(c).map(function(e){try{E.on(e,function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];c[e].apply(null,n)})}catch(e){console.log(e)}}),g(!0),h(!0)}catch(e){console.log("!!!",e)}return Promise.resolve()}catch(e){return Promise.reject(e)}}(),function(){try{E.removeAllListeners()}catch(e){console.log(e)}}):function(){}},[u.appId]),react.useEffect(function(){var e=!1;return S?(function(){try{return Promise.resolve(v.current).then(function(){var n=u.tokenUrl,r=u.channel,i=u.uid,o=u.appId,a=u.token,s=function(){if(E&&!e){E.setClientRole("audience"===u.role?u.role:"host");var s=function(){if(!n)return Promise.resolve(E.join(o,r,a||null,i||0)).then(function(e){t.current=e});var e=_catch(function(){return Promise.resolve(fetch(n+"/rtc/"+r+"/publisher/uid/"+(i||0)+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){return Promise.resolve(E.join(o,r,e.rtcToken,i||0)).then(function(e){t.current=e})})})},function(e){console.log(e)});return e&&e.then?e.then(function(){}):void 0}();if(s&&s.then)return s.then(function(){})}else console.error("trying to join before RTC Engine was initialized")}();if(s&&s.then)return s.then(function(){})})}catch(e){return Promise.reject(e)}}(),console.log("Attempted join: ",u.channel)):console.log("In precall - waiting to join"),function(){if(e=!0,S){console.log("Leaving channel");try{stopScreenshare(),r.current=!1}catch(e){console.log(e)}v.current=E.leave().catch(function(e){return console.log(e)})}}},[u.channel,u.uid,S,u.tokenUrl]),react.useEffect(function(){console.log("Publish",o,a,S),S&&function(){try{var e=function(){function e(){var e=function(){if(null!=o&&o.enabled&&f){var e=function(){if(!y)return Promise.resolve(E.publish([o]).then(function(){y=!0})).then(function(){})}();if(e&&e.then)return e.then(function(){})}}();if(e&&e.then)return e.then(function(){})}var t=function(){if(null!=a&&a.enabled&&f){var e=function(){if(!_)return Promise.resolve(E.publish([a]).then(function(){_=!0})).then(function(){})}();if(e&&e.then)return e.then(function(){})}}();return t&&t.then?t.then(e):e()},t=function(){if(u.enableDualStream)return Promise.resolve(E.enableDualStream()).then(function(){})}();return Promise.resolve(t&&t.then?t.then(e):e())}catch(e){return Promise.reject(e)}}()},[S,null==o?void 0:o.enabled,null==a?void 0:a.enabled,f]),react.useEffect(function(){o&&null!==a&&(b.current[0]={audioTrack:a,videoTrack:o},R({type:"update-user-video",value:[a,o]}))},[u.channel,f]),react.useEffect(function(){f&&u.token&&E.renewToken(u.token).then(function(e){return console.log("renewed token",e)})},[u.token,f]),react.useEffect(function(){u.role&&E.setClientRole(u.role).then(function(e){return console.log("changed role",e)})},[u.role,f]),react.useEffect(function(){return S&&function(){try{var e=function(){if(u.activeSpeaker&&u.layout!==layout.grid)return E.on("volume-indicator",function(e){var n=e.reduce(function(e,t){return null===e||t.level>e.level?t:e},null),r=n?n.uid:void 0;void 0!==r&&R({type:"ActiveSpeaker",value:[r===t.current?0:r]})}),Promise.resolve(E.enableAudioVolumeIndicator()).then(function(){})}();return Promise.resolve(e&&e.then?e.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}(),function(){E.removeAllListeners("volume-indicator")}},[u.activeSpeaker,u.layout]),react.createElement(RtcProvider,{value:{client:E,mediaStore:b.current,localVideoTrack:o,localAudioTrack:a,dispatch:R,localUid:t,channelJoined:f,toggleScreensharing:function(){try{return r.current?(stopScreenshare(),r.current=!1):function(){try{return R({type:"Screensharing",value:[!0]}),Promise.resolve(nq.createScreenVideoTrack({},"disable")).then(function(e){return n.current=e,b.current[u.screenshareUid||1]={videoTrack:n.current},n.current.on("track-ended",function(){r.current=!1,R({type:"Screensharing",value:[!1]})}),r.current=!0,Promise.resolve(startScreenshare(u.appId,u.channel,n.current,u.screenshareToken,u.screenshareUid,u.tokenUrl,u.enableDualStream)).then(function(){})})}catch(e){return Promise.reject(e)}}(),Promise.resolve()}catch(e){return Promise.reject(e)}},isScreensharing:r.current}},react.createElement(MaxUidProvider,{value:T.max},react.createElement(MinUidProvider,{value:T.min},d?e.children:null)))},icons={videocam:react.createElement(react.Fragment,null,react.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),react.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),videocamOff:react.createElement(react.Fragment,null,react.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),react.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),remoteSwap:react.createElement(react.Fragment,null,react.createElement("polyline",{points:"15 3 21 3 21 9"}),react.createElement("polyline",{points:"9 21 3 21 3 15"}),react.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),react.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),callEnd:react.createElement(react.Fragment,null,react.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),react.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),mic:react.createElement(react.Fragment,null,react.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),react.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),react.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),react.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),micOff:react.createElement(react.Fragment,null,react.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),react.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),react.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),react.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),react.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),screen:react.createElement(react.Fragment,null,react.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),react.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),react.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),stop:react.createElement(react.Fragment,null,react.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),react.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},BtnTemplate=function(e){var t=e.onClick,n=e.name,r=e.disabled,i=e.style,o=react.useContext(PropsContext).styleProps||{},a=o.theme,s=o.iconSize,c=o.customIcon;return react.createElement("div",{style:_extends({},{width:35,height:35,borderRadius:"100%",borderWidth:2,borderStyle:"solid",borderColor:"#fff",backgroundColor:"rgba(0,80,180,0.2)",alignItems:"center",justifyContent:"center",display:"flex",cursor:r?"auto":"pointer",margin:4},o.BtnTemplateStyles,i),onClick:t},c?react.createElement("img",{src:c[n],alt:n}):react.createElement("svg",{style:{width:s||24,height:s||24},xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",opacity:r?"0.5":"1",stroke:a||"#fff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},icons[n]))};function EndCall(){var e=react.useContext(PropsContext),t=e.callbacks;return react.createElement(BtnTemplate,{style:((e.styleProps||{}).localBtnStyles||{}).endCall||{backgroundColor:"#ef5588",borderColor:"#f00"},name:"callEnd",onClick:function(){return(null==t?void 0:t.EndCall)&&t.EndCall()}})}var LocalContext=react.createContext({}),LocalUserContext=function(e){var t,n=react.useContext(MaxUidContext),r=react.useContext(MinUidContext);return t=0===n[0].uid?n[0]:r.find(function(e){return 0===e.uid}),react.createElement(LocalContext.Provider,{value:t},e.children)},muteAudio=function(e,t,n,r){try{var i=function(){if(0===e.uid){var i=e.hasAudio,o=function(){if(i===ToggleState.enabled||i===ToggleState.disabled){var e=i===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;t({type:"local-user-mute-audio",value:[e]}),r&&r["local-user-mute-audio"]&&r["local-user-mute-audio"](e);var o=_catch(function(){return Promise.resolve(null==n?void 0:n.setEnabled(i!==ToggleState.enabled)).then(function(){e=i===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,r&&r["local-user-mute-audio"]&&r["local-user-mute-audio"](e),t({type:"local-user-mute-audio",value:[i===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled]})})},function(){t({type:"local-user-mute-audio",value:[i]})});if(o&&o.then)return o.then(function(){})}}();if(o&&o.then)return o.then(function(){})}}();return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};function LocalAudioMute(){var e=react.useContext(PropsContext),t=e.callbacks,n=((e.styleProps||{}).localBtnStyles||{}).muteLocalAudio,r=react.useContext(RtcContext),i=r.dispatch,o=r.localAudioTrack,a=react.useContext(LocalContext);return react.createElement("div",null,react.createElement(BtnTemplate,{style:n,name:a.hasAudio===ToggleState.enabled?"mic":"micOff",onClick:function(){return o&&muteAudio(a,i,o,t)}}))}function Screenshare(){var e=((react.useContext(PropsContext).styleProps||{}).localBtnStyles||{}).screenshare,t=react.useContext(RtcContext),n=t.toggleScreensharing;return react.createElement("div",null,react.createElement(BtnTemplate,{style:e,name:t.isScreensharing?"stop":"screen",onClick:function(){return n()}}))}var muteVideo=function(e,t,n,r){try{var i=function(){if(0===e.uid){var i=e.hasVideo,o=function(){if(i===ToggleState.enabled||i===ToggleState.disabled){var e=i===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;t({type:"local-user-mute-video",value:[e]}),r&&r["local-user-mute-video"]&&r["local-user-mute-video"](e);var o=_catch(function(){return Promise.resolve(null==n?void 0:n.setEnabled(i!==ToggleState.enabled)).then(function(){e=i===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,r&&r["local-user-mute-video"]&&r["local-user-mute-video"](e),t({type:"local-user-mute-video",value:[e]})})},function(){t({type:"local-user-mute-video",value:[i]})});if(o&&o.then)return o.then(function(){})}}();if(o&&o.then)return o.then(function(){})}}();return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},rtmStatusEnum,clientRoleRaw,mutingDevice,popUpStateEnum;function LocalVideoMute(){var e=react.useContext(PropsContext),t=e.callbacks,n=((e.styleProps||{}).localBtnStyles||{}).muteLocalVideo,r=react.useContext(RtcContext),i=r.dispatch,o=r.localVideoTrack,a=react.useContext(LocalContext);return react.createElement("div",null,react.createElement(BtnTemplate,{style:n,name:a.hasVideo===ToggleState.enabled?"videocam":"videocamOff",onClick:function(){return o&&muteVideo(a,i,o,t)}}))}function LocalControls(){var e=react.useContext(PropsContext),t=e.rtcProps;return react.createElement("div",{style:_extends({},{backgroundColor:"#007bff",width:"100%",height:70,zIndex:10,display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center"},(e.styleProps||{}).localBtnContainer)},"audience"!==t.role&&react.createElement(LocalVideoMute,null),"audience"!==t.role&&react.createElement(LocalAudioMute,null),"audience"!==t.role&&t.enableScreensharing&&react.createElement(Screenshare,null),react.createElement(EndCall,null))}!function(e){e[e.initFailed=0]="initFailed",e[e.offline=1]="offline",e[e.initialising=2]="initialising",e[e.loggingIn=3]="loggingIn",e[e.loggedIn=4]="loggedIn",e[e.connected=5]="connected",e[e.loginFailed=6]="loginFailed"}(rtmStatusEnum||(rtmStatusEnum={})),function(e){e[e.broadcaster=0]="broadcaster",e[e.audience=1]="audience"}(clientRoleRaw||(clientRoleRaw={})),function(e){e[e.camera=0]="camera",e[e.microphone=1]="microphone"}(mutingDevice||(mutingDevice={})),function(e){e[e.closed=0]="closed",e[e.muteMic=1]="muteMic",e[e.muteCamera=2]="muteCamera",e[e.unmuteMic=3]="unmuteMic",e[e.unmuteCamera=4]="unmuteCamera"}(popUpStateEnum||(popUpStateEnum={}));var RtmContext=react.createContext(null),RtmProvider=RtmContext.Provider;function RemoteVideoMute(e){var t=react.useContext(PropsContext).styleProps,n=react.useContext(RtmContext),r=n.sendMuteRequest,i=e.UIKitUser,o=i.hasVideo===remoteTrackState.no;return 0!==i.uid&&n.uidMap[i.uid]?react.createElement("div",null,react.createElement(BtnTemplate,{name:i.hasVideo===remoteTrackState.subbed?"videocam":"videocamOff",style:((t||{}).remoteBtnStyles||{}).muteRemoteVideo,onClick:function(){return r(mutingDevice.camera,i.uid,!o)}})):null}function RemoteAudioMute(e){var t=(react.useContext(PropsContext).styleProps||{}).remoteBtnStyles,n=react.useContext(RtmContext),r=n.sendMuteRequest,i=e.UIKitUser,o=i.hasAudio===remoteTrackState.no;return 0!==i.uid&&n.uidMap[i.uid]?react.createElement("div",null,react.createElement(BtnTemplate,{style:(t||{}).muteRemoteAudio,name:i.hasAudio===remoteTrackState.subbed?"mic":"micOff",onClick:function(){return r(mutingDevice.microphone,i.uid,!o)}})):null}function SwapUser(e){var t=react.useContext(RtcContext).dispatch,n=e.UIKitUser;return react.createElement("div",null,react.createElement(BtnTemplate,{name:"remoteSwap",onClick:function(){return t({type:"user-swap",value:[n]})}}))}var VideoPlaceholder=function(e){var t=react.useContext(PropsContext),n=t.rtcProps,r=t.styleProps||{},i=r.maxViewStyles,o=r.maxViewOverlayContainer,a=e.user,s=n.CustomVideoPlaceholder;return s?s&&s(_extends({},e),null):react.createElement("div",{key:a.uid,style:_extends({},style.max,i)},react.createElement("div",{style:style.imgContainer},react.createElement("img",{style:style.img,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg=="})),e.isShown&&react.createElement("div",{style:_extends({},style.btnContainer,o)},e.showButtons&&react.createElement(react.Fragment,null,!n.disableRtm&&react.createElement(RemoteVideoMute,{UIKitUser:a}),!n.disableRtm&&react.createElement(RemoteAudioMute,{UIKitUser:a}),e.showSwap&&react.createElement(SwapUser,{UIKitUser:a}))))},style={max:{flex:1,display:"flex",backgroundColor:"#007bff33",flexDirection:"row",position:"relative"},imgContainer:{flex:10,display:"flex",justifyContent:"center"},img:{width:100,height:100,position:"absolute",alignSelf:"center",justifySelf:"center",margin:"auto",display:"flex"},btnContainer:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},Username=function(e){var t=react.useContext(RtmContext).usernames,n=react.useContext(PropsContext),r=n.rtmProps,i=n.styleProps,o=e.user;return null!=r&&r.displayUsername?react.createElement("p",{style:_extends({},styles.username,null==i?void 0:i.usernameText)},1===o.uid?"Screenshare":t[o.uid]):react.createElement(react.Fragment,null)},styles={username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MaxVideoView=function(e){var t=react.useContext(RtcContext).mediaStore,n=react.useContext(PropsContext),r=n.rtcProps,i=n.styleProps||{},o=i.maxViewStyles,a=i.videoMode,s=i.maxViewOverlayContainer,c=null==a?void 0:a.max,u=react.useState(!1),l=u[0],d=u[1],h=e.user;return react.createElement("div",{style:_extends({},styles$1.container,e.style,o),onMouseEnter:function(){return d(!0)},onMouseLeave:function(){return d(!1)}},1===h.hasVideo?react.createElement("div",{style:styles$1.videoContainer},!r.disableRtm&&react.createElement(Username,{user:h}),react.createElement(AgoraVideoPlayer,{style:styles$1.videoplayer,config:{fit:c||"cover"},videoTrack:t[h.uid].videoTrack}),l&&react.createElement("div",{style:_extends({},styles$1.overlay,s)},!r.disableRtm&&react.createElement(RemoteVideoMute,{UIKitUser:h}),!r.disableRtm&&react.createElement(RemoteAudioMute,{UIKitUser:h}))):react.createElement("div",{style:styles$1.videoContainer},!r.disableRtm&&react.createElement(Username,{user:h}),react.createElement(VideoPlaceholder,{user:h,isShown:l,showButtons:!0})))},styles$1={container:{display:"flex",flex:1},videoContainer:{display:"flex",flex:1,position:"relative"},videoplayer:{width:"100%",display:"flex",flex:1},overlay:{position:"absolute",margin:5,flexDirection:"column",display:"flex"},username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MinVideoView=function(e){var t=react.useContext(RtcContext).mediaStore,n=react.useContext(PropsContext),r=n.rtcProps,i=n.styleProps||{},o=i.minViewStyles,a=i.videoMode,s=i.minViewOverlayContainer,c=null==a?void 0:a.min,u=react.useState(!1),l=u[0],d=u[1],h=e.user;return react.createElement("div",{style:_extends({},{display:"flex",flex:1},o),onMouseEnter:function(){return d(!0)},onMouseLeave:function(){return d(!1)}},1===h.hasVideo?react.createElement("div",{style:_extends({},{display:"flex",flex:1,position:"relative"})},react.createElement(AgoraVideoPlayer,{style:{flex:10,display:"flex"},config:{fit:void 0!==c?c:"cover"},videoTrack:t[h.uid].videoTrack}),l&&react.createElement("div",{style:_extends({},{margin:4,position:"absolute",flex:1,display:"flex",flexDirection:"column"},s)},!r.disableRtm&&react.createElement(RemoteVideoMute,{UIKitUser:h}),!r.disableRtm&&react.createElement(RemoteAudioMute,{UIKitUser:h}),react.createElement(SwapUser,{UIKitUser:h}))):react.createElement(VideoPlaceholder,{user:h,isShown:l,showButtons:!0,showSwap:!0}))},styles$2={test:"_3ybTi",scrollbar:"_3Sxu7"},PinnedVideo=function(){var e=react.useContext(PropsContext),t=e.rtcProps,n=e.styleProps||{},r=n.minViewContainer,i=n.pinnedVideoContainer,o=n.maxViewContainer,a=n.scrollViewContainer,s=react.useRef(null),c=react.useState(0),u=c[0],l=c[1],d=react.useState(0),h=d[1],p=u>d[0];return react.useEffect(function(){var e=function(){s.current&&(l(s.current.offsetWidth),h(s.current.offsetHeight))};return window.addEventListener("resize",e),s.current&&(l(s.current.offsetWidth),h(s.current.offsetHeight)),function(){window.removeEventListener("resize",e)}},[]),react.createElement("div",{ref:s,style:_extends({},{display:"flex",flex:1,flexDirection:p?"row":"column-reverse",overflow:"hidden"},i)},react.createElement("div",{style:_extends({},{display:"flex",flex:p?5:4},o)},react.createElement(MaxUidConsumer,null,function(e){return"audience"===t.role&&0===e[0].uid?null:react.createElement(MaxVideoView,{user:e[0]})})),react.createElement("div",{className:styles$2.scrollbar,style:_extends({},{overflowY:p?"scroll":"hidden",overflowX:p?"hidden":"scroll",display:"flex",flex:1,flexDirection:p?"column":"row"},a)},react.createElement(MinUidConsumer,null,function(e){return e.map(function(e){return"audience"===t.role&&0===e.uid?null:react.createElement("div",{style:_extends({},{minHeight:p?"35vh":"99%",minWidth:p?"99%":"40vw",margin:2,display:"flex"},r),key:e.uid},react.createElement(MinVideoView,{user:e}))})})))},GridVideo=function(){var e=react.useContext(PropsContext),t=e.rtcProps,n=e.styleProps||{},r=n.gridVideoCells,i=n.gridVideoContainer,o=react.useContext(MaxUidContext),a=react.useContext(MinUidContext),s="audience"===t.role?[].concat(o,a).filter(function(e){return 0!==e.uid}):[].concat(o,a),c=react.useRef(null),u=react.useState(window.innerWidth),l=u[0],d=u[1],h=react.useState(window.innerHeight),p=h[1],f=l>h[0],m="minmax(0, 1fr) ";return react.useEffect(function(){var e=function(){c.current&&(d(c.current.offsetWidth),p(c.current.offsetHeight))};return window.addEventListener("resize",e),c.current&&(d(c.current.offsetWidth),p(c.current.offsetHeight)),function(){window.removeEventListener("resize",e)}},[]),react.createElement("div",{ref:c,style:_extends({},{width:"100%",height:"100%",display:"grid",gridTemplateColumns:f?s.length>9?m.repeat(4):s.length>4?m.repeat(3):s.length>1?m.repeat(2):m:s.length>8?m.repeat(3):s.length>2?m.repeat(2):m},i)},s.map(function(e){return react.createElement(MaxVideoView,{user:e,style:_extends({},{height:"100%",width:"100%"},r),key:e.uid})}))},useTracks=createMicrophoneAndCameraTracks({encoderConfig:{}},{encoderConfig:{}}),TracksConfigure=function(e){var t=react.useState(!1),n=t[0],r=t[1],i=react.useState(null),o=i[0],a=i[1],s=react.useState(null),c=s[0],u=s[1],l=useTracks(),d=l.ready,h=l.tracks,p=l.error,f=react.useRef({});return react.useEffect(function(){return null!==h?(u(h[0]),a(h[1]),f.current[0]={audioTrack:h[0],videoTrack:h[1]},r(!0)):p&&(console.error(p),r(!1)),function(){var e,t;h&&(null===(e=h[0])||void 0===e||e.close(),null===(t=h[1])||void 0===t||t.close())}},[d,p]),react.createElement(TracksProvider,{value:{localVideoTrack:o,localAudioTrack:c}},n?e.children:null)},timeNow=function(){return(new Date).getTime()},useChannel=createLazyChannel(),useClient$1=createLazyClient(),RtmConfigure=function(e){var t=react.useContext(PropsContext),n=t.rtcProps,r=t.rtmProps,i=react.useState(!1),o=i[0],a=i[1],s=useClient$1(n.appId),c=useChannel(s,n.channel),u=react.useRef(""),l=react.useRef(5),d=react.useContext(LocalContext),h=react.useContext(PropsContext).rtmCallbacks,p=react.useState({}),f=p[0],m=p[1],g=react.useState({}),v=g[0],E=g[1],y=react.useState({}),_=y[0],b=y[1],S=react.useState(popUpStateEnum.closed),w=S[0],T=S[1],R=react.useState(rtmStatusEnum.offline),C=R[0],I=R[1],O=react.useContext(RtcContext),A=O.localUid,N=O.localAudioTrack,k=O.localVideoTrack,P=O.dispatch,L=O.channelJoined,D=function e(){try{var t=n.tokenUrl,i=function(){if(t){var n=_catch(function(){return Promise.resolve(fetch(t+"/rtm/"+((null==r?void 0:r.uid)||u.current))).then(function(e){return Promise.resolve(e.json()).then(function(e){return Promise.resolve(s.login({uid:(null==r?void 0:r.uid)||u.current,token:e.rtmToken})).then(function(){l.current=5})})})},function(){setTimeout(function(){try{return l.current=l.current+l.current,e(),Promise.resolve()}catch(e){return Promise.reject(e)}},1e3*l.current)});if(n&&n.then)return n.then(function(){})}else{var i=_catch(function(){return Promise.resolve(s.login({uid:(null==r?void 0:r.uid)||u.current,token:(null==r?void 0:r.token)||void 0})).then(function(){l.current=5})},function(){setTimeout(function(){try{return l.current=l.current+l.current,e(),Promise.resolve()}catch(e){return Promise.reject(e)}},1e3*l.current)});if(i&&i.then)return i.then(function(){})}}();return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},M=function e(){try{var t=_catch(function(){return Promise.resolve(c.join()).then(function(){l.current=5})},function(){setTimeout(function(){try{return l.current=l.current+l.current,e(),Promise.resolve()}catch(e){return Promise.reject(e)}},1e3*l.current)});return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},x=function(){try{if(I(rtmStatusEnum.initialising),u.current=String(n.uid?n.uid:timeNow()),s.on("ConnectionStateChanged",function(e,t){console.log(e,t)}),s.on("TokenExpired",function(){try{var e=n.tokenUrl;console.log("token expired - renewing");var t=function(){if(e){var t=_catch(function(){return Promise.resolve(fetch(e+"/rtm/"+((null==r?void 0:r.uid)||u.current))).then(function(e){return Promise.resolve(e.json()).then(function(e){return Promise.resolve(s.renewToken(e.rtmToken)).then(function(){l.current=5})})})},function(e){console.error("TokenExpiredError",e)});if(t&&t.then)return t.then(function(){})}}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}}),s.on("MessageFromPeer",function(e,t){F(e,t)}),c.on("ChannelMessage",function(e,t){F(e,t)}),c.on("MemberJoined",function(e){try{return Promise.resolve(H(U(),e)).then(function(){})}catch(e){return Promise.reject(e)}}),c.on("MemberCountUpdated",function(e){try{return console.log("RTM-MemberCountUpdated: ",e),Promise.resolve()}catch(e){return Promise.reject(e)}}),null!=h&&h.channel?Object.keys(h.channel).map(function(e){h.channel&&c.on(e,h.channel[e])}):null!=h&&h.client&&Object.keys(h.client).map(function(e){h.client&&s.on(e,h.client[e])}),n.tokenUrl){var e=n.tokenUrl,t=n.uid;s.on("TokenExpired",function(){try{return console.log("token expired"),Promise.resolve(fetch(e+"/rtm/"+(t||0)+"/")).then(function(e){return Promise.resolve(e.json()).then(function(e){s.renewToken(e.rtmToken)})})}catch(e){return Promise.reject(e)}})}return I(rtmStatusEnum.loggingIn),Promise.resolve(D()).then(function(){return I(rtmStatusEnum.loggedIn),Promise.resolve(M()).then(function(){I(rtmStatusEnum.connected),E(function(e){return _extends({},e,{0:null==r?void 0:r.username})}),G(U())})})}catch(e){return Promise.reject(e)}},U=function(){return{messageType:"UserData",rtmId:(null==r?void 0:r.uid)||u.current,rtcId:A.current,username:null==r?void 0:r.username,role:"audience"===n.role?1:0,uikit:{platform:"web",framework:"react",version:"1.2.0"},agora:{rtm:AgoraRTM__default.VERSION,rtc:nq.VERSION}}},F=function(e,t){var n;if("RAW"===e.messageType?n=parsePayload(e.rawMessage):"TEXT"===e.messageType&&(n=JSON.parse(e.text)),console.log(n,t),n)switch(n.messageType){case"UserData":$(n);break;case"MuteRequest":j(n);break;case"RtmDataRequest":switch(n.type){case"ping":V(t);break;case"userData":B(t);break;default:console.log(t)}break;default:console.log("unknown message content")}else console.log("unknown rtm message type")},$=function(e){m(function(t){var n;return _extends({},t,((n={})[e.rtcId]=e.rtmId,n))}),E(function(t){var n;return _extends({},t,((n={})[e.rtcId]=e.username,n))}),b(function(t){var n;return _extends({},t,((n={})[e.rtmId]=e,n))})},j=function(e){A.current===e.rtcId&&(e.isForceful?e.mute?e.device===mutingDevice.microphone?N&&muteAudio(d,P,N):e.device===mutingDevice.camera&&k&&muteVideo(d,P,k):console.error("cannot force unmute"):e.device===mutingDevice.microphone?T(e.mute?popUpStateEnum.muteMic:popUpStateEnum.unmuteMic):e.device===mutingDevice.camera&&T(e.mute?popUpStateEnum.muteCamera:popUpStateEnum.unmuteCamera))},V=function(e){H({messageType:"RtmDataRequest",type:"pong"},e)},B=function(e){H(U(),e)},G=function(e){try{var t=s.createMessage({text:JSON.stringify(e),messageType:AgoraRTM__default.MessageType.TEXT}),n=_catch(function(){return Promise.resolve(c.sendMessage(t)).then(function(){})},function(e){console.error(e)});return Promise.resolve(n&&n.then?n.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},H=function(e,t){try{var n=s.createMessage({text:JSON.stringify(e),messageType:AgoraRTM__default.MessageType.TEXT}),r=_catch(function(){return Promise.resolve(s.sendMessageToPeer(n,String(t))).then(function(){})},function(e){console.error(e)});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}};return react.useEffect(function(){return L&&(x(),a(!0)),function(){L&&function(){try{return Promise.resolve(s.logout()).then(function(){return Promise.resolve(s.removeAllListeners()).then(function(){})})}catch(e){return Promise.reject(e)}}()}},[n.channel,n.appId,L]),react.createElement(RtmProvider,{value:{rtmStatus:C,sendPeerMessage:H,sendChannelMessage:G,sendMuteRequest:function(e,t,n){var i=!1===(null==r?void 0:r.showPopUpBeforeRemoteMute),o={messageType:"MuteRequest",device:e,rtcId:t,mute:n,isForceful:i},a=f[t];i&&!n?console.log("cannot send force unmute request"):a?H(o,a):console.log("peer not found")},rtmClient:s,uidMap:f,usernames:v,userDataMap:_,popUpState:w,setPopUpState:T}},o?e.children:react.createElement(react.Fragment,null))};new TextEncoder;var dec=new TextDecoder,parsePayload=function(e){return JSON.parse(dec.decode(e))};function PopUp(){var e=react.useContext(PropsContext).styleProps,t=react.useContext(RtmContext),n=t.popUpState,r=t.setPopUpState,i=(e||{}).popUpContainer,o=react.useContext(RtcContext),a=o.dispatch,s=o.localVideoTrack,c=o.localAudioTrack,u=react.useContext(LocalContext);return n!==popUpStateEnum.closed?react.createElement("div",{style:_extends({},styles$3.container,i)},react.createElement("div",{style:{color:"#fff",fontSize:18,fontWeight:700}},n===popUpStateEnum.muteCamera||n===popUpStateEnum.muteMic?"Mute ":"Unmute ",n===popUpStateEnum.muteCamera||n===popUpStateEnum.unmuteCamera?"Camera":"Mic","?"),react.createElement("div",{style:{flexDirection:"row",display:"flex",width:"100%",justifyContent:"space-around"}},react.createElement("div",{onClick:function(){switch(n){case popUpStateEnum.muteCamera:u.hasVideo&&s&&muteVideo(u,a,s);break;case popUpStateEnum.muteMic:u.hasAudio&&c&&muteAudio(u,a,c);break;case popUpStateEnum.unmuteCamera:!u.hasVideo&&s&&muteVideo(u,a,s);break;case popUpStateEnum.unmuteMic:!u.hasAudio&&c&&muteAudio(u,a,c)}r(popUpStateEnum.closed)},style:styles$3.button},"Confirm"),react.createElement("div",{style:styles$3.buttonClose,onClick:function(){return r(popUpStateEnum.closed)}},"Close"))):null}var styles$3={button:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},buttonClose:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},container:{backgroundColor:"#007bffaa",position:"absolute",width:240,height:80,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},AgoraUIKit=function(e){var t=e.rtcProps;return react.createElement(PropsProvider,{value:e},react.createElement("div",{style:_extends({},style$1,(e.styleProps||{}).UIKitContainer)},"audience"===t.role?react.createElement(VideocallUI,null):react.createElement(TracksConfigure,null,react.createElement(VideocallUI,null))))},VideocallUI=function(){var e=react.useContext(PropsContext).rtcProps;return react.createElement(RtcConfigure,{callActive:e.callActive},react.createElement(LocalUserContext,null,e.disableRtm?react.createElement(react.Fragment,null,react.createElement((null==e?void 0:e.layout)===layout.grid?GridVideo:PinnedVideo,null),react.createElement(LocalControls,null)):react.createElement(RtmConfigure,null,react.createElement(PopUp,null),react.createElement((null==e?void 0:e.layout)===layout.grid?GridVideo:PinnedVideo,null),react.createElement(LocalControls,null))))},style$1={display:"flex",flex:1,minHeight:0,flexDirection:"column"},VIEWPORT_ID="agora-root";function getViewport(){var e=document.getElementById(VIEWPORT_ID);if(e)return e;var t=document.createElement("div");return t.setAttribute("id",VIEWPORT_ID),t.style.width="100vw",t.style.height="100vh",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.zIndex="50",document.body.appendChild(t),t}function destroyViewport(){var e=document.getElementById(VIEWPORT_ID);e&&e.remove()}var agoraUIKit={start:function(e){var t=this;this.end();var n=e.viewport||getViewport();this.options=e;var r={rtcProps:{appId:e.appId,channel:e.channel,token:e.token,layout:void 0===e.layout?layout.grid:e.layout,enableScreensharing:!0,uid:e.uid,enableAudio:void 0===e.enableAudio||e.enableAudio,enableVideo:void 0===e.enableVideo||e.enableVideo},callbacks:{EndCall:function(){t.end()},"user-joined":function(){e.onUserJoin&&e.onUserJoin()},"user-left":function(){e.onUserLeft&&e.onUserLeft()}}},i={width:"100%",height:"100%",display:"flex",flex:1};client.createRoot(n).render(h(react.StrictMode,null,h(function(){var e=react.useState(!0),n=e[0],o=e[1];return t.unmount=function(){o(!1)},h("div",{style:i},n?h(AgoraUIKit,r):h(Fragment,null))},null)))},end:function(){try{var e=function(){var e;null!=(e=t.options)&&e.viewport||destroyViewport()},t=this,n=function(){if(t.unmount)return t.unmount(),t.unmount=void 0,Promise.resolve(new Promise(function(e){setTimeout(e,50)})).then(function(){})}();return Promise.resolve(n&&n.then?n.then(e):e())}catch(e){return Promise.reject(e)}}};window.AgoraUIKit=agoraUIKit,module.exports=agoraUIKit;
//# sourceMappingURL=agora-ui-kit.cjs.map
