(function(){const e0=document.createElement("link").relList;if(e0&&e0.supports&&e0.supports("modulepreload"))return;for(const i0 of document.querySelectorAll('link[rel="modulepreload"]'))r0(i0);new MutationObserver(i0=>{for(const o0 of i0)if(o0.type==="childList")for(const s0 of o0.addedNodes)s0.tagName==="LINK"&&s0.rel==="modulepreload"&&r0(s0)}).observe(document,{childList:!0,subtree:!0});function n0(i0){const o0={};return i0.integrity&&(o0.integrity=i0.integrity),i0.referrerPolicy&&(o0.referrerPolicy=i0.referrerPolicy),i0.crossOrigin==="use-credentials"?o0.credentials="include":i0.crossOrigin==="anonymous"?o0.credentials="omit":o0.credentials="same-origin",o0}function r0(i0){if(i0.ep)return;i0.ep=!0;const o0=n0(i0);fetch(i0.href,o0)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(t0){return t0&&t0.__esModule&&Object.prototype.hasOwnProperty.call(t0,"default")?t0.default:t0}function getDefaultExportFromNamespaceIfPresent(t0){return t0&&Object.prototype.hasOwnProperty.call(t0,"default")?t0.default:t0}function getDefaultExportFromNamespaceIfNotNamed(t0){return t0&&Object.prototype.hasOwnProperty.call(t0,"default")&&Object.keys(t0).length===1?t0.default:t0}function getAugmentedNamespace(t0){if(t0.__esModule)return t0;var e0=t0.default;if(typeof e0=="function"){var n0=function r0(){return this instanceof r0?Reflect.construct(e0,arguments,this.constructor):e0.apply(this,arguments)};n0.prototype=e0.prototype}else n0={};return Object.defineProperty(n0,"__esModule",{value:!0}),Object.keys(t0).forEach(function(r0){var i0=Object.getOwnPropertyDescriptor(t0,r0);Object.defineProperty(n0,r0,i0.get?i0:{enumerable:!0,get:function(){return t0[r0]}})}),n0}var jsxRuntime$2={exports:{}},reactJsxRuntime_production_min={},react$1={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$2=Symbol.for("react.element"),n$2=Symbol.for("react.portal"),p$3=Symbol.for("react.fragment"),q$2=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u$1=Symbol.for("react.context"),v$2=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x$1=Symbol.for("react.memo"),y$1=Symbol.for("react.lazy"),z$2=Symbol.iterator;function A$2(t0){return t0===null||typeof t0!="object"?null:(t0=z$2&&t0[z$2]||t0["@@iterator"],typeof t0=="function"?t0:null)}var B$2={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$2=Object.assign,D$2={};function E$2(t0,e0,n0){this.props=t0,this.context=e0,this.refs=D$2,this.updater=n0||B$2}E$2.prototype.isReactComponent={};E$2.prototype.setState=function(t0,e0){if(typeof t0!="object"&&typeof t0!="function"&&t0!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t0,e0,"setState")};E$2.prototype.forceUpdate=function(t0){this.updater.enqueueForceUpdate(this,t0,"forceUpdate")};function F$1(){}F$1.prototype=E$2.prototype;function G$2(t0,e0,n0){this.props=t0,this.context=e0,this.refs=D$2,this.updater=n0||B$2}var H$2=G$2.prototype=new F$1;H$2.constructor=G$2;C$2(H$2,E$2.prototype);H$2.isPureReactComponent=!0;var I$2=Array.isArray,J$1=Object.prototype.hasOwnProperty,K$2={current:null},L$2={key:!0,ref:!0,__self:!0,__source:!0};function M$2(t0,e0,n0){var r0,i0={},o0=null,s0=null;if(e0!=null)for(r0 in e0.ref!==void 0&&(s0=e0.ref),e0.key!==void 0&&(o0=""+e0.key),e0)J$1.call(e0,r0)&&!L$2.hasOwnProperty(r0)&&(i0[r0]=e0[r0]);var a0=arguments.length-2;if(a0===1)i0.children=n0;else if(1<a0){for(var c0=Array(a0),u0=0;u0<a0;u0++)c0[u0]=arguments[u0+2];i0.children=c0}if(t0&&t0.defaultProps)for(r0 in a0=t0.defaultProps,a0)i0[r0]===void 0&&(i0[r0]=a0[r0]);return{$$typeof:l$2,type:t0,key:o0,ref:s0,props:i0,_owner:K$2.current}}function N$2(t0,e0){return{$$typeof:l$2,type:t0.type,key:e0,ref:t0.ref,props:t0.props,_owner:t0._owner}}function O$2(t0){return typeof t0=="object"&&t0!==null&&t0.$$typeof===l$2}function escape$1(t0){var e0={"=":"=0",":":"=2"};return"$"+t0.replace(/[=:]/g,function(n0){return e0[n0]})}var P$2=/\/+/g;function Q$2(t0,e0){return typeof t0=="object"&&t0!==null&&t0.key!=null?escape$1(""+t0.key):e0.toString(36)}function R$2(t0,e0,n0,r0,i0){var o0=typeof t0;(o0==="undefined"||o0==="boolean")&&(t0=null);var s0=!1;if(t0===null)s0=!0;else switch(o0){case"string":case"number":s0=!0;break;case"object":switch(t0.$$typeof){case l$2:case n$2:s0=!0}}if(s0)return s0=t0,i0=i0(s0),t0=r0===""?"."+Q$2(s0,0):r0,I$2(i0)?(n0="",t0!=null&&(n0=t0.replace(P$2,"$&/")+"/"),R$2(i0,e0,n0,"",function(u0){return u0})):i0!=null&&(O$2(i0)&&(i0=N$2(i0,n0+(!i0.key||s0&&s0.key===i0.key?"":(""+i0.key).replace(P$2,"$&/")+"/")+t0)),e0.push(i0)),1;if(s0=0,r0=r0===""?".":r0+":",I$2(t0))for(var a0=0;a0<t0.length;a0++){o0=t0[a0];var c0=r0+Q$2(o0,a0);s0+=R$2(o0,e0,n0,c0,i0)}else if(c0=A$2(t0),typeof c0=="function")for(t0=c0.call(t0),a0=0;!(o0=t0.next()).done;)o0=o0.value,c0=r0+Q$2(o0,a0++),s0+=R$2(o0,e0,n0,c0,i0);else if(o0==="object")throw e0=String(t0),Error("Objects are not valid as a React child (found: "+(e0==="[object Object]"?"object with keys {"+Object.keys(t0).join(", ")+"}":e0)+"). If you meant to render a collection of children, use an array instead.");return s0}function S$2(t0,e0,n0){if(t0==null)return t0;var r0=[],i0=0;return R$2(t0,r0,"","",function(o0){return e0.call(n0,o0,i0++)}),r0}function T$2(t0){if(t0._status===-1){var e0=t0._result;e0=e0(),e0.then(function(n0){(t0._status===0||t0._status===-1)&&(t0._status=1,t0._result=n0)},function(n0){(t0._status===0||t0._status===-1)&&(t0._status=2,t0._result=n0)}),t0._status===-1&&(t0._status=0,t0._result=e0)}if(t0._status===1)return t0._result.default;throw t0._result}var U$2={current:null},V$2={transition:null},W$2={ReactCurrentDispatcher:U$2,ReactCurrentBatchConfig:V$2,ReactCurrentOwner:K$2};function X$2(){throw Error("act(...) is not supported in production builds of React.")}var Children=react_production_min.Children={map:S$2,forEach:function(t0,e0,n0){S$2(t0,function(){e0.apply(this,arguments)},n0)},count:function(t0){var e0=0;return S$2(t0,function(){e0++}),e0},toArray:function(t0){return S$2(t0,function(e0){return e0})||[]},only:function(t0){if(!O$2(t0))throw Error("React.Children.only expected to receive a single React element child.");return t0}},Component=react_production_min.Component=E$2,Fragment$1=react_production_min.Fragment=p$3,Profiler=react_production_min.Profiler=r$1,PureComponent=react_production_min.PureComponent=G$2,StrictMode=react_production_min.StrictMode=q$2,Suspense=react_production_min.Suspense=w$1,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED$1=react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$2,act=react_production_min.act=X$2,cloneElement=react_production_min.cloneElement=function(t0,e0,n0){if(t0==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t0+".");var r0=C$2({},t0.props),i0=t0.key,o0=t0.ref,s0=t0._owner;if(e0!=null){if(e0.ref!==void 0&&(o0=e0.ref,s0=K$2.current),e0.key!==void 0&&(i0=""+e0.key),t0.type&&t0.type.defaultProps)var a0=t0.type.defaultProps;for(c0 in e0)J$1.call(e0,c0)&&!L$2.hasOwnProperty(c0)&&(r0[c0]=e0[c0]===void 0&&a0!==void 0?a0[c0]:e0[c0])}var c0=arguments.length-2;if(c0===1)r0.children=n0;else if(1<c0){a0=Array(c0);for(var u0=0;u0<c0;u0++)a0[u0]=arguments[u0+2];r0.children=a0}return{$$typeof:l$2,type:t0.type,key:i0,ref:o0,props:r0,_owner:s0}},createContext=react_production_min.createContext=function(t0){return t0={$$typeof:u$1,_currentValue:t0,_currentValue2:t0,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t0.Provider={$$typeof:t$1,_context:t0},t0.Consumer=t0},createElement=react_production_min.createElement=M$2,createFactory=react_production_min.createFactory=function(t0){var e0=M$2.bind(null,t0);return e0.type=t0,e0},createRef=react_production_min.createRef=function(){return{current:null}},forwardRef=react_production_min.forwardRef=function(t0){return{$$typeof:v$2,render:t0}},isValidElement=react_production_min.isValidElement=O$2,lazy=react_production_min.lazy=function(t0){return{$$typeof:y$1,_payload:{_status:-1,_result:t0},_init:T$2}},memo=react_production_min.memo=function(t0,e0){return{$$typeof:x$1,type:t0,compare:e0===void 0?null:e0}},startTransition=react_production_min.startTransition=function(t0){var e0=V$2.transition;V$2.transition={};try{t0()}finally{V$2.transition=e0}},unstable_act=react_production_min.unstable_act=X$2,useCallback=react_production_min.useCallback=function(t0,e0){return U$2.current.useCallback(t0,e0)},useContext=react_production_min.useContext=function(t0){return U$2.current.useContext(t0)},useDebugValue=react_production_min.useDebugValue=function(){},useDeferredValue=react_production_min.useDeferredValue=function(t0){return U$2.current.useDeferredValue(t0)},useEffect=react_production_min.useEffect=function(t0,e0){return U$2.current.useEffect(t0,e0)},useId=react_production_min.useId=function(){return U$2.current.useId()},useImperativeHandle=react_production_min.useImperativeHandle=function(t0,e0,n0){return U$2.current.useImperativeHandle(t0,e0,n0)},useInsertionEffect=react_production_min.useInsertionEffect=function(t0,e0){return U$2.current.useInsertionEffect(t0,e0)},useLayoutEffect=react_production_min.useLayoutEffect=function(t0,e0){return U$2.current.useLayoutEffect(t0,e0)},useMemo=react_production_min.useMemo=function(t0,e0){return U$2.current.useMemo(t0,e0)},useReducer=react_production_min.useReducer=function(t0,e0,n0){return U$2.current.useReducer(t0,e0,n0)},useRef=react_production_min.useRef=function(t0){return U$2.current.useRef(t0)},useState=react_production_min.useState=function(t0){return U$2.current.useState(t0)},useSyncExternalStore=react_production_min.useSyncExternalStore=function(t0,e0,n0){return U$2.current.useSyncExternalStore(t0,e0,n0)},useTransition=react_production_min.useTransition=function(){return U$2.current.useTransition()},version$1=react_production_min.version="18.3.1",react=react$1.exports;react$1.exports=react_production_min;var reactExports=react$1.exports;const React=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$1=reactExports,k$1=Symbol.for("react.element"),l$1=Symbol.for("react.fragment"),m$2=Object.prototype.hasOwnProperty,n$1=f$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$2={key:!0,ref:!0,__self:!0,__source:!0};function q$1(t0,e0,n0){var r0,i0={},o0=null,s0=null;n0!==void 0&&(o0=""+n0),e0.key!==void 0&&(o0=""+e0.key),e0.ref!==void 0&&(s0=e0.ref);for(r0 in e0)m$2.call(e0,r0)&&!p$2.hasOwnProperty(r0)&&(i0[r0]=e0[r0]);if(t0&&t0.defaultProps)for(r0 in e0=t0.defaultProps,e0)i0[r0]===void 0&&(i0[r0]=e0[r0]);return{$$typeof:k$1,type:t0,key:o0,ref:s0,props:i0,_owner:n$1.current}}var Fragment=reactJsxRuntime_production_min.Fragment=l$1,jsx=reactJsxRuntime_production_min.jsx=q$1,jsxs=reactJsxRuntime_production_min.jsxs=q$1,jsxRuntime=jsxRuntime$2.exports;jsxRuntime$2.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime$2.exports;const jsxRuntime$1=getDefaultExportFromCjs(jsxRuntimeExports);var client={},reactDom$1={exports:{}},reactDom_production_min={},scheduler$1={exports:{}},scheduler_production_min$1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t0){"use strict";function e0(A0,P0){var O0=A0.length;A0.push(P0);t:for(;0<O0;){var v0=O0-1>>>1,R0=A0[v0];if(0<i0(R0,P0))A0[v0]=P0,A0[O0]=R0,O0=v0;else break t}}function n0(A0){return A0.length===0?null:A0[0]}function r0(A0){if(A0.length===0)return null;var P0=A0[0],O0=A0.pop();if(O0!==P0){A0[0]=O0;t:for(var v0=0,R0=A0.length,T0=R0>>>1;v0<T0;){var F0=2*(v0+1)-1,V0=A0[F0],H0=F0+1,X0=A0[H0];if(0>i0(V0,O0))H0<R0&&0>i0(X0,V0)?(A0[v0]=X0,A0[H0]=O0,v0=H0):(A0[v0]=V0,A0[F0]=O0,v0=F0);else if(H0<R0&&0>i0(X0,O0))A0[v0]=X0,A0[H0]=O0,v0=H0;else break t}}return P0}function i0(A0,P0){var O0=A0.sortIndex-P0.sortIndex;return O0!==0?O0:A0.id-P0.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o0=performance;t0.unstable_now=function(){return o0.now()}}else{var s0=Date,a0=s0.now();t0.unstable_now=function(){return s0.now()-a0}}var c0=[],u0=[],l0=1,d0=null,h0=3,p0=!1,m0=!1,f0=!1,g0=typeof setTimeout=="function"?setTimeout:null,E0=typeof clearTimeout=="function"?clearTimeout:null,_0=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y0(A0){for(var P0=n0(u0);P0!==null;){if(P0.callback===null)r0(u0);else if(P0.startTime<=A0)r0(u0),P0.sortIndex=P0.expirationTime,e0(c0,P0);else break;P0=n0(u0)}}function b0(A0){if(f0=!1,y0(A0),!m0)if(n0(c0)!==null)m0=!0,$0(S0);else{var P0=n0(u0);P0!==null&&N0(b0,P0.startTime-A0)}}function S0(A0,P0){m0=!1,f0&&(f0=!1,E0(L0),L0=-1),p0=!0;var O0=h0;try{for(y0(P0),d0=n0(c0);d0!==null&&(!(d0.expirationTime>P0)||A0&&!U0());){var v0=d0.callback;if(typeof v0=="function"){d0.callback=null,h0=d0.priorityLevel;var R0=v0(d0.expirationTime<=P0);P0=t0.unstable_now(),typeof R0=="function"?d0.callback=R0:d0===n0(c0)&&r0(c0),y0(P0)}else r0(c0);d0=n0(c0)}if(d0!==null)var T0=!0;else{var F0=n0(u0);F0!==null&&N0(b0,F0.startTime-P0),T0=!1}return T0}finally{d0=null,h0=O0,p0=!1}}var w0=!1,I0=null,L0=-1,M0=5,C0=-1;function U0(){return!(t0.unstable_now()-C0<M0)}function x0(){if(I0!==null){var A0=t0.unstable_now();C0=A0;var P0=!0;try{P0=I0(!0,A0)}finally{P0?j0():(w0=!1,I0=null)}}else w0=!1}var j0;if(typeof _0=="function")j0=function(){_0(x0)};else if(typeof MessageChannel<"u"){var k0=new MessageChannel,D0=k0.port2;k0.port1.onmessage=x0,j0=function(){D0.postMessage(null)}}else j0=function(){g0(x0,0)};function $0(A0){I0=A0,w0||(w0=!0,j0())}function N0(A0,P0){L0=g0(function(){A0(t0.unstable_now())},P0)}t0.unstable_IdlePriority=5,t0.unstable_ImmediatePriority=1,t0.unstable_LowPriority=4,t0.unstable_NormalPriority=3,t0.unstable_Profiling=null,t0.unstable_UserBlockingPriority=2,t0.unstable_cancelCallback=function(A0){A0.callback=null},t0.unstable_continueExecution=function(){m0||p0||(m0=!0,$0(S0))},t0.unstable_forceFrameRate=function(A0){0>A0||125<A0?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M0=0<A0?Math.floor(1e3/A0):5},t0.unstable_getCurrentPriorityLevel=function(){return h0},t0.unstable_getFirstCallbackNode=function(){return n0(c0)},t0.unstable_next=function(A0){switch(h0){case 1:case 2:case 3:var P0=3;break;default:P0=h0}var O0=h0;h0=P0;try{return A0()}finally{h0=O0}},t0.unstable_pauseExecution=function(){},t0.unstable_requestPaint=function(){},t0.unstable_runWithPriority=function(A0,P0){switch(A0){case 1:case 2:case 3:case 4:case 5:break;default:A0=3}var O0=h0;h0=A0;try{return P0()}finally{h0=O0}},t0.unstable_scheduleCallback=function(A0,P0,O0){var v0=t0.unstable_now();switch(typeof O0=="object"&&O0!==null?(O0=O0.delay,O0=typeof O0=="number"&&0<O0?v0+O0:v0):O0=v0,A0){case 1:var R0=-1;break;case 2:R0=250;break;case 5:R0=1073741823;break;case 4:R0=1e4;break;default:R0=5e3}return R0=O0+R0,A0={id:l0++,callback:P0,priorityLevel:A0,startTime:O0,expirationTime:R0,sortIndex:-1},O0>v0?(A0.sortIndex=O0,e0(u0,A0),n0(c0)===null&&A0===n0(u0)&&(f0?(E0(L0),L0=-1):f0=!0,N0(b0,O0-v0))):(A0.sortIndex=R0,e0(c0,A0),m0||p0||(m0=!0,$0(S0))),A0},t0.unstable_shouldYield=U0,t0.unstable_wrapCallback=function(A0){var P0=h0;return function(){var O0=h0;h0=P0;try{return A0.apply(this,arguments)}finally{h0=O0}}}})(scheduler_production_min$1);const scheduler_production_min=getDefaultExportFromCjs(scheduler_production_min$1);var scheduler=scheduler$1.exports;scheduler$1.exports=scheduler_production_min$1;var schedulerExports=scheduler$1.exports;const index$1=getDefaultExportFromCjs(schedulerExports);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa$1=reactExports,ca$1=schedulerExports;function p$1(t0){for(var e0="https://reactjs.org/docs/error-decoder.html?invariant="+t0,n0=1;n0<arguments.length;n0++)e0+="&args[]="+encodeURIComponent(arguments[n0]);return"Minified React error #"+t0+"; visit "+e0+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da$1=new Set,ea$1={};function fa$1(t0,e0){ha$1(t0,e0),ha$1(t0+"Capture",e0)}function ha$1(t0,e0){for(ea$1[t0]=e0,t0=0;t0<e0.length;t0++)da$1.add(e0[t0])}var ia$1=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja$1=Object.prototype.hasOwnProperty,ka$1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la$1={},ma$1={};function oa$1(t0){return ja$1.call(ma$1,t0)?!0:ja$1.call(la$1,t0)?!1:ka$1.test(t0)?ma$1[t0]=!0:(la$1[t0]=!0,!1)}function pa$1(t0,e0,n0,r0){if(n0!==null&&n0.type===0)return!1;switch(typeof e0){case"function":case"symbol":return!0;case"boolean":return r0?!1:n0!==null?!n0.acceptsBooleans:(t0=t0.toLowerCase().slice(0,5),t0!=="data-"&&t0!=="aria-");default:return!1}}function qa$1(t0,e0,n0,r0){if(e0===null||typeof e0>"u"||pa$1(t0,e0,n0,r0))return!0;if(r0)return!1;if(n0!==null)switch(n0.type){case 3:return!e0;case 4:return e0===!1;case 5:return isNaN(e0);case 6:return isNaN(e0)||1>e0}return!1}function v$1(t0,e0,n0,r0,i0,o0,s0){this.acceptsBooleans=e0===2||e0===3||e0===4,this.attributeName=r0,this.attributeNamespace=i0,this.mustUseProperty=n0,this.propertyName=t0,this.type=e0,this.sanitizeURL=o0,this.removeEmptyString=s0}var z$1={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t0){z$1[t0]=new v$1(t0,0,!1,t0,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t0){var e0=t0[0];z$1[e0]=new v$1(e0,1,!1,t0[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t0){z$1[t0]=new v$1(t0,2,!1,t0.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t0){z$1[t0]=new v$1(t0,2,!1,t0,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t0){z$1[t0]=new v$1(t0,3,!1,t0.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t0){z$1[t0]=new v$1(t0,3,!0,t0,null,!1,!1)});["capture","download"].forEach(function(t0){z$1[t0]=new v$1(t0,4,!1,t0,null,!1,!1)});["cols","rows","size","span"].forEach(function(t0){z$1[t0]=new v$1(t0,6,!1,t0,null,!1,!1)});["rowSpan","start"].forEach(function(t0){z$1[t0]=new v$1(t0,5,!1,t0.toLowerCase(),null,!1,!1)});var ra$1=/[\-:]([a-z])/g;function sa$1(t0){return t0[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t0){var e0=t0.replace(ra$1,sa$1);z$1[e0]=new v$1(e0,1,!1,t0,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t0){var e0=t0.replace(ra$1,sa$1);z$1[e0]=new v$1(e0,1,!1,t0,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t0){var e0=t0.replace(ra$1,sa$1);z$1[e0]=new v$1(e0,1,!1,t0,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t0){z$1[t0]=new v$1(t0,1,!1,t0.toLowerCase(),null,!1,!1)});z$1.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t0){z$1[t0]=new v$1(t0,1,!1,t0.toLowerCase(),null,!0,!0)});function ta$1(t0,e0,n0,r0){var i0=z$1.hasOwnProperty(e0)?z$1[e0]:null;(i0!==null?i0.type!==0:r0||!(2<e0.length)||e0[0]!=="o"&&e0[0]!=="O"||e0[1]!=="n"&&e0[1]!=="N")&&(qa$1(e0,n0,i0,r0)&&(n0=null),r0||i0===null?oa$1(e0)&&(n0===null?t0.removeAttribute(e0):t0.setAttribute(e0,""+n0)):i0.mustUseProperty?t0[i0.propertyName]=n0===null?i0.type===3?!1:"":n0:(e0=i0.attributeName,r0=i0.attributeNamespace,n0===null?t0.removeAttribute(e0):(i0=i0.type,n0=i0===3||i0===4&&n0===!0?"":""+n0,r0?t0.setAttributeNS(r0,e0,n0):t0.setAttribute(e0,n0))))}var ua$1=aa$1.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va$1=Symbol.for("react.element"),wa$1=Symbol.for("react.portal"),ya$1=Symbol.for("react.fragment"),za$1=Symbol.for("react.strict_mode"),Aa$1=Symbol.for("react.profiler"),Ba$1=Symbol.for("react.provider"),Ca$1=Symbol.for("react.context"),Da$1=Symbol.for("react.forward_ref"),Ea$1=Symbol.for("react.suspense"),Fa$1=Symbol.for("react.suspense_list"),Ga$1=Symbol.for("react.memo"),Ha$1=Symbol.for("react.lazy");Symbol.for("react.scope");Symbol.for("react.debug_trace_mode");var Ia$1=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden");Symbol.for("react.cache");Symbol.for("react.tracing_marker");var Ja$1=Symbol.iterator;function Ka$1(t0){return t0===null||typeof t0!="object"?null:(t0=Ja$1&&t0[Ja$1]||t0["@@iterator"],typeof t0=="function"?t0:null)}var A$1=Object.assign,La$1;function Ma$1(t0){if(La$1===void 0)try{throw Error()}catch(n0){var e0=n0.stack.trim().match(/\n( *(at )?)/);La$1=e0&&e0[1]||""}return`
`+La$1+t0}var Na$1=!1;function Oa$1(t0,e0){if(!t0||Na$1)return"";Na$1=!0;var n0=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e0)if(e0=function(){throw Error()},Object.defineProperty(e0.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e0,[])}catch(u0){var r0=u0}Reflect.construct(t0,[],e0)}else{try{e0.call()}catch(u0){r0=u0}t0.call(e0.prototype)}else{try{throw Error()}catch(u0){r0=u0}t0()}}catch(u0){if(u0&&r0&&typeof u0.stack=="string"){for(var i0=u0.stack.split(`
`),o0=r0.stack.split(`
`),s0=i0.length-1,a0=o0.length-1;1<=s0&&0<=a0&&i0[s0]!==o0[a0];)a0--;for(;1<=s0&&0<=a0;s0--,a0--)if(i0[s0]!==o0[a0]){if(s0!==1||a0!==1)do if(s0--,a0--,0>a0||i0[s0]!==o0[a0]){var c0=`
`+i0[s0].replace(" at new "," at ");return t0.displayName&&c0.includes("<anonymous>")&&(c0=c0.replace("<anonymous>",t0.displayName)),c0}while(1<=s0&&0<=a0);break}}}finally{Na$1=!1,Error.prepareStackTrace=n0}return(t0=t0?t0.displayName||t0.name:"")?Ma$1(t0):""}function Pa$1(t0){switch(t0.tag){case 5:return Ma$1(t0.type);case 16:return Ma$1("Lazy");case 13:return Ma$1("Suspense");case 19:return Ma$1("SuspenseList");case 0:case 2:case 15:return t0=Oa$1(t0.type,!1),t0;case 11:return t0=Oa$1(t0.type.render,!1),t0;case 1:return t0=Oa$1(t0.type,!0),t0;default:return""}}function Qa$1(t0){if(t0==null)return null;if(typeof t0=="function")return t0.displayName||t0.name||null;if(typeof t0=="string")return t0;switch(t0){case ya$1:return"Fragment";case wa$1:return"Portal";case Aa$1:return"Profiler";case za$1:return"StrictMode";case Ea$1:return"Suspense";case Fa$1:return"SuspenseList"}if(typeof t0=="object")switch(t0.$$typeof){case Ca$1:return(t0.displayName||"Context")+".Consumer";case Ba$1:return(t0._context.displayName||"Context")+".Provider";case Da$1:var e0=t0.render;return t0=t0.displayName,t0||(t0=e0.displayName||e0.name||"",t0=t0!==""?"ForwardRef("+t0+")":"ForwardRef"),t0;case Ga$1:return e0=t0.displayName||null,e0!==null?e0:Qa$1(t0.type)||"Memo";case Ha$1:e0=t0._payload,t0=t0._init;try{return Qa$1(t0(e0))}catch{}}return null}function Ra$1(t0){var e0=t0.type;switch(t0.tag){case 24:return"Cache";case 9:return(e0.displayName||"Context")+".Consumer";case 10:return(e0._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t0=e0.render,t0=t0.displayName||t0.name||"",e0.displayName||(t0!==""?"ForwardRef("+t0+")":"ForwardRef");case 7:return"Fragment";case 5:return e0;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa$1(e0);case 8:return e0===za$1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e0=="function")return e0.displayName||e0.name||null;if(typeof e0=="string")return e0}return null}function Sa$1(t0){switch(typeof t0){case"boolean":case"number":case"string":case"undefined":return t0;case"object":return t0;default:return""}}function Ta$1(t0){var e0=t0.type;return(t0=t0.nodeName)&&t0.toLowerCase()==="input"&&(e0==="checkbox"||e0==="radio")}function Ua$1(t0){var e0=Ta$1(t0)?"checked":"value",n0=Object.getOwnPropertyDescriptor(t0.constructor.prototype,e0),r0=""+t0[e0];if(!t0.hasOwnProperty(e0)&&typeof n0<"u"&&typeof n0.get=="function"&&typeof n0.set=="function"){var i0=n0.get,o0=n0.set;return Object.defineProperty(t0,e0,{configurable:!0,get:function(){return i0.call(this)},set:function(s0){r0=""+s0,o0.call(this,s0)}}),Object.defineProperty(t0,e0,{enumerable:n0.enumerable}),{getValue:function(){return r0},setValue:function(s0){r0=""+s0},stopTracking:function(){t0._valueTracker=null,delete t0[e0]}}}}function Va$1(t0){t0._valueTracker||(t0._valueTracker=Ua$1(t0))}function Wa$1(t0){if(!t0)return!1;var e0=t0._valueTracker;if(!e0)return!0;var n0=e0.getValue(),r0="";return t0&&(r0=Ta$1(t0)?t0.checked?"true":"false":t0.value),t0=r0,t0!==n0?(e0.setValue(t0),!0):!1}function Xa$1(t0){if(t0=t0||(typeof document<"u"?document:void 0),typeof t0>"u")return null;try{return t0.activeElement||t0.body}catch{return t0.body}}function Ya$1(t0,e0){var n0=e0.checked;return A$1({},e0,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n0??t0._wrapperState.initialChecked})}function Za$1(t0,e0){var n0=e0.defaultValue==null?"":e0.defaultValue,r0=e0.checked!=null?e0.checked:e0.defaultChecked;n0=Sa$1(e0.value!=null?e0.value:n0),t0._wrapperState={initialChecked:r0,initialValue:n0,controlled:e0.type==="checkbox"||e0.type==="radio"?e0.checked!=null:e0.value!=null}}function ab$1(t0,e0){e0=e0.checked,e0!=null&&ta$1(t0,"checked",e0,!1)}function bb$1(t0,e0){ab$1(t0,e0);var n0=Sa$1(e0.value),r0=e0.type;if(n0!=null)r0==="number"?(n0===0&&t0.value===""||t0.value!=n0)&&(t0.value=""+n0):t0.value!==""+n0&&(t0.value=""+n0);else if(r0==="submit"||r0==="reset"){t0.removeAttribute("value");return}e0.hasOwnProperty("value")?cb$1(t0,e0.type,n0):e0.hasOwnProperty("defaultValue")&&cb$1(t0,e0.type,Sa$1(e0.defaultValue)),e0.checked==null&&e0.defaultChecked!=null&&(t0.defaultChecked=!!e0.defaultChecked)}function db$1(t0,e0,n0){if(e0.hasOwnProperty("value")||e0.hasOwnProperty("defaultValue")){var r0=e0.type;if(!(r0!=="submit"&&r0!=="reset"||e0.value!==void 0&&e0.value!==null))return;e0=""+t0._wrapperState.initialValue,n0||e0===t0.value||(t0.value=e0),t0.defaultValue=e0}n0=t0.name,n0!==""&&(t0.name=""),t0.defaultChecked=!!t0._wrapperState.initialChecked,n0!==""&&(t0.name=n0)}function cb$1(t0,e0,n0){(e0!=="number"||Xa$1(t0.ownerDocument)!==t0)&&(n0==null?t0.defaultValue=""+t0._wrapperState.initialValue:t0.defaultValue!==""+n0&&(t0.defaultValue=""+n0))}var eb$1=Array.isArray;function fb$1(t0,e0,n0,r0){if(t0=t0.options,e0){e0={};for(var i0=0;i0<n0.length;i0++)e0["$"+n0[i0]]=!0;for(n0=0;n0<t0.length;n0++)i0=e0.hasOwnProperty("$"+t0[n0].value),t0[n0].selected!==i0&&(t0[n0].selected=i0),i0&&r0&&(t0[n0].defaultSelected=!0)}else{for(n0=""+Sa$1(n0),e0=null,i0=0;i0<t0.length;i0++){if(t0[i0].value===n0){t0[i0].selected=!0,r0&&(t0[i0].defaultSelected=!0);return}e0!==null||t0[i0].disabled||(e0=t0[i0])}e0!==null&&(e0.selected=!0)}}function gb$1(t0,e0){if(e0.dangerouslySetInnerHTML!=null)throw Error(p$1(91));return A$1({},e0,{value:void 0,defaultValue:void 0,children:""+t0._wrapperState.initialValue})}function hb$1(t0,e0){var n0=e0.value;if(n0==null){if(n0=e0.children,e0=e0.defaultValue,n0!=null){if(e0!=null)throw Error(p$1(92));if(eb$1(n0)){if(1<n0.length)throw Error(p$1(93));n0=n0[0]}e0=n0}e0==null&&(e0=""),n0=e0}t0._wrapperState={initialValue:Sa$1(n0)}}function ib$1(t0,e0){var n0=Sa$1(e0.value),r0=Sa$1(e0.defaultValue);n0!=null&&(n0=""+n0,n0!==t0.value&&(t0.value=n0),e0.defaultValue==null&&t0.defaultValue!==n0&&(t0.defaultValue=n0)),r0!=null&&(t0.defaultValue=""+r0)}function jb$1(t0){var e0=t0.textContent;e0===t0._wrapperState.initialValue&&e0!==""&&e0!==null&&(t0.value=e0)}function kb$1(t0){switch(t0){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb$1(t0,e0){return t0==null||t0==="http://www.w3.org/1999/xhtml"?kb$1(e0):t0==="http://www.w3.org/2000/svg"&&e0==="foreignObject"?"http://www.w3.org/1999/xhtml":t0}var mb$1,nb$1=function(t0){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e0,n0,r0,i0){MSApp.execUnsafeLocalFunction(function(){return t0(e0,n0,r0,i0)})}:t0}(function(t0,e0){if(t0.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t0)t0.innerHTML=e0;else{for(mb$1=mb$1||document.createElement("div"),mb$1.innerHTML="<svg>"+e0.valueOf().toString()+"</svg>",e0=mb$1.firstChild;t0.firstChild;)t0.removeChild(t0.firstChild);for(;e0.firstChild;)t0.appendChild(e0.firstChild)}});function ob$1(t0,e0){if(e0){var n0=t0.firstChild;if(n0&&n0===t0.lastChild&&n0.nodeType===3){n0.nodeValue=e0;return}}t0.textContent=e0}var pb$1={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb$1=["Webkit","ms","Moz","O"];Object.keys(pb$1).forEach(function(t0){qb$1.forEach(function(e0){e0=e0+t0.charAt(0).toUpperCase()+t0.substring(1),pb$1[e0]=pb$1[t0]})});function rb$1(t0,e0,n0){return e0==null||typeof e0=="boolean"||e0===""?"":n0||typeof e0!="number"||e0===0||pb$1.hasOwnProperty(t0)&&pb$1[t0]?(""+e0).trim():e0+"px"}function sb$1(t0,e0){t0=t0.style;for(var n0 in e0)if(e0.hasOwnProperty(n0)){var r0=n0.indexOf("--")===0,i0=rb$1(n0,e0[n0],r0);n0==="float"&&(n0="cssFloat"),r0?t0.setProperty(n0,i0):t0[n0]=i0}}var tb$1=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub$1(t0,e0){if(e0){if(tb$1[t0]&&(e0.children!=null||e0.dangerouslySetInnerHTML!=null))throw Error(p$1(137,t0));if(e0.dangerouslySetInnerHTML!=null){if(e0.children!=null)throw Error(p$1(60));if(typeof e0.dangerouslySetInnerHTML!="object"||!("__html"in e0.dangerouslySetInnerHTML))throw Error(p$1(61))}if(e0.style!=null&&typeof e0.style!="object")throw Error(p$1(62))}}function vb$1(t0,e0){if(t0.indexOf("-")===-1)return typeof e0.is=="string";switch(t0){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb$1=null;function xb$1(t0){return t0=t0.target||t0.srcElement||window,t0.correspondingUseElement&&(t0=t0.correspondingUseElement),t0.nodeType===3?t0.parentNode:t0}var yb$1=null,zb$1=null,Ab$1=null;function Bb$1(t0){if(t0=Cb$1(t0)){if(typeof yb$1!="function")throw Error(p$1(280));var e0=t0.stateNode;e0&&(e0=Db$1(e0),yb$1(t0.stateNode,t0.type,e0))}}function Eb$1(t0){zb$1?Ab$1?Ab$1.push(t0):Ab$1=[t0]:zb$1=t0}function Fb$1(){if(zb$1){var t0=zb$1,e0=Ab$1;if(Ab$1=zb$1=null,Bb$1(t0),e0)for(t0=0;t0<e0.length;t0++)Bb$1(e0[t0])}}function Gb$1(t0,e0){return t0(e0)}function Hb$1(){}var Ib$1=!1;function Jb$1(t0,e0,n0){if(Ib$1)return t0(e0,n0);Ib$1=!0;try{return Gb$1(t0,e0,n0)}finally{Ib$1=!1,(zb$1!==null||Ab$1!==null)&&(Hb$1(),Fb$1())}}function Kb$1(t0,e0){var n0=t0.stateNode;if(n0===null)return null;var r0=Db$1(n0);if(r0===null)return null;n0=r0[e0];t:switch(e0){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r0=!r0.disabled)||(t0=t0.type,r0=!(t0==="button"||t0==="input"||t0==="select"||t0==="textarea")),t0=!r0;break t;default:t0=!1}if(t0)return null;if(n0&&typeof n0!="function")throw Error(p$1(231,e0,typeof n0));return n0}var Lb$1=!1;if(ia$1)try{var Mb$1={};Object.defineProperty(Mb$1,"passive",{get:function(){Lb$1=!0}}),window.addEventListener("test",Mb$1,Mb$1),window.removeEventListener("test",Mb$1,Mb$1)}catch{Lb$1=!1}function Nb$1(t0,e0,n0,r0,i0,o0,s0,a0,c0){var u0=Array.prototype.slice.call(arguments,3);try{e0.apply(n0,u0)}catch(l0){this.onError(l0)}}var Ob$1=!1,Pb$1=null,Qb$1=!1,Rb$1=null,Sb$1={onError:function(t0){Ob$1=!0,Pb$1=t0}};function Tb$1(t0,e0,n0,r0,i0,o0,s0,a0,c0){Ob$1=!1,Pb$1=null,Nb$1.apply(Sb$1,arguments)}function Ub$1(t0,e0,n0,r0,i0,o0,s0,a0,c0){if(Tb$1.apply(this,arguments),Ob$1){if(Ob$1){var u0=Pb$1;Ob$1=!1,Pb$1=null}else throw Error(p$1(198));Qb$1||(Qb$1=!0,Rb$1=u0)}}function Vb$1(t0){var e0=t0,n0=t0;if(t0.alternate)for(;e0.return;)e0=e0.return;else{t0=e0;do e0=t0,e0.flags&4098&&(n0=e0.return),t0=e0.return;while(t0)}return e0.tag===3?n0:null}function Wb$1(t0){if(t0.tag===13){var e0=t0.memoizedState;if(e0===null&&(t0=t0.alternate,t0!==null&&(e0=t0.memoizedState)),e0!==null)return e0.dehydrated}return null}function Xb$1(t0){if(Vb$1(t0)!==t0)throw Error(p$1(188))}function Yb$1(t0){var e0=t0.alternate;if(!e0){if(e0=Vb$1(t0),e0===null)throw Error(p$1(188));return e0!==t0?null:t0}for(var n0=t0,r0=e0;;){var i0=n0.return;if(i0===null)break;var o0=i0.alternate;if(o0===null){if(r0=i0.return,r0!==null){n0=r0;continue}break}if(i0.child===o0.child){for(o0=i0.child;o0;){if(o0===n0)return Xb$1(i0),t0;if(o0===r0)return Xb$1(i0),e0;o0=o0.sibling}throw Error(p$1(188))}if(n0.return!==r0.return)n0=i0,r0=o0;else{for(var s0=!1,a0=i0.child;a0;){if(a0===n0){s0=!0,n0=i0,r0=o0;break}if(a0===r0){s0=!0,r0=i0,n0=o0;break}a0=a0.sibling}if(!s0){for(a0=o0.child;a0;){if(a0===n0){s0=!0,n0=o0,r0=i0;break}if(a0===r0){s0=!0,r0=o0,n0=i0;break}a0=a0.sibling}if(!s0)throw Error(p$1(189))}}if(n0.alternate!==r0)throw Error(p$1(190))}if(n0.tag!==3)throw Error(p$1(188));return n0.stateNode.current===n0?t0:e0}function Zb$1(t0){return t0=Yb$1(t0),t0!==null?$b$1(t0):null}function $b$1(t0){if(t0.tag===5||t0.tag===6)return t0;for(t0=t0.child;t0!==null;){var e0=$b$1(t0);if(e0!==null)return e0;t0=t0.sibling}return null}var ac$1=ca$1.unstable_scheduleCallback,bc$1=ca$1.unstable_cancelCallback,cc$1=ca$1.unstable_shouldYield,dc$1=ca$1.unstable_requestPaint,B$1=ca$1.unstable_now,ec$1=ca$1.unstable_getCurrentPriorityLevel,fc$1=ca$1.unstable_ImmediatePriority,gc$1=ca$1.unstable_UserBlockingPriority,hc$1=ca$1.unstable_NormalPriority,ic$1=ca$1.unstable_LowPriority,jc$1=ca$1.unstable_IdlePriority,kc$1=null,lc$1=null;function mc$1(t0){if(lc$1&&typeof lc$1.onCommitFiberRoot=="function")try{lc$1.onCommitFiberRoot(kc$1,t0,void 0,(t0.current.flags&128)===128)}catch{}}var oc$1=Math.clz32?Math.clz32:nc$1,pc$1=Math.log,qc$1=Math.LN2;function nc$1(t0){return t0>>>=0,t0===0?32:31-(pc$1(t0)/qc$1|0)|0}var rc$1=64,sc$1=4194304;function tc$1(t0){switch(t0&-t0){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t0&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t0&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t0}}function uc$1(t0,e0){var n0=t0.pendingLanes;if(n0===0)return 0;var r0=0,i0=t0.suspendedLanes,o0=t0.pingedLanes,s0=n0&268435455;if(s0!==0){var a0=s0&~i0;a0!==0?r0=tc$1(a0):(o0&=s0,o0!==0&&(r0=tc$1(o0)))}else s0=n0&~i0,s0!==0?r0=tc$1(s0):o0!==0&&(r0=tc$1(o0));if(r0===0)return 0;if(e0!==0&&e0!==r0&&!(e0&i0)&&(i0=r0&-r0,o0=e0&-e0,i0>=o0||i0===16&&(o0&4194240)!==0))return e0;if(r0&4&&(r0|=n0&16),e0=t0.entangledLanes,e0!==0)for(t0=t0.entanglements,e0&=r0;0<e0;)n0=31-oc$1(e0),i0=1<<n0,r0|=t0[n0],e0&=~i0;return r0}function vc$1(t0,e0){switch(t0){case 1:case 2:case 4:return e0+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e0+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc$1(t0,e0){for(var n0=t0.suspendedLanes,r0=t0.pingedLanes,i0=t0.expirationTimes,o0=t0.pendingLanes;0<o0;){var s0=31-oc$1(o0),a0=1<<s0,c0=i0[s0];c0===-1?(!(a0&n0)||a0&r0)&&(i0[s0]=vc$1(a0,e0)):c0<=e0&&(t0.expiredLanes|=a0),o0&=~a0}}function xc$1(t0){return t0=t0.pendingLanes&-1073741825,t0!==0?t0:t0&1073741824?1073741824:0}function yc$1(){var t0=rc$1;return rc$1<<=1,!(rc$1&4194240)&&(rc$1=64),t0}function zc$1(t0){for(var e0=[],n0=0;31>n0;n0++)e0.push(t0);return e0}function Ac$1(t0,e0,n0){t0.pendingLanes|=e0,e0!==536870912&&(t0.suspendedLanes=0,t0.pingedLanes=0),t0=t0.eventTimes,e0=31-oc$1(e0),t0[e0]=n0}function Bc$1(t0,e0){var n0=t0.pendingLanes&~e0;t0.pendingLanes=e0,t0.suspendedLanes=0,t0.pingedLanes=0,t0.expiredLanes&=e0,t0.mutableReadLanes&=e0,t0.entangledLanes&=e0,e0=t0.entanglements;var r0=t0.eventTimes;for(t0=t0.expirationTimes;0<n0;){var i0=31-oc$1(n0),o0=1<<i0;e0[i0]=0,r0[i0]=-1,t0[i0]=-1,n0&=~o0}}function Cc$1(t0,e0){var n0=t0.entangledLanes|=e0;for(t0=t0.entanglements;n0;){var r0=31-oc$1(n0),i0=1<<r0;i0&e0|t0[r0]&e0&&(t0[r0]|=e0),n0&=~i0}}var C$1=0;function Dc$1(t0){return t0&=-t0,1<t0?4<t0?t0&268435455?16:536870912:4:1}var Ec$1,Fc$1,Gc$1,Hc$1,Ic$1,Jc$1=!1,Kc$1=[],Lc$1=null,Mc$1=null,Nc$1=null,Oc$1=new Map,Pc$1=new Map,Qc$1=[],Rc$1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc$1(t0,e0){switch(t0){case"focusin":case"focusout":Lc$1=null;break;case"dragenter":case"dragleave":Mc$1=null;break;case"mouseover":case"mouseout":Nc$1=null;break;case"pointerover":case"pointerout":Oc$1.delete(e0.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc$1.delete(e0.pointerId)}}function Tc$1(t0,e0,n0,r0,i0,o0){return t0===null||t0.nativeEvent!==o0?(t0={blockedOn:e0,domEventName:n0,eventSystemFlags:r0,nativeEvent:o0,targetContainers:[i0]},e0!==null&&(e0=Cb$1(e0),e0!==null&&Fc$1(e0)),t0):(t0.eventSystemFlags|=r0,e0=t0.targetContainers,i0!==null&&e0.indexOf(i0)===-1&&e0.push(i0),t0)}function Uc$1(t0,e0,n0,r0,i0){switch(e0){case"focusin":return Lc$1=Tc$1(Lc$1,t0,e0,n0,r0,i0),!0;case"dragenter":return Mc$1=Tc$1(Mc$1,t0,e0,n0,r0,i0),!0;case"mouseover":return Nc$1=Tc$1(Nc$1,t0,e0,n0,r0,i0),!0;case"pointerover":var o0=i0.pointerId;return Oc$1.set(o0,Tc$1(Oc$1.get(o0)||null,t0,e0,n0,r0,i0)),!0;case"gotpointercapture":return o0=i0.pointerId,Pc$1.set(o0,Tc$1(Pc$1.get(o0)||null,t0,e0,n0,r0,i0)),!0}return!1}function Vc$1(t0){var e0=Wc$1(t0.target);if(e0!==null){var n0=Vb$1(e0);if(n0!==null){if(e0=n0.tag,e0===13){if(e0=Wb$1(n0),e0!==null){t0.blockedOn=e0,Ic$1(t0.priority,function(){Gc$1(n0)});return}}else if(e0===3&&n0.stateNode.current.memoizedState.isDehydrated){t0.blockedOn=n0.tag===3?n0.stateNode.containerInfo:null;return}}}t0.blockedOn=null}function Xc$1(t0){if(t0.blockedOn!==null)return!1;for(var e0=t0.targetContainers;0<e0.length;){var n0=Yc$1(t0.domEventName,t0.eventSystemFlags,e0[0],t0.nativeEvent);if(n0===null){n0=t0.nativeEvent;var r0=new n0.constructor(n0.type,n0);wb$1=r0,n0.target.dispatchEvent(r0),wb$1=null}else return e0=Cb$1(n0),e0!==null&&Fc$1(e0),t0.blockedOn=n0,!1;e0.shift()}return!0}function Zc$1(t0,e0,n0){Xc$1(t0)&&n0.delete(e0)}function $c$1(){Jc$1=!1,Lc$1!==null&&Xc$1(Lc$1)&&(Lc$1=null),Mc$1!==null&&Xc$1(Mc$1)&&(Mc$1=null),Nc$1!==null&&Xc$1(Nc$1)&&(Nc$1=null),Oc$1.forEach(Zc$1),Pc$1.forEach(Zc$1)}function ad$1(t0,e0){t0.blockedOn===e0&&(t0.blockedOn=null,Jc$1||(Jc$1=!0,ca$1.unstable_scheduleCallback(ca$1.unstable_NormalPriority,$c$1)))}function bd$1(t0){function e0(i0){return ad$1(i0,t0)}if(0<Kc$1.length){ad$1(Kc$1[0],t0);for(var n0=1;n0<Kc$1.length;n0++){var r0=Kc$1[n0];r0.blockedOn===t0&&(r0.blockedOn=null)}}for(Lc$1!==null&&ad$1(Lc$1,t0),Mc$1!==null&&ad$1(Mc$1,t0),Nc$1!==null&&ad$1(Nc$1,t0),Oc$1.forEach(e0),Pc$1.forEach(e0),n0=0;n0<Qc$1.length;n0++)r0=Qc$1[n0],r0.blockedOn===t0&&(r0.blockedOn=null);for(;0<Qc$1.length&&(n0=Qc$1[0],n0.blockedOn===null);)Vc$1(n0),n0.blockedOn===null&&Qc$1.shift()}var cd$1=ua$1.ReactCurrentBatchConfig,dd$1=!0;function ed$1(t0,e0,n0,r0){var i0=C$1,o0=cd$1.transition;cd$1.transition=null;try{C$1=1,fd$1(t0,e0,n0,r0)}finally{C$1=i0,cd$1.transition=o0}}function gd$1(t0,e0,n0,r0){var i0=C$1,o0=cd$1.transition;cd$1.transition=null;try{C$1=4,fd$1(t0,e0,n0,r0)}finally{C$1=i0,cd$1.transition=o0}}function fd$1(t0,e0,n0,r0){if(dd$1){var i0=Yc$1(t0,e0,n0,r0);if(i0===null)hd$1(t0,e0,r0,id$1,n0),Sc$1(t0,r0);else if(Uc$1(i0,t0,e0,n0,r0))r0.stopPropagation();else if(Sc$1(t0,r0),e0&4&&-1<Rc$1.indexOf(t0)){for(;i0!==null;){var o0=Cb$1(i0);if(o0!==null&&Ec$1(o0),o0=Yc$1(t0,e0,n0,r0),o0===null&&hd$1(t0,e0,r0,id$1,n0),o0===i0)break;i0=o0}i0!==null&&r0.stopPropagation()}else hd$1(t0,e0,r0,null,n0)}}var id$1=null;function Yc$1(t0,e0,n0,r0){if(id$1=null,t0=xb$1(r0),t0=Wc$1(t0),t0!==null)if(e0=Vb$1(t0),e0===null)t0=null;else if(n0=e0.tag,n0===13){if(t0=Wb$1(e0),t0!==null)return t0;t0=null}else if(n0===3){if(e0.stateNode.current.memoizedState.isDehydrated)return e0.tag===3?e0.stateNode.containerInfo:null;t0=null}else e0!==t0&&(t0=null);return id$1=t0,null}function jd$1(t0){switch(t0){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec$1()){case fc$1:return 1;case gc$1:return 4;case hc$1:case ic$1:return 16;case jc$1:return 536870912;default:return 16}default:return 16}}var kd$1=null,ld$1=null,md$1=null;function nd$1(){if(md$1)return md$1;var t0,e0=ld$1,n0=e0.length,r0,i0="value"in kd$1?kd$1.value:kd$1.textContent,o0=i0.length;for(t0=0;t0<n0&&e0[t0]===i0[t0];t0++);var s0=n0-t0;for(r0=1;r0<=s0&&e0[n0-r0]===i0[o0-r0];r0++);return md$1=i0.slice(t0,1<r0?1-r0:void 0)}function od$1(t0){var e0=t0.keyCode;return"charCode"in t0?(t0=t0.charCode,t0===0&&e0===13&&(t0=13)):t0=e0,t0===10&&(t0=13),32<=t0||t0===13?t0:0}function pd$1(){return!0}function qd$1(){return!1}function rd$1(t0){function e0(n0,r0,i0,o0,s0){this._reactName=n0,this._targetInst=i0,this.type=r0,this.nativeEvent=o0,this.target=s0,this.currentTarget=null;for(var a0 in t0)t0.hasOwnProperty(a0)&&(n0=t0[a0],this[a0]=n0?n0(o0):o0[a0]);return this.isDefaultPrevented=(o0.defaultPrevented!=null?o0.defaultPrevented:o0.returnValue===!1)?pd$1:qd$1,this.isPropagationStopped=qd$1,this}return A$1(e0.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n0=this.nativeEvent;n0&&(n0.preventDefault?n0.preventDefault():typeof n0.returnValue!="unknown"&&(n0.returnValue=!1),this.isDefaultPrevented=pd$1)},stopPropagation:function(){var n0=this.nativeEvent;n0&&(n0.stopPropagation?n0.stopPropagation():typeof n0.cancelBubble!="unknown"&&(n0.cancelBubble=!0),this.isPropagationStopped=pd$1)},persist:function(){},isPersistent:pd$1}),e0}var sd$1={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t0){return t0.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td$1=rd$1(sd$1),ud$1=A$1({},sd$1,{view:0,detail:0}),vd$1=rd$1(ud$1),wd$1,xd$1,yd$1,Ad$1=A$1({},ud$1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd$1,button:0,buttons:0,relatedTarget:function(t0){return t0.relatedTarget===void 0?t0.fromElement===t0.srcElement?t0.toElement:t0.fromElement:t0.relatedTarget},movementX:function(t0){return"movementX"in t0?t0.movementX:(t0!==yd$1&&(yd$1&&t0.type==="mousemove"?(wd$1=t0.screenX-yd$1.screenX,xd$1=t0.screenY-yd$1.screenY):xd$1=wd$1=0,yd$1=t0),wd$1)},movementY:function(t0){return"movementY"in t0?t0.movementY:xd$1}}),Bd$1=rd$1(Ad$1),Cd$1=A$1({},Ad$1,{dataTransfer:0}),Dd$1=rd$1(Cd$1),Ed$1=A$1({},ud$1,{relatedTarget:0}),Fd$1=rd$1(Ed$1),Gd$1=A$1({},sd$1,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd$1=rd$1(Gd$1),Id$1=A$1({},sd$1,{clipboardData:function(t0){return"clipboardData"in t0?t0.clipboardData:window.clipboardData}}),Jd$1=rd$1(Id$1),Kd$1=A$1({},sd$1,{data:0}),Ld$1=rd$1(Kd$1),Md$1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd$1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od$1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd$1(t0){var e0=this.nativeEvent;return e0.getModifierState?e0.getModifierState(t0):(t0=Od$1[t0])?!!e0[t0]:!1}function zd$1(){return Pd$1}var Qd$1=A$1({},ud$1,{key:function(t0){if(t0.key){var e0=Md$1[t0.key]||t0.key;if(e0!=="Unidentified")return e0}return t0.type==="keypress"?(t0=od$1(t0),t0===13?"Enter":String.fromCharCode(t0)):t0.type==="keydown"||t0.type==="keyup"?Nd$1[t0.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd$1,charCode:function(t0){return t0.type==="keypress"?od$1(t0):0},keyCode:function(t0){return t0.type==="keydown"||t0.type==="keyup"?t0.keyCode:0},which:function(t0){return t0.type==="keypress"?od$1(t0):t0.type==="keydown"||t0.type==="keyup"?t0.keyCode:0}}),Rd$1=rd$1(Qd$1),Sd$1=A$1({},Ad$1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td$1=rd$1(Sd$1),Ud$1=A$1({},ud$1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd$1}),Vd$1=rd$1(Ud$1),Wd$1=A$1({},sd$1,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd$1=rd$1(Wd$1),Yd$1=A$1({},Ad$1,{deltaX:function(t0){return"deltaX"in t0?t0.deltaX:"wheelDeltaX"in t0?-t0.wheelDeltaX:0},deltaY:function(t0){return"deltaY"in t0?t0.deltaY:"wheelDeltaY"in t0?-t0.wheelDeltaY:"wheelDelta"in t0?-t0.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd$1=rd$1(Yd$1),$d$1=[9,13,27,32],ae$1=ia$1&&"CompositionEvent"in window,be$1=null;ia$1&&"documentMode"in document&&(be$1=document.documentMode);var ce$1=ia$1&&"TextEvent"in window&&!be$1,de$1=ia$1&&(!ae$1||be$1&&8<be$1&&11>=be$1),ee$1=" ",fe$1=!1;function ge$1(t0,e0){switch(t0){case"keyup":return $d$1.indexOf(e0.keyCode)!==-1;case"keydown":return e0.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(t0){return t0=t0.detail,typeof t0=="object"&&"data"in t0?t0.data:null}var ie$1=!1;function je$1(t0,e0){switch(t0){case"compositionend":return he$1(e0);case"keypress":return e0.which!==32?null:(fe$1=!0,ee$1);case"textInput":return t0=e0.data,t0===ee$1&&fe$1?null:t0;default:return null}}function ke$1(t0,e0){if(ie$1)return t0==="compositionend"||!ae$1&&ge$1(t0,e0)?(t0=nd$1(),md$1=ld$1=kd$1=null,ie$1=!1,t0):null;switch(t0){case"paste":return null;case"keypress":if(!(e0.ctrlKey||e0.altKey||e0.metaKey)||e0.ctrlKey&&e0.altKey){if(e0.char&&1<e0.char.length)return e0.char;if(e0.which)return String.fromCharCode(e0.which)}return null;case"compositionend":return de$1&&e0.locale!=="ko"?null:e0.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(t0){var e0=t0&&t0.nodeName&&t0.nodeName.toLowerCase();return e0==="input"?!!le$1[t0.type]:e0==="textarea"}function ne$1(t0,e0,n0,r0){Eb$1(r0),e0=oe$1(e0,"onChange"),0<e0.length&&(n0=new td$1("onChange","change",null,n0,r0),t0.push({event:n0,listeners:e0}))}var pe$1=null,qe$1=null;function re$1(t0){se$1(t0,0)}function te$1(t0){var e0=ue$1(t0);if(Wa$1(e0))return t0}function ve$1(t0,e0){if(t0==="change")return e0}var we$1=!1;if(ia$1){var xe$1;if(ia$1){var ye$1="oninput"in document;if(!ye$1){var ze$1=document.createElement("div");ze$1.setAttribute("oninput","return;"),ye$1=typeof ze$1.oninput=="function"}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$1&&(pe$1.detachEvent("onpropertychange",Be$1),qe$1=pe$1=null)}function Be$1(t0){if(t0.propertyName==="value"&&te$1(qe$1)){var e0=[];ne$1(e0,qe$1,t0,xb$1(t0)),Jb$1(re$1,e0)}}function Ce$1(t0,e0,n0){t0==="focusin"?(Ae$1(),pe$1=e0,qe$1=n0,pe$1.attachEvent("onpropertychange",Be$1)):t0==="focusout"&&Ae$1()}function De$1(t0){if(t0==="selectionchange"||t0==="keyup"||t0==="keydown")return te$1(qe$1)}function Ee$1(t0,e0){if(t0==="click")return te$1(e0)}function Fe$1(t0,e0){if(t0==="input"||t0==="change")return te$1(e0)}function Ge$1(t0,e0){return t0===e0&&(t0!==0||1/t0===1/e0)||t0!==t0&&e0!==e0}var He$1=typeof Object.is=="function"?Object.is:Ge$1;function Ie$1(t0,e0){if(He$1(t0,e0))return!0;if(typeof t0!="object"||t0===null||typeof e0!="object"||e0===null)return!1;var n0=Object.keys(t0),r0=Object.keys(e0);if(n0.length!==r0.length)return!1;for(r0=0;r0<n0.length;r0++){var i0=n0[r0];if(!ja$1.call(e0,i0)||!He$1(t0[i0],e0[i0]))return!1}return!0}function Je$1(t0){for(;t0&&t0.firstChild;)t0=t0.firstChild;return t0}function Ke$1(t0,e0){var n0=Je$1(t0);t0=0;for(var r0;n0;){if(n0.nodeType===3){if(r0=t0+n0.textContent.length,t0<=e0&&r0>=e0)return{node:n0,offset:e0-t0};t0=r0}t:{for(;n0;){if(n0.nextSibling){n0=n0.nextSibling;break t}n0=n0.parentNode}n0=void 0}n0=Je$1(n0)}}function Le$1(t0,e0){return t0&&e0?t0===e0?!0:t0&&t0.nodeType===3?!1:e0&&e0.nodeType===3?Le$1(t0,e0.parentNode):"contains"in t0?t0.contains(e0):t0.compareDocumentPosition?!!(t0.compareDocumentPosition(e0)&16):!1:!1}function Me$1(){for(var t0=window,e0=Xa$1();e0 instanceof t0.HTMLIFrameElement;){try{var n0=typeof e0.contentWindow.location.href=="string"}catch{n0=!1}if(n0)t0=e0.contentWindow;else break;e0=Xa$1(t0.document)}return e0}function Ne$1(t0){var e0=t0&&t0.nodeName&&t0.nodeName.toLowerCase();return e0&&(e0==="input"&&(t0.type==="text"||t0.type==="search"||t0.type==="tel"||t0.type==="url"||t0.type==="password")||e0==="textarea"||t0.contentEditable==="true")}function Oe$1(t0){var e0=Me$1(),n0=t0.focusedElem,r0=t0.selectionRange;if(e0!==n0&&n0&&n0.ownerDocument&&Le$1(n0.ownerDocument.documentElement,n0)){if(r0!==null&&Ne$1(n0)){if(e0=r0.start,t0=r0.end,t0===void 0&&(t0=e0),"selectionStart"in n0)n0.selectionStart=e0,n0.selectionEnd=Math.min(t0,n0.value.length);else if(t0=(e0=n0.ownerDocument||document)&&e0.defaultView||window,t0.getSelection){t0=t0.getSelection();var i0=n0.textContent.length,o0=Math.min(r0.start,i0);r0=r0.end===void 0?o0:Math.min(r0.end,i0),!t0.extend&&o0>r0&&(i0=r0,r0=o0,o0=i0),i0=Ke$1(n0,o0);var s0=Ke$1(n0,r0);i0&&s0&&(t0.rangeCount!==1||t0.anchorNode!==i0.node||t0.anchorOffset!==i0.offset||t0.focusNode!==s0.node||t0.focusOffset!==s0.offset)&&(e0=e0.createRange(),e0.setStart(i0.node,i0.offset),t0.removeAllRanges(),o0>r0?(t0.addRange(e0),t0.extend(s0.node,s0.offset)):(e0.setEnd(s0.node,s0.offset),t0.addRange(e0)))}}for(e0=[],t0=n0;t0=t0.parentNode;)t0.nodeType===1&&e0.push({element:t0,left:t0.scrollLeft,top:t0.scrollTop});for(typeof n0.focus=="function"&&n0.focus(),n0=0;n0<e0.length;n0++)t0=e0[n0],t0.element.scrollLeft=t0.left,t0.element.scrollTop=t0.top}}var Pe$1=ia$1&&"documentMode"in document&&11>=document.documentMode,Qe$1=null,Re$1=null,Se$1=null,Te$1=!1;function Ue$1(t0,e0,n0){var r0=n0.window===n0?n0.document:n0.nodeType===9?n0:n0.ownerDocument;Te$1||Qe$1==null||Qe$1!==Xa$1(r0)||(r0=Qe$1,"selectionStart"in r0&&Ne$1(r0)?r0={start:r0.selectionStart,end:r0.selectionEnd}:(r0=(r0.ownerDocument&&r0.ownerDocument.defaultView||window).getSelection(),r0={anchorNode:r0.anchorNode,anchorOffset:r0.anchorOffset,focusNode:r0.focusNode,focusOffset:r0.focusOffset}),Se$1&&Ie$1(Se$1,r0)||(Se$1=r0,r0=oe$1(Re$1,"onSelect"),0<r0.length&&(e0=new td$1("onSelect","select",null,e0,n0),t0.push({event:e0,listeners:r0}),e0.target=Qe$1)))}function Ve$1(t0,e0){var n0={};return n0[t0.toLowerCase()]=e0.toLowerCase(),n0["Webkit"+t0]="webkit"+e0,n0["Moz"+t0]="moz"+e0,n0}var We$1={animationend:Ve$1("Animation","AnimationEnd"),animationiteration:Ve$1("Animation","AnimationIteration"),animationstart:Ve$1("Animation","AnimationStart"),transitionend:Ve$1("Transition","TransitionEnd")},Xe$1={},Ye$1={};ia$1&&(Ye$1=document.createElement("div").style,"AnimationEvent"in window||(delete We$1.animationend.animation,delete We$1.animationiteration.animation,delete We$1.animationstart.animation),"TransitionEvent"in window||delete We$1.transitionend.transition);function Ze$1(t0){if(Xe$1[t0])return Xe$1[t0];if(!We$1[t0])return t0;var e0=We$1[t0],n0;for(n0 in e0)if(e0.hasOwnProperty(n0)&&n0 in Ye$1)return Xe$1[t0]=e0[n0];return t0}var $e$1=Ze$1("animationend"),af$1=Ze$1("animationiteration"),bf$1=Ze$1("animationstart"),cf$1=Ze$1("transitionend"),df$1=new Map,ef$1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff$1(t0,e0){df$1.set(t0,e0),fa$1(e0,[t0])}for(var gf$1=0;gf$1<ef$1.length;gf$1++){var hf$1=ef$1[gf$1],jf$1=hf$1.toLowerCase(),kf$1=hf$1[0].toUpperCase()+hf$1.slice(1);ff$1(jf$1,"on"+kf$1)}ff$1($e$1,"onAnimationEnd");ff$1(af$1,"onAnimationIteration");ff$1(bf$1,"onAnimationStart");ff$1("dblclick","onDoubleClick");ff$1("focusin","onFocus");ff$1("focusout","onBlur");ff$1(cf$1,"onTransitionEnd");ha$1("onMouseEnter",["mouseout","mouseover"]);ha$1("onMouseLeave",["mouseout","mouseover"]);ha$1("onPointerEnter",["pointerout","pointerover"]);ha$1("onPointerLeave",["pointerout","pointerover"]);fa$1("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa$1("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa$1("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa$1("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa$1("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa$1("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf$1="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf$1=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf$1));function nf$1(t0,e0,n0){var r0=t0.type||"unknown-event";t0.currentTarget=n0,Ub$1(r0,e0,void 0,t0),t0.currentTarget=null}function se$1(t0,e0){e0=(e0&4)!==0;for(var n0=0;n0<t0.length;n0++){var r0=t0[n0],i0=r0.event;r0=r0.listeners;t:{var o0=void 0;if(e0)for(var s0=r0.length-1;0<=s0;s0--){var a0=r0[s0],c0=a0.instance,u0=a0.currentTarget;if(a0=a0.listener,c0!==o0&&i0.isPropagationStopped())break t;nf$1(i0,a0,u0),o0=c0}else for(s0=0;s0<r0.length;s0++){if(a0=r0[s0],c0=a0.instance,u0=a0.currentTarget,a0=a0.listener,c0!==o0&&i0.isPropagationStopped())break t;nf$1(i0,a0,u0),o0=c0}}}if(Qb$1)throw t0=Rb$1,Qb$1=!1,Rb$1=null,t0}function D$1(t0,e0){var n0=e0[of$1];n0===void 0&&(n0=e0[of$1]=new Set);var r0=t0+"__bubble";n0.has(r0)||(pf$1(e0,t0,2,!1),n0.add(r0))}function qf$1(t0,e0,n0){var r0=0;e0&&(r0|=4),pf$1(n0,t0,r0,e0)}var rf$1="_reactListening"+Math.random().toString(36).slice(2);function sf$1(t0){if(!t0[rf$1]){t0[rf$1]=!0,da$1.forEach(function(n0){n0!=="selectionchange"&&(mf$1.has(n0)||qf$1(n0,!1,t0),qf$1(n0,!0,t0))});var e0=t0.nodeType===9?t0:t0.ownerDocument;e0===null||e0[rf$1]||(e0[rf$1]=!0,qf$1("selectionchange",!1,e0))}}function pf$1(t0,e0,n0,r0){switch(jd$1(e0)){case 1:var i0=ed$1;break;case 4:i0=gd$1;break;default:i0=fd$1}n0=i0.bind(null,e0,n0,t0),i0=void 0,!Lb$1||e0!=="touchstart"&&e0!=="touchmove"&&e0!=="wheel"||(i0=!0),r0?i0!==void 0?t0.addEventListener(e0,n0,{capture:!0,passive:i0}):t0.addEventListener(e0,n0,!0):i0!==void 0?t0.addEventListener(e0,n0,{passive:i0}):t0.addEventListener(e0,n0,!1)}function hd$1(t0,e0,n0,r0,i0){var o0=r0;if(!(e0&1)&&!(e0&2)&&r0!==null)t:for(;;){if(r0===null)return;var s0=r0.tag;if(s0===3||s0===4){var a0=r0.stateNode.containerInfo;if(a0===i0||a0.nodeType===8&&a0.parentNode===i0)break;if(s0===4)for(s0=r0.return;s0!==null;){var c0=s0.tag;if((c0===3||c0===4)&&(c0=s0.stateNode.containerInfo,c0===i0||c0.nodeType===8&&c0.parentNode===i0))return;s0=s0.return}for(;a0!==null;){if(s0=Wc$1(a0),s0===null)return;if(c0=s0.tag,c0===5||c0===6){r0=o0=s0;continue t}a0=a0.parentNode}}r0=r0.return}Jb$1(function(){var u0=o0,l0=xb$1(n0),d0=[];t:{var h0=df$1.get(t0);if(h0!==void 0){var p0=td$1,m0=t0;switch(t0){case"keypress":if(od$1(n0)===0)break t;case"keydown":case"keyup":p0=Rd$1;break;case"focusin":m0="focus",p0=Fd$1;break;case"focusout":m0="blur",p0=Fd$1;break;case"beforeblur":case"afterblur":p0=Fd$1;break;case"click":if(n0.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p0=Bd$1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p0=Dd$1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p0=Vd$1;break;case $e$1:case af$1:case bf$1:p0=Hd$1;break;case cf$1:p0=Xd$1;break;case"scroll":p0=vd$1;break;case"wheel":p0=Zd$1;break;case"copy":case"cut":case"paste":p0=Jd$1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p0=Td$1}var f0=(e0&4)!==0,g0=!f0&&t0==="scroll",E0=f0?h0!==null?h0+"Capture":null:h0;f0=[];for(var _0=u0,y0;_0!==null;){y0=_0;var b0=y0.stateNode;if(y0.tag===5&&b0!==null&&(y0=b0,E0!==null&&(b0=Kb$1(_0,E0),b0!=null&&f0.push(tf$1(_0,b0,y0)))),g0)break;_0=_0.return}0<f0.length&&(h0=new p0(h0,m0,null,n0,l0),d0.push({event:h0,listeners:f0}))}}if(!(e0&7)){t:{if(h0=t0==="mouseover"||t0==="pointerover",p0=t0==="mouseout"||t0==="pointerout",h0&&n0!==wb$1&&(m0=n0.relatedTarget||n0.fromElement)&&(Wc$1(m0)||m0[uf$1]))break t;if((p0||h0)&&(h0=l0.window===l0?l0:(h0=l0.ownerDocument)?h0.defaultView||h0.parentWindow:window,p0?(m0=n0.relatedTarget||n0.toElement,p0=u0,m0=m0?Wc$1(m0):null,m0!==null&&(g0=Vb$1(m0),m0!==g0||m0.tag!==5&&m0.tag!==6)&&(m0=null)):(p0=null,m0=u0),p0!==m0)){if(f0=Bd$1,b0="onMouseLeave",E0="onMouseEnter",_0="mouse",(t0==="pointerout"||t0==="pointerover")&&(f0=Td$1,b0="onPointerLeave",E0="onPointerEnter",_0="pointer"),g0=p0==null?h0:ue$1(p0),y0=m0==null?h0:ue$1(m0),h0=new f0(b0,_0+"leave",p0,n0,l0),h0.target=g0,h0.relatedTarget=y0,b0=null,Wc$1(l0)===u0&&(f0=new f0(E0,_0+"enter",m0,n0,l0),f0.target=y0,f0.relatedTarget=g0,b0=f0),g0=b0,p0&&m0)e:{for(f0=p0,E0=m0,_0=0,y0=f0;y0;y0=vf$1(y0))_0++;for(y0=0,b0=E0;b0;b0=vf$1(b0))y0++;for(;0<_0-y0;)f0=vf$1(f0),_0--;for(;0<y0-_0;)E0=vf$1(E0),y0--;for(;_0--;){if(f0===E0||E0!==null&&f0===E0.alternate)break e;f0=vf$1(f0),E0=vf$1(E0)}f0=null}else f0=null;p0!==null&&wf$1(d0,h0,p0,f0,!1),m0!==null&&g0!==null&&wf$1(d0,g0,m0,f0,!0)}}t:{if(h0=u0?ue$1(u0):window,p0=h0.nodeName&&h0.nodeName.toLowerCase(),p0==="select"||p0==="input"&&h0.type==="file")var S0=ve$1;else if(me$1(h0))if(we$1)S0=Fe$1;else{S0=De$1;var w0=Ce$1}else(p0=h0.nodeName)&&p0.toLowerCase()==="input"&&(h0.type==="checkbox"||h0.type==="radio")&&(S0=Ee$1);if(S0&&(S0=S0(t0,u0))){ne$1(d0,S0,n0,l0);break t}w0&&w0(t0,h0,u0),t0==="focusout"&&(w0=h0._wrapperState)&&w0.controlled&&h0.type==="number"&&cb$1(h0,"number",h0.value)}switch(w0=u0?ue$1(u0):window,t0){case"focusin":(me$1(w0)||w0.contentEditable==="true")&&(Qe$1=w0,Re$1=u0,Se$1=null);break;case"focusout":Se$1=Re$1=Qe$1=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue$1(d0,n0,l0);break;case"selectionchange":if(Pe$1)break;case"keydown":case"keyup":Ue$1(d0,n0,l0)}var I0;if(ae$1)t:{switch(t0){case"compositionstart":var L0="onCompositionStart";break t;case"compositionend":L0="onCompositionEnd";break t;case"compositionupdate":L0="onCompositionUpdate";break t}L0=void 0}else ie$1?ge$1(t0,n0)&&(L0="onCompositionEnd"):t0==="keydown"&&n0.keyCode===229&&(L0="onCompositionStart");L0&&(de$1&&n0.locale!=="ko"&&(ie$1||L0!=="onCompositionStart"?L0==="onCompositionEnd"&&ie$1&&(I0=nd$1()):(kd$1=l0,ld$1="value"in kd$1?kd$1.value:kd$1.textContent,ie$1=!0)),w0=oe$1(u0,L0),0<w0.length&&(L0=new Ld$1(L0,t0,null,n0,l0),d0.push({event:L0,listeners:w0}),I0?L0.data=I0:(I0=he$1(n0),I0!==null&&(L0.data=I0)))),(I0=ce$1?je$1(t0,n0):ke$1(t0,n0))&&(u0=oe$1(u0,"onBeforeInput"),0<u0.length&&(l0=new Ld$1("onBeforeInput","beforeinput",null,n0,l0),d0.push({event:l0,listeners:u0}),l0.data=I0))}se$1(d0,e0)})}function tf$1(t0,e0,n0){return{instance:t0,listener:e0,currentTarget:n0}}function oe$1(t0,e0){for(var n0=e0+"Capture",r0=[];t0!==null;){var i0=t0,o0=i0.stateNode;i0.tag===5&&o0!==null&&(i0=o0,o0=Kb$1(t0,n0),o0!=null&&r0.unshift(tf$1(t0,o0,i0)),o0=Kb$1(t0,e0),o0!=null&&r0.push(tf$1(t0,o0,i0))),t0=t0.return}return r0}function vf$1(t0){if(t0===null)return null;do t0=t0.return;while(t0&&t0.tag!==5);return t0||null}function wf$1(t0,e0,n0,r0,i0){for(var o0=e0._reactName,s0=[];n0!==null&&n0!==r0;){var a0=n0,c0=a0.alternate,u0=a0.stateNode;if(c0!==null&&c0===r0)break;a0.tag===5&&u0!==null&&(a0=u0,i0?(c0=Kb$1(n0,o0),c0!=null&&s0.unshift(tf$1(n0,c0,a0))):i0||(c0=Kb$1(n0,o0),c0!=null&&s0.push(tf$1(n0,c0,a0)))),n0=n0.return}s0.length!==0&&t0.push({event:e0,listeners:s0})}var xf$1=/\r\n?/g,yf$1=/\u0000|\uFFFD/g;function zf$1(t0){return(typeof t0=="string"?t0:""+t0).replace(xf$1,`
`).replace(yf$1,"")}function Af$1(t0,e0,n0){if(e0=zf$1(e0),zf$1(t0)!==e0&&n0)throw Error(p$1(425))}function Bf$1(){}var Cf$1=null,Df$1=null;function Ef$1(t0,e0){return t0==="textarea"||t0==="noscript"||typeof e0.children=="string"||typeof e0.children=="number"||typeof e0.dangerouslySetInnerHTML=="object"&&e0.dangerouslySetInnerHTML!==null&&e0.dangerouslySetInnerHTML.__html!=null}var Ff$1=typeof setTimeout=="function"?setTimeout:void 0,Gf$1=typeof clearTimeout=="function"?clearTimeout:void 0,Hf$1=typeof Promise=="function"?Promise:void 0,Jf$1=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf$1<"u"?function(t0){return Hf$1.resolve(null).then(t0).catch(If$1)}:Ff$1;function If$1(t0){setTimeout(function(){throw t0})}function Kf$1(t0,e0){var n0=e0,r0=0;do{var i0=n0.nextSibling;if(t0.removeChild(n0),i0&&i0.nodeType===8)if(n0=i0.data,n0==="/$"){if(r0===0){t0.removeChild(i0),bd$1(e0);return}r0--}else n0!=="$"&&n0!=="$?"&&n0!=="$!"||r0++;n0=i0}while(n0);bd$1(e0)}function Lf$1(t0){for(;t0!=null;t0=t0.nextSibling){var e0=t0.nodeType;if(e0===1||e0===3)break;if(e0===8){if(e0=t0.data,e0==="$"||e0==="$!"||e0==="$?")break;if(e0==="/$")return null}}return t0}function Mf$1(t0){t0=t0.previousSibling;for(var e0=0;t0;){if(t0.nodeType===8){var n0=t0.data;if(n0==="$"||n0==="$!"||n0==="$?"){if(e0===0)return t0;e0--}else n0==="/$"&&e0++}t0=t0.previousSibling}return null}var Nf$1=Math.random().toString(36).slice(2),Of$1="__reactFiber$"+Nf$1,Pf$1="__reactProps$"+Nf$1,uf$1="__reactContainer$"+Nf$1,of$1="__reactEvents$"+Nf$1,Qf$1="__reactListeners$"+Nf$1,Rf$1="__reactHandles$"+Nf$1;function Wc$1(t0){var e0=t0[Of$1];if(e0)return e0;for(var n0=t0.parentNode;n0;){if(e0=n0[uf$1]||n0[Of$1]){if(n0=e0.alternate,e0.child!==null||n0!==null&&n0.child!==null)for(t0=Mf$1(t0);t0!==null;){if(n0=t0[Of$1])return n0;t0=Mf$1(t0)}return e0}t0=n0,n0=t0.parentNode}return null}function Cb$1(t0){return t0=t0[Of$1]||t0[uf$1],!t0||t0.tag!==5&&t0.tag!==6&&t0.tag!==13&&t0.tag!==3?null:t0}function ue$1(t0){if(t0.tag===5||t0.tag===6)return t0.stateNode;throw Error(p$1(33))}function Db$1(t0){return t0[Pf$1]||null}var Sf$1=[],Tf$1=-1;function Uf$1(t0){return{current:t0}}function E$1(t0){0>Tf$1||(t0.current=Sf$1[Tf$1],Sf$1[Tf$1]=null,Tf$1--)}function G$1(t0,e0){Tf$1++,Sf$1[Tf$1]=t0.current,t0.current=e0}var Vf$1={},H$1=Uf$1(Vf$1),Wf$1=Uf$1(!1),Xf$1=Vf$1;function Yf$1(t0,e0){var n0=t0.type.contextTypes;if(!n0)return Vf$1;var r0=t0.stateNode;if(r0&&r0.__reactInternalMemoizedUnmaskedChildContext===e0)return r0.__reactInternalMemoizedMaskedChildContext;var i0={},o0;for(o0 in n0)i0[o0]=e0[o0];return r0&&(t0=t0.stateNode,t0.__reactInternalMemoizedUnmaskedChildContext=e0,t0.__reactInternalMemoizedMaskedChildContext=i0),i0}function Zf$1(t0){return t0=t0.childContextTypes,t0!=null}function $f$1(){E$1(Wf$1),E$1(H$1)}function ag$1(t0,e0,n0){if(H$1.current!==Vf$1)throw Error(p$1(168));G$1(H$1,e0),G$1(Wf$1,n0)}function bg$1(t0,e0,n0){var r0=t0.stateNode;if(e0=e0.childContextTypes,typeof r0.getChildContext!="function")return n0;r0=r0.getChildContext();for(var i0 in r0)if(!(i0 in e0))throw Error(p$1(108,Ra$1(t0)||"Unknown",i0));return A$1({},n0,r0)}function cg$1(t0){return t0=(t0=t0.stateNode)&&t0.__reactInternalMemoizedMergedChildContext||Vf$1,Xf$1=H$1.current,G$1(H$1,t0),G$1(Wf$1,Wf$1.current),!0}function dg$1(t0,e0,n0){var r0=t0.stateNode;if(!r0)throw Error(p$1(169));n0?(t0=bg$1(t0,e0,Xf$1),r0.__reactInternalMemoizedMergedChildContext=t0,E$1(Wf$1),E$1(H$1),G$1(H$1,t0)):E$1(Wf$1),G$1(Wf$1,n0)}var eg$1=null,fg$1=!1,gg$1=!1;function hg$1(t0){eg$1===null?eg$1=[t0]:eg$1.push(t0)}function ig$1(t0){fg$1=!0,hg$1(t0)}function jg$1(){if(!gg$1&&eg$1!==null){gg$1=!0;var t0=0,e0=C$1;try{var n0=eg$1;for(C$1=1;t0<n0.length;t0++){var r0=n0[t0];do r0=r0(!0);while(r0!==null)}eg$1=null,fg$1=!1}catch(i0){throw eg$1!==null&&(eg$1=eg$1.slice(t0+1)),ac$1(fc$1,jg$1),i0}finally{C$1=e0,gg$1=!1}}return null}var kg$1=[],lg$1=0,mg$1=null,ng$1=0,og$1=[],pg$1=0,qg$1=null,rg$1=1,sg$1="";function tg$1(t0,e0){kg$1[lg$1++]=ng$1,kg$1[lg$1++]=mg$1,mg$1=t0,ng$1=e0}function ug$1(t0,e0,n0){og$1[pg$1++]=rg$1,og$1[pg$1++]=sg$1,og$1[pg$1++]=qg$1,qg$1=t0;var r0=rg$1;t0=sg$1;var i0=32-oc$1(r0)-1;r0&=~(1<<i0),n0+=1;var o0=32-oc$1(e0)+i0;if(30<o0){var s0=i0-i0%5;o0=(r0&(1<<s0)-1).toString(32),r0>>=s0,i0-=s0,rg$1=1<<32-oc$1(e0)+i0|n0<<i0|r0,sg$1=o0+t0}else rg$1=1<<o0|n0<<i0|r0,sg$1=t0}function vg$1(t0){t0.return!==null&&(tg$1(t0,1),ug$1(t0,1,0))}function wg$1(t0){for(;t0===mg$1;)mg$1=kg$1[--lg$1],kg$1[lg$1]=null,ng$1=kg$1[--lg$1],kg$1[lg$1]=null;for(;t0===qg$1;)qg$1=og$1[--pg$1],og$1[pg$1]=null,sg$1=og$1[--pg$1],og$1[pg$1]=null,rg$1=og$1[--pg$1],og$1[pg$1]=null}var xg$1=null,yg$1=null,I$1=!1,zg$1=null;function Ag$1(t0,e0){var n0=Bg$1(5,null,null,0);n0.elementType="DELETED",n0.stateNode=e0,n0.return=t0,e0=t0.deletions,e0===null?(t0.deletions=[n0],t0.flags|=16):e0.push(n0)}function Cg$1(t0,e0){switch(t0.tag){case 5:var n0=t0.type;return e0=e0.nodeType!==1||n0.toLowerCase()!==e0.nodeName.toLowerCase()?null:e0,e0!==null?(t0.stateNode=e0,xg$1=t0,yg$1=Lf$1(e0.firstChild),!0):!1;case 6:return e0=t0.pendingProps===""||e0.nodeType!==3?null:e0,e0!==null?(t0.stateNode=e0,xg$1=t0,yg$1=null,!0):!1;case 13:return e0=e0.nodeType!==8?null:e0,e0!==null?(n0=qg$1!==null?{id:rg$1,overflow:sg$1}:null,t0.memoizedState={dehydrated:e0,treeContext:n0,retryLane:1073741824},n0=Bg$1(18,null,null,0),n0.stateNode=e0,n0.return=t0,t0.child=n0,xg$1=t0,yg$1=null,!0):!1;default:return!1}}function Dg$1(t0){return(t0.mode&1)!==0&&(t0.flags&128)===0}function Eg$1(t0){if(I$1){var e0=yg$1;if(e0){var n0=e0;if(!Cg$1(t0,e0)){if(Dg$1(t0))throw Error(p$1(418));e0=Lf$1(n0.nextSibling);var r0=xg$1;e0&&Cg$1(t0,e0)?Ag$1(r0,n0):(t0.flags=t0.flags&-4097|2,I$1=!1,xg$1=t0)}}else{if(Dg$1(t0))throw Error(p$1(418));t0.flags=t0.flags&-4097|2,I$1=!1,xg$1=t0}}}function Fg$1(t0){for(t0=t0.return;t0!==null&&t0.tag!==5&&t0.tag!==3&&t0.tag!==13;)t0=t0.return;xg$1=t0}function Gg$1(t0){if(t0!==xg$1)return!1;if(!I$1)return Fg$1(t0),I$1=!0,!1;var e0;if((e0=t0.tag!==3)&&!(e0=t0.tag!==5)&&(e0=t0.type,e0=e0!=="head"&&e0!=="body"&&!Ef$1(t0.type,t0.memoizedProps)),e0&&(e0=yg$1)){if(Dg$1(t0))throw Hg$1(),Error(p$1(418));for(;e0;)Ag$1(t0,e0),e0=Lf$1(e0.nextSibling)}if(Fg$1(t0),t0.tag===13){if(t0=t0.memoizedState,t0=t0!==null?t0.dehydrated:null,!t0)throw Error(p$1(317));t:{for(t0=t0.nextSibling,e0=0;t0;){if(t0.nodeType===8){var n0=t0.data;if(n0==="/$"){if(e0===0){yg$1=Lf$1(t0.nextSibling);break t}e0--}else n0!=="$"&&n0!=="$!"&&n0!=="$?"||e0++}t0=t0.nextSibling}yg$1=null}}else yg$1=xg$1?Lf$1(t0.stateNode.nextSibling):null;return!0}function Hg$1(){for(var t0=yg$1;t0;)t0=Lf$1(t0.nextSibling)}function Ig$1(){yg$1=xg$1=null,I$1=!1}function Jg$1(t0){zg$1===null?zg$1=[t0]:zg$1.push(t0)}var Kg$1=ua$1.ReactCurrentBatchConfig;function Lg$1(t0,e0,n0){if(t0=n0.ref,t0!==null&&typeof t0!="function"&&typeof t0!="object"){if(n0._owner){if(n0=n0._owner,n0){if(n0.tag!==1)throw Error(p$1(309));var r0=n0.stateNode}if(!r0)throw Error(p$1(147,t0));var i0=r0,o0=""+t0;return e0!==null&&e0.ref!==null&&typeof e0.ref=="function"&&e0.ref._stringRef===o0?e0.ref:(e0=function(s0){var a0=i0.refs;s0===null?delete a0[o0]:a0[o0]=s0},e0._stringRef=o0,e0)}if(typeof t0!="string")throw Error(p$1(284));if(!n0._owner)throw Error(p$1(290,t0))}return t0}function Mg$1(t0,e0){throw t0=Object.prototype.toString.call(e0),Error(p$1(31,t0==="[object Object]"?"object with keys {"+Object.keys(e0).join(", ")+"}":t0))}function Ng$1(t0){var e0=t0._init;return e0(t0._payload)}function Og$1(t0){function e0(E0,_0){if(t0){var y0=E0.deletions;y0===null?(E0.deletions=[_0],E0.flags|=16):y0.push(_0)}}function n0(E0,_0){if(!t0)return null;for(;_0!==null;)e0(E0,_0),_0=_0.sibling;return null}function r0(E0,_0){for(E0=new Map;_0!==null;)_0.key!==null?E0.set(_0.key,_0):E0.set(_0.index,_0),_0=_0.sibling;return E0}function i0(E0,_0){return E0=Pg$1(E0,_0),E0.index=0,E0.sibling=null,E0}function o0(E0,_0,y0){return E0.index=y0,t0?(y0=E0.alternate,y0!==null?(y0=y0.index,y0<_0?(E0.flags|=2,_0):y0):(E0.flags|=2,_0)):(E0.flags|=1048576,_0)}function s0(E0){return t0&&E0.alternate===null&&(E0.flags|=2),E0}function a0(E0,_0,y0,b0){return _0===null||_0.tag!==6?(_0=Qg$1(y0,E0.mode,b0),_0.return=E0,_0):(_0=i0(_0,y0),_0.return=E0,_0)}function c0(E0,_0,y0,b0){var S0=y0.type;return S0===ya$1?l0(E0,_0,y0.props.children,b0,y0.key):_0!==null&&(_0.elementType===S0||typeof S0=="object"&&S0!==null&&S0.$$typeof===Ha$1&&Ng$1(S0)===_0.type)?(b0=i0(_0,y0.props),b0.ref=Lg$1(E0,_0,y0),b0.return=E0,b0):(b0=Rg$1(y0.type,y0.key,y0.props,null,E0.mode,b0),b0.ref=Lg$1(E0,_0,y0),b0.return=E0,b0)}function u0(E0,_0,y0,b0){return _0===null||_0.tag!==4||_0.stateNode.containerInfo!==y0.containerInfo||_0.stateNode.implementation!==y0.implementation?(_0=Sg$1(y0,E0.mode,b0),_0.return=E0,_0):(_0=i0(_0,y0.children||[]),_0.return=E0,_0)}function l0(E0,_0,y0,b0,S0){return _0===null||_0.tag!==7?(_0=Tg$1(y0,E0.mode,b0,S0),_0.return=E0,_0):(_0=i0(_0,y0),_0.return=E0,_0)}function d0(E0,_0,y0){if(typeof _0=="string"&&_0!==""||typeof _0=="number")return _0=Qg$1(""+_0,E0.mode,y0),_0.return=E0,_0;if(typeof _0=="object"&&_0!==null){switch(_0.$$typeof){case va$1:return y0=Rg$1(_0.type,_0.key,_0.props,null,E0.mode,y0),y0.ref=Lg$1(E0,null,_0),y0.return=E0,y0;case wa$1:return _0=Sg$1(_0,E0.mode,y0),_0.return=E0,_0;case Ha$1:var b0=_0._init;return d0(E0,b0(_0._payload),y0)}if(eb$1(_0)||Ka$1(_0))return _0=Tg$1(_0,E0.mode,y0,null),_0.return=E0,_0;Mg$1(E0,_0)}return null}function h0(E0,_0,y0,b0){var S0=_0!==null?_0.key:null;if(typeof y0=="string"&&y0!==""||typeof y0=="number")return S0!==null?null:a0(E0,_0,""+y0,b0);if(typeof y0=="object"&&y0!==null){switch(y0.$$typeof){case va$1:return y0.key===S0?c0(E0,_0,y0,b0):null;case wa$1:return y0.key===S0?u0(E0,_0,y0,b0):null;case Ha$1:return S0=y0._init,h0(E0,_0,S0(y0._payload),b0)}if(eb$1(y0)||Ka$1(y0))return S0!==null?null:l0(E0,_0,y0,b0,null);Mg$1(E0,y0)}return null}function p0(E0,_0,y0,b0,S0){if(typeof b0=="string"&&b0!==""||typeof b0=="number")return E0=E0.get(y0)||null,a0(_0,E0,""+b0,S0);if(typeof b0=="object"&&b0!==null){switch(b0.$$typeof){case va$1:return E0=E0.get(b0.key===null?y0:b0.key)||null,c0(_0,E0,b0,S0);case wa$1:return E0=E0.get(b0.key===null?y0:b0.key)||null,u0(_0,E0,b0,S0);case Ha$1:var w0=b0._init;return p0(E0,_0,y0,w0(b0._payload),S0)}if(eb$1(b0)||Ka$1(b0))return E0=E0.get(y0)||null,l0(_0,E0,b0,S0,null);Mg$1(_0,b0)}return null}function m0(E0,_0,y0,b0){for(var S0=null,w0=null,I0=_0,L0=_0=0,M0=null;I0!==null&&L0<y0.length;L0++){I0.index>L0?(M0=I0,I0=null):M0=I0.sibling;var C0=h0(E0,I0,y0[L0],b0);if(C0===null){I0===null&&(I0=M0);break}t0&&I0&&C0.alternate===null&&e0(E0,I0),_0=o0(C0,_0,L0),w0===null?S0=C0:w0.sibling=C0,w0=C0,I0=M0}if(L0===y0.length)return n0(E0,I0),I$1&&tg$1(E0,L0),S0;if(I0===null){for(;L0<y0.length;L0++)I0=d0(E0,y0[L0],b0),I0!==null&&(_0=o0(I0,_0,L0),w0===null?S0=I0:w0.sibling=I0,w0=I0);return I$1&&tg$1(E0,L0),S0}for(I0=r0(E0,I0);L0<y0.length;L0++)M0=p0(I0,E0,L0,y0[L0],b0),M0!==null&&(t0&&M0.alternate!==null&&I0.delete(M0.key===null?L0:M0.key),_0=o0(M0,_0,L0),w0===null?S0=M0:w0.sibling=M0,w0=M0);return t0&&I0.forEach(function(U0){return e0(E0,U0)}),I$1&&tg$1(E0,L0),S0}function f0(E0,_0,y0,b0){var S0=Ka$1(y0);if(typeof S0!="function")throw Error(p$1(150));if(y0=S0.call(y0),y0==null)throw Error(p$1(151));for(var w0=S0=null,I0=_0,L0=_0=0,M0=null,C0=y0.next();I0!==null&&!C0.done;L0++,C0=y0.next()){I0.index>L0?(M0=I0,I0=null):M0=I0.sibling;var U0=h0(E0,I0,C0.value,b0);if(U0===null){I0===null&&(I0=M0);break}t0&&I0&&U0.alternate===null&&e0(E0,I0),_0=o0(U0,_0,L0),w0===null?S0=U0:w0.sibling=U0,w0=U0,I0=M0}if(C0.done)return n0(E0,I0),I$1&&tg$1(E0,L0),S0;if(I0===null){for(;!C0.done;L0++,C0=y0.next())C0=d0(E0,C0.value,b0),C0!==null&&(_0=o0(C0,_0,L0),w0===null?S0=C0:w0.sibling=C0,w0=C0);return I$1&&tg$1(E0,L0),S0}for(I0=r0(E0,I0);!C0.done;L0++,C0=y0.next())C0=p0(I0,E0,L0,C0.value,b0),C0!==null&&(t0&&C0.alternate!==null&&I0.delete(C0.key===null?L0:C0.key),_0=o0(C0,_0,L0),w0===null?S0=C0:w0.sibling=C0,w0=C0);return t0&&I0.forEach(function(x0){return e0(E0,x0)}),I$1&&tg$1(E0,L0),S0}function g0(E0,_0,y0,b0){if(typeof y0=="object"&&y0!==null&&y0.type===ya$1&&y0.key===null&&(y0=y0.props.children),typeof y0=="object"&&y0!==null){switch(y0.$$typeof){case va$1:t:{for(var S0=y0.key,w0=_0;w0!==null;){if(w0.key===S0){if(S0=y0.type,S0===ya$1){if(w0.tag===7){n0(E0,w0.sibling),_0=i0(w0,y0.props.children),_0.return=E0,E0=_0;break t}}else if(w0.elementType===S0||typeof S0=="object"&&S0!==null&&S0.$$typeof===Ha$1&&Ng$1(S0)===w0.type){n0(E0,w0.sibling),_0=i0(w0,y0.props),_0.ref=Lg$1(E0,w0,y0),_0.return=E0,E0=_0;break t}n0(E0,w0);break}else e0(E0,w0);w0=w0.sibling}y0.type===ya$1?(_0=Tg$1(y0.props.children,E0.mode,b0,y0.key),_0.return=E0,E0=_0):(b0=Rg$1(y0.type,y0.key,y0.props,null,E0.mode,b0),b0.ref=Lg$1(E0,_0,y0),b0.return=E0,E0=b0)}return s0(E0);case wa$1:t:{for(w0=y0.key;_0!==null;){if(_0.key===w0)if(_0.tag===4&&_0.stateNode.containerInfo===y0.containerInfo&&_0.stateNode.implementation===y0.implementation){n0(E0,_0.sibling),_0=i0(_0,y0.children||[]),_0.return=E0,E0=_0;break t}else{n0(E0,_0);break}else e0(E0,_0);_0=_0.sibling}_0=Sg$1(y0,E0.mode,b0),_0.return=E0,E0=_0}return s0(E0);case Ha$1:return w0=y0._init,g0(E0,_0,w0(y0._payload),b0)}if(eb$1(y0))return m0(E0,_0,y0,b0);if(Ka$1(y0))return f0(E0,_0,y0,b0);Mg$1(E0,y0)}return typeof y0=="string"&&y0!==""||typeof y0=="number"?(y0=""+y0,_0!==null&&_0.tag===6?(n0(E0,_0.sibling),_0=i0(_0,y0),_0.return=E0,E0=_0):(n0(E0,_0),_0=Qg$1(y0,E0.mode,b0),_0.return=E0,E0=_0),s0(E0)):n0(E0,_0)}return g0}var Ug$1=Og$1(!0),Vg$1=Og$1(!1),Wg$1=Uf$1(null),Xg$1=null,Yg$1=null,Zg$1=null;function $g$1(){Zg$1=Yg$1=Xg$1=null}function ah$1(t0){var e0=Wg$1.current;E$1(Wg$1),t0._currentValue=e0}function bh$1(t0,e0,n0){for(;t0!==null;){var r0=t0.alternate;if((t0.childLanes&e0)!==e0?(t0.childLanes|=e0,r0!==null&&(r0.childLanes|=e0)):r0!==null&&(r0.childLanes&e0)!==e0&&(r0.childLanes|=e0),t0===n0)break;t0=t0.return}}function ch$1(t0,e0){Xg$1=t0,Zg$1=Yg$1=null,t0=t0.dependencies,t0!==null&&t0.firstContext!==null&&(t0.lanes&e0&&(dh$1=!0),t0.firstContext=null)}function eh$1(t0){var e0=t0._currentValue;if(Zg$1!==t0)if(t0={context:t0,memoizedValue:e0,next:null},Yg$1===null){if(Xg$1===null)throw Error(p$1(308));Yg$1=t0,Xg$1.dependencies={lanes:0,firstContext:t0}}else Yg$1=Yg$1.next=t0;return e0}var fh$1=null;function gh$1(t0){fh$1===null?fh$1=[t0]:fh$1.push(t0)}function hh$1(t0,e0,n0,r0){var i0=e0.interleaved;return i0===null?(n0.next=n0,gh$1(e0)):(n0.next=i0.next,i0.next=n0),e0.interleaved=n0,ih$1(t0,r0)}function ih$1(t0,e0){t0.lanes|=e0;var n0=t0.alternate;for(n0!==null&&(n0.lanes|=e0),n0=t0,t0=t0.return;t0!==null;)t0.childLanes|=e0,n0=t0.alternate,n0!==null&&(n0.childLanes|=e0),n0=t0,t0=t0.return;return n0.tag===3?n0.stateNode:null}var jh$1=!1;function kh$1(t0){t0.updateQueue={baseState:t0.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh$1(t0,e0){t0=t0.updateQueue,e0.updateQueue===t0&&(e0.updateQueue={baseState:t0.baseState,firstBaseUpdate:t0.firstBaseUpdate,lastBaseUpdate:t0.lastBaseUpdate,shared:t0.shared,effects:t0.effects})}function mh$1(t0,e0){return{eventTime:t0,lane:e0,tag:0,payload:null,callback:null,next:null}}function nh$1(t0,e0,n0){var r0=t0.updateQueue;if(r0===null)return null;if(r0=r0.shared,K$1&2){var i0=r0.pending;return i0===null?e0.next=e0:(e0.next=i0.next,i0.next=e0),r0.pending=e0,ih$1(t0,n0)}return i0=r0.interleaved,i0===null?(e0.next=e0,gh$1(r0)):(e0.next=i0.next,i0.next=e0),r0.interleaved=e0,ih$1(t0,n0)}function oh$1(t0,e0,n0){if(e0=e0.updateQueue,e0!==null&&(e0=e0.shared,(n0&4194240)!==0)){var r0=e0.lanes;r0&=t0.pendingLanes,n0|=r0,e0.lanes=n0,Cc$1(t0,n0)}}function ph$1(t0,e0){var n0=t0.updateQueue,r0=t0.alternate;if(r0!==null&&(r0=r0.updateQueue,n0===r0)){var i0=null,o0=null;if(n0=n0.firstBaseUpdate,n0!==null){do{var s0={eventTime:n0.eventTime,lane:n0.lane,tag:n0.tag,payload:n0.payload,callback:n0.callback,next:null};o0===null?i0=o0=s0:o0=o0.next=s0,n0=n0.next}while(n0!==null);o0===null?i0=o0=e0:o0=o0.next=e0}else i0=o0=e0;n0={baseState:r0.baseState,firstBaseUpdate:i0,lastBaseUpdate:o0,shared:r0.shared,effects:r0.effects},t0.updateQueue=n0;return}t0=n0.lastBaseUpdate,t0===null?n0.firstBaseUpdate=e0:t0.next=e0,n0.lastBaseUpdate=e0}function qh$1(t0,e0,n0,r0){var i0=t0.updateQueue;jh$1=!1;var o0=i0.firstBaseUpdate,s0=i0.lastBaseUpdate,a0=i0.shared.pending;if(a0!==null){i0.shared.pending=null;var c0=a0,u0=c0.next;c0.next=null,s0===null?o0=u0:s0.next=u0,s0=c0;var l0=t0.alternate;l0!==null&&(l0=l0.updateQueue,a0=l0.lastBaseUpdate,a0!==s0&&(a0===null?l0.firstBaseUpdate=u0:a0.next=u0,l0.lastBaseUpdate=c0))}if(o0!==null){var d0=i0.baseState;s0=0,l0=u0=c0=null,a0=o0;do{var h0=a0.lane,p0=a0.eventTime;if((r0&h0)===h0){l0!==null&&(l0=l0.next={eventTime:p0,lane:0,tag:a0.tag,payload:a0.payload,callback:a0.callback,next:null});t:{var m0=t0,f0=a0;switch(h0=e0,p0=n0,f0.tag){case 1:if(m0=f0.payload,typeof m0=="function"){d0=m0.call(p0,d0,h0);break t}d0=m0;break t;case 3:m0.flags=m0.flags&-65537|128;case 0:if(m0=f0.payload,h0=typeof m0=="function"?m0.call(p0,d0,h0):m0,h0==null)break t;d0=A$1({},d0,h0);break t;case 2:jh$1=!0}}a0.callback!==null&&a0.lane!==0&&(t0.flags|=64,h0=i0.effects,h0===null?i0.effects=[a0]:h0.push(a0))}else p0={eventTime:p0,lane:h0,tag:a0.tag,payload:a0.payload,callback:a0.callback,next:null},l0===null?(u0=l0=p0,c0=d0):l0=l0.next=p0,s0|=h0;if(a0=a0.next,a0===null){if(a0=i0.shared.pending,a0===null)break;h0=a0,a0=h0.next,h0.next=null,i0.lastBaseUpdate=h0,i0.shared.pending=null}}while(!0);if(l0===null&&(c0=d0),i0.baseState=c0,i0.firstBaseUpdate=u0,i0.lastBaseUpdate=l0,e0=i0.shared.interleaved,e0!==null){i0=e0;do s0|=i0.lane,i0=i0.next;while(i0!==e0)}else o0===null&&(i0.shared.lanes=0);rh$1|=s0,t0.lanes=s0,t0.memoizedState=d0}}function sh$1(t0,e0,n0){if(t0=e0.effects,e0.effects=null,t0!==null)for(e0=0;e0<t0.length;e0++){var r0=t0[e0],i0=r0.callback;if(i0!==null){if(r0.callback=null,r0=n0,typeof i0!="function")throw Error(p$1(191,i0));i0.call(r0)}}}var th$1={},uh$1=Uf$1(th$1),vh$1=Uf$1(th$1),wh$1=Uf$1(th$1);function xh$1(t0){if(t0===th$1)throw Error(p$1(174));return t0}function yh$1(t0,e0){switch(G$1(wh$1,e0),G$1(vh$1,t0),G$1(uh$1,th$1),t0=e0.nodeType,t0){case 9:case 11:e0=(e0=e0.documentElement)?e0.namespaceURI:lb$1(null,"");break;default:t0=t0===8?e0.parentNode:e0,e0=t0.namespaceURI||null,t0=t0.tagName,e0=lb$1(e0,t0)}E$1(uh$1),G$1(uh$1,e0)}function zh$1(){E$1(uh$1),E$1(vh$1),E$1(wh$1)}function Ah$1(t0){xh$1(wh$1.current);var e0=xh$1(uh$1.current),n0=lb$1(e0,t0.type);e0!==n0&&(G$1(vh$1,t0),G$1(uh$1,n0))}function Bh$1(t0){vh$1.current===t0&&(E$1(uh$1),E$1(vh$1))}var L$1=Uf$1(0);function Ch$1(t0){for(var e0=t0;e0!==null;){if(e0.tag===13){var n0=e0.memoizedState;if(n0!==null&&(n0=n0.dehydrated,n0===null||n0.data==="$?"||n0.data==="$!"))return e0}else if(e0.tag===19&&e0.memoizedProps.revealOrder!==void 0){if(e0.flags&128)return e0}else if(e0.child!==null){e0.child.return=e0,e0=e0.child;continue}if(e0===t0)break;for(;e0.sibling===null;){if(e0.return===null||e0.return===t0)return null;e0=e0.return}e0.sibling.return=e0.return,e0=e0.sibling}return null}var Dh$1=[];function Eh$1(){for(var t0=0;t0<Dh$1.length;t0++)Dh$1[t0]._workInProgressVersionPrimary=null;Dh$1.length=0}var Fh$1=ua$1.ReactCurrentDispatcher,Gh$1=ua$1.ReactCurrentBatchConfig,Hh$1=0,M$1=null,N$1=null,O$1=null,Ih$1=!1,Jh$1=!1,Kh$1=0,Lh$1=0;function P$1(){throw Error(p$1(321))}function Mh$1(t0,e0){if(e0===null)return!1;for(var n0=0;n0<e0.length&&n0<t0.length;n0++)if(!He$1(t0[n0],e0[n0]))return!1;return!0}function Nh$1(t0,e0,n0,r0,i0,o0){if(Hh$1=o0,M$1=e0,e0.memoizedState=null,e0.updateQueue=null,e0.lanes=0,Fh$1.current=t0===null||t0.memoizedState===null?Oh$1:Ph$1,t0=n0(r0,i0),Jh$1){o0=0;do{if(Jh$1=!1,Kh$1=0,25<=o0)throw Error(p$1(301));o0+=1,O$1=N$1=null,e0.updateQueue=null,Fh$1.current=Qh$1,t0=n0(r0,i0)}while(Jh$1)}if(Fh$1.current=Rh$1,e0=N$1!==null&&N$1.next!==null,Hh$1=0,O$1=N$1=M$1=null,Ih$1=!1,e0)throw Error(p$1(300));return t0}function Sh$1(){var t0=Kh$1!==0;return Kh$1=0,t0}function Th$1(){var t0={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O$1===null?M$1.memoizedState=O$1=t0:O$1=O$1.next=t0,O$1}function Uh$1(){if(N$1===null){var t0=M$1.alternate;t0=t0!==null?t0.memoizedState:null}else t0=N$1.next;var e0=O$1===null?M$1.memoizedState:O$1.next;if(e0!==null)O$1=e0,N$1=t0;else{if(t0===null)throw Error(p$1(310));N$1=t0,t0={memoizedState:N$1.memoizedState,baseState:N$1.baseState,baseQueue:N$1.baseQueue,queue:N$1.queue,next:null},O$1===null?M$1.memoizedState=O$1=t0:O$1=O$1.next=t0}return O$1}function Vh$1(t0,e0){return typeof e0=="function"?e0(t0):e0}function Wh$1(t0){var e0=Uh$1(),n0=e0.queue;if(n0===null)throw Error(p$1(311));n0.lastRenderedReducer=t0;var r0=N$1,i0=r0.baseQueue,o0=n0.pending;if(o0!==null){if(i0!==null){var s0=i0.next;i0.next=o0.next,o0.next=s0}r0.baseQueue=i0=o0,n0.pending=null}if(i0!==null){o0=i0.next,r0=r0.baseState;var a0=s0=null,c0=null,u0=o0;do{var l0=u0.lane;if((Hh$1&l0)===l0)c0!==null&&(c0=c0.next={lane:0,action:u0.action,hasEagerState:u0.hasEagerState,eagerState:u0.eagerState,next:null}),r0=u0.hasEagerState?u0.eagerState:t0(r0,u0.action);else{var d0={lane:l0,action:u0.action,hasEagerState:u0.hasEagerState,eagerState:u0.eagerState,next:null};c0===null?(a0=c0=d0,s0=r0):c0=c0.next=d0,M$1.lanes|=l0,rh$1|=l0}u0=u0.next}while(u0!==null&&u0!==o0);c0===null?s0=r0:c0.next=a0,He$1(r0,e0.memoizedState)||(dh$1=!0),e0.memoizedState=r0,e0.baseState=s0,e0.baseQueue=c0,n0.lastRenderedState=r0}if(t0=n0.interleaved,t0!==null){i0=t0;do o0=i0.lane,M$1.lanes|=o0,rh$1|=o0,i0=i0.next;while(i0!==t0)}else i0===null&&(n0.lanes=0);return[e0.memoizedState,n0.dispatch]}function Xh$1(t0){var e0=Uh$1(),n0=e0.queue;if(n0===null)throw Error(p$1(311));n0.lastRenderedReducer=t0;var r0=n0.dispatch,i0=n0.pending,o0=e0.memoizedState;if(i0!==null){n0.pending=null;var s0=i0=i0.next;do o0=t0(o0,s0.action),s0=s0.next;while(s0!==i0);He$1(o0,e0.memoizedState)||(dh$1=!0),e0.memoizedState=o0,e0.baseQueue===null&&(e0.baseState=o0),n0.lastRenderedState=o0}return[o0,r0]}function Yh$1(){}function Zh$1(t0,e0){var n0=M$1,r0=Uh$1(),i0=e0(),o0=!He$1(r0.memoizedState,i0);if(o0&&(r0.memoizedState=i0,dh$1=!0),r0=r0.queue,$h$1(ai$1.bind(null,n0,r0,t0),[t0]),r0.getSnapshot!==e0||o0||O$1!==null&&O$1.memoizedState.tag&1){if(n0.flags|=2048,bi$1(9,ci$1.bind(null,n0,r0,i0,e0),void 0,null),Q$1===null)throw Error(p$1(349));Hh$1&30||di$1(n0,e0,i0)}return i0}function di$1(t0,e0,n0){t0.flags|=16384,t0={getSnapshot:e0,value:n0},e0=M$1.updateQueue,e0===null?(e0={lastEffect:null,stores:null},M$1.updateQueue=e0,e0.stores=[t0]):(n0=e0.stores,n0===null?e0.stores=[t0]:n0.push(t0))}function ci$1(t0,e0,n0,r0){e0.value=n0,e0.getSnapshot=r0,ei$1(e0)&&fi$1(t0)}function ai$1(t0,e0,n0){return n0(function(){ei$1(e0)&&fi$1(t0)})}function ei$1(t0){var e0=t0.getSnapshot;t0=t0.value;try{var n0=e0();return!He$1(t0,n0)}catch{return!0}}function fi$1(t0){var e0=ih$1(t0,1);e0!==null&&gi$1(e0,t0,1,-1)}function hi$1(t0){var e0=Th$1();return typeof t0=="function"&&(t0=t0()),e0.memoizedState=e0.baseState=t0,t0={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh$1,lastRenderedState:t0},e0.queue=t0,t0=t0.dispatch=ii$1.bind(null,M$1,t0),[e0.memoizedState,t0]}function bi$1(t0,e0,n0,r0){return t0={tag:t0,create:e0,destroy:n0,deps:r0,next:null},e0=M$1.updateQueue,e0===null?(e0={lastEffect:null,stores:null},M$1.updateQueue=e0,e0.lastEffect=t0.next=t0):(n0=e0.lastEffect,n0===null?e0.lastEffect=t0.next=t0:(r0=n0.next,n0.next=t0,t0.next=r0,e0.lastEffect=t0)),t0}function ji$1(){return Uh$1().memoizedState}function ki$1(t0,e0,n0,r0){var i0=Th$1();M$1.flags|=t0,i0.memoizedState=bi$1(1|e0,n0,void 0,r0===void 0?null:r0)}function li$1(t0,e0,n0,r0){var i0=Uh$1();r0=r0===void 0?null:r0;var o0=void 0;if(N$1!==null){var s0=N$1.memoizedState;if(o0=s0.destroy,r0!==null&&Mh$1(r0,s0.deps)){i0.memoizedState=bi$1(e0,n0,o0,r0);return}}M$1.flags|=t0,i0.memoizedState=bi$1(1|e0,n0,o0,r0)}function mi$1(t0,e0){return ki$1(8390656,8,t0,e0)}function $h$1(t0,e0){return li$1(2048,8,t0,e0)}function ni$1(t0,e0){return li$1(4,2,t0,e0)}function oi$1(t0,e0){return li$1(4,4,t0,e0)}function pi$1(t0,e0){if(typeof e0=="function")return t0=t0(),e0(t0),function(){e0(null)};if(e0!=null)return t0=t0(),e0.current=t0,function(){e0.current=null}}function qi$1(t0,e0,n0){return n0=n0!=null?n0.concat([t0]):null,li$1(4,4,pi$1.bind(null,e0,t0),n0)}function ri$1(){}function si$1(t0,e0){var n0=Uh$1();e0=e0===void 0?null:e0;var r0=n0.memoizedState;return r0!==null&&e0!==null&&Mh$1(e0,r0[1])?r0[0]:(n0.memoizedState=[t0,e0],t0)}function ti$1(t0,e0){var n0=Uh$1();e0=e0===void 0?null:e0;var r0=n0.memoizedState;return r0!==null&&e0!==null&&Mh$1(e0,r0[1])?r0[0]:(t0=t0(),n0.memoizedState=[t0,e0],t0)}function ui$1(t0,e0,n0){return Hh$1&21?(He$1(n0,e0)||(n0=yc$1(),M$1.lanes|=n0,rh$1|=n0,t0.baseState=!0),e0):(t0.baseState&&(t0.baseState=!1,dh$1=!0),t0.memoizedState=n0)}function vi$1(t0,e0){var n0=C$1;C$1=n0!==0&&4>n0?n0:4,t0(!0);var r0=Gh$1.transition;Gh$1.transition={};try{t0(!1),e0()}finally{C$1=n0,Gh$1.transition=r0}}function wi$1(){return Uh$1().memoizedState}function xi$1(t0,e0,n0){var r0=yi$1(t0);if(n0={lane:r0,action:n0,hasEagerState:!1,eagerState:null,next:null},zi$1(t0))Ai$1(e0,n0);else if(n0=hh$1(t0,e0,n0,r0),n0!==null){var i0=R$1();gi$1(n0,t0,r0,i0),Bi$1(n0,e0,r0)}}function ii$1(t0,e0,n0){var r0=yi$1(t0),i0={lane:r0,action:n0,hasEagerState:!1,eagerState:null,next:null};if(zi$1(t0))Ai$1(e0,i0);else{var o0=t0.alternate;if(t0.lanes===0&&(o0===null||o0.lanes===0)&&(o0=e0.lastRenderedReducer,o0!==null))try{var s0=e0.lastRenderedState,a0=o0(s0,n0);if(i0.hasEagerState=!0,i0.eagerState=a0,He$1(a0,s0)){var c0=e0.interleaved;c0===null?(i0.next=i0,gh$1(e0)):(i0.next=c0.next,c0.next=i0),e0.interleaved=i0;return}}catch{}finally{}n0=hh$1(t0,e0,i0,r0),n0!==null&&(i0=R$1(),gi$1(n0,t0,r0,i0),Bi$1(n0,e0,r0))}}function zi$1(t0){var e0=t0.alternate;return t0===M$1||e0!==null&&e0===M$1}function Ai$1(t0,e0){Jh$1=Ih$1=!0;var n0=t0.pending;n0===null?e0.next=e0:(e0.next=n0.next,n0.next=e0),t0.pending=e0}function Bi$1(t0,e0,n0){if(n0&4194240){var r0=e0.lanes;r0&=t0.pendingLanes,n0|=r0,e0.lanes=n0,Cc$1(t0,n0)}}var Rh$1={readContext:eh$1,useCallback:P$1,useContext:P$1,useEffect:P$1,useImperativeHandle:P$1,useInsertionEffect:P$1,useLayoutEffect:P$1,useMemo:P$1,useReducer:P$1,useRef:P$1,useState:P$1,useDebugValue:P$1,useDeferredValue:P$1,useTransition:P$1,useMutableSource:P$1,useSyncExternalStore:P$1,useId:P$1,unstable_isNewReconciler:!1},Oh$1={readContext:eh$1,useCallback:function(t0,e0){return Th$1().memoizedState=[t0,e0===void 0?null:e0],t0},useContext:eh$1,useEffect:mi$1,useImperativeHandle:function(t0,e0,n0){return n0=n0!=null?n0.concat([t0]):null,ki$1(4194308,4,pi$1.bind(null,e0,t0),n0)},useLayoutEffect:function(t0,e0){return ki$1(4194308,4,t0,e0)},useInsertionEffect:function(t0,e0){return ki$1(4,2,t0,e0)},useMemo:function(t0,e0){var n0=Th$1();return e0=e0===void 0?null:e0,t0=t0(),n0.memoizedState=[t0,e0],t0},useReducer:function(t0,e0,n0){var r0=Th$1();return e0=n0!==void 0?n0(e0):e0,r0.memoizedState=r0.baseState=e0,t0={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t0,lastRenderedState:e0},r0.queue=t0,t0=t0.dispatch=xi$1.bind(null,M$1,t0),[r0.memoizedState,t0]},useRef:function(t0){var e0=Th$1();return t0={current:t0},e0.memoizedState=t0},useState:hi$1,useDebugValue:ri$1,useDeferredValue:function(t0){return Th$1().memoizedState=t0},useTransition:function(){var t0=hi$1(!1),e0=t0[0];return t0=vi$1.bind(null,t0[1]),Th$1().memoizedState=t0,[e0,t0]},useMutableSource:function(){},useSyncExternalStore:function(t0,e0,n0){var r0=M$1,i0=Th$1();if(I$1){if(n0===void 0)throw Error(p$1(407));n0=n0()}else{if(n0=e0(),Q$1===null)throw Error(p$1(349));Hh$1&30||di$1(r0,e0,n0)}i0.memoizedState=n0;var o0={value:n0,getSnapshot:e0};return i0.queue=o0,mi$1(ai$1.bind(null,r0,o0,t0),[t0]),r0.flags|=2048,bi$1(9,ci$1.bind(null,r0,o0,n0,e0),void 0,null),n0},useId:function(){var t0=Th$1(),e0=Q$1.identifierPrefix;if(I$1){var n0=sg$1,r0=rg$1;n0=(r0&~(1<<32-oc$1(r0)-1)).toString(32)+n0,e0=":"+e0+"R"+n0,n0=Kh$1++,0<n0&&(e0+="H"+n0.toString(32)),e0+=":"}else n0=Lh$1++,e0=":"+e0+"r"+n0.toString(32)+":";return t0.memoizedState=e0},unstable_isNewReconciler:!1},Ph$1={readContext:eh$1,useCallback:si$1,useContext:eh$1,useEffect:$h$1,useImperativeHandle:qi$1,useInsertionEffect:ni$1,useLayoutEffect:oi$1,useMemo:ti$1,useReducer:Wh$1,useRef:ji$1,useState:function(){return Wh$1(Vh$1)},useDebugValue:ri$1,useDeferredValue:function(t0){var e0=Uh$1();return ui$1(e0,N$1.memoizedState,t0)},useTransition:function(){var t0=Wh$1(Vh$1)[0],e0=Uh$1().memoizedState;return[t0,e0]},useMutableSource:Yh$1,useSyncExternalStore:Zh$1,useId:wi$1,unstable_isNewReconciler:!1},Qh$1={readContext:eh$1,useCallback:si$1,useContext:eh$1,useEffect:$h$1,useImperativeHandle:qi$1,useInsertionEffect:ni$1,useLayoutEffect:oi$1,useMemo:ti$1,useReducer:Xh$1,useRef:ji$1,useState:function(){return Xh$1(Vh$1)},useDebugValue:ri$1,useDeferredValue:function(t0){var e0=Uh$1();return N$1===null?e0.memoizedState=t0:ui$1(e0,N$1.memoizedState,t0)},useTransition:function(){var t0=Xh$1(Vh$1)[0],e0=Uh$1().memoizedState;return[t0,e0]},useMutableSource:Yh$1,useSyncExternalStore:Zh$1,useId:wi$1,unstable_isNewReconciler:!1};function Ci$1(t0,e0){if(t0&&t0.defaultProps){e0=A$1({},e0),t0=t0.defaultProps;for(var n0 in t0)e0[n0]===void 0&&(e0[n0]=t0[n0]);return e0}return e0}function Di$1(t0,e0,n0,r0){e0=t0.memoizedState,n0=n0(r0,e0),n0=n0==null?e0:A$1({},e0,n0),t0.memoizedState=n0,t0.lanes===0&&(t0.updateQueue.baseState=n0)}var Ei$1={isMounted:function(t0){return(t0=t0._reactInternals)?Vb$1(t0)===t0:!1},enqueueSetState:function(t0,e0,n0){t0=t0._reactInternals;var r0=R$1(),i0=yi$1(t0),o0=mh$1(r0,i0);o0.payload=e0,n0!=null&&(o0.callback=n0),e0=nh$1(t0,o0,i0),e0!==null&&(gi$1(e0,t0,i0,r0),oh$1(e0,t0,i0))},enqueueReplaceState:function(t0,e0,n0){t0=t0._reactInternals;var r0=R$1(),i0=yi$1(t0),o0=mh$1(r0,i0);o0.tag=1,o0.payload=e0,n0!=null&&(o0.callback=n0),e0=nh$1(t0,o0,i0),e0!==null&&(gi$1(e0,t0,i0,r0),oh$1(e0,t0,i0))},enqueueForceUpdate:function(t0,e0){t0=t0._reactInternals;var n0=R$1(),r0=yi$1(t0),i0=mh$1(n0,r0);i0.tag=2,e0!=null&&(i0.callback=e0),e0=nh$1(t0,i0,r0),e0!==null&&(gi$1(e0,t0,r0,n0),oh$1(e0,t0,r0))}};function Fi$1(t0,e0,n0,r0,i0,o0,s0){return t0=t0.stateNode,typeof t0.shouldComponentUpdate=="function"?t0.shouldComponentUpdate(r0,o0,s0):e0.prototype&&e0.prototype.isPureReactComponent?!Ie$1(n0,r0)||!Ie$1(i0,o0):!0}function Gi$1(t0,e0,n0){var r0=!1,i0=Vf$1,o0=e0.contextType;return typeof o0=="object"&&o0!==null?o0=eh$1(o0):(i0=Zf$1(e0)?Xf$1:H$1.current,r0=e0.contextTypes,o0=(r0=r0!=null)?Yf$1(t0,i0):Vf$1),e0=new e0(n0,o0),t0.memoizedState=e0.state!==null&&e0.state!==void 0?e0.state:null,e0.updater=Ei$1,t0.stateNode=e0,e0._reactInternals=t0,r0&&(t0=t0.stateNode,t0.__reactInternalMemoizedUnmaskedChildContext=i0,t0.__reactInternalMemoizedMaskedChildContext=o0),e0}function Hi$1(t0,e0,n0,r0){t0=e0.state,typeof e0.componentWillReceiveProps=="function"&&e0.componentWillReceiveProps(n0,r0),typeof e0.UNSAFE_componentWillReceiveProps=="function"&&e0.UNSAFE_componentWillReceiveProps(n0,r0),e0.state!==t0&&Ei$1.enqueueReplaceState(e0,e0.state,null)}function Ii$1(t0,e0,n0,r0){var i0=t0.stateNode;i0.props=n0,i0.state=t0.memoizedState,i0.refs={},kh$1(t0);var o0=e0.contextType;typeof o0=="object"&&o0!==null?i0.context=eh$1(o0):(o0=Zf$1(e0)?Xf$1:H$1.current,i0.context=Yf$1(t0,o0)),i0.state=t0.memoizedState,o0=e0.getDerivedStateFromProps,typeof o0=="function"&&(Di$1(t0,e0,o0,n0),i0.state=t0.memoizedState),typeof e0.getDerivedStateFromProps=="function"||typeof i0.getSnapshotBeforeUpdate=="function"||typeof i0.UNSAFE_componentWillMount!="function"&&typeof i0.componentWillMount!="function"||(e0=i0.state,typeof i0.componentWillMount=="function"&&i0.componentWillMount(),typeof i0.UNSAFE_componentWillMount=="function"&&i0.UNSAFE_componentWillMount(),e0!==i0.state&&Ei$1.enqueueReplaceState(i0,i0.state,null),qh$1(t0,n0,i0,r0),i0.state=t0.memoizedState),typeof i0.componentDidMount=="function"&&(t0.flags|=4194308)}function Ji$1(t0,e0){try{var n0="",r0=e0;do n0+=Pa$1(r0),r0=r0.return;while(r0);var i0=n0}catch(o0){i0=`
Error generating stack: `+o0.message+`
`+o0.stack}return{value:t0,source:e0,stack:i0,digest:null}}function Ki$1(t0,e0,n0){return{value:t0,source:null,stack:n0??null,digest:e0??null}}function Li$1(t0,e0){try{console.error(e0.value)}catch(n0){setTimeout(function(){throw n0})}}var Mi$1=typeof WeakMap=="function"?WeakMap:Map;function Ni$1(t0,e0,n0){n0=mh$1(-1,n0),n0.tag=3,n0.payload={element:null};var r0=e0.value;return n0.callback=function(){Oi$1||(Oi$1=!0,Pi$1=r0),Li$1(t0,e0)},n0}function Qi$1(t0,e0,n0){n0=mh$1(-1,n0),n0.tag=3;var r0=t0.type.getDerivedStateFromError;if(typeof r0=="function"){var i0=e0.value;n0.payload=function(){return r0(i0)},n0.callback=function(){Li$1(t0,e0)}}var o0=t0.stateNode;return o0!==null&&typeof o0.componentDidCatch=="function"&&(n0.callback=function(){Li$1(t0,e0),typeof r0!="function"&&(Ri$1===null?Ri$1=new Set([this]):Ri$1.add(this));var s0=e0.stack;this.componentDidCatch(e0.value,{componentStack:s0!==null?s0:""})}),n0}function Si$1(t0,e0,n0){var r0=t0.pingCache;if(r0===null){r0=t0.pingCache=new Mi$1;var i0=new Set;r0.set(e0,i0)}else i0=r0.get(e0),i0===void 0&&(i0=new Set,r0.set(e0,i0));i0.has(n0)||(i0.add(n0),t0=Ti$1.bind(null,t0,e0,n0),e0.then(t0,t0))}function Ui$1(t0){do{var e0;if((e0=t0.tag===13)&&(e0=t0.memoizedState,e0=e0!==null?e0.dehydrated!==null:!0),e0)return t0;t0=t0.return}while(t0!==null);return null}function Vi$1(t0,e0,n0,r0,i0){return t0.mode&1?(t0.flags|=65536,t0.lanes=i0,t0):(t0===e0?t0.flags|=65536:(t0.flags|=128,n0.flags|=131072,n0.flags&=-52805,n0.tag===1&&(n0.alternate===null?n0.tag=17:(e0=mh$1(-1,1),e0.tag=2,nh$1(n0,e0,1))),n0.lanes|=1),t0)}var Wi$1=ua$1.ReactCurrentOwner,dh$1=!1;function Xi$1(t0,e0,n0,r0){e0.child=t0===null?Vg$1(e0,null,n0,r0):Ug$1(e0,t0.child,n0,r0)}function Yi$1(t0,e0,n0,r0,i0){n0=n0.render;var o0=e0.ref;return ch$1(e0,i0),r0=Nh$1(t0,e0,n0,r0,o0,i0),n0=Sh$1(),t0!==null&&!dh$1?(e0.updateQueue=t0.updateQueue,e0.flags&=-2053,t0.lanes&=~i0,Zi$1(t0,e0,i0)):(I$1&&n0&&vg$1(e0),e0.flags|=1,Xi$1(t0,e0,r0,i0),e0.child)}function $i$1(t0,e0,n0,r0,i0){if(t0===null){var o0=n0.type;return typeof o0=="function"&&!aj$1(o0)&&o0.defaultProps===void 0&&n0.compare===null&&n0.defaultProps===void 0?(e0.tag=15,e0.type=o0,bj$1(t0,e0,o0,r0,i0)):(t0=Rg$1(n0.type,null,r0,e0,e0.mode,i0),t0.ref=e0.ref,t0.return=e0,e0.child=t0)}if(o0=t0.child,!(t0.lanes&i0)){var s0=o0.memoizedProps;if(n0=n0.compare,n0=n0!==null?n0:Ie$1,n0(s0,r0)&&t0.ref===e0.ref)return Zi$1(t0,e0,i0)}return e0.flags|=1,t0=Pg$1(o0,r0),t0.ref=e0.ref,t0.return=e0,e0.child=t0}function bj$1(t0,e0,n0,r0,i0){if(t0!==null){var o0=t0.memoizedProps;if(Ie$1(o0,r0)&&t0.ref===e0.ref)if(dh$1=!1,e0.pendingProps=r0=o0,(t0.lanes&i0)!==0)t0.flags&131072&&(dh$1=!0);else return e0.lanes=t0.lanes,Zi$1(t0,e0,i0)}return cj$1(t0,e0,n0,r0,i0)}function dj$1(t0,e0,n0){var r0=e0.pendingProps,i0=r0.children,o0=t0!==null?t0.memoizedState:null;if(r0.mode==="hidden")if(!(e0.mode&1))e0.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(ej$1,fj$1),fj$1|=n0;else{if(!(n0&1073741824))return t0=o0!==null?o0.baseLanes|n0:n0,e0.lanes=e0.childLanes=1073741824,e0.memoizedState={baseLanes:t0,cachePool:null,transitions:null},e0.updateQueue=null,G$1(ej$1,fj$1),fj$1|=t0,null;e0.memoizedState={baseLanes:0,cachePool:null,transitions:null},r0=o0!==null?o0.baseLanes:n0,G$1(ej$1,fj$1),fj$1|=r0}else o0!==null?(r0=o0.baseLanes|n0,e0.memoizedState=null):r0=n0,G$1(ej$1,fj$1),fj$1|=r0;return Xi$1(t0,e0,i0,n0),e0.child}function gj$1(t0,e0){var n0=e0.ref;(t0===null&&n0!==null||t0!==null&&t0.ref!==n0)&&(e0.flags|=512,e0.flags|=2097152)}function cj$1(t0,e0,n0,r0,i0){var o0=Zf$1(n0)?Xf$1:H$1.current;return o0=Yf$1(e0,o0),ch$1(e0,i0),n0=Nh$1(t0,e0,n0,r0,o0,i0),r0=Sh$1(),t0!==null&&!dh$1?(e0.updateQueue=t0.updateQueue,e0.flags&=-2053,t0.lanes&=~i0,Zi$1(t0,e0,i0)):(I$1&&r0&&vg$1(e0),e0.flags|=1,Xi$1(t0,e0,n0,i0),e0.child)}function hj$1(t0,e0,n0,r0,i0){if(Zf$1(n0)){var o0=!0;cg$1(e0)}else o0=!1;if(ch$1(e0,i0),e0.stateNode===null)ij$1(t0,e0),Gi$1(e0,n0,r0),Ii$1(e0,n0,r0,i0),r0=!0;else if(t0===null){var s0=e0.stateNode,a0=e0.memoizedProps;s0.props=a0;var c0=s0.context,u0=n0.contextType;typeof u0=="object"&&u0!==null?u0=eh$1(u0):(u0=Zf$1(n0)?Xf$1:H$1.current,u0=Yf$1(e0,u0));var l0=n0.getDerivedStateFromProps,d0=typeof l0=="function"||typeof s0.getSnapshotBeforeUpdate=="function";d0||typeof s0.UNSAFE_componentWillReceiveProps!="function"&&typeof s0.componentWillReceiveProps!="function"||(a0!==r0||c0!==u0)&&Hi$1(e0,s0,r0,u0),jh$1=!1;var h0=e0.memoizedState;s0.state=h0,qh$1(e0,r0,s0,i0),c0=e0.memoizedState,a0!==r0||h0!==c0||Wf$1.current||jh$1?(typeof l0=="function"&&(Di$1(e0,n0,l0,r0),c0=e0.memoizedState),(a0=jh$1||Fi$1(e0,n0,a0,r0,h0,c0,u0))?(d0||typeof s0.UNSAFE_componentWillMount!="function"&&typeof s0.componentWillMount!="function"||(typeof s0.componentWillMount=="function"&&s0.componentWillMount(),typeof s0.UNSAFE_componentWillMount=="function"&&s0.UNSAFE_componentWillMount()),typeof s0.componentDidMount=="function"&&(e0.flags|=4194308)):(typeof s0.componentDidMount=="function"&&(e0.flags|=4194308),e0.memoizedProps=r0,e0.memoizedState=c0),s0.props=r0,s0.state=c0,s0.context=u0,r0=a0):(typeof s0.componentDidMount=="function"&&(e0.flags|=4194308),r0=!1)}else{s0=e0.stateNode,lh$1(t0,e0),a0=e0.memoizedProps,u0=e0.type===e0.elementType?a0:Ci$1(e0.type,a0),s0.props=u0,d0=e0.pendingProps,h0=s0.context,c0=n0.contextType,typeof c0=="object"&&c0!==null?c0=eh$1(c0):(c0=Zf$1(n0)?Xf$1:H$1.current,c0=Yf$1(e0,c0));var p0=n0.getDerivedStateFromProps;(l0=typeof p0=="function"||typeof s0.getSnapshotBeforeUpdate=="function")||typeof s0.UNSAFE_componentWillReceiveProps!="function"&&typeof s0.componentWillReceiveProps!="function"||(a0!==d0||h0!==c0)&&Hi$1(e0,s0,r0,c0),jh$1=!1,h0=e0.memoizedState,s0.state=h0,qh$1(e0,r0,s0,i0);var m0=e0.memoizedState;a0!==d0||h0!==m0||Wf$1.current||jh$1?(typeof p0=="function"&&(Di$1(e0,n0,p0,r0),m0=e0.memoizedState),(u0=jh$1||Fi$1(e0,n0,u0,r0,h0,m0,c0)||!1)?(l0||typeof s0.UNSAFE_componentWillUpdate!="function"&&typeof s0.componentWillUpdate!="function"||(typeof s0.componentWillUpdate=="function"&&s0.componentWillUpdate(r0,m0,c0),typeof s0.UNSAFE_componentWillUpdate=="function"&&s0.UNSAFE_componentWillUpdate(r0,m0,c0)),typeof s0.componentDidUpdate=="function"&&(e0.flags|=4),typeof s0.getSnapshotBeforeUpdate=="function"&&(e0.flags|=1024)):(typeof s0.componentDidUpdate!="function"||a0===t0.memoizedProps&&h0===t0.memoizedState||(e0.flags|=4),typeof s0.getSnapshotBeforeUpdate!="function"||a0===t0.memoizedProps&&h0===t0.memoizedState||(e0.flags|=1024),e0.memoizedProps=r0,e0.memoizedState=m0),s0.props=r0,s0.state=m0,s0.context=c0,r0=u0):(typeof s0.componentDidUpdate!="function"||a0===t0.memoizedProps&&h0===t0.memoizedState||(e0.flags|=4),typeof s0.getSnapshotBeforeUpdate!="function"||a0===t0.memoizedProps&&h0===t0.memoizedState||(e0.flags|=1024),r0=!1)}return jj$1(t0,e0,n0,r0,o0,i0)}function jj$1(t0,e0,n0,r0,i0,o0){gj$1(t0,e0);var s0=(e0.flags&128)!==0;if(!r0&&!s0)return i0&&dg$1(e0,n0,!1),Zi$1(t0,e0,o0);r0=e0.stateNode,Wi$1.current=e0;var a0=s0&&typeof n0.getDerivedStateFromError!="function"?null:r0.render();return e0.flags|=1,t0!==null&&s0?(e0.child=Ug$1(e0,t0.child,null,o0),e0.child=Ug$1(e0,null,a0,o0)):Xi$1(t0,e0,a0,o0),e0.memoizedState=r0.state,i0&&dg$1(e0,n0,!0),e0.child}function kj$1(t0){var e0=t0.stateNode;e0.pendingContext?ag$1(t0,e0.pendingContext,e0.pendingContext!==e0.context):e0.context&&ag$1(t0,e0.context,!1),yh$1(t0,e0.containerInfo)}function lj$1(t0,e0,n0,r0,i0){return Ig$1(),Jg$1(i0),e0.flags|=256,Xi$1(t0,e0,n0,r0),e0.child}var mj$1={dehydrated:null,treeContext:null,retryLane:0};function nj$1(t0){return{baseLanes:t0,cachePool:null,transitions:null}}function oj$1(t0,e0,n0){var r0=e0.pendingProps,i0=L$1.current,o0=!1,s0=(e0.flags&128)!==0,a0;if((a0=s0)||(a0=t0!==null&&t0.memoizedState===null?!1:(i0&2)!==0),a0?(o0=!0,e0.flags&=-129):(t0===null||t0.memoizedState!==null)&&(i0|=1),G$1(L$1,i0&1),t0===null)return Eg$1(e0),t0=e0.memoizedState,t0!==null&&(t0=t0.dehydrated,t0!==null)?(e0.mode&1?t0.data==="$!"?e0.lanes=8:e0.lanes=1073741824:e0.lanes=1,null):(s0=r0.children,t0=r0.fallback,o0?(r0=e0.mode,o0=e0.child,s0={mode:"hidden",children:s0},!(r0&1)&&o0!==null?(o0.childLanes=0,o0.pendingProps=s0):o0=pj$1(s0,r0,0,null),t0=Tg$1(t0,r0,n0,null),o0.return=e0,t0.return=e0,o0.sibling=t0,e0.child=o0,e0.child.memoizedState=nj$1(n0),e0.memoizedState=mj$1,t0):qj$1(e0,s0));if(i0=t0.memoizedState,i0!==null&&(a0=i0.dehydrated,a0!==null))return rj$1(t0,e0,s0,r0,a0,i0,n0);if(o0){o0=r0.fallback,s0=e0.mode,i0=t0.child,a0=i0.sibling;var c0={mode:"hidden",children:r0.children};return!(s0&1)&&e0.child!==i0?(r0=e0.child,r0.childLanes=0,r0.pendingProps=c0,e0.deletions=null):(r0=Pg$1(i0,c0),r0.subtreeFlags=i0.subtreeFlags&14680064),a0!==null?o0=Pg$1(a0,o0):(o0=Tg$1(o0,s0,n0,null),o0.flags|=2),o0.return=e0,r0.return=e0,r0.sibling=o0,e0.child=r0,r0=o0,o0=e0.child,s0=t0.child.memoizedState,s0=s0===null?nj$1(n0):{baseLanes:s0.baseLanes|n0,cachePool:null,transitions:s0.transitions},o0.memoizedState=s0,o0.childLanes=t0.childLanes&~n0,e0.memoizedState=mj$1,r0}return o0=t0.child,t0=o0.sibling,r0=Pg$1(o0,{mode:"visible",children:r0.children}),!(e0.mode&1)&&(r0.lanes=n0),r0.return=e0,r0.sibling=null,t0!==null&&(n0=e0.deletions,n0===null?(e0.deletions=[t0],e0.flags|=16):n0.push(t0)),e0.child=r0,e0.memoizedState=null,r0}function qj$1(t0,e0){return e0=pj$1({mode:"visible",children:e0},t0.mode,0,null),e0.return=t0,t0.child=e0}function sj$1(t0,e0,n0,r0){return r0!==null&&Jg$1(r0),Ug$1(e0,t0.child,null,n0),t0=qj$1(e0,e0.pendingProps.children),t0.flags|=2,e0.memoizedState=null,t0}function rj$1(t0,e0,n0,r0,i0,o0,s0){if(n0)return e0.flags&256?(e0.flags&=-257,r0=Ki$1(Error(p$1(422))),sj$1(t0,e0,s0,r0)):e0.memoizedState!==null?(e0.child=t0.child,e0.flags|=128,null):(o0=r0.fallback,i0=e0.mode,r0=pj$1({mode:"visible",children:r0.children},i0,0,null),o0=Tg$1(o0,i0,s0,null),o0.flags|=2,r0.return=e0,o0.return=e0,r0.sibling=o0,e0.child=r0,e0.mode&1&&Ug$1(e0,t0.child,null,s0),e0.child.memoizedState=nj$1(s0),e0.memoizedState=mj$1,o0);if(!(e0.mode&1))return sj$1(t0,e0,s0,null);if(i0.data==="$!"){if(r0=i0.nextSibling&&i0.nextSibling.dataset,r0)var a0=r0.dgst;return r0=a0,o0=Error(p$1(419)),r0=Ki$1(o0,r0,void 0),sj$1(t0,e0,s0,r0)}if(a0=(s0&t0.childLanes)!==0,dh$1||a0){if(r0=Q$1,r0!==null){switch(s0&-s0){case 4:i0=2;break;case 16:i0=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i0=32;break;case 536870912:i0=268435456;break;default:i0=0}i0=i0&(r0.suspendedLanes|s0)?0:i0,i0!==0&&i0!==o0.retryLane&&(o0.retryLane=i0,ih$1(t0,i0),gi$1(r0,t0,i0,-1))}return tj$1(),r0=Ki$1(Error(p$1(421))),sj$1(t0,e0,s0,r0)}return i0.data==="$?"?(e0.flags|=128,e0.child=t0.child,e0=uj$1.bind(null,t0),i0._reactRetry=e0,null):(t0=o0.treeContext,yg$1=Lf$1(i0.nextSibling),xg$1=e0,I$1=!0,zg$1=null,t0!==null&&(og$1[pg$1++]=rg$1,og$1[pg$1++]=sg$1,og$1[pg$1++]=qg$1,rg$1=t0.id,sg$1=t0.overflow,qg$1=e0),e0=qj$1(e0,r0.children),e0.flags|=4096,e0)}function vj$1(t0,e0,n0){t0.lanes|=e0;var r0=t0.alternate;r0!==null&&(r0.lanes|=e0),bh$1(t0.return,e0,n0)}function wj$1(t0,e0,n0,r0,i0){var o0=t0.memoizedState;o0===null?t0.memoizedState={isBackwards:e0,rendering:null,renderingStartTime:0,last:r0,tail:n0,tailMode:i0}:(o0.isBackwards=e0,o0.rendering=null,o0.renderingStartTime=0,o0.last=r0,o0.tail=n0,o0.tailMode=i0)}function xj$1(t0,e0,n0){var r0=e0.pendingProps,i0=r0.revealOrder,o0=r0.tail;if(Xi$1(t0,e0,r0.children,n0),r0=L$1.current,r0&2)r0=r0&1|2,e0.flags|=128;else{if(t0!==null&&t0.flags&128)t:for(t0=e0.child;t0!==null;){if(t0.tag===13)t0.memoizedState!==null&&vj$1(t0,n0,e0);else if(t0.tag===19)vj$1(t0,n0,e0);else if(t0.child!==null){t0.child.return=t0,t0=t0.child;continue}if(t0===e0)break t;for(;t0.sibling===null;){if(t0.return===null||t0.return===e0)break t;t0=t0.return}t0.sibling.return=t0.return,t0=t0.sibling}r0&=1}if(G$1(L$1,r0),!(e0.mode&1))e0.memoizedState=null;else switch(i0){case"forwards":for(n0=e0.child,i0=null;n0!==null;)t0=n0.alternate,t0!==null&&Ch$1(t0)===null&&(i0=n0),n0=n0.sibling;n0=i0,n0===null?(i0=e0.child,e0.child=null):(i0=n0.sibling,n0.sibling=null),wj$1(e0,!1,i0,n0,o0);break;case"backwards":for(n0=null,i0=e0.child,e0.child=null;i0!==null;){if(t0=i0.alternate,t0!==null&&Ch$1(t0)===null){e0.child=i0;break}t0=i0.sibling,i0.sibling=n0,n0=i0,i0=t0}wj$1(e0,!0,n0,null,o0);break;case"together":wj$1(e0,!1,null,null,void 0);break;default:e0.memoizedState=null}return e0.child}function ij$1(t0,e0){!(e0.mode&1)&&t0!==null&&(t0.alternate=null,e0.alternate=null,e0.flags|=2)}function Zi$1(t0,e0,n0){if(t0!==null&&(e0.dependencies=t0.dependencies),rh$1|=e0.lanes,!(n0&e0.childLanes))return null;if(t0!==null&&e0.child!==t0.child)throw Error(p$1(153));if(e0.child!==null){for(t0=e0.child,n0=Pg$1(t0,t0.pendingProps),e0.child=n0,n0.return=e0;t0.sibling!==null;)t0=t0.sibling,n0=n0.sibling=Pg$1(t0,t0.pendingProps),n0.return=e0;n0.sibling=null}return e0.child}function yj$1(t0,e0,n0){switch(e0.tag){case 3:kj$1(e0),Ig$1();break;case 5:Ah$1(e0);break;case 1:Zf$1(e0.type)&&cg$1(e0);break;case 4:yh$1(e0,e0.stateNode.containerInfo);break;case 10:var r0=e0.type._context,i0=e0.memoizedProps.value;G$1(Wg$1,r0._currentValue),r0._currentValue=i0;break;case 13:if(r0=e0.memoizedState,r0!==null)return r0.dehydrated!==null?(G$1(L$1,L$1.current&1),e0.flags|=128,null):n0&e0.child.childLanes?oj$1(t0,e0,n0):(G$1(L$1,L$1.current&1),t0=Zi$1(t0,e0,n0),t0!==null?t0.sibling:null);G$1(L$1,L$1.current&1);break;case 19:if(r0=(n0&e0.childLanes)!==0,t0.flags&128){if(r0)return xj$1(t0,e0,n0);e0.flags|=128}if(i0=e0.memoizedState,i0!==null&&(i0.rendering=null,i0.tail=null,i0.lastEffect=null),G$1(L$1,L$1.current),r0)break;return null;case 22:case 23:return e0.lanes=0,dj$1(t0,e0,n0)}return Zi$1(t0,e0,n0)}var zj$1,Aj$1,Bj$1,Cj$1;zj$1=function(t0,e0){for(var n0=e0.child;n0!==null;){if(n0.tag===5||n0.tag===6)t0.appendChild(n0.stateNode);else if(n0.tag!==4&&n0.child!==null){n0.child.return=n0,n0=n0.child;continue}if(n0===e0)break;for(;n0.sibling===null;){if(n0.return===null||n0.return===e0)return;n0=n0.return}n0.sibling.return=n0.return,n0=n0.sibling}};Aj$1=function(){};Bj$1=function(t0,e0,n0,r0){var i0=t0.memoizedProps;if(i0!==r0){t0=e0.stateNode,xh$1(uh$1.current);var o0=null;switch(n0){case"input":i0=Ya$1(t0,i0),r0=Ya$1(t0,r0),o0=[];break;case"select":i0=A$1({},i0,{value:void 0}),r0=A$1({},r0,{value:void 0}),o0=[];break;case"textarea":i0=gb$1(t0,i0),r0=gb$1(t0,r0),o0=[];break;default:typeof i0.onClick!="function"&&typeof r0.onClick=="function"&&(t0.onclick=Bf$1)}ub$1(n0,r0);var s0;n0=null;for(u0 in i0)if(!r0.hasOwnProperty(u0)&&i0.hasOwnProperty(u0)&&i0[u0]!=null)if(u0==="style"){var a0=i0[u0];for(s0 in a0)a0.hasOwnProperty(s0)&&(n0||(n0={}),n0[s0]="")}else u0!=="dangerouslySetInnerHTML"&&u0!=="children"&&u0!=="suppressContentEditableWarning"&&u0!=="suppressHydrationWarning"&&u0!=="autoFocus"&&(ea$1.hasOwnProperty(u0)?o0||(o0=[]):(o0=o0||[]).push(u0,null));for(u0 in r0){var c0=r0[u0];if(a0=i0!=null?i0[u0]:void 0,r0.hasOwnProperty(u0)&&c0!==a0&&(c0!=null||a0!=null))if(u0==="style")if(a0){for(s0 in a0)!a0.hasOwnProperty(s0)||c0&&c0.hasOwnProperty(s0)||(n0||(n0={}),n0[s0]="");for(s0 in c0)c0.hasOwnProperty(s0)&&a0[s0]!==c0[s0]&&(n0||(n0={}),n0[s0]=c0[s0])}else n0||(o0||(o0=[]),o0.push(u0,n0)),n0=c0;else u0==="dangerouslySetInnerHTML"?(c0=c0?c0.__html:void 0,a0=a0?a0.__html:void 0,c0!=null&&a0!==c0&&(o0=o0||[]).push(u0,c0)):u0==="children"?typeof c0!="string"&&typeof c0!="number"||(o0=o0||[]).push(u0,""+c0):u0!=="suppressContentEditableWarning"&&u0!=="suppressHydrationWarning"&&(ea$1.hasOwnProperty(u0)?(c0!=null&&u0==="onScroll"&&D$1("scroll",t0),o0||a0===c0||(o0=[])):(o0=o0||[]).push(u0,c0))}n0&&(o0=o0||[]).push("style",n0);var u0=o0;(e0.updateQueue=u0)&&(e0.flags|=4)}};Cj$1=function(t0,e0,n0,r0){n0!==r0&&(e0.flags|=4)};function Dj$1(t0,e0){if(!I$1)switch(t0.tailMode){case"hidden":e0=t0.tail;for(var n0=null;e0!==null;)e0.alternate!==null&&(n0=e0),e0=e0.sibling;n0===null?t0.tail=null:n0.sibling=null;break;case"collapsed":n0=t0.tail;for(var r0=null;n0!==null;)n0.alternate!==null&&(r0=n0),n0=n0.sibling;r0===null?e0||t0.tail===null?t0.tail=null:t0.tail.sibling=null:r0.sibling=null}}function S$1(t0){var e0=t0.alternate!==null&&t0.alternate.child===t0.child,n0=0,r0=0;if(e0)for(var i0=t0.child;i0!==null;)n0|=i0.lanes|i0.childLanes,r0|=i0.subtreeFlags&14680064,r0|=i0.flags&14680064,i0.return=t0,i0=i0.sibling;else for(i0=t0.child;i0!==null;)n0|=i0.lanes|i0.childLanes,r0|=i0.subtreeFlags,r0|=i0.flags,i0.return=t0,i0=i0.sibling;return t0.subtreeFlags|=r0,t0.childLanes=n0,e0}function Ej$1(t0,e0,n0){var r0=e0.pendingProps;switch(wg$1(e0),e0.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$1(e0),null;case 1:return Zf$1(e0.type)&&$f$1(),S$1(e0),null;case 3:return r0=e0.stateNode,zh$1(),E$1(Wf$1),E$1(H$1),Eh$1(),r0.pendingContext&&(r0.context=r0.pendingContext,r0.pendingContext=null),(t0===null||t0.child===null)&&(Gg$1(e0)?e0.flags|=4:t0===null||t0.memoizedState.isDehydrated&&!(e0.flags&256)||(e0.flags|=1024,zg$1!==null&&(Fj$1(zg$1),zg$1=null))),Aj$1(t0,e0),S$1(e0),null;case 5:Bh$1(e0);var i0=xh$1(wh$1.current);if(n0=e0.type,t0!==null&&e0.stateNode!=null)Bj$1(t0,e0,n0,r0,i0),t0.ref!==e0.ref&&(e0.flags|=512,e0.flags|=2097152);else{if(!r0){if(e0.stateNode===null)throw Error(p$1(166));return S$1(e0),null}if(t0=xh$1(uh$1.current),Gg$1(e0)){r0=e0.stateNode,n0=e0.type;var o0=e0.memoizedProps;switch(r0[Of$1]=e0,r0[Pf$1]=o0,t0=(e0.mode&1)!==0,n0){case"dialog":D$1("cancel",r0),D$1("close",r0);break;case"iframe":case"object":case"embed":D$1("load",r0);break;case"video":case"audio":for(i0=0;i0<lf$1.length;i0++)D$1(lf$1[i0],r0);break;case"source":D$1("error",r0);break;case"img":case"image":case"link":D$1("error",r0),D$1("load",r0);break;case"details":D$1("toggle",r0);break;case"input":Za$1(r0,o0),D$1("invalid",r0);break;case"select":r0._wrapperState={wasMultiple:!!o0.multiple},D$1("invalid",r0);break;case"textarea":hb$1(r0,o0),D$1("invalid",r0)}ub$1(n0,o0),i0=null;for(var s0 in o0)if(o0.hasOwnProperty(s0)){var a0=o0[s0];s0==="children"?typeof a0=="string"?r0.textContent!==a0&&(o0.suppressHydrationWarning!==!0&&Af$1(r0.textContent,a0,t0),i0=["children",a0]):typeof a0=="number"&&r0.textContent!==""+a0&&(o0.suppressHydrationWarning!==!0&&Af$1(r0.textContent,a0,t0),i0=["children",""+a0]):ea$1.hasOwnProperty(s0)&&a0!=null&&s0==="onScroll"&&D$1("scroll",r0)}switch(n0){case"input":Va$1(r0),db$1(r0,o0,!0);break;case"textarea":Va$1(r0),jb$1(r0);break;case"select":case"option":break;default:typeof o0.onClick=="function"&&(r0.onclick=Bf$1)}r0=i0,e0.updateQueue=r0,r0!==null&&(e0.flags|=4)}else{s0=i0.nodeType===9?i0:i0.ownerDocument,t0==="http://www.w3.org/1999/xhtml"&&(t0=kb$1(n0)),t0==="http://www.w3.org/1999/xhtml"?n0==="script"?(t0=s0.createElement("div"),t0.innerHTML="<script><\/script>",t0=t0.removeChild(t0.firstChild)):typeof r0.is=="string"?t0=s0.createElement(n0,{is:r0.is}):(t0=s0.createElement(n0),n0==="select"&&(s0=t0,r0.multiple?s0.multiple=!0:r0.size&&(s0.size=r0.size))):t0=s0.createElementNS(t0,n0),t0[Of$1]=e0,t0[Pf$1]=r0,zj$1(t0,e0,!1,!1),e0.stateNode=t0;t:{switch(s0=vb$1(n0,r0),n0){case"dialog":D$1("cancel",t0),D$1("close",t0),i0=r0;break;case"iframe":case"object":case"embed":D$1("load",t0),i0=r0;break;case"video":case"audio":for(i0=0;i0<lf$1.length;i0++)D$1(lf$1[i0],t0);i0=r0;break;case"source":D$1("error",t0),i0=r0;break;case"img":case"image":case"link":D$1("error",t0),D$1("load",t0),i0=r0;break;case"details":D$1("toggle",t0),i0=r0;break;case"input":Za$1(t0,r0),i0=Ya$1(t0,r0),D$1("invalid",t0);break;case"option":i0=r0;break;case"select":t0._wrapperState={wasMultiple:!!r0.multiple},i0=A$1({},r0,{value:void 0}),D$1("invalid",t0);break;case"textarea":hb$1(t0,r0),i0=gb$1(t0,r0),D$1("invalid",t0);break;default:i0=r0}ub$1(n0,i0),a0=i0;for(o0 in a0)if(a0.hasOwnProperty(o0)){var c0=a0[o0];o0==="style"?sb$1(t0,c0):o0==="dangerouslySetInnerHTML"?(c0=c0?c0.__html:void 0,c0!=null&&nb$1(t0,c0)):o0==="children"?typeof c0=="string"?(n0!=="textarea"||c0!=="")&&ob$1(t0,c0):typeof c0=="number"&&ob$1(t0,""+c0):o0!=="suppressContentEditableWarning"&&o0!=="suppressHydrationWarning"&&o0!=="autoFocus"&&(ea$1.hasOwnProperty(o0)?c0!=null&&o0==="onScroll"&&D$1("scroll",t0):c0!=null&&ta$1(t0,o0,c0,s0))}switch(n0){case"input":Va$1(t0),db$1(t0,r0,!1);break;case"textarea":Va$1(t0),jb$1(t0);break;case"option":r0.value!=null&&t0.setAttribute("value",""+Sa$1(r0.value));break;case"select":t0.multiple=!!r0.multiple,o0=r0.value,o0!=null?fb$1(t0,!!r0.multiple,o0,!1):r0.defaultValue!=null&&fb$1(t0,!!r0.multiple,r0.defaultValue,!0);break;default:typeof i0.onClick=="function"&&(t0.onclick=Bf$1)}switch(n0){case"button":case"input":case"select":case"textarea":r0=!!r0.autoFocus;break t;case"img":r0=!0;break t;default:r0=!1}}r0&&(e0.flags|=4)}e0.ref!==null&&(e0.flags|=512,e0.flags|=2097152)}return S$1(e0),null;case 6:if(t0&&e0.stateNode!=null)Cj$1(t0,e0,t0.memoizedProps,r0);else{if(typeof r0!="string"&&e0.stateNode===null)throw Error(p$1(166));if(n0=xh$1(wh$1.current),xh$1(uh$1.current),Gg$1(e0)){if(r0=e0.stateNode,n0=e0.memoizedProps,r0[Of$1]=e0,(o0=r0.nodeValue!==n0)&&(t0=xg$1,t0!==null))switch(t0.tag){case 3:Af$1(r0.nodeValue,n0,(t0.mode&1)!==0);break;case 5:t0.memoizedProps.suppressHydrationWarning!==!0&&Af$1(r0.nodeValue,n0,(t0.mode&1)!==0)}o0&&(e0.flags|=4)}else r0=(n0.nodeType===9?n0:n0.ownerDocument).createTextNode(r0),r0[Of$1]=e0,e0.stateNode=r0}return S$1(e0),null;case 13:if(E$1(L$1),r0=e0.memoizedState,t0===null||t0.memoizedState!==null&&t0.memoizedState.dehydrated!==null){if(I$1&&yg$1!==null&&e0.mode&1&&!(e0.flags&128))Hg$1(),Ig$1(),e0.flags|=98560,o0=!1;else if(o0=Gg$1(e0),r0!==null&&r0.dehydrated!==null){if(t0===null){if(!o0)throw Error(p$1(318));if(o0=e0.memoizedState,o0=o0!==null?o0.dehydrated:null,!o0)throw Error(p$1(317));o0[Of$1]=e0}else Ig$1(),!(e0.flags&128)&&(e0.memoizedState=null),e0.flags|=4;S$1(e0),o0=!1}else zg$1!==null&&(Fj$1(zg$1),zg$1=null),o0=!0;if(!o0)return e0.flags&65536?e0:null}return e0.flags&128?(e0.lanes=n0,e0):(r0=r0!==null,r0!==(t0!==null&&t0.memoizedState!==null)&&r0&&(e0.child.flags|=8192,e0.mode&1&&(t0===null||L$1.current&1?T$1===0&&(T$1=3):tj$1())),e0.updateQueue!==null&&(e0.flags|=4),S$1(e0),null);case 4:return zh$1(),Aj$1(t0,e0),t0===null&&sf$1(e0.stateNode.containerInfo),S$1(e0),null;case 10:return ah$1(e0.type._context),S$1(e0),null;case 17:return Zf$1(e0.type)&&$f$1(),S$1(e0),null;case 19:if(E$1(L$1),o0=e0.memoizedState,o0===null)return S$1(e0),null;if(r0=(e0.flags&128)!==0,s0=o0.rendering,s0===null)if(r0)Dj$1(o0,!1);else{if(T$1!==0||t0!==null&&t0.flags&128)for(t0=e0.child;t0!==null;){if(s0=Ch$1(t0),s0!==null){for(e0.flags|=128,Dj$1(o0,!1),r0=s0.updateQueue,r0!==null&&(e0.updateQueue=r0,e0.flags|=4),e0.subtreeFlags=0,r0=n0,n0=e0.child;n0!==null;)o0=n0,t0=r0,o0.flags&=14680066,s0=o0.alternate,s0===null?(o0.childLanes=0,o0.lanes=t0,o0.child=null,o0.subtreeFlags=0,o0.memoizedProps=null,o0.memoizedState=null,o0.updateQueue=null,o0.dependencies=null,o0.stateNode=null):(o0.childLanes=s0.childLanes,o0.lanes=s0.lanes,o0.child=s0.child,o0.subtreeFlags=0,o0.deletions=null,o0.memoizedProps=s0.memoizedProps,o0.memoizedState=s0.memoizedState,o0.updateQueue=s0.updateQueue,o0.type=s0.type,t0=s0.dependencies,o0.dependencies=t0===null?null:{lanes:t0.lanes,firstContext:t0.firstContext}),n0=n0.sibling;return G$1(L$1,L$1.current&1|2),e0.child}t0=t0.sibling}o0.tail!==null&&B$1()>Gj$1&&(e0.flags|=128,r0=!0,Dj$1(o0,!1),e0.lanes=4194304)}else{if(!r0)if(t0=Ch$1(s0),t0!==null){if(e0.flags|=128,r0=!0,n0=t0.updateQueue,n0!==null&&(e0.updateQueue=n0,e0.flags|=4),Dj$1(o0,!0),o0.tail===null&&o0.tailMode==="hidden"&&!s0.alternate&&!I$1)return S$1(e0),null}else 2*B$1()-o0.renderingStartTime>Gj$1&&n0!==1073741824&&(e0.flags|=128,r0=!0,Dj$1(o0,!1),e0.lanes=4194304);o0.isBackwards?(s0.sibling=e0.child,e0.child=s0):(n0=o0.last,n0!==null?n0.sibling=s0:e0.child=s0,o0.last=s0)}return o0.tail!==null?(e0=o0.tail,o0.rendering=e0,o0.tail=e0.sibling,o0.renderingStartTime=B$1(),e0.sibling=null,n0=L$1.current,G$1(L$1,r0?n0&1|2:n0&1),e0):(S$1(e0),null);case 22:case 23:return Hj$1(),r0=e0.memoizedState!==null,t0!==null&&t0.memoizedState!==null!==r0&&(e0.flags|=8192),r0&&e0.mode&1?fj$1&1073741824&&(S$1(e0),e0.subtreeFlags&6&&(e0.flags|=8192)):S$1(e0),null;case 24:return null;case 25:return null}throw Error(p$1(156,e0.tag))}function Ij$1(t0,e0){switch(wg$1(e0),e0.tag){case 1:return Zf$1(e0.type)&&$f$1(),t0=e0.flags,t0&65536?(e0.flags=t0&-65537|128,e0):null;case 3:return zh$1(),E$1(Wf$1),E$1(H$1),Eh$1(),t0=e0.flags,t0&65536&&!(t0&128)?(e0.flags=t0&-65537|128,e0):null;case 5:return Bh$1(e0),null;case 13:if(E$1(L$1),t0=e0.memoizedState,t0!==null&&t0.dehydrated!==null){if(e0.alternate===null)throw Error(p$1(340));Ig$1()}return t0=e0.flags,t0&65536?(e0.flags=t0&-65537|128,e0):null;case 19:return E$1(L$1),null;case 4:return zh$1(),null;case 10:return ah$1(e0.type._context),null;case 22:case 23:return Hj$1(),null;case 24:return null;default:return null}}var Jj$1=!1,U$1=!1,Kj$1=typeof WeakSet=="function"?WeakSet:Set,V$1=null;function Lj$1(t0,e0){var n0=t0.ref;if(n0!==null)if(typeof n0=="function")try{n0(null)}catch(r0){W$1(t0,e0,r0)}else n0.current=null}function Mj$1(t0,e0,n0){try{n0()}catch(r0){W$1(t0,e0,r0)}}var Nj$1=!1;function Oj$1(t0,e0){if(Cf$1=dd$1,t0=Me$1(),Ne$1(t0)){if("selectionStart"in t0)var n0={start:t0.selectionStart,end:t0.selectionEnd};else t:{n0=(n0=t0.ownerDocument)&&n0.defaultView||window;var r0=n0.getSelection&&n0.getSelection();if(r0&&r0.rangeCount!==0){n0=r0.anchorNode;var i0=r0.anchorOffset,o0=r0.focusNode;r0=r0.focusOffset;try{n0.nodeType,o0.nodeType}catch{n0=null;break t}var s0=0,a0=-1,c0=-1,u0=0,l0=0,d0=t0,h0=null;e:for(;;){for(var p0;d0!==n0||i0!==0&&d0.nodeType!==3||(a0=s0+i0),d0!==o0||r0!==0&&d0.nodeType!==3||(c0=s0+r0),d0.nodeType===3&&(s0+=d0.nodeValue.length),(p0=d0.firstChild)!==null;)h0=d0,d0=p0;for(;;){if(d0===t0)break e;if(h0===n0&&++u0===i0&&(a0=s0),h0===o0&&++l0===r0&&(c0=s0),(p0=d0.nextSibling)!==null)break;d0=h0,h0=d0.parentNode}d0=p0}n0=a0===-1||c0===-1?null:{start:a0,end:c0}}else n0=null}n0=n0||{start:0,end:0}}else n0=null;for(Df$1={focusedElem:t0,selectionRange:n0},dd$1=!1,V$1=e0;V$1!==null;)if(e0=V$1,t0=e0.child,(e0.subtreeFlags&1028)!==0&&t0!==null)t0.return=e0,V$1=t0;else for(;V$1!==null;){e0=V$1;try{var m0=e0.alternate;if(e0.flags&1024)switch(e0.tag){case 0:case 11:case 15:break;case 1:if(m0!==null){var f0=m0.memoizedProps,g0=m0.memoizedState,E0=e0.stateNode,_0=E0.getSnapshotBeforeUpdate(e0.elementType===e0.type?f0:Ci$1(e0.type,f0),g0);E0.__reactInternalSnapshotBeforeUpdate=_0}break;case 3:var y0=e0.stateNode.containerInfo;y0.nodeType===1?y0.textContent="":y0.nodeType===9&&y0.documentElement&&y0.removeChild(y0.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$1(163))}}catch(b0){W$1(e0,e0.return,b0)}if(t0=e0.sibling,t0!==null){t0.return=e0.return,V$1=t0;break}V$1=e0.return}return m0=Nj$1,Nj$1=!1,m0}function Pj$1(t0,e0,n0){var r0=e0.updateQueue;if(r0=r0!==null?r0.lastEffect:null,r0!==null){var i0=r0=r0.next;do{if((i0.tag&t0)===t0){var o0=i0.destroy;i0.destroy=void 0,o0!==void 0&&Mj$1(e0,n0,o0)}i0=i0.next}while(i0!==r0)}}function Qj$1(t0,e0){if(e0=e0.updateQueue,e0=e0!==null?e0.lastEffect:null,e0!==null){var n0=e0=e0.next;do{if((n0.tag&t0)===t0){var r0=n0.create;n0.destroy=r0()}n0=n0.next}while(n0!==e0)}}function Rj$1(t0){var e0=t0.ref;if(e0!==null){var n0=t0.stateNode;switch(t0.tag){case 5:t0=n0;break;default:t0=n0}typeof e0=="function"?e0(t0):e0.current=t0}}function Sj$1(t0){var e0=t0.alternate;e0!==null&&(t0.alternate=null,Sj$1(e0)),t0.child=null,t0.deletions=null,t0.sibling=null,t0.tag===5&&(e0=t0.stateNode,e0!==null&&(delete e0[Of$1],delete e0[Pf$1],delete e0[of$1],delete e0[Qf$1],delete e0[Rf$1])),t0.stateNode=null,t0.return=null,t0.dependencies=null,t0.memoizedProps=null,t0.memoizedState=null,t0.pendingProps=null,t0.stateNode=null,t0.updateQueue=null}function Tj$1(t0){return t0.tag===5||t0.tag===3||t0.tag===4}function Uj$1(t0){t:for(;;){for(;t0.sibling===null;){if(t0.return===null||Tj$1(t0.return))return null;t0=t0.return}for(t0.sibling.return=t0.return,t0=t0.sibling;t0.tag!==5&&t0.tag!==6&&t0.tag!==18;){if(t0.flags&2||t0.child===null||t0.tag===4)continue t;t0.child.return=t0,t0=t0.child}if(!(t0.flags&2))return t0.stateNode}}function Vj$1(t0,e0,n0){var r0=t0.tag;if(r0===5||r0===6)t0=t0.stateNode,e0?n0.nodeType===8?n0.parentNode.insertBefore(t0,e0):n0.insertBefore(t0,e0):(n0.nodeType===8?(e0=n0.parentNode,e0.insertBefore(t0,n0)):(e0=n0,e0.appendChild(t0)),n0=n0._reactRootContainer,n0!=null||e0.onclick!==null||(e0.onclick=Bf$1));else if(r0!==4&&(t0=t0.child,t0!==null))for(Vj$1(t0,e0,n0),t0=t0.sibling;t0!==null;)Vj$1(t0,e0,n0),t0=t0.sibling}function Wj$1(t0,e0,n0){var r0=t0.tag;if(r0===5||r0===6)t0=t0.stateNode,e0?n0.insertBefore(t0,e0):n0.appendChild(t0);else if(r0!==4&&(t0=t0.child,t0!==null))for(Wj$1(t0,e0,n0),t0=t0.sibling;t0!==null;)Wj$1(t0,e0,n0),t0=t0.sibling}var X$1=null,Xj$1=!1;function Yj$1(t0,e0,n0){for(n0=n0.child;n0!==null;)Zj$1(t0,e0,n0),n0=n0.sibling}function Zj$1(t0,e0,n0){if(lc$1&&typeof lc$1.onCommitFiberUnmount=="function")try{lc$1.onCommitFiberUnmount(kc$1,n0)}catch{}switch(n0.tag){case 5:U$1||Lj$1(n0,e0);case 6:var r0=X$1,i0=Xj$1;X$1=null,Yj$1(t0,e0,n0),X$1=r0,Xj$1=i0,X$1!==null&&(Xj$1?(t0=X$1,n0=n0.stateNode,t0.nodeType===8?t0.parentNode.removeChild(n0):t0.removeChild(n0)):X$1.removeChild(n0.stateNode));break;case 18:X$1!==null&&(Xj$1?(t0=X$1,n0=n0.stateNode,t0.nodeType===8?Kf$1(t0.parentNode,n0):t0.nodeType===1&&Kf$1(t0,n0),bd$1(t0)):Kf$1(X$1,n0.stateNode));break;case 4:r0=X$1,i0=Xj$1,X$1=n0.stateNode.containerInfo,Xj$1=!0,Yj$1(t0,e0,n0),X$1=r0,Xj$1=i0;break;case 0:case 11:case 14:case 15:if(!U$1&&(r0=n0.updateQueue,r0!==null&&(r0=r0.lastEffect,r0!==null))){i0=r0=r0.next;do{var o0=i0,s0=o0.destroy;o0=o0.tag,s0!==void 0&&(o0&2||o0&4)&&Mj$1(n0,e0,s0),i0=i0.next}while(i0!==r0)}Yj$1(t0,e0,n0);break;case 1:if(!U$1&&(Lj$1(n0,e0),r0=n0.stateNode,typeof r0.componentWillUnmount=="function"))try{r0.props=n0.memoizedProps,r0.state=n0.memoizedState,r0.componentWillUnmount()}catch(a0){W$1(n0,e0,a0)}Yj$1(t0,e0,n0);break;case 21:Yj$1(t0,e0,n0);break;case 22:n0.mode&1?(U$1=(r0=U$1)||n0.memoizedState!==null,Yj$1(t0,e0,n0),U$1=r0):Yj$1(t0,e0,n0);break;default:Yj$1(t0,e0,n0)}}function ak$1(t0){var e0=t0.updateQueue;if(e0!==null){t0.updateQueue=null;var n0=t0.stateNode;n0===null&&(n0=t0.stateNode=new Kj$1),e0.forEach(function(r0){var i0=bk$1.bind(null,t0,r0);n0.has(r0)||(n0.add(r0),r0.then(i0,i0))})}}function ck$1(t0,e0){var n0=e0.deletions;if(n0!==null)for(var r0=0;r0<n0.length;r0++){var i0=n0[r0];try{var o0=t0,s0=e0,a0=s0;t:for(;a0!==null;){switch(a0.tag){case 5:X$1=a0.stateNode,Xj$1=!1;break t;case 3:X$1=a0.stateNode.containerInfo,Xj$1=!0;break t;case 4:X$1=a0.stateNode.containerInfo,Xj$1=!0;break t}a0=a0.return}if(X$1===null)throw Error(p$1(160));Zj$1(o0,s0,i0),X$1=null,Xj$1=!1;var c0=i0.alternate;c0!==null&&(c0.return=null),i0.return=null}catch(u0){W$1(i0,e0,u0)}}if(e0.subtreeFlags&12854)for(e0=e0.child;e0!==null;)dk$1(e0,t0),e0=e0.sibling}function dk$1(t0,e0){var n0=t0.alternate,r0=t0.flags;switch(t0.tag){case 0:case 11:case 14:case 15:if(ck$1(e0,t0),ek$1(t0),r0&4){try{Pj$1(3,t0,t0.return),Qj$1(3,t0)}catch(f0){W$1(t0,t0.return,f0)}try{Pj$1(5,t0,t0.return)}catch(f0){W$1(t0,t0.return,f0)}}break;case 1:ck$1(e0,t0),ek$1(t0),r0&512&&n0!==null&&Lj$1(n0,n0.return);break;case 5:if(ck$1(e0,t0),ek$1(t0),r0&512&&n0!==null&&Lj$1(n0,n0.return),t0.flags&32){var i0=t0.stateNode;try{ob$1(i0,"")}catch(f0){W$1(t0,t0.return,f0)}}if(r0&4&&(i0=t0.stateNode,i0!=null)){var o0=t0.memoizedProps,s0=n0!==null?n0.memoizedProps:o0,a0=t0.type,c0=t0.updateQueue;if(t0.updateQueue=null,c0!==null)try{a0==="input"&&o0.type==="radio"&&o0.name!=null&&ab$1(i0,o0),vb$1(a0,s0);var u0=vb$1(a0,o0);for(s0=0;s0<c0.length;s0+=2){var l0=c0[s0],d0=c0[s0+1];l0==="style"?sb$1(i0,d0):l0==="dangerouslySetInnerHTML"?nb$1(i0,d0):l0==="children"?ob$1(i0,d0):ta$1(i0,l0,d0,u0)}switch(a0){case"input":bb$1(i0,o0);break;case"textarea":ib$1(i0,o0);break;case"select":var h0=i0._wrapperState.wasMultiple;i0._wrapperState.wasMultiple=!!o0.multiple;var p0=o0.value;p0!=null?fb$1(i0,!!o0.multiple,p0,!1):h0!==!!o0.multiple&&(o0.defaultValue!=null?fb$1(i0,!!o0.multiple,o0.defaultValue,!0):fb$1(i0,!!o0.multiple,o0.multiple?[]:"",!1))}i0[Pf$1]=o0}catch(f0){W$1(t0,t0.return,f0)}}break;case 6:if(ck$1(e0,t0),ek$1(t0),r0&4){if(t0.stateNode===null)throw Error(p$1(162));i0=t0.stateNode,o0=t0.memoizedProps;try{i0.nodeValue=o0}catch(f0){W$1(t0,t0.return,f0)}}break;case 3:if(ck$1(e0,t0),ek$1(t0),r0&4&&n0!==null&&n0.memoizedState.isDehydrated)try{bd$1(e0.containerInfo)}catch(f0){W$1(t0,t0.return,f0)}break;case 4:ck$1(e0,t0),ek$1(t0);break;case 13:ck$1(e0,t0),ek$1(t0),i0=t0.child,i0.flags&8192&&(o0=i0.memoizedState!==null,i0.stateNode.isHidden=o0,!o0||i0.alternate!==null&&i0.alternate.memoizedState!==null||(fk$1=B$1())),r0&4&&ak$1(t0);break;case 22:if(l0=n0!==null&&n0.memoizedState!==null,t0.mode&1?(U$1=(u0=U$1)||l0,ck$1(e0,t0),U$1=u0):ck$1(e0,t0),ek$1(t0),r0&8192){if(u0=t0.memoizedState!==null,(t0.stateNode.isHidden=u0)&&!l0&&t0.mode&1)for(V$1=t0,l0=t0.child;l0!==null;){for(d0=V$1=l0;V$1!==null;){switch(h0=V$1,p0=h0.child,h0.tag){case 0:case 11:case 14:case 15:Pj$1(4,h0,h0.return);break;case 1:Lj$1(h0,h0.return);var m0=h0.stateNode;if(typeof m0.componentWillUnmount=="function"){r0=h0,n0=h0.return;try{e0=r0,m0.props=e0.memoizedProps,m0.state=e0.memoizedState,m0.componentWillUnmount()}catch(f0){W$1(r0,n0,f0)}}break;case 5:Lj$1(h0,h0.return);break;case 22:if(h0.memoizedState!==null){gk$1(d0);continue}}p0!==null?(p0.return=h0,V$1=p0):gk$1(d0)}l0=l0.sibling}t:for(l0=null,d0=t0;;){if(d0.tag===5){if(l0===null){l0=d0;try{i0=d0.stateNode,u0?(o0=i0.style,typeof o0.setProperty=="function"?o0.setProperty("display","none","important"):o0.display="none"):(a0=d0.stateNode,c0=d0.memoizedProps.style,s0=c0!=null&&c0.hasOwnProperty("display")?c0.display:null,a0.style.display=rb$1("display",s0))}catch(f0){W$1(t0,t0.return,f0)}}}else if(d0.tag===6){if(l0===null)try{d0.stateNode.nodeValue=u0?"":d0.memoizedProps}catch(f0){W$1(t0,t0.return,f0)}}else if((d0.tag!==22&&d0.tag!==23||d0.memoizedState===null||d0===t0)&&d0.child!==null){d0.child.return=d0,d0=d0.child;continue}if(d0===t0)break t;for(;d0.sibling===null;){if(d0.return===null||d0.return===t0)break t;l0===d0&&(l0=null),d0=d0.return}l0===d0&&(l0=null),d0.sibling.return=d0.return,d0=d0.sibling}}break;case 19:ck$1(e0,t0),ek$1(t0),r0&4&&ak$1(t0);break;case 21:break;default:ck$1(e0,t0),ek$1(t0)}}function ek$1(t0){var e0=t0.flags;if(e0&2){try{t:{for(var n0=t0.return;n0!==null;){if(Tj$1(n0)){var r0=n0;break t}n0=n0.return}throw Error(p$1(160))}switch(r0.tag){case 5:var i0=r0.stateNode;r0.flags&32&&(ob$1(i0,""),r0.flags&=-33);var o0=Uj$1(t0);Wj$1(t0,o0,i0);break;case 3:case 4:var s0=r0.stateNode.containerInfo,a0=Uj$1(t0);Vj$1(t0,a0,s0);break;default:throw Error(p$1(161))}}catch(c0){W$1(t0,t0.return,c0)}t0.flags&=-3}e0&4096&&(t0.flags&=-4097)}function hk$1(t0,e0,n0){V$1=t0,ik$1(t0,e0,n0)}function ik$1(t0,e0,n0){for(var r0=(t0.mode&1)!==0;V$1!==null;){var i0=V$1,o0=i0.child;if(i0.tag===22&&r0){var s0=i0.memoizedState!==null||Jj$1;if(!s0){var a0=i0.alternate,c0=a0!==null&&a0.memoizedState!==null||U$1;a0=Jj$1;var u0=U$1;if(Jj$1=s0,(U$1=c0)&&!u0)for(V$1=i0;V$1!==null;)s0=V$1,c0=s0.child,s0.tag===22&&s0.memoizedState!==null?jk$1(i0):c0!==null?(c0.return=s0,V$1=c0):jk$1(i0);for(;o0!==null;)V$1=o0,ik$1(o0,e0,n0),o0=o0.sibling;V$1=i0,Jj$1=a0,U$1=u0}kk$1(t0,e0,n0)}else i0.subtreeFlags&8772&&o0!==null?(o0.return=i0,V$1=o0):kk$1(t0,e0,n0)}}function kk$1(t0){for(;V$1!==null;){var e0=V$1;if(e0.flags&8772){var n0=e0.alternate;try{if(e0.flags&8772)switch(e0.tag){case 0:case 11:case 15:U$1||Qj$1(5,e0);break;case 1:var r0=e0.stateNode;if(e0.flags&4&&!U$1)if(n0===null)r0.componentDidMount();else{var i0=e0.elementType===e0.type?n0.memoizedProps:Ci$1(e0.type,n0.memoizedProps);r0.componentDidUpdate(i0,n0.memoizedState,r0.__reactInternalSnapshotBeforeUpdate)}var o0=e0.updateQueue;o0!==null&&sh$1(e0,o0,r0);break;case 3:var s0=e0.updateQueue;if(s0!==null){if(n0=null,e0.child!==null)switch(e0.child.tag){case 5:n0=e0.child.stateNode;break;case 1:n0=e0.child.stateNode}sh$1(e0,s0,n0)}break;case 5:var a0=e0.stateNode;if(n0===null&&e0.flags&4){n0=a0;var c0=e0.memoizedProps;switch(e0.type){case"button":case"input":case"select":case"textarea":c0.autoFocus&&n0.focus();break;case"img":c0.src&&(n0.src=c0.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e0.memoizedState===null){var u0=e0.alternate;if(u0!==null){var l0=u0.memoizedState;if(l0!==null){var d0=l0.dehydrated;d0!==null&&bd$1(d0)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$1(163))}U$1||e0.flags&512&&Rj$1(e0)}catch(h0){W$1(e0,e0.return,h0)}}if(e0===t0){V$1=null;break}if(n0=e0.sibling,n0!==null){n0.return=e0.return,V$1=n0;break}V$1=e0.return}}function gk$1(t0){for(;V$1!==null;){var e0=V$1;if(e0===t0){V$1=null;break}var n0=e0.sibling;if(n0!==null){n0.return=e0.return,V$1=n0;break}V$1=e0.return}}function jk$1(t0){for(;V$1!==null;){var e0=V$1;try{switch(e0.tag){case 0:case 11:case 15:var n0=e0.return;try{Qj$1(4,e0)}catch(c0){W$1(e0,n0,c0)}break;case 1:var r0=e0.stateNode;if(typeof r0.componentDidMount=="function"){var i0=e0.return;try{r0.componentDidMount()}catch(c0){W$1(e0,i0,c0)}}var o0=e0.return;try{Rj$1(e0)}catch(c0){W$1(e0,o0,c0)}break;case 5:var s0=e0.return;try{Rj$1(e0)}catch(c0){W$1(e0,s0,c0)}}}catch(c0){W$1(e0,e0.return,c0)}if(e0===t0){V$1=null;break}var a0=e0.sibling;if(a0!==null){a0.return=e0.return,V$1=a0;break}V$1=e0.return}}var lk$1=Math.ceil,mk$1=ua$1.ReactCurrentDispatcher,nk$1=ua$1.ReactCurrentOwner,ok$1=ua$1.ReactCurrentBatchConfig,K$1=0,Q$1=null,Y$1=null,Z$1=0,fj$1=0,ej$1=Uf$1(0),T$1=0,pk$1=null,rh$1=0,qk$1=0,rk$1=0,sk$1=null,tk$1=null,fk$1=0,Gj$1=1/0,uk$1=null,Oi$1=!1,Pi$1=null,Ri$1=null,vk$1=!1,wk$1=null,xk$1=0,yk$1=0,zk$1=null,Ak$1=-1,Bk$1=0;function R$1(){return K$1&6?B$1():Ak$1!==-1?Ak$1:Ak$1=B$1()}function yi$1(t0){return t0.mode&1?K$1&2&&Z$1!==0?Z$1&-Z$1:Kg$1.transition!==null?(Bk$1===0&&(Bk$1=yc$1()),Bk$1):(t0=C$1,t0!==0||(t0=window.event,t0=t0===void 0?16:jd$1(t0.type)),t0):1}function gi$1(t0,e0,n0,r0){if(50<yk$1)throw yk$1=0,zk$1=null,Error(p$1(185));Ac$1(t0,n0,r0),(!(K$1&2)||t0!==Q$1)&&(t0===Q$1&&(!(K$1&2)&&(qk$1|=n0),T$1===4&&Ck$1(t0,Z$1)),Dk$1(t0,r0),n0===1&&K$1===0&&!(e0.mode&1)&&(Gj$1=B$1()+500,fg$1&&jg$1()))}function Dk$1(t0,e0){var n0=t0.callbackNode;wc$1(t0,e0);var r0=uc$1(t0,t0===Q$1?Z$1:0);if(r0===0)n0!==null&&bc$1(n0),t0.callbackNode=null,t0.callbackPriority=0;else if(e0=r0&-r0,t0.callbackPriority!==e0){if(n0!=null&&bc$1(n0),e0===1)t0.tag===0?ig$1(Ek$1.bind(null,t0)):hg$1(Ek$1.bind(null,t0)),Jf$1(function(){!(K$1&6)&&jg$1()}),n0=null;else{switch(Dc$1(r0)){case 1:n0=fc$1;break;case 4:n0=gc$1;break;case 16:n0=hc$1;break;case 536870912:n0=jc$1;break;default:n0=hc$1}n0=Fk$1(n0,Gk$1.bind(null,t0))}t0.callbackPriority=e0,t0.callbackNode=n0}}function Gk$1(t0,e0){if(Ak$1=-1,Bk$1=0,K$1&6)throw Error(p$1(327));var n0=t0.callbackNode;if(Hk$1()&&t0.callbackNode!==n0)return null;var r0=uc$1(t0,t0===Q$1?Z$1:0);if(r0===0)return null;if(r0&30||r0&t0.expiredLanes||e0)e0=Ik$1(t0,r0);else{e0=r0;var i0=K$1;K$1|=2;var o0=Jk$1();(Q$1!==t0||Z$1!==e0)&&(uk$1=null,Gj$1=B$1()+500,Kk$1(t0,e0));do try{Lk$1();break}catch(a0){Mk$1(t0,a0)}while(!0);$g$1(),mk$1.current=o0,K$1=i0,Y$1!==null?e0=0:(Q$1=null,Z$1=0,e0=T$1)}if(e0!==0){if(e0===2&&(i0=xc$1(t0),i0!==0&&(r0=i0,e0=Nk$1(t0,i0))),e0===1)throw n0=pk$1,Kk$1(t0,0),Ck$1(t0,r0),Dk$1(t0,B$1()),n0;if(e0===6)Ck$1(t0,r0);else{if(i0=t0.current.alternate,!(r0&30)&&!Ok$1(i0)&&(e0=Ik$1(t0,r0),e0===2&&(o0=xc$1(t0),o0!==0&&(r0=o0,e0=Nk$1(t0,o0))),e0===1))throw n0=pk$1,Kk$1(t0,0),Ck$1(t0,r0),Dk$1(t0,B$1()),n0;switch(t0.finishedWork=i0,t0.finishedLanes=r0,e0){case 0:case 1:throw Error(p$1(345));case 2:Pk$1(t0,tk$1,uk$1);break;case 3:if(Ck$1(t0,r0),(r0&130023424)===r0&&(e0=fk$1+500-B$1(),10<e0)){if(uc$1(t0,0)!==0)break;if(i0=t0.suspendedLanes,(i0&r0)!==r0){R$1(),t0.pingedLanes|=t0.suspendedLanes&i0;break}t0.timeoutHandle=Ff$1(Pk$1.bind(null,t0,tk$1,uk$1),e0);break}Pk$1(t0,tk$1,uk$1);break;case 4:if(Ck$1(t0,r0),(r0&4194240)===r0)break;for(e0=t0.eventTimes,i0=-1;0<r0;){var s0=31-oc$1(r0);o0=1<<s0,s0=e0[s0],s0>i0&&(i0=s0),r0&=~o0}if(r0=i0,r0=B$1()-r0,r0=(120>r0?120:480>r0?480:1080>r0?1080:1920>r0?1920:3e3>r0?3e3:4320>r0?4320:1960*lk$1(r0/1960))-r0,10<r0){t0.timeoutHandle=Ff$1(Pk$1.bind(null,t0,tk$1,uk$1),r0);break}Pk$1(t0,tk$1,uk$1);break;case 5:Pk$1(t0,tk$1,uk$1);break;default:throw Error(p$1(329))}}}return Dk$1(t0,B$1()),t0.callbackNode===n0?Gk$1.bind(null,t0):null}function Nk$1(t0,e0){var n0=sk$1;return t0.current.memoizedState.isDehydrated&&(Kk$1(t0,e0).flags|=256),t0=Ik$1(t0,e0),t0!==2&&(e0=tk$1,tk$1=n0,e0!==null&&Fj$1(e0)),t0}function Fj$1(t0){tk$1===null?tk$1=t0:tk$1.push.apply(tk$1,t0)}function Ok$1(t0){for(var e0=t0;;){if(e0.flags&16384){var n0=e0.updateQueue;if(n0!==null&&(n0=n0.stores,n0!==null))for(var r0=0;r0<n0.length;r0++){var i0=n0[r0],o0=i0.getSnapshot;i0=i0.value;try{if(!He$1(o0(),i0))return!1}catch{return!1}}}if(n0=e0.child,e0.subtreeFlags&16384&&n0!==null)n0.return=e0,e0=n0;else{if(e0===t0)break;for(;e0.sibling===null;){if(e0.return===null||e0.return===t0)return!0;e0=e0.return}e0.sibling.return=e0.return,e0=e0.sibling}}return!0}function Ck$1(t0,e0){for(e0&=~rk$1,e0&=~qk$1,t0.suspendedLanes|=e0,t0.pingedLanes&=~e0,t0=t0.expirationTimes;0<e0;){var n0=31-oc$1(e0),r0=1<<n0;t0[n0]=-1,e0&=~r0}}function Ek$1(t0){if(K$1&6)throw Error(p$1(327));Hk$1();var e0=uc$1(t0,0);if(!(e0&1))return Dk$1(t0,B$1()),null;var n0=Ik$1(t0,e0);if(t0.tag!==0&&n0===2){var r0=xc$1(t0);r0!==0&&(e0=r0,n0=Nk$1(t0,r0))}if(n0===1)throw n0=pk$1,Kk$1(t0,0),Ck$1(t0,e0),Dk$1(t0,B$1()),n0;if(n0===6)throw Error(p$1(345));return t0.finishedWork=t0.current.alternate,t0.finishedLanes=e0,Pk$1(t0,tk$1,uk$1),Dk$1(t0,B$1()),null}function Qk$1(t0,e0){var n0=K$1;K$1|=1;try{return t0(e0)}finally{K$1=n0,K$1===0&&(Gj$1=B$1()+500,fg$1&&jg$1())}}function Rk$1(t0){wk$1!==null&&wk$1.tag===0&&!(K$1&6)&&Hk$1();var e0=K$1;K$1|=1;var n0=ok$1.transition,r0=C$1;try{if(ok$1.transition=null,C$1=1,t0)return t0()}finally{C$1=r0,ok$1.transition=n0,K$1=e0,!(K$1&6)&&jg$1()}}function Hj$1(){fj$1=ej$1.current,E$1(ej$1)}function Kk$1(t0,e0){t0.finishedWork=null,t0.finishedLanes=0;var n0=t0.timeoutHandle;if(n0!==-1&&(t0.timeoutHandle=-1,Gf$1(n0)),Y$1!==null)for(n0=Y$1.return;n0!==null;){var r0=n0;switch(wg$1(r0),r0.tag){case 1:r0=r0.type.childContextTypes,r0!=null&&$f$1();break;case 3:zh$1(),E$1(Wf$1),E$1(H$1),Eh$1();break;case 5:Bh$1(r0);break;case 4:zh$1();break;case 13:E$1(L$1);break;case 19:E$1(L$1);break;case 10:ah$1(r0.type._context);break;case 22:case 23:Hj$1()}n0=n0.return}if(Q$1=t0,Y$1=t0=Pg$1(t0.current,null),Z$1=fj$1=e0,T$1=0,pk$1=null,rk$1=qk$1=rh$1=0,tk$1=sk$1=null,fh$1!==null){for(e0=0;e0<fh$1.length;e0++)if(n0=fh$1[e0],r0=n0.interleaved,r0!==null){n0.interleaved=null;var i0=r0.next,o0=n0.pending;if(o0!==null){var s0=o0.next;o0.next=i0,r0.next=s0}n0.pending=r0}fh$1=null}return t0}function Mk$1(t0,e0){do{var n0=Y$1;try{if($g$1(),Fh$1.current=Rh$1,Ih$1){for(var r0=M$1.memoizedState;r0!==null;){var i0=r0.queue;i0!==null&&(i0.pending=null),r0=r0.next}Ih$1=!1}if(Hh$1=0,O$1=N$1=M$1=null,Jh$1=!1,Kh$1=0,nk$1.current=null,n0===null||n0.return===null){T$1=1,pk$1=e0,Y$1=null;break}t:{var o0=t0,s0=n0.return,a0=n0,c0=e0;if(e0=Z$1,a0.flags|=32768,c0!==null&&typeof c0=="object"&&typeof c0.then=="function"){var u0=c0,l0=a0,d0=l0.tag;if(!(l0.mode&1)&&(d0===0||d0===11||d0===15)){var h0=l0.alternate;h0?(l0.updateQueue=h0.updateQueue,l0.memoizedState=h0.memoizedState,l0.lanes=h0.lanes):(l0.updateQueue=null,l0.memoizedState=null)}var p0=Ui$1(s0);if(p0!==null){p0.flags&=-257,Vi$1(p0,s0,a0,o0,e0),p0.mode&1&&Si$1(o0,u0,e0),e0=p0,c0=u0;var m0=e0.updateQueue;if(m0===null){var f0=new Set;f0.add(c0),e0.updateQueue=f0}else m0.add(c0);break t}else{if(!(e0&1)){Si$1(o0,u0,e0),tj$1();break t}c0=Error(p$1(426))}}else if(I$1&&a0.mode&1){var g0=Ui$1(s0);if(g0!==null){!(g0.flags&65536)&&(g0.flags|=256),Vi$1(g0,s0,a0,o0,e0),Jg$1(Ji$1(c0,a0));break t}}o0=c0=Ji$1(c0,a0),T$1!==4&&(T$1=2),sk$1===null?sk$1=[o0]:sk$1.push(o0),o0=s0;do{switch(o0.tag){case 3:o0.flags|=65536,e0&=-e0,o0.lanes|=e0;var E0=Ni$1(o0,c0,e0);ph$1(o0,E0);break t;case 1:a0=c0;var _0=o0.type,y0=o0.stateNode;if(!(o0.flags&128)&&(typeof _0.getDerivedStateFromError=="function"||y0!==null&&typeof y0.componentDidCatch=="function"&&(Ri$1===null||!Ri$1.has(y0)))){o0.flags|=65536,e0&=-e0,o0.lanes|=e0;var b0=Qi$1(o0,a0,e0);ph$1(o0,b0);break t}}o0=o0.return}while(o0!==null)}Sk$1(n0)}catch(S0){e0=S0,Y$1===n0&&n0!==null&&(Y$1=n0=n0.return);continue}break}while(!0)}function Jk$1(){var t0=mk$1.current;return mk$1.current=Rh$1,t0===null?Rh$1:t0}function tj$1(){(T$1===0||T$1===3||T$1===2)&&(T$1=4),Q$1===null||!(rh$1&268435455)&&!(qk$1&268435455)||Ck$1(Q$1,Z$1)}function Ik$1(t0,e0){var n0=K$1;K$1|=2;var r0=Jk$1();(Q$1!==t0||Z$1!==e0)&&(uk$1=null,Kk$1(t0,e0));do try{Tk$1();break}catch(i0){Mk$1(t0,i0)}while(!0);if($g$1(),K$1=n0,mk$1.current=r0,Y$1!==null)throw Error(p$1(261));return Q$1=null,Z$1=0,T$1}function Tk$1(){for(;Y$1!==null;)Uk$1(Y$1)}function Lk$1(){for(;Y$1!==null&&!cc$1();)Uk$1(Y$1)}function Uk$1(t0){var e0=Vk$1(t0.alternate,t0,fj$1);t0.memoizedProps=t0.pendingProps,e0===null?Sk$1(t0):Y$1=e0,nk$1.current=null}function Sk$1(t0){var e0=t0;do{var n0=e0.alternate;if(t0=e0.return,e0.flags&32768){if(n0=Ij$1(n0,e0),n0!==null){n0.flags&=32767,Y$1=n0;return}if(t0!==null)t0.flags|=32768,t0.subtreeFlags=0,t0.deletions=null;else{T$1=6,Y$1=null;return}}else if(n0=Ej$1(n0,e0,fj$1),n0!==null){Y$1=n0;return}if(e0=e0.sibling,e0!==null){Y$1=e0;return}Y$1=e0=t0}while(e0!==null);T$1===0&&(T$1=5)}function Pk$1(t0,e0,n0){var r0=C$1,i0=ok$1.transition;try{ok$1.transition=null,C$1=1,Wk$1(t0,e0,n0,r0)}finally{ok$1.transition=i0,C$1=r0}return null}function Wk$1(t0,e0,n0,r0){do Hk$1();while(wk$1!==null);if(K$1&6)throw Error(p$1(327));n0=t0.finishedWork;var i0=t0.finishedLanes;if(n0===null)return null;if(t0.finishedWork=null,t0.finishedLanes=0,n0===t0.current)throw Error(p$1(177));t0.callbackNode=null,t0.callbackPriority=0;var o0=n0.lanes|n0.childLanes;if(Bc$1(t0,o0),t0===Q$1&&(Y$1=Q$1=null,Z$1=0),!(n0.subtreeFlags&2064)&&!(n0.flags&2064)||vk$1||(vk$1=!0,Fk$1(hc$1,function(){return Hk$1(),null})),o0=(n0.flags&15990)!==0,n0.subtreeFlags&15990||o0){o0=ok$1.transition,ok$1.transition=null;var s0=C$1;C$1=1;var a0=K$1;K$1|=4,nk$1.current=null,Oj$1(t0,n0),dk$1(n0,t0),Oe$1(Df$1),dd$1=!!Cf$1,Df$1=Cf$1=null,t0.current=n0,hk$1(n0,t0,i0),dc$1(),K$1=a0,C$1=s0,ok$1.transition=o0}else t0.current=n0;if(vk$1&&(vk$1=!1,wk$1=t0,xk$1=i0),o0=t0.pendingLanes,o0===0&&(Ri$1=null),mc$1(n0.stateNode,r0),Dk$1(t0,B$1()),e0!==null)for(r0=t0.onRecoverableError,n0=0;n0<e0.length;n0++)i0=e0[n0],r0(i0.value,{componentStack:i0.stack,digest:i0.digest});if(Oi$1)throw Oi$1=!1,t0=Pi$1,Pi$1=null,t0;return xk$1&1&&t0.tag!==0&&Hk$1(),o0=t0.pendingLanes,o0&1?t0===zk$1?yk$1++:(yk$1=0,zk$1=t0):yk$1=0,jg$1(),null}function Hk$1(){if(wk$1!==null){var t0=Dc$1(xk$1),e0=ok$1.transition,n0=C$1;try{if(ok$1.transition=null,C$1=16>t0?16:t0,wk$1===null)var r0=!1;else{if(t0=wk$1,wk$1=null,xk$1=0,K$1&6)throw Error(p$1(331));var i0=K$1;for(K$1|=4,V$1=t0.current;V$1!==null;){var o0=V$1,s0=o0.child;if(V$1.flags&16){var a0=o0.deletions;if(a0!==null){for(var c0=0;c0<a0.length;c0++){var u0=a0[c0];for(V$1=u0;V$1!==null;){var l0=V$1;switch(l0.tag){case 0:case 11:case 15:Pj$1(8,l0,o0)}var d0=l0.child;if(d0!==null)d0.return=l0,V$1=d0;else for(;V$1!==null;){l0=V$1;var h0=l0.sibling,p0=l0.return;if(Sj$1(l0),l0===u0){V$1=null;break}if(h0!==null){h0.return=p0,V$1=h0;break}V$1=p0}}}var m0=o0.alternate;if(m0!==null){var f0=m0.child;if(f0!==null){m0.child=null;do{var g0=f0.sibling;f0.sibling=null,f0=g0}while(f0!==null)}}V$1=o0}}if(o0.subtreeFlags&2064&&s0!==null)s0.return=o0,V$1=s0;else t:for(;V$1!==null;){if(o0=V$1,o0.flags&2048)switch(o0.tag){case 0:case 11:case 15:Pj$1(9,o0,o0.return)}var E0=o0.sibling;if(E0!==null){E0.return=o0.return,V$1=E0;break t}V$1=o0.return}}var _0=t0.current;for(V$1=_0;V$1!==null;){s0=V$1;var y0=s0.child;if(s0.subtreeFlags&2064&&y0!==null)y0.return=s0,V$1=y0;else t:for(s0=_0;V$1!==null;){if(a0=V$1,a0.flags&2048)try{switch(a0.tag){case 0:case 11:case 15:Qj$1(9,a0)}}catch(S0){W$1(a0,a0.return,S0)}if(a0===s0){V$1=null;break t}var b0=a0.sibling;if(b0!==null){b0.return=a0.return,V$1=b0;break t}V$1=a0.return}}if(K$1=i0,jg$1(),lc$1&&typeof lc$1.onPostCommitFiberRoot=="function")try{lc$1.onPostCommitFiberRoot(kc$1,t0)}catch{}r0=!0}return r0}finally{C$1=n0,ok$1.transition=e0}}return!1}function Xk$1(t0,e0,n0){e0=Ji$1(n0,e0),e0=Ni$1(t0,e0,1),t0=nh$1(t0,e0,1),e0=R$1(),t0!==null&&(Ac$1(t0,1,e0),Dk$1(t0,e0))}function W$1(t0,e0,n0){if(t0.tag===3)Xk$1(t0,t0,n0);else for(;e0!==null;){if(e0.tag===3){Xk$1(e0,t0,n0);break}else if(e0.tag===1){var r0=e0.stateNode;if(typeof e0.type.getDerivedStateFromError=="function"||typeof r0.componentDidCatch=="function"&&(Ri$1===null||!Ri$1.has(r0))){t0=Ji$1(n0,t0),t0=Qi$1(e0,t0,1),e0=nh$1(e0,t0,1),t0=R$1(),e0!==null&&(Ac$1(e0,1,t0),Dk$1(e0,t0));break}}e0=e0.return}}function Ti$1(t0,e0,n0){var r0=t0.pingCache;r0!==null&&r0.delete(e0),e0=R$1(),t0.pingedLanes|=t0.suspendedLanes&n0,Q$1===t0&&(Z$1&n0)===n0&&(T$1===4||T$1===3&&(Z$1&130023424)===Z$1&&500>B$1()-fk$1?Kk$1(t0,0):rk$1|=n0),Dk$1(t0,e0)}function Yk$1(t0,e0){e0===0&&(t0.mode&1?(e0=sc$1,sc$1<<=1,!(sc$1&130023424)&&(sc$1=4194304)):e0=1);var n0=R$1();t0=ih$1(t0,e0),t0!==null&&(Ac$1(t0,e0,n0),Dk$1(t0,n0))}function uj$1(t0){var e0=t0.memoizedState,n0=0;e0!==null&&(n0=e0.retryLane),Yk$1(t0,n0)}function bk$1(t0,e0){var n0=0;switch(t0.tag){case 13:var r0=t0.stateNode,i0=t0.memoizedState;i0!==null&&(n0=i0.retryLane);break;case 19:r0=t0.stateNode;break;default:throw Error(p$1(314))}r0!==null&&r0.delete(e0),Yk$1(t0,n0)}var Vk$1;Vk$1=function(t0,e0,n0){if(t0!==null)if(t0.memoizedProps!==e0.pendingProps||Wf$1.current)dh$1=!0;else{if(!(t0.lanes&n0)&&!(e0.flags&128))return dh$1=!1,yj$1(t0,e0,n0);dh$1=!!(t0.flags&131072)}else dh$1=!1,I$1&&e0.flags&1048576&&ug$1(e0,ng$1,e0.index);switch(e0.lanes=0,e0.tag){case 2:var r0=e0.type;ij$1(t0,e0),t0=e0.pendingProps;var i0=Yf$1(e0,H$1.current);ch$1(e0,n0),i0=Nh$1(null,e0,r0,t0,i0,n0);var o0=Sh$1();return e0.flags|=1,typeof i0=="object"&&i0!==null&&typeof i0.render=="function"&&i0.$$typeof===void 0?(e0.tag=1,e0.memoizedState=null,e0.updateQueue=null,Zf$1(r0)?(o0=!0,cg$1(e0)):o0=!1,e0.memoizedState=i0.state!==null&&i0.state!==void 0?i0.state:null,kh$1(e0),i0.updater=Ei$1,e0.stateNode=i0,i0._reactInternals=e0,Ii$1(e0,r0,t0,n0),e0=jj$1(null,e0,r0,!0,o0,n0)):(e0.tag=0,I$1&&o0&&vg$1(e0),Xi$1(null,e0,i0,n0),e0=e0.child),e0;case 16:r0=e0.elementType;t:{switch(ij$1(t0,e0),t0=e0.pendingProps,i0=r0._init,r0=i0(r0._payload),e0.type=r0,i0=e0.tag=Zk$1(r0),t0=Ci$1(r0,t0),i0){case 0:e0=cj$1(null,e0,r0,t0,n0);break t;case 1:e0=hj$1(null,e0,r0,t0,n0);break t;case 11:e0=Yi$1(null,e0,r0,t0,n0);break t;case 14:e0=$i$1(null,e0,r0,Ci$1(r0.type,t0),n0);break t}throw Error(p$1(306,r0,""))}return e0;case 0:return r0=e0.type,i0=e0.pendingProps,i0=e0.elementType===r0?i0:Ci$1(r0,i0),cj$1(t0,e0,r0,i0,n0);case 1:return r0=e0.type,i0=e0.pendingProps,i0=e0.elementType===r0?i0:Ci$1(r0,i0),hj$1(t0,e0,r0,i0,n0);case 3:t:{if(kj$1(e0),t0===null)throw Error(p$1(387));r0=e0.pendingProps,o0=e0.memoizedState,i0=o0.element,lh$1(t0,e0),qh$1(e0,r0,null,n0);var s0=e0.memoizedState;if(r0=s0.element,o0.isDehydrated)if(o0={element:r0,isDehydrated:!1,cache:s0.cache,pendingSuspenseBoundaries:s0.pendingSuspenseBoundaries,transitions:s0.transitions},e0.updateQueue.baseState=o0,e0.memoizedState=o0,e0.flags&256){i0=Ji$1(Error(p$1(423)),e0),e0=lj$1(t0,e0,r0,n0,i0);break t}else if(r0!==i0){i0=Ji$1(Error(p$1(424)),e0),e0=lj$1(t0,e0,r0,n0,i0);break t}else for(yg$1=Lf$1(e0.stateNode.containerInfo.firstChild),xg$1=e0,I$1=!0,zg$1=null,n0=Vg$1(e0,null,r0,n0),e0.child=n0;n0;)n0.flags=n0.flags&-3|4096,n0=n0.sibling;else{if(Ig$1(),r0===i0){e0=Zi$1(t0,e0,n0);break t}Xi$1(t0,e0,r0,n0)}e0=e0.child}return e0;case 5:return Ah$1(e0),t0===null&&Eg$1(e0),r0=e0.type,i0=e0.pendingProps,o0=t0!==null?t0.memoizedProps:null,s0=i0.children,Ef$1(r0,i0)?s0=null:o0!==null&&Ef$1(r0,o0)&&(e0.flags|=32),gj$1(t0,e0),Xi$1(t0,e0,s0,n0),e0.child;case 6:return t0===null&&Eg$1(e0),null;case 13:return oj$1(t0,e0,n0);case 4:return yh$1(e0,e0.stateNode.containerInfo),r0=e0.pendingProps,t0===null?e0.child=Ug$1(e0,null,r0,n0):Xi$1(t0,e0,r0,n0),e0.child;case 11:return r0=e0.type,i0=e0.pendingProps,i0=e0.elementType===r0?i0:Ci$1(r0,i0),Yi$1(t0,e0,r0,i0,n0);case 7:return Xi$1(t0,e0,e0.pendingProps,n0),e0.child;case 8:return Xi$1(t0,e0,e0.pendingProps.children,n0),e0.child;case 12:return Xi$1(t0,e0,e0.pendingProps.children,n0),e0.child;case 10:t:{if(r0=e0.type._context,i0=e0.pendingProps,o0=e0.memoizedProps,s0=i0.value,G$1(Wg$1,r0._currentValue),r0._currentValue=s0,o0!==null)if(He$1(o0.value,s0)){if(o0.children===i0.children&&!Wf$1.current){e0=Zi$1(t0,e0,n0);break t}}else for(o0=e0.child,o0!==null&&(o0.return=e0);o0!==null;){var a0=o0.dependencies;if(a0!==null){s0=o0.child;for(var c0=a0.firstContext;c0!==null;){if(c0.context===r0){if(o0.tag===1){c0=mh$1(-1,n0&-n0),c0.tag=2;var u0=o0.updateQueue;if(u0!==null){u0=u0.shared;var l0=u0.pending;l0===null?c0.next=c0:(c0.next=l0.next,l0.next=c0),u0.pending=c0}}o0.lanes|=n0,c0=o0.alternate,c0!==null&&(c0.lanes|=n0),bh$1(o0.return,n0,e0),a0.lanes|=n0;break}c0=c0.next}}else if(o0.tag===10)s0=o0.type===e0.type?null:o0.child;else if(o0.tag===18){if(s0=o0.return,s0===null)throw Error(p$1(341));s0.lanes|=n0,a0=s0.alternate,a0!==null&&(a0.lanes|=n0),bh$1(s0,n0,e0),s0=o0.sibling}else s0=o0.child;if(s0!==null)s0.return=o0;else for(s0=o0;s0!==null;){if(s0===e0){s0=null;break}if(o0=s0.sibling,o0!==null){o0.return=s0.return,s0=o0;break}s0=s0.return}o0=s0}Xi$1(t0,e0,i0.children,n0),e0=e0.child}return e0;case 9:return i0=e0.type,r0=e0.pendingProps.children,ch$1(e0,n0),i0=eh$1(i0),r0=r0(i0),e0.flags|=1,Xi$1(t0,e0,r0,n0),e0.child;case 14:return r0=e0.type,i0=Ci$1(r0,e0.pendingProps),i0=Ci$1(r0.type,i0),$i$1(t0,e0,r0,i0,n0);case 15:return bj$1(t0,e0,e0.type,e0.pendingProps,n0);case 17:return r0=e0.type,i0=e0.pendingProps,i0=e0.elementType===r0?i0:Ci$1(r0,i0),ij$1(t0,e0),e0.tag=1,Zf$1(r0)?(t0=!0,cg$1(e0)):t0=!1,ch$1(e0,n0),Gi$1(e0,r0,i0),Ii$1(e0,r0,i0,n0),jj$1(null,e0,r0,!0,t0,n0);case 19:return xj$1(t0,e0,n0);case 22:return dj$1(t0,e0,n0)}throw Error(p$1(156,e0.tag))};function Fk$1(t0,e0){return ac$1(t0,e0)}function $k$1(t0,e0,n0,r0){this.tag=t0,this.key=n0,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e0,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r0,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg$1(t0,e0,n0,r0){return new $k$1(t0,e0,n0,r0)}function aj$1(t0){return t0=t0.prototype,!(!t0||!t0.isReactComponent)}function Zk$1(t0){if(typeof t0=="function")return aj$1(t0)?1:0;if(t0!=null){if(t0=t0.$$typeof,t0===Da$1)return 11;if(t0===Ga$1)return 14}return 2}function Pg$1(t0,e0){var n0=t0.alternate;return n0===null?(n0=Bg$1(t0.tag,e0,t0.key,t0.mode),n0.elementType=t0.elementType,n0.type=t0.type,n0.stateNode=t0.stateNode,n0.alternate=t0,t0.alternate=n0):(n0.pendingProps=e0,n0.type=t0.type,n0.flags=0,n0.subtreeFlags=0,n0.deletions=null),n0.flags=t0.flags&14680064,n0.childLanes=t0.childLanes,n0.lanes=t0.lanes,n0.child=t0.child,n0.memoizedProps=t0.memoizedProps,n0.memoizedState=t0.memoizedState,n0.updateQueue=t0.updateQueue,e0=t0.dependencies,n0.dependencies=e0===null?null:{lanes:e0.lanes,firstContext:e0.firstContext},n0.sibling=t0.sibling,n0.index=t0.index,n0.ref=t0.ref,n0}function Rg$1(t0,e0,n0,r0,i0,o0){var s0=2;if(r0=t0,typeof t0=="function")aj$1(t0)&&(s0=1);else if(typeof t0=="string")s0=5;else t:switch(t0){case ya$1:return Tg$1(n0.children,i0,o0,e0);case za$1:s0=8,i0|=8;break;case Aa$1:return t0=Bg$1(12,n0,e0,i0|2),t0.elementType=Aa$1,t0.lanes=o0,t0;case Ea$1:return t0=Bg$1(13,n0,e0,i0),t0.elementType=Ea$1,t0.lanes=o0,t0;case Fa$1:return t0=Bg$1(19,n0,e0,i0),t0.elementType=Fa$1,t0.lanes=o0,t0;case Ia$1:return pj$1(n0,i0,o0,e0);default:if(typeof t0=="object"&&t0!==null)switch(t0.$$typeof){case Ba$1:s0=10;break t;case Ca$1:s0=9;break t;case Da$1:s0=11;break t;case Ga$1:s0=14;break t;case Ha$1:s0=16,r0=null;break t}throw Error(p$1(130,t0==null?t0:typeof t0,""))}return e0=Bg$1(s0,n0,e0,i0),e0.elementType=t0,e0.type=r0,e0.lanes=o0,e0}function Tg$1(t0,e0,n0,r0){return t0=Bg$1(7,t0,r0,e0),t0.lanes=n0,t0}function pj$1(t0,e0,n0,r0){return t0=Bg$1(22,t0,r0,e0),t0.elementType=Ia$1,t0.lanes=n0,t0.stateNode={isHidden:!1},t0}function Qg$1(t0,e0,n0){return t0=Bg$1(6,t0,null,e0),t0.lanes=n0,t0}function Sg$1(t0,e0,n0){return e0=Bg$1(4,t0.children!==null?t0.children:[],t0.key,e0),e0.lanes=n0,e0.stateNode={containerInfo:t0.containerInfo,pendingChildren:null,implementation:t0.implementation},e0}function al$1(t0,e0,n0,r0,i0){this.tag=e0,this.containerInfo=t0,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc$1(0),this.expirationTimes=zc$1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc$1(0),this.identifierPrefix=r0,this.onRecoverableError=i0,this.mutableSourceEagerHydrationData=null}function bl$1(t0,e0,n0,r0,i0,o0,s0,a0,c0){return t0=new al$1(t0,e0,n0,a0,c0),e0===1?(e0=1,o0===!0&&(e0|=8)):e0=0,o0=Bg$1(3,null,null,e0),t0.current=o0,o0.stateNode=t0,o0.memoizedState={element:r0,isDehydrated:n0,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh$1(o0),t0}function cl$1(t0,e0,n0){var r0=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa$1,key:r0==null?null:""+r0,children:t0,containerInfo:e0,implementation:n0}}function dl$1(t0){if(!t0)return Vf$1;t0=t0._reactInternals;t:{if(Vb$1(t0)!==t0||t0.tag!==1)throw Error(p$1(170));var e0=t0;do{switch(e0.tag){case 3:e0=e0.stateNode.context;break t;case 1:if(Zf$1(e0.type)){e0=e0.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e0=e0.return}while(e0!==null);throw Error(p$1(171))}if(t0.tag===1){var n0=t0.type;if(Zf$1(n0))return bg$1(t0,n0,e0)}return e0}function el$1(t0,e0,n0,r0,i0,o0,s0,a0,c0){return t0=bl$1(n0,r0,!0,t0,i0,o0,s0,a0,c0),t0.context=dl$1(null),n0=t0.current,r0=R$1(),i0=yi$1(n0),o0=mh$1(r0,i0),o0.callback=e0??null,nh$1(n0,o0,i0),t0.current.lanes=i0,Ac$1(t0,i0,r0),Dk$1(t0,r0),t0}function fl$1(t0,e0,n0,r0){var i0=e0.current,o0=R$1(),s0=yi$1(i0);return n0=dl$1(n0),e0.context===null?e0.context=n0:e0.pendingContext=n0,e0=mh$1(o0,s0),e0.payload={element:t0},r0=r0===void 0?null:r0,r0!==null&&(e0.callback=r0),t0=nh$1(i0,e0,s0),t0!==null&&(gi$1(t0,i0,s0,o0),oh$1(t0,i0,s0)),s0}function gl$1(t0){if(t0=t0.current,!t0.child)return null;switch(t0.child.tag){case 5:return t0.child.stateNode;default:return t0.child.stateNode}}function hl$1(t0,e0){if(t0=t0.memoizedState,t0!==null&&t0.dehydrated!==null){var n0=t0.retryLane;t0.retryLane=n0!==0&&n0<e0?n0:e0}}function il$1(t0,e0){hl$1(t0,e0),(t0=t0.alternate)&&hl$1(t0,e0)}function jl$1(){return null}var kl$1=typeof reportError=="function"?reportError:function(t0){console.error(t0)};function ll$1(t0){this._internalRoot=t0}ml$1.prototype.render=ll$1.prototype.render=function(t0){var e0=this._internalRoot;if(e0===null)throw Error(p$1(409));fl$1(t0,e0,null,null)};ml$1.prototype.unmount=ll$1.prototype.unmount=function(){var t0=this._internalRoot;if(t0!==null){this._internalRoot=null;var e0=t0.containerInfo;Rk$1(function(){fl$1(null,t0,null,null)}),e0[uf$1]=null}};function ml$1(t0){this._internalRoot=t0}ml$1.prototype.unstable_scheduleHydration=function(t0){if(t0){var e0=Hc$1();t0={blockedOn:null,target:t0,priority:e0};for(var n0=0;n0<Qc$1.length&&e0!==0&&e0<Qc$1[n0].priority;n0++);Qc$1.splice(n0,0,t0),n0===0&&Vc$1(t0)}};function nl$1(t0){return!(!t0||t0.nodeType!==1&&t0.nodeType!==9&&t0.nodeType!==11)}function ol$1(t0){return!(!t0||t0.nodeType!==1&&t0.nodeType!==9&&t0.nodeType!==11&&(t0.nodeType!==8||t0.nodeValue!==" react-mount-point-unstable "))}function pl$1(){}function ql$1(t0,e0,n0,r0,i0){if(i0){if(typeof r0=="function"){var o0=r0;r0=function(){var u0=gl$1(s0);o0.call(u0)}}var s0=el$1(e0,r0,t0,0,null,!1,!1,"",pl$1);return t0._reactRootContainer=s0,t0[uf$1]=s0.current,sf$1(t0.nodeType===8?t0.parentNode:t0),Rk$1(),s0}for(;i0=t0.lastChild;)t0.removeChild(i0);if(typeof r0=="function"){var a0=r0;r0=function(){var u0=gl$1(c0);a0.call(u0)}}var c0=bl$1(t0,0,!1,null,null,!1,!1,"",pl$1);return t0._reactRootContainer=c0,t0[uf$1]=c0.current,sf$1(t0.nodeType===8?t0.parentNode:t0),Rk$1(function(){fl$1(e0,c0,n0,r0)}),c0}function rl$1(t0,e0,n0,r0,i0){var o0=n0._reactRootContainer;if(o0){var s0=o0;if(typeof i0=="function"){var a0=i0;i0=function(){var c0=gl$1(s0);a0.call(c0)}}fl$1(e0,s0,t0,i0)}else s0=ql$1(n0,e0,t0,i0,r0);return gl$1(s0)}Ec$1=function(t0){switch(t0.tag){case 3:var e0=t0.stateNode;if(e0.current.memoizedState.isDehydrated){var n0=tc$1(e0.pendingLanes);n0!==0&&(Cc$1(e0,n0|1),Dk$1(e0,B$1()),!(K$1&6)&&(Gj$1=B$1()+500,jg$1()))}break;case 13:Rk$1(function(){var r0=ih$1(t0,1);if(r0!==null){var i0=R$1();gi$1(r0,t0,1,i0)}}),il$1(t0,1)}};Fc$1=function(t0){if(t0.tag===13){var e0=ih$1(t0,134217728);if(e0!==null){var n0=R$1();gi$1(e0,t0,134217728,n0)}il$1(t0,134217728)}};Gc$1=function(t0){if(t0.tag===13){var e0=yi$1(t0),n0=ih$1(t0,e0);if(n0!==null){var r0=R$1();gi$1(n0,t0,e0,r0)}il$1(t0,e0)}};Hc$1=function(){return C$1};Ic$1=function(t0,e0){var n0=C$1;try{return C$1=t0,e0()}finally{C$1=n0}};yb$1=function(t0,e0,n0){switch(e0){case"input":if(bb$1(t0,n0),e0=n0.name,n0.type==="radio"&&e0!=null){for(n0=t0;n0.parentNode;)n0=n0.parentNode;for(n0=n0.querySelectorAll("input[name="+JSON.stringify(""+e0)+'][type="radio"]'),e0=0;e0<n0.length;e0++){var r0=n0[e0];if(r0!==t0&&r0.form===t0.form){var i0=Db$1(r0);if(!i0)throw Error(p$1(90));Wa$1(r0),bb$1(r0,i0)}}}break;case"textarea":ib$1(t0,n0);break;case"select":e0=n0.value,e0!=null&&fb$1(t0,!!n0.multiple,e0,!1)}};Gb$1=Qk$1;Hb$1=Rk$1;var sl$1={usingClientEntryPoint:!1,Events:[Cb$1,ue$1,Db$1,Eb$1,Fb$1,Qk$1]},tl$1={findFiberByHostInstance:Wc$1,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul$1={bundleType:tl$1.bundleType,version:tl$1.version,rendererPackageName:tl$1.rendererPackageName,rendererConfig:tl$1.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua$1.ReactCurrentDispatcher,findHostInstanceByFiber:function(t0){return t0=Zb$1(t0),t0===null?null:t0.stateNode},findFiberByHostInstance:tl$1.findFiberByHostInstance||jl$1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl$1=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl$1.isDisabled&&vl$1.supportsFiber)try{kc$1=vl$1.inject(ul$1),lc$1=vl$1}catch{}}var __SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl$1,createPortal=reactDom_production_min.createPortal=function(t0,e0){var n0=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl$1(e0))throw Error(p$1(200));return cl$1(t0,e0,null,n0)},createRoot$1=reactDom_production_min.createRoot=function(t0,e0){if(!nl$1(t0))throw Error(p$1(299));var n0=!1,r0="",i0=kl$1;return e0!=null&&(e0.unstable_strictMode===!0&&(n0=!0),e0.identifierPrefix!==void 0&&(r0=e0.identifierPrefix),e0.onRecoverableError!==void 0&&(i0=e0.onRecoverableError)),e0=bl$1(t0,1,!1,null,null,n0,!1,r0,i0),t0[uf$1]=e0.current,sf$1(t0.nodeType===8?t0.parentNode:t0),new ll$1(e0)},findDOMNode=reactDom_production_min.findDOMNode=function(t0){if(t0==null)return null;if(t0.nodeType===1)return t0;var e0=t0._reactInternals;if(e0===void 0)throw typeof t0.render=="function"?Error(p$1(188)):(t0=Object.keys(t0).join(","),Error(p$1(268,t0)));return t0=Zb$1(e0),t0=t0===null?null:t0.stateNode,t0},flushSync=reactDom_production_min.flushSync=function(t0){return Rk$1(t0)},hydrate=reactDom_production_min.hydrate=function(t0,e0,n0){if(!ol$1(e0))throw Error(p$1(200));return rl$1(null,t0,e0,!0,n0)},hydrateRoot$1=reactDom_production_min.hydrateRoot=function(t0,e0,n0){if(!nl$1(t0))throw Error(p$1(405));var r0=n0!=null&&n0.hydratedSources||null,i0=!1,o0="",s0=kl$1;if(n0!=null&&(n0.unstable_strictMode===!0&&(i0=!0),n0.identifierPrefix!==void 0&&(o0=n0.identifierPrefix),n0.onRecoverableError!==void 0&&(s0=n0.onRecoverableError)),e0=el$1(e0,null,t0,1,n0??null,i0,!1,o0,s0),t0[uf$1]=e0.current,sf$1(t0),r0)for(t0=0;t0<r0.length;t0++)n0=r0[t0],i0=n0._getVersion,i0=i0(n0._source),e0.mutableSourceEagerHydrationData==null?e0.mutableSourceEagerHydrationData=[n0,i0]:e0.mutableSourceEagerHydrationData.push(n0,i0);return new ml$1(e0)},render=reactDom_production_min.render=function(t0,e0,n0){if(!ol$1(e0))throw Error(p$1(200));return rl$1(null,t0,e0,!1,n0)},unmountComponentAtNode=reactDom_production_min.unmountComponentAtNode=function(t0){if(!ol$1(t0))throw Error(p$1(40));return t0._reactRootContainer?(Rk$1(function(){rl$1(null,null,t0,!1,function(){t0._reactRootContainer=null,t0[uf$1]=null})}),!0):!1},unstable_batchedUpdates=reactDom_production_min.unstable_batchedUpdates=Qk$1,unstable_renderSubtreeIntoContainer=reactDom_production_min.unstable_renderSubtreeIntoContainer=function(t0,e0,n0,r0){if(!ol$1(n0))throw Error(p$1(200));if(t0==null||t0._reactInternals===void 0)throw Error(p$1(38));return rl$1(t0,e0,n0,!1,r0)},version=reactDom_production_min.version="18.3.1-next-f1338f8080-20240426",reactDom=reactDom$1.exports;function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(t0){console.error(t0)}}checkDCE(),reactDom$1.exports=reactDom_production_min;var reactDomExports=reactDom$1.exports;const index=getDefaultExportFromCjs(reactDomExports);var hydrateRoot,createRoot,m$1=reactDomExports;if(1)createRoot=client.createRoot=m$1.createRoot,hydrateRoot=client.hydrateRoot=m$1.hydrateRoot;else var i$1;function e(t0,e0){return e0.forEach(function(n0){n0&&typeof n0!="string"&&!Array.isArray(n0)&&Object.keys(n0).forEach(function(r0){if(r0!=="default"&&!(r0 in t0)){var i0=Object.getOwnPropertyDescriptor(n0,r0);Object.defineProperty(t0,r0,i0.get?i0:{enumerable:!0,get:function(){return n0[r0]}})}})}),Object.freeze(t0)}var t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function i(t0){return t0&&t0.__esModule&&Object.prototype.hasOwnProperty.call(t0,"default")?t0.default:t0}var n=function(t0){try{return!!t0()}catch{return!0}},r=!n(function(){var t0=(function(){}).bind();return typeof t0!="function"||t0.hasOwnProperty("prototype")}),o=r,s=Function.prototype,a=s.call,c=o&&s.bind.bind(a,a),d=o?c:function(t0){return function(){return a.apply(t0,arguments)}},l=d({}.isPrototypeOf),u=function(t0){return t0&&t0.Math==Math&&t0},h=u(typeof globalThis=="object"&&globalThis)||u(typeof window=="object"&&window)||u(typeof self=="object"&&self)||u(typeof t=="object"&&t)||function(){return this}()||t||Function("return this")(),p=r,_=Function.prototype,E=_.apply,f=_.call,m=typeof Reflect=="object"&&Reflect.apply||(p?f.bind(E):function(){return f.apply(E,arguments)}),T=d,S=T({}.toString),g=T("".slice),R=function(t0){return g(S(t0),8,-1)},C=R,I=d,v=function(t0){if(C(t0)==="Function")return I(t0)},y=typeof document=="object"&&document.all,A={all:y,IS_HTMLDDA:y===void 0&&y!==void 0},b=A.all,w=A.IS_HTMLDDA?function(t0){return typeof t0=="function"||t0===b}:function(t0){return typeof t0=="function"},O={},N=!n(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),D=r,P=Function.prototype.call,L=D?P.bind(P):function(){return P.apply(P,arguments)},k={},M={}.propertyIsEnumerable,U=Object.getOwnPropertyDescriptor,x=U&&!M.call({1:2},1);k.f=x?function(t0){var e0=U(this,t0);return!!e0&&e0.enumerable}:M;var V,F,B=function(t0,e0){return{enumerable:!(1&t0),configurable:!(2&t0),writable:!(4&t0),value:e0}},j=n,G=R,W=Object,H=d("".split),K=j(function(){return!W("z").propertyIsEnumerable(0)})?function(t0){return G(t0)=="String"?H(t0,""):W(t0)}:W,Y=function(t0){return t0==null},q=Y,z=TypeError,J=function(t0){if(q(t0))throw z("Can't call method on "+t0);return t0},X=K,Q=J,Z=function(t0){return X(Q(t0))},$=w,ee=A.all,te=A.IS_HTMLDDA?function(t0){return typeof t0=="object"?t0!==null:$(t0)||t0===ee}:function(t0){return typeof t0=="object"?t0!==null:$(t0)},ie={},ne=ie,re=h,oe=w,se=function(t0){return oe(t0)?t0:void 0},ae=function(t0,e0){return arguments.length<2?se(ne[t0])||se(re[t0]):ne[t0]&&ne[t0][e0]||re[t0]&&re[t0][e0]},ce=typeof navigator<"u"&&String(navigator.userAgent)||"",de=h,le=ce,ue=de.process,he=de.Deno,pe=ue&&ue.versions||he&&he.version,_e=pe&&pe.v8;_e&&(F=(V=_e.split("."))[0]>0&&V[0]<4?1:+(V[0]+V[1])),!F&&le&&(!(V=le.match(/Edge\/(\d+)/))||V[1]>=74)&&(V=le.match(/Chrome\/(\d+)/))&&(F=+V[1]);var Ee=F,fe=Ee,me=n,Te=h.String,Se=!!Object.getOwnPropertySymbols&&!me(function(){var t0=Symbol();return!Te(t0)||!(Object(t0)instanceof Symbol)||!Symbol.sham&&fe&&fe<41}),ge=Se&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Re=ae,Ce=w,Ie=l,ve=Object,ye=ge?function(t0){return typeof t0=="symbol"}:function(t0){var e0=Re("Symbol");return Ce(e0)&&Ie(e0.prototype,ve(t0))},Ae=String,be=function(t0){try{return Ae(t0)}catch{return"Object"}},we=w,Oe=be,Ne=TypeError,De=function(t0){if(we(t0))return t0;throw Ne(Oe(t0)+" is not a function")},Pe=De,Le=Y,ke=function(t0,e0){var n0=t0[e0];return Le(n0)?void 0:Pe(n0)},Me=L,Ue=w,xe=te,Ve=TypeError,Fe={exports:{}},Be=h,je=Object.defineProperty,Ge=function(t0,e0){try{je(Be,t0,{value:e0,configurable:!0,writable:!0})}catch{Be[t0]=e0}return e0},We="__core-js_shared__",He=h[We]||Ge(We,{}),Ke=He;(Fe.exports=function(t0,e0){return Ke[t0]||(Ke[t0]=e0!==void 0?e0:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Ye=Fe.exports,qe=J,ze=Object,Je=function(t0){return ze(qe(t0))},Xe=Je,Qe=d({}.hasOwnProperty),Ze=Object.hasOwn||function(t0,e0){return Qe(Xe(t0),e0)},$e=d,et=0,tt=Math.random(),it=$e(1 .toString),nt=function(t0){return"Symbol("+(t0===void 0?"":t0)+")_"+it(++et+tt,36)},rt=Ye,ot=Ze,st=nt,at=Se,ct=ge,dt=h.Symbol,lt=rt("wks"),ut=ct?dt.for||dt:dt&&dt.withoutSetter||st,ht=function(t0){return ot(lt,t0)||(lt[t0]=at&&ot(dt,t0)?dt[t0]:ut("Symbol."+t0)),lt[t0]},pt=L,_t=te,Et=ye,ft=ke,mt=function(t0,e0){var n0,r0;if(e0==="string"&&Ue(n0=t0.toString)&&!xe(r0=Me(n0,t0))||Ue(n0=t0.valueOf)&&!xe(r0=Me(n0,t0))||e0!=="string"&&Ue(n0=t0.toString)&&!xe(r0=Me(n0,t0)))return r0;throw Ve("Can't convert object to primitive value")},Tt=TypeError,St=ht("toPrimitive"),gt=function(t0,e0){if(!_t(t0)||Et(t0))return t0;var n0,r0=ft(t0,St);if(r0){if(e0===void 0&&(e0="default"),n0=pt(r0,t0,e0),!_t(n0)||Et(n0))return n0;throw Tt("Can't convert object to primitive value")}return e0===void 0&&(e0="number"),mt(t0,e0)},Rt=ye,Ct=function(t0){var e0=gt(t0,"string");return Rt(e0)?e0:e0+""},It=te,vt=h.document,yt=It(vt)&&It(vt.createElement),At=function(t0){return yt?vt.createElement(t0):{}},bt=At,wt=!N&&!n(function(){return Object.defineProperty(bt("div"),"a",{get:function(){return 7}}).a!=7}),Ot=N,Nt=L,Dt=k,Pt=B,Lt=Z,kt=Ct,Mt=Ze,Ut=wt,xt=Object.getOwnPropertyDescriptor;O.f=Ot?xt:function(t0,e0){if(t0=Lt(t0),e0=kt(e0),Ut)try{return xt(t0,e0)}catch{}if(Mt(t0,e0))return Pt(!Nt(Dt.f,t0,e0),t0[e0])};var Vt=n,Ft=w,Bt=/#|\.prototype\./,jt=function(t0,e0){var n0=Wt[Gt(t0)];return n0==Kt||n0!=Ht&&(Ft(e0)?Vt(e0):!!e0)},Gt=jt.normalize=function(t0){return String(t0).replace(Bt,".").toLowerCase()},Wt=jt.data={},Ht=jt.NATIVE="N",Kt=jt.POLYFILL="P",Yt=jt,qt=De,zt=r,Jt=v(v.bind),Xt=function(t0,e0){return qt(t0),e0===void 0?t0:zt?Jt(t0,e0):function(){return t0.apply(e0,arguments)}},Qt={},Zt=N&&n(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),$t=te,ei=String,ti=TypeError,ii=function(t0){if($t(t0))return t0;throw ti(ei(t0)+" is not an object")},ni=N,ri=wt,oi=Zt,si=ii,ai=Ct,ci=TypeError,di=Object.defineProperty,li=Object.getOwnPropertyDescriptor,ui="enumerable",hi="configurable",pi="writable";Qt.f=ni?oi?function(t0,e0,n0){if(si(t0),e0=ai(e0),si(n0),typeof t0=="function"&&e0==="prototype"&&"value"in n0&&pi in n0&&!n0[pi]){var r0=li(t0,e0);r0&&r0[pi]&&(t0[e0]=n0.value,n0={configurable:hi in n0?n0[hi]:r0[hi],enumerable:ui in n0?n0[ui]:r0[ui],writable:!1})}return di(t0,e0,n0)}:di:function(t0,e0,n0){if(si(t0),e0=ai(e0),si(n0),ri)try{return di(t0,e0,n0)}catch{}if("get"in n0||"set"in n0)throw ci("Accessors not supported");return"value"in n0&&(t0[e0]=n0.value),t0};var _i=Qt,Ei=B,fi=N?function(t0,e0,n0){return _i.f(t0,e0,Ei(1,n0))}:function(t0,e0,n0){return t0[e0]=n0,t0},mi=h,Ti=m,Si=v,gi=w,Ri=O.f,Ci=Yt,Ii=ie,vi=Xt,yi=fi,Ai=Ze,bi=function(t0){var e0=function(n0,r0,i0){if(this instanceof e0){switch(arguments.length){case 0:return new t0;case 1:return new t0(n0);case 2:return new t0(n0,r0)}return new t0(n0,r0,i0)}return Ti(t0,this,arguments)};return e0.prototype=t0.prototype,e0},wi=function(t0,e0){var n0,r0,i0,o0,s0,a0,c0,u0,l0,d0=t0.target,h0=t0.global,p0=t0.stat,m0=t0.proto,f0=h0?mi:p0?mi[d0]:(mi[d0]||{}).prototype,g0=h0?Ii:Ii[d0]||yi(Ii,d0,{})[d0],E0=g0.prototype;for(o0 in e0)r0=!(n0=Ci(h0?o0:d0+(p0?".":"#")+o0,t0.forced))&&f0&&Ai(f0,o0),a0=g0[o0],r0&&(c0=t0.dontCallGetSet?(l0=Ri(f0,o0))&&l0.value:f0[o0]),s0=r0&&c0?c0:e0[o0],r0&&typeof a0==typeof s0||(u0=t0.bind&&r0?vi(s0,mi):t0.wrap&&r0?bi(s0):m0&&gi(s0)?Si(s0):s0,(t0.sham||s0&&s0.sham||a0&&a0.sham)&&yi(u0,"sham",!0),yi(g0,o0,u0),m0&&(Ai(Ii,i0=d0+"Prototype")||yi(Ii,i0,{}),yi(Ii[i0],o0,s0),t0.real&&E0&&(n0||!E0[o0])&&yi(E0,o0,s0)))},Oi=Math.ceil,Ni=Math.floor,Di=Math.trunc||function(t0){var e0=+t0;return(e0>0?Ni:Oi)(e0)},Pi=Di,Li=function(t0){var e0=+t0;return e0!=e0||e0===0?0:Pi(e0)},ki=Li,Mi=Math.max,Ui=Math.min,xi=function(t0,e0){var n0=ki(t0);return n0<0?Mi(n0+e0,0):Ui(n0,e0)},Vi=Li,Fi=Math.min,Bi=function(t0){return t0>0?Fi(Vi(t0),9007199254740991):0},ji=Bi,Gi=function(t0){return ji(t0.length)},Wi=Z,Hi=xi,Ki=Gi,Yi=function(t0){return function(e0,n0,r0){var i0,o0=Wi(e0),s0=Ki(o0),a0=Hi(r0,s0);if(t0&&n0!=n0){for(;s0>a0;)if((i0=o0[a0++])!=i0)return!0}else for(;s0>a0;a0++)if((t0||a0 in o0)&&o0[a0]===n0)return t0||a0||0;return!t0&&-1}},qi={includes:Yi(!0),indexOf:Yi(!1)},zi=qi.includes;wi({target:"Array",proto:!0,forced:n(function(){return!Array(1).includes()})},{includes:function(t0){return zi(this,t0,arguments.length>1?arguments[1]:void 0)}});var Ji=ie,Xi=function(t0){return Ji[t0+"Prototype"]},Qi=Xi("Array").includes,Zi=te,$i=R,en=ht("match"),tn=function(t0){var e0;return Zi(t0)&&((e0=t0[en])!==void 0?!!e0:$i(t0)=="RegExp")},nn=tn,rn=TypeError,on={};on[ht("toStringTag")]="z";var sn=String(on)==="[object z]",an=sn,cn=w,dn=R,ln=ht("toStringTag"),un=Object,hn=dn(function(){return arguments}())=="Arguments",pn=an?dn:function(t0){var e0,n0,r0;return t0===void 0?"Undefined":t0===null?"Null":typeof(n0=function(i0,o0){try{return i0[o0]}catch{}}(e0=un(t0),ln))=="string"?n0:hn?dn(e0):(r0=dn(e0))=="Object"&&cn(e0.callee)?"Arguments":r0},_n=pn,En=String,fn=function(t0){if(_n(t0)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return En(t0)},mn=ht("match"),Tn=wi,Sn=function(t0){if(nn(t0))throw rn("The method doesn't accept regular expressions");return t0},gn=J,Rn=fn,Cn=function(t0){var e0=/./;try{"/./"[t0](e0)}catch{try{return e0[mn]=!1,"/./"[t0](e0)}catch{}}return!1},In=d("".indexOf);Tn({target:"String",proto:!0,forced:!Cn("includes")},{includes:function(t0){return!!~In(Rn(gn(this)),Rn(Sn(t0)),arguments.length>1?arguments[1]:void 0)}});var vn=Xi("String").includes,yn=l,An=Qi,bn=vn,wn=Array.prototype,On=String.prototype,Nn=function(t0){var e0=t0.includes;return t0===wn||yn(wn,t0)&&e0===wn.includes?An:typeof t0=="string"||t0===On||yn(On,t0)&&e0===On.includes?bn:e0},Dn=i(Nn),Pn=De,Ln=Je,kn=K,Mn=Gi,Un=TypeError,xn=function(t0){return function(e0,n0,r0,i0){Pn(n0);var o0=Ln(e0),s0=kn(o0),a0=Mn(o0),c0=t0?a0-1:0,u0=t0?-1:1;if(r0<2)for(;;){if(c0 in s0){i0=s0[c0],c0+=u0;break}if(c0+=u0,t0?c0<0:a0<=c0)throw Un("Reduce of empty array with no initial value")}for(;t0?c0>=0:a0>c0;c0+=u0)c0 in s0&&(i0=n0(i0,s0[c0],c0,o0));return i0}},Vn={left:xn(!1),right:xn(!0)},Fn=n,Bn=function(t0,e0){var n0=[][t0];return!!n0&&Fn(function(){n0.call(null,e0||function(){return 1},1)})},jn=typeof process<"u"&&R(process)=="process",Gn=Vn.left;wi({target:"Array",proto:!0,forced:!jn&&Ee>79&&Ee<83||!Bn("reduce")},{reduce:function(t0){var e0=arguments.length;return Gn(this,t0,e0,e0>1?arguments[1]:void 0)}});var Wn=Xi("Array").reduce,Hn=l,Kn=Wn,Yn=Array.prototype,qn=function(t0){var e0=t0.reduce;return t0===Yn||Hn(Yn,t0)&&e0===Yn.reduce?Kn:e0},zn=qn,Jn=i(zn);let Xn=!0,Qn=!0;function Zn(t0,e0,n0){const r0=t0.match(e0);return r0&&r0.length>=n0&&parseInt(r0[n0],10)}function $n(t0,e0,n0){if(!t0.RTCPeerConnection)return;const r0=t0.RTCPeerConnection.prototype,i0=r0.addEventListener;r0.addEventListener=function(s0,a0){if(s0!==e0)return i0.apply(this,arguments);const c0=u0=>{const l0=n0(u0);l0&&(a0.handleEvent?a0.handleEvent(l0):a0(l0))};return this._eventMap=this._eventMap||{},this._eventMap[e0]||(this._eventMap[e0]=new Map),this._eventMap[e0].set(a0,c0),i0.apply(this,[s0,c0])};const o0=r0.removeEventListener;r0.removeEventListener=function(s0,a0){if(s0!==e0||!this._eventMap||!this._eventMap[e0])return o0.apply(this,arguments);if(!this._eventMap[e0].has(a0))return o0.apply(this,arguments);const c0=this._eventMap[e0].get(a0);return this._eventMap[e0].delete(a0),this._eventMap[e0].size===0&&delete this._eventMap[e0],Object.keys(this._eventMap).length===0&&delete this._eventMap,o0.apply(this,[s0,c0])},Object.defineProperty(r0,"on"+e0,{get(){return this["_on"+e0]},set(s0){this["_on"+e0]&&(this.removeEventListener(e0,this["_on"+e0]),delete this["_on"+e0]),s0&&this.addEventListener(e0,this["_on"+e0]=s0)},enumerable:!0,configurable:!0})}function er(t0){return typeof t0!="boolean"?new Error("Argument type: "+typeof t0+". Please use a boolean."):(Xn=t0,t0?"adapter.js logging disabled":"adapter.js logging enabled")}function tr(t0){return typeof t0!="boolean"?new Error("Argument type: "+typeof t0+". Please use a boolean."):(Qn=!t0,"adapter.js deprecation warnings "+(t0?"disabled":"enabled"))}function ir(){if(typeof window=="object"){if(Xn)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function nr(t0,e0){Qn&&console.warn(t0+" is deprecated, please use "+e0+" instead.")}function rr(t0){return Object.prototype.toString.call(t0)==="[object Object]"}function or(t0){var e0;return rr(t0)?Jn(e0=Object.keys(t0)).call(e0,function(n0,r0){const i0=rr(t0[r0]),o0=i0?or(t0[r0]):t0[r0],s0=i0&&!Object.keys(o0).length;return o0===void 0||s0?n0:Object.assign(n0,{[r0]:o0})},{}):t0}function sr(t0,e0,n0){e0&&!n0.has(e0.id)&&(n0.set(e0.id,e0),Object.keys(e0).forEach(r0=>{r0.endsWith("Id")?sr(t0,t0.get(e0[r0]),n0):r0.endsWith("Ids")&&e0[r0].forEach(i0=>{sr(t0,t0.get(i0),n0)})}))}function ar(t0,e0,n0){const r0=n0?"outbound-rtp":"inbound-rtp",i0=new Map;if(e0===null)return i0;const o0=[];return t0.forEach(s0=>{s0.type==="track"&&s0.trackIdentifier===e0.id&&o0.push(s0)}),o0.forEach(s0=>{t0.forEach(a0=>{a0.type===r0&&a0.trackId===s0.id&&sr(t0,a0,i0)})}),i0}var cr=nt,dr=Ye("keys"),lr=function(t0){return dr[t0]||(dr[t0]=cr(t0))},ur=!n(function(){function t0(){}return t0.prototype.constructor=null,Object.getPrototypeOf(new t0)!==t0.prototype}),hr=Ze,pr=w,_r=Je,Er=ur,fr=lr("IE_PROTO"),mr=Object,Tr=mr.prototype,Sr=Er?mr.getPrototypeOf:function(t0){var e0=_r(t0);if(hr(e0,fr))return e0[fr];var n0=e0.constructor;return pr(n0)&&e0 instanceof n0?n0.prototype:e0 instanceof mr?Tr:null},gr=d,Rr=De,Cr=w,Ir=String,vr=TypeError,yr=function(t0,e0,n0){try{return gr(Rr(Object.getOwnPropertyDescriptor(t0,e0)[n0]))}catch{}},Ar=ii,br=function(t0){if(typeof t0=="object"||Cr(t0))return t0;throw vr("Can't set "+Ir(t0)+" as a prototype")},wr=Object.setPrototypeOf||("__proto__"in{}?function(){var t0,e0=!1,n0={};try{(t0=yr(Object.prototype,"__proto__","set"))(n0,[]),e0=n0 instanceof Array}catch{}return function(r0,i0){return Ar(r0),br(i0),e0?t0(r0,i0):r0.__proto__=i0,r0}}():void 0),Or={},Nr={},Dr=Ze,Pr=Z,Lr=qi.indexOf,kr=Nr,Mr=d([].push),Ur=function(t0,e0){var n0,r0=Pr(t0),i0=0,o0=[];for(n0 in r0)!Dr(kr,n0)&&Dr(r0,n0)&&Mr(o0,n0);for(;e0.length>i0;)Dr(r0,n0=e0[i0++])&&(~Lr(o0,n0)||Mr(o0,n0));return o0},xr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Vr=Ur,Fr=xr.concat("length","prototype");Or.f=Object.getOwnPropertyNames||function(t0){return Vr(t0,Fr)};var Br={};Br.f=Object.getOwnPropertySymbols;var jr=ae,Gr=Or,Wr=Br,Hr=ii,Kr=d([].concat),Yr=jr("Reflect","ownKeys")||function(t0){var e0=Gr.f(Hr(t0)),n0=Wr.f;return n0?Kr(e0,n0(t0)):e0},qr=Ze,zr=Yr,Jr=O,Xr=Qt,Qr={},Zr=Ur,$r=xr,eo=Object.keys||function(t0){return Zr(t0,$r)},to=N,io=Zt,no=Qt,ro=ii,oo=Z,so=eo;Qr.f=to&&!io?Object.defineProperties:function(t0,e0){ro(t0);for(var n0,r0=oo(e0),i0=so(e0),o0=i0.length,s0=0;o0>s0;)no.f(t0,n0=i0[s0++],r0[n0]);return t0};var ao,co=ae("document","documentElement"),lo=ii,uo=Qr,ho=xr,po=Nr,_o=co,Eo=At,fo="prototype",mo="script",To=lr("IE_PROTO"),So=function(){},go=function(t0){return"<"+mo+">"+t0+"</"+mo+">"},Ro=function(t0){t0.write(go("")),t0.close();var e0=t0.parentWindow.Object;return t0=null,e0},Co=function(){try{ao=new ActiveXObject("htmlfile")}catch{}var t0,e0,n0;Co=typeof document<"u"?document.domain&&ao?Ro(ao):(e0=Eo("iframe"),n0="java"+mo+":",e0.style.display="none",_o.appendChild(e0),e0.src=String(n0),(t0=e0.contentWindow.document).open(),t0.write(go("document.F=Object")),t0.close(),t0.F):Ro(ao);for(var r0=ho.length;r0--;)delete Co[fo][ho[r0]];return Co()};po[To]=!0;var Io=Object.create||function(t0,e0){var n0;return t0!==null?(So[fo]=lo(t0),n0=new So,So[fo]=null,n0[To]=t0):n0=Co(),e0===void 0?n0:uo.f(n0,e0)},vo=te,yo=fi,Ao=Error,bo=d("".replace),wo=String(Ao("zxcasd").stack),Oo=/\n\s*at [^:]*:[^\n]*/,No=Oo.test(wo),Do=B,Po=!n(function(){var t0=Error("a");return!("stack"in t0)||(Object.defineProperty(t0,"stack",Do(1,7)),t0.stack!==7)}),Lo=fi,ko=function(t0,e0){if(No&&typeof t0=="string"&&!Ao.prepareStackTrace)for(;e0--;)t0=bo(t0,Oo,"");return t0},Mo=Po,Uo=Error.captureStackTrace,xo={},Vo=xo,Fo=ht("iterator"),Bo=Array.prototype,jo=function(t0){return t0!==void 0&&(Vo.Array===t0||Bo[Fo]===t0)},Go=pn,Wo=ke,Ho=Y,Ko=xo,Yo=ht("iterator"),qo=function(t0){if(!Ho(t0))return Wo(t0,Yo)||Wo(t0,"@@iterator")||Ko[Go(t0)]},zo=L,Jo=De,Xo=ii,Qo=be,Zo=qo,$o=TypeError,es=function(t0,e0){var n0=arguments.length<2?Zo(t0):e0;if(Jo(n0))return Xo(zo(n0,t0));throw $o(Qo(t0)+" is not iterable")},ts=L,is=ii,ns=ke,rs=function(t0,e0,n0){var r0,i0;is(t0);try{if(!(r0=ns(t0,"return"))){if(e0==="throw")throw n0;return n0}r0=ts(r0,t0)}catch(o0){i0=!0,r0=o0}if(e0==="throw")throw n0;if(i0)throw r0;return is(r0),n0},os=Xt,ss=L,as=ii,cs=be,ds=jo,ls=Gi,us=l,hs=es,ps=qo,_s=rs,Es=TypeError,fs=function(t0,e0){this.stopped=t0,this.result=e0},ms=fs.prototype,Ts=function(t0,e0,n0){var r0,i0,o0,s0,a0,c0,u0,l0=n0&&n0.that,d0=!(!n0||!n0.AS_ENTRIES),h0=!(!n0||!n0.IS_RECORD),p0=!(!n0||!n0.IS_ITERATOR),m0=!(!n0||!n0.INTERRUPTED),f0=os(e0,l0),g0=function(_0){return r0&&_s(r0,"normal",_0),new fs(!0,_0)},E0=function(_0){return d0?(as(_0),m0?f0(_0[0],_0[1],g0):f0(_0[0],_0[1])):m0?f0(_0,g0):f0(_0)};if(h0)r0=t0.iterator;else if(p0)r0=t0;else{if(!(i0=ps(t0)))throw Es(cs(t0)+" is not iterable");if(ds(i0)){for(o0=0,s0=ls(t0);s0>o0;o0++)if((a0=E0(t0[o0]))&&us(ms,a0))return a0;return new fs(!1)}r0=hs(t0,i0)}for(c0=h0?t0.next:r0.next;!(u0=ss(c0,r0)).done;){try{a0=E0(u0.value)}catch(_0){_s(r0,"throw",_0)}if(typeof a0=="object"&&a0&&us(ms,a0))return a0}return new fs(!1)},Ss=fn,gs=wi,Rs=l,Cs=Sr,Is=wr,vs=function(t0,e0,n0){for(var r0=zr(e0),i0=Xr.f,o0=Jr.f,s0=0;s0<r0.length;s0++){var a0=r0[s0];qr(t0,a0)||n0&&qr(n0,a0)||i0(t0,a0,o0(e0,a0))}},ys=Io,As=fi,bs=B,ws=function(t0,e0){vo(e0)&&"cause"in e0&&yo(t0,"cause",e0.cause)},Os=function(t0,e0,n0,r0){Mo&&(Uo?Uo(t0,e0):Lo(t0,"stack",ko(n0,r0)))},Ns=Ts,Ds=function(t0,e0){return t0===void 0?arguments.length<2?"":e0:Ss(t0)},Ps=ht("toStringTag"),Ls=Error,ks=[].push,Ms=function(t0,e0){var n0,r0=Rs(Us,this);Is?n0=Is(Ls(),r0?Cs(this):Us):(n0=r0?this:ys(Us),As(n0,Ps,"Error")),e0!==void 0&&As(n0,"message",Ds(e0)),Os(n0,Ms,n0.stack,1),arguments.length>2&&ws(n0,arguments[2]);var i0=[];return Ns(t0,ks,{that:i0}),As(n0,"errors",i0),n0};Is?Is(Ms,Ls):vs(Ms,Ls,{name:!0});var Us=Ms.prototype=ys(Ls.prototype,{constructor:bs(1,Ms),message:bs(1,""),name:bs(1,"AggregateError")});gs({global:!0,constructor:!0,arity:2},{AggregateError:Ms});var xs,Vs,Fs,Bs=w,js=h.WeakMap,Gs=Bs(js)&&/native code/.test(String(js)),Ws=h,Hs=te,Ks=fi,Ys=Ze,qs=He,zs=lr,Js=Nr,Xs="Object already initialized",Qs=Ws.TypeError,Zs=Ws.WeakMap;if(Gs||qs.state){var $s=qs.state||(qs.state=new Zs);$s.get=$s.get,$s.has=$s.has,$s.set=$s.set,xs=function(t0,e0){if($s.has(t0))throw Qs(Xs);return e0.facade=t0,$s.set(t0,e0),e0},Vs=function(t0){return $s.get(t0)||{}},Fs=function(t0){return $s.has(t0)}}else{var ea=zs("state");Js[ea]=!0,xs=function(t0,e0){if(Ys(t0,ea))throw Qs(Xs);return e0.facade=t0,Ks(t0,ea,e0),e0},Vs=function(t0){return Ys(t0,ea)?t0[ea]:{}},Fs=function(t0){return Ys(t0,ea)}}var ta,ia,na,ra={set:xs,get:Vs,has:Fs,enforce:function(t0){return Fs(t0)?Vs(t0):xs(t0,{})},getterFor:function(t0){return function(e0){var n0;if(!Hs(e0)||(n0=Vs(e0)).type!==t0)throw Qs("Incompatible receiver, "+t0+" required");return n0}}},oa=N,sa=Ze,aa=Function.prototype,ca=oa&&Object.getOwnPropertyDescriptor,da=sa(aa,"name"),la={EXISTS:da,PROPER:da&&(function(){}).name==="something",CONFIGURABLE:da&&(!oa||oa&&ca(aa,"name").configurable)},ua=fi,ha=function(t0,e0,n0,r0){return r0&&r0.enumerable?t0[e0]=n0:ua(t0,e0,n0),t0},pa=n,_a=w,Ea=te,fa=Io,ma=Sr,Ta=ha,Sa=ht("iterator"),ga=!1;[].keys&&("next"in(na=[].keys())?(ia=ma(ma(na)))!==Object.prototype&&(ta=ia):ga=!0);var Ra=!Ea(ta)||pa(function(){var t0={};return ta[Sa].call(t0)!==t0});_a((ta=Ra?{}:fa(ta))[Sa])||Ta(ta,Sa,function(){return this});var Ca={IteratorPrototype:ta,BUGGY_SAFARI_ITERATORS:ga},Ia=pn,va=sn?{}.toString:function(){return"[object "+Ia(this)+"]"},ya=sn,Aa=Qt.f,ba=fi,wa=Ze,Oa=va,Na=ht("toStringTag"),Da=function(t0,e0,n0,r0){if(t0){var i0=n0?t0:t0.prototype;wa(i0,Na)||Aa(i0,Na,{configurable:!0,value:e0}),r0&&!ya&&ba(i0,"toString",Oa)}},Pa=Ca.IteratorPrototype,La=Io,ka=B,Ma=Da,Ua=xo,xa=function(){return this},Va=function(t0,e0,n0,r0){var i0=e0+" Iterator";return t0.prototype=La(Pa,{next:ka(+!r0,n0)}),Ma(t0,i0,!1,!0),Ua[i0]=xa,t0},Fa=wi,Ba=L,ja=la,Ga=Va,Wa=Sr,Ha=Da,Ka=ha,Ya=xo,qa=Ca,za=ja.PROPER,Ja=qa.BUGGY_SAFARI_ITERATORS,Xa=ht("iterator"),Qa="keys",Za="values",$a="entries",ec=function(){return this},tc=function(t0,e0,n0,r0,i0,o0,s0){Ga(n0,e0,r0);var a0,c0,u0,l0=function(E0){if(E0===i0&&f0)return f0;if(!Ja&&E0 in p0)return p0[E0];switch(E0){case Qa:case Za:case $a:return function(){return new n0(this,E0)}}return function(){return new n0(this)}},d0=e0+" Iterator",h0=!1,p0=t0.prototype,m0=p0[Xa]||p0["@@iterator"]||i0&&p0[i0],f0=!Ja&&m0||l0(i0),g0=e0=="Array"&&p0.entries||m0;if(g0&&(a0=Wa(g0.call(new t0)))!==Object.prototype&&a0.next&&(Ha(a0,d0,!0,!0),Ya[d0]=ec),za&&i0==Za&&m0&&m0.name!==Za&&(h0=!0,f0=function(){return Ba(m0,this)}),i0)if(c0={values:l0(Za),keys:o0?f0:l0(Qa),entries:l0($a)},s0)for(u0 in c0)(Ja||h0||!(u0 in p0))&&Ka(p0,u0,c0[u0]);else Fa({target:e0,proto:!0,forced:Ja||h0},c0);return s0&&p0[Xa]!==f0&&Ka(p0,Xa,f0,{name:i0}),Ya[e0]=f0,c0},ic=function(t0,e0){return{value:t0,done:e0}},nc=Z,rc=xo,oc=ra;Qt.f;var sc=tc,ac=ic,cc="Array Iterator",dc=oc.set,lc=oc.getterFor(cc);sc(Array,"Array",function(t0,e0){dc(this,{type:cc,target:nc(t0),index:0,kind:e0})},function(){var t0=lc(this),e0=t0.target,n0=t0.kind,r0=t0.index++;return!e0||r0>=e0.length?(t0.target=void 0,ac(void 0,!0)):ac(n0=="keys"?r0:n0=="values"?e0[r0]:[r0,e0[r0]],!1)},"values"),rc.Arguments=rc.Array;var uc=Qt,hc=function(t0,e0,n0){return uc.f(t0,e0,n0)},pc=ae,_c=hc,Ec=N,fc=ht("species"),mc=l,Tc=TypeError,Sc=function(t0,e0){if(mc(e0,t0))return t0;throw Tc("Incorrect invocation")},gc=w,Rc=He,Cc=d(Function.toString);gc(Rc.inspectSource)||(Rc.inspectSource=function(t0){return Cc(t0)});var Ic=Rc.inspectSource,vc=d,yc=n,Ac=w,bc=pn,wc=Ic,Oc=function(){},Nc=[],Dc=ae("Reflect","construct"),Pc=/^\s*(?:class|function)\b/,Lc=vc(Pc.exec),kc=!Pc.exec(Oc),Mc=function(t0){if(!Ac(t0))return!1;try{return Dc(Oc,Nc,t0),!0}catch{return!1}},Uc=function(t0){if(!Ac(t0))return!1;switch(bc(t0)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return kc||!!Lc(Pc,wc(t0))}catch{return!0}};Uc.sham=!0;var xc,Vc,Fc,Bc,jc=!Dc||yc(function(){var t0;return Mc(Mc.call)||!Mc(Object)||!Mc(function(){t0=!0})||t0})?Uc:Mc,Gc=jc,Wc=be,Hc=TypeError,Kc=ii,Yc=function(t0){if(Gc(t0))return t0;throw Hc(Wc(t0)+" is not a constructor")},qc=Y,zc=ht("species"),Jc=function(t0,e0){var n0,r0=Kc(t0).constructor;return r0===void 0||qc(n0=Kc(r0)[zc])?e0:Yc(n0)},Xc=d([].slice),Qc=TypeError,Zc=function(t0,e0){if(t0<e0)throw Qc("Not enough arguments");return t0},$c=/(?:ipad|iphone|ipod).*applewebkit/i.test(ce),ed=h,td=m,id=Xt,nd=w,rd=Ze,od=n,sd=co,ad=Xc,cd=At,dd=Zc,ld=$c,ud=jn,hd=ed.setImmediate,pd=ed.clearImmediate,_d=ed.process,Ed=ed.Dispatch,fd=ed.Function,md=ed.MessageChannel,Td=ed.String,Sd=0,gd={},Rd="onreadystatechange";od(function(){xc=ed.location});var Cd=function(t0){if(rd(gd,t0)){var e0=gd[t0];delete gd[t0],e0()}},Id=function(t0){return function(){Cd(t0)}},vd=function(t0){Cd(t0.data)},yd=function(t0){ed.postMessage(Td(t0),xc.protocol+"//"+xc.host)};hd&&pd||(hd=function(t0){dd(arguments.length,1);var e0=nd(t0)?t0:fd(t0),n0=ad(arguments,1);return gd[++Sd]=function(){td(e0,void 0,n0)},Vc(Sd),Sd},pd=function(t0){delete gd[t0]},ud?Vc=function(t0){_d.nextTick(Id(t0))}:Ed&&Ed.now?Vc=function(t0){Ed.now(Id(t0))}:md&&!ld?(Bc=(Fc=new md).port2,Fc.port1.onmessage=vd,Vc=id(Bc.postMessage,Bc)):ed.addEventListener&&nd(ed.postMessage)&&!ed.importScripts&&xc&&xc.protocol!=="file:"&&!od(yd)?(Vc=yd,ed.addEventListener("message",vd,!1)):Vc=Rd in cd("script")?function(t0){sd.appendChild(cd("script"))[Rd]=function(){sd.removeChild(this),Cd(t0)}}:function(t0){setTimeout(Id(t0),0)});var Ad={set:hd,clear:pd},bd=function(){this.head=null,this.tail=null};bd.prototype={add:function(t0){var e0={item:t0,next:null},n0=this.tail;n0?n0.next=e0:this.head=e0,this.tail=e0},get:function(){var t0=this.head;if(t0)return(this.head=t0.next)===null&&(this.tail=null),t0.item}};var wd,Od,Nd,Dd,Pd,Ld=bd,kd=/ipad|iphone|ipod/i.test(ce)&&typeof Pebble<"u",Md=/web0s(?!.*chrome)/i.test(ce),Ud=h,xd=Xt,Vd=O.f,Fd=Ad.set,Bd=Ld,jd=$c,Gd=kd,Wd=Md,Hd=jn,Kd=Ud.MutationObserver||Ud.WebKitMutationObserver,Yd=Ud.document,qd=Ud.process,zd=Ud.Promise,Jd=Vd(Ud,"queueMicrotask"),Xd=Jd&&Jd.value;if(!Xd){var Qd=new Bd,Zd=function(){var t0,e0;for(Hd&&(t0=qd.domain)&&t0.exit();e0=Qd.get();)try{e0()}catch(n0){throw Qd.head&&wd(),n0}t0&&t0.enter()};jd||Hd||Wd||!Kd||!Yd?!Gd&&zd&&zd.resolve?((Dd=zd.resolve(void 0)).constructor=zd,Pd=xd(Dd.then,Dd),wd=function(){Pd(Zd)}):Hd?wd=function(){qd.nextTick(Zd)}:(Fd=xd(Fd,Ud),wd=function(){Fd(Zd)}):(Od=!0,Nd=Yd.createTextNode(""),new Kd(Zd).observe(Nd,{characterData:!0}),wd=function(){Nd.data=Od=!Od}),Xd=function(t0){Qd.head||wd(),Qd.add(t0)}}var $d=Xd,el=function(t0){try{return{error:!1,value:t0()}}catch(e0){return{error:!0,value:e0}}},tl=h.Promise,il=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",nl=!il&&!jn&&typeof window=="object"&&typeof document=="object",rl=h,ol=tl,sl=w,al=Yt,cl=Ic,dl=ht,ll=nl,ul=il,hl=Ee,pl=ol&&ol.prototype,_l=dl("species"),El=!1,fl=sl(rl.PromiseRejectionEvent),ml=al("Promise",function(){var t0=cl(ol),e0=t0!==String(ol);if(!e0&&hl===66||!pl.catch||!pl.finally)return!0;if(!hl||hl<51||!/native code/.test(t0)){var n0=new ol(function(i0){i0(1)}),r0=function(i0){i0(function(){},function(){})};if((n0.constructor={})[_l]=r0,!(El=n0.then(function(){})instanceof r0))return!0}return!e0&&(ll||ul)&&!fl}),Tl={CONSTRUCTOR:ml,REJECTION_EVENT:fl,SUBCLASSING:El},Sl={},gl=De,Rl=TypeError,Cl=function(t0){var e0,n0;this.promise=new t0(function(r0,i0){if(e0!==void 0||n0!==void 0)throw Rl("Bad Promise constructor");e0=r0,n0=i0}),this.resolve=gl(e0),this.reject=gl(n0)};Sl.f=function(t0){return new Cl(t0)};var Il,vl,yl=wi,Al=jn,bl=h,wl=L,Ol=ha,Nl=Da,Dl=function(t0){var e0=pc(t0);Ec&&e0&&!e0[fc]&&_c(e0,fc,{configurable:!0,get:function(){return this}})},Pl=De,Ll=w,kl=te,Ml=Sc,Ul=Jc,xl=Ad.set,Vl=$d,Fl=function(t0,e0){try{arguments.length==1?console.error(t0):console.error(t0,e0)}catch{}},Bl=el,jl=Ld,Gl=ra,Wl=tl,Hl=Tl,Kl=Sl,Yl="Promise",ql=Hl.CONSTRUCTOR,zl=Hl.REJECTION_EVENT,Jl=Gl.getterFor(Yl),Xl=Gl.set,Ql=Wl&&Wl.prototype,Zl=Wl,$l=Ql,eu=bl.TypeError,tu=bl.document,iu=bl.process,nu=Kl.f,ru=nu,ou=!!(tu&&tu.createEvent&&bl.dispatchEvent),su="unhandledrejection",au=function(t0){var e0;return!(!kl(t0)||!Ll(e0=t0.then))&&e0},cu=function(t0,e0){var n0,r0,i0,o0=e0.value,s0=e0.state==1,a0=s0?t0.ok:t0.fail,c0=t0.resolve,u0=t0.reject,l0=t0.domain;try{a0?(s0||(e0.rejection===2&&pu(e0),e0.rejection=1),a0===!0?n0=o0:(l0&&l0.enter(),n0=a0(o0),l0&&(l0.exit(),i0=!0)),n0===t0.promise?u0(eu("Promise-chain cycle")):(r0=au(n0))?wl(r0,n0,c0,u0):c0(n0)):u0(o0)}catch(d0){l0&&!i0&&l0.exit(),u0(d0)}},du=function(t0,e0){t0.notified||(t0.notified=!0,Vl(function(){for(var n0,r0=t0.reactions;n0=r0.get();)cu(n0,t0);t0.notified=!1,e0&&!t0.rejection&&uu(t0)}))},lu=function(t0,e0,n0){var r0,i0;ou?((r0=tu.createEvent("Event")).promise=e0,r0.reason=n0,r0.initEvent(t0,!1,!0),bl.dispatchEvent(r0)):r0={promise:e0,reason:n0},!zl&&(i0=bl["on"+t0])?i0(r0):t0===su&&Fl("Unhandled promise rejection",n0)},uu=function(t0){wl(xl,bl,function(){var e0,n0=t0.facade,r0=t0.value;if(hu(t0)&&(e0=Bl(function(){Al?iu.emit("unhandledRejection",r0,n0):lu(su,n0,r0)}),t0.rejection=Al||hu(t0)?2:1,e0.error))throw e0.value})},hu=function(t0){return t0.rejection!==1&&!t0.parent},pu=function(t0){wl(xl,bl,function(){var e0=t0.facade;Al?iu.emit("rejectionHandled",e0):lu("rejectionhandled",e0,t0.value)})},_u=function(t0,e0,n0){return function(r0){t0(e0,r0,n0)}},Eu=function(t0,e0,n0){t0.done||(t0.done=!0,n0&&(t0=n0),t0.value=e0,t0.state=2,du(t0,!0))},fu=function(t0,e0,n0){if(!t0.done){t0.done=!0,n0&&(t0=n0);try{if(t0.facade===e0)throw eu("Promise can't be resolved itself");var r0=au(e0);r0?Vl(function(){var i0={done:!1};try{wl(r0,e0,_u(fu,i0,t0),_u(Eu,i0,t0))}catch(o0){Eu(i0,o0,t0)}}):(t0.value=e0,t0.state=1,du(t0,!1))}catch(i0){Eu({done:!1},i0,t0)}}};ql&&($l=(Zl=function(t0){Ml(this,$l),Pl(t0),wl(Il,this);var e0=Jl(this);try{t0(_u(fu,e0),_u(Eu,e0))}catch(n0){Eu(e0,n0)}}).prototype,(Il=function(t0){Xl(this,{type:Yl,done:!1,notified:!1,parent:!1,reactions:new jl,rejection:!1,state:0,value:void 0})}).prototype=Ol($l,"then",function(t0,e0){var n0=Jl(this),r0=nu(Ul(this,Zl));return n0.parent=!0,r0.ok=!Ll(t0)||t0,r0.fail=Ll(e0)&&e0,r0.domain=Al?iu.domain:void 0,n0.state==0?n0.reactions.add(r0):Vl(function(){cu(r0,n0)}),r0.promise}),vl=function(){var t0=new Il,e0=Jl(t0);this.promise=t0,this.resolve=_u(fu,e0),this.reject=_u(Eu,e0)},Kl.f=nu=function(t0){return t0===Zl||t0===void 0?new vl(t0):ru(t0)}),yl({global:!0,constructor:!0,wrap:!0,forced:ql},{Promise:Zl}),Nl(Zl,Yl,!1,!0),Dl(Yl);var mu=ht("iterator"),Tu=!1;try{var Su=0,gu={next:function(){return{done:!!Su++}},return:function(){Tu=!0}};gu[mu]=function(){return this},Array.from(gu,function(){throw 2})}catch{}var Ru=tl,Cu=function(t0,e0){if(!e0&&!Tu)return!1;var n0=!1;try{var r0={};r0[mu]=function(){return{next:function(){return{done:n0=!0}}}},t0(r0)}catch{}return n0},Iu=Tl.CONSTRUCTOR||!Cu(function(t0){Ru.all(t0).then(void 0,function(){})}),vu=L,yu=De,Au=Sl,bu=el,wu=Ts;wi({target:"Promise",stat:!0,forced:Iu},{all:function(t0){var e0=this,n0=Au.f(e0),r0=n0.resolve,i0=n0.reject,o0=bu(function(){var s0=yu(e0.resolve),a0=[],c0=0,u0=1;wu(t0,function(l0){var d0=c0++,h0=!1;u0++,vu(s0,e0,l0).then(function(p0){h0||(h0=!0,a0[d0]=p0,--u0||r0(a0))},i0)}),--u0||r0(a0)});return o0.error&&i0(o0.value),n0.promise}});var Ou=wi,Nu=Tl.CONSTRUCTOR;tl&&tl.prototype,Ou({target:"Promise",proto:!0,forced:Nu,real:!0},{catch:function(t0){return this.then(void 0,t0)}});var Du=L,Pu=De,Lu=Sl,ku=el,Mu=Ts;wi({target:"Promise",stat:!0,forced:Iu},{race:function(t0){var e0=this,n0=Lu.f(e0),r0=n0.reject,i0=ku(function(){var o0=Pu(e0.resolve);Mu(t0,function(s0){Du(o0,e0,s0).then(n0.resolve,r0)})});return i0.error&&r0(i0.value),n0.promise}});var Uu=L,xu=Sl;wi({target:"Promise",stat:!0,forced:Tl.CONSTRUCTOR},{reject:function(t0){var e0=xu.f(this);return Uu(e0.reject,void 0,t0),e0.promise}});var Vu=ii,Fu=te,Bu=Sl,ju=function(t0,e0){if(Vu(t0),Fu(e0)&&e0.constructor===t0)return e0;var n0=Bu.f(t0);return(0,n0.resolve)(e0),n0.promise},Gu=wi,Wu=tl,Hu=Tl.CONSTRUCTOR,Ku=ju,Yu=ae("Promise"),qu=!Hu;Gu({target:"Promise",stat:!0,forced:!0},{resolve:function(t0){return Ku(qu&&this===Yu?Wu:this,t0)}});var zu=L,Ju=De,Xu=Sl,Qu=el,Zu=Ts;wi({target:"Promise",stat:!0,forced:Iu},{allSettled:function(t0){var e0=this,n0=Xu.f(e0),r0=n0.resolve,i0=n0.reject,o0=Qu(function(){var s0=Ju(e0.resolve),a0=[],c0=0,u0=1;Zu(t0,function(l0){var d0=c0++,h0=!1;u0++,zu(s0,e0,l0).then(function(p0){h0||(h0=!0,a0[d0]={status:"fulfilled",value:p0},--u0||r0(a0))},function(p0){h0||(h0=!0,a0[d0]={status:"rejected",reason:p0},--u0||r0(a0))})}),--u0||r0(a0)});return o0.error&&i0(o0.value),n0.promise}});var $u=L,eh=De,th=ae,ih=Sl,nh=el,rh=Ts,oh="No one promise resolved";wi({target:"Promise",stat:!0,forced:Iu},{any:function(t0){var e0=this,n0=th("AggregateError"),r0=ih.f(e0),i0=r0.resolve,o0=r0.reject,s0=nh(function(){var a0=eh(e0.resolve),c0=[],u0=0,l0=1,d0=!1;rh(t0,function(h0){var p0=u0++,m0=!1;l0++,$u(a0,e0,h0).then(function(f0){m0||d0||(d0=!0,i0(f0))},function(f0){m0||d0||(m0=!0,c0[p0]=f0,--l0||o0(new n0(c0,oh)))})}),--l0||o0(new n0(c0,oh))});return s0.error&&o0(s0.value),r0.promise}});var sh=wi,ah=tl,ch=n,dh=ae,lh=w,uh=Jc,hh=ju,ph=ah&&ah.prototype;sh({target:"Promise",proto:!0,real:!0,forced:!!ah&&ch(function(){ph.finally.call({then:function(){}},function(){})})},{finally:function(t0){var e0=uh(this,dh("Promise")),n0=lh(t0);return this.then(n0?function(r0){return hh(e0,t0()).then(function(){return r0})}:t0,n0?function(r0){return hh(e0,t0()).then(function(){throw r0})}:t0)}});var _h=d,Eh=Li,fh=fn,mh=J,Th=_h("".charAt),Sh=_h("".charCodeAt),gh=_h("".slice),Rh=function(t0){return function(e0,n0){var r0,i0,o0=fh(mh(e0)),s0=Eh(n0),a0=o0.length;return s0<0||s0>=a0?t0?"":void 0:(r0=Sh(o0,s0))<55296||r0>56319||s0+1===a0||(i0=Sh(o0,s0+1))<56320||i0>57343?t0?Th(o0,s0):r0:t0?gh(o0,s0,s0+2):i0-56320+(r0-55296<<10)+65536}},Ch={codeAt:Rh(!1),charAt:Rh(!0)},Ih=Ch.charAt,vh=fn,yh=ra,Ah=tc,bh=ic,wh="String Iterator",Oh=yh.set,Nh=yh.getterFor(wh);Ah(String,"String",function(t0){Oh(this,{type:wh,string:vh(t0),index:0})},function(){var t0,e0=Nh(this),n0=e0.string,r0=e0.index;return r0>=n0.length?bh(void 0,!0):(t0=Ih(n0,r0),e0.index+=t0.length,bh(t0,!1))});var Dh=ie.Promise,Ph={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Lh=h,kh=pn,Mh=fi,Uh=xo,xh=ht("toStringTag");for(var Vh in Ph){var Fh=Lh[Vh],Bh=Fh&&Fh.prototype;Bh&&kh(Bh)!==xh&&Mh(Bh,xh,Vh),Uh[Vh]=Uh.Array}var jh=Dh,Gh=i(jh);const Wh=ir;function Hh(t0,e0){const n0=t0&&t0.navigator;if(!n0.mediaDevices)return;const r0=function(s0){if(typeof s0!="object"||s0.mandatory||s0.optional)return s0;const a0={};return Object.keys(s0).forEach(c0=>{if(c0==="require"||c0==="advanced"||c0==="mediaSource")return;const u0=typeof s0[c0]=="object"?s0[c0]:{ideal:s0[c0]};u0.exact!==void 0&&typeof u0.exact=="number"&&(u0.min=u0.max=u0.exact);const l0=function(d0,h0){return d0?d0+h0.charAt(0).toUpperCase()+h0.slice(1):h0==="deviceId"?"sourceId":h0};if(u0.ideal!==void 0){a0.optional=a0.optional||[];let d0={};typeof u0.ideal=="number"?(d0[l0("min",c0)]=u0.ideal,a0.optional.push(d0),d0={},d0[l0("max",c0)]=u0.ideal,a0.optional.push(d0)):(d0[l0("",c0)]=u0.ideal,a0.optional.push(d0))}u0.exact!==void 0&&typeof u0.exact!="number"?(a0.mandatory=a0.mandatory||{},a0.mandatory[l0("",c0)]=u0.exact):["min","max"].forEach(d0=>{u0[d0]!==void 0&&(a0.mandatory=a0.mandatory||{},a0.mandatory[l0(d0,c0)]=u0[d0])})}),s0.advanced&&(a0.optional=(a0.optional||[]).concat(s0.advanced)),a0},i0=function(s0,a0){if(e0.version>=61)return a0(s0);if((s0=JSON.parse(JSON.stringify(s0)))&&typeof s0.audio=="object"){const c0=function(u0,l0,d0){l0 in u0&&!(d0 in u0)&&(u0[d0]=u0[l0],delete u0[l0])};c0((s0=JSON.parse(JSON.stringify(s0))).audio,"autoGainControl","googAutoGainControl"),c0(s0.audio,"noiseSuppression","googNoiseSuppression"),s0.audio=r0(s0.audio)}if(s0&&typeof s0.video=="object"){let c0=s0.video.facingMode;c0=c0&&(typeof c0=="object"?c0:{ideal:c0});const u0=e0.version<66;if(c0&&(c0.exact==="user"||c0.exact==="environment"||c0.ideal==="user"||c0.ideal==="environment")&&(!n0.mediaDevices.getSupportedConstraints||!n0.mediaDevices.getSupportedConstraints().facingMode||u0)){let l0;if(delete s0.video.facingMode,c0.exact==="environment"||c0.ideal==="environment"?l0=["back","rear"]:c0.exact!=="user"&&c0.ideal!=="user"||(l0=["front"]),l0)return n0.mediaDevices.enumerateDevices().then(d0=>{let h0=(d0=d0.filter(p0=>p0.kind==="videoinput")).find(p0=>l0.some(m0=>{var f0;return Dn(f0=p0.label.toLowerCase()).call(f0,m0)}));return!h0&&d0.length&&Dn(l0).call(l0,"back")&&(h0=d0[d0.length-1]),h0&&(s0.video.deviceId=c0.exact?{exact:h0.deviceId}:{ideal:h0.deviceId}),s0.video=r0(s0.video),Wh("chrome: "+JSON.stringify(s0)),a0(s0)})}s0.video=r0(s0.video)}return Wh("chrome: "+JSON.stringify(s0)),a0(s0)},o0=function(s0){return e0.version>=64?s0:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s0.name]||s0.name,message:s0.message,constraint:s0.constraint||s0.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n0.getUserMedia=(function(s0,a0,c0){i0(s0,u0=>{n0.webkitGetUserMedia(u0,a0,l0=>{c0&&c0(o0(l0))})})}).bind(n0),n0.mediaDevices.getUserMedia){const s0=n0.mediaDevices.getUserMedia.bind(n0.mediaDevices);n0.mediaDevices.getUserMedia=function(a0){return i0(a0,c0=>s0(c0).then(u0=>{if(c0.audio&&!u0.getAudioTracks().length||c0.video&&!u0.getVideoTracks().length)throw u0.getTracks().forEach(l0=>{l0.stop()}),new DOMException("","NotFoundError");return u0},u0=>Gh.reject(o0(u0))))}}}function Kh(t0){t0.MediaStream=t0.MediaStream||t0.webkitMediaStream}function Yh(t0){if(typeof t0=="object"&&t0.RTCPeerConnection&&!("ontrack"in t0.RTCPeerConnection.prototype)){Object.defineProperty(t0.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n0){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n0)},enumerable:!0,configurable:!0});const e0=t0.RTCPeerConnection.prototype.setRemoteDescription;t0.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n0=>{n0.stream.addEventListener("addtrack",r0=>{let i0;i0=t0.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s0=>s0.track&&s0.track.id===r0.track.id):{track:r0.track};const o0=new Event("track");o0.track=r0.track,o0.receiver=i0,o0.transceiver={receiver:i0},o0.streams=[n0.stream],this.dispatchEvent(o0)}),n0.stream.getTracks().forEach(r0=>{let i0;i0=t0.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s0=>s0.track&&s0.track.id===r0.id):{track:r0};const o0=new Event("track");o0.track=r0,o0.receiver=i0,o0.transceiver={receiver:i0},o0.streams=[n0.stream],this.dispatchEvent(o0)})},this.addEventListener("addstream",this._ontrackpoly)),e0.apply(this,arguments)}}else $n(t0,"track",e0=>(e0.transceiver||Object.defineProperty(e0,"transceiver",{value:{receiver:e0.receiver}}),e0))}function qh(t0){if(typeof t0=="object"&&t0.RTCPeerConnection&&!("getSenders"in t0.RTCPeerConnection.prototype)&&"createDTMFSender"in t0.RTCPeerConnection.prototype){const e0=function(i0,o0){return{track:o0,get dtmf(){return this._dtmf===void 0&&(o0.kind==="audio"?this._dtmf=i0.createDTMFSender(o0):this._dtmf=null),this._dtmf},_pc:i0}};if(!t0.RTCPeerConnection.prototype.getSenders){t0.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i0=t0.RTCPeerConnection.prototype.addTrack;t0.RTCPeerConnection.prototype.addTrack=function(s0,a0){let c0=i0.apply(this,arguments);return c0||(c0=e0(this,s0),this._senders.push(c0)),c0};const o0=t0.RTCPeerConnection.prototype.removeTrack;t0.RTCPeerConnection.prototype.removeTrack=function(s0){o0.apply(this,arguments);const a0=this._senders.indexOf(s0);a0!==-1&&this._senders.splice(a0,1)}}const n0=t0.RTCPeerConnection.prototype.addStream;t0.RTCPeerConnection.prototype.addStream=function(i0){this._senders=this._senders||[],n0.apply(this,[i0]),i0.getTracks().forEach(o0=>{this._senders.push(e0(this,o0))})};const r0=t0.RTCPeerConnection.prototype.removeStream;t0.RTCPeerConnection.prototype.removeStream=function(i0){this._senders=this._senders||[],r0.apply(this,[i0]),i0.getTracks().forEach(o0=>{const s0=this._senders.find(a0=>a0.track===o0);s0&&this._senders.splice(this._senders.indexOf(s0),1)})}}else if(typeof t0=="object"&&t0.RTCPeerConnection&&"getSenders"in t0.RTCPeerConnection.prototype&&"createDTMFSender"in t0.RTCPeerConnection.prototype&&t0.RTCRtpSender&&!("dtmf"in t0.RTCRtpSender.prototype)){const e0=t0.RTCPeerConnection.prototype.getSenders;t0.RTCPeerConnection.prototype.getSenders=function(){const n0=e0.apply(this,[]);return n0.forEach(r0=>r0._pc=this),n0},Object.defineProperty(t0.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function zh(t0){if(!t0.RTCPeerConnection)return;const e0=t0.RTCPeerConnection.prototype.getStats;t0.RTCPeerConnection.prototype.getStats=function(){const[n0,r0,i0]=arguments;if(arguments.length>0&&typeof n0=="function")return e0.apply(this,arguments);if(e0.length===0&&(arguments.length===0||typeof n0!="function"))return e0.apply(this,[]);const o0=function(a0){const c0={};return a0.result().forEach(u0=>{const l0={id:u0.id,timestamp:u0.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u0.type]||u0.type};u0.names().forEach(d0=>{l0[d0]=u0.stat(d0)}),c0[l0.id]=l0}),c0},s0=function(a0){return new Map(Object.keys(a0).map(c0=>[c0,a0[c0]]))};if(arguments.length>=2){const a0=function(c0){r0(s0(o0(c0)))};return e0.apply(this,[a0,n0])}return new Gh((a0,c0)=>{e0.apply(this,[function(u0){a0(s0(o0(u0)))},c0])}).then(r0,i0)}}function Jh(t0){if(!(typeof t0=="object"&&t0.RTCPeerConnection&&t0.RTCRtpSender&&t0.RTCRtpReceiver))return;if(!("getStats"in t0.RTCRtpSender.prototype)){const n0=t0.RTCPeerConnection.prototype.getSenders;n0&&(t0.RTCPeerConnection.prototype.getSenders=function(){const i0=n0.apply(this,[]);return i0.forEach(o0=>o0._pc=this),i0});const r0=t0.RTCPeerConnection.prototype.addTrack;r0&&(t0.RTCPeerConnection.prototype.addTrack=function(){const i0=r0.apply(this,arguments);return i0._pc=this,i0}),t0.RTCRtpSender.prototype.getStats=function(){const i0=this;return this._pc.getStats().then(o0=>ar(o0,i0.track,!0))}}if(!("getStats"in t0.RTCRtpReceiver.prototype)){const n0=t0.RTCPeerConnection.prototype.getReceivers;n0&&(t0.RTCPeerConnection.prototype.getReceivers=function(){const r0=n0.apply(this,[]);return r0.forEach(i0=>i0._pc=this),r0}),$n(t0,"track",r0=>(r0.receiver._pc=r0.srcElement,r0)),t0.RTCRtpReceiver.prototype.getStats=function(){const r0=this;return this._pc.getStats().then(i0=>ar(i0,r0.track,!1))}}if(!("getStats"in t0.RTCRtpSender.prototype)||!("getStats"in t0.RTCRtpReceiver.prototype))return;const e0=t0.RTCPeerConnection.prototype.getStats;t0.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t0.MediaStreamTrack){const n0=arguments[0];let r0,i0,o0;return this.getSenders().forEach(s0=>{s0.track===n0&&(r0?o0=!0:r0=s0)}),this.getReceivers().forEach(s0=>(s0.track===n0&&(i0?o0=!0:i0=s0),s0.track===n0)),o0||r0&&i0?Gh.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r0?r0.getStats():i0?i0.getStats():Gh.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e0.apply(this,arguments)}}function Xh(t0){t0.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o0=>this._shimmedLocalStreams[o0][0])};const e0=t0.RTCPeerConnection.prototype.addTrack;t0.RTCPeerConnection.prototype.addTrack=function(o0,s0){if(!s0)return e0.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const a0=e0.apply(this,arguments);return this._shimmedLocalStreams[s0.id]?this._shimmedLocalStreams[s0.id].indexOf(a0)===-1&&this._shimmedLocalStreams[s0.id].push(a0):this._shimmedLocalStreams[s0.id]=[s0,a0],a0};const n0=t0.RTCPeerConnection.prototype.addStream;t0.RTCPeerConnection.prototype.addStream=function(o0){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o0.getTracks().forEach(c0=>{if(this.getSenders().find(l0=>l0.track===c0))throw new DOMException("Track already exists.","InvalidAccessError")});const s0=this.getSenders();n0.apply(this,arguments);const a0=this.getSenders().filter(c0=>s0.indexOf(c0)===-1);this._shimmedLocalStreams[o0.id]=[o0].concat(a0)};const r0=t0.RTCPeerConnection.prototype.removeStream;t0.RTCPeerConnection.prototype.removeStream=function(o0){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o0.id],r0.apply(this,arguments)};const i0=t0.RTCPeerConnection.prototype.removeTrack;t0.RTCPeerConnection.prototype.removeTrack=function(o0){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o0&&Object.keys(this._shimmedLocalStreams).forEach(s0=>{const a0=this._shimmedLocalStreams[s0].indexOf(o0);a0!==-1&&this._shimmedLocalStreams[s0].splice(a0,1),this._shimmedLocalStreams[s0].length===1&&delete this._shimmedLocalStreams[s0]}),i0.apply(this,arguments)}}function Qh(t0,e0){if(!t0.RTCPeerConnection)return;if(t0.RTCPeerConnection.prototype.addTrack&&e0.version>=65)return Xh(t0);const n0=t0.RTCPeerConnection.prototype.getLocalStreams;t0.RTCPeerConnection.prototype.getLocalStreams=function(){const c0=n0.apply(this);return this._reverseStreams=this._reverseStreams||{},c0.map(u0=>this._reverseStreams[u0.id])};const r0=t0.RTCPeerConnection.prototype.addStream;t0.RTCPeerConnection.prototype.addStream=function(c0){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c0.getTracks().forEach(u0=>{if(this.getSenders().find(d0=>d0.track===u0))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c0.id]){const u0=new t0.MediaStream(c0.getTracks());this._streams[c0.id]=u0,this._reverseStreams[u0.id]=c0,c0=u0}r0.apply(this,[c0])};const i0=t0.RTCPeerConnection.prototype.removeStream;function o0(c0,u0){let l0=u0.sdp;return Object.keys(c0._reverseStreams||[]).forEach(d0=>{const h0=c0._reverseStreams[d0],p0=c0._streams[h0.id];l0=l0.replace(new RegExp(p0.id,"g"),h0.id)}),new RTCSessionDescription({type:u0.type,sdp:l0})}t0.RTCPeerConnection.prototype.removeStream=function(c0){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i0.apply(this,[this._streams[c0.id]||c0]),delete this._reverseStreams[this._streams[c0.id]?this._streams[c0.id].id:c0.id],delete this._streams[c0.id]},t0.RTCPeerConnection.prototype.addTrack=function(c0,u0){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const l0=[].slice.call(arguments,1);if(l0.length!==1||!l0[0].getTracks().find(p0=>p0===c0))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p0=>p0.track===c0))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const h0=this._streams[u0.id];if(h0)h0.addTrack(c0),Gh.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p0=new t0.MediaStream([c0]);this._streams[u0.id]=p0,this._reverseStreams[p0.id]=u0,this.addStream(p0)}return this.getSenders().find(p0=>p0.track===c0)},["createOffer","createAnswer"].forEach(function(c0){const u0=t0.RTCPeerConnection.prototype[c0],l0={[c0](){const d0=arguments;return arguments.length&&typeof arguments[0]=="function"?u0.apply(this,[h0=>{const p0=o0(this,h0);d0[0].apply(null,[p0])},h0=>{d0[1]&&d0[1].apply(null,h0)},arguments[2]]):u0.apply(this,arguments).then(h0=>o0(this,h0))}};t0.RTCPeerConnection.prototype[c0]=l0[c0]});const s0=t0.RTCPeerConnection.prototype.setLocalDescription;t0.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(c0,u0){let l0=u0.sdp;return Object.keys(c0._reverseStreams||[]).forEach(d0=>{const h0=c0._reverseStreams[d0],p0=c0._streams[h0.id];l0=l0.replace(new RegExp(h0.id,"g"),p0.id)}),new RTCSessionDescription({type:u0.type,sdp:l0})}(this,arguments[0]),s0.apply(this,arguments)):s0.apply(this,arguments)};const a0=Object.getOwnPropertyDescriptor(t0.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t0.RTCPeerConnection.prototype,"localDescription",{get(){const c0=a0.get.apply(this);return c0.type===""?c0:o0(this,c0)}}),t0.RTCPeerConnection.prototype.removeTrack=function(c0){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c0._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(c0._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let u0;this._streams=this._streams||{},Object.keys(this._streams).forEach(l0=>{this._streams[l0].getTracks().find(d0=>c0.track===d0)&&(u0=this._streams[l0])}),u0&&(u0.getTracks().length===1?this.removeStream(this._reverseStreams[u0.id]):u0.removeTrack(c0.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Zh(t0,e0){!t0.RTCPeerConnection&&t0.webkitRTCPeerConnection&&(t0.RTCPeerConnection=t0.webkitRTCPeerConnection),t0.RTCPeerConnection&&e0.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n0){const r0=t0.RTCPeerConnection.prototype[n0],i0={[n0](){return arguments[0]=new(n0==="addIceCandidate"?t0.RTCIceCandidate:t0.RTCSessionDescription)(arguments[0]),r0.apply(this,arguments)}};t0.RTCPeerConnection.prototype[n0]=i0[n0]})}function $h(t0,e0){$n(t0,"negotiationneeded",n0=>{const r0=n0.target;if(!(e0.version<72||r0.getConfiguration&&r0.getConfiguration().sdpSemantics==="plan-b")||r0.signalingState==="stable")return n0})}var ep=Object.freeze({__proto__:null,fixNegotiationNeeded:$h,shimAddTrackRemoveTrack:Qh,shimAddTrackRemoveTrackWithNative:Xh,shimGetDisplayMedia:function(t0,e0){t0.navigator.mediaDevices&&"getDisplayMedia"in t0.navigator.mediaDevices||t0.navigator.mediaDevices&&(typeof e0=="function"?t0.navigator.mediaDevices.getDisplayMedia=function(n0){return e0(n0).then(r0=>{const i0=n0.video&&n0.video.width,o0=n0.video&&n0.video.height,s0=n0.video&&n0.video.frameRate;return n0.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r0,maxFrameRate:s0||3}},i0&&(n0.video.mandatory.maxWidth=i0),o0&&(n0.video.mandatory.maxHeight=o0),t0.navigator.mediaDevices.getUserMedia(n0)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:qh,shimGetStats:zh,shimGetUserMedia:Hh,shimMediaStream:Kh,shimOnTrack:Yh,shimPeerConnection:Zh,shimSenderReceiverGetStats:Jh});function tp(t0,e0){const n0=t0&&t0.navigator,r0=t0&&t0.MediaStreamTrack;if(n0.getUserMedia=function(i0,o0,s0){nr("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n0.mediaDevices.getUserMedia(i0).then(o0,s0)},!(e0.version>55&&"autoGainControl"in n0.mediaDevices.getSupportedConstraints())){const i0=function(s0,a0,c0){a0 in s0&&!(c0 in s0)&&(s0[c0]=s0[a0],delete s0[a0])},o0=n0.mediaDevices.getUserMedia.bind(n0.mediaDevices);if(n0.mediaDevices.getUserMedia=function(s0){return typeof s0=="object"&&typeof s0.audio=="object"&&(s0=JSON.parse(JSON.stringify(s0)),i0(s0.audio,"autoGainControl","mozAutoGainControl"),i0(s0.audio,"noiseSuppression","mozNoiseSuppression")),o0(s0)},r0&&r0.prototype.getSettings){const s0=r0.prototype.getSettings;r0.prototype.getSettings=function(){const a0=s0.apply(this,arguments);return i0(a0,"mozAutoGainControl","autoGainControl"),i0(a0,"mozNoiseSuppression","noiseSuppression"),a0}}if(r0&&r0.prototype.applyConstraints){const s0=r0.prototype.applyConstraints;r0.prototype.applyConstraints=function(a0){return this.kind==="audio"&&typeof a0=="object"&&(a0=JSON.parse(JSON.stringify(a0)),i0(a0,"autoGainControl","mozAutoGainControl"),i0(a0,"noiseSuppression","mozNoiseSuppression")),s0.apply(this,[a0])}}}}function ip(t0){typeof t0=="object"&&t0.RTCTrackEvent&&"receiver"in t0.RTCTrackEvent.prototype&&!("transceiver"in t0.RTCTrackEvent.prototype)&&Object.defineProperty(t0.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function np(t0,e0){if(typeof t0!="object"||!t0.RTCPeerConnection&&!t0.mozRTCPeerConnection)return;!t0.RTCPeerConnection&&t0.mozRTCPeerConnection&&(t0.RTCPeerConnection=t0.mozRTCPeerConnection),e0.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i0){const o0=t0.RTCPeerConnection.prototype[i0],s0={[i0](){return arguments[0]=new(i0==="addIceCandidate"?t0.RTCIceCandidate:t0.RTCSessionDescription)(arguments[0]),o0.apply(this,arguments)}};t0.RTCPeerConnection.prototype[i0]=s0[i0]});const n0={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r0=t0.RTCPeerConnection.prototype.getStats;t0.RTCPeerConnection.prototype.getStats=function(){const[i0,o0,s0]=arguments;return r0.apply(this,[i0||null]).then(a0=>{if(e0.version<53&&!o0)try{a0.forEach(c0=>{c0.type=n0[c0.type]||c0.type})}catch(c0){if(c0.name!=="TypeError")throw c0;a0.forEach((u0,l0)=>{a0.set(l0,Object.assign({},u0,{type:n0[u0.type]||u0.type}))})}return a0}).then(o0,s0)}}function rp(t0){if(typeof t0!="object"||!t0.RTCPeerConnection||!t0.RTCRtpSender||t0.RTCRtpSender&&"getStats"in t0.RTCRtpSender.prototype)return;const e0=t0.RTCPeerConnection.prototype.getSenders;e0&&(t0.RTCPeerConnection.prototype.getSenders=function(){const r0=e0.apply(this,[]);return r0.forEach(i0=>i0._pc=this),r0});const n0=t0.RTCPeerConnection.prototype.addTrack;n0&&(t0.RTCPeerConnection.prototype.addTrack=function(){const r0=n0.apply(this,arguments);return r0._pc=this,r0}),t0.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Gh.resolve(new Map)}}function op(t0){if(typeof t0!="object"||!t0.RTCPeerConnection||!t0.RTCRtpSender||t0.RTCRtpSender&&"getStats"in t0.RTCRtpReceiver.prototype)return;const e0=t0.RTCPeerConnection.prototype.getReceivers;e0&&(t0.RTCPeerConnection.prototype.getReceivers=function(){const n0=e0.apply(this,[]);return n0.forEach(r0=>r0._pc=this),n0}),$n(t0,"track",n0=>(n0.receiver._pc=n0.srcElement,n0)),t0.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function sp(t0){t0.RTCPeerConnection&&!("removeStream"in t0.RTCPeerConnection.prototype)&&(t0.RTCPeerConnection.prototype.removeStream=function(e0){nr("removeStream","removeTrack"),this.getSenders().forEach(n0=>{var r0;n0.track&&Dn(r0=e0.getTracks()).call(r0,n0.track)&&this.removeTrack(n0)})})}function ap(t0){t0.DataChannel&&!t0.RTCDataChannel&&(t0.RTCDataChannel=t0.DataChannel)}function cp(t0){if(typeof t0!="object"||!t0.RTCPeerConnection)return;const e0=t0.RTCPeerConnection.prototype.addTransceiver;e0&&(t0.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n0=arguments[1]&&arguments[1].sendEncodings;n0===void 0&&(n0=[]),n0=[...n0];const r0=n0.length>0;r0&&n0.forEach(o0=>{if("rid"in o0&&!/^[a-z0-9]{0,16}$/i.test(o0.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o0&&!(parseFloat(o0.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o0&&!(parseFloat(o0.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i0=e0.apply(this,arguments);if(r0){const{sender:o0}=i0,s0=o0.getParameters();(!("encodings"in s0)||s0.encodings.length===1&&Object.keys(s0.encodings[0]).length===0)&&(s0.encodings=n0,o0.sendEncodings=n0,this.setParametersPromises.push(o0.setParameters(s0).then(()=>{delete o0.sendEncodings}).catch(()=>{delete o0.sendEncodings})))}return i0})}function dp(t0){if(typeof t0!="object"||!t0.RTCRtpSender)return;const e0=t0.RTCRtpSender.prototype.getParameters;e0&&(t0.RTCRtpSender.prototype.getParameters=function(){const n0=e0.apply(this,arguments);return"encodings"in n0||(n0.encodings=[].concat(this.sendEncodings||[{}])),n0})}function lp(t0){if(typeof t0!="object"||!t0.RTCPeerConnection)return;const e0=t0.RTCPeerConnection.prototype.createOffer;t0.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Gh.all(this.setParametersPromises).then(()=>e0.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e0.apply(this,arguments)}}function up(t0){if(typeof t0!="object"||!t0.RTCPeerConnection)return;const e0=t0.RTCPeerConnection.prototype.createAnswer;t0.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Gh.all(this.setParametersPromises).then(()=>e0.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e0.apply(this,arguments)}}var hp=Object.freeze({__proto__:null,shimAddTransceiver:cp,shimCreateAnswer:up,shimCreateOffer:lp,shimGetDisplayMedia:function(t0,e0){t0.navigator.mediaDevices&&"getDisplayMedia"in t0.navigator.mediaDevices||t0.navigator.mediaDevices&&(t0.navigator.mediaDevices.getDisplayMedia=function(n0){if(!n0||!n0.video){const r0=new DOMException("getDisplayMedia without video constraints is undefined");return r0.name="NotFoundError",r0.code=8,Gh.reject(r0)}return n0.video===!0?n0.video={mediaSource:e0}:n0.video.mediaSource=e0,t0.navigator.mediaDevices.getUserMedia(n0)})},shimGetParameters:dp,shimGetUserMedia:tp,shimOnTrack:ip,shimPeerConnection:np,shimRTCDataChannel:ap,shimReceiverGetStats:op,shimRemoveStream:sp,shimSenderGetStats:rp});function pp(t0){if(typeof t0=="object"&&t0.RTCPeerConnection){if("getLocalStreams"in t0.RTCPeerConnection.prototype||(t0.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t0.RTCPeerConnection.prototype)){const e0=t0.RTCPeerConnection.prototype.addTrack;t0.RTCPeerConnection.prototype.addStream=function(n0){var r0;this._localStreams||(this._localStreams=[]),Dn(r0=this._localStreams).call(r0,n0)||this._localStreams.push(n0),n0.getAudioTracks().forEach(i0=>e0.call(this,i0,n0)),n0.getVideoTracks().forEach(i0=>e0.call(this,i0,n0))},t0.RTCPeerConnection.prototype.addTrack=function(n0){for(var r0=arguments.length,i0=new Array(r0>1?r0-1:0),o0=1;o0<r0;o0++)i0[o0-1]=arguments[o0];return i0&&i0.forEach(s0=>{var a0;this._localStreams?Dn(a0=this._localStreams).call(a0,s0)||this._localStreams.push(s0):this._localStreams=[s0]}),e0.apply(this,arguments)}}"removeStream"in t0.RTCPeerConnection.prototype||(t0.RTCPeerConnection.prototype.removeStream=function(e0){this._localStreams||(this._localStreams=[]);const n0=this._localStreams.indexOf(e0);if(n0===-1)return;this._localStreams.splice(n0,1);const r0=e0.getTracks();this.getSenders().forEach(i0=>{Dn(r0).call(r0,i0.track)&&this.removeTrack(i0)})})}}function _p(t0){if(typeof t0=="object"&&t0.RTCPeerConnection&&("getRemoteStreams"in t0.RTCPeerConnection.prototype||(t0.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t0.RTCPeerConnection.prototype))){Object.defineProperty(t0.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n0){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n0),this.addEventListener("track",this._onaddstreampoly=r0=>{r0.streams.forEach(i0=>{var o0;if(this._remoteStreams||(this._remoteStreams=[]),Dn(o0=this._remoteStreams).call(o0,i0))return;this._remoteStreams.push(i0);const s0=new Event("addstream");s0.stream=i0,this.dispatchEvent(s0)})})}});const e0=t0.RTCPeerConnection.prototype.setRemoteDescription;t0.RTCPeerConnection.prototype.setRemoteDescription=function(){const n0=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r0){r0.streams.forEach(i0=>{if(n0._remoteStreams||(n0._remoteStreams=[]),n0._remoteStreams.indexOf(i0)>=0)return;n0._remoteStreams.push(i0);const o0=new Event("addstream");o0.stream=i0,n0.dispatchEvent(o0)})}),e0.apply(n0,arguments)}}}function Ep(t0){if(typeof t0!="object"||!t0.RTCPeerConnection)return;const e0=t0.RTCPeerConnection.prototype,n0=e0.createOffer,r0=e0.createAnswer,i0=e0.setLocalDescription,o0=e0.setRemoteDescription,s0=e0.addIceCandidate;e0.createOffer=function(c0,u0){const l0=arguments.length>=2?arguments[2]:arguments[0],d0=n0.apply(this,[l0]);return u0?(d0.then(c0,u0),Gh.resolve()):d0},e0.createAnswer=function(c0,u0){const l0=arguments.length>=2?arguments[2]:arguments[0],d0=r0.apply(this,[l0]);return u0?(d0.then(c0,u0),Gh.resolve()):d0};let a0=function(c0,u0,l0){const d0=i0.apply(this,[c0]);return l0?(d0.then(u0,l0),Gh.resolve()):d0};e0.setLocalDescription=a0,a0=function(c0,u0,l0){const d0=o0.apply(this,[c0]);return l0?(d0.then(u0,l0),Gh.resolve()):d0},e0.setRemoteDescription=a0,a0=function(c0,u0,l0){const d0=s0.apply(this,[c0]);return l0?(d0.then(u0,l0),Gh.resolve()):d0},e0.addIceCandidate=a0}function fp(t0){const e0=t0&&t0.navigator;if(e0.mediaDevices&&e0.mediaDevices.getUserMedia){const n0=e0.mediaDevices,r0=n0.getUserMedia.bind(n0);e0.mediaDevices.getUserMedia=i0=>r0(mp(i0))}!e0.getUserMedia&&e0.mediaDevices&&e0.mediaDevices.getUserMedia&&(e0.getUserMedia=(function(n0,r0,i0){e0.mediaDevices.getUserMedia(n0).then(r0,i0)}).bind(e0))}function mp(t0){return t0&&t0.video!==void 0?Object.assign({},t0,{video:or(t0.video)}):t0}function Tp(t0){if(!t0.RTCPeerConnection)return;const e0=t0.RTCPeerConnection;t0.RTCPeerConnection=function(n0,r0){if(n0&&n0.iceServers){const i0=[];for(let o0=0;o0<n0.iceServers.length;o0++){let s0=n0.iceServers[o0];!s0.hasOwnProperty("urls")&&s0.hasOwnProperty("url")?(nr("RTCIceServer.url","RTCIceServer.urls"),s0=JSON.parse(JSON.stringify(s0)),s0.urls=s0.url,delete s0.url,i0.push(s0)):i0.push(n0.iceServers[o0])}n0.iceServers=i0}return new e0(n0,r0)},t0.RTCPeerConnection.prototype=e0.prototype,"generateCertificate"in e0&&Object.defineProperty(t0.RTCPeerConnection,"generateCertificate",{get:()=>e0.generateCertificate})}function Sp(t0){typeof t0=="object"&&t0.RTCTrackEvent&&"receiver"in t0.RTCTrackEvent.prototype&&!("transceiver"in t0.RTCTrackEvent.prototype)&&Object.defineProperty(t0.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gp(t0){const e0=t0.RTCPeerConnection.prototype.createOffer;t0.RTCPeerConnection.prototype.createOffer=function(n0){if(n0){n0.offerToReceiveAudio!==void 0&&(n0.offerToReceiveAudio=!!n0.offerToReceiveAudio);const r0=this.getTransceivers().find(o0=>o0.receiver.track.kind==="audio");n0.offerToReceiveAudio===!1&&r0?r0.direction==="sendrecv"?r0.setDirection?r0.setDirection("sendonly"):r0.direction="sendonly":r0.direction==="recvonly"&&(r0.setDirection?r0.setDirection("inactive"):r0.direction="inactive"):n0.offerToReceiveAudio!==!0||r0||this.addTransceiver("audio",{direction:"recvonly"}),n0.offerToReceiveVideo!==void 0&&(n0.offerToReceiveVideo=!!n0.offerToReceiveVideo);const i0=this.getTransceivers().find(o0=>o0.receiver.track.kind==="video");n0.offerToReceiveVideo===!1&&i0?i0.direction==="sendrecv"?i0.setDirection?i0.setDirection("sendonly"):i0.direction="sendonly":i0.direction==="recvonly"&&(i0.setDirection?i0.setDirection("inactive"):i0.direction="inactive"):n0.offerToReceiveVideo!==!0||i0||this.addTransceiver("video",{direction:"recvonly"})}return e0.apply(this,arguments)}}function Rp(t0){typeof t0!="object"||t0.AudioContext||(t0.AudioContext=t0.webkitAudioContext)}var Cp=Object.freeze({__proto__:null,shimAudioContext:Rp,shimCallbacksAPI:Ep,shimConstraints:mp,shimCreateOfferLegacy:gp,shimGetUserMedia:fp,shimLocalStreamsAPI:pp,shimRTCIceServerUrls:Tp,shimRemoteStreamsAPI:_p,shimTrackEventTransceiver:Sp}),Ip=`	
\v\f\r \u2028\u2029\uFEFF`,vp=J,yp=fn,Ap=Ip,bp=d("".replace),wp=RegExp("^["+Ap+"]+"),Op=RegExp("(^|[^"+Ap+"])["+Ap+"]+$"),Np=function(t0){return function(e0){var n0=yp(vp(e0));return 1&t0&&(n0=bp(n0,wp,"")),2&t0&&(n0=bp(n0,Op,"$1")),n0}},Dp={start:Np(1),end:Np(2),trim:Np(3)},Pp=la.PROPER,Lp=n,kp=Ip,Mp=Dp.trim;wi({target:"String",proto:!0,forced:function(t0){return Lp(function(){return!!kp[t0]()||""[t0]()!==""||Pp&&kp[t0].name!==t0})}("trim")},{trim:function(){return Mp(this)}});var Up=Xi("String").trim,xp=l,Vp=Up,Fp=String.prototype,Bp=function(t0){var e0=t0.trim;return typeof t0=="string"||t0===Fp||xp(Fp,t0)&&e0===Fp.trim?Vp:e0},jp=i(Bp),Gp={exports:{}};(function(t0){const e0={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e0.localCName=e0.generateIdentifier(),e0.splitLines=function(n0){return n0.trim().split(`
`).map(r0=>r0.trim())},e0.splitSections=function(n0){return n0.split(`
m=`).map((r0,i0)=>(i0>0?"m="+r0:r0).trim()+`\r
`)},e0.getDescription=function(n0){const r0=e0.splitSections(n0);return r0&&r0[0]},e0.getMediaSections=function(n0){const r0=e0.splitSections(n0);return r0.shift(),r0},e0.matchPrefix=function(n0,r0){return e0.splitLines(n0).filter(i0=>i0.indexOf(r0)===0)},e0.parseCandidate=function(n0){let r0;r0=n0.indexOf("a=candidate:")===0?n0.substring(12).split(" "):n0.substring(10).split(" ");const i0={foundation:r0[0],component:{1:"rtp",2:"rtcp"}[r0[1]]||r0[1],protocol:r0[2].toLowerCase(),priority:parseInt(r0[3],10),ip:r0[4],address:r0[4],port:parseInt(r0[5],10),type:r0[7]};for(let o0=8;o0<r0.length;o0+=2)switch(r0[o0]){case"raddr":i0.relatedAddress=r0[o0+1];break;case"rport":i0.relatedPort=parseInt(r0[o0+1],10);break;case"tcptype":i0.tcpType=r0[o0+1];break;case"ufrag":i0.ufrag=r0[o0+1],i0.usernameFragment=r0[o0+1];break;default:i0[r0[o0]]===void 0&&(i0[r0[o0]]=r0[o0+1])}return i0},e0.writeCandidate=function(n0){const r0=[];r0.push(n0.foundation);const i0=n0.component;i0==="rtp"?r0.push(1):i0==="rtcp"?r0.push(2):r0.push(i0),r0.push(n0.protocol.toUpperCase()),r0.push(n0.priority),r0.push(n0.address||n0.ip),r0.push(n0.port);const o0=n0.type;return r0.push("typ"),r0.push(o0),o0!=="host"&&n0.relatedAddress&&n0.relatedPort&&(r0.push("raddr"),r0.push(n0.relatedAddress),r0.push("rport"),r0.push(n0.relatedPort)),n0.tcpType&&n0.protocol.toLowerCase()==="tcp"&&(r0.push("tcptype"),r0.push(n0.tcpType)),(n0.usernameFragment||n0.ufrag)&&(r0.push("ufrag"),r0.push(n0.usernameFragment||n0.ufrag)),"candidate:"+r0.join(" ")},e0.parseIceOptions=function(n0){return n0.substring(14).split(" ")},e0.parseRtpMap=function(n0){let r0=n0.substring(9).split(" ");const i0={payloadType:parseInt(r0.shift(),10)};return r0=r0[0].split("/"),i0.name=r0[0],i0.clockRate=parseInt(r0[1],10),i0.channels=r0.length===3?parseInt(r0[2],10):1,i0.numChannels=i0.channels,i0},e0.writeRtpMap=function(n0){let r0=n0.payloadType;n0.preferredPayloadType!==void 0&&(r0=n0.preferredPayloadType);const i0=n0.channels||n0.numChannels||1;return"a=rtpmap:"+r0+" "+n0.name+"/"+n0.clockRate+(i0!==1?"/"+i0:"")+`\r
`},e0.parseExtmap=function(n0){const r0=n0.substring(9).split(" ");return{id:parseInt(r0[0],10),direction:r0[0].indexOf("/")>0?r0[0].split("/")[1]:"sendrecv",uri:r0[1],attributes:r0.slice(2).join(" ")}},e0.writeExtmap=function(n0){return"a=extmap:"+(n0.id||n0.preferredId)+(n0.direction&&n0.direction!=="sendrecv"?"/"+n0.direction:"")+" "+n0.uri+(n0.attributes?" "+n0.attributes:"")+`\r
`},e0.parseFmtp=function(n0){const r0={};let i0;const o0=n0.substring(n0.indexOf(" ")+1).split(";");for(let s0=0;s0<o0.length;s0++)i0=o0[s0].trim().split("="),r0[i0[0].trim()]=i0[1];return r0},e0.writeFmtp=function(n0){let r0="",i0=n0.payloadType;if(n0.preferredPayloadType!==void 0&&(i0=n0.preferredPayloadType),n0.parameters&&Object.keys(n0.parameters).length){const o0=[];Object.keys(n0.parameters).forEach(s0=>{n0.parameters[s0]!==void 0?o0.push(s0+"="+n0.parameters[s0]):o0.push(s0)}),r0+="a=fmtp:"+i0+" "+o0.join(";")+`\r
`}return r0},e0.parseRtcpFb=function(n0){const r0=n0.substring(n0.indexOf(" ")+1).split(" ");return{type:r0.shift(),parameter:r0.join(" ")}},e0.writeRtcpFb=function(n0){let r0="",i0=n0.payloadType;return n0.preferredPayloadType!==void 0&&(i0=n0.preferredPayloadType),n0.rtcpFeedback&&n0.rtcpFeedback.length&&n0.rtcpFeedback.forEach(o0=>{r0+="a=rtcp-fb:"+i0+" "+o0.type+(o0.parameter&&o0.parameter.length?" "+o0.parameter:"")+`\r
`}),r0},e0.parseSsrcMedia=function(n0){const r0=n0.indexOf(" "),i0={ssrc:parseInt(n0.substring(7,r0),10)},o0=n0.indexOf(":",r0);return o0>-1?(i0.attribute=n0.substring(r0+1,o0),i0.value=n0.substring(o0+1)):i0.attribute=n0.substring(r0+1),i0},e0.parseSsrcGroup=function(n0){const r0=n0.substring(13).split(" ");return{semantics:r0.shift(),ssrcs:r0.map(i0=>parseInt(i0,10))}},e0.getMid=function(n0){const r0=e0.matchPrefix(n0,"a=mid:")[0];if(r0)return r0.substring(6)},e0.parseFingerprint=function(n0){const r0=n0.substring(14).split(" ");return{algorithm:r0[0].toLowerCase(),value:r0[1].toUpperCase()}},e0.getDtlsParameters=function(n0,r0){return{role:"auto",fingerprints:e0.matchPrefix(n0+r0,"a=fingerprint:").map(e0.parseFingerprint)}},e0.writeDtlsParameters=function(n0,r0){let i0="a=setup:"+r0+`\r
`;return n0.fingerprints.forEach(o0=>{i0+="a=fingerprint:"+o0.algorithm+" "+o0.value+`\r
`}),i0},e0.parseCryptoLine=function(n0){const r0=n0.substring(9).split(" ");return{tag:parseInt(r0[0],10),cryptoSuite:r0[1],keyParams:r0[2],sessionParams:r0.slice(3)}},e0.writeCryptoLine=function(n0){return"a=crypto:"+n0.tag+" "+n0.cryptoSuite+" "+(typeof n0.keyParams=="object"?e0.writeCryptoKeyParams(n0.keyParams):n0.keyParams)+(n0.sessionParams?" "+n0.sessionParams.join(" "):"")+`\r
`},e0.parseCryptoKeyParams=function(n0){if(n0.indexOf("inline:")!==0)return null;const r0=n0.substring(7).split("|");return{keyMethod:"inline",keySalt:r0[0],lifeTime:r0[1],mkiValue:r0[2]?r0[2].split(":")[0]:void 0,mkiLength:r0[2]?r0[2].split(":")[1]:void 0}},e0.writeCryptoKeyParams=function(n0){return n0.keyMethod+":"+n0.keySalt+(n0.lifeTime?"|"+n0.lifeTime:"")+(n0.mkiValue&&n0.mkiLength?"|"+n0.mkiValue+":"+n0.mkiLength:"")},e0.getCryptoParameters=function(n0,r0){return e0.matchPrefix(n0+r0,"a=crypto:").map(e0.parseCryptoLine)},e0.getIceParameters=function(n0,r0){const i0=e0.matchPrefix(n0+r0,"a=ice-ufrag:")[0],o0=e0.matchPrefix(n0+r0,"a=ice-pwd:")[0];return i0&&o0?{usernameFragment:i0.substring(12),password:o0.substring(10)}:null},e0.writeIceParameters=function(n0){let r0="a=ice-ufrag:"+n0.usernameFragment+`\r
a=ice-pwd:`+n0.password+`\r
`;return n0.iceLite&&(r0+=`a=ice-lite\r
`),r0},e0.parseRtpParameters=function(n0){const r0={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i0=e0.splitLines(n0)[0].split(" ");r0.profile=i0[2];for(let s0=3;s0<i0.length;s0++){const a0=i0[s0],c0=e0.matchPrefix(n0,"a=rtpmap:"+a0+" ")[0];if(c0){const u0=e0.parseRtpMap(c0),l0=e0.matchPrefix(n0,"a=fmtp:"+a0+" ");switch(u0.parameters=l0.length?e0.parseFmtp(l0[0]):{},u0.rtcpFeedback=e0.matchPrefix(n0,"a=rtcp-fb:"+a0+" ").map(e0.parseRtcpFb),r0.codecs.push(u0),u0.name.toUpperCase()){case"RED":case"ULPFEC":r0.fecMechanisms.push(u0.name.toUpperCase())}}}e0.matchPrefix(n0,"a=extmap:").forEach(s0=>{r0.headerExtensions.push(e0.parseExtmap(s0))});const o0=e0.matchPrefix(n0,"a=rtcp-fb:* ").map(e0.parseRtcpFb);return r0.codecs.forEach(s0=>{o0.forEach(a0=>{s0.rtcpFeedback.find(c0=>c0.type===a0.type&&c0.parameter===a0.parameter)||s0.rtcpFeedback.push(a0)})}),r0},e0.writeRtpDescription=function(n0,r0){let i0="";i0+="m="+n0+" ",i0+=r0.codecs.length>0?"9":"0",i0+=" "+(r0.profile||"UDP/TLS/RTP/SAVPF")+" ",i0+=r0.codecs.map(s0=>s0.preferredPayloadType!==void 0?s0.preferredPayloadType:s0.payloadType).join(" ")+`\r
`,i0+=`c=IN IP4 0.0.0.0\r
`,i0+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r0.codecs.forEach(s0=>{i0+=e0.writeRtpMap(s0),i0+=e0.writeFmtp(s0),i0+=e0.writeRtcpFb(s0)});let o0=0;return r0.codecs.forEach(s0=>{s0.maxptime>o0&&(o0=s0.maxptime)}),o0>0&&(i0+="a=maxptime:"+o0+`\r
`),r0.headerExtensions&&r0.headerExtensions.forEach(s0=>{i0+=e0.writeExtmap(s0)}),i0},e0.parseRtpEncodingParameters=function(n0){const r0=[],i0=e0.parseRtpParameters(n0),o0=i0.fecMechanisms.indexOf("RED")!==-1,s0=i0.fecMechanisms.indexOf("ULPFEC")!==-1,a0=e0.matchPrefix(n0,"a=ssrc:").map(h0=>e0.parseSsrcMedia(h0)).filter(h0=>h0.attribute==="cname"),c0=a0.length>0&&a0[0].ssrc;let u0;const l0=e0.matchPrefix(n0,"a=ssrc-group:FID").map(h0=>h0.substring(17).split(" ").map(p0=>parseInt(p0,10)));l0.length>0&&l0[0].length>1&&l0[0][0]===c0&&(u0=l0[0][1]),i0.codecs.forEach(h0=>{if(h0.name.toUpperCase()==="RTX"&&h0.parameters.apt){let p0={ssrc:c0,codecPayloadType:parseInt(h0.parameters.apt,10)};c0&&u0&&(p0.rtx={ssrc:u0}),r0.push(p0),o0&&(p0=JSON.parse(JSON.stringify(p0)),p0.fec={ssrc:c0,mechanism:s0?"red+ulpfec":"red"},r0.push(p0))}}),r0.length===0&&c0&&r0.push({ssrc:c0});let d0=e0.matchPrefix(n0,"b=");return d0.length&&(d0=d0[0].indexOf("b=TIAS:")===0?parseInt(d0[0].substring(7),10):d0[0].indexOf("b=AS:")===0?1e3*parseInt(d0[0].substring(5),10)*.95-16e3:void 0,r0.forEach(h0=>{h0.maxBitrate=d0})),r0},e0.parseRtcpParameters=function(n0){const r0={},i0=e0.matchPrefix(n0,"a=ssrc:").map(a0=>e0.parseSsrcMedia(a0)).filter(a0=>a0.attribute==="cname")[0];i0&&(r0.cname=i0.value,r0.ssrc=i0.ssrc);const o0=e0.matchPrefix(n0,"a=rtcp-rsize");r0.reducedSize=o0.length>0,r0.compound=o0.length===0;const s0=e0.matchPrefix(n0,"a=rtcp-mux");return r0.mux=s0.length>0,r0},e0.writeRtcpParameters=function(n0){let r0="";return n0.reducedSize&&(r0+=`a=rtcp-rsize\r
`),n0.mux&&(r0+=`a=rtcp-mux\r
`),n0.ssrc!==void 0&&n0.cname&&(r0+="a=ssrc:"+n0.ssrc+" cname:"+n0.cname+`\r
`),r0},e0.parseMsid=function(n0){let r0;const i0=e0.matchPrefix(n0,"a=msid:");if(i0.length===1)return r0=i0[0].substring(7).split(" "),{stream:r0[0],track:r0[1]};const o0=e0.matchPrefix(n0,"a=ssrc:").map(s0=>e0.parseSsrcMedia(s0)).filter(s0=>s0.attribute==="msid");return o0.length>0?(r0=o0[0].value.split(" "),{stream:r0[0],track:r0[1]}):void 0},e0.parseSctpDescription=function(n0){const r0=e0.parseMLine(n0),i0=e0.matchPrefix(n0,"a=max-message-size:");let o0;i0.length>0&&(o0=parseInt(i0[0].substring(19),10)),isNaN(o0)&&(o0=65536);const s0=e0.matchPrefix(n0,"a=sctp-port:");if(s0.length>0)return{port:parseInt(s0[0].substring(12),10),protocol:r0.fmt,maxMessageSize:o0};const a0=e0.matchPrefix(n0,"a=sctpmap:");if(a0.length>0){const c0=a0[0].substring(10).split(" ");return{port:parseInt(c0[0],10),protocol:c0[1],maxMessageSize:o0}}},e0.writeSctpDescription=function(n0,r0){let i0=[];return i0=n0.protocol!=="DTLS/SCTP"?["m="+n0.kind+" 9 "+n0.protocol+" "+r0.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r0.port+`\r
`]:["m="+n0.kind+" 9 "+n0.protocol+" "+r0.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r0.port+" "+r0.protocol+` 65535\r
`],r0.maxMessageSize!==void 0&&i0.push("a=max-message-size:"+r0.maxMessageSize+`\r
`),i0.join("")},e0.generateSessionId=function(){return Math.random().toString().substr(2,22)},e0.writeSessionBoilerplate=function(n0,r0,i0){let o0;const s0=r0!==void 0?r0:2;return o0=n0||e0.generateSessionId(),`v=0\r
o=`+(i0||"thisisadapterortc")+" "+o0+" "+s0+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e0.getDirection=function(n0,r0){const i0=e0.splitLines(n0);for(let o0=0;o0<i0.length;o0++)switch(i0[o0]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i0[o0].substring(2)}return r0?e0.getDirection(r0):"sendrecv"},e0.getKind=function(n0){return e0.splitLines(n0)[0].split(" ")[0].substring(2)},e0.isRejected=function(n0){return n0.split(" ",2)[1]==="0"},e0.parseMLine=function(n0){const r0=e0.splitLines(n0)[0].substring(2).split(" ");return{kind:r0[0],port:parseInt(r0[1],10),protocol:r0[2],fmt:r0.slice(3).join(" ")}},e0.parseOLine=function(n0){const r0=e0.matchPrefix(n0,"o=")[0].substring(2).split(" ");return{username:r0[0],sessionId:r0[1],sessionVersion:parseInt(r0[2],10),netType:r0[3],addressType:r0[4],address:r0[5]}},e0.isValidSDP=function(n0){if(typeof n0!="string"||n0.length===0)return!1;const r0=e0.splitLines(n0);for(let i0=0;i0<r0.length;i0++)if(r0[i0].length<2||r0[i0].charAt(1)!=="=")return!1;return!0},t0.exports=e0})(Gp);var Wp=Gp.exports,Hp=i(Wp),Kp=e({__proto__:null,default:Hp},[Wp]);function Yp(t0){if(!t0.RTCIceCandidate||t0.RTCIceCandidate&&"foundation"in t0.RTCIceCandidate.prototype)return;const e0=t0.RTCIceCandidate;t0.RTCIceCandidate=function(n0){if(typeof n0=="object"&&n0.candidate&&n0.candidate.indexOf("a=")===0&&((n0=JSON.parse(JSON.stringify(n0))).candidate=n0.candidate.substr(2)),n0.candidate&&n0.candidate.length){const r0=new e0(n0),i0=Hp.parseCandidate(n0.candidate),o0=Object.assign(r0,i0);return o0.toJSON=function(){return{candidate:o0.candidate,sdpMid:o0.sdpMid,sdpMLineIndex:o0.sdpMLineIndex,usernameFragment:o0.usernameFragment}},o0}return new e0(n0)},t0.RTCIceCandidate.prototype=e0.prototype,$n(t0,"icecandidate",n0=>(n0.candidate&&Object.defineProperty(n0,"candidate",{value:new t0.RTCIceCandidate(n0.candidate),writable:"false"}),n0))}function qp(t0){!t0.RTCIceCandidate||t0.RTCIceCandidate&&"relayProtocol"in t0.RTCIceCandidate.prototype||$n(t0,"icecandidate",e0=>{if(e0.candidate){const n0=Hp.parseCandidate(e0.candidate.candidate);n0.type==="relay"&&(e0.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n0.priority>>24])}return e0})}function zp(t0,e0){if(!t0.RTCPeerConnection)return;"sctp"in t0.RTCPeerConnection.prototype||Object.defineProperty(t0.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n0=function(a0){if(!a0||!a0.sdp)return!1;const c0=Hp.splitSections(a0.sdp);return c0.shift(),c0.some(u0=>{const l0=Hp.parseMLine(u0);return l0&&l0.kind==="application"&&l0.protocol.indexOf("SCTP")!==-1})},r0=function(a0){const c0=a0.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c0===null||c0.length<2)return-1;const u0=parseInt(c0[1],10);return u0!=u0?-1:u0},i0=function(a0){let c0=65536;return e0.browser==="firefox"&&(c0=e0.version<57?a0===-1?16384:2147483637:e0.version<60?e0.version===57?65535:65536:2147483637),c0},o0=function(a0,c0){let u0=65536;e0.browser==="firefox"&&e0.version===57&&(u0=65535);const l0=Hp.matchPrefix(a0.sdp,"a=max-message-size:");return l0.length>0?u0=parseInt(l0[0].substr(19),10):e0.browser==="firefox"&&c0!==-1&&(u0=2147483637),u0},s0=t0.RTCPeerConnection.prototype.setRemoteDescription;t0.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e0.browser==="chrome"&&e0.version>=76){const{sdpSemantics:a0}=this.getConfiguration();a0==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n0(arguments[0])){const a0=r0(arguments[0]),c0=i0(a0),u0=o0(arguments[0],a0);let l0;l0=c0===0&&u0===0?Number.POSITIVE_INFINITY:c0===0||u0===0?Math.max(c0,u0):Math.min(c0,u0);const d0={};Object.defineProperty(d0,"maxMessageSize",{get:()=>l0}),this._sctp=d0}return s0.apply(this,arguments)}}function Jp(t0){if(!t0.RTCPeerConnection||!("createDataChannel"in t0.RTCPeerConnection.prototype))return;function e0(r0,i0){const o0=r0.send;r0.send=function(){const s0=arguments[0],a0=s0.length||s0.size||s0.byteLength;if(r0.readyState==="open"&&i0.sctp&&a0>i0.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i0.sctp.maxMessageSize+" bytes)");return o0.apply(r0,arguments)}}const n0=t0.RTCPeerConnection.prototype.createDataChannel;t0.RTCPeerConnection.prototype.createDataChannel=function(){const r0=n0.apply(this,arguments);return e0(r0,this),r0},$n(t0,"datachannel",r0=>(e0(r0.channel,r0.target),r0))}function Xp(t0){if(!t0.RTCPeerConnection||"connectionState"in t0.RTCPeerConnection.prototype)return;const e0=t0.RTCPeerConnection.prototype;Object.defineProperty(e0,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e0,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n0){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n0&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n0)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n0=>{const r0=e0[n0];e0[n0]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i0=>{const o0=i0.target;if(o0._lastConnectionState!==o0.connectionState){o0._lastConnectionState=o0.connectionState;const s0=new Event("connectionstatechange",i0);o0.dispatchEvent(s0)}return i0},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r0.apply(this,arguments)}})}function Qp(t0,e0){if(!t0.RTCPeerConnection||e0.browser==="chrome"&&e0.version>=71||e0.browser==="safari"&&e0.version>=605)return;const n0=t0.RTCPeerConnection.prototype.setRemoteDescription;t0.RTCPeerConnection.prototype.setRemoteDescription=function(r0){if(r0&&r0.sdp&&r0.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i0=r0.sdp.split(`
`).filter(o0=>jp(o0).call(o0)!=="a=extmap-allow-mixed").join(`
`);t0.RTCSessionDescription&&r0 instanceof t0.RTCSessionDescription?arguments[0]=new t0.RTCSessionDescription({type:r0.type,sdp:i0}):r0.sdp=i0}return n0.apply(this,arguments)}}function Zp(t0,e0){if(!t0.RTCPeerConnection||!t0.RTCPeerConnection.prototype)return;const n0=t0.RTCPeerConnection.prototype.addIceCandidate;n0&&n0.length!==0&&(t0.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e0.browser==="chrome"&&e0.version<78||e0.browser==="firefox"&&e0.version<68||e0.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Gh.resolve():n0.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Gh.resolve())})}function $p(t0,e0){if(!t0.RTCPeerConnection||!t0.RTCPeerConnection.prototype)return;const n0=t0.RTCPeerConnection.prototype.setLocalDescription;n0&&n0.length!==0&&(t0.RTCPeerConnection.prototype.setLocalDescription=function(){let r0=arguments[0]||{};if(typeof r0!="object"||r0.type&&r0.sdp)return n0.apply(this,arguments);if(r0={type:r0.type,sdp:r0.sdp},!r0.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r0.type="offer";break;default:r0.type="answer"}return r0.sdp||r0.type!=="offer"&&r0.type!=="answer"?n0.apply(this,[r0]):(r0.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i0=>n0.apply(this,[i0]))})}var e_=Object.freeze({__proto__:null,removeExtmapAllowMixed:Qp,shimAddIceCandidateNullOrEmpty:Zp,shimConnectionState:Xp,shimMaxMessageSize:zp,shimParameterlessSetLocalDescription:$p,shimRTCIceCandidate:Yp,shimRTCIceCandidateRelayProtocol:qp,shimSendThrowTypeError:Jp});(function(){let{window:t0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n0=ir,r0=function(o0){const s0={browser:null,version:null};if(o0===void 0||!o0.navigator)return s0.browser="Not a browser.",s0;const{navigator:a0}=o0;if(a0.mozGetUserMedia)s0.browser="firefox",s0.version=Zn(a0.userAgent,/Firefox\/(\d+)\./,1);else if(a0.webkitGetUserMedia||o0.isSecureContext===!1&&o0.webkitRTCPeerConnection)s0.browser="chrome",s0.version=Zn(a0.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o0.RTCPeerConnection||!a0.userAgent.match(/AppleWebKit\/(\d+)\./))return s0.browser="Not a supported browser.",s0;s0.browser="safari",s0.version=Zn(a0.userAgent,/AppleWebKit\/(\d+)\./,1),s0.supportsUnifiedPlan=o0.RTCRtpTransceiver&&"currentDirection"in o0.RTCRtpTransceiver.prototype}return s0}(t0),i0={browserDetails:r0,commonShim:e_,extractVersion:Zn,disableLog:er,disableWarnings:tr,sdp:Kp};switch(r0.browser){case"chrome":if(!ep||!Zh||!e0.shimChrome)return n0("Chrome shim is not included in this adapter release."),i0;if(r0.version===null)return n0("Chrome shim can not determine version, not shimming."),i0;n0("adapter.js shimming chrome."),i0.browserShim=ep,Zp(t0,r0),$p(t0),Hh(t0,r0),Kh(t0),Zh(t0,r0),Yh(t0),Qh(t0,r0),qh(t0),zh(t0),Jh(t0),$h(t0,r0),Yp(t0),qp(t0),Xp(t0),zp(t0,r0),Jp(t0),Qp(t0,r0);break;case"firefox":if(!hp||!np||!e0.shimFirefox)return n0("Firefox shim is not included in this adapter release."),i0;n0("adapter.js shimming firefox."),i0.browserShim=hp,Zp(t0,r0),$p(t0),tp(t0,r0),np(t0,r0),ip(t0),sp(t0),rp(t0),op(t0),ap(t0),cp(t0),dp(t0),lp(t0),up(t0),Yp(t0),Xp(t0),zp(t0,r0),Jp(t0);break;case"safari":if(!Cp||!e0.shimSafari)return n0("Safari shim is not included in this adapter release."),i0;n0("adapter.js shimming safari."),i0.browserShim=Cp,Zp(t0,r0),$p(t0),Tp(t0),gp(t0),Ep(t0),pp(t0),_p(t0),Sp(t0),fp(t0),Rp(t0),Yp(t0),qp(t0),zp(t0,r0),Jp(t0),Qp(t0,r0);break;default:n0("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var t_=Xi("Array").keys,i_=pn,n_=Ze,r_=l,o_=t_,s_=Array.prototype,a_={DOMTokenList:!0,NodeList:!0},c_=function(t0){var e0=t0.keys;return t0===s_||r_(s_,t0)&&e0===s_.keys||n_(a_,i_(t0))?o_:e0},d_=i(c_),l_=be,u_=TypeError,h_=Ct,p_=Qt,__=B,E_=function(t0,e0,n0){var r0=h_(e0);r0 in t0?p_.f(t0,r0,__(0,n0)):t0[r0]=n0},f_=xi,m_=Gi,T_=E_,S_=Array,g_=Math.max,R_=function(t0,e0,n0){for(var r0=m_(t0),i0=f_(e0,r0),o0=f_(n0===void 0?r0:n0,r0),s0=S_(g_(o0-i0,0)),a0=0;i0<o0;i0++,a0++)T_(s0,a0,t0[i0]);return s0.length=a0,s0},C_=R_,I_=Math.floor,v_=function(t0,e0){var n0=t0.length,r0=I_(n0/2);return n0<8?y_(t0,e0):A_(t0,v_(C_(t0,0,r0),e0),v_(C_(t0,r0),e0),e0)},y_=function(t0,e0){for(var n0,r0,i0=t0.length,o0=1;o0<i0;){for(r0=o0,n0=t0[o0];r0&&e0(t0[r0-1],n0)>0;)t0[r0]=t0[--r0];r0!==o0++&&(t0[r0]=n0)}return t0},A_=function(t0,e0,n0,r0){for(var i0=e0.length,o0=n0.length,s0=0,a0=0;s0<i0||a0<o0;)t0[s0+a0]=s0<i0&&a0<o0?r0(e0[s0],n0[a0])<=0?e0[s0++]:n0[a0++]:s0<i0?e0[s0++]:n0[a0++];return t0},b_=v_,w_=ce.match(/firefox\/(\d+)/i),O_=!!w_&&+w_[1],N_=/MSIE|Trident/.test(ce),D_=ce.match(/AppleWebKit\/(\d+)\./),P_=!!D_&&+D_[1],L_=wi,k_=d,M_=De,U_=Je,x_=Gi,V_=function(t0,e0){if(!delete t0[e0])throw u_("Cannot delete property "+l_(e0)+" of "+l_(t0))},F_=fn,B_=n,j_=b_,G_=Bn,W_=O_,H_=N_,K_=Ee,Y_=P_,q_=[],z_=k_(q_.sort),J_=k_(q_.push),X_=B_(function(){q_.sort(void 0)}),Q_=B_(function(){q_.sort(null)}),Z_=G_("sort"),$_=!B_(function(){if(K_)return K_<70;if(!(W_&&W_>3)){if(H_)return!0;if(Y_)return Y_<603;var t0,e0,n0,r0,i0="";for(t0=65;t0<76;t0++){switch(e0=String.fromCharCode(t0),t0){case 66:case 69:case 70:case 72:n0=3;break;case 68:case 71:n0=4;break;default:n0=2}for(r0=0;r0<47;r0++)q_.push({k:e0+r0,v:n0})}for(q_.sort(function(o0,s0){return s0.v-o0.v}),r0=0;r0<q_.length;r0++)e0=q_[r0].k.charAt(0),i0.charAt(i0.length-1)!==e0&&(i0+=e0);return i0!=="DGBEFHACIJK"}});L_({target:"Array",proto:!0,forced:X_||!Q_||!Z_||!$_},{sort:function(t0){t0!==void 0&&M_(t0);var e0=U_(this);if($_)return t0===void 0?z_(e0):z_(e0,t0);var n0,r0,i0=[],o0=x_(e0);for(r0=0;r0<o0;r0++)r0 in e0&&J_(i0,e0[r0]);for(j_(i0,function(s0){return function(a0,c0){return c0===void 0?-1:a0===void 0?1:s0!==void 0?+s0(a0,c0)||0:F_(a0)>F_(c0)?1:-1}}(t0)),n0=x_(i0),r0=0;r0<n0;)e0[r0]=i0[r0++];for(;r0<o0;)V_(e0,r0++);return e0}});var eE,tE,iE=Xi("Array").sort,nE=l,rE=iE,oE=Array.prototype,sE=function(t0){var e0=t0.sort;return t0===oE||nE(oE,t0)&&e0===oE.sort?rE:e0},aE=i(sE),cE={exports:{}};eE=cE,tE=cE.exports,function(t0,e0){var n0="function",r0="undefined",i0="object",o0="string",s0="major",a0="model",c0="name",u0="type",l0="vendor",d0="version",h0="architecture",p0="console",m0="mobile",f0="tablet",g0="smarttv",E0="wearable",_0="embedded",y0="Amazon",b0="Apple",S0="ASUS",w0="BlackBerry",I0="Browser",L0="Chrome",M0="Firefox",C0="Google",U0="Huawei",x0="LG",j0="Microsoft",k0="Motorola",D0="Opera",$0="Samsung",N0="Sharp",A0="Sony",P0="Xiaomi",O0="Zebra",v0="Facebook",R0="Chromium OS",T0="Mac OS",F0=function(q0){for(var B0={},G0=0;G0<q0.length;G0++)B0[q0[G0].toUpperCase()]=q0[G0];return B0},V0=function(q0,B0){return typeof q0===o0&&H0(B0).indexOf(H0(q0))!==-1},H0=function(q0){return q0.toLowerCase()},X0=function(q0,B0){if(typeof q0===o0)return q0=q0.replace(/^\s\s*/,""),typeof B0===r0?q0:q0.substring(0,350)},Z0=function(q0,B0){for(var G0,z0,Q0,Y0,W0,t1,o1=0;o1<B0.length&&!W0;){var r1=B0[o1],l1=B0[o1+1];for(G0=z0=0;G0<r1.length&&!W0&&r1[G0];)if(W0=r1[G0++].exec(q0))for(Q0=0;Q0<l1.length;Q0++)t1=W0[++z0],typeof(Y0=l1[Q0])===i0&&Y0.length>0?Y0.length===2?typeof Y0[1]==n0?this[Y0[0]]=Y0[1].call(this,t1):this[Y0[0]]=Y0[1]:Y0.length===3?typeof Y0[1]!==n0||Y0[1].exec&&Y0[1].test?this[Y0[0]]=t1?t1.replace(Y0[1],Y0[2]):e0:this[Y0[0]]=t1?Y0[1].call(this,t1,Y0[2]):e0:Y0.length===4&&(this[Y0[0]]=t1?Y0[3].call(this,t1.replace(Y0[1],Y0[2])):e0):this[Y0]=t1||e0;o1+=2}},n1=function(q0,B0){for(var G0 in B0)if(typeof B0[G0]===i0&&B0[G0].length>0){for(var z0=0;z0<B0[G0].length;z0++)if(V0(B0[G0][z0],q0))return G0==="?"?e0:G0}else if(V0(B0[G0],q0))return G0==="?"?e0:G0;return q0},s1={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},i1={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[d0,[c0,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[d0,[c0,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c0,d0],[/opios[\/ ]+([\w\.]+)/i],[d0,[c0,D0+" Mini"]],[/\bopr\/([\w\.]+)/i],[d0,[c0,D0]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[c0,d0],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[d0,[c0,"UC"+I0]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[d0,[c0,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[d0,[c0,"WeChat"]],[/konqueror\/([\w\.]+)/i],[d0,[c0,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[d0,[c0,"IE"]],[/yabrowser\/([\w\.]+)/i],[d0,[c0,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c0,/(.+)/,"$1 Secure "+I0],d0],[/\bfocus\/([\w\.]+)/i],[d0,[c0,M0+" Focus"]],[/\bopt\/([\w\.]+)/i],[d0,[c0,D0+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[d0,[c0,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[d0,[c0,"Dolphin"]],[/coast\/([\w\.]+)/i],[d0,[c0,D0+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[d0,[c0,"MIUI "+I0]],[/fxios\/([-\w\.]+)/i],[d0,[c0,M0]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c0,"360 "+I0]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c0,/(.+)/,"$1 "+I0],d0],[/(comodo_dragon)\/([\w\.]+)/i],[[c0,/_/g," "],d0],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c0,d0],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c0],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c0,v0],d0],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c0,d0],[/\bgsa\/([\w\.]+) .*safari\//i],[d0,[c0,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[d0,[c0,L0+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c0,L0+" WebView"],d0],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[d0,[c0,"Android "+I0]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c0,d0],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[d0,[c0,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[d0,c0],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c0,[d0,n1,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c0,d0],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c0,"Netscape"],d0],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[d0,[c0,M0+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c0,d0],[/(cobalt)\/([\w\.]+)/i],[c0,[d0,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h0,"amd64"]],[/(ia32(?=;))/i],[[h0,H0]],[/((?:i[346]|x)86)[;\)]/i],[[h0,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h0,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h0,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h0,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h0,/ower/,"",H0]],[/(sun4\w)[;\)]/i],[[h0,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h0,H0]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a0,[l0,$0],[u0,f0]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[a0,[l0,$0],[u0,m0]],[/\((ip(?:hone|od)[\w ]*);/i],[a0,[l0,b0],[u0,m0]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a0,[l0,b0],[u0,f0]],[/(macintosh);/i],[a0,[l0,b0]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a0,[l0,N0],[u0,m0]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[a0,[l0,U0],[u0,f0]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a0,[l0,U0],[u0,m0]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[a0,/_/g," "],[l0,P0],[u0,m0]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[a0,/_/g," "],[l0,P0],[u0,f0]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a0,[l0,"OPPO"],[u0,m0]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a0,[l0,"Vivo"],[u0,m0]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[a0,[l0,"Realme"],[u0,m0]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a0,[l0,k0],[u0,m0]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a0,[l0,k0],[u0,f0]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a0,[l0,x0],[u0,f0]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[a0,[l0,x0],[u0,m0]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[a0,[l0,"Lenovo"],[u0,f0]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[a0,/_/g," "],[l0,"Nokia"],[u0,m0]],[/(pixel c)\b/i],[a0,[l0,C0],[u0,f0]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a0,[l0,C0],[u0,m0]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a0,[l0,A0],[u0,m0]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a0,"Xperia Tablet"],[l0,A0],[u0,f0]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a0,[l0,"OnePlus"],[u0,m0]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a0,[l0,y0],[u0,f0]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a0,/(.+)/g,"Fire Phone $1"],[l0,y0],[u0,m0]],[/(playbook);[-\w\),; ]+(rim)/i],[a0,l0,[u0,f0]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a0,[l0,w0],[u0,m0]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a0,[l0,S0],[u0,f0]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a0,[l0,S0],[u0,m0]],[/(nexus 9)/i],[a0,[l0,"HTC"],[u0,f0]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[l0,[a0,/_/g," "],[u0,m0]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a0,[l0,"Acer"],[u0,f0]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a0,[l0,"Meizu"],[u0,m0]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[l0,a0,[u0,m0]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[l0,a0,[u0,f0]],[/(surface duo)/i],[a0,[l0,j0],[u0,f0]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a0,[l0,"Fairphone"],[u0,m0]],[/(u304aa)/i],[a0,[l0,"AT&T"],[u0,m0]],[/\bsie-(\w*)/i],[a0,[l0,"Siemens"],[u0,m0]],[/\b(rct\w+) b/i],[a0,[l0,"RCA"],[u0,f0]],[/\b(venue[\d ]{2,7}) b/i],[a0,[l0,"Dell"],[u0,f0]],[/\b(q(?:mv|ta)\w+) b/i],[a0,[l0,"Verizon"],[u0,f0]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a0,[l0,"Barnes & Noble"],[u0,f0]],[/\b(tm\d{3}\w+) b/i],[a0,[l0,"NuVision"],[u0,f0]],[/\b(k88) b/i],[a0,[l0,"ZTE"],[u0,f0]],[/\b(nx\d{3}j) b/i],[a0,[l0,"ZTE"],[u0,m0]],[/\b(gen\d{3}) b.+49h/i],[a0,[l0,"Swiss"],[u0,m0]],[/\b(zur\d{3}) b/i],[a0,[l0,"Swiss"],[u0,f0]],[/\b((zeki)?tb.*\b) b/i],[a0,[l0,"Zeki"],[u0,f0]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[l0,"Dragon Touch"],a0,[u0,f0]],[/\b(ns-?\w{0,9}) b/i],[a0,[l0,"Insignia"],[u0,f0]],[/\b((nxa|next)-?\w{0,9}) b/i],[a0,[l0,"NextBook"],[u0,f0]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[l0,"Voice"],a0,[u0,m0]],[/\b(lvtel\-)?(v1[12]) b/i],[[l0,"LvTel"],a0,[u0,m0]],[/\b(ph-1) /i],[a0,[l0,"Essential"],[u0,m0]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a0,[l0,"Envizen"],[u0,f0]],[/\b(trio[-\w\. ]+) b/i],[a0,[l0,"MachSpeed"],[u0,f0]],[/\btu_(1491) b/i],[a0,[l0,"Rotor"],[u0,f0]],[/(shield[\w ]+) b/i],[a0,[l0,"Nvidia"],[u0,f0]],[/(sprint) (\w+)/i],[l0,a0,[u0,m0]],[/(kin\.[onetw]{3})/i],[[a0,/\./g," "],[l0,j0],[u0,m0]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a0,[l0,O0],[u0,f0]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a0,[l0,O0],[u0,m0]],[/smart-tv.+(samsung)/i],[l0,[u0,g0]],[/hbbtv.+maple;(\d+)/i],[[a0,/^/,"SmartTV"],[l0,$0],[u0,g0]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[l0,x0],[u0,g0]],[/(apple) ?tv/i],[l0,[a0,b0+" TV"],[u0,g0]],[/crkey/i],[[a0,L0+"cast"],[l0,C0],[u0,g0]],[/droid.+aft(\w)( bui|\))/i],[a0,[l0,y0],[u0,g0]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a0,[l0,N0],[u0,g0]],[/(bravia[\w ]+)( bui|\))/i],[a0,[l0,A0],[u0,g0]],[/(mitv-\w{5}) bui/i],[a0,[l0,P0],[u0,g0]],[/Hbbtv.*(technisat) (.*);/i],[l0,a0,[u0,g0]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[l0,X0],[a0,X0],[u0,g0]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u0,g0]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[l0,a0,[u0,p0]],[/droid.+; (shield) bui/i],[a0,[l0,"Nvidia"],[u0,p0]],[/(playstation [345portablevi]+)/i],[a0,[l0,A0],[u0,p0]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a0,[l0,j0],[u0,p0]],[/((pebble))app/i],[l0,a0,[u0,E0]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a0,[l0,b0],[u0,E0]],[/droid.+; (glass) \d/i],[a0,[l0,C0],[u0,E0]],[/droid.+; (wt63?0{2,3})\)/i],[a0,[l0,O0],[u0,E0]],[/(quest( 2| pro)?)/i],[a0,[l0,v0],[u0,E0]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[l0,[u0,_0]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[a0,[u0,m0]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a0,[u0,f0]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u0,f0]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u0,m0]],[/(android[-\w\. ]{0,9});.+buil/i],[a0,[l0,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[d0,[c0,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[d0,[c0,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[c0,d0],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[d0,c0]],os:[[/microsoft (windows) (vista|xp)/i],[c0,d0],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c0,[d0,n1,s1]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c0,"Windows"],[d0,n1,s1]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[d0,/_/g,"."],[c0,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c0,T0],[d0,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[d0,c0],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c0,d0],[/\(bb(10);/i],[d0,[c0,w0]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[d0,[c0,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[d0,[c0,M0+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[d0,[c0,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[d0,[c0,"watchOS"]],[/crkey\/([\d\.]+)/i],[d0,[c0,L0+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c0,R0],d0],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c0,d0],[/(sunos) ?([\w\.\d]*)/i],[[c0,"Solaris"],d0],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[c0,d0]]},e1=function(q0,B0){if(typeof q0===i0&&(B0=q0,q0=e0),!(this instanceof e1))return new e1(q0,B0).getResult();var G0=typeof t0!==r0&&t0.navigator?t0.navigator:e0,z0=q0||(G0&&G0.userAgent?G0.userAgent:""),Q0=G0&&G0.userAgentData?G0.userAgentData:e0,Y0=B0?function(W0,t1){var o1={};for(var r1 in W0)t1[r1]&&t1[r1].length%2==0?o1[r1]=t1[r1].concat(W0[r1]):o1[r1]=W0[r1];return o1}(i1,B0):i1;return this.getBrowser=function(){var W0={};return W0[c0]=e0,W0[d0]=e0,Z0.call(W0,z0,Y0.browser),W0[s0]=function(t1){return typeof t1===o0?t1.replace(/[^\d\.]/g,"").split(".")[0]:e0}(W0[d0]),G0&&G0.brave&&typeof G0.brave.isBrave==n0&&(W0[c0]="Brave"),W0},this.getCPU=function(){var W0={};return W0[h0]=e0,Z0.call(W0,z0,Y0.cpu),W0},this.getDevice=function(){var W0={};return W0[l0]=e0,W0[a0]=e0,W0[u0]=e0,Z0.call(W0,z0,Y0.device),!W0[u0]&&Q0&&Q0.mobile&&(W0[u0]=m0),W0[a0]=="Macintosh"&&G0&&typeof G0.standalone!==r0&&G0.maxTouchPoints&&G0.maxTouchPoints>2&&(W0[a0]="iPad",W0[u0]=f0),W0},this.getEngine=function(){var W0={};return W0[c0]=e0,W0[d0]=e0,Z0.call(W0,z0,Y0.engine),W0},this.getOS=function(){var W0={};return W0[c0]=e0,W0[d0]=e0,Z0.call(W0,z0,Y0.os),!W0[c0]&&Q0&&Q0.platform!="Unknown"&&(W0[c0]=Q0.platform.replace(/chrome os/i,R0).replace(/macos/i,T0)),W0},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return z0},this.setUA=function(W0){return z0=typeof W0===o0&&W0.length>350?X0(W0,350):W0,this},this.setUA(z0),this};e1.VERSION="0.7.34",e1.BROWSER=F0([c0,d0,s0]),e1.CPU=F0([h0]),e1.DEVICE=F0([a0,l0,u0,p0,m0,g0,f0,E0,_0]),e1.ENGINE=e1.OS=F0([c0,d0]),eE.exports&&(tE=eE.exports=e1),tE.UAParser=e1;var J0=typeof t0!==r0&&(t0.jQuery||t0.Zepto);if(J0&&!J0.ua){var K0=new e1;J0.ua=K0.getResult(),J0.ua.get=function(){return K0.getUA()},J0.ua.set=function(q0){K0.setUA(q0);var B0=K0.getResult();for(var G0 in B0)J0.ua[G0]=B0[G0]}}}(typeof window=="object"?window:t);var dE=i(cE.exports),lE=pn,uE=Ze,hE=Y,pE=xo,_E=ht("iterator"),EE=Object,fE=function(t0){if(hE(t0))return!1;var e0=EE(t0);return e0[_E]!==void 0||"@@iterator"in e0||uE(pE,lE(e0))},mE=i(fE),TE=h;wi({global:!0,forced:TE.globalThis!==TE},{globalThis:TE});var SE=i(h),gE=Ad.clear;wi({global:!0,bind:!0,enumerable:!0,forced:h.clearImmediate!==gE},{clearImmediate:gE});var RE=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",CE=h,IE=m,vE=w,yE=RE,AE=ce,bE=Xc,wE=Zc,OE=CE.Function,NE=/MSIE .\./.test(AE)||yE&&function(){var t0=CE.Bun.version.split(".");return t0.length<3||t0[0]==0&&(t0[1]<3||t0[1]==3&&t0[2]==0)}(),DE=wi,PE=h,LE=Ad.set,kE=function(t0,e0){var n0=e0?2:1;return NE?function(r0,i0){var o0=wE(arguments.length,1)>n0,s0=vE(r0)?r0:OE(r0),a0=o0?bE(arguments,n0):[],c0=o0?function(){IE(s0,this,a0)}:s0;return e0?t0(c0,i0):t0(c0)}:t0},ME=PE.setImmediate?kE(LE,!1):LE;DE({global:!0,bind:!0,enumerable:!0,forced:PE.setImmediate!==ME},{setImmediate:ME});var UE=i(ie.setImmediate),xE=wi,VE=$d,FE=De,BE=Zc,jE=jn,GE=h.process;xE({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(t0){BE(arguments.length,1),FE(t0);var e0=jE&&GE.domain;VE(e0?e0.bind(t0):t0)}});var WE=i(ie.queueMicrotask);function HE(t0,e0){return function(){return t0.apply(e0,arguments)}}const{toString:KE}=Object.prototype,{getPrototypeOf:YE}=Object,qE=(zE=Object.create(null),t0=>{const e0=KE.call(t0);return zE[e0]||(zE[e0]=e0.slice(8,-1).toLowerCase())});var zE;const JE=t0=>(t0=t0.toLowerCase(),e0=>qE(e0)===t0),XE=t0=>e0=>typeof e0===t0,{isArray:QE}=Array,ZE=XE("undefined"),$E=JE("ArrayBuffer"),ef=XE("string"),tf=XE("function"),nf=XE("number"),rf=t0=>t0!==null&&typeof t0=="object",of=t0=>{if(qE(t0)!=="object")return!1;const e0=YE(t0);return!(e0!==null&&e0!==Object.prototype&&Object.getPrototypeOf(e0)!==null||Symbol.toStringTag in t0||mE(t0))},sf=JE("Date"),af=JE("File"),cf=JE("Blob"),df=JE("FileList"),lf=JE("URLSearchParams"),[uf,hf,pf,_f]=["ReadableStream","Request","Response","Headers"].map(JE);function Ef(t0,e0){let n0,r0,{allOwnKeys:i0=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t0!=null)if(typeof t0!="object"&&(t0=[t0]),QE(t0))for(n0=0,r0=t0.length;n0<r0;n0++)e0.call(null,t0[n0],n0,t0);else{const o0=i0?Object.getOwnPropertyNames(t0):Object.keys(t0),s0=o0.length;let a0;for(n0=0;n0<s0;n0++)a0=o0[n0],e0.call(null,t0[a0],a0,t0)}}function ff(t0,e0){e0=e0.toLowerCase();const n0=Object.keys(t0);let r0,i0=n0.length;for(;i0-- >0;)if(r0=n0[i0],e0===r0.toLowerCase())return r0;return null}const mf=SE!==void 0?SE:typeof self<"u"?self:typeof window<"u"?window:global,Tf=t0=>!ZE(t0)&&t0!==mf,Sf=(gf=typeof Uint8Array<"u"&&YE(Uint8Array),t0=>gf&&t0 instanceof gf);var gf;const Rf=JE("HTMLFormElement"),Cf=(t0=>{let{hasOwnProperty:e0}=t0;return(n0,r0)=>e0.call(n0,r0)})(Object.prototype),If=JE("RegExp"),vf=(t0,e0)=>{const n0=Object.getOwnPropertyDescriptors(t0),r0={};Ef(n0,(i0,o0)=>{let s0;(s0=e0(i0,o0,t0))!==!1&&(r0[o0]=s0||i0)}),Object.defineProperties(t0,r0)},yf="abcdefghijklmnopqrstuvwxyz",Af="0123456789",bf={DIGIT:Af,ALPHA:yf,ALPHA_DIGIT:yf+yf.toUpperCase()+Af},wf=JE("AsyncFunction"),Of=(Nf=typeof UE=="function",Df=tf(mf.postMessage),Nf?UE:Df?(Pf="axios@".concat(Math.random()),Lf=[],mf.addEventListener("message",t0=>{let{source:e0,data:n0}=t0;e0===mf&&n0===Pf&&Lf.length&&Lf.shift()()},!1),t0=>{Lf.push(t0),mf.postMessage(Pf,"*")}):t0=>setTimeout(t0));var Nf,Df,Pf,Lf;const kf=WE!==void 0?WE.bind(mf):typeof process<"u"&&process.nextTick||Of;var Mf={isArray:QE,isArrayBuffer:$E,isBuffer:function(t0){return t0!==null&&!ZE(t0)&&t0.constructor!==null&&!ZE(t0.constructor)&&tf(t0.constructor.isBuffer)&&t0.constructor.isBuffer(t0)},isFormData:t0=>{let e0;return t0&&(typeof FormData=="function"&&t0 instanceof FormData||tf(t0.append)&&((e0=qE(t0))==="formdata"||e0==="object"&&tf(t0.toString)&&t0.toString()==="[object FormData]"))},isArrayBufferView:function(t0){let e0;return e0=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t0):t0&&t0.buffer&&$E(t0.buffer),e0},isString:ef,isNumber:nf,isBoolean:t0=>t0===!0||t0===!1,isObject:rf,isPlainObject:of,isReadableStream:uf,isRequest:hf,isResponse:pf,isHeaders:_f,isUndefined:ZE,isDate:sf,isFile:af,isBlob:cf,isRegExp:If,isFunction:tf,isStream:t0=>rf(t0)&&tf(t0.pipe),isURLSearchParams:lf,isTypedArray:Sf,isFileList:df,forEach:Ef,merge:function t0(){const{caseless:e0}=Tf(this)&&this||{},n0={},r0=(i0,o0)=>{const s0=e0&&ff(n0,o0)||o0;of(n0[s0])&&of(i0)?n0[s0]=t0(n0[s0],i0):of(i0)?n0[s0]=t0({},i0):QE(i0)?n0[s0]=i0.slice():n0[s0]=i0};for(let i0=0,o0=arguments.length;i0<o0;i0++)arguments[i0]&&Ef(arguments[i0],r0);return n0},extend:function(t0,e0,n0){let{allOwnKeys:r0}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Ef(e0,(i0,o0)=>{n0&&tf(i0)?t0[o0]=HE(i0,n0):t0[o0]=i0},{allOwnKeys:r0}),t0},trim:t0=>jp(t0)?jp(t0).call(t0):t0.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t0=>(t0.charCodeAt(0)===65279&&(t0=t0.slice(1)),t0),inherits:(t0,e0,n0,r0)=>{t0.prototype=Object.create(e0.prototype,r0),t0.prototype.constructor=t0,Object.defineProperty(t0,"super",{value:e0.prototype}),n0&&Object.assign(t0.prototype,n0)},toFlatObject:(t0,e0,n0,r0)=>{let i0,o0,s0;const a0={};if(e0=e0||{},t0==null)return e0;do{for(i0=Object.getOwnPropertyNames(t0),o0=i0.length;o0-- >0;)s0=i0[o0],r0&&!r0(s0,t0,e0)||a0[s0]||(e0[s0]=t0[s0],a0[s0]=!0);t0=n0!==!1&&YE(t0)}while(t0&&(!n0||n0(t0,e0))&&t0!==Object.prototype);return e0},kindOf:qE,kindOfTest:JE,endsWith:(t0,e0,n0)=>{t0=String(t0),(n0===void 0||n0>t0.length)&&(n0=t0.length),n0-=e0.length;const r0=t0.indexOf(e0,n0);return r0!==-1&&r0===n0},toArray:t0=>{if(!t0)return null;if(QE(t0))return t0;let e0=t0.length;if(!nf(e0))return null;const n0=new Array(e0);for(;e0-- >0;)n0[e0]=t0[e0];return n0},forEachEntry:(t0,e0)=>{const n0=(t0&&t0[Symbol.iterator]).call(t0);let r0;for(;(r0=n0.next())&&!r0.done;){const i0=r0.value;e0.call(t0,i0[0],i0[1])}},matchAll:(t0,e0)=>{let n0;const r0=[];for(;(n0=t0.exec(e0))!==null;)r0.push(n0);return r0},isHTMLForm:Rf,hasOwnProperty:Cf,hasOwnProp:Cf,reduceDescriptors:vf,freezeMethods:t0=>{vf(t0,(e0,n0)=>{if(tf(t0)&&["arguments","caller","callee"].indexOf(n0)!==-1)return!1;const r0=t0[n0];tf(r0)&&(e0.enumerable=!1,"writable"in e0?e0.writable=!1:e0.set||(e0.set=()=>{throw Error("Can not rewrite read-only method '"+n0+"'")}))})},toObjectSet:(t0,e0)=>{const n0={},r0=i0=>{i0.forEach(o0=>{n0[o0]=!0})};return QE(t0)?r0(t0):r0(String(t0).split(e0)),n0},toCamelCase:t0=>t0.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e0,n0,r0){return n0.toUpperCase()+r0}),noop:()=>{},toFiniteNumber:(t0,e0)=>t0!=null&&Number.isFinite(t0=+t0)?t0:e0,findKey:ff,global:mf,isContextDefined:Tf,ALPHABET:bf,generateString:function(){let t0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:bf.ALPHA_DIGIT,n0="";const{length:r0}=e0;for(;t0--;)n0+=e0[Math.random()*r0|0];return n0},isSpecCompliantForm:function(t0){return!!(t0&&tf(t0.append)&&t0[Symbol.toStringTag]==="FormData"&&t0[Symbol.iterator])},toJSONObject:t0=>{const e0=new Array(10),n0=(r0,i0)=>{if(rf(r0)){if(e0.indexOf(r0)>=0)return;if(!("toJSON"in r0)){e0[i0]=r0;const o0=QE(r0)?[]:{};return Ef(r0,(s0,a0)=>{const c0=n0(s0,i0+1);!ZE(c0)&&(o0[a0]=c0)}),e0[i0]=void 0,o0}}return r0};return n0(t0,0)},isAsyncFn:wf,isThenable:t0=>t0&&(rf(t0)||tf(t0))&&tf(t0.then)&&tf(t0.catch),setImmediate:Of,asap:kf};function Uf(t0,e0,n0,r0,i0){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t0,this.name="AxiosError",e0&&(this.code=e0),n0&&(this.config=n0),r0&&(this.request=r0),i0&&(this.response=i0,this.status=i0.status?i0.status:null)}Mf.inherits(Uf,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Mf.toJSONObject(this.config),code:this.code,status:this.status}}});const xf=Uf.prototype,Vf={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t0=>{Vf[t0]={value:t0}}),Object.defineProperties(Uf,Vf),Object.defineProperty(xf,"isAxiosError",{value:!0}),Uf.from=(t0,e0,n0,r0,i0,o0)=>{const s0=Object.create(xf);return Mf.toFlatObject(t0,s0,function(a0){return a0!==Error.prototype},a0=>a0!=="isAxiosError"),Uf.call(s0,t0.message,e0,n0,r0,i0),s0.cause=t0,s0.name=t0.name,o0&&Object.assign(s0,o0),s0};function Ff(t0){return Mf.isPlainObject(t0)||Mf.isArray(t0)}function Bf(t0){return Mf.endsWith(t0,"[]")?t0.slice(0,-2):t0}function jf(t0,e0,n0){return t0?t0.concat(e0).map(function(r0,i0){return r0=Bf(r0),!n0&&i0?"["+r0+"]":r0}).join(n0?".":""):e0}const Gf=Mf.toFlatObject(Mf,{},null,function(t0){return/^is[A-Z]/.test(t0)});function Wf(t0,e0,n0){if(!Mf.isObject(t0))throw new TypeError("target must be an object");e0=e0||new FormData;const r0=(n0=Mf.toFlatObject(n0,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h0,p0){return!Mf.isUndefined(p0[h0])})).metaTokens,i0=n0.visitor||u0,o0=n0.dots,s0=n0.indexes,a0=(n0.Blob||typeof Blob<"u"&&Blob)&&Mf.isSpecCompliantForm(e0);if(!Mf.isFunction(i0))throw new TypeError("visitor must be a function");function c0(h0){if(h0===null)return"";if(Mf.isDate(h0))return h0.toISOString();if(!a0&&Mf.isBlob(h0))throw new Uf("Blob is not supported. Use a Buffer instead.");return Mf.isArrayBuffer(h0)||Mf.isTypedArray(h0)?a0&&typeof Blob=="function"?new Blob([h0]):Buffer.from(h0):h0}function u0(h0,p0,m0){let f0=h0;if(h0&&!m0&&typeof h0=="object"){if(Mf.endsWith(p0,"{}"))p0=r0?p0:p0.slice(0,-2),h0=JSON.stringify(h0);else if(Mf.isArray(h0)&&function(g0){return Mf.isArray(g0)&&!g0.some(Ff)}(h0)||(Mf.isFileList(h0)||Mf.endsWith(p0,"[]"))&&(f0=Mf.toArray(h0)))return p0=Bf(p0),f0.forEach(function(g0,E0){!Mf.isUndefined(g0)&&g0!==null&&e0.append(s0===!0?jf([p0],E0,o0):s0===null?p0:p0+"[]",c0(g0))}),!1}return!!Ff(h0)||(e0.append(jf(m0,p0,o0),c0(h0)),!1)}const l0=[],d0=Object.assign(Gf,{defaultVisitor:u0,convertValue:c0,isVisitable:Ff});if(!Mf.isObject(t0))throw new TypeError("data must be an object");return function h0(p0,m0){if(!Mf.isUndefined(p0)){if(l0.indexOf(p0)!==-1)throw Error("Circular reference detected in "+m0.join("."));l0.push(p0),Mf.forEach(p0,function(f0,g0){(!(Mf.isUndefined(f0)||f0===null)&&i0.call(e0,f0,Mf.isString(g0)?jp(g0).call(g0):g0,m0,d0))===!0&&h0(f0,m0?m0.concat(g0):[g0])}),l0.pop()}}(t0),e0}function Hf(t0){const e0={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t0).replace(/[!'()~]|%20|%00/g,function(n0){return e0[n0]})}function Kf(t0,e0){this._pairs=[],t0&&Wf(t0,this,e0)}const Yf=Kf.prototype;function qf(t0){return encodeURIComponent(t0).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zf(t0,e0,n0){if(!e0)return t0;const r0=n0&&n0.encode||qf,i0=n0&&n0.serialize;let o0;if(o0=i0?i0(e0,n0):Mf.isURLSearchParams(e0)?e0.toString():new Kf(e0,n0).toString(r0),o0){const s0=t0.indexOf("#");s0!==-1&&(t0=t0.slice(0,s0)),t0+=(t0.indexOf("?")===-1?"?":"&")+o0}return t0}Yf.append=function(t0,e0){this._pairs.push([t0,e0])},Yf.toString=function(t0){const e0=t0?function(n0){return t0.call(this,n0,Hf)}:Hf;return this._pairs.map(function(n0){return e0(n0[0])+"="+e0(n0[1])},"").join("&")};var Jf=class{constructor(){this.handlers=[]}use(t0,e0,n0){return this.handlers.push({fulfilled:t0,rejected:e0,synchronous:!!n0&&n0.synchronous,runWhen:n0?n0.runWhen:null}),this.handlers.length-1}eject(t0){this.handlers[t0]&&(this.handlers[t0]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t0){Mf.forEach(this.handlers,function(e0){e0!==null&&t0(e0)})}},Xf={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Qf={exports:{}},Zf=wi,$f=N,em=Qt.f;Zf({target:"Object",stat:!0,forced:Object.defineProperty!==em,sham:!$f},{defineProperty:em});var tm=ie.Object,im=Qf.exports=function(t0,e0,n0){return tm.defineProperty(t0,e0,n0)};tm.defineProperty.sham&&(im.sham=!0);var nm=i(Qf.exports),rm=R,om=Array.isArray||function(t0){return rm(t0)=="Array"},sm=TypeError,am=om,cm=jc,dm=te,lm=ht("species"),um=Array,hm=function(t0){var e0;return am(t0)&&(e0=t0.constructor,(cm(e0)&&(e0===um||am(e0.prototype))||dm(e0)&&(e0=e0[lm])===null)&&(e0=void 0)),e0===void 0?um:e0},pm=function(t0,e0){return new(hm(t0))(e0===0?0:e0)},_m=n,Em=Ee,fm=ht("species"),mm=function(t0){return Em>=51||!_m(function(){var e0=[];return(e0.constructor={})[fm]=function(){return{foo:1}},e0[t0](Boolean).foo!==1})},Tm=wi,Sm=n,gm=om,Rm=te,Cm=Je,Im=Gi,vm=function(t0){if(t0>9007199254740991)throw sm("Maximum allowed index exceeded");return t0},ym=E_,Am=pm,bm=mm,wm=Ee,Om=ht("isConcatSpreadable"),Nm=wm>=51||!Sm(function(){var t0=[];return t0[Om]=!1,t0.concat()[0]!==t0}),Dm=function(t0){if(!Rm(t0))return!1;var e0=t0[Om];return e0!==void 0?!!e0:gm(t0)};Tm({target:"Array",proto:!0,arity:1,forced:!Nm||!bm("concat")},{concat:function(t0){var e0,n0,r0,i0,o0,s0=Cm(this),a0=Am(s0,0),c0=0;for(e0=-1,r0=arguments.length;e0<r0;e0++)if(Dm(o0=e0===-1?s0:arguments[e0]))for(i0=Im(o0),vm(c0+i0),n0=0;n0<i0;n0++,c0++)n0 in o0&&ym(a0,c0,o0[n0]);else vm(c0+1),ym(a0,c0++,o0);return a0.length=c0,a0}});var Pm={},Lm=R,km=Z,Mm=Or.f,Um=R_,xm=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Pm.f=function(t0){return xm&&Lm(t0)=="Window"?function(e0){try{return Mm(e0)}catch{return Um(xm)}}(t0):Mm(km(t0))};var Vm={},Fm=ht;Vm.f=Fm;var Bm=ie,jm=Ze,Gm=Vm,Wm=Qt.f,Hm=function(t0){var e0=Bm.Symbol||(Bm.Symbol={});jm(e0,t0)||Wm(e0,t0,{value:Gm.f(t0)})},Km=L,Ym=ae,qm=ht,zm=ha,Jm=function(){var t0=Ym("Symbol"),e0=t0&&t0.prototype,n0=e0&&e0.valueOf,r0=qm("toPrimitive");e0&&!e0[r0]&&zm(e0,r0,function(i0){return Km(n0,this)},{arity:1})},Xm=Xt,Qm=K,Zm=Je,$m=Gi,eT=pm,tT=d([].push),iT=function(t0){var e0=t0==1,n0=t0==2,r0=t0==3,i0=t0==4,o0=t0==6,s0=t0==7,a0=t0==5||o0;return function(c0,u0,l0,d0){for(var h0,p0,m0=Zm(c0),f0=Qm(m0),g0=Xm(u0,l0),E0=$m(f0),_0=0,y0=d0||eT,b0=e0?y0(c0,E0):n0||s0?y0(c0,0):void 0;E0>_0;_0++)if((a0||_0 in f0)&&(p0=g0(h0=f0[_0],_0,m0),t0))if(e0)b0[_0]=p0;else if(p0)switch(t0){case 3:return!0;case 5:return h0;case 6:return _0;case 2:tT(b0,h0)}else switch(t0){case 4:return!1;case 7:tT(b0,h0)}return o0?-1:r0||i0?i0:b0}},nT={forEach:iT(0),map:iT(1),filter:iT(2),some:iT(3),every:iT(4),find:iT(5),findIndex:iT(6),filterReject:iT(7)},rT=wi,oT=h,sT=L,aT=d,cT=N,dT=Se,lT=n,uT=Ze,hT=l,pT=ii,_T=Z,ET=Ct,fT=fn,mT=B,TT=Io,ST=eo,gT=Or,RT=Pm,CT=Br,IT=O,vT=Qt,yT=Qr,AT=k,bT=ha,wT=hc,OT=Ye,NT=Nr,DT=nt,PT=ht,LT=Vm,kT=Hm,MT=Jm,UT=Da,xT=ra,VT=nT.forEach,FT=lr("hidden"),BT="Symbol",jT="prototype",GT=xT.set,WT=xT.getterFor(BT),HT=Object[jT],KT=oT.Symbol,YT=KT&&KT[jT],qT=oT.TypeError,zT=oT.QObject,JT=IT.f,XT=vT.f,QT=RT.f,ZT=AT.f,$T=aT([].push),eS=OT("symbols"),tS=OT("op-symbols"),iS=OT("wks"),nS=!zT||!zT[jT]||!zT[jT].findChild,rS=cT&&lT(function(){return TT(XT({},"a",{get:function(){return XT(this,"a",{value:7}).a}})).a!=7})?function(t0,e0,n0){var r0=JT(HT,e0);r0&&delete HT[e0],XT(t0,e0,n0),r0&&t0!==HT&&XT(HT,e0,r0)}:XT,oS=function(t0,e0){var n0=eS[t0]=TT(YT);return GT(n0,{type:BT,tag:t0,description:e0}),cT||(n0.description=e0),n0},sS=function(t0,e0,n0){t0===HT&&sS(tS,e0,n0),pT(t0);var r0=ET(e0);return pT(n0),uT(eS,r0)?(n0.enumerable?(uT(t0,FT)&&t0[FT][r0]&&(t0[FT][r0]=!1),n0=TT(n0,{enumerable:mT(0,!1)})):(uT(t0,FT)||XT(t0,FT,mT(1,{})),t0[FT][r0]=!0),rS(t0,r0,n0)):XT(t0,r0,n0)},aS=function(t0,e0){pT(t0);var n0=_T(e0),r0=ST(n0).concat(uS(n0));return VT(r0,function(i0){cT&&!sT(cS,n0,i0)||sS(t0,i0,n0[i0])}),t0},cS=function(t0){var e0=ET(t0),n0=sT(ZT,this,e0);return!(this===HT&&uT(eS,e0)&&!uT(tS,e0))&&(!(n0||!uT(this,e0)||!uT(eS,e0)||uT(this,FT)&&this[FT][e0])||n0)},dS=function(t0,e0){var n0=_T(t0),r0=ET(e0);if(n0!==HT||!uT(eS,r0)||uT(tS,r0)){var i0=JT(n0,r0);return!i0||!uT(eS,r0)||uT(n0,FT)&&n0[FT][r0]||(i0.enumerable=!0),i0}},lS=function(t0){var e0=QT(_T(t0)),n0=[];return VT(e0,function(r0){uT(eS,r0)||uT(NT,r0)||$T(n0,r0)}),n0},uS=function(t0){var e0=t0===HT,n0=QT(e0?tS:_T(t0)),r0=[];return VT(n0,function(i0){!uT(eS,i0)||e0&&!uT(HT,i0)||$T(r0,eS[i0])}),r0};dT||(bT(YT=(KT=function(){if(hT(YT,this))throw qT("Symbol is not a constructor");var t0=arguments.length&&arguments[0]!==void 0?fT(arguments[0]):void 0,e0=DT(t0),n0=function(r0){this===HT&&sT(n0,tS,r0),uT(this,FT)&&uT(this[FT],e0)&&(this[FT][e0]=!1),rS(this,e0,mT(1,r0))};return cT&&nS&&rS(HT,e0,{configurable:!0,set:n0}),oS(e0,t0)})[jT],"toString",function(){return WT(this).tag}),bT(KT,"withoutSetter",function(t0){return oS(DT(t0),t0)}),AT.f=cS,vT.f=sS,yT.f=aS,IT.f=dS,gT.f=RT.f=lS,CT.f=uS,LT.f=function(t0){return oS(PT(t0),t0)},cT&&wT(YT,"description",{configurable:!0,get:function(){return WT(this).description}})),rT({global:!0,constructor:!0,wrap:!0,forced:!dT,sham:!dT},{Symbol:KT}),VT(ST(iS),function(t0){kT(t0)}),rT({target:BT,stat:!0,forced:!dT},{useSetter:function(){nS=!0},useSimple:function(){nS=!1}}),rT({target:"Object",stat:!0,forced:!dT,sham:!cT},{create:function(t0,e0){return e0===void 0?TT(t0):aS(TT(t0),e0)},defineProperty:sS,defineProperties:aS,getOwnPropertyDescriptor:dS}),rT({target:"Object",stat:!0,forced:!dT},{getOwnPropertyNames:lS}),MT(),UT(KT,BT),NT[FT]=!0;var hS=Se&&!!Symbol.for&&!!Symbol.keyFor,pS=wi,_S=ae,ES=Ze,fS=fn,mS=Ye,TS=hS,SS=mS("string-to-symbol-registry"),gS=mS("symbol-to-string-registry");pS({target:"Symbol",stat:!0,forced:!TS},{for:function(t0){var e0=fS(t0);if(ES(SS,e0))return SS[e0];var n0=_S("Symbol")(e0);return SS[e0]=n0,gS[n0]=e0,n0}});var RS=wi,CS=Ze,IS=ye,vS=be,yS=hS,AS=Ye("symbol-to-string-registry");RS({target:"Symbol",stat:!0,forced:!yS},{keyFor:function(t0){if(!IS(t0))throw TypeError(vS(t0)+" is not a symbol");if(CS(AS,t0))return AS[t0]}});var bS=om,wS=w,OS=R,NS=fn,DS=d([].push),PS=wi,LS=ae,kS=m,MS=L,US=d,xS=n,VS=w,FS=ye,BS=Xc,jS=function(t0){if(wS(t0))return t0;if(bS(t0)){for(var e0=t0.length,n0=[],r0=0;r0<e0;r0++){var i0=t0[r0];typeof i0=="string"?DS(n0,i0):typeof i0!="number"&&OS(i0)!="Number"&&OS(i0)!="String"||DS(n0,NS(i0))}var o0=n0.length,s0=!0;return function(a0,c0){if(s0)return s0=!1,c0;if(bS(this))return c0;for(var u0=0;u0<o0;u0++)if(n0[u0]===a0)return c0}}},GS=Se,WS=String,HS=LS("JSON","stringify"),KS=US(/./.exec),YS=US("".charAt),qS=US("".charCodeAt),zS=US("".replace),JS=US(1 .toString),XS=/[\uD800-\uDFFF]/g,QS=/^[\uD800-\uDBFF]$/,ZS=/^[\uDC00-\uDFFF]$/,$S=!GS||xS(function(){var t0=LS("Symbol")();return HS([t0])!="[null]"||HS({a:t0})!="{}"||HS(Object(t0))!="{}"}),eg=xS(function(){return HS("\uDF06\uD834")!=='"\\udf06\\ud834"'||HS("\uDEAD")!=='"\\udead"'}),tg=function(t0,e0){var n0=BS(arguments),r0=jS(e0);if(VS(r0)||t0!==void 0&&!FS(t0))return n0[1]=function(i0,o0){if(VS(r0)&&(o0=MS(r0,this,WS(i0),o0)),!FS(o0))return o0},kS(HS,null,n0)},ig=function(t0,e0,n0){var r0=YS(n0,e0-1),i0=YS(n0,e0+1);return KS(QS,t0)&&!KS(ZS,i0)||KS(ZS,t0)&&!KS(QS,r0)?"\\u"+JS(qS(t0,0),16):t0};HS&&PS({target:"JSON",stat:!0,arity:3,forced:$S||eg},{stringify:function(t0,e0,n0){var r0=BS(arguments),i0=kS($S?tg:HS,null,r0);return eg&&typeof i0=="string"?zS(i0,XS,ig):i0}});var ng=Br,rg=Je;wi({target:"Object",stat:!0,forced:!Se||n(function(){ng.f(1)})},{getOwnPropertySymbols:function(t0){var e0=ng.f;return e0?e0(rg(t0)):[]}}),Hm("asyncIterator"),Hm("hasInstance"),Hm("isConcatSpreadable"),Hm("iterator"),Hm("match"),Hm("matchAll"),Hm("replace"),Hm("search"),Hm("species"),Hm("split");var og=Jm;Hm("toPrimitive"),og();var sg=ae,ag=Da;Hm("toStringTag"),ag(sg("Symbol"),"Symbol"),Hm("unscopables"),Da(h.JSON,"JSON",!0);var cg=ie.Symbol,dg=ht,lg=Qt.f,ug=dg("metadata"),hg=Function.prototype;hg[ug]===void 0&&lg(hg,ug,{value:null}),Hm("dispose"),Hm("metadata");var pg=cg;Hm("asyncDispose");var _g=d,Eg=ae("Symbol"),fg=Eg.keyFor,mg=_g(Eg.prototype.valueOf),Tg=Eg.isRegisteredSymbol||function(t0){try{return fg(mg(t0))!==void 0}catch{return!1}};wi({target:"Symbol",stat:!0},{isRegisteredSymbol:Tg});for(var Sg=Ye,gg=ae,Rg=d,Cg=ye,Ig=ht,vg=gg("Symbol"),yg=vg.isWellKnownSymbol,Ag=gg("Object","getOwnPropertyNames"),bg=Rg(vg.prototype.valueOf),wg=Sg("wks"),Og=0,Ng=Ag(vg),Dg=Ng.length;Og<Dg;Og++)try{var Pg=Ng[Og];Cg(vg[Pg])&&Ig(Pg)}catch{}var Lg=function(t0){if(yg&&yg(t0))return!0;try{for(var e0=bg(t0),n0=0,r0=Ag(wg),i0=r0.length;n0<i0;n0++)if(wg[r0[n0]]==e0)return!0}catch{}return!1};wi({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Lg}),Hm("matcher"),Hm("observable"),wi({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Tg}),wi({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Lg}),Hm("metadataKey"),Hm("patternMatch"),Hm("replaceAll");var kg=i(pg),Mg=i(Vm.f("iterator"));function Ug(t0){return Ug=typeof kg=="function"&&typeof Mg=="symbol"?function(e0){return typeof e0}:function(e0){return e0&&typeof kg=="function"&&e0.constructor===kg&&e0!==kg.prototype?"symbol":typeof e0},Ug(t0)}var xg=i(Vm.f("toPrimitive"));function Vg(t0){var e0=function(n0,r0){if(Ug(n0)!=="object"||n0===null)return n0;var i0=n0[xg];if(i0!==void 0){var o0=i0.call(n0,r0||"default");if(Ug(o0)!=="object")return o0;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r0==="string"?String:Number)(n0)}(t0,"string");return Ug(e0)==="symbol"?e0:String(e0)}function Fg(t0,e0,n0){return(e0=Vg(e0))in t0?nm(t0,e0,{value:n0,enumerable:!0,configurable:!0,writable:!0}):t0[e0]=n0,t0}var Bg=n,jg=ht("iterator"),Gg=!Bg(function(){var t0=new URL("b?a=1&b=2&c=3","http://a"),e0=t0.searchParams,n0=new URLSearchParams("a=1&a=2"),r0="";return t0.pathname="c%20d",e0.forEach(function(i0,o0){e0.delete("b"),r0+=o0+i0}),n0.delete("a",2),!t0.toJSON||!n0.has("a",1)||n0.has("a",2)||!e0.size&&!0||!e0.sort||t0.href!=="http://a/c%20d?a=1&c=3"||e0.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e0[jg]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||r0!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Wg=ha,Hg=wi,Kg=h,Yg=L,qg=d,zg=N,Jg=Gg,Xg=ha,Qg=hc,Zg=function(t0,e0,n0){for(var r0 in e0)n0&&n0.unsafe&&t0[r0]?t0[r0]=e0[r0]:Wg(t0,r0,e0[r0],n0);return t0},$g=Da,eR=Va,tR=ra,iR=Sc,nR=w,rR=Ze,oR=Xt,sR=pn,aR=ii,cR=te,dR=fn,lR=Io,uR=B,hR=es,pR=qo,_R=Zc,ER=b_,fR=ht("iterator"),mR="URLSearchParams",TR=mR+"Iterator",SR=tR.set,gR=tR.getterFor(mR),RR=tR.getterFor(TR),CR=Object.getOwnPropertyDescriptor,IR=function(t0){if(!zg)return Kg[t0];var e0=CR(Kg,t0);return e0&&e0.value},vR=IR("fetch"),yR=IR("Request"),AR=IR("Headers"),bR=yR&&yR.prototype,wR=AR&&AR.prototype,OR=Kg.RegExp,NR=Kg.TypeError,DR=Kg.decodeURIComponent,PR=Kg.encodeURIComponent,LR=qg("".charAt),kR=qg([].join),MR=qg([].push),UR=qg("".replace),xR=qg([].shift),VR=qg([].splice),FR=qg("".split),BR=qg("".slice),jR=/\+/g,GR=Array(4),WR=function(t0){return GR[t0-1]||(GR[t0-1]=OR("((?:%[\\da-f]{2}){"+t0+"})","gi"))},HR=function(t0){try{return DR(t0)}catch{return t0}},KR=function(t0){var e0=UR(t0,jR," "),n0=4;try{return DR(e0)}catch{for(;n0;)e0=UR(e0,WR(n0--),HR);return e0}},YR=/[!'()~]|%20/g,qR={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},zR=function(t0){return qR[t0]},JR=function(t0){return UR(PR(t0),YR,zR)},XR=eR(function(t0,e0){SR(this,{type:TR,iterator:hR(gR(t0).entries),kind:e0})},"Iterator",function(){var t0=RR(this),e0=t0.kind,n0=t0.iterator.next(),r0=n0.value;return n0.done||(n0.value=e0==="keys"?r0.key:e0==="values"?r0.value:[r0.key,r0.value]),n0},!0),QR=function(t0){this.entries=[],this.url=null,t0!==void 0&&(cR(t0)?this.parseObject(t0):this.parseQuery(typeof t0=="string"?LR(t0,0)==="?"?BR(t0,1):t0:dR(t0)))};QR.prototype={type:mR,bindURL:function(t0){this.url=t0,this.update()},parseObject:function(t0){var e0,n0,r0,i0,o0,s0,a0,c0=pR(t0);if(c0)for(n0=(e0=hR(t0,c0)).next;!(r0=Yg(n0,e0)).done;){if(o0=(i0=hR(aR(r0.value))).next,(s0=Yg(o0,i0)).done||(a0=Yg(o0,i0)).done||!Yg(o0,i0).done)throw NR("Expected sequence with length 2");MR(this.entries,{key:dR(s0.value),value:dR(a0.value)})}else for(var u0 in t0)rR(t0,u0)&&MR(this.entries,{key:u0,value:dR(t0[u0])})},parseQuery:function(t0){if(t0)for(var e0,n0,r0=FR(t0,"&"),i0=0;i0<r0.length;)(e0=r0[i0++]).length&&(n0=FR(e0,"="),MR(this.entries,{key:KR(xR(n0)),value:KR(kR(n0,"="))}))},serialize:function(){for(var t0,e0=this.entries,n0=[],r0=0;r0<e0.length;)t0=e0[r0++],MR(n0,JR(t0.key)+"="+JR(t0.value));return kR(n0,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ZR=function(){iR(this,$R);var t0=SR(this,new QR(arguments.length>0?arguments[0]:void 0));zg||(this.size=t0.entries.length)},$R=ZR.prototype;if(Zg($R,{append:function(t0,e0){var n0=gR(this);_R(arguments.length,2),MR(n0.entries,{key:dR(t0),value:dR(e0)}),zg||this.length++,n0.updateURL()},delete:function(t0){for(var e0=gR(this),n0=_R(arguments.length,1),r0=e0.entries,i0=dR(t0),o0=n0<2?void 0:arguments[1],s0=o0===void 0?o0:dR(o0),a0=0;a0<r0.length;){var c0=r0[a0];if(c0.key!==i0||s0!==void 0&&c0.value!==s0)a0++;else if(VR(r0,a0,1),s0!==void 0)break}zg||(this.size=r0.length),e0.updateURL()},get:function(t0){var e0=gR(this).entries;_R(arguments.length,1);for(var n0=dR(t0),r0=0;r0<e0.length;r0++)if(e0[r0].key===n0)return e0[r0].value;return null},getAll:function(t0){var e0=gR(this).entries;_R(arguments.length,1);for(var n0=dR(t0),r0=[],i0=0;i0<e0.length;i0++)e0[i0].key===n0&&MR(r0,e0[i0].value);return r0},has:function(t0){for(var e0=gR(this).entries,n0=_R(arguments.length,1),r0=dR(t0),i0=n0<2?void 0:arguments[1],o0=i0===void 0?i0:dR(i0),s0=0;s0<e0.length;){var a0=e0[s0++];if(a0.key===r0&&(o0===void 0||a0.value===o0))return!0}return!1},set:function(t0,e0){var n0=gR(this);_R(arguments.length,1);for(var r0,i0=n0.entries,o0=!1,s0=dR(t0),a0=dR(e0),c0=0;c0<i0.length;c0++)(r0=i0[c0]).key===s0&&(o0?VR(i0,c0--,1):(o0=!0,r0.value=a0));o0||MR(i0,{key:s0,value:a0}),zg||(this.size=i0.length),n0.updateURL()},sort:function(){var t0=gR(this);ER(t0.entries,function(e0,n0){return e0.key>n0.key?1:-1}),t0.updateURL()},forEach:function(t0){for(var e0,n0=gR(this).entries,r0=oR(t0,arguments.length>1?arguments[1]:void 0),i0=0;i0<n0.length;)r0((e0=n0[i0++]).value,e0.key,this)},keys:function(){return new XR(this,"keys")},values:function(){return new XR(this,"values")},entries:function(){return new XR(this,"entries")}},{enumerable:!0}),Xg($R,fR,$R.entries,{name:"entries"}),Xg($R,"toString",function(){return gR(this).serialize()},{enumerable:!0}),zg&&Qg($R,"size",{get:function(){return gR(this).entries.length},configurable:!0,enumerable:!0}),$g(ZR,mR),Hg({global:!0,constructor:!0,forced:!Jg},{URLSearchParams:ZR}),!Jg&&nR(AR)){var eC=qg(wR.has),tC=qg(wR.set),iC=function(t0){if(cR(t0)){var e0,n0=t0.body;if(sR(n0)===mR)return e0=t0.headers?new AR(t0.headers):new AR,eC(e0,"content-type")||tC(e0,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),lR(t0,{body:uR(0,dR(n0)),headers:uR(0,e0)})}return t0};if(nR(vR)&&Hg({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t0){return vR(t0,arguments.length>1?iC(arguments[1]):{})}}),nR(yR)){var nC=function(t0){return iR(this,bR),new yR(t0,arguments.length>1?iC(arguments[1]):{})};bR.constructor=nC,nC.prototype=bR,Hg({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:nC})}}var rC={URLSearchParams:ZR,getState:gR},oC=i(ie.URLSearchParams),sC={isBrowser:!0,classes:{URLSearchParams:oC!==void 0?oC:Kf,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const aC=typeof window<"u"&&typeof document<"u",cC=typeof navigator=="object"&&navigator||void 0,dC=aC&&(!cC||["ReactNative","NativeScript","NS"].indexOf(cC.product)<0),lC=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",uC=aC&&window.location.href||"http://localhost";function hC(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function pC(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?hC(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):hC(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}var _C=pC(pC({},Object.freeze({__proto__:null,hasBrowserEnv:aC,hasStandardBrowserEnv:dC,hasStandardBrowserWebWorkerEnv:lC,navigator:cC,origin:uC})),sC),EC=ii,fC=L,mC=Ze,TC=l,SC=function(){var t0=EC(this),e0="";return t0.hasIndices&&(e0+="d"),t0.global&&(e0+="g"),t0.ignoreCase&&(e0+="i"),t0.multiline&&(e0+="m"),t0.dotAll&&(e0+="s"),t0.unicode&&(e0+="u"),t0.unicodeSets&&(e0+="v"),t0.sticky&&(e0+="y"),e0},gC=RegExp.prototype,RC=function(t0){var e0=t0.flags;return e0!==void 0||"flags"in gC||mC(t0,"flags")||!TC(gC,t0)?e0:fC(SC,t0)},CC=Ch.charAt,IC=L,vC=ii,yC=w,AC=R,bC=/./.exec,wC=TypeError,OC=wi,NC=L,DC=v,PC=Va,LC=ic,kC=J,MC=Bi,UC=fn,xC=ii,VC=Y,FC=R,BC=tn,jC=RC,GC=ke,WC=n,HC=Jc,KC=function(t0,e0,n0){return e0+(n0?CC(t0,e0).length:1)},YC=function(t0,e0){var n0=t0.exec;if(yC(n0)){var r0=IC(n0,t0,e0);return r0!==null&&vC(r0),r0}if(AC(t0)==="RegExp")return IC(bC,t0,e0);throw wC("RegExp#exec called on incompatible receiver")},qC=ra,zC=ht("matchAll"),JC="RegExp String",XC=JC+" Iterator",QC=qC.set,ZC=qC.getterFor(XC),$C=TypeError,eI=DC("".indexOf),tI=DC("".matchAll),iI=!!tI&&!WC(function(){tI("a",/./)}),nI=PC(function(t0,e0,n0,r0){QC(this,{type:XC,regexp:t0,string:e0,global:n0,unicode:r0,done:!1})},JC,function(){var t0=ZC(this);if(t0.done)return LC(void 0,!0);var e0=t0.regexp,n0=t0.string,r0=YC(e0,n0);return r0===null?(t0.done=!0,LC(void 0,!0)):t0.global?(UC(r0[0])===""&&(e0.lastIndex=KC(n0,MC(e0.lastIndex),t0.unicode)),LC(r0,!1)):(t0.done=!0,LC(r0,!1))}),rI=function(t0){var e0,n0,r0,i0=xC(this),o0=UC(t0),s0=HC(i0,RegExp),a0=UC(jC(i0));return e0=new s0(s0===RegExp?i0.source:i0,a0),n0=!!~eI(a0,"g"),r0=!!~eI(a0,"u"),e0.lastIndex=MC(i0.lastIndex),new nI(e0,o0,n0,r0)};OC({target:"String",proto:!0,forced:iI},{matchAll:function(t0){var e0,n0,r0,i0,o0=kC(this);if(VC(t0)){if(iI)return tI(o0,t0)}else{if(BC(t0)&&(e0=UC(kC(jC(t0))),!~eI(e0,"g")))throw $C("`.matchAll` does not allow non-global regexes");if(iI)return tI(o0,t0);if((r0=GC(t0,zC))===void 0&&FC(t0)=="RegExp"&&(r0=rI),r0)return NC(r0,t0,o0)}return n0=UC(o0),i0=new RegExp(t0,"g"),NC(rI,i0,n0)}});var oI=Xi("String").matchAll,sI=l,aI=oI,cI=String.prototype,dI=function(t0){var e0=t0.matchAll;return typeof t0=="string"||t0===cI||sI(cI,t0)&&e0===cI.matchAll?aI:e0},lI=i(dI);function uI(t0){function e0(n0,r0,i0,o0){let s0=n0[o0++];if(s0==="__proto__")return!0;const a0=Number.isFinite(+s0),c0=o0>=n0.length;return s0=!s0&&Mf.isArray(i0)?i0.length:s0,c0?(Mf.hasOwnProp(i0,s0)?i0[s0]=[i0[s0],r0]:i0[s0]=r0,!a0):(i0[s0]&&Mf.isObject(i0[s0])||(i0[s0]=[]),e0(n0,r0,i0[s0],o0)&&Mf.isArray(i0[s0])&&(i0[s0]=function(u0){const l0={},d0=Object.keys(u0);let h0;const p0=d0.length;let m0;for(h0=0;h0<p0;h0++)m0=d0[h0],l0[m0]=u0[m0];return l0}(i0[s0])),!a0)}if(Mf.isFormData(t0)&&Mf.isFunction(t0.entries)){const n0={};return Mf.forEachEntry(t0,(r0,i0)=>{e0(function(o0){return lI(Mf).call(Mf,/\w+|\[(\w*)]/g,o0).map(s0=>s0[0]==="[]"?"":s0[1]||s0[0])}(r0),i0,n0,0)}),n0}return null}const hI={transitional:Xf,adapter:["xhr","http","fetch"],transformRequest:[function(t0,e0){const n0=e0.getContentType()||"",r0=n0.indexOf("application/json")>-1,i0=Mf.isObject(t0);if(i0&&Mf.isHTMLForm(t0)&&(t0=new FormData(t0)),Mf.isFormData(t0))return r0?JSON.stringify(uI(t0)):t0;if(Mf.isArrayBuffer(t0)||Mf.isBuffer(t0)||Mf.isStream(t0)||Mf.isFile(t0)||Mf.isBlob(t0)||Mf.isReadableStream(t0))return t0;if(Mf.isArrayBufferView(t0))return t0.buffer;if(Mf.isURLSearchParams(t0))return e0.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t0.toString();let o0;if(i0){if(n0.indexOf("application/x-www-form-urlencoded")>-1)return function(s0,a0){return Wf(s0,new _C.classes.URLSearchParams,Object.assign({visitor:function(c0,u0,l0,d0){return _C.isNode&&Mf.isBuffer(c0)?(this.append(u0,c0.toString("base64")),!1):d0.defaultVisitor.apply(this,arguments)}},a0))}(t0,this.formSerializer).toString();if((o0=Mf.isFileList(t0))||n0.indexOf("multipart/form-data")>-1){const s0=this.env&&this.env.FormData;return Wf(o0?{"files[]":t0}:t0,s0&&new s0,this.formSerializer)}}return i0||r0?(e0.setContentType("application/json",!1),function(s0,a0,c0){if(Mf.isString(s0))try{return(a0||JSON.parse)(s0),jp(Mf).call(Mf,s0)}catch(u0){if(u0.name!=="SyntaxError")throw u0}return(c0||JSON.stringify)(s0)}(t0)):t0}],transformResponse:[function(t0){const e0=this.transitional||hI.transitional,n0=e0&&e0.forcedJSONParsing,r0=this.responseType==="json";if(Mf.isResponse(t0)||Mf.isReadableStream(t0))return t0;if(t0&&Mf.isString(t0)&&(n0&&!this.responseType||r0)){const i0=!(e0&&e0.silentJSONParsing)&&r0;try{return JSON.parse(t0)}catch(o0){if(i0)throw o0.name==="SyntaxError"?Uf.from(o0,Uf.ERR_BAD_RESPONSE,this,null,this.response):o0}}return t0}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:_C.classes.FormData,Blob:_C.classes.Blob},validateStatus:function(t0){return t0>=200&&t0<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Mf.forEach(["delete","get","head","post","put","patch"],t0=>{hI.headers[t0]={}});var pI=hI;const _I=Mf.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),EI=Symbol("internals");function fI(t0){var e0;return t0&&jp(e0=String(t0)).call(e0).toLowerCase()}function mI(t0){return t0===!1||t0==null?t0:Mf.isArray(t0)?t0.map(mI):String(t0)}function TI(t0,e0,n0,r0,i0){return Mf.isFunction(r0)?r0.call(this,e0,n0):(i0&&(e0=n0),Mf.isString(e0)?Mf.isString(r0)?e0.indexOf(r0)!==-1:Mf.isRegExp(r0)?r0.test(e0):void 0:void 0)}class SI{constructor(e0){e0&&this.set(e0)}set(e0,n0,r0){const i0=this;function o0(c0,u0,l0){const d0=fI(u0);if(!d0)throw new Error("header name must be a non-empty string");const h0=Mf.findKey(i0,d0);(!h0||i0[h0]===void 0||l0===!0||l0===void 0&&i0[h0]!==!1)&&(i0[h0||u0]=mI(c0))}const s0=(c0,u0)=>Mf.forEach(c0,(l0,d0)=>o0(l0,d0,u0));if(Mf.isPlainObject(e0)||e0 instanceof this.constructor)s0(e0,n0);else if(Mf.isString(e0)&&(e0=jp(e0).call(e0))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(jp(a0=e0).call(a0)))s0((c0=>{const u0={};let l0,d0,h0;return c0&&c0.split(`
`).forEach(function(p0){var m0,f0;h0=p0.indexOf(":"),l0=jp(m0=p0.substring(0,h0)).call(m0).toLowerCase(),d0=jp(f0=p0.substring(h0+1)).call(f0),!l0||u0[l0]&&_I[l0]||(l0==="set-cookie"?u0[l0]?u0[l0].push(d0):u0[l0]=[d0]:u0[l0]=u0[l0]?u0[l0]+", "+d0:d0)}),u0})(e0),n0);else if(Mf.isHeaders(e0))for(const[c0,u0]of e0.entries())o0(u0,c0,r0);else e0!=null&&o0(n0,e0,r0);var a0;return this}get(e0,n0){if(e0=fI(e0)){const r0=Mf.findKey(this,e0);if(r0){const i0=this[r0];if(!n0)return i0;if(n0===!0)return function(o0){const s0=Object.create(null),a0=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let c0;for(;c0=a0.exec(o0);)s0[c0[1]]=c0[2];return s0}(i0);if(Mf.isFunction(n0))return n0.call(this,i0,r0);if(Mf.isRegExp(n0))return n0.exec(i0);throw new TypeError("parser must be boolean|regexp|function")}}}has(e0,n0){if(e0=fI(e0)){const r0=Mf.findKey(this,e0);return!(!r0||this[r0]===void 0||n0&&!TI(0,this[r0],r0,n0))}return!1}delete(e0,n0){const r0=this;let i0=!1;function o0(s0){if(s0=fI(s0)){const a0=Mf.findKey(r0,s0);!a0||n0&&!TI(0,r0[a0],a0,n0)||(delete r0[a0],i0=!0)}}return Mf.isArray(e0)?e0.forEach(o0):o0(e0),i0}clear(e0){const n0=Object.keys(this);let r0=n0.length,i0=!1;for(;r0--;){const o0=n0[r0];e0&&!TI(0,this[o0],o0,e0,!0)||(delete this[o0],i0=!0)}return i0}normalize(e0){const n0=this,r0={};return Mf.forEach(this,(i0,o0)=>{var s0;const a0=Mf.findKey(r0,o0);if(a0)return n0[a0]=mI(i0),void delete n0[o0];const c0=e0?function(u0){return jp(u0).call(u0).toLowerCase().replace(/([a-z\d])(\w*)/g,(l0,d0,h0)=>d0.toUpperCase()+h0)}(o0):jp(s0=String(o0)).call(s0);c0!==o0&&delete n0[o0],n0[c0]=mI(i0),r0[c0]=!0}),this}concat(){for(var e0=arguments.length,n0=new Array(e0),r0=0;r0<e0;r0++)n0[r0]=arguments[r0];return this.constructor.concat(this,...n0)}toJSON(e0){const n0=Object.create(null);return Mf.forEach(this,(r0,i0)=>{r0!=null&&r0!==!1&&(n0[i0]=e0&&Mf.isArray(r0)?r0.join(", "):r0)}),n0}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e0=>{let[n0,r0]=e0;return n0+": "+r0}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e0){return e0 instanceof this?e0:new this(e0)}static concat(e0){const n0=new this(e0);for(var r0=arguments.length,i0=new Array(r0>1?r0-1:0),o0=1;o0<r0;o0++)i0[o0-1]=arguments[o0];return i0.forEach(s0=>n0.set(s0)),n0}static accessor(e0){const n0=(this[EI]=this[EI]={accessors:{}}).accessors,r0=this.prototype;function i0(o0){const s0=fI(o0);n0[s0]||(function(a0,c0){const u0=Mf.toCamelCase(" "+c0);["get","set","has"].forEach(l0=>{Object.defineProperty(a0,l0+u0,{value:function(d0,h0,p0){return this[l0].call(this,c0,d0,h0,p0)},configurable:!0})})}(r0,o0),n0[s0]=!0)}return Mf.isArray(e0)?e0.forEach(i0):i0(e0),this}}SI.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Mf.reduceDescriptors(SI.prototype,(t0,e0)=>{let{value:n0}=t0,r0=e0[0].toUpperCase()+e0.slice(1);return{get:()=>n0,set(i0){this[r0]=i0}}}),Mf.freezeMethods(SI);var gI=SI;function RI(t0,e0){const n0=this||pI,r0=e0||n0,i0=gI.from(r0.headers);let o0=r0.data;return Mf.forEach(t0,function(s0){o0=s0.call(n0,o0,i0.normalize(),e0?e0.status:void 0)}),i0.normalize(),o0}function CI(t0){return!(!t0||!t0.__CANCEL__)}function II(t0,e0,n0){Uf.call(this,t0??"canceled",Uf.ERR_CANCELED,e0,n0),this.name="CanceledError"}function vI(t0,e0,n0){const r0=n0.config.validateStatus;n0.status&&r0&&!r0(n0.status)?e0(new Uf("Request failed with status code "+n0.status,[Uf.ERR_BAD_REQUEST,Uf.ERR_BAD_RESPONSE][Math.floor(n0.status/100)-4],n0.config,n0.request,n0)):t0(n0)}Mf.inherits(II,Uf,{__CANCEL__:!0});const yI=function(t0,e0){let n0=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r0=0;const i0=function(o0,s0){o0=o0||10;const a0=new Array(o0),c0=new Array(o0);let u0,l0=0,d0=0;return s0=s0!==void 0?s0:1e3,function(h0){const p0=Date.now(),m0=c0[d0];u0||(u0=p0),a0[l0]=h0,c0[l0]=p0;let f0=d0,g0=0;for(;f0!==l0;)g0+=a0[f0++],f0%=o0;if(l0=(l0+1)%o0,l0===d0&&(d0=(d0+1)%o0),p0-u0<s0)return;const E0=m0&&p0-m0;return E0?Math.round(1e3*g0/E0):void 0}}(50,250);return function(o0,s0){let a0,c0,u0=0,l0=1e3/s0;const d0=function(h0){u0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),a0=null,c0&&(clearTimeout(c0),c0=null),o0.apply(null,h0)};return[function(){const h0=Date.now(),p0=h0-u0;for(var m0=arguments.length,f0=new Array(m0),g0=0;g0<m0;g0++)f0[g0]=arguments[g0];p0>=l0?d0(f0,h0):(a0=f0,c0||(c0=setTimeout(()=>{c0=null,d0(a0)},l0-p0)))},()=>a0&&d0(a0)]}(o0=>{const s0=o0.loaded,a0=o0.lengthComputable?o0.total:void 0,c0=s0-r0,u0=i0(c0);r0=s0,t0({loaded:s0,total:a0,progress:a0?s0/a0:void 0,bytes:c0,rate:u0||void 0,estimated:u0&&a0&&s0<=a0?(a0-s0)/u0:void 0,event:o0,lengthComputable:a0!=null,[e0?"download":"upload"]:!0})},n0)},AI=(t0,e0)=>{const n0=t0!=null;return[r0=>e0[0]({lengthComputable:n0,total:t0,loaded:r0}),e0[1]]},bI=t0=>function(){for(var e0=arguments.length,n0=new Array(e0),r0=0;r0<e0;r0++)n0[r0]=arguments[r0];return Mf.asap(()=>t0(...n0))};var wI=_C.hasStandardBrowserEnv?function(){const t0=_C.navigator&&/(msie|trident)/i.test(_C.navigator.userAgent),e0=document.createElement("a");let n0;function r0(i0){let o0=i0;return t0&&(e0.setAttribute("href",o0),o0=e0.href),e0.setAttribute("href",o0),{href:e0.href,protocol:e0.protocol?e0.protocol.replace(/:$/,""):"",host:e0.host,search:e0.search?e0.search.replace(/^\?/,""):"",hash:e0.hash?e0.hash.replace(/^#/,""):"",hostname:e0.hostname,port:e0.port,pathname:e0.pathname.charAt(0)==="/"?e0.pathname:"/"+e0.pathname}}return n0=r0(window.location.href),function(i0){const o0=Mf.isString(i0)?r0(i0):i0;return o0.protocol===n0.protocol&&o0.host===n0.host}}():function(){return!0},OI=_C.hasStandardBrowserEnv?{write(t0,e0,n0,r0,i0,o0){const s0=[t0+"="+encodeURIComponent(e0)];Mf.isNumber(n0)&&s0.push("expires="+new Date(n0).toGMTString()),Mf.isString(r0)&&s0.push("path="+r0),Mf.isString(i0)&&s0.push("domain="+i0),o0===!0&&s0.push("secure"),document.cookie=s0.join("; ")},read(t0){const e0=document.cookie.match(new RegExp("(^|;\\s*)("+t0+")=([^;]*)"));return e0?decodeURIComponent(e0[3]):null},remove(t0){this.write(t0,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function NI(t0,e0){return t0&&!function(n0){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n0)}(e0)?function(n0,r0){return r0?n0.replace(/\/?\/$/,"")+"/"+r0.replace(/^\/+/,""):n0}(t0,e0):e0}function DI(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}const PI=t0=>t0 instanceof gI?function(e0){for(var n0=1;n0<arguments.length;n0++){var r0=arguments[n0]!=null?arguments[n0]:{};n0%2?DI(Object(r0),!0).forEach(function(i0){Fg(e0,i0,r0[i0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e0,Object.getOwnPropertyDescriptors(r0)):DI(Object(r0)).forEach(function(i0){Object.defineProperty(e0,i0,Object.getOwnPropertyDescriptor(r0,i0))})}return e0}({},t0):t0;function LI(t0,e0){e0=e0||{};const n0={};function r0(u0,l0,d0){return Mf.isPlainObject(u0)&&Mf.isPlainObject(l0)?Mf.merge.call({caseless:d0},u0,l0):Mf.isPlainObject(l0)?Mf.merge({},l0):Mf.isArray(l0)?l0.slice():l0}function i0(u0,l0,d0){return Mf.isUndefined(l0)?Mf.isUndefined(u0)?void 0:r0(void 0,u0,d0):r0(u0,l0,d0)}function o0(u0,l0){if(!Mf.isUndefined(l0))return r0(void 0,l0)}function s0(u0,l0){return Mf.isUndefined(l0)?Mf.isUndefined(u0)?void 0:r0(void 0,u0):r0(void 0,l0)}function a0(u0,l0,d0){return d0 in e0?r0(u0,l0):d0 in t0?r0(void 0,u0):void 0}const c0={url:o0,method:o0,data:o0,baseURL:s0,transformRequest:s0,transformResponse:s0,paramsSerializer:s0,timeout:s0,timeoutMessage:s0,withCredentials:s0,withXSRFToken:s0,adapter:s0,responseType:s0,xsrfCookieName:s0,xsrfHeaderName:s0,onUploadProgress:s0,onDownloadProgress:s0,decompress:s0,maxContentLength:s0,maxBodyLength:s0,beforeRedirect:s0,transport:s0,httpAgent:s0,httpsAgent:s0,cancelToken:s0,socketPath:s0,responseEncoding:s0,validateStatus:a0,headers:(u0,l0)=>i0(PI(u0),PI(l0),!0)};return Mf.forEach(Object.keys(Object.assign({},t0,e0)),function(u0){const l0=c0[u0]||i0,d0=l0(t0[u0],e0[u0],u0);Mf.isUndefined(d0)&&l0!==a0||(n0[u0]=d0)}),n0}var kI=t0=>{const e0=LI({},t0);let n0,{data:r0,withXSRFToken:i0,xsrfHeaderName:o0,xsrfCookieName:s0,headers:a0,auth:c0}=e0;if(e0.headers=a0=gI.from(a0),e0.url=zf(NI(e0.baseURL,e0.url),t0.params,t0.paramsSerializer),c0&&a0.set("Authorization","Basic "+btoa((c0.username||"")+":"+(c0.password?unescape(encodeURIComponent(c0.password)):""))),Mf.isFormData(r0)){if(_C.hasStandardBrowserEnv||_C.hasStandardBrowserWebWorkerEnv)a0.setContentType(void 0);else if((n0=a0.getContentType())!==!1){const[u0,...l0]=n0?n0.split(";").map(d0=>jp(d0).call(d0)).filter(Boolean):[];a0.setContentType([u0||"multipart/form-data",...l0].join("; "))}}if(_C.hasStandardBrowserEnv&&(i0&&Mf.isFunction(i0)&&(i0=i0(e0)),i0||i0!==!1&&wI(e0.url))){const u0=o0&&s0&&OI.read(s0);u0&&a0.set(o0,u0)}return e0},MI=typeof XMLHttpRequest<"u"&&function(t0){return new Gh(function(e0,n0){const r0=kI(t0);let i0=r0.data;const o0=gI.from(r0.headers).normalize();let s0,a0,c0,u0,l0,{responseType:d0,onUploadProgress:h0,onDownloadProgress:p0}=r0;function m0(){u0&&u0(),l0&&l0(),r0.cancelToken&&r0.cancelToken.unsubscribe(s0),r0.signal&&r0.signal.removeEventListener("abort",s0)}let f0=new XMLHttpRequest;function g0(){if(!f0)return;const _0=gI.from("getAllResponseHeaders"in f0&&f0.getAllResponseHeaders());vI(function(y0){e0(y0),m0()},function(y0){n0(y0),m0()},{data:d0&&d0!=="text"&&d0!=="json"?f0.response:f0.responseText,status:f0.status,statusText:f0.statusText,headers:_0,config:t0,request:f0}),f0=null}f0.open(r0.method.toUpperCase(),r0.url,!0),f0.timeout=r0.timeout,"onloadend"in f0?f0.onloadend=g0:f0.onreadystatechange=function(){f0&&f0.readyState===4&&(f0.status!==0||f0.responseURL&&f0.responseURL.indexOf("file:")===0)&&setTimeout(g0)},f0.onabort=function(){f0&&(n0(new Uf("Request aborted",Uf.ECONNABORTED,t0,f0)),f0=null)},f0.onerror=function(){n0(new Uf("Network Error",Uf.ERR_NETWORK,t0,f0)),f0=null},f0.ontimeout=function(){let _0=r0.timeout?"timeout of "+r0.timeout+"ms exceeded":"timeout exceeded";const y0=r0.transitional||Xf;r0.timeoutErrorMessage&&(_0=r0.timeoutErrorMessage),n0(new Uf(_0,y0.clarifyTimeoutError?Uf.ETIMEDOUT:Uf.ECONNABORTED,t0,f0)),f0=null},i0===void 0&&o0.setContentType(null),"setRequestHeader"in f0&&Mf.forEach(o0.toJSON(),function(_0,y0){f0.setRequestHeader(y0,_0)}),Mf.isUndefined(r0.withCredentials)||(f0.withCredentials=!!r0.withCredentials),d0&&d0!=="json"&&(f0.responseType=r0.responseType),p0&&([c0,l0]=yI(p0,!0),f0.addEventListener("progress",c0)),h0&&f0.upload&&([a0,u0]=yI(h0),f0.upload.addEventListener("progress",a0),f0.upload.addEventListener("loadend",u0)),(r0.cancelToken||r0.signal)&&(s0=_0=>{f0&&(n0(!_0||_0.type?new II(null,t0,f0):_0),f0.abort(),f0=null)},r0.cancelToken&&r0.cancelToken.subscribe(s0),r0.signal&&(r0.signal.aborted?s0():r0.signal.addEventListener("abort",s0)));const E0=function(_0){const y0=/^([-+\w]{1,25})(:?\/\/|:)/.exec(_0);return y0&&y0[1]||""}(r0.url);E0&&_C.protocols.indexOf(E0)===-1?n0(new Uf("Unsupported protocol "+E0+":",Uf.ERR_BAD_REQUEST,t0)):f0.send(i0||null)})},UI=(t0,e0)=>{const{length:n0}=t0=t0?t0.filter(Boolean):[];if(e0||n0){let r0,i0=new AbortController;const o0=function(u0){if(!r0){r0=!0,a0();const l0=u0 instanceof Error?u0:this.reason;i0.abort(l0 instanceof Uf?l0:new II(l0 instanceof Error?l0.message:l0))}};let s0=e0&&setTimeout(()=>{s0=null,o0(new Uf("timeout ".concat(e0," of ms exceeded"),Uf.ETIMEDOUT))},e0);const a0=()=>{t0&&(s0&&clearTimeout(s0),s0=null,t0.forEach(u0=>{u0.unsubscribe?u0.unsubscribe(o0):u0.removeEventListener("abort",o0)}),t0=null)};t0.forEach(u0=>u0.addEventListener("abort",o0));const{signal:c0}=i0;return c0.unsubscribe=()=>Mf.asap(a0),c0}},xI=jh,VI=Sl;wi({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t0=VI.f(this);return{promise:t0.promise,resolve:t0.resolve,reject:t0.reject}}});var FI=Sl,BI=el;wi({target:"Promise",stat:!0,forced:!0},{try:function(t0){var e0=FI.f(this),n0=BI(t0);return(n0.error?e0.reject:e0.resolve)(n0.value),e0.promise}});var jI=i(xI),GI=Vm.f("asyncIterator"),WI=i(GI);function HI(t0,e0){this.v=t0,this.k=e0}function KI(t0){var e0,n0;function r0(o0,s0){try{var a0=t0[o0](s0),c0=a0.value,u0=c0 instanceof HI;jI.resolve(u0?c0.v:c0).then(function(l0){if(u0){var d0=o0==="return"?"return":"next";if(!c0.k||l0.done)return r0(d0,l0);l0=t0[d0](l0).value}i0(a0.done?"return":"normal",l0)},function(l0){r0("throw",l0)})}catch(l0){i0("throw",l0)}}function i0(o0,s0){switch(o0){case"return":e0.resolve({value:s0,done:!0});break;case"throw":e0.reject(s0);break;default:e0.resolve({value:s0,done:!1})}(e0=e0.next)?r0(e0.key,e0.arg):n0=null}this._invoke=function(o0,s0){return new jI(function(a0,c0){var u0={key:o0,arg:s0,resolve:a0,reject:c0,next:null};n0?n0=n0.next=u0:(e0=n0=u0,r0(o0,s0))})},typeof t0.return!="function"&&(this.return=void 0)}function YI(t0){return function(){return new KI(t0.apply(this,arguments))}}function qI(t0){return new HI(t0,0)}function zI(t0){var e0={},n0=!1;function r0(i0,o0){return n0=!0,{done:!1,value:new HI(o0=new jI(function(s0){s0(t0[i0](o0))}),1)}}return e0[kg!==void 0&&Mg||"@@iterator"]=function(){return this},e0.next=function(i0){return n0?(n0=!1,i0):r0("next",i0)},typeof t0.throw=="function"&&(e0.throw=function(i0){if(n0)throw n0=!1,i0;return r0("throw",i0)}),typeof t0.return=="function"&&(e0.return=function(i0){return n0?(n0=!1,i0):r0("return",i0)}),e0}KI.prototype[typeof kg=="function"&&WI||"@@asyncIterator"]=function(){return this},KI.prototype.next=function(t0){return this._invoke("next",t0)},KI.prototype.throw=function(t0){return this._invoke("throw",t0)},KI.prototype.return=function(t0){return this._invoke("return",t0)};var JI=i(GI);function XI(t0){var e0,n0,r0,i0=2;for(typeof Symbol<"u"&&(n0=JI,r0=Symbol.iterator);i0--;){if(n0&&(e0=t0[n0])!=null)return e0.call(t0);if(r0&&(e0=t0[r0])!=null)return new QI(e0.call(t0));n0="@@asyncIterator",r0="@@iterator"}throw new TypeError("Object is not async iterable")}function QI(t0){function e0(n0){if(Object(n0)!==n0)return Gh.reject(new TypeError(n0+" is not an object."));var r0=n0.done;return Gh.resolve(n0.value).then(function(i0){return{value:i0,done:r0}})}return QI=function(n0){this.s=n0,this.n=n0.next},QI.prototype={s:null,n:null,next:function(){return e0(this.n.apply(this.s,arguments))},return:function(n0){var r0=this.s.return;return r0===void 0?Gh.resolve({value:n0,done:!0}):e0(r0.apply(this.s,arguments))},throw:function(n0){var r0=this.s.return;return r0===void 0?Gh.reject(n0):e0(r0.apply(this.s,arguments))}},new QI(t0)}const ZI=function*(t0,e0){let n0=t0.byteLength;if(!e0||n0<e0)return void(yield t0);let r0,i0=0;for(;i0<n0;)r0=i0+e0,yield t0.slice(i0,r0),i0=r0},$I=function(){var t0=YI(function*(e0,n0){var r0,i0=!1,o0=!1;try{for(var s0,a0=XI(ev(e0));i0=!(s0=yield qI(a0.next())).done;i0=!1){const c0=s0.value;yield*zI(XI(ZI(c0,n0)))}}catch(c0){o0=!0,r0=c0}finally{try{i0&&a0.return!=null&&(yield qI(a0.return()))}finally{if(o0)throw r0}}});return function(e0,n0){return t0.apply(this,arguments)}}(),ev=function(){var t0=YI(function*(e0){if(e0[JI])return void(yield*zI(XI(e0)));const n0=e0.getReader();try{for(;;){const{done:r0,value:i0}=yield qI(n0.read());if(r0)break;yield i0}}finally{yield qI(n0.cancel())}});return function(e0){return t0.apply(this,arguments)}}(),tv=(t0,e0,n0,r0)=>{const i0=$I(t0,e0);let o0,s0=0,a0=c0=>{o0||(o0=!0,r0&&r0(c0))};return new ReadableStream({async pull(c0){try{const{done:u0,value:l0}=await i0.next();if(u0)return a0(),void c0.close();let d0=l0.byteLength;if(n0){let h0=s0+=d0;n0(h0)}c0.enqueue(new Uint8Array(l0))}catch(u0){throw a0(u0),u0}},cancel:c0=>(a0(c0),i0.return())},{highWaterMark:2})};function iv(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function nv(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?iv(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):iv(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}const rv=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ov=rv&&typeof ReadableStream=="function",sv=rv&&(typeof TextEncoder=="function"?(av=new TextEncoder,t0=>av.encode(t0)):async t0=>new Uint8Array(await new Response(t0).arrayBuffer()));var av;const cv=function(t0){try{for(var e0=arguments.length,n0=new Array(e0>1?e0-1:0),r0=1;r0<e0;r0++)n0[r0-1]=arguments[r0];return!!t0(...n0)}catch{return!1}},dv=ov&&cv(()=>{let t0=!1;const e0=new Request(_C.origin,{body:new ReadableStream,method:"POST",get duplex(){return t0=!0,"half"}}).headers.has("Content-Type");return t0&&!e0}),lv=ov&&cv(()=>Mf.isReadableStream(new Response("").body)),uv={stream:lv&&(t0=>t0.body)};var hv;rv&&(hv=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t0=>{!uv[t0]&&(uv[t0]=Mf.isFunction(hv[t0])?e0=>e0[t0]():(e0,n0)=>{throw new Uf("Response type '".concat(t0,"' is not supported"),Uf.ERR_NOT_SUPPORT,n0)})}));const pv=async(t0,e0)=>{const n0=Mf.toFiniteNumber(t0.getContentLength());return n0??(async r0=>r0==null?0:Mf.isBlob(r0)?r0.size:Mf.isSpecCompliantForm(r0)?(await new Request(_C.origin,{method:"POST",body:r0}).arrayBuffer()).byteLength:Mf.isArrayBufferView(r0)||Mf.isArrayBuffer(r0)?r0.byteLength:(Mf.isURLSearchParams(r0)&&(r0+=""),Mf.isString(r0)?(await sv(r0)).byteLength:void 0))(e0)};var _v=rv&&(async t0=>{let{url:e0,method:n0,data:r0,signal:i0,cancelToken:o0,timeout:s0,onDownloadProgress:a0,onUploadProgress:c0,responseType:u0,headers:l0,withCredentials:d0="same-origin",fetchOptions:h0}=kI(t0);u0=u0?(u0+"").toLowerCase():"text";let p0,m0=UI([i0,o0&&o0.toAbortSignal()],s0);const f0=m0&&m0.unsubscribe&&(()=>{m0.unsubscribe()});let g0;try{if(c0&&dv&&n0!=="get"&&n0!=="head"&&(g0=await pv(l0,r0))!==0){let S0,w0=new Request(e0,{method:"POST",body:r0,duplex:"half"});if(Mf.isFormData(r0)&&(S0=w0.headers.get("content-type"))&&l0.setContentType(S0),w0.body){const[I0,L0]=AI(g0,yI(bI(c0)));r0=tv(w0.body,65536,I0,L0)}}Mf.isString(d0)||(d0=d0?"include":"omit");const E0="credentials"in Request.prototype;p0=new Request(e0,nv(nv({},h0),{},{signal:m0,method:n0.toUpperCase(),headers:l0.normalize().toJSON(),body:r0,duplex:"half",credentials:E0?d0:void 0}));let _0=await fetch(p0);const y0=lv&&(u0==="stream"||u0==="response");if(lv&&(a0||y0&&f0)){const S0={};["status","statusText","headers"].forEach(M0=>{S0[M0]=_0[M0]});const w0=Mf.toFiniteNumber(_0.headers.get("content-length")),[I0,L0]=a0&&AI(w0,yI(bI(a0),!0))||[];_0=new Response(tv(_0.body,65536,I0,()=>{L0&&L0(),f0&&f0()}),S0)}u0=u0||"text";let b0=await uv[Mf.findKey(uv,u0)||"text"](_0,t0);return!y0&&f0&&f0(),await new Gh((S0,w0)=>{vI(S0,w0,{data:b0,headers:gI.from(_0.headers),status:_0.status,statusText:_0.statusText,config:t0,request:p0})})}catch(E0){throw f0&&f0(),E0&&E0.name==="TypeError"&&/fetch/i.test(E0.message)?Object.assign(new Uf("Network Error",Uf.ERR_NETWORK,t0,p0),{cause:E0.cause||E0}):Uf.from(E0,E0&&E0.code,t0,p0)}});const Ev={http:null,xhr:MI,fetch:_v};Mf.forEach(Ev,(t0,e0)=>{if(t0){try{Object.defineProperty(t0,"name",{value:e0})}catch{}Object.defineProperty(t0,"adapterName",{value:e0})}});const fv=t0=>"- ".concat(t0),mv=t0=>Mf.isFunction(t0)||t0===null||t0===!1;var Tv={getAdapter:t0=>{t0=Mf.isArray(t0)?t0:[t0];const{length:e0}=t0;let n0,r0;const i0={};for(let o0=0;o0<e0;o0++){let s0;if(n0=t0[o0],r0=n0,!mv(n0)&&(r0=Ev[(s0=String(n0)).toLowerCase()],r0===void 0))throw new Uf("Unknown adapter '".concat(s0,"'"));if(r0)break;i0[s0||"#"+o0]=r0}if(!r0){const o0=Object.entries(i0).map(s0=>{let[a0,c0]=s0;return"adapter ".concat(a0," ")+(c0===!1?"is not supported by the environment":"is not available in the build")});throw new Uf("There is no suitable adapter to dispatch the request "+(e0?o0.length>1?`since :
`+o0.map(fv).join(`
`):" "+fv(o0[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r0},adapters:Ev};function Sv(t0){if(t0.cancelToken&&t0.cancelToken.throwIfRequested(),t0.signal&&t0.signal.aborted)throw new II(null,t0)}function gv(t0){return Sv(t0),t0.headers=gI.from(t0.headers),t0.data=RI.call(t0,t0.transformRequest),["post","put","patch"].indexOf(t0.method)!==-1&&t0.headers.setContentType("application/x-www-form-urlencoded",!1),Tv.getAdapter(t0.adapter||pI.adapter)(t0).then(function(e0){return Sv(t0),e0.data=RI.call(t0,t0.transformResponse,e0),e0.headers=gI.from(e0.headers),e0},function(e0){return CI(e0)||(Sv(t0),e0&&e0.response&&(e0.response.data=RI.call(t0,t0.transformResponse,e0.response),e0.response.headers=gI.from(e0.response.headers))),Gh.reject(e0)})}const Rv="1.7.7",Cv={};["object","boolean","number","function","string","symbol"].forEach((t0,e0)=>{Cv[t0]=function(n0){return typeof n0===t0||"a"+(e0<1?"n ":" ")+t0}});const Iv={};Cv.transitional=function(t0,e0,n0){function r0(i0,o0){return"[Axios v"+Rv+"] Transitional option '"+i0+"'"+o0+(n0?". "+n0:"")}return(i0,o0,s0)=>{if(t0===!1)throw new Uf(r0(o0," has been removed"+(e0?" in "+e0:"")),Uf.ERR_DEPRECATED);return e0&&!Iv[o0]&&(Iv[o0]=!0,console.warn(r0(o0," has been deprecated since v"+e0+" and will be removed in the near future"))),!t0||t0(i0,o0,s0)}};var vv={assertOptions:function(t0,e0,n0){if(typeof t0!="object")throw new Uf("options must be an object",Uf.ERR_BAD_OPTION_VALUE);const r0=Object.keys(t0);let i0=r0.length;for(;i0-- >0;){const o0=r0[i0],s0=e0[o0];if(s0){const a0=t0[o0],c0=a0===void 0||s0(a0,o0,t0);if(c0!==!0)throw new Uf("option "+o0+" must be "+c0,Uf.ERR_BAD_OPTION_VALUE)}else if(n0!==!0)throw new Uf("Unknown option "+o0,Uf.ERR_BAD_OPTION)}},validators:Cv};const yv=vv.validators;let Av=class{constructor(t0){this.defaults=t0,this.interceptors={request:new Jf,response:new Jf}}async request(t0,e0){try{return await this._request(t0,e0)}catch(n0){if(n0 instanceof Error){let r0;Error.captureStackTrace?Error.captureStackTrace(r0={}):r0=new Error;const i0=r0.stack?r0.stack.replace(/^.+\n/,""):"";try{n0.stack?i0&&!String(n0.stack).endsWith(i0.replace(/^.+\n.+\n/,""))&&(n0.stack+=`
`+i0):n0.stack=i0}catch{}}throw n0}}_request(t0,e0){typeof t0=="string"?(e0=e0||{}).url=t0:e0=t0||{},e0=LI(this.defaults,e0);const{transitional:n0,paramsSerializer:r0,headers:i0}=e0;n0!==void 0&&vv.assertOptions(n0,{silentJSONParsing:yv.transitional(yv.boolean),forcedJSONParsing:yv.transitional(yv.boolean),clarifyTimeoutError:yv.transitional(yv.boolean)},!1),r0!=null&&(Mf.isFunction(r0)?e0.paramsSerializer={serialize:r0}:vv.assertOptions(r0,{encode:yv.function,serialize:yv.function},!0)),e0.method=(e0.method||this.defaults.method||"get").toLowerCase();let o0=i0&&Mf.merge(i0.common,i0[e0.method]);i0&&Mf.forEach(["delete","get","head","post","put","patch","common"],p0=>{delete i0[p0]}),e0.headers=gI.concat(o0,i0);const s0=[];let a0=!0;this.interceptors.request.forEach(function(p0){typeof p0.runWhen=="function"&&p0.runWhen(e0)===!1||(a0=a0&&p0.synchronous,s0.unshift(p0.fulfilled,p0.rejected))});const c0=[];let u0;this.interceptors.response.forEach(function(p0){c0.push(p0.fulfilled,p0.rejected)});let l0,d0=0;if(!a0){const p0=[gv.bind(this),void 0];for(p0.unshift.apply(p0,s0),p0.push.apply(p0,c0),l0=p0.length,u0=Gh.resolve(e0);d0<l0;)u0=u0.then(p0[d0++],p0[d0++]);return u0}l0=s0.length;let h0=e0;for(d0=0;d0<l0;){const p0=s0[d0++],m0=s0[d0++];try{h0=p0(h0)}catch(f0){m0.call(this,f0);break}}try{u0=gv.call(this,h0)}catch(p0){return Gh.reject(p0)}for(d0=0,l0=c0.length;d0<l0;)u0=u0.then(c0[d0++],c0[d0++]);return u0}getUri(t0){return zf(NI((t0=LI(this.defaults,t0)).baseURL,t0.url),t0.params,t0.paramsSerializer)}};Mf.forEach(["delete","get","head","options"],function(t0){Av.prototype[t0]=function(e0,n0){return this.request(LI(n0||{},{method:t0,url:e0,data:(n0||{}).data}))}}),Mf.forEach(["post","put","patch"],function(t0){function e0(n0){return function(r0,i0,o0){return this.request(LI(o0||{},{method:t0,headers:n0?{"Content-Type":"multipart/form-data"}:{},url:r0,data:i0}))}}Av.prototype[t0]=e0(),Av.prototype[t0+"Form"]=e0(!0)});var bv=Av;class wv{constructor(e0){if(typeof e0!="function")throw new TypeError("executor must be a function.");let n0;this.promise=new Gh(function(i0){n0=i0});const r0=this;this.promise.then(i0=>{if(!r0._listeners)return;let o0=r0._listeners.length;for(;o0-- >0;)r0._listeners[o0](i0);r0._listeners=null}),this.promise.then=i0=>{let o0;const s0=new Gh(a0=>{r0.subscribe(a0),o0=a0}).then(i0);return s0.cancel=function(){r0.unsubscribe(o0)},s0},e0(function(i0,o0,s0){r0.reason||(r0.reason=new II(i0,o0,s0),n0(r0.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e0){this.reason?e0(this.reason):this._listeners?this._listeners.push(e0):this._listeners=[e0]}unsubscribe(e0){if(!this._listeners)return;const n0=this._listeners.indexOf(e0);n0!==-1&&this._listeners.splice(n0,1)}toAbortSignal(){const e0=new AbortController,n0=r0=>{e0.abort(r0)};return this.subscribe(n0),e0.signal.unsubscribe=()=>this.unsubscribe(n0),e0.signal}static source(){let e0;return{token:new wv(function(n0){e0=n0}),cancel:e0}}}var Ov=wv;const Nv={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Nv).forEach(t0=>{let[e0,n0]=t0;Nv[n0]=e0});var Dv=Nv;const Pv=function t0(e0){const n0=new bv(e0),r0=HE(bv.prototype.request,n0);return Mf.extend(r0,bv.prototype,n0,{allOwnKeys:!0}),Mf.extend(r0,n0,null,{allOwnKeys:!0}),r0.create=function(i0){return t0(LI(e0,i0))},r0}(pI);Pv.Axios=bv,Pv.CanceledError=II,Pv.CancelToken=Ov,Pv.isCancel=CI,Pv.VERSION=Rv,Pv.toFormData=Wf,Pv.AxiosError=Uf,Pv.Cancel=Pv.CanceledError,Pv.all=function(t0){return Gh.all(t0)},Pv.spread=function(t0){return function(e0){return t0.apply(null,e0)}},Pv.isAxiosError=function(t0){return Mf.isObject(t0)&&t0.isAxiosError===!0},Pv.mergeConfig=LI,Pv.AxiosHeaders=gI,Pv.formToJSON=t0=>uI(Mf.isHTMLForm(t0)?new FormData(t0):t0),Pv.getAdapter=Tv.getAdapter,Pv.HttpStatusCode=Dv,Pv.default=Pv;var Lv=Pv;const kv=()=>{};function Mv(){const t0={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:kv};return t0.promise=new Gh((e0,n0)=>{t0.resolve=r0=>{t0.isFinished||(t0.isResolved=!0,t0.isFinished=!0,e0(r0),t0.value=r0)},t0.reject=r0=>{t0.isFinished||(t0.isRejected=!0,t0.isFinished=!0,n0(r0))}}),t0}const Uv=new Map,xv=new Map,Vv=new Map;let Fv=function(t0){return t0.WIN_10="Windows 10",t0.WIN_81="Windows 8.1",t0.WIN_8="Windows 8",t0.WIN_7="Windows 7",t0.WIN_VISTA="Windows Vista",t0.WIN_SERVER_2003="Windows Server 2003",t0.WIN_XP="Windows XP",t0.WIN_2000="Windows 2000",t0.ANDROID="Android",t0.HARMONY_OS="HarmonyOS",t0.OPEN_BSD="Open BSD",t0.SUN_OS="Sun OS",t0.LINUX="Linux",t0.IOS="iOS",t0.MAC_OS="Mac OS",t0.CHROMIUM_OS="Chromium OS",t0.QNX="QNX",t0.UNIX="UNIX",t0.BEOS="BeOS",t0.OS_2="OS/2",t0.SEARCH_BOT="Search Bot",t0}({}),Bv=function(t0){return t0.CHROME="Chrome",t0.SAFARI="Safari",t0.EDGE="Edge",t0.FIREFOX="Firefox",t0.OPERA="OPR",t0.QQ="QQBrowser",t0.WECHAT="MicroMessenger",t0}({});const jv=new dE;let Gv=jv.getResult(),Wv=null;function Hv(t0){if(!Wv){t0&&jv.setUA(t0),Gv=jv.getResult();const e0=function(a0){if(a0.engine.name==="Blink"&&a0.browser.name!=="WeChat")return Bv.CHROME;switch(a0.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Bv.CHROME;case"Safari":case"Mobile Safari":return Bv.SAFARI;case"Edge":return Bv.EDGE;case"Firefox":return Bv.FIREFOX;case"QQ":case"QQBrowser":return Bv.QQ;case"Opera":return Bv.OPERA;case"WeChat":return Bv.WECHAT;default:return a0.browser.name||""}}(Gv),n0=Kv(Gv),r0=function(a0){return a0.os.name==="Windows"?a0.os.version?a0.os.name+" "+a0.os.version:a0.os.name:a0.os.name||""}(Gv),i0=Gv.os.version,o0=Kv(Gv,!1),s0=Gv.device.type;if(!(e0&&n0&&r0&&i0))return{name:e0,version:n0,os:r0,osVersion:i0,browserVersion:o0,deviceType:s0};Wv={name:e0,version:n0,os:r0,osVersion:i0,browserVersion:o0,deviceType:s0}}return Wv}function Kv(t0){let e0,n0=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e0=t0.engine.name==="Blink"?t0.engine.version||"":t0.browser.version||"",n0?e0.split(".")[0]:e0}function Yv(){return Hv().os}function qv(){const t0=Hv();return"".concat(t0.os," ").concat(t0.osVersion)}function zv(){const t0=Hv();return!!(Gv.engine.name==="WebKit"&&t0.os===Fv.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t0.name!==Bv.SAFARI||$v()&&t0.name!==Bv.SAFARI)}function Jv(){return Hv().name===Bv.CHROME}function Xv(){return Hv().name===Bv.SAFARI}function Qv(){return Hv().name===Bv.EDGE}function Zv(){return Hv().name===Bv.FIREFOX}function $v(){return Hv().os===Fv.IOS}function ey(t0){const e0=Hv();return!(e0.name!==Bv.CHROME||!e0.osVersion)&&Number(e0.version)>=t0}function ty(t0){const e0=Hv();return!(e0.name!==Bv.CHROME||!e0.osVersion)&&Number(e0.version)<t0}function iy(t0){const e0=Hv();return!(e0.name!==Bv.EDGE||!e0.osVersion)&&Number(e0.version)>=t0}function ny(t0){const e0=Hv();return!(e0.name!==Bv.SAFARI||!e0.osVersion)&&Number(e0.version)>=t0}function ry(t0,e0,n0){const r0=Hv();if(r0.os!==Fv.IOS||!r0.osVersion)return!1;const i0=r0.osVersion.split(".");return n0?e0&&Number(i0[0])===t0&&Number(i0[1])<e0||Number(i0[0])<t0:e0?Number(i0[0])===t0&&Number(i0[1])<=e0||Number(i0[0])<t0:Number(i0[0])<=t0}function oy(t0,e0,n0){const r0=Hv();if(r0.name!==Bv.SAFARI||!r0.osVersion||!r0.browserVersion)return!1;const i0=r0.browserVersion.split(".");return n0?e0&&Number(i0[0])===t0&&Number(i0[1])<e0||Number(i0[0])<t0:e0?Number(i0[0])===t0&&Number(i0[1])<=e0||Number(i0[0])<t0:Number(i0[0])<=t0}function sy(t0){const e0=Hv();return!(e0.name!==Bv.OPERA||!e0.osVersion)&&Number(e0.version)>=t0}function ay(){const t0=Hv();if(t0.os!==Fv.IOS||!t0.osVersion)return!1;const e0=t0.osVersion.split(".");return Number(e0[0])<14||Number(e0[0])===14&&Number(e0[1])<=6}function cy(){const t0=Hv();if(t0.os!==Fv.IOS||!t0.osVersion)return!1;const e0=t0.osVersion.split(".");return Number(e0[0])===15}function dy(){const t0=Hv();if(t0.os!==Fv.IOS||!t0.osVersion)return!1;const e0=t0.osVersion.split(".");return Number(e0[0])===16}function ly(){const t0=Hv();if(t0.os!==Fv.IOS||!t0.osVersion)return!1;const e0=t0.osVersion.split(".");return Number(e0[0])===15&&Number(e0[1])>=1}function uy(){return Xv()&&navigator.maxTouchPoints>0}function hy(){return Hv().name===Bv.WECHAT}function py(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function _y(){const t0=Yv();return function(){const{deviceType:e0}=Hv();return e0==="mobile"||e0==="tablet"}()||t0===Fv.ANDROID||t0===Fv.IOS||t0===Fv.HARMONY_OS}function Ey(){const t0=Hv();return t0.name!==Bv.EDGE&&t0.name!==Bv.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function fy(){return Yv()===Fv.ANDROID}function my(){const t0=Hv();return fy()&&(t0.name===Bv.CHROME||t0.name===Bv.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Ty(t0,e0,n0){return(e0=function(r0){var i0=function(o0,s0){if(typeof o0!="object"||!o0)return o0;var a0=o0[Symbol.toPrimitive];if(a0!==void 0){var c0=a0.call(o0,"string");if(typeof c0!="object")return c0;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o0)}(r0);return typeof i0=="symbol"?i0:i0+""}(e0))in t0?Object.defineProperty(t0,e0,{value:n0,enumerable:!0,configurable:!0,writable:!0}):t0[e0]=n0,t0}function Sy(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function gy(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?Sy(Object(n0),!0).forEach(function(r0){Ty(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):Sy(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}let Ry=function(t0){return t0.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t0.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t0.TIMEOUT="TIMEOUT",t0.INVALID_PARAMS="INVALID_PARAMS",t0.NOT_READABLE="NOT_READABLE",t0.NOT_SUPPORTED="NOT_SUPPORTED",t0.INVALID_OPERATION="INVALID_OPERATION",t0.OPERATION_ABORTED="OPERATION_ABORTED",t0.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t0.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t0.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t0.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t0.NETWORK_ERROR="NETWORK_ERROR",t0.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t0.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t0.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t0.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t0.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t0.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t0.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t0.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t0.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t0.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t0.PERMISSION_DENIED="PERMISSION_DENIED",t0.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t0.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t0.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t0.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t0.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t0.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t0.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t0.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t0.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t0.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t0.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t0.UID_CONFLICT="UID_CONFLICT",t0.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t0.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t0.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t0.INVALID_TRACK="INVALID_TRACK",t0.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t0.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t0.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t0.ICE_FAILED="ICE_FAILED",t0.PC_CLOSED="PC_CLOSED",t0.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t0.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t0.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t0.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t0.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t0.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t0.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t0.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t0.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t0.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t0.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t0.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t0.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t0.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t0.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t0.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t0.WS_ABORT="WS_ABORT",t0.WS_DISCONNECT="WS_DISCONNECT",t0.WS_ERR="WS_ERR",t0.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t0.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t0.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t0.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t0.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t0.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t0.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t0.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t0.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t0.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t0.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t0.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t0.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t0.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t0.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t0.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t0.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t0.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t0.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t0.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t0.INVALID_PLUGIN="INVALID_PLUGIN",t0.DISCONNECT_P2P="DISCONNECT_P2P",t0.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t0.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t0.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t0.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t0.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t0.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t0.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t0.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t0}({}),Cy=class extends Error{constructor(t0){let e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n0=arguments.length>2?arguments[2]:void 0;super(e0),Ty(this,"code",void 0),Ty(this,"message",void 0),Ty(this,"data",void 0),Ty(this,"name","AgoraRTCException"),this.code=t0,this.message="AgoraRTCError ".concat(this.code,": ").concat(e0),this.data=n0}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e0=arguments.length>1?arguments[1]:void 0;return t0==="error"&&(e0||console).error(this.toString()),t0==="warning"&&(e0||console).warn(this.toString()),this}throw(t0){throw this.print("error",t0),this}};function Iy(t0,e0){if(typeof t0!="boolean")throw new Cy(Ry.INVALID_PARAMS,"Invalid ".concat(e0,": The value is of the boolean type."))}function vy(t0,e0,n0){if(!Dn(n0).call(n0,t0))throw new Cy(Ry.INVALID_PARAMS,"".concat(e0," can only be set as ").concat(JSON.stringify(n0)))}function yy(t0,e0){let n0=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r0=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t0<n0||t0>r0||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i0){return typeof i0=="number"&&i0%1==0}(t0))throw new Cy(Ry.INVALID_PARAMS,"invalid ".concat(e0,": the value range is [").concat(n0,", ").concat(r0,"]. integer only"))}function Ay(t0,e0){if(typeof t0!="number"){if(!(t0.min||t0.max||t0.ideal||t0.exact))throw new Cy(Ry.INVALID_PARAMS,"".concat(e0," is not a valid ConstrainLong"));t0.min!==void 0&&yy(t0.min,"".concat(e0,".min"),0,1/0),t0.max!==void 0&&yy(t0.max,"".concat(e0,".max"),1,1/0),t0.exact!==void 0&&yy(t0.exact,"".concat(e0,".exact"),1,1/0),t0.ideal!==void 0&&yy(t0.ideal,"".concat(e0,".ideal"),1,1/0)}else yy(t0,e0,1,1/0)}function by(t0,e0){let n0=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r0=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i0=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t0==null)throw new Cy(Ry.INVALID_PARAMS,"".concat(e0||"param"," cannot be empty"));if(!Ny(t0,n0,r0,i0))throw new Cy(Ry.INVALID_PARAMS,"Invalid ".concat(e0||"string param",": Length of the string: [").concat(n0,",").concat(r0,"].").concat(i0?" ASCII characters only.":""))}function wy(t0,e0){if(!Array.isArray(t0))throw new Cy(Ry.INVALID_PARAMS,"".concat(e0," should be an array"))}function Oy(t0){return t0==null}function Ny(t0){let e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n0=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r0=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t0=="string"&&t0.length<=n0&&t0.length>=e0&&(!r0||function(i0){if(typeof i0!="string")return!1;for(let o0=0;o0<i0.length;o0+=1){const s0=i0.charCodeAt(o0);if(s0<0||s0>255)return!1}return!0}(t0))}var Dy=function(t0){return t0.COVERED="COVERED",t0.POSITION="POSITION",t0.SIZE="SIZE",t0.STYLE="STYLE",t0}(Dy||{}),Py=function(t0){return t0.UNMOUNTED="UNMOUNTED",t0.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t0}(Py||{});const Ly=new class{constructor(){Ty(this,"_clientSize",null),Ty(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ty(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ty(this,"getStyle",t0=>window.getComputedStyle(t0,null)),Ty(this,"checkCssVisibleProperty",t0=>{var e0;let n0=!0;const r0=this.getStyle(t0),{display:i0,visibility:o0,opacity:s0,filter:a0}=r0;return(i0==="none"||Dn(e0=["hidden","collapse"]).call(e0,o0)||Number(s0)<.1)&&(n0=!1),!!n0&&(a0&&a0.split(" ").filter(c0=>{var u0;const l0=c0.split("(")[0];return Dn(u0=["brightness","blur","opacity"]).call(u0,l0)}).map(c0=>{const[u0,l0]=c0.split(/\(|\)/);return[u0,Number(l0.match(/^[0-9\.]+/))]}).forEach(c0=>{const[u0,l0]=c0;switch(u0){case"brightness":(l0<.1||l0>3)&&(n0=!1);break;case"blur":l0>3&&(n0=!1);break;case"opacity":l0<.1&&(n0=!1)}}),n0)}),Ty(this,"checkPropertyUpToAllParentNodes",(t0,e0)=>{let n0=!0,r0=!0;const i0=s0=>e0(s0);let o0=t0;for(;o0&&r0;)i0(o0)||(n0=!1,r0=!1),o0=o0.parentElement,o0||(r0=!1);return n0}),Ty(this,"checkActualCssVisibleIncludeInherit",t0=>this.checkPropertyUpToAllParentNodes(t0,this.checkCssVisibleProperty)),Ty(this,"getSizeAboutClient",t0=>{const{width:e0,height:n0,left:r0,right:i0,top:o0,bottom:s0}=t0.getBoundingClientRect(),a0=this.getClientWidth(),c0=this.getClientHeight();return{width:e0,height:n0,left:r0,right:i0,top:o0,bottom:s0,clientWidth:a0,clientHeight:c0,clientMin:Math.min(a0,c0)}}),Ty(this,"checkActualSize",()=>{const{width:t0,height:e0,clientMin:n0}=this._clientSize;return this.checkSizeIsVisible(t0,e0,n0)}),Ty(this,"elementFromPoint",(t0,e0)=>document.elementFromPoint?document.elementFromPoint(t0,e0):null),Ty(this,"checkCoverForAPoint",(t0,e0,n0)=>{const r0=this.elementFromPoint(t0,e0);return r0!==null&&r0!==n0}),Ty(this,"getPointPositionList",()=>{const{width:t0,height:e0,left:n0,top:r0}=this._clientSize,i0=t0/6,o0=e0/6,s0=[],a0=10**6;for(let c0=0;c0<5;c0++)for(let u0=0;u0<5;u0++){const l0=(n0*a0+(c0===0?.1:c0===4?(i0*c0*a0-1e5)/a0:i0*c0)*a0)/a0,d0=(r0*a0+(u0===0?.1:u0===4?(o0*u0*a0-1e5)/a0:o0*u0)*a0)/a0;s0.push({x:l0,y:d0})}return[...s0]}),Ty(this,"checkElementCover",t0=>this.getPointPositionList().map(e0=>this.checkCoverForAPoint(e0.x,e0.y,t0)).filter(e0=>!!e0).length>6),Ty(this,"checkSizeIsVisible",(t0,e0,n0)=>(t0>50||n0/t0<=10)&&(e0>50||n0/e0<=10)),Ty(this,"checkSizeOfPartInClient",()=>{const{left:t0,right:e0,top:n0,bottom:r0,clientHeight:i0,clientWidth:o0,clientMin:s0}=this._clientSize;let a0,c0,u0,l0;if(t0<0)a0=0;else{if(!(t0<o0))return!1;a0=t0}if(e0<0)return!1;if(c0=e0<o0?e0:o0,n0<0)u0=0;else{if(!(n0<i0))return!1;u0=n0}if(r0<0)return!1;l0=r0<i0?r0:i0;const d0=c0-a0,h0=l0-u0;return this.checkSizeIsVisible(d0,h0,s0)}),Ty(this,"returnHiddenResult",t0=>(this._clientSize=null,{visible:!1,reason:t0})),Ty(this,"checkOneElementVisible",t0=>{if(t0 instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t0)){if(this.checkActualCssVisibleIncludeInherit(t0)){if(this._clientSize=this.getSizeAboutClient(t0),this.checkElementCover(t0))return this.returnHiddenResult(Dy.COVERED);{const e0=this.checkActualSize(),n0=this.checkSizeOfPartInClient();return e0&&!n0?this.returnHiddenResult(Dy.POSITION):e0?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Dy.SIZE)}}return this.returnHiddenResult(Dy.STYLE)}return this.returnHiddenResult(Py.UNMOUNTED)}return this.returnHiddenResult(Py.INVALID_HTML_ELEMENT)}),Ty(this,"checkElementIsMountedOnDom",t0=>this.checkPropertyUpToAllParentNodes(t0,e0=>e0.nodeName.toUpperCase()!=="HTML"?e0.parentElement!==null:!!document.documentElement))}};function ky(t0){return new TextEncoder().encode(t0)}const My=function(t0,e0){const n0=new Uint8Array(t0.byteLength+e0.byteLength);return n0.set(new Uint8Array(t0),0),n0.set(new Uint8Array(e0),t0.byteLength),n0},Uy=async t0=>function(e0,n0){let r0="";return new Uint8Array(e0).forEach(i0=>{r0+=i0.toString(n0).padStart(2,"0")}),r0}(await crypto.subtle.digest("SHA-256",ky(t0)),16);class xy{constructor(){Ty(this,"_events",{}),Ty(this,"addListener",this.on)}getListeners(e0){return this._events[e0]?this._events[e0].map(n0=>n0.listener):[]}on(e0,n0){this._events[e0]||(this._events[e0]=[]);const r0=this._events[e0];this._indexOfListener(r0,n0)===-1&&r0.push({listener:n0,once:!1})}once(e0,n0){this._events[e0]||(this._events[e0]=[]);const r0=this._events[e0];this._indexOfListener(r0,n0)===-1&&r0.push({listener:n0,once:!0})}off(e0,n0){if(!this._events[e0])return;const r0=this._events[e0],i0=this._indexOfListener(r0,n0);i0!==-1&&r0.splice(i0,1),this._events[e0].length===0&&delete this._events[e0]}removeAllListeners(e0){e0?delete this._events[e0]:this._events={}}emit(e0){this._events[e0]||(this._events[e0]=[]);const n0=this._events[e0].map(s0=>s0);for(var r0=arguments.length,i0=new Array(r0>1?r0-1:0),o0=1;o0<r0;o0++)i0[o0-1]=arguments[o0];for(let s0=0;s0<n0.length;s0+=1){const a0=n0[s0];a0.once&&this.off(e0,a0.listener),a0.listener.apply(this,i0||[])}}safeEmit(e0){for(var n0=arguments.length,r0=new Array(n0>1?n0-1:0),i0=1;i0<n0;i0++)r0[i0-1]=arguments[i0];[...this._events[e0]||[]].forEach(o0=>{o0.once&&this.off(e0,o0.listener);try{o0.listener.apply(this,r0)}catch(s0){console.error("safeEmit event:".concat(e0," error ").concat(s0==null?void 0:s0.toString()))}})}_indexOfListener(e0,n0){let r0=e0.length;for(;r0--;)if(e0[r0].listener===n0)return r0;return-1}}let Vy=null;function Fy(){if(Vy)return Vy;if(window.electron)return Vy=window.electron;if(!window.require)return null;try{return Vy=window.require("electron"),Vy}catch{return null}}let By=function(t0){return t0.CREATE_CLIENT="createClient",t0.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t0.SET_AREA="setArea",t0.PRELOAD="PRELOAD",t0.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t0.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t0.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t0.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t0.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t0.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t0.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t0.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t0.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t0.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t0.START_PROXY_SERVER="Client.startProxyServer",t0.STOP_PROXY_SERVER="Client.stopProxyServer",t0.SET_PROXY_SERVER="Client.setProxyServer",t0.SET_TURN_SERVER="Client.setTurnServer",t0.SET_CLIENT_ROLE="Client.setClientRole",t0.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t0.ENABLE_DUAL_STREAM="Client.enableDualStream",t0.DISABLE_DUAL_STREAM="Client.disableDualStream",t0.JOIN="Client.join",t0.LEAVE="Client.leave",t0.PUBLISH="Client.publish",t0.UNPUBLISH="Client.unpublish",t0.SUBSCRIBE="Client.subscribe",t0.MASS_SUBSCRIBE="Client.massSubscribe",t0.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t0.UNSUBSCRIBE="Client.unsubscribe",t0.RENEW_TOKEN="Client.renewToken",t0.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t0.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t0.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t0.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t0.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t0.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t0.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t0.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t0.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t0.START_LIVE_STREAMING="Client.startLiveStreaming",t0.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t0.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t0.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t0.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t0.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t0.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t0.SET_CONFIG_DISTRIBUTE="_configDistribute",t0.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t0.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t0.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t0.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t0.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t0.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t0.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t0.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t0.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t0.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t0.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t0.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t0.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t0.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t0.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t0.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t0.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t0.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t0.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t0.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t0.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t0.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t0.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t0.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t0.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t0.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t0.STREAM_TYPE_CHANGE="streamTypeChange",t0.CONNECTION_STATE_CHANGE="connectionStateChange",t0.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t0.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t0}({}),jy=function(t0){return t0.TRACER="tracer",t0}({});function Gy(t0){return yy(t0.timeout,"config.timeout",0,1e5),yy(t0.timeoutFactor,"config.timeoutFactor",0,100,!1),yy(t0.maxRetryCount,"config.maxRetryConfig",0,1/0),yy(t0.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Wy=function(t0){return t0[t0.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t0[t0.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t0[t0.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t0}({}),Hy=function(t0){return t0.LEAVE="LEAVE",t0.NETWORK_ERROR="NETWORK_ERROR",t0.SERVER_ERROR="SERVER_ERROR",t0.UID_BANNED="UID_BANNED",t0.FALLBACK="FALLBACK",t0.IP_BANNED="IP_BANNED",t0.CHANNEL_BANNED="CHANNEL_BANNED",t0.LICENSE_MISSING="LICENSE_MISSING",t0.LICENSE_EXPIRED="LICENSE_EXPIRED",t0.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t0.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t0.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t0.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t0.TOKEN_EXPIRE="TOKEN_EXPIRE",t0}({});function Ky(t0){if(!Array.isArray(t0)||t0.length<1)return!1;try{t0.forEach(e0=>{if(!e0.urls)throw Error()})}catch{return!1}return!0}function Yy(t0){return by(t0.turnServerURL,"turnServerURL"),by(t0.username,"username"),by(t0.password,"password"),t0.udpport&&yy(t0.udpport,"udpport",1,99999,!0),t0.forceturn&&Iy(t0.forceturn,"forceturn"),t0.security&&Iy(t0.security,"security"),t0.tcpport&&yy(t0.tcpport,"tcpport",1,99999,!0),!0}function qy(t0){return t0.level!==void 0&&vy(t0.level,"level",[1,2,3]),t0.delay!==void 0&&yy(t0.delay,"delay",0,3e3,!0),!0}let zy=function(t0){return t0.CONNECTION_STATE_CHANGE="connection-state-change",t0.MEDIA_RECONNECT_START="media-reconnect-start",t0.MEDIA_RECONNECT_END="media-reconnect-end",t0.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t0.USER_JOINED="user-joined",t0.USER_LEAVED="user-left",t0.USER_PUBLISHED="user-published",t0.USER_UNPUBLISHED="user-unpublished",t0.USER_INFO_UPDATED="user-info-updated",t0.CLIENT_BANNED="client-banned",t0.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t0.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t0.VOLUME_INDICATOR="volume-indicator",t0.CRYPT_ERROR="crypt-error",t0.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t0.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t0.NETWORK_QUALITY="network-quality",t0.STREAM_TYPE_CHANGED="stream-type-changed",t0.STREAM_FALLBACK="stream-fallback",t0.RECEIVE_METADATA="receive-metadata",t0.STREAM_MESSAGE="stream-message",t0.LIVE_STREAMING_ERROR="live-streaming-error",t0.LIVE_STREAMING_WARNING="live-streaming-warning",t0.EXCEPTION="exception",t0.ERROR="error",t0.P2P_LOST="p2p_lost",t0.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t0.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t0.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t0.PUBLISHED_USER_LIST="published-user-list",t0.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t0.CONTENT_INSPECT_ERROR="content-inspect-error",t0.CONTENT_INSPECT_RESULT="content-inspect-result",t0.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t0}({}),Jy=function(t0){return t0.NETWORK_ERROR="NETWORK_ERROR",t0.SERVER_ERROR="SERVER_ERROR",t0.MULTI_IP="MULTI_IP",t0.TIMEOUT="TIMEOUT",t0.OFFLINE="OFFLINE",t0.LEAVE="LEAVE",t0.P2P_FAILED="P2P_FAILED",t0.FALLBACK="FALLBACK",t0}({}),Xy=function(t0){return t0.ONLINE="ONLINE",t0.OFFLINE="OFFLINE",t0}({}),Qy=function(t0){return t0.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t0.ONLINE="ONLINE",t0.OFFLINE="OFFLINE",t0}({});function Zy(t0,e0){for(var n0=arguments.length,r0=new Array(n0>2?n0-2:0),i0=2;i0<n0;i0++)r0[i0-2]=arguments[i0];return t0.getListeners(e0).length===0?Gh.reject(new Cy(Ry.UNEXPECTED_ERROR,"can not emit promise")):new Gh((o0,s0)=>{t0.emit(e0,...r0,o0,s0)})}function $y(t0,e0){if(t0.getListeners(e0).length===0)return Gh.resolve();for(var n0=arguments.length,r0=new Array(n0>2?n0-2:0),i0=2;i0<n0;i0++)r0[i0-2]=arguments[i0];return Zy(t0,e0,...r0)}function eA(t0,e0){if(t0.getListeners(e0).length===0)return null;for(var n0=arguments.length,r0=new Array(n0>2?n0-2:0),i0=2;i0<n0;i0++)r0[i0-2]=arguments[i0];return tA(t0,e0,...r0)}function tA(t0,e0){let n0=null,r0=null;for(var i0=arguments.length,o0=new Array(i0>2?i0-2:0),s0=2;s0<i0;s0++)o0[s0-2]=arguments[s0];if(t0.emit(e0,...o0,a0=>{n0=a0},a0=>{r0=a0}),r0!==null)throw r0;if(n0===null)throw new Cy(Ry.UNEXPECTED_ERROR,"handler is not sync");return n0}const iA=new class extends xy{set networkState(t0){this.emit(Qy.NETWORK_STATE_CHANGE,t0,this._networkState),t0===Xy.ONLINE?this.emit(Qy.ONLINE):t0===Xy.OFFLINE&&(this.onlineWaiter=new Gh(e0=>{this.once(Qy.ONLINE,()=>{this.onlineWaiter=void 0,e0(Xy.ONLINE)})}),this.emit(Qy.OFFLINE)),this._networkState=t0}get networkState(){return this._networkState}get isOnline(){return this._networkState===Xy.ONLINE}constructor(){super(),Ty(this,"_moduleName","network-indicator"),Ty(this,"_networkState",Xy.ONLINE),Ty(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Xy.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Xy.OFFLINE})}};function nA(t0,e0){const n0=t0.indexOf(e0);n0!==-1&&t0.splice(n0,1)}function rA(t0){const e0=[];return t0.forEach(n0=>{e0.indexOf(n0)===-1&&e0.push(n0)}),e0}function oA(t0){Gh!==void 0?Gh.resolve().then(t0):setTimeout(t0,0)}function sA(t0){return JSON.parse(JSON.stringify(t0))}function aA(t0){try{return sA(t0)}catch{return t0}}const cA={};function dA(t0,e0){cA[e0]||(cA[e0]=!0,t0())}function lA(t0){const e0=window.atob(t0),n0=new Uint8Array(new ArrayBuffer(e0.length));for(let r0=0;r0<e0.length;r0+=1)n0[r0]=e0.charCodeAt(r0);return n0}function uA(t0){let e0="";for(let n0=0;n0<t0.length;n0+=1)e0+=String.fromCharCode(t0[n0]);return window.btoa(e0)}function hA(t0){let e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n0=new TextEncoder().encode(t0);if(n0.length>e0)n0=n0.slice(0,e0);else if(n0.length<e0){const r0=new Uint8Array(e0);r0.set(n0),n0=r0}return n0}function pA(){for(var t0=arguments.length,e0=new Array(t0),n0=0;n0<t0;n0++)e0[n0]=arguments[n0];const r0=Jn(e0).call(e0,(s0,a0)=>s0+a0.length,0),i0=new Uint8Array(new ArrayBuffer(r0));let o0=0;return e0.forEach(s0=>{i0.set(s0,o0),o0+=s0.length}),i0}function _A(t0){return window.TextEncoder?new TextEncoder().encode(t0).length:t0.length}function EA(t0){let e0=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t0.realFormData&&(t0=t0.realFormData),t0.forEach(n0=>{e0+=typeof n0=="string"?_A(n0):n0.size}),e0+138}function fA(t0){const e0=new Cy(Ry.TIMEOUT,"timeout");return new Gh((n0,r0)=>{window.setTimeout(()=>r0(e0),t0)})}function mA(t0){return new Gh(e0=>{window.setTimeout(e0,t0)})}function TA(){let t0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e0=arguments.length>1?arguments[1]:void 0;const n0=Math.random().toString(16).substr(2,t0).toLowerCase();return n0.length===t0?"".concat(e0).concat(n0):"".concat(e0).concat(n0)+TA(t0-n0.length,"")}function SA(){return TA(32,"").toUpperCase()}const gA=()=>{},RA=new class{constructor(){Ty(this,"fnMap",new Map)}throttleByKey(t0,e0,n0,r0){for(var i0=arguments.length,o0=new Array(i0>4?i0-4:0),s0=4;s0<i0;s0++)o0[s0-4]=arguments[s0];if(this.fnMap.has(e0)){const a0=this.fnMap.get(e0);if(a0.threshold!==n0){a0.fn(...a0.args),clearTimeout(a0.timer);const c0=window.setTimeout(()=>{const u0=this.fnMap.get(e0);u0&&u0.fn(...u0.args),this.fnMap.delete(e0)},n0);this.fnMap.set(e0,{fn:t0,threshold:n0,timer:c0,args:o0,skipFn:r0})}else a0.skipFn&&a0.skipFn(...a0.args),this.fnMap.set(e0,gy(gy({},a0),{},{fn:t0,args:o0,skipFn:r0}))}else{const a0=window.setTimeout(()=>{const c0=this.fnMap.get(e0);c0&&c0.fn(...c0.args),this.fnMap.delete(e0)},n0);this.fnMap.set(e0,{fn:t0,threshold:n0,timer:a0,args:o0,skipFn:r0})}}},CA=RA.throttleByKey.bind(RA);function IA(t0){return typeof t0=="object"&&t0!==null&&!(t0 instanceof RegExp)}function vA(t0,e0){if(!IA(t0)||!IA(e0)||Array.isArray(t0)&&!Array.isArray(e0)||!Array.isArray(t0)&&Array.isArray(e0))return e0;if(Array.isArray(e0)&&Array.isArray(t0)){const n0=[...t0];for(let r0=0;r0<e0.length;r0++)n0[r0]=vA(t0[r0],e0[r0]);return n0}{const n0=gy({},t0);for(const r0 in e0)Object.prototype.hasOwnProperty.call(e0,r0)&&(Object.prototype.hasOwnProperty.call(t0,r0)?n0[r0]=vA(t0[r0],e0[r0]):n0[r0]=e0[r0]);return n0}}function yA(t0,e0){let n0=[0];if(e0&&(n0=new Array(e0).fill(0)),t0===0)return n0;let r0=0;for(;t0>0&&(n0[r0]=255&t0,t0>>=8,r0++,!e0||r0!==e0););return n0}function AA(t0){return typeof t0=="number"?t0:t0.exact||t0.ideal||t0.max||t0.min||0}function bA(t0){const e0="0123456789abcdef";function n0(y0){let b0,S0="";for(b0=0;b0<=3;b0++)S0+=e0.charAt(y0>>8*b0+4&15)+e0.charAt(y0>>8*b0&15);return S0}function r0(y0,b0){const S0=(65535&y0)+(65535&b0);return(y0>>16)+(b0>>16)+(S0>>16)<<16|65535&S0}function i0(y0,b0,S0,w0,I0,L0){return r0(function(M0,C0){return M0<<C0|M0>>>32-C0}(r0(r0(b0,y0),r0(w0,L0)),I0),S0)}function o0(y0,b0,S0,w0,I0,L0,M0){return i0(b0&S0|~b0&w0,y0,b0,I0,L0,M0)}function s0(y0,b0,S0,w0,I0,L0,M0){return i0(b0&w0|S0&~w0,y0,b0,I0,L0,M0)}function a0(y0,b0,S0,w0,I0,L0,M0){return i0(b0^S0^w0,y0,b0,I0,L0,M0)}function c0(y0,b0,S0,w0,I0,L0,M0){return i0(S0^(b0|~w0),y0,b0,I0,L0,M0)}const u0=function(y0){let b0;const S0=1+(y0.length+8>>6),w0=new Array(16*S0);for(b0=0;b0<16*S0;b0++)w0[b0]=0;for(b0=0;b0<y0.length;b0++)w0[b0>>2]|=y0.charCodeAt(b0)<<b0%4*8;return w0[b0>>2]|=128<<b0%4*8,w0[16*S0-2]=8*y0.length,w0}(t0);let l0,d0,h0,p0,m0,f0=1732584193,g0=-271733879,E0=-1732584194,_0=271733878;for(l0=0;l0<u0.length;l0+=16)d0=f0,h0=g0,p0=E0,m0=_0,f0=o0(f0,g0,E0,_0,u0[l0+0],7,-680876936),_0=o0(_0,f0,g0,E0,u0[l0+1],12,-389564586),E0=o0(E0,_0,f0,g0,u0[l0+2],17,606105819),g0=o0(g0,E0,_0,f0,u0[l0+3],22,-1044525330),f0=o0(f0,g0,E0,_0,u0[l0+4],7,-176418897),_0=o0(_0,f0,g0,E0,u0[l0+5],12,1200080426),E0=o0(E0,_0,f0,g0,u0[l0+6],17,-1473231341),g0=o0(g0,E0,_0,f0,u0[l0+7],22,-45705983),f0=o0(f0,g0,E0,_0,u0[l0+8],7,1770035416),_0=o0(_0,f0,g0,E0,u0[l0+9],12,-1958414417),E0=o0(E0,_0,f0,g0,u0[l0+10],17,-42063),g0=o0(g0,E0,_0,f0,u0[l0+11],22,-1990404162),f0=o0(f0,g0,E0,_0,u0[l0+12],7,1804603682),_0=o0(_0,f0,g0,E0,u0[l0+13],12,-40341101),E0=o0(E0,_0,f0,g0,u0[l0+14],17,-1502002290),g0=o0(g0,E0,_0,f0,u0[l0+15],22,1236535329),f0=s0(f0,g0,E0,_0,u0[l0+1],5,-165796510),_0=s0(_0,f0,g0,E0,u0[l0+6],9,-1069501632),E0=s0(E0,_0,f0,g0,u0[l0+11],14,643717713),g0=s0(g0,E0,_0,f0,u0[l0+0],20,-373897302),f0=s0(f0,g0,E0,_0,u0[l0+5],5,-701558691),_0=s0(_0,f0,g0,E0,u0[l0+10],9,38016083),E0=s0(E0,_0,f0,g0,u0[l0+15],14,-660478335),g0=s0(g0,E0,_0,f0,u0[l0+4],20,-405537848),f0=s0(f0,g0,E0,_0,u0[l0+9],5,568446438),_0=s0(_0,f0,g0,E0,u0[l0+14],9,-1019803690),E0=s0(E0,_0,f0,g0,u0[l0+3],14,-187363961),g0=s0(g0,E0,_0,f0,u0[l0+8],20,1163531501),f0=s0(f0,g0,E0,_0,u0[l0+13],5,-1444681467),_0=s0(_0,f0,g0,E0,u0[l0+2],9,-51403784),E0=s0(E0,_0,f0,g0,u0[l0+7],14,1735328473),g0=s0(g0,E0,_0,f0,u0[l0+12],20,-1926607734),f0=a0(f0,g0,E0,_0,u0[l0+5],4,-378558),_0=a0(_0,f0,g0,E0,u0[l0+8],11,-2022574463),E0=a0(E0,_0,f0,g0,u0[l0+11],16,1839030562),g0=a0(g0,E0,_0,f0,u0[l0+14],23,-35309556),f0=a0(f0,g0,E0,_0,u0[l0+1],4,-1530992060),_0=a0(_0,f0,g0,E0,u0[l0+4],11,1272893353),E0=a0(E0,_0,f0,g0,u0[l0+7],16,-155497632),g0=a0(g0,E0,_0,f0,u0[l0+10],23,-1094730640),f0=a0(f0,g0,E0,_0,u0[l0+13],4,681279174),_0=a0(_0,f0,g0,E0,u0[l0+0],11,-358537222),E0=a0(E0,_0,f0,g0,u0[l0+3],16,-722521979),g0=a0(g0,E0,_0,f0,u0[l0+6],23,76029189),f0=a0(f0,g0,E0,_0,u0[l0+9],4,-640364487),_0=a0(_0,f0,g0,E0,u0[l0+12],11,-421815835),E0=a0(E0,_0,f0,g0,u0[l0+15],16,530742520),g0=a0(g0,E0,_0,f0,u0[l0+2],23,-995338651),f0=c0(f0,g0,E0,_0,u0[l0+0],6,-198630844),_0=c0(_0,f0,g0,E0,u0[l0+7],10,1126891415),E0=c0(E0,_0,f0,g0,u0[l0+14],15,-1416354905),g0=c0(g0,E0,_0,f0,u0[l0+5],21,-57434055),f0=c0(f0,g0,E0,_0,u0[l0+12],6,1700485571),_0=c0(_0,f0,g0,E0,u0[l0+3],10,-1894986606),E0=c0(E0,_0,f0,g0,u0[l0+10],15,-1051523),g0=c0(g0,E0,_0,f0,u0[l0+1],21,-2054922799),f0=c0(f0,g0,E0,_0,u0[l0+8],6,1873313359),_0=c0(_0,f0,g0,E0,u0[l0+15],10,-30611744),E0=c0(E0,_0,f0,g0,u0[l0+6],15,-1560198380),g0=c0(g0,E0,_0,f0,u0[l0+13],21,1309151649),f0=c0(f0,g0,E0,_0,u0[l0+4],6,-145523070),_0=c0(_0,f0,g0,E0,u0[l0+11],10,-1120210379),E0=c0(E0,_0,f0,g0,u0[l0+2],15,718787259),g0=c0(g0,E0,_0,f0,u0[l0+9],21,-343485551),f0=r0(f0,d0),g0=r0(g0,h0),E0=r0(E0,p0),_0=r0(_0,m0);return n0(f0)+n0(g0)+n0(E0)+n0(_0)}let wA=1,OA=console,NA=class{static setLogger(t0){OA=t0}constructor(t0){Ty(this,"lockingPromise",Gh.resolve()),Ty(this,"locks",0),Ty(this,"name",""),Ty(this,"lockId",void 0),this.lockId=wA++,t0&&(this.name=t0),OA.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t0){let e0;this.locks+=1,OA.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t0=="string"?t0:""));const n0=new Gh(i0=>{e0=()=>{this.locks-=1,OA.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t0=="string"?t0:"")),i0()}}),r0=this.lockingPromise.then(()=>e0);return this.lockingPromise=this.lockingPromise.then(()=>n0),r0}};function DA(t0,e0){return function(n0,r0,i0){const o0=i0.value;if(typeof o0!="function")throw new Error("Cannot use mutex on object property.");return i0.value=async function(){const s0=this[e0];if(!s0)throw new Error("mutex property key ".concat(e0," doesn't exist on ").concat(t0));const a0=await s0.lock("From ".concat(t0,".").concat(r0));try{for(var c0=arguments.length,u0=new Array(c0),l0=0;l0<c0;l0++)u0[l0]=arguments[l0];return await o0.apply(this,u0)}finally{a0()}},i0}}const PA={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function LA(t0,e0){const n0=Math.floor(e0.timeout*Math.pow(e0.timeoutFactor,t0));return Math.min(e0.maxRetryTimeout,n0)}function kA(t0,e0,n0,r0){const i0=Object.assign({},PA,r0);let o0=i0.timeout;const s0=async()=>{await function(u0){return new Gh(l0=>{window.setTimeout(l0,u0)})}(o0),o0*=i0.timeoutFactor,o0=Math.min(i0.maxRetryTimeout,o0)};let a0=!1;const c0=new Gh(async(u0,l0)=>{e0=e0||(()=>!1),n0=n0||(()=>!0);for(let d0=0;d0<i0.maxRetryCount;d0+=1){if(a0)return l0(new Cy(Ry.OPERATION_ABORTED));try{const h0=await t0();if(!e0(h0,d0)||d0+1===i0.maxRetryCount)return u0(h0);await s0()}catch(h0){if(!n0(h0,d0)||d0+1===i0.maxRetryCount)return l0(h0);await s0()}}});return c0.cancel=()=>a0=!0,c0}class MA{constructor(e0){Ty(this,"input",[]),Ty(this,"size",void 0),this.size=e0}add(e0){this.input.push(e0),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e0;return this.input.length===0?0:Jn(e0=this.input).call(e0,(n0,r0)=>n0+r0)/this.input.length}}let UA,xA=0,VA=0;function FA(t0,e0,n0,r0){return new Gh((i0,o0)=>{e0.responseType=e0.responseType||"json",e0.data&&!n0?(e0.data=JSON.stringify(e0.data),xA+=_A(e0.data)):n0&&(e0.data.size?xA+=e0.data.size:e0.data instanceof FormData?xA+=EA(e0.data):xA+=_A(JSON.stringify(e0.data))),e0.headers=e0.headers||{},e0.headers["Content-Type"]=e0.headers["Content-Type"]||"application/json",e0.method="POST",e0.url=t0,Lv.request(e0).then(s0=>{typeof s0.data=="string"?VA+=_A(s0.data):s0.data instanceof ArrayBuffer||s0.data instanceof Uint8Array?VA+=s0.data.byteLength:VA+=_A(JSON.stringify(s0.data)),r0&&i0({data:s0.data,headers:s0.headers}),i0(s0.data)}).catch(s0=>{Lv.isCancel(s0)?o0(new Cy(Ry.OPERATION_ABORTED,"cancel token canceled")):s0.code==="ECONNABORTED"?o0(new Cy(Ry.NETWORK_TIMEOUT,s0.message)):s0.response?o0(new Cy(Ry.NETWORK_RESPONSE_ERROR,s0.response.status)):o0(new Cy(Ry.NETWORK_ERROR,s0.message))})})}async function BA(t0,e0){const n0=new Blob([e0.data],{type:"buffer"});return await FA(t0,gy(gy({},e0),{},{data:n0,headers:{"Content-Type":"application/octet-stream"}}),!0)}const jA=()=>window.isSecureContext!==void 0,GA=function(t0){if(t0.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t0;const e0=t0.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e0&&e0[1]&&e0[2]){const n0=e0[1],r0=e0[2];return"".concat(n0,".").concat(r0)}return"4.0.0.999"}("4.22.1"),WA=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let HA=function(t0){return t0.Default="default",t0.Auto="auto",t0.Relay="relay",t0.SdRtn="sd-rtn",t0}({});const KA=function(){const t0="us".concat("erna","me"),e0="pa".concat("sswo","rd"),n0=["t","s","t"];n0.splice(1,0,"e");const r0=n0.join(""),i0=[];for(let a0=0;a0<6;a0++)i0.push("1");const o0=i0.join(""),s0={};return s0[t0]=r0,s0[e0]=o0,Object.assign(s0,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=KA;const YA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},qA="v4.22.1-0-g1c8e27e9(9/19/2024, 2:23:30 PM)",zA=gy(gy({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:YA,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0,DISABLE_SCREEN_SHARE_REMB:!1},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0});function JA(t0,e0,n0){var r0,i0,o0;Dn(r0=Object.keys(zA)).call(r0,t0)&&(!n0&&Dn(i0=Object.keys(QA)).call(i0,t0)||(zA[t0]=e0,t0==="ENABLE_VIDEO_SEI"&&e0===!0&&(zA.ENABLE_ENCODED_TRANSFORM=!0),t0==="USE_NEW_NETWORK_CONFIG"&&e0&&(o0=!!e0,zA.USE_NEW_NETWORK_CONFIG=o0,o0&&(zA.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],zA.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],zA.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],zA.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],zA.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",zA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",zA.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t0==="ENABLE_PRE_SUB"&&e0&&(zA.ENABLE_INSTANT_VIDEO=!0,zA.ENABLE_PREALLOC_PC=!0),t0==="ENABLE_SVC"&&e0&&(zA.ENABLE_AUT_CC=!0)))}function XA(t0){return zA[t0]}WA||(zA.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],zA.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],zA.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],zA.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],zA.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],zA.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],zA.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",zA.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",zA.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",zA.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",zA.AREAS=["NORTH_AMERICA","OVERSEA"]);const QA={};var ZA=function(t0){return t0.SET_SESSION_ID="SET_SESSION_ID",t0.SET_P2P_ID="SET_P2P_id",t0.SET_DC_ID="SET_DC_id",t0.SET_UID="SET_UID",t0.SET_INT_UID="SET_INT_UID",t0.SET_PUB_ID="SET_PUB_ID",t0.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t0.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t0.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t0.AVOID_JOIN_START="AVOID_JOIN_START",t0.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t0.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t0.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t0.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t0.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t0.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t0.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t0.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t0.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t0.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t0.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t0.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t0.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t0.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t0.RESET_KEY_METRICS="RESET_KEY_METRICS",t0.SET_USE_P2P="SET_USE_P2P",t0.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t0}(ZA||{});class $A{constructor(e0,n0,r0,i0){Ty(this,"state",void 0),this.state={codec:e0,audioCodec:n0,mode:r0,clientId:i0,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:HA.Default}}dispatch(e0){this.state=function(n0,r0){switch(r0.type){case ZA.SET_SESSION_ID:return gy(gy({},n0),{},{sessionId:r0.sessionId});case ZA.SET_P2P_ID:return gy(gy({},n0),{},{p2pId:r0.p2pId});case ZA.SET_UID:return gy(gy({},n0),{},{uid:r0.uid});case ZA.SET_INT_UID:return gy(gy({},n0),{},{intUid:r0.intUid});case ZA.SET_PUB_ID:return gy(gy({},n0),{},{pubId:r0.pubId});case ZA.KEY_METRIC_CLIENT_CREATED:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{clientCreated:r0.metric})});case ZA.KEY_METRIC_JOIN_START:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{joinStart:r0.metric})});case ZA.AVOID_JOIN_START:return gy(gy({},n0),{},{avoidJoinStart:r0.avoidJoinStart});case ZA.KEY_METRIC_JOIN_END:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{joinEnd:r0.metric})});case ZA.KEY_METRIC_REQUEST_AP_START:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{requestAPStart:r0.metric})});case ZA.KEY_METRIC_REQUEST_AP_END:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{requestAPEnd:r0.metric})});case ZA.KEY_METRIC_JOIN_GATEWAY_START:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{joinGatewayStart:r0.metric})});case ZA.KEY_METRIC_JOIN_GATEWAY_END:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{joinGatewayEnd:r0.metric})});case ZA.KEY_METRIC_PEER_CONNECTION_START:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{peerConnectionStart:r0.metric})});case ZA.KEY_METRIC_PEER_CONNECTION_END:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{peerConnectionEnd:r0.metric})});case ZA.KEY_METRIC_DESCRIPTION_START:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{descriptionStart:r0.metric})});case ZA.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{signalChannelOpen:r0.metric})});case ZA.KEY_METRIC_ICE_CONNECTION_END:return gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{iceConnectionEnd:r0.metric})});case ZA.KEY_METRIC_PUBLISH:{const i0=n0.keyMetrics.publish,o0=i0.findIndex(s0=>s0.trackId===r0.metric.trackId);return o0!==-1?(i0[o0]=gy(gy({},i0[o0]),r0.metric),gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{publish:[...i0]})})):gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{publish:[...n0.keyMetrics.publish,r0.metric]})})}case ZA.KEY_METRIC_SUBSCRIBE:{const i0=n0.keyMetrics.subscribe,o0=i0.findIndex(s0=>s0.userId===r0.metric.userId&&s0.type===r0.metric.type);return o0!==-1?(i0[o0]=gy(gy({},i0[o0]),r0.metric),gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{subscribe:[...i0]})})):gy(gy({},n0),{},{keyMetrics:gy(gy({},n0.keyMetrics),{},{subscribe:[...n0.keyMetrics.subscribe,r0.metric]})})}case ZA.SET_CLOUD_PROXY_SERVER_MODE:return n0.cloudProxyServerMode=r0.mode,n0;case ZA.RECORD_JOIN_CHANNEL_SERVICE:return typeof r0.index!="number"?n0.joinChannelServiceRecords=[...n0.joinChannelServiceRecords,r0.record]:(n0.joinChannelServiceRecords[r0.index]=gy(gy({},n0.joinChannelServiceRecords[r0.index]),r0.record),n0.joinChannelServiceRecords=[...n0.joinChannelServiceRecords]),n0;case ZA.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n0.joinChannelServiceRecords=[],n0;case ZA.RESET_KEY_METRICS:return n0.keyMetrics={publish:[],subscribe:[]},n0;case ZA.SET_USE_P2P:return gy(gy({},n0),{},{useP2P:r0.val});case ZA.SET_TRANSPORT_TYPE:return gy(gy({},n0),{},{p2pTransport:r0.val});default:return n0}}(this.state,e0)}set sessionId(e0){this.dispatch({type:ZA.SET_SESSION_ID,sessionId:e0})}get sessionId(){return this.state.sessionId}set codec(e0){this.state.codec=e0}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e0){this.dispatch({type:ZA.SET_P2P_ID,p2pId:e0})}get p2pId(){return this.state.p2pId}set dcId(e0){this.dispatch({type:ZA.SET_DC_ID,dcId:e0})}get dcId(){return this.state.dcId}set uid(e0){this.dispatch({type:ZA.SET_UID,uid:e0})}get uid(){return this.state.uid}set intUid(e0){this.dispatch({type:ZA.SET_INT_UID,intUid:e0})}get intUid(){return this.state.intUid}set pubId(e0){this.dispatch({type:ZA.SET_PUB_ID,pubId:e0})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e0){this.dispatch({type:ZA.SET_CLOUD_PROXY_SERVER_MODE,mode:e0})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e0){this.dispatch({type:ZA.SET_USE_P2P,val:e0})}get useP2P(){return this.state.useP2P}set p2pTransport(e0){this.dispatch({type:ZA.SET_TRANSPORT_TYPE,val:e0})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:ZA.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ZA.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ZA.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ZA.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ZA.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ZA.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ZA.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ZA.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ZA.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ZA.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ZA.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ZA.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e0,n0,r0,i0){this.dispatch({type:ZA.KEY_METRIC_PUBLISH,metric:gy(gy({trackId:e0,type:n0},r0&&{publishStart:r0}),i0&&{publishEnd:i0})})}subscribe(e0,n0,r0,i0,o0,s0,a0){this.dispatch({type:ZA.KEY_METRIC_SUBSCRIBE,metric:gy(gy(gy(gy(gy({userId:e0,type:n0},r0&&{subscribeStart:r0}),i0&&{subscribeEnd:i0}),o0&&{firstFrame:o0}),s0&&{streamAdded:s0}),a0&&{firstDecoded:a0})})}massSubscribe(e0,n0,r0,i0){e0.forEach(o0=>{this.dispatch({type:ZA.KEY_METRIC_SUBSCRIBE,metric:gy(gy(gy({userId:o0.userId,type:o0.type},n0&&{subscribeStart:n0}),r0&&{subscribeEnd:r0}),i0&&{firstFrame:i0})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e0,n0){e0.service==="gateway"&&Array.isArray(e0.urls)&&(e0.urls=e0.urls.map(r0=>r0.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n0!="number"?(this.dispatch({type:ZA.RECORD_JOIN_CHANNEL_SERVICE,record:gy(gy({},e0),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n0<0||n0>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ZA.RECORD_JOIN_CHANNEL_SERVICE,record:e0,index:n0}),n0)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ZA.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ZA.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e0){this.dispatch({type:ZA.AVOID_JOIN_START,avoidJoinStart:e0})}}let eb=function(t0){return t0.h264="h264",t0.h265="h265",t0.vp8="vp8",t0.vp9="vp9",t0.av1="av1",t0}({});(function(t0){t0.opus="opus",t0.pcma="pcma",t0.pcmu="pcmu",t0.g722="g722"})({});const tb=128,ib=96,nb=1e3,rb=10;let ob=0;function sb(t0,e0,n0){return(e0=function(r0){var i0=function(o0,s0){if(typeof o0!="object"||!o0)return o0;var a0=o0[Symbol.toPrimitive];if(a0!==void 0){var c0=a0.call(o0,"string");if(typeof c0!="object")return c0;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o0)}(r0);return typeof i0=="symbol"?i0:i0+""}(e0))in t0?Object.defineProperty(t0,e0,{value:n0,enumerable:!0,configurable:!0,writable:!0}):t0[e0]=n0,t0}function ab(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function cb(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?ab(Object(n0),!0).forEach(function(r0){sb(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):ab(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}const db=new class extends xy{constructor(){super(...arguments),sb(this,"currentUploadLogID",0)}reportLogUploadError(t0){const{errorRange:e0}=t0;e0[e0.length-1]&&e0[e0.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e0[e0.length-1],this.emit("REPORT_LOG_UPLOAD",t0))}};class lb{constructor(e0){sb(this,"logger",void 0),sb(this,"prefixLists",[]),this.logger=e0}debug(){for(var e0=arguments.length,n0=new Array(e0),r0=0;r0<e0;r0++)n0[r0]=arguments[r0];this.logger.debug(...this.prefixLists,...n0)}info(){for(var e0=arguments.length,n0=new Array(e0),r0=0;r0<e0;r0++)n0[r0]=arguments[r0];this.logger.info(...this.prefixLists,...n0)}warning(){for(var e0=arguments.length,n0=new Array(e0),r0=0;r0<e0;r0++)n0[r0]=arguments[r0];this.logger.warning(...this.prefixLists,...n0)}error(){for(var e0=arguments.length,n0=new Array(e0),r0=0;r0<e0;r0++)n0[r0]=arguments[r0];this.logger.error(...this.prefixLists,...n0)}prefix(e0){return this.prefixLists.push(e0),this}popPrefix(){return this.prefixLists.pop(),this}}function ub(){const t0=new Date;return t0.toTimeString().split(" ")[0]+":"+t0.getMilliseconds()}function hb(){const t0=new Date,e0=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e0?(e0==null?void 0:e0[0])+":"+t0.getUTCMilliseconds():t0.toTimeString().split(" ")[0]+":"+t0.getMilliseconds()}const pb={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},_b=Date.now(),Eb=t0=>{for(const e0 in pb)if(Object.prototype.hasOwnProperty.call(pb,e0)&&pb[e0]===t0)return e0;return"DEFAULT"},fb=new class{constructor(){sb(this,"proxyServerURL",void 0),sb(this,"logLevel",pb.DEBUG),sb(this,"uploadState","collecting"),sb(this,"uploadLogWaitingList",[]),sb(this,"uploadLogUploadingList",[]),sb(this,"uploadErrorCount",0),sb(this,"currentLogID",0),sb(this,"url",void 0),sb(this,"extLog",(t0,e0)=>{this.appendLogToWaitingList(t0,...e0)})}debug(){for(var t0=arguments.length,e0=new Array(t0),n0=0;n0<t0;n0++)e0[n0]=arguments[n0];const r0=[pb.DEBUG].concat(e0);this.log.apply(this,r0)}info(){for(var t0=arguments.length,e0=new Array(t0),n0=0;n0<t0;n0++)e0[n0]=arguments[n0];const r0=[pb.INFO].concat(e0);this.log.apply(this,r0)}warning(){for(var t0=arguments.length,e0=new Array(t0),n0=0;n0<t0;n0++)e0[n0]=arguments[n0];const r0=[pb.WARNING].concat(e0);this.log.apply(this,r0)}warn(){this.warning(...arguments)}error(){for(var t0=arguments.length,e0=new Array(t0),n0=0;n0<t0;n0++)e0[n0]=arguments[n0];const r0=[pb.ERROR].concat(e0);this.log.apply(this,r0)}upload(){for(var t0=arguments.length,e0=new Array(t0),n0=0;n0<t0;n0++)e0[n0]=arguments[n0];const r0=[pb.DEBUG].concat(e0);this.uploadLog.apply(this,r0)}setLogLevel(t0){t0=Math.min(Math.max(0,t0),4),this.logLevel=t0}enableLogUpload(){JA("UPLOAD_LOG",!0)}disableLogUpload(){JA("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t0){this.proxyServerURL=t0}prefix(t0){return new lb(this).prefix(t0)}log(){for(var t0=arguments.length,e0=new Array(t0),n0=0;n0<t0;n0++)e0[n0]=arguments[n0];if(Date.now()-_b<100)return void setTimeout(()=>{this.log(...e0)},Date.now()-_b);const r0=Math.max(0,Math.min(4,e0[0]));if(e0[0]=ub()+" Agora-SDK [".concat(Eb(r0),"]:"),this.appendLogToWaitingList(r0,...e0),r0<this.logLevel)return;const i0=ub()+" %cAgora-SDK [".concat(Eb(r0),"]:");let o0=[];if(!XA("USE_NEW_LOG"))switch(r0){case pb.DEBUG:o0=[i0,"color: #64B5F6;"].concat(e0.slice(1)),console.log.apply(console,o0);break;case pb.INFO:o0=[i0,"color: #1E88E5; font-weight: bold;"].concat(e0.slice(1)),console.log.apply(console,o0);break;case pb.WARNING:o0=[i0,"color: #FB8C00; font-weight: bold;"].concat(e0.slice(1)),console.warn.apply(console,o0);break;case pb.ERROR:o0=[i0,"color: #B00020; font-weight: bold;"].concat(e0.slice(1)),console.error.apply(console,o0)}}uploadLog(){for(var t0=arguments.length,e0=new Array(t0),n0=0;n0<t0;n0++)e0[n0]=arguments[n0];if(Date.now()-_b<100)return void setTimeout(()=>{this.uploadLog(...e0)},Date.now()-_b);const r0=Math.max(0,Math.min(4,e0[0]));e0[0]=ub()+" Agora-SDK [".concat(Eb(r0),"]:"),this.appendLogToWaitingList(r0,...e0)}appendLogToWaitingList(t0){if(!XA("UPLOAD_LOG"))return;for(var e0=arguments.length,n0=new Array(e0>1?e0-1:0),r0=1;r0<e0;r0++)n0[r0-1]=arguments[r0];Array.isArray(n0[0])?n0[0][0]=hb()+" Agora-SDK [".concat(Eb(t0),"]:"):n0[0]=hb()+" Agora-SDK [".concat(Eb(t0),"]:");let i0="";n0.forEach(o0=>{typeof o0=="object"&&(o0=JSON.stringify(o0)),i0+="".concat(o0," ")}),this.uploadLogWaitingList.push({payload_str:i0,log_level:t0,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t0=this.uploadLogUploadingList,e0={sdk_version:GA,process_id:XA("PROCESS_ID"),payload:JSON.stringify(t0)};return kA(async()=>{const n0=await Lv.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(XA("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(XA("LOG_UPLOAD_SERVER"),"/upload/v1")),e0,{responseType:"text"});if(n0.data!=="OK"){const r0=new Error("unexpected upload log response");throw r0.response=n0,r0}},()=>(this.uploadLogUploadingList=[],!1),n0=>{const r0={status:-1,message:n0.message,errorRange:t0.map(i0=>i0.log_item_id)};return n0.response?(r0.status=n0.response.status,r0.data=n0.response.data,r0.headers=n0.response.headers):n0.request&&(r0.status=n0.request.status),db.reportLogUploadError(r0),!0},{timeout:XA("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:XA("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,XA("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),XA("UPLOAD_LOG_INTERVAL"))}).catch(t0=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),XA("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),XA("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var mb;function Tb(t0){return by(t0.reportId,"params.reportId",0,100,!1),by(t0.category,"params.category",0,100,!1),by(t0.event,"params.event",0,100,!1),by(t0.label,"params.label",0,100,!1),yy(t0.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(mb={}).FREE="free",mb.UPLOADING="uploading",function(t0){t0[t0.MISC=0]="MISC",t0[t0.INTERNAL_EVENT=1]="INTERNAL_EVENT",t0[t0.PUBLIC_EVENT=2]="PUBLIC_EVENT",t0[t0.WEB_EVENT=3]="WEB_EVENT",t0[t0.INTERNAL_API=4]="INTERNAL_API",t0[t0.WEB_API=5]="WEB_API",t0[t0.PUBLIC_API=6]="PUBLIC_API"}({});const Sb={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let gb=function(t0){return t0.PUBLISH="publish",t0.SUBSCRIBE="subscribe",t0.WS_COMPRESSOR_INIT="ws_compressor_init",t0.SESSION_INIT="session_init",t0.JOIN_CHOOSE_SERVER="join_choose_server",t0.REQ_USER_ACCOUNT="req_user_account",t0.JOIN_GATEWAY="join_gateway",t0.REJOIN_GATEWAY="rejoin_gateway",t0.STREAM_SWITCH="stream_switch",t0.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t0.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t0.FIRST_VIDEO_RECEIVED="first_video_received",t0.FIRST_AUDIO_RECEIVED="first_audio_received",t0.FIRST_VIDEO_DECODE="first_video_decode",t0.FIRST_AUDIO_DECODE="first_audio_decode",t0.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t0.ON_ADD_VIDEO_STREAM="on_add_video_stream",t0.ON_UPDATE_STREAM="on_update_stream",t0.ON_REMOVE_STREAM="on_remove_stream",t0.USER_ANALYTICS="req_user_analytics",t0.PC_STATS="pc_stats",t0.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t0}({}),Rb=function(t0){return t0.SESSION="io.agora.pb.Wrtc.Session",t0.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t0.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t0.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t0.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t0.PUBLISH="io.agora.pb.Wrtc.Publish",t0.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t0.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t0.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t0.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t0.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t0.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t0.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t0.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t0.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t0.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t0.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t0.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t0.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t0.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t0.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t0.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t0.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t0.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t0.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t0.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t0.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t0.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t0.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t0.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t0.PC_STATS="io.agora.pb.Wrtc.PCStats",t0.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t0}({});(function(t0){t0[t0.WORKER_EVENT=156]="WORKER_EVENT",t0[t0.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Cb=function(t0){return t0[t0.SESSION=26]="SESSION",t0[t0.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t0[t0.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t0[t0.JOIN_GATEWAY=28]="JOIN_GATEWAY",t0[t0.PUBLISH=30]="PUBLISH",t0[t0.SUBSCRIBE=29]="SUBSCRIBE",t0[t0.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t0[t0.STREAM_SWITCH=32]="STREAM_SWITCH",t0[t0.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t0[t0.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t0[t0.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t0[t0.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t0[t0.API_INVOKE=41]="API_INVOKE",t0[t0.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t0[t0.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t0[t0.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t0[t0.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t0[t0.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t0[t0.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t0[t0.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t0[t0.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t0[t0.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t0[t0.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t0[t0.WORKER_EVENT=156]="WORKER_EVENT",t0[t0.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t0[t0.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t0[t0.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t0[t0.USER_ANALYTICS=1e4]="USER_ANALYTICS",t0[t0.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t0}({});function Ib(){let t0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e0,n0,r0){const i0=r0.value;if(typeof i0=="function"){const o0=t0.className||e0.__className__||(e0.constructor.name==="AgoraRTCClient"?"Client":e0.constructor.name);r0.value=function(){for(var s0=arguments.length,a0=new Array(s0),c0=0;c0<s0;c0++)a0[c0]=arguments[c0];let u0=a0;if(t0.argsMap)try{u0=t0.argsMap(this,...a0)}catch(d0){fb.warning(d0),u0=[]}try{JSON.stringify(u0)}catch{fb.warning("arguments for method ".concat(o0,".").concat(String(n0)," not serializable for apiInvoke.")),u0=[]}const l0=(t0.report||vb).reportApiInvoke(this._sessionId||null,{name:"".concat(o0,".").concat(String(n0)),options:u0,tag:jy.TRACER,reportResult:t0.reportResult},t0.throttleTime);try{const d0=i0.apply(this,a0);return d0 instanceof Gh?d0.then(h0=>(l0.onSuccess(t0.reportResult&&h0),h0)).catch(h0=>{throw l0.onError(h0),h0}):(l0.onSuccess(t0.reportResult&&d0),d0)}catch(d0){throw l0.onError(d0),d0}}}return r0}}const vb=new class{constructor(){sb(this,"baseInfoMap",new Map),sb(this,"proxyServer",void 0),sb(this,"eventUploadTimer",void 0),sb(this,"setSessionIdTimer",void 0),sb(this,"url",void 0),sb(this,"sids",new Set),sb(this,"backupUrl",void 0),sb(this,"_appId",void 0),sb(this,"keyEventUploadPendingItems",[]),sb(this,"normalEventUploadPendingItems",[]),sb(this,"apiInvokeUploadPendingItems",[]),sb(this,"apiInvokeCount",0),sb(this,"ltsList",[]),sb(this,"lastSendNormalEventTime",Date.now()),sb(this,"customReportCounterTimer",void 0),sb(this,"customReportCount",0),sb(this,"extApiInvoke",async t0=>{for(const e0 of t0){const n0=cb(cb({},e0),{},{sid:null,invokeId:++this.apiInvokeCount,tag:jy.TRACER});this.sendApiInvoke(n0)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),XA("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),XA("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t0){return this.baseInfoMap.get(t0)}adjustSessionStartTime(t0){if(!this.baseInfoMap.has(t0)&&!this.baseInfoMap.get(t0))return void fb.error("adjust session ".concat(t0," start time, sid is not exist or info is undefined"));const e0=this.baseInfoMap.get(t0),n0=Date.now(),r0=e0.startTime;e0.startTime=n0,fb.debug("rewrite session ".concat(t0," startTime: ").concat(n0," , ").concat(n0-r0,"ms")),this.baseInfoMap.set(t0,e0)}setAppId(t0){this._appId=t0}reportApiInvoke(t0,e0,n0){e0.timeout=e0.timeout||6e4,e0.reportResult=e0.reportResult===void 0||e0.reportResult;const r0=Date.now();this.apiInvokeCount+=1;const i0=this.apiInvokeCount,o0=()=>({tag:e0.tag,invokeId:i0,sid:t0,name:e0.name,apiInvokeTime:r0,options:e0.options,states:e0.states||null}),s0=!!XA("SHOW_REPORT_INVOKER_LOG");s0&&fb.info("".concat(e0.name," start"),e0.options);let a0=!1;mA(e0.timeout).then(()=>{a0||(this.sendApiInvoke(cb(cb({},o0()),{},{error:Ry.API_INVOKE_TIMEOUT,success:!1})),fb.debug("".concat(e0.name," timeout")))});const c0=new Cy(Ry.UNEXPECTED_ERROR,"".concat(e0.name,": this api invoke is end"));return{onSuccess:u0=>{const l0=()=>{if(a0)throw c0;return a0=!0,this.sendApiInvoke(cb(cb({},o0()),{},{success:!0},e0.reportResult&&{result:u0})),s0&&fb.info("".concat(e0.name," onSuccess")),u0};return n0?CA(l0,e0.name+"Success",n0,()=>a0=!0):l0()},onError:u0=>{const l0=()=>{if(a0)throw u0;a0=!0,this.sendApiInvoke(cb(cb({},o0()),{},{success:!1,error:u0})),s0&&fb.info("".concat(e0.name," onFailure"),u0.toString())};return n0?CA(l0,e0.name+"Error",n0,()=>a0=!0):l0()}}}sessionInit(t0,e0){if(this.baseInfoMap.has(t0))return;const n0=Date.now(),r0=this.createBaseInfo(t0,n0);r0.cname=e0.cname;const i0=Object.assign({},{willUploadConsoleLog:XA("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:WA?"global":"oversea",areas:XA("AREAS")&&XA("AREAS").join(",")},e0.extend),{stringUid:o0,channelProfile:s0,channelMode:a0,isABTestSuccess:c0,lsid:u0,clientRole:l0}=e0,d0=Date.now(),h0=cb(cb({},r0),{},{eventType:gb.SESSION_INIT,appid:e0.appid,browser:navigator.userAgent,buildFormat:e0.buildFormat,build:qA,lts:d0,elapse:d0-n0,extend:JSON.stringify(i0),mode:e0.mode,process:XA("PROCESS_ID"),appType:XA("APP_TYPE"),success:!0,version:GA,stringUid:o0,channelProfile:s0,channelMode:a0,isABTestSuccess:c0,lsid:u0,clientType:Dn(p0=window.navigator.userAgent).call(p0,"AgoraWebView")?42:20,clientRole:l0,serviceId:XA("PROCESS_ID"),extensionID:XA("PLUGIN_INFO").join(",")||""});var p0;this.send({type:Rb.SESSION,data:h0},!0)}joinChooseServer(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb({},r0),{},{eventType:gb.JOIN_CHOOSE_SERVER,lts:i0,eventElapse:e0.elapse||i0-e0.lts,chooseServerAddr:e0.csAddr,errorCode:e0.ec,elapse:i0-n0.startTime,success:e0.succ,chooseServerAddrList:JSON.stringify(e0.serverList),uid:e0.uid?parseInt(e0.uid):null,cid:e0.cid?parseInt(e0.cid):null,chooseServerIp:e0.csIp||"",opid:e0.opid,unilbsServerIds:e0.unilbsServerIds,extend:e0.extend||void 0,isHttp3:e0.isHttp3,corssRegionTagReq:e0.corssRegionTagReq||void 0,corssRegionTagRes:e0.corssRegionTagRes||void 0});this.send({type:Rb.JOIN_CHOOSE_SERVER,data:o0},!0)}reqUserAccount(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb({},r0),{},{eventType:gb.REQ_USER_ACCOUNT,lts:i0,success:e0.success,serverAddress:e0.serverAddr,stringUid:e0.stringUid,uid:e0.uid,errorCode:e0.errorCode,elapse:e0.elapse||i0-n0.startTime,eventElapse:i0-e0.lts,extend:JSON.stringify(e0.extend)});this.send({type:Rb.REQ_USER_ACCOUNT,data:o0},!0)}joinGateway(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info;e0.vid&&(r0.vid=e0.vid),r0.uid=e0.uid,r0.cid=e0.cid;const i0=Date.now(),{firstSuccess:o0,avoidJoinStartTime:s0}=e0,a0=i0-(o0&&s0?s0:n0.startTime),c0=cb(cb({},r0),{},{eventType:gb.JOIN_GATEWAY,lts:i0,gatewayAddr:e0.addr,success:e0.succ,errorCode:e0.ec,errorMsg:e0.errorMsg||"",elapse:a0,eventElapse:i0-e0.lts,firstSuccess:o0,signalChannel:e0.signalChannel,preload:e0.preload?1:0});e0.succ&&(n0.lastJoinSuccessTime=i0),this.send({type:Rb.JOIN_GATEWAY,data:c0},!0)}joinChannelTimeout(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=Date.now(),i0=cb(cb({},n0.info),{},{lts:r0,timeout:e0,elapse:r0-n0.startTime});this.send({type:Rb.JOIN_CHANNEL_TIMEOUT,data:i0},!0)}publish(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb({},r0),{},{eventType:gb.PUBLISH,lts:i0,eventElapse:e0.eventElapse,elapse:i0-n0.startTime,success:e0.succ,errorCode:e0.ec,videoName:e0.videoName,audioName:e0.audioName,screenName:e0.screenName,screenshare:e0.screenshare,audio:e0.audio,video:e0.video,p2pid:e0.p2pid,publishRequestid:e0.publishRequestid});this.send({type:Rb.PUBLISH,data:o0},!0)}subscribe(t0,e0,n0){const r0=this.baseInfoMap.get(t0);if(!r0)return;const i0=r0.info,o0=Date.now(),s0=cb(cb({},i0),{},{eventType:gb.SUBSCRIBE,lts:o0,eventElapse:e0.eventElapse,elapse:o0-r0.startTime,success:e0.succ,errorCode:e0.ec,video:e0.video,audio:e0.audio,subscribeRequestid:e0.subscribeRequestid,p2pid:e0.p2pid,preSsrc:e0.preSsrc?1:0},n0&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e0.peerid=="string"?s0.peerSuid=e0.peerid:s0.peer=e0.peerid,this.send({type:Rb.SUBSCRIBE,data:s0},!0)}wsCompressorInit(t0){var e0;const n0=[...d_(e0=this.baseInfoMap).call(e0)],r0=n0.length?n0[0]:"UnableToGetSid",i0=this.baseInfoMap.get(r0);if(!i0)return;const o0=i0.info,s0=Date.now(),a0=cb(cb({},o0),{},{eventType:gb.WS_COMPRESSOR_INIT,lts:s0,eventElapse:t0.eventElapse,elapse:s0-i0.startTime,status:t0.status?1:2});this.send({type:Rb.WS_COMPRESSOR_INIT,data:a0},!0)}firstRemoteVideoDecode(t0,e0,n0,r0){const i0=this.baseInfoMap.get(t0);if(!i0)return;const o0=i0.info,s0=Date.now(),a0=cb(cb(cb({},o0),r0),{},{elapse:s0-i0.startTime,eventType:e0,lts:s0,firstDecodeFrame:Math.max((r0.firstFrame||s0)-i0.startTime,0),apEnd:Math.max(r0.apEnd-i0.startTime,0),apStart:Math.max(r0.apStart-i0.startTime,0),joinGwEnd:Math.max(r0.joinGwEnd-i0.startTime,0),joinGwStart:Math.max(r0.joinGwStart-i0.startTime,0),pcEnd:Math.max(r0.pcEnd-i0.startTime,0),pcStart:Math.max(r0.pcStart-i0.startTime,0),subscriberEnd:Math.max(r0.subscriberEnd-i0.startTime,0),subscriberStart:Math.max(r0.subscriberStart-i0.startTime,0),videoAddNotify:Math.max(r0.videoAddNotify-i0.startTime,0)});this.send({type:n0,data:a0},!0)}firstRemoteFrame(t0,e0,n0,r0){const i0=this.baseInfoMap.get(t0);if(!i0)return;const o0=i0.info,s0=Date.now(),a0=cb(cb(cb({},o0),r0),{},{elapse:s0-i0.startTime,eventType:e0,lts:s0});this.send({type:n0,data:a0},!0)}pcStats(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb(cb({},r0),e0),{},{vid:r0.vid===void 0?0:Number(r0.vid),elapse:i0-n0.startTime,eventType:gb.PC_STATS,lts:i0,preallocation:e0.preallocation?1:0});this.send({type:Rb.PC_STATS,data:o0},!0)}updateRemoteRTPCapabilities(t0,e0){if(t0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb(cb({},r0),e0),{},{vid:r0.vid===void 0?0:Number(r0.vid),eventType:gb.UPDATE_REMOTE_RTPCAPABILITIES,lts:i0});this.send({type:Rb.UPDATE_REMOTE_RTPCAPABILITIES,data:o0},!0)}}onGatewayStream(t0,e0,n0,r0){const i0=this.baseInfoMap.get(t0);if(!i0)return;const o0=i0.info,s0=Date.now(),a0=cb(cb(cb({},o0),r0),{},{eventType:e0,lts:s0});this.send({type:n0,data:a0},!0)}streamSwitch(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb({},r0),{},{eventType:gb.STREAM_SWITCH,lts:i0,isDual:e0.isdual,elapse:i0-n0.startTime,success:e0.succ});this.send({type:Rb.STREAM_SWITCH,data:o0},!0)}requestProxyAppCenter(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb({},r0),{},{eventType:gb.REQUEST_PROXY_APPCENTER,lts:i0,eventElapse:i0-e0.lts,elapse:i0-n0.startTime,APAddr:e0.APAddr,workerManagerList:e0.workerManagerList,response:e0.response,errorCode:e0.ec,success:e0.succ});this.send({type:Rb.REQUEST_PROXY_APPCENTER,data:o0},!0)}requestProxyWorkerManager(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb({},r0),{},{eventType:gb.REQUEST_PROXY_WORKER_MANAGER,lts:i0,eventElapse:i0-e0.lts,elapse:i0-n0.startTime,workerManagerAddr:e0.workerManagerAddr,response:e0.response,errorCode:e0.ec,success:e0.succ});this.send({type:Rb.REQUEST_PROXY_WORKER_MANAGER,data:o0},!0)}setProxyServer(t0){this.proxyServer=t0,t0?fb.debug("reportProxyServerurl: ".concat(t0)):fb.debug("disable reportProxyServerurl: ".concat(t0))}peerPublishStatus(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb({},r0),{},{subscribeElapse:e0.subscribeElapse,peer:e0.peer,peerPublishDuration:Math.max(e0.audioPublishDuration,e0.videoPublishDuration),audiotag:e0.audioPublishDuration>0?1:-1,videotag:e0.videoPublishDuration>0?1:-1,lts:i0,elapse:i0-n0.startTime,joinChannelSuccessElapse:i0-(n0.lastJoinSuccessTime||i0),peerPublishDurationVideo:e0.videoPublishDuration,peerPublishDurationAudio:e0.audioPublishDuration});this.send({type:Rb.PEER_PUBLISH_STATUS,data:o0},!0)}workerEvent(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now();(function(o0,s0,a0){const c0=o0[s0];if(!c0||typeof c0!="string")return[o0];o0[s0]="";const u0=_A(JSON.stringify(o0));let l0=0;const d0=[];let h0=0;for(let p0=0;p0<c0.length;p0++)h0+=c0.charCodeAt(p0)<=127?1:3,h0<=a0-u0||(d0[d0.length]=gy(gy({},o0),{},{[s0]:c0.substring(l0,p0)}),l0=p0,h0=c0.charCodeAt(p0)<=127?1:3);return l0!==c0.length-1&&(d0[d0.length]=gy(gy({},o0),{},{[s0]:c0.substring(l0)})),d0})(cb(cb(cb({},r0),e0),{},{elapse:i0-n0.startTime,lts:i0,productType:"WebRTC"}),"payload",1300).forEach(o0=>this.send({type:Rb.WORKER_EVENT,data:o0},!0))}apworkerEvent(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb(cb({},r0),e0),{},{elapse:i0-n0.startTime,lts:i0});this.send({type:Rb.AP_WORKER_EVENT,data:o0},!0)}joinWebProxyAP(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb(cb({},r0),e0),{},{elapse:i0-n0.startTime,lts:i0,extend:e0.extend||void 0});this.send({type:Rb.JOIN_WEB_PROXY_AP,data:o0},!0)}WebSocketQuit(t0,e0){const n0=this.baseInfoMap.get(t0);if(!n0)return;const r0=n0.info,i0=Date.now(),o0=cb(cb(cb({},r0),e0),{},{elapse:i0-n0.startTime,lts:i0});this.send({type:Rb.WEBSOCKET_QUIT,data:o0},!0)}async sendCustomReportMessage(t0,e0){if(this.customReportCount+=e0.length,this.customReportCount>XA("CUSTOM_REPORT_LIMIT"))throw new Cy(Ry.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n0=Date.now(),r0=e0.map(i0=>({type:Rb.USER_ANALYTICS,data:cb(cb({sid:t0},i0),{},{lts:n0})}));try{XA("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r0):await this.postDataToStatsCollector(r0)}catch(i0){throw fb.error("send custom report message failed",i0.toString()),new Cy(Ry.CUSTOM_REPORT_SEND_FAILED,i0.message)}}sendApiInvoke(t0){const e0=XA("NOT_REPORT_EVENT");if(t0.tag&&Dn(e0)&&Dn(e0).call(e0,t0.tag))return!1;if(t0.sid===null)return this.apiInvokeUploadPendingItems.push(t0),!1;const n0=this.baseInfoMap.get(t0.sid);if(!n0)return this.apiInvokeUploadPendingItems.push(t0),!1;const{cname:r0,uid:i0,cid:o0}=n0.info;let s0;if(t0.lts=t0.lts||Date.now(),t0.error)if(t0.error instanceof Cy){const{code:c0,message:u0}=t0.error;s0=c0||u0||t0.error.toString()}else s0=t0.error.toString();const a0={invokeId:t0.invokeId,sid:t0.sid,cname:r0,cid:o0,uid:i0,lts:t0.lts,success:t0.success,elapse:t0.lts-n0.startTime,execElapse:t0.lts-t0.apiInvokeTime,apiName:t0.name,options:t0.options?JSON.stringify(t0.options):void 0,execStates:t0.states?JSON.stringify(t0.states):void 0,execResult:t0.result?JSON.stringify(t0.result):void 0,errorCode:t0.error?s0:void 0,errorMsg:t0.error?JSON.stringify(t0.error):void 0};return this.send({type:Rb.API_INVOKE,data:a0},!1),!0}addSid(t0){this.sids.add(t0)}removeSid(t0){this.sids.delete(t0)}appendSessionId(){const t0=this.apiInvokeUploadPendingItems;if(t0.length===0)return;const e0=Array.from(this.sids).find(n0=>n0!==null);e0&&t0.forEach(n0=>{n0&&(n0.sid=e0,this.sendApiInvoke(Object.assign({},n0)))}),t0.length=0}send(t0,e0){if(e0)return this.keyEventUploadPendingItems.push(t0),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t0),this.normalEventUploadPendingItems.length>XA("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t0,e0){const n0=[],r0=[];for(;t0.length;){const o0=t0.shift();n0.length<20?n0.push(o0):r0.push(o0)}t0.push(...r0);for(const o0 of[...n0]){var i0;this.ltsList.indexOf(o0.data.lts)!==-1?(o0.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o0.data.lts)):(this.ltsList.push(o0.data.lts),aE(i0=this.ltsList).call(i0,(s0,a0)=>s0-a0))}return e0||(this.lastSendNormalEventTime=Date.now()),XA("ENABLE_EVENT_REPORT")&&n0.length&&(XA("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n0):this.postDataToStatsCollector(n0)).catch((o0=>s0=>{XA("EVENT_REPORT_RETRY")&&(e0?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o0):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o0),this.normalEventUploadPendingItems.length>XA("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-XA("NORMAL_EVENT_QUEUE_CAPACITY")),fb.warning("report: drop normal events"))))})(n0)),t0}async postDataToStatsCollector2(t0){iA.networkState===Xy.OFFLINE&&await Gh.race([iA.onlineWaiter,mA(2*PA.maxRetryTimeout)]);const e0=i0=>{let o0=new Uint8Array;return i0.forEach(s0=>{const a0=ky(JSON.stringify(s0.data)),c0=new ArrayBuffer(5),u0=(d0=>{let h0=0;return Object.entries(Rb).forEach(p0=>{let[m0,f0]=p0;f0===d0.type&&(h0=Cb[m0])}),h0})(s0),l0=new DataView(c0);l0.setUint16(0,a0.byteLength,!0),l0.setUint8(2,255&u0),l0.setUint8(3,u0>>>8&255),l0.setUint8(4,u0>>>16&255),o0=My(o0,new Uint8Array(c0)),o0=My(o0,a0)}),o0},n0="event";let r0=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n0):"https://".concat(XA("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n0);for(let i0=0;i0<2;i0+=1){i0===1&&(r0=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n0):"https://".concat(XA("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n0));try{await FA(r0,{timeout:1e4,data:e0(t0),headers:cb(cb({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(o0){if(i0===1)throw o0;continue}return}}async postDataToStatsCollector(t0){let e0=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n0={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t0.map(o0=>JSON.stringify(o0)),vid:(o0=>{const s0=o0&&o0.data.sid&&this.baseInfoMap.get(o0.data.sid);return s0&&s0.info.vid&&+s0.info.vid||0})(t0[0])};iA.networkState===Xy.OFFLINE&&await Gh.race([iA.onlineWaiter,mA(2*PA.maxRetryTimeout)]);const r0=e0?"/events/proto-raws":"/events/messages";let i0=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA("EVENT_REPORT_DOMAIN"),"&p=").concat(XA("STATS_COLLECTOR_PORT"),"&d=").concat(r0):"https://".concat(XA("EVENT_REPORT_DOMAIN"),":").concat(XA("STATS_COLLECTOR_PORT")).concat(r0));for(let o0=0;o0<2;o0+=1){o0===1&&(i0=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(XA("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(XA("STATS_COLLECTOR_PORT"),"&d=").concat(r0):"https://".concat(XA("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(XA("STATS_COLLECTOR_PORT")).concat(r0)));try{e0?await BA(i0,{timeout:1e4,data:n0}):await FA(i0,{timeout:1e4,data:n0})}catch(s0){if(o0===1)throw s0;continue}return}}createBaseInfo(t0,e0){const n0=Object.assign({},Sb);return n0.sid=t0,this.baseInfoMap.set(t0,{info:n0,startTime:e0}),n0}reportResourceTiming(t0,e0){const n0=performance.getEntriesByName(t0),r0=n0[n0.length-1];r0&&this.reportApiInvoke(e0,{name:"Client.resourceTiming",options:r0,tag:jy.TRACER}).onSuccess()}};db.on("REPORT_LOG_UPLOAD",t0=>{t0.networkState=iA.networkState,vb.reportApiInvoke(null,{name:"logUploadError",options:t0,tag:jy.TRACER}).onSuccess("logUploadError")});class yb extends Cy{constructor(e0){super(e0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),sb(this,"name","AgoraRTCException")}print(){let e0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e0,fb)}throw(){super.throw(fb)}}const Ab=["CHINA","GLOBAL"],bb=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],wb=[];function Ob(t0,e0){return!!e0&&wb.some(n0=>n0.uid===t0&&n0.channelName===e0)}var Nb=nT.forEach,Db=Bn("forEach")?[].forEach:function(t0){return Nb(this,t0,arguments.length>1?arguments[1]:void 0)};wi({target:"Array",proto:!0,forced:[].forEach!=Db},{forEach:Db});var Pb=Xi("Array").forEach,Lb=pn,kb=Ze,Mb=l,Ub=Pb,xb=Array.prototype,Vb={DOMTokenList:!0,NodeList:!0},Fb=function(t0){var e0=t0.forEach;return t0===xb||Mb(xb,t0)&&e0===xb.forEach||kb(Vb,Lb(t0))?Ub:e0},Bb=i(Fb),jb=Je,Gb=eo;wi({target:"Object",stat:!0,forced:n(function(){Gb(1)})},{keys:function(t0){return Gb(jb(t0))}});var Wb=i(ie.Object.keys),Hb=i(zn),Kb=wi,Yb=om,qb=d([].reverse),zb=[1,2];Kb({target:"Array",proto:!0,forced:String(zb)===String(zb.reverse())},{reverse:function(){return Yb(this)&&(this.length=this.length),qb(this)}});var Jb=Xi("Array").reverse,Xb=l,Qb=Jb,Zb=Array.prototype,$b=function(t0){var e0=t0.reverse;return t0===Zb||Xb(Zb,t0)&&e0===Zb.reverse?Qb:e0},ew=$b,tw=i(ew),iw=wi,nw=om,rw=jc,ow=te,sw=xi,aw=Gi,cw=Z,dw=E_,lw=ht,uw=Xc,hw=mm("slice"),pw=lw("species"),_w=Array,Ew=Math.max;iw({target:"Array",proto:!0,forced:!hw},{slice:function(t0,e0){var n0,r0,i0,o0=cw(this),s0=aw(o0),a0=sw(t0,s0),c0=sw(e0===void 0?s0:e0,s0);if(nw(o0)&&(n0=o0.constructor,(rw(n0)&&(n0===_w||nw(n0.prototype))||ow(n0)&&(n0=n0[pw])===null)&&(n0=void 0),n0===_w||n0===void 0))return uw(o0,a0,c0);for(r0=new(n0===void 0?_w:n0)(Ew(c0-a0,0)),i0=0;a0<c0;a0++,i0++)a0 in o0&&dw(r0,i0,o0[a0]);return r0.length=i0,r0}});var fw=Xi("Array").slice,mw=l,Tw=fw,Sw=Array.prototype,gw=function(t0){var e0=t0.slice;return t0===Sw||mw(Sw,t0)&&e0===Sw.slice?Tw:e0},Rw=i(gw);function Cw(t0,e0,n0,r0,i0){var o0,s0,a0,c0={};return Bb(o0=Wb(r0)).call(o0,function(u0){c0[u0]=r0[u0]}),c0.enumerable=!!c0.enumerable,c0.configurable=!!c0.configurable,("value"in c0||c0.initializer)&&(c0.writable=!0),c0=Hb(s0=tw(a0=Rw(n0).call(n0)).call(a0)).call(s0,function(u0,l0){return l0(t0,e0,u0)||u0},c0),i0&&c0.initializer!==void 0&&(c0.value=c0.initializer?c0.initializer.call(i0):void 0,c0.initializer=void 0),c0.initializer===void 0&&(nm(t0,e0,c0),c0=null),c0}let Iw=function(t0){return t0.L1T1="L1T1",t0.L1T2="L1T2",t0.L1T3="L1T3",t0.L1T3_KEY="L1T3_KEY",t0.L2T1_KEY="L2T1_KEY",t0.L2T2_KEY="L2T2_KEY",t0.L2T3_KEY="L2T3_KEY",t0.L3T1_KEY="L3T1_KEY",t0.L3T2_KEY="L3T2_KEY",t0.L3T3_KEY="L3T3_KEY",t0}({}),vw=function(t0){return t0.CERTIFICATE="certificate",t0.CODEC="codec",t0.CANDIDATE_PAIR="candidate-pair",t0.LOCAL_CANDIDATE="local-candidate",t0.REMOTE_CANDIDATE="remote-candidate",t0.INBOUND="inbound-rtp",t0.TRACK="track",t0.OUTBOUND="outbound-rtp",t0.PC="peer-connection",t0.REMOTE_INBOUND="remote-inbound-rtp",t0.REMOTE_OUTBOUND="remote-outbound-rtp",t0.TRANSPORT="transport",t0.CSRC="csrc",t0.DATA_CHANNEL="data-channel",t0.STREAM="stream",t0.SENDER="sender",t0.RECEIVER="receiver",t0}({}),yw=function(t0){return t0[t0.ACCESS_POINT=101]="ACCESS_POINT",t0[t0.UNILBS=201]="UNILBS",t0[t0.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t0}({}),Aw=function(t0){return t0[t0.IIIEGAL_APPID=1]="IIIEGAL_APPID",t0[t0.IIIEGAL_UID=2]="IIIEGAL_UID",t0[t0.INTERNAL_ERROR=3]="INTERNAL_ERROR",t0}({}),bw=function(t0){return t0[t0.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t0[t0.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t0[t0.INTERNAL_ERROR=8]="INTERNAL_ERROR",t0[t0.NO_AUTHORIZED=9]="NO_AUTHORIZED",t0[t0.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t0[t0.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t0[t0.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t0[t0.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t0[t0.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t0[t0.USER_OVERLOAD=16]="USER_OVERLOAD",t0[t0.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t0[t0.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t0}({}),ww=function(t0){return t0[t0.NO_FLAG_SET=100]="NO_FLAG_SET",t0[t0.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t0[t0.INVALID_FALG_SET=102]="INVALID_FALG_SET",t0[t0.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t0[t0.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t0[t0.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t0[t0.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t0[t0.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t0[t0.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t0[t0.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t0[t0.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t0[t0.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t0[t0.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t0[t0.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t0[t0.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t0[t0.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t0[t0.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t0[t0.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t0[t0.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t0}({}),Ow=function(t0){return t0[t0.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t0[t0.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t0[t0.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t0[t0.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t0[t0.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t0[t0.K_TICKET_INVALID=7]="K_TICKET_INVALID",t0[t0.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t0[t0.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t0[t0.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t0[t0.K_UID_BANNED=14]="K_UID_BANNED",t0[t0.K_IP_BANNED=15]="K_IP_BANNED",t0[t0.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t0[t0.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t0[t0.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t0[t0.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t0[t0.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t0[t0.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t0[t0.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t0[t0.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t0[t0.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t0[t0.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t0[t0.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t0[t0.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t0[t0.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t0[t0.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t0[t0.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t0[t0.ERR_INVALID_UID=117]="ERR_INVALID_UID",t0[t0.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t0[t0.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t0[t0.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t0[t0.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t0[t0.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t0[t0.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t0[t0.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t0[t0.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t0[t0.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t0[t0.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t0[t0.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t0[t0.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t0[t0.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t0[t0.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t0[t0.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t0[t0.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t0[t0.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t0[t0.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t0[t0.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t0[t0.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t0[t0.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t0[t0.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t0[t0.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t0[t0.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t0[t0.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t0[t0.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t0[t0.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t0[t0.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t0[t0.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t0[t0.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t0[t0.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t0[t0.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t0[t0.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t0[t0.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t0[t0.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t0[t0.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t0[t0.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t0}({}),Nw=function(t0){return t0.CONNECTING="connecting",t0.CONNECTED="connected",t0.RECONNECTING="reconnecting",t0.CLOSED="closed",t0}({}),Dw=function(t0){return t0.WS_CONNECTED="ws_connected",t0.WS_RECONNECTING="ws_reconnecting",t0.WS_CLOSED="ws_closed",t0.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",t0.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t0.ON_BINARY_DATA="on_binary_data",t0.REQUEST_RECOVER="request_recover",t0.REQUEST_JOIN_INFO="request_join_info",t0.REQUEST_REJOIN_INFO="req_rejoin_info",t0.IS_P2P_DISCONNECTED="is_p2p_dis",t0.DISCONNECT_P2P="dis_p2p",t0.ABORT_P2P_EXECUTION="abort_p2p_execution",t0.NEED_RENEW_SESSION="need-sid",t0.REPORT_JOIN_GATEWAY="report_join_gateway",t0.REQUEST_TIMEOUT="request_timeout",t0.REQUEST_SUCCESS="request_success",t0.JOIN_RESPONSE="join_response",t0.PRE_CONNECT_PC="pre_connect_pc",t0.P2P_CONNECTION="p2p_connection",t0.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t0.P2P_SUBSCRIBE="p2p_subscribe",t0.P2P_UNSUBSCRIBE="p2p_unsubscribe",t0.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t0.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t0.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t0.RECOVER_NOTIFICATION="recover_notification",t0}({}),Pw=function(t0){return t0.PING="ping",t0.PING_BACK="ping_back",t0.JOIN="join_v3",t0.REJOIN="rejoin_v3",t0.LEAVE="leave",t0.SET_CLIENT_ROLE="set_client_role",t0.PUBLISH="publish",t0.PUBLISH_DATASTREAM="publish_datastream",t0.UNPUBLISH="unpublish",t0.UNPUBLISH_DATASTREAM="unpublish_datastream",t0.SUBSCRIBE="subscribe",t0.PRE_SUBSCRIBE="pre_subscribe",t0.SUBSCRIBE_DATASTREAM="subscribe_datastream",t0.SUBSCRIBE_STREAMS="subscribe_streams",t0.UNSUBSCRIBE="unsubscribe",t0.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t0.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t0.SUBSCRIBE_CHANGE="subscribe_change",t0.TRAFFIC_STATS="traffic_stats",t0.RENEW_TOKEN="renew_token",t0.SWITCH_VIDEO_STREAM="switch_video_stream",t0.DEFAULT_VIDEO_STREAM="default_video_stream",t0.SET_FALLBACK_OPTION="set_fallback_option",t0.GATEWAY_INFO="gateway_info",t0.CONTROL="control",t0.SEND_METADATA="send_metadata",t0.DATA_STREAM="data_stream",t0.PICK_SVC_LAYER="pick_svc_layer",t0.RESTART_ICE="restart_ice",t0.CONNECT_PC="connect_pc",t0.SET_VIDEO_PROFILE="set_video_profile",t0.SET_PARAMETER="set_parameter",t0.SET_RTM2_FLAG="set_rtm2_flag",t0}({}),Lw=function(t0){return t0.WRTC_STATS="wrtc_stats",t0.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t0.DENOISER_STATS="denoiser_stats",t0.EXTENSION_USAGE_STATS="extension_usage_stats",t0}({}),kw=function(t0){return t0.ON_USER_ONLINE="on_user_online",t0.ON_USER_OFFLINE="on_user_offline",t0.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t0.ON_PUBLISH_STREAM="on_publish_stream",t0.ON_UPLINK_STATS="on_uplink_stats",t0.ON_P2P_LOST="on_p2p_lost",t0.ON_REMOVE_STREAM="on_remove_stream",t0.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t0.ON_ADD_VIDEO_STREAM="on_add_video_stream",t0.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t0.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t0.ON_USER_BANNED="on_user_banned",t0.ON_USER_LICENSE_BANNED="on_user_license_banned",t0.ON_NOTIFICATION="on_notification",t0.ON_CRYPT_ERROR="on_crypt_error",t0.MUTE_AUDIO="mute_audio",t0.MUTE_VIDEO="mute_video",t0.UNMUTE_AUDIO="unmute_audio",t0.UNMUTE_VIDEO="unmute_video",t0.ON_P2P_OK="on_p2p_ok",t0.RECEIVE_METADATA="receive_metadata",t0.ON_DATA_STREAM="on_data_stream",t0.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t0.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t0.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t0.ENABLE_LOCAL_VIDEO="enable_local_video",t0.DISABLE_LOCAL_VIDEO="disable_local_video",t0.ENABLE_LOCAL_AUDIO="enable_local_audio",t0.DISABLE_LOCAL_AUDIO="disable_local_audio",t0.ON_PUBLISHED_USER_LIST="on_published_user_list",t0}({}),Mw=function(t0){return t0.SEND_ONLY="SEND_ONLY",t0.RECEIVE_ONLY="RECEIVE_ONLY",t0}({}),Uw=function(t0){return t0.CONNECTED="websocket:connected",t0.RECONNECTING="websocket:reconnecting",t0.WILL_RECONNECT="websocket:will_reconnect",t0.CLOSED="websocket:closed",t0.FAILED="websocket:failed",t0.ON_MESSAGE="websocket:on_message",t0.REQUEST_NEW_URLS="websocket:request_new_urls",t0.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",t0.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t0.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t0}({});function xw(t0){if(typeof t0!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t0))throw fb.error("Invalid Channel Name ".concat(t0)),new yb(Ry.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Vw(t0){if(!function(e0){return typeof e0=="number"&&Math.floor(e0)===e0&&0<=e0&&e0<=4294967295}(t0)&&!Ny(t0,1,255))throw new yb(Ry.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof t0=="string"&&fb.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Fw=function(t0){return t0.TRANSCODE="mix_streaming",t0.RAW="raw_streaming",t0}({});const Bw={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},jw={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Gw(t0,e0){by(t0.url,"".concat(e0,".url"),1,1e3,!1),Oy(t0.x)||yy(t0.x,"".concat(e0,".x"),0,1e4),Oy(t0.y)||yy(t0.y,"".concat(e0,".y"),0,1e4),Oy(t0.width)||yy(t0.width,"".concat(e0,".width"),0,1e4),Oy(t0.height)||yy(t0.height,"".concat(e0,".height"),0,1e4),Oy(t0.zOrder)||yy(t0.zOrder,"".concat(e0,".zOrder"),0,255),Oy(t0.alpha)||yy(t0.alpha,"".concat(e0,".alpha"),0,1,!1)}const Ww={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Hw=function(t0){return t0.WARNING="@live_uap-warning",t0.ERROR="@line_uap-error",t0.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t0.WORKER_STATUS="@live_uap-worker-status",t0.REQUEST_NEW_ADDRESS="@live_uap-request-address",t0}({}),Kw=function(t0){return t0.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t0}({}),Yw=function(t0){return t0[t0.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t0[t0.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t0[t0.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t0[t0.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t0[t0.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t0[t0.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t0[t0.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t0[t0.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t0[t0.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t0[t0.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t0[t0.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t0[t0.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t0[t0.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t0[t0.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t0[t0.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t0[t0.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t0[t0.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t0[t0.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t0[t0.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t0[t0.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t0[t0.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t0}({});function qw(t0){if(!t0.channelName)throw new yb(Ry.INVALID_PARAMS,"invalid channelName in info");if(typeof t0.uid!="number")throw new yb(Ry.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t0.token&&by(t0.token,"info.token",1,2047),Vw(t0.uid),xw(t0.channelName),!0}let zw=function(t0){return t0[t0.SetSdkProfile=0]="SetSdkProfile",t0[t0.SetSourceChannel=1]="SetSourceChannel",t0[t0.SetSourceUserId=2]="SetSourceUserId",t0[t0.SetDestChannel=3]="SetDestChannel",t0[t0.StartPacketTransfer=4]="StartPacketTransfer",t0[t0.StopPacketTransfer=5]="StopPacketTransfer",t0[t0.UpdateDestChannel=6]="UpdateDestChannel",t0[t0.Reconnect=7]="Reconnect",t0[t0.SetVideoProfile=8]="SetVideoProfile",t0}({}),Jw=function(t0){return t0.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t0.NETWORK_CONNECTED="NETWORK_CONNECTED",t0.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t0.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t0.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t0.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t0.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t0.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t0.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t0.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t0}({}),Xw=function(t0){return t0.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t0.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t0.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t0.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t0}({}),Qw=function(t0){return t0.RELAY_OK="RELAY_OK",t0.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t0.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t0.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t0}({}),Zw=function(t0){return t0.High="high",t0.Low="low",t0.Audio="audio",t0.Screen="screen",t0.ScreenLow="screen_low",t0}({}),$w=function(t0){return t0.DISCONNECT="disconnect",t0.CONNECTION_STATE_CHANGE="connection-state-change",t0.NETWORK_QUALITY="network-quality",t0.STREAM_TYPE_CHANGE="stream-type-change",t0.IS_P2P_DISCONNECTED="is-p2p-dis",t0.DISCONNECT_P2P="dis-p2p",t0.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t0.NEED_RENEW_SESSION="need-sid",t0.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t0.JOIN_RESPONSE="join-response",t0.RESET_CONNECTION_EVENTS="reset-connection-events",t0.PRE_CONNECT_PC="pre-connect_pc",t0}({}),eO=function(t0){return t0.P2P_DISCONNECTED="P2P_DISCONNECTED",t0.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t0.TIMEOUT="TIMEOUT",t0.UNKNOWN_REASON="UNKNOWN_REASON",t0}({}),tO=function(t0){return t0[t0.Nothing=0]="Nothing",t0[t0.Audio=1]="Audio",t0[t0.LwoVideo=2]="LwoVideo",t0[t0.Video=4]="Video",t0[t0.Data=8]="Data",t0[t0.DataStream0=256]="DataStream0",t0[t0.DataStream1=512]="DataStream1",t0[t0.DataStream2=1024]="DataStream2",t0[t0.DataStream3=2048]="DataStream3",t0[t0.DataStream4=4096]="DataStream4",t0[t0.DataStream5=8192]="DataStream5",t0[t0.DataStream6=16384]="DataStream6",t0[t0.DataStream7=32768]="DataStream7",t0}({}),iO=function(t0){return t0.CHINA="CHINA",t0.ASIA="ASIA",t0.NORTH_AMERICA="NORTH_AMERICA",t0.EUROPE="EUROPE",t0.JAPAN="JAPAN",t0.INDIA="INDIA",t0.KOREA="KOREA",t0.HKMC="HKMC",t0.US="US",t0.OCEANIA="OCEANIA",t0.SOUTH_AMERICA="SOUTH_AMERICA",t0.AFRICA="AFRICA",t0.OVERSEA="OVERSEA",t0.GLOBAL="GLOBAL",t0.EXTENSIONS="EXTENSIONS",t0}({});const nO=[iO.AFRICA,iO.ASIA,iO.CHINA,iO.EUROPE,iO.GLOBAL,iO.INDIA,iO.JAPAN,iO.NORTH_AMERICA,iO.OCEANIA,iO.OVERSEA,iO.SOUTH_AMERICA];let rO=function(t0){return t0.CHINA="CN",t0.ASIA="AS",t0.NORTH_AMERICA="NA",t0.EUROPE="EU",t0.JAPAN="JP",t0.INDIA="IN",t0.KOREA="KR",t0.HKMC="HK",t0.US="US",t0.OCEANIA="OC",t0.SOUTH_AMERICA="SA",t0.AFRICA="AF",t0.OVERSEA="OVERSEA",t0.GLOBAL="GLOBAL",t0.EXTENSIONS="GLOBAL",t0}({});const oO={CHINA:{},ASIA:{CODE:rO.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:rO.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:rO.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:rO.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:rO.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:rO.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:rO.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:rO.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:rO.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:rO.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:rO.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:rO.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:rO.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};WA&&(oO.CHINA={CODE:rO.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let sO=function(t0){return t0.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t0}({});class aO extends xy{constructor(e0,n0){super(),Fg(this,"onICEConnectionStateChange",void 0),Fg(this,"onConnectionStateChange",void 0),Fg(this,"onDTLSTransportStateChange",void 0),Fg(this,"onDTLSTransportError",void 0),Fg(this,"onICETransportStateChange",void 0),Fg(this,"onFirstAudioReceived",void 0),Fg(this,"onFirstVideoReceived",void 0),Fg(this,"onFirstAudioDecoded",void 0),Fg(this,"onFirstVideoDecoded",void 0),Fg(this,"onFirstVideoDecodedTimeout",void 0),Fg(this,"onSelectedLocalCandidateChanged",void 0),Fg(this,"onSelectedRemoteCandidateChanged",void 0),Fg(this,"getLocalVideoStats",void 0)}}class cO extends aO{constructor(e0,n0){super(e0,n0),Fg(this,"establishPromise",void 0)}}let dO=function(t0){return t0.VIDEO="video",t0.AUDIO="audio",t0}({}),lO=function(t0){return t0[t0.UDP=0]="UDP",t0[t0.TCP=1]="TCP",t0[t0.RELAY=2]="RELAY",t0}({}),uO=function(t0){return t0[t0.FIRST_CONNECTION=0]="FIRST_CONNECTION",t0[t0.TCP_RESTART=1]="TCP_RESTART",t0[t0.RELAY_RESTART=2]="RELAY_RESTART",t0[t0.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t0[t0.OLD_RESTART=11]="OLD_RESTART",t0[t0.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t0}({}),hO=function(t0){return t0.LocalVideoTrack="videoTrack",t0.LocalAudioTrack="audioTrack",t0.LocalVideoLowTrack="videoLowTrack",t0}({}),pO=function(t0){return t0.New="new",t0.Connected="connected",t0.Reconnecting="reconnecting",t0.Disconnected="disconnected",t0}({}),_O=function(t0){return t0.StateChange="stateChange",t0.IceConnectionStateChange="iceConnectionStateChange",t0.RequestMuteLocal="requestMuteLocal",t0.RequestUnmuteLocal="requestUnmuteLocal",t0.RequestRePublish="requestRePublish",t0.RequestRePublishDataChannel="requestRePublishDataChannel",t0.RequestReSubscribe="requestReSubscribe",t0.RequestUploadStats="requestUploadStats",t0.RequestUpload="requestUpload",t0.MediaReconnectStart="MediaReconnectStart",t0.MediaReconnectEnd="MediaReconnectEnd",t0.NeedSignalRTT="NeedSignalRTT",t0.RequestRestartICE="RequestRestartIce",t0.PeerConnectionStateChange="PeerConnectionStateChange",t0.RequestReconnect="RequestReconnect",t0.RequestReconnectPC="RequestReconnectPC",t0.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t0.P2PLost="P2PLost",t0.UpdateVideoEncoder="UpdateVideoEncoder",t0.ConnectionTypeChange="ConnectionTypeChange",t0.RequestLowStreamParameter="RequestLowStreamParameter",t0.QueryClientConnectionState="QueryClientConnectionState",t0.LocalCandidate="LocalCandidate",t0.RequestP2PMuteLocal="requestP2PMuteLocal",t0.RequestP2PUnPublish="RequestP2PUnPublish",t0.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t0.RequestP2PMuteRemote="RequestP2PMuteRemote",t0.RequestP2PRestartICE="RequestP2PRestartICE",t0}({}),EO=function(t0){return t0.CONNECTING="CONNECTING",t0.RECONNECTING="RECONNECTING",t0.CONNECTED="CONNECTED",t0.CLOSED="CLOSED",t0}({}),fO=function(t0){return t0[t0.CONNECT_AP=0]="CONNECT_AP",t0[t0.AP_CONNECTED=1]="AP_CONNECTED",t0[t0.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t0[t0.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t0[t0.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t0[t0.CONNECT_WORKER=5]="CONNECT_WORKER",t0[t0.WORKER_CONNECTED=6]="WORKER_CONNECTED",t0[t0.CLOSED=7]="CLOSED",t0}({}),mO=function(t0){return t0.CONNECTION_STATE_CHANGE="connection-state-change",t0.STATE_CHANGE="state-change",t0.INSPECT_RESULT="inspect-result",t0.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t0.REQUEST_NEW_WORKER_URL="request-new-worker-url",t0}({}),TO=function(t0){return t0.CONNECTED="transmitter:connected",t0.RECONNECTING="transmitter:reconnecting",t0.WILL_RECONNECT="transmitter:will_reconnect",t0.CLOSED="transmitter:closed",t0.FAILED="transmitter:failed",t0.ON_MESSAGE="transmitter:on_message",t0.REQUEST_NEW_URLS="transmitter:request_new_urls",t0.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",t0.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t0.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t0.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t0.FAILBACK="transmitter:failback",t0.PRE_CONNECT_PC="transmitter:pre_connect_pc",t0}({}),SO=function(t0){return t0.CAMERA_CHANGED="camera-changed",t0.MICROPHONE_CHANGED="microphone-changed",t0.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t0.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t0.AUTOPLAY_FAILED="autoplay-failed",t0.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t0.SECURITY_POLICY_VIOLATION="security-policy-violation",t0}({}),gO=function(t0){return t0.CONNECTING="CONNECTING",t0.RECONNECTING="RECONNECTING",t0.CONNECTED="CONNECTED",t0.CLOSED="CLOSED",t0}({}),RO=function(t0){return t0.CONNECTION_STATE_CHANGE="connection-state-change",t0.STATE_CHANGE="state-change",t0.INSPECT_RESULT="inspect-result",t0.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t0.REQUEST_NEW_WORKER_URL="request-new-worker-url",t0}({}),CO=function(t0){return t0[t0.CONNECT_AP=0]="CONNECT_AP",t0[t0.AP_CONNECTED=1]="AP_CONNECTED",t0[t0.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t0[t0.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t0[t0.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t0[t0.CONNECT_WORKER=5]="CONNECT_WORKER",t0[t0.WORKER_CONNECTED=6]="WORKER_CONNECTED",t0[t0.CLOSED=7]="CLOSED",t0}({}),IO=function(t0){return t0.CALL="call",t0.CANDIDATE="candidate",t0.PUBLISH="publish",t0.UNPUBLISH="unpublish",t0.CONTROL="control",t0.RESTART_ICE="restart_ice",t0.ACK="ack",t0.RESPONSE="response",t0.JOIN="join",t0.CHECK="check",t0}({}),vO=function(t0){return t0.ABORT="abort",t0}({}),yO=function(t0){return t0.MUTE_LOCAL_AUDIO="mute_local_audio",t0.MUTE_LOCAL_VIDEO="mute_local_video",t0.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t0.UNMUTE_LOCAL_VIDEO="unmute_local_video",t0}({}),AO=function(t0){return t0.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t0.P2P_TOKEN_CHANGED="p2p_token_changed",t0}({});const bO={[yw.ACCESS_POINT]:{[ww.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ww.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ww.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ww.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ww.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ww.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ww.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[yw.UNILBS]:{[bw.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[bw.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[bw.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[bw.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[bw.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[bw.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[bw.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[bw.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[bw.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[bw.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[bw.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[bw.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[yw.STRING_UID_ALLOCATOR]:{[Aw.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Aw.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Aw.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function wO(t0){const e0=bO[Math.floor(t0/1e4)];if(!e0)return{desc:"unknown error",retry:!1};const n0=e0[t0%1e4];if(!n0){if(Math.floor(t0/1e4)===yw.ACCESS_POINT){const r0=t0%1e4;if(r0.toString()[0]==="1")return{desc:t0.toString(),retry:!1};if(r0.toString()[0]==="2")return{desc:t0.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n0}const OO={[Ow.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ow.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ow.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ow.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ow.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ow.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ow.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ow.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ow.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ow.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ow.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ow.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ow.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ow.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ow.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ow.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ow.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ow.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ow.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ow.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ow.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ow.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ow.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ow.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ow.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ow.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ow.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ow.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ow.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ow.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ow.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ow.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ow.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ow.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ow.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ow.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ow.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ow.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ow.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ow.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ow.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ow.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ow.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ow.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ow.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ow.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ow.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ow.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ow.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ow.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ow.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ow.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ow.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ow.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ow.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ow.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ow.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ow.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ow.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ow.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ow.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ow.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ow.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function NO(t0){return OO[t0]||{desc:"UNKNOWN_ERROR_".concat(t0),action:"failed"}}function DO(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function PO(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?DO(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):DO(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}function LO(t0){return t0.every(e0=>e0.readyState===WebSocket.CLOSED||e0.readyState===WebSocket.CLOSING)}function kO(t0,e0){if(typeof t0=="string")return t0;const{proxy:n0,host:r0,port:i0}=t0;if(e0){const o0=XA("JOIN_GATEWAY_FALLBACK_PORT")||443;return o0===443?"wss://".concat(r0,"/ws/?p=").concat(Number(i0)+150):"wss://".concat(r0,":").concat(o0,"/ws/?p=").concat(Number(i0)+150)}return n0?"wss://".concat(n0,"/ws/?h=").concat(r0,"&p=").concat(i0):"wss://".concat(r0,":").concat(i0)}const MO=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,UO=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,xO=/wss:\/\/(.+):([0-9]+)\/?/,VO=/wss:\/\/(.[^\/]+)\/?/;let FO=0;class BO{constructor(e0,n0){Fg(this,"id",0),Fg(this,"store",void 0),Fg(this,"recordIndex",void 0),Fg(this,"websockets",[]),Fg(this,"try443PortDuration",2e3),Fg(this,"forceCloseWSDuration",5e3),Fg(this,"try443PortTimeout",null),Fg(this,"forceCloseTimeout",null),Fg(this,"isTry443PortFailed",!1),Fg(this,"isNormalPortFailed",!1),Fg(this,"useDoubleDomain",!1),Fg(this,"useProxy",!1),Fg(this,"startTime",Date.now()),this.id=++FO,this.try443PortDuration=XA("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e0||5e3,this.store=n0}closeAllWebsockets(){this.websockets.forEach(e0=>{e0.onopen=null,e0.onclose=null,e0.onmessage=null,e0.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e0;const n0=Date.now()-this.startTime;for(var r0=arguments.length,i0=new Array(r0),o0=0;o0<r0;o0++)i0[o0]=arguments[o0];fb.debug("[choose-best-ws ".concat((e0=this.store)===null||e0===void 0?void 0:e0.clientId," ").concat(this.id,"] ").concat(n0,"ms:"),...i0)}createWebSocket(e0,n0,r0){this.logger("createWebSocket:",e0,{isTry443Port:n0,hasTimeoutDetection:r0});const i0=XA("GATEWAY_DOMAINS"),o0=Date.now(),s0=[],a0=i0.find(l0=>{var d0;return Dn(d0=e0.host).call(d0,l0)});a0||(this.useDoubleDomain=!1);const c0=[];if(this.useDoubleDomain)i0.forEach(l0=>{c0.push(kO(PO(PO({},e0),{},{host:e0.host.replace(a0,l0)}),n0))});else{const l0=PO({},e0);if(n0&&a0){const d0=i0.find(h0=>h0!==a0);d0&&(l0.host=l0.host.replace(a0,d0))}c0.push(kO(l0,n0))}try{c0.forEach(l0=>{const d0=new WebSocket(l0);d0.binaryType="arraybuffer",s0.push(d0),this.logger("ws is connecting:",d0.url)})}catch(l0){if(this.logger("ws create failed"),s0.forEach(d0=>d0.close()),s0.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e0,n0,r0);if(!n0&&Number(e0.port)!==443)return this.createWebSocket(e0,!0,r0);throw new yb(Ry.WS_ERR,"init websocket failed! Error: ".concat(l0.toString()))}const u0=Mv();return this.store&&this.store.recordJoinChannelService({urls:s0.map(l0=>l0.url),service:"gateway"},this.recordIndex),s0.forEach(l0=>{l0.onopen=()=>{this.logger("onopen: ws ".concat(l0.url," open cost ").concat(Date.now()-o0,"ms")),this.websockets.forEach(d0=>{d0!==l0&&(d0.onopen=null,d0.onclose=null,d0.onmessage=null,d0.close(),this.logger("close backup websocket: ".concat(d0.url)))}),this.websockets.length=0,u0.resolve(l0)},l0.onclose=d0=>{this.logger("onclose: ws ".concat(l0.url," closed cost ").concat(Date.now()-o0,"ms state: ").concat(l0.readyState)),n0?this.isTry443PortFailed=LO(s0):this.isNormalPortFailed=LO(s0),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(n0&&this.isTry443PortFailed||!n0&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(d0.reason)),u0.reject({code:d0.code,reason:eO.A_ROUND_WS_FAILED}))},l0.onmessage=d0=>this.logger("".concat(l0.url," onmessage: ").concat(d0.data))}),this.websockets.push(...s0),r0||(()=>{const l0=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",u0.isResolved),this.websockets.forEach(d0=>d0.readyState!==WebSocket.OPEN&&d0.close())};if(n0||this.useProxy)return this.logger("add 5s timeout at ".concat(n0?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(l0,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",u0.isResolved),u0.isResolved)return l0();Hv().os===Fv.MAC_OS&&Zv()&&l0(),this.createWebSocket(e0,!0,!0).then(d0=>u0.resolve(d0)).catch(d0=>{this.isNormalPortFailed&&u0.reject(d0),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(l0,this.forceCloseWSDuration)},this.try443PortDuration)})(),u0.promise}chooseBestWebsocket(e0,n0,r0,i0){return this.useDoubleDomain=!!n0,typeof e0=="string"&&(e0=function(o0){let s0,a0,c0;return[,s0,a0,c0]=o0.match(MO)||[],s0||([,a0,c0]=o0.match(UO)||[]),a0&&c0||([,a0,c0]=o0.match(xO)||[]),a0&&c0||([,a0]=o0.match(VO)||[]),a0||fb.warning("un-destructible url: ",o0),{proxy:s0,host:a0,port:c0||"443"}}(e0)),this.recordIndex=i0,this.useProxy=!!e0.proxy,r0&&this.useProxy&&(fb.warn("cannot use 443 only when use proxy"),r0=!1),this.createWebSocket(e0,!!r0,!1).finally(()=>this.clearTimeout())}}function jO(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}class GO extends xy{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e0){var n0;Dn(n0=["tryNext","recover"]).call(n0,e0)&&this.resetReconnectCount(e0),this._reconnectMode=e0}get state(){return this._state}set state(e0){e0!==this._state&&(this._state=e0,this._state==="reconnecting"?this.emit(Uw.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Uw.CONNECTED):this._state==="closed"?this.emit(Uw.CLOSED):this._state==="failed"&&this.emit(Uw.FAILED))}resetReconnectCount(e0){fb.debug("websocket reset reconnect count, reason: "+e0),this.reconnectCount=0}constructor(e0,n0){let r0=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i0=arguments.length>3&&arguments[3]!==void 0&&arguments[3],o0=arguments.length>4&&arguments[4]!==void 0&&arguments[4],s0=arguments.length>5?arguments[5]:void 0;super(),Fg(this,"connectionID",0),Fg(this,"currentURLIndex",0),Fg(this,"urls",[]),Fg(this,"_reconnectMode","tryNext"),Fg(this,"reconnectReason",void 0),Fg(this,"_initMutex",new NA("websocket")),Fg(this,"name",void 0),Fg(this,"_state","closed"),Fg(this,"reconnectInterrupter",void 0),Fg(this,"websocket",void 0),Fg(this,"retryConfig",void 0),Fg(this,"reconnectCount",0),Fg(this,"forceCloseTimeout",5e3),Fg(this,"onlineReconnectListener",void 0),Fg(this,"useCompress",void 0),Fg(this,"tryDoubleDomain",!1),Fg(this,"use443PortOnly",!1),Fg(this,"wsInflateLength",0),Fg(this,"wsDeflateLength",0),Fg(this,"closeEstablishingWs",()=>{}),Fg(this,"store",void 0),Fg(this,"joinGatewayRecordIndex",void 0),this.store=s0,this.name=e0,this.retryConfig=function(d0){for(var h0=1;h0<arguments.length;h0++){var p0=arguments[h0]!=null?arguments[h0]:{};h0%2?jO(Object(p0),!0).forEach(function(m0){Fg(d0,m0,p0[m0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(d0,Object.getOwnPropertyDescriptors(p0)):jO(Object(p0)).forEach(function(m0){Object.defineProperty(d0,m0,Object.getOwnPropertyDescriptor(p0,m0))})}return d0}({},n0),this.useCompress=r0,this.tryDoubleDomain=i0,this.use443PortOnly=o0;const{timeout:a0,timeoutFactor:c0}=n0,u0=Math.max(300,Math.floor(3*a0/5)),l0=Math.max(1.2,Math.floor(8*c0)/10);Xy.ONLINE&&(this.retryConfig.timeout=u0,this.retryConfig.timeoutFactor=l0),iA.on(Qy.NETWORK_STATE_CHANGE,(d0,h0)=>{d0!==h0&&(this.resetReconnectCount("network state change: ".concat(h0," -> ").concat(d0)),d0===Xy.ONLINE?(this.retryConfig.timeout=u0,this.retryConfig.timeoutFactor=l0):(this.retryConfig.timeout=a0,this.retryConfig.timeoutFactor=c0))})}getConnection(){return this.websocket||void 0}async init(e0){let n0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r0=await this._initMutex.lock();this.forceCloseTimeout=n0,this.urls=e0,this.state="connecting";try{const i0=Mv(),o0=this.urls[this.currentURLIndex];XA("ENABLE_PREALLOC_PC")&&this.emit(TO.PRE_CONNECT_PC),this.createWebSocketConnection(o0).then(i0.resolve).catch(i0.reject),this.once(Uw.CLOSED,()=>{i0.reject(new Cy(Ry.WS_DISCONNECT))}),this.once(Uw.CONNECTED,i0.resolve),await i0.promise}catch{}finally{r0()}}close(e0,n0){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r0=this.websocket;n0?setTimeout(()=>r0.close(),500):r0.close(),this.websocket=void 0}this.state=e0?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e0,n0){if(!this.websocket)return void fb.warning("[".concat(this.name,"] can not reconnect, no websocket"));e0!==void 0&&(this.reconnectMode=e0),fb.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n0)]},this.joinGatewayRecordIndex);const r0=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r0&&r0.bind(this.websocket)({code:9999,reason:n0})}sendMessage(e0){let n0=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Cy(Ry.WS_ABORT,"websocket is not ready");try{n0||(e0=JSON.stringify(e0)),this.websocket.send(e0)}catch(r0){throw new Cy(Ry.WS_ERR,"send websocket message error"+r0.toString())}}setWsInflateData(e0){this.wsDeflateLength=this.wsDeflateLength+e0.originLength,this.wsInflateLength=this.wsInflateLength+e0.compressedLength}getWsInflateData(){const e0=this.wsInflateLength,n0=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e0,wsDeflateLength:n0}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e0){var n0;const r0=Mv();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i0=l0=>{var d0;(d0=this.store)===null||d0===void 0||d0.signalChannelOpen(),fb.debug("[".concat(this.name,"] websocket opened:"),l0),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r0.resolve()},o0=async l0=>{var d0;if(fb.debug("[".concat(this.name,"] websocket close ").concat((d0=this.websocket)===null||d0===void 0?void 0:d0.url,", code: ").concat(l0.code,", reason: ").concat(l0.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r0.reject(new Cy(Ry.WS_DISCONNECT,"websocket close: ".concat(l0.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=l0.reason,this.state="reconnecting");const h0=eA(this,Uw.WILL_RECONNECT,this.reconnectMode,l0.reason)||this.reconnectMode,p0=await this.reconnectWithAction(h0);if(this.state==="closed")return void fb.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!p0)return r0.reject(new Cy(Ry.WS_DISCONNECT,"websocket reconnect failed: ".concat(l0.code))),this.close(!0);r0.resolve()}},s0=l0=>{this.emit(Uw.ON_MESSAGE,l0)},a0=l0=>{fb.warn("[".concat(this.connectionID,"] ws open error ").concat(l0))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),XA("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e0=XA("GATEWAY_WSS_ADDRESS")),fb.debug("[".concat(this.name,"] start connect, url:"),e0);const c0=(n0=this.store)===null||n0===void 0?void 0:n0.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var u0;const l0=await this.chooseBestWebsocketConnection(e0);this.websocket=l0,i0&&i0(this.websocket.url),this.websocket.onclose=o0,this.websocket.onmessage=s0,this.websocket.onerror=a0,(u0=this.store)===null||u0===void 0||u0.recordJoinChannelService({endTs:Date.now(),status:"success"},c0),this.joinGatewayRecordIndex=c0}catch(l0){const d0=this.state==="closed",h0=l0 instanceof Cy,p0=h0&&l0.code===Ry.WS_ABORT,m0=h0&&l0.code===Ry.WS_ERR,f0=h0?l0.message:l0&&(l0.reason||l0.toString());fb.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(f0)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:p0?"aborted":"error",errors:[l0]},c0),d0||m0?(r0.reject(d0?new Cy(Ry.WS_DISCONNECT,"websocket is closed: ".concat(f0)):new Cy(Ry.WS_ERR,"init websocket failed: ".concat(f0))),m0&&fb.error("[".concat(this.name,"] init websocket failed: ").concat(f0))):o0&&o0(l0)}return r0.promise}async reconnectWithAction(e0){let n0=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;fb.warning("[choose-best-ws] action: =>",e0),this.onlineReconnectListener||iA.isOnline||!iA.onlineWaiter||(this.onlineReconnectListener=iA.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r0=!0;if(this.reconnectInterrupter=()=>r0=!1,n0){const s0=LA(this.reconnectCount,this.retryConfig);fb.debug("[".concat(this.name,"] wait ").concat(s0,"ms to reconnect websocket, mode: ").concat(e0)),await Gh.race([mA(s0),this.onlineReconnectListener||new Gh(()=>{})])}if(this._state==="closed"||!r0)return!1;this.reconnectCount+=1;const i0=async(s0,a0)=>{this.emit(Uw.RECONNECT_CREATE_CONNECTION,a0),await this.createWebSocketConnection(s0)};try{if(e0==="retry")this.emit(Uw.RECONNECT_WAITTING_FINISH,e0),await i0(this.urls[this.currentURLIndex],e0);else if(e0==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);fb.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Uw.RECONNECT_WAITTING_FINISH,e0),await i0(this.urls[this.currentURLIndex],e0)}else e0==="recover"&&(fb.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Uw.RECONNECT_WAITTING_FINISH,e0),this.urls=await Zy(this,Uw.REQUEST_NEW_URLS),this.currentURLIndex=0,await i0(this.urls[this.currentURLIndex],e0))}catch(s0){var o0;fb.error("[".concat(this.name,"] reconnect failed ").concat(s0&&s0.toString()));const a0=s0==null||(o0=s0.data)===null||o0===void 0?void 0:o0.desc;return Array.isArray(a0)&&Dn(a0).call(a0,"dynamic key expired")?(this.emit(Uw.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e0,n0)}return!0}}class WO extends GO{constructor(e0,n0){super(e0,n0,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e0,n0){const r0=Mv(),i0=function(s0,a0){return new BO(s0,a0)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{fb.debug("[choose-best-ws] close establishing websockets"),i0.closeAllWebsockets(),r0.reject(new Cy(Ry.WS_ABORT,"choose best websocket aborted"))};const o0=XA("GATEWAY_DOMAINS");return fb.debug("[choose-best-ws] currentDomain: ",e0,", domains: ",o0,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i0.chooseBestWebsocket(e0,this.tryDoubleDomain,this.use443PortOnly,n0).then(r0.resolve).catch(r0.reject),r0.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class HO extends GO{constructor(e0,n0){super(e0,n0,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e0,n0){return new Gh((r0,i0)=>{let o0=!1;const s0=[];this.closeEstablishingWs=()=>{fb.debug("[choose-best-ws] close establishing websockets"),s0.forEach(m0=>{m0.onclose=null,m0.onopen=null,m0.onmessage=null,m0.close()}),i0(new Cy(Ry.WS_ABORT,"choose best websocket aborted"))};const a0=XA("GATEWAY_DOMAINS");let c0;const u0=e0.indexOf("?h="),l0=a0.find(m0=>u0!==-1?Dn(e0).call(e0,m0,u0):Dn(e0).call(e0,m0));fb.debug("[choose-best-ws] currentDomain: ",l0,", domains: ",a0);let d0=!this.tryDoubleDomain||!l0;if(!d0&&l0){var h0;const m0=Date.now();try{a0.forEach(f0=>{const g0=u0===-1?e0.replace(l0,f0):e0.substr(0,u0)+e0.substr(u0).replace(l0,f0),E0=new WebSocket(g0);E0.binaryType="arraybuffer",s0.push(E0),fb.debug("[choose-best-ws] ws is connecting:",E0.url)})}catch{for(fb.debug("[choose-best-ws] ws create failed, fallback to single url"),s0.forEach(g0=>g0.close());s0.length;)s0.pop();d0=!0}(h0=this.store)===null||h0===void 0||h0.recordJoinChannelService({urls:s0.map(f0=>f0.url),service:"gateway"},n0),s0.forEach(f0=>{f0.onopen=()=>{if(o0)return;const g0=Date.now()-m0;fb.debug("[choose-best-ws] ws open cost ".concat(g0,"ms")),s0.filter(E0=>E0!==f0).forEach(E0=>{fb.debug("[choose-best-ws]close backup websocket: ".concat(E0.url)),E0.close()}),o0=!0,r0(f0)},f0.onclose=g0=>{c0=g0,!o0&&(s0.find(E0=>!(E0.readyState===WebSocket.CLOSED||E0.readyState===WebSocket.CLOSING))||(fb.debug("[choose-best-ws] all websocket is closed"),o0=!0,i0(c0)))},f0.onmessage=g0=>{fb.debug("[choose-best-ws]".concat(f0.url," onmessage: ").concat(g0.data))}}),mA(this.forceCloseTimeout).then(()=>{s0.forEach(f0=>{f0.readyState!==WebSocket.OPEN&&f0.close()})})}if(d0){var p0;let m0;fb.debug("[choose-best-ws] use single url: ",e0),(p0=this.store)===null||p0===void 0||p0.recordJoinChannelService({urls:[e0],service:"gateway"},n0);try{m0=new WebSocket(e0),s0.push(m0),m0.binaryType="arraybuffer"}catch(f0){const g0=new Cy(Ry.WS_ERR,"init websocket failed! Error: ".concat(f0.toString()));return fb.error("[".concat(this.name,"]").concat(g0)),void i0(g0)}m0.onopen=()=>{r0(m0)},m0.onclose=f0=>{i0(f0)},m0.onmessage=f0=>{fb.debug("[choose-best-ws]".concat(m0.url," onmessage: ").concat(f0.data))},mA(this.forceCloseTimeout).then(()=>{m0&&m0.readyState!==WebSocket.OPEN&&m0.close()})}}).then(r0=>(this.closeEstablishingWs=void 0,r0)).catch(r0=>{throw this.closeEstablishingWs=void 0,r0})}}class KO extends xy{get connectionState(){return this._connectionState}set connectionState(e0){e0!==this._connectionState&&(this._connectionState=e0,e0===Nw.CONNECTED?this.emit(Dw.WS_CONNECTED):e0===Nw.RECONNECTING?this.emit(Dw.WS_RECONNECTING,this._websocketReconnectReason):e0===Nw.CLOSED&&this.emit(Dw.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e0,n0){super(),Fg(this,"_disconnectedReason",void 0),Fg(this,"_websocketReconnectReason",void 0),Fg(this,"_connectionState",Nw.CLOSED),Fg(this,"reconnectToken",void 0),Fg(this,"websocket",void 0),Fg(this,"openConnectionTime",void 0),Fg(this,"clientId",void 0),Fg(this,"lastMsgTime",Date.now()),Fg(this,"uploadCache",[]),Fg(this,"uploadCacheInterval",void 0),Fg(this,"rttRolling",new MA(5)),Fg(this,"pingpongTimer",void 0),Fg(this,"wsInflateDataTimer",void 0),Fg(this,"pingpongTimeoutCount",0),Fg(this,"joinResponse",void 0),Fg(this,"multiIpOption",void 0),Fg(this,"initError",void 0),Fg(this,"spec",void 0),Fg(this,"store",void 0),Fg(this,"onWebsocketMessage",r0=>{if(r0.data instanceof ArrayBuffer)return void this.emit(Dw.ON_BINARY_DATA,r0.data);const i0=JSON.parse(r0.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i0,"_id")){const o0="res-@".concat(i0._id);this.emit(o0,i0._result,i0._message)}else if(Object.prototype.hasOwnProperty.call(i0,"_type")){if(this.emit(i0._type,i0._message),i0._type===kw.ON_NOTIFICATION&&this.handleNotification(i0._message),i0._type===kw.ON_USER_BANNED)switch(i0._message.error_code){case 14:this.close(Hy.UID_BANNED);break;case 15:this.close(Hy.IP_BANNED);break;case 16:this.close(Hy.CHANNEL_BANNED)}if(i0._type===kw.ON_USER_LICENSE_BANNED)switch(i0._message.error_code){case Ow.ERR_LICENSE_MISSING:this.close(Hy.LICENSE_MISSING);break;case Ow.ERR_LICENSE_EXPIRED:this.close(Hy.LICENSE_EXPIRED);break;case Ow.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Hy.LICENSE_MINUTES_EXCEEDED);break;case Ow.ERR_LICENSE_PERIOD_INVALID:this.close(Hy.LICENSE_PERIOD_INVALID);break;case Ow.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Hy.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ow.ERR_LICENSE_ILLEGAL:this.close(Hy.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e0.clientId,this.spec=e0,this.store=n0,this.websocket=new WO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,XA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),XA("JOIN_GATEWAY_USE_443PORT_ONLY"),n0),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Nw.CONNECTED&&this.reconnect("retry",Jy.OFFLINE)})}async request(e0,n0,r0,i0){const o0=TA(6,""),s0={_id:o0,_type:e0,_message:n0},a0=this.websocket.connectionID,c0=()=>new Gh((m0,f0)=>{if(this.connectionState===Nw.CONNECTED)return m0();const g0=()=>{this.off(Dw.WS_CLOSED,E0),m0()},E0=()=>{this.off(Dw.WS_CONNECTED,g0),f0(new yb(Ry.WS_ABORT))};this.once(Dw.WS_CONNECTED,g0),this.once(Dw.WS_CLOSED,E0),e0!==Pw.PUBLISH&&e0!==Pw.PUBLISH_DATASTREAM&&e0!==Pw.SUBSCRIBE&&e0!==Pw.SUBSCRIBE_DATASTREAM&&e0!==Pw.UNSUBSCRIBE&&e0!==Pw.UNSUBSCRIBE_DATASTREAM&&e0!==Pw.UNPUBLISH&&e0!==Pw.UNPUBLISH_DATASTREAM&&e0!==Pw.CONTROL&&e0!==Pw.RESTART_ICE||this.once(Dw.DISCONNECT_P2P,()=>{f0(new yb(Ry.DISCONNECT_P2P))}),e0!==Pw.PUBLISH&&e0!==Pw.RESTART_ICE||this.once(Dw.ABORT_P2P_EXECUTION,()=>{f0(new yb(Ry.DISCONNECT_P2P))})});if(this.connectionState!==Nw.CONNECTING&&this.connectionState!==Nw.RECONNECTING||e0===Pw.JOIN||e0===Pw.REJOIN||await c0(),this.websocket.sendMessage(s0,!0),i0)return;const u0=new Gh((m0,f0)=>{let g0=!1;const E0=(y0,b0)=>{g0=!0,m0({isSuccess:y0==="success",message:b0||{}}),this.off(Dw.WS_CLOSED,_0),this.off(Dw.WS_RECONNECTING,_0),this.emit(Dw.REQUEST_SUCCESS,e0,n0)};this.once("res-@".concat(o0),E0);const _0=()=>{f0(new yb(Ry.WS_ABORT,"type: ".concat(e0))),this.off(Dw.WS_CLOSED,_0),this.off(Dw.WS_RECONNECTING,_0),this.off("res-@".concat(o0),E0)};this.once(Dw.WS_CLOSED,_0),this.once(Dw.WS_RECONNECTING,_0),mA(XA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a0||g0||(fb.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e0)),this.emit(Dw.REQUEST_TIMEOUT,e0,n0))})});let l0=null;try{l0=await u0}catch(m0){if(this.connectionState===Nw.CLOSED||e0===Pw.LEAVE)throw new yb(Ry.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r0?m0.throw():e0===Pw.JOIN||e0===Pw.REJOIN?null:(await c0(),await this.request(e0,n0))}if(l0.isSuccess)return l0.message;const d0=Number(l0.message.error_code||l0.message.code),h0=NO(d0),p0=new yb(Ry.UNEXPECTED_RESPONSE,"".concat(h0.desc,": ").concat(l0.message.error_str),{code:d0,data:l0.message,desc:h0.desc});return h0.action==="success"?l0.message:(fb.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e0,", error_code: ").concat(d0,", message: ").concat(h0.desc,", action: ").concat(h0.action)),d0===Ow.ERR_TOO_MANY_BROADCASTERS?((e0===Pw.JOIN||e0===Pw.REJOIN)&&(this.initError=p0,this.close()),p0.throw()):h0.action==="failed"?p0.throw():h0.action==="quit"?(this.initError=p0,this.close(),p0.throw()):(d0===Ow.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l0.message.option,fb.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Jy.MULTI_IP)):this.reconnect(h0.action,Jy.SERVER_ERROR),e0===Pw.JOIN||e0===Pw.REJOIN?null:await this.request(e0,n0)))}waitMessage(e0,n0){return new Gh(r0=>{const i0=o0=>{(!n0||n0(o0))&&(this.off(e0,i0),r0(o0))};this.on(e0,i0)})}uploadWRTCStats(e0){if(!this.store.sessionId)return void fb.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n0={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e0};this.upload(Lw.WRTC_STATS,n0)}upload(e0,n0){const r0={_type:e0,_message:n0};try{this.websocket.sendMessage(r0)}catch{const o0=XA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r0),this.uploadCache.length>o0&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Nw.CONNECTED)return;const s0=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s0._type,s0._message)},XA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e0,n0){const r0={_type:e0,_message:n0};this.websocket.sendMessage(r0)}init(e0,n0){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Gh((r0,i0)=>{this.once(Dw.WS_CONNECTED,()=>r0(this.joinResponse)),this.once(Dw.WS_CLOSED,()=>i0(this.initError||new yb(Ry.WS_ABORT))),this.connectionState=Nw.CONNECTING,this.websocket.init(e0).catch(i0),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e0){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e0||Hy.LEAVE,this.connectionState=Nw.CLOSED,fb.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Dw.ABORT_P2P_EXECUTION);const e0=await Zy(this,Dw.REQUEST_JOIN_INFO),n0=await this.request(Pw.JOIN,e0);if(!n0)return this.emit(Dw.REPORT_JOIN_GATEWAY,eO.TIMEOUT,this.url||""),!1;this.joinResponse=n0,this.emit(Dw.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Nw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new yb(Ry.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e0=tA(this,Dw.REQUEST_REJOIN_INFO);e0.token=this.reconnectToken;const n0=await this.request(Pw.REJOIN,e0);return!!n0&&(this.connectionState=Nw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n0.peers&&n0.peers.forEach(r0=>{this.emit(kw.ON_USER_ONLINE,{uid:r0.uid}),r0.audio&&this.emit(kw.ON_ADD_AUDIO_STREAM,{uid:r0.uid,uint_id:r0.uint_id,audio:!0,ssrcId:r0.audio_ssrc}),r0.video&&this.emit(kw.ON_ADD_VIDEO_STREAM,{uid:r0.uid,uint_id:r0.uint_id,video:!0,ssrcId:r0.video_ssrc}),r0.audio_mute?this.emit(kw.MUTE_AUDIO,{uid:r0.uid}):this.emit(kw.UNMUTE_AUDIO,{uid:r0.uid}),r0.video_mute?this.emit(kw.MUTE_VIDEO,{uid:r0.uid}):this.emit(kw.UNMUTE_VIDEO,{uid:r0.uid}),r0.audio_enable_local?this.emit(kw.ENABLE_LOCAL_AUDIO,{uid:r0.uid}):this.emit(kw.DISABLE_LOCAL_AUDIO,{uid:r0.uid}),r0.video_enable_local?this.emit(kw.ENABLE_LOCAL_VIDEO,{uid:r0.uid}):this.emit(kw.DISABLE_LOCAL_VIDEO,{uid:r0.uid}),r0.audio||r0.video||this.emit(kw.ON_REMOVE_STREAM,{uid:r0.uid,uint_id:r0.uint_id})}),!0)}reconnect(e0,n0){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e0,n0)}handleNotification(e0){fb.debug("[".concat(this.clientId,"] receive notification: "),e0);const n0=NO(e0.code);if(e0.code===28&&"detail"in e0&&(fb.info("[".concat(this.clientId,"] receive recover notification: "),e0.detail),this.emit(Dw.RECOVER_NOTIFICATION,e0.detail)),n0.action!=="success"){if(n0.action!=="failed")return n0.action==="quit"?(n0.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Hy.UID_BANNED),void this.close()):void this.reconnect(n0.action,Jy.SERVER_ERROR);fb.error("[".concat(this.clientId,"] ignore error: "),n0.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e0=XA("PING_PONG_TIME_OUT"),n0=Date.now();this.pingpongTimeoutCount>=e0&&(fb.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n0-this.lastMsgTime,"ms")),n0-this.lastMsgTime>XA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Jy.TIMEOUT):this.request(Pw.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r0=Date.now()-n0;this.rttRolling.add(r0),XA("REPORT_STATS")&&this.send(Pw.PING_BACK,{pingpongElapse:r0})}).catch(r0=>{})}handleWsInflateData(){const{wsInflateLength:e0,wsDeflateLength:n0}=this.websocket.getWsInflateData();e0!==0&&n0!==0&&this.upload(Lw.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n0,ws_inflate_length:e0})}handleWebsocketEvents(){this.websocket.on(Uw.RECONNECT_WAITTING_FINISH,e0=>{this.emit(Dw.WS_RECONNECT_WAITTING_FINISH,e0)}),this.websocket.on(Uw.RECONNECT_CREATE_CONNECTION,e0=>{this.emit(Dw.WS_RECONNECT_CREATE_CONNECTION,e0)}),this.websocket.on(Uw.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Uw.CLOSED,()=>{this.connectionState=Nw.CLOSED}),this.websocket.on(Uw.FAILED,()=>{this._disconnectedReason=Hy.NETWORK_ERROR,this.connectionState=Nw.CLOSED}),this.websocket.on(Uw.RECONNECTING,e0=>{this._websocketReconnectReason=e0,this.joinResponse=void 0,this.connectionState===Nw.CONNECTED?this.connectionState=Nw.RECONNECTING:this.connectionState=Nw.CONNECTING}),this.websocket.on(Uw.WILL_RECONNECT,(e0,n0,r0)=>{const i0=tA(this,Dw.IS_P2P_DISCONNECTED),o0=i0||e0!=="retry";i0&&e0==="retry"&&(fb.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e0="tryNext",n0=eO.P2P_DISCONNECTED),o0&&(fb.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e0)),this.emit(Dw.REPORT_JOIN_GATEWAY,n0||eO.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Dw.DISCONNECT_P2P)),r0(e0)}),this.websocket.on(Uw.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e0=>{fb.warning("[".concat(this.clientId,"] rejoin failed ").concat(e0)),this.reconnect("tryNext",Jy.SERVER_ERROR)}):this.join().catch(e0=>{if(this.emit(Dw.REPORT_JOIN_GATEWAY,e0,this.url||""),e0 instanceof yb){if(e0.code===Ry.UNEXPECTED_RESPONSE&&e0.data.code===Ow.ERR_NO_AUTHORIZED)return this.initError=new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),fb.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Jy.SERVER_ERROR);fb.error("[".concat(this.clientId,"] join gateway request failed"),e0.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Jy.SERVER_ERROR):(this.initError=e0,this.close())}})}),this.websocket.on(Uw.REQUEST_NEW_URLS,(e0,n0)=>{Zy(this,Dw.REQUEST_RECOVER,this.multiIpOption).then(e0).catch(n0)}),this.websocket.on(Uw.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(kw.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(TO.PRE_CONNECT_PC,()=>{this.emit(Dw.PRE_CONNECT_PC)})}}let YO=function(t0){return t0[t0.CHOOSE_SERVER=11]="CHOOSE_SERVER",t0[t0.CLOUD_PROXY=18]="CLOUD_PROXY",t0[t0.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t0[t0.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t0}({});function qO(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function zO(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?qO(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):qO(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}function JO(t0){return t0.match(/^[\.\:\d]+$/)?"".concat(t0.replace(/[^\d]/g,"-"),".").concat(XA("TURN_DOMAIN")):(fb.info("Unidentified as ip: ".concat(t0,", use as host")),t0)}function XO(t0,e0){t0.addresses||(t0.addresses=[]);const n0=function(a0,c0){if(XA("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a0.map(d0=>{let{ip:h0,port:p0}=d0;return{address:"".concat(h0,":").concat(p0)}});const u0=XA("GATEWAY_DOMAINS");let l0=u0[1]&&Dn(c0).call(c0,u0[1])?1:0;return a0.map(d0=>{let{domain_prefix:h0,port:p0,ip:m0}=d0;if(h0)return{address:"".concat(h0,".").concat(u0[l0++%u0.length],":").concat(p0)};const f0=/^[\.\:\d]+$/.test(m0),g0=f0?"".concat(m0.replace(/[^\d]/g,"-"),".").concat(u0[l0++%u0.length],":").concat(p0):"".concat(m0,":").concat(p0);return f0||fb.info("Unidentified as ip: ".concat(m0,", use as host")),{ip:m0,port:p0,address:g0}})}(t0.addresses,e0),r0=Array.isArray(t0.detail)&&t0.detail[18];if(r0&&typeof r0=="string"){const a0=r0.split(";");for(let c0=0;c0<a0.length;c0++){var i0;const u0=jp(i0=a0[c0]).call(i0);n0[c0]&&u0&&(n0[c0].ip6=u0)}}const o0=t0.detail&&t0.detail.candidate;let s0;if(o0){const[a0,c0]=o0.split(":");a0&&c0&&(s0={port:Number(c0),ip:a0,address:"".concat(a0,":").concat(c0)})}return{gatewayAddrs:n0,apGatewayAddress:s0,uid:t0.uid,cid:t0.cid,cert:t0.cert,vid:t0.detail&&t0.detail[8],uni_lbs_ip:t0.detail&&t0.detail[1],res:t0,csIp:t0.detail&&t0.detail[502]}}function QO(t0){return typeof t0=="number"?t0:t0.exact||t0.ideal||t0.max||t0.min||0}function ZO(t0){const e0=t0._encoderConfig;if(!e0)return{};const n0={resolution:e0.width&&e0.height?"".concat(QO(e0.width),"x").concat(QO(e0.height)):void 0,maxVideoBW:e0.bitrateMax,minVideoBW:e0.bitrateMin};return typeof e0.frameRate=="number"?(n0.maxFrameRate=e0.frameRate,n0.minFrameRate=e0.frameRate):e0.frameRate&&(n0.maxFrameRate=e0.frameRate.max||e0.frameRate.ideal||e0.frameRate.exact||e0.frameRate.min,n0.minFrameRate=e0.frameRate.min||e0.frameRate.ideal||e0.frameRate.exact||e0.frameRate.max),n0}function $O(t0){return t0>=0&&t0<.17?1:t0>=.17&&t0<.36?2:t0>=.36&&t0<.59?3:t0>=.59&&t0<=1?4:t0>1?5:0}function eN(t0,e0){let n0,r0,i0;switch(e0){case YO.CHOOSE_SERVER:r0=4096,i0="choose server";break;case YO.CLOUD_PROXY:r0=1048576,i0="proxy";break;case YO.CLOUD_PROXY_5:r0=4194304,i0="proxy5";break;case YO.CLOUD_PROXY_FALLBACK:r0=4194310,i0="proxy fallback";break;default:throw new yb(Ry.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t0.detail&&t0.detail[502],retry:!1})}if(t0.response_body.forEach(o0=>{o0.buffer&&o0.buffer.flag===r0&&(n0={code:o0.buffer.code,addresses:(o0.buffer.edges_services||[]).map(s0=>zO(zO({},s0),{},{ticket:o0.buffer.cert})),server_ts:t0.enter_ts,uid:o0.buffer.uid,cid:o0.buffer.cid,cname:o0.buffer.cname,detail:zO(zO({},o0.buffer.detail),t0.detail),flag:o0.buffer.flag,opid:t0.opid,cert:o0.buffer.cert})}),!n0)throw new yb(Ry.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i0," from multi unilbs response"),{csIp:t0.detail&&t0.detail[502]});return n0}async function tN(t0,e0){return await Gh.all(t0.addresses.map(async n0=>({address:JO(n0.ip),tcpport:n0.port,udpport:n0.port,username:e0&&XA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e0.toString():KA.username,password:e0&&XA("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Uy(e0.toString()):KA.password})))}function iN(t0,e0){const n0=e0.getMediaStreamTrack(!0).getSettings(),r0=e0.videoHeight||n0.height,i0=e0.videoWidth||n0.width;return r0&&i0?Math.max(Math.min(r0,i0)/Math.min(QO(t0.height),QO(t0.width)),1):(fb.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function nN(t0){let{candidateType:e0,relayProtocol:n0,type:r0,address:i0,port:o0,protocol:s0}=t0;return r0==="local-candidate"?{candidateType:e0,relayProtocol:n0,protocol:s0}:{candidateType:e0,relayProtocol:n0,address:i0,port:o0,protocol:s0}}var rN,oN=i(ew),sN=Xi("Array").values,aN=pn,cN=Ze,dN=l,lN=sN,uN=Array.prototype,hN={DOMTokenList:!0,NodeList:!0},pN=function(t0){var e0=t0.values;return t0===uN||dN(uN,t0)&&e0===uN.values||cN(hN,aN(t0))?lN:e0},_N=i(pN),EN=N,fN=d,mN=L,TN=n,SN=eo,gN=Br,RN=k,CN=Je,IN=K,vN=Object.assign,yN=Object.defineProperty,AN=fN([].concat),bN=!vN||TN(function(){if(EN&&vN({b:1},vN(yN({},"a",{enumerable:!0,get:function(){yN(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t0={},e0={},n0=Symbol(),r0="abcdefghijklmnopqrst";return t0[n0]=7,r0.split("").forEach(function(i0){e0[i0]=i0}),vN({},t0)[n0]!=7||SN(vN({},e0)).join("")!=r0})?function(t0,e0){for(var n0=CN(t0),r0=arguments.length,i0=1,o0=gN.f,s0=RN.f;r0>i0;)for(var a0,c0=IN(arguments[i0++]),u0=o0?AN(SN(c0),o0(c0)):SN(c0),l0=u0.length,d0=0;l0>d0;)a0=u0[d0++],EN&&!mN(s0,c0,a0)||(n0[a0]=c0[a0]);return n0}:vN,wN=ii,ON=rs,NN=Xt,DN=L,PN=Je,LN=function(t0,e0,n0,r0){try{return r0?e0(wN(n0)[0],n0[1]):e0(n0)}catch(i0){ON(t0,"throw",i0)}},kN=jo,MN=jc,UN=Gi,xN=E_,VN=es,FN=qo,BN=Array,jN=d,GN=2147483647,WN=/[^\0-\u007E]/,HN=/[.\u3002\uFF0E\uFF61]/g,KN="Overflow: input needs wider integers to process",YN=RangeError,qN=jN(HN.exec),zN=Math.floor,JN=String.fromCharCode,XN=jN("".charCodeAt),QN=jN([].join),ZN=jN([].push),$N=jN("".replace),eD=jN("".split),tD=jN("".toLowerCase),iD=function(t0){return t0+22+75*(t0<26)},nD=function(t0,e0,n0){var r0=0;for(t0=n0?zN(t0/700):t0>>1,t0+=zN(t0/e0);t0>455;)t0=zN(t0/35),r0+=36;return zN(r0+36*t0/(t0+38))},rD=function(t0){var e0=[];t0=function(E0){for(var _0=[],y0=0,b0=E0.length;y0<b0;){var S0=XN(E0,y0++);if(S0>=55296&&S0<=56319&&y0<b0){var w0=XN(E0,y0++);(64512&w0)==56320?ZN(_0,((1023&S0)<<10)+(1023&w0)+65536):(ZN(_0,S0),y0--)}else ZN(_0,S0)}return _0}(t0);var n0,r0,i0=t0.length,o0=128,s0=0,a0=72;for(n0=0;n0<t0.length;n0++)(r0=t0[n0])<128&&ZN(e0,JN(r0));var c0=e0.length,u0=c0;for(c0&&ZN(e0,"-");u0<i0;){var l0=GN;for(n0=0;n0<t0.length;n0++)(r0=t0[n0])>=o0&&r0<l0&&(l0=r0);var d0=u0+1;if(l0-o0>zN((GN-s0)/d0))throw YN(KN);for(s0+=(l0-o0)*d0,o0=l0,n0=0;n0<t0.length;n0++){if((r0=t0[n0])<o0&&++s0>GN)throw YN(KN);if(r0==o0){for(var h0=s0,p0=36;;){var m0=p0<=a0?1:p0>=a0+26?26:p0-a0;if(h0<m0)break;var f0=h0-m0,g0=36-m0;ZN(e0,JN(iD(m0+f0%g0))),h0=zN(f0/g0),p0+=36}ZN(e0,JN(iD(h0))),a0=nD(s0,d0,u0==c0),s0=0,u0++}}s0++,o0++}return QN(e0,"")},oD=wi,sD=N,aD=Gg,cD=h,dD=Xt,lD=d,uD=ha,hD=hc,pD=Sc,_D=Ze,ED=bN,fD=function(t0){var e0=PN(t0),n0=MN(this),r0=arguments.length,i0=r0>1?arguments[1]:void 0,o0=i0!==void 0;o0&&(i0=NN(i0,r0>2?arguments[2]:void 0));var s0,a0,c0,u0,l0,d0,h0=FN(e0),p0=0;if(!h0||this===BN&&kN(h0))for(s0=UN(e0),a0=n0?new this(s0):BN(s0);s0>p0;p0++)d0=o0?i0(e0[p0],p0):e0[p0],xN(a0,p0,d0);else for(l0=(u0=VN(e0,h0)).next,a0=n0?new this:[];!(c0=DN(l0,u0)).done;p0++)d0=o0?LN(u0,i0,[c0.value,p0],!0):c0.value,xN(a0,p0,d0);return a0.length=p0,a0},mD=R_,TD=Ch.codeAt,SD=function(t0){var e0,n0,r0=[],i0=eD($N(tD(t0),HN,"."),".");for(e0=0;e0<i0.length;e0++)n0=i0[e0],ZN(r0,qN(WN,n0)?"xn--"+rD(n0):n0);return QN(r0,".")},gD=fn,RD=Da,CD=Zc,ID=rC,vD=ra,yD=vD.set,AD=vD.getterFor("URL"),bD=ID.URLSearchParams,wD=ID.getState,OD=cD.URL,ND=cD.TypeError,DD=cD.parseInt,PD=Math.floor,LD=Math.pow,kD=lD("".charAt),MD=lD(/./.exec),UD=lD([].join),xD=lD(1 .toString),VD=lD([].pop),FD=lD([].push),BD=lD("".replace),jD=lD([].shift),GD=lD("".split),WD=lD("".slice),HD=lD("".toLowerCase),KD=lD([].unshift),YD="Invalid scheme",qD="Invalid host",zD="Invalid port",JD=/[a-z]/i,XD=/[\d+-.a-z]/i,QD=/\d/,ZD=/^0x/i,$D=/^[0-7]+$/,eP=/^\d+$/,tP=/^[\da-f]+$/i,iP=/[\0\t\n\r #%/:<>?@[\\\]^|]/,nP=/[\0\t\n\r #/:<>?@[\\\]^|]/,rP=/^[\u0000-\u0020]+/,oP=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,sP=/[\t\n\r]/g,aP=function(t0){var e0,n0,r0,i0;if(typeof t0=="number"){for(e0=[],n0=0;n0<4;n0++)KD(e0,t0%256),t0=PD(t0/256);return UD(e0,".")}if(typeof t0=="object"){for(e0="",r0=function(o0){for(var s0=null,a0=1,c0=null,u0=0,l0=0;l0<8;l0++)o0[l0]!==0?(u0>a0&&(s0=c0,a0=u0),c0=null,u0=0):(c0===null&&(c0=l0),++u0);return u0>a0&&(s0=c0,a0=u0),s0}(t0),n0=0;n0<8;n0++)i0&&t0[n0]===0||(i0&&(i0=!1),r0===n0?(e0+=n0?":":"::",i0=!0):(e0+=xD(t0[n0],16),n0<7&&(e0+=":")));return"["+e0+"]"}return t0},cP={},dP=ED({},cP,{" ":1,'"':1,"<":1,">":1,"`":1}),lP=ED({},dP,{"#":1,"?":1,"{":1,"}":1}),uP=ED({},lP,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),hP=function(t0,e0){var n0=TD(t0,0);return n0>32&&n0<127&&!_D(e0,t0)?t0:encodeURIComponent(t0)},pP={ftp:21,file:null,http:80,https:443,ws:80,wss:443},_P=function(t0,e0){var n0;return t0.length==2&&MD(JD,kD(t0,0))&&((n0=kD(t0,1))==":"||!e0&&n0=="|")},EP=function(t0){var e0;return t0.length>1&&_P(WD(t0,0,2))&&(t0.length==2||(e0=kD(t0,2))==="/"||e0==="\\"||e0==="?"||e0==="#")},fP=function(t0){return t0==="."||HD(t0)==="%2e"},mP={},TP={},SP={},gP={},RP={},CP={},IP={},vP={},yP={},AP={},bP={},wP={},OP={},NP={},DP={},PP={},LP={},kP={},MP={},UP={},xP={},VP=function(t0,e0,n0){var r0,i0,o0,s0=gD(t0);if(e0){if(i0=this.parse(s0))throw ND(i0);this.searchParams=null}else{if(n0!==void 0&&(r0=new VP(n0,!0)),i0=this.parse(s0,null,r0))throw ND(i0);(o0=wD(new bD)).bindURL(this),this.searchParams=o0}};VP.prototype={type:"URL",parse:function(t0,e0,n0){var r0,i0,o0,s0,a0,c0=this,u0=e0||mP,l0=0,d0="",h0=!1,p0=!1,m0=!1;for(t0=gD(t0),e0||(c0.scheme="",c0.username="",c0.password="",c0.host=null,c0.port=null,c0.path=[],c0.query=null,c0.fragment=null,c0.cannotBeABaseURL=!1,t0=BD(t0,rP,""),t0=BD(t0,oP,"$1")),t0=BD(t0,sP,""),r0=fD(t0);l0<=r0.length;){switch(i0=r0[l0],u0){case mP:if(!i0||!MD(JD,i0)){if(e0)return YD;u0=SP;continue}d0+=HD(i0),u0=TP;break;case TP:if(i0&&(MD(XD,i0)||i0=="+"||i0=="-"||i0=="."))d0+=HD(i0);else{if(i0!=":"){if(e0)return YD;d0="",u0=SP,l0=0;continue}if(e0&&(c0.isSpecial()!=_D(pP,d0)||d0=="file"&&(c0.includesCredentials()||c0.port!==null)||c0.scheme=="file"&&!c0.host))return;if(c0.scheme=d0,e0)return void(c0.isSpecial()&&pP[c0.scheme]==c0.port&&(c0.port=null));d0="",c0.scheme=="file"?u0=NP:c0.isSpecial()&&n0&&n0.scheme==c0.scheme?u0=gP:c0.isSpecial()?u0=vP:r0[l0+1]=="/"?(u0=RP,l0++):(c0.cannotBeABaseURL=!0,FD(c0.path,""),u0=MP)}break;case SP:if(!n0||n0.cannotBeABaseURL&&i0!="#")return YD;if(n0.cannotBeABaseURL&&i0=="#"){c0.scheme=n0.scheme,c0.path=mD(n0.path),c0.query=n0.query,c0.fragment="",c0.cannotBeABaseURL=!0,u0=xP;break}u0=n0.scheme=="file"?NP:CP;continue;case gP:if(i0!="/"||r0[l0+1]!="/"){u0=CP;continue}u0=yP,l0++;break;case RP:if(i0=="/"){u0=AP;break}u0=kP;continue;case CP:if(c0.scheme=n0.scheme,i0==rN)c0.username=n0.username,c0.password=n0.password,c0.host=n0.host,c0.port=n0.port,c0.path=mD(n0.path),c0.query=n0.query;else if(i0=="/"||i0=="\\"&&c0.isSpecial())u0=IP;else if(i0=="?")c0.username=n0.username,c0.password=n0.password,c0.host=n0.host,c0.port=n0.port,c0.path=mD(n0.path),c0.query="",u0=UP;else{if(i0!="#"){c0.username=n0.username,c0.password=n0.password,c0.host=n0.host,c0.port=n0.port,c0.path=mD(n0.path),c0.path.length--,u0=kP;continue}c0.username=n0.username,c0.password=n0.password,c0.host=n0.host,c0.port=n0.port,c0.path=mD(n0.path),c0.query=n0.query,c0.fragment="",u0=xP}break;case IP:if(!c0.isSpecial()||i0!="/"&&i0!="\\"){if(i0!="/"){c0.username=n0.username,c0.password=n0.password,c0.host=n0.host,c0.port=n0.port,u0=kP;continue}u0=AP}else u0=yP;break;case vP:if(u0=yP,i0!="/"||kD(d0,l0+1)!="/")continue;l0++;break;case yP:if(i0!="/"&&i0!="\\"){u0=AP;continue}break;case AP:if(i0=="@"){h0&&(d0="%40"+d0),h0=!0,o0=fD(d0);for(var f0=0;f0<o0.length;f0++){var g0=o0[f0];if(g0!=":"||m0){var E0=hP(g0,uP);m0?c0.password+=E0:c0.username+=E0}else m0=!0}d0=""}else if(i0==rN||i0=="/"||i0=="?"||i0=="#"||i0=="\\"&&c0.isSpecial()){if(h0&&d0=="")return"Invalid authority";l0-=fD(d0).length+1,d0="",u0=bP}else d0+=i0;break;case bP:case wP:if(e0&&c0.scheme=="file"){u0=PP;continue}if(i0!=":"||p0){if(i0==rN||i0=="/"||i0=="?"||i0=="#"||i0=="\\"&&c0.isSpecial()){if(c0.isSpecial()&&d0=="")return qD;if(e0&&d0==""&&(c0.includesCredentials()||c0.port!==null))return;if(s0=c0.parseHost(d0))return s0;if(d0="",u0=LP,e0)return;continue}i0=="["?p0=!0:i0=="]"&&(p0=!1),d0+=i0}else{if(d0=="")return qD;if(s0=c0.parseHost(d0))return s0;if(d0="",u0=OP,e0==wP)return}break;case OP:if(!MD(QD,i0)){if(i0==rN||i0=="/"||i0=="?"||i0=="#"||i0=="\\"&&c0.isSpecial()||e0){if(d0!=""){var _0=DD(d0,10);if(_0>65535)return zD;c0.port=c0.isSpecial()&&_0===pP[c0.scheme]?null:_0,d0=""}if(e0)return;u0=LP;continue}return zD}d0+=i0;break;case NP:if(c0.scheme="file",i0=="/"||i0=="\\")u0=DP;else{if(!n0||n0.scheme!="file"){u0=kP;continue}if(i0==rN)c0.host=n0.host,c0.path=mD(n0.path),c0.query=n0.query;else if(i0=="?")c0.host=n0.host,c0.path=mD(n0.path),c0.query="",u0=UP;else{if(i0!="#"){EP(UD(mD(r0,l0),""))||(c0.host=n0.host,c0.path=mD(n0.path),c0.shortenPath()),u0=kP;continue}c0.host=n0.host,c0.path=mD(n0.path),c0.query=n0.query,c0.fragment="",u0=xP}}break;case DP:if(i0=="/"||i0=="\\"){u0=PP;break}n0&&n0.scheme=="file"&&!EP(UD(mD(r0,l0),""))&&(_P(n0.path[0],!0)?FD(c0.path,n0.path[0]):c0.host=n0.host),u0=kP;continue;case PP:if(i0==rN||i0=="/"||i0=="\\"||i0=="?"||i0=="#"){if(!e0&&_P(d0))u0=kP;else if(d0==""){if(c0.host="",e0)return;u0=LP}else{if(s0=c0.parseHost(d0))return s0;if(c0.host=="localhost"&&(c0.host=""),e0)return;d0="",u0=LP}continue}d0+=i0;break;case LP:if(c0.isSpecial()){if(u0=kP,i0!="/"&&i0!="\\")continue}else if(e0||i0!="?")if(e0||i0!="#"){if(i0!=rN&&(u0=kP,i0!="/"))continue}else c0.fragment="",u0=xP;else c0.query="",u0=UP;break;case kP:if(i0==rN||i0=="/"||i0=="\\"&&c0.isSpecial()||!e0&&(i0=="?"||i0=="#")){if((a0=HD(a0=d0))===".."||a0==="%2e."||a0===".%2e"||a0==="%2e%2e"?(c0.shortenPath(),i0=="/"||i0=="\\"&&c0.isSpecial()||FD(c0.path,"")):fP(d0)?i0=="/"||i0=="\\"&&c0.isSpecial()||FD(c0.path,""):(c0.scheme=="file"&&!c0.path.length&&_P(d0)&&(c0.host&&(c0.host=""),d0=kD(d0,0)+":"),FD(c0.path,d0)),d0="",c0.scheme=="file"&&(i0==rN||i0=="?"||i0=="#"))for(;c0.path.length>1&&c0.path[0]==="";)jD(c0.path);i0=="?"?(c0.query="",u0=UP):i0=="#"&&(c0.fragment="",u0=xP)}else d0+=hP(i0,lP);break;case MP:i0=="?"?(c0.query="",u0=UP):i0=="#"?(c0.fragment="",u0=xP):i0!=rN&&(c0.path[0]+=hP(i0,cP));break;case UP:e0||i0!="#"?i0!=rN&&(i0=="'"&&c0.isSpecial()?c0.query+="%27":c0.query+=i0=="#"?"%23":hP(i0,cP)):(c0.fragment="",u0=xP);break;case xP:i0!=rN&&(c0.fragment+=hP(i0,dP))}l0++}},parseHost:function(t0){var e0,n0,r0;if(kD(t0,0)=="["){if(kD(t0,t0.length-1)!="]"||(e0=function(i0){var o0,s0,a0,c0,u0,l0,d0,h0=[0,0,0,0,0,0,0,0],p0=0,m0=null,f0=0,g0=function(){return kD(i0,f0)};if(g0()==":"){if(kD(i0,1)!=":")return;f0+=2,m0=++p0}for(;g0();){if(p0==8)return;if(g0()!=":"){for(o0=s0=0;s0<4&&MD(tP,g0());)o0=16*o0+DD(g0(),16),f0++,s0++;if(g0()=="."){if(s0==0||(f0-=s0,p0>6))return;for(a0=0;g0();){if(c0=null,a0>0){if(!(g0()=="."&&a0<4))return;f0++}if(!MD(QD,g0()))return;for(;MD(QD,g0());){if(u0=DD(g0(),10),c0===null)c0=u0;else{if(c0==0)return;c0=10*c0+u0}if(c0>255)return;f0++}h0[p0]=256*h0[p0]+c0,++a0!=2&&a0!=4||p0++}if(a0!=4)return;break}if(g0()==":"){if(f0++,!g0())return}else if(g0())return;h0[p0++]=o0}else{if(m0!==null)return;f0++,m0=++p0}}if(m0!==null)for(l0=p0-m0,p0=7;p0!=0&&l0>0;)d0=h0[p0],h0[p0--]=h0[m0+l0-1],h0[m0+--l0]=d0;else if(p0!=8)return;return h0}(WD(t0,1,-1)),!e0))return qD;this.host=e0}else if(this.isSpecial()){if(t0=SD(t0),MD(iP,t0)||(e0=function(i0){var o0,s0,a0,c0,u0,l0,d0,h0=GD(i0,".");if(h0.length&&h0[h0.length-1]==""&&h0.length--,(o0=h0.length)>4)return i0;for(s0=[],a0=0;a0<o0;a0++){if((c0=h0[a0])=="")return i0;if(u0=10,c0.length>1&&kD(c0,0)=="0"&&(u0=MD(ZD,c0)?16:8,c0=WD(c0,u0==8?1:2)),c0==="")l0=0;else{if(!MD(u0==10?eP:u0==8?$D:tP,c0))return i0;l0=DD(c0,u0)}FD(s0,l0)}for(a0=0;a0<o0;a0++)if(l0=s0[a0],a0==o0-1){if(l0>=LD(256,5-o0))return null}else if(l0>255)return null;for(d0=VD(s0),a0=0;a0<s0.length;a0++)d0+=s0[a0]*LD(256,3-a0);return d0}(t0),e0===null))return qD;this.host=e0}else{if(MD(nP,t0))return qD;for(e0="",n0=fD(t0),r0=0;r0<n0.length;r0++)e0+=hP(n0[r0],cP);this.host=e0}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return _D(pP,this.scheme)},shortenPath:function(){var t0=this.path,e0=t0.length;!e0||this.scheme=="file"&&e0==1&&_P(t0[0],!0)||t0.length--},serialize:function(){var t0=this,e0=t0.scheme,n0=t0.username,r0=t0.password,i0=t0.host,o0=t0.port,s0=t0.path,a0=t0.query,c0=t0.fragment,u0=e0+":";return i0!==null?(u0+="//",t0.includesCredentials()&&(u0+=n0+(r0?":"+r0:"")+"@"),u0+=aP(i0),o0!==null&&(u0+=":"+o0)):e0=="file"&&(u0+="//"),u0+=t0.cannotBeABaseURL?s0[0]:s0.length?"/"+UD(s0,"/"):"",a0!==null&&(u0+="?"+a0),c0!==null&&(u0+="#"+c0),u0},setHref:function(t0){var e0=this.parse(t0);if(e0)throw ND(e0);this.searchParams.update()},getOrigin:function(){var t0=this.scheme,e0=this.port;if(t0=="blob")try{return new FP(t0.path[0]).origin}catch{return"null"}return t0!="file"&&this.isSpecial()?t0+"://"+aP(this.host)+(e0!==null?":"+e0:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t0){this.parse(gD(t0)+":",mP)},getUsername:function(){return this.username},setUsername:function(t0){var e0=fD(gD(t0));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n0=0;n0<e0.length;n0++)this.username+=hP(e0[n0],uP)}},getPassword:function(){return this.password},setPassword:function(t0){var e0=fD(gD(t0));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n0=0;n0<e0.length;n0++)this.password+=hP(e0[n0],uP)}},getHost:function(){var t0=this.host,e0=this.port;return t0===null?"":e0===null?aP(t0):aP(t0)+":"+e0},setHost:function(t0){this.cannotBeABaseURL||this.parse(t0,bP)},getHostname:function(){var t0=this.host;return t0===null?"":aP(t0)},setHostname:function(t0){this.cannotBeABaseURL||this.parse(t0,wP)},getPort:function(){var t0=this.port;return t0===null?"":gD(t0)},setPort:function(t0){this.cannotHaveUsernamePasswordPort()||((t0=gD(t0))==""?this.port=null:this.parse(t0,OP))},getPathname:function(){var t0=this.path;return this.cannotBeABaseURL?t0[0]:t0.length?"/"+UD(t0,"/"):""},setPathname:function(t0){this.cannotBeABaseURL||(this.path=[],this.parse(t0,LP))},getSearch:function(){var t0=this.query;return t0?"?"+t0:""},setSearch:function(t0){(t0=gD(t0))==""?this.query=null:(kD(t0,0)=="?"&&(t0=WD(t0,1)),this.query="",this.parse(t0,UP)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t0=this.fragment;return t0?"#"+t0:""},setHash:function(t0){(t0=gD(t0))!=""?(kD(t0,0)=="#"&&(t0=WD(t0,1)),this.fragment="",this.parse(t0,xP)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var FP=function(t0){var e0=pD(this,BP),n0=CD(arguments.length,1)>1?arguments[1]:void 0,r0=yD(e0,new VP(t0,!1,n0));sD||(e0.href=r0.serialize(),e0.origin=r0.getOrigin(),e0.protocol=r0.getProtocol(),e0.username=r0.getUsername(),e0.password=r0.getPassword(),e0.host=r0.getHost(),e0.hostname=r0.getHostname(),e0.port=r0.getPort(),e0.pathname=r0.getPathname(),e0.search=r0.getSearch(),e0.searchParams=r0.getSearchParams(),e0.hash=r0.getHash())},BP=FP.prototype,jP=function(t0,e0){return{get:function(){return AD(this)[t0]()},set:e0&&function(n0){return AD(this)[e0](n0)},configurable:!0,enumerable:!0}};if(sD&&(hD(BP,"href",jP("serialize","setHref")),hD(BP,"origin",jP("getOrigin")),hD(BP,"protocol",jP("getProtocol","setProtocol")),hD(BP,"username",jP("getUsername","setUsername")),hD(BP,"password",jP("getPassword","setPassword")),hD(BP,"host",jP("getHost","setHost")),hD(BP,"hostname",jP("getHostname","setHostname")),hD(BP,"port",jP("getPort","setPort")),hD(BP,"pathname",jP("getPathname","setPathname")),hD(BP,"search",jP("getSearch","setSearch")),hD(BP,"searchParams",jP("getSearchParams")),hD(BP,"hash",jP("getHash","setHash"))),uD(BP,"toJSON",function(){return AD(this).serialize()},{enumerable:!0}),uD(BP,"toString",function(){return AD(this).serialize()},{enumerable:!0}),OD){var GP=OD.createObjectURL,WP=OD.revokeObjectURL;GP&&uD(FP,"createObjectURL",dD(GP,OD)),WP&&uD(FP,"revokeObjectURL",dD(WP,OD))}RD(FP,"URL"),oD({global:!0,constructor:!0,forced:!aD,sham:!sD},{URL:FP});var HP=wi,KP=n,YP=Zc,qP=fn,zP=Gg,JP=ae("URL");HP({target:"URL",stat:!0,forced:!(zP&&KP(function(){JP.canParse()}))},{canParse:function(t0){var e0=YP(arguments.length,1),n0=qP(t0),r0=e0<2||arguments[1]===void 0?void 0:qP(arguments[1]);try{return!!new JP(n0,r0)}catch{return!1}}});var XP=i(ie.URL);const QP={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ZP(){return QP}function $P(){return"setSinkId"in HTMLAudioElement.prototype&&(!XA("RESTRICTION_SET_PLAYBACK_DEVICE")||(Jv()||Qv())&&!_y())}function eL(){return!QP.supportUnifiedPlan||XA("CHROME_FORCE_PLAN_B")&&Ey()}let tL=function(t0){return t0.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t0.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t0.IOS_INTERRUPTION_START="ios-interruption-start",t0.IOS_INTERRUPTION_END="ios-interruption-end",t0.STATE_CHANGE="state-change",t0}({});function iL(t0,e0,n0){return{sampleRate:t0,stereo:e0,bitrate:n0}}function nL(t0,e0,n0,r0,i0){return{width:t0,height:e0,frameRate:n0,bitrateMin:r0,bitrateMax:i0}}function rL(t0,e0,n0,r0,i0){return{width:{max:t0},height:{max:e0},frameRate:n0,bitrateMin:r0,bitrateMax:i0}}function oL(t0,e0){return{numSpatialLayers:t0,numTemporalLayers:e0}}const sL={"90p":nL(160,90),"90p_1":nL(160,90),"120p":nL(160,120,15,30,65),"120p_1":nL(160,120,15,30,65),"120p_3":nL(120,120,15,30,50),"120p_4":nL(212,120),"180p":nL(320,180,15,30,140),"180p_1":nL(320,180,15,30,140),"180p_3":nL(180,180,15,30,100),"180p_4":nL(240,180,15,30,120),"240p":nL(320,240,15,40,200),"240p_1":nL(320,240,15,40,200),"240p_3":nL(240,240,15,40,140),"240p_4":nL(424,240,15,40,220),"360p":nL(640,360,15,80,400),"360p_1":nL(640,360,15,80,400),"360p_3":nL(360,360,15,80,260),"360p_4":nL(640,360,30,80,600),"360p_6":nL(360,360,30,80,400),"360p_7":nL(480,360,15,80,320),"360p_8":nL(480,360,30,80,490),"360p_9":nL(640,360,15,80,800),"360p_10":nL(640,360,24,80,800),"360p_11":nL(640,360,24,80,1e3),"480p":nL(640,480,15,100,500),"480p_1":nL(640,480,15,100,500),"480p_2":nL(640,480,30,100,1e3),"480p_3":nL(480,480,15,100,400),"480p_4":nL(640,480,30,100,750),"480p_6":nL(480,480,30,100,600),"480p_8":nL(848,480,15,100,610),"480p_9":nL(848,480,30,100,930),"480p_10":nL(640,480,10,100,400),"720p":nL(1280,720,15,120,1130),"720p_auto":nL(1280,720,30,900,3e3),"720p_1":nL(1280,720,15,120,1130),"720p_2":nL(1280,720,30,120,2e3),"720p_3":nL(1280,720,30,120,1710),"720p_5":nL(960,720,15,120,910),"720p_6":nL(960,720,30,120,1380),"1080p":nL(1920,1080,15,120,2080),"1080p_1":nL(1920,1080,15,120,2080),"1080p_2":nL(1920,1080,30,120,3e3),"1080p_3":nL(1920,1080,30,120,3150),"1080p_5":nL(1920,1080,60,120,4780),"1440p":nL(2560,1440,30,120,4850),"1440p_1":nL(2560,1440,30,120,4850),"1440p_2":nL(2560,1440,60,120,7350),"4k":nL(3840,2160,30,120,8910),"4k_1":nL(3840,2160,30,120,8910),"4k_3":nL(3840,2160,60,120,13500)},aL={"480p":rL(640,480,5),"480p_1":rL(640,480,5),"480p_2":rL(640,480,30),"480p_3":rL(640,480,15),"720p":rL(1280,720,5),"720p_auto":nL(1280,720,30,900,3e3),"720p_1":rL(1280,720,5),"720p_2":rL(1280,720,30),"720p_3":rL(1280,720,15),"1080p":rL(1920,1080,5),"1080p_1":rL(1920,1080,5),"1080p_2":rL(1920,1080,30),"1080p_3":rL(1920,1080,15)},cL={"1SL1TL":oL(1,1),"3SL3TL":oL(3,3),"2SL3TL":oL(2,3)};function dL(t0){return t0||(t0="480p_1"),typeof t0=="string"?Object.assign({},sL[t0]):t0}function lL(t0){return typeof t0=="string"?Object.assign({},aL[t0]):t0}function uL(t0){return typeof t0=="string"?Object.assign({},cL[t0]):t0}const hL={speech_low_quality:iL(16e3,!1),speech_standard:iL(32e3,!1,18),music_standard:iL(48e3,!1),standard_stereo:iL(48e3,!0,56),high_quality:iL(48e3,!1,128),high_quality_stereo:iL(48e3,!0,192)};function pL(t0){return typeof t0=="string"?Object.assign({},hL[t0]):t0}const _L=[];function EL(t0){return vy(t0,"mediaSource",["screen","window","application"]),!0}let fL=function(t0){return t0.NEED_RENEGOTIATE="@need_renegotiate",t0.NEED_REPLACE_TRACK="@need_replace_track",t0.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t0.NEED_CLOSE="@need_close",t0.NEED_ENABLE_TRACK="@need_enable_track",t0.NEED_DISABLE_TRACK="@need_disable_track",t0.NEED_SESSION_ID="@need_sid",t0.SET_OPTIMIZATION_MODE="@set_optimization_mode",t0.GET_STATS="@get_stats",t0.GET_RTC_STATS="@get_rtc_stats",t0.GET_LOW_VIDEO_TRACK="@get_low_video_track",t0.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t0.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t0.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t0.NEED_MUTE_TRACK="@need_mute_track",t0.NEED_UNMUTE_TRACK="@need_unmute_track",t0}({}),mL=function(t0){return t0.SCREEN_TRACK="screen_track",t0.CUSTOM_TRACK="custome_track",t0.LOW_STREAM="low_stream",t0.SCREEN_LOW_TRACK="screen_low_track",t0}({}),TL=function(t0){return t0[t0.HIGH_STREAM=0]="HIGH_STREAM",t0[t0.LOW_STREAM=1]="LOW_STREAM",t0}({}),SL=function(t0){return t0[t0.HIGH_STREAM=0]="HIGH_STREAM",t0[t0.LOW_STREAM=1]="LOW_STREAM",t0[t0.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t0[t0.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t0[t0.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t0[t0.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t0[t0.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t0[t0.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t0}({}),gL=function(t0){return t0[t0.DISABLE=0]="DISABLE",t0[t0.LOW_STREAM=1]="LOW_STREAM",t0[t0.AUDIO_ONLY=2]="AUDIO_ONLY",t0[t0.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t0[t0.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t0[t0.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t0[t0.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t0[t0.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t0[t0.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t0}({}),RL=function(t0){return t0.TRANSCEIVER_UPDATED="transceiver-updated",t0.SEI_TO_SEND="sei-to-send",t0.SEI_RECEIVED="sei-received",t0.TRACK_UPDATED="track-updated",t0}({}),CL=function(t0){return t0.SOURCE_STATE_CHANGE="source-state-change",t0.TRACK_ENDED="track-ended",t0.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t0.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t0.CLOSED="closed",t0}({}),IL=function(t0){return t0.FIRST_FRAME_DECODED="first-frame-decoded",t0.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t0.VIDEO_STATE_CHANGED="video-state-changed",t0}({}),vL=function(t0){return t0.AUDIO="audio",t0.VIDEO="video",t0.DATA="data",t0}({}),yL=function(t0){return t0.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t0.RECEIVE_TRACK_BUFFER="receive_track_buffer",t0.ON_AUDIO_BUFFER="on_audio_buffer",t0.UPDATE_SOURCE="update_source",t0}({});(function(t0){t0.UPDATE_TRACK_SOURCE="update-track-source"})({});const AL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},bL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},wL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},OL={uplinkNetworkQuality:0,downlinkNetworkQuality:0},NL={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let DL=function(t0){return t0.ON_TRACK="on_track",t0.ON_NODE="on_node",t0}({}),PL=function(t0){return t0.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t0.REQUEST_CONSTRAINTS="request_constraints",t0}({}),LL=function(t0){return t0.IDLE="IDLE",t0.INITING="INITING",t0.INITEND="INITEND",t0}({}),kL=function(t0){return t0.STATE_CHANGE="state_change",t0.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t0.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t0.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t0}({}),ML=function(t0){return t0.NONE="none",t0.INIT="init",t0.CANPLAY="canplay",t0.PLAYING="playing",t0.PAUSED="paused",t0.SUSPEND="suspend",t0.STALLED="stalled",t0.WAITING="waiting",t0.ERROR="error",t0.DESTROYED="destroyed",t0.ABORT="abort",t0.ENDED="ended",t0.EMPTIED="emptied",t0.LOADEDDATA="loadeddata",t0}({}),UL=function(t0){return t0[t0.VideoStateStopped=0]="VideoStateStopped",t0[t0.VideoStateStarting=1]="VideoStateStarting",t0[t0.VideoStateDecoding=2]="VideoStateDecoding",t0[t0.VideoStateFrozen=3]="VideoStateFrozen",t0}({});const xL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let VL=function(t0){return t0.OPEN="open",t0.MESSAGE="message",t0.CLOSE="close",t0.CLOSING="closing",t0.ERROR="error",t0}({});function FL(t0,e0,n0,r0,i0){var o0,s0,a0={};return Object.keys(r0).forEach(function(c0){a0[c0]=r0[c0]}),a0.enumerable=!!a0.enumerable,a0.configurable=!!a0.configurable,("value"in a0||a0.initializer)&&(a0.writable=!0),a0=Jn(o0=oN(s0=n0.slice()).call(s0)).call(o0,function(c0,u0){return u0(t0,e0,c0)||c0},a0),i0&&a0.initializer!==void 0&&(a0.value=a0.initializer?a0.initializer.call(i0):void 0,a0.initializer=void 0),a0.initializer===void 0&&(Object.defineProperty(t0,e0,a0),a0=null),a0}function BL(t0,e0,n0){return(e0=function(r0){var i0=function(o0,s0){if(typeof o0!="object"||!o0)return o0;var a0=o0[Symbol.toPrimitive];if(a0!==void 0){var c0=a0.call(o0,"string");if(typeof c0!="object")return c0;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o0)}(r0);return typeof i0=="symbol"?i0:i0+""}(e0))in t0?Object.defineProperty(t0,e0,{value:n0,enumerable:!0,configurable:!0,writable:!0}):t0[e0]=n0,t0}function jL(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function GL(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?jL(Object(n0),!0).forEach(function(r0){BL(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):jL(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}class WL extends xy{set _mediaStreamTrack(e0){e0!==this.mediaStreamTrack&&(this.safeEmit(RL.TRACK_UPDATED,e0),this.mediaStreamTrack=e0)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e0,n0){super(),BL(this,"trackMediaType",void 0),BL(this,"_ID",void 0),BL(this,"_rtpTransceiver",void 0),BL(this,"_lowRtpTransceiver",void 0),BL(this,"_hints",[]),BL(this,"_isClosed",!1),BL(this,"_originMediaStreamTrack",void 0),BL(this,"mediaStreamTrack",void 0),BL(this,"_external",{}),this._ID=n0||TA(8,"track-"),this._originMediaStreamTrack=e0,this.mediaStreamTrack=e0,function(r0){Dn(_L).call(_L,r0)||_L.push(r0)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e0){return e0||dA(()=>{var n0;vb.reportApiInvoke(null,{name:By.GET_MEDIA_STREAM_TRACK,options:[],tag:jy.TRACER}).onSuccess(((n0=this._mediaStreamTrack)===null||n0===void 0?void 0:n0.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e0){return e0===TL.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e0){const n0=_L.indexOf(e0);n0!==-1&&_L.splice(n0,1)}(this),this.emit(CL.CLOSED),this.removeAllListeners(RL.SEI_RECEIVED)}_updateRtpTransceiver(e0,n0){if(n0===TL.LOW_STREAM){if(this._lowRtpTransceiver===e0)return;this._lowRtpTransceiver=e0}else{if(this._rtpTransceiver===e0)return;this._rtpTransceiver=e0}this.emit(RL.TRANSCEIVER_UPDATED,e0,n0)}}class HL extends WL{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e0,n0){super(e0,n0),BL(this,"_enabled",!0),BL(this,"_muted",!1),BL(this,"_isExternalTrack",!1),BL(this,"_isClosed",!1),BL(this,"_enabledMutex",void 0),BL(this,"processor",void 0),BL(this,"_processorContext",void 0),BL(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new NA("".concat(this.getTrackId())),e0.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e0,n0;return(e0=(n0=this._originMediaStreamTrack)===null||n0===void 0?void 0:n0.label)!==null&&e0!==void 0?e0:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,fb.debug("[".concat(this.getTrackId(),"] close")),this.emit(fL.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e0,n0){let r0=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r0,e0!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n0&&this._originMediaStreamTrack.stop()),e0.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e0,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,fL.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){fb.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(CL.TRACK_ENDED)}stateCheck(e0,n0){if(fb.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e0,": ").concat(n0,"]")),Iy(n0,e0),this._enabled&&this._muted&&e0==="enabled"&&n0===!1)throw new Cy(Ry.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",fb);if(!this._enabled&&!this._muted&&e0==="muted"&&n0===!0)throw new Cy(Ry.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",fb)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Gh.resolve([])}}const KL=window.AudioContext||window.webkitAudioContext;let YL=null;const qL=new class extends xy{constructor(){super(...arguments),BL(this,"prevState",void 0),BL(this,"curState",void 0),BL(this,"currentTime",void 0),BL(this,"currentTimeStuckAt",void 0),BL(this,"interruptDetectorTrack",void 0),BL(this,"onLocalAudioTrackMute",()=>{fb.info("ios15-interruption-start"),this.emit(tL.IOS_15_16_INTERRUPTION_START)}),BL(this,"onLocalAudioTrackUnmute",async()=>{fb.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?fb.info("ios15-interruption-end-canceled"):(YL&&await YL.suspend(),this.emit(tL.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t0){fb.debug("webaudio bindInterruptDetectorTrack ".concat(t0.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t0,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t0){fb.debug("webaudio unbindInterruptDetectorTrack ".concat(t0.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t0&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function zL(){if(!YL){if(function(){if(!KL)return void fb.error("your browser is not support web audio");fb.info("create audio context");const t0=GL({},XA("WEBAUDIO_INIT_OPTIONS"));fb.debug("audio context init option:",JSON.stringify(t0)),YL=new KL(t0),qL.curState=YL.state,YL.onstatechange=()=>{qL.prevState=qL.curState,qL.curState=YL?YL.state:void 0;const{prevState:e0,curState:n0}=qL,r0=n0==="running",i0=n0==="interrupted",o0=e0==="running",s0=e0==="suspended",a0=e0==="interrupted",c0=Hv().osVersion;($v()||uy())&&o0&&i0&&(fb.info("ios".concat(c0,"-interruption-start")),qL.emit(tL.IOS_INTERRUPTION_START)),($v()||uy())&&(s0||a0)&&r0&&(fb.info("ios".concat(c0,"-interruption-end")),qL.emit(tL.IOS_INTERRUPTION_END)),e0!==n0&&qL.emit(tL.STATE_CHANGE,n0,e0)},setInterval(()=>{var e0;const n0=(e0=YL)===null||e0===void 0?void 0:e0.currentTime;qL.currentTime!==n0?(qL.currentTimeStuckAt&&(fb.debug("AudioContext current time resume at ".concat(n0)),qL.currentTimeStuckAt=void 0),qL.currentTime=n0):(n0!==qL.currentTimeStuckAt&&(vb.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n0},tag:jy.TRACER}).onSuccess(),fb.warning("AudioContext current time stuck at ".concat(n0))),qL.currentTimeStuckAt=n0)},5e3),async function(e0){const n0=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r0,i0=!1,o0=!1,s0=!1;function a0(f0){e0.state==="running"?c0(!1):$v()||uy()?e0.state==="suspended"&&(c0(!0),f0&&e0.resume().then(u0,u0)):e0.state!=="closed"&&(c0(!0),f0&&e0.resume().then(u0,u0))}function c0(f0){if(i0!==f0){i0=f0;for(let g0=0,E0=n0;g0<E0.length;g0+=1){const _0=E0[g0];f0?window.addEventListener(_0,l0,{capture:!0,passive:!0}):window.removeEventListener(_0,l0,{capture:!0,passive:!0})}}}function u0(){a0(!1)}function l0(){a0(!0)}function d0(f0){if(!s0)if(r0.paused)if(f0){let g0;h0(!1),s0=!0;try{g0=r0.play(),g0?g0.then(p0,p0):(r0.addEventListener("playing",p0),r0.addEventListener("abort",p0),r0.addEventListener("error",p0))}catch{p0()}}else h0(!0);else h0(!1)}function h0(f0){if(o0!==f0){o0=f0;for(let g0=0,E0=n0;g0<E0.length;g0++){const _0=E0[g0];f0?window.addEventListener(_0,m0,{capture:!0,passive:!0}):window.removeEventListener(_0,m0,{capture:!0,passive:!0})}}}function p0(){r0.removeEventListener("playing",p0),r0.removeEventListener("abort",p0),r0.removeEventListener("error",p0),s0=!1,d0(!1)}function m0(){d0(!0)}if($v()){const f0=e0.createMediaStreamDestination(),g0=document.createElement("div");g0.innerHTML="<audio x-webkit-airplay='deny'></audio>",r0=g0.children.item(0),r0.controls=!1,r0.disableRemotePlayback=!0,r0.preload="auto",r0.srcObject=f0.stream,d0(!0)}qL.on(tL.STATE_CHANGE,function(){a0(!0)}),a0(!1)}(YL)}(),!YL)throw new Cy(Ry.NOT_SUPPORTED,"can not create audio context");return YL}return YL}function JL(t0){if(function(){if(XL!==null)return XL;const r0=zL(),i0=r0.createBufferSource(),o0=r0.createGain(),s0=r0.createGain();i0.connect(o0),i0.connect(s0),i0.disconnect(o0);let a0=!1;try{i0.disconnect(o0)}catch{a0=!0}return i0.disconnect(),XL=a0,a0}())return;const e0=t0.connect,n0=t0.disconnect;t0.connect=(r0,i0,o0)=>{var s0;return t0._inputNodes||(t0._inputNodes=[]),Dn(s0=t0._inputNodes).call(s0,r0)||(r0 instanceof AudioNode?(t0._inputNodes.push(r0),e0.call(t0,r0,i0,o0)):e0.call(t0,r0,i0)),t0},t0.disconnect=(r0,i0,o0)=>{n0.call(t0),r0?nA(t0._inputNodes,r0):t0._inputNodes=[];for(const s0 of t0._inputNodes)e0.call(t0,s0)}}let XL=null;function QL(t0,e0){let n0=!1;const r0=1/e0;if(XA("DISABLE_WEBAUDIO")){const i0=window.setInterval(()=>{n0?window.clearInterval(i0):t0(performance.now()/1e3)},1e3*r0)}else{const i0=zL();let o0=i0.createGain();o0.gain.value=0,o0.connect(i0.destination);const s0=()=>{if(n0)return void(o0=null);const a0=i0.createOscillator();a0.onended=s0,a0.connect(o0),a0.start(0),a0.stop(i0.currentTime+r0),t0(i0.currentTime)};s0()}return()=>{n0=!0}}class ZL{constructor(){BL(this,"context",void 0),BL(this,"analyserNode",void 0),BL(this,"sourceNode",void 0),this.context=zL(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e0){if(e0!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e0,e0==null||e0.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||$v()||uy()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e0=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e0);else{const r0=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r0);for(let i0=0;i0<e0.length;++i0)e0[i0]=r0[i0]/128-1}const n0=Jn(e0).call(e0,(r0,i0)=>r0+i0*i0,0)/e0.length;return Math.max(10*Math.log10(n0)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e0,n0;(e0=this.sourceNode)===null||e0===void 0||e0.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n0=this.sourceNode)===null||n0===void 0||n0.connect(this.analyserNode)}catch{fb.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class $L extends xy{get processSourceNode(){return this.sourceNode}set processedNode(e0){var n0;if(!this.isDestroyed&&this._processedNode!==e0){try{var r0;(r0=this.sourceNode)===null||r0===void 0||r0.disconnect(this.outputNode)}catch{}(n0=this._processedNode)===null||n0===void 0||n0.disconnect(),this._processedNode=e0,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),BL(this,"outputNode",void 0),BL(this,"outputTrack",void 0),BL(this,"isPlayed",!1),BL(this,"sourceNode",void 0),BL(this,"context",void 0),BL(this,"audioBufferNode",void 0),BL(this,"destNode",void 0),BL(this,"audioOutputLevel",0),BL(this,"volumeLevelAnalyser",void 0),BL(this,"_processedNode",void 0),BL(this,"playNode",void 0),BL(this,"isDestroyed",!1),BL(this,"onNoAudioInput",void 0),BL(this,"isNoAudioInput",!1),BL(this,"_noAudioInputCount",0),this.context=zL(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),JL(this.outputNode),this.volumeLevelAnalyser=new ZL}startGetAudioBuffer(e0){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e0),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n0=>{this.emit(yL.ON_AUDIO_BUFFER,function(r0){for(let i0=0;i0<r0.outputBuffer.numberOfChannels;i0+=1){const o0=r0.outputBuffer.getChannelData(i0);for(let s0=0;s0<o0.length;s0+=1)o0[s0]=0}return r0.inputBuffer}(n0))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ZP().webAudioMediaStreamDest)throw new Cy(Ry.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e0){this.context.state!=="running"&&oA(()=>{qL.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e0||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e0>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;$v()||uy()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n0=this.volumeLevelAnalyser.getAnalyserNode();let r0;n0.getFloatTimeDomainData?(r0=new Float32Array(n0.fftSize),n0.getFloatTimeDomainData(r0)):(r0=new Uint8Array(n0.fftSize),n0.getByteTimeDomainData(r0));let i0=!1;for(let o0=0;o0<r0.length;o0++)r0[o0]!==0&&(i0=!0);return i0?(this.isNoAudioInput=!1,!0):(await mA(200),await this.checkHasAudioInput(e0?e0+1:1)&&i0)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e0){this.outputNode.gain.setValueAtTime(e0,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e0,n0;(e0=this.processedNode)===null||e0===void 0||e0.disconnect(),(n0=this.sourceNode)===null||n0===void 0||n0.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e0;this.processedNode?(e0=this.processedNode)===null||e0===void 0||e0.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ek extends $L{get isFreeze(){return!1}constructor(e0,n0,r0){var i0;if(super(),BL(this,"sourceNode",void 0),BL(this,"track",void 0),BL(this,"clonedTrack",void 0),BL(this,"audioElement",void 0),BL(this,"isCurrentTrackCloned",!1),BL(this,"isRemoteTrack",!1),BL(this,"originVolumeLevelAnalyser",void 0),BL(this,"rebuildWebAudio",async()=>{if(fb.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void fb.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>fb.info("resume success")),fb.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const a0=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?a0.stop():this.isCurrentTrackCloned=!0;const c0=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(c0),JL(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const u0=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u0,this.context.currentTime),JL(this.outputNode),this.emit(yL.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=c0,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e0.kind!=="audio")throw new Cy(Ry.UNEXPECTED_ERROR);this.track=e0;const o0=new MediaStream([this.track]);if(this.isRemoteTrack=!!n0,this.sourceNode=this.context.createMediaStreamSource(o0),JL(this.sourceNode),r0){const a0=r0.clone();a0.enabled=!0,this.clonedTrack=a0,fb.debug("create an unmuted track ".concat(a0.id," from the original track ").concat(r0.id," to get the volume"));const c0=this.context.createMediaStreamSource(new MediaStream([a0]));JL(c0),this.originVolumeLevelAnalyser=new ZL,this.originVolumeLevelAnalyser.updateSource(c0)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=o0;const s0=Hv();n0&&s0.os===Fv.IOS&&Number((i0=s0.osVersion)===null||i0===void 0?void 0:i0.split(".")[0])<15&&(qL.on(tL.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(a0=>{a0||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e0){this.sourceNode.disconnect(),this.track=e0,this.isCurrentTrackCloned=!1;const n0=new MediaStream([e0]);this.sourceNode=this.context.createMediaStreamSource(n0),JL(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(yL.UPDATE_SOURCE),this.audioElement.srcObject=n0}destroy(){var e0;this.audioElement.srcObject=null,this.audioElement.remove(),qL.off("state-change",this.rebuildWebAudio),(e0=this.originVolumeLevelAnalyser)===null||e0===void 0||e0.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e0){return this.context.createMediaStreamSource(new MediaStream([e0]))}updateOriginTrack(e0){const n0=e0.clone();n0.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n0),fb.debug("create an unmuted track ".concat(n0.id," from the original track ").concat(e0.id," to get the volume"));const r0=this.context.createMediaStreamSource(new MediaStream([n0]));JL(r0),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r0)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function tk(t0,e0,n0){const r0=(o0,s0)=>o0?typeof o0!="number"?o0.max||o0.exact||o0.ideal||o0.min||s0:o0:s0,i0={audio:!!n0&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t0,maxHeight:r0(e0.height,1080),maxWidth:r0(e0.width,1920)}}};return e0.frameRate&&typeof e0.frameRate!="number"?(i0.video.mandatory.maxFrameRate=e0.frameRate.max,i0.video.mandatory.minFrameRate=e0.frameRate.min):typeof e0.frameRate=="number"&&(i0.video.mandatory.maxFrameRate=e0.frameRate),await navigator.mediaDevices.getUserMedia(i0)}async function ik(t0,e0){const n0=await nk(t0.mediaSource),{sourceId:r0,audio:i0}=await function(o0){let s0=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Gh((a0,c0)=>{const u0=document.createElement("div");u0.innerText="share screen",u0.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const l0=document.createElement("div");l0.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const d0=document.createElement("div");d0.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",d0.setAttribute("style","height: 12%;");const h0=document.createElement("div");h0.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const p0=document.createElement("div");p0.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const m0=document.createElement("button");m0.innerHTML="cancel",m0.setAttribute("style","width: 85px;"),m0.onclick=()=>{document.body.removeChild(E0);const _0=new Error("NotAllowedError");_0.name="NotAllowedError",c0(_0)};let f0=s0;const g0=document.createElement("div");if(s0){const _0=document.createElement("input");_0.setAttribute("type","checkbox");const y0=document.createElement("span");_0.setAttribute("style","margin-right: 6px;"),y0.innerText="Share audio",_0.checked=f0,_0.onchange=()=>{f0=_0.checked},g0.appendChild(_0),g0.appendChild(y0)}p0.appendChild(g0),p0.appendChild(m0),l0.appendChild(d0),l0.appendChild(h0),l0.appendChild(p0);const E0=document.createElement("div");E0.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),E0.appendChild(u0),E0.appendChild(l0),document.body.appendChild(E0),o0.map(_0=>{if(_0.id){const y0=document.createElement("div");y0.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let b0=_0.thumbnail;try{const{width:S0}=b0.getSize();S0>1920&&(b0=b0.resize({width:1920}))}catch(S0){throw S0&&S0.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),S0}y0.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+b0.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+_0.name.replace(/[\u00A0-\u9999<>\&]/g,function(S0){return"&#"+S0.charCodeAt(0)+";"})+"</span>",y0.onclick=()=>{document.body.removeChild(E0),a0({sourceId:_0.id,audio:f0})},h0.appendChild(y0)}})})}(n0,e0);return await tk(r0,t0,i0)}async function nk(t0){let e0=["window","screen"];t0!=="application"&&t0!=="window"||(e0=["window"]),t0==="screen"&&(e0=["screen"]);const n0=Fy();if(!n0)throw console.error("failed to fetch electron, please mount it to window"),new Cy(Ry.ELECTRON_IS_NULL);let r0=null;try{var i0;r0=((i0=n0.desktopCapturer)===null||i0===void 0?void 0:i0.getSources({types:e0}))||n0.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e0})}catch{r0=null}r0&&r0.then||(r0=new Gh((o0,s0)=>{n0.desktopCapturer.getSources({types:e0},(a0,c0)=>{a0?s0(a0):o0(c0)})}));try{return await r0}catch(o0){throw new Cy(Ry.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o0.toString())}}const rk=new NA("safari");let ok=!1,sk=!1;async function ak(t0,e0){let n0=0,r0=null;for(;n0<2;)try{r0=await ck(t0,e0,n0>0);break}catch(i0){if(i0 instanceof Cy)throw fb.error("[".concat(e0,"] ").concat(i0.toString())),i0;const o0=dk(i0.name||i0.code||i0,i0.message);if(o0.code===Ry.MEDIA_OPTION_INVALID){fb.debug("[".concat(e0,"] detect media option invalid, retry")),n0+=1,await mA(500);continue}throw fb.error("[".concat(e0,"] ").concat(o0.toString())),o0}if(!r0)throw new Cy(Ry.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r0}async function ck(t0,e0,n0){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Cy(Ry.NOT_SUPPORTED,"can not find getUserMedia");n0&&(t0.video&&(delete t0.video.width,delete t0.video.height),t0.screen&&(delete t0.screen.width,delete t0.screen.height));const r0=ZP(),i0=new MediaStream;if(t0.audioSource&&i0.addTrack(t0.audioSource),t0.videoSource&&i0.addTrack(t0.videoSource),!t0.audio&&!t0.video&&!t0.screen)return fb.debug("Using Video Source/ Audio Source"),i0;if(t0.screen)if(Fy())t0.screen.sourceId?lk(i0,await tk(t0.screen.sourceId,t0.screen,t0.screenAudio)):lk(i0,await ik(t0.screen,t0.screenAudio));else if(Jv()&&t0.screen.extensionId&&t0.screen.mandatory){if(!r0.getStreamFromExtension)throw new Cy(Ry.NOT_SUPPORTED,"This browser does not support screen sharing");fb.debug("[".concat(e0,'] Screen access on chrome stable, looking for extension"'));const h0=await(s0=t0.screen.extensionId,a0=e0,new Gh((p0,m0)=>{try{chrome.runtime.sendMessage(s0,{getStream:!0},f0=>{if(!f0||!f0.streamId)return fb.error("[".concat(a0,"] No response from Chrome Plugin. Plugin not installed properly"),f0),void m0(new Cy(Ry.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));p0(f0.streamId)})}catch(f0){fb.error("[".concat(a0,"] AgoraRTC screensharing plugin is not accessible(").concat(s0,")"),f0.toString()),m0(new Cy(Ry.CHROME_PLUGIN_NOT_INSTALL))}}));t0.screen.mandatory.chromeMediaSourceId=h0,lk(i0,await navigator.mediaDevices.getUserMedia({video:{mandatory:t0.screen.mandatory}}))}else if(r0.getDisplayMedia){var o0;t0.screen.mediaSource&&EL(t0.screen.mediaSource);const h0={width:t0.screen.width,height:t0.screen.height,frameRate:t0.screen.frameRate,displaySurface:(o0=t0.screen.displaySurface)!==null&&o0!==void 0?o0:t0.screen.mediaSource==="screen"?"monitor":t0.screen.mediaSource},{selfBrowserSurface:p0,surfaceSwitching:m0,systemAudio:f0}=t0.screen,g0={selfBrowserSurface:p0,surfaceSwitching:m0,systemAudio:f0};!p0&&delete g0.selfBrowserSurface,!m0&&delete g0.surfaceSwitching,!f0&&delete g0.systemAudio,fb.debug("[".concat(e0,"] getDisplayMedia:"),JSON.stringify({video:h0,audio:!!t0.screenAudio,controls:g0})),lk(i0,await navigator.mediaDevices.getDisplayMedia(GL({video:h0,audio:!!t0.screenAudio},g0)))}else{if(!Zv())throw fb.error("[".concat(e0,"] This browser does not support screenSharing")),new Cy(Ry.NOT_SUPPORTED,"This browser does not support screen sharing");{t0.screen.mediaSource&&EL(t0.screen.mediaSource);const h0={video:{mediaSource:t0.screen.mediaSource,width:t0.screen.width,height:t0.screen.height,frameRate:t0.screen.frameRate}};fb.debug("[".concat(e0,"] getUserMedia: ").concat(JSON.stringify(h0))),lk(i0,await navigator.mediaDevices.getUserMedia(h0))}}var s0,a0;if(!t0.video&&!t0.audio)return i0;let c0={video:t0.video,audio:t0.audio},u0=XA("MEDIA_DEVICE_CONSTRAINTS");if(u0)try{typeof u0=="string"&&(u0=JSON.parse(u0)),c0=vA(c0,u0)}catch{}fb.debug("[".concat(e0,"] GetUserMedia"),JSON.stringify(c0)),Hv();let l0,d0=null;(Xv()||$v()||zv())&&(d0=await rk.lock());try{l0=await navigator.mediaDevices.getUserMedia(c0)}catch(h0){throw d0&&d0(),h0}return c0.audio&&(ok=!0),c0.video&&(sk=!0),lk(i0,l0),d0&&d0(),i0}function dk(t0,e0){switch(t0){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Cy(Ry.MEDIA_OPTION_INVALID,"".concat(t0,": ").concat(e0));case"NotFoundError":case"DevicesNotFoundError":return new Cy(Ry.DEVICE_NOT_FOUND,"".concat(t0,": ").concat(e0));case"NotSupportedError":return new Cy(Ry.NOT_SUPPORTED,"".concat(t0,": ").concat(e0));case"NotReadableError":return new Cy(Ry.NOT_READABLE,"".concat(t0,": ").concat(e0));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Cy(Ry.PERMISSION_DENIED,"".concat(t0,": ").concat(e0));case"ConstraintNotSatisfiedError":return new Cy(Ry.CONSTRAINT_NOT_SATISFIED,"".concat(t0,": ").concat(e0));default:return fb.error("getUserMedia unexpected error",t0),new Cy(Ry.UNEXPECTED_ERROR,"".concat(t0,": ").concat(e0))}}function lk(t0,e0){const n0=t0.getVideoTracks()[0],r0=t0.getAudioTracks()[0],i0=e0.getVideoTracks()[0],o0=e0.getAudioTracks()[0];o0&&(r0&&t0.removeTrack(r0),t0.addTrack(o0)),i0&&(n0&&t0.removeTrack(n0),t0.addTrack(i0))}const uk=new class extends xy{get state(){return this._state}set state(t0){t0!==this._state&&(this.emit(kL.STATE_CHANGE,t0),this._state=t0)}constructor(){super(),BL(this,"_state",LL.IDLE),BL(this,"isAccessMicrophonePermission",!1),BL(this,"isAccessCameraPermission",!1),BL(this,"lastAccessMicrophonePermission",!1),BL(this,"lastAccessCameraPermission",!1),BL(this,"checkdeviceMatched",!1),BL(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(XA("ENUMERATE_DEVICES_INTERVAL")||(fy()||Yv()===Fv.HARMONY_OS)&&Ey())&&this.updateDevicesInfo()},XA("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t0=>fb.error(t0.toString()))}async enumerateDevices(t0,e0){let n0=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Cy(Ry.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r0=await navigator.mediaDevices.enumerateDevices(),i0=this.checkMediaDeviceInfoIsOk(r0);let o0=!this.isAccessMicrophonePermission&&t0,s0=!this.isAccessCameraPermission&&e0;i0.audio&&(o0=!1),i0.video&&(s0=!1);let a0=null,c0=null,u0=null;if(!n0&&(o0||s0)){if(rk.isLocked&&(fb.debug("[device manager] wait GUM lock"),(await rk.lock())(),fb.debug("[device manager] GUM unlock")),ok&&(o0=!1,this.isAccessMicrophonePermission=!0),sk&&(s0=!1,this.isAccessCameraPermission=!0),fb.debug("[device manager] check media device permissions",t0,e0,o0,s0),o0&&s0){try{u0=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(l0){const d0=dk(l0.name||l0.code||l0,l0.message);if(d0.code===Ry.PERMISSION_DENIED)throw d0;fb.warning("getUserMedia failed in getDevices",d0)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o0){try{a0=await navigator.mediaDevices.getUserMedia({audio:t0})}catch(l0){const d0=dk(l0.name||l0.code||l0,l0.message);if(d0.code===Ry.PERMISSION_DENIED)throw d0;fb.warning("getUserMedia failed in getDevices",d0)}this.isAccessMicrophonePermission=!0}else if(s0){try{c0=await navigator.mediaDevices.getUserMedia({video:e0})}catch(l0){const d0=dk(l0.name||l0.code||l0,l0.message);if(d0.code===Ry.PERMISSION_DENIED)throw d0;fb.warning("getUserMedia failed in getDevices",d0)}this.isAccessCameraPermission=!0}fb.debug("[device manager] mic permission",t0,"cam permission",e0)}try{const l0=await navigator.mediaDevices.enumerateDevices();return a0&&a0.getTracks().forEach(d0=>d0.stop()),c0&&c0.getTracks().forEach(d0=>d0.stop()),u0&&u0.getTracks().forEach(d0=>d0.stop()),a0=null,c0=null,u0=null,l0}catch(l0){return a0&&a0.getTracks().forEach(d0=>d0.stop()),c0&&c0.getTracks().forEach(d0=>d0.stop()),u0&&u0.getTracks().forEach(d0=>d0.stop()),a0=null,c0=null,u0=null,new Cy(Ry.ENUMERATE_DEVICES_FAILED,l0.toString()).throw()}}async getRecordingDevices(){let t0=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t0)).filter(e0=>e0.kind==="audioinput")}async getCamerasDevices(){let t0=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t0)).filter(e0=>e0.kind==="videoinput")}async getSpeakers(){let t0=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t0)).filter(e0=>e0.kind==="audiooutput")}searchDeviceIdByName(t0){let e0=null;return this.deviceInfoMap.forEach(n0=>{n0.device.label===t0&&(e0=n0.device.deviceId)}),e0}async getDeviceById(t0){const e0=(await this.enumerateDevices(!0,!0,!0)).find(n0=>n0.deviceId===t0);if(!e0)throw new Cy(Ry.DEVICE_NOT_FOUND,"deviceId: ".concat(t0));return e0}async init(){this.state=LL.INITING;try{await this.updateDevicesInfo(),this.state=LL.INITEND}catch(t0){throw fb.warning("Device Detection functionality cannot start properly.",t0.toString()),this.state=LL.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Cy(Ry.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t0}}async updateDevicesInfo(){const t0=await this.enumerateDevices(!0,!0,!0),e0=Date.now(),n0=[];if(t0[0]&&t0[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i0=t0.find(s0=>s0.kind==="audioinput"&&s0.deviceId==="default"),o0=t0.find(s0=>s0.kind==="audiooutput"&&s0.deviceId==="default");i0&&o0?o0.groupId===i0.groupId?fb.debug("[device-check] default input ".concat(i0.label," and output ").concat(o0.label," is the same group")):fb.warning("[device-check] default input ".concat(i0.label," and output ").concat(o0.label," is not the same group")):fb.debug("[device-check] default input or output not found")}const r0=this.checkMediaDeviceInfoIsOk(t0);if(t0.forEach(i0=>{if(!i0.deviceId)return;const o0=this.deviceInfoMap.get("".concat(i0.kind,"_").concat(i0.deviceId));if((o0?o0.state:"INACTIVE")!=="ACTIVE"){const s0={initAt:e0,updateAt:e0,device:i0,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i0.kind,"_").concat(i0.deviceId),s0),n0.push(s0)}o0&&(o0.updateAt=e0)}),this.deviceInfoMap.forEach((i0,o0)=>{i0.state==="ACTIVE"&&i0.updateAt!==e0&&(i0.state="INACTIVE",n0.push(i0))}),this.state!==LL.INITEND)return r0.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r0.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n0.forEach(i0=>{switch(i0.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(kL.RECORDING_DEVICE_CHANGED,i0);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(kL.CAMERA_DEVICE_CHANGED,i0);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(kL.PLAYOUT_DEVICE_CHANGED,i0)}}),r0.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r0.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t0){const e0=t0.filter(i0=>i0.kind==="audioinput"),n0=t0.filter(i0=>i0.kind==="videoinput"),r0={audio:!1,video:!1};for(const i0 of e0)if(i0.label&&i0.deviceId){r0.audio=!0;break}for(const i0 of n0)if(i0.label&&i0.deviceId){r0.video=!0;break}return r0}};let hk=!1;const pk=new class extends xy{constructor(){super(...arguments),BL(this,"onAutoplayFailed",void 0),BL(this,"onAudioAutoplayFailed",void 0)}};function _k(){if(Hv(),!hk){const t0=e0=>{e0.preventDefault(),hk=!1,my()?document.body.removeEventListener("click",t0,!0):(document.body.removeEventListener("touchstart",t0,!0),document.body.removeEventListener("mousedown",t0,!0))};hk=!0,my()?document.body.addEventListener("click",t0,!0):(document.body.addEventListener("touchstart",t0,!0),document.body.addEventListener("mousedown",t0,!0)),fb.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),pk.onAutoplayFailed?pk.onAutoplayFailed():pk.onAudioAutoplayFailed?fb.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):fb.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),pk.emit("autoplay-failed")}}function Ek(t0,e0,n0,r0){if(!t0)return;const i0=vb.getBaseInfoBySessionId(t0);if(!i0)return;const o0=i0.info,s0=Date.now(),a0=GL(GL({},o0),{},{vid:o0.vid===void 0?0:Number(o0.vid),lts:s0,elapse:s0-i0.startTime,cbRegistered:pk.onAutoplayFailed||pk.onAudioAutoplayFailed?1:-1,errorMsg:n0,mediaType:e0,trackId:r0,extend:void 0});vb.send({type:Rb.AUTOPLAY_FAILED,data:a0},!0)}const fk=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],mk=new class{constructor(){BL(this,"onAutoplayFailed",void 0),BL(this,"elementMap",new Map),BL(this,"elementStateMap",new Map),BL(this,"elementsNeedToResume",[]),BL(this,"sinkIdMap",new Map),BL(this,"autoResumeAfterInterruption",t0=>{Array.from(this.elementMap.entries()).forEach(e0=>{let[n0,r0]=e0;const i0=this.elementStateMap.get(n0),o0=r0.srcObject.getAudioTracks()[0],s0=o0&&o0.readyState;if(fb.debug("resume after interrupted, ele: ".concat(i0," audio: ").concat(s0," ").concat(t0)),s0==="live"){if(t0)return r0.pause(),void r0.play();if(qL.curState==="running")return cy()?(r0.pause(),void r0.play()):void(i0&&i0==="paused"&&r0.play())}})}),BL(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t0=>{let[e0,n0]=t0;const r0=n0.srcObject.getAudioTracks()[0];r0&&r0.readyState==="live"&&(fb.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n0.pause(),n0.play())})}),this.autoResumeAudioElement(),qL.on(tL.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qL.on(tL.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),qL.on(tL.STATE_CHANGE,()=>{$v()&&qL.prevState==="suspended"&&qL.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t0,e0){const n0=this.elementMap.get(t0);if(this.sinkIdMap.set(t0,e0),n0)try{await n0.setSinkId(e0)}catch(r0){throw new Cy(Ry.PERMISSION_DENIED,"can not set sink id: "+r0.toString())}}play(t0,e0,n0,r0){if(this.elementMap.has(e0))return;const i0=document.createElement("audio");i0.autoplay=!0,i0.srcObject=new MediaStream([t0]),this.bindAudioElementEvents(e0,i0),this.elementMap.set(e0,i0),this.elementStateMap.set(e0,ML.INIT),this.setVolume(e0,n0);const o0=this.sinkIdMap.get(e0);if(o0)try{i0.setSinkId(o0).catch(a0=>{fb.warning("[".concat(e0,"] set sink id failed"),a0.toString())})}catch(a0){fb.warning("[".concat(e0,"] set sink id failed"),a0.toString())}const s0=i0.play();s0&&s0.then&&s0.catch(a0=>{r0&&Ek(r0,"audio",a0.message,e0),fb.warning("audio element play warning",a0.toString()),this.elementMap.has(e0)&&a0.name==="NotAllowedError"&&(fb.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i0),oA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),_k()}))})}updateTrack(t0,e0){const n0=this.elementMap.get(t0);n0&&(n0.srcObject=new MediaStream([e0]))}isPlaying(t0){return this.elementMap.has(t0)&&this.elementStateMap.get(t0)==="playing"}setVolume(t0,e0){const n0=this.elementMap.get(t0);n0&&(e0=Math.max(0,Math.min(100,e0)),n0.volume=e0/100)}stop(t0){const e0=this.elementMap.get(t0);if(this.sinkIdMap.delete(t0),!e0)return;const n0=this.elementsNeedToResume.indexOf(e0);this.elementsNeedToResume.splice(n0,1),e0.srcObject=null,e0.remove(),this.elementMap.delete(t0),this.elementStateMap.delete(t0)}bindAudioElementEvents(t0,e0){fk.forEach(n0=>{e0.addEventListener(n0,r0=>{const i0=this.elementStateMap.get(t0),o0=r0.type==="pause"?"paused":r0.type;if(fb.debug("[".concat(t0,"] audio-element-status change ").concat(i0," => ").concat(o0)),r0.type==="error"){const s0=e0==null?void 0:e0.error;s0&&fb.error("[".concat(t0,"] media error, code: ").concat(s0.code,", message: ").concat(s0.message))}this.elementStateMap.set(t0,o0)})})}getPlayerState(t0){return this.elementStateMap.get(t0)||"uninit"}autoResumeAudioElement(){const t0=()=>{this.elementsNeedToResume.forEach(e0=>{e0.play().then(n0=>{fb.debug("Auto resume audio element success")}).catch(n0=>{fb.warning("Auto resume audio element failed!",n0)})}),this.elementsNeedToResume=[]};new Gh(e0=>{document.body?e0():window.addEventListener("load",()=>e0())}).then(()=>{my()?document.body.addEventListener("click",t0,!0):(document.body.addEventListener("touchstart",t0,!0),document.body.addEventListener("mousedown",t0,!0))})}};function Tk(){return function(t0,e0,n0){const r0=n0.value;return typeof r0=="function"&&(n0.value=function(){this._isClosed&&new Cy(Ry.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",fb);for(var i0=arguments.length,o0=new Array(i0),s0=0;s0<i0;s0++)o0[s0]=arguments[s0];const a0=r0.apply(this,o0);return a0 instanceof Gh?new Gh((c0,u0)=>{a0.then(c0).catch(u0)}):a0}),n0}}class Sk extends xy{constructor(e0){super(),BL(this,"name","VideoProcessorDestination"),BL(this,"ID","0"),BL(this,"_source",void 0),BL(this,"videoContext",void 0),BL(this,"inputTrack",void 0),this.videoContext=e0}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Cy(Ry.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Cy(Ry.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e0){if(e0.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e0.track&&e0.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e0.track,this.emit(DL.ON_TRACK,e0.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(DL.ON_TRACK,void 0)}}class gk extends xy{set chained(e0){this._chained=e0}get chained(){return this._chained}constructor(e0,n0){super(),BL(this,"constraintsMap",new Map),BL(this,"statsRegistry",[]),BL(this,"usageRegistry",[]),BL(this,"trackId",void 0),BL(this,"direction",void 0),BL(this,"_chained",!1),this.trackId=e0,this.direction=n0}async getConstraints(){return await Zy(this,PL.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e0,n0){var r0;return fb.info("processor ".concat(n0.name," requestApplyConstraints for ").concat(this.trackId)),e0&&this.constraintsMap.set(n0,e0),$y(this,PL.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(r0=this.constraintsMap).call(r0)))}async requestRevertConstraints(e0){var n0;if(this.constraintsMap.has(e0))return fb.info("processor ".concat(e0.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e0),$y(this,PL.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(n0=this.constraintsMap).call(n0)))}registerStats(e0,n0,r0){this.statsRegistry.find(i0=>i0.processorID===e0.ID&&i0.processorName===e0.name&&i0.type===n0)||this.statsRegistry.push({processorName:e0.name,processorID:e0.ID,type:n0,cb:r0})}unregisterStats(e0,n0){const r0=this.statsRegistry.findIndex(i0=>i0.processorID===e0.ID&&i0.processorName===e0.name&&i0.type===n0);r0!==-1&&this.statsRegistry.splice(r0,1)}gatherStats(){const e0=[];for(const{processorID:n0,processorName:r0,type:i0,cb:o0}of this.statsRegistry)try{const s0=o0();e0.push({processorID:n0,processorName:r0,type:i0,stats:s0})}catch(s0){fb.error(new Cy(Ry.UNEXPECTED_ERROR,s0.message))}return e0}registerUsage(e0,n0){this.usageRegistry.find(r0=>r0.processorID===e0.ID&&r0.processorName===e0.name)||this.usageRegistry.push({processorID:e0.ID,processorName:e0.name,cb:n0})}unregisterUsage(e0){const n0=this.usageRegistry.findIndex(r0=>r0.processorID===e0.ID&&r0.processorName===e0.name);n0!==-1&&this.usageRegistry.splice(n0,1)}async gatherUsage(){const e0=[];if(!this.chained)return[];for(const{cb:n0}of this.usageRegistry)try{let r0=n0();r0 instanceof Gh&&(r0=await r0),e0.push(GL(GL({},r0),{},{direction:this.direction}))}catch(r0){fb.error("gather extension usage error",r0)}return e0}getDirection(){return this.direction}}class Rk extends xy{constructor(e0){super(),BL(this,"name","AudioProcessorDestination"),BL(this,"ID","0"),BL(this,"inputTrack",void 0),BL(this,"inputNode",void 0),BL(this,"audioProcessorContext",void 0),BL(this,"_source",void 0),this.audioProcessorContext=e0}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Cy(Ry.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Cy(Ry.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(DL.ON_TRACK,void 0),this.emit(DL.ON_NODE,void 0)}updateInput(e0){if(e0.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e0.track&&this.inputTrack!==e0.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e0.track,this.emit(DL.ON_TRACK,this.inputTrack)),e0.node&&this.inputNode!==e0.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e0.node,this.emit(DL.ON_NODE,this.inputNode))}}class Ck extends xy{set chained(e0){this._chained=e0}get chained(){return this._chained}constructor(e0,n0,r0){super(),BL(this,"constraintsMap",new Map),BL(this,"statsRegistry",[]),BL(this,"audioContext",void 0),BL(this,"trackId",void 0),BL(this,"direction",void 0),BL(this,"usageRegistry",[]),BL(this,"_chained",!1),this.audioContext=e0,this.trackId=n0,this.direction=r0}async getConstraints(){return Zy(this,PL.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e0,n0){var r0;return fb.info("processor ".concat(n0.name," requestApplyConstraints for ").concat(this.trackId)),e0&&this.constraintsMap.set(n0,e0),$y(this,PL.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(r0=this.constraintsMap).call(r0)))}async requestRevertConstraints(e0){var n0;if(this.constraintsMap.has(e0))return this.constraintsMap.delete(e0),$y(this,PL.REQUEST_UPDATE_CONSTRAINTS,Array.from(_N(n0=this.constraintsMap).call(n0)))}registerStats(e0,n0,r0){this.statsRegistry.find(i0=>i0.processorID===e0.ID&&i0.processorName===e0.name&&i0.type===n0)||this.statsRegistry.push({processorName:e0.name,processorID:e0.ID,type:n0,cb:r0})}unregisterStats(e0,n0){const r0=this.statsRegistry.findIndex(i0=>i0.processorID===e0.ID&&i0.processorName===e0.name&&i0.type===n0);r0!==-1&&this.statsRegistry.splice(r0,1)}gatherStats(){const e0=[];for(const{processorID:n0,processorName:r0,type:i0,cb:o0}of this.statsRegistry)try{const s0=o0();e0.push({processorID:n0,processorName:r0,type:i0,stats:s0})}catch(s0){fb.error(new Cy(Ry.UNEXPECTED_ERROR,s0.message))}return e0}registerUsage(e0,n0){this.usageRegistry.find(r0=>r0.processorID===e0.ID&&r0.processorName===e0.name)||this.usageRegistry.push({processorID:e0.ID,processorName:e0.name,cb:n0})}unregisterUsage(e0){const n0=this.usageRegistry.findIndex(r0=>r0.processorID===e0.ID&&r0.processorName===e0.name);n0!==-1&&this.usageRegistry.splice(n0,1)}async gatherUsage(){const e0=[];if(!this.chained)return[];for(const{cb:n0}of this.usageRegistry)try{let r0=n0();r0 instanceof Gh&&(r0=await r0),e0.push(GL(GL({},r0),{},{direction:this.direction}))}catch(r0){fb.error("gather extension usage error",r0)}return e0}getDirection(){return this.direction}}class Ik extends xy{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),BL(this,"context",void 0),BL(this,"processSourceNode",void 0),BL(this,"outputTrack",void 0),BL(this,"processedNode",void 0),BL(this,"clonedTrack",void 0),BL(this,"outputNode",void 0),this.outputNode=new vk}setVolume(){}createOutputTrack(){throw new Cy(Ry.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class vk{disconnect(){}connect(){}}function yk(t0){return new Gh((e0,n0)=>{let r0=!1;const i0=document.createElement("video");i0.setAttribute("autoplay",""),i0.setAttribute("muted",""),i0.muted=!0,i0.autoplay=!0,i0.setAttribute("playsinline",""),i0.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i0);const o0=$v()?"canplay":"playing";i0.addEventListener(o0,()=>{const s0=i0.videoWidth,a0=i0.videoHeight;!s0&&Zv()||(r0=!0,i0.srcObject=null,i0.remove(),e0([s0,a0]))}),i0.srcObject=new MediaStream([t0]),i0.play().catch(gA),setTimeout(()=>{r0||(i0.srcObject=null,i0.remove(),e0([i0.videoWidth,i0.videoHeight]))},4e3)})}function Ak(t0){const e0={};t0.facingMode&&(e0.facingMode=t0.facingMode),t0.cameraId&&(e0.deviceId={exact:t0.cameraId});const n0=dL(t0.encoderConfig);return n0.width!=null&&(e0.width=n0.width),n0.height!=null&&(e0.height=n0.height),!py()&&n0.frameRate&&(e0.frameRate=n0.frameRate),Qv()&&typeof e0.frameRate=="object"&&(e0.frameRate.max=60),Zv()&&(e0.frameRate={ideal:30,max:30}),e0}function bk(t0){const e0={};if(py()||(t0.AGC!==void 0&&(e0.autoGainControl=t0.AGC),t0.AEC!==void 0&&(e0.echoCancellation=t0.AEC),t0.ANS!==void 0&&(e0.noiseSuppression=t0.ANS,Jv()&&t0.ANS&&(e0.googHighpassFilter=t0.ANS))),t0.encoderConfig){const n0=pL(t0.encoderConfig);e0.channelCount=n0.stereo?2:1,e0.sampleRate=n0.sampleRate,e0.sampleSize=n0.sampleSize}return t0.microphoneId&&(e0.deviceId={exact:t0.microphoneId}),fy()&&(e0.sampleRate=void 0),e0}const wk=t0=>{const e0=t0._encoderConfig;if(!e0)return;const{frameRate:n0,width:r0,height:i0}=t0.getMediaStreamTrackSettings();let{frameRate:o0=n0,width:s0=r0,height:a0=i0}=e0;if(!o0||!s0||!a0)return;s0=AA(s0),a0=AA(a0),o0=AA(o0);const{max:c0,min:u0}=function(p0,m0,f0){const g0=200*Math.pow(f0/15,.6)*Math.pow(p0*m0/640/360,.75);return{min:Math.floor(g0),max:Math.floor(4*g0)}}(s0,a0,o0),{bitrateMax:l0,bitrateMin:d0}=e0||{};l0||fb.debug("calculate bitrate: [w: ".concat(s0,", h: ").concat(a0,", fps: ").concat(o0,"] => [brMax: ").concat(l0,", brMin: ").concat(d0,"]"));const{maxFramerate:h0}=XA("ENCODER_CONFIG_LIMIT");return h0&&typeof h0=="number"&&(o0=Math.min(o0,h0)),{frameRate:o0,bitrateMax:l0||c0,bitrateMin:d0||u0,scaleResolutionDownBy:1,scale:0}},Ok=async(t0,e0,n0)=>await(async(r0,i0,o0)=>{const s0=function(u0){const l0=[];for(let d0=0;d0<u0.length;d0+=2)l0.push(parseInt(u0.slice(d0,d0+2),16));return Uint8Array.from(l0)}(bA(""+i0+o0)).slice(0,16),a0=s0.slice(0,12),c0=await window.crypto.subtle.importKey("raw",s0,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a0},c0,r0))})(t0.buffer,e0,n0),Nk=t0=>{const e0=document.createElement("canvas");return e0.width=2,e0.height=2,new Gh((n0,r0)=>{e0.toBlob(async i0=>{if(e0.remove(),i0){const o0=await Dk(i0);n0({buffer:o0,width:e0.width,height:e0.height})}else r0(new Cy(Ry.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t0,1)})},Dk=async t0=>{const e0=await t0.arrayBuffer();return new Uint8Array(e0)};var Pk,Lk,kk,Mk,Uk,xk,Vk,Fk,Bk,jk,Gk,Wk,Hk,Kk,Yk,qk,zk,Jk,Xk,Qk,Zk,$k,eM,tM,iM,nM,rM,oM,sM,aM,cM,dM,lM,uM,hM,pM,_M,EM,fM,mM;let TM=(Pk=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0],throttleTime:300}),Lk=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0]}),kk=Tk(),Mk=DA("LocalAudioTrack","_enabledMutex"),Uk=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0]}),xk=Tk(),Vk=DA("LocalAudioTrack","_enabledMutex"),Fk=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0]}),Bk=Tk(),jk=Tk(),Gk=Tk(),Wk=Ib({argsMap:t0=>[t0.getTrackId()]}),Hk=Tk(),Kk=Ib({argsMap:t0=>[t0.getTrackId()]}),Yk=Tk(),qk=Ib({argsMap:t0=>[t0.getTrackId()]}),zk=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0.name]}),Jk=Ib({argsMap:t0=>[t0.getTrackId()]}),FL((Xk=class extends HL{get _source(){return this.initWebAudio()}set _source(t0){this._trackSource=t0}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?mk.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t0,e0,n0,r0){super(t0,n0),BL(this,"trackMediaType",vL.AUDIO),BL(this,"_encoderConfig",void 0),BL(this,"_trackSource",void 0),BL(this,"_enabled",!0),BL(this,"_volume",100),BL(this,"_useAudioElement",!0),BL(this,"_bypassWebAudio",!1),BL(this,"processor",void 0),BL(this,"_processorContext",void 0),BL(this,"_processorDestination",void 0),BL(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e0,this._getOriginVolumeLevel=!!r0,this._trackSource=new Ik,XA("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),XA("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Xv()&&!YL?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t0){yy(t0,"volume",0,1e3),this._volume=t0,this._source.setVolume(t0/100),this._useAudioElement&&mk.setVolume(this.getTrackId(),t0);try{if(this._bypassWebAudio)return void fb.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e0=this._source.createOutputTrack();this._mediaStreamTrack!==e0&&(this._mediaStreamTrack=e0,$y(this,fL.NEED_REPLACE_TRACK,this).then(()=>{fb.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n0=>{fb.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n0)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t0){if(!this._useAudioElement||!$P())throw new Cy(Ry.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mk.setSinkID(this.getTrackId(),t0)}async setEnabled(t0,e0,n0){return this._setEnabled(t0,e0,n0)}async _setEnabled(t0,e0,n0){if(!n0){if(t0===this._enabled)return;this.stateCheck("enabled",t0)}if(fb.info("[".concat(this.getTrackId(),"] start setEnabled"),t0),t0){this._originMediaStreamTrack.enabled=!0;try{n0||(this._enabled=!0),await $y(this,fL.NEED_ENABLE_TRACK,this),fb.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t0," success"))}catch(r0){throw n0||(this._enabled=!1),fb.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r0.toString()),r0}}else{this._originMediaStreamTrack.enabled=!1,n0||(this._enabled=!1);try{await $y(this,fL.NEED_DISABLE_TRACK,this)}catch(r0){throw n0||(this._enabled=!0),fb.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r0.toString()),r0}}}async setMuted(t0){t0!==this._muted&&(this.stateCheck("muted",t0),this._muted=t0,this._originMediaStreamTrack.enabled=!t0,fb.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t0)),t0?await $y(this,fL.NEED_MUTE_TRACK,this):await $y(this,fL.NEED_UNMUTE_TRACK,this))}getStats(){return dA(()=>{fb.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),eA(this,fL.GET_STATS)||GL({},AL)}setAudioFrameCallback(t0){let e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t0)return this._source.removeAllListeners(yL.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e0),this._source.removeAllListeners(yL.ON_AUDIO_BUFFER),this._source.on(yL.ON_AUDIO_BUFFER,n0=>t0(n0))}play(){fb.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(fb.debug("[".concat(this.getTrackId(),"] start audio playback in element")),mk.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){fb.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?mk.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t0=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];fb.debug("[".concat(this.getTrackId(),"] update player source track")),t0&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mk.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t0,e0){this._originMediaStreamTrack!==t0&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e0&&this._originMediaStreamTrack.stop()),t0.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t0,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t0,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,fL.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t0))}renewMediaStreamTrack(t0){return Gh.resolve(void 0)}pipe(t0){if(this._bypassWebAudio)throw new Cy(Ry.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t0)return t0;if(t0._source)throw new Cy(Ry.INVALID_OPERATION,"Processor ".concat(t0.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t0,this.processor._source=this,t0.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t0}unpipe(){var t0;if(!this.processor)return;const e0=this.processor;(t0=this._source.processSourceNode)===null||t0===void 0||t0.disconnect(),this.processor._source=!1,this.processor=void 0,e0.reset()}bindProcessorDestinationEvents(t0){t0.on(DL.ON_TRACK,async e0=>{e0?e0!==this._mediaStreamTrack&&(this._mediaStreamTrack=e0,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e0),await $y(this,fL.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,fL.NEED_REPLACE_TRACK,this))}),t0.on(DL.ON_NODE,e0=>{this._source.processedNode=e0})}unbindProcessorDestinationEvents(t0){t0.removeAllListeners(DL.ON_TRACK),t0.removeAllListeners(DL.ON_NODE)}bindProcessorContextEvents(t0){t0.on(PL.REQUEST_CONSTRAINTS,async e0=>{e0(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t0){t0.removeAllListeners(PL.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof Ik&&(this._trackSource=new ek(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t0=new Ck(this._source.context,this.getTrackId(),"local"),e0=new Rk(t0);return this._processorContext=t0,this._processorDestination=e0,this.bindProcessorContextEvents(t0),this.bindProcessorDestinationEvents(e0),this._source.on(yL.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t0})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(mk.stop(this.getTrackId()),this._source.play()),$y(this,fL.NEED_REPLACE_MIXING_TRACK,this).then(()=>{fb.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n0=>{fb.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n0)})),{processorContext:t0,processorDestination:e0}}}).prototype,"setVolume",[Pk],Object.getOwnPropertyDescriptor(Xk.prototype,"setVolume"),Xk.prototype),FL(Xk.prototype,"setPlaybackDevice",[Lk,kk],Object.getOwnPropertyDescriptor(Xk.prototype,"setPlaybackDevice"),Xk.prototype),FL(Xk.prototype,"setEnabled",[Mk,Uk,xk],Object.getOwnPropertyDescriptor(Xk.prototype,"setEnabled"),Xk.prototype),FL(Xk.prototype,"setMuted",[Vk,Fk,Bk],Object.getOwnPropertyDescriptor(Xk.prototype,"setMuted"),Xk.prototype),FL(Xk.prototype,"getStats",[jk],Object.getOwnPropertyDescriptor(Xk.prototype,"getStats"),Xk.prototype),FL(Xk.prototype,"setAudioFrameCallback",[Gk],Object.getOwnPropertyDescriptor(Xk.prototype,"setAudioFrameCallback"),Xk.prototype),FL(Xk.prototype,"play",[Wk,Hk],Object.getOwnPropertyDescriptor(Xk.prototype,"play"),Xk.prototype),FL(Xk.prototype,"stop",[Kk,Yk],Object.getOwnPropertyDescriptor(Xk.prototype,"stop"),Xk.prototype),FL(Xk.prototype,"close",[qk],Object.getOwnPropertyDescriptor(Xk.prototype,"close"),Xk.prototype),FL(Xk.prototype,"pipe",[zk],Object.getOwnPropertyDescriptor(Xk.prototype,"pipe"),Xk.prototype),FL(Xk.prototype,"unpipe",[Jk],Object.getOwnPropertyDescriptor(Xk.prototype,"unpipe"),Xk.prototype),Xk),SM=(Qk=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0]}),Zk=Tk(),$k=DA("MicrophoneAudioTrack","_enabledMutex"),eM=Ib({argsMap:(t0,e0,n0)=>[t0.getTrackId(),e0,n0]}),tM=Tk(),iM=Ib({argsMap:t0=>[t0.getTrackId()]}),FL((nM=class extends TM{get __className__(){return"MicrophoneAudioTrack"}constructor(t0,e0,n0,r0){super(t0,e0.encoderConfig?pL(e0.encoderConfig):{},r0,XA("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),BL(this,"_config",void 0),BL(this,"_deviceName","default"),BL(this,"_constraints",void 0),BL(this,"_originalConstraints",void 0),BL(this,"_enabled",!0),this._config=e0,this._constraints=n0,this._originalConstraints=n0,this._deviceName=t0.label,typeof e0.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e0.bypassWebAudio),(cy()||dy())&&qL.bindInterruptDetectorTrack(this)}async setDevice(t0){if(fb.info("[".concat(this.getTrackId(),"] start set device to ").concat(t0)),this._enabled)try{const e0=await uk.getDeviceById(t0),n0={};n0.audio=GL({},this._constraints),n0.audio.deviceId={exact:t0},this._originMediaStreamTrack.stop();let r0=null;try{r0=await ak(n0,this.getTrackId())}catch(i0){throw fb.error("[".concat(this.getTrackId(),"] setDevice failed"),i0.toString()),r0=await ak({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r0.getAudioTracks()[0],!1),i0}await this._updateOriginMediaStreamTrack(r0.getAudioTracks()[0],!1),this._deviceName=e0.label,this._config.microphoneId=t0,this._constraints.deviceId={exact:t0}}catch(e0){throw fb.error("[".concat(this.getTrackId(),"] setDevice error"),e0.toString()),e0}else try{const e0=await uk.getDeviceById(t0);this._deviceName=e0.label,this._config.microphoneId=t0,this._constraints.deviceId={exact:t0}}catch(e0){throw fb.error("[".concat(this.getTrackId(),"] setDevice error"),e0.toString()),e0}fb.info("[".concat(this.getTrackId(),"] set device to ").concat(t0," success"))}async setEnabled(t0,e0,n0){if(e0)return fb.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t0);if(!n0){if(t0===this._enabled)return;this.stateCheck("enabled",t0)}if(fb.info("[".concat(this.getTrackId(),"] start setEnabled"),t0),XA("AUTO_RESET_AUDIO_ROUTE")&&($v()||uy())){const s0=navigator.audioSession;s0&&(t0||(s0.type="playback"),s0.type="auto")}if(!t0){var r0;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r0=this._source.clonedTrack)===null||r0===void 0||r0.stop(),n0||(this._enabled=!1);try{await $y(this,fL.NEED_DISABLE_TRACK,this)}catch(s0){throw fb.error("[".concat(this.getTrackId(),"] setEnabled false failed"),s0.toString()),s0}return}const i0=GL({},this._constraints),o0=uk.searchDeviceIdByName(this._deviceName);o0&&!i0.deviceId&&(i0.deviceId=o0);try{n0||(this._enabled=!0);const s0=await ak({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s0.getAudioTracks()[0],!1),await $y(this,fL.NEED_ENABLE_TRACK,this)}catch(s0){throw n0||(this._enabled=!1),fb.error("[".concat(this.getTrackId(),"] setEnabled true failed"),s0.toString()),s0}fb.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(cy()||dy())&&qL.unbindInterruptDetectorTrack(this)}onTrackEnded(){if(($v()||uy())&&this._enabled&&!this._isClosed&&qL.duringInterruption){const t0=async()=>{qL.off(tL.IOS_INTERRUPTION_END,t0),this._enabled&&!this._isClosed&&(fb.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};qL.on(tL.IOS_INTERRUPTION_END,t0)}else fb.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(CL.TRACK_ENDED)}async renewMediaStreamTrack(t0){const e0=t0||this._constraints,n0=uk.searchDeviceIdByName(this._deviceName);if(n0&&!e0.deviceId&&(e0.deviceId=n0),this._constraints=e0,this._enabled){this._originMediaStreamTrack.stop();const r0=await ak({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r0.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t0){super.bindProcessorContextEvents(t0),t0.on(PL.REQUEST_UPDATE_CONSTRAINTS,async(e0,n0,r0)=>{try{const i0=Object.assign({},this._originalConstraints,...e0);await this.renewMediaStreamTrack(i0),n0()}catch(i0){r0(i0)}})}unbindProcessorContextEvents(t0){super.unbindProcessorContextEvents(t0),t0.removeAllListeners(PL.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Qk,Zk],Object.getOwnPropertyDescriptor(nM.prototype,"setDevice"),nM.prototype),FL(nM.prototype,"setEnabled",[$k,eM,tM],Object.getOwnPropertyDescriptor(nM.prototype,"setEnabled"),nM.prototype),FL(nM.prototype,"close",[iM],Object.getOwnPropertyDescriptor(nM.prototype,"close"),nM.prototype),nM),gM=(rM=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0,t0.duration]}),oM=Tk(),sM=Ib({argsMap:t0=>[t0.getTrackId()]}),aM=Tk(),cM=Ib({argsMap:t0=>[t0.getTrackId()]}),dM=Tk(),lM=Ib({argsMap:t0=>[t0.getTrackId()]}),uM=Tk(),hM=Ib({argsMap:t0=>[t0.getTrackId()]}),pM=Tk(),_M=Ib({argsMap:t0=>[t0.getTrackId()]}),EM=Ib({argsMap:t0=>[t0.getTrackId()]}),fM=Tk(),FL((mM=class extends TM{get __className__(){return"BufferSourceAudioTrack"}constructor(t0,e0,n0,r0){super(e0.createOutputTrack(),n0,r0),BL(this,"source",void 0),BL(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t0,this._bufferSource=e0,this._bufferSource.on(yL.AUDIO_SOURCE_STATE_CHANGE,i0=>{this.safeEmit(CL.SOURCE_STATE_CHANGE,i0)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t0){t0&&this._bufferSource.updateOptions(t0),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t0){this._bufferSource.seekAudioBuffer(t0)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t0){yy(t0,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t0)}}).prototype,"startProcessAudioBuffer",[rM,oM],Object.getOwnPropertyDescriptor(mM.prototype,"startProcessAudioBuffer"),mM.prototype),FL(mM.prototype,"pauseProcessAudioBuffer",[sM,aM],Object.getOwnPropertyDescriptor(mM.prototype,"pauseProcessAudioBuffer"),mM.prototype),FL(mM.prototype,"seekAudioBuffer",[cM,dM],Object.getOwnPropertyDescriptor(mM.prototype,"seekAudioBuffer"),mM.prototype),FL(mM.prototype,"resumeProcessAudioBuffer",[lM,uM],Object.getOwnPropertyDescriptor(mM.prototype,"resumeProcessAudioBuffer"),mM.prototype),FL(mM.prototype,"stopProcessAudioBuffer",[hM,pM],Object.getOwnPropertyDescriptor(mM.prototype,"stopProcessAudioBuffer"),mM.prototype),FL(mM.prototype,"close",[_M],Object.getOwnPropertyDescriptor(mM.prototype,"close"),mM.prototype),FL(mM.prototype,"setAudioBufferPlaybackSpeed",[EM,fM],Object.getOwnPropertyDescriptor(mM.prototype,"setAudioBufferPlaybackSpeed"),mM.prototype),mM);class RM extends TM{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e0 of this.trackList)if(e0._enabled&&!e0._isClosed&&!e0.muted)return!0;return!1}constructor(){const e0=zL().createMediaStreamDestination();super(e0.stream.getAudioTracks()[0],void 0,TA(8,"track-mix-")),BL(this,"trackList",void 0),BL(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e0,this.trackList=[]}hasAudioTrack(e0){return this.trackList.indexOf(e0)!==-1}addAudioTrack(e0){this.trackList.indexOf(e0)===-1?(fb.debug("add ".concat(e0.getTrackId()," to mixing track")),e0._source.outputNode.connect(this.destNode),this.trackList.push(e0),this.updateEncoderConfig()):fb.debug("track ".concat(e0.getTrackId()," is already added"))}removeAudioTrack(e0){if(this.trackList.indexOf(e0)!==-1){fb.debug("remove ".concat(e0.getTrackId()," from mixing track"));try{e0._source.outputNode.disconnect(this.destNode)}catch{}nA(this.trackList,e0),this.updateEncoderConfig()}}updateEncoderConfig(){const e0={};this.trackList.forEach(n0=>{n0._encoderConfig&&((n0._encoderConfig.bitrate||0)>(e0.bitrate||0)&&(e0.bitrate=n0._encoderConfig.bitrate),(n0._encoderConfig.sampleRate||0)>(e0.sampleRate||0)&&(e0.sampleRate=n0._encoderConfig.sampleRate),(n0._encoderConfig.sampleSize||0)>(e0.sampleSize||0)&&(e0.sampleSize=n0._encoderConfig.sampleSize),n0._encoderConfig.stereo&&(e0.stereo=!0))}),this._encoderConfig=e0}_updateRtpTransceiver(e0){this._rtpTransceiver!==e0&&(this._rtpTransceiver=e0,this.trackList.forEach(n0=>{n0 instanceof RM?n0.emit(RL.TRANSCEIVER_UPDATED,e0):n0._updateRtpTransceiver(e0)}))}}class CM extends $L{set currentState(e0){e0!==this._currentState&&(this._currentState=e0,this.safeEmit(yL.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e0){let n0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),BL(this,"audioBuffer",void 0),BL(this,"sourceNode",void 0),BL(this,"startPlayTime",0),BL(this,"startPlayOffset",0),BL(this,"pausePlayTime",0),BL(this,"options",void 0),BL(this,"currentLoopCount",0),BL(this,"currentPlaybackSpeed",100),BL(this,"_currentState","stopped"),this.audioBuffer=e0,this.options=n0,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e0){this.currentState==="stopped"?(this.options=e0,this.startPlayOffset=this.options.startPlayTime||0):fb.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e0){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e0,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e0))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e0){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e0/100),this.currentPlaybackSpeed=e0}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e0=this.context.createBufferSource();return e0.buffer=this.audioBuffer,e0.loop=!!this.options.loop,e0.connect(this.outputNode),e0.playbackRate.value=this.currentPlaybackSpeed/100,e0}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const IM=new Map;class vM{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e0=this.renderStats.curTs-this.renderStats.lastTs,n0=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e0;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n0}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e0){e0!==this._videoElementStatus&&(fb.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e0)),this._videoElementStatus=e0)}get videoState(){return this._videoState}set videoState(e0){var n0;e0!==this._videoState&&(this._videoState=e0,(n0=this.onVideoStateChanged)===null||n0===void 0||n0.call(this,this.videoState))}constructor(e0){BL(this,"trackId",void 0),BL(this,"config",void 0),BL(this,"onFirstVideoFrameDecoded",void 0),BL(this,"onVideoStateChanged",void 0),BL(this,"freezeTimeCounterList",[]),BL(this,"renderFreezeAccTime",0),BL(this,"isKeepLastFrame",!1),BL(this,"timeUpdatedCount",0),BL(this,"freezeTime",0),BL(this,"playbackTime",0),BL(this,"lastTimeUpdatedTime",0),BL(this,"autoplayFailed",!1),BL(this,"videoTrack",void 0),BL(this,"videoElement",void 0),BL(this,"cacheVideoElement",void 0),BL(this,"renderStats",void 0),BL(this,"_videoState",UL.VideoStateStopped),BL(this,"videoElementCheckInterval",void 0),BL(this,"videoElementFreezeTimeout",void 0),BL(this,"_videoElementStatus",ML.NONE),BL(this,"isGettingVideoDimensions",!1),BL(this,"startGetVideoDimensions",()=>{const n0=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return fb.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n0,500)};!this.isGettingVideoDimensions&&n0()}),BL(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&qL.curState==="running"&&(fb.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(qv())),ly()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),BL(this,"handleVideoEvents",n0=>{switch(n0.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=ML.PLAYING;break;case"loadeddata":if(this.videoState=UL.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ML.CANPLAY;break;case"stalled":this.videoElementStatus=ML.STALLED;break;case"suspend":this.videoElementStatus=ML.SUSPEND;break;case"pause":this.videoElementStatus=ML.PAUSED,$v()||uy()||Xv()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(fb.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ML.WAITING;break;case"abort":this.videoElementStatus=ML.ABORT;break;case"ended":this.videoElementStatus=ML.ENDED;break;case"emptied":this.videoElementStatus=ML.EMPTIED;break;case"error":{const r0=this.videoElement.error,i0=r0?"".concat(r0.message," (").concat(r0.code,")"):"";r0&&(this.videoElementStatus=ML.ERROR),fb.error("[".concat(this.trackId,"] media error: ").concat(i0," "));break}case"timeupdate":{const r0=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r0);const i0=r0-this.lastTimeUpdatedTime,o0=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r0,yU.lastVisibleTime<yU.lastHiddenTime||o0<yU.lastHiddenTime||o0<yU.lastVisibleTime)return;for(i0>XA("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i0),this.playbackTime+=i0;this.playbackTime>=6e3;){this.playbackTime-=6e3;const s0=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(s0),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),BL(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(fb.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(qv())),ly()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e0.trackId,this.config=e0,e0.element instanceof HTMLVideoElement?this.videoElement=e0.element:this.videoElement=document.createElement("video"),qL.on(tL.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qL.on(tL.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e0;return(e0=this.videoElement.parentElement)!==null&&e0!==void 0?e0:void 0}updateConfig(e0){this.config=e0,this.trackId=e0.trackId,e0.element!==this.videoElement&&(this.destroy(),this.videoElement=e0.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e0){this.videoTrack!==e0&&(this.videoTrack=e0,this.initVideoElement())}play(e0){const n0=this.videoElement.play();n0&&n0.catch&&n0.catch(i0=>{e0&&Ek(e0,"video",i0.message,this.trackId),i0.name==="NotAllowedError"?(fb.warning("detected video element autoplay failed",i0),this.autoplayFailed=!0,this.handleAutoPlayFailed()):fb.warning("[".concat(this.trackId,"] play warning: "),i0)});const r0=Hv();if((r0.name==="Safari"&&Number(r0.version)===15||cy())&&n0&&n0.then){const i0=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n0.then(i0).catch(i0)}}getCurrentFrame(){const e0=document.createElement("canvas");e0.width=this.videoElement.videoWidth,e0.height=this.videoElement.videoHeight;const n0=e0.getContext("2d");if(!n0)return fb.error("create canvas context failed!"),new ImageData(2,2);n0.drawImage(this.videoElement,0,0,e0.width,e0.height);const r0=n0.getImageData(0,0,e0.width,e0.height);return e0.remove(),r0}async getCurrentFrameToUint8Array(e0){let n0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r0=document.createElement("canvas");r0.width=this.videoElement.videoWidth,r0.height=this.videoElement.videoHeight;const i0=r0.getContext("2d");return i0?(i0.drawImage(this.videoElement,0,0,r0.width,r0.height),new Gh((o0,s0)=>{r0.toBlob(async a0=>{if(r0.remove(),a0){const c0=await Dk(a0);o0({buffer:c0,width:r0.width,height:r0.height})}else s0(new Cy(Ry.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e0,n0<0?.1:n0>1?1:n0)})):await Nk(e0)}destroy(){this.renderStats=void 0,qL.off(tL.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),qL.off(tL.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=UL.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ML.INIT,!this.videoElementCheckInterval&&(yM.forEach(o0=>{this.videoElement.addEventListener(o0,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(o0){return o0!==document.body&&document.body.contains(o0)})(this.videoElement)||(this.videoElementStatus=ML.DESTROYED)},1e3),XA("ENABLE_VIDEO_FRAME_CALLBACK"))){var e0,n0;let o0;const s0=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",s0),this.videoElementFreezeTimeout=window.setTimeout(a0,XA("VIDEO_FREEZE_DURATION")))},a0=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===UL.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=UL.VideoStateFrozen:document.addEventListener("visibilitychange",s0))},c0=(u0,l0)=>{if(this.videoElementStatus===ML.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=l0.mediaTime):this.renderStats={lastTs:l0.mediaTime,curTs:l0.mediaTime,lastRenderNum:0,renderNum:0},o0){const p0=l0.presentationTime-o0.presentationTime;this.videoState===UL.VideoStateStarting&&(this.videoState=UL.VideoStateDecoding),this.videoState===UL.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(a0,XA("VIDEO_FREEZE_DURATION"))),p0<XA("VIDEO_FREEZE_DURATION")&&this.videoState===UL.VideoStateFrozen&&(this.videoState=UL.VideoStateDecoding),p0>XA("VIDEO_FREEZE_DURATION")&&yU.lastVisibleTime>=yU.lastHiddenTime&&o0.timestamp>yU.lastVisibleTime&&o0.timestamp>yU.lastHiddenTime&&(this.renderFreezeAccTime+=p0)}o0=GL(GL({},l0),{},{timestamp:u0})}var d0,h0;XA("ENABLE_VIDEO_FRAME_CALLBACK")&&((d0=(h0=this.videoElement).requestVideoFrameCallback)===null||d0===void 0||d0.call(h0,c0))};(e0=(n0=this.videoElement).requestVideoFrameCallback)===null||e0===void 0||e0.call(n0,c0)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),fy()&&!XA("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r0=Hv();r0.name==="Safari"&&Number(r0.version)===15||cy()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Zv()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Zv()&&this.videoElement.load());const i0=this.videoElement.play();i0!==void 0&&i0.catch(o0=>{fb.debug("[".concat(this.trackId,"] playback interrupted"),o0.toString())})}resetVideoElement(){yM.forEach(e0=>{this.videoElement&&this.videoElement.removeEventListener(e0,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ML.NONE}handleAutoPlayFailed(){const e0=n0=>{n0.preventDefault(),this.videoElement.play().then(()=>{fb.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r0=>{fb.error(r0)}),this.autoplayFailed=!1,my()?document.body.removeEventListener("click",e0,!0):(document.body.removeEventListener("touchstart",e0,!0),document.body.removeEventListener("mousedown",e0,!0))};my()?document.body.addEventListener("click",e0,!0):(document.body.addEventListener("touchstart",e0,!0),document.body.addEventListener("mousedown",e0,!0)),_k()}}const yM=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class AM extends vM{constructor(e0){super(e0),BL(this,"container",void 0),BL(this,"slot",void 0),this.slot=e0.element,this.updateConfig(e0)}updateConfig(e0){this.config=e0,this.trackId=e0.trackId;const n0=e0.element;n0!==this.slot&&(this.destroy(),this.slot=n0),this.createElements()}updateVideoTrack(e0){this.videoTrack!==e0&&(this.videoTrack=e0,this.createElements())}play(e0){var n0;(n0=this.container)!==null&&n0!==void 0&&n0.contains(this.videoElement)&&super.play(e0)}getCurrentFrame(){var e0;return(e0=this.container)!==null&&e0!==void 0&&e0.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e0){var n0;let r0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n0=this.container)!==null&&n0!==void 0&&n0.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e0,r0):await Nk(e0)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",XA("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e0;!this.container||(e0=this.container)!==null&&e0!==void 0&&e0.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e0;if((e0=this.container)!==null&&e0!==void 0&&e0.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e0;(e0=this.container)!==null&&e0!==void 0&&e0.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var bM,wM,OM,NM,DM,PM,LM,kM,MM,UM,xM,VM,FM,BM,jM,GM,WM,HM,KM,YM,qM,zM,JM,XM,QM,ZM,$M,eU,tU,iU,nU,rU,oU,sU;let aU=(bM=Ib({argsMap:(t0,e0,n0)=>[t0.getTrackId(),typeof e0=="string"?e0:e0 instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n0]}),wM=Tk(),OM=Ib({argsMap:t0=>[t0.getTrackId()]}),NM=DA("LocalVideoTrack","_enabledMutex"),DM=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0]}),PM=Tk(),LM=DA("LocalVideoTrack","_enabledMutex"),kM=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0]}),MM=Tk(),UM=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0]}),xM=Tk(),VM=Tk(),FM=Ib({argsMap:(t0,e0,n0)=>[t0.getTrackId(),e0,n0]}),BM=Tk(),jM=Tk(),GM=Tk(),WM=Tk(),HM=Tk(),KM=Tk(),YM=Tk(),qM=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0.name]}),zM=Ib({argsMap:t0=>[t0.getTrackId()]}),JM=Ib({argsMap:t0=>[t0.getTrackId()]}),XM=Ib({argsMap:(t0,e0,n0)=>[t0.getTrackId(),e0.label,n0]}),QM=class d1 extends HL{get videoHeight(){if(Xv()){const{height:e0}=this._mediaStreamTrack.getSettings();return this._videoHeight=e0,this._videoHeight}return this._videoHeight}get videoWidth(){if(Xv()){const{width:e0}=this._mediaStreamTrack.getSettings();return this._videoWidth=e0,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ML.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e0){this._processorContext=e0}get __className__(){return"LocalVideoTrack"}constructor(e0,n0,r0,i0,o0,s0){if(super(e0,o0),BL(this,"trackMediaType",vL.VIDEO),BL(this,"_player",void 0),BL(this,"isUseScaleResolutionDownBy",!1),BL(this,"_videoVisibleTimer",null),BL(this,"_previousVideoVisibleStatus",void 0),BL(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),BL(this,"_encoderConfig",void 0),BL(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),BL(this,"_optimizationMode",void 0),BL(this,"_videoHeight",void 0),BL(this,"_videoWidth",void 0),BL(this,"_forceBitrateLimit",void 0),BL(this,"_enabled",!0),BL(this,"_processorDestination",void 0),BL(this,"_processorContext",void 0),Xv()){const{width:a0,height:c0}=e0.getSettings();this._videoWidth=a0,this._videoHeight=c0}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n0,this._scalabilityMode=r0,this._optimizationMode=i0,this._hints=s0||[],this._hints.indexOf(mL.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(a0,c0,u0){const l0=Hv();return!(l0.name!==a0||!l0.osVersion)&&(u0?Number(l0.version)>=c0&&Number(l0.version)<=u0:Number(l0.version)===c0)}(Bv.CHROME,115)&&Yv().indexOf("Windows")!==-1){const a0=function(c0,u0){if("VideoFrame"in window&&"TransformStream"in window&&ZP().supportWebRTCInsertableStream){const l0=new MediaStreamTrackProcessor(c0),d0=new MediaStreamTrackGenerator({kind:"video"});let h0,p0,m0=Date.now();const f0=()=>{g0&&(clearInterval(g0),g0=void 0),h0&&(h0.close(),h0=void 0),c0.stop(),p0=void 0,d0.removeEventListener("ended",f0)};let g0=window.setInterval(()=>{if(p0&&h0&&Date.now()-m0>(u0??1e3))try{d0.readyState==="live"?p0.enqueue(h0.clone()):f0()}catch{f0()}},u0??1e3);const E0=new TransformStream({transform:(_0,y0)=>{d0.readyState==="live"?(p0=y0,m0=Date.now(),h0===void 0?(h0=_0,y0.enqueue(_0.clone())):(y0.enqueue(h0),h0=_0)):_0.close()}});return d0.addEventListener("ended",f0),l0.readable.pipeThrough(E0).pipeTo(d0.writable),d0}}(e0);a0&&(fb.info("local screen video track begin to inject frame"),this._mediaStreamTrack=a0)}n0&&this._hints.indexOf(mL.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n0),this._processorContext=new gk(this.getTrackId(),"local"),this._processorDestination=new Sk(this.processorContext),this.bindProcessorDestinationEvents()}play(e0){let n0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e0=="string"){const i0=document.getElementById(e0);i0?e0=i0:(fb.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e0,'" element, use document.body')),e0=document.body)}fb.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e0 instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n0));const r0=GL(GL(GL({},this._getDefaultPlayerConfig()),n0),{},{trackId:this.getTrackId(),element:e0});this._player?this._player.updateConfig(r0):(e0 instanceof HTMLVideoElement?this._player=new vM(r0):this._player=new AM(r0),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i0=this.getVideoElementVisibleStatus();this.safeEmit(CL.VIDEO_ELEMENT_VISIBLE_STATUS,i0)}catch{}},XA("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,fb.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e0,n0){if(!n0){if(e0===this._enabled)return;this.stateCheck("enabled",e0)}if(fb.info("[".concat(this.getTrackId(),"] start setEnabled"),e0),!e0){this._originMediaStreamTrack.enabled=!1;try{await $y(this,fL.NEED_DISABLE_TRACK,this)}catch(r0){throw fb.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r0.toString()),r0}return n0||(this._enabled=!1),void fb.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await $y(this,fL.NEED_ENABLE_TRACK,this)}catch(r0){throw fb.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r0.toString()),r0}fb.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n0||(this._enabled=!0)}async setMuted(e0){e0!==this._muted&&(this.stateCheck("muted",e0),this._muted=e0,this._originMediaStreamTrack.enabled=!e0,fb.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e0)),e0?await $y(this,fL.NEED_MUTE_TRACK,this):await $y(this,fL.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e0,n0){if(!this._enabled)throw new Cy(Ry.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e0=dL(e0),this._forceBitrateLimit&&(e0.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e0.bitrateMax,e0.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e0.bitrateMin),e0.width||e0.height||e0.frameRate){const r0=Ak({encoderConfig:e0});(Xv()||$v()||uy())&&(r0.deviceId=void 0),fb.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e0),JSON.stringify(r0));try{await this._originMediaStreamTrack.applyConstraints(r0),this.updateMediaStreamTrackResolution()}catch(i0){const o0=new Cy(Ry.UNEXPECTED_ERROR,i0.toString());throw fb.error("[".concat(this.getTrackId(),"] applyConstraints error"),o0.toString()),o0}}this._encoderConfig=e0,this._hints.indexOf(mL.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await $y(this,fL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r0){return r0.throw(fb)}}getStats(){return dA(()=>{fb.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),eA(this,fL.GET_STATS)||GL({},bL)}async setBeautyEffect(e0){fb.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e0){let n0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e0,n0):await Nk(e0)}async setBitrateLimit(e0){if(fb.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e0))),e0){this._forceBitrateLimit=e0,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e0.max_bitrate?this._encoderConfig.bitrateMax:e0.max_bitrate:this._encoderConfig.bitrateMax=e0.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e0.min_bitrate);try{await $y(this,fL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n0){return n0.throw(fb)}}}async setOptimizationMode(e0){if(e0!=="motion"&&e0!=="detail"&&e0!=="balanced")return void fb.error(Ry.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n0=this._optimizationMode;try{this._optimizationMode=e0,await $y(this,fL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r0){throw this._optimizationMode=n0,fb.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r0.toString()),r0}fb.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e0,")"))}setScalabiltyMode(e0){if(e0.numSpatialLayers===1&&e0.numTemporalLayers!==1)return fb.error(Ry.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e0,fb.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e0,")"))}updateMediaStreamTrackResolution(){yk(this._originMediaStreamTrack).then(e0=>{let[n0,r0]=e0;this._videoHeight=r0,this._videoWidth=n0}).catch(gA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e0){if(!this._enabled)throw new Cy(Ry.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");fb.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e0)),e0=dL(e0),this._forceBitrateLimit&&(e0.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e0.bitrateMax,e0.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e0.bitrateMin),this._encoderConfig=e0,this._hints.indexOf(mL.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await $y(this,fL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n0){return n0.throw(fb)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e0,height:n0,frameRate:r0}=this.getMediaStreamTrackSettings();if(!e0||!n0||!r0)return;const{bitrateMax:i0,bitrateMin:o0}=this._encoderConfig;if(o0==null||i0==null){const{max:s0,min:a0}=function(c0,u0,l0,d0,h0){const p0=XA("BITRATE_ADAPTER_TYPE");if(p0==="DEFAULT_BITRATE")return{min:d0,max:h0};if(h0===void 0){var m0;const g0=Math.floor(200*Math.pow(l0/15,.6)*Math.pow(c0*u0/640/360,.75));h0=p0==="STANDARD_BITRATE"?4*g0:2*g0,d0=(m0=d0)!==null&&m0!==void 0?m0:g0}else{var f0;d0=(f0=d0)!==null&&f0!==void 0?f0:Math.floor(h0/10)}return{min:d0,max:h0}}(e0,n0,r0,o0,i0);this._encoderConfig.bitrateMin=a0,this._encoderConfig.bitrateMax=s0,fb.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e0,", h: ").concat(n0,", fps: ").concat(r0,"] => [brMax: ").concat(s0,", brMin: ").concat(a0,"]"))}}getVideoElementVisibleStatus(){try{var e0,n0;const r0=this==null||(e0=this._player)===null||e0===void 0?void 0:e0.getContainerElement(),i0={track:this,element:this==null||(n0=this._player)===null||n0===void 0?void 0:n0.getVideoElement(),slot:r0==null?void 0:r0.parentElement},{element:o0,slot:s0}=i0;if(this.isPlaying&&o0 instanceof HTMLVideoElement&&s0 instanceof HTMLElement){const a0=Ly.checkOneElementVisible(o0),c0=Object.assign({},a0);if(c0.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c0.visible;const u0=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c0.visible?u0.onSuccess("Video is visible"):u0.onSuccess("Invisible because of ".concat(c0.reason))}return c0}return}catch(r0){throw new Cy(Ry.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r0.message)}}async renewMediaStreamTrack(e0){}pipe(e0){if(this.processor===e0)return e0;if(e0._source)throw new Cy(Ry.INVALID_OPERATION,"Processor ".concat(e0.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e0,this.processor._source=this,e0.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e0}unpipe(){if(!this.processor)return;const e0=this.processor;this.processor._source=void 0,this.processor=void 0,e0.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e0){let n0=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r0=this._encoderConfig;e0&&(r0=GL(GL({},r0),dL(e0))),r0=aA(r0);const i0=TA(8,"track-video-cloned-"),o0=new d1(n0?this._mediaStreamTrack.clone():this._mediaStreamTrack,r0,aA(this._scalabilityMode),this._optimizationMode,i0,aA(this._hints));return e0&&r0&&o0.setEncoderConfiguration(r0),fb.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i0,", clone ").concat(n0)),o0}async replaceTrack(e0,n0){if(!(e0 instanceof MediaStreamTrack))throw new Cy(Ry.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e0.kind!=="video")throw new Cy(Ry.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e0,n0,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e0){if(dA(()=>{vb.reportApiInvoke(null,{name:By.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:jy.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!XA("ENABLE_VIDEO_SEI")||!XA("ENABLE_ENCODED_TRANSFORM"))return void fb.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e0 instanceof Uint8Array==0)return new Cy(Ry.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n0=this.getRTCRtpTransceiver();if(!n0)return void fb.warning("Video track is not published, SEI can not be send");const r0=n0.sender.getParameters();if(r0.codecs.length===0)return;const i0=r0.codecs[0].mimeType.toLocaleLowerCase();i0==="video/h264"?this.safeEmit("sei-to-send",e0):fb.warning("SEI is not supported by ".concat(i0))}bindProcessorDestinationEvents(){this.processorDestination.on(DL.ON_TRACK,async e0=>{e0?e0!==this._mediaStreamTrack&&(this._mediaStreamTrack=e0,this._updatePlayerSource(),await $y(this,fL.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,fL.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(DL.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(PL.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(PL.REQUEST_CONSTRAINTS)}},FL(QM.prototype,"play",[bM,wM],Object.getOwnPropertyDescriptor(QM.prototype,"play"),QM.prototype),FL(QM.prototype,"stop",[OM],Object.getOwnPropertyDescriptor(QM.prototype,"stop"),QM.prototype),FL(QM.prototype,"setEnabled",[NM,DM,PM],Object.getOwnPropertyDescriptor(QM.prototype,"setEnabled"),QM.prototype),FL(QM.prototype,"setMuted",[LM,kM,MM],Object.getOwnPropertyDescriptor(QM.prototype,"setMuted"),QM.prototype),FL(QM.prototype,"setEncoderConfiguration",[UM,xM],Object.getOwnPropertyDescriptor(QM.prototype,"setEncoderConfiguration"),QM.prototype),FL(QM.prototype,"getStats",[VM],Object.getOwnPropertyDescriptor(QM.prototype,"getStats"),QM.prototype),FL(QM.prototype,"setBeautyEffect",[FM,BM],Object.getOwnPropertyDescriptor(QM.prototype,"setBeautyEffect"),QM.prototype),FL(QM.prototype,"getCurrentFrameData",[jM],Object.getOwnPropertyDescriptor(QM.prototype,"getCurrentFrameData"),QM.prototype),FL(QM.prototype,"getCurrentFrameImage",[GM],Object.getOwnPropertyDescriptor(QM.prototype,"getCurrentFrameImage"),QM.prototype),FL(QM.prototype,"setBitrateLimit",[WM],Object.getOwnPropertyDescriptor(QM.prototype,"setBitrateLimit"),QM.prototype),FL(QM.prototype,"setOptimizationMode",[HM],Object.getOwnPropertyDescriptor(QM.prototype,"setOptimizationMode"),QM.prototype),FL(QM.prototype,"setScalabiltyMode",[KM],Object.getOwnPropertyDescriptor(QM.prototype,"setScalabiltyMode"),QM.prototype),FL(QM.prototype,"updateMediaStreamTrackResolution",[YM],Object.getOwnPropertyDescriptor(QM.prototype,"updateMediaStreamTrackResolution"),QM.prototype),FL(QM.prototype,"pipe",[qM],Object.getOwnPropertyDescriptor(QM.prototype,"pipe"),QM.prototype),FL(QM.prototype,"unpipe",[zM],Object.getOwnPropertyDescriptor(QM.prototype,"unpipe"),QM.prototype),FL(QM.prototype,"close",[JM],Object.getOwnPropertyDescriptor(QM.prototype,"close"),QM.prototype),FL(QM.prototype,"replaceTrack",[XM],Object.getOwnPropertyDescriptor(QM.prototype,"replaceTrack"),QM.prototype),QM),cU=(ZM=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0]}),$M=Tk(),eU=DA("CameraVideoTrack","_enabledMutex"),tU=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0]}),iU=Tk(),nU=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0]}),rU=Tk(),oU=Ib({argsMap:t0=>[t0.getTrackId()]}),sU=class h1 extends aU{get __className__(){return"CameraVideoTrack"}constructor(e0,n0,r0,i0,o0,s0){super(e0,dL(n0.encoderConfig),i0,o0,s0),BL(this,"_config",void 0),BL(this,"_originalConstraints",void 0),BL(this,"_constraints",void 0),BL(this,"_enabled",!0),BL(this,"_deviceName","default"),BL(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(cy()||dy())&&!function(){const a0=Hv();if(a0.os!==Fv.IOS||!a0.osVersion)return!1;const c0=a0.osVersion.split(".");return Number(c0[0])===15&&Number(c0[1])>=2}()&&hy()&&this._enabled&&!this._isClosed&&(fb.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n0,this._originalConstraints=r0,this._constraints=r0,this._deviceName=e0.label,this._encoderConfig=dL(this._config.encoderConfig),qL.on(tL.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),qL.on(tL.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e0){return typeof e0=="string"?this._setDeviceById(e0):e0.deviceId?this._setDeviceById(e0.deviceId):e0.facingMode?this._setDeviceByFacingModel(e0.facingMode):void 0}async _setDeviceById(e0){if(fb.info("[".concat(this.getTrackId(),"] set device to ").concat(e0)),this._enabled)try{const n0=await uk.getDeviceById(e0),r0={};r0.video=GL({},this._constraints),r0.video.deviceId={exact:e0},r0.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i0=null;try{i0=await ak(r0,this.getTrackId())}catch(o0){throw fb.error("[".concat(this.getTrackId(),"] setDevice failed"),o0.toString()),i0=await ak({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i0.getVideoTracks()[0],!1),o0}await this._updateOriginMediaStreamTrack(i0.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n0.label,this._config.cameraId=e0,this._constraints.deviceId={exact:e0}}catch(n0){throw fb.error("[".concat(this.getTrackId(),"] setDevice error"),n0.toString()),n0}else try{const n0=await uk.getDeviceById(e0);this._deviceName=n0.label,this._config.cameraId=e0,this._constraints.deviceId={exact:e0}}catch(n0){throw fb.error("[".concat(this.getTrackId(),"] setDevice error"),n0.toString()),n0}fb.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e0){fb.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e0));const n0={video:GL(GL({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e0}})};if(this._enabled){this._originMediaStreamTrack.stop();let r0=null;try{r0=await ak(n0,this.getTrackId())}catch(i0){throw fb.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i0.toString()),r0=await ak({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r0.getVideoTracks()[0],!1),i0}await this._updateOriginMediaStreamTrack(r0.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e0,this._config.cameraId=void 0,this._constraints=GL({},n0.video),fb.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e0,n0){if(!n0){if(e0===this._enabled)return;this.stateCheck("enabled",e0)}if(fb.info("[".concat(this.getTrackId(),"] start setEnabled"),e0),e0){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r0=await ak({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r0.getVideoTracks()[0],!1)}await $y(this,fL.NEED_ENABLE_TRACK,this)}catch(r0){throw fb.error("[".concat(this.getTrackId(),"] setEnabled true error"),r0.toString()),r0}this.updateMediaStreamTrackResolution(),fb.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n0||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n0||(this._enabled=!1);try{await $y(this,fL.NEED_DISABLE_TRACK,this)}catch(r0){throw fb.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r0.toString()),r0}fb.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e0,n0){if(!this._enabled)throw new Cy(Ry.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e0=dL(e0),this._forceBitrateLimit&&(e0.bitrateMax=this._forceBitrateLimit.max_bitrate||e0.bitrateMax,e0.bitrateMin=this._forceBitrateLimit.min_bitrate||e0.bitrateMin);const r0=sA(this._config);r0.encoderConfig=e0;const i0=Ak(r0);(Xv()||$v()||uy())&&(i0.deviceId=void 0),fb.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e0),JSON.stringify(i0));try{await this._originMediaStreamTrack.applyConstraints(i0),this.updateMediaStreamTrackResolution()}catch(o0){const s0=new Cy(Ry.UNEXPECTED_ERROR,o0.toString());throw fb.error("[".concat(this.getTrackId(),"] applyConstraints error"),s0.toString()),s0}this._config=r0,this._constraints=i0,this._originalConstraints=i0,this._encoderConfig=e0,this._hints.indexOf(mL.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await $y(this,fL.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o0){return o0.throw(fb)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if(($v()||uy())&&this._enabled&&!this._isClosed&&qL.duringInterruption){const e0=async()=>{qL.off(tL.IOS_INTERRUPTION_END,e0),this._enabled&&!this._isClosed&&(fb.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};qL.on(tL.IOS_INTERRUPTION_END,e0)}else fb.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(CL.TRACK_ENDED)}async renewMediaStreamTrack(e0){const n0=e0||this._constraints,r0=uk.searchDeviceIdByName(this._deviceName);if(r0&&!n0.deviceId&&(n0.deviceId={exact:r0}),this._enabled){const i0=await ak({video:n0},this.getTrackId());this._constraints=n0,await this._updateOriginMediaStreamTrack(i0.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),qL.off(tL.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),qL.off(tL.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e0){let n0=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r0=this._encoderConfig;e0&&(r0=GL(GL({},r0),dL(e0))),r0=aA(r0);const i0=TA(8,"track-cam-cloned-"),o0=new h1(n0?this._mediaStreamTrack.clone():this._mediaStreamTrack,aA(GL(GL({},this._config),{},{encoderConfig:r0})),aA(this._constraints),aA(this._scalabilityMode),this._optimizationMode,i0);return e0&&r0&&o0.setEncoderConfiguration(r0),fb.debug("clone track from ".concat(this.getTrackId()," to ").concat(i0,", clone ").concat(n0)),o0}bindProcessorContextEvents(){this.processorContext.on(PL.REQUEST_UPDATE_CONSTRAINTS,async(e0,n0,r0)=>{try{const i0=Object.assign({},this._originalConstraints,...e0);await this.renewMediaStreamTrack(i0),n0()}catch(i0){r0(i0)}}),this.processorContext.on(PL.REQUEST_CONSTRAINTS,async e0=>{e0(this._originMediaStreamTrack.getSettings())})}},FL(sU.prototype,"setDevice",[ZM,$M],Object.getOwnPropertyDescriptor(sU.prototype,"setDevice"),sU.prototype),FL(sU.prototype,"setEnabled",[eU,tU,iU],Object.getOwnPropertyDescriptor(sU.prototype,"setEnabled"),sU.prototype),FL(sU.prototype,"setEncoderConfiguration",[nU,rU],Object.getOwnPropertyDescriptor(sU.prototype,"setEncoderConfiguration"),sU.prototype),FL(sU.prototype,"close",[oU],Object.getOwnPropertyDescriptor(sU.prototype,"close"),sU.prototype),sU);function dU(t0,e0,n0,r0){n0.optimizationMode&&(r0&&r0.width&&r0.height?(n0.encoderConfig=GL(GL({},r0),{},{bitrateMin:r0.bitrateMin,bitrateMax:r0.bitrateMax}),n0.optimizationMode!=="motion"&&n0.optimizationMode!=="detail"||(e0.contentHint=n0.optimizationMode,e0.contentHint===n0.optimizationMode?fb.debug("[".concat(t0,"] set content hint to"),n0.optimizationMode):fb.debug("[".concat(t0,"] set content hint failed")))):fb.warning("[".concat(t0,"] can not apply optimization mode bitrate config, no encoderConfig")))}var lU,uU,hU,pU,_U,EU,fU,mU,TU,SU,gU,RU;class CU extends WL{getUserId(){return this._userId}constructor(e0,n0,r0,i0){super(e0,"track-".concat(e0.kind,"-").concat(n0,"-").concat(i0.clientId,"_").concat(TA(5,""))),BL(this,"_userId",void 0),BL(this,"_uintId",void 0),BL(this,"_isDestroyed",!1),BL(this,"store",void 0),BL(this,"processor",void 0),BL(this,"processorContext",void 0),this._userId=n0,this._uintId=r0,this.store=i0}_updateOriginMediaStreamTrack(e0){this._originMediaStreamTrack=e0,this._mediaStreamTrack=e0,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,fb.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let IU=(lU=Ib({argsMap:(t0,e0,n0)=>[t0.getTrackId(),typeof e0=="string"?e0:e0 instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n0]}),uU=Ib({argsMap:t0=>[t0.getTrackId()]}),hU=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0.name]}),pU=Ib({argsMap:t0=>[t0.getTrackId()]}),FL((_U=class extends CU{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ML.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t0,e0,n0,r0){super(t0,e0,n0,r0),BL(this,"_videoVisibleTimer",null),BL(this,"_previousVideoVisibleStatus",void 0),BL(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),BL(this,"trackMediaType",vL.VIDEO),BL(this,"_videoWidth",void 0),BL(this,"_videoHeight",void 0),BL(this,"_player",void 0),BL(this,"processorDestination",void 0),BL(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new gk(this.getTrackId(),"remote"),this.processorDestination=new Sk(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return dA(()=>{fb.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),eA(this,fL.GET_STATS)||GL({},NL)}play(t0){let e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t0=="string"){const r0=document.getElementById(t0);r0?t0=r0:(fb.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t0,'" element, use document.body')),t0=document.body)}fb.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t0 instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e0));const n0=GL(GL({fit:"cover"},e0),{},{trackId:this.getTrackId(),element:t0});this._player?this._player.updateConfig(n0):(t0 instanceof HTMLVideoElement?this._player=new vM(n0):this._player=new AM(n0),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(IL.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=r0=>{this.safeEmit(IL.VIDEO_STATE_CHANGED,r0)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r0=this.getVideoElementVisibleStatus();this.safeEmit(IL.VIDEO_ELEMENT_VISIBLE_STATUS,r0)}catch{}},XA("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,fb.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){yk(this._originMediaStreamTrack).then(t0=>{let[e0,n0]=t0;this._videoHeight=n0,this._videoWidth=e0}).catch(gA)}_updatePlayerSource(){fb.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t0,e0;const n0=this==null||(t0=this._player)===null||t0===void 0?void 0:t0.getContainerElement(),r0={track:this,element:this==null||(e0=this._player)===null||e0===void 0?void 0:e0.getVideoElement(),slot:n0==null?void 0:n0.parentElement},{element:i0,slot:o0}=r0;if(this.isPlaying&&i0 instanceof HTMLVideoElement&&o0 instanceof HTMLElement){const s0=Ly.checkOneElementVisible(i0),a0=Object.assign({},s0);if(a0.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=a0.visible;const c0=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});a0.visible?c0.onSuccess("Video is visible"):c0.onSuccess("Invisible because of ".concat(a0.reason))}return a0}return}catch(n0){throw new Cy(Ry.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n0.message)}}pipe(t0){if(this.processor===t0)return t0;if(t0._source)throw new Cy(Ry.INVALID_OPERATION,"Processor ".concat(t0.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t0,this.processor._source=this,t0.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t0}unpipe(){if(!this.processor)return;const t0=this.processor;this.processor._source=void 0,this.processor=void 0,t0.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(DL.ON_TRACK,async t0=>{t0?t0!==this._mediaStreamTrack&&(this._mediaStreamTrack=t0,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(DL.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t0){this.emit(RL.SEI_RECEIVED,t0)}}).prototype,"play",[lU],Object.getOwnPropertyDescriptor(_U.prototype,"play"),_U.prototype),FL(_U.prototype,"stop",[uU],Object.getOwnPropertyDescriptor(_U.prototype,"stop"),_U.prototype),FL(_U.prototype,"pipe",[hU],Object.getOwnPropertyDescriptor(_U.prototype,"pipe"),_U.prototype),FL(_U.prototype,"unpipe",[pU],Object.getOwnPropertyDescriptor(_U.prototype,"unpipe"),_U.prototype),_U),vU=(EU=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0],throttleTime:300}),fU=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0]}),mU=Ib({argsMap:t0=>[t0.getTrackId()]}),TU=Ib({argsMap:t0=>[t0.getTrackId()]}),SU=Ib({argsMap:(t0,e0)=>[t0.getTrackId(),e0.name]}),gU=Ib({argsMap:t0=>[t0.getTrackId()]}),FL((RU=class extends CU{get isPlaying(){return this._useAudioElement?mk.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t0,e0,n0,r0){super(t0,e0,n0,r0),BL(this,"trackMediaType",vL.AUDIO),BL(this,"_source",void 0),BL(this,"_useAudioElement",!0),BL(this,"_volume",100),BL(this,"processorContext",void 0),BL(this,"processorDestination",void 0),BL(this,"_played",!1),BL(this,"_bypassWebAudio",!1),XA("DISABLE_WEBAUDIO")?(this._source=new Ik,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ek(t0,!0),XA("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(yL.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(IL.FIRST_FRAME_DECODED)}),this.processorContext=new Ck(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new Rk(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(yL.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t0){let e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t0)return this._source.removeAllListeners(yL.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e0),this._source.removeAllListeners(yL.ON_AUDIO_BUFFER),this._source.on(yL.ON_AUDIO_BUFFER,n0=>t0(n0))}setVolume(t0){this._volume=t0,this._useAudioElement?mk.setVolume(this.getTrackId(),t0):this._source.setVolume(t0/100)}async setPlaybackDevice(t0){if(!this._useAudioElement||!$P())throw new Cy(Ry.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mk.setSinkID(this.getTrackId(),t0)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return dA(()=>{fb.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),eA(this,fL.GET_STATS)||GL({},wL)}play(){fb.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(fb.debug("[".concat(this.getTrackId(),"] use audio element to play")),mk.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){fb.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?mk.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t0=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];fb.debug("[".concat(this.getTrackId(),"] update player source track")),t0&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mk.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t0){if(this._bypassWebAudio)throw new Cy(Ry.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t0)return t0;if(t0._source)throw new Cy(Ry.INVALID_OPERATION,"Processor ".concat(t0.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t0,this.processor._source=this,t0.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t0}unpipe(){var t0;if(this._bypassWebAudio)throw new Cy(Ry.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e0=this.processor;(t0=this._source.processSourceNode)===null||t0===void 0||t0.disconnect(),this.processor._source=!1,this.processor=void 0,e0.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(DL.ON_TRACK,async t0=>{t0?t0!==this._mediaStreamTrack&&(this._mediaStreamTrack=t0,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t0)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(DL.ON_NODE,t0=>{this._source.processedNode=t0;const e0=!t0;this._useAudioElement!==e0&&(this._played?(this.stop(),this._useAudioElement=e0,this.play()):this._useAudioElement=e0)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(DL.ON_TRACK),this.processorDestination.removeAllListeners(DL.ON_NODE)}}).prototype,"setVolume",[EU],Object.getOwnPropertyDescriptor(RU.prototype,"setVolume"),RU.prototype),FL(RU.prototype,"setPlaybackDevice",[fU],Object.getOwnPropertyDescriptor(RU.prototype,"setPlaybackDevice"),RU.prototype),FL(RU.prototype,"play",[mU],Object.getOwnPropertyDescriptor(RU.prototype,"play"),RU.prototype),FL(RU.prototype,"stop",[TU],Object.getOwnPropertyDescriptor(RU.prototype,"stop"),RU.prototype),FL(RU.prototype,"pipe",[SU],Object.getOwnPropertyDescriptor(RU.prototype,"pipe"),RU.prototype),FL(RU.prototype,"unpipe",[gU],Object.getOwnPropertyDescriptor(RU.prototype,"unpipe"),RU.prototype),RU);const yU=new class extends xy{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),BL(this,"_lastHiddenTime",0),BL(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),fb.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class AU extends xy{constructor(e0,n0){super(),BL(this,"trackMediaType",vL.DATA),BL(this,"_version",1),BL(this,"_type",3),BL(this,"_config",void 0),BL(this,"_originDataChannel",void 0),BL(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),BL(this,"_dataStreamPacketHandler",{serialize:r0=>r0,deserialize:r0=>r0}),BL(this,"_datachannelEventMap",new Map),this._config=e0,n0&&(this._originDataChannel=n0,this._bandDataChannelEvents(n0)),this._initPacketHeader()}useDataStream(e0){this._dataStreamPacketHandler=e0}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return XA("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e0,n0;return(e0=(n0=this._originDataChannel)===null||n0===void 0?void 0:n0.readyState)!==null&&e0!==void 0?e0:"connecting"}get _originDataChannelId(){var e0,n0;return(e0=(n0=this._originDataChannel)===null||n0===void 0?void 0:n0.id)!==null&&e0!==void 0?e0:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Gh((e0,n0)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e0();const r0=setTimeout(()=>{var i0;n0(new Cy(Ry.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i0=this._originDataChannel)===null||i0===void 0?void 0:i0.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r0),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e0()},this._originDataChannel.onerror=()=>{throw clearTimeout(r0),new Cy(Ry.DATACHANNEL_CONNECTION_TIMEOUT)}}else n0(new Cy(Ry.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e0){this._originDataChannel=e0,this._bandDataChannelEvents(e0)}_initPacketHeader(){const e0=new DataView(this._dataStreamPacketHeader);e0.setUint16(0,this._version),e0.setUint8(2,this._type),e0.setUint8(3,this._config.id)}_bandDataChannelEvents(e0){this._unbindDataChannelEvents(e0),[VL.OPEN,VL.CLOSE,VL.ERROR].forEach(n0=>{const r0=()=>{this.emit(n0)};this._datachannelEventMap.set(n0,r0),e0.addEventListener(n0,r0)})}_unbindDataChannelEvents(e0){Array.from(this._datachannelEventMap.entries()).forEach(n0=>{let[r0,i0]=n0;e0.removeEventListener(r0,i0)}),this._datachannelEventMap.clear()}}class bU extends AU{constructor(e0){super(e0),BL(this,"_messageListener",void 0),this._messageListener=n0=>{if(n0.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r0=n0.data.slice(0,this._dataStreamPacketHeader.byteLength),i0=new DataView(r0).getUint8(3);if(i0!==this.id)return void(XA("SHOW_DATASTREAM2_LOG")&&fb.debug("invalid datachannel id: ".concat(i0," !== ").concat(this.id)));let o0=n0.data.slice(this._dataStreamPacketHeader.byteLength);o0=this._dataStreamPacketHandler.deserialize(o0),this.emit(VL.MESSAGE,o0)}}_updateOriginDataChannel(e0){super._updateOriginDataChannel(e0),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class wU extends AU{send(e0){if(this._originDataChannel){let n0=e0;n0=this._dataStreamPacketHandler.serialize(e0);const r0=new Uint8Array(this._dataStreamPacketHeader.byteLength+n0.byteLength);r0.set(new Uint8Array(this._dataStreamPacketHeader),0),r0.set(new Uint8Array(n0),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r0.buffer)}}}function OU(){const t0=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>XP.revokeObjectURL(t0),0),new Worker(XP.createObjectURL(t0))}const NU=new Map,DU=new Map;function PU(t0,e0,n0){let r0=new Uint8Array(t0,e0,n0),i0=[],o0=0;for(;i0.length<n0;)o0+3<n0&&r0[o0]===0&&r0[o0+1]===0&&r0[o0+2]===3&&(r0[o0+3]===0||r0[o0+3]===1||r0[o0+3]===2||r0[o0+3]===3)?(i0.push(r0[o0],r0[o0+1],r0[o0+3]),o0+=4):(i0.push(r0[o0]),o0++);return new Uint8Array(i0)}const LU=new Map;async function kU(t0,e0){if(!ZP().supportWebRTCEncodedTransform)return void fb.warning("browser not support video encoded transform");if(LU.has(t0)||!t0.track)return;const n0={track:t0.track};if(Jv()){if(!t0.createEncodedStreams)return void fb.warning("browser not support createEncodedStreams() API");let i0=null;try{i0=t0.createEncodedStreams()}catch(a0){return void fb.error("create video-encoded-streams error",a0&&a0.message)}let o0=[];e0.on("sei-to-send",a0=>{o0.push(a0)});const s0=new TransformStream({transform(a0,c0){n0.controller||(n0.controller=c0),t0.track&&t0.track.id!==n0.track.id&&(fb.debug("video track changed: ".concat(n0.track.id," => ").concat(t0.track.id)),n0.track.removeEventListener("ended",r0),n0.track=t0.track,n0.track.addEventListener("ended",r0));const u0=o0.shift();u0&&(a0.data=function(l0,d0){const h0=function(_0){const y0=_0.length;let b0=[],S0=0;for(;S0<y0;)S0+2<y0&&_0[S0]===0&&_0[S0+1]===0&&(_0[S0+2]===0||_0[S0+2]===1||_0[S0+2]===2||_0[S0+2]===3)?(b0.push(_0[S0],_0[S0+1],3,_0[S0+2]),S0+=3):(b0.push(_0[S0]),S0++);return new Uint8Array(b0)}(d0),p0=h0.length,m0=Math.floor(p0/255),f0=p0%255,g0=new Uint8Array(6+m0+1+p0+l0.byteLength);g0[0]=0,g0[1]=0,g0[2]=0,g0[3]=1,g0[4]=6,g0[5]=101;let E0=0;for(;E0<m0;)g0[6+E0]=255,E0++;return g0[6+E0]=f0,E0++,g0.set(h0,6+E0),g0.set(new Uint8Array(l0),6+E0+p0),g0.buffer}(a0.data,u0)),c0.enqueue(a0)}});i0.readable.pipeThrough(s0).pipeTo(i0.writable)}else{if(!Xv())return;{if(typeof RTCRtpScriptTransform>"u")return void fb.warning("browser not support RTCRtpScriptTransform");const i0=OU(),o0=new MessageChannel;await new Gh(a0=>i0.onmessage=c0=>{c0.data==="registered"&&a0(void 0)});const s0=new RTCRtpScriptTransform(i0,{name:"tx",port:o0.port2},[o0.port2]);t0.transform=s0,await new Gh(a0=>i0.onmessage=c0=>{c0.data==="started"&&a0(void 0)}),e0.on("sei-to-send",a0=>{o0.port1.postMessage({sei:a0})}),o0.port1.onmessage=a0=>{var c0;a0.data.transformed&&t0.track&&((c0=t0.track)===null||c0===void 0?void 0:c0.id)!==n0.track.id&&(fb.debug("video track changed: ".concat(n0.track.id," => ").concat(t0.track.id)),n0.track.removeEventListener("ended",r0),n0.track=t0.track,n0.track.addEventListener("ended",r0))},n0.worker=i0}}function r0(){if(t0.track){if(this.id!==t0.track.id)return;t0.track.removeEventListener("ended",r0)}const i0=LU.get(t0);if(i0){LU.delete(t0);try{var o0,s0;(o0=i0.controller)===null||o0===void 0||o0.terminate(),(s0=i0.worker)===null||s0===void 0||s0.terminate()}catch(a0){fb.warning(a0&&a0.message)}}}LU.set(t0,n0),t0.track.addEventListener("ended",r0)}const MU=new Map;(function(){const t0=Hv();QP.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),QP.getStreamFromExtension=t0.name===Bv.CHROME&&Number(t0.version)>34,QP.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e0=new RTCPeerConnection;let n0=!1;try{e0.addTransceiver("audio"),n0=!0}catch{}return e0.close(),n0}(),QP.supportMinBitrate=t0.name===Bv.CHROME||t0.name===Bv.EDGE,QP.supportSetRtpSenderParameters=function(){const e0=Hv();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ey()||!(!Xv()&&!zv())||e0.name===Bv.FIREFOX&&Number(e0.version)>=64)}(),t0.name===Bv.SAFARI&&(Number(t0.version)>=14?QP.supportDualStream=!0:QP.supportDualStream=!1),QP.webAudioMediaStreamDest=function(){const e0=Hv();return!(e0.name===Bv.SAFARI&&Number(e0.version)<12)}(),QP.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",QP.supportWebGL=typeof WebGLRenderingContext<"u",QP.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ey()||(QP.webAudioWithAEC=!0),QP.supportShareAudio=function(){const e0=Hv();return(e0.os===Fv.WIN_10||e0.os===Fv.WIN_81||e0.os===Fv.WIN_7||e0.os===Fv.LINUX||e0.os===Fv.MAC_OS||e0.os===Fv.CHROMIUM_OS)&&e0.name===Bv.CHROME&&Number(e0.version)>=74}(),QP.supportDataChannel=!!(ey(76)||function(e0){const n0=Hv();return!(n0.name!==Bv.FIREFOX||!n0.osVersion)&&Number(n0.version)>=e0}(68)||ny(14)),QP.supportPCSetConfiguration=function(){const e0=window.RTCPeerConnection;return!Zv()&&!!e0&&e0.prototype.setConfiguration instanceof Function}(),QP.supportWebRTCEncodedTransform=function(){const e0=Hv();return e0.name==="Chrome"&&Number(e0.version)>=86||e0.name==="Safari"&&Number(e0.version)>=15}(),QP.supportWebRTCInsertableStream=function(){const e0=Hv();return(e0.name===Bv.CHROME||e0.name===Bv.EDGE)&&Number(e0.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),QP.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,QP.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,oA(()=>{QP.supportDualStreamEncoding=function(){const e0=Hv();return!!XA("DISABLE_WEBAUDIO")||e0.name==="Safari"&&Number(e0.version)>=14||!!(e0.name==="Chrome"&&/Windows/i.test(e0.os||"")&&Number(e0.version)>=100&&XA("CHROME_DUAL_STREAM_USE_ENCODING"))}(),fb.info("browser compatibility",JSON.stringify(QP),JSON.stringify(t0))})})();class UU extends xy{constructor(e0,n0){super(),Fg(this,"signal",void 0),Fg(this,"token",void 0),Fg(this,"tokenTimeout",void 0),Fg(this,"tokenInterval",void 0),Fg(this,"_sequence",0),Fg(this,"userMap",new Map),Fg(this,"encoder",new TextEncoder),this.signal=e0,this.token=n0;const r0=()=>{this.signal.connectionState===Nw.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r0,1e3):this.tokenInterval=window.setTimeout(r0,3*XA("P2P_TOKEN_INTERVAL"))};r0()}async send(e0,n0,r0,i0,o0){var s0,a0,c0;if(this.userMap.size===0)return;const u0=Array.from(_N(s0=this.userMap).call(s0))[0].token;typeof n0!="string"&&(n0=JSON.stringify(n0)),i0=(a0=i0)!==null&&a0!==void 0?a0:TA(6,""),o0=(c0=o0)!==null&&c0!==void 0?c0:this._sequence++;const l0={_id:i0,_type:e0,_seq:o0,_message:n0,token:"".concat(this.token,"_").concat(u0)};XA("SHOW_P2P_LOG")&&fb.debug("send message",l0,"noNeedResponse : ".concat(r0)),this.splitMessage(JSON.stringify(l0)).forEach(h0=>{this.signal.request(Pw.DATA_STREAM,{payload:uA(this.encoder.encode(h0))})});const d0=new Gh((h0,p0)=>{const m0=window.setTimeout(()=>{this.off("res-@".concat(i0,"_ack"),f0),this.off("res-@".concat(i0),E0),this.off(vO.ABORT,g0),fb.debug("[external-signal] request timeout, type: ".concat(e0,", requestId: ").concat(i0)),this.userMap.size===0?p0(new Cy(Ry.INVALID_REMOTE_USER)):p0(new Cy(Ry.TIMEOUT))},XA("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),f0=()=>{m0&&window.clearTimeout(m0),this.off(vO.ABORT,g0),r0&&h0()},g0=()=>{m0&&window.clearTimeout(m0),this.off("res-@".concat(i0,"_ack"),f0),this.off("res-@".concat(i0),E0),p0(new Cy(Ry.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e0,", requestId: ").concat(i0)))};this.once(vO.ABORT,g0),this.once("res-@".concat(i0,"_ack"),f0);const E0=(y0,b0)=>{_0=!0,m0&&window.clearTimeout(m0),this.off("res-@".concat(i0,"_ack"),f0),this.off(vO.ABORT,g0),y0==="success"?h0(b0):p0(new Cy(Ry.P2P_MESSAGE_FAILED,"request ".concat(e0," failed, requestId: ").concat(i0)))};let _0=!1;r0||(this.once("res-@".concat(i0),E0),mA(XA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{_0||fb.warning("external_signal request timeout, type: ".concat(e0,", requestId: ").concat(i0,", ").concat(l0))}))});try{return await d0}catch(h0){if(h0.code===Ry.TIMEOUT)return await this.send(e0,n0,r0,i0,o0);throw h0}}onMessage(e0){var n0;const{_uid:r0}=e0;let i0,o0=this.userMap.get(r0);if(o0)i0=o0.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e0)||e0._type!==IO.CHECK)return;const{token:u0}=e0;i0=new Map,o0={uid:r0,isStart:!0,token:u0,splitMessageMap:i0,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r0,o0),this.signal.emit(kw.ON_USER_ONLINE,{uid:r0}),this.handleUserOnline()}if("id"in e0&&"total"in e0){var s0;const{id:u0,total:l0}=e0,d0=(s0=i0.get(u0))!==null&&s0!==void 0?s0:[];if(d0.push(e0),i0.has(u0)||i0.set(u0,d0),d0.length!==l0)return;{const h0=aE(d0).call(d0,(p0,m0)=>p0.index-m0.index).map(p0=>p0.payload).join("");i0.delete(u0),(e0=JSON.parse(h0))._uid=r0}}const{_type:a0,token:c0}=e0;if(Dn(n0=[IO.ACK,IO.CHECK]).call(n0,a0))return a0===IO.CHECK&&this.handleCheckToken(o0,c0),void this.receiveMessage(e0);c0==="".concat(o0.token,"_").concat(this.token)?this.handleReceivedMessage(e0):fb.debug('Receive unexpected message", '.concat(c0,", cur_token: ").concat(o0.token,"_").concat(this.token),e0)}check(){const e0={_id:TA(6,""),token:this.token,_type:IO.CHECK};XA("SHOW_P2P_LOG")&&fb.debug("send message",e0),this.signal.request(Pw.DATA_STREAM,{payload:uA(this.encoder.encode(JSON.stringify(e0)))})}ack(e0){const n0={_id:e0,_type:IO.ACK,token:this.token};XA("SHOW_P2P_LOG")&&fb.debug("send message",n0),this.signal.request(Pw.DATA_STREAM,{payload:uA(this.encoder.encode(JSON.stringify(n0)))})}response(e0,n0,r0){this.send(IO.RESPONSE,JSON.stringify({success:!r0,message:n0}),!0,e0)}handleReceivedMessage(e0){const n0=()=>{this.userMap.forEach(u0=>{const{receivedMessagesMap:l0,nextExpectedSequenceNumber:d0}=u0;for(;l0.has(d0);){const h0=l0.get(d0);l0.delete(d0),this.receiveMessage(h0),u0.nextExpectedSequenceNumber++}})};if(!e0)return void n0();const{_uid:r0,_seq:i0}=e0,o0=this.userMap.get(r0),{receivedMessagesMap:s0,isStart:a0,nextExpectedSequenceNumber:c0}=o0;if(i0<c0)return this.ack(e0._id),void fb.debug("[external-signal] receive old message, seq: ".concat(i0,", ").concat(e0._message));s0.set(i0,e0),a0&&i0===c0&&(this.receiveMessage(e0),s0.delete(c0),o0.nextExpectedSequenceNumber++,n0())}receiveMessage(e0){const{_id:n0,_type:r0,_message:i0,_uid:o0}=e0;if(XA("SHOW_P2P_LOG")&&fb.debug("receive message",e0),n0){let s0;switch(e0._type!==IO.ACK&&(i0&&(s0=JSON.parse(i0)),this.ack(e0._id)),e0._type){case IO.CANDIDATE:case IO.CONTROL:this.signal.emit(r0,s0,o0);break;case IO.PUBLISH:case IO.UNPUBLISH:case IO.RESTART_ICE:case IO.CALL:s0.uid=o0,Zy(this.signal,r0,s0).then(a0=>{this.response(e0._id,a0)}).catch(()=>{this.response(e0._id,void 0,!0)});break;case IO.ACK:this.getListeners("res-@".concat(n0,"_ack")).length>0&&this.emit("res-@".concat(n0,"_ack"));break;case IO.RESPONSE:{const{success:a0,message:c0}=s0;this.emit("res-@".concat(n0),a0?"success":"failed",c0);break}}}}splitMessage(e0){if(e0.length<UU.MAX_MESSAGE_SIZE)return[e0];const n0=[],{remoteToken:r0}=JSON.parse(e0),i0=TA(6,"");let o0=0,s0=800;const a0=Math.ceil(e0.length/s0);for(;e0.length>0;){o0++;const c0={id:i0,index:o0,total:a0,payload:e0.slice(0,s0),token:"".concat(this.token,"_").concat(r0)};JSON.stringify(c0).length>UU.MAX_MESSAGE_SIZE?s0-=50:(n0.push(c0),e0=e0.slice(s0))}return n0.map(c0=>JSON.stringify(c0))}handleCheckToken(e0,n0){return e0.token!==n0?(fb.debug("token changed, from ".concat(e0.token," to ").concat(n0)),this.reset(e0.uid,n0),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{fb.debug("token timeout, ".concat(n0)),this.reset(e0.uid)},XA("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e0=await Zy(this.signal,IO.CALL,void 0),n0=await this.send(IO.CALL,e0);this.signal.emit(Dw.P2P_CONNECTION,n0,!0)}async reset(e0,n0){const r0=this.userMap.get(e0);r0&&(this.emit(vO.ABORT),this.signal.emit(kw.ON_USER_OFFLINE,{uid:r0.uid,reason:AO.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n0||(fb.debug("change local token from ".concat(n0," to ").concat(n0)),this.token=TA(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(vO.ABORT)}}Fg(UU,"MAX_SIZE",1),Fg(UU,"MAX_MESSAGE_SIZE",1024);class xU extends xy{get connectionState(){return this._connectionState}set connectionState(e0){e0!==this._connectionState&&(this._connectionState=e0,e0===Nw.CONNECTED?this.emit(Dw.WS_CONNECTED):e0===Nw.RECONNECTING?this.emit(Dw.WS_RECONNECTING,this._websocketReconnectReason):e0===Nw.CLOSED&&this.emit(Dw.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e0,n0){super(),Fg(this,"_disconnectedReason",void 0),Fg(this,"_websocketReconnectReason",void 0),Fg(this,"_connectionState",Nw.CLOSED),Fg(this,"reconnectToken",void 0),Fg(this,"p2pToken",void 0),Fg(this,"websocket",void 0),Fg(this,"openConnectionTime",void 0),Fg(this,"clientId",void 0),Fg(this,"lastMsgTime",Date.now()),Fg(this,"uploadCache",[]),Fg(this,"uploadCacheInterval",void 0),Fg(this,"rttRolling",new MA(5)),Fg(this,"pingpongTimer",void 0),Fg(this,"pingpongTimeoutCount",0),Fg(this,"joinResponse",void 0),Fg(this,"multiIpOption",void 0),Fg(this,"initError",void 0),Fg(this,"spec",void 0),Fg(this,"store",void 0),Fg(this,"_external_signal",void 0),Fg(this,"onWebsocketMessage",r0=>{if(r0.data instanceof ArrayBuffer)return void this.emit(Dw.ON_BINARY_DATA,r0.data);const i0=JSON.parse(r0.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i0,"_id")){const o0="res-@".concat(i0._id);this.emit(o0,i0._result,i0._message)}else if(Object.prototype.hasOwnProperty.call(i0,"_type")){switch(i0._type){case kw.ON_DATA_STREAM:return void this.handleDataStream(i0._message);case kw.MUTE_AUDIO:case kw.MUTE_VIDEO:case kw.ON_P2P_LOST:case kw.ON_USER_ONLINE:return;case kw.ON_USER_OFFLINE:const{uid:o0}=i0._message;return fb.debug("[".concat(this.clientId,"] user-offline uid: ").concat(o0)),void this._external_signal.reset(o0)}if(this.emit(i0._type,i0._message),i0._type===kw.ON_NOTIFICATION&&this.handleNotification(i0._message),i0._type===kw.ON_USER_BANNED)switch(i0._message.error_code){case 14:this.close(Hy.UID_BANNED);break;case 15:this.close(Hy.IP_BANNED);break;case 16:this.close(Hy.CHANNEL_BANNED)}if(i0._type===kw.ON_USER_LICENSE_BANNED)switch(i0._message.error_code){case Ow.ERR_LICENSE_MISSING:this.close(Hy.LICENSE_MISSING);break;case Ow.ERR_LICENSE_EXPIRED:this.close(Hy.LICENSE_EXPIRED);break;case Ow.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Hy.LICENSE_MINUTES_EXCEEDED);break;case Ow.ERR_LICENSE_PERIOD_INVALID:this.close(Hy.LICENSE_PERIOD_INVALID);break;case Ow.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Hy.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ow.ERR_LICENSE_ILLEGAL:this.close(Hy.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e0.clientId,this.spec=e0,this.store=n0,this.websocket=new WO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,XA("JOIN_GATEWAY_USE_DUAL_DOMAIN"),XA("JOIN_GATEWAY_USE_443PORT_ONLY"),n0),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Nw.CONNECTED&&this.reconnect("retry",Jy.OFFLINE)}),this.p2pToken=TA(6,""),this._external_signal=new UU(this,this.p2pToken)}async request(e0,n0,r0,i0){const o0=TA(6,""),s0={_id:o0,_type:e0,_message:n0},a0=this.websocket.connectionID,c0=()=>new Gh((m0,f0)=>{if(this.connectionState===Nw.CONNECTED)return m0();const g0=()=>{this.off(Dw.WS_CLOSED,E0),m0()},E0=()=>{this.off(Dw.WS_CONNECTED,g0),f0(new Cy(Ry.WS_ABORT))};this.once(Dw.WS_CONNECTED,g0),this.once(Dw.WS_CLOSED,E0)});if(this.connectionState!==Nw.CONNECTING&&this.connectionState!==Nw.RECONNECTING||e0===Pw.JOIN||e0===Pw.REJOIN||await c0(),this.websocket.sendMessage(s0,!0),i0)return;const u0=new Gh((m0,f0)=>{let g0=!1;const E0=(y0,b0)=>{g0=!0,m0({isSuccess:y0==="success",message:b0||{}}),this.off(Dw.WS_CLOSED,_0),this.off(Dw.WS_RECONNECTING,_0),this.emit(Dw.REQUEST_SUCCESS,e0,n0)};this.once("res-@".concat(o0),E0);const _0=()=>{f0(new Cy(Ry.WS_ABORT,"type: ".concat(e0))),this.off(Dw.WS_CLOSED,_0),this.off(Dw.WS_RECONNECTING,_0),this.off("res-@".concat(o0),E0)};this.once(Dw.WS_CLOSED,_0),this.once(Dw.WS_RECONNECTING,_0),mA(XA("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a0||g0||(fb.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e0)),this.emit(Dw.REQUEST_TIMEOUT,e0,n0))})});let l0=null;try{l0=await u0}catch(m0){if(this.connectionState===Nw.CLOSED||e0===Pw.LEAVE)throw new Cy(Ry.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r0?m0.throw():e0===Pw.JOIN||e0===Pw.REJOIN?null:(await c0(),await this.request(e0,n0))}if(l0.isSuccess)return l0.message;const d0=Number(l0.message.error_code||l0.message.code),h0=NO(d0),p0=new Cy(Ry.UNEXPECTED_RESPONSE,"".concat(h0.desc,": ").concat(l0.message.error_str),{code:d0,data:l0.message,desc:h0.desc});return h0.action==="success"?l0.message:(fb.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e0,", error_code: ").concat(d0,", message: ").concat(h0.desc,", action: ").concat(h0.action)),d0===Ow.ERR_TOO_MANY_BROADCASTERS?((e0===Pw.JOIN||e0===Pw.REJOIN)&&(this.initError=p0,this.close()),p0.throw()):h0.action==="failed"?p0.throw():h0.action==="quit"?(this.initError=p0,this.close(),p0.throw()):(d0===Ow.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l0.message.option,fb.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Jy.MULTI_IP)):this.reconnect(h0.action,Jy.SERVER_ERROR),e0===Pw.JOIN||e0===Pw.REJOIN?null:await this.request(e0,n0)))}waitMessage(e0,n0){return new Gh(r0=>{const i0=o0=>{(!n0||n0(o0))&&(this.off(e0,i0),r0(o0))};this.on(e0,i0)})}uploadWRTCStats(e0){if(!this.store.sessionId)return void fb.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n0={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e0};this.upload(Lw.WRTC_STATS,n0)}upload(e0,n0){const r0={_type:e0,_message:n0};try{this.websocket.sendMessage(r0)}catch{const o0=XA("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r0),this.uploadCache.length>o0&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Nw.CONNECTED)return;const s0=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s0._type,s0._message)},XA("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e0,n0){const r0={_type:e0,_message:n0};this.websocket.sendMessage(r0)}async sendExtensionMessage(e0,n0,r0){return await this._external_signal.send(e0,n0,r0)}init(e0){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Gh((n0,r0)=>{this.once(Dw.WS_CONNECTED,()=>n0(this.joinResponse)),this.once(Dw.WS_CLOSED,()=>r0(this.initError||new Cy(Ry.WS_ABORT))),this.connectionState=Nw.CONNECTING,this.websocket.init(e0).catch(r0)})}close(e0){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e0||Hy.LEAVE,this.connectionState=Nw.CLOSED,fb.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=TA(6,""),this._external_signal.clear(),this._external_signal=new UU(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Dw.ABORT_P2P_EXECUTION);const e0=await Zy(this,Dw.REQUEST_JOIN_INFO),n0=await this.request(Pw.JOIN,e0);if(!n0)return this.emit(Dw.REPORT_JOIN_GATEWAY,Ry.TIMEOUT,this.url||""),!1;this.joinResponse=n0,this.emit(Dw.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Nw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e0,n0){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e0,n0)}handleDataStream(e0){try{var n0;const r0=lA(e0.payload),i0=new TextDecoder().decode(r0),o0=JSON.parse(i0);"total"in o0&&"id"in o0||Dn(n0=Object.values(IO)).call(n0,o0._type)?(o0._uid=e0.uid,this._external_signal.onMessage(o0)):this.emit(kw.ON_DATA_STREAM,e0)}catch{this.emit(kw.ON_DATA_STREAM,e0)}}handleNotification(e0){fb.debug("[".concat(this.clientId,"] receive notification: "),e0);const n0=NO(e0.code);if(n0.action!=="success"){if(n0.action!=="failed")return n0.action==="quit"?(n0.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Hy.UID_BANNED),void this.close()):void this.reconnect(n0.action,Jy.SERVER_ERROR);fb.error("[".concat(this.clientId,"] ignore error: "),n0.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e0=XA("PING_PONG_TIME_OUT"),n0=Date.now();this.pingpongTimeoutCount>=e0&&(fb.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n0-this.lastMsgTime,"ms")),n0-this.lastMsgTime>XA("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Jy.TIMEOUT):this.request(Pw.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r0=Date.now()-n0;this.rttRolling.add(r0),XA("REPORT_STATS")&&this.send(Pw.PING_BACK,{pingpongElapse:r0})}).catch(r0=>{})}handleWebsocketEvents(){this.websocket.on(Uw.RECONNECT_WAITTING_FINISH,e0=>{this.emit(Dw.WS_RECONNECT_WAITTING_FINISH,e0)}),this.websocket.on(Uw.RECONNECT_CREATE_CONNECTION,e0=>{this.emit(Dw.WS_RECONNECT_CREATE_CONNECTION,e0)}),this.websocket.on(Uw.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Uw.CLOSED,()=>{this.connectionState=Nw.CLOSED}),this.websocket.on(Uw.FAILED,()=>{this._disconnectedReason=Hy.NETWORK_ERROR,this.connectionState=Nw.CLOSED}),this.websocket.on(Uw.RECONNECTING,e0=>{this._websocketReconnectReason=e0,this.joinResponse=void 0,this.connectionState===Nw.CONNECTED?this.connectionState=Nw.RECONNECTING:this.connectionState=Nw.CONNECTING}),this.websocket.on(Uw.WILL_RECONNECT,(e0,n0,r0)=>{e0!=="retry"?(fb.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e0)),this.reconnectToken=void 0):fb.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r0(e0)}),this.websocket.on(Uw.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e0=>{if(this.emit(Dw.REPORT_JOIN_GATEWAY,e0,this.url||""),e0 instanceof Cy&&e0.code===Ry.UNEXPECTED_RESPONSE&&e0.data.code===Ow.ERR_NO_AUTHORIZED)return fb.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Jy.SERVER_ERROR);fb.error("[".concat(this.clientId,"] join gateway request failed"),e0.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Jy.SERVER_ERROR):(this.initError=e0,this.close())})}),this.websocket.on(Uw.REQUEST_NEW_URLS,(e0,n0)=>{Zy(this,Dw.REQUEST_RECOVER,this.multiIpOption).then(e0).catch(n0)}),this.websocket.on(Uw.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(kw.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var VU={exports:{}};VU.exports=(()=>{var t0={8:(r0,i0,o0)=>{o0.r(i0),o0.d(i0,{Parser:()=>M0,Printer:()=>k0,parse:()=>A0,print:()=>P0});const s0=`
`,a0="".concat("\r").concat(s0),c0=" ";let u0;function l0(O0){return O0>="0"&&O0<="9"}function d0(O0){return O0>="!"&&O0<="~"}function h0(O0){return d0(O0)||O0>=""&&O0<=""}function p0(O0){return O0==="!"||O0>="#"&&O0<="'"||O0>="*"&&O0<="+"||O0>="-"&&O0<="."||O0>="0"&&O0<="9"||O0>="A"&&O0<="Z"||O0>="^"&&O0<="~"}function m0(O0){return O0>="1"&&O0<="9"}function f0(O0){return O0>="A"&&O0<="Z"||O0>="a"&&O0<="z"}function g0(O0){return O0==="d"||O0==="h"||O0==="m"||O0==="s"}function E0(O0){return O0>""&&O0<"	"||O0>"\v"&&O0<"\f"||O0>""&&O0<""}function _0(O0){return f0(O0)||l0(O0)||O0==="+"||O0==="/"}function y0(O0){return l0(O0)||f0(O0)||O0==="+"||O0==="/"||O0==="-"||O0==="_"}function b0(O0){return f0(O0)||l0(O0)||O0==="+"||O0==="/"}function S0(O0,v0){var R0=Object.keys(O0);if(Object.getOwnPropertySymbols){var T0=Object.getOwnPropertySymbols(O0);v0&&(T0=T0.filter(function(F0){return Object.getOwnPropertyDescriptor(O0,F0).enumerable})),R0.push.apply(R0,T0)}return R0}function w0(O0){for(var v0=1;v0<arguments.length;v0++){var R0=arguments[v0]!=null?arguments[v0]:{};v0%2?S0(Object(R0),!0).forEach(function(T0){I0(O0,T0,R0[T0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(O0,Object.getOwnPropertyDescriptors(R0)):S0(Object(R0)).forEach(function(T0){Object.defineProperty(O0,T0,Object.getOwnPropertyDescriptor(R0,T0))})}return O0}function I0(O0,v0,R0){return v0 in O0?Object.defineProperty(O0,v0,{value:R0,enumerable:!0,configurable:!0,writable:!0}):O0[v0]=R0,O0}(function(O0){O0.VERSION="v",O0.ORIGIN="o",O0.SESSION_NAME="s",O0.INFORMATION="i",O0.URI="u",O0.EMAIL="e",O0.PHONE="p",O0.CONNECTION="c",O0.BANDWIDTH="b",O0.TIME="t",O0.REPEAT="r",O0.ZONE_ADJUSTMENTS="z",O0.KEY="k",O0.ATTRIBUTE="a",O0.MEDIA="m"})(u0||(u0={}));class L0{consumeText(v0,R0){let T0=R0;for(;T0<v0.length;){const F0=v0[T0];if(F0==="\0"||F0==="\r"||F0===s0)break;T0+=1}if(T0-R0==0)throw new Error("Invalid text, at ".concat(v0));return T0}consumeUnicastAddress(v0,R0,T0){return this.consumeTill(v0,R0,c0)}consumeOneOrMore(v0,R0,T0){let F0=R0;for(;T0(v0[F0]);)F0++;if(F0-R0==0)throw new Error("Invalid rule at ".concat(R0,"."));return F0}consumeSpace(v0,R0){if(v0[R0]===c0)return R0+1;throw new Error("Invalid space at ".concat(R0,"."))}consumeIP4Address(v0,R0){let T0=R0;for(let F0=0;F0<4;F0++)if(T0=this.consumeDecimalUChar(v0,T0),F0!==3){if(v0[T0]!==".")throw new Error("Invalid IP4 address.");T0++}return T0}consumeDecimalUChar(v0,R0){let T0=R0;for(let V0=0;V0<3&&l0(v0[T0]);V0++,T0++);if(T0-R0==0)throw new Error("Invalid decimal uchar.");const F0=parseInt(v0.slice(R0,T0));if(F0>=0&&F0<=255)return T0;throw new Error("Invalid decimal uchar")}consumeIP6Address(v0,R0){let T0=this.consumeHexpart(v0,R0);return v0[T0]===":"&&(T0+=1,T0=this.consumeIP4Address(v0,T0)),T0}consumeHexpart(v0,R0){let T0=R0;if(v0[T0]===":"&&v0[T0+1]===":"){T0+=2;try{T0=this.consumeHexseq(v0,T0)}catch{}return T0}if(T0=this.consumeHexseq(v0,T0),v0[T0]===":"&&v0[T0+1]===":"){T0+=2;try{T0=this.consumeHexseq(v0,T0)}catch{}return T0}return T0}consumeHexseq(v0,R0){let T0=R0;for(;T0=this.consumeHex4(v0,T0),v0[T0]===":"&&v0[T0+1]!==":";)T0+=1;return T0}consumeHex4(v0,R0){let T0=0;for(;T0<4;T0++)if(!((F0=v0[R0+T0])>="0"&&F0<="9"||F0>="a"&&F0<="f"||F0>="A"&&F0<="F")){if(T0===0)throw new Error("Invalid hex 4");break}var F0;return R0+T0}consumeFQDN(v0,R0){let T0=R0;for(;l0(v0[T0])||f0(v0[T0])||v0[T0]==="-"||v0[T0]===".";)T0+=1;if(T0-R0<4)throw new Error("Invalid FQDN");return T0}consumeExtnAddr(v0,R0){return this.consumeOneOrMore(v0,R0,h0)}consumeMulticastAddress(v0,R0,T0){switch(T0){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(v0,R0);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(v0,R0);default:try{return this.consumeFQDN(v0,R0)}catch{return this.consumeExtnAddr(v0,R0)}}}consumeIP6MulticastAddress(v0,R0){const T0=this.consumeHexpart(v0,R0);return v0[T0]==="/"?this.consumeInteger(v0,T0+1):T0}consumeIP4MulticastAddress(v0,R0){let T0=R0+3;const F0=v0.slice(R0,T0),V0=parseInt(F0);if(V0<224||V0>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let H0=0;H0<3;H0++){if(v0[T0]!==".")throw new Error("Invalid IP4 multicast address.");T0+=1,T0=this.consumeDecimalUChar(v0,T0)}return v0[T0]==="/"&&(T0+=1),T0=this.consumeTTL(v0,T0),v0[T0]==="/"&&(T0=this.consumeInteger(v0,T0)),T0}consumeInteger(v0,R0){if(!m0(v0[R0]))throw new Error("Invalid integer.");for(R0+=1;l0(v0[R0]);)R0+=1;return R0}consumeTTL(v0,R0){if(v0[R0]==="0")return R0+1;if(!m0(v0[R0]))throw new Error("Invalid TTL.");R0+=1;for(let T0=0;T0<2&&l0(v0[R0]);T0++)R0+=1;return R0}consumeToken(v0,R0){return this.consumeOneOrMore(v0,R0,p0)}consumeTime(v0,R0){let T0=R0;if(v0[T0]==="0")return T0+1;for(m0(v0[T0])&&(T0+=1);l0(v0[T0]);)T0++;if(T0-R0<10)throw new Error("Invalid time");return T0}consumeAddress(v0,R0){return this.consumeTill(v0,R0,c0)}consumeTypedTime(v0,R0){let T0=R0;return T0=this.consumeOneOrMore(v0,T0,l0),g0(v0[T0])?T0+1:T0}consumeRepeatInterval(v0,R0){if(!m0(v0[R0]))throw new Error("Invalid repeat interval");for(R0+=1;l0(v0[R0]);)R0+=1;return g0(v0[R0])&&(R0+=1),R0}consumePort(v0,R0){return this.consumeOneOrMore(v0,R0,l0)}consume(v0,R0,T0){for(let F0=0;F0<T0.length;F0++){if(R0+F0>=v0.length)throw new Error("consume exceeding value length");if(v0[R0+F0]!==T0[F0])throw new Error("consume ".concat(T0," failed at ").concat(F0))}return R0+T0.length}consumeTill(v0,R0,T0){let F0=R0;for(;F0<v0.length&&(typeof T0!="string"||v0[F0]!==T0)&&(typeof T0!="function"||!T0(v0[F0]));)F0++;return F0}}class M0 extends L0{constructor(){super(),I0(this,"records",[]),I0(this,"currentLine",0)}parse(v0){const R0=this.probeEOL(v0);this.records=v0.split(R0).filter(B0=>!!jp(B0).call(B0)).map(this.parseLine),this.currentLine=0;const T0=this.parseVersion(),F0=this.parseOrigin(),V0=this.parseSessionName(),H0=this.parseInformation(),X0=this.parseUri(),Z0=this.parseEmail(),n1=this.parsePhone(),s1=this.parseConnection(),i1=this.parseBandWidth(),e1=this.parseTimeFields(),J0=this.parseKey(),K0=this.parseSessionAttribute(),q0=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:T0,origin:F0,sessionName:V0,information:H0,uri:X0,emails:Z0,phones:n1,connection:s1,bandwidths:i1,timeFields:e1,key:J0,attributes:K0,mediaDescriptions:q0}}getCurrentRecord(){const v0=this.records[this.currentLine];if(!v0)throw new Error("Record doesn't exit.");return v0}probeEOL(v0){for(let R0=0;R0<v0.length;R0++)if(v0[R0]===s0)return v0[R0-1]==="\r"?a0:s0;throw new Error("Invalid newline character.")}parseLine(v0,R0){if(v0.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const T0=v0[0];if(v0[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:T0,value:v0.slice(2),line:R0,cur:0}}parseSessionAttribute(){const v0=new U0;for(;this.currentLine<this.records.length;){const R0=this.getCurrentRecord();if(R0.type!==u0.ATTRIBUTE)break;const T0={attField:this.extractOneOrMore(R0,F0=>p0(F0)&&F0!==":"),_cur:0};R0.value[R0.cur]===":"&&(R0.cur+=1,T0.attValue=this.extractOneOrMore(R0,E0)),v0.parse(T0),this.currentLine++}return v0.digest()}parseMediaAttributes(v0){const R0=new x0(v0);for(;this.currentLine<this.records.length;){const T0=this.getCurrentRecord();if(T0.type!==u0.ATTRIBUTE)break;const F0={attField:this.extractOneOrMore(T0,V0=>p0(V0)&&V0!==":"),_cur:0};T0.value[T0.cur]===":"&&(T0.cur+=1,F0.attValue=this.extractOneOrMore(T0,E0)),R0.parse(F0),this.currentLine++}return R0.digest()}parseKey(){const v0=this.getCurrentRecord();if(v0.type===u0.KEY){if(v0.value==="prompt"||v0.value==="clear:"||v0.value==="base64:"||v0.value==="uri:")return v0.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const v0=this.getCurrentRecord();if(v0.type===u0.ZONE_ADJUSTMENTS){const R0=[];for(;;)try{const T0=this.extract(v0,this.consumeTime);this.consumeSpaceForRecord(v0);let F0=!1;v0.value[v0.cur]==="-"&&(F0=!0,v0.cur+=1);const V0=this.extract(v0,this.consumeTypedTime);R0.push({time:T0,typedTime:V0,back:F0})}catch{break}if(R0.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,R0}return[]}parseRepeat(){const v0=[];for(;;){const R0=this.getCurrentRecord();if(R0.type!==u0.REPEAT)break;{const T0=this.extract(R0,this.consumeRepeatInterval),F0=this.parseTypedTime(R0);v0.push({repeatInterval:T0,typedTimes:F0}),this.currentLine++}}return v0}parseTypedTime(v0){const R0=[];for(;;)try{this.consumeSpaceForRecord(v0),R0.push(this.extract(v0,this.consumeTypedTime))}catch{break}if(R0.length===0)throw new Error("Invalid typed time.");return R0}parseTime(){const v0=this.getCurrentRecord(),R0=this.extract(v0,this.consumeTime);this.consumeSpaceForRecord(v0);const T0=this.extract(v0,this.consumeTime);return this.currentLine++,{startTime:R0,stopTime:T0}}parseBandWidth(){const v0=[];for(;this.currentLine<this.records.length;){const R0=this.getCurrentRecord();if(R0.type!==u0.BANDWIDTH)break;{const T0=this.extractOneOrMore(R0,p0);if(R0.value[R0.cur]!==":")throw new Error("Invalid bandwidth field.");R0.cur++;const F0=this.extractOneOrMore(R0,l0);v0.push({bwtype:T0,bandwidth:F0}),this.currentLine++}}return v0}parseVersion(){const v0=this.getCurrentRecord();if(v0.type!==u0.VERSION)throw new Error("first sdp record must be version");const R0=v0.value.slice(0,this.consumeOneOrMore(v0.value,0,l0));if(R0.length!==v0.value.length)throw new Error('invalid proto version, "v='.concat(v0.value,'"'));return this.currentLine++,R0}parseOrigin(){const v0=this.getCurrentRecord();if(v0.type!==u0.ORIGIN)throw new Error("second line of sdp must be origin");const R0=this.extractOneOrMore(v0,h0);this.consumeSpaceForRecord(v0);const T0=this.extractOneOrMore(v0,l0);this.consumeSpaceForRecord(v0);const F0=this.extractOneOrMore(v0,l0);this.consumeSpaceForRecord(v0);const V0=this.extractOneOrMore(v0,p0);this.consumeSpaceForRecord(v0);const H0=this.extractOneOrMore(v0,p0);this.consumeSpaceForRecord(v0);const X0=this.extract(v0,this.consumeUnicastAddress);return this.currentLine++,{username:R0,sessId:T0,sessVersion:F0,nettype:V0,addrtype:H0,unicastAddress:X0}}parseSessionName(){const v0=this.getCurrentRecord();if(v0.type===u0.SESSION_NAME){const R0=this.extract(v0,this.consumeText);return this.currentLine++,R0}}parseInformation(){const v0=this.getCurrentRecord();if(v0.type!==u0.INFORMATION)return;const R0=this.extract(v0,this.consumeText);return this.currentLine++,R0}parseUri(){const v0=this.getCurrentRecord();if(v0.type===u0.URI)return this.currentLine++,v0.value}parseEmail(){const v0=[];for(;;){const R0=this.getCurrentRecord();if(R0.type!==u0.EMAIL)break;v0.push(R0.value),this.currentLine++}return v0}parsePhone(){const v0=[];for(;;){const R0=this.getCurrentRecord();if(R0.type!==u0.PHONE)break;v0.push(R0.value),this.currentLine++}return v0}parseConnection(){const v0=this.getCurrentRecord();if(v0.type===u0.CONNECTION){const R0=this.extractOneOrMore(v0,p0);this.consumeSpaceForRecord(v0);const T0=this.extractOneOrMore(v0,p0);this.consumeSpaceForRecord(v0);const F0=this.extract(v0,this.consumeAddress);return this.currentLine++,{nettype:R0,addrtype:T0,address:F0}}}parseMedia(){const v0=this.getCurrentRecord(),R0=this.extract(v0,this.consumeToken);this.consumeSpaceForRecord(v0);let T0=this.extract(v0,this.consumePort);v0.value[v0.cur]==="/"&&(v0.cur+=1,T0+=this.extract(v0,this.consumeInteger)),this.consumeSpaceForRecord(v0);const F0=[];for(F0.push(this.extract(v0,this.consumeToken));v0.value[v0.cur]==="/";)v0.cur+=1,F0.push(this.extract(v0,this.consumeToken));if(F0.length===0)throw new Error("Invalid proto");const V0=this.parseFmt(v0);return this.currentLine++,{mediaType:R0,port:T0,protos:F0,fmts:V0}}parseTimeFields(){const v0=[];for(;this.getCurrentRecord().type===u0.TIME;){const R0=this.parseTime(),T0=this.parseRepeat(),F0=this.parseZone();v0.push({time:R0,repeats:T0,zones:F0})}return v0}parseMediaDescription(){const v0=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u0.MEDIA;){const R0=this.parseMedia(),T0=this.parseInformation(),F0=this.parseConnections(),V0=this.parseBandWidth(),H0=this.parseKey(),X0=this.parseMediaAttributes(R0);v0.push({media:R0,information:T0,connections:F0,bandwidths:V0,key:H0,attributes:X0})}return v0}parseConnections(){const v0=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u0.CONNECTION;)v0.push(this.parseConnection());return v0}parseFmt(v0){const R0=[];for(;;)try{this.consumeSpaceForRecord(v0),R0.push(this.extract(v0,this.consumeToken))}catch{break}if(R0.length===0)throw new Error("Invalid fmts");return R0}extract(v0,R0){for(var T0=arguments.length,F0=new Array(T0>2?T0-2:0),V0=2;V0<T0;V0++)F0[V0-2]=arguments[V0];const H0=R0.call(this,v0.value,v0.cur,...F0),X0=v0.value.slice(v0.cur,H0);return v0.cur=H0,X0}extractOneOrMore(v0,R0){const T0=this.consumeOneOrMore(v0.value,v0.cur,R0),F0=v0.value.slice(v0.cur,T0);return v0.cur=T0,F0}consumeSpaceForRecord(v0){if(v0.value[v0.cur]!==c0)throw new Error("Invalid space at ".concat(v0.cur,"."));v0.cur+=1}}class C0 extends L0{constructor(){super(...arguments),I0(this,"attributes",void 0),I0(this,"digested",!1)}extractOneOrMore(v0,R0,T0){const F0=this.consumeOneOrMore(v0.attValue,v0._cur,R0),V0=v0.attValue.slice(v0._cur,F0),[H0,X0]=T0||[];if(typeof H0=="number"&&V0.length<H0)throw new Error("error in length, should be more or equal than ".concat(H0," characters."));if(typeof X0=="number"&&V0.length>X0)throw new Error("error in length, should be less or equal than ".concat(X0," characters."));return v0._cur=F0,V0}consumeAttributeSpace(v0){if(v0.attValue[v0._cur]!==c0)throw new Error("Invalid space at ".concat(v0._cur,"."));v0._cur+=1}extract(v0,R0){if(!v0.attValue)throw new Error("Nothing to extract from attValue.");for(var T0=arguments.length,F0=new Array(T0>2?T0-2:0),V0=2;V0<T0;V0++)F0[V0-2]=arguments[V0];const H0=R0.call(this,v0.attValue,v0._cur,...F0),X0=v0.attValue.slice(v0._cur,H0);return v0._cur=H0,X0}atEnd(v0){if(!v0.attValue)throw new Error;return v0._cur>=v0.attValue.length}peekChar(v0){if(!v0.attValue)throw new Error;return v0.attValue[v0._cur]}peek(v0,R0){if(!v0.attValue)throw new Error;for(let T0=0;T0<R0.length;T0++)if(R0[T0]!==v0.attValue[v0._cur+T0])return!1;return!0}parseIceUfrag(v0){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(v0,_0,[4,256])}parseIcePwd(v0){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(v0,_0,[22,256])}parseIceOptions(v0){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const R0=[];for(;!this.atEnd(v0);){R0.push(this.extractOneOrMore(v0,_0));try{this.consumeAttributeSpace(v0)}catch(T0){if(this.atEnd(v0))break;throw T0}}this.attributes.iceOptions=R0}parseFingerprint(v0){const R0=this.extract(v0,this.consumeToken);this.consumeAttributeSpace(v0);const T0=this.extract(v0,this.consumeTill);this.attributes.fingerprints.push({hashFunction:R0,fingerprint:T0})}parseExtmap(v0){const R0=this.extractOneOrMore(v0,l0);let T0;this.peekChar(v0)==="/"&&(this.extract(v0,this.consume,"/"),T0=this.extract(v0,this.consumeToken)),this.consumeAttributeSpace(v0);const F0=this.extract(v0,this.consumeTill,c0),V0=w0(w0({entry:parseInt(R0,10)},T0&&{direction:T0}),{},{extensionName:F0});this.peekChar(v0)===c0&&(this.consumeAttributeSpace(v0),V0.extensionAttributes=this.extract(v0,this.consumeTill)),this.attributes.extmaps.push(V0)}parseSetup(v0){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const R0=this.extract(v0,this.consumeTill);if(R0!=="active"&&R0!=="passive"&&R0!=="actpass"&&R0!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=R0}}class U0 extends C0{constructor(){super(...arguments),I0(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(v0){if(this.digested)throw new Error("already digested");try{switch(v0.attField){case"group":this.parseGroup(v0);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(v0);break;case"ice-pwd":this.parseIcePwd(v0);break;case"ice-options":this.parseIceOptions(v0);break;case"fingerprint":this.parseFingerprint(v0);break;case"setup":this.parseSetup(v0);break;case"tls-id":this.parseTlsId(v0);break;case"identity":this.parseIdentity(v0);break;case"extmap":this.parseExtmap(v0);break;case"msid-semantic":this.parseMsidSemantic(v0);break;default:v0.ignored=!0,this.attributes.unrecognized.push(v0)}}catch(R0){throw console.error("parsing session attribute ".concat(v0.attField,' error, "a=').concat(v0.attField,":").concat(v0.attValue,'"')),R0}if(!v0.ignored&&v0.attValue&&!this.atEnd(v0))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(v0){const R0=this.extract(v0,this.consumeToken),T0=[];for(;!this.atEnd(v0)&&this.peekChar(v0)===c0;)this.consumeAttributeSpace(v0),T0.push(this.extract(v0,this.consumeToken));this.attributes.groups.push({semantic:R0,identificationTag:T0})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(v0){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(v0,y0)}parseIdentity(v0){const R0=this.extractOneOrMore(v0,b0),T0=[];for(;!this.atEnd(v0)&&this.peekChar(v0)===c0;){this.consumeAttributeSpace(v0);const F0=this.extract(v0,this.consumeToken);this.extract(v0,this.consume,"=");const V0=this.extractOneOrMore(v0,H0=>H0!==c0&&E0(H0));T0.push({name:F0,value:V0})}this.attributes.identities.push({assertionValue:R0,extensions:T0})}parseMsidSemantic(v0){this.peekChar(v0)===c0&&this.consumeAttributeSpace(v0);const R0={semantic:this.extract(v0,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(v0)}catch{break}if(this.peekChar(v0)==="*"){this.extract(v0,this.consume,"*"),R0.applyForAll=!0;break}{const T0=this.extract(v0,this.consumeTill,c0);R0.identifierList.push(T0)}}this.attributes.msidSemantic=R0}}class x0 extends C0{constructor(v0){super(),I0(this,"attributes",void 0),v0.protos.indexOf("RTP")!==-1||v0.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(v0){if(this.digested)throw new Error("already digested");try{switch(v0.attField){case"extmap":this.parseExtmap(v0);break;case"setup":this.parseSetup(v0);break;case"ice-ufrag":this.parseIceUfrag(v0);break;case"ice-pwd":this.parseIcePwd(v0);break;case"ice-options":this.parseIceOptions(v0);break;case"candidate":this.parseCandidate(v0);break;case"remote-candidate":this.parseRemoteCandidate(v0);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(v0);break;case"rtpmap":this.parseRtpmap(v0);break;case"ptime":this.parsePtime(v0);break;case"maxptime":this.parseMaxPtime(v0);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(v0);break;case"ssrc":this.parseSSRC(v0);break;case"fmtp":this.parseFmtp(v0);break;case"rtcp-fb":this.parseRtcpFb(v0);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(v0);break;case"mid":this.parseMid(v0);break;case"msid":this.parseMsid(v0);break;case"imageattr":this.parseImageAttr(v0);break;case"rid":this.parseRid(v0);break;case"simulcast":this.parseSimulcast(v0);break;case"sctp-port":this.parseSctpPort(v0);break;case"max-message-size":this.parseMaxMessageSize(v0);break;case"ssrc-group":this.parseSSRCGroup(v0);break;default:v0.ignored=!0,this.attributes.unrecognized.push(v0)}}catch(R0){throw console.error("parsing media attribute ".concat(v0.attField,' error, "a=').concat(v0.attField,":").concat(v0.attValue,'"')),R0}if(!v0.ignored&&v0.attValue&&!this.atEnd(v0))throw new Error("attribute parsing error")}parseCandidate(v0){const R0=this.extractOneOrMore(v0,_0,[1,32]);this.consumeAttributeSpace(v0);const T0=this.extractOneOrMore(v0,l0,[1,5]);this.consumeAttributeSpace(v0);const F0=this.extract(v0,this.consumeToken);this.consumeAttributeSpace(v0);const V0=this.extractOneOrMore(v0,l0,[1,10]);this.consumeAttributeSpace(v0);const H0=this.extract(v0,this.consumeAddress);this.consumeAttributeSpace(v0);const X0=this.extract(v0,this.consumePort);this.consumeAttributeSpace(v0),this.extract(v0,this.consume,"typ"),this.consumeAttributeSpace(v0);const Z0={foundation:R0,componentId:T0,transport:F0,priority:V0,connectionAddress:H0,port:X0,type:this.extract(v0,this.consumeToken),extension:{}};for(this.peek(v0," raddr")&&(this.extract(v0,this.consume," raddr"),this.consumeAttributeSpace(v0),Z0.relAddr=this.extract(v0,this.consumeAddress)),this.peek(v0," rport")&&(this.extract(v0,this.consume," rport"),this.consumeAttributeSpace(v0),Z0.relPort=this.extract(v0,this.consumePort));this.peekChar(v0)===c0;){this.consumeAttributeSpace(v0);const n1=this.extract(v0,this.consumeToken);this.consumeAttributeSpace(v0),Z0.extension[n1]=this.extractOneOrMore(v0,d0)}this.attributes.candidates.push(Z0)}parseRemoteCandidate(v0){const R0=[];for(;;){const T0=this.extractOneOrMore(v0,l0,[1,5]);this.consumeAttributeSpace(v0);const F0=this.extract(v0,this.consumeAddress);this.consumeAttributeSpace(v0);const V0=this.extract(v0,this.consumePort);R0.push({componentId:T0,connectionAddress:F0,port:V0});try{this.consumeAttributeSpace(v0)}catch{break}}this.attributes.remoteCandidatesList.push(R0)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(v0){const R0=this.extract(v0,this.consumeToken);this.consumeAttributeSpace(v0);const T0=this.extract(v0,this.consumeTill,"/");this.extract(v0,this.consume,"/");const F0={encodingName:T0,clockRate:this.extractOneOrMore(v0,l0)};this.atEnd(v0)||this.peekChar(v0)!=="/"||(this.extract(v0,this.consume,"/"),F0.encodingParameters=parseInt(this.extract(v0,this.consumeTill),10));const V0=this.attributes.payloads.find(H0=>H0.payloadType===parseInt(R0,10));V0?V0.rtpMap=F0:this.attributes.payloads.push({payloadType:parseInt(R0,10),rtpMap:F0,rtcpFeedbacks:[]})}parsePtime(v0){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(v0,this.consumeTill)}parseMaxPtime(v0){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(v0,this.consumeTill)}parseDirection(v0){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=v0.attField}parseSSRC(v0){const R0=this.extractOneOrMore(v0,l0);this.consumeAttributeSpace(v0);const T0=this.extract(v0,this.consumeTill,":");let F0;this.peekChar(v0)===":"&&(this.extract(v0,this.consume,":"),F0=this.extract(v0,this.consumeTill));const V0=this.attributes.ssrcs.find(H0=>H0.ssrcId===parseInt(R0,10));V0?V0.attributes[T0]=F0:this.attributes.ssrcs.push({ssrcId:parseInt(R0,10),attributes:{[T0]:F0}})}parseFmtp(v0){const R0=this.extract(v0,this.consumeTill,c0);this.consumeAttributeSpace(v0);const T0=this.extract(v0,this.consumeTill),F0={};T0.split(";").forEach(H0=>{let[X0,Z0]=H0.split("=");X0=jp(X0).call(X0);const n1=typeof Z0=="string"?jp(Z0).call(Z0):null;typeof X0=="string"&&X0.length>0&&(F0[X0]=n1)});const V0=this.attributes.payloads.find(H0=>H0.payloadType===parseInt(R0,10));V0?V0.fmtp={parameters:F0}:this.attributes.payloads.push({payloadType:parseInt(R0,10),rtcpFeedbacks:[],fmtp:{parameters:F0}})}parseFmtParameters(v0){const R0={},T0=this.extract(v0,this.consumeTill,"=");v0._cur++;const F0=this.extract(v0,this.consumeTill,";");for(R0[T0]=F0;v0.attValue[v0._cur]===";";){const V0=this.extract(v0,this.consumeTill,"=");v0._cur++;const H0=this.extract(v0,this.consumeTill,";");R0[V0]=H0}return R0}parseRtcpFb(v0){let R0="";R0=this.peekChar(v0)==="*"?this.extract(v0,this.consume,"*"):this.extract(v0,this.consumeTill,c0),this.consumeAttributeSpace(v0);const T0=this.extract(v0,this.consumeTill,c0);let F0;if(T0==="trr-int")F0={type:T0,interval:this.extract(v0,this.consumeTill)};else{const V0={type:T0};this.peekChar(v0)===c0&&(this.consumeAttributeSpace(v0),V0.parameter=this.extract(v0,this.consumeToken),this.peekChar(v0)===c0&&(V0.additional=this.extract(v0,this.consumeTill))),F0=V0}if(R0==="*")this.attributes.rtcpFeedbackWildcards.push(F0);else{const V0=this.attributes.payloads.find(H0=>H0.payloadType===parseInt(R0,10));V0?V0.rtcpFeedbacks.push(F0):this.attributes.payloads.push({payloadType:parseInt(R0,10),rtcpFeedbacks:[F0]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(v0){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const R0={port:this.extract(v0,this.consumePort)};this.peekChar(v0)===c0&&(this.consumeAttributeSpace(v0),R0.netType=this.extractOneOrMore(v0,p0),this.consumeAttributeSpace(v0),R0.addressType=this.extractOneOrMore(v0,p0),this.consumeAttributeSpace(v0),R0.address=this.extract(v0,this.consumeAddress)),this.attributes.rtcp=R0}parseMsid(v0){const R0={id:this.extractOneOrMore(v0,p0,[1,64])};this.peekChar(v0)===c0&&(this.consumeAttributeSpace(v0),R0.appdata=this.extractOneOrMore(v0,p0,[1,64])),this.attributes.msids.push(R0)}parseImageAttr(v0){this.attributes.imageattr.push(v0.attValue)}parseRid(v0){const R0=this.extractOneOrMore(v0,F0=>f0(F0)||l0(F0)||F0==="_"||F0==="-");this.consumeAttributeSpace(v0);const T0={id:R0,direction:this.extract(v0,this.consumeToken),params:[]};if(this.peekChar(v0)===c0){if(this.consumeAttributeSpace(v0),this.peek(v0,"pt=")){this.extract(v0,this.consume,"pt=");const F0=[];for(;;){const V0=this.extract(v0,this.consumeToken);F0.push(V0);try{this.extract(v0,this.consume,",")}catch{break}}T0.payloads=F0,this.peekChar(v0)===c0&&this.extract(v0,this.consume,c0)}for(;;){const F0=this.extract(v0,this.consumeToken);switch(F0){case"depend":{const V0={type:F0,rids:this.extract(v0,this.consume,"=").split(",")};T0.params.push(V0);break}default:{const V0={type:F0};this.peekChar(v0)==="="&&(this.extract(v0,this.consume,"="),V0.val=this.extract(v0,this.consumeTill,";")),T0.params.push(V0)}}try{this.extract(v0,this.consume,";")}catch{break}}}this.attributes.rids.push(T0)}parseSimulcast(v0){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=v0.attValue,this.extract(v0,this.consumeTill)}parseSctpPort(v0){this.attributes.sctpPort=this.extractOneOrMore(v0,l0,[1,5])}parseMaxMessageSize(v0){this.attributes.maxMessageSize=this.extractOneOrMore(v0,l0,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(v0){this.attributes.mid=this.extract(v0,this.consumeToken)}parseSSRCGroup(v0){const R0=this.extract(v0,this.consumeToken),T0=[];for(;;)try{this.consumeAttributeSpace(v0);const F0=this.extract(v0,this.consumeInteger);T0.push(parseInt(F0,10))}catch{break}this.attributes.ssrcGroups.push({semantic:R0,ssrcIds:T0})}}function j0(O0,v0,R0){return v0 in O0?Object.defineProperty(O0,v0,{value:R0,enumerable:!0,configurable:!0,writable:!0}):O0[v0]=R0,O0}class k0{constructor(){j0(this,"eol",a0)}print(v0,R0){let T0="";return R0&&(this.eol=R0),T0+=this.printVersion(v0.version),T0+=this.printOrigin(v0.origin),T0+=this.printSessionName(v0.sessionName),T0+=this.printInformation(v0.information),T0+=this.printUri(v0.uri),T0+=this.printEmail(v0.emails),T0+=this.printPhone(v0.phones),T0+=this.printConnection(v0.connection),T0+=this.printBandwidth(v0.bandwidths),T0+=this.printTimeFields(v0.timeFields),T0+=this.printKey(v0.key),T0+=this.printSessionAttributes(v0.attributes),T0+=this.printMediaDescription(v0.mediaDescriptions),T0}printVersion(v0){return"v=".concat(v0).concat(this.eol)}printOrigin(v0){return"o=".concat(v0.username," ").concat(v0.sessId," ").concat(v0.sessVersion," ").concat(v0.nettype," ").concat(v0.addrtype," ").concat(v0.unicastAddress).concat(this.eol)}printSessionName(v0){return v0?"s=".concat(v0).concat(this.eol):""}printInformation(v0){return v0?"i=".concat(v0).concat(this.eol):""}printUri(v0){return v0?"u=".concat(v0).concat(this.eol):""}printEmail(v0){let R0="";for(const T0 of v0)R0+="e=".concat(T0).concat(this.eol);return R0}printPhone(v0){let R0="";for(const T0 of v0)R0+="e=".concat(T0).concat(this.eol);return R0}printConnection(v0){return v0?"c=".concat(v0.nettype," ").concat(v0.addrtype," ").concat(v0.address).concat(this.eol):""}printBandwidth(v0){let R0="";for(const T0 of v0)R0+="b=".concat(T0.bwtype,":").concat(T0.bandwidth).concat(this.eol);return R0}printTimeFields(v0){let R0="";for(const T0 of v0){R0+="t=".concat(T0.time.startTime," ").concat(T0.time.startTime).concat(this.eol);for(const F0 of T0.repeats)R0+="r=".concat(F0.repeatInterval," ").concat(F0.typedTimes.join(" ")).concat(this.eol);T0.zoneAdjustments&&(R0+="z=",R0+="z=".concat(T0.zoneAdjustments.map(F0=>"".concat(F0.time," ").concat(F0.back?"-":""," ").concat(F0.typedTime)).join(" ")).concat(this.eol),R0+=this.eol)}return R0}printKey(v0){return v0?"k=".concat(v0).concat(this.eol):""}printAttributes(v0){let R0="";for(const T0 of v0)R0+="a=".concat(T0.attField).concat(T0.attValue?":".concat(T0.attValue):"").concat(this.eol);return R0}printMediaDescription(v0){let R0="";for(const T0 of v0)R0+=this.printMedia(T0.media),R0+=this.printInformation(T0.information),R0+=this.printConnections(T0.connections),R0+=this.printBandwidth(T0.bandwidths),R0+=this.printKey(T0.key),R0+=this.printMediaAttributes(T0);return R0}printConnections(v0){let R0="";for(const T0 of v0)R0+=this.printConnection(T0);return R0}printMedia(v0){return"m=".concat(v0.mediaType," ").concat(v0.port," ").concat(v0.protos.join("/")," ").concat(v0.fmts.join(" ")).concat(this.eol)}printSessionAttributes(v0){return new $0(this.eol).print(v0)}printMediaAttributes(v0){return new N0(this.eol).print(v0)}}class D0{constructor(v0){j0(this,"eol",void 0),this.eol=v0}printIceUfrag(v0){return v0===void 0?"":"a=ice-ufrag:".concat(v0).concat(this.eol)}printIcePwd(v0){return v0===void 0?"":"a=ice-pwd:".concat(v0).concat(this.eol)}printIceOptions(v0){return v0===void 0?"":"a=ice-options:".concat(v0.join(c0)).concat(this.eol)}printFingerprints(v0){return v0.length>0?v0.map(R0=>"a=fingerprint:".concat(R0.hashFunction).concat(c0).concat(R0.fingerprint)).join(this.eol)+this.eol:""}printExtmap(v0){return v0.map(R0=>"a=extmap:".concat(R0.entry).concat(R0.direction?"/".concat(R0.direction):"").concat(c0).concat(R0.extensionName).concat(R0.extensionAttributes?"".concat(c0).concat(R0.extensionAttributes):"").concat(this.eol)).join("")}printSetup(v0){return v0===void 0?"":"a=setup:".concat(v0).concat(this.eol)}printUnrecognized(v0){return v0.map(R0=>"a=".concat(R0.attField).concat(R0.attValue?":".concat(R0.attValue):"").concat(this.eol)).join("")}}class $0 extends D0{print(v0){let R0="";return R0+=this.printGroups(v0.groups),R0+=this.printMsidSemantic(v0.msidSemantic),R0+=this.printIceLite(v0.iceLite),R0+=this.printIceUfrag(v0.iceUfrag),R0+=this.printIcePwd(v0.icePwd),R0+=this.printIceOptions(v0.iceOptions),R0+=this.printFingerprints(v0.fingerprints),R0+=this.printSetup(v0.setup),R0+=this.printTlsId(v0.tlsId),R0+=this.printIdentity(v0.identities),R0+=this.printExtmap(v0.extmaps),R0+=this.printUnrecognized(v0.unrecognized),R0}printGroups(v0){let R0="";return v0.length>0&&(R0+=v0.map(T0=>"a=group:".concat(T0.semantic).concat(T0.identificationTag.map(F0=>"".concat(c0).concat(F0)).join("")).concat(this.eol)).join("")),R0}printIceLite(v0){return v0===void 0?"":"a=ice-lite"+this.eol}printTlsId(v0){return v0?"a=tls-id:".concat(v0).concat(this.eol):""}printIdentity(v0){return v0.length===0?"":v0.map(R0=>"a=identity:".concat(R0.assertionValue).concat(R0.extensions.map(T0=>"".concat(c0).concat(T0.name).concat(T0.value?"=".concat(T0.value):"")))).join(this.eol)+this.eol}printMsidSemantic(v0){if(!v0)return"";let R0="a=msid-semantic:".concat(v0.semantic);return v0.applyForAll?R0+="".concat(c0,"*"):v0.identifierList.length>0&&(R0+=v0.identifierList.map(T0=>"".concat(c0).concat(T0))),R0+this.eol}}class N0 extends D0{print(v0){const R0=v0.attributes;let T0="";return T0+=this.printRTCP(R0.rtcp),T0+=this.printIceUfrag(R0.iceUfrag),T0+=this.printIcePwd(R0.icePwd),T0+=this.printIceOptions(R0.iceOptions),T0+=this.printCandidates(R0.candidates),T0+=this.printRemoteCandidatesList(R0.remoteCandidatesList),T0+=this.printEndOfCandidates(R0.endOfCandidates),T0+=this.printFingerprints(R0.fingerprints),T0+=this.printSetup(R0.setup),T0+=this.printMid(R0.mid),T0+=this.printExtmap(R0.extmaps),T0+=this.printRTPRelated(R0),T0+=this.printPtime(R0.ptime),T0+=this.printMaxPtime(R0.maxPtime),T0+=this.printDirection(R0.direction),T0+=this.printSSRCGroups(R0.ssrcGroups),T0+=this.printSSRC(R0.ssrcs),T0+=this.printRTCPMux(R0.rtcpMux),T0+=this.printRTCPMuxOnly(R0.rtcpMuxOnly),T0+=this.printRTCPRsize(R0.rtcpRsize),T0+=this.printMSId(R0.msids),T0+=this.printImageattr(R0.imageattr),T0+=this.printRid(R0.rids),T0+=this.printSimulcast(R0.simulcast),T0+=this.printSCTPPort(R0.sctpPort),T0+=this.printMaxMessageSize(R0.maxMessageSize),T0+=this.printUnrecognized(R0.unrecognized),T0}printCandidates(v0){return v0.map(R0=>"a=candidate:".concat(R0.foundation).concat(c0).concat(R0.componentId).concat(c0).concat(R0.transport).concat(c0).concat(R0.priority).concat(c0).concat(R0.connectionAddress).concat(c0).concat(R0.port).concat(c0,"typ").concat(c0).concat(R0.type).concat(R0.relAddr?"".concat(c0,"raddr").concat(c0).concat(R0.relAddr):"").concat(R0.relPort?"".concat(c0,"rport").concat(c0).concat(R0.relPort):"").concat(Object.keys(R0.extension).map(T0=>"".concat(c0).concat(T0).concat(c0).concat(R0.extension[T0])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(v0){return v0.map(R0=>"a=remote-candidates:".concat(R0.join(c0)).concat(this.eol)).join("")}printEndOfCandidates(v0){return v0===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(v0){if(!v0.payloads)return"";const R0=v0.payloads;let T0="";T0+=v0.rtcpFeedbackWildcards.map(F0=>this.printRTCPFeedback("*",F0)).join("");for(const F0 of R0)T0+=this.printRtpMap(F0.payloadType,F0.rtpMap),T0+=this.printFmtp(F0.payloadType,F0.fmtp),T0+=F0.rtcpFeedbacks.map(V0=>this.printRTCPFeedback(F0.payloadType,V0)).join("");return T0}printFmtp(v0,R0){if(!R0)return"";const T0=Object.keys(R0.parameters);return T0.length===1&&R0.parameters[T0[0]]===null?"a=fmtp:".concat(v0).concat(c0).concat(T0[0]).concat(this.eol):"a=fmtp:".concat(v0).concat(c0).concat(Object.keys(R0.parameters).map(F0=>"".concat(F0,"=").concat(R0.parameters[F0])).join(";")).concat(this.eol)}printRtpMap(v0,R0){return R0?"a=rtpmap:".concat(v0).concat(c0).concat(R0.encodingName,"/").concat(R0.clockRate).concat(R0.encodingParameters?"/".concat(R0.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(v0,R0){let T0="a=rtcp-fb:".concat(v0).concat(c0),F0=R0;return F0.type==="trr-int"?T0+="ttr-int".concat(c0).concat(F0.interval):(T0+="".concat(F0.type),F0.parameter&&(T0+="".concat(c0).concat(F0.parameter),F0.additional&&(T0+="".concat(c0).concat(F0.additional)))),T0+this.eol}printPtime(v0){return v0===void 0?"":"a=ptime:".concat(v0).concat(this.eol)}printMaxPtime(v0){return v0===void 0?"":"a=maxptime:".concat(v0).concat(this.eol)}printDirection(v0){return v0===void 0?"":"a=".concat(v0).concat(this.eol)}printSSRC(v0){return v0.map(R0=>Object.keys(R0.attributes).map(T0=>"a=ssrc:".concat(R0.ssrcId.toString(10)).concat(c0).concat(T0).concat(R0.attributes[T0]?":".concat(R0.attributes[T0]):"").concat(this.eol)).join("")).join("")}printRTCPMux(v0){return v0===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(v0){return v0===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(v0){return v0===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(v0){if(v0===void 0)return"";let R0="a=rtcp:".concat(v0.port);return v0.netType&&(R0+="".concat(c0).concat(v0.netType)),v0.addressType&&(R0+="".concat(c0).concat(v0.addressType)),v0.address&&(R0+="".concat(c0).concat(v0.address)),R0+this.eol}printMSId(v0){return v0.map(R0=>"a=msid:".concat(R0.id).concat(R0.appdata?"".concat(c0).concat(R0.appdata):"").concat(this.eol)).join("")}printImageattr(v0){return v0.map(R0=>"a=imageattr:".concat(R0).concat(this.eol)).join("")}printRid(v0){return v0.map(R0=>{let T0="a=rid:".concat(R0.id).concat(c0).concat(R0.direction);return R0.payloads&&(T0+="".concat(c0,"pt=").concat(R0.payloads.join(","))),R0.params.length>0&&(T0+="".concat(c0).concat(R0.params.map(F0=>F0.type==="depend"?"depend=".concat(F0.rids.join(",")):"".concat(F0.type,"=").concat(F0.val)).join(";"))),T0+this.eol}).join("")}printSimulcast(v0){return v0===void 0?"":"a=simulcast:".concat(v0).concat(this.eol)}printSCTPPort(v0){return v0===void 0?"":"a=sctp-port:".concat(v0).concat(this.eol)}printMaxMessageSize(v0){return v0===void 0?"":"a=max-message-size:".concat(v0).concat(this.eol)}printMid(v0){return v0===void 0?"":"a=mid:".concat(v0).concat(this.eol)}printSSRCGroups(v0){return v0.map(R0=>"a=ssrc-group:".concat(R0.semantic).concat(R0.ssrcIds.map(T0=>"".concat(c0).concat(T0.toString(10))).join("")).concat(this.eol)).join("")}}function A0(O0){return new M0().parse(O0)}function P0(O0,v0){return new k0().print(O0,v0)}}},e0={};function n0(r0){if(e0[r0])return e0[r0].exports;var i0=e0[r0]={exports:{}};return t0[r0](i0,i0.exports,n0),i0.exports}return n0.d=(r0,i0)=>{for(var o0 in i0)n0.o(i0,o0)&&!n0.o(r0,o0)&&Object.defineProperty(r0,o0,{enumerable:!0,get:i0[o0]})},n0.o=(r0,i0)=>Object.prototype.hasOwnProperty.call(r0,i0),n0.r=r0=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r0,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r0,"__esModule",{value:!0})},n0(8)})();var FU=VU.exports;function BU(){let t0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:XA("SVC_MODE");if(XA("ENABLE_SVC"))return function(e0){return e0 in Iw}(t0)?t0:Iw.L1T3}function jU(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function GU(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?jU(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):jU(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}function WU(t0){let e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n0=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r0=arguments.length>3?arguments[3]:void 0;const{filterRTX:i0,filterVideoFec:o0,filterAudioFec:s0,filterAudioCodec:a0,filterVideoCodec:c0}=e0,{useXR:u0}=n0;let l0=[],d0=[],h0=[],p0=[],m0=!1,f0=!1;if(FU.parse(t0).mediaDescriptions.forEach(E0=>{r0&&r0!==E0.attributes.direction||(E0.media.mediaType!=="video"||m0||(d0=E0.attributes.payloads,p0=E0.attributes.extmaps,m0=!0),E0.media.mediaType!=="audio"||f0||(l0=E0.attributes.payloads,h0=E0.attributes.extmaps,f0=!0))}),!p0||d0.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!h0||l0.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(d0.forEach(E0=>{var _0;(_0=E0.rtpMap)!==null&&_0!==void 0&&_0.clockRate&&(E0.rtpMap.clockRate=parseInt(E0.rtpMap.clockRate)),u0&&E0.rtcpFeedbacks.push({type:"rrtr"})}),l0.forEach(E0=>{var _0;(_0=E0.rtpMap)!==null&&_0!==void 0&&_0.clockRate&&(E0.rtpMap.clockRate=parseInt(E0.rtpMap.clockRate)),u0&&E0.rtcpFeedbacks.push({type:"rrtr"})}),i0&&(l0=l0.filter(E0=>{var _0;return((_0=E0.rtpMap)===null||_0===void 0?void 0:_0.encodingName.toLowerCase())!=="rtx"}),d0=d0.filter(E0=>{var _0;return((_0=E0.rtpMap)===null||_0===void 0?void 0:_0.encodingName.toLowerCase())!=="rtx"})),o0&&(d0=d0.filter(E0=>{var _0;return!/(red)|(ulpfec)|(flexfec)/i.test(((_0=E0.rtpMap)===null||_0===void 0?void 0:_0.encodingName)||"")})),s0&&(l0=l0.filter(E0=>{var _0;return!/(red)|(ulpfec)|(flexfec)/i.test(((_0=E0.rtpMap)===null||_0===void 0?void 0:_0.encodingName)||"")})),a0&&(a0==null?void 0:a0.length)>0&&(l0=l0.filter(E0=>{var _0;return Dn(a0).call(a0,((_0=E0.rtpMap)===null||_0===void 0?void 0:_0.encodingName.toLowerCase())||"")})),c0&&(c0==null?void 0:c0.length)>0){const E0=d0.filter(_0=>{var y0;return Dn(c0).call(c0,((y0=_0.rtpMap)===null||y0===void 0?void 0:y0.encodingName.toLowerCase())||"")});d0=E0.concat(i0?[]:ax(E0,d0))}const g0=XA("UNSUPPORTED_VIDEO_CODEC");return g0&&g0.length>0&&(d0=d0.filter(E0=>!(E0.rtpMap&&Dn(g0).call(g0,E0.rtpMap.encodingName.toLowerCase())))),{audioCodecs:l0,videoCodecs:d0,audioExtensions:h0,videoExtensions:p0}}function HU(t0){const e0=FU.parse(t0);let n0,r0;for(const i0 of e0.mediaDescriptions){if(!n0){const o0=i0.attributes.iceUfrag,s0=i0.attributes.icePwd;if(!o0||!s0)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n0={iceUfrag:o0,icePwd:s0}}if(!r0){const o0=i0.attributes.fingerprints;o0.length>0&&(r0={fingerprints:o0})}}if(!r0&&e0.attributes.fingerprints.length>0&&(r0={fingerprints:e0.attributes.fingerprints}),!r0||!n0)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n0,dtlsParameters:r0}}function KU(t0,e0){const n0=[],r0=t0.attributes.ssrcGroups.filter(s0=>s0.semantic==="FID"),i0=t0.attributes.ssrcGroups.find(s0=>s0.semantic==="SIM"),o0=t0.attributes.ssrcs;if(i0)i0.ssrcIds.forEach(s0=>{var a0;const c0=(a0=r0.find(u0=>u0.ssrcIds[0]===s0))===null||a0===void 0?void 0:a0.ssrcIds[1];n0.push({ssrcId:s0,rtx:e0?c0:void 0})});else if(r0.length>0){const s0=r0[0].ssrcIds[0],a0=r0[0].ssrcIds[1];n0.push({ssrcId:s0,rtx:e0?a0:void 0})}else{if(o0.length===0)throw new Error("No ssrcs found on local media description.");n0.push({ssrcId:o0[0].ssrcId})}return n0}function YU(t0,e0,n0){const{cname:r0}=t0;let i0=[];e0&&(i0=qU(e0)),i0.length===0&&(i0=t0.iceParameters.candidates.map(l0=>({foundation:l0.foundation,componentId:"1",transport:l0.protocol,priority:l0.priority.toString(),connectionAddress:l0.ip,port:l0.port.toString(),type:l0.type,extension:{}})),fb.debug("Using candidates from gateway."));const o0={fingerprints:t0.dtlsParameters.fingerprints.map(l0=>({hashFunction:l0.algorithm,fingerprint:l0.fingerprint}))},s0={iceUfrag:t0.iceParameters.iceUfrag,icePwd:t0.iceParameters.icePwd};let a0;switch(t0.dtlsParameters.role){case"server":a0="passive";break;case"client":a0="active";break;case"auto":a0="actpass"}const c0=rx(t0.rtpCapabilities),u0=[];return Array.isArray(n0)&&n0.length>0&&n0.forEach(l0=>{u0.push({kind:dO.VIDEO,ssrcId:l0.v,rtx:l0.v_rtx,mslabel:"".concat(l0.v,"_").concat(l0.a)},{kind:dO.AUDIO,ssrcId:l0.a,mslabel:"".concat(l0.v,"_").concat(l0.a)})}),{dtlsParameters:o0,iceParameters:s0,candidates:i0,rtpCapabilities:c0,setup:a0,cname:r0,preSSRCs:u0}}function qU(t0){let e0=[];return t0.ip&&typeof t0.port=="number"&&(e0=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t0.ip,port:t0.port.toString(),type:"host",extension:{}}],fb.debug("Using remote candidate from AP ".concat(t0.ip,":").concat(t0.port)),t0.ip6&&(e0.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t0.ip6,port:t0.port.toString(),type:"host",extension:{}}),fb.debug("Using IPV6 remote candidate from AP ".concat(t0.ip6,":").concat(t0.port)))),e0}function zU(t0,e0,n0){const r0=[],i0=[];return t0.forEach(o0=>{let{ssrcId:s0,rtx:a0}=o0;const c0=TA(8,"track-"),u0={ssrcId:s0,attributes:GU({label:c0,mslabel:n0=n0||TA(10,""),msid:"".concat(n0," ").concat(c0)},e0&&{cname:e0})};if(r0.push(u0),a0!==void 0){const l0={ssrcId:a0,attributes:GU({label:c0,mslabel:n0,msid:"".concat(n0," ").concat(c0)},e0&&{cname:e0})};r0.push(l0),i0.push({semantic:"FID",ssrcIds:[s0,a0]})}}),t0.length>1&&i0.push({semantic:"SIM",ssrcIds:t0.map(o0=>{let{ssrcId:s0}=o0;return s0})}),{ssrcs:r0,ssrcGroups:i0}}function JU(t0,e0){e0 instanceof TM&&t0.attributes.payloads.forEach(n0=>{var r0;const i0=(r0=n0.rtpMap)===null||r0===void 0?void 0:r0.encodingName.toLowerCase();if(!i0||["opus","pcmu","pcma","g722"].indexOf(i0)===-1)return;n0.fmtp||(n0.fmtp={parameters:{}}),n0.fmtp.parameters.minptime="10",n0.fmtp.parameters.useinbandfec="1";const o0=e0._encoderConfig;o0&&i0!=="pcmu"&&i0!=="pcma"&&i0!=="g722"&&(o0.bitrate&&!Zv()&&(n0.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o0.bitrate))),o0.sampleRate&&(n0.fmtp.parameters.maxplaybackrate="".concat(o0.sampleRate),n0.fmtp.parameters["sprop-maxcapturerate"]="".concat(o0.sampleRate)),o0.stereo&&(n0.fmtp.parameters.stereo="1",n0.fmtp.parameters["sprop-stereo"]="1"))})}function XU(t0){const e0=t0.attributes.unrecognized.findIndex(n0=>n0.attField==="x-google-flag"&&n0.attValue==="conference");e0!==-1&&t0.attributes.unrecognized.splice(e0,1)}function QU(t0,e0){var n0;if(!(e0 instanceof aU&&e0._encoderConfig&&e0._hints.indexOf(mL.SCREEN_TRACK)===-1))return;const r0=e0._encoderConfig;ZP().supportMinBitrate&&r0.bitrateMin&&t0.attributes.payloads.forEach(i0=>{var o0,s0;Dn(o0=["h264","h265","vp8","vp9","av1"]).call(o0,((s0=i0.rtpMap)===null||s0===void 0?void 0:s0.encodingName.toLowerCase())||"")&&(i0.fmtp||(i0.fmtp={parameters:{}}),i0.fmtp.parameters["x-google-min-bitrate"]="".concat(r0.bitrateMin))}),ZP().supportMinBitrate&&!Dn(n0=e0._hints).call(n0,mL.LOW_STREAM)&&r0.bitrateMax&&t0.attributes.payloads.forEach(i0=>{var o0,s0;Dn(o0=["h264","h265","vp8","vp9","av1"]).call(o0,((s0=i0.rtpMap)===null||s0===void 0?void 0:s0.encodingName.toLowerCase())||"")&&(i0.fmtp||(i0.fmtp={parameters:{}}),i0.fmtp.parameters["x-google-start-bitrate"]="".concat(XA("X_GOOGLE_START_BITRATE")||Math.floor(r0.bitrateMax)))})}function ZU(t0){if(t0.media.mediaType!=="video")return;const e0=Hv();if(e0.name!==Bv.SAFARI&&e0.os!==Fv.IOS)return;const n0=t0.attributes.extmaps.findIndex(r0=>/video-orientation/g.test(r0.extensionName));n0!==-1&&t0.attributes.extmaps.splice(n0,1)}function $U(t0,e0,n0){if(!e0)return;let r0,i0;if(t0.media.mediaType==="video"?(r0=n0.videoExtensions,i0=n0.videoCodecs):(r0=n0.audioExtensions,i0=n0.audioCodecs),e0.twcc===!0){const o0=r0.find(s0=>s0.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o0&&(t0.attributes.extmaps.find(a0=>a0.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||t0.attributes.extmaps.push({entry:o0.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(a0,c0){return c0.filter(u0=>!!a0.find(l0=>l0.payloadType===u0.payloadType&&!!l0.rtcpFeedbacks.find(d0=>d0.type==="transport-cc")))}(i0,t0.attributes.payloads).forEach(a0=>{a0.rtcpFeedbacks.find(c0=>c0.type==="transport-cc")||a0.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(e0.twcc===!1){const o0=t0.attributes.extmaps.findIndex(s0=>s0.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o0!==-1&&t0.attributes.extmaps.splice(o0,1),t0.attributes.payloads.forEach(s0=>{const a0=s0.rtcpFeedbacks.findIndex(c0=>c0.type==="transport-cc");a0!==-1&&s0.rtcpFeedbacks.splice(a0,1)})}if(e0.remb===!0){const o0=r0.find(s0=>s0.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o0&&(t0.attributes.extmaps.find(a0=>a0.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||t0.attributes.extmaps.push({entry:o0.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(a0,c0){return c0.filter(u0=>!!a0.find(l0=>l0.payloadType===u0.payloadType&&!!l0.rtcpFeedbacks.find(d0=>d0.type==="goog-remb")))}(i0,t0.attributes.payloads).forEach(a0=>{a0.rtcpFeedbacks.find(c0=>c0.type==="goog-remb")||a0.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(e0.remb===!1){const o0=t0.attributes.extmaps.findIndex(s0=>s0.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o0!==-1&&t0.attributes.extmaps.splice(o0,1),t0.attributes.payloads.forEach(s0=>{const a0=s0.rtcpFeedbacks.findIndex(c0=>c0.type==="goog-remb");a0!==-1&&s0.rtcpFeedbacks.splice(a0,1)})}}function ex(t0,e0,n0){if(Zv()||t0.media.mediaType!=="video"||!(e0 instanceof aU)||n0!=="vp9"&&n0!=="vp8"||n0==="vp8"&&!XA("SIMULCAST")||n0==="vp9"&&XA("ENABLE_SVC")||e0._scalabilityMode===void 0||e0._scalabilityMode.numSpatialLayers<=1)return;const r0=n0==="vp8"?2:e0._scalabilityMode.numSpatialLayers,i0=t0.attributes.ssrcs[0],o0=t0.attributes.ssrcGroups.find(a0=>a0.semantic==="FID"&&a0.ssrcIds[0]===i0.ssrcId),s0={semantic:"SIM",ssrcIds:[i0.ssrcId]};for(let a0=1;a0<r0;a0++)t0.attributes.ssrcs.push({ssrcId:i0.ssrcId+a0,attributes:sA(i0.attributes)}),s0.ssrcIds.push(i0.ssrcId+a0),o0&&(t0.attributes.ssrcs.push({ssrcId:o0.ssrcIds[1]+a0,attributes:sA(i0.attributes)}),t0.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i0.ssrcId+a0,o0.ssrcIds[1]+a0]}));t0.attributes.ssrcGroups.unshift(s0)}async function tx(){let t0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n0=new RTCPeerConnection;n0.addTransceiver("video",{direction:"sendonly"}),n0.addTransceiver("audio",{direction:"sendonly"}),n0.addTransceiver("video",{direction:"recvonly"}),n0.addTransceiver("audio",{direction:"recvonly"});const r0=(await n0.createOffer()).sdp,{send:i0,recv:o0,sendrecv:s0}=function(){let a0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u0=arguments.length>2?arguments[2]:void 0;const l0=WU(u0,a0,c0,"sendonly"),d0=WU(u0,a0,c0,"recvonly"),h0={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p0={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m0={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nx(l0,d0,"videoExtensions",h0,p0,m0),nx(l0,d0,"videoCodecs",h0,p0,m0),nx(l0,d0,"audioExtensions",h0,p0,m0),nx(l0,d0,"audioCodecs",h0,p0,m0),XA("RAISE_H264_BASELINE_PRIORITY")){const f0=m0.videoCodecs.findIndex(g0=>{var E0,_0;return((E0=g0.rtpMap)===null||E0===void 0?void 0:E0.encodingName.toLocaleLowerCase())==="h264"&&((_0=g0.fmtp)===null||_0===void 0?void 0:_0.parameters["profile-level-id"])==="42001f"});if(f0!==-1){const g0=m0.videoCodecs.findIndex(E0=>{var _0;return((_0=E0.rtpMap)===null||_0===void 0?void 0:_0.encodingName.toLocaleLowerCase())==="h264"});if(g0<f0){fb.debug("raising H264 baseline profile priority");const E0=m0.videoCodecs[f0];m0.videoCodecs.splice(f0,1),m0.videoCodecs.splice(g0,0,E0)}g0!==-1&&(p0.videoCodecs=p0.videoCodecs.filter(E0=>{var _0,y0;return!(((_0=E0.rtpMap)===null||_0===void 0?void 0:_0.encodingName.toLocaleLowerCase())==="h264"&&((y0=E0.fmtp)===null||y0===void 0?void 0:y0.parameters["profile-level-id"])!=="42001f")})),g0!==-1&&XA("FILTER_SEND_H264_BASELINE")&&(h0.videoCodecs=h0.videoCodecs.filter(E0=>{var _0,y0;return!(((_0=E0.rtpMap)===null||_0===void 0?void 0:_0.encodingName.toLocaleLowerCase())==="h264"&&((y0=E0.fmtp)===null||y0===void 0?void 0:y0.parameters["profile-level-id"])!=="42001f")}))}}return{send:h0,recv:p0,sendrecv:m0}}(t0,e0,r0);try{n0.close()}catch{}return{send:i0,recv:o0,sendrecv:s0}}function ix(){const t0={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e0=WU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n0={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r0={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i0={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nx(t0,e0,"videoExtensions",n0,r0,i0),nx(t0,e0,"videoCodecs",n0,r0,i0),nx(t0,e0,"audioExtensions",n0,r0,i0),nx(t0,e0,"audioCodecs",n0,r0,i0),XA("RAISE_H264_BASELINE_PRIORITY")){const o0=i0.videoCodecs.findIndex(s0=>s0.rtpMap&&s0.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&s0.fmtp&&s0.fmtp.parameters["profile-level-id"]==="42001f");if(o0!==-1){const s0=i0.videoCodecs.findIndex(a0=>a0.rtpMap&&a0.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(s0<o0){fb.debug("raising H264 baseline profile priority");const a0=i0.videoCodecs[o0];i0.videoCodecs.splice(o0,1),i0.videoCodecs.splice(s0,0,a0)}s0!==-1&&(r0.videoCodecs=r0.videoCodecs.filter(a0=>!(a0.rtpMap&&a0.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a0.fmtp&&a0.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n0,recv:r0,sendrecv:i0}}function nx(t0,e0,n0,r0,i0,o0){if(n0==="videoExtensions"||n0==="audioExtensions"){const s0=[];return t0[n0].forEach(a0=>{e0[n0].some((c0,u0)=>{if(a0.entry===c0.entry&&a0.extensionName===c0.extensionName)return s0.push(u0),!0})?o0[n0].push(a0):r0[n0].push(a0)}),void e0[n0].forEach((a0,c0)=>{s0.indexOf(c0)===-1&&i0[n0].push(a0)})}if(n0==="videoCodecs"||n0==="audioCodecs"){const s0=[];return t0[n0].forEach(a0=>{e0[n0].some((c0,u0)=>{if(a0.payloadType===c0.payloadType&&JSON.stringify(a0)===JSON.stringify(c0))return s0.push(u0),!0})?o0[n0].push(a0):r0[n0].push(a0)}),void e0[n0].forEach((a0,c0)=>{s0.indexOf(c0)===-1&&i0[n0].push(a0)})}}function rx(t0){const{send:e0,recv:n0,sendrecv:r0}=t0;if(!r0){if(!e0||!n0)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e0,recv:n0}}let i0,o0;return e0?(i0={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i0.audioCodecs=[...e0.audioCodecs,...r0.audioCodecs],i0.videoCodecs=[...e0.videoCodecs,...r0.videoCodecs],i0.audioExtensions=[...e0.audioExtensions,...r0.audioExtensions],i0.videoExtensions=[...e0.videoExtensions,...r0.videoExtensions]):i0=r0,n0?(o0={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o0.audioCodecs=[...n0.audioCodecs,...r0.audioCodecs],o0.videoCodecs=[...n0.videoCodecs,...r0.videoCodecs],o0.audioExtensions=[...n0.audioExtensions,...r0.audioExtensions],o0.videoExtensions=[...n0.videoExtensions,...r0.videoExtensions]):o0=r0,{send:i0,recv:o0}}function ox(t0){t0.media.mediaType==="audio"&&t0.attributes.payloads.filter(e0=>{var n0;return((n0=e0.rtpMap)===null||n0===void 0?void 0:n0.encodingName.toLowerCase())==="opus"}).forEach(e0=>{e0.fmtp||(e0.fmtp={parameters:{}}),e0.fmtp.parameters.stereo="1",e0.fmtp.parameters["sprop-stereo"]="1"})}function sx(t0,e0,n0,r0){let i0=[];if(t0===dO.VIDEO){if(XA("H264_PROFILE_LEVEL_ID")&&r0==="h264"&&(i0=e0.videoCodecs.filter(o0=>{var s0;return Dn(s0=o0.rtpMap&&o0.rtpMap.encodingName.toLowerCase()||"").call(s0,r0)&&o0&&o0.fmtp&&o0.fmtp.parameters["profile-level-id"]===XA("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i0)||i0.length===0){let o0=[];const s0=[],a0=[],c0=[];if(n0.videoCodecs.forEach(u0=>{const l0=u0.rtpMap&&u0.rtpMap.encodingName.toLowerCase()||"";Dn(l0).call(l0,r0)?o0.push(u0):Dn(l0).call(l0,"vp9")?s0.push(u0):Dn(l0).call(l0,"vp8")?a0.push(u0):Dn(l0).call(l0,"h264")&&c0.push(u0)}),o0.length===0){let u0="";s0.length!==0?(o0=s0,u0="vp9"):a0.length!==0?(o0=a0,u0="vp8"):c0.length!==0&&(o0=c0,u0="h264"),fb.warning("codec ".concat(r0," not included in rtpCapabilities, fallback to default payloads: ").concat(u0))}o0.length!==0&&(i0=e0.videoCodecs.filter(u0=>o0.some(l0=>l0.payloadType===u0.payloadType)))}if(i0.length===0&&(fb.warning("codec ".concat(r0," not included in rtpCapabilities, fallback to default payloads: ").concat(e0.videoCodecs[0].rtpMap&&e0.videoCodecs[0].rtpMap.encodingName)),i0=e0.videoCodecs),XA("USE_PUB_RTX")||XA("USE_SUB_RTX")){const o0=ax(i0,e0.videoCodecs);i0=[...i0,...o0]}}else i0=e0.audioCodecs.filter(o0=>{var s0;return Dn(s0=o0.rtpMap&&o0.rtpMap.encodingName.toLowerCase()||"").call(s0,r0)}),i0.length===0&&(fb.warning("codec ".concat(r0," not included in rtpCapabilities, fallback to opus")),i0=e0.audioCodecs.filter(o0=>{var s0;return Dn(s0=o0.rtpMap&&o0.rtpMap.encodingName.toLowerCase()||"").call(s0,"opus")}));return i0}function ax(t0,e0){const n0=t0.map(r0=>r0.payloadType.toString());return e0.filter(r0=>r0.rtpMap&&r0.rtpMap.encodingName==="rtx"&&r0.fmtp&&r0.fmtp.parameters.apt&&Dn(n0).call(n0,r0.fmtp&&r0.fmtp.parameters.apt))}async function cx(t0,e0,n0){const r0=e0.toString(),i0=lx(r0,"offer","remote","exchangeSDP");await t0.setRemoteDescription({type:"offer",sdp:r0});const o0=await t0.createAnswer();if(!o0.sdp)throw new Error("cannot get answer sdp");let s0=o0.sdp;s0=dx(s0,n0||{}),i0==null||i0(s0||""),await t0.setLocalDescription({type:"answer",sdp:s0})}function dx(t0,e0,n0){const r0=FU.parse(t0),{useXR:i0}=e0;return r0.mediaDescriptions.forEach(o0=>{var s0;o0.attributes.mid&&(Array.isArray(n0)&&!Dn(n0).call(n0,o0.attributes.mid)||(o0.media.mediaType==="audio"&&ox(o0),i0&&Dn(s0=["audio","video"]).call(s0,o0.media.mediaType)&&o0.attributes.payloads.forEach(a0=>{a0.rtcpFeedbacks.findIndex(c0=>c0.type==="rrtr")===-1&&a0.rtcpFeedbacks.push({type:"rrtr"})})))}),FU.print(r0)}function lx(t0,e0,n0,r0){if(XA("SDP_LOGGING"))return fb.upload("exchanging ".concat(n0," ").concat(e0," SDP during P2PConnection.").concat(r0,`
`),t0),e0==="offer"?i0=>{lx(i0,"answer",n0==="local"?"remote":"local",r0)}:void 0}function ux(t0,e0){return typeof XA(t0)===e0?XA(t0):void 0}function hx(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function px(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?hx(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):hx(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}const _x=new Map;class Ex extends xy{get state(){return this._state}set state(e0){if(e0===this._state)return;const n0=this._state;this._state=e0,e0==="DISCONNECTED"&&this._disconnectedReason?this.emit($w.CONNECTION_STATE_CHANGE,e0,n0,this._disconnectedReason):this.emit($w.CONNECTION_STATE_CHANGE,e0,n0)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e0){fb.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e0)),this._joinGatewayStartTime=e0}constructor(e0,n0){super(),Fg(this,"store",void 0),Fg(this,"joinInfo",void 0),Fg(this,"key",void 0),Fg(this,"ntpOffset",0),Fg(this,"signal",void 0),Fg(this,"role",void 0),Fg(this,"inChannelInfo",{joinAt:null,duration:0}),Fg(this,"spec",void 0),Fg(this,"_state","DISCONNECTED"),Fg(this,"_statsCollector",void 0),Fg(this,"_disconnectedReason",void 0),Fg(this,"isSignalRecover",!1),Fg(this,"hasChangeBGPAddress",!1),Fg(this,"trafficStatsInterval",void 0),Fg(this,"networkQualityInterval",void 0),Fg(this,"_joinGatewayStartTime",0),Fg(this,"_signalTimeout",!1),Fg(this,"_clientRoleOptions",void 0),Fg(this,"_isProactiveJoin",!1),this.store=e0,this.spec=n0,this.signal=this.store.useP2P?new xU(px(px({},n0),{},{retryConfig:n0.websocketRetryConfig}),e0):new KO(px(px({},n0),{},{retryConfig:n0.websocketRetryConfig}),e0),this._statsCollector=n0.statsCollector,this.role=n0.role||"audience",this._clientRoleOptions=n0.clientRoleOptions,this.handleSignalEvents()}async join(e0,n0,r0){this.store.joinGatewayStart(),e0.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i0=Date.now();let o0=_x.get(e0.cname);if(o0||(o0=new Map,_x.set(e0.cname,o0)),this._isProactiveJoin=!0,o0.has(e0.uid)){const u0=new yb(Ry.UID_CONFLICT);throw vb.joinGateway(e0.sid,{lts:i0,succ:!1,ec:u0.code,addr:null,uid:e0.uid,cid:e0.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e0.proxyServer,signalChannel:"0",preload:e0.preload}),this._isProactiveJoin=!1,u0}o0.set(e0.uid,!0),this.joinInfo=e0,this.key=n0;let s0=0;this.joinGatewayStartTime=i0;const a0=e0.proxyServer;try{fb.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(s0));const u0=e0.gatewayAddrs.map(l0=>{let{address:d0}=l0;const[h0,p0]=d0.split(":"),m0={host:h0,port:p0};return e0.proxyServer&&(m0.proxy=e0.proxyServer),m0});s0=(await this.signal.init(u0,r0)).uid,fb.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(s0," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(u0){var c0;throw fb.error("[".concat(this.store.clientId,"] User join failed"),u0.toString()),vb.joinGateway(e0.sid,{lts:i0,succ:!1,ec:((c0=u0.data)===null||c0===void 0?void 0:c0.desc)||u0.code,errorMsg:u0.message,addr:this.signal.url,uid:e0.uid,cid:e0.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a0,signalChannel:"0",preload:e0.preload}),this._isProactiveJoin=!1,o0.delete(e0.uid),this.signal.close(),u0}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),fb.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(u0=>{fb.warning("[".concat(this.store.clientId,"] get traffic stats error"),u0.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit($w.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit($w.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit($w.NETWORK_QUALITY,{uplinkNetworkQuality:$O(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:$O(this._statsCollector.trafficStats.B_dnq)}):this.emit($w.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),s0}async leave(){let e0=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n0=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n0!==Hy.FALLBACK&&(this.state="DISCONNECTING");try{e0||this.signal.connectionState!==Nw.CONNECTED||await function(r0,i0){return i0===1/0?r0:Gh.race([r0,fA(i0)])}(this.signal.request(Pw.LEAVE,void 0,!0),3e3)}catch(r0){fb.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r0)}this.signal.close(n0),n0!==Hy.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e0,n0,r0){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i0={state:"offer",p2p_id:this.store.p2pId,ortc:n0,mode:this.spec.mode,extend:XA("PUB_EXTEND"),twcc:!!XA("PUBLISH_TWCC"),rtx:!!XA("USE_PUB_RTX")};try{return(await this.signal.request(Pw.PUBLISH,i0,!0))._message}catch(o0){if(r0&&o0.data&&o0.data.code===Ow.ERR_PUBLISH_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),o0.toString()),await this.tryUnpubBeforeRepub(e0,n0),this.publish(e0,n0,!1);throw o0}}async publishDataChannel(e0,n0,r0){var i0;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o0={stream_id:n0.streamId,ordered:n0.ordered?1:0,max_retrans_times:(i0=n0.maxRetransmits)!==null&&i0!==void 0?i0:10,channel_id:n0.channelId,metadata:n0.metadata};try{await this.signal.request(Pw.PUBLISH_DATASTREAM,o0,!0)}catch(s0){if(r0&&s0.data&&s0.data.code===Ow.ERR_PUBLISH_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),s0.toString()),await this.tryUnpubDataChannelBeforeRepub(e0,n0),this.publishDataChannel(e0,n0,!1);throw s0}}async unpublish(e0,n0){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Pw.UNPUBLISH,{stream_id:n0,ortc:e0},!0)}catch(r0){fb.warning("[".concat(this.store.clientId,"] unpublish warning: "),r0)}}async unpublishDataChannel(e0){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Gh.all(e0.map(n0=>this.signal.request(Pw.UNPUBLISH_DATASTREAM,{channel_id:n0},!0)))}catch(n0){fb.warning("unpublish datachannels warning: ",n0)}}async presubscribe(e0,n0,r0){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i0={stream_id:e0,stream_type:n0,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!XA("SUBSCRIBE_TWCC"),rtx:!!XA("USE_SUB_RTX")||void 0,extend:XA("SUB_EXTEND"),svc:Array.isArray(XA("SVC"))&&XA("SVC").length!==0?XA("SVC"):void 0};try{return await this.signal.request(Pw.PRE_SUBSCRIBE,i0,!0)}catch(o0){if(r0&&o0.data&&o0.data.code===Ow.ERR_SUBSCRIBE_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),o0.toString()),this.presubscribe(e0,n0,!1);throw o0}}async subscribe(e0,n0,r0){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i0={stream_id:e0,stream_type:n0.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!XA("SUBSCRIBE_TWCC"),rtx:!!XA("USE_SUB_RTX"),extend:XA("SUB_EXTEND"),ssrcId:n0.ssrcId,svc:Array.isArray(XA("SVC"))&&XA("SVC").length!==0?XA("SVC"):void 0};try{return(await this.signal.request(Pw.SUBSCRIBE,i0,!0))._message}catch(o0){if(r0&&o0.data&&o0.data.code===Ow.ERR_SUBSCRIBE_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),o0.toString()),await this.tryUnsubBeforeResub(e0,n0),await this.subscribe(e0,n0,!1);throw o0}}async subscribeDataChannel(e0,n0,r0){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i0={uid:e0,stream_id:n0.id,channel_id:n0.datachannelId};try{return void await this.signal.request(Pw.SUBSCRIBE_DATASTREAM,i0,!0)}catch(o0){if(r0&&o0.data&&o0.data.code===Ow.ERR_SUBSCRIBE_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),o0.toString()),await this.tryUnsubDataChannelBeforeResub(e0,n0),await this.subscribeDataChannel(e0,n0,!1);throw o0}}async subscribeAll(e0,n0){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r0={p2p_id:this.store.p2pId,users:e0,dtx:!1,rtx:!!XA("USE_SUB_RTX"),twcc:!!XA("SUBSCRIBE_TWCC"),svc:Array.isArray(XA("SVC"))&&XA("SVC").length!==0?XA("SVC"):void 0};try{return await this.signal.request(Pw.SUBSCRIBE_STREAMS,r0,!0)}catch(i0){if(n0&&i0.data&&i0.data.code===Ow.ERR_SUBSCRIBE_REQUEST_INVALID)return fb.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i0.toString()),await this.tryMassUnsubBeforeResub(e0),await this.subscribeAll(e0,!1);throw i0}}async setVideoProfile(e0){const n0=function(r0){if(!(r0.bitrateMax&&r0.bitrateMin&&r0.frameRate&&r0.height&&r0.width))return;let i0=r0.frameRate,o0=r0.width,s0=r0.height,a0=!0;return typeof i0!="number"&&(i0=i0.exact||i0.ideal||i0.max||i0.min||0,i0||(a0=!1)),typeof o0!="number"&&(o0=o0.exact||o0.ideal||o0.max||o0.min||0,o0||(a0=!1)),typeof s0!="number"&&(s0=s0.exact||s0.ideal||s0.max||s0.min||0,i0||(a0=!1)),a0?{stream_type:0,width:o0,height:s0,fps:i0,start_bps:1e3*r0.bitrateMax,min_bps:1e3*r0.bitrateMin,target_bps:1e3*r0.bitrateMax}:void 0}(e0);if(n0)return this.signal.request(Pw.SET_VIDEO_PROFILE,n0);fb.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e0,n0){try{await this.signal.request(Pw.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e0,stream_id:n0},!0)}catch(r0){fb.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r0)}}async unsubscribeDataChannel(e0,n0){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Gh.all(e0.map(r0=>this.signal.request(Pw.UNSUBSCRIBE_DATASTREAM,{stream_id:r0,uid:n0},!0)))}catch(r0){fb.warning("unsubscribeDataChannel warning: ",r0)}}async massUnsubscribe(e0){try{await this.signal.request(Pw.UNSUBSCRIBE_STREAMS,e0,!0)}catch(n0){fb.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n0)}}async reconnectPC(e0){const{iceParameters:n0,dtlsParameters:r0,rtpCapabilities:i0}=e0;return{gatewayEstablishParams:await this.signal.request(Pw.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n0,dtlsParameters:r0,rtpCapabilities:i0}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Pw.GATEWAY_INFO)}async renewToken(e0){await this.signal.request(Pw.RENEW_TOKEN,e0),this.key=e0.token}async setClientRole(e0,n0){if(n0&&(this._clientRoleOptions=Object.assign({},n0)),this.state!=="CONNECTED")return void(this.role=e0);let r0,i0=0;e0==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r0=this._clientRoleOptions.delay,i0=1):i0=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i0=0,await this.signal.request(Pw.SET_CLIENT_ROLE,{role:e0,level:i0,delay:r0,client_ts:Date.now()}),this.role=e0}async setRemoteVideoStreamType(e0,n0){await this.signal.request(Pw.SWITCH_VIDEO_STREAM,{stream_id:e0,stream_type:n0})}async setDefaultRemoteVideoStreamType(e0){await this.signal.request(Pw.DEFAULT_VIDEO_STREAM,{stream_type:e0})}async setStreamFallbackOption(e0,n0){await this.signal.request(Pw.SET_FALLBACK_OPTION,{stream_id:e0,fallback_type:n0})}async pickSVCLayer(e0,n0){await this.signal.request(Pw.PICK_SVC_LAYER,{stream_id:e0,spatial_layer:n0.spatialLayer,temporal_layer:n0.temporalLayer})}async setRTM2Flag(e0){await this.signal.request(Pw.SET_RTM2_FLAG,{rtm2_flag:e0})}async sendExtensionMessage(e0,n0,r0){if(this.signal instanceof xU)return this.signal.sendExtensionMessage(e0,n0,r0)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),px({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Pw.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e0=_x.get(this.joinInfo.cname);e0&&e0.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e0=function(n0){let r0;return r0=n0.startsWith("dc")?n0.match(/(dc\:\/\/)?([^:]+):(\d+)/):n0.match(/(wss\:\/\/)?([^:]+):(\d+)/),r0?{username:KA.username,password:KA.password,turnServerURL:r0[2],tcpport:parseInt(r0[3])+30,udpport:parseInt(r0[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e0&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(px(px({},KA),{},{turnServerURL:e0.turnServerURL,tcpport:e0.tcpport,udpport:e0.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e0=await this.signal.request(Pw.TRAFFIC_STATS,void 0,!0);e0.timestamp=Date.now(),e0.ntp_offset!=null&&(this.ntpOffset=e0.ntp_offset),e0.peer_delay.forEach(n0=>{const r0=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i0=>i0.peer_uid===n0.peer_uid);r0&&r0.B_st!==n0.B_st&&oA(()=>{this.emit($w.STREAM_TYPE_CHANGE,n0.peer_uid,n0.B_st)})}),this._statsCollector.updateTrafficStats(e0)}getJoinMessage(e0){if(!this.joinInfo||!this.key)throw new yb(Ry.UNEXPECTED_ERROR,"can not generate join message, no join info");const n0=Object.assign({},this.joinInfo.apResponse);let r0=XA("REPORT_APP_SCENARIO");if(typeof r0!="string")try{r0=JSON.stringify(r0)}catch{r0=void 0}r0&&r0.length>128&&(r0=void 0);const i0=!(Zv()||ty(87)||eL())&&typeof XA("ENABLE_PRE_SUB")=="boolean"&&XA("ENABLE_PRE_SUB"),o0=!eL()&&ux("ENABLE_PREALLOC_PC","boolean"),s0=px({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:GA,browser:navigator.userAgent,process_id:XA("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n0,extend:XA("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r0,attributes:{userAttributes:{enablePublishedUserList:XA("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:XA("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof XA("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?XA("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof XA("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?XA("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof XA("ENABLE_USER_LICENSE_CHECK")=="boolean"?XA("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:XA("USE_PUB_RTX")===!0||XA("USE_SUB_RTX")===!0||void 0,disableFEC:XA("DISABLE_FEC"),enableNTPReport:!!XA("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!XA("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!XA("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:ux("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!XA("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!XA("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:ux("USE_XR","boolean"),enableLossbasedBwe:ux("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!XA("ENABLE_AUT_CC")||void 0,enableCCFallback:ux("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o0,preSubNum:i0?ux("PRE_SUB_NUM","number"):void 0,enablePubTWCC:ux("PUBLISH_TWCC","boolean"),enableSubTWCC:ux("SUBSCRIBE_TWCC","boolean"),enablePubRTX:ux("USE_PUB_RTX","boolean"),enableSubRTX:ux("USE_SUB_RTX","boolean"),enableSubSVC:XA("ENABLE_SVC")?XA("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(XA("SVC"))&&XA("SVC").length!==0?XA("SVC"):void 0}},join_ts:this.joinGatewayStartTime},e0);return this.joinInfo.stringUid&&(s0.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s0.aes_mode=this.joinInfo.aesmode,XA("ENCRYPT_AES")?(s0.aes_secret=this.joinInfo.aespassword,s0.aes_encrypt=!0):s0.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s0.aes_salt=this.joinInfo.aessalt)),n0.addresses[this.signal.websocket.currentURLIndex]&&(s0.ap_response.ticket=n0.addresses[this.signal.websocket.currentURLIndex].ticket,delete n0.addresses),this.joinInfo.defaultVideoStream!==void 0&&(s0.default_video_stream=this.joinInfo.defaultVideoStream),s0}getRejoinMessage(){if(!this.joinInfo)throw new yb(Ry.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Dw.WS_RECONNECT_WAITTING_FINISH,e0=>{var n0;Dn(n0=["tryNext","recover"]).call(n0,e0)&&this.joinInfo&&vb.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(Dw.WS_RECONNECT_CREATE_CONNECTION,e0=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Dw.WS_RECONNECTING,e0=>{this.joinInfo&&vb.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e0||Jy.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",vb.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Dw.WS_CLOSED,e0=>{let n0;switch(e0){case Hy.LEAVE:n0=Jy.LEAVE;break;case Hy.UID_BANNED:case Hy.IP_BANNED:case Hy.CHANNEL_BANNED:case Hy.SERVER_ERROR:n0=Jy.SERVER_ERROR;break;case Hy.FALLBACK:n0=Jy.FALLBACK;break;case Hy.LICENSE_MISSING:case Hy.LICENSE_EXPIRED:case Hy.LICENSE_MINUTES_EXCEEDED:case Hy.LICENSE_PERIOD_INVALID:case Hy.LICENSE_MULTIPLE_SDK_SERVICE:case Hy.LICENSE_ILLEGAL:case Hy.TOKEN_EXPIRE:n0=e0;break;default:n0=Jy.NETWORK_ERROR}fb.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n0||"undefined -> "+Jy.NETWORK_ERROR)),this.joinInfo&&vb.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e0===Hy.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n0}),this._disconnectedReason=e0,e0!==Hy.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Dw.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(fb.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),vb.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const e0=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e0)return void fb.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e0));JA("EVENT_REPORT_DOMAIN",e0[1]),JA("EVENT_REPORT_BACKUP_DOMAIN",e0[1]),JA("LOG_UPLOAD_SERVER","".concat(e0[1],":6444"))}}),this.signal.on(kw.ON_UPLINK_STATS,e0=>{this._statsCollector.updateUplinkStats(e0)}),this.signal.on(Dw.REQUEST_RECOVER,(e0,n0,r0)=>{if(!this.joinInfo)return r0(new yb(Ry.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e0&&(this.joinInfo.multiIP=e0,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Zy(this,$w.REQUEST_NEW_GATEWAY_LIST).then(n0).catch(r0)}),this.signal.on(Dw.REQUEST_JOIN_INFO,async e0=>{var n0;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e0(this.getJoinMessage({ortc:{}}));const{iceParameters:r0,dtlsParameters:i0,rtpCapabilities:o0}=await Zy(this,$w.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n0=this.joinInfo)===null||n0===void 0?void 0:n0.turnServer});e0(this.getJoinMessage({ortc:{iceParameters:r0,dtlsParameters:i0,rtpCapabilities:o0,version:"2"}}))}),this.signal.on(Dw.REQUEST_REJOIN_INFO,e0=>{e0(this.getRejoinMessage())}),this.signal.on(Dw.REPORT_JOIN_GATEWAY,(e0,n0)=>{if(!this.joinInfo)return;let r0,i0="";var o0;e0 instanceof yb?(r0=((o0=e0.data)===null||o0===void 0?void 0:o0.desc)||e0.code,i0=e0.message):r0=e0,vb.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r0,errorMsg:i0,addr:n0,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(Dw.IS_P2P_DISCONNECTED,e0=>{e0(tA(this,$w.IS_P2P_DISCONNECTED))}),this.signal.on(Dw.DISCONNECT_P2P,()=>{this.emit($w.DISCONNECT_P2P)}),this.signal.on(Dw.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Dw.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Dw.JOIN_RESPONSE,e0=>{const n0=this.getCurrentGatewayAddress();this.emit($w.JOIN_RESPONSE,e0,n0)}),this.signal.on(Dw.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e0=this.getCurrentGatewayAddress(),n0=XA("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e0&&n0){const r0=qU(e0);this.emit($w.PRE_CONNECT_PC,{candidates:r0,fingerprint:n0})}}}),this.signal.on(Dw.RECOVER_NOTIFICATION,e0=>{this.joinInfo&&typeof XA("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(XA("AP_REQUEST_DETAIL"),";").concat(e0))})}async tryUnsubBeforeResub(e0,n0){try{await this.signal.request(Pw.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e0,ortc:[n0]},!0)}catch(r0){throw fb.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r0),r0}}async tryUnsubDataChannelBeforeResub(e0,n0){try{await this.signal.request(Pw.UNSUBSCRIBE,{stream_id:n0.id},!0)}catch(r0){throw fb.warning("unsubscribe datachannel warning",r0),r0}}async tryUnpubBeforeRepub(e0,n0){try{await this.signal.request(Pw.UNPUBLISH,{stream_id:e0,ortc:n0},!0)}catch(r0){throw fb.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r0),r0}}async tryUnpubDataChannelBeforeRepub(e0,n0){try{await this.signal.request(Pw.UNPUBLISH_DATASTREAM,{channnel_id:n0.channelId},!0)}catch(r0){throw fb.warning("unpublish datastream warning: ",r0),r0}}async tryMassUnsubBeforeResub(e0){const n0={users:e0.map(r0=>({stream_id:r0.stream_id,stream_type:r0.stream_type}))};try{await this.signal.request(Pw.UNSUBSCRIBE_STREAMS,n0,!0)}catch(r0){throw fb.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r0),r0}}async muteLocal(e0,n0){const r0={action:e0.find(i0=>i0.stream_type===Zw.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e0,stream_id:n0};try{await this.signal.request(Pw.CONTROL,r0,!0,!0)}catch(i0){throw fb.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i0),i0}}async unmuteLocal(e0,n0){const r0={action:e0.find(i0=>i0.stream_type===Zw.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e0,stream_id:n0};try{await this.signal.request(Pw.CONTROL,r0,!0,!0)}catch(i0){throw fb.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i0),i0}}async muteRemote(e0,n0){const r0={action:e0===dO.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n0};try{await this.signal.request(Pw.CONTROL,r0,!0,!0)}catch(i0){throw fb.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i0),i0}}async unmuteRemote(e0,n0){const r0={action:e0===dO.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n0};try{await this.signal.request(Pw.CONTROL,r0,!0,!0)}catch(i0){throw fb.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i0),i0}}uploadWRTCStats(e0){this.signal.uploadWRTCStats(e0)}upload(e0,n0){this.signal.upload(e0,n0)}getSignalRTT(){return this.signal.rtt}async restartICE(e0){const n0={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e0};try{return await this.signal.request(Pw.RESTART_ICE,n0,!0)}catch(r0){throw fb.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r0),r0}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Jy.P2P_FAILED)}getCurrentGatewayAddress(){var e0,n0;if(!XA("GATEWAY_WSS_ADDRESS"))return XA("USE_CANDIDATE_FROM_AP_DETAIL")&&(e0=this.joinInfo)!==null&&e0!==void 0&&e0.apGatewayAddress?(fb.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n0=this.joinInfo)!==null&&n0!==void 0&&n0.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e0){await this.signal.request(Pw.SET_PARAMETER,{enablePublishAudioFilter:e0})}}let fx=0,mx=0;function Tx(t0,e0,n0,r0){return new Gh((i0,o0)=>{e0.timeout=e0.timeout||XA("HTTP_CONNECT_TIMEOUT"),e0.responseType=e0.responseType||"json",e0.data&&!n0?(e0.data=JSON.stringify(e0.data),fx+=_A(e0.data)):n0&&(e0.data.size?fx+=e0.data.size:e0.data instanceof FormData?fx+=EA(e0.data):fx+=_A(JSON.stringify(e0.data))),e0.headers=e0.headers||{},e0.headers["Content-Type"]=e0.headers["Content-Type"]||"application/json",e0.method="POST",e0.url=t0,Lv.request(e0).then(s0=>{typeof s0.data=="string"?mx+=_A(s0.data):s0.data instanceof ArrayBuffer||s0.data instanceof Uint8Array?mx+=s0.data.byteLength:mx+=_A(JSON.stringify(s0.data)),r0&&i0({data:s0.data,headers:s0.headers}),i0(s0.data)}).catch(s0=>{Lv.isCancel(s0)?o0(new yb(Ry.OPERATION_ABORTED,"cancel token canceled")):s0.code==="ECONNABORTED"?o0(new yb(Ry.NETWORK_TIMEOUT,s0.message)):s0.response?o0(new yb(Ry.NETWORK_RESPONSE_ERROR,s0.response.status)):o0(new yb(Ry.NETWORK_ERROR,s0.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t0;function e0(N0){var A0=0;return function(){return A0<N0.length?{done:!1,value:N0[A0++]}:{done:!0}}}var n0=typeof Object.defineProperties=="function"?Object.defineProperty:function(N0,A0,P0){return N0==Array.prototype||N0==Object.prototype||(N0[A0]=P0.value),N0},r0,i0=function(N0){N0=[typeof globalThis=="object"&&globalThis,N0,typeof window=="object"&&window,typeof self=="object"&&self,typeof t=="object"&&t];for(var A0=0;A0<N0.length;++A0){var P0=N0[A0];if(P0&&P0.Math==Math)return P0}throw Error("Cannot find global object")}(this);function o0(N0,A0){if(A0)t:{var P0=i0;N0=N0.split(".");for(var O0=0;O0<N0.length-1;O0++){var v0=N0[O0];if(!(v0 in P0))break t;P0=P0[v0]}(A0=A0(O0=P0[N0=N0[N0.length-1]]))!=O0&&A0!=null&&n0(P0,N0,{configurable:!0,writable:!0,value:A0})}}function s0(N0){return(N0={next:N0})[Symbol.iterator]=function(){return this},N0}function a0(N0){var A0=typeof Symbol<"u"&&Symbol.iterator&&N0[Symbol.iterator];return A0?A0.call(N0):{next:e0(N0)}}if(o0("Symbol",function(N0){function A0(v0,R0){this.A=v0,n0(this,"description",{configurable:!0,writable:!0,value:R0})}if(N0)return N0;A0.prototype.toString=function(){return this.A};var P0="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",O0=0;return function v0(R0){if(this instanceof v0)throw new TypeError("Symbol is not a constructor");return new A0(P0+(R0||"")+"_"+O0++,R0)}}),o0("Symbol.iterator",function(N0){if(N0)return N0;N0=Symbol("Symbol.iterator");for(var A0="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),P0=0;P0<A0.length;P0++){var O0=i0[A0[P0]];typeof O0=="function"&&typeof O0.prototype[N0]!="function"&&n0(O0.prototype,N0,{configurable:!0,writable:!0,value:function(){return s0(e0(this))}})}return N0}),typeof Object.setPrototypeOf=="function")r0=Object.setPrototypeOf;else{var c0;t:{var u0={};try{u0.__proto__={a:!0},c0=u0.a;break t}catch{}c0=!1}r0=c0?function(N0,A0){if(N0.__proto__=A0,N0.__proto__!==A0)throw new TypeError(N0+" is not extensible");return N0}:null}var l0=r0;function d0(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h0(N0){if(N0.m)throw new TypeError("Generator is already running");N0.m=!0}function p0(N0,A0){return N0.h=3,{value:A0}}function m0(N0){this.g=new d0,this.G=N0}function f0(N0,A0,P0,O0){try{var v0=A0.call(N0.g.j,P0);if(!(v0 instanceof Object))throw new TypeError("Iterator result "+v0+" is not an object");if(!v0.done)return N0.g.m=!1,v0;var R0=v0.value}catch(T0){return N0.g.j=null,N0.g.s(T0),g0(N0)}return N0.g.j=null,O0.call(N0.g,R0),g0(N0)}function g0(N0){for(;N0.g.h;)try{var A0=N0.G(N0.g);if(A0)return N0.g.m=!1,{value:A0.value,done:!1}}catch(P0){N0.g.v=void 0,N0.g.s(P0)}if(N0.g.m=!1,N0.g.l){if(A0=N0.g.l,N0.g.l=null,A0.F)throw A0.D;return{value:A0.return,done:!0}}return{value:void 0,done:!0}}function E0(N0){this.next=function(A0){return N0.o(A0)},this.throw=function(A0){return N0.s(A0)},this.return=function(A0){return function(P0,O0){h0(P0.g);var v0=P0.g.j;return v0?f0(P0,"return"in v0?v0.return:function(R0){return{value:R0,done:!0}},O0,P0.g.return):(P0.g.return(O0),g0(P0))}(N0,A0)},this[Symbol.iterator]=function(){return this}}function _0(N0,A0){return A0=new E0(new m0(A0)),l0&&N0.prototype&&l0(A0,N0.prototype),A0}if(d0.prototype.o=function(N0){this.v=N0},d0.prototype.s=function(N0){this.l={D:N0,F:!0},this.h=this.C||this.u},d0.prototype.return=function(N0){this.l={return:N0},this.h=this.u},m0.prototype.o=function(N0){return h0(this.g),this.g.j?f0(this,this.g.j.next,N0,this.g.o):(this.g.o(N0),g0(this))},m0.prototype.s=function(N0){return h0(this.g),this.g.j?f0(this,this.g.j.throw,N0,this.g.o):(this.g.s(N0),g0(this))},o0("Array.prototype.entries",function(N0){return N0||function(){return function(A0,P0){A0 instanceof String&&(A0+="");var O0=0,v0=!1,R0={next:function(){if(!v0&&O0<A0.length){var T0=O0++;return{value:P0(T0,A0[T0]),done:!1}}return v0=!0,{done:!0,value:void 0}}};return R0[Symbol.iterator]=function(){return R0},R0}(this,function(A0,P0){return[A0,P0]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var y0=function(N0,A0){for(var P0=0;P0<N0.length;P0++)A0(N0[P0])},b0=function(N0){return N0.replace(/\r?\n|\r/g,`\r
`)},S0=function(N0,A0,P0){return A0 instanceof Blob?(P0=P0!==void 0?P0+"":typeof A0.name=="string"?A0.name:"blob",A0.name===P0&&Object.prototype.toString.call(A0)!=="[object Blob]"||(A0=new File([A0],P0)),[String(N0),A0]):[String(N0),String(A0)]},w0=function(N0,A0){if(N0.length<A0)throw new TypeError(A0+" argument required, but only "+N0.length+" present.")},I0=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,L0=I0.FormData,M0=I0.XMLHttpRequest&&I0.XMLHttpRequest.prototype.send,C0=I0.Request&&I0.fetch,U0=I0.navigator&&I0.navigator.sendBeacon,x0=I0.Element&&I0.Element.prototype,j0=I0.Symbol&&Symbol.toStringTag;j0&&(Blob.prototype[j0]||(Blob.prototype[j0]="Blob"),"File"in I0&&!File.prototype[j0]&&(File.prototype[j0]="File"));try{new File([],"")}catch{I0.File=function(A0,P0,O0){return A0=new Blob(A0,O0||{}),Object.defineProperties(A0,{name:{value:P0},lastModified:{value:+(O0&&O0.lastModified!==void 0?new Date(O0.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),j0&&Object.defineProperty(A0,j0,{value:"File"}),A0}}var k0=function(N0){return N0.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},D0=function(N0){this.i=[];var A0=this;N0&&y0(N0.elements,function(P0){if(P0.name&&!P0.disabled&&P0.type!=="submit"&&P0.type!=="button"&&!P0.matches("form fieldset[disabled] *"))if(P0.type==="file"){var O0=P0.files&&P0.files.length?P0.files:[new File([],"",{type:"application/octet-stream"})];y0(O0,function(v0){A0.append(P0.name,v0)})}else P0.type==="select-multiple"||P0.type==="select-one"?y0(P0.options,function(v0){!v0.disabled&&v0.selected&&A0.append(P0.name,v0.value)}):P0.type==="checkbox"||P0.type==="radio"?P0.checked&&A0.append(P0.name,P0.value):(O0=P0.type==="textarea"?b0(P0.value):P0.value,A0.append(P0.name,O0))})};if((t0=D0.prototype).append=function(N0,A0,P0){w0(arguments,2),this.i.push(S0(N0,A0,P0))},t0.delete=function(N0){w0(arguments,1);var A0=[];N0=String(N0),y0(this.i,function(P0){P0[0]!==N0&&A0.push(P0)}),this.i=A0},t0.entries=function N0(){var A0,P0=this;return _0(N0,function(O0){if(O0.h==1&&(A0=0),O0.h!=3)return A0<P0.i.length?O0=p0(O0,P0.i[A0]):(O0.h=0,O0=void 0),O0;A0++,O0.h=2})},t0.forEach=function(N0,A0){w0(arguments,1);for(var P0=a0(this),O0=P0.next();!O0.done;O0=P0.next()){var v0=a0(O0.value);O0=v0.next().value,v0=v0.next().value,N0.call(A0,v0,O0,this)}},t0.get=function(N0){w0(arguments,1);var A0=this.i;N0=String(N0);for(var P0=0;P0<A0.length;P0++)if(A0[P0][0]===N0)return A0[P0][1];return null},t0.getAll=function(N0){w0(arguments,1);var A0=[];return N0=String(N0),y0(this.i,function(P0){P0[0]===N0&&A0.push(P0[1])}),A0},t0.has=function(N0){w0(arguments,1),N0=String(N0);for(var A0=0;A0<this.i.length;A0++)if(this.i[A0][0]===N0)return!0;return!1},t0.keys=function N0(){var A0,P0,O0,v0,R0=this;return _0(N0,function(T0){if(T0.h==1&&(A0=a0(R0),P0=A0.next()),T0.h!=3)return P0.done?void(T0.h=0):(O0=P0.value,v0=a0(O0),p0(T0,v0.next().value));P0=A0.next(),T0.h=2})},t0.set=function(N0,A0,P0){w0(arguments,2),N0=String(N0);var O0=[],v0=S0(N0,A0,P0),R0=!0;y0(this.i,function(T0){T0[0]===N0?R0&&(R0=!O0.push(v0)):O0.push(T0)}),R0&&O0.push(v0),this.i=O0},t0.values=function N0(){var A0,P0,O0,v0,R0=this;return _0(N0,function(T0){if(T0.h==1&&(A0=a0(R0),P0=A0.next()),T0.h!=3)return P0.done?void(T0.h=0):(O0=P0.value,(v0=a0(O0)).next(),p0(T0,v0.next().value));P0=A0.next(),T0.h=2})},D0.prototype._asNative=function(){for(var N0=new L0,A0=a0(this),P0=A0.next();!P0.done;P0=A0.next()){var O0=a0(P0.value);P0=O0.next().value,O0=O0.next().value,N0.append(P0,O0)}return N0},D0.prototype._blob=function(){var N0="----formdata-polyfill-"+Math.random(),A0=[],P0="--"+N0+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(O0,v0){return typeof O0=="string"?A0.push(P0+k0(b0(v0))+`"\r
\r
`+b0(O0)+`\r
`):A0.push(P0+k0(b0(v0))+'"; filename="'+k0(O0.name)+`"\r
Content-Type: `+(O0.type||"application/octet-stream")+`\r
\r
`,O0,`\r
`)}),A0.push("--"+N0+"--"),new Blob(A0,{type:"multipart/form-data; boundary="+N0})},D0.prototype[Symbol.iterator]=function(){return this.entries()},D0.prototype.toString=function(){return"[object FormData]"},x0&&!x0.matches&&(x0.matches=x0.matchesSelector||x0.mozMatchesSelector||x0.msMatchesSelector||x0.oMatchesSelector||x0.webkitMatchesSelector||function(N0){for(var A0=(N0=(this.document||this.ownerDocument).querySelectorAll(N0)).length;0<=--A0&&N0.item(A0)!==this;);return-1<A0}),j0&&(D0.prototype[j0]="FormData"),M0){var $0=I0.XMLHttpRequest.prototype.setRequestHeader;I0.XMLHttpRequest.prototype.setRequestHeader=function(N0,A0){$0.call(this,N0,A0),N0.toLowerCase()==="content-type"&&(this.B=!0)},I0.XMLHttpRequest.prototype.send=function(N0){N0 instanceof D0?(N0=N0._blob(),this.B||this.setRequestHeader("Content-Type",N0.type),M0.call(this,N0)):M0.call(this,N0)}}C0&&(I0.fetch=function(N0,A0){return A0&&A0.body&&A0.body instanceof D0&&(A0.body=A0.body._blob()),C0.call(this,N0,A0)}),U0&&(I0.navigator.sendBeacon=function(N0,A0){return A0 instanceof D0&&(A0=A0._asNative()),U0.call(this,N0,A0)}),I0.FormData=D0}})();const Sx=()=>{const t0=XA("AREAS");return t0.length===0&&t0.push(iO.GLOBAL),Jn(t0).call(t0,(e0,n0,r0)=>{const i0=gx(n0);return i0?r0===0?i0:"".concat(e0,",").concat(i0):e0},"")},gx=t0=>t0===iO.OVERSEA?"".concat(rO.ASIA,",").concat(rO.EUROPE,",").concat(rO.AFRICA,",").concat(rO.NORTH_AMERICA,",").concat(rO.SOUTH_AMERICA,",").concat(rO.OCEANIA):rO[t0],Rx=t0=>{const e0={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t0.map(n0=>{const r0=oO[n0],i0=Object.keys(r0);i0&&i0.map(o0=>{o0!=="CODE"&&(e0[o0]=e0[o0].concat(r0[o0]))})}),e0},Cx={GLOBAL:{ASIA:[iO.CHINA,iO.JAPAN,iO.INDIA,iO.KOREA,iO.HKMC],EUROPE:[],NORTH_AMERICA:[iO.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Ix=Object.keys(Cx[iO.GLOBAL]),vx=[iO.CHINA,iO.NORTH_AMERICA,iO.EUROPE,iO.ASIA,iO.JAPAN,iO.INDIA,iO.OCEANIA,iO.SOUTH_AMERICA,iO.AFRICA,iO.KOREA,iO.HKMC,iO.US],yx=function(t0,e0){let n0=[];if(Dn(t0).call(t0,iO.GLOBAL)){const o0=[iO.GLOBAL,iO.OVERSEA],s0=Object.keys(oO);if(e0===iO.GLOBAL)throw new yb(Ry.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e0===iO.CHINA)n0=[iO.OVERSEA];else if(i0=e0,Dn(Ix).call(Ix,i0)){const a0=(r0=e0,Cx[iO.GLOBAL][r0]||[]),c0=[...o0,e0,...a0];n0=s0.filter(u0=>!Dn(c0).call(c0,u0))}else if(function(a0){let c0=!1;return Ix.forEach(u0=>{var l0;Dn(l0=Cx[iO.GLOBAL][u0]).call(l0,a0)&&(c0=!0)}),c0}(e0)){const a0=function(u0){let l0;return Ix.forEach(d0=>{var h0;Dn(h0=Cx[iO.GLOBAL][d0]).call(h0,u0)&&(l0=d0)}),l0}(e0),c0=[...o0,a0,e0];n0=s0.filter(u0=>!Dn(c0).call(c0,u0))}else n0=t0;n0=function(a0){const c0=[];return vx.forEach(u0=>{Dn(a0).call(a0,u0)&&c0.push(u0)}),c0.concat(a0.filter(u0=>!Dn(vx).call(vx,u0)))}(n0)}else n0=t0;var r0,i0;return n0};function Ax(t0){var e0,n0;if(!t0&&Dn(e0=XA("AREAS")).call(e0,iO.EXTENSIONS))return fb.debug("update area from ap : reset"),void bx(Ab,!0);if(!Dn(n0=XA("AREAS")).call(n0,iO.GLOBAL)||!t0)return;let r0=oO.EXTENSIONS;r0&&(r0={CODE:gx(iO.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t0,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t0,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t0,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t0,".agora.io"),"cds-ap-web-2-".concat(t0,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t0,".agora.io"),"sua-ap-web-2-".concat(t0,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t0,".agora.io"),"uap-ap-web-2-".concat(t0,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t0,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t0,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t0,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t0,".agora.io")]},fb.debug("update area from ap success: ".concat(t0,",config is "),r0),JA("AREAS",[iO.EXTENSIONS],!0),Object.keys(r0).map(i0=>{i0==="LOG_UPLOAD_SERVER"||i0==="EVENT_REPORT_DOMAIN"||i0==="EVENT_REPORT_BACKUP_DOMAIN"||i0==="PROXY_SERVER_TYPE3"?JA(i0,r0[i0][0]):JA(i0,r0[i0])}))}function bx(t0){let e0=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n0=vb.reportApiInvoke(null,{name:By.SET_AREA,options:t0,tag:jy.TRACER});try{let r0=[];if(typeof t0=="string"&&(r0=[t0]),Array.isArray(t0)&&(t0.forEach(o0=>{if(!Dn(nO).call(nO,o0))throw new yb(Ry.INVALID_PARAMS,"invalid area code")}),r0=t0),Object.prototype.toString.call(t0)==="[object Object]"){const{areaCode:o0,excludedArea:s0}=t0;if(!o0)throw new yb(Ry.INVALID_PARAMS,"area code is needed");let a0=o0;typeof o0=="string"&&(a0=[o0]),r0=s0?yx(a0,s0):a0}if(!e0){if(QA.AREAS){const o0=new yb(Ry.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n0.onError(o0),void fb.warning("setArea is prohibited because of config-distribute")}if(Dn(r0).call(r0,iO.GLOBAL)&&XA("AREAS")===iO.EXTENSIONS){const o0=new yb(Ry.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n0.onError(o0),void fb.warning("setArea is prohibited because of ap extensions")}}JA("AREAS",r0,e0);const i0=Rx(r0);Object.keys(i0).map(o0=>{o0==="LOG_UPLOAD_SERVER"||o0==="EVENT_REPORT_DOMAIN"||o0==="EVENT_REPORT_BACKUP_DOMAIN"||o0==="PROXY_SERVER_TYPE3"?JA(o0,i0[o0][0]):JA(o0,i0[o0])}),fb.debug("set area success:",r0.join(","))}catch(r0){throw n0.onError(r0),r0}n0.onSuccess()}function wx(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function Ox(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?wx(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):wx(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}let Nx=1;function Dx(t0,e0,n0,r0,i0){Nx+=1;const o0={sid:n0.sid,command:"convergeAllocateEdge",uid:"666",appId:n0.appId,ts:Math.floor(Date.now()/1e3),seq:Nx,requestId:Nx,version:GA,cname:n0.cname},s0={service_name:e0,json_body:JSON.stringify(o0)};let a0,c0,u0=t0[0];return kA(async()=>{a0=Date.now();const l0=await Tx(u0,{data:s0,cancelToken:r0,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c0=Date.now()-a0,l0.code!==0){const p0=new yb(Ry.UNEXPECTED_RESPONSE,"live streaming ap error, code"+l0.code,{retry:!0,responseTime:c0});throw fb.error(p0.toString()),p0}const d0=JSON.parse(l0.json_body);if(d0.code!==200){const p0=new yb(Ry.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(d0.code,", reason: ").concat(d0.reason),{code:d0.code,responseTime:c0});throw fb.error(p0.toString()),p0}if(!d0.servers||d0.servers.length===0){const p0=new yb(Ry.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:d0.code,responseTime:c0});throw fb.error(p0.toString()),p0}const h0=function(p0,m0){return{addressList:p0.servers.map(f0=>"wss://".concat(f0.address.replace(/\./g,"-"),".").concat(XA("WORKER_DOMAIN"),":").concat(f0.wss,"?serviceName=").concat(encodeURIComponent(m0))),workerToken:p0.workerToken,vid:p0.vid}}(d0,e0);return XA("LIVE_STREAMING_ADDRESS")&&(h0.addressList=XA("LIVE_STREAMING_ADDRESS")instanceof Array?XA("LIVE_STREAMING_ADDRESS"):[XA("LIVE_STREAMING_ADDRESS")]),Ox(Ox({},h0),{},{responseTime:c0})},(l0,d0)=>(vb.apworkerEvent(n0.sid,{success:!0,sc:200,serviceName:e0,responseDetail:JSON.stringify(l0.addressList),firstSuccess:d0===0,responseTime:c0,serverIp:t0[d0%t0.length]}),!1),(l0,d0)=>(vb.apworkerEvent(n0.sid,{success:!1,sc:l0.data&&l0.data.code||200,serviceName:e0,responseTime:c0,serverIp:t0[d0%t0.length]}),!!(l0.code!==Ry.OPERATION_ABORTED&&l0.code!==Ry.UNEXPECTED_RESPONSE||l0.data&&l0.data.retry)&&(u0=t0[(d0+1)%t0.length],!0)),i0)}let Px=1;function Lx(t0,e0,n0,r0){let{url:i0,areaCode:o0}=t0;const{clientId:s0,sid:a0}=e0,c0=Date.now();let u0;const[l0,d0]=Vx(e0,o0,[YO.CHOOSE_SERVER]);let h0=iA.networkState;return kA(async()=>{h0&&iA.networkState===Xy.OFFLINE&&iA.onlineWaiter&&await Gh.race([iA.onlineWaiter,mA(r0&&r0.maxRetryTimeout||PA.maxRetryTimeout)]),h0=iA.networkState;const{data:p0,headers:m0}=await Tx(i0,{data:l0,cancelToken:n0,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u0=m0.http3==="1"?1:-1,vb.reportResourceTiming(i0,a0),Mx(p0,i0,e0,c0,[YO.CHOOSE_SERVER],u0);const f0=eN(p0,YO.CHOOSE_SERVER);return Ux(f0),XO(f0,i0)},p0=>(p0&&vb.joinChooseServer(a0,{lts:c0,succ:!0,csAddr:i0,opid:d0,serverList:p0.gatewayAddrs.map(m0=>m0.address),ec:null,cid:p0.cid.toString(),uid:p0.uid.toString(),csIp:p0.csIp,unilbsServerIds:[YO.CHOOSE_SERVER].toString(),isHttp3:u0,corssRegionTagReq:e0.apRequestDetail,corssRegionTagRes:p0.res.detail&&p0.res.detail[38]}),!1),p0=>p0.code!==Ry.OPERATION_ABORTED&&(p0.code===Ry.CAN_NOT_GET_GATEWAY_SERVER?p0.data.retry:(vb.joinChooseServer(a0,{lts:c0,succ:!1,csAddr:i0,serverList:null,opid:d0,ec:p0.code,csIp:p0.data&&p0.data.csIp,unilbsServerIds:[YO.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h0}),isHttp3:u0,corssRegionTagReq:e0.apRequestDetail}),fb.warning("[".concat(s0||"sid-".concat(a0.slice(0,6)),"] Choose server network error, retry"),p0),!0)),r0)}function kx(t0,e0,n0,r0){let i0,{url:o0,areaCode:s0,serviceIds:a0}=t0;const c0=Date.now(),[u0,l0]=Vx(e0,s0,a0);let d0;return kA(async()=>{d0&&iA.networkState===Xy.OFFLINE&&iA.onlineWaiter&&await Gh.race([iA.onlineWaiter,mA(r0&&r0.maxRetryTimeout||PA.maxRetryTimeout)]),d0=iA.networkState;const{data:h0,headers:p0}=await Tx(o0,{data:u0,cancelToken:n0,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i0=p0.http3==="1"?1:-1,vb.reportResourceTiming(o0,e0.sid),Mx(h0,o0,e0,c0,a0,i0);const m0=eN(h0,YO.CHOOSE_SERVER),f0=eN(h0,e0.cloudProxyServer==="proxy5"?YO.CLOUD_PROXY_5:e0.cloudProxyServer==="proxy3"||e0.cloudProxyServer==="proxy4"?YO.CLOUD_PROXY:YO.CLOUD_PROXY_FALLBACK);return Ux(m0),{gatewayInfo:XO(m0,o0),proxyInfo:f0,url:o0}},h0=>(h0.gatewayInfo&&vb.joinChooseServer(e0.sid,{lts:c0,succ:!0,csAddr:o0,serverList:h0.gatewayInfo.gatewayAddrs.map(p0=>p0.address),ec:null,opid:l0,cid:h0.gatewayInfo.cid.toString(),uid:h0.gatewayInfo.uid.toString(),csIp:h0.gatewayInfo.csIp,unilbsServerIds:a0.toString(),isHttp3:i0,corssRegionTagReq:e0.apRequestDetail,corssRegionTagRes:h0.gatewayInfo.res.detail&&h0.gatewayInfo.res.detail[38]}),h0.proxyInfo&&vb.joinWebProxyAP(e0.sid,{lts:c0,sucess:1,apServerAddr:o0,turnServerAddrList:h0.proxyInfo.addresses.map(p0=>p0.ip).join(","),errorCode:null,eventType:e0.cloudProxyServer,unilbsServerIds:a0.toString()}),!1),h0=>h0.code!==Ry.OPERATION_ABORTED&&(h0.code===Ry.CAN_NOT_GET_GATEWAY_SERVER?h0.data.retry:(vb.joinWebProxyAP(e0.sid,{lts:c0,sucess:0,apServerAddr:o0,turnServerAddrList:null,errorCode:h0.code,eventType:e0.cloudProxyServer,unilbsServerIds:a0.toString(),extend:JSON.stringify({networkState:d0})}),fb.warning("[".concat(e0.clientId,"] multi unilbs network error, retry"),h0),!0)),r0)}const Mx=(t0,e0,n0,r0,i0,o0)=>{const{sid:s0,clientId:a0,cloudProxyServer:c0}=n0,u0=[],l0=d0=>{d0.flag===4096?vb.joinChooseServer(s0,{lts:r0,succ:!1,csAddr:e0,opid:t0.opid,serverList:null,ec:d0.error.message,csIp:d0.error.data&&d0.error.data.csIp,unilbsServerIds:i0.toString(),isHttp3:o0,corssRegionTagReq:n0.apRequestDetail}):d0.flag!==1048576&&d0.flag!==4194304&&d0.flag!==4194310||vb.joinWebProxyAP(s0,{lts:r0,sucess:0,apServerAddr:e0,turnServerAddrList:null,errorCode:d0.error.code,eventType:c0,unilbsServerIds:i0.toString()})};if(t0.response_body.forEach(d0=>{const h0=d0.buffer.code;if(d0.uri===23&&h0===0&&!d0.buffer.edges_services)if(d0.buffer.flag===4194310)fb.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),d0.buffer.edges_services=[];else{const p0={error:new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t0.detail[502]}),flag:d0.buffer.flag};u0.push(p0),l0(p0)}if(h0!==0){const p0=wO(h0),m0={error:new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,p0.desc,{desc:p0.desc,retry:p0.retry,csIp:t0.detail[502]}),flag:d0.buffer.flag};d0.buffer.flag===4194310?fb.warning(m0.error.toString()):u0.push(m0),l0(m0)}}),u0.length)throw fb.warning("[".concat(a0||"sid-".concat(s0.slice(0,6)),"] multi unilbs ").concat(e0," failed, ").concat(u0.map(d0=>"flag: ".concat(d0.flag,", message: ").concat(d0.error.message,", retry: ").concat(d0.error.data.retry)).join(" | "))),new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,u0.map(d0=>"flag: ".concat(d0.flag,", message: ").concat(d0.error.message)).join(" | "),{retry:!!u0.find(d0=>d0.error.data.retry),csIp:t0.detail[502],desc:[...new Set(u0.map(d0=>{var h0;return d0==null||(h0=d0.error)===null||h0===void 0||(h0=h0.data)===null||h0===void 0?void 0:h0.desc}).filter(d0=>!!d0))]})},Ux=t0=>{var e0,n0,r0,i0;if(t0.addresses&&t0.addresses.length===0&&t0.code===0)throw new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t0.detail&&t0.detail[502]});if(XA("AP_AREA")&&((r0=t0.detail)!==null&&r0!==void 0&&r0[23]&&typeof((i0=t0.detail)===null||i0===void 0?void 0:i0[23])=="string"?Ax(t0.detail[23].toLowerCase()):Ax()),(e0=t0.detail)!==null&&e0!==void 0&&e0[19]&&typeof((n0=t0.detail)===null||n0===void 0?void 0:n0[19])=="string"){const s0=t0.detail[19],a0=s0==null?void 0:s0.split(";");for(let c0=0;c0<a0.length;c0++){var o0;const u0=jp(o0=a0[c0]).call(o0);t0.addresses[c0]&&a0&&(t0.addresses[c0].fingerprint=u0)}}if(XA("GATEWAY_ADDRESS")&&XA("GATEWAY_ADDRESS").length>0){fb.debug("assign gateway address to",XA("GATEWAY_ADDRESS"));const s0=XA("GATEWAY_ADDRESS").map(a0=>{var c0,u0;const l0=(c0=(u0=t0.addresses.find(d0=>d0.ip===a0.ip&&d0.port===a0.port))===null||u0===void 0?void 0:u0.fingerprint)!==null&&c0!==void 0?c0:"";return{ip:a0.ip,port:a0.port,ticket:t0.addresses[0]&&t0.addresses[0].ticket,fingerprint:l0}});t0.addresses=s0}},xx=(t0,e0)=>{if(t0.response_body&&t0.response_body.length){const n0=t0.response_body[0];if(n0.buffer.code!==0){const r0=wO(n0.buffer.code);throw new yb(Ry.UPDATE_TICKET_FAILED,"[".concat(n0.buffer.code,"]: ").concat(r0.desc),{retry:r0.retry})}return n0.buffer.ticket}throw fb.debug("update ticket request received ap response without response body:",e0),new yb(Ry.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Vx=(t0,e0,n0)=>{const r0=Math.floor(Math.random()*1e12),i0={appid:t0.appId,client_ts:Date.now(),opid:r0,sid:t0.sid,request_bodies:[{uri:22,buffer:{cname:t0.cname,detail:Ox(Ox({6:t0.stringUid,11:e0,12:XA("USE_NEW_TOKEN")?"1":void 0,22:e0},t0.apRequestDetail?{33:t0.apRequestDetail}:{}),t0.apRTM?{26:"RTM2"}:{}),key:t0.token,service_ids:n0,uid:t0.uid||0}}]};i0.request_bodies.forEach(s0=>{t0.multiIP&&t0.multiIP.gateway_ip&&(s0.buffer.detail[5]=JSON.stringify({vocs_ip:[t0.multiIP.uni_lbs_ip],vos_ip:[t0.multiIP.gateway_ip]}))});const o0=new FormData;return o0.append("request",JSON.stringify(i0)),[o0,r0]},Fx=(t0,e0)=>{const n0=Math.floor(Math.random()*1e12),r0={appid:t0.appId,client_ts:Date.now(),opid:n0,sid:t0.sid,request_bodies:[{uri:28,buffer:{cname:t0.cname,detail:{1:"",6:t0.stringUid,12:"1"},token:t0.token,service_ids:e0,uid:t0.uid||0,edges_services:t0.apResponse.addresses.map(o0=>({ip:o0.ip,port:o0.port}))}}]},i0=new FormData;return i0.append("request",JSON.stringify(r0)),[i0,n0]};let Bx=0;function jx(t0){return Gh.all(t0.map(e0=>e0.then(n0=>{throw n0},n0=>n0))).then(e0=>{throw e0},e0=>e0)}const Gx=async t0=>{let{fragementLength:e0,referenceList:n0,asyncMapHandler:r0,allFailedhandler:i0,promisesCollector:o0}=t0,s0=0;const a0=e0;let c0,u0=0;const l0=async()=>{const d0=(()=>{const h0=s0*a0,p0=h0+a0;return n0.slice(h0,p0).map(r0)})();o0&&o0.push(...d0);try{c0=await jx(d0)}catch(h0){if(u0+=a0,s0++,!(u0>=n0.length))return void await l0();i0(h0)}d0.forEach(h0=>h0.cancel())};return await l0(),c0},Wx=async t0=>{let{referenceList:e0,asyncMapHandler:n0,closeFn:r0}=t0;const i0=e0.length;let o0=0;const s0=async()=>{const a0=n0(e0.shift());try{return await a0}catch(c0){if(o0++,o0>=i0||r0!=null&&r0(c0))throw c0;return s0()}};return s0()};async function Hx(t0,e0,n0,r0){return{gatewayInfo:await async function(o0,s0,a0,c0){let u0=null;const l0=[],d0=async()=>{const p0=XA("WEBCS_DOMAIN").slice(0,XA("AJAX_REQUEST_CONCURRENT")).map(g0=>({url:o0.proxyServer?"https://".concat(o0.proxyServer,"/ap/?url=").concat(g0+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g0,"/api/v2/transpond/webrtc?v=2"),areaCode:Sx()})),m0=c0.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p0.map(g0=>g0.url)}),f0=await Gx({fragementLength:XA("FRAGEMENT_LENGTH"),referenceList:p0,asyncMapHandler:g0=>(fb.debug("[".concat(o0.clientId,"] Connect to choose_server:"),g0.url),Lx(g0,o0,s0,a0)),allFailedhandler:g0=>{throw c0.recordJoinChannelService({endTs:Date.now(),status:"error",errors:g0},m0),g0[0]},promisesCollector:l0});return c0.recordJoinChannelService({endTs:Date.now(),status:"success"},m0),f0},h0=async()=>{if(await mA(1e3),u0!==null)return u0;const p0=XA("WEBCS_DOMAIN_BACKUP_LIST").map(g0=>({url:o0.proxyServer?"https://".concat(o0.proxyServer,"/ap/?url=").concat(g0+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g0,"/api/v2/transpond/webrtc?v=2"),areaCode:Sx()})),m0=c0.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:p0.map(g0=>g0.url)}),f0=await Gx({fragementLength:XA("FRAGEMENT_LENGTH"),referenceList:p0,asyncMapHandler:g0=>(fb.debug("[".concat(o0.clientId,"] Connect to backup choose_server:"),g0.url),Lx(g0,o0,s0,a0)),allFailedhandler:g0=>{throw c0.recordJoinChannelService({endTs:Date.now(),status:"error",errors:g0},m0),g0[0]},promisesCollector:l0});return c0.recordJoinChannelService({endTs:Date.now(),status:"success"},m0),f0};try{return u0=await jx([d0(),h0()]),l0.length&&l0.forEach(p0=>p0.cancel&&typeof p0.cancel=="function"&&p0.cancel()),u0}catch(p0){throw p0[0]}}(t0,e0,n0,r0)}}async function Kx(t0,e0,n0,r0,i0){const o0=t0.cloudProxyServer;if(o0==="disabled"){if(!r0)return;if(t0.useLocalAccessPoint)return await Hx(t0,e0,n0,i0);if(XA("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:h0,proxyInfo:p0}=await Xx(t0,e0,n0,i0);if(t0.turnServer&&t0.turnServer.mode!=="auto")return{gatewayInfo:h0};const m0=p0.map(f0=>({turnServerURL:f0.address,tcpport:f0.tcpport||KA.tcpport,udpport:f0.udpport||KA.udpport,username:f0.username||KA.username,password:f0.password||KA.password,forceturn:!1,security:!0}));if(i0.useP2P){var s0;const f0=(s0=t0.uid)!==null&&s0!==void 0?s0:h0.uid,g0="glb:".concat(f0.toString()),E0=await Uy(g0),_0=p0.map(y0=>({turnServerURL:y0.address,tcpport:y0.tcpport||KA.tcpport,udpport:y0.udpport||KA.udpport,username:g0,password:E0,forceturn:!1,security:!0}));m0.push(..._0)}return t0.turnServer={mode:"manual",servers:m0},{gatewayInfo:h0}}return await Hx(t0,e0,n0,i0)}const{proxyInfo:a0,gatewayInfo:c0}=await Xx(t0,e0,n0,i0),u0={gatewayInfo:c0},l0=a0.map(h0=>({turnServerURL:h0.address,tcpport:o0==="proxy3"?void 0:h0.tcpport?h0.tcpport:KA.tcpport,udpport:o0==="proxy4"?void 0:h0.udpport?h0.udpport:KA.udpport,username:h0.username||KA.username,password:h0.password||KA.password,forceturn:o0!=="proxy4",security:o0==="proxy5"}));if(i0.useP2P){var d0;const h0=(d0=t0.uid)!==null&&d0!==void 0?d0:c0.uid,p0="glb:".concat(h0.toString()),m0=await Uy(p0),f0=a0.map(g0=>({turnServerURL:g0.address,tcpport:o0==="proxy3"?void 0:g0.tcpport||KA.tcpport,udpport:o0==="proxy4"?void 0:g0.udpport||KA.udpport,username:p0,password:m0,forceturn:o0!=="proxy4",security:o0==="proxy5"}));l0.push(...f0)}return t0.turnServer={mode:"manual",servers:l0},fb.debug("[".concat(t0.clientId,"] set proxy server: ").concat(t0.proxyServer,", mode: ").concat(o0)),u0}async function Yx(t0,e0,n0,r0,i0){const o0=XA("ACCOUNT_REGISTER").slice(0,XA("AJAX_REQUEST_CONCURRENT"));let s0=[];s0=e0.proxyServer?o0.map(c0=>"https://".concat(e0.proxyServer,"/ap/?url=").concat(c0+"/api/v1")):o0.map(c0=>"https://".concat(c0,"/api/v1"));const a0=i0==null?void 0:i0.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s0});try{const c0=await async function(u0,l0,d0,h0,p0){const m0=Date.now(),f0={sid:d0.sid,opid:10,appid:d0.appId,string_uid:l0};let g0=u0[0];const E0=await kA(()=>Tx(g0+"".concat(g0.indexOf("?")===-1?"?":"&","action=stringuid"),{data:f0,cancelToken:h0,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(_0,y0)=>{if(_0.code===0){if(_0.uid<=0||_0.uid>=Math.pow(2,32))throw fb.error("Invalid Uint Uid ".concat(l0," => ").concat(_0.uid),_0),vb.reqUserAccount(f0.sid,{lts:m0,success:!1,serverAddr:g0,stringUid:f0.string_uid,uid:_0.uid,errorCode:Ry.INVALID_UINT_UID_FROM_STRING_UID,extend:f0}),new yb(Ry.INVALID_UINT_UID_FROM_STRING_UID);return vb.reqUserAccount(f0.sid,{lts:m0,success:!0,serverAddr:g0,stringUid:f0.string_uid,uid:_0.uid,errorCode:null,extend:f0}),!1}const b0=wO(_0.code);return b0.retry&&(g0=u0[(y0+1)%u0.length]),vb.reqUserAccount(f0.sid,{lts:m0,success:!1,serverAddr:g0,stringUid:f0.string_uid,uid:_0.uid,errorCode:b0.desc,extend:f0}),b0.retry},(_0,y0)=>_0.code!==Ry.OPERATION_ABORTED&&(vb.reqUserAccount(f0.sid,{lts:m0,success:!1,serverAddr:g0,stringUid:f0.string_uid,uid:null,errorCode:_0.code,extend:f0}),g0=u0[(y0+1)%u0.length],!0),p0);if(E0.code!==0){const _0=wO(E0.code);throw new yb(Ry.UNEXPECTED_RESPONSE,_0.desc)}return E0}(s0,t0,e0,n0,r0);return i0==null||i0.recordJoinChannelService({status:"success",endTs:Date.now()},a0),c0.uid}catch(c0){throw i0==null||i0.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[c0]},a0),c0}}async function qx(t0,e0,n0){const r0=XA("ACCOUNT_REGISTER");let i0=[];i0=e0.proxyServer?r0.map(o0=>"https://".concat(e0.proxyServer,"/ap/?url=").concat(o0+"/api/v1")):r0.map(o0=>"https://".concat(o0,"/api/v1"));try{return await Wx({referenceList:i0,asyncMapHandler:s0=>async function(a0,c0,u0,l0){const d0=Date.now(),h0={sid:u0.sid,opid:10,appid:u0.appId,string_uid:c0};try{const p0=await Tx(a0+"".concat(a0.indexOf("?")===-1?"?":"&","action=stringuid"),{data:h0,cancelToken:l0,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(p0.code!==0){const m0=wO(p0.code);throw new yb(Ry.UNEXPECTED_RESPONSE,"preload sua error:".concat(m0.desc),m0)}if(p0.uid<=0||p0.uid>=Math.pow(2,32))throw new yb(Ry.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:d0,url:a0,req:h0,uid:p0.uid,elapse:Date.now()-d0}}catch(p0){throw p0}}(s0,t0,e0,n0),closeFn:s0=>s0.code===Ry.OPERATION_ABORTED||s0.code===Ry.UNEXPECTED_RESPONSE&&!s0.data.retry})}catch(o0){throw o0}}async function zx(t0,e0,n0){const r0=XA("CDS_AP").slice(0,XA("AJAX_REQUEST_CONCURRENT")).map(c0=>t0.proxyServer?"https://".concat(t0.proxyServer,"/ap/?url=").concat(c0+"/api/v1"):"https://".concat(c0,"/api/v1?action=config")),i0=r0.map(c0=>function(u0,l0,d0,h0){const p0=Hv(),m0={flag:64,cipher_method:0,features:{device:p0.name,system:p0.os,system_general:navigator.userAgent,vendor:l0.appId,version:GA,cname:l0.cname,sid:l0.sid,session_id:l0.sid,detail:"",proxyServer:l0.proxyServer}};return kA(()=>Tx(u0,{data:m0,timeout:1e3,cancelToken:d0,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,f0=>f0.code!==Ry.OPERATION_ABORTED,h0)}(c0,t0,e0,n0));let o0=null,s0=null,a0={};try{o0=await jx(i0)}catch(c0){if(c0.code===Ry.OPERATION_ABORTED)throw c0;s0=c0}if(i0.forEach(c0=>c0.cancel()),vb.reportApiInvoke(t0.sid,{name:By.REQUEST_CONFIG_DISTRIBUTE,options:{error:s0,res:o0}}).onSuccess(),o0&&o0.test_tags)try{a0=function(c0){if(!c0.test_tags)return{};const u0=c0.test_tags,l0=Object.keys(u0),d0={};return l0.forEach(h0=>{var p0;const m0=jp(p0=h0.slice(4)).call(p0),f0=JSON.parse(u0[h0])[1];d0[m0]=f0}),d0}(o0)}catch{}return a0}async function Jx(t0,e0){const n0=XA("WEBCS_DOMAIN").concat(XA("WEBCS_DOMAIN_BACKUP_LIST")).map(r0=>({url:"https://".concat(r0,"/api/v2/transpond/webrtc?v=2"),areaCode:Sx(),serviceIds:[YO.CHOOSE_SERVER,YO.CLOUD_PROXY_FALLBACK]}));try{return await Wx({referenceList:n0,asyncMapHandler:i0=>async function(o0,s0,a0){let c0,{url:u0,areaCode:l0,serviceIds:d0}=o0;const h0=Date.now(),[p0,m0]=Vx(s0,l0,d0);let f0=iA.networkState;try{f0&&iA.networkState===Xy.OFFLINE&&iA.onlineWaiter&&await Gh.race([iA.onlineWaiter,mA(PA.maxRetryTimeout)]),f0=iA.networkState;const{data:g0,headers:E0}=await Tx(u0,{data:p0,cancelToken:a0,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c0=E0.http3==="1"?1:-1,(S0=>{const w0=[];if(S0.response_body.forEach(I0=>{const L0=I0.buffer.code;if(I0.uri===23&&L0===0&&!I0.buffer.edges_services)if(I0.buffer.flag===4194310)I0.buffer.edges_services=[];else{const M0={error:new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:S0.detail[502]}),flag:I0.buffer.flag};w0.push(M0)}if(L0!==0){const M0=wO(L0),C0={error:new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,M0.desc,{desc:M0.desc,retry:M0.retry,csIp:S0.detail[502]}),flag:I0.buffer.flag};I0.buffer.flag===4194310?fb.warning(C0.error.toString()):w0.push(C0)}}),w0.length)throw new yb(Ry.CAN_NOT_GET_GATEWAY_SERVER,w0.map(I0=>"flag: ".concat(I0.flag,", message: ").concat(I0.error.message)).join(" | "),{retry:!!w0.find(I0=>I0.error.data.retry),csIp:S0.detail[502],desc:[...new Set(w0.map(I0=>{var L0;return I0==null||(L0=I0.error)===null||L0===void 0||(L0=L0.data)===null||L0===void 0?void 0:L0.desc}).filter(I0=>!!I0))]})})(g0);const y0=eN(g0,YO.CHOOSE_SERVER),b0=eN(g0,YO.CLOUD_PROXY_FALLBACK);return Ux(y0),{gatewayInfo:XO(y0,u0),proxyInfo:b0,opid:m0,requestTime:h0,url:u0,isHttp3:c0,elapse:Date.now()-h0}}catch(g0){throw g0}}(i0,t0,e0),closeFn:i0=>i0.code===Ry.OPERATION_ABORTED||i0.code===Ry.CAN_NOT_GET_GATEWAY_SERVER&&!i0.data.retry})}catch(r0){throw r0}}async function Xx(t0,e0,n0,r0){const i0=XA("PROXY_SERVER_TYPE3"),o0=(p0,m0,f0)=>{let g0=f0||i0;return Array.isArray(g0)&&(g0=m0%2==0?i0[1]:i0[0]),"https://".concat(g0,"/ap/?url=").concat(p0)};let s0=null;const a0=[],c0=async()=>{const p0=XA("WEBCS_DOMAIN").slice(0,XA("AJAX_REQUEST_CONCURRENT")).map((g0,E0)=>{let _0;return _0=t0.cloudProxyServer==="disabled"&&t0.proxyServer?o0("".concat(g0,"/api/v2/transpond/webrtc?v=2"),E0,t0.proxyServer):t0.cloudProxyServer==="disabled"||t0.cloudProxyServer==="fallback"?"https://".concat(g0,"/api/v2/transpond/webrtc?v=2"):o0("".concat(g0,"/api/v2/transpond/webrtc?v=2"),E0),{url:_0,areaCode:Sx(),serviceIds:[YO.CHOOSE_SERVER,t0.cloudProxyServer==="proxy5"?YO.CLOUD_PROXY_5:t0.cloudProxyServer==="proxy3"||t0.cloudProxyServer==="proxy4"?YO.CLOUD_PROXY:YO.CLOUD_PROXY_FALLBACK]}}),m0=r0.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p0.map(g0=>g0.url)}),f0=await Gx({fragementLength:XA("FRAGEMENT_LENGTH"),referenceList:p0,asyncMapHandler:g0=>(fb.debug("[".concat(t0.clientId,"] Connect to choose_server:"),g0.url),kx(g0,t0,e0,n0)),allFailedhandler:g0=>{throw r0.recordJoinChannelService({endTs:Date.now(),status:"error",errors:g0},m0),g0[0]},promisesCollector:a0});return r0.recordJoinChannelService({endTs:Date.now(),status:"success"},m0),f0},u0=async()=>{if(await mA(1e3),s0!==null)return s0;const p0=XA("WEBCS_DOMAIN_BACKUP_LIST").map((g0,E0)=>{let _0;return _0=t0.cloudProxyServer==="disabled"&&t0.proxyServer?o0("".concat(g0,"/api/v2/transpond/webrtc?v=2"),E0,t0.proxyServer):t0.cloudProxyServer==="disabled"||t0.cloudProxyServer==="fallback"?"https://".concat(g0,"/api/v2/transpond/webrtc?v=2"):o0("".concat(g0,"/api/v2/transpond/webrtc?v=2"),E0),{url:_0,areaCode:Sx(),serviceIds:[YO.CHOOSE_SERVER,t0.cloudProxyServer==="proxy5"?YO.CLOUD_PROXY_5:t0.cloudProxyServer==="proxy3"||t0.cloudProxyServer==="proxy4"?YO.CLOUD_PROXY:YO.CLOUD_PROXY_FALLBACK]}}),m0=r0.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p0.map(g0=>g0.url)}),f0=await Gx({fragementLength:XA("FRAGEMENT_LENGTH"),referenceList:p0,asyncMapHandler:g0=>(fb.debug("[".concat(t0.clientId,"] Connect to backup choose_server:"),g0.url),kx(g0,t0,e0,n0)),allFailedhandler:g0=>{throw r0.recordJoinChannelService({endTs:Date.now(),status:"error",errors:g0},m0),g0[0]},promisesCollector:a0});return r0.recordJoinChannelService({endTs:Date.now(),status:"success"},m0),f0};let l0,d0,h0;try{({gatewayInfo:l0,proxyInfo:d0,url:h0}=await jx([c0(),u0()]))}catch(p0){throw p0[0]}if(a0.length&&a0.forEach(p0=>p0.cancel&&typeof p0.cancel=="function"&&p0.cancel()),!l0||!d0)throw new yb(Ry.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t0.apUrl=h0,t0.cloudProxyServer!=="disabled"&&Array.isArray(i0)&&h0){const p0=/^https?:\/\/(.+?)(\/.*)?$/.exec(h0)[1];Dn(i0).call(i0,p0)&&(t0.proxyServer=p0,fb.setProxyServer(p0),vb.setProxyServer(p0))}return s0={gatewayInfo:l0,proxyInfo:await tN(d0,l0.uid)},s0}async function Qx(t0,e0,n0){const r0=XA("UAP_AP").slice(0,XA("AJAX_REQUEST_CONCURRENT")).map(o0=>t0.proxyServer?"https://".concat(t0.proxyServer,"/ap/?url=").concat(o0+"/api/v1?action=uap"):"https://".concat(o0,"/api/v1?action=uap")),i0=r0.map(o0=>function(s0,a0,c0,u0){const l0={command:"convergeAllocateEdge",sid:a0.sid,appId:a0.appId,token:a0.token,ts:Date.now(),version:GA,cname:a0.cname,uid:a0.uid.toString(),requestId:Px,seq:Px};Px+=1;const d0={service_name:"tele_channel",json_body:JSON.stringify(l0)};return kA(async()=>{const h0=await Tx(s0,{data:d0,cancelToken:c0,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(h0.code!==0){const m0=new yb(Ry.UNEXPECTED_RESPONSE,"cross channel ap error, code"+h0.code,{retry:!0});throw fb.error(m0.toString()),m0}const p0=JSON.parse(h0.json_body);if(p0.code!==200){const m0=new yb(Ry.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(p0.code,", reason: ").concat(p0.reason));throw fb.error(m0.toString()),m0}if(!p0.servers||p0.servers.length===0){const m0=new yb(Ry.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw fb.error(m0.toString()),m0}return{vid:p0.vid,workerToken:p0.workerToken,addressList:(XA("CHANNEL_MEDIA_RELAY_SERVERS")||p0.servers).map(m0=>"wss://".concat(m0.address.replace(/\./g,"-"),".").concat(XA("WORKER_DOMAIN"),":").concat(m0.wss))}},void 0,h0=>!!(h0.code!==Ry.OPERATION_ABORTED&&h0.code!==Ry.UNEXPECTED_RESPONSE||h0.data&&h0.data.retry),u0)}(o0,t0,e0,n0));try{const o0=await jx(i0);return i0.forEach(s0=>s0.cancel()),o0}catch(o0){throw o0[0]}}async function Zx(t0,e0,n0){let r0=null;const i0=[],o0=async s0=>{const a0=XA(s0?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(c0=>t0.proxyServer?"https://".concat(t0.proxyServer,"/ap/?url=").concat(c0+"/api/v2/transpond/webrtc?v=2"):"https://".concat(c0,"/api/v2/transpond/webrtc?v=2"));return s0&&(await mA(1e3),r0!==null)?r0:await Gx({fragementLength:XA("FRAGEMENT_LENGTH"),referenceList:a0,asyncMapHandler:c0=>(fb.debug("[".concat(t0.clientId,"] update ticket, Connect to ").concat(s0?"backup":""," choose_server:"),c0),function(u0,l0,d0,h0){const[p0]=Fx(l0,[YO.CHOOSE_SERVER]);let m0=iA.networkState;return kA(async()=>{m0&&iA.networkState===Xy.OFFLINE&&iA.onlineWaiter&&await Gh.race([iA.onlineWaiter,mA(h0&&h0.maxRetryTimeout||PA.maxRetryTimeout)]),m0=iA.networkState;const f0=await Tx(u0,{data:p0,cancelToken:d0,headers:{"Content-Type":"multipart/form-data;"}},!0);return xx(f0,u0)},()=>!1,f0=>f0.code!==Ry.OPERATION_ABORTED&&(f0.code===Ry.UPDATE_TICKET_FAILED?f0.data.retry:(fb.warning("[".concat(l0.clientId,"] update ticket network error, retry"),f0),!0)),h0)}(c0,t0,e0,n0)),allFailedhandler:c0=>{throw c0[0]},promisesCollector:i0})};try{return r0=await jx([o0(!1),o0(!0)]),i0.length&&i0.forEach(s0=>s0.cancel&&typeof s0.cancel=="function"&&s0.cancel()),r0}catch(s0){throw s0[0]}}function $x(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function eV(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?$x(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):$x(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}class tV extends xy{get isSuccess(){return!!this.configs}constructor(){super(),Fg(this,"configs",void 0),Fg(this,"joinInfo",void 0),Fg(this,"cancelToken",void 0),Fg(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Fg(this,"interval",void 0),Fg(this,"mutex",new NA("config-distribute")),Fg(this,"mutableParamsRead",!1)}startGetConfigDistribute(e0,n0){this.joinInfo=e0,this.cancelToken=n0,this.interval&&this.stopGetConfigDistribute(),XA("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},XA("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,vb.reportApiInvoke(null,{options:void 0,name:By.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:jy.TRACER}).onSuccess(JSON.stringify(QA))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void fb.debug("[config-distribute] get config distribute interrupted have no joininfo");let e0;const n0=await this.mutex.lock();try{e0=await zx(this.joinInfo,this.cancelToken,this.retryConfig),fb.debug("[config-distribute] get config distribute",JSON.stringify(e0)),e0.limit_bitrate&&this.handleBitrateLimit(e0.limit_bitrate),this.cacheGlobalParameterConfig(e0),this.configs=e0}catch(r0){const i0=new yb(Ry.NETWORK_RESPONSE_ERROR,r0);fb.warning("[config-distribute] ".concat(i0.toString()))}finally{n0()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e0){var n0;(n0=e0)&&n0.uplink&&n0.id&&n0.uplink.max_bitrate!==void 0&&n0.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e0.id&&this.emit(sO.UPDATE_BITRATE_LIMIT,e0):this.emit(sO.UPDATE_BITRATE_LIMIT,e0))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&eV({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e0){var n0;const r0=aE(n0=Object.keys(e0).filter(o0=>/^webrtc_ng_global_parameter/.test(o0))).call(n0);for(let o0=0;o0<r0.length;o0++)for(let s0=r0.length-1;s0>o0;s0--){const a0=r0[s0];if(typeof e0[a0].__priority=="number"){const c0=e0[a0].__priority,u0=r0[s0-1];if(typeof e0[u0].__priority=="number"){if(!(c0>e0[u0].__priority))continue;{const l0=a0;r0[s0]=r0[s0-1],r0[s0-1]=l0}}else{const l0=a0;r0[s0]=r0[s0-1],r0[s0-1]=l0}}}const i0={};r0.forEach(o0=>{const s0=e0[o0],a0=s0.__expires;Object.keys(s0).forEach(c0=>{c0==="__priority"||c0==="__expires"||Object.prototype.hasOwnProperty.call(i0,c0)||(i0[c0]=eV({value:s0[c0]},a0&&{expires:a0}))})});try{(function(a0){try{const c0=Date.now();Object.keys(a0).forEach(u0=>{switch(u0){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(zA,u0)){const{value:l0,expires:d0}=a0[u0];if(d0&&d0<=c0)return;QA[u0]=l0,zA[u0]=l0,fb.debug("Update global parameters from config distribute",u0,l0)}}})}catch(c0){fb.error("Error update config immediately: ".concat(a0),c0.message)}})(i0);const o0=JSON.stringify(i0),s0=window.btoa(o0);window.localStorage.setItem("websdk_ng_global_parameter",s0),fb.debug("Caching global parameters ".concat(o0))}catch(o0){fb.error("Error caching global parameters:",o0.message)}}}class iV extends xy{constructor(){super(...arguments),Fg(this,"resultStorage",new Map)}setLocalAudioStats(e0,n0,r0){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e0,this.checkAudioInputLevel(r0,n0)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e0,this.checkSendAudioBitrate(r0,n0))}setLocalVideoStats(e0,n0,r0){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e0,this.checkSendVideoBitrate(r0,n0)),this.record("FRAMERATE_INPUT_TOO_LOW",e0,this.checkFramerateInput(r0,n0)),this.record("FRAMERATE_SENT_TOO_LOW",e0,this.checkFramerateSent(r0))}setRemoteAudioStats(e0,n0){const r0=e0.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r0,this.checkAudioOutputLevel(n0))}setRemoteVideoStats(e0,n0){const r0=e0.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r0,this.checkVideoDecode(n0))}record(e0,n0,r0){if(XA("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e0)||this.resultStorage.set(e0,{result:[],isPrevNormal:!0});const i0=this.resultStorage.get(e0);if(i0&&(i0.result.push(r0),i0.result.length>=5)){var o0;const s0=Dn(o0=i0.result).call(o0,!0);i0.isPrevNormal&&!s0&&this.emit("exception",nV[e0],e0,n0),!i0.isPrevNormal&&s0&&this.emit("exception",nV[e0]+2e3,e0+"_RECOVER",n0),i0.isPrevNormal=s0,i0.result=[]}}checkAudioOutputLevel(e0){return!(e0.receiveBitrate>0&&e0.receiveLevel===0)}checkAudioInputLevel(e0,n0){return n0 instanceof RM&&!n0.isActive||!!n0.muted||e0.sendVolumeLevel!==0}checkFramerateInput(e0,n0){let r0=null;n0._encoderConfig&&n0._encoderConfig.frameRate&&(r0=QO(n0._encoderConfig.frameRate));const i0=e0.captureFrameRate;return!r0||!i0||!(r0>10&&i0<5||r0<10&&r0>=5&&i0<=1)}checkFramerateSent(e0){return!(e0.captureFrameRate&&e0.sendFrameRate&&e0.captureFrameRate>5&&e0.sendFrameRate<=1)}checkSendVideoBitrate(e0,n0){return!!n0.muted||e0.sendBitrate!==0}checkSendAudioBitrate(e0,n0){return n0 instanceof RM&&!n0.isActive||!!n0.muted||e0.sendBitrate!==0}checkVideoDecode(e0){return e0.receiveBitrate===0||e0.decodeFrameRate!==0}}const nV={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},rV=new class{markSubscribeStart(t0,e0){performance.mark("agora-web-sdk/".concat(t0,"/subscribe-").concat(e0))}markPublishStart(t0,e0){performance.mark("agora-web-sdk/".concat(t0,"/publish-").concat(e0))}measureFromSubscribeStart(t0,e0){const n0=performance.getEntriesByName("agora-web-sdk/".concat(t0,"/subscribe-").concat(e0));if(n0.length>0){const r0=n0[n0.length-1];return Math.round(performance.now()-r0.startTime)}return 0}measureFromPublishStart(t0,e0){const n0=performance.getEntriesByName("agora-web-sdk/".concat(t0,"/publish-").concat(e0));if(n0.length>0){const r0=n0[n0.length-1];return Math.round(performance.now()-r0.startTime)}return 0}};var oV=i(ie.Object.getOwnPropertySymbols),sV=wi,aV=qi.indexOf,cV=Bn,dV=v([].indexOf),lV=!!dV&&1/dV([1],1,-0)<0;sV({target:"Array",proto:!0,forced:lV||!cV("indexOf")},{indexOf:function(t0){var e0=arguments.length>1?arguments[1]:void 0;return lV?dV(this,t0,e0)||0:aV(this,t0,e0)}});var uV=Xi("Array").indexOf,hV=l,pV=uV,_V=Array.prototype,EV=function(t0){var e0=t0.indexOf;return t0===_V||hV(_V,t0)&&e0===_V.indexOf?pV:e0},fV=i(EV);function mV(t0,e0){if(t0==null)return{};var n0,r0,i0=function(s0,a0){if(s0==null)return{};var c0,u0,l0={},d0=Wb(s0);for(u0=0;u0<d0.length;u0++)c0=d0[u0],fV(a0).call(a0,c0)>=0||(l0[c0]=s0[c0]);return l0}(t0,e0);if(oV){var o0=oV(t0);for(r0=0;r0<o0.length;r0++)n0=o0[r0],fV(e0).call(e0,n0)>=0||Object.prototype.propertyIsEnumerable.call(t0,n0)&&(i0[n0]=t0[n0])}return i0}function TV(t0){if(Array.isArray(t0))return t0.map(n0=>n0);if(!SV(t0))return t0;const e0={};for(const n0 in t0){const r0=t0[n0];SV(r0)||Array.isArray(r0)?e0[n0]=TV(r0):e0[n0]=r0}return e0}function SV(t0){return!(typeof t0!="object"||Array.isArray(t0)||!t0)}class gV{constructor(e0){Fg(this,"input",[]),Fg(this,"size",void 0),this.size=e0}add(e0){this.input.push(e0),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const RV={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},CV={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:RV,remoteCandidate:RV}},IV={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},vV={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},yV={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},AV={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function bV(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function wV(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?bV(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):bV(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}class OV{constructor(e0,n0){Fg(this,"onFirstVideoReceived",void 0),Fg(this,"onFirstVideoDecoded",void 0),Fg(this,"onFirstAudioReceived",void 0),Fg(this,"onFirstVideoDecodedTimeout",void 0),Fg(this,"onFirstAudioDecoded",void 0),Fg(this,"onSelectedLocalCandidateChanged",void 0),Fg(this,"onSelectedRemoteCandidateChanged",void 0),Fg(this,"videoIsReady",!1),Fg(this,"videoIsReady2",{}),Fg(this,"pc",void 0),Fg(this,"options",void 0),Fg(this,"intervalTimer",void 0),Fg(this,"stats",TV(CV)),Fg(this,"isFirstVideoReceived",{}),Fg(this,"isFirstVideoDecoded",{}),Fg(this,"isFirstAudioReceived",{}),Fg(this,"isFirstAudioDecoded",{}),Fg(this,"isFirstVideoDecodedTimeout",{}),Fg(this,"lossRateWindowStats",[]),this.pc=e0,this.options=n0,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Gh(e0=>{e0({local:wV({},RV),remote:wV({},RV)})})}setVideoIsReady(e0){this.videoIsReady=e0}setVideoIsReady2(e0,n0){this.videoIsReady2[e0]=n0}getVideoIsReady(e0){return this.videoIsReady2[e0]||!1}setIsFirstAudioDecoded(e0){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e0){this.lossRateWindowStats.push(e0),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n0=this.lossRateWindowStats.length,r0=["videoSend","audioSend","videoRecv","audioRecv"];let i0=0,o0=0,s0=0,a0=0;for(const c0 of r0)e0[c0].forEach((u0,l0)=>{if(!this.lossRateWindowStats[n0-1][c0][l0]||!this.lossRateWindowStats[0][c0][l0])return;const d0=this.lossRateWindowStats[n0-1][c0][l0].packets-this.lossRateWindowStats[0][c0][l0].packets,h0=this.lossRateWindowStats[n0-1][c0][l0].packetsLost-this.lossRateWindowStats[0][c0][l0].packetsLost;c0==="videoSend"||c0==="audioSend"?(i0+=d0,s0+=h0):(o0+=d0,a0+=h0),Number.isNaN(d0)||Number.isNaN(d0)?u0.packetLostRate=0:u0.packetLostRate=d0<=0||h0<=0?0:h0/(d0+h0)});e0.sendPacketLossRate=i0<=0||s0<=0?0:s0/(i0+s0),e0.recvPacketLossRate=o0<=0||a0<=0?0:a0/(o0+a0)}}function NV(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function DV(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?NV(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):NV(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}class PV extends OV{constructor(){super(...arguments),Fg(this,"_stats",CV),Fg(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e0=await this._getStats(),n0=this.statsResponsesToObjects(e0);this._stats=TV(CV);const r0=n0.filter(o0=>o0.type==="ssrc");this.processSSRCStats(r0);const i0=n0.find(o0=>o0.type==="VideoBwe");i0&&this.processBandwidthStats(i0),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e0){this._stats.bitrate={actualEncoded:Number(e0.googActualEncBitrate),targetEncoded:Number(e0.googTargetEncBitrate),retransmit:Number(e0.googRetransmitBitrate),transmit:Number(e0.googTransmitBitrate)},this._stats.sendBandwidth=Number(e0.googAvailableSendBandwidth)}processSSRCStats(e0){e0.forEach(n0=>{var r0;const i0=Dn(r0=n0.id).call(r0,"send");switch("".concat(n0.mediaType,"_").concat(i0?"send":"recv")){case"video_send":{const o0=TV(vV);o0.codec=n0.googCodecName,o0.adaptionChangeReason="none",n0.googCpuLimitedResolution&&(o0.adaptionChangeReason="cpu"),n0.googBandwidthLimitedResolution&&(o0.adaptionChangeReason="bandwidth"),o0.avgEncodeMs=Number(n0.googAvgEncodeMs),o0.inputFrame={width:Number(n0.googFrameWidthInput)||Number(n0.googFrameWidthSent),height:Number(n0.googFrameHeightInput)||Number(n0.googFrameHeightSent),frameRate:Number(n0.googFrameRateInput)},o0.sentFrame={width:Number(n0.googFrameWidthSent),height:Number(n0.googFrameHeightSent),frameRate:Number(n0.googFrameRateInput)},o0.firsCount=Number(n0.googFirReceived),o0.nacksCount=Number(n0.googNacksReceived),o0.plisCount=Number(n0.googPlisReceived),o0.frameCount=Number(n0.framesEncoded),o0.bytes=Number(n0.bytesSent),o0.packets=Number(n0.packetsSent),o0.packetsLost=Number(n0.packetsLost),o0.ssrc=Number(n0.ssrc),o0.rttMs=Number(n0.googRtt||0),this._stats.videoSend.push(o0),this._stats.rtt=o0.rttMs;break}case"video_recv":{const o0=TV(IV),s0=this.lastDecodeVideoReceiverStats.get(Number(n0.ssrc));if(o0.codec=n0.googCodecName,o0.targetDelayMs=Number(n0.googTargetDelayMs),o0.renderDelayMs=Number(n0.googRenderDelayMs),o0.currentDelayMs=Number(n0.googCurrentDelayMs),o0.minPlayoutDelayMs=Number(n0.googMinPlayoutDelayMs),o0.decodeMs=Number(n0.googDecodeMs),o0.maxDecodeMs=Number(n0.googMaxDecodeMs),o0.receivedFrame={width:Number(n0.googFrameWidthReceived),height:Number(n0.googFrameHeightReceived),frameRate:Number(n0.googFrameRateReceived)},o0.decodedFrame={width:Number(n0.googFrameWidthReceived),height:Number(n0.googFrameHeightReceived),frameRate:Number(n0.googFrameRateDecoded)},o0.decodeFrameRate=Number(n0.googFrameRateDecoded),o0.outputFrame={width:Number(n0.googFrameWidthReceived),height:Number(n0.googFrameHeightReceived),frameRate:Number(n0.googFrameRateOutput)},o0.jitterBufferMs=Number(n0.googJitterBufferMs),o0.firsCount=Number(n0.googFirsSent),o0.nacksCount=Number(n0.googNacksSent),o0.plisCount=Number(n0.googPlisSent),o0.framesDecodeCount=Number(n0.framesDecoded),o0.bytes=Number(n0.bytesReceived),o0.packets=Number(n0.packetsReceived),o0.packetsLost=Number(n0.packetsLost),o0.ssrc=Number(n0.ssrc),o0.packets>0&&!this.isFirstVideoReceived[o0.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o0.ssrc),this.isFirstVideoReceived[o0.ssrc]=!0),o0.framesDecodeCount>0&&!this.isFirstVideoDecoded[o0.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o0.ssrc,o0.decodedFrame.width,o0.decodedFrame.height),this.isFirstVideoDecoded[o0.ssrc]=!0),s0){const a0=s0.stats,c0=Date.now()-s0.lts;o0.framesDecodeFreezeTime=a0.framesDecodeFreezeTime,o0.framesDecodeInterval=a0.framesDecodeInterval,o0.framesDecodeCount>a0.framesDecodeCount&&this.isFirstVideoDecoded[o0.ssrc]?(s0.lts=Date.now(),o0.framesDecodeInterval=c0,o0.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n0.ssrc,10))?o0.framesDecodeFreezeTime+=o0.framesDecodeInterval:this.setVideoIsReady2(parseInt(n0.ssrc,10),!0))):o0.framesDecodeCount<s0.stats.framesDecodeCount&&(o0.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o0.ssrc,{stats:DV({},o0),lts:Date.now()}),this._stats.videoRecv.push(o0);break}case"audio_recv":{const o0=TV(AV);o0.codec=n0.googCodecName,o0.outputLevel=Math.abs(Number(n0.audioOutputLevel))/32767,o0.decodingCNG=Number(n0.googDecodingCNG),o0.decodingCTN=Number(n0.googDecodingCTN),o0.decodingCTSG=Number(n0.googDecodingCTSG),o0.decodingNormal=Number(n0.googDecodingNormal),o0.decodingPLC=Number(n0.googDecodingPLC),o0.decodingPLCCNG=Number(n0.googDecodingPLCCNG),o0.expandRate=Number(n0.googExpandRate),o0.accelerateRate=Number(n0.googAccelerateRate),o0.preemptiveExpandRate=Number(n0.googPreemptiveExpandRate),o0.secondaryDecodedRate=Number(n0.googSecondaryDecodedRate),o0.speechExpandRate=Number(n0.googSpeechExpandRate),o0.preferredJitterBufferMs=Number(n0.googPreferredJitterBufferMs),o0.jitterBufferMs=Number(n0.googJitterBufferMs),o0.jitterMs=Number(n0.googJitterReceived),o0.bytes=Number(n0.bytesReceived),o0.packets=Number(n0.packetsReceived),o0.packetsLost=Number(n0.packetsLost),o0.ssrc=Number(n0.ssrc),o0.receivedFrames=Number(n0.googDecodingCTN)||Number(n0.packetsReceived),o0.droppedFrames=Number(n0.googDecodingPLC)+Number(n0.googDecodingPLCCNG)||Number(n0.packetsLost),o0.receivedFrames>0&&!this.isFirstAudioReceived[o0.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o0.ssrc),this.isFirstAudioReceived[o0.ssrc]=!0),o0.decodingNormal>0&&!this.isFirstAudioDecoded[o0.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o0.ssrc),this.isFirstAudioDecoded[o0.ssrc]=!0),this._stats.audioRecv.push(o0);break}case"audio_send":{const o0=TV(yV);o0.codec=n0.googCodecName,o0.inputLevel=Math.abs(Number(n0.audioInputLevel))/32767,o0.aecReturnLoss=Number(n0.googEchoCancellationReturnLoss||0),o0.aecReturnLossEnhancement=Number(n0.googEchoCancellationReturnLossEnhancement||0),o0.residualEchoLikelihood=Number(n0.googResidualEchoLikelihood||0),o0.residualEchoLikelihoodRecentMax=Number(n0.googResidualEchoLikelihoodRecentMax||0),o0.bytes=Number(n0.bytesSent),o0.packets=Number(n0.packetsSent),o0.packetsLost=Number(n0.packetsLost),o0.ssrc=Number(n0.ssrc),o0.rttMs=Number(n0.googRtt||0),this._stats.rtt=o0.rttMs,this._stats.audioSend.push(o0);break}}})}_getStats(){return new Gh((e0,n0)=>{this.pc.getStats(e0,n0)})}statsResponsesToObjects(e0){const n0=[];return e0.result().forEach(r0=>{const i0={id:r0.id,timestamp:r0.timestamp.valueOf().toString(),type:r0.type};r0.names().forEach(o0=>{i0[o0]=r0.stat(o0)}),n0.push(i0)}),n0}}function LV(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function kV(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?LV(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):LV(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}class MV extends OV{constructor(){super(...arguments),Fg(this,"_stats",CV),Fg(this,"report",void 0),Fg(this,"lastDecodeVideoReceiverStats",new Map),Fg(this,"lastVideoFramesRecv",new Map),Fg(this,"lastVideoFramesSent",new Map),Fg(this,"lastVideoFramesDecode",new Map),Fg(this,"lastVideoFramesOutput",new Map),Fg(this,"lastVideoJBDelay",new Map),Fg(this,"lastAudioJBDelay",new Map),Fg(this,"mediaBytesSent",new Map),Fg(this,"mediaBytesRetransmit",new Map),Fg(this,"mediaBytesTargetEncode",new Map),Fg(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=TV(CV),this.report.forEach(e0=>{switch(e0.type){case vw.OUTBOUND:case vw.INBOUND:{const n0=e0.mediaType||e0.kind,r0=!n0&&"frameWidth"in e0,i0=!n0&&!("frameWidth"in e0);e0.type===vw.OUTBOUND?n0==="audio"||i0?this.processAudioOutboundStats(e0):(n0==="video"||r0)&&this.processVideoOutboundStats(e0):e0.type===vw.INBOUND&&(n0==="audio"||i0?this.processAudioInboundStats(e0):(n0==="video"||r0)&&this.processVideoInboundStats(e0));break}case vw.TRANSPORT:{const n0=this.report.get(e0.selectedCandidatePairId);n0&&this.processCandidatePairStats(n0);break}case vw.CANDIDATE_PAIR:e0.selected&&this.processCandidatePairStats(e0)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e0=await this.pc.getStats(),n0={local:kV({},RV),remote:kV({},RV)};return e0.forEach(r0=>{let i0;if(r0.type===vw.TRANSPORT&&(i0=e0.get(r0.selectedCandidatePairId)),r0.type===vw.CANDIDATE_PAIR&&r0.selected&&(i0=r0),i0){const o0=(s0,a0)=>{s0.type=a0.type,s0.id=a0.id,a0.address&&(s0.address=a0.address),a0.candidateType&&(s0.candidateType=a0.candidateType),a0.port&&(s0.port=a0.port),a0.priority&&(s0.priority=a0.priority),a0.protocol&&(s0.protocol=a0.protocol),a0.relayProtocol&&(s0.relayProtocol=a0.relayProtocol)};if(i0.localCandidateId){const s0=e0.get(i0.localCandidateId);s0&&o0(n0.local,s0)}if(i0.remoteCandidateId){const s0=e0.get(i0.remoteCandidateId);s0&&o0(n0.remote,s0)}}}),n0}processCandidatePairStats(e0){if(this._stats.sendBandwidth=e0.availableOutgoingBitrate||0,e0.currentRoundTripTime&&(this._stats.rtt=1e3*e0.currentRoundTripTime),this._stats.videoSend.forEach(n0=>{e0.currentRoundTripTime&&(n0.rttMs=1e3*e0.currentRoundTripTime)}),this._stats.audioSend.forEach(n0=>{e0.currentRoundTripTime&&(n0.rttMs=1e3*e0.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e0.id,e0.localCandidateId){const n0=this.report.get(e0.localCandidateId);n0&&this.processCandidateStats(n0)}if(e0.remoteCandidateId){const n0=this.report.get(e0.remoteCandidateId);n0&&this.processCandidateStats(n0)}}processCandidateStats(e0){let n0;e0.type===vw.LOCAL_CANDIDATE&&(n0=this._stats.selectedCandidatePair.localCandidate),e0.type===vw.REMOTE_CANDIDATE&&(n0=this._stats.selectedCandidatePair.remoteCandidate),n0&&(n0.type=e0.type,n0.id=e0.id,e0.address&&(n0.address=e0.address),e0.candidateType&&(n0.candidateType=e0.candidateType),e0.port&&(n0.port=e0.port),e0.priority&&(n0.priority=e0.priority),e0.protocol&&(n0.protocol=e0.protocol),e0.relayProtocol&&(n0.relayProtocol=e0.relayProtocol),e0.type===vw.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n0.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(kV({},n0),kV({},this.stats.selectedCandidatePair.localCandidate)),e0.type===vw.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n0.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(kV({},n0),kV({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e0){let n0=this._stats.audioRecv.find(r0=>r0.ssrc===e0.ssrc);n0||(n0=TV(AV),this._stats.audioRecv.push(n0)),n0.ssrc=e0.ssrc,n0.packets=e0.packetsReceived,n0.packetsLost=e0.packetsLost,n0.packetsDiscarded=e0.packetsDiscarded,n0.bytes=e0.bytesReceived,n0.jitterMs=1e3*e0.jitter,this.processAudioTrackReceiverStats(e0,e0.trackId,n0),e0.codecId&&(n0.codec=this.getCodecFromCodecStats(e0.codecId)),n0.receivedFrames||(n0.receivedFrames=e0.packetsReceived),n0.droppedFrames||(n0.droppedFrames=e0.packetsLost),n0.receivedFrames>0&&!this.isFirstAudioReceived[n0.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n0.ssrc),this.isFirstAudioReceived[n0.ssrc]=!0),n0.outputLevel&&n0.outputLevel>0&&!this.isFirstAudioDecoded[n0.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n0.ssrc),this.isFirstAudioDecoded[n0.ssrc]=!0),typeof e0.concealedSamples=="number"&&(n0.concealedSamples=e0.concealedSamples)}processVideoInboundStats(e0){let n0=this._stats.videoRecv.find(a0=>a0.ssrc===e0.ssrc);n0||(n0=TV(IV),this._stats.videoRecv.push(n0)),n0.ssrc=e0.ssrc,n0.packets=e0.packetsReceived,n0.packetsLost=e0.packetsLost,n0.bytes=e0.bytesReceived,n0.firsCount=e0.firCount,n0.nacksCount=e0.nackCount,n0.plisCount=e0.pliCount,n0.framesDecodeCount=e0.framesDecoded,n0.framesDroppedCount=e0.framesDropped,n0.totalInterFrameDelay=e0.totalInterFrameDelay,n0.totalSquaredInterFrameDelay=e0.totalSquaredInterFrameDelay,n0.totalFreezesDuration=e0.totalFreezesDuration;const r0=this.lastDecodeVideoReceiverStats.get(n0.ssrc),i0=this.lastVideoFramesDecode.get(n0.ssrc),o0=this.lastVideoFramesOutput.get(n0.ssrc),s0=Date.now();if(n0.framesDecodeCount>0&&!this.isFirstVideoDecoded[n0.ssrc]){const a0=n0.decodedFrame?n0.decodedFrame.width:0,c0=n0.decodedFrame?n0.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n0.ssrc,a0,c0),this.isFirstVideoDecoded[n0.ssrc]=!0}if(r0){const a0=r0.stats,c0=s0-r0.lts;n0.framesDecodeFreezeTime=a0.framesDecodeFreezeTime,n0.framesDecodeInterval=a0.framesDecodeInterval,!this.isFirstVideoDecoded[n0.ssrc]&&c0>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n0.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n0.ssrc),this.isFirstVideoDecodedTimeout[n0.ssrc]=!0),n0.framesDecodeCount>a0.framesDecodeCount&&this.isFirstVideoDecoded[n0.ssrc]?(r0.lts=Date.now(),n0.framesDecodeInterval=c0,n0.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e0.ssrc))?n0.framesDecodeFreezeTime+=n0.framesDecodeInterval:this.setVideoIsReady2(parseInt(e0.ssrc,10),!0))):n0.framesDecodeCount<a0.framesDecodeCount&&(n0.framesDecodeInterval=0),e0.framesDecoded&&e0.qpSum&&(r0.stats.framesDecodeCount>e0.framesDecoded?n0.qpSumPerFrame=e0.qpSum/e0.framesDecoded:n0.qpSumPerFrame=(e0.qpSum-r0.qpSum)/(e0.framesDecoded-r0.stats.framesDecodeCount))}i0&&s0-i0.lts>=800?(n0.decodeFrameRate=Math.round((n0.framesDecodeCount-i0.count)/((s0-i0.lts)/1e3)),this.lastVideoFramesDecode.set(n0.ssrc,{count:n0.framesDecodeCount,lts:s0,rate:n0.decodeFrameRate})):i0?n0.decodeFrameRate=i0.rate:this.lastVideoFramesDecode.set(n0.ssrc,{count:n0.framesDecodeCount,lts:s0,rate:0}),n0.framesDroppedCount&&e0.framesReceived&&(o0&&s0-o0.lts>=800?(n0.outputFrameRate=Math.round((e0.framesReceived-n0.framesDroppedCount-o0.count)/((s0-o0.lts)/1e3)),this.lastVideoFramesOutput.set(n0.ssrc,{count:e0.framesReceived-n0.framesDroppedCount,lts:s0,rate:Math.max(n0.outputFrameRate,0)})):o0?n0.outputFrameRate=o0.rate:this.lastVideoFramesOutput.set(n0.ssrc,{count:e0.framesReceived-n0.framesDroppedCount,lts:s0,rate:0})),e0.totalDecodeTime&&(n0.decodeMs=1e3*e0.totalDecodeTime),this.processVideoTrackReceiverStats(e0,e0.trackId,n0),e0.codecId&&(n0.codec=this.getCodecFromCodecStats(e0.codecId)),e0.framerateMean&&(n0.framesRateFirefox=e0.framerateMean),n0.packets>0&&!this.isFirstVideoReceived[n0.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n0.ssrc),this.isFirstVideoReceived[n0.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n0.ssrc,{stats:kV({},n0),lts:r0?r0.lts:Date.now(),qpSum:e0.qpSum})}processVideoOutboundStats(e0){let n0=this._stats.videoSend.find(i0=>i0.ssrc===e0.ssrc);n0||(n0=TV(vV),this._stats.videoSend.push(n0));const r0=this.mediaBytesSent.get(e0.ssrc);if(r0)r0.add(e0.bytesSent);else{const i0=new gV(10);i0.add(e0.bytesSent),this.mediaBytesSent.set(e0.ssrc,i0)}if(e0.retransmittedBytesSent!==void 0){const i0=this.mediaBytesRetransmit.get(e0.ssrc);if(i0)i0.add(e0.retransmittedBytesSent);else{const o0=new gV(10);o0.add(e0.retransmittedBytesSent),this.mediaBytesRetransmit.set(e0.ssrc,o0)}}if(e0.totalEncodedBytesTarget){const i0=this.mediaBytesTargetEncode.get(e0.ssrc);if(i0)i0.add(e0.totalEncodedBytesTarget);else{const o0=new gV(10);o0.add(e0.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e0.ssrc,o0)}}if(n0.ssrc=e0.ssrc,n0.bytes=e0.bytesSent,n0.packets=e0.packetsSent,n0.firsCount=e0.firCount,n0.nacksCount=e0.nackCount,n0.plisCount=e0.pliCount,n0.frameCount=e0.framesEncoded,n0.adaptionChangeReason=e0.qualityLimitationReason,n0.scalabilityMode=e0.scalabilityMode,e0.totalEncodeTime&&e0.framesEncoded){const i0=this.lastEncoderMs.get(e0.ssrc);if(!i0||i0.lastFrameCount>e0.framesEncoded)n0.avgEncodeMs=1e3*e0.totalEncodeTime/e0.framesEncoded;else{const o0=e0.framesEncoded-i0.lastFrameCount,s0=e0.totalEncodeTime-i0.lastEncoderTime;n0.avgEncodeMs=1e3*s0/o0}}if(e0.framesEncoded&&e0.qpSum){const i0=this.lastEncoderMs.get(e0.ssrc);!i0||i0.lastFrameCount>e0.framesEncoded?n0.qpSumPerFrame=e0.qpSum/e0.framesEncoded:n0.qpSumPerFrame=(e0.qpSum-i0.lastQpSum)/(e0.framesEncoded-i0.lastFrameCount)}if(this.lastEncoderMs.set(e0.ssrc,{lastFrameCount:e0.framesEncoded,lastEncoderTime:e0.totalEncodeTime,lastQpSum:e0.qpSum,lts:Date.now()}),e0.codecId&&(n0.codec=this.getCodecFromCodecStats(e0.codecId)),e0.mediaSourceId&&this.processVideoMediaSource(e0.mediaSourceId,n0),this.processVideoTrackSenderStats(e0,e0.trackId,n0),e0.remoteId)this.processRemoteInboundStats(e0.remoteId,n0);else{const i0=this.findRemoteStatsId(e0.ssrc,vw.REMOTE_INBOUND);i0&&this.processRemoteInboundStats(i0,n0)}}processAudioOutboundStats(e0){let n0=this._stats.audioSend.find(r0=>r0.ssrc===e0.ssrc);if(n0||(n0=TV(yV),this._stats.audioSend.push(n0)),n0.ssrc=e0.ssrc,n0.packets=e0.packetsSent,n0.bytes=e0.bytesSent,e0.mediaSourceId&&this.processAudioMediaSource(e0.mediaSourceId,n0),e0.codecId&&(n0.codec=this.getCodecFromCodecStats(e0.codecId)),this.processAudioTrackSenderStats(e0,e0.trackId,n0),e0.remoteId)this.processRemoteInboundStats(e0.remoteId,n0);else{const r0=this.findRemoteStatsId(e0.ssrc,vw.REMOTE_INBOUND);r0&&this.processRemoteInboundStats(r0,n0)}}findRemoteStatsId(e0,n0){var r0;const i0=Array.from(_N(r0=this.report).call(r0)).find(o0=>o0.type===n0&&o0.ssrc===e0);return i0?i0.id:null}processVideoMediaSource(e0,n0){const r0=this.report.get(e0);r0&&r0.width&&r0.height&&r0.framesPerSecond&&(n0.inputFrame={width:r0.width,height:r0.height,frameRate:r0.framesPerSecond})}processAudioMediaSource(e0,n0){const r0=this.report.get(e0);r0&&(n0.inputLevel=r0.audioLevel)}processVideoTrackSenderStats(e0,n0,r0){var i0,o0,s0,a0;const c0=n0?this.report.get(n0):void 0,u0=(i0=c0==null?void 0:c0.framesSent)!==null&&i0!==void 0?i0:e0.framesSent;if(typeof u0!="number")return;let l0=(o0=c0==null?void 0:c0.frameWidth)!==null&&o0!==void 0?o0:e0.frameWidth,d0=(s0=c0==null?void 0:c0.frameHeight)!==null&&s0!==void 0?s0:e0.frameHeight,h0=(a0=c0==null?void 0:c0.framesPerSecond)!==null&&a0!==void 0?a0:e0.framesPerSecond;if(typeof l0=="number"&&typeof d0=="number"||(l0=0,d0=0),h0==null){const p0=Date.now(),m0=this.lastVideoFramesSent.get(r0.ssrc);m0&&p0-m0.lts>=800?(h0=Math.round((u0-m0.count)/((p0-m0.lts)/1e3)),this.lastVideoFramesSent.set(r0.ssrc,{count:u0,lts:p0,rate:h0})):m0?h0=m0.rate:this.lastVideoFramesSent.set(r0.ssrc,{count:u0,lts:p0,rate:0})}r0.sentFrame={width:l0,height:d0,frameRate:Math.max(0,h0)}}processVideoTrackReceiverStats(e0,n0,r0){var i0,o0,s0,a0,c0;const u0=n0?this.report.get(n0):void 0,l0=(i0=u0==null?void 0:u0.framesReceived)!==null&&i0!==void 0?i0:e0.framesReceived,d0=(o0=u0==null?void 0:u0.frameWidth)!==null&&o0!==void 0?o0:e0.frameWidth,h0=(s0=u0==null?void 0:u0.frameHeight)!==null&&s0!==void 0?s0:e0.frameHeight,p0=(a0=u0==null?void 0:u0.jitterBufferDelay)!==null&&a0!==void 0?a0:e0.jitterBufferDelay,m0=(c0=u0==null?void 0:u0.jitterBufferEmittedCount)!==null&&c0!==void 0?c0:e0.jitterBufferEmittedCount;if(typeof l0=="number"){const f0=this.lastVideoFramesRecv.get(r0.ssrc),g0=Date.now();r0.framesReceivedCount=l0;let E0=0;f0&&g0-f0.lts>=800?(E0=Math.round((l0-f0.count)/((g0-f0.lts)/1e3)),this.lastVideoFramesRecv.set(r0.ssrc,{count:l0,lts:g0,rate:E0})):f0?E0=f0.rate:this.lastVideoFramesRecv.set(r0.ssrc,{count:l0,lts:g0,rate:0}),r0.receivedFrame={width:d0||0,height:h0||0,frameRate:E0||0},r0.decodedFrame={width:d0||0,height:h0||0,frameRate:r0.decodeFrameRate||0},r0.outputFrame={width:d0||0,height:h0||0,frameRate:r0.outputFrameRate||r0.decodeFrameRate||0}}if(p0&&m0){const f0=this.lastVideoJBDelay.get(r0.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let g0=f0.jitterBufferMs;const E0=m0-f0.jitterBufferEmittedCount;E0>0&&(g0=1e3*(p0-f0.jitterBufferDelay)/E0),r0.jitterBufferMs=g0,r0.currentDelayMs=Math.round(g0),this.lastVideoJBDelay.set(r0.ssrc,{jitterBufferDelay:p0,jitterBufferEmittedCount:m0,jitterBufferMs:r0.currentDelayMs})}}processAudioTrackSenderStats(e0,n0,r0){var i0,o0,s0,a0;const c0=n0?this.report.get(n0):void 0,u0=(i0=(o0=c0==null?void 0:c0.echoReturnLoss)!==null&&o0!==void 0?o0:e0.echoReturnLoss)!==null&&i0!==void 0?i0:0,l0=(s0=(a0=c0==null?void 0:c0.echoReturnLossEnhancement)!==null&&a0!==void 0?a0:e0.echoReturnLossEnhancement)!==null&&s0!==void 0?s0:0;r0.aecReturnLoss=u0,r0.aecReturnLossEnhancement=l0}processAudioTrackReceiverStats(e0,n0,r0){var i0,o0,s0,a0,c0,u0,l0;const d0=n0?this.report.get(n0):void 0,h0=(i0=d0==null?void 0:d0.removedSamplesForAcceleration)!==null&&i0!==void 0?i0:e0.removedSamplesForAcceleration,p0=(o0=d0==null?void 0:d0.totalSamplesReceived)!==null&&o0!==void 0?o0:e0.totalSamplesReceived,m0=(s0=d0==null?void 0:d0.jitterBufferDelay)!==null&&s0!==void 0?s0:e0.jitterBufferDelay,f0=(a0=d0==null?void 0:d0.jitterBufferEmittedCount)!==null&&a0!==void 0?a0:e0.jitterBufferEmittedCount,g0=(c0=d0==null?void 0:d0.audioLevel)!==null&&c0!==void 0?c0:e0==null?void 0:e0.audioLevel,E0=(u0=d0==null?void 0:d0.totalSamplesDuration)!==null&&u0!==void 0?u0:e0==null?void 0:e0.totalSamplesDuration,_0=(l0=d0==null?void 0:d0.concealedSamples)!==null&&l0!==void 0?l0:e0.concealedSamples;if(h0&&p0&&(r0.accelerateRate=h0/p0),m0&&f0){const b0=this.lastAudioJBDelay.get(r0.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let S0=b0.jitterBufferMs;const w0=f0-b0.jitterBufferEmittedCount;w0>0&&(S0=1e3*(m0-b0.jitterBufferDelay)/w0),r0.jitterBufferMs=Math.round(S0),this.lastAudioJBDelay.set(r0.ssrc,{jitterBufferDelay:m0,jitterBufferEmittedCount:f0,jitterBufferMs:r0.jitterBufferMs})}r0.outputLevel=g0;let y0=1920;E0&&p0&&(y0=p0/E0/50,r0.receivedFrames=Math.round(p0/y0)),_0&&(r0.droppedFrames=Math.round(_0/y0))}processRemoteInboundStats(e0,n0){const r0=this.report.get(e0);r0&&(n0.packetsLost=r0.packetsLost,r0.roundTripTime&&(n0.rttMs=1e3*r0.roundTripTime),r0.jitter&&(n0.jitterMs=1e3*r0.jitter),r0.timestamp&&(n0.timestamp=r0.timestamp))}getCodecFromCodecStats(e0){const n0=this.report.get(e0);if(!n0)return"";const r0=n0.mimeType.match(/\/(.*)$/);return r0&&r0[1]?r0[1]:""}updateSendBitrate(){let e0=0,n0=null,r0=null;this.mediaBytesSent.forEach(o0=>{e0+=o0.diffMean()}),this.mediaBytesRetransmit.forEach(o0=>{n0=n0===null?o0.diffMean():n0+o0.diffMean()}),this.mediaBytesTargetEncode.forEach(o0=>{r0=r0===null?o0.diffMean():r0+o0.diffMean()});const i0=n0!==null?e0-n0:e0;this._stats.bitrate={actualEncoded:8*i0/(this.options.updateInterval/1e3),transmit:8*e0/(this.options.updateInterval/1e3)},n0!==null&&(this._stats.bitrate.retransmit=8*n0/(this.options.updateInterval/1e3)),r0!==null&&(this._stats.bitrate.targetEncoded=8*r0/(this.options.updateInterval/1e3))}}class UV extends OV{updateStats(){return Gh.resolve()}}function xV(t0){let e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n0=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r0=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i0=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const o0=function(){const s0=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return s0&&s0[0]?Number(s0[0].split("/")[1]):null}();return o0?o0<76?new PV(t0,{updateInterval:e0,lossRateInterval:n0,freezeRateLimit:r0,firstVideoDecodedTimeout:i0}):new MV(t0,{updateInterval:e0,lossRateInterval:n0,freezeRateLimit:r0,firstVideoDecodedTimeout:i0}):function(s0){if(!window.RTCStatsReport)return!1;const a0=s0.getStats();return!!(a0 instanceof Gh||function(c0){return!!c0&&(typeof c0=="object"||typeof c0=="function")&&typeof c0.then=="function"}(a0))}(t0)?new MV(t0,{updateInterval:e0,lossRateInterval:n0,freezeRateLimit:r0,firstVideoDecodedTimeout:i0}):new UV(t0,{updateInterval:e0,lossRateInterval:n0,freezeRateLimit:r0,firstVideoDecodedTimeout:i0})}let VV=class{get localCapabilities(){return sA(this._localCapabilities)}get rtpCapabilities(){return sA(this._rtpCapabilities)}get candidates(){return sA(this._candidates)}get iceParameters(){return sA(this._iceParameters)}get dtlsParameters(){return sA(this._dtlsParameters)}constructor(t0){Fg(this,"sessionDesc",void 0),Fg(this,"_localCapabilities",void 0),Fg(this,"_rtpCapabilities",void 0),Fg(this,"_candidates",void 0),Fg(this,"_iceParameters",void 0),Fg(this,"_dtlsParameters",void 0),Fg(this,"setup",void 0),Fg(this,"currentMidIndex",void 0),Fg(this,"cname","o/i14u9pJrxRKAsu"),Fg(this,"firefoxSsrcMidMap",new Map),t0=sA(t0);const{remoteIceParameters:e0,remoteDtlsParameters:n0,candidates:r0,remoteRTPCapabilities:i0,localCapabilities:o0,direction:s0,setup:a0,videoCodec:c0,audioCodec:u0}=t0;let l0;this.setup=a0,l0=s0===Mw.RECEIVE_ONLY?FU.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):FU.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i0,this._candidates=r0,this._iceParameters=e0,this._dtlsParameters=n0,this._localCapabilities=o0;const d0=s0===Mw.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h0=s0===Mw.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p0=s0===Mw.RECEIVE_ONLY?i0.send.videoCodecs:sx(dO.VIDEO,d0,h0,c0),m0=s0===Mw.RECEIVE_ONLY?i0.send.audioCodecs:sx(dO.AUDIO,d0,h0,u0);for(const f0 of l0.mediaDescriptions)f0.attributes.iceUfrag=e0.iceUfrag,f0.attributes.icePwd=e0.icePwd,f0.attributes.fingerprints=n0.fingerprints,f0.attributes.candidates=r0,f0.attributes.setup=this.setup,f0.media.mediaType==="application"&&(f0.attributes.sctpPort="5000"),f0.media.mediaType==="video"&&(f0.media.fmts=p0.map(g0=>g0.payloadType.toString(10)),f0.attributes.payloads=p0,f0.attributes.extmaps=d0.videoExtensions),f0.media.mediaType==="audio"&&(f0.media.fmts=m0.map(g0=>g0.payloadType.toString(10)),f0.attributes.payloads=m0,f0.attributes.extmaps=d0.audioExtensions,ox(f0));this.sessionDesc=l0,this.currentMidIndex=l0.mediaDescriptions.length-1}toString(){return FU.print(this.sessionDesc)}hasMid(t0){return Array.isArray(t0)?t0.every(e0=>this.hasMid(e0)):this.sessionDesc.mediaDescriptions.some(e0=>e0.attributes.mid===t0)}send(t0,e0,n0,r0,i0){n0=n0.replace(/ /g,"-");const{ssrcs:o0,ssrcGroups:s0}=zU(e0,this.cname,XA("SYNC_GROUP")?n0:void 0),a0=this.findPreloadMediaDesc(o0);if(a0){if(Zv()&&this.firefoxSsrcMidMap.set(o0[0].ssrcId,a0.attributes.mid),i0&&(i0.twcc||i0.remb)){const c0=this.sessionDesc.mediaDescriptions.indexOf(a0);return this.sessionDesc.mediaDescriptions[c0]=this.mungSendMediaDesc(a0,i0),{mid:a0.attributes.mid,needExchangeSDP:!0}}return{mid:a0.attributes.mid,needExchangeSDP:!1}}{const c0=this.findAvailableMediaIndex(t0,o0,r0);let u0;return c0===-1?(u0=this.createOrRecycleSendMedia(t0,o0,s0,"sendonly",r0,i0),this.updateBundleMids()):(u0=sA(this.sessionDesc.mediaDescriptions[c0]),u0.attributes.direction="sendonly",u0.attributes.ssrcs=o0,u0.attributes.ssrcGroups=s0,this.sessionDesc.mediaDescriptions[c0]=this.mungSendMediaDesc(u0,i0)),Zv()&&this.firefoxSsrcMidMap.set(o0[0].ssrcId,u0.attributes.mid),{needExchangeSDP:!0,mid:u0.attributes.mid}}}stopSending(t0){const e0=this.sessionDesc.mediaDescriptions.filter(n0=>n0.attributes.mid&&t0.indexOf(n0.attributes.mid)!==-1);if(e0.length!==t0.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e0.forEach(n0=>{n0.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t0,e0,n0){const r0=[];return t0.forEach(i0=>{const o0=i0._mediaStreamTrack.kind,s0=this.findAvailableRecvMediaIndex(o0);let a0,c0=!1;s0===-1?(c0=!0,a0=this.createOrRecycleRecvMedia(i0,[],"recvonly",e0,n0),this.updateBundleMids()):(a0=sA(this.sessionDesc.mediaDescriptions[s0]),a0.attributes.direction="recvonly"),r0.push({mid:a0.attributes.mid,needCreateTransceiver:c0})}),r0}stopReceiving(t0){const e0=this.sessionDesc.mediaDescriptions.filter(n0=>t0.indexOf(n0.attributes.mid)!==-1);if(e0.length!==t0.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e0.forEach(n0=>{n0.media.port="0",n0.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t0){const{foundation:e0,protocol:n0,address:r0,port:i0,type:o0,relatedAddress:s0,relatedPort:a0,priority:c0}=new RTCIceCandidate(t0),u0={foundation:e0??"",componentId:"1",transport:n0??"",priority:c0?c0+"":"",connectionAddress:r0??"",port:i0?i0+"":"",type:o0?o0+"":"",relAddr:s0??"",relPort:a0?a0+"":"",extension:{}};this.candidates.some(l0=>l0.priority===u0.priority&&l0.connectionAddress===u0.connectionAddress&&l0.port===u0.port)||(this._candidates.push(u0),this.sessionDesc.mediaDescriptions.forEach(l0=>{l0.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t0,e0,n0,r0,i0){const o0=t0._mediaStreamTrack.kind,s0=this.rtpCapabilities.recv,a0=sx(o0,s0,this.localCapabilities.send,o0===dO.AUDIO?i0:r0),c0=o0===dO.VIDEO?s0.videoExtensions:s0.audioExtensions,u0="".concat(++this.currentMidIndex);let l0={media:{mediaType:o0,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a0.map(h0=>h0.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c0,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e0,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:a0,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n0,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u0)}};l0=this.mungRecvMediaDsec(l0,t0);const d0=this.findFirstClosedMedia(o0);if(d0){const h0=this.sessionDesc.mediaDescriptions.indexOf(d0);this.sessionDesc.mediaDescriptions[h0]=l0}else this.sessionDesc.mediaDescriptions.push(l0);return l0}muteRemote(t0){const e0=this.sessionDesc.mediaDescriptions.filter(n0=>Dn(t0).call(t0,n0.attributes.mid||""));if(e0.length!==t0.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e0.forEach(n0=>{n0.attributes.direction="inactive"})}unmuteRemote(t0){const e0=this.sessionDesc.mediaDescriptions.filter(n0=>Dn(t0).call(t0,n0.attributes.mid||""));if(e0.length!==t0.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e0.forEach(n0=>{n0.attributes.direction="recvonly"})}findAvailableMediaIndex(t0,e0,n0){return this.sessionDesc.mediaDescriptions.findIndex(r0=>{const i0=r0.media.mediaType===t0&&r0.media.port!=="0"&&(r0.attributes.direction==="sendonly"||r0.attributes.direction==="sendrecv")&&r0.attributes.ssrcs.length===0;if(Zv()){if(i0){const o0=this.firefoxSsrcMidMap.get(e0[0].ssrcId);return!(o0||r0.attributes.mid!=="0"&&r0.attributes.mid!=="1")||!(!o0||o0!==r0.attributes.mid)}return!1}return i0&&r0.attributes.mid===n0})}findAvailableRecvMediaIndex(t0){return this.sessionDesc.mediaDescriptions.findIndex(e0=>{const n0=e0.media.mediaType===t0&&e0.media.port!=="0"&&(e0.attributes.direction==="recvonly"||e0.attributes.direction==="sendrecv");return e0.attributes.mid!=="0"&&e0.attributes.mid!=="1"&&n0})}predictReceivingMids(t0){const e0=[];for(let n0=0;n0<t0;n0++)e0.push((this.currentMidIndex+n0+1).toString(10));return e0}restartICE(t0){t0=sA(t0),this._iceParameters=t0,this.sessionDesc.mediaDescriptions.forEach(e0=>{e0.attributes.iceUfrag=t0.iceUfrag,e0.attributes.icePwd=t0.icePwd})}createOrRecycleSendMedia(t0,e0,n0,r0,i0,o0){const s0=this.rtpCapabilities.send,a0=t0===dO.VIDEO?s0.videoCodecs:s0.audioCodecs,c0=t0===dO.VIDEO?s0.videoExtensions:s0.audioExtensions;Zv()&&(i0="".concat(++this.currentMidIndex));let u0={media:{mediaType:t0,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a0.map(d0=>d0.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c0,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e0,ssrcGroups:n0,rtcpFeedbackWildcards:[],payloads:a0,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r0,rtcpMux:!0,rtcpRsize:!0,mid:i0}};u0=this.mungSendMediaDesc(u0,o0);const l0=this.findFirstClosedMedia(t0);if(l0){const d0=this.sessionDesc.mediaDescriptions.indexOf(l0);this.sessionDesc.mediaDescriptions[d0]=u0}else this.sessionDesc.mediaDescriptions.push(u0);return u0}mungRecvMediaDsec(t0,e0,n0){const r0=sA(t0);return XU(r0),JU(r0,e0),QU(r0,e0),ZU(r0),$U(r0,n0,this.localCapabilities.send),r0}mungSendMediaDesc(t0,e0){const n0=sA(t0);return $U(n0,e0,this.localCapabilities.recv),ox(n0),n0}updateRecvMedia(t0,e0){const n0=this.sessionDesc.mediaDescriptions.findIndex(r0=>r0.attributes.mid===t0);if(n0!==-1){const r0=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n0],e0);this.sessionDesc.mediaDescriptions[n0]=r0}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t0=>t0.media.port!=="0").map(t0=>t0.attributes.mid)}findPreloadMediaDesc(t0){return this.sessionDesc.mediaDescriptions.find(e0=>{var n0;return((n0=e0.attributes)===null||n0===void 0||(n0=n0.ssrcs[0])===null||n0===void 0?void 0:n0.ssrcId)===t0[0].ssrcId})}findFirstClosedMedia(t0){return this.sessionDesc.mediaDescriptions.find(e0=>Zv()?e0.media.port==="0"&&e0.media.mediaType===t0:e0.media.port==="0")}};const FV=["sdp"];var BV;function jV(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function GV(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?jV(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):jV(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}let WV=(BV=class a1 extends aO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e0,n0;return(e0=(n0=this.peerConnection.getReceivers()[0])===null||n0===void 0||(n0=n0.transport)===null||n0===void 0?void 0:n0.state)!==null&&e0!==void 0?e0:null}get localCodecs(){return[]}set isInRestartIce(e0){this._isInRestartIce=e0}get isInRestartIce(){return this._isInRestartIce}constructor(e0,n0,r0){super(e0,n0),Fg(this,"direction",void 0),Fg(this,"name",void 0),Fg(this,"store",void 0),Fg(this,"spec",void 0),Fg(this,"peerConnection",void 0),Fg(this,"initialOffer",void 0),Fg(this,"transport",void 0),Fg(this,"statsFilter",void 0),Fg(this,"localCandidateCount",0),Fg(this,"_isInRestartIce",!1),Fg(this,"mutex",new NA("P2PConnection-mutex")),Fg(this,"onLocalCandidate",void 0),Fg(this,"remoteSDP",void 0),Fg(this,"pendingCandidates",[]),Fg(this,"localCapabilities",void 0),Fg(this,"isReady",!1),Fg(this,"restartCnt",0),Fg(this,"curTurnServerIndex",0),this.store=n0,this.spec=e0,this.peerConnection=new RTCPeerConnection(a1.resolvePCConfiguration(e0,n0.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r0??Mw.SEND_ONLY,this.name=this.direction===Mw.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=xV(this.peerConnection,XA("STATS_UPDATE_INTERVAL"),void 0,Zv()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e0){try{const n0=await tx();if(this.localCapabilities=rx(n0),e0){const{sdp:r0}=e0,i0=mV(e0,FV),o0=function(){const l0={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},d0=WU(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),h0={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p0={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},m0={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nx(d0,l0,"videoExtensions",h0,p0,m0),nx(d0,l0,"videoCodecs",h0,p0,m0),nx(d0,l0,"audioExtensions",h0,p0,m0),nx(d0,l0,"audioCodecs",h0,p0,m0),XA("RAISE_H264_BASELINE_PRIORITY")){const f0=m0.videoCodecs.findIndex(g0=>g0.rtpMap&&g0.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&g0.fmtp&&g0.fmtp.parameters["profile-level-id"]==="42001f");if(f0!==-1){const g0=m0.videoCodecs.findIndex(E0=>E0.rtpMap&&E0.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(g0<f0){fb.debug("raising H264 baseline profile priority");const E0=m0.videoCodecs[f0];m0.videoCodecs.splice(f0,1),m0.videoCodecs.splice(g0,0,E0)}g0!==-1&&XA("FILTER_SEND_H264_BASELINE")&&(h0.videoCodecs=h0.videoCodecs.filter(E0=>!(E0.rtpMap&&E0.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&E0.fmtp&&E0.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:h0,recv:p0,sendrecv:m0}}({},{},r0);this.remoteSDP=new VV({remoteIceParameters:i0.iceParameters,remoteDtlsParameters:i0.dtlsParameters,candidates:[],remoteRTPCapabilities:o0,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const s0=await this.peerConnection.createAnswer();if(!s0.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const a0=HU(s0.sdp);await this.peerConnection.setLocalDescription(s0);const c0=await ix({},{},s0.sdp);this.localCapabilities=rx(c0);const u0=this.peerConnection.getTransceivers()[0];return u0!=null&&u0.receiver&&u0.receiver.transport&&this.tryBindTransportEvents(u0.receiver.transport),GV(GV({},a0),{},{sdp:s0.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r0=await this.peerConnection.createOffer();if(!r0.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i0=HU(r0.sdp);return this.initialOffer=r0,GV(GV({},i0),{},{sdp:r0.sdp})}}catch(n0){throw new Cy(Ry.GET_LOCAL_CONNECTION_PARAMS_FAILED,n0.toString())}}async connect(e0){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n0,iceParameters:r0,dtlsParameters:i0}=e0,o0=await ix({},{},n0);this.remoteSDP=new VV({remoteIceParameters:r0,remoteDtlsParameters:i0,candidates:[],remoteRTPCapabilities:o0,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const s0=this.peerConnection.getTransceivers()[0];s0!=null&&s0.sender&&s0.sender.transport&&this.tryBindTransportEvents(s0.sender.transport)}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n0.toString()))}}async addRemoteCandidate(e0){try{e0&&this.pendingCandidates.push(e0),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n0=>{this.peerConnection.addIceCandidate(n0)}),this.pendingCandidates=[])}catch(n0){throw new Cy(Ry.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n0.toString()))}}send(e0,n0,r0){var i0=this;return YI(function*(){const o0=yield qI(i0.mutex.lock("From P2PConnection.send"));try{if(!i0.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s0=[],a0=i0.remoteSDP.receive(e0,n0,r0);e0.forEach((g0,E0)=>{if(a0[E0].needCreateTransceiver){const _0=i0.peerConnection.addTransceiver(g0._mediaStreamTrack,{direction:"sendonly"});s0.push(_0),g0._updateRtpTransceiver(_0)}else{const _0=i0.peerConnection.getTransceivers().find(y0=>y0.mid===a0[E0].mid);if(!_0)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(a0[E0].mid));s0.push(_0),g0._updateRtpTransceiver(_0)}}),Zv()&&XA("SIMULCAST")===!0&&(yield qI(i0.applySimulcastForFirefox(s0,e0)));const c0=a0.map(g0=>g0.mid),u0=yield qI(i0.peerConnection.createOffer()),l0=i0.mungSendOfferSDP(u0.sdp,e0,c0),d0=FU.parse(l0),h0=c0.map(g0=>{const E0=d0.mediaDescriptions.find(_0=>_0.attributes.mid===g0);if(!E0)throw new Error("Cannot extract ssrc from mediaDescription.");return KU(E0,XA("USE_PUB_RTX"))}),p0=s0.map((g0,E0)=>{const _0=c0[E0];return{localSSRC:h0[E0],id:_0}});yield qI(i0.peerConnection.setLocalDescription({type:"offer",sdp:l0}));try{yield p0}catch(g0){const E0=i0.remoteSDP.toString();throw yield qI(i0.peerConnection.setLocalDescription({type:"offer",sdp:l0})),yield qI(i0.peerConnection.setRemoteDescription({type:"answer",sdp:E0})),yield qI(i0.stopSending(c0,!0)),g0}yield qI(i0.applySimulcastEncodings(s0,e0)),yield qI(i0.applySendEncodings(s0,e0));const m0=i0.remoteSDP.toString(),f0=i0.logSDPExchange(l0,"offer","local","send");return f0==null||f0(m0),yield qI(i0.setRemoteDescription({type:"answer",sdp:m0})),s0.map((g0,E0)=>{const _0=c0[E0];return{localSSRC:h0[E0],id:_0}})}catch(s0){throw s0 instanceof Cy?s0:new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s0.toString()))}finally{o0()}})()}async stopSending(e0,n0){const r0=n0?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i0=this.peerConnection.getTransceivers().filter(c0=>e0.indexOf(c0.mid)!==-1);if(i0.length!==e0.length)throw new Error("Transceivers' length (".concat(i0.length,") doesn't match mids' length (").concat(e0.length,") when trying to call P2PConnection.stopSending."));i0.map(c0=>{var u0;c0.direction="inactive",(u0=c0.stop)===null||u0===void 0||u0.call(c0)});const o0=await this.peerConnection.createOffer(),s0=this.logSDPExchange(o0.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o0),this.remoteSDP.stopReceiving(e0);const a0=this.remoteSDP.toString();s0==null||s0(a0),await this.setRemoteDescription({type:"answer",sdp:a0})}catch(i0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i0.toString()))}finally{r0&&r0()}}async receive(e0,n0,r0,i0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e0," before remoteSDP created."));const{mid:o0,needExchangeSDP:s0}=this.remoteSDP.send(e0,n0,r0,i0);if(s0){const c0=this.remoteSDP.toString(),u0=this.logSDPExchange(c0,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c0});const l0=await this.peerConnection.createAnswer(),d0=this.mungReceiveAnswerSDP(l0.sdp,o0,e0);u0==null||u0(d0||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:d0}),fb.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e0," by exchanging SDP."))}else fb.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e0," no need to exchange SDP."));const a0=this.peerConnection.getTransceivers().find(c0=>c0.mid===o0);if(!a0||a0.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a0.receiver.track,mid:a0.mid,transceiver:a0}}catch(o0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o0.toString()))}}async mockReceive(e0,n0,r0,i0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e0," before remoteSDP created."));const{mid:o0,needExchangeSDP:s0}=this.remoteSDP.send(e0,n0,r0,i0);if(s0){const a0=this.remoteSDP.toString(),c0=this.logSDPExchange(a0,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:a0});const u0=await this.peerConnection.createAnswer(),l0=this.mungReceiveAnswerSDP(u0.sdp,o0,e0);c0==null||c0(l0||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:l0}),fb.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e0," by exchanging SDP."))}else fb.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e0," no need to exchange SDP."))}catch(o0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o0.toString()))}}async stopReceiving(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e0);const n0=this.remoteSDP.toString(),r0=this.logSDPExchange(n0,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n0});const i0=await this.peerConnection.createAnswer();r0==null||r0(i0.sdp||""),await this.peerConnection.setLocalDescription(i0)}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n0.toString()))}}async restartICE(e0){try{if(this.store.p2pTransport===HA.Auto&&(this.store.p2pTransport=HA.SdRtn,ZP().supportPCSetConfiguration&&this.peerConnection.setConfiguration(a1.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,ZP().supportPCSetConfiguration&&this.peerConnection.setConfiguration(a1.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e0){this.restartCnt++,this.isReady=!1;const n0=await this.peerConnection.createOffer({iceRestart:!0});if(!n0.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r0}=HU(n0.sdp);return this.store.descriptionStart(),this.direction===Mw.SEND_ONLY&&await this.peerConnection.setLocalDescription(n0),r0}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e0),this.store.descriptionStart(),this.direction===Mw.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n0=await this.peerConnection.createAnswer();if(!n0.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r0}=HU(n0.sdp);return await this.peerConnection.setLocalDescription(n0),r0}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n0.toString()))}}close(){var e0;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e0=this.onConnectionStateChange)===null||e0===void 0||e0.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e0){return this.statsFilter.getVideoIsReady(e0)}async updateEncoderConfig(e0,n0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r0=await this.peerConnection.createOffer(),i0=this.mungSendOfferSDP(r0.sdp,[n0],[e0]);this.remoteSDP.updateRecvMedia(e0,n0);const o0=this.remoteSDP.toString(),s0=this.logSDPExchange(i0,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i0}),s0==null||s0(o0),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o0})}catch(r0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,r0.toString())}}async updateSendParameters(e0,n0){const r0=this.peerConnection.getTransceivers().filter(i0=>i0.mid===e0);r0.length===1&&(this.isVP8Simulcast(n0)?Zv()||await this.applySimulcastEncodings(r0,[n0]):await this.applySendEncodings(r0,[n0]))}setStatsRemoteVideoIsReady(e0,n0){this.statsFilter.setVideoIsReady2(e0,n0)}async replaceTrack(e0,n0){const r0=this.peerConnection.getTransceivers().find(i0=>i0.mid===n0);r0&&await r0.sender.replaceTrack(e0._mediaStreamTrack)}async getSelectedCandidatePair(){const e0=this.peerConnection.getReceivers();if(e0.length>0&&e0[0].transport&&e0[0].transport.iceTransport&&e0[0].transport.iceTransport.getSelectedCandidatePair&&e0[0].transport.iceTransport.getSelectedCandidatePair()){const n0=e0[0].transport.iceTransport,{local:r0,remote:i0}=n0.getSelectedCandidatePair();return{local:GV(GV({},RV),{},{candidateType:r0.type,protocol:r0.protocol,address:r0.address,port:r0.port}),remote:GV(GV({},RV),{},{candidateType:i0.type,protocol:i0.protocol,address:i0.address,port:i0.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e0,n0;Dn(e0=["connected","completed"]).call(e0,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n0=this.onICEConnectionStateChange)===null||n0===void 0||n0.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e0;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e0=this.onConnectionStateChange)===null||e0===void 0||e0.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e0=>{if(e0.candidate){var n0;e0.candidate.candidate&&((n0=this.onLocalCandidate)===null||n0===void 0||n0.call(this,e0.candidate.toJSON())),this.localCandidateCount+=1}else fb.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e0,n0){let r0=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i0={iceServers:[]};var o0;return e0.iceServers?i0.iceServers=e0.iceServers:e0.turnServer&&e0.turnServer.mode!=="off"&&(Ky(e0.turnServer.servers)?i0.iceServers=e0.turnServer.servers:(i0.iceServers&&i0.iceServers.push(...a1.turnServerConfigToIceServers(e0.turnServer.servers,n0,r0)),XA("USE_TURN_SERVER_OF_GATEWAY")&&i0.iceServers&&e0.turnServer.serversFromGateway&&i0.iceServers.push(...a1.turnServerConfigToIceServers(e0.turnServer.serversFromGateway,n0,r0)),Dn(o0=[HA.Relay,HA.SdRtn]).call(o0,n0)&&(i0.iceTransportPolicy="relay"),XA("FORCE_TURN_TCP")?i0.iceTransportPolicy="relay":e0.turnServer.servers.concat(e0.turnServer.serversFromGateway||[]).forEach(s0=>{s0.forceturn&&(i0.iceTransportPolicy="relay")}))),XA("ENABLE_ENCODED_TRANSFORM")&&ZP().supportWebRTCEncodedTransform&&(i0.encodedInsertableStreams=!0),fb.debug("P2PConnection p2pTransport is ".concat(n0)),i0}static turnServerConfigToIceServers(e0,n0){let r0=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i0=[],o0=e0.filter(a0=>a0.tcpport);fb.debug("P2PConnection turnServers is ".concat(o0,", current index is ").concat(r0));const s0=o0.length>r0?o0[r0]:o0[0];switch(n0){case HA.SdRtn:const a0=e0.filter(u0=>{var l0;return Dn(l0=u0.username).call(l0,"glb:")&&u0.turnServerURL==u0.turnServerURL}),c0=a0.length>r0?a0[r0]:a0[0];c0&&(i0.push({username:c0.username,credential:c0.password,credentialType:"password",urls:"turn:".concat(JO(c0.turnServerURL),":").concat(c0.tcpport,"?transport=udp")}),i0.push({username:c0.username,credential:c0.password,credentialType:"password",urls:"turns:".concat(JO(c0.turnServerURL),":").concat(c0.tcpport,"?transport=tcp")}));break;case HA.Relay:s0&&(i0.push({username:s0.username,credential:s0.password,credentialType:"password",urls:"turn:".concat(s0.turnServerURL,":").concat(s0.tcpport,"?transport=udp")}),i0.push({username:s0.username,credential:s0.password,credentialType:"password",urls:"turns:".concat(JO(s0.turnServerURL),":").concat(s0.tcpport,"?transport=tcp")}));break;default:s0&&(i0.push({username:s0.username,credential:s0.password,credentialType:"password",urls:"turn:".concat(s0.turnServerURL,":").concat(s0.tcpport,"?transport=udp")}),i0.push({username:s0.username,credential:s0.password,credentialType:"password",urls:"turns:".concat(JO(s0.turnServerURL),":").concat(s0.tcpport,"?transport=tcp")}),i0.push({username:s0.username,credential:s0.password,credentialType:"password",urls:"stun:".concat(s0.turnServerURL,":").concat(s0.tcpport)}))}return i0}tryBindTransportEvents(e0){if(e0){this.transport=e0,e0.onstatechange=()=>{var r0;e0!=null&&e0.state&&((r0=this.onDTLSTransportStateChange)===null||r0===void 0||r0.call(this,e0.state))},e0.onerror=r0=>{var i0;(i0=this.onDTLSTransportError)===null||i0===void 0||i0.call(this,"error"in r0?r0.error:r0)};const n0=e0.iceTransport;n0&&(n0.onstatechange=()=>{const r0=e0==null?void 0:e0.iceTransport.state;var i0;r0&&((i0=this.onICETransportStateChange)===null||i0===void 0||i0.call(this,r0))},n0.getSelectedCandidatePair&&(n0.onselectedcandidatepairchange=()=>{if(n0.getSelectedCandidatePair()){const{local:r0,remote:i0}=n0.getSelectedCandidatePair();fb.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r0.type,protocol:r0.protocol}),", remote ").concat(JSON.stringify({candidateType:i0.type,protocol:i0.protocol,address:i0.address,port:i0.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e0,n0){var r0;if(n0||(n0=this.peerConnection.getSenders().find(l0=>l0.track===e0._mediaStreamTrack)),!n0)return fb.warn("[".concat(e0.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e0))return fb.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ZP().supportSetRtpSenderParameters)return fb.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i0={},o0={};switch(e0._optimizationMode){case"motion":i0.degradationPreference="maintain-framerate";break;case"detail":i0.degradationPreference="maintain-resolution";break;default:i0.degradationPreference="balanced"}if(e0._encoderConfig){var s0;const{bitrateMax:l0,frameRate:d0,scaleResolutionDownBy:h0}=e0._encoderConfig;l0&&(o0.maxBitrate=1e3*l0),Dn(s0=e0._hints).call(s0,mL.LOW_STREAM)&&(d0&&(o0.maxFramerate=QO(d0)),h0&&h0>=1&&(o0.scaleResolutionDownBy=h0))}if(XA("DSCP_TYPE")&&Ey()){var a0;const l0=XA("DSCP_TYPE");Dn(a0=["very-low","low","medium","high"]).call(a0,l0)&&(o0.networkPriority=l0)}const c0=n0.getParameters(),u0=(r0=c0.encodings)===null||r0===void 0?void 0:r0[0];Zv()&&!u0&&(i0.encodings=[o0]),u0&&Object.assign(u0,o0),Object.assign(c0,i0),fb.debug("[".concat(e0.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c0.encodings))),await n0.setParameters(c0)}async applySendEncodings(e0,n0){try{if(!ZP().supportSetRtpSenderParameters||e0.length!==n0.length)return;for(let r0=0;r0<e0.length;r0++){const i0=e0[r0],o0=n0[r0];o0 instanceof aU&&!this.isVP8Simulcast(o0)&&await this.updateRtpSenderEncodings(o0,i0.sender)}}catch{fb.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e0,n0,r0){const i0=FU.parse(e0);return n0.forEach((o0,s0)=>{const a0=r0[s0],c0=i0.mediaDescriptions.find(u0=>u0.attributes.mid===a0);c0&&(JU(c0,o0),ex(c0,o0,this.store.codec))}),FU.print(i0)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e0=>{var n0;(n0=this.onFirstAudioReceived)===null||n0===void 0||n0.call(this,e0)},this.statsFilter.onFirstVideoReceived=e0=>{var n0;(n0=this.onFirstVideoReceived)===null||n0===void 0||n0.call(this,e0)},this.statsFilter.onFirstAudioDecoded=e0=>{var n0;(n0=this.onFirstAudioDecoded)===null||n0===void 0||n0.call(this,e0)},this.statsFilter.onFirstVideoDecoded=(e0,n0,r0)=>{var i0;(i0=this.onFirstVideoDecoded)===null||i0===void 0||i0.call(this,e0,n0,r0)},this.statsFilter.onSelectedLocalCandidateChanged=(e0,n0)=>{var r0;(r0=this.onSelectedLocalCandidateChanged)===null||r0===void 0||r0.call(this,e0,n0)},this.statsFilter.onSelectedRemoteCandidateChanged=(e0,n0)=>{var r0;(r0=this.onSelectedRemoteCandidateChanged)===null||r0===void 0||r0.call(this,e0,n0)},this.statsFilter.onFirstVideoDecodedTimeout=e0=>{var n0;(n0=this.onFirstVideoDecodedTimeout)===null||n0===void 0||n0.call(this,e0)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e0,n0){if(e0.length===n0.length)for(let c0=0;c0<e0.length;c0++){var r0,i0,o0,s0,a0;const u0=e0[c0],l0=n0[c0];if(l0 instanceof aU&&!Dn(r0=l0._hints).call(r0,mL.LOW_STREAM)&&(i0=l0._encoderConfig)!==null&&i0!==void 0&&i0.bitrateMax&&((o0=l0._encoderConfig)===null||o0===void 0?void 0:o0.bitrateMax)>200&&(s0=l0._scalabilityMode)!==null&&s0!==void 0&&s0.numSpatialLayers&&((a0=l0._scalabilityMode)===null||a0===void 0?void 0:a0.numSpatialLayers)>1&&this.store.codec==="vp8"){const d0={},h0={high:1e3*(l0._encoderConfig.bitrateMax-50),medium:5e4};d0.encodings=[{rid:"m",active:!0,maxBitrate:h0.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h0.high}];const p0=u0.sender.getParameters();await u0.sender.setParameters(Object.assign(p0,d0))}}}async applySimulcastEncodings(e0,n0){if(!Zv()&&e0.length===n0.length)for(let r0=0;r0<e0.length;r0++){const i0=n0[r0];if(i0 instanceof aU&&this.isVP8Simulcast(i0)){const o0=e0[r0],s0={},a0={high:1e3*(i0._encoderConfig.bitrateMax-50),medium:5e4};s0.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a0.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a0.medium,scaleResolutionDownBy:4}];const c0=o0.sender.getParameters();await o0.sender.setParameters(Object.assign(c0,s0))}}}isVP8Simulcast(e0){var n0,r0,i0,o0,s0;return!!(e0 instanceof aU&&XA("SIMULCAST")&&this.store.codec==="vp8"&&!Dn(n0=e0._hints).call(n0,mL.LOW_STREAM)&&(r0=e0._encoderConfig)!==null&&r0!==void 0&&r0.bitrateMax&&((i0=e0._encoderConfig)===null||i0===void 0?void 0:i0.bitrateMax)>200&&(o0=e0._scalabilityMode)!==null&&o0!==void 0&&o0.numSpatialLayers&&((s0=e0._scalabilityMode)===null||s0===void 0?void 0:s0.numSpatialLayers)>1)}logSDPExchange(e0,n0,r0,i0){if(XA("SDP_LOGGING"))return fb.upload("[".concat(this.store.clientId,"] exchanging ").concat(r0," ").concat(n0," SDP during P2PConnection.").concat(i0,`
`),e0),n0==="offer"?o0=>{this.logSDPExchange(o0,"answer",r0==="local"?"remote":"local",i0)}:void 0}async muteLocal(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n0=this.peerConnection.getTransceivers().filter(s0=>s0.mid&&e0.indexOf(s0.mid)!==-1);if(n0.length!==e0.length)throw new Error("Transceivers' length doesn't match mids' length.");n0.map(s0=>{s0.direction="inactive"});const r0=await this.peerConnection.createOffer(),i0=this.logSDPExchange(r0.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r0),this.remoteSDP.muteRemote(e0);const o0=this.remoteSDP.toString();i0==null||i0(o0),await this.setRemoteDescription({type:"answer",sdp:o0})}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n0.toString()))}}async unmuteLocal(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n0=this.peerConnection.getTransceivers().filter(s0=>s0.mid&&e0.indexOf(s0.mid)!==-1);if(n0.length!==e0.length)throw new Error("Transceivers' length doesn't match mids' length.");n0.map(async s0=>{s0.direction="sendonly"});const r0=await this.peerConnection.createOffer(),i0=this.logSDPExchange(r0.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r0),this.remoteSDP.unmuteRemote(e0);const o0=this.remoteSDP.toString();i0==null||i0(o0),await this.setRemoteDescription({type:"answer",sdp:o0})}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n0.toString()))}}async getRemoteSSRC(e0,n0){var r0,i0;if(n0=(r0=n0)!==null&&r0!==void 0?r0:(i0=this.currentRemoteDescription)===null||i0===void 0?void 0:i0.sdp){var o0;const s0=(o0=FU.parse(n0).mediaDescriptions.find(a0=>a0.attributes.mid===e0))===null||o0===void 0?void 0:o0.attributes.ssrcs;return s0==null?void 0:s0[0].ssrcId}}async setRemoteDescription(e0){var n0;await this.peerConnection.setRemoteDescription(e0),Dn(n0=["connected","completed"]).call(n0,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e0,n0,r0){const i0=FU.parse(e0),o0=i0.mediaDescriptions.find(s0=>s0.attributes.mid===n0);return o0&&r0===dO.AUDIO&&o0.media.mediaType==="audio"&&ox(o0),FU.print(i0)}},Cw(BV.prototype,"establish",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"establish"),BV.prototype),Cw(BV.prototype,"connect",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"connect"),BV.prototype),Cw(BV.prototype,"receive",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"receive"),BV.prototype),Cw(BV.prototype,"mockReceive",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"mockReceive"),BV.prototype),Cw(BV.prototype,"stopReceiving",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"stopReceiving"),BV.prototype),Cw(BV.prototype,"restartICE",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"restartICE"),BV.prototype),Cw(BV.prototype,"close",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"close"),BV.prototype),Cw(BV.prototype,"updateEncoderConfig",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"updateEncoderConfig"),BV.prototype),Cw(BV.prototype,"updateSendParameters",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"updateSendParameters"),BV.prototype),Cw(BV.prototype,"replaceTrack",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"replaceTrack"),BV.prototype),Cw(BV.prototype,"muteLocal",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"muteLocal"),BV.prototype),Cw(BV.prototype,"unmuteLocal",[HV],Object.getOwnPropertyDescriptor(BV.prototype,"unmuteLocal"),BV.prototype),BV);function HV(t0,e0,n0){const r0=t0[e0];if(typeof r0!="function")throw new Error("Cannot use mutex on object property.");return n0.value=async function(){const i0=this.mutex,o0=await i0.lock("From P2PConnection.".concat(e0));try{for(var s0=arguments.length,a0=new Array(s0),c0=0;c0<s0;c0++)a0[c0]=arguments[c0];return await r0.apply(this,a0)}finally{o0()}},n0}function KV(t0,e0){let n0=document.createElement("video"),r0=document.createElement("canvas");n0.setAttribute("style","display:none"),r0.setAttribute("style","display:none"),n0.setAttribute("muted",""),n0.muted=!0,n0.setAttribute("autoplay",""),n0.autoplay=!0,n0.setAttribute("playsinline",""),r0.width=QO(e0.width),r0.height=QO(e0.height);const i0=QO(e0.framerate||15);document.body.append(n0),document.body.append(r0);let o0=t0._mediaStreamTrack;n0.srcObject=new MediaStream([o0]),n0.play();const s0=r0.getContext("2d");if(!s0)throw new yb(Ry.UNEXPECTED_ERROR,"can not get canvas context");const a0=ZP(),c0=r0.captureStream(a0.supportRequestFrame?0:i0).getVideoTracks()[0];c0.canvas||(c0.canvas=r0),r0.startCapture=()=>{if(!n0)return r0.stopCapture&&r0.stopCapture();if(n0.paused&&n0.play(),n0.videoHeight>2&&n0.videoWidth>2){const l0=n0.videoWidth,d0=n0.videoHeight/l0,h0=r0.width*d0;Math.abs(h0-r0.height)>=2&&(fb.debug("adjust low stream resolution","".concat(r0.width,"x").concat(r0.height," -> ").concat(r0.width,"x").concat(h0)),r0.height=h0)}s0.drawImage(n0,0,0,r0.width,r0.height),c0.requestFrame&&c0.requestFrame(),o0!==t0._mediaStreamTrack&&(o0=t0._mediaStreamTrack,n0.srcObject=new MediaStream([o0]))},r0.stopCapture=QL(()=>r0.startCapture&&r0.startCapture(),i0);const u0=c0.stop;return c0.stop=()=>{u0.call(c0),n0&&(n0.remove(),n0.srcObject=null,n0=null),r0&&(r0.width=0,r0.remove(),r0.stopCapture&&r0.stopCapture(),r0.startCapture=void 0,r0.stopCapture=void 0,r0=null),fb.debug("clean low stream renderer")},c0}var YV=function(t0){return t0[t0.HEIGHT=2033]="HEIGHT",t0[t0.FRAME_RATE=2034]="FRAME_RATE",t0[t0.WIDTH=2035]="WIDTH",t0}(YV||{}),qV=function(t0){return t0[t0.FRAME_RATE=2002]="FRAME_RATE",t0[t0.WIDTH=2003]="WIDTH",t0[t0.HEIGHT=2004]="HEIGHT",t0[t0.PACKAGE_LOST=2005]="PACKAGE_LOST",t0[t0.AVG_ENCODE=2007]="AVG_ENCODE",t0[t0.NACKS=2009]="NACKS",t0[t0.PLIS=2010]="PLIS",t0[t0.FIRS=2011]="FIRS",t0[t0.BITRATE=2012]="BITRATE",t0[t0.PACKAGE_RATE=2031]="PACKAGE_RATE",t0[t0.ADAPTATION=2032]="ADAPTATION",t0[t0.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t0[t0.BANDWIDTH=2061]="BANDWIDTH",t0[t0.RETRANSMIT=2062]="RETRANSMIT",t0[t0.TARGET_ENCODED=2064]="TARGET_ENCODED",t0[t0.TRANSMIT=2066]="TRANSMIT",t0[t0.FREEZE=2082]="FREEZE",t0[t0.DISABLED=2095]="DISABLED",t0[t0.PLAYER_STATUS=2128]="PLAYER_STATUS",t0[t0.QP_SUM=2143]="QP_SUM",t0}(qV||{}),zV=function(t0){return t0[t0.BITRATE=2069]="BITRATE",t0[t0.PACKAGE_LOST=2070]="PACKAGE_LOST",t0[t0.PACKAGE_RATE=2071]="PACKAGE_RATE",t0[t0.HEIGHT=2073]="HEIGHT",t0[t0.FRAME_RATE=2075]="FRAME_RATE",t0[t0.WIDTH=2077]="WIDTH",t0}(zV||{}),JV=function(t0){return t0[t0.JITTER=-1]="JITTER",t0[t0.PACKAGE_LOST=2014]="PACKAGE_LOST",t0[t0.WIDTH=2018]="WIDTH",t0[t0.HEIGHT=2019]="HEIGHT",t0[t0.FRAME_RATE=2020]="FRAME_RATE",t0[t0.JITTER_BUFFER=2023]="JITTER_BUFFER",t0[t0.CURRENT_DELAY=2024]="CURRENT_DELAY",t0[t0.NACKS=2026]="NACKS",t0[t0.PLIS=2027]="PLIS",t0[t0.FIRS=2028]="FIRS",t0[t0.BITRATE=2029]="BITRATE",t0[t0.PACKAGE_RATE=2078]="PACKAGE_RATE",t0[t0.FREEZE=2084]="FREEZE",t0[t0.DISABLED=2101]="DISABLED",t0[t0.PLAYER_STATUS=2129]="PLAYER_STATUS",t0[t0.QP_SUM=2144]="QP_SUM",t0[t0.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t0}(JV||{}),XV=function(t0){return t0[t0.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t0[t0.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t0[t0.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t0[t0.FREEZE_TIME=2109]="FREEZE_TIME",t0[t0.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t0[t0.FREEZE_DURATION=2156]="FREEZE_DURATION",t0}(XV||{}),QV=function(t0){return t0[t0.PCM_LEVEL=2104]="PCM_LEVEL",t0}(QV||{}),ZV=function(t0){return t0[t0.PACKAGE_LOST=-1]="PACKAGE_LOST",t0[t0.LEVEL=2038]="LEVEL",t0[t0.BITRATE=2039]="BITRATE",t0[t0.PACKAGE_RATE=2040]="PACKAGE_RATE",t0[t0.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t0[t0.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t0[t0.FREEZE=2081]="FREEZE",t0[t0.DISABLED=2096]="DISABLED",t0}(ZV||{}),$V=function(t0){return t0[t0.BITRATE=2044]="BITRATE",t0[t0.PACKAGE_LOST=2045]="PACKAGE_LOST",t0[t0.PACKAGE_RATE=2046]="PACKAGE_RATE",t0[t0.CURRENT_DELAY=2047]="CURRENT_DELAY",t0[t0.JITTER_BUFFER=2054]="JITTER_BUFFER",t0[t0.JITTER=2055]="JITTER",t0[t0.FREEZE=2083]="FREEZE",t0[t0.DISABLED=2102]="DISABLED",t0[t0.PCM_LEVEL=2105]="PCM_LEVEL",t0[t0.PLAYER_STATUS=2130]="PLAYER_STATUS",t0[t0.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t0}($V||{}),eF=function(t0){return t0[t0.FREEZE_TIME=-1]="FREEZE_TIME",t0[t0.LEVEL=2043]="LEVEL",t0}(eF||{}),tF=function(t0){return t0[t0.RTT=2006]="RTT",t0[t0.CONN_TYPE=801]="CONN_TYPE",t0}(tF||{});const iF=1e3,nF=3;function rF(t0,e0,n0){n0!=null&&Number.isFinite(n0)&&(t0[e0]=Math.round(Math.max(0,n0)))}function oF(t0){const e0={[tF.CONN_TYPE]:0,[tF.RTT]:t0.rtt};switch(t0.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n0=t0.selectedCandidatePair.localCandidate.relayProtocol;n0==="udp"&&(e0[tF.CONN_TYPE]=1),n0==="tcp"&&(e0[tF.CONN_TYPE]=3),n0==="tls"&&(e0[tF.CONN_TYPE]=4);break}case"srflx":e0[tF.CONN_TYPE]=2}return e0}function sF(t0){let e0=0;switch(t0){case"none":e0=0;break;case"cpu":e0=1;break;case"bandwidth":e0=2;break;case"other":e0=3}return e0}class aF extends xy{constructor(e0){super(),Fg(this,"store",void 0),Fg(this,"uploadWRTCStatsTimer",void 0),Fg(this,"uploadOutboundDenoiserStatsTimer",void 0),Fg(this,"uploadExtStatsTimer",void 0),Fg(this,"uploadExtUsageStatsTimer",void 0),Fg(this,"uploadInboundExtStatsTimer",void 0),Fg(this,"requestStats",void 0),Fg(this,"requestTransportStats",void 0),Fg(this,"requestLocalMedia",void 0),Fg(this,"requestRemoteMedia",void 0),Fg(this,"requestAllTracks",void 0),Fg(this,"requestVideoIsReady",void 0),Fg(this,"requestUploadStats",void 0),Fg(this,"requestUpload",void 0),Fg(this,"uploadOutboundStarted",!1),Fg(this,"uploadInboundStarted",!1),Fg(this,"uploadTransportStarted",!1),Fg(this,"uploadExtensionUsageStarted",!1),Fg(this,"lastRecvStats",void 0),Fg(this,"lastSendStats",void 0),Fg(this,"lastFullRecvStats",void 0),Fg(this,"lastFullSendStats",void 0),Fg(this,"needUploadRenderFreezeTime",!0),this.store=e0}uploadWRTCStats(e0){if(!this.requestStats||!this.requestUploadStats)return;let n0,r0;if(this.uploadTransportStarted&&(n0=this.requestStats(),this.store.useP2P&&(r0=this.requestStats(!0))),!n0&&this.uploadOutboundStarted&&(n0=this.requestStats()),!r0&&this.uploadInboundStarted&&(r0=this.requestStats(!0)),n0||r0){const i0={};if(this.uploadTransportStarted&&n0){const o0=this.getTransportStats(n0,r0,e0);o0&&(i0.misc=[o0])}if(this.uploadOutboundStarted&&n0){const o0=this.getOutboundStats(n0,e0?this.lastSendStats:this.lastFullSendStats,e0);o0&&(i0.outbound=[o0])}if(this.uploadInboundStarted&&r0){const o0=this.getInboundStats(r0,e0?this.lastRecvStats:this.lastFullRecvStats,e0);o0&&(i0.inbound=o0)}this.requestUploadStats(i0)}this.lastRecvStats=r0,this.lastSendStats=n0,e0||(this.lastFullRecvStats=r0,this.lastFullSendStats=n0)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e0=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e0!==nF),++e0===nF+1&&(e0=1)},iF)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e0,n0,r0){if(!this.requestStats)return;if(r0)return e0.rtt==null?void 0:{addition:{[tF.RTT]:e0.rtt,[tF.CONN_TYPE]:void 0}};const i0=oF(e0);if(this.store.useP2P){if(n0){const o0=oF(n0);i0[tF.CONN_TYPE]+=o0[tF.CONN_TYPE]<<3}i0[tF.CONN_TYPE]+=110}else i0[tF.CONN_TYPE]+=100;return{addition:i0}}getOutboundStats(e0,n0,r0){if(!this.requestUploadStats||!this.requestLocalMedia)return;const i0=this.requestLocalMedia();if(!i0||i0.length===0)return;let o0,s0,a0;return i0.forEach(c0=>{let[u0,{track:l0,ssrcs:d0}]=c0;switch(u0){case hO.LocalVideoLowTrack:case hO.LocalVideoTrack:if(u0===hO.LocalVideoTrack){const h0=function(f0,g0,E0,_0,y0){const b0=g0.videoSend.find(C0=>C0.ssrc===f0);if(!b0)return;const S0={},{sentFrame:w0,inputFrame:I0}=b0;if(I0&&w0){const C0=I0.frameRate,U0=w0.frameRate;S0[qV.FREEZE]=function(x0,j0){let k0=!0;return k0=!(x0<=5)&&(x0<=10?j0<3:x0<=20?j0<4:j0<5),k0}(C0,U0)?1:0}if(rF(S0,qV.QP_SUM,b0.qpSumPerFrame),y0)return S0;switch(w0&&(rF(S0,qV.HEIGHT,w0.height),rF(S0,qV.WIDTH,w0.width),rF(S0,qV.FRAME_RATE,w0.frameRate)),S0[qV.DISABLED]=_0._originMediaStreamTrack&&!_0._originMediaStreamTrack.enabled||_0._mediaStreamTrack&&!_0._mediaStreamTrack.enabled?1:0,b0.adaptionChangeReason){case"none":S0[qV.ADAPTATION]=0;break;case"cpu":S0[qV.ADAPTATION]=1;break;case"bandwidth":S0[qV.ADAPTATION]=2;break;case"other":S0[qV.ADAPTATION]=3}let L0=0;b0.adaptionChangeReason&&(L0+=sF(b0.adaptionChangeReason)),g0.qualityLimitationReason&&(L0+=sF(g0.qualityLimitationReason)<<3),S0[qV.ADAPTATION]=L0,S0[qV.PLAYER_STATUS]=xL[_0._player?_0._player.videoElementStatus:"uninit"],rF(S0,qV.NACKS,b0.nacksCount),rF(S0,qV.PLIS,b0.plisCount),rF(S0,qV.FIRS,b0.firsCount),rF(S0,qV.AVG_ENCODE,b0.avgEncodeMs);const M0=E0&&E0.videoSend.find(C0=>C0.ssrc===f0);if(M0){let C0=y0?iF:iF*nF;M0.timestamp&&b0.timestamp&&(C0=b0.timestamp-M0.timestamp),M0.packets!=null&&b0.packets!=null&&rF(S0,qV.PACKAGE_RATE,1e3*(b0.packets-M0.packets)/C0),b0.packetsLost!=null&&M0.packetsLost!=null&&rF(S0,qV.PACKAGE_LOST,b0.packetsLost-M0.packetsLost),M0.bytes!=null&&b0.bytes!=null&&rF(S0,qV.BITRATE,8*(b0.bytes-M0.bytes)/C0)}return S0}(d0[0].ssrcId,e0,n0,l0,r0),p0=r0?null:function(f0,g0,E0){const _0=g0.videoSend.find(L0=>L0.ssrc===f0);if(!_0)return null;const y0={},b0=_0.inputFrame,S0=b0&&b0.height||E0&&E0.videoHeight||0,w0=b0&&b0.width||E0&&E0.videoWidth||0,I0=b0&&b0.frameRate||0;return rF(y0,YV.HEIGHT,S0),rF(y0,YV.WIDTH,w0),rF(y0,YV.FRAME_RATE,I0),y0}(d0[0].ssrcId,e0,l0),m0=r0?null:function(f0){const g0={};return rF(g0,qV.RETRANSMIT,f0.bitrate.retransmit),rF(g0,qV.TARGET_ENCODED,f0.bitrate.targetEncoded),rF(g0,qV.ACTUAL_ENCODED,f0.bitrate.actualEncoded),rF(g0,qV.TRANSMIT,f0.bitrate.transmit),rF(g0,qV.BANDWIDTH,f0.sendBandwidth),g0}(e0);s0=Object.assign({},h0,p0,m0)}else a0=r0?void 0:function(h0,p0,m0){const f0=p0.videoSend.find(_0=>_0.ssrc===h0);if(!f0)return;const g0={},E0=f0.sentFrame;if(E0&&(rF(g0,zV.HEIGHT,E0.height),rF(g0,zV.WIDTH,E0.width),rF(g0,zV.FRAME_RATE,E0.frameRate)),m0){const _0=m0.videoSend.find(y0=>y0.ssrc===h0);if(_0){let y0=iF*nF;_0.timestamp&&f0.timestamp&&(y0=f0.timestamp-_0.timestamp),_0.packets!=null&&f0.packets!=null&&rF(g0,zV.PACKAGE_RATE,1e3*(f0.packets-_0.packets)/y0),f0.packetsLost!=null&&_0.packetsLost!=null&&rF(g0,zV.PACKAGE_LOST,f0.packetsLost-_0.packetsLost),_0.bytes!=null&&f0.bytes!=null&&rF(g0,zV.BITRATE,8*(f0.bytes-_0.bytes)/y0)}}return g0}(d0[0].ssrcId,e0,n0);break;case hO.LocalAudioTrack:o0=r0?void 0:function(h0,p0,m0,f0){const g0=p0.audioSend.find(S0=>S0.ssrc===h0);if(!g0)return;const E0={};E0[ZV.DISABLED]=f0._originMediaStreamTrack&&!f0._originMediaStreamTrack.enabled||f0._mediaStreamTrack&&!f0._mediaStreamTrack.enabled?1:0;const _0=100*f0._source.getAccurateVolumeLevel(),y0=g0.inputLevel;if(y0!=null){const S0=Math.ceil(50*Math.log10(100*y0+1));rF(E0,ZV.LEVEL,S0)}else rF(E0,ZV.LEVEL,_0);rF(E0,QV.PCM_LEVEL,_0),rF(E0,ZV.AEC_RETURN_LOSS,g0.aecReturnLoss),rF(E0,ZV.AEC_RETURN_LOSS_ENH,g0.aecReturnLossEnhancement),E0[ZV.FREEZE]=0;const b0=m0&&m0.audioSend.find(S0=>S0.ssrc===h0);if(b0){let S0=iF*nF;b0.timestamp&&g0.timestamp&&(S0=g0.timestamp-b0.timestamp),b0.bytes!=null&&g0.bytes!=null&&rF(E0,ZV.BITRATE,8*(g0.bytes-b0.bytes)/S0),b0.packets!=null&&g0.packets!=null&&rF(E0,ZV.PACKAGE_RATE,1e3*(g0.packets-b0.packets)/S0)}return E0}(d0[0].ssrcId,e0,n0,l0)}}),{high:s0,low:a0,audio:o0}}getInboundStats(e0,n0,r0){if(!this.requestRemoteMedia)return;const i0=this.requestRemoteMedia()||[],o0=[];return i0.forEach(s0=>{let[a0,c0]=s0;const u0={peer:a0.uid};if(c0.has(dO.VIDEO)&&a0.videoTrack){const l0=a0._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a0._videoSSRC)||!1,d0=a0.videoTrack?function(h0,p0,m0,f0,g0,E0,_0){var y0;const b0=p0.videoRecv.find(U0=>U0.ssrc===h0);if(!b0)return;const S0={},{receivedFrame:w0,outputFrame:I0,decodeFrameRate:L0}=b0,M0=m0&&m0.videoRecv.find(U0=>U0.ssrc===h0);if(S0[JV.FREEZE]=g0&&DF.isRemoteVideoFreeze(f0,b0,M0)?1:0,rF(S0,XV.FRAME_RATE_DECODE,L0),rF(S0,JV.QP_SUM,b0.qpSumPerFrame),b0.framesRateFirefox&&rF(S0,JV.FRAME_RATE,b0.framesRateFirefox),w0&&rF(S0,JV.FRAME_RATE,w0.frameRate),M0){const U0=p0.timestamp-m0.timestamp||(_0?iF:nF*iF);b0.packetsLost!=null&&M0.packetsLost!=null&&rF(S0,JV.PACKAGE_LOST,b0.packetsLost-M0.packetsLost),M0.bytes!=null&&b0.bytes!=null&&rF(S0,JV.BITRATE,8*(b0.bytes-M0.bytes)/U0),M0.packets!=null&&b0.packets!=null&&rF(S0,JV.PACKAGE_RATE,1e3*(b0.packets-M0.packets)/U0)}if(_0)return S0;w0?(rF(S0,JV.HEIGHT,w0.height),rF(S0,JV.WIDTH,w0.width)):f0&&(rF(S0,JV.HEIGHT,f0._videoHeight||0),rF(S0,JV.WIDTH,f0._videoWidth||0)),I0&&rF(S0,XV.FRAME_RATE_OUTPUT,I0.frameRate);const C0=(y0=f0._player)===null||y0===void 0?void 0:y0.rendFrameRate.toFixed(0);if(C0&&rF(S0,XV.FRAME_RATE_RENDER,+C0),rF(S0,JV.JITTER_BUFFER,b0.jitterBufferMs),rF(S0,JV.CURRENT_DELAY,b0.currentDelayMs),rF(S0,JV.FIRS,b0.firsCount),rF(S0,JV.NACKS,b0.nacksCount),rF(S0,JV.PLIS,b0.plisCount),f0){S0[JV.DISABLED]=f0._originMediaStreamTrack.enabled&&f0._mediaStreamTrack.enabled?0:1;const U0=f0._player;if(U0){const{freezeTimeCounterList:x0,renderFreezeAccTime:j0,videoElementStatus:k0}=U0;if(x0&&x0.length>0&&rF(S0,XV.FREEZE_TIME,x0.splice(0,1)[0]),E0&&yU.visibility==="visible"&&k0===ML.PLAYING&&ZP().supportRequestVideoFrameCallback){const D0=Math.min(6e3,j0);U0.renderFreezeAccTime=Math.max(0,j0-D0),rF(S0,XV.FREEZE_TIME_RENDER,D0)}if(typeof b0.totalFreezesDuration=="number"){const D0=M0&&M0.totalFreezesDuration?b0.totalFreezesDuration-M0.totalFreezesDuration:b0.totalFreezesDuration;rF(S0,XV.FREEZE_DURATION,1e3*D0)}}}if(S0[JV.PLAYER_STATUS]=xL[f0._player?f0._player.videoElementStatus:"uninit"],M0&&b0.totalInterFrameDelay!==void 0&&b0.totalSquaredInterFrameDelay!==void 0&&M0.totalInterFrameDelay!==void 0&&M0.totalSquaredInterFrameDelay!==void 0){const U0=b0.totalInterFrameDelay-M0.totalInterFrameDelay,x0=b0.totalSquaredInterFrameDelay-M0.totalSquaredInterFrameDelay,j0=b0.framesDecodeCount-M0.framesDecodeCount,k0=U0/j0*1e3,D0=Math.round(1e3*Math.sqrt((x0-Math.pow(U0,2)/j0)/j0));!isNaN(D0)&&k0+D0>Math.max(3*k0,k0+150)&&(S0[JV.I_FRAME_DELAY]=D0)}return S0}(a0._videoSSRC,e0,n0,a0.videoTrack,l0===!0,this.needUploadRenderFreezeTime,r0):void 0;d0&&(u0.video=d0)}if(c0.has(dO.AUDIO)&&a0.audioTrack){const l0=a0.audioTrack?function(d0,h0,p0,m0,f0){const g0=h0.audioRecv.find(M0=>M0.ssrc===d0);if(!g0)return;const E0={},_0=p0&&p0.audioRecv.find(M0=>M0.ssrc===d0),{receivedFrames:y0,droppedFrames:b0}=g0;var S0,w0;if(rF(E0,$V.JITTER,g0.jitterMs),y0!=null&&b0!=null&&(E0[$V.FREEZE]=(w0=b0,(S0=y0)===0||100*w0/S0>20?1:0)),_0){const M0=h0.timestamp-p0.timestamp||(f0?iF:iF*nF);g0.packets!=null&&_0.packets!=null&&rF(E0,$V.PACKAGE_RATE,1e3*(g0.packets-_0.packets)/M0),_0.bytes!=null&&g0.bytes!=null&&rF(E0,$V.BITRATE,8*(g0.bytes-_0.bytes)/M0),g0.packetsLost!=null&&_0.packetsLost!=null&&rF(E0,$V.PACKAGE_LOST,g0.packetsLost-_0.packetsLost)}if(f0)return E0;const I0=100*m0._source.getAccurateVolumeLevel(),L0=g0.outputLevel;if(L0!=null){const M0=Math.ceil(50*Math.log10(100*L0+1));rF(E0,eF.LEVEL,M0)}if(rF(E0,$V.PCM_LEVEL,I0),m0&&(E0[$V.DISABLED]=m0._originMediaStreamTrack.enabled&&m0._mediaStreamTrack.enabled?0:1),rF(E0,$V.JITTER_BUFFER,g0.jitterBufferMs),rF(E0,$V.CURRENT_DELAY,g0.jitterBufferMs),E0[$V.PLAYER_STATUS]=xL[mk.getPlayerState(m0.getTrackId())],_0){const M0=g0.concealedSamples-_0.concealedSamples;M0>0&&rF(E0,$V.CONCEALED_SAMPLES,M0)}return E0}(a0._audioSSRC,e0,n0,a0.audioTrack,r0):void 0;l0&&(u0.audio=l0)}(u0.video||u0.audio)&&o0.push(u0)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o0}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e0=(this.requestAllTracks()||[]).find(n0=>n0 instanceof SM);if(e0&&e0._external.getDenoiserStats){const n0=e0._external.getDenoiserStats();n0&&this.requestUpload(Lw.DENOISER_STATS,n0)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e0=>{e0.getProcessorStats().forEach(n0=>{this.requestUpload&&this.requestUpload(n0.type,n0.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e0=>{let[n0,r0]=e0;r0.has(dO.VIDEO)&&n0.videoTrack&&n0.videoTrack.getProcessorStats().forEach(i0=>{this.requestUpload&&this.requestUpload(i0.type,i0.stats)}),r0.has(dO.AUDIO)&&n0.audioTrack&&n0.audioTrack.getProcessorStats().forEach(i0=>{this.requestUpload&&this.requestUpload(i0.type,i0.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e0=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n0=Date.now(),r0={connectionInterval:XA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n0};let i0=[];const o0=this.requestAllTracks&&this.requestAllTracks()||[];for(const u0 of o0)!u0.muted&&u0.enabled&&(i0=i0.concat(await u0.getProcessorUsage()));const s0=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[u0,l0]of s0)l0.has(dO.VIDEO)&&u0.videoTrack&&(i0=i0.concat(await u0.videoTrack.getProcessorUsage())),l0.has(dO.AUDIO)&&u0.audioTrack&&(i0=i0.concat(await u0.audioTrack.getProcessorUsage()));if(i0.length===0)return;r0.details=function(u0,l0){const d0={};for(const{id:f0,value:g0,level:E0,direction:_0}of u0){var h0;const y0=(h0=l0.get(f0))!==null&&h0!==void 0?h0:0,b0=g0===2?y0+XA("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:y0;var p0,m0;l0.set(f0,b0),d0[f0]?(g0===2&&(d0[f0].value=g0),E0>d0[f0].level&&(d0[f0].level=E0),_0==="remote"&&(d0[f0].remoteUidCount+=1),d0[f0].totalTs=(p0=l0.get(f0))!==null&&p0!==void 0?p0:0):d0[f0]={value:g0,level:E0,remoteUidCount:_0==="local"?0:1,totalTs:(m0=l0.get(f0))!==null&&m0!==void 0?m0:0}}return Object.keys(d0).map(f0=>{const{level:g0,value:E0,totalTs:_0}=d0[f0];return{id:f0,level:g0,value:E0,totalTs:_0}})}(i0,e0);const a0=Date.now(),c0=a0>n0?a0:n0+1;this.requestUpload&&this.requestUpload(Lw.EXTENSION_USAGE_STATS,{usageStats:r0,sendTs:c0})},XA("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class cF{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e0,n0){Fg(this,"uid",void 0),Fg(this,"_uintid",void 0),Fg(this,"_trust_in_room_",!0),Fg(this,"_trust_audio_enabled_state_",!0),Fg(this,"_trust_video_enabled_state_",!0),Fg(this,"_trust_audio_mute_state_",!0),Fg(this,"_trust_video_mute_state_",!0),Fg(this,"_audio_muted_",!1),Fg(this,"_video_muted_",!1),Fg(this,"_audio_enabled_",!0),Fg(this,"_video_enabled_",!0),Fg(this,"_audio_added_",!1),Fg(this,"_video_added_",!1),Fg(this,"_is_pre_created",!1),Fg(this,"_video_pre_subscribed",!1),Fg(this,"_audio_pre_subscribed",!1),Fg(this,"_trust_video_stream_added_state_",!0),Fg(this,"_trust_audio_stream_added_state_",!0),Fg(this,"_audioTrack",void 0),Fg(this,"_videoTrack",void 0),Fg(this,"_dataChannels",[]),Fg(this,"_audioSSRC",void 0),Fg(this,"_videoSSRC",void 0),Fg(this,"_audioOrtc",void 0),Fg(this,"_videoOrtc",void 0),Fg(this,"_cname",void 0),Fg(this,"_rtxSsrcId",void 0),Fg(this,"_videoMid",void 0),Fg(this,"_audioMid",void 0),this.uid=e0,this._uintid=n0}}let dF=function(t0){return t0.SEND_ONLY="SEND_ONLY",t0.RECEIVE_ONLY="RECEIVE_ONLY",t0}({});function lF(t0,e0){var n0;let r0;switch(e0){case hO.LocalAudioTrack:r0=Zw.Audio;break;case hO.LocalVideoTrack:r0=Dn(n0=t0._hints).call(n0,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:r0=Zw.Low}return r0}function uF(t0){const e0=ZP();if(t0.some(n0=>n0._bypassWebAudio))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e0.webAudioMediaStreamDest)throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function hF(t0,e0){uF(t0);const n0=e0||new RM;return t0.forEach(r0=>n0.addAudioTrack(r0)),n0}var pF,_F,EF,fF,mF,TF,SF,gF,RF,CF,IF,vF;function yF(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function AF(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?yF(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):yF(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}let bF=(pF=wF(dF.SEND_ONLY),_F=wF(dF.SEND_ONLY),EF=wF(),fF=wF(dF.RECEIVE_ONLY),mF=wF(dF.RECEIVE_ONLY),TF=wF(dF.RECEIVE_ONLY),SF=wF(dF.RECEIVE_ONLY),gF=wF(dF.RECEIVE_ONLY),RF=wF(dF.RECEIVE_ONLY),CF=wF(),IF=wF(dF.RECEIVE_ONLY),vF=class extends xy{get state(){return this._state}set state(t0){const e0=this._state;this._state=t0,this.emit(_O.StateChange,e0,this._state)}constructor(t0,e0){super(),Fg(this,"isPlanB",!1),Fg(this,"store",void 0),Fg(this,"statsUploader",void 0),Fg(this,"sendConnection",void 0),Fg(this,"recvConnection",void 0),Fg(this,"localTrackMap",new Map),Fg(this,"remoteUserMap",new Map),Fg(this,"localDataChannels",[]),Fg(this,"pendingLocalTracks",[]),Fg(this,"pendingRemoteTracks",[]),Fg(this,"statsCollector",void 0),Fg(this,"dtlsFailedCount",0),Fg(this,"sendMutex",new NA("P2PChannel2-send-mutex")),Fg(this,"recvMutex",new NA("P2PChannel2-recv-mutex")),Fg(this,"_state",pO.Disconnected),Fg(this,"_restartStates",["disconnected","failed"]),Fg(this,"reconnectInterval",void 0),Fg(this,"uploadUnplinkStarted",!1),Fg(this,"uploadDownlinkStarted",!1),Fg(this,"uplinkStateUploadInterval",void 0),Fg(this,"downlinkStatsUploadInterval",void 0),Fg(this,"handleMuteLocalTrack",async(n0,r0,i0)=>{const o0=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==pO.Connected)return void i0(new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const c0=this.filterTobeMutedTracks(n0);if(c0.length===0)return void r0();const u0=c0.find(p0=>p0[0]==="videoLowTrack");u0&&u0[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(c0.map(p0=>{let[,{id:m0}]=p0;return m0}));let l0=!1;var s0,a0;n0.trackMediaType==="video"?l0=!((s0=this.localTrackMap.get(hO.LocalAudioTrack))===null||s0===void 0||!s0.track._muted):l0=((a0=this.localTrackMap.get(hO.LocalVideoTrack))===null||a0===void 0?void 0:a0.id)===void 0;const d0=this.createMuteMessage(c0);await $y(this,_O.RequestMuteLocal,d0);const h0=n0.trackMediaType==="video"?yO.MUTE_LOCAL_VIDEO:yO.MUTE_LOCAL_AUDIO;await $y(this,_O.RequestP2PMuteLocal,{action:h0,message:d0,isMuteAll:l0}),r0()}catch(c0){i0(c0)}finally{o0()}}),Fg(this,"handleUnmuteLocalTrack",async(n0,r0,i0)=>{const o0=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==pO.Connected)return void i0(new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const s0=this.filterTobeUnmutedTracks(n0);if(s0.length===0)return void r0();await this.sendConnection.unmuteLocal(s0.map(u0=>{let[,{id:l0}]=u0;return l0}));const a0=this.createUnmuteMessage(s0),c0=n0.trackMediaType==="video"?yO.UNMUTE_LOCAL_VIDEO:yO.UNMUTE_LOCAL_AUDIO;await $y(this,_O.RequestP2PMuteLocal,{action:c0,message:a0}),r0()}catch(s0){i0(s0)}finally{o0()}}),Fg(this,"handleUpdateVideoEncoder",async(n0,r0,i0)=>{const o0=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const s0=this.localTrackMap.get(hO.LocalVideoTrack);if(!this.sendConnection||!s0||s0.track!==n0||this.state!==pO.Connected)return void r0();const{id:a0,track:c0}=s0;a0&&(await this.sendConnection.updateSendParameters(a0,c0),await this.sendConnection.updateEncoderConfig(a0,c0),this.emit(_O.UpdateVideoEncoder,c0)),r0()}catch(s0){i0(s0)}finally{o0()}}),Fg(this,"handleUpdateVideoSendParameters",async(n0,r0,i0)=>{const o0=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const s0=this.localTrackMap.get(hO.LocalVideoTrack);if(!this.sendConnection||!s0||s0.track!==n0||this.state!==pO.Connected)return void r0();const{id:a0,track:c0}=s0;a0&&await this.sendConnection.updateSendParameters(a0,c0),r0()}catch(s0){i0(s0)}finally{o0()}}),Fg(this,"handleReplaceTrack",async(n0,r0,i0,o0)=>{let s0;fb.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n0.getTrackId(),"]")),typeof o0=="boolean"&&o0||(s0=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var a0;const u0=Array.from(this.localTrackMap.entries()).find(l0=>{let[,{track:d0}]=l0;return n0===d0});if(!this.sendConnection||!u0||u0[1].id===void 0||this.state!==pO.Connected)return void r0();if(await((a0=this.sendConnection)===null||a0===void 0?void 0:a0.replaceTrack(n0,u0[1].id)),u0[0]===hO.LocalVideoTrack&&ZP().supportDualStreamEncoding){const l0=this.localTrackMap.get(hO.LocalVideoLowTrack);if(l0){const d0=n0._mediaStreamTrack.clone();l0.track._originMediaStreamTrack.stop(),l0.track._mediaStreamTrack=d0,l0.track._originMediaStreamTrack=d0,await new Gh((h0,p0)=>{this.handleReplaceTrack(l0.track,h0,p0,!0)})}}r0()}catch(u0){i0(u0)}finally{var c0;(c0=s0)===null||c0===void 0||c0()}}),Fg(this,"handleGetLocalVideoStats",n0=>{n0(this.statsCollector.getLocalVideoTrackStats())}),Fg(this,"handleGetLocalAudioStats",n0=>{n0(this.statsCollector.getLocalAudioTrackStats())}),Fg(this,"handleGetRemoteVideoStats",n0=>this.statsCollector.getRemoteVideoTrackStats(n0.uid)[n0.uid]),Fg(this,"handleGetRemoteAudioStats",n0=>this.statsCollector.getRemoteAudioTrackStats(n0.uid)[n0.uid]),this.store=t0,this.statsCollector=e0,this.statsCollector.addP2PChannel(this),this.statsUploader=new aF(t0),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n0=>{n0&&(n0.iceConnectionState!=="disconnected"&&n0.iceConnectionState!=="failed"||this.handleDisconnect(n0.direction))})},XA("ICE_RESTART_INTERVAL"))}async startP2PConnection(t0,e0){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t0){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t0,e0){let n0;try{if(e0){this.recvConnection&&(fb.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n0=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new WV(t0,this.store,Mw.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r0=await this.recvConnection.establish(e0);return{iceParameters:r0.iceParameters,dtlsParameters:r0.dtlsParameters,sdp:r0.sdp}}{this.state=pO.New,this.sendConnection&&(fb.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n0=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new WV(t0,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r0=await this.sendConnection.establish();return{iceParameters:r0.iceParameters,dtlsParameters:r0.dtlsParameters,sdp:r0.sdp}}}finally{n0&&n0()}}async p2pConnect(t0){if(!this.sendConnection)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t0),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=pO.Connected}async addRemoteCandidate(t0,e0){if(e0===Mw.RECEIVE_ONLY){if(!this.sendConnection)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t0)}else{if(!this.recvConnection)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t0)}}publish(t0,e0,n0){var r0=this;return YI(function*(){const i0=yield qI(r0.sendMutex.lock("From P2PChannel.publish"));try{if(!r0.sendConnection||r0.state!==pO.Connected){r0.throwIfTrackTypeNotMatch(t0);const u0=t0.filter(l0=>r0.pendingLocalTracks.indexOf(l0)===-1);return void(r0.pendingLocalTracks=r0.pendingLocalTracks.concat(u0))}r0.store.pubId=r0.store.pubId+1,rV.markPublishStart(r0.store.clientId,r0.store.pubId);const o0=r0.filterTobePublishedTracks(t0,e0,n0);if(o0.length===0)return void(yield qI(r0.tryToUnmuteAudio(t0)));o0.forEach(u0=>{let{track:l0,type:d0}=u0;const h0=Date.now();r0.store.publish(l0.getTrackId(),d0===hO.LocalAudioTrack?"audio":"video",h0)}),r0.bindLocalTrackEvents(o0);const s0=yield qI(r0.sendConnection.send(o0.map(u0=>{let{track:l0}=u0;return l0}),r0.store.codec,r0.store.audioCodec)),a0=(yield qI(s0.next())).value,c0=r0.createGatewayPublishMessage(o0,a0);try{yield c0}catch(u0){throw s0.throw(u0),(u0==null?void 0:u0.code)===Ry.WS_ABORT&&o0.forEach(l0=>{let{track:d0}=l0;r0.pendingLocalTracks.indexOf(d0)===-1&&r0.pendingLocalTracks.push(d0)}),r0.unbindLocalTrackEvents(o0),u0}yield qI(s0.next()),o0.forEach(u0=>{let{type:l0}=u0;r0.statsCollector.addLocalStats(l0)}),r0.statsUploader.startUploadOutboundStats(),r0.assignLocalTracks(o0,a0),o0.forEach(u0=>{let{track:l0,type:d0}=u0;const h0=Date.now();r0.store.publish(l0.getTrackId(),d0===hO.LocalAudioTrack?"audio":"video",void 0,h0)}),r0.startUploadUplinkState()}finally{i0()}})()}async unpublish(t0){if(!this.sendConnection||this.state!==pO.Connected)return void(t0.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i0=>!Dn(t0).call(t0,i0)));const e0=this.filterTobeUnpublishedTracks(t0);if(e0.length===0)return;const n0=e0.find(i0=>i0[0]==="videoLowTrack");n0&&n0[1].track.close();const r0=this.createGatewayUnpublishMessage(e0);if(await this.sendConnection.stopSending(e0.map(i0=>{let[,{id:o0}]=i0;return o0})),this.withdrawLocalTracks(e0),this.unbindLocalTrackEvents(e0.map(i0=>{let[o0,{track:s0}]=i0;return{type:o0,track:s0}})),e0.forEach(i0=>{let[o0]=i0;this.statsCollector.removeLocalStats(o0)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===pO.Connected)return n0&&n0[1].track.close(),r0;t0.forEach(i0=>{const o0=this.pendingLocalTracks.indexOf(i0);o0!==-1&&this.pendingLocalTracks.splice(o0,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t0=()=>{const e0=[],n0=[];Array.from(this.localTrackMap.entries()).forEach(r0=>{let[i0,{track:o0,ssrcs:s0}]=r0;const a0={stream_type:lF(o0,i0),ssrcs:s0};o0._muted||!o0._enabled?e0.push(a0):n0.push(a0)}),e0.length>0&&e0.forEach(r0=>{$y(this,_O.RequestMuteLocal,[r0])}),n0.length>0&&n0.forEach(r0=>{$y(this,_O.RequestUnmuteLocal,[r0])})};t0(),this.uplinkStateUploadInterval=window.setInterval(()=>{t0()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t0){return YI(function*(){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(fb.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Zy(this,_O.RequestRePublish,this.pendingLocalTracks),this.emit(_O.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t0,e0,n0,r0){var i0;if(!this.recvConnection)throw new Cy(Ry.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i0=this.remoteUserMap.get(t0))!==null&&i0!==void 0&&i0.has(e0))return;const{track:o0,mid:s0,transceiver:a0}=await this.recvConnection.receive(e0,[{ssrcId:n0}],String(t0.uid),r0);e0===dO.AUDIO?(t0._audioTrack?t0._audioTrack._updateOriginMediaStreamTrack(o0):(t0._audioTrack=new vU(o0,t0.uid,t0._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t0._audioTrack.getTrackId()))),a0&&t0._audioTrack._updateRtpTransceiver(a0),this.bindRemoteTrackEvents(t0,t0._audioTrack)):(t0._videoSSRC=n0,t0._videoTrack?t0._videoTrack._updateOriginMediaStreamTrack(o0):(t0._videoTrack=new IU(o0,t0.uid,t0._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t0._videoTrack.getTrackId()))),a0&&t0._videoTrack._updateRtpTransceiver(a0),this.bindRemoteTrackEvents(t0,t0._videoTrack));const c0=this.remoteUserMap.get(t0);c0?c0.set(e0,s0):this.remoteUserMap.set(t0,new Map([[e0,s0]])),this.statsCollector.addRemoteStats(t0.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const u0=this.pendingRemoteTracks.findIndex(l0=>{let{user:d0,kind:h0}=l0;return d0.uid===t0.uid&&e0===h0});u0!==-1&&(this.pendingRemoteTracks.splice(u0,1),this.emit(_O.MediaReconnectEnd,t0.uid))}async mockSubscribe(t0,e0,n0,r0){if(!this.recvConnection)throw new Cy(Ry.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e0,[{ssrcId:n0}],String(t0.uid),r0)}async unsubscribe(t0,e0,n0){const r0=this.pendingRemoteTracks.filter(o0=>{let{user:s0,kind:a0}=o0;return e0!==void 0?s0.uid===t0.uid&&e0===a0:s0.uid===t0.uid});if(r0.forEach(o0=>{const s0=this.pendingRemoteTracks.indexOf(o0);this.pendingRemoteTracks.splice(s0,1)}),this.recvConnection||n0||r0.forEach(o0=>{let{kind:s0}=o0;var a0;if(s0===dO.AUDIO)(a0=t0._audioTrack)===null||a0===void 0||a0._destroy(),t0._audioTrack=void 0;else if(s0===dO.VIDEO){var c0;(c0=t0._videoTrack)===null||c0===void 0||c0._destroy(),t0._videoTrack=void 0}}),!this.recvConnection)return;const i0=this.filterTobeUnSubscribedTracks(t0,e0);i0.length!==0&&(await this.recvConnection.stopReceiving(i0.map(o0=>{let[,{id:s0}]=o0;return s0})),this.withdrawRemoteTracks(i0),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i0.forEach(o0=>{let[s0,{kind:a0}]=o0;var c0,u0;if(a0===dO.VIDEO&&s0._videoSSRC&&((c0=this.recvConnection)===null||c0===void 0||c0.setStatsRemoteVideoIsReady(s0._videoSSRC,!1)),a0===dO.VIDEO)this.unbindRemoteTrackEvents(s0._videoTrack),n0||((u0=s0._videoTrack)===null||u0===void 0||u0._destroy(),s0._videoTrack=void 0);else if(a0===dO.AUDIO){var l0;this.unbindRemoteTrackEvents(s0._audioTrack),!n0&&((l0=s0._audioTrack)===null||l0===void 0||l0._destroy(),s0._audioTrack=void 0)}}),i0.forEach(o0=>{let[,{kind:s0}]=o0;$y(this,_O.RequestP2PMuteRemote,s0)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t0=()=>Array.from(this.remoteUserMap.entries()).forEach(e0=>{let[,n0]=e0;[dO.VIDEO,dO.AUDIO].forEach(r0=>{n0.has(r0)?$y(this,_O.RequestP2PUnmuteRemote,r0):$y(this,_O.RequestP2PMuteRemote,r0)})});t0(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t0()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t0){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t0){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t0){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t0){throw new Cy(Ry.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t0,e0){if(!this.recvConnection)return;const n0=this.remoteUserMap.get(t0);if(!n0)return void fb.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t0.uid,"."));if(!n0.get(e0))return void fb.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t0.uid," media type ").concat(e0,"."));const r0=e0===dO.VIDEO?t0._videoSSRC:t0._audioSSRC;r0!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r0,!1)}async unmuteRemote(t0,e0){return this.unmuteRemoteNoLock(t0,e0)}async unmuteRemoteNoLock(t0,e0){if(!this.recvConnection)return;const n0=this.remoteUserMap.get(t0);if(!n0)return void fb.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t0.uid,"."));n0.get(e0)||fb.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t0.uid," media type ").concat(e0,"."))}getAllTracks(t0){const e0=this.localTrackMap.get(hO.LocalAudioTrack);if((e0==null?void 0:e0.track)instanceof RM){const n0=e0.track;return Array.from(this.localTrackMap.entries()).filter(r0=>{let[i0]=r0;return i0!==hO.LocalAudioTrack}).filter(r0=>{let[i0]=r0;return!(t0&&i0===hO.LocalVideoLowTrack)}).map(r0=>{let[,{track:i0}]=r0;return i0}).concat(n0.trackList)}return Array.from(this.localTrackMap.entries()).filter(n0=>{let[r0]=n0;return!(t0&&r0===hO.LocalVideoLowTrack)}).map(n0=>{let[,{track:r0}]=n0;return r0})}reportPublishEvent(t0,e0,n0,r0,i0){if(t0){const s0=this.localTrackMap.get(hO.LocalAudioTrack),a0=r0?this.localTrackMap.get(hO.LocalVideoLowTrack):this.localTrackMap.get(hO.LocalVideoTrack);vb.publish(this.store.sessionId,{eventElapse:rV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t0,ec:e0,audioName:s0==null?void 0:s0.track.getTrackLabel(),videoName:a0==null?void 0:a0.track.getTrackLabel(),screenshare:(a0==null?void 0:a0.track._hints.indexOf(mL.SCREEN_TRACK))!==-1,audio:!!s0,video:!!a0,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i0})}else{var o0;n0||(n0=[]);const s0=n0.find(c0=>c0 instanceof TM),a0=r0?(o0=this.localTrackMap.get(hO.LocalVideoTrack))===null||o0===void 0?void 0:o0.track:n0.find(c0=>c0 instanceof aU);vb.publish(this.store.sessionId,{eventElapse:rV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t0,ec:e0,audioName:s0==null?void 0:s0.getTrackLabel(),videoName:a0==null?void 0:a0.getTrackLabel(),screenshare:(a0==null?void 0:a0._hints.indexOf(mL.SCREEN_TRACK))!==-1,audio:!!s0,video:!!a0,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i0})}}reportSubscribeEvent(t0,e0,n0,r0){const i0=r0===dO.VIDEO?n0._videoSSRC:n0._audioSSRC;i0&&vb.subscribe(this.store.sessionId,{succ:t0,ec:e0,video:r0===dO.VIDEO,audio:r0===dO.AUDIO,peerid:n0.uid,subscribeRequestid:r0===dO.VIDEO?n0._videoSSRC:n0._audioSSRC,p2pid:this.store.p2pId,eventElapse:rV.measureFromSubscribeStart(this.store.clientId,i0)})}reset(){fb.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new NA("P2PChannel2-send-mutex"),this.sendMutex=new NA("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t0=this.localTrackMap.get(hO.LocalAudioTrack);if((t0==null?void 0:t0.track)instanceof RM){if(t0.track.trackList.length>0){const e0=t0.track;t0.track.trackList.forEach(n0=>{e0.removeAudioTrack(n0)})}t0.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=pO.Disconnected}getStats(t0){var e0,n0;return t0?(n0=this.recvConnection)===null||n0===void 0?void 0:n0.getStats():(e0=this.sendConnection)===null||e0===void 0?void 0:e0.getStats()}getRemoteVideoIsReady(t0){var e0;return((e0=this.recvConnection)===null||e0===void 0?void 0:e0.getRemoteVideoIsReady(t0))||!1}getLocalAudioVolume(){const t0=this.localTrackMap.get(hO.LocalAudioTrack);if(t0)return t0.track.getVolumeLevel()}getLocalVideoSize(){const t0=this.localTrackMap.get(hO.LocalVideoTrack);if(t0)return{width:t0.track.videoWidth||0,height:t0.track.videoHeight||0}}getEncoderConfig(t0){const e0=this.localTrackMap.get(t0);return e0&&e0.track instanceof aU||e0&&e0.track instanceof TM?e0.track._encoderConfig:void 0}getLocalMedia(t0){return this.localTrackMap.get(t0)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t0,e0){if(!t0)return this.remoteUserMap.size>0;const n0=this.remoteUserMap.get(t0);return!!n0&&(!e0||n0.has(e0))}async hasRemoteMediaWithLock(t0,e0){if(!t0)return this.remoteUserMap.size>0;const n0=this.remoteUserMap.get(t0);return!!n0&&(!e0||n0.has(e0))}getRemoteMedia(t0){var e0;const n0=Array.from(d_(e0=this.remoteUserMap).call(e0)).find(r0=>r0.uid===t0);return n0?{audioTrack:n0.audioTrack,audioSSRC:n0._audioSSRC,videoTrack:n0.videoTrack,videoSSRC:n0._videoSSRC}:{}}getAudioLevels(){let t0=Array.from(this.remoteUserMap.entries()).map(n0=>{let[r0]=n0;return{uid:r0.uid,level:r0.audioTrack?100*r0.audioTrack._source.getAccurateVolumeLevel():0}});const e0=this.localTrackMap.get(hO.LocalAudioTrack);return e0&&t0.push({level:100*e0.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t0=aE(t0).call(t0,(n0,r0)=>n0.level-r0.level),t0}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(fb.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=pO.Reconnecting,XA("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t0=>{let[e0]=t0;var n0;e0._videoTrack&&e0._videoTrack._player&&((n0=e0._videoTrack._player.getVideoElement())===null||n0===void 0||n0.pause(),e0._videoTrack._player.isKeepLastFrame=!0,e0._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t0=>{var e0;let[n0,{track:r0}]=t0;switch(n0){case hO.LocalVideoTrack:Dn(e0=r0._hints).call(e0,mL.LOW_STREAM)?r0.close():this.pendingLocalTracks.push(r0);break;case hO.LocalAudioTrack:r0 instanceof RM?this.pendingLocalTracks=this.pendingLocalTracks.concat(r0.trackList):this.pendingLocalTracks.push(r0);case hO.LocalVideoLowTrack:}}),this.emit(_O.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t0=>{let[e0,n0]=t0;Array.from(d_(n0).call(n0)).forEach(r0=>{this.setPendingRemoteMedia(e0,r0)}),this.emit(_O.MediaReconnectStart,e0.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),fb.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t0,e0){for(const n0 of this.pendingRemoteTracks){const{user:r0,kind:i0}=n0;if((t0 instanceof cF?t0.uid:t0)===r0.uid&&e0===i0)return!0}return!1}setPendingRemoteMedia(t0,e0){this.hasPendingRemoteMedia(t0,e0)||this.pendingRemoteTracks.push({user:t0,kind:e0})}async restartICE(t0,e0){let n0,r0;if(t0===Mw.SEND_ONLY){if(!this.sendConnection)throw new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n0=await this.sendMutex.lock("From P2PChannel.restartICE"),r0=this.sendConnection}else{if(!this.recvConnection)throw new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n0=await this.recvMutex.lock("From P2PChannel.restartICE"),r0=this.recvConnection}try{if(e0){const i0=await r0.restartICE(e0);return r0.isInRestartIce=!1,i0}{const i0=await r0.restartICE();if(i0){const o0=await Zy(this,_O.RequestP2PRestartICE,{direction:Mw.RECEIVE_ONLY,iceParameter:i0});await r0.restartICE(o0),r0.isInRestartIce=!1}}}finally{n0()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t0=this.sendConnection.getStats(),e0=this.localTrackMap.get(hO.LocalVideoTrack),n0=this.localTrackMap.get(hO.LocalAudioTrack),r0=t0.videoSend.find(p0=>{var m0;return p0.ssrc===(e0==null||(m0=e0.ssrcs)===null||m0===void 0?void 0:m0[0].ssrcId)}),i0=t0.audioSend.find(p0=>{var m0;return p0.ssrc===(n0==null||(m0=n0.ssrcs)===null||m0===void 0?void 0:m0[0].ssrcId)});if(!r0||!i0)return 1;const o0=eA(this,_O.NeedSignalRTT),s0=r0?r0.rttMs:void 0,a0=i0?i0.rttMs:void 0,c0=s0&&a0?(s0+a0)/2:s0||a0,u0=(c0&&o0?(c0+o0)/2:c0||o0)||0,l0=100*t0.sendPacketLossRate*.7/50+.3*u0/1500,d0=l0<.17?1:l0<.36?2:l0<.59?3:l0<.1?4:5,h0=e0==null?void 0:e0.track;if(h0&&h0._encoderConfig&&h0._hints.indexOf(mL.SCREEN_TRACK)===-1){const p0=h0._encoderConfig.bitrateMax,m0=t0.bitrate.actualEncoded;if(p0&&m0){const f0=(1e3*p0-m0)/(1e3*p0);return bb[f0<.15?0:f0<.3?1:f0<.45?2:f0<.6?3:4][d0]}}return d0}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t0=this.recvConnection.getStats();let e0=0;return Array.from(this.remoteUserMap.entries()).forEach(n0=>{let[r0]=n0;const i0=r0._audioSSRC,o0=r0._videoSSRC,s0=t0.audioRecv.find(m0=>m0.ssrc===i0),a0=t0.videoRecv.find(m0=>m0.ssrc===o0);if(!s0&&!a0)return void(e0+=1);const c0=eA(this,_O.NeedSignalRTT),u0=t0.rtt,l0=(u0&&c0?(u0+c0)/2:u0||c0)||0,d0=s0?s0.jitterMs:void 0,h0=t0.recvPacketLossRate;let p0=.7*h0*100/50+.3*l0/1500;d0&&(p0=.6*h0*100/50+.2*l0/1500+.2*d0/400),e0+=p0<.1?1:p0<.17?2:p0<.36?3:p0<.59?4:5}),this.remoteUserMap.size>0?Math.round(e0/this.remoteUserMap.size):e0}async muteLocalTrack(t0){return new Gh((e0,n0)=>{this.handleMuteLocalTrack(t0,e0,n0)})}filterTobePublishedTracks(t0,e0,n0){const r0=[],i0=ZP(),o0=this.getAllTracks();t0=rA(t0=t0.filter(c0=>o0.indexOf(c0)===-1));let s0=!1,a0=!1;for(const c0 of t0){if(c0 instanceof aU&&(this.localTrackMap.has(hO.LocalVideoTrack)||s0?new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r0.push({track:c0,type:hO.LocalVideoTrack}),s0=!0),e0)){const u0=this.getLowVideoTrack(c0,n0);r0.push({track:u0,type:hO.LocalVideoLowTrack})}if(c0 instanceof TM){const u0=this.localTrackMap.get(hO.LocalAudioTrack);if(u0){if(!(u0.track instanceof RM))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c0._bypassWebAudio)throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");u0.track.addAudioTrack(c0),this.bindLocalAudioTrackEvents(c0,!0)}else if(a0){const l0=r0.find(d0=>{let{type:h0}=d0;return h0===hO.LocalAudioTrack});if(!(l0.track instanceof RM))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c0._bypassWebAudio)throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l0.track.addAudioTrack(c0)}else{if(!i0.webAudioMediaStreamDest||c0 instanceof RM||c0._bypassWebAudio)r0.push({track:c0,type:hO.LocalAudioTrack});else{const l0=new RM;l0.addAudioTrack(c0),r0.push({track:l0,type:hO.LocalAudioTrack})}a0=!0}}}return r0}filterTobeUnpublishedTracks(t0){const e0=[],n0=this.getAllTracks();t0=rA(t0=t0.filter(r0=>n0.indexOf(r0)!==-1));for(const r0 of t0){if(r0 instanceof TM){const i0=this.localTrackMap.get(hO.LocalAudioTrack);if(!i0)continue;i0.track instanceof RM?(i0.track.removeAudioTrack(r0),this.unbindLocalAudioTrackEvents(r0),i0.track.trackList.length===0&&(e0.push([hO.LocalAudioTrack,i0]),i0.track.close())):e0.push([hO.LocalAudioTrack,i0])}if(r0 instanceof aU){const i0=this.localTrackMap.get(hO.LocalVideoTrack);if(!i0)continue;e0.push([hO.LocalVideoTrack,i0]);const o0=this.localTrackMap.get(hO.LocalVideoLowTrack);o0&&e0.push([hO.LocalVideoLowTrack,o0])}}return e0}bindLocalTrackEvents(t0){t0.forEach(e0=>{let{track:n0,type:r0}=e0;switch(r0){case hO.LocalVideoTrack:n0.addListener(fL.GET_STATS,this.handleGetLocalVideoStats),n0.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n0.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n0.addListener(fL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n0.addListener(fL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n0.addListener(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),n0.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n0.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO.LocalAudioTrack:this.bindLocalAudioTrackEvents(n0);case hO.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t0,e0){t0 instanceof RM?t0.trackList.forEach(n0=>{n0.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n0.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n0.addListener(fL.GET_STATS,this.handleGetLocalAudioStats),n0.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n0.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t0.addListener(fL.GET_STATS,this.handleGetLocalAudioStats),t0.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t0.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t0.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t0.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e0||t0.addListener(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t0){t0||(t0=Array.from(this.localTrackMap.entries()).map(e0=>{let[n0,{track:r0}]=e0;return{track:r0,type:n0}})),t0.forEach(e0=>{let{track:n0,type:r0}=e0;switch(r0){case hO.LocalVideoTrack:n0.off(fL.GET_STATS,this.handleGetLocalVideoStats),n0.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n0.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n0.off(fL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n0.off(fL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n0.off(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),n0.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n0.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n0);case hO.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t0){t0 instanceof RM?t0.trackList.forEach(e0=>{e0.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e0.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e0.off(fL.GET_STATS,this.handleGetLocalAudioStats),e0.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e0.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t0.off(fL.GET_STATS,this.handleGetLocalAudioStats),t0.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t0.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t0.off(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),t0.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t0.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t0,e0){e0 instanceof IU&&e0.addListener(fL.GET_STATS,n0=>{n0(this.handleGetRemoteVideoStats(t0))}),e0 instanceof vU&&e0.addListener(fL.GET_STATS,n0=>{n0(this.handleGetRemoteAudioStats(t0))})}unbindRemoteTrackEvents(t0){t0&&t0.removeAllListeners(fL.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t0=>{let[e0,n0]=t0;n0.has(dO.AUDIO)&&this.unbindRemoteTrackEvents(e0._audioTrack),n0.has(dO.VIDEO)&&this.unbindRemoteTrackEvents(e0._videoTrack)})}createGatewayPublishMessage(t0,e0){return t0.map((n0,r0)=>{var i0;let o0,{track:s0,type:a0}=n0;switch(a0){case hO.LocalAudioTrack:o0=Zw.Audio;break;case hO.LocalVideoTrack:o0=Dn(i0=s0._hints).call(i0,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:o0=Zw.Low}return{kind:a0===hO.LocalAudioTrack?dO.AUDIO:dO.VIDEO,stream_type:o0,mid:e0[r0].id,ssrcs:e0[r0].localSSRC,isMuted:s0.muted||!s0.enabled}})}createGatewayUnpublishMessage(t0){return t0.map(e0=>{var n0;let r0,[i0,{track:o0,ssrcs:s0,id:a0}]=e0;switch(i0){case hO.LocalVideoTrack:r0=Dn(n0=o0._hints).call(n0,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalAudioTrack:r0=Zw.Audio;break;case hO.LocalVideoLowTrack:r0=Zw.Low}return{stream_type:r0,ssrcs:s0,mid:a0}})}assignLocalTracks(t0,e0){t0.forEach((n0,r0)=>{let{track:i0,type:o0}=n0;this.localTrackMap.set(o0,{track:i0,id:e0[r0].id,ssrcs:e0[r0].localSSRC})})}withdrawLocalTracks(t0){t0.forEach(e0=>{let[n0]=e0;this.localTrackMap.delete(n0)})}bindConnectionEvents(t0){t0.onConnectionStateChange=async e0=>{var n0;fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t0.name,".onConnectionStateChange(").concat(e0,")")),this.emit(_O.PeerConnectionStateChange,e0),e0!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e0==="connected"&&(t0.isInRestartIce=!1),Dn(n0=this._restartStates).call(n0,e0)&&!t0.isInRestartIce&&(e0==="disconnected"&&await mA(800),t0.iceConnectionState!=="disconnected"&&t0.iceConnectionState!=="failed"||this.handleDisconnect(t0.direction))},t0.onICEConnectionStateChange=e0=>{e0!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e0,")")),vb.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e0,tag:jy.TRACER}).onSuccess(),this.emit(_O.IceConnectionStateChange,e0)},t0.onICETransportStateChange=e0=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e0,")"))},t0.onDTLSTransportStateChange=e0=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e0,")"))},t0.onDTLSTransportError=e0=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e0,")"))},t0.onFirstAudioDecoded=e0=>{var n0;const r0=Array.from(d_(n0=this.remoteUserMap).call(n0)).find(o0=>o0._audioSSRC===e0);var i0;r0&&(this.store.subscribe(r0.uid,"audio",void 0,void 0,void 0,Date.now()),(i0=r0.audioTrack)===null||i0===void 0||i0.emit(IL.FIRST_FRAME_DECODED),vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_AUDIO_DECODE,Rb.FIRST_AUDIO_DECODE,{peer:r0._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e0),subscribeRequestid:e0,p2pid:this.store.p2pId}))},t0.onFirstAudioReceived=e0=>{var n0;const r0=Array.from(d_(n0=this.remoteUserMap).call(n0)).find(i0=>i0._audioSSRC===e0);r0&&vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_AUDIO_RECEIVED,Rb.FIRST_AUDIO_RECEIVED,{peer:r0._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e0),subscribeRequestid:e0,p2pid:this.store.p2pId})},t0.onFirstVideoDecoded=(e0,n0,r0)=>{this.reportVideoFirstFrameDecoded(e0,n0,r0)},t0.onFirstVideoReceived=e0=>{var n0;const r0=Array.from(d_(n0=this.remoteUserMap).call(n0)).find(i0=>i0._videoSSRC===e0);r0&&vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_VIDEO_RECEIVED,Rb.FIRST_VIDEO_RECEIVED,{peer:r0._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e0),subscribeRequestid:e0,p2pid:this.store.p2pId})},t0.onSelectedLocalCandidateChanged=(e0,n0)=>{const r0=e0.candidateType==="relay",i0=n0.candidateType==="relay";n0.candidateType!=="unknown"&&r0===i0||this.emit(_O.ConnectionTypeChange,r0),fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(nN(n0))," -> ").concat(JSON.stringify(nN(e0)),")"))},t0.onSelectedRemoteCandidateChanged=(e0,n0)=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(nN(n0))," -> ").concat(JSON.stringify(nN(e0)),")"))},t0.onFirstVideoDecodedTimeout=e0=>{this.reportVideoFirstFrameDecoded(e0,void 0,void 0,!0)},t0.onLocalCandidate=e0=>{this.emit(_O.LocalCandidate,{candidate:e0,direction:t0.direction})}}unbindConnectionEvents(t0){t0.onConnectionStateChange=void 0,t0.onICEConnectionStateChange=void 0,t0.onICETransportStateChange=void 0,t0.onDTLSTransportStateChange=void 0,t0.onDTLSTransportError=void 0,t0.onFirstAudioDecoded=void 0,t0.onFirstAudioReceived=void 0,t0.onFirstVideoDecoded=void 0,t0.onFirstVideoReceived=void 0,t0.onSelectedLocalCandidateChanged=void 0,t0.onSelectedRemoteCandidateChanged=void 0,t0.onFirstVideoDecodedTimeout=void 0,t0.onLocalCandidate=void 0}async handleDisconnect(t0){const e0=t0===Mw.SEND_ONLY?this.sendConnection:this.recvConnection;e0&&!e0.isInRestartIce&&(e0.isInRestartIce=!0,fb.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e0.name,"] start use restartICE")),t0===Mw.SEND_ONLY?this.restartICE(t0):Zy(this,_O.RequestP2PRestartICE,{direction:Mw.SEND_ONLY}))}filterTobeMutedTracks(t0){const e0=[];if(this.getAllTracks().indexOf(t0)===-1)return e0;const n0=this.localTrackMap.get(hO.LocalAudioTrack);if(t0 instanceof TM&&(n0==null?void 0:n0.track)instanceof RM)return n0.track.isActive||e0.push([hO.LocalAudioTrack,n0]),e0;const r0=Array.from(this.localTrackMap.entries()).find(i0=>{let[,{track:o0}]=i0;return t0===o0});if(r0&&(e0.push(r0),r0[0]===hO.LocalVideoTrack)){const i0=this.localTrackMap.get(hO.LocalVideoLowTrack);i0&&e0.push([hO.LocalVideoLowTrack,i0])}return e0}filterTobeUnmutedTracks(t0){const e0=[],n0=this.localTrackMap.get(hO.LocalAudioTrack);if(t0 instanceof TM&&(n0==null?void 0:n0.track)instanceof RM)return n0.track.isActive&&e0.push([hO.LocalAudioTrack,n0]),e0;const r0=Array.from(this.localTrackMap.entries()).find(i0=>{let[,{track:o0}]=i0;return t0===o0});if(r0)if(r0[0]===hO.LocalVideoTrack){e0.push(r0);const i0=this.localTrackMap.get(hO.LocalVideoLowTrack);i0&&e0.push([hO.LocalVideoLowTrack,i0])}else e0.push(r0);return e0}createMuteMessage(t0){return t0.map(e0=>{var n0;let r0,[i0,{track:o0,ssrcs:s0,id:a0}]=e0;switch(i0){case hO.LocalAudioTrack:r0=Zw.Audio;break;case hO.LocalVideoTrack:r0=Dn(n0=o0._hints).call(n0,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:r0=Zw.Low}return{stream_type:r0,ssrcs:s0,mid:a0}})}createUnmuteMessage(t0){return t0.map(e0=>{var n0;let r0,[i0,{track:o0,ssrcs:s0,id:a0}]=e0;switch(i0){case hO.LocalAudioTrack:r0=Zw.Audio;break;case hO.LocalVideoTrack:r0=Dn(n0=o0._hints).call(n0,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:r0=Zw.Low}return{stream_type:r0,ssrcs:s0,mid:a0}})}filterTobeUnSubscribedTracks(t0,e0){const n0=[],r0=this.remoteUserMap.get(t0);if(!r0)return n0;if(e0){const i0=r0.get(e0);if(!i0)return n0;n0.push([t0,{kind:e0,id:i0}])}else Array.from(r0.entries()).forEach(i0=>{let[o0,s0]=i0;n0.push([t0,{kind:o0,id:s0}])});return n0}createUnsubscribeMessage(t0){const e0=[];return t0.forEach(n0=>{let[r0,{kind:i0,id:o0}]=n0;switch(i0){case dO.VIDEO:return void(r0._videoSSRC&&e0.push({stream_type:dO.VIDEO,ssrcId:r0._videoSSRC}));case dO.AUDIO:return void(r0._audioSSRC&&e0.push({stream_type:dO.AUDIO,ssrcId:r0._audioSSRC}))}}),e0}withdrawRemoteTracks(t0){t0.forEach(e0=>{let[n0,{kind:r0}]=e0;const i0=this.remoteUserMap.get(n0);i0&&(i0.delete(r0),Array.from(i0.entries()).length===0&&this.remoteUserMap.delete(n0))})}async updateBitrateLimit(t0){const e0=this.localTrackMap.get(hO.LocalVideoTrack),n0=this.localTrackMap.get(hO.LocalVideoLowTrack);e0&&await e0.track.setBitrateLimit(t0.uplink),n0&&t0.low_stream_uplink&&await n0.track.setBitrateLimit({max_bitrate:t0.low_stream_uplink.bitrate,min_bitrate:t0.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t0=this.sendConnection.peerConnectionState,e0=this.recvConnection.peerConnectionState;return t0!=="connected"&&e0!=="connected"}return!0}async tryToUnmuteAudio(t0){for(let e0=0;e0<t0.length;e0++)if(t0[e0]instanceof TM){const n0=this.filterTobeUnmutedTracks(t0[e0]);if(n0.length===0)continue;const r0=this.createUnmuteMessage(n0);return void await $y(this,_O.RequestUnmuteLocal,r0)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t0=>this.getStats(t0),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t0=>{let[,{ssrcs:e0}]=t0;return!!e0}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t0=>{var e0;return!((e0=this.recvConnection)===null||e0===void 0||!e0.getRemoteVideoIsReady(t0))},this.statsUploader.requestUpload=(t0,e0)=>this.emit(_O.RequestUpload,t0,e0),this.statsUploader.requestUploadStats=t0=>this.emit(_O.RequestUploadStats,t0),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await mA(LA(this.dtlsFailedCount,PA)),this.emit(_O.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(hO.LocalVideoTrack)||this.pendingLocalTracks.some(t0=>t0 instanceof aU)}throwIfTrackTypeNotMatch(t0){if(t0.filter(e0=>e0 instanceof aU).length>1)throw new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t0.filter(e0=>e0 instanceof TM).length>1&&(t0.some(e0=>e0 instanceof TM&&e0._bypassWebAudio)||!ZP().webAudioMediaStreamDest))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e0 of t0){if(e0 instanceof aU&&this.pendingLocalTracks.some(n0=>n0 instanceof aU))throw new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e0 instanceof TM&&this.pendingLocalTracks.some(n0=>n0 instanceof TM)&&(!ZP().webAudioMediaStreamDest||e0._bypassWebAudio||this.pendingLocalTracks.some(n0=>n0 instanceof TM&&n0._bypassWebAudio)))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t0,e0){const n0=!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding,r0=AF(AF({},{width:160,height:120,framerate:15,bitrate:50}),e0);let i0;i0=n0?t0._mediaStreamTrack.clone():KV(t0,r0);const o0=TA(8,"track-low-"),s0=new aU(i0,AF(AF({},n0&&{scaleResolutionDownBy:iN(r0,t0)}),{},{frameRate:r0.framerate,bitrateMax:r0.bitrate,bitrateMin:r0.bitrate}),void 0,void 0,o0);return s0.on(RL.TRANSCEIVER_UPDATED,a0=>{t0._updateRtpTransceiver(a0,TL.LOW_STREAM)}),s0._hints.push(mL.LOW_STREAM),t0.addListener(fL.NEED_CLOSE,()=>{s0.close()}),s0}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t0,e0,n0,r0){var i0;const o0=Array.from(d_(i0=this.remoteUserMap).call(i0)).find(s0=>s0._videoSSRC===t0);if(o0){r0||this.store.subscribe(o0.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s0=this.store.keyMetrics,a0=s0.subscribe.find(c0=>c0.userId===o0.uid&&c0.type==="video");vb.firstRemoteVideoDecode(this.store.sessionId,gb.FIRST_VIDEO_DECODE,Rb.FIRST_VIDEO_DECODE,{peer:o0._uintid,videowidth:e0,videoheight:n0,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,t0),subscribeRequestid:t0,p2pid:this.store.p2pId,apEnd:s0.requestAPEnd||0,apStart:s0.requestAPStart||0,joinGwEnd:s0.joinGatewayEnd||0,joinGwStart:s0.joinGatewayStart||0,pcEnd:s0.peerConnectionEnd||0,pcStart:s0.peerConnectionStart||0,subscriberEnd:(a0==null?void 0:a0.subscribeEnd)||0,subscriberStart:(a0==null?void 0:a0.subscribeStart)||0,videoAddNotify:(a0==null?void 0:a0.streamAdded)||0,state:r0?1:0})}}async remoteMediaSsrcChanged(t0,e0,n0){if(!this.recvConnection)return!1;const r0=this.remoteUserMap.get(t0);if(!r0)return!1;const i0=r0.get(e0);if(!i0)return!1;const o0=await this.recvConnection.getRemoteSSRC(i0);return o0!==void 0&&o0!==n0}isPreSubScribe(t0){return!1}async publishDataChannel(t0){throw new Cy(Ry.NOT_SUPPORTED)}async unpublishDataChannel(t0){throw new Cy(Ry.NOT_SUPPORTED)}async subscribeDataChannel(t0,e0){throw new Cy(Ry.NOT_SUPPORTED)}async unsubscribeDataChannel(t0,e0){throw new Cy(Ry.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t0,e0){throw new Cy(Ry.NOT_SUPPORTED)}setPendingRemoteDataChannel(t0,e0){throw new Cy(Ry.NOT_SUPPORTED)}async preConnect(t0){throw new Cy(Ry.NOT_SUPPORTED)}getEstablishParams(){throw new Cy(Ry.NOT_SUPPORTED)}async reSubscribe(t0){throw new Cy(Ry.NOT_SUPPORTED)}async updateVideoStreamParameter(t0,e0){throw new Cy(Ry.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t0=>{let[e0,{track:n0}]=t0;e0===hO.LocalVideoLowTrack?n0._updateRtpTransceiver(void 0,TL.LOW_STREAM):n0._updateRtpTransceiver(void 0)})}},Cw(vF.prototype,"p2pConnect",[pF],Object.getOwnPropertyDescriptor(vF.prototype,"p2pConnect"),vF.prototype),Cw(vF.prototype,"unpublish",[_F],Object.getOwnPropertyDescriptor(vF.prototype,"unpublish"),vF.prototype),Cw(vF.prototype,"unpublishLowStream",[EF],Object.getOwnPropertyDescriptor(vF.prototype,"unpublishLowStream"),vF.prototype),Cw(vF.prototype,"subscribe",[fF],Object.getOwnPropertyDescriptor(vF.prototype,"subscribe"),vF.prototype),Cw(vF.prototype,"mockSubscribe",[mF],Object.getOwnPropertyDescriptor(vF.prototype,"mockSubscribe"),vF.prototype),Cw(vF.prototype,"unsubscribe",[TF],Object.getOwnPropertyDescriptor(vF.prototype,"unsubscribe"),vF.prototype),Cw(vF.prototype,"muteRemote",[SF],Object.getOwnPropertyDescriptor(vF.prototype,"muteRemote"),vF.prototype),Cw(vF.prototype,"unmuteRemote",[gF],Object.getOwnPropertyDescriptor(vF.prototype,"unmuteRemote"),vF.prototype),Cw(vF.prototype,"hasRemoteMediaWithLock",[RF],Object.getOwnPropertyDescriptor(vF.prototype,"hasRemoteMediaWithLock"),vF.prototype),Cw(vF.prototype,"disconnectForReconnect",[CF],Object.getOwnPropertyDescriptor(vF.prototype,"disconnectForReconnect"),vF.prototype),Cw(vF.prototype,"remoteMediaSsrcChanged",[IF],Object.getOwnPropertyDescriptor(vF.prototype,"remoteMediaSsrcChanged"),vF.prototype),vF);function wF(t0){return function(e0,n0,r0){const i0=e0[n0];if(typeof i0!="function")throw new Error("Cannot use mutex on object property.");return r0.value=async function(){for(var o0=arguments.length,s0=new Array(o0),a0=0;a0<o0;a0++)s0[a0]=arguments[a0];switch(t0){case dF.SEND_ONLY:{const c0=await this.sendMutex.lock("From P2PChannel2.".concat(n0));try{return await i0.apply(this,s0)}finally{c0()}}case dF.RECEIVE_ONLY:{const c0=await this.recvMutex.lock("From P2PChannel2.".concat(n0));try{return await i0.apply(this,s0)}finally{c0()}}default:{const c0=await this.sendMutex.lock("From P2PChannel2.".concat(n0)),u0=await this.recvMutex.lock("From P2PChannel2.".concat(n0));try{return await i0.apply(this,s0)}finally{c0(),u0()}}}},r0}}function OF(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function NF(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?OF(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):OF(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}class DF{constructor(e0){Fg(this,"store",void 0),Fg(this,"onStatsException",void 0),Fg(this,"onUploadPublishDuration",void 0),Fg(this,"onStatsChanged",void 0),Fg(this,"localStats",new Map),Fg(this,"remoteStats",new Map),Fg(this,"updateStatsInterval",void 0),Fg(this,"trafficStats",void 0),Fg(this,"trafficStatsPeerList",[]),Fg(this,"uplinkStats",void 0),Fg(this,"exceptionMonitor",void 0),Fg(this,"p2pChannel",void 0),Fg(this,"scalabilityMode",Iw.L1T1),Fg(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e0,this.exceptionMonitor=new iV,this.exceptionMonitor.on("exception",(n0,r0,i0)=>{this.onStatsException&&this.onStatsException(n0,r0,i0)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(hO.LocalAudioTrack)||NF({},AL)}getLocalVideoTrackStats(){return this.localStats.get(hO.LocalVideoTrack)||NF({},bL)}getRemoteAudioTrackStats(e0){const n0=(o0,s0)=>{if(!this.trafficStats)return s0;const a0=this.trafficStats.peer_delay.find(c0=>c0.peer_uid===o0);return a0&&(s0.publishDuration=a0.B_ppad+(Date.now()-this.trafficStats.timestamp)),s0},r0={};if(e0){var i0;const o0=(i0=this.remoteStats.get(e0))===null||i0===void 0?void 0:i0.audioStats;o0&&(r0[e0]=n0(e0,o0))}else Array.from(this.remoteStats.entries()).forEach(o0=>{let[s0,{audioStats:a0}]=o0;a0&&(r0[s0]=n0(s0,a0))});return r0}getRemoteNetworkQualityStats(e0){const n0={};if(e0){var r0;const i0=(r0=this.remoteStats.get(e0))===null||r0===void 0?void 0:r0.networkStats;i0&&(n0[e0]=i0)}else Array.from(this.remoteStats.entries()).forEach(i0=>{let[o0,{networkStats:s0}]=i0;s0&&(n0[o0]=s0)});return n0}getRemoteVideoTrackStats(e0){const n0=(o0,s0)=>{if(!this.trafficStats)return s0;const a0=this.trafficStats.peer_delay.find(c0=>c0.peer_uid===o0);return a0&&(s0.publishDuration=a0.B_ppvd+(Date.now()-this.trafficStats.timestamp)),s0},r0={};if(e0){var i0;const o0=(i0=this.remoteStats.get(e0))===null||i0===void 0?void 0:i0.videoStats;o0&&(r0[e0]=n0(e0,o0))}else Array.from(this.remoteStats.entries()).forEach(o0=>{let[s0,{videoStats:a0}]=o0;a0&&(r0[s0]=n0(s0,a0))});return r0}getRTCStats(){let e0=0,n0=0,r0=0,i0=0;const o0=this.localStats.get(hO.LocalAudioTrack);o0&&(e0+=o0.sendBytes,n0+=o0.sendBitrate);const s0=this.localStats.get(hO.LocalVideoTrack);s0&&(e0+=s0.sendBytes,n0+=s0.sendBitrate);const a0=this.localStats.get(hO.LocalVideoLowTrack);a0&&(e0+=a0.sendBytes,n0+=a0.sendBitrate),this.remoteStats.forEach(u0=>{let{audioStats:l0,videoStats:d0}=u0;l0&&(r0+=l0.receiveBytes,i0+=l0.receiveBitrate),d0&&(r0+=d0.receiveBytes,i0+=d0.receiveBitrate)});let c0=1;return this.trafficStats&&(c0+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:c0,SendBitrate:n0,SendBytes:e0,RecvBytes:r0,RecvBitrate:i0,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e0){this.localStats.set(e0,void 0)}removeLocalStats(e0){e0?this.localStats.delete(e0):this.localStats.clear()}addRemoteStats(e0){this.remoteStats.set(e0,{})}removeRemoteStats(e0){e0?this.remoteStats.delete(e0):this.remoteStats.clear()}addP2PChannel(e0){this.p2pChannel=e0}updateTrafficStats(e0){e0.peer_delay=e0.peer_delay.filter(n0=>n0.B_ppad!==void 0||n0.B_ppvd!==void 0),e0.peer_delay.filter(n0=>this.trafficStatsPeerList.indexOf(n0.peer_uid)===-1).forEach(n0=>{var r0;const i0=(r0=this.p2pChannel)===null||r0===void 0?void 0:r0.getRemoteMedia(n0.peer_uid),o0=i0!=null&&i0.videoSSRC?rV.measureFromSubscribeStart(this.store.clientId,i0.videoSSRC):0,s0=i0!=null&&i0.audioSSRC?rV.measureFromSubscribeStart(this.store.clientId,i0.audioSSRC):0;n0.B_ppad!==void 0&&n0.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n0.peer_uid,n0.B_ppad,n0.B_ppvd,o0>s0?o0:s0),this.trafficStatsPeerList.push(n0.peer_uid))}),this.trafficStats=e0}updateUplinkStats(e0){this.uplinkStats&&this.uplinkStats.B_fir!==e0.B_fir&&fb.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e0.B_fir)),this.uplinkStats=e0}static isRemoteVideoFreeze(e0,n0,r0){if(!e0)return!1;const i0=!!r0&&n0.framesDecodeFreezeTime>r0.framesDecodeFreezeTime,o0=!r0||n0.framesDecodeCount>r0.framesDecodeCount;return i0||!o0}static isRemoteAudioFreeze(e0){return!!e0&&e0._isFreeze()}isLocalVideoFreeze(e0){return!(!e0.inputFrame||!e0.sentFrame)&&e0.inputFrame.frameRate>5&&e0.sentFrame.frameRate<3}updateLocalStats(e0){Array.from(this.localStats.entries()).forEach(n0=>{let[r0,i0]=n0;switch(r0){case hO.LocalVideoTrack:case hO.LocalVideoLowTrack:{const s0=i0,a0=NF({},bL),c0=e0.getStats(),u0=e0.getLocalMedia(r0);if(c0){const l0=c0.videoSend.find(d0=>d0.ssrc===(u0==null?void 0:u0.ssrcs[0].ssrcId));if(l0){const d0=e0.getLocalVideoSize(),h0=e0.getEncoderConfig(hO.LocalVideoTrack);l0.codec!=="H264"&&l0.codec!=="H265"&&l0.codec!=="VP8"&&l0.codec!=="VP9"&&l0.codec!=="AV1X"&&l0.codec!=="AV1"||(a0.codecType=l0.codec),a0.sendBytes=l0.bytes,a0.sendBitrate=s0?8*Math.max(0,a0.sendBytes-s0.sendBytes):0,l0.inputFrame?(a0.captureFrameRate=l0.inputFrame.frameRate,a0.captureResolutionHeight=l0.inputFrame.height,a0.captureResolutionWidth=l0.inputFrame.width):d0&&(a0.captureResolutionWidth=d0.width,a0.captureResolutionHeight=d0.height),l0.sentFrame?(a0.sendFrameRate=l0.sentFrame.frameRate,a0.sendResolutionHeight=l0.sentFrame.height,a0.sendResolutionWidth=l0.sentFrame.width):d0&&(a0.sendResolutionWidth=d0.width,a0.sendResolutionHeight=d0.height),l0.avgEncodeMs&&(a0.encodeDelay=l0.avgEncodeMs),h0&&h0.bitrateMax&&(a0.targetSendBitrate=1e3*h0.bitrateMax),a0.sendPackets=l0.packets,a0.sendPacketsLost=l0.packetsLost,a0.sendJitterMs=l0.jitterMs,a0.sendRttMs=l0.rttMs,a0.totalDuration=s0?s0.totalDuration+1:1,a0.totalFreezeTime=s0?s0.totalFreezeTime:0,this.isLocalVideoFreeze(l0)&&(a0.totalFreezeTime+=1),l0.scalabilityMode&&this.scalabilityMode!==l0.scalabilityMode&&(fb.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(l0.scalabilityMode)),this.scalabilityMode=l0.scalabilityMode)}this.trafficStats&&(a0.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o0;this.localStats.set(r0,a0),((s0==null?void 0:s0.sendResolutionWidth)!==a0.sendResolutionWidth||(s0==null?void 0:s0.sendResolutionHeight)!==a0.sendResolutionHeight)&&((o0=this.onStatsChanged)===null||o0===void 0||o0.call(this,"resolution",{width:a0.sendResolutionWidth,height:a0.sendResolutionHeight})),a0&&u0&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,u0.track,a0);break}case hO.LocalAudioTrack:{const s0=i0,a0=NF({},AL),c0=e0.getStats(),u0=e0.getLocalMedia(r0);if(c0){const l0=c0.audioSend.find(d0=>d0.ssrc===(u0==null?void 0:u0.ssrcs[0].ssrcId));if(l0){if(l0.codec!=="opus"&&l0.codec!=="aac"&&l0.codec!=="PCMU"&&l0.codec!=="PCMA"&&l0.codec!=="G722"||(a0.codecType=l0.codec),l0.inputLevel)a0.sendVolumeLevel=Math.round(32767*l0.inputLevel);else{const d0=e0.getLocalAudioVolume();d0&&(a0.sendVolumeLevel=Math.round(32767*d0))}a0.sendBytes=l0.bytes,a0.sendPackets=l0.packets,a0.sendPacketsLost=l0.packetsLost,a0.sendJitterMs=l0.jitterMs,a0.sendRttMs=l0.rttMs,a0.sendBitrate=s0?8*Math.max(0,a0.sendBytes-s0.sendBytes):0}}this.trafficStats&&(a0.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(hO.LocalAudioTrack,a0),a0&&u0&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,u0.track,a0);break}}})}updateRemoteStats(e0){Array.from(this.remoteStats.entries()).forEach(n0=>{var r0,i0;let[o0,{videoStats:s0,audioStats:a0,videoPcStats:c0}]=n0;const u0=a0,l0=s0,d0=c0,h0=NF({},wL),p0=NF({},NL),m0=NF({},OL),{audioTrack:f0,videoTrack:g0,audioSSRC:E0,videoSSRC:_0}=e0.getRemoteMedia(o0);let y0;y0=e0 instanceof bF?e0.getStats(!0):e0.getStats();const b0=(r0=y0)===null||r0===void 0?void 0:r0.audioRecv.find(I0=>I0.ssrc===E0),S0=(i0=y0)===null||i0===void 0?void 0:i0.videoRecv.find(I0=>I0.ssrc===_0),w0=this.trafficStats&&this.trafficStats.peer_delay.find(I0=>I0.peer_uid===o0);if(b0&&(b0.codec!=="opus"&&b0.codec!=="aac"&&b0.codec!=="PCMU"&&b0.codec!=="PCMA"&&b0.codec!=="G722"||(h0.codecType=b0.codec),b0.outputLevel?h0.receiveLevel=Math.round(32767*b0.outputLevel):f0&&(h0.receiveLevel=Math.round(32767*f0.getVolumeLevel())),h0.receiveBytes=b0.bytes,h0.receivePackets=b0.packets,h0.receivePacketsLost=b0.packetsLost,h0.receivePacketsDiscarded=b0.packetsDiscarded,h0.packetLossRate=h0.receivePacketsLost/(h0.receivePackets+h0.receivePacketsLost),h0.receiveBitrate=u0?8*Math.max(0,h0.receiveBytes-u0.receiveBytes):0,h0.totalDuration=u0?u0.totalDuration+1:1,h0.totalFreezeTime=u0?u0.totalFreezeTime:0,h0.freezeRate=h0.totalFreezeTime/h0.totalDuration,h0.receiveDelay=b0.jitterBufferMs,h0.totalDuration>10&&DF.isRemoteAudioFreeze(f0)&&(h0.totalFreezeTime+=1)),S0){S0.codec!=="H264"&&S0.codec!=="H265"&&S0.codec!=="VP8"&&S0.codec!=="VP9"&&S0.codec!=="AV1X"&&S0.codec!=="AV1"||(p0.codecType=S0.codec),p0.receiveBytes=S0.bytes,p0.receiveBitrate=l0?8*Math.max(0,p0.receiveBytes-l0.receiveBytes):0,p0.decodeFrameRate=S0.decodeFrameRate<0?0:S0.decodeFrameRate,p0.renderFrameRate=S0.decodeFrameRate<0?0:S0.decodeFrameRate,S0.outputFrame&&(p0.renderFrameRate=S0.outputFrame.frameRate),S0.receivedFrame?(p0.receiveFrameRate=S0.receivedFrame.frameRate,p0.receiveResolutionHeight=S0.receivedFrame.height,p0.receiveResolutionWidth=S0.receivedFrame.width):g0&&(p0.receiveResolutionHeight=g0._videoHeight||0,p0.receiveResolutionWidth=g0._videoWidth||0),S0.framesRateFirefox!==void 0&&(p0.receiveFrameRate=Math.round(S0.framesRateFirefox)),p0.receivePackets=S0.packets,p0.receivePacketsLost=S0.packetsLost,p0.packetLossRate=p0.receivePacketsLost/(p0.receivePackets+p0.receivePacketsLost),p0.totalDuration=l0?l0.totalDuration+1:1,p0.totalFreezeTime=l0?l0.totalFreezeTime:0,p0.receiveDelay=S0.jitterBufferMs||0;const I0=!!_0&&e0.getRemoteVideoIsReady(_0);g0&&I0&&DF.isRemoteVideoFreeze(g0,S0,d0)&&(p0.totalFreezeTime+=1),p0.freezeRate=p0.totalFreezeTime/p0.totalDuration}w0&&(h0.end2EndDelay=w0.B_ad,p0.end2EndDelay=w0.B_vd,h0.transportDelay=w0.B_ed,p0.transportDelay=w0.B_ed,h0.currentPacketLossRate=w0.B_ealr4/100,p0.currentPacketLossRate=w0.B_evlr4/100,m0.uplinkNetworkQuality=w0.B_punq?w0.B_punq:0,m0.downlinkNetworkQuality=w0.B_pdnq?w0.B_pdnq:0),this.remoteStats.set(o0,{audioStats:h0,videoStats:p0,videoPcStats:S0,networkStats:m0}),f0&&this.exceptionMonitor.setRemoteAudioStats(f0,h0),g0&&this.exceptionMonitor.setRemoteVideoStats(g0,p0)})}}class PF{constructor(){Fg(this,"destChannelMediaInfos",new Map),Fg(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e0){qw(e0),this.srcChannelMediaInfo=e0}addDestChannelInfo(e0){qw(e0),this.destChannelMediaInfos.set(e0.channelName,e0)}removeDestChannelInfo(e0){xw(e0),this.destChannelMediaInfos.delete(e0)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function LF(t0){if(!(t0 instanceof PF))return new yb(Ry.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e0=t0.getSrcChannelMediaInfo(),n0=t0.getDestChannelMediaInfo();if(!e0)return new yb(Ry.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n0.size===0)return new yb(Ry.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function kF(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function MF(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?kF(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):kF(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}var UF;function xF(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function VF(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?xF(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):xF(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}let FF=(UF=class c1 extends cO{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e0=>e0.rtpMap&&e0.rtpMap.encodingName.toLowerCase()||"").filter(e0=>{var n0;return Dn(n0=Object.keys(eb)).call(n0,e0)}))]}constructor(e0,n0){super(e0,n0),Fg(this,"store",void 0),Fg(this,"peerConnection",void 0),Fg(this,"remoteSDP",void 0),Fg(this,"initialOffer",void 0),Fg(this,"statsFilter",void 0),Fg(this,"useRTX",!1),Fg(this,"localCapabilities",void 0),Fg(this,"localCandidateCount",0),Fg(this,"allCandidatesReceived",!1),Fg(this,"establishPromise",void 0),Fg(this,"mutex",new NA("P2PConnection-mutex")),this.store=n0,this.peerConnection=new RTCPeerConnection(c1.resolvePCConfiguration(e0),{optional:[{googDscp:!0}]}),this.statsFilter=xV(this.peerConnection,XA("STATS_UPDATE_INTERVAL"),void 0,Zv()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e0=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e0.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n0=HU(e0.sdp),r0=WU(e0.sdp,{filterRTX:!this.useRTX,filterVideoFec:XA("FILTER_VIDEO_FEC"),filterAudioFec:XA("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r0,this.initialOffer=e0,VF(VF({},n0),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r0},offerSDP:e0.sdp})}catch(e0){throw new Cy(Ry.GET_LOCAL_CONNECTION_PARAMS_FAILED,e0.toString())}}async updateRemoteConnect(){}async connect(e0){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(r0){Fg(this,"sessionDesc",void 0),Fg(this,"localCapabilities",void 0),Fg(this,"rtpCapabilities",void 0),Fg(this,"candidates",void 0),Fg(this,"iceParameters",void 0),Fg(this,"dtlsParameters",void 0),Fg(this,"setup",void 0),Fg(this,"currentMidIndex",void 0),Fg(this,"cname",void 0),r0=sA(r0);const{iceParameters:i0,dtlsParameters:o0,candidates:s0,rtpCapabilities:a0,setup:c0,localCapabilities:u0,sdkCodec:l0,cname:d0}=r0,h0=FU.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a0,this.candidates=s0,this.iceParameters=i0,this.dtlsParameters=o0,this.setup=c0,this.localCapabilities=u0,this.cname=d0;for(let p0=0;p0<h0.mediaDescriptions.length;p0++){const m0=h0.mediaDescriptions[p0];if(m0.attributes.iceUfrag=i0.iceUfrag,m0.attributes.icePwd=i0.icePwd,m0.attributes.fingerprints=o0.fingerprints,m0.attributes.candidates=s0,m0.attributes.setup=c0,m0.media.mediaType==="video"){m0.media.fmts=a0.videoCodecs.map(g0=>g0.payloadType.toString(10));let f0=a0.videoCodecs.filter(g0=>{var E0,_0;return(E0=g0.rtpMap)===null||E0===void 0?void 0:Dn(_0=E0.encodingName.toLowerCase()).call(_0,l0)});f0.length===0&&(f0=a0.videoCodecs),m0.attributes.payloads=f0,m0.attributes.extmaps=a0.videoExtensions}m0.media.mediaType==="audio"&&(m0.media.fmts=a0.audioCodecs.map(f0=>f0.payloadType.toString(10)),m0.attributes.payloads=a0.audioCodecs,m0.attributes.extmaps=a0.audioExtensions),h0.mediaDescriptions[p0]=this.mungMediaDesc(m0)}this.sessionDesc=h0,this.currentMidIndex=h0.mediaDescriptions.length-1}toString(){return FU.print(this.sessionDesc)}send(r0,i0,o0){const{ssrcs:s0,ssrcGroups:a0}=zU(i0,this.cname),c0=this.sessionDesc.mediaDescriptions.find(d0=>r0===dO.VIDEO?d0.media.mediaType==="video":d0.media.mediaType==="audio"),u0=s0[0].attributes.label,l0=s0[0].attributes.mslabel;return c0.attributes.ssrcs=c0.attributes.ssrcs.concat(s0),c0.attributes.ssrcGroups=c0.attributes.ssrcGroups.concat(a0),{id:u0,mslabel:l0}}batchSend(r0){return r0.map(i0=>{let{kind:o0,ssrcMsg:s0}=i0;return this.send(o0,s0,void 0)})}stopSending(r0){this.sessionDesc.mediaDescriptions.forEach(i0=>{const o0=[],s0=[],a0=[];i0.attributes.ssrcs.forEach(c0=>{Dn(r0).call(r0,c0.attributes.label||"")?a0.push(c0):o0.push(c0)}),i0.attributes.ssrcGroups.forEach(c0=>{var u0;Dn(u0=a0.map(l0=>l0.ssrcId)).call(u0,c0.ssrcIds[0])||s0.push(c0)}),i0.attributes.ssrcs=o0,i0.attributes.ssrcGroups=s0})}mute(r0){const i0=this.sessionDesc.mediaDescriptions.find(o0=>o0.attributes.mid===r0);if(!i0)throw new Error("mediaDescription not found with ".concat(r0," in remote SDP when calling RemoteSDP.mute."));i0.attributes.direction="inactive"}unmute(r0){const i0=this.sessionDesc.mediaDescriptions.find(o0=>o0.attributes.mid===r0);if(!i0)throw new Error("mediaDescription not found with ".concat(r0," in remote SDP when calling RemoteSDP.unmute."));i0.attributes.direction="sendonly"}receive(r0,i0,o0){r0.forEach((s0,a0)=>{const c0=s0._mediaStreamTrack,u0=this.sessionDesc.mediaDescriptions.findIndex(d0=>d0.attributes.mid===c0.kind),l0=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u0],s0);this.sessionDesc.mediaDescriptions[u0]=l0})}stopReceiving(r0){}updateCandidates(r0){r0===lO.TCP?this.candidates.forEach(i0=>{this.candidates.findIndex(o0=>o0.transport==="tcp"&&o0.connectionAddress===i0.connectionAddress&&o0.port===i0.port)===-1&&this.candidates.push(MF(MF({},i0),{},{foundation:"tcpcandidate",priority:Number(i0.priority)-1+"",transport:"tcp",port:Number(i0.port)+90+""}))}):this.candidates=this.candidates.filter(i0=>i0.transport!=="tcp");for(const i0 of this.sessionDesc.mediaDescriptions)i0.attributes.candidates=this.candidates}restartICE(r0){r0=sA(r0),this.iceParameters=r0,this.sessionDesc.mediaDescriptions.forEach(i0=>{i0.attributes.iceUfrag=r0.iceUfrag,i0.attributes.icePwd=r0.icePwd})}predictReceivingMids(r0){const i0=[];for(let o0=0;o0<r0;o0++)i0.push((this.currentMidIndex+o0+1).toString(10));return i0}mungRecvMediaDsec(r0,i0){const o0=sA(r0);return JU(o0,i0),QU(o0,i0),o0}updateRecvMedia(r0,i0){const o0=this.sessionDesc.mediaDescriptions.findIndex(s0=>s0.attributes.mid===r0);if(o0!==-1){const s0=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o0],i0);this.sessionDesc.mediaDescriptions[o0]=s0}}bumpMid(r0){this.currentMidIndex+=r0}updateTrackLabel(r0,i0,o0){const s0=this.sessionDesc.mediaDescriptions.find(c0=>r0===dO.VIDEO?c0.attributes.mid==="video":c0.attributes.mid==="audio");if(s0){const c0=s0.attributes.ssrcs.find(u0=>u0.attributes.label===i0);var a0;c0&&(c0.attributes.label=o0,(a0=c0.attributes.msid)===null||a0===void 0||a0.replace(i0,o0))}}mungMediaDesc(r0){const i0=sA(r0);return XU(i0),function(o0){const s0=o0.attributes.extmaps.find(a0=>a0.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s0&&o0.attributes.extmaps.splice(o0.attributes.extmaps.indexOf(s0),1),o0.attributes.payloads.forEach(a0=>{const c0=a0.rtcpFeedbacks.findIndex(u0=>u0.type==="transport-cc");c0!==-1&&a0.rtcpFeedbacks.splice(c0,1)})}(i0),i0}getSSRC(r0){for(const i0 of this.sessionDesc.mediaDescriptions)for(const o0 of i0.attributes.ssrcs)if(o0.attributes.label===r0)return[o0]}}(VF(VF({},e0),{},{rtpCapabilities:e0.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n0=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n0})}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n0.toString()))}}async updateRemoteRTPCapabilities(e0,n0){throw new Cy(Ry.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e0){}send(e0,n0){var r0=this;return YI(function*(){const i0=yield qI(r0.mutex.lock());try{if(!r0.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o0=e0.map(h0=>r0.peerConnection.addTrack(h0._mediaStreamTrack)),s0=yield qI(r0.peerConnection.createOffer()),a0=FU.parse(s0.sdp),c0=e0.map(h0=>{const p0=h0._mediaStreamTrack,m0=a0.mediaDescriptions.find(f0=>f0.attributes.mid===p0.kind);if(!m0)throw new Error("Cannot extract ssrc from mediaDescription.");return function(f0,g0,E0){const _0=f0.attributes.ssrcs.filter(b0=>b0.attributes.label===g0),y0=f0.attributes.ssrcGroups;if(_0.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(y0&&_0.length>1){const b0=y0.find(S0=>S0.ssrcIds.indexOf(_0[0].ssrcId)!==-1);return b0?[{ssrcId:b0.ssrcIds[0],rtx:E0?b0.ssrcIds[1]:void 0}]:[{ssrcId:_0[0].ssrcId}]}return[{ssrcId:_0[0].ssrcId}]}(m0,p0.id,r0.useRTX)});let u0;try{u0=yield c0}catch(h0){throw o0.forEach(p0=>{Xv()&&p0.replaceTrack(null),r0.peerConnection.removeTrack(p0)}),h0}const l0=r0.mungSendOfferSDP(s0.sdp,e0);r0.remoteSDP.receive(e0,n0,u0);const d0=r0.remoteSDP.toString();return yield qI(r0.peerConnection.setLocalDescription({type:"offer",sdp:l0})),yield qI(r0.applySendEncodings(o0,e0)),yield qI(r0.peerConnection.setRemoteDescription({type:"answer",sdp:d0})),e0.map((h0,p0)=>{const m0=h0._mediaStreamTrack.id;return{localSSRC:c0[p0],id:m0}})}catch(o0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o0.toString()))}finally{i0()}})()}async stopSending(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n0=this.peerConnection.getSenders().filter(o0=>{var s0;return e0.indexOf(((s0=o0.track)===null||s0===void 0?void 0:s0.id)||"")!==-1});if(n0.length!==e0.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n0.map(o0=>{Xv()&&o0.replaceTrack(null),this.peerConnection.removeTrack(o0)});const r0=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r0),this.remoteSDP.stopReceiving(e0);const i0=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i0})}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n0.toString()))}}async receive(e0,n0,r0,i0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e0," before remoteSDP created."));const{id:o0,mslabel:s0}=this.remoteSDP.send(e0,n0,i0),a0=new Gh((l0,d0)=>{const h0=setTimeout(()=>{d0(new Error("Cannot receive track, id: ".concat(o0)))},1e4),p0=m0=>{const f0=Hv();if((f0.name==="Safari"&&Number(f0.version)===11||$v())&&m0.track.id!==o0&&m0.streams[0].id===s0){var g0;const E0=m0.streams[0].getTracks()[0];return(g0=this.remoteSDP)===null||g0===void 0||g0.updateTrackLabel(e0,o0,m0.track.id),this.peerConnection.removeEventListener("track",p0),clearTimeout(h0),void l0(E0)}if(m0.track.id===o0)return this.peerConnection.removeEventListener("track",p0),clearTimeout(h0),void l0(m0.track)};this.peerConnection.addEventListener("track",p0)}),c0=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c0});const u0=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(u0),{track:await a0,id:o0}}catch(o0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o0.toString()))}}async stopReceiving(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e0);const n0=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n0});const r0=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r0)}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n0.toString()))}}async muteRemote(e0){}async unmuteRemote(e0){}async muteLocal(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n0=this.peerConnection.getSenders().filter(r0=>{var i0;return e0.indexOf(((i0=r0.track)===null||i0===void 0?void 0:i0.id)||"")!==-1});if(n0.length!==e0.length)throw new Error("sender' length doesn't match mids' length.");n0.map(r0=>{if(Xv()&&r0.track)r0.track.enabled=!1;else{const i0=r0.getParameters();i0.encodings.forEach(o0=>o0.active=!1),r0.setParameters(i0)}})}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n0.toString()))}}async unmuteLocal(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n0=this.peerConnection.getSenders().filter(o0=>{var s0;return e0.indexOf(((s0=o0.track)===null||s0===void 0?void 0:s0.id)||"")!==-1});if(n0.length!==e0.length)throw new Error("Senders' length doesn't match mids' length.");n0.map(async o0=>{if(Xv()&&o0.track)o0.track.enabled=!0;else{const s0=o0.getParameters();s0.encodings.forEach(a0=>a0.active=!0),await o0.setParameters(s0)}});const r0=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r0);const i0=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i0})}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n0.toString()))}}restartICE(e0){var n0=this;return YI(function*(){const r0=yield qI(n0.mutex.lock("From P2PConnection.restartICE"));try{if(!n0.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ZP().supportPCSetConfiguration){const c0=n0.peerConnection.getConfiguration(),u0=e0===lO.RELAY?"relay":"all";c0.iceTransportPolicy!==u0&&(fb.debug("[".concat(n0.store.clientId,"] restartICE change iceTransportPolicy from [").concat(c0.iceTransportPolicy,"] to [").concat(u0,"]")),c0.iceTransportPolicy=u0,n0.peerConnection.setConfiguration(c0))}else if(e0===lO.RELAY)return;e0!==lO.RELAY&&n0.remoteSDP.updateCandidates(e0);const i0=yield qI(n0.peerConnection.createOffer({iceRestart:!0}));if(!i0.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o0=HU(i0.sdp),{remoteIceParameters:s0}=yield o0.iceParameters;n0.remoteSDP.restartICE(s0);const a0=n0.remoteSDP.toString();yield qI(n0.peerConnection.setLocalDescription(i0)),yield qI(n0.peerConnection.setRemoteDescription({type:"answer",sdp:a0}))}catch(i0){fb.warning("[".concat(n0.store.clientId,"] restart ICE failed, abort operation"),i0)}finally{r0()}})()}close(){var e0;this.peerConnection.close(),(e0=this.onConnectionStateChange)===null||e0===void 0||e0.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e0){return this.statsFilter.getVideoIsReady(e0)}async updateEncoderConfig(e0,n0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r0=await this.peerConnection.createOffer(),i0=this.mungSendOfferSDP(r0.sdp,[n0]);this.remoteSDP.updateRecvMedia(n0._mediaStreamTrack.kind,n0);const o0=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i0}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o0})}catch(r0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,r0.toString())}}async updateSendParameters(e0,n0){const r0=this.peerConnection.getSenders().filter(i0=>{var o0;return((o0=i0.track)===null||o0===void 0?void 0:o0.id)===e0});r0.length===1&&await this.applySendEncodings(r0,[n0])}setStatsRemoteVideoIsReady(e0,n0){this.statsFilter.setVideoIsReady2(e0,n0)}async replaceTrack(e0,n0){const r0=this.peerConnection.getSenders().find(i0=>{var o0;return((o0=i0.track)===null||o0===void 0?void 0:o0.id)===n0});r0&&await r0.replaceTrack(e0._mediaStreamTrack)}createDataChannels(e0,n0){throw new Cy(Ry.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e0){throw new Cy(Ry.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e0;(e0=this.onICEConnectionStateChange)===null||e0===void 0||e0.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e0;(e0=this.onConnectionStateChange)===null||e0===void 0||e0.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e0=>{e0.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,fb.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,fb.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},XA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e0){const n0={iceServers:[],sdpSemantics:"plan-b"};return e0.iceServers?n0.iceServers=e0.iceServers:e0.turnServer&&e0.turnServer.mode!=="off"&&(Ky(e0.turnServer.servers)?n0.iceServers=e0.turnServer.servers:(n0.iceServers&&n0.iceServers.push(...c1.turnServerConfigToIceServers(e0.turnServer.servers)),XA("USE_TURN_SERVER_OF_GATEWAY")&&n0.iceServers&&e0.turnServer.serversFromGateway&&n0.iceServers.push(...c1.turnServerConfigToIceServers(e0.turnServer.serversFromGateway)),e0.turnServer.servers.concat(e0.turnServer.serversFromGateway||[]).forEach(r0=>{r0.forceturn&&(n0.iceTransportPolicy="relay")}))),n0}static turnServerConfigToIceServers(e0){const n0=[];return e0.forEach(r0=>{r0.security?r0.tcpport&&n0.push({username:r0.username,credential:r0.password,credentialType:"password",urls:"turns:".concat(r0.turnServerURL,":").concat(r0.tcpport,"?transport=tcp")}):(r0.udpport&&n0.push({username:r0.username,credential:r0.password,credentialType:"password",urls:"turn:".concat(r0.turnServerURL,":").concat(r0.udpport,"?transport=udp")}),r0.tcpport&&n0.push({username:r0.username,credential:r0.password,credentialType:"password",urls:"turn:".concat(r0.turnServerURL,":").concat(r0.tcpport,"?transport=tcp")}))}),n0}async updateRtpSenderEncodings(e0,n0){var r0;if(n0||(n0=this.peerConnection.getSenders().find(u0=>{var l0;return((l0=u0.track)===null||l0===void 0?void 0:l0.id)===e0._mediaStreamTrack.id})),!n0)return fb.warn("[".concat(e0.getTrackId(),"] no rtpSender found}"));if(!ZP().supportSetRtpSenderParameters)return fb.warn("Browser not support set rtp-sender parameters");const i0={},o0={};if(e0 instanceof aU)switch(e0._optimizationMode){case"motion":i0.degradationPreference="maintain-framerate";break;case"detail":i0.degradationPreference="maintain-resolution";break;default:i0.degradationPreference="balanced"}if(XA("DSCP_TYPE")&&Ey()){var s0;const u0=XA("DSCP_TYPE");Dn(s0=["very-low","low","medium","high"]).call(s0,u0)&&(o0.networkPriority=u0)}const a0=n0.getParameters(),c0=(r0=a0.encodings)===null||r0===void 0?void 0:r0[0];c0&&Object.assign(c0,o0),Object.assign(a0,i0),fb.debug("[".concat(e0.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a0.encodings))),await n0.setParameters(a0)}async applySendEncodings(e0,n0){try{if(!ZP().supportSetRtpSenderParameters||e0.length!==n0.length)return;for(let r0=0;r0<e0.length;r0++){const i0=e0[r0],o0=n0[r0];i0&&o0&&await this.updateRtpSenderEncodings(o0,i0)}}catch{fb.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e0,n0){const r0=FU.parse(e0);return n0.forEach((i0,o0)=>{const s0=i0._mediaStreamTrack,a0=r0.mediaDescriptions.find(c0=>c0.attributes.mid===s0.kind);a0&&JU(a0,i0)}),FU.print(r0)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e0=>{var n0;(n0=this.onFirstAudioReceived)===null||n0===void 0||n0.call(this,e0)},this.statsFilter.onFirstVideoReceived=e0=>{var n0;(n0=this.onFirstVideoReceived)===null||n0===void 0||n0.call(this,e0)},this.statsFilter.onFirstAudioDecoded=e0=>{var n0;(n0=this.onFirstAudioDecoded)===null||n0===void 0||n0.call(this,e0)},this.statsFilter.onFirstVideoDecoded=(e0,n0,r0)=>{var i0;(i0=this.onFirstVideoDecoded)===null||i0===void 0||i0.call(this,e0,n0,r0)},this.statsFilter.onSelectedLocalCandidateChanged=(e0,n0)=>{var r0;(r0=this.onSelectedLocalCandidateChanged)===null||r0===void 0||r0.call(this,e0,n0)},this.statsFilter.onSelectedRemoteCandidateChanged=(e0,n0)=>{var r0;(r0=this.onSelectedRemoteCandidateChanged)===null||r0===void 0||r0.call(this,e0,n0)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n0=this.remoteSDP.batchSend(e0).map((o0,s0)=>{let{id:a0,mslabel:c0}=o0;const{kind:u0}=e0[s0];return new Gh((l0,d0)=>{const h0=setTimeout(()=>{d0(new Error("Cannot receive track, id: ".concat(a0)))},1e4),p0=m0=>{const f0=Hv();if(f0.name==="Safari"&&Number(f0.version)===11&&m0.track.id!==a0&&m0.streams[0].id===c0){var g0;const E0=m0.streams[0].getTracks()[0];return(g0=this.remoteSDP)===null||g0===void 0||g0.updateTrackLabel(u0,a0,m0.track.id),this.peerConnection.removeEventListener("track",p0),clearTimeout(h0),void l0({track:E0,id:a0})}if(m0.track.id===a0)return this.peerConnection.removeEventListener("track",p0),clearTimeout(h0),void l0({track:m0.track,id:a0})};this.peerConnection.addEventListener("track",p0)})}),r0=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r0});const i0=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i0),await Gh.all(n0)}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n0.toString()))}}async getRemoteSSRC(e0){if(!this.remoteSDP)return;const n0=this.remoteSDP.getSSRC(e0);return n0==null?void 0:n0[0].ssrcId}setConfiguration(e0){if(ZP().supportPCSetConfiguration){const n0=c1.resolvePCConfiguration(e0);this.peerConnection.setConfiguration(n0)}}},Cw(UF.prototype,"connect",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"connect"),UF.prototype),Cw(UF.prototype,"stopSending",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"stopSending"),UF.prototype),Cw(UF.prototype,"receive",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"receive"),UF.prototype),Cw(UF.prototype,"stopReceiving",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"stopReceiving"),UF.prototype),Cw(UF.prototype,"muteRemote",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"muteRemote"),UF.prototype),Cw(UF.prototype,"unmuteRemote",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"unmuteRemote"),UF.prototype),Cw(UF.prototype,"muteLocal",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"muteLocal"),UF.prototype),Cw(UF.prototype,"unmuteLocal",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"unmuteLocal"),UF.prototype),Cw(UF.prototype,"close",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"close"),UF.prototype),Cw(UF.prototype,"updateEncoderConfig",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"updateEncoderConfig"),UF.prototype),Cw(UF.prototype,"updateSendParameters",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"updateSendParameters"),UF.prototype),Cw(UF.prototype,"replaceTrack",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"replaceTrack"),UF.prototype),Cw(UF.prototype,"getRemoteSSRC",[BF],Object.getOwnPropertyDescriptor(UF.prototype,"getRemoteSSRC"),UF.prototype),UF);function BF(t0,e0,n0){const r0=t0[e0];if(typeof r0!="function")throw new Error("Cannot use mutex on object property.");return n0.value=async function(){const i0=this.mutex,o0=await i0.lock("Locking from P2PConnection.".concat(e0));try{for(var s0=arguments.length,a0=new Array(s0),c0=0;c0<s0;c0++)a0[c0]=arguments[c0];return await r0.apply(this,a0)}finally{o0()}},n0}function jF(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function GF(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?jF(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):jF(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}const WF="9",HF=4e4;class KF{get localCapabilities(){return sA(this._localCapabilities)}get rtpCapabilities(){return sA(this._rtpCapabilities)}get candidates(){return sA(this._candidates)}get iceParameters(){return sA(this._iceParameters)}get dtlsParameters(){return sA(this._dtlsParameters)}constructor(e0){Fg(this,"sessionDesc",void 0),Fg(this,"_localCapabilities",void 0),Fg(this,"_rtpCapabilities",void 0),Fg(this,"_candidates",void 0),Fg(this,"_iceParameters",void 0),Fg(this,"_dtlsParameters",void 0),Fg(this,"setup",void 0),Fg(this,"currentMidIndex",void 0),Fg(this,"cname",void 0),Fg(this,"firefoxSsrcMidMap",new Map),e0=sA(e0);const{iceParameters:n0,dtlsParameters:r0,candidates:i0,rtpCapabilities:o0,setup:s0,localCapabilities:a0,cname:c0}=e0;this._rtpCapabilities=o0,this._candidates=i0,this._iceParameters=n0,this._dtlsParameters=r0,this._localCapabilities=a0,this.setup=s0,this.cname=c0,this.sessionDesc=this.updateRemoteRTPCapabilities(o0),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e0){const n0=this.candidates,r0=this.dtlsParameters,i0=this.iceParameters,o0=this.rtpCapabilities.send;let s0=this.sessionDesc.mediaDescriptions.length-1;for(let a0=1;a0<e0;a0++){const c0=2*a0+2e4,u0=2*a0+HF,{ssrcs:l0,ssrcGroups:d0}=zU([{ssrcId:c0}],this.cname),{ssrcs:h0,ssrcGroups:p0}=zU([{ssrcId:u0,rtx:XA("USE_SUB_RTX")?u0+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:WF,protos:["UDP","TLS","RTP","SAVPF"],fmts:o0.videoCodecs.map(m0=>m0.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i0.iceUfrag,icePwd:i0.icePwd,unrecognized:[],candidates:n0,extmaps:o0.videoExtensions,fingerprints:r0.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h0,ssrcGroups:p0,rtcpFeedbackWildcards:[],payloads:o0.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++s0)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:WF,protos:["UDP","TLS","RTP","SAVPF"],fmts:o0.audioCodecs.map(m0=>m0.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i0.iceUfrag,icePwd:i0.icePwd,unrecognized:[],candidates:n0,extmaps:o0.audioExtensions,fingerprints:r0.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l0,ssrcGroups:d0,rtcpFeedbackWildcards:[],payloads:o0.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++s0)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return FU.print(this.sessionDesc)}send(e0,n0,r0,i0){const{ssrcs:o0,ssrcGroups:s0}=zU(n0,this.cname,XA("SYNC_GROUP")?r0:void 0),a0=this.findPreloadMediaDesc(o0);if(a0){if(Zv()&&this.firefoxSsrcMidMap.set(o0[0].ssrcId,a0.attributes.mid),i0&&(i0.twcc||i0.remb)){const c0=this.sessionDesc.mediaDescriptions.indexOf(a0);return this.sessionDesc.mediaDescriptions[c0]=this.mungSendMediaDesc(a0,i0),{mid:a0.attributes.mid,needExchangeSDP:!0}}return{mid:a0.attributes.mid,needExchangeSDP:!1}}{const c0=this.findAvailableMediaIndex(e0,o0);let u0;return c0===-1||c0===1&&(Xv()||function(){const l0=Hv();return!(l0.name!==Bv.CHROME||!l0.osVersion)&&Number(l0.version)<=90}())||c0===0&&XA("USE_SUB_RTX")||ay()?(u0=this.createOrRecycleSendMedia(e0,o0,s0,"sendonly",i0),this.updateBundleMids()):(u0=sA(this.sessionDesc.mediaDescriptions[c0]),u0.attributes.direction="sendonly",u0.attributes.ssrcs=o0,u0.attributes.ssrcGroups=s0,this.sessionDesc.mediaDescriptions[c0]=this.mungSendMediaDesc(u0,i0)),Zv()&&this.firefoxSsrcMidMap.set(o0[0].ssrcId,u0.attributes.mid),{mid:u0.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e0,needExchangeSDP:n0}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e0.attributes.mid,needExchangeSDP:n0}}batchSend(e0){const n0=e0.map(o0=>{let{kind:s0,ssrcMsg:a0,mslabel:c0}=o0;return this.send(s0,a0,c0)}),r0=[];let i0=!1;return n0.forEach(o0=>{let{mid:s0,needExchangeSDP:a0}=o0;a0&&(i0=!0),r0.push(s0)}),{mids:r0,needExchangeSDP:i0}}stopSending(e0){const n0=this.sessionDesc.mediaDescriptions.filter(r0=>r0.attributes.mid&&e0.indexOf(r0.attributes.mid)!==-1);if(n0.length!==e0.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n0.forEach(r0=>{r0.attributes.mid==="0"||Zv()||ay()?r0.attributes.ssrcs=[]:(r0.attributes.ssrcs=[],r0.attributes.direction="inactive",r0.media.port="0")}),this.updateBundleMids()}mute(e0){const n0=this.sessionDesc.mediaDescriptions.find(r0=>r0.attributes.mid===e0);if(!n0)throw new Error("mediaDescription not found with ".concat(e0," in remote SDP when calling RemoteSDP.mute."));n0.attributes.direction="inactive"}unmute(e0){const n0=this.sessionDesc.mediaDescriptions.find(r0=>r0.attributes.mid===e0);if(!n0)throw new Error("mediaDescription not found with ".concat(e0," in remote SDP when calling RemoteSDP.unmute."));n0.attributes.direction="sendonly"}muteRemote(e0){const n0=this.sessionDesc.mediaDescriptions.filter(r0=>Dn(e0).call(e0,r0.attributes.mid||""));if(n0.length!==e0.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n0.forEach(r0=>{r0.attributes.direction="inactive"})}unmuteRemote(e0){const n0=this.sessionDesc.mediaDescriptions.filter(r0=>Dn(e0).call(e0,r0.attributes.mid||""));if(n0.length!==e0.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n0.forEach(r0=>{r0.attributes.direction="recvonly"})}receive(e0,n0,r0,i0){e0.forEach((o0,s0)=>{this.createOrRecycleRecvMedia(o0,[],"recvonly",n0,r0,i0[s0])}),this.updateBundleMids()}stopReceiving(e0){const n0=this.sessionDesc.mediaDescriptions.filter(r0=>e0.indexOf(r0.attributes.mid)!==-1);if(n0.length!==e0.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n0.forEach(r0=>{r0.media.port="0",r0.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e0){const n0=this.sessionDesc||FU.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=e0;const r0=this.rtpCapabilities.send,i0=this.localCapabilities.send;for(const o0 of n0.mediaDescriptions){if(o0.attributes.iceUfrag=this._iceParameters.iceUfrag,o0.attributes.icePwd=this._iceParameters.icePwd,o0.attributes.fingerprints=this._dtlsParameters.fingerprints,o0.attributes.candidates=this._candidates,o0.attributes.setup=this.setup,o0.media.mediaType==="application"&&(o0.attributes.sctpPort="5000"),o0.media.mediaType==="video"){if(r0.videoCodecs.length===0){const s0=i0.videoCodecs.filter(a0=>{var c0,u0;return(c0=a0.rtpMap)===null||c0===void 0?void 0:Dn(u0=c0.encodingName.toLowerCase()).call(u0,"vp8")})||[i0.videoCodecs[0]];o0.media.fmts=s0.map(a0=>a0.payloadType.toString(10)),o0.attributes.payloads=s0,o0.attributes.extmaps=[]}else if(o0.media.fmts=r0.videoCodecs.map(s0=>s0.payloadType.toString(10)),o0.attributes.payloads=r0.videoCodecs,o0.attributes.extmaps=r0.videoExtensions,XA("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:s0,ssrcGroups:a0}=zU([{ssrcId:HF,rtx:XA("USE_SUB_RTX")?40001:void 0}],this.cname);o0.attributes.ssrcs=s0,o0.attributes.ssrcGroups=a0}}if(o0.media.mediaType==="audio"){if(r0.audioCodecs.length===0){const s0=i0.audioCodecs.filter(a0=>{var c0,u0;return(c0=a0.rtpMap)===null||c0===void 0?void 0:Dn(u0=c0.encodingName.toLowerCase()).call(u0,"opus")})||[i0.audioCodecs[0]];o0.media.fmts=s0.map(a0=>a0.payloadType.toString(10)),o0.attributes.payloads=s0,o0.attributes.extmaps=[]}else if(o0.media.fmts=r0.audioCodecs.map(s0=>s0.payloadType.toString(10)),o0.attributes.payloads=r0.audioCodecs,o0.attributes.extmaps=r0.audioExtensions,ox(o0),XA("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:s0,ssrcGroups:a0}=zU([{ssrcId:2e4}],this.cname);o0.attributes.ssrcs=s0,o0.attributes.ssrcGroups=a0}}}return this.sessionDesc=n0,this.currentMidIndex=n0.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e0){const n0=this._candidates.filter(r0=>r0.transport==="udp");if(e0===lO.TCP){if(n0.length===0)return;if(XA("TCP_CANDIDATE_ONLY")){const r0=this._candidates.filter(i0=>i0.transport==="tcp");n0.forEach(i0=>{r0.findIndex(o0=>o0.connectionAddress===i0.connectionAddress)===-1&&r0.push(GF(GF({},i0),{},{foundation:"tcpcandidate",priority:Number(i0.priority)-1+"",transport:"tcp",port:Number(i0.port)+90+""}))}),this._candidates=r0}else{const r0=[];n0.forEach(i0=>{r0.push(GF(GF({},i0),{},{foundation:"tcpcandidate",priority:Number(i0.priority)-1+"",transport:"tcp",port:Number(i0.port)+90+""}))}),this._candidates=[...n0,...r0]}}else if(e0===lO.RELAY){if(n0.length!==0)return;{const r0=this._candidates.filter(i0=>i0.transport==="tcp");r0.forEach(i0=>{n0.push(GF(GF({},i0),{},{foundation:"udpcandidate",priority:Number(i0.priority)+1+"",transport:"udp",port:Number(i0.port)-90+""}))}),this._candidates=[...n0,...r0]}}else n0.length===0?(this._candidates.filter(r0=>r0.transport==="tcp").forEach(r0=>{n0.push(GF(GF({},r0),{},{foundation:"udpcandidate",priority:Number(r0.priority)+1+"",transport:"udp",port:Number(r0.port)-90+""}))}),this._candidates=n0):this._candidates=this._candidates.filter(r0=>r0.transport!=="tcp");for(const r0 of this.sessionDesc.mediaDescriptions)r0.attributes.candidates=this.candidates}restartICE(e0){e0=sA(e0),this._iceParameters=e0,this.sessionDesc.mediaDescriptions.forEach(n0=>{n0.attributes.iceUfrag=e0.iceUfrag,n0.attributes.icePwd=e0.icePwd})}predictReceivingMids(e0){const n0=[];for(let r0=0;r0<e0;r0++)n0.push((this.currentMidIndex+r0+1).toString(10));return n0}findAvailableMediaIndex(e0,n0){return this.sessionDesc.mediaDescriptions.findIndex(r0=>{const i0=r0.media.mediaType===e0&&r0.media.port!=="0"&&(r0.attributes.direction==="sendonly"||r0.attributes.direction==="sendrecv")&&r0.attributes.ssrcs.length===0;if(Zv()){if(i0){const o0=this.firefoxSsrcMidMap.get(n0[0].ssrcId);return!(o0||r0.attributes.mid!=="0"&&r0.attributes.mid!=="1")||!(!o0||o0!==r0.attributes.mid)}return!1}return i0})}createOrRecycleDataChannel(){for(const r0 of this.sessionDesc.mediaDescriptions)if(r0.media.mediaType==="application")return{mediaDesc:r0,needExchangeSDP:!1};this.currentMidIndex+=1;const e0="".concat(this.currentMidIndex),n0={media:{mediaType:"application",port:WF,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e0),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(n0),{mediaDesc:n0,needExchangeSDP:!0}}createOrRecycleRecvMedia(e0,n0,r0,i0,o0,s0){const a0=e0._mediaStreamTrack.kind,c0=this.rtpCapabilities.recv,u0=sx(a0,c0,this.localCapabilities.send,a0===dO.VIDEO?i0:o0),l0=a0===dO.VIDEO?c0.videoExtensions:c0.audioExtensions;this.currentMidIndex+=1;const d0="".concat(this.currentMidIndex);let h0={media:{mediaType:a0,port:WF,protos:["UDP","TLS","RTP","SAVPF"],fmts:u0.map(m0=>m0.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l0,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n0,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u0,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r0,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d0)}};h0=this.mungRecvMediaDsec(h0,e0,s0);const p0=this.findFirstClosedMedia(a0);if(p0){const m0=this.sessionDesc.mediaDescriptions.indexOf(p0);this.sessionDesc.mediaDescriptions[m0]=h0}else this.sessionDesc.mediaDescriptions.push(h0);return h0}updateRemoteCodec(e0,n0,r0){const i0=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(h0=>h0.rtpMap&&h0.rtpMap.encodingName.toLowerCase()||"").filter(h0=>{var p0;return Dn(p0=Object.keys(eb)).call(p0,h0)}))],o0=new Set(n0);if(i0.every(h0=>o0.has(h0)))return fb.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(n0)),!1;const s0=this._rtpCapabilities.recv.videoCodecs.filter(h0=>n0.some(p0=>{var m0;return Dn(m0=h0.rtpMap&&h0.rtpMap.encodingName.toLowerCase()||"").call(m0,p0)}));if(s0.length===0)return fb.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i0," codecs: ").concat(n0)),!1;const a0=[...new Set(s0.map(h0=>h0.rtpMap&&h0.rtpMap.encodingName.toLowerCase()||""))];let c0;if(fb.debug("updateRemoteCodec, from ".concat(i0," to ").concat(a0)),e0.length===0)c0=this.sessionDesc.mediaDescriptions.filter(h0=>h0.media.mediaType==="video"&&h0.attributes.direction==="recvonly");else if(c0=this.sessionDesc.mediaDescriptions.filter(h0=>h0.attributes.mid&&Dn(e0).call(e0,h0.attributes.mid)&&h0.attributes.direction==="recvonly"),c0.length!==e0.length)return fb.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e0,", codecs: ").concat(n0)),!1;if(XA("USE_PUB_RTX")||XA("USE_SUB_RTX")){const h0=ax(s0,this.rtpCapabilities.recv.videoCodecs);s0.push(...h0)}this._rtpCapabilities.recv.videoCodecs=s0;const u0=this.localCapabilities.send,l0=this.rtpCapabilities.recv,d0=sx(dO.VIDEO,l0,u0,r0);return c0.forEach(h0=>{const p0=d0.map(m0=>m0.payloadType.toString(10));fb.debug("updateRemoteCodec mid: ".concat(h0.attributes.mid,", from ").concat(h0.attributes.payloads," to ").concat(d0)),h0.attributes.payloads=d0,h0.media.fmts=p0}),!0}createOrRecycleSendMedia(e0,n0,r0,i0,o0){const s0=this.rtpCapabilities.send,a0=e0===dO.VIDEO?s0.videoCodecs:s0.audioCodecs,c0=e0===dO.VIDEO?s0.videoExtensions:s0.audioExtensions;this.currentMidIndex+=1;const u0="".concat(this.currentMidIndex);let l0={media:{mediaType:e0,port:WF,protos:["UDP","TLS","RTP","SAVPF"],fmts:a0.map(h0=>h0.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c0,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n0,ssrcGroups:r0,rtcpFeedbackWildcards:[],payloads:a0,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i0,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u0)}};l0=this.mungSendMediaDesc(l0,o0);const d0=this.findFirstClosedMedia(e0);if(d0){const h0=this.sessionDesc.mediaDescriptions.indexOf(d0);this.sessionDesc.mediaDescriptions[h0]=l0}else this.sessionDesc.mediaDescriptions.push(l0);return l0}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e0=>e0.media.port!=="0").map(e0=>e0.attributes.mid)}mungRecvMediaDsec(e0,n0,r0){const i0=sA(e0);return XU(i0),JU(i0,n0),QU(i0,n0),ZU(i0),$U(i0,r0,this.localCapabilities.send),i0}mungSendMediaDesc(e0,n0){const r0=sA(e0);return $U(r0,n0,this.localCapabilities.recv),ox(r0),r0}updateRecvMedia(e0,n0){const r0=this.sessionDesc.mediaDescriptions.findIndex(i0=>i0.attributes.mid===e0);if(r0!==-1){const i0=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r0],n0);this.sessionDesc.mediaDescriptions[r0]=i0}}bumpMid(e0){this.currentMidIndex+=e0}findFirstClosedMedia(e0){return this.sessionDesc.mediaDescriptions.find(n0=>Zv()?n0.media.port==="0"&&n0.media.mediaType===e0:n0.media.port==="0")}findPreloadMediaDesc(e0){return this.sessionDesc.mediaDescriptions.find(n0=>{var r0;return((r0=n0.attributes)===null||r0===void 0||(r0=r0.ssrcs[0])===null||r0===void 0?void 0:r0.ssrcId)===e0[0].ssrcId})}getSSRC(e0){var n0;return(n0=this.sessionDesc.mediaDescriptions.find(r0=>r0.attributes.mid===e0))===null||n0===void 0?void 0:n0.attributes.ssrcs}}function YF(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function qF(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?YF(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):YF(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}let zF=function(t0){return t0.BANDWIDTH="bandwidth",t0.CPU="cpu",t0.NONE="none",t0.OTHER="other",t0}({});var JF=function(t0){return t0[t0.DOWN=0]="DOWN",t0[t0.UP=1]="UP",t0}(JF||{});const XF=new Map;function QF(t0,e0,n0,r0){let{scale:i0}=t0;if(i0===0&&r0===JF.UP||i0>=e0.length-1&&r0===JF.DOWN)return t0;let o0=qF(qF({},t0),{},{scale:r0===JF.DOWN?++i0:--i0});switch(n0){case"maintain-framerate":o0=qF(qF({},o0),e0[i0].motion);break;case"maintain-resolution":o0=qF(qF({},o0),e0[i0].detail);break;case"balanced":o0=qF(qF({},o0),e0[i0].balanced)}return o0}function ZF(t0,e0){if(e0){const n0={overUse:0,underUse:0,adaptationList:$F(e0)};XF.set(t0,n0)}else XF.delete(t0)}function $F(t0){const e0=qF({},t0),{bitrateMax:n0,frameRate:r0,scaleResolutionDownBy:i0,bitrateMin:o0}=e0,{MIN_FRAME_RATE:s0,MAX_THRESHOLD_FRAMERATE:a0,MAX_SCALE:c0,BITRATE_MIN_THRESHOLD:u0,BITRATE_MAX_THRESHOLD:l0,BWE_SCALE_UP_THRESHOLD:d0,BWE_SCALE_DOWN_THRESHOLD:h0,PERF_SCALE_DOWN_THRESHOLD:p0,PERF_SCALE_UP_THRESHOLD:m0,BALANCE_BITRATE_FACTOR:f0,BALANCE_FRAMERATE_FACTOR:g0,BALANCE_RESOLUTION_FACTOR:E0,MOTION_RESOLUTION_FACTOR:_0,MOTION_BITRATE_FACTOR:y0,DETAIL_FRAMERATE_FACTOR:b0,DETAIL_BITRATE_FACTOR:S0}=YA,w0=Math.min(e0.frameRate,a0),I0=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h0,1)*n0),bwe_up:n0,fps_down:Math.round(Math.pow(p0,1)*w0),fps_up:r0},balanced:{scaleResolutionDownBy:1,frameRate:r0,bitrateMax:n0,bitrateMin:o0},motion:{scaleResolutionDownBy:1,frameRate:r0,bitrateMax:n0,bitrateMin:o0},detail:{scaleResolutionDownBy:1,frameRate:r0,bitrateMax:n0,bitrateMin:o0}}];for(let L0=1;L0<=c0;L0++){const M0={bwe_up:Math.round(Math.pow(d0,L0)*n0),bwe_down:Math.round(Math.pow(h0,L0+1)*n0),fps_up:Math.round(Math.pow(m0,L0)*w0),fps_down:Math.round(Math.pow(p0,L0+1)*w0)},C0={scaleResolutionDownBy:i0/Math.pow(E0,L0),frameRate:Math.max(Math.round(Math.pow(g0,L0)*r0),s0),bitrateMax:Math.max(Math.round(Math.pow(f0,L0)*n0),l0),bitrateMin:Math.max(Math.round(Math.pow(f0,L0)*o0),u0)},U0={scaleResolutionDownBy:i0/Math.pow(_0,L0),frameRate:r0,bitrateMax:Math.max(Math.round(Math.pow(y0,L0)*n0),l0),bitrateMin:Math.max(Math.round(Math.pow(y0,L0)*o0),u0)},x0={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(b0,L0)*r0),s0),bitrateMax:Math.max(Math.round(Math.pow(S0,L0)*n0),l0),bitrateMin:Math.max(Math.round(Math.pow(S0,L0)*o0),u0)};I0.push({scale:L0,threshold:M0,balanced:C0,motion:U0,detail:x0})}return I0}function eB(t0,e0,n0,r0,i0,o0){const s0=XF.get(t0)||{overUse:0,underUse:0,adaptationList:$F(i0)},{adaptationList:a0}=s0;XF.set(t0,s0);const{OVERUSE_TIMES_THRESHOLD:c0,UNDERUSE_TIMES_THRESHOLD:u0}=YA,{scale:l0}=r0;let d0,h0;return typeof e0=="number"&&e0>0&&function(p0,m0,f0,g0){if(m0>=f0.length)return!1;let{threshold:{fps_down:E0}}=f0[m0];return XA("FORCE_AG_HIGH_FRAMERATE")&&g0==="maintain-framerate"&&(E0=f0[0].threshold.fps_down),p0<E0}(e0,l0,a0,o0)&&(s0.overUse++,h0=zF.CPU,s0.overUse>c0)||typeof n0=="number"&&n0>0&&function(p0,m0,f0){if(m0>=f0.length)return!1;const{threshold:{bwe_down:g0}}=f0[m0];return p0<g0}(n0,l0,a0)&&(s0.overUse++,h0=zF.BANDWIDTH,s0.overUse>c0)?(s0.overUse=0,s0.underUse=0,d0=QF(r0,a0,o0,JF.DOWN),[d0,h0]):(typeof e0=="number"&&e0>0&&typeof n0=="number"&&n0>0&&function(p0,m0,f0,g0){if(m0===0)return;let{threshold:{fps_up:E0}}=f0[m0];return XA("FORCE_AG_HIGH_FRAMERATE")&&g0==="maintain-framerate"&&(E0=f0[1].threshold.fps_up),p0>E0}(e0,l0,a0,o0)&&function(p0,m0,f0){if(m0===0)return;const{threshold:{bwe_up:g0}}=f0[m0];return p0>g0}(n0,l0,a0)&&(s0.underUse++,s0.underUse>u0&&(s0.overUse=0,s0.underUse=0,d0=QF(r0,a0,o0,JF.UP),d0.scale===0&&(h0=zF.NONE))),[d0,h0])}function tB(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function iB(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?tB(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):tB(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}function nB(t0){var e0;return!!XA("ENABLE_AG_ADAPTATION")&&!!(t0 instanceof cU||Dn(e0=t0._hints).call(e0,mL.CUSTOM_TRACK))&&(!!XA("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n0){const r0=Hv();if(r0.os!==Fv.IOS||!r0.osVersion)return!1;const i0=r0.osVersion.split(".");return Number(i0[0])>=n0}(14)&&ry(17,4,!0)||ny(14)&&oy(17,4,!0)))}const rB=new Map;function oB(t0,e0){const n0=rB.get(t0);if(n0){const{timer:r0}=n0;window.clearTimeout(r0),rB.delete(t0)}e0.qualityLimitationReason=zF.NONE,ZF(t0)}var sB;function aB(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function cB(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?aB(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):aB(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}let dB=(sB=class u1 extends cO{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e0,n0;return(e0=(n0=this.peerConnection.getReceivers()[0])===null||n0===void 0||(n0=n0.transport)===null||n0===void 0?void 0:n0.state)!==null&&e0!==void 0?e0:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e0=>e0.rtpMap&&e0.rtpMap.encodingName.toLowerCase()||"").filter(e0=>{var n0;return Dn(n0=Object.keys(eb)).call(n0,e0)}))]}constructor(e0,n0){super(e0,n0),Fg(this,"store",void 0),Fg(this,"peerConnection",void 0),Fg(this,"id",TA(5,"connection-")),Fg(this,"remoteSDP",void 0),Fg(this,"initialOffer",void 0),Fg(this,"transportEventReceiver",void 0),Fg(this,"statsFilter",void 0),Fg(this,"extension",{useXR:XA("USE_XR")}),Fg(this,"localCapabilities",void 0),Fg(this,"remoteCodecs",void 0),Fg(this,"localCandidateCount",0),Fg(this,"allCandidatesReceived",!1),Fg(this,"isPreallocation",!1),Fg(this,"preSSRCMap",new Map),Fg(this,"dataStreamChannelMap",new Map),Fg(this,"establishPromise",void 0),Fg(this,"recoveredDataChannelIds",[]),Fg(this,"currentDataChannelId",1),Fg(this,"mutex",new NA("P2PConnection-mutex")),Fg(this,"qualityLimitationReason",zF.NONE),this.store=n0,this.peerConnection=new RTCPeerConnection(u1.resolvePCConfiguration(e0),{optional:[{googDscp:!0}]}),this.statsFilter=xV(this.peerConnection,XA("STATS_UPDATE_INTERVAL"),void 0,Zv()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e0){const n0=this.preSSRCMap.get(e0);if(n0!==void 0){const r0=this.peerConnection.getTransceivers().find(i0=>i0.mid===n0);if(r0)return{transceiver:r0,track:r0.receiver.track,id:n0}}}async updateRemoteRTPCapabilities(e0,n0){if(this.remoteCodecs=n0,!this.remoteSDP)return void fb.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n0));if(this.remoteSDP.updateRemoteCodec(e0,n0,this.store.codec)){const r0=await this.peerConnection.createOffer(),i0=this.logSDPExchange(r0.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r0);const o0=this.remoteSDP.toString();i0==null||i0(o0),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o0})}else fb.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e0=await this.peerConnection.createOffer();if(!e0.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n0=HU(e0.sdp),r0=await tx({filterRTX:!XA("USE_PUB_RTX")&&!XA("USE_SUB_RTX"),filterVideoFec:XA("FILTER_VIDEO_FEC"),filterAudioFec:XA("FILTER_AUDIO_FEC"),filterVideoCodec:XA("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=rx(r0),this.initialOffer=e0,cB(cB({},n0),{},{rtpCapabilities:r0,offerSDP:e0.sdp})}catch(e0){throw new Cy(Ry.GET_LOCAL_CONNECTION_PARAMS_FAILED,e0.toString())}}async connect(e0){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new KF(cB(cB({},e0),{},{localCapabilities:this.localCapabilities})),e0.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n0=this.remoteSDP.toString(),r0=dx(this.initialOffer.sdp,this.extension),i0=this.logSDPExchange(r0||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r0}),i0==null||i0(n0),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n0});const o0=this.peerConnection.getTransceivers()[0];if(o0!=null&&o0.receiver&&this.tryBindTransportEvents(o0.receiver),XA("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(XA("PRELOAD_MEDIA_COUNT"));const a0=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a0});const c0=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c0)}const{preSSRCs:s0}=e0;if(Array.isArray(s0)&&s0.length>0){const{mids:a0}=this.remoteSDP.batchSend(s0.map(c0=>({kind:c0.kind,ssrcMsg:[{ssrcId:c0.ssrcId,rtx:c0.rtx}],mslabel:c0.mslabel})));a0.forEach((c0,u0)=>{this.preSSRCMap.set(s0[u0].ssrcId,c0)}),await cx(this.peerConnection,this.remoteSDP,this.extension),fb.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n0.toString()))}}async updateRemoteConnect(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n0}=e0;this.remoteSDP.updateRemoteRTPCapabilities(n0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:r0}=e0;if(Array.isArray(r0)&&r0.length>0){const{mids:i0}=this.remoteSDP.batchSend(r0.map(o0=>Object.assign({},{kind:o0.kind,ssrcMsg:[{ssrcId:o0.ssrcId,rtx:o0.rtx}],mslabel:o0.mslabel})));i0.forEach((o0,s0)=>{this.preSSRCMap.set(r0[s0].ssrcId,o0)})}await cx(this.peerConnection,this.remoteSDP,this.extension),fb.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n0.toString()))}}send(e0,n0,r0){var i0=this;return YI(function*(){const o0=yield qI(i0.mutex.lock("From P2PConnection.send"));try{if(!i0.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s0=[];e0.forEach(f0=>{const g0=i0.peerConnection.addTransceiver(f0._mediaStreamTrack,{direction:"sendonly"});s0.push(g0),f0._updateRtpTransceiver(g0)}),Zv()&&XA("SIMULCAST")===!0&&(yield qI(i0.applySimulcastForFirefox(s0,e0)));const a0=yield qI(i0.peerConnection.createOffer()),c0=i0.remoteSDP.predictReceivingMids(e0.length),u0=i0.mungSendOfferSDP(a0.sdp,e0,c0),l0=FU.parse(u0),d0=c0.map(f0=>{const g0=l0.mediaDescriptions.find(E0=>E0.attributes.mid===f0);if(!g0)throw new Error("Cannot extract ssrc from mediaDescription.");return KU(g0,XA("USE_PUB_RTX"))});let h0;try{h0=yield d0}catch(f0){h0=[],i0.remoteSDP.receive(e0,n0,r0,h0);const g0=i0.remoteSDP.toString();throw yield qI(i0.peerConnection.setLocalDescription({type:"offer",sdp:u0})),yield qI(i0.peerConnection.setRemoteDescription({type:"answer",sdp:g0})),yield qI(i0.stopSending(c0,!0)),f0}i0.remoteSDP.receive(e0,n0,r0,h0);const p0=i0.remoteSDP.toString(),m0=i0.logSDPExchange(u0,"offer","local","send");return yield qI(i0.peerConnection.setLocalDescription({type:"offer",sdp:u0})),yield qI(i0.applySimulcastEncodings(s0,e0)),yield qI(i0.applySendEncodings(s0,e0)),m0==null||m0(p0),yield qI(i0.peerConnection.setRemoteDescription({type:"answer",sdp:p0})),s0.map((f0,g0)=>{const E0=c0[g0];return{localSSRC:d0[g0],id:E0,transceiver:f0}})}catch(s0){throw s0 instanceof Cy?s0:new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s0.toString()))}finally{o0()}})()}async createDataChannels(e0,n0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r0=this.dataStreamChannelMap.get(e0);if(r0&&r0.readyState==="open")fb.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const o0=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o0!="number")throw new Error("create DataChannel error, because cannot get dc id");r0=this.peerConnection.createDataChannel("datastream-channel",{id:o0,negotiated:!0,ordered:!1,maxRetransmits:XA("DATASTREAM_MAX_RETRANSMITS")}),r0.binaryType="arraybuffer",this.dataStreamChannelMap.set(e0,r0)}n0.forEach(o0=>{o0._updateOriginDataChannel(r0)});const{needExchangeSDP:i0}=this.remoteSDP.sendDataChannel();if(i0){const o0=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o0});const s0=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s0),fb.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else fb.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r0){throw r0 instanceof Cy?r0:new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r0.toString()))}}async stopDataChannels(e0){try{const n0=this.dataStreamChannelMap.get(e0);return n0&&(n0.id&&this.recoveredDataChannelIds.push(n0.id),n0.close()),void this.dataStreamChannelMap.delete(e0)}catch(n0){throw n0 instanceof Cy?n0:new Cy(Ry.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n0.toString()))}}async stopSending(e0,n0){const r0=n0?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i0=this.peerConnection.getTransceivers().filter(c0=>e0.indexOf(c0.mid)!==-1);if(i0.length!==e0.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i0.map(c0=>{var u0;oB(this.id+c0.mid,this),c0.direction="inactive",(u0=c0.stop)===null||u0===void 0||u0.call(c0)});const o0=await this.peerConnection.createOffer(),s0=this.logSDPExchange(o0.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o0),this.remoteSDP.stopReceiving(e0);const a0=this.remoteSDP.toString();s0==null||s0(a0),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a0})}catch(i0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i0.toString()))}finally{r0&&r0()}}async receive(e0,n0,r0,i0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e0," before remoteSDP created."));const{mid:o0,needExchangeSDP:s0}=this.remoteSDP.send(e0,n0,r0,i0);s0&&(await cx(this.peerConnection,this.remoteSDP,this.extension),fb.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e0," by exchanging SDP.")));const a0=this.peerConnection.getTransceivers().find(c0=>c0.mid===o0);if(!a0)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a0.receiver.track,id:o0,transceiver:a0}}catch(o0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o0.toString()))}}async batchReceive(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n0,needExchangeSDP:r0}=this.remoteSDP.batchSend(e0);return r0&&(await cx(this.peerConnection,this.remoteSDP,this.extension),fb.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n0.map(i0=>{const o0=this.peerConnection.getTransceivers().find(s0=>s0.mid===i0);if(!o0)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o0.receiver.track,id:i0,transceiver:o0}})}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n0.toString()))}}async stopReceiving(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e0.forEach(o0=>{Array.from(this.preSSRCMap.entries()).some(s0=>{let[a0,c0]=s0;if(c0===o0)return this.preSSRCMap.delete(a0),!0})}),this.remoteSDP.stopSending(e0);const n0=this.remoteSDP.toString(),r0=this.logSDPExchange(n0,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n0});const i0=await this.peerConnection.createAnswer();r0==null||r0(i0.sdp||""),await this.peerConnection.setLocalDescription(i0)}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n0.toString()))}}async muteRemote(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e0," before remote SDP created."));this.remoteSDP.mute(e0);const n0=this.remoteSDP.toString(),r0=this.logSDPExchange(n0,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n0});const i0=await this.peerConnection.createAnswer();r0==null||r0(i0.sdp||""),await this.peerConnection.setLocalDescription(i0)}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n0.toString()))}}async unmuteRemote(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e0," before remote SDP created."));this.remoteSDP.unmute(e0);const n0=this.remoteSDP.toString(),r0=this.logSDPExchange(n0,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n0});const i0=await this.peerConnection.createAnswer();r0==null||r0(i0.sdp||""),await this.peerConnection.setLocalDescription(i0)}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n0.toString()))}}async muteLocal(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n0=this.peerConnection.getTransceivers().filter(s0=>s0.mid&&e0.indexOf(s0.mid)!==-1);if(n0.length!==e0.length)throw new Error("Transceivers' length doesn't match mids' length.");n0.map(s0=>{s0.direction="inactive"});const r0=await this.peerConnection.createOffer(),i0=this.logSDPExchange(r0.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r0),this.remoteSDP.muteRemote(e0);const o0=this.remoteSDP.toString();i0==null||i0(o0),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o0})}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n0.toString()))}}async unmuteLocal(e0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n0=this.peerConnection.getTransceivers().filter(s0=>s0.mid&&e0.indexOf(s0.mid)!==-1);if(n0.length!==e0.length)throw new Error("Transceivers' length doesn't match mids' length.");n0.map(async(s0,a0)=>{s0.direction="sendonly"});const r0=await this.peerConnection.createOffer(),i0=this.logSDPExchange(r0.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r0),this.remoteSDP.unmuteRemote(e0);const o0=this.remoteSDP.toString();i0==null||i0(o0),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o0})}catch(n0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n0.toString()))}}restartICE(e0){var n0=this;return YI(function*(){const r0=yield qI(n0.mutex.lock("From P2PConnection.restartICE"));try{if(!n0.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(ZP().supportPCSetConfiguration){const u0=n0.peerConnection.getConfiguration(),l0=e0===lO.RELAY?"relay":"all";u0.iceTransportPolicy!==l0&&(fb.debug("[".concat(n0.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u0.iceTransportPolicy,"] to [").concat(l0,"]")),u0.iceTransportPolicy=l0,n0.peerConnection.setConfiguration(u0))}else if(e0===lO.RELAY)return;n0.remoteSDP.updateCandidates(e0);const i0=yield qI(n0.peerConnection.createOffer({iceRestart:!0}));if(!i0.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o0=HU(i0.sdp),{remoteIceParameters:s0}=yield o0.iceParameters;n0.remoteSDP.restartICE(s0);const a0=n0.remoteSDP.toString(),c0=n0.logSDPExchange(i0.sdp||"","offer","local","restartICE");n0.store.descriptionStart(),yield qI(n0.peerConnection.setLocalDescription(i0)),c0==null||c0(a0),yield qI(n0.peerConnection.setRemoteDescription({type:"answer",sdp:a0}))}catch(i0){fb.warning("[".concat(n0.store.clientId,"] restart ICE failed, abort operation"),i0)}finally{r0()}})()}close(){var e0;this.peerConnection.getTransceivers().forEach(n0=>{oB(this.id+n0.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e0=this.onConnectionStateChange)===null||e0===void 0||e0.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return cB(cB({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e0){return this.statsFilter.getVideoIsReady(e0)}async updateEncoderConfig(e0,n0){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r0=await this.peerConnection.createOffer(),i0=this.mungSendOfferSDP(r0.sdp,[n0],[e0]);this.remoteSDP.updateRecvMedia(e0,n0);const o0=this.remoteSDP.toString(),s0=this.logSDPExchange(i0,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i0}),s0==null||s0(o0),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o0})}catch(r0){throw new Cy(Ry.EXCHANGE_SDP_FAILED,r0.toString())}}async updateSendParameters(e0,n0){const r0=this.peerConnection.getTransceivers().filter(i0=>i0.mid===e0);r0.length===1&&(this.isVP8Simulcast(n0)?Zv()||await this.applySimulcastEncodings(r0,[n0]):await this.applySendEncodings(r0,[n0]))}setStatsRemoteVideoIsReady(e0,n0){this.statsFilter.setVideoIsReady2(e0,n0)}async replaceTrack(e0,n0){const r0=this.peerConnection.getTransceivers().find(i0=>i0.mid===n0);r0&&await r0.sender.replaceTrack(e0._mediaStreamTrack)}async getSelectedCandidatePair(){const e0=this.peerConnection.getReceivers();if(e0.length>0&&e0[0].transport&&e0[0].transport.iceTransport&&e0[0].transport.iceTransport.getSelectedCandidatePair&&e0[0].transport.iceTransport.getSelectedCandidatePair()){const n0=e0[0].transport.iceTransport,{local:r0,remote:i0}=n0.getSelectedCandidatePair();return{local:cB(cB({},RV),{},{candidateType:r0.type,protocol:r0.protocol,address:r0.address,port:r0.port}),remote:cB(cB({},RV),{},{candidateType:i0.type,protocol:i0.protocol,address:i0.address,port:i0.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e0;(e0=this.onICEConnectionStateChange)===null||e0===void 0||e0.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e0;(e0=this.onConnectionStateChange)===null||e0===void 0||e0.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e0=>{e0.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,fb.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,fb.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},XA("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e0){const n0={iceServers:[]};return e0.iceServers?n0.iceServers=e0.iceServers:e0.turnServer&&e0.turnServer.mode!=="off"&&(Ky(e0.turnServer.servers)?n0.iceServers=e0.turnServer.servers:(n0.iceServers&&n0.iceServers.push(...u1.turnServerConfigToIceServers(e0.turnServer.servers)),XA("USE_TURN_SERVER_OF_GATEWAY")&&n0.iceServers&&e0.turnServer.serversFromGateway&&n0.iceServers.push(...u1.turnServerConfigToIceServers(e0.turnServer.serversFromGateway)),XA("FORCE_TURN_TCP")?n0.iceTransportPolicy="relay":e0.turnServer.servers.concat(e0.turnServer.serversFromGateway||[]).forEach(r0=>{r0.forceturn&&(n0.iceTransportPolicy="relay")}))),XA("ENABLE_ENCODED_TRANSFORM")&&ZP().supportWebRTCEncodedTransform&&(n0.encodedInsertableStreams=!0),n0}static turnServerConfigToIceServers(e0){const n0=[];return e0.forEach(r0=>{r0.security?r0.tcpport&&n0.push({username:r0.username,credential:r0.password,credentialType:"password",urls:"turns:".concat(JO(r0.turnServerURL),":").concat(r0.tcpport,"?transport=tcp")}):(r0.udpport&&!XA("FORCE_TURN_TCP")&&n0.push({username:r0.username,credential:r0.password,credentialType:"password",urls:"turn:".concat(r0.turnServerURL,":").concat(r0.udpport,"?transport=udp")}),r0.tcpport&&n0.push({username:r0.username,credential:r0.password,credentialType:"password",urls:"turn:".concat(r0.turnServerURL,":").concat(r0.tcpport,"?transport=tcp")}))}),n0}tryBindTransportEvents(e0){const n0=e0.transport;if(n0){this.transportEventReceiver=e0,n0.onstatechange=()=>{var i0;n0!=null&&n0.state&&((i0=this.onDTLSTransportStateChange)===null||i0===void 0||i0.call(this,n0.state))},n0.onerror=i0=>{var o0;(o0=this.onDTLSTransportError)===null||o0===void 0||o0.call(this,"error"in i0?i0.error:i0)};const r0=n0.iceTransport;r0&&(r0.onstatechange=()=>{const i0=n0==null?void 0:n0.iceTransport.state;var o0;i0&&((o0=this.onICETransportStateChange)===null||o0===void 0||o0.call(this,i0))},r0.getSelectedCandidatePair&&(r0.onselectedcandidatepairchange=()=>{if(r0.getSelectedCandidatePair()){const{local:i0,remote:o0}=r0.getSelectedCandidatePair();fb.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i0.type,protocol:i0.protocol}),", remote ").concat(JSON.stringify({candidateType:o0.type,protocol:o0.protocol,address:o0.address,port:o0.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e0,n0){var r0,i0;if(n0||(n0=this.peerConnection.getSenders().find(g0=>g0.track===e0._mediaStreamTrack)),!n0)return fb.warn("[".concat(e0.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e0))return fb.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ZP().supportSetRtpSenderParameters)return fb.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o0={},s0={};switch(e0._optimizationMode){case"motion":o0.degradationPreference="maintain-framerate";break;case"detail":o0.degradationPreference="maintain-resolution";break;case"balanced":o0.degradationPreference="balanced"}const a0=function(f0,g0){return f0.getTransceivers().find(E0=>E0.sender.track===g0||E0.receiver.track===g0)}(this.peerConnection,e0._mediaStreamTrack),c0=wk(e0);if(nB(e0)&&a0&&n0&&c0&&this.getLocalVideoStats&&Dn(r0=["vp8","vp9"]).call(r0,this.store.codec)){var u0;const f0=o0.degradationPreference||(Dn(u0=e0._hints).call(u0,mL.CUSTOM_TRACK)?XA("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(g0,E0,_0,y0,b0,S0){if(oB(g0,_0),b0(E0),y0!=="balanced"&&y0!=="maintain-framerate"&&y0!=="maintain-resolution")return;let w0=-1;ZF(g0,E0);const I0=window.setInterval(()=>{const M0=rB.get(g0);if(!XA("ENABLE_AG_ADAPTATION")||!M0)return oB(g0,_0),void b0(E0);const C0=S0();if(C0.sendPackets>0&&C0.OutgoingAvailableBandwidth>0){if(w0===-1)return void(w0=Date.now());if(Date.now()-w0<1e3)return;const U0=C0.sendFrameRate,x0=C0.OutgoingAvailableBandwidth,[j0,k0]=eB(g0,U0,x0,M0.adaptationConfig,E0,y0);k0&&(_0.qualityLimitationReason=k0),j0&&M0.adaptationConfig.scale!==j0.scale&&(fb.debug("[".concat(g0,"] applyAdaptation: ").concat(_0.qualityLimitationReason,`
           sendFps `).concat(U0,", bwe ").concat(x0,", switch from ").concat(M0.adaptationConfig.scale," to ").concat(j0.scale," ")),M0.adaptationConfig=iB(iB({},M0.adaptationConfig),j0),b0(j0))}},XA("CHECK_LOCAL_STATS_INTERVAL")),L0=iB({},E0);rB.set(g0,{timer:I0,adaptationConfig:L0,originConfig:E0,adaptationFunc:b0}),fb.debug("[".concat(g0,"] start adaptation, originConfig: ").concat(JSON.stringify(E0),", degradationPreference: ").concat(y0))})(this.id+a0.mid,c0,this,f0,g0=>{n0&&this.updateAdaptation(n0,g0)},this.getLocalVideoStats.bind(this))}if(e0._encoderConfig){var l0;const{bitrateMax:f0,frameRate:g0,scaleResolutionDownBy:E0}=e0._encoderConfig;f0&&(s0.maxBitrate=1e3*f0),(Dn(l0=e0._hints).call(l0,mL.LOW_STREAM)||e0.isUseScaleResolutionDownBy)&&(g0&&(s0.maxFramerate=QO(g0)),E0&&E0>=1&&(s0.scaleResolutionDownBy=E0))}const{maxFramerate:d0}=XA("ENCODER_CONFIG_LIMIT");if(d0&&typeof d0=="number"&&(s0.maxFramerate=s0.maxFramerate?Math.min(s0.maxFramerate,d0):d0),XA("DSCP_TYPE")&&Ey()){var h0;const f0=XA("DSCP_TYPE");Dn(h0=["very-low","low","medium","high"]).call(h0,f0)&&(s0.networkPriority=f0)}const p0=n0.getParameters(),m0=(i0=p0.encodings)===null||i0===void 0?void 0:i0[0];Zv()&&!m0&&(o0.encodings=[s0]),m0&&Object.assign(m0,s0),Object.assign(p0,o0),fb.debug("[".concat(e0.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p0.encodings))),await n0.setParameters(p0),await async function(f0,g0,E0){try{var _0;if(!ZP().supportSetRtpSenderParameters||!function(I0){return I0==="vp9"}(f0)||!XA("ENABLE_SVC"))return;const y0={},b0={},S0=g0.getParameters(),w0=(_0=S0.encodings)===null||_0===void 0?void 0:_0[0];b0.scalabilityMode=BU(E0),w0&&Object.assign(w0,b0),Object.assign(S0,y0),await g0.setParameters(S0),fb.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(S0.encodings)))}catch(y0){fb.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",y0)}}(this.store.codec,n0,XA("SVC_MODE"))}async updateAdaptation(e0,n0){var r0,i0;if(!e0)return fb.debug("[updateAdaptation] no rtpSender found");if(!ZP().supportSetRtpSenderParameters)return fb.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const o0={},{bitrateMax:s0,frameRate:a0,scaleResolutionDownBy:c0}=n0;s0&&(o0.maxBitrate=1e3*s0),a0&&(o0.maxFramerate=QO(a0)),c0&&c0>=1&&Dn(r0=["vp8","vp9"]).call(r0,this.store.codec)&&(o0.scaleResolutionDownBy=c0);const u0=e0.getParameters(),l0=(i0=u0.encodings)===null||i0===void 0?void 0:i0[0];l0&&Object.assign(l0,o0),Object.assign(u0,{});try{await e0.setParameters(u0),fb.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(u0.encodings)))}catch(d0){!("transport"in e0)||e0.transport&&e0.transport.state==="connected"?this.peerConnectionState!=="connected"?fb.debug("[updateAdaptation] peerConnection not connected}"):fb.debug("[updateAdaptation] updateRtpSenderEncodings failed",d0):fb.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e0,n0){try{if(!ZP().supportSetRtpSenderParameters||e0.length!==n0.length)return;for(let r0=0;r0<e0.length;r0++){const i0=e0[r0],o0=n0[r0];o0 instanceof aU&&!this.isVP8Simulcast(o0)&&await this.updateRtpSenderEncodings(o0,i0.sender)}}catch{fb.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e0,n0,r0){const i0=FU.parse(e0);return n0.forEach((o0,s0)=>{const a0=r0[s0],c0=i0.mediaDescriptions.find(u0=>u0.attributes.mid===a0);c0&&(JU(c0,o0),ex(c0,o0,this.store.codec))}),FU.print(i0)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e0=>{var n0;(n0=this.onFirstAudioReceived)===null||n0===void 0||n0.call(this,e0)},this.statsFilter.onFirstVideoReceived=e0=>{var n0;(n0=this.onFirstVideoReceived)===null||n0===void 0||n0.call(this,e0)},this.statsFilter.onFirstAudioDecoded=e0=>{var n0;(n0=this.onFirstAudioDecoded)===null||n0===void 0||n0.call(this,e0)},this.statsFilter.onFirstVideoDecoded=(e0,n0,r0)=>{var i0;(i0=this.onFirstVideoDecoded)===null||i0===void 0||i0.call(this,e0,n0,r0)},this.statsFilter.onSelectedLocalCandidateChanged=(e0,n0)=>{var r0;(r0=this.onSelectedLocalCandidateChanged)===null||r0===void 0||r0.call(this,e0,n0)},this.statsFilter.onSelectedRemoteCandidateChanged=(e0,n0)=>{var r0;(r0=this.onSelectedRemoteCandidateChanged)===null||r0===void 0||r0.call(this,e0,n0)},this.statsFilter.onFirstVideoDecodedTimeout=e0=>{var n0;(n0=this.onFirstVideoDecodedTimeout)===null||n0===void 0||n0.call(this,e0)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e0,n0){if(e0.length===n0.length)for(let c0=0;c0<e0.length;c0++){var r0,i0,o0,s0,a0;const u0=e0[c0],l0=n0[c0];if(l0 instanceof aU&&!Dn(r0=l0._hints).call(r0,mL.LOW_STREAM)&&(i0=l0._encoderConfig)!==null&&i0!==void 0&&i0.bitrateMax&&((o0=l0._encoderConfig)===null||o0===void 0?void 0:o0.bitrateMax)>200&&(s0=l0._scalabilityMode)!==null&&s0!==void 0&&s0.numSpatialLayers&&((a0=l0._scalabilityMode)===null||a0===void 0?void 0:a0.numSpatialLayers)>1&&this.store.codec==="vp8"){const d0={},h0={high:1e3*(l0._encoderConfig.bitrateMax-50),medium:5e4};d0.encodings=[{rid:"m",active:!0,maxBitrate:h0.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h0.high}];const p0=u0.sender.getParameters();await u0.sender.setParameters(Object.assign(p0,d0))}}}async applySimulcastEncodings(e0,n0){if(!Zv()&&e0.length===n0.length)for(let r0=0;r0<e0.length;r0++){const i0=n0[r0];if(i0 instanceof aU&&this.isVP8Simulcast(i0)){const o0=e0[r0],s0={},a0={high:1e3*(i0._encoderConfig.bitrateMax-50),medium:5e4};s0.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a0.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a0.medium,scaleResolutionDownBy:4}];const c0=o0.sender.getParameters();await o0.sender.setParameters(Object.assign(c0,s0))}}}isVP8Simulcast(e0){var n0,r0,i0,o0,s0;return!!(e0 instanceof aU&&XA("SIMULCAST")&&this.store.codec==="vp8"&&!Dn(n0=e0._hints).call(n0,mL.LOW_STREAM)&&(r0=e0._encoderConfig)!==null&&r0!==void 0&&r0.bitrateMax&&((i0=e0._encoderConfig)===null||i0===void 0?void 0:i0.bitrateMax)>200&&(o0=e0._scalabilityMode)!==null&&o0!==void 0&&o0.numSpatialLayers&&((s0=e0._scalabilityMode)===null||s0===void 0?void 0:s0.numSpatialLayers)>1)}logSDPExchange(e0,n0,r0,i0){if(XA("SDP_LOGGING"))return fb.upload("[".concat(this.store.clientId,"] exchanging ").concat(r0," ").concat(n0," SDP during P2PConnection.").concat(i0,`
`),e0),n0==="offer"?o0=>{this.logSDPExchange(o0,"answer",r0==="local"?"remote":"local",i0)}:void 0}async getRemoteSSRC(e0){if(!this.remoteSDP)return;const n0=this.remoteSDP.getSSRC(e0);return n0&&n0.length!==0?n0[0].ssrcId:void 0}setConfiguration(e0){if(ZP().supportPCSetConfiguration){const n0=u1.resolvePCConfiguration(e0);this.peerConnection.setConfiguration(n0)}}},Cw(sB.prototype,"updateRemoteRTPCapabilities",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"updateRemoteRTPCapabilities"),sB.prototype),Cw(sB.prototype,"connect",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"connect"),sB.prototype),Cw(sB.prototype,"updateRemoteConnect",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"updateRemoteConnect"),sB.prototype),Cw(sB.prototype,"createDataChannels",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"createDataChannels"),sB.prototype),Cw(sB.prototype,"receive",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"receive"),sB.prototype),Cw(sB.prototype,"batchReceive",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"batchReceive"),sB.prototype),Cw(sB.prototype,"stopReceiving",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"stopReceiving"),sB.prototype),Cw(sB.prototype,"muteRemote",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"muteRemote"),sB.prototype),Cw(sB.prototype,"unmuteRemote",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"unmuteRemote"),sB.prototype),Cw(sB.prototype,"muteLocal",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"muteLocal"),sB.prototype),Cw(sB.prototype,"unmuteLocal",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"unmuteLocal"),sB.prototype),Cw(sB.prototype,"close",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"close"),sB.prototype),Cw(sB.prototype,"updateEncoderConfig",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"updateEncoderConfig"),sB.prototype),Cw(sB.prototype,"updateSendParameters",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"updateSendParameters"),sB.prototype),Cw(sB.prototype,"replaceTrack",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"replaceTrack"),sB.prototype),Cw(sB.prototype,"updateAdaptation",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"updateAdaptation"),sB.prototype),Cw(sB.prototype,"getRemoteSSRC",[lB],Object.getOwnPropertyDescriptor(sB.prototype,"getRemoteSSRC"),sB.prototype),sB);function lB(t0,e0,n0){const r0=t0[e0];if(typeof r0!="function")throw new Error("Cannot use mutex on object property.");return n0.value=async function(){const i0=this.mutex,o0=await i0.lock("From P2PConnection.".concat(e0));try{for(var s0=arguments.length,a0=new Array(s0),c0=0;c0<s0;c0++)a0[c0]=arguments[c0];return await r0.apply(this,a0)}finally{o0()}},n0}var uB;function hB(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function pB(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?hB(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):hB(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}function _B(t0){var e0,n0,r0,i0=2;for(typeof Symbol<"u"&&(n0=JI,r0=Symbol.iterator);i0--;){if(n0&&(e0=t0[n0])!=null)return e0.call(t0);if(r0&&(e0=t0[r0])!=null)return new EB(e0.call(t0));n0="@@asyncIterator",r0="@@iterator"}throw new TypeError("Object is not async iterable")}function EB(t0){function e0(n0){if(Object(n0)!==n0)return Gh.reject(new TypeError(n0+" is not an object."));var r0=n0.done;return Gh.resolve(n0.value).then(function(i0){return{value:i0,done:r0}})}return EB=function(n0){this.s=n0,this.n=n0.next},EB.prototype={s:null,n:null,next:function(){return e0(this.n.apply(this.s,arguments))},return:function(n0){var r0=this.s.return;return r0===void 0?Gh.resolve({value:n0,done:!0}):e0(r0.apply(this.s,arguments))},throw:function(n0){var r0=this.s.return;return r0===void 0?Gh.reject(n0):e0(r0.apply(this.s,arguments))}},new EB(t0)}let fB=(uB=class extends xy{get state(){return this._state}set state(t0){const e0=this._state;this._state=t0,this.emit(_O.StateChange,e0,this._state)}constructor(t0,e0){super(),Fg(this,"isPlanB",void 0),Fg(this,"store",void 0),Fg(this,"statsUploader",void 0),Fg(this,"connection",void 0),Fg(this,"localTrackMap",new Map),Fg(this,"remoteUserMap",new Map),Fg(this,"localDataChannels",[]),Fg(this,"remoteDataChannelMap",new Map),Fg(this,"pendingLocalTracks",[]),Fg(this,"pendingRemoteTracks",[]),Fg(this,"pendingLocalDataChannels",[]),Fg(this,"pendingRemoteDataChannels",[]),Fg(this,"statsCollector",void 0),Fg(this,"shouldForwardP2PCreation",void 0),Fg(this,"iceFailedCount",0),Fg(this,"dtlsFailedCount",0),Fg(this,"mutex",new NA("P2PChannel-mutex")),Fg(this,"_state",pO.Disconnected),Fg(this,"_pcStatsUploadType",XA("NEW_ICE_RESTART")?uO.FIRST_CONNECTION:uO.OLD_FIRST_CONNECTION),Fg(this,"_isInRestartIce",!1),Fg(this,"_isStartRestartIce",!1),Fg(this,"_restartStates",["disconnected","failed"]),Fg(this,"_restartTimer",void 0),Fg(this,"_isFirstConnected",!0),Fg(this,"handleMuteLocalTrack",async(n0,r0,i0)=>{const o0=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==pO.Connected)return void i0(new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const s0=this.filterTobeMutedTracks(n0);if(s0.length===0)return void r0();const a0=s0.find(u0=>u0[0]==="videoLowTrack");a0&&a0[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(s0.map(u0=>{let[,{id:l0}]=u0;return l0}));const c0=this.createMuteMessage(s0);await $y(this,_O.RequestMuteLocal,c0),r0()}catch(s0){i0(s0)}finally{o0()}}),Fg(this,"handleUnmuteLocalTrack",async(n0,r0,i0)=>{const o0=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==pO.Connected)return void i0(new Cy(Ry.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const s0=this.filterTobeUnmutedTracks(n0);if(s0.length===0)return void r0();const a0=s0.find(u0=>u0[0]==="videoLowTrack");if(a0){const u0=a0[1];if(u0.track._originMediaStreamTrack.stop(),!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding){const l0=n0._mediaStreamTrack.clone();u0.track._mediaStreamTrack=l0,u0.track._originMediaStreamTrack=l0}else{const l0=KV(n0,tA(this,_O.RequestLowStreamParameter));u0.track._mediaStreamTrack=l0,u0.track._originMediaStreamTrack=l0}await new Gh((l0,d0)=>{this.handleReplaceTrack(u0.track,l0,d0,!0)})}await this.connection.unmuteLocal(s0.map(u0=>{let[,{id:l0}]=u0;return l0}));const c0=this.createUnmuteMessage(s0);await $y(this,_O.RequestUnmuteLocal,c0),r0()}catch(s0){i0(s0)}finally{o0()}}),Fg(this,"handleUpdateVideoEncoder",async(n0,r0,i0)=>{const o0=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const s0=this.localTrackMap.get(hO.LocalVideoTrack);if(!this.connection||!s0||s0.track!==n0||this.state!==pO.Connected)return void r0();const{id:a0,track:c0}=s0;await this.connection.updateSendParameters(a0,c0),await this.connection.updateEncoderConfig(a0,c0),this.emit(_O.UpdateVideoEncoder,c0),r0()}catch(s0){i0(s0)}finally{o0()}}),Fg(this,"handleUpdateVideoSendParameters",async(n0,r0,i0)=>{const o0=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const s0=this.localTrackMap.get(hO.LocalVideoTrack);if(!this.connection||!s0||s0.track!==n0||this.state!==pO.Connected)return void r0();const{id:a0,track:c0}=s0;await this.connection.updateSendParameters(a0,c0),r0()}catch(s0){i0(s0)}finally{o0()}}),Fg(this,"handleReplaceMixingTrack",async(n0,r0,i0,o0)=>{if(!this.connection||this.state!==pO.Connected)return void r0();const s0=hF([n0]);let a0;fb.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(s0.getTrackId(),"]")),typeof o0=="boolean"&&o0||(a0=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n0,s0),r0()}catch(u0){i0(u0)}finally{var c0;(c0=a0)===null||c0===void 0||c0()}}),Fg(this,"handleReplaceTrack",async(n0,r0,i0,o0)=>{let s0;fb.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n0.getTrackId(),"]")),typeof o0=="boolean"&&o0||(s0=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var a0;const u0=Array.from(this.localTrackMap.entries()).find(l0=>{let[,{track:d0}]=l0;return n0===d0});if(!this.connection||!u0||this.state!==pO.Connected)return void r0();if(await((a0=this.connection)===null||a0===void 0?void 0:a0.replaceTrack(n0,u0[1].id)),this.isPlanB){const l0=u0[1];l0.id=n0._mediaStreamTrack.id,this.localTrackMap.set(u0[0],l0)}if(u0[0]===hO.LocalVideoTrack&&!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding){const l0=this.localTrackMap.get(hO.LocalVideoLowTrack);if(l0){const d0=n0._mediaStreamTrack.clone();l0.track._originMediaStreamTrack.stop(),l0.track._mediaStreamTrack=d0,l0.track._originMediaStreamTrack=d0,await new Gh((h0,p0)=>{this.handleReplaceTrack(l0.track,h0,p0,!0)})}}r0()}catch(u0){i0(u0)}finally{var c0;(c0=s0)===null||c0===void 0||c0()}}),Fg(this,"handleGetRTCStats",n0=>{n0(this.statsCollector.getRTCStats())}),Fg(this,"handleGetLocalVideoStats",n0=>{n0(this.statsCollector.getLocalVideoTrackStats())}),Fg(this,"handleGetLocalAudioStats",n0=>{n0(this.statsCollector.getLocalAudioTrackStats())}),Fg(this,"handleGetRemoteVideoStats",n0=>this.statsCollector.getRemoteVideoTrackStats(n0.uid)[n0.uid]),Fg(this,"handleGetRemoteAudioStats",n0=>this.statsCollector.getRemoteAudioTrackStats(n0.uid)[n0.uid]),this.store=t0,this.statsCollector=e0,this.statsCollector.addP2PChannel(this),this.statsUploader=new aF(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!ZP().supportUnifiedPlan||XA("CHROME_FORCE_PLAN_B")&&Ey(),this.shouldForwardP2PCreation=XA("FORWARD_P2P_CREATION")&&ZP().supportPCSetConfiguration&&_y(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new FF({},this.store):new dB({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(t0){var e0;this.state=pO.New;const n0=this.shouldForwardP2PCreation&&((e0=this.connection)===null||e0===void 0?void 0:e0.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n0||(n0&&this.connection&&(fb.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new FF(t0,this.store):new dB(t0,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=XA("NEW_ICE_RESTART")?uO.FIRST_CONNECTION:uO.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(t0),this.connection.establishPromise}async connect(t0){if(!this.connection)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");XA("ENABLE_PREALLOC_PC")&&this.state===pO.Connected?await this.connection.updateRemoteConnect(t0):(this.store.peerConnectionStart(),await this.connection.connect(t0),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=pO.Connected)}updateRemoteRTPCapabilities(t0){const e0=Array.from(this.localTrackMap.entries()).filter(i0=>{var o0;let[s0]=i0;return Dn(o0=[hO.LocalVideoLowTrack,hO.LocalVideoTrack]).call(o0,s0)}),n0=e0.map(i0=>{let[,{id:o0}]=i0;return o0}),r0=e0.map(i0=>{let[o0]=i0;return o0});if(this.connection instanceof dB){if(vb.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r0),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t0)}),!Dn(t0).call(t0,this.store.codec)){const i0=["vp9","vp8","h264"].find(o0=>Dn(t0).call(t0,o0));i0&&(this.store.codec=i0,fb.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i0,".")))}this.connection.updateRemoteRTPCapabilities(n0,t0)}}async getEstablishParams(){var t0;if(this.connection instanceof dB&&this.connection.peerConnectionState!=="closed"&&Dn(t0=[pO.New,pO.Connected]).call(t0,this.state))return this.connection.establishPromise}async publishDataChannel(t0){if(!this.connection||this.state!==pO.Connected){if(this.state===pO.Disconnected)throw new Cy(Ry.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t0.forEach(n0=>{var r0;Dn(r0=this.pendingLocalDataChannels).call(r0,n0)||this.pendingLocalDataChannels.push(n0)}),[]}const e0=this.filterTobePublishedDataChannels(t0);return e0.length===0?[]:(e0.forEach(n0=>{const r0=Date.now();this.store.publish(n0.id.toString(),"datachannel",r0)}),await this.connection.createDataChannels(this.store.uid,e0),e0.forEach(n0=>{this.localDataChannels.push(n0);const r0=Date.now();this.store.publish(n0.id+"","datachannel",void 0,r0)}),t0.map(n0=>({streamId:n0.id,ordered:n0.ordered,maxRetransmits:n0.maxRetransmits,metadata:n0.metadata,channelId:n0._originDataChannelId})))}publish(t0,e0,n0){var r0=this;return YI(function*(){const i0=yield qI(r0.mutex.lock("From P2PChannel.publish"));try{if(!r0.connection||r0.state!==pO.Connected){if(r0.state===pO.Disconnected)throw new Cy(Ry.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r0.throwIfTrackTypeNotMatch(t0);const s0=t0.filter(a0=>r0.pendingLocalTracks.indexOf(a0)===-1);return void(r0.pendingLocalTracks=r0.pendingLocalTracks.concat(s0))}r0.store.pubId=r0.store.pubId+1,rV.markPublishStart(r0.store.clientId,r0.store.pubId);const o0=r0.filterTobePublishedTracks(t0,e0,n0);if(o0.length===0)return void(yield qI(r0.tryToUnmuteAudio(t0)));yield*zI(_B(r0.doPublish(r0.connection,o0)))}finally{i0()}})()}doPublish(t0,e0){var n0=this;return YI(function*(){e0.forEach(d0=>{let{track:h0,type:p0}=d0;const m0=Date.now();n0.store.publish(h0.getTrackId(),p0===hO.LocalAudioTrack?"audio":"video",m0)}),n0.bindLocalTrackEvents(e0);const r0=e0.map(d0=>{let{track:h0}=d0;return h0}),i0=yield qI(t0.send(r0,n0.store.codec,n0.store.audioCodec)),o0=(yield qI(i0.next())).value,s0=n0.createGatewayPublishMessage(e0,o0);let a0;try{a0=yield s0}catch(d0){throw i0.throw(d0),(d0==null?void 0:d0.code)===Ry.WS_ABORT&&e0.forEach(h0=>{let{track:p0}=h0;n0.pendingLocalTracks.indexOf(p0)===-1&&n0.pendingLocalTracks.push(p0)}),n0.unbindLocalTrackEvents(e0),d0}const c0=n0.mapPubResToRemoteConfig(s0,a0,r0),u0=(yield qI(i0.next(c0))).value,l0=XA("ENABLE_VIDEO_SEI");r0.forEach(async d0=>{const h0=d0.getRTCRtpTransceiver();h0&&l0&&(d0.trackMediaType===dO.VIDEO?await kU(h0.sender,d0):d0.trackMediaType===dO.AUDIO&&await async function(p0){if(!ZP().supportWebRTCEncodedTransform)return void fb.warning("browser not support audio encoded transform");if(NU.has(p0)||!p0.track)return;const m0={track:p0.track};if(Jv()){if(!p0.createEncodedStreams)return void fb.warning("browser not support createEncodedStreams() API");let g0=null;try{g0=p0.createEncodedStreams()}catch(_0){return void fb.error("create audio-encoded-streams error",_0&&_0.message)}const E0=new TransformStream({transform(_0,y0){m0.controller||(m0.controller=y0),p0.track&&p0.track.id!==m0.track.id&&(fb.debug("audio track changed: ".concat(m0.track.id," => ").concat(p0.track.id)),m0.track.removeEventListener("ended",f0),m0.track=p0.track,m0.track.addEventListener("ended",f0)),y0.enqueue(_0)}});g0.readable.pipeThrough(E0).pipeTo(g0.writable)}else if(Xv()){if(typeof RTCRtpScriptTransform>"u")return void fb.warning("browser not support RTCRtpScriptTransform");const g0=OU(),E0=new MessageChannel;await new Gh(y0=>g0.onmessage=b0=>{b0.data==="registered"&&y0(void 0)});const _0=new RTCRtpScriptTransform(g0,{name:"tx",port:E0.port2},[E0.port2]);p0.transform=_0,await new Gh(y0=>g0.onmessage=b0=>{b0.data==="started"&&y0(void 0)}),E0.port1.onmessage=y0=>{var b0;y0.data.transformed&&p0.track&&((b0=p0.track)===null||b0===void 0?void 0:b0.id)!==m0.track.id&&(fb.debug("audio track changed: ".concat(m0.track.id," => ").concat(p0.track.id)),m0.track.removeEventListener("ended",f0),m0.track=p0.track,m0.track.addEventListener("ended",f0))},m0.worker=g0}function f0(){if(p0.track){if(this.id!==p0.track.id)return;p0.track.removeEventListener("ended",f0)}const g0=NU.get(p0);if(g0){NU.delete(p0);try{var E0,_0;(E0=g0.controller)===null||E0===void 0||E0.terminate(),(_0=g0.worker)===null||_0===void 0||_0.terminate()}catch(y0){fb.warning(y0&&y0.message)}}}NU.set(p0,m0),p0.track.addEventListener("ended",f0)}(h0.sender))}),e0.forEach(d0=>{let{type:h0}=d0;n0.statsCollector.addLocalStats(h0)}),n0.assignLocalTracks(e0,u0),n0.statsUploader.startUploadOutboundStats(),e0.forEach(d0=>{let{track:h0,type:p0}=d0;const m0=Date.now();n0.store.publish(h0.getTrackId(),p0===hO.LocalAudioTrack?"audio":"video",void 0,m0)})})()}async updateVideoStreamParameter(t0,e0){const n0=this.localTrackMap.get(e0);if(!n0)return;if(!(n0.track instanceof aU))return fb.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof dB||this.connection instanceof FF))return fb.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:r0}=n0,i0=function(o0,s0){const a0={};return o0.height&&o0.width&&(a0.scaleResolutionDownBy=iN(o0,s0)),a0.maxFramerate=o0.framerate?QO(o0.framerate):void 0,a0.maxBitrate=o0.bitrate?1e3*o0.bitrate:void 0,a0}(t0,r0);if(r0._encoderConfig||(r0._encoderConfig={}),e0!==hO.LocalVideoLowTrack||!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding)i0.scaleResolutionDownBy!=null&&(r0._encoderConfig.scaleResolutionDownBy=i0.scaleResolutionDownBy);else{const o0=r0._originMediaStreamTrack;if(!o0.canvas)return fb.warn("[".concat(r0.getTrackId(),"] no canvas on track"));(function(s0,a0){const c0=s0.canvas;a0.width&&(c0.width=QO(a0.width)),a0.height&&(c0.height=QO(a0.height)),a0.framerate&&(c0.stopCapture&&c0.stopCapture(),c0.stopCapture=QL(()=>{!c0.startCapture&&c0.stopCapture&&c0.stopCapture(),c0.startCapture&&c0.startCapture()},QO(a0.framerate)))})(o0,t0)}i0.maxBitrate!=null&&(r0._encoderConfig.bitrateMax=i0.maxBitrate/1e3),i0.maxFramerate!=null&&(r0._encoderConfig.frameRate&&typeof r0._encoderConfig.frameRate=="object"?r0._encoderConfig.frameRate.max=i0.maxFramerate:r0._encoderConfig.frameRate={max:i0.maxFramerate}),fb.debug("[".concat(r0.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r0._encoderConfig))),await this.connection.updateRtpSenderEncodings(r0)}publishLowStream(t0){var e0=this;return YI(function*(){if(!e0.connection||e0.state!==pO.Connected)return;const n0=yield qI(e0.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i0=e0.localTrackMap.get(hO.LocalVideoTrack);if(!i0)throw new Cy(Ry.UNEXPECTED_ERROR,"Could not find high stream");if(e0.localTrackMap.has(hO.LocalVideoLowTrack))throw new Cy(Ry.UNEXPECTED_ERROR,"[".concat(e0.store.clientId,"] Can't publish low stream when stream already publish"));const o0=[{track:e0.getLowVideoTrack(i0.track,t0),type:hO.LocalVideoLowTrack}];if(yield*zI(_B(e0.doPublish(e0.connection,o0))),i0.track.muted||!i0.track.enabled){var r0;const s0=(r0=e0.localTrackMap.get(hO.LocalVideoLowTrack))===null||r0===void 0?void 0:r0.id;s0!==void 0&&(yield qI(e0.connection.muteLocal([s0])))}}finally{n0()}})()}async republish(){this.pendingLocalTracks.length>0&&(fb.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Zy(this,_O.RequestRePublish,this.pendingLocalTracks),this.emit(_O.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(fb.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Zy(this,_O.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(t0){for(let e0=this.pendingRemoteTracks.length-1;e0>=0;e0--){const{user:n0,kind:r0}=this.pendingRemoteTracks[e0];(r0!==dO.AUDIO||n0._audio_added_&&n0._audioSSRC)&&(r0!==dO.VIDEO||n0._video_added_&&n0._videoSSRC)||this.pendingRemoteTracks.splice(e0,1)}if(t0)await Zy(this,_O.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e0,kind:n0}of this.pendingRemoteTracks)await this.subscribe(e0,n0,n0===dO.VIDEO?e0._videoSSRC:e0._audioSSRC);this.pendingRemoteTracks.forEach(e0=>{let{user:n0}=e0;this.emit(_O.MediaReconnectEnd,n0.uid)}),this.pendingRemoteTracks=[]}async unpublish(t0){if(!this.connection||this.state!==pO.Connected)return void t0.forEach(r0=>{const i0=this.pendingLocalTracks.indexOf(r0);i0!==-1&&this.pendingLocalTracks.splice(i0,1)});const e0=this.filterTobeUnpublishedTracks(t0);if(e0.length===0)return;const n0=e0.find(r0=>r0[0]==="videoLowTrack");return n0&&n0[1].track.close(),this.doUnpublish(this.connection,e0)}async unpublishDataChannel(t0){if(!this.connection||this.state!==pO.Connected)return void t0.forEach(n0=>{const r0=this.pendingLocalDataChannels.indexOf(n0);r0!==-1&&this.pendingLocalDataChannels.splice(r0,1)});const e0=this.filterTobeUnpublishedDataChannels(t0);return e0.length!==0?(e0.forEach(n0=>{const r0=this.localDataChannels.indexOf(n0);r0!==-1&&this.localDataChannels.splice(r0,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e0.map(n0=>n0.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==pO.Connected)return;const t0=this.localTrackMap.get(hO.LocalVideoLowTrack);if(!t0)return;t0.track.close();const e0=[[hO.LocalVideoLowTrack,t0]];return this.doUnpublish(this.connection,e0)}async doUnpublish(t0,e0){const n0=this.createGatewayUnpublishMessage(e0);return await t0.stopSending(e0.map(r0=>{let[,{id:i0}]=r0;return i0})),this.withdrawLocalTracks(e0),this.unbindLocalTrackEvents(e0.map(r0=>{let[i0,{track:o0}]=r0;return{type:i0,track:o0}})),e0.forEach(r0=>{let[i0]=r0;this.statsCollector.removeLocalStats(i0)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n0}async subscribeDataChannel(t0,e0){if(!this.connection||this.state!==pO.Connected)throw new Cy(Ry.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n0=e0.filter(r0=>{var i0;return!((i0=this.remoteDataChannelMap.get(t0))!==null&&i0!==void 0&&i0.get(r0.id))});if(n0.length!==0)return await this.connection.createDataChannels(t0.uid,n0),n0.forEach(r0=>{var i0;this.remoteDataChannelMap.has(t0)?(i0=this.remoteDataChannelMap.get(t0))===null||i0===void 0||i0.set(r0.id,r0):this.remoteDataChannelMap.set(t0,new Map([[r0.id,r0]]));const o0=this.pendingRemoteDataChannels.findIndex(s0=>{let{user:a0,id:c0}=s0;return a0.uid===t0.uid&&c0===r0.id});o0!==-1&&this.pendingRemoteDataChannels.splice(o0,1)}),n0.map(r0=>r0.id)}async subscribe(t0,e0,n0,r0,i0){var o0;if(!this.connection||this.state!==pO.Connected)throw new Cy(Ry.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o0=this.remoteUserMap.get(t0))!==null&&o0!==void 0&&o0.has(e0))return;let s0,a0,c0;const u0=this.connection.getPreMedia(n0);if(u0)fb.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n0,", no need to send sub to gateway.")),c0=u0.transceiver,s0=u0.track,a0=u0.id;else if(i0){const h0=i0.find(m0=>{let{stream_type:f0}=m0;return f0===e0});if(!h0)throw new Cy(Ry.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e0," for user: ").concat(t0.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e0,"."));const p0=await this.connection.receive(e0,h0.ssrcs,String(t0._uintid),h0.attributes);this.connection instanceof dB&&(c0=p0.transceiver),s0=p0.track,a0=p0.id}else{const h0=await this.connection.receive(e0,[{ssrcId:n0,rtx:r0}],String(t0._uintid),void 0);this.connection instanceof dB&&(c0=h0.transceiver),s0=h0.track,a0=h0.id}e0===dO.AUDIO?(t0._audioTrack?t0._audioTrack._updateOriginMediaStreamTrack(s0):(t0._audioTrack=new vU(s0,t0.uid,t0._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t0._audioTrack.getTrackId()))),c0&&t0._audioTrack._updateRtpTransceiver(c0),this.bindRemoteTrackEvents(t0,t0._audioTrack)):(t0._videoTrack?t0._videoTrack._updateOriginMediaStreamTrack(s0):(t0._videoTrack=new IU(s0,t0.uid,t0._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t0._videoTrack.getTrackId()))),c0&&t0._videoTrack._updateRtpTransceiver(c0),this.bindRemoteTrackEvents(t0,t0._videoTrack)),XA("ENABLE_VIDEO_SEI")&&c0&&(e0==dO.VIDEO?await async function(h0){let p0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ZP().supportWebRTCEncodedTransform)return void fb.warning("browser not support video encoded transform");if(!h0.track)return;if(MU.has(h0)){const g0=MU.get(h0);return void(g0&&(g0.onSei=p0.onSei))}const m0={track:h0.track,onSei:p0.onSei};if(Jv()){if(!h0.createEncodedStreams)return void fb.warning("browser not support createEncodedStreams() API");let g0=null;try{g0=h0.createEncodedStreams()}catch(_0){return void fb.error("create video-encoded-streams error",_0&&_0.message)}const E0=new TransformStream({transform(_0,y0){m0.controller||(m0.controller=y0),h0.track&&h0.track.id!==m0.track.id&&(fb.debug("video track changed: ".concat(m0.track.id," => ").concat(h0.track.id)),m0.track.removeEventListener("ended",f0),m0.track=h0.track,m0.track.addEventListener("ended",f0));const b0=function(S0){const w0=new DataView(S0.data);let I0=0;for(;I0+4<S0.data.byteLength;){if(w0.getUint8(I0+0)===0&&w0.getUint8(I0+1)===0&&w0.getUint8(I0+2)===0&&w0.getUint8(I0+3)===1&&w0.getUint8(I0+4)===6){let L0=I0+6,M0=0,C0=0;for(;(C0=w0.getUint8(L0++))===255;)M0+=255;M0+=C0;const U0=PU(S0.data,L0,M0);return new Uint8Array(U0)}I0++}return null}(_0);b0&&m0.onSei&&m0.onSei(b0),y0.enqueue(_0)}});g0.readable.pipeThrough(E0).pipeTo(g0.writable)}else if(Xv()){if(typeof RTCRtpScriptTransform>"u")return void fb.warning("browser not support RTCRtpScriptTransform");const g0=OU(),E0=new MessageChannel;await new Gh(y0=>g0.onmessage=b0=>{b0.data==="registered"&&y0(void 0)});const _0=new RTCRtpScriptTransform(g0,{name:"rx",port:E0.port2},[E0.port2]);h0.transform=_0,await new Gh(y0=>g0.onmessage=b0=>{b0.data==="started"&&y0(void 0)}),E0.port1.onmessage=y0=>{var b0;y0.data.transformed&&h0.track&&((b0=h0.track)===null||b0===void 0?void 0:b0.id)!==m0.track.id?(fb.debug("video track changed: ".concat(m0.track.id," => ").concat(h0.track.id)),m0.track.removeEventListener("ended",f0),m0.track=h0.track,m0.track.addEventListener("ended",f0)):y0.data.sei&&m0.onSei&&m0.onSei(y0.data.sei)},m0.worker=g0}function f0(){if(h0.track){if(this.id!==h0.track.id)return;h0.track.removeEventListener("ended",f0)}(function(g0){const E0=MU.get(g0);if(E0){MU.delete(g0);try{var _0,y0;(_0=E0.controller)===null||_0===void 0||_0.terminate(),(y0=E0.worker)===null||y0===void 0||y0.terminate()}catch(b0){fb.warning(b0&&b0.message)}}})(h0)}MU.set(h0,m0),h0.track.addEventListener("ended",f0)}(c0.receiver,{onSei:h0=>{var p0;(p0=t0._videoTrack)===null||p0===void 0||p0._onSei(h0)}}):e0==dO.AUDIO&&await async function(h0){if(!ZP().supportWebRTCEncodedTransform)return void fb.warning("browser not support audio encoded transform");if(DU.has(h0))return;const p0={track:h0.track};if(Jv()){if(!h0.createEncodedStreams)return void fb.warning("browser not support createEncodedStreams() API");let f0=null;try{f0=h0.createEncodedStreams()}catch(E0){return void fb.error("create audio-encoded-streams error",E0&&E0.message)}const g0=new TransformStream({transform(E0,_0){p0.controller||(p0.controller=_0),h0.track&&h0.track.id!==p0.track.id&&(fb.debug("audio track changed: ".concat(p0.track.id," => ").concat(h0.track.id)),p0.track.removeEventListener("ended",m0),p0.track=h0.track,p0.track.addEventListener("ended",m0)),_0.enqueue(E0)}});f0.readable.pipeThrough(g0).pipeTo(f0.writable)}else if(Xv()){if(typeof RTCRtpScriptTransform>"u")return void fb.warning("browser not support RTCRtpScriptTransform");const f0=OU(),g0=new MessageChannel;await new Gh(_0=>f0.onmessage=y0=>{y0.data==="registered"&&_0(void 0)});const E0=new RTCRtpScriptTransform(f0,{name:"rx",port:g0.port2},[g0.port2]);h0.transform=E0,await new Gh(_0=>f0.onmessage=y0=>{y0.data==="started"&&_0(void 0)}),g0.port1.onmessage=_0=>{var y0;_0.data.transformed&&h0.track&&((y0=h0.track)===null||y0===void 0?void 0:y0.id)!==p0.track.id&&(fb.debug("audio track changed: ".concat(p0.track.id," => ").concat(h0.track.id)),p0.track.removeEventListener("ended",m0),p0.track=h0.track,p0.track.addEventListener("ended",m0))},p0.worker=f0}function m0(){h0.track.removeEventListener("ended",m0),function(f0){const g0=DU.get(f0);if(g0){DU.delete(f0);try{var E0,_0;(E0=g0.controller)===null||E0===void 0||E0.terminate(),(_0=g0.worker)===null||_0===void 0||_0.terminate()}catch(y0){fb.warning(y0&&y0.message)}}}(h0)}DU.set(h0,p0),h0.track.addEventListener("ended",m0)}(c0.receiver));const l0=this.remoteUserMap.get(t0);l0?l0.set(e0,a0):this.remoteUserMap.set(t0,new Map([[e0,a0]])),this.statsCollector.addRemoteStats(t0.uid),this.statsUploader.startUploadInboundStats();const d0=this.pendingRemoteTracks.findIndex(h0=>{let{user:p0,kind:m0}=h0;return p0.uid===t0.uid&&e0===m0});d0!==-1&&(this.pendingRemoteTracks.splice(d0,1),this.emit(_O.MediaReconnectEnd,t0.uid))}async massSubscribe(t0){return this.massSubscribeNoLock(t0)}async massSubscribeNoLock(t0){if(!this.connection||this.state!==pO.Connected)throw new Cy(Ry.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t0=t0.filter(i0=>{var o0;let{user:s0,mediaType:a0}=i0;return!((o0=this.remoteUserMap.get(s0))!==null&&o0!==void 0&&o0.has(a0))});const e0=[],n0=new Map;t0.forEach(i0=>{if(!this.connection)return;const o0=this.connection.getPreMedia(i0.ssrcId);o0?n0.set(i0.ssrcId,o0):e0.push(i0)});const r0=await this.connection.batchReceive(e0.map(i0=>{let{user:o0,mediaType:s0,ssrcId:a0,rtxSsrcId:c0}=i0;return{kind:s0,ssrcMsg:[{ssrcId:a0,rtx:c0}],mslabel:String(o0._uintid)}}));e0.forEach((i0,o0)=>{n0.set(i0.ssrcId,r0[o0])}),t0.forEach(i0=>{let{user:o0,mediaType:s0,ssrcId:a0}=i0;const c0=n0.get(a0);if(!c0)return void fb.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o0.uid," subscribe data,").concat(s0,", ").concat(a0));const{track:u0,id:l0,transceiver:d0}=c0;s0===dO.AUDIO?(o0._audioTrack?o0._audioTrack._updateOriginMediaStreamTrack(u0):(o0._audioTrack=new vU(u0,o0.uid,o0._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o0._audioTrack.getTrackId()))),d0&&o0._audioTrack._updateRtpTransceiver(d0),this.bindRemoteTrackEvents(o0,o0._audioTrack)):(o0._videoTrack?o0._videoTrack._updateOriginMediaStreamTrack(u0):(o0._videoTrack=new IU(u0,o0.uid,o0._uintid,this.store),fb.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o0._videoTrack.getTrackId()))),d0&&o0._videoTrack._updateRtpTransceiver(d0),this.bindRemoteTrackEvents(o0,o0._videoTrack));const h0=this.remoteUserMap.get(o0);h0?h0.set(s0,l0):this.remoteUserMap.set(o0,new Map([[s0,l0]])),this.statsCollector.addRemoteStats(o0.uid),this.statsUploader.startUploadInboundStats();const p0=this.pendingRemoteTracks.findIndex(m0=>{let{user:f0,kind:g0}=m0;return f0.uid===o0.uid&&s0===g0});p0!==-1&&(this.pendingRemoteTracks.splice(p0,1),this.emit(_O.MediaReconnectEnd,o0.uid))})}async unsubscribe(t0,e0,n0){const r0=this.pendingRemoteTracks.filter(s0=>{let{user:a0,kind:c0}=s0;return e0!==void 0?a0.uid===t0.uid&&e0===c0:a0.uid===t0.uid});if(r0.forEach(s0=>{const a0=this.pendingRemoteTracks.indexOf(s0);this.pendingRemoteTracks.splice(a0,1)}),this.connection&&this.state===pO.Connected||n0||r0.forEach(s0=>{let{kind:a0}=s0;var c0;if(a0===dO.AUDIO)(c0=t0._audioTrack)===null||c0===void 0||c0._destroy(),t0._audioTrack=void 0;else if(a0===dO.VIDEO){var u0;(u0=t0._videoTrack)===null||u0===void 0||u0._destroy(),t0._videoTrack=void 0}}),!this.connection||this.state!==pO.Connected)return;const i0=this.filterTobeUnSubscribedTracks(t0,e0);if(i0.length===0)return;await this.connection.stopReceiving(i0.map(s0=>{let[,{id:a0}]=s0;return a0}));const o0=this.createUnsubscribeMessage(i0);return this.withdrawRemoteTracks(i0),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i0.forEach(s0=>{let[a0,{kind:c0}]=s0;var u0,l0;if(c0===dO.VIDEO&&a0._videoSSRC&&((u0=this.connection)===null||u0===void 0||u0.setStatsRemoteVideoIsReady(a0._videoSSRC,!1)),c0===dO.VIDEO)this.unbindRemoteTrackEvents(a0._videoTrack),n0||((l0=a0._videoTrack)===null||l0===void 0||l0._destroy(),a0._videoTrack=void 0);else if(c0===dO.AUDIO){var d0;this.unbindRemoteTrackEvents(a0._audioTrack),!n0&&((d0=a0._audioTrack)===null||d0===void 0||d0._destroy(),a0._audioTrack=void 0)}}),o0}async unsubscribeDataChannel(t0,e0){if(e0.forEach(i0=>{const o0=this.pendingRemoteDataChannels.findIndex(s0=>s0.id===i0.id);o0!==-1&&this.pendingRemoteDataChannels.splice(o0,1)}),!this.connection)return;const n0=this.filterTobeUnSubscribedDataChannels(t0,e0);if(n0.length===0)return;e0.forEach(i0=>{i0._close()});const r0=this.remoteDataChannelMap.get(t0);return n0.forEach(i0=>{r0&&r0.delete(i0.id)}),r0&&r0.size===0&&(this.remoteDataChannelMap.delete(t0),await this.connection.stopDataChannels(t0.uid)),n0.map(i0=>i0.id)}async massUnsubscribe(t0){return this.massUnsubscribeNoLock(t0)}async massUnsubscribeNoLock(t0){let e0=[];for(const{user:i0,mediaType:o0}of t0){const s0=this.pendingRemoteTracks.filter(a0=>{let{user:c0,kind:u0}=a0;return o0!==void 0?c0.uid===i0.uid&&o0===u0:c0.uid===i0.uid});s0.forEach(a0=>{const c0=this.pendingRemoteTracks.indexOf(a0);this.pendingRemoteTracks.splice(c0,1)}),e0=e0.concat(s0)}if(!this.connection||this.state!==pO.Connected)return void e0.forEach(i0=>{let{user:o0,kind:s0}=i0;var a0;if(s0===dO.AUDIO)(a0=o0._audioTrack)===null||a0===void 0||a0._destroy(),o0._audioTrack=void 0;else if(s0===dO.VIDEO){var c0;(c0=o0._videoTrack)===null||c0===void 0||c0._destroy(),o0._videoTrack=void 0}});const n0=Jn(t0).call(t0,(i0,o0)=>{let{user:s0,mediaType:a0}=o0;const c0=this.filterTobeUnSubscribedTracks(s0,a0);return i0.concat(c0)},[]);if(n0.length===0)return;await this.connection.stopReceiving(n0.map(i0=>{let[,{id:o0}]=i0;return o0}));const r0=this.createUnsubscribeAllMessage(n0);return this.withdrawRemoteTracks(n0),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n0.forEach(i0=>{let[o0,{kind:s0}]=i0;var a0,c0;if(s0===dO.VIDEO&&o0._videoSSRC&&((a0=this.connection)===null||a0===void 0||a0.setStatsRemoteVideoIsReady(o0._videoSSRC,!1)),s0===dO.VIDEO)this.unbindRemoteTrackEvents(o0._videoTrack),(c0=o0._videoTrack)===null||c0===void 0||c0._destroy(),o0._videoTrack=void 0;else if(s0===dO.AUDIO){var u0;this.unbindRemoteTrackEvents(o0._audioTrack),(u0=o0._audioTrack)===null||u0===void 0||u0._destroy(),o0._audioTrack=void 0}}),r0}isPreSubScribe(t0){return!this.connection||this.state!==pO.Connected?!1:!!this.connection.getPreMedia(t0)}async muteRemote(t0,e0){if(!this.connection)return;const n0=this.remoteUserMap.get(t0);if(!n0)return void fb.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t0.uid,"."));if(!n0.get(e0))return void fb.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t0.uid," media type ").concat(e0,"."));const r0=e0===dO.VIDEO?t0._videoSSRC:t0._audioSSRC;r0!==void 0&&this.connection.setStatsRemoteVideoIsReady(r0,!1)}async unmuteRemote(t0,e0){return this.unmuteRemoteNoLock(t0,e0)}async unmuteRemoteNoLock(t0,e0){if(!this.connection)return;const n0=this.remoteUserMap.get(t0);if(!n0)return void fb.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t0.uid,"."));n0.get(e0)||fb.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t0.uid," media type ").concat(e0,"."))}getAllTracks(t0){const e0=this.localTrackMap.get(hO.LocalAudioTrack);if((e0==null?void 0:e0.track)instanceof RM){const n0=e0.track;return Array.from(this.localTrackMap.entries()).filter(r0=>{let[i0]=r0;return i0!==hO.LocalAudioTrack}).filter(r0=>{let[i0]=r0;return!(t0&&i0===hO.LocalVideoLowTrack)}).map(r0=>{let[,{track:i0}]=r0;return i0}).concat(n0.trackList)}return Array.from(this.localTrackMap.entries()).filter(n0=>{let[r0]=n0;return!(t0&&r0===hO.LocalVideoLowTrack)}).map(n0=>{let[,{track:r0}]=n0;return r0})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t0,e0,n0,r0,i0){if(t0){const s0=this.localTrackMap.get(hO.LocalAudioTrack),a0=r0?this.localTrackMap.get(hO.LocalVideoLowTrack):this.localTrackMap.get(hO.LocalVideoTrack);vb.publish(this.store.sessionId,{eventElapse:rV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t0,ec:e0,audioName:s0==null?void 0:s0.track.getTrackLabel(),videoName:a0==null?void 0:a0.track.getTrackLabel(),screenshare:(a0==null?void 0:a0.track._hints.indexOf(mL.SCREEN_TRACK))!==-1,audio:!!s0,video:!!a0,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i0})}else{var o0;n0||(n0=[]);const s0=n0.find(c0=>c0 instanceof TM),a0=r0?(o0=this.localTrackMap.get(hO.LocalVideoTrack))===null||o0===void 0?void 0:o0.track:n0.find(c0=>c0 instanceof aU);vb.publish(this.store.sessionId,{eventElapse:rV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t0,ec:e0,audioName:s0==null?void 0:s0.getTrackLabel(),videoName:a0==null?void 0:a0.getTrackLabel(),screenshare:(a0==null?void 0:a0._hints.indexOf(mL.SCREEN_TRACK))!==-1,audio:!!s0,video:!!a0,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i0})}}reportSubscribeEvent(t0,e0,n0,r0){const i0=r0===dO.VIDEO?n0._videoSSRC:n0._audioSSRC;i0&&vb.subscribe(this.store.sessionId,{succ:t0,ec:e0,video:r0===dO.VIDEO,audio:r0===dO.AUDIO,peerid:n0.uid,subscribeRequestid:i0,p2pid:this.store.p2pId,eventElapse:rV.measureFromSubscribeStart(this.store.clientId,i0),preSsrc:this.isPreSubScribe(i0)})}reset(){fb.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new NA("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new FF({},this.store):new dB({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t0=this.localTrackMap.get(hO.LocalAudioTrack);if((t0==null?void 0:t0.track)instanceof RM){if(t0.track.trackList.length>0){const e0=t0.track;t0.track.trackList.forEach(n0=>{e0.removeAudioTrack(n0)})}t0.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=pO.Disconnected}getStats(){var t0;return(t0=this.connection)===null||t0===void 0?void 0:t0.getStats()}getRemoteVideoIsReady(t0){var e0;return((e0=this.connection)===null||e0===void 0?void 0:e0.getRemoteVideoIsReady(t0))||!1}getLocalAudioVolume(){const t0=this.localTrackMap.get(hO.LocalAudioTrack);if(t0)return t0.track.getVolumeLevel()}getLocalVideoSize(){const t0=this.localTrackMap.get(hO.LocalVideoTrack);if(t0)return{width:t0.track.videoWidth||0,height:t0.track.videoHeight||0}}getEncoderConfig(t0){const e0=this.localTrackMap.get(t0);return e0&&e0.track instanceof aU||e0&&e0.track instanceof TM?e0.track._encoderConfig:void 0}getLocalMedia(t0){return this.localTrackMap.get(t0)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t0,e0){if(!t0)return this.remoteUserMap.size>0;const n0=this.remoteUserMap.get(t0);return!!n0&&(!e0||n0.has(e0))}async hasRemoteMediaWithLock(t0,e0){if(!t0)return this.remoteUserMap.size>0;const n0=this.remoteUserMap.get(t0);return!!n0&&(!e0||n0.has(e0))}getRemoteMedia(t0){var e0;const n0=Array.from(d_(e0=this.remoteUserMap).call(e0)).find(r0=>r0.uid===t0);return n0?{audioTrack:n0.audioTrack,audioSSRC:n0._audioSSRC,videoTrack:n0.videoTrack,videoSSRC:n0._videoSSRC}:{}}getAudioLevels(){let t0=Array.from(this.remoteUserMap.entries()).map(n0=>{let[r0]=n0;return{uid:r0.uid,level:r0.audioTrack?100*r0.audioTrack._source.getAccurateVolumeLevel():0}});const e0=this.localTrackMap.get(hO.LocalAudioTrack);return e0&&t0.push({level:100*e0.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t0=aE(t0).call(t0,(n0,r0)=>n0.level-r0.level),t0}async disconnectForReconnect(){this.connection&&(fb.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=pO.Reconnecting,XA("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t0=>{let[e0]=t0;var n0;e0._videoTrack&&e0._videoTrack._player&&((n0=e0._videoTrack._player.getVideoElement())===null||n0===void 0||n0.pause(),e0._videoTrack._player.isKeepLastFrame=!0,e0._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new FF({},this.store):new dB({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t0=>{var e0;let[n0,{track:r0}]=t0;switch(n0){case hO.LocalVideoTrack:Dn(e0=r0._hints).call(e0,mL.LOW_STREAM)?r0.close():this.pendingLocalTracks.push(r0);break;case hO.LocalAudioTrack:r0 instanceof RM?this.pendingLocalTracks=this.pendingLocalTracks.concat(r0.trackList):this.pendingLocalTracks.push(r0);case hO.LocalVideoLowTrack:}}),this.emit(_O.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t0=>{let[e0,n0]=t0;Array.from(d_(n0).call(n0)).forEach(r0=>{this.setPendingRemoteMedia(e0,r0)}),this.emit(_O.MediaReconnectStart,e0.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t0=>{this.pendingLocalDataChannels.push(t0)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t0=>{let[e0,n0]=t0;Array.from(d_(n0).call(n0)).forEach(r0=>{this.setPendingRemoteDataChannel(e0,r0)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),fb.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t0,e0){for(const n0 of this.pendingRemoteDataChannels){const{user:r0,id:i0}=n0;if((t0 instanceof cF?t0.uid:t0)===r0.uid&&i0===e0)return!0}return!1}setPendingRemoteDataChannel(t0,e0){this.hasPendingRemoteDataChannel(t0,e0)||this.pendingRemoteDataChannels.push({user:t0,id:e0})}hasPendingRemoteMedia(t0,e0){for(const n0 of this.pendingRemoteTracks){const{user:r0,kind:i0}=n0;if((t0 instanceof cF?t0.uid:t0)===r0.uid&&e0===i0)return!0}return!1}setPendingRemoteMedia(t0,e0){this.hasPendingRemoteMedia(t0,e0)||this.pendingRemoteTracks.push({user:t0,kind:e0})}restartICE(t0){var e0=this;return YI(function*(){if(!e0.connection||e0.state!==pO.Connected)return;const n0=yield qI(e0.mutex.lock("From P2PChannel.restartICE"));let r0;try{r0=yield qI(e0.connection.restartICE(t0));const o0=yield qI(r0.next());if(o0.done)return;const s0=o0.value,a0=yield s0;switch(e0.reportPCDisconnectedOrFailed(t0),t0){case lO.TCP:e0._pcStatsUploadType=uO.TCP_RESTART;break;case lO.RELAY:e0._pcStatsUploadType=uO.RELAY_RESTART;break;default:e0._pcStatsUploadType=uO.OLD_RESTART}e0._isInRestartIce=!0,r0.next(a0)}catch(o0){var i0;(i0=r0)===null||i0===void 0||i0.throw(o0)}finally{n0()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t0=this.connection.getStats(),e0=this.localTrackMap.get(hO.LocalVideoTrack),n0=this.localTrackMap.get(hO.LocalAudioTrack),r0=t0.videoSend.find(p0=>p0.ssrc===(e0==null?void 0:e0.ssrcs[0].ssrcId)),i0=t0.audioSend.find(p0=>p0.ssrc===(n0==null?void 0:n0.ssrcs[0].ssrcId));if(!r0||!i0)return 1;const o0=eA(this,_O.NeedSignalRTT),s0=r0?r0.rttMs:void 0,a0=i0?i0.rttMs:void 0,c0=s0&&a0?(s0+a0)/2:s0||a0,u0=(c0&&o0?(c0+o0)/2:c0||o0)||0,l0=100*t0.sendPacketLossRate*.7/50+.3*u0/1500,d0=l0<.17?1:l0<.36?2:l0<.59?3:l0<.1?4:5,h0=e0==null?void 0:e0.track;if(h0&&h0._encoderConfig&&h0._hints.indexOf(mL.SCREEN_TRACK)===-1){const p0=h0._encoderConfig.bitrateMax,m0=t0.bitrate.actualEncoded;if(p0&&m0){const f0=(1e3*p0-m0)/(1e3*p0);return bb[f0<.15?0:f0<.3?1:f0<.45?2:f0<.6?3:4][d0]}}return d0}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t0=this.connection.getStats();let e0=0;return Array.from(this.remoteUserMap.entries()).forEach(n0=>{let[r0]=n0;const i0=r0._audioSSRC,o0=r0._videoSSRC,s0=t0.audioRecv.find(m0=>m0.ssrc===i0),a0=t0.videoRecv.find(m0=>m0.ssrc===o0);if(!s0&&!a0)return void(e0+=1);const c0=eA(this,_O.NeedSignalRTT),u0=t0.rtt,l0=(u0&&c0?(u0+c0)/2:u0||c0)||0,d0=s0?s0.jitterMs:void 0,h0=t0.recvPacketLossRate;let p0=.7*h0*100/50+.3*l0/1500;d0&&(p0=.6*h0*100/50+.2*l0/1500+.2*d0/400),e0+=p0<.1?1:p0<.17?2:p0<.36?3:p0<.59?4:5}),this.remoteUserMap.size>0?Math.round(e0/this.remoteUserMap.size):e0}async muteLocalTrack(t0){return new Gh((e0,n0)=>{this.handleMuteLocalTrack(t0,e0,n0)})}async replaceTrack(t0,e0){var n0;if(fb.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t0.getTrackId(),"] to [").concat(e0.getTrackId(),"]")),!this.connection||this.state!==pO.Connected)return;const r0=Array.from(this.localTrackMap.entries()).find(o0=>{let[,{track:s0}]=o0;return t0===s0});if(!r0)return;const i0=r0[0];if(t0!==e0&&(this.unbindLocalTrackEvents([{track:t0,type:i0}]),this.bindLocalTrackEvents([{track:e0,type:i0}]),r0[1].track=e0),await((n0=this.connection)===null||n0===void 0?void 0:n0.replaceTrack(e0,r0[1].id)),this.isPlanB){const o0=r0[1];o0.id=e0._mediaStreamTrack.id,this.localTrackMap.set(i0,o0)}if(i0===hO.LocalVideoTrack&&!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding){const o0=this.localTrackMap.get(hO.LocalVideoLowTrack);if(o0){const s0=t0._mediaStreamTrack.clone();o0.track._originMediaStreamTrack.stop(),o0.track._mediaStreamTrack=s0,o0.track._originMediaStreamTrack=s0,await new Gh((a0,c0)=>{this.handleReplaceTrack(o0.track,a0,c0,!0)})}}}filterTobePublishedTracks(t0,e0,n0){const r0=[],i0=this.getAllTracks();t0=rA(t0=t0.filter(c0=>i0.indexOf(c0)===-1));let o0,s0=!1;const a0=this.localTrackMap.get(hO.LocalAudioTrack);for(const c0 of t0){if(c0 instanceof aU&&(this.localTrackMap.has(hO.LocalVideoTrack)||s0?new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r0.push({track:c0,type:hO.LocalVideoTrack}),s0=!0),e0)){const u0=this.getLowVideoTrack(c0,n0);r0.push({track:u0,type:hO.LocalVideoLowTrack})}if(c0 instanceof TM)if(a0){const u0=a0.track;if(u0 instanceof RM)uF([c0]),u0.addAudioTrack(c0),this.bindLocalAudioTrackEvents(c0,!0);else{const l0=hF([u0,c0]);fb.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l0.getTrackId(),"]")),this.replaceTrack(u0,l0)}}else o0 instanceof RM?(uF([c0]),o0.addAudioTrack(c0)):o0||!c0._useAudioElement&&ZP().webAudioMediaStreamDest&&!c0._bypassWebAudio?o0=hF(o0?[c0,o0]:[c0]):o0=c0}return o0&&(fb.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o0.getTrackId(),"]")),r0.push({track:o0,type:hO.LocalAudioTrack})),r0}filterTobeUnpublishedTracks(t0){const e0=[],n0=this.getAllTracks();t0=rA(t0=t0.filter(r0=>n0.indexOf(r0)!==-1));for(const r0 of t0){if(r0 instanceof TM){const i0=this.localTrackMap.get(hO.LocalAudioTrack);if(!i0)continue;i0.track instanceof RM?(i0.track.removeAudioTrack(r0),this.unbindLocalAudioTrackEvents(r0),i0.track.trackList.length===0&&(e0.push([hO.LocalAudioTrack,i0]),i0.track.close())):e0.push([hO.LocalAudioTrack,i0])}if(r0 instanceof aU){const i0=this.localTrackMap.get(hO.LocalVideoTrack);if(!i0)continue;e0.push([hO.LocalVideoTrack,i0]);const o0=this.localTrackMap.get(hO.LocalVideoLowTrack);o0&&e0.push([hO.LocalVideoLowTrack,o0])}}return e0}filterTobePublishedDataChannels(t0){return t0=(t0=rA(t0)).filter(e0=>this.localDataChannels.findIndex(n0=>n0.id===e0.id)===-1)}filterTobeUnpublishedDataChannels(t0){return t0=(t0=(t0=rA(t0)).filter(e0=>this.localDataChannels.indexOf(e0)!==-1)).filter(e0=>e0._originDataChannel)}bindLocalTrackEvents(t0){t0.forEach(e0=>{let{track:n0,type:r0}=e0;switch(r0){case hO.LocalVideoTrack:n0.addListener(fL.GET_STATS,this.handleGetLocalVideoStats),n0.addListener(fL.GET_RTC_STATS,this.handleGetRTCStats),n0.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n0.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n0.addListener(fL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n0.addListener(fL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n0.addListener(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),n0.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n0.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO.LocalAudioTrack:this.bindLocalAudioTrackEvents(n0);case hO.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t0,e0){t0 instanceof RM?t0.trackList.forEach(n0=>{n0.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n0.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n0.addListener(fL.GET_STATS,this.handleGetLocalAudioStats),n0.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n0.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t0.addListener(fL.GET_STATS,this.handleGetLocalAudioStats),t0.addListener(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t0.addListener(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t0.addListener(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t0.addListener(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e0||(t0.addListener(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),t0.addListener(fL.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t0){t0||(t0=Array.from(this.localTrackMap.entries()).map(e0=>{let[n0,{track:r0}]=e0;return{track:r0,type:n0}})),t0.forEach(e0=>{let{track:n0,type:r0}=e0;switch(r0){case hO.LocalVideoTrack:n0.off(fL.GET_STATS,this.handleGetLocalVideoStats),n0.off(fL.GET_RTC_STATS,this.handleGetRTCStats),n0.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n0.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n0.off(fL.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n0.off(fL.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n0.off(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),n0.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n0.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case hO.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n0);case hO.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t0){t0 instanceof RM?t0.trackList.forEach(e0=>{e0.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e0.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e0.off(fL.GET_STATS,this.handleGetLocalAudioStats),e0.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e0.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t0.off(fL.GET_STATS,this.handleGetLocalAudioStats),t0.off(fL.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t0.off(fL.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t0.off(fL.NEED_REPLACE_TRACK,this.handleReplaceTrack),t0.off(fL.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t0.off(fL.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t0.off(fL.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t0,e0){e0 instanceof IU&&e0.addListener(fL.GET_STATS,n0=>{n0(this.handleGetRemoteVideoStats(t0))}),e0 instanceof vU&&e0.addListener(fL.GET_STATS,n0=>{n0(this.handleGetRemoteAudioStats(t0))})}unbindRemoteTrackEvents(t0){t0&&t0.removeAllListeners(fL.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t0=>{let[e0,n0]=t0;n0.has(dO.AUDIO)&&this.unbindRemoteTrackEvents(e0._audioTrack),n0.has(dO.VIDEO)&&this.unbindRemoteTrackEvents(e0._videoTrack)})}createGatewayPublishMessage(t0,e0){return t0.map((n0,r0)=>{var i0;let o0,s0,{track:a0,type:c0}=n0;switch(c0){case hO.LocalAudioTrack:o0=Zw.Audio,s0={dtx:a0 instanceof SM&&a0._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case hO.LocalVideoTrack:o0=Dn(i0=a0._hints).call(i0,mL.SCREEN_TRACK)?Zw.Screen:Zw.High,s0=pB(pB({},ZO(a0)),{},{codec:this.store.codec,svc_mode:BU()});break;case hO.LocalVideoLowTrack:o0=Zw.Low,s0=pB(pB({},ZO(a0)),{},{codec:this.store.codec,svc_mode:BU()})}return{stream_type:o0,attributes:s0,ssrcs:e0[r0]}})}createGatewayUnpublishMessage(t0){return t0.map(e0=>{var n0;let r0,[i0,{track:o0,ssrcs:s0,id:a0}]=e0;switch(i0){case hO.LocalVideoTrack:r0=Dn(n0=o0._hints).call(n0,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalAudioTrack:r0=Zw.Audio;break;case hO.LocalVideoLowTrack:r0=Zw.Low}return{stream_type:r0,ssrcs:s0,mid:a0}})}assignLocalTracks(t0,e0){t0.forEach((n0,r0)=>{let{track:i0,type:o0}=n0;this.localTrackMap.set(o0,{track:i0,id:e0[r0].id,ssrcs:e0[r0].localSSRC})})}withdrawLocalTracks(t0){t0.forEach(e0=>{let[n0]=e0;this.localTrackMap.delete(n0)})}bindConnectionEvents(t0){t0.onConnectionStateChange=async e0=>{if(fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e0,")")),this.emit(_O.PeerConnectionStateChange,e0),e0!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e0==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),XA("NEW_ICE_RESTART")){var n0;if(Dn(n0=this._restartStates).call(n0,e0)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r0=s0=>{(t0.iceConnectionState==="disconnected"||t0.iceConnectionState==="checking"||t0.iceConnectionState==="failed")&&(fb.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(s0)),eA(this,_O.QueryClientConnectionState)==="CONNECTED"&&this.emit(_O.RequestRestartICE,s0))},i0=()=>{t0.iceConnectionState!=="disconnected"&&t0.iceConnectionState!=="checking"&&t0.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),fb.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(_O.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},o0=XA("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(XA("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ZP().supportPCSetConfiguration)r0(lO.RELAY),this._restartTimer=window.setTimeout(i0,o0);else if(Zv())r0(lO.UDP),this._restartTimer=window.setTimeout(i0,4e3);else{if(r0(lO.TCP),ZP().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{r0(lO.RELAY),this._restartTimer=window.setTimeout(i0,o0)},o0));this._restartTimer=window.setTimeout(i0,o0)}},800))}}else{if(e0==="disconnected"&&t0.iceConnectionState==="disconnected")return setTimeout(()=>{t0.iceConnectionState==="disconnected"&&XA("ICE_RESTART")&&eA(this,_O.QueryClientConnectionState)==="CONNECTED"&&this.emit(_O.RequestRestartICE)},800),void setTimeout(()=>{t0.peerConnectionState==="disconnected"&&(fb.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(_O.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e0==="failed"&&(fb.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(_O.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t0.onICEConnectionStateChange=e0=>{e0!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e0,")")),vb.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e0,tag:jy.TRACER}).onSuccess(),this.emit(_O.IceConnectionStateChange,e0)},t0.onICETransportStateChange=e0=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e0,")"))},t0.onDTLSTransportStateChange=e0=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e0,")"))},t0.onDTLSTransportError=e0=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e0,")"))},t0.onFirstAudioDecoded=e0=>{var n0;const r0=Array.from(d_(n0=this.remoteUserMap).call(n0)).find(o0=>o0._audioSSRC===e0);var i0;r0&&(this.store.subscribe(r0.uid,"audio",void 0,void 0,void 0,Date.now()),(i0=r0.audioTrack)===null||i0===void 0||i0.emit(IL.FIRST_FRAME_DECODED),vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_AUDIO_DECODE,Rb.FIRST_AUDIO_DECODE,{peer:r0._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e0),subscribeRequestid:e0,p2pid:this.store.p2pId}))},t0.onFirstAudioReceived=e0=>{var n0;const r0=Array.from(d_(n0=this.remoteUserMap).call(n0)).find(i0=>i0._audioSSRC===e0);r0&&vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_AUDIO_RECEIVED,Rb.FIRST_AUDIO_RECEIVED,{peer:r0._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e0),subscribeRequestid:e0,p2pid:this.store.p2pId})},t0.onFirstVideoDecoded=(e0,n0,r0)=>{this.reportVideoFirstFrameDecoded(e0,n0,r0)},t0.onFirstVideoReceived=e0=>{var n0;const r0=Array.from(d_(n0=this.remoteUserMap).call(n0)).find(i0=>i0._videoSSRC===e0);r0&&vb.firstRemoteFrame(this.store.sessionId,gb.FIRST_VIDEO_RECEIVED,Rb.FIRST_VIDEO_RECEIVED,{peer:r0._uintid,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,e0),subscribeRequestid:e0,p2pid:this.store.p2pId})},t0.onSelectedLocalCandidateChanged=(e0,n0)=>{const r0=e0.candidateType==="relay",i0=n0.candidateType==="relay";n0.candidateType!=="unknown"&&r0===i0||this.emit(_O.ConnectionTypeChange,r0),fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(nN(n0))," -> ").concat(JSON.stringify(nN(e0)),")"))},t0.onSelectedRemoteCandidateChanged=(e0,n0)=>{fb.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(nN(n0))," -> ").concat(JSON.stringify(nN(e0)),")"))},t0.onFirstVideoDecodedTimeout=e0=>{this.reportVideoFirstFrameDecoded(e0,void 0,void 0,!0)},t0.getLocalVideoStats=()=>{const e0=this.statsCollector.getLocalVideoTrackStats(),n0=this.statsCollector.getRTCStats();return pB(pB({},e0),n0)}}unbindConnectionEvents(t0){t0.onConnectionStateChange=void 0,t0.onICEConnectionStateChange=void 0,t0.onICETransportStateChange=void 0,t0.onDTLSTransportStateChange=void 0,t0.onDTLSTransportError=void 0,t0.onFirstAudioDecoded=void 0,t0.onFirstAudioReceived=void 0,t0.onFirstVideoDecoded=void 0,t0.onFirstVideoReceived=void 0,t0.onSelectedLocalCandidateChanged=void 0,t0.onSelectedRemoteCandidateChanged=void 0,t0.onFirstVideoDecodedTimeout=void 0,t0.getLocalVideoStats=void 0}filterTobeMutedTracks(t0){const e0=[];if(this.getAllTracks().indexOf(t0)===-1)return e0;const n0=this.localTrackMap.get(hO.LocalAudioTrack);if(t0 instanceof TM&&(n0==null?void 0:n0.track)instanceof RM)return n0.track.isActive||e0.push([hO.LocalAudioTrack,n0]),e0;const r0=Array.from(this.localTrackMap.entries()).find(i0=>{let[,{track:o0}]=i0;return t0===o0});if(r0&&(e0.push(r0),r0[0]===hO.LocalVideoTrack)){const i0=this.localTrackMap.get(hO.LocalVideoLowTrack);i0&&e0.push([hO.LocalVideoLowTrack,i0])}return e0}filterTobeUnmutedTracks(t0){const e0=[],n0=this.localTrackMap.get(hO.LocalAudioTrack);if(t0 instanceof TM&&(n0==null?void 0:n0.track)instanceof RM)return n0.track.isActive&&e0.push([hO.LocalAudioTrack,n0]),e0;const r0=Array.from(this.localTrackMap.entries()).find(i0=>{let[,{track:o0}]=i0;return t0===o0});if(r0)if(r0[0]===hO.LocalVideoTrack){e0.push(r0);const i0=this.localTrackMap.get(hO.LocalVideoLowTrack);i0&&e0.push([hO.LocalVideoLowTrack,i0])}else e0.push(r0);return e0}createMuteMessage(t0){return t0.map(e0=>{var n0;let r0,[i0,{track:o0,ssrcs:s0,id:a0}]=e0;switch(i0){case hO.LocalAudioTrack:r0=Zw.Audio;break;case hO.LocalVideoTrack:r0=Dn(n0=o0._hints).call(n0,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:r0=Zw.Low}return{stream_type:r0,ssrcs:s0,mid:a0}})}createUnmuteMessage(t0){return t0.map(e0=>{var n0;let r0,[i0,{track:o0,ssrcs:s0,id:a0}]=e0;switch(i0){case hO.LocalAudioTrack:r0=Zw.Audio;break;case hO.LocalVideoTrack:r0=Dn(n0=o0._hints).call(n0,mL.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case hO.LocalVideoLowTrack:r0=Zw.Low}return{stream_type:r0,ssrcs:s0,mid:a0}})}filterTobeUnSubscribedTracks(t0,e0){const n0=[],r0=this.remoteUserMap.get(t0);if(!r0)return n0;if(e0){const i0=r0.get(e0);if(!i0)return n0;n0.push([t0,{kind:e0,id:i0}])}else Array.from(r0.entries()).forEach(i0=>{let[o0,s0]=i0;n0.push([t0,{kind:o0,id:s0}])});return n0}filterTobeUnSubscribedDataChannels(t0,e0){const n0=[];return e0.forEach(r0=>{var i0;(i0=this.remoteDataChannelMap.get(t0))!==null&&i0!==void 0&&i0.has(r0.id)&&n0.push(r0)}),n0}createUnsubscribeMessage(t0){const e0=[];return t0.forEach(n0=>{let[r0,{kind:i0,id:o0}]=n0;switch(i0){case dO.VIDEO:return void(r0._videoSSRC&&e0.push({stream_type:dO.VIDEO,ssrcId:r0._videoSSRC}));case dO.AUDIO:return void(r0._audioSSRC&&e0.push({stream_type:dO.AUDIO,ssrcId:r0._audioSSRC}))}}),e0}createUnsubscribeAllMessage(t0){const e0=new Map;return t0.forEach(n0=>{let[r0,{kind:i0}]=n0;if(e0.has(r0)){let o0=e0.get(r0);i0===dO.VIDEO?o0|=tO.Video:o0|=tO.Audio,e0.set(r0,o0)}else i0===dO.VIDEO?e0.set(r0,tO.Video):e0.set(r0,tO.Audio)}),{users:Array.from(e0.entries()).map(n0=>{let[r0,i0]=n0;return{stream_id:r0.uid,stream_type:i0}})}}withdrawRemoteTracks(t0){t0.forEach(e0=>{let[n0,{kind:r0}]=e0;const i0=this.remoteUserMap.get(n0);i0&&(i0.delete(r0),Array.from(i0.entries()).length===0&&this.remoteUserMap.delete(n0))})}async updateBitrateLimit(t0){const e0=this.localTrackMap.get(hO.LocalVideoTrack),n0=this.localTrackMap.get(hO.LocalVideoLowTrack);e0&&await e0.track.setBitrateLimit(t0.uplink),n0&&t0.low_stream_uplink&&await n0.track.setBitrateLimit({max_bitrate:t0.low_stream_uplink.bitrate,min_bitrate:t0.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t0,e0,n0){return t0.map((r0,i0)=>{var o0;let{stream_type:s0}=r0;const a0=(o0=e0.find(c0=>{let{stream_type:u0}=c0;return s0===u0}))===null||o0===void 0?void 0:o0.attributes;if(a0&&XA("DISABLE_SCREEN_SHARE_REMB")){const c0=n0[i0]._hints;(Dn(c0).call(c0,mL.SCREEN_TRACK)||Dn(c0).call(c0,mL.SCREEN_LOW_TRACK))&&(a0.remb=!1,fb.debug("disable remb for screen share, hints:",c0))}return a0})}async tryToUnmuteAudio(t0){for(let n0=0;n0<t0.length;n0++)if(t0[n0]instanceof TM){var e0;const r0=this.filterTobeUnmutedTracks(t0[n0]);if(r0.length===0)continue;await((e0=this.connection)===null||e0===void 0?void 0:e0.unmuteLocal(r0.map(o0=>{let[,{id:s0}]=o0;return s0})));const i0=this.createUnmuteMessage(r0);return void await $y(this,_O.RequestUnmuteLocal,i0)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t0=>{var e0;return!((e0=this.connection)===null||e0===void 0||!e0.getRemoteVideoIsReady(t0))},this.statsUploader.requestUpload=(t0,e0)=>this.emit(_O.RequestUpload,t0,e0),this.statsUploader.requestUploadStats=t0=>this.emit(_O.RequestUploadStats,t0),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await mA(LA(this.dtlsFailedCount,PA)),this.emit(_O.RequestReconnect)}async reconnectP2P(){const t0=Array.from(this.localTrackMap.entries()),e0=this.createGatewayUnpublishMessage(t0);Array.from(this.remoteUserMap.entries()),e0.length>0&&await Zy(this,_O.RequestUnpublishForReconnectPC,e0),this.disconnectForReconnect(),this.emit(_O.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(hO.LocalVideoTrack)||this.pendingLocalTracks.some(t0=>t0 instanceof aU)}throwIfTrackTypeNotMatch(t0){if(t0.filter(e0=>e0 instanceof aU).length>1)throw new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t0.filter(e0=>e0 instanceof TM).length>1&&(t0.some(e0=>e0 instanceof TM&&e0._bypassWebAudio)||!ZP().webAudioMediaStreamDest))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e0 of t0){if(e0 instanceof aU&&this.pendingLocalTracks.some(n0=>n0 instanceof aU))throw new Cy(Ry.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e0 instanceof TM&&this.pendingLocalTracks.some(n0=>n0 instanceof TM)&&(!ZP().webAudioMediaStreamDest||e0._bypassWebAudio||this.pendingLocalTracks.some(n0=>n0 instanceof TM&&n0._bypassWebAudio)))throw new Cy(Ry.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t0,e0){var n0;const r0=!XA("DISABLE_DUAL_STREAM_USE_ENCODING")&&ZP().supportDualStreamEncoding,i0=pB(pB({},{width:160,height:120,framerate:15,bitrate:50}),e0);let o0;o0=r0?t0._mediaStreamTrack.clone():KV(t0,i0);const s0=TA(8,"track-low-"),a0=new aU(o0,pB(pB({},r0&&{scaleResolutionDownBy:iN(i0,t0)}),{},{frameRate:i0.framerate,bitrateMax:i0.bitrate,bitrateMin:i0.bitrate}),void 0,void 0,s0);return a0.on(RL.TRANSCEIVER_UPDATED,c0=>{t0._updateRtpTransceiver(c0,TL.LOW_STREAM)}),a0._hints.push(mL.LOW_STREAM),Dn(n0=t0._hints).call(n0,mL.SCREEN_TRACK)&&a0._hints.push(mL.SCREEN_LOW_TRACK),t0.on("sei-to-send",c0=>{a0.emit("sei-to-send",c0)}),t0.addListener(fL.NEED_CLOSE,()=>{a0.close()}),a0}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t0,e0,n0){let r0=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof dB){var i0,o0,s0,a0;const c0=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u0,dtlsTransportState:l0,peerConnectionState:d0}=this.connection,{local:h0,remote:p0}=await this.connection.getSelectedCandidatePair();vb.pcStats(this.store.sessionId,{startTime:c0,eventElapse:t0-c0||0,iceconnectionsate:u0,dtlsstate:l0,connectionstate:d0,intSucc:e0?1:2,error:r0,selectedLocalCandidateProtocol:(i0=h0==null?void 0:h0.protocol)!==null&&i0!==void 0?i0:"",selectedLocalCandidateType:(o0=h0.candidateType)!==null&&o0!==void 0?o0:"",selectedLocalCandidateAddress:"".concat(h0.address,":").concat(h0.port),selectedRemoteCandidateProtocol:(s0=p0.protocol)!==null&&s0!==void 0?s0:"",selectedRemoteCandidateType:(a0=p0.candidateType)!==null&&a0!==void 0?a0:"",selectedRemoteCandidateAddress:"".concat(p0.address,":").concat(p0.port),restartCnt:n0,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(t0,e0,n0,r0){var i0;const o0=Array.from(d_(i0=this.remoteUserMap).call(i0)).find(s0=>s0._videoSSRC===t0);if(o0){r0||this.store.subscribe(o0.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s0=this.store.keyMetrics,a0=s0.subscribe.find(c0=>c0.userId===o0.uid&&c0.type==="video");vb.firstRemoteVideoDecode(this.store.sessionId,gb.FIRST_VIDEO_DECODE,Rb.FIRST_VIDEO_DECODE,{peer:o0._uintid,videowidth:e0,videoheight:n0,subscribeElapse:rV.measureFromSubscribeStart(this.store.clientId,t0),subscribeRequestid:t0,p2pid:this.store.p2pId,apEnd:s0.requestAPEnd||0,apStart:s0.requestAPStart||0,joinGwEnd:s0.joinGatewayEnd||0,joinGwStart:s0.joinGatewayStart||0,pcEnd:s0.peerConnectionEnd||0,pcStart:s0.peerConnectionStart||0,subscriberEnd:(a0==null?void 0:a0.subscribeEnd)||0,subscriberStart:(a0==null?void 0:a0.subscribeStart)||0,videoAddNotify:(a0==null?void 0:a0.streamAdded)||0,state:r0?1:0,firstFrame:(a0==null?void 0:a0.firstFrame)||0})}}async remoteMediaSsrcChanged(t0,e0,n0){if(!this.connection)return!1;const r0=this.remoteUserMap.get(t0);if(!r0)return!1;const i0=r0.get(e0);if(!i0)return!1;const o0=await this.connection.getRemoteSSRC(i0);return o0!==void 0&&o0!==n0}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t0=>{let[e0,{track:n0}]=t0;e0===hO.LocalVideoLowTrack?n0._updateRtpTransceiver(void 0,TL.LOW_STREAM):n0._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(t0){this.connection&&this.connection instanceof dB&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===uO.TCP_RESTART&&t0===lO.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,uO.DISCONNECTED_OR_FAILED)))}},Cw(uB.prototype,"startP2PConnection",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"startP2PConnection"),uB.prototype),Cw(uB.prototype,"connect",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"connect"),uB.prototype),Cw(uB.prototype,"updateRemoteRTPCapabilities",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"updateRemoteRTPCapabilities"),uB.prototype),Cw(uB.prototype,"publishDataChannel",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"publishDataChannel"),uB.prototype),Cw(uB.prototype,"unpublish",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unpublish"),uB.prototype),Cw(uB.prototype,"unpublishDataChannel",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unpublishDataChannel"),uB.prototype),Cw(uB.prototype,"unpublishLowStream",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unpublishLowStream"),uB.prototype),Cw(uB.prototype,"subscribeDataChannel",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"subscribeDataChannel"),uB.prototype),Cw(uB.prototype,"subscribe",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"subscribe"),uB.prototype),Cw(uB.prototype,"massSubscribe",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"massSubscribe"),uB.prototype),Cw(uB.prototype,"unsubscribe",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unsubscribe"),uB.prototype),Cw(uB.prototype,"unsubscribeDataChannel",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unsubscribeDataChannel"),uB.prototype),Cw(uB.prototype,"massUnsubscribe",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"massUnsubscribe"),uB.prototype),Cw(uB.prototype,"muteRemote",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"muteRemote"),uB.prototype),Cw(uB.prototype,"unmuteRemote",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"unmuteRemote"),uB.prototype),Cw(uB.prototype,"hasRemoteMediaWithLock",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"hasRemoteMediaWithLock"),uB.prototype),Cw(uB.prototype,"disconnectForReconnect",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"disconnectForReconnect"),uB.prototype),Cw(uB.prototype,"updateBitrateLimit",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"updateBitrateLimit"),uB.prototype),Cw(uB.prototype,"remoteMediaSsrcChanged",[mB],Object.getOwnPropertyDescriptor(uB.prototype,"remoteMediaSsrcChanged"),uB.prototype),uB);function mB(t0,e0,n0){const r0=t0[e0];if(typeof r0!="function")throw new Error("Cannot use mutex on object property.");return n0.value=async function(){const i0=this.mutex,o0=await i0.lock("From P2PChannel.".concat(e0));try{for(var s0=arguments.length,a0=new Array(s0),c0=0;c0<s0;c0++)a0[c0]=arguments[c0];return await r0.apply(this,a0)}finally{o0()}},n0}const TB={};function SB(t0){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&fb.debug("install service ".concat(t0.name)),TB[t0.name]=t0}function gB(t0){const e0=TB[t0];if(!e0)throw new Cy(Ry.INVALID_OPERATION,"".concat(t0," not found, please use AgoraRTC.use(").concat(t0,"Service) to load it first"));return e0}function RB(t0,e0){return gB("DataStream").create(t0,e0)}function CB(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function IB(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?CB(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):CB(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}const vB=Date.now(),yB=20,AB=new Map,bB=new Map;async function wB(t0){const e0=AB.get(t0),n0=Array.isArray(e0)&&e0[e0.length-1],r0=bB.get(t0);if(!n0)return void(r0.isSyncing=!1);const i0={uid:n0.uid,payload:n0.payload};r0.firstRecvTs===0&&(r0.firstRecvTs=n0.recvTs,r0.firstSendTs=n0.sendTs);const o0=n0.sendTs-r0.firstSendTs,s0=o0-(Date.now()-r0.firstRecvTs);s0>0&&(r0.firstRecvTs=Date.now()-o0);let a0=n0.mediaDelay+s0;a0<=0?(e0.pop(),OB(n0.context,i0),a0=0):a0=Math.min(a0,yB),setTimeout(()=>e0.length&&wB(t0),a0)}function OB(t0,e0){t0.safeEmit(zy.STREAM_MESSAGE,e0.uid,e0.payload),t0.onStreamMessage&&t0.onStreamMessage(e0)}function NB(t0){let e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n0=arguments.length>2?arguments[2]:void 0;if(!t0.syncWithAudio)return OB(n0,{uid:t0.uid,payload:t0.payload});const r0="".concat(n0.id,"-").concat(t0.uid),i0=AB.get(r0)||[],o0=i0.findIndex(u0=>t0.sendTs>=u0.sendTs),s0=IB(IB({},t0),{},{context:n0,mediaDelay:e0,recvTs:Date.now()});o0===-1?i0.push(s0):i0.splice(o0,0,s0),AB.set(r0,i0);let a0=!1;var c0;bB.has(r0)?a0=!((c0=bB.get(r0))===null||c0===void 0||!c0.isSyncing):bB.set(r0,{isSyncing:a0,firstRecvTs:0,firstSendTs:0}),a0||wB(r0)}const DB=Hv().name;function PB(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function LB(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?PB(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):PB(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}const kB="websdk_ng_cache_parameter",MB=XA("MAX_PRELOAD_ASYNC_LENGTH"),UB=1e4,xB=new Map,VB=[];let FB=null,BB=0,jB=0;const GB=new Map,WB=function(t0,e0){const n0=[];let r0=0;const i0=async()=>{const o0=n0.shift();o0&&await o0(),n0.length>0&&r0<e0?i0():r0--};return async function(){for(var o0=arguments.length,s0=new Array(o0),a0=0;a0<o0;a0++)s0[a0]=arguments[a0];return new Gh(async(c0,u0)=>{n0.push(async()=>{try{const l0=await t0(...s0);c0(l0)}catch(l0){u0(l0)}}),r0<e0&&(r0++,i0())})}}(KB,MB),HB=Lv.CancelToken.source();async function KB(t0,e0,n0,r0,i0,o0){try{if(!XA("ENABLE_PRELOAD"))return;if(!ZP().supportWebCrypto)return void dA(()=>{fb.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n0&&n0!==null)throw new Cy(Ry.INVALID_PARAMS,"Invalid token: ".concat(n0,". If you don not use token, set it to null"));n0&&by(n0,"token",1,2047),by(t0,"appid",1,2047),xw(e0),r0&&Vw(r0);const s0=SA();fb.debug("preload channel ".concat(e0,", uid is ").concat(r0));const a0={appId:t0,cname:e0,token:n0||t0,uid:typeof r0!="string"?r0:null,sid:s0,proxyServer:i0};let c0,u0;typeof r0=="string"?(a0.stringUid=r0,[u0,c0]=await Gh.all([qx(r0,{sid:s0,appId:t0},HB.token),Jx(LB(LB({},a0),{},{token:n0||t0,uid:0}),HB.token)]),a0.uid=u0.uid,c0.gatewayInfo.uid=a0.uid,c0.gatewayInfo.res.uid=a0.uid):(o0&&(a0.stringUid=o0),c0=await Jx(a0,HB.token));const l0={sid:s0,appId:t0,cname:e0,token:n0||t0,uid:a0.stringUid||r0,intUid:a0.uid||c0.gatewayInfo.uid,stringUid:a0.stringUid,ts:Date.now(),sua:u0,ap:c0};await async function(d0){let h0;try{d0.uid&&qB({appId:d0.appId,cname:d0.cname,token:d0.token,uid:d0.uid,stringUid:d0.stringUid});const p0=$B(d0),m0=await async function(g0,E0){try{const _0=await window.crypto.subtle.importKey("raw",hA(E0),"AES-GCM",!1,["encrypt"]),y0=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},_0,lA(window.btoa(JSON.stringify(g0))));return uA(new Uint8Array(y0))}catch{return}}(d0,d0.token||d0.appId);if(!m0)return;h0=QB(kB);const f0=h0?JSON.parse(h0):[];f0.push({[p0]:m0}),f0.length>XA("AP_CACHE_NUM")&&f0.shift(),ZB(kB,JSON.stringify(f0))}catch(p0){fb.warn("Error caching server parameters:",p0.message),ZB(kB,"")}}(l0),BB++}catch(s0){throw jB++,function(a0){FB||(FB=window.setTimeout(()=>{let u0="";GB.forEach((l0,d0)=>{u0+="".concat(d0,": ").concat(l0," ;")}),vb.reportApiInvoke(null,{name:By.PRELOAD,options:{success:BB,failed:jB,err:u0}}).onError(a0),BB=0,jB=0,GB.clear(),FB=null},UB));const c0=GB.get(a0.code)||0;GB.set(a0.code,c0+1)}(s0),s0}}async function YB(t0){try{if(XA("AP_REQUEST_DETAIL"))return;const e0=qB(t0);if(!e0||t0.cloudProxyServer!=="disabled")return;const n0=await async function(r0,i0){try{const o0=await window.crypto.subtle.importKey("raw",hA(i0),"AES-GCM",!1,["decrypt"]),s0=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o0,lA(r0));return JSON.parse(window.atob(uA(new Uint8Array(s0))))}catch{return}}(e0,t0.token||t0.appId);if(!n0||!function(r0,i0){return r0.cname===i0.cname&&r0.appId===i0.appId&&r0.token===i0.token?i0.stringUid?r0.stringUid===i0.stringUid:typeof i0.uid=="number"?r0.uid===i0.uid:r0.uid==i0.uid:!1}(n0,t0))return;if(n0&&Date.now()-n0.ts<XA("AP_CACHE_LIFETIME"))return n0}catch(e0){fb.warn("Error get preloadInfo",e0.message)}}function qB(t0){let e0;try{if(e0=QB(kB),!e0)return;const n0=JSON.parse(e0),r0=$B(t0),i0=function(s0,a0){for(let c0=s0.length-1;c0>=0;c0--)if(a0(s0[c0]))return c0;return-1}(n0,s0=>r0 in s0);if(i0===-1)return;const o0=n0.splice(i0,1)[0];return ZB(kB,JSON.stringify(n0)),o0[r0]}catch(n0){fb.warn("Error delete preload info: ".concat(e0),n0.message),ZB(kB,"")}}function zB(t0){if(t0){let e0=xB.get(t0);e0&&(window.clearTimeout(e0),e0=null,xB.delete(t0)),Dn(VB).call(VB,t0)||t0.cloudProxyServer!=="disabled"||VB.push(t0)}if(xB.size<XA("AP_CACHE_NUM")&&VB.length>0){const e0=VB.shift();xB.set(e0,window.setTimeout(async()=>{const{appId:n0,cname:r0,token:i0,stringUid:o0,uid:s0,proxyServer:a0}=e0;try{await WB(n0,r0,i0,s0,a0,o0),xB.has(e0)&&zB(e0)}catch(c0){fb.warn("update preload failed",c0.message),JB(e0)}},XA("AP_UPDATE_INTERVAL")))}}function JB(t0){const e0=VB.indexOf(t0);e0!==-1&&VB.splice(e0,1);let n0=xB.get(t0);n0&&(window.clearTimeout(n0),n0=null,xB.delete(t0),zB())}function XB(t0,e0){const n0=t0.sua,r0=t0.ap;e0&&n0&&vb.reqUserAccount(t0.sid,{lts:n0.requestTime,elapse:n0.elapse,success:!0,serverAddr:n0.url,stringUid:e0,uid:t0.intUid,errorCode:null,extend:n0.req}),vb.reportResourceTiming(t0.ap.url,t0.sid),vb.joinWebProxyAP(t0.sid,{lts:r0.requestTime,elapse:r0.elapse,sucess:1,apServerAddr:r0.url,turnServerAddrList:r0.proxyInfo.addresses.map(i0=>i0.ip).join(","),eventType:"disabled",unilbsServerIds:[YO.CHOOSE_SERVER,YO.CLOUD_PROXY_FALLBACK].toString()}),vb.joinChooseServer(t0.sid,{lts:r0.requestTime,elapse:r0.elapse,succ:!0,csAddr:r0.url,opid:r0.opid,serverList:r0.gatewayInfo.gatewayAddrs.map(i0=>i0.address),ec:null,cid:r0.gatewayInfo.cid.toString(),uid:r0.gatewayInfo.uid.toString(),csIp:r0.gatewayInfo.csIp,unilbsServerIds:[YO.CHOOSE_SERVER].toString(),isHttp3:r0.isHttp3})}function QB(t0){return window.atob(window.localStorage.getItem(t0)||"")}function ZB(t0,e0){window.localStorage.setItem(t0,window.btoa(e0))}function $B(t0){let e0="".concat(t0.appId,"_").concat(t0.cname);return typeof t0.uid=="string"&&(e0+="_s_".concat(t0.uid)),typeof t0.uid=="number"&&(e0+="_".concat(t0.uid)),t0.token&&(e0+="_".concat(t0.token)),bA(e0)}function ej(t0){let e0=function(){const n0=rj.pop();return n0?(n0.offset=n0.limit=0,n0):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n0,r0){let i0=n0.appId;i0!==void 0&&(Ej(r0,10),uj(r0,i0));let o0=n0.cid;o0!==void 0&&(Ej(r0,16),Ej(r0,o0));let s0=n0.cname;s0!==void 0&&(Ej(r0,26),uj(r0,s0));let a0=n0.deviceId;a0!==void 0&&(Ej(r0,34),uj(r0,a0));let c0=n0.elapse;c0!==void 0&&(Ej(r0,40),mj(r0,c0));let u0=n0.fileSize;u0!==void 0&&(Ej(r0,48),mj(r0,nj(u0)));let l0=n0.height;l0!==void 0&&(Ej(r0,56),mj(r0,nj(l0)));let d0=n0.jpg;d0!==void 0&&(Ej(r0,66),Ej(r0,d0.length),dj(r0,d0));let h0=n0.networkType;h0!==void 0&&(Ej(r0,72),mj(r0,nj(h0)));let p0=n0.osType;p0!==void 0&&(Ej(r0,80),mj(r0,nj(p0)));let m0=n0.requestId;m0!==void 0&&(Ej(r0,90),uj(r0,m0));let f0=n0.sdkVersion;f0!==void 0&&(Ej(r0,98),uj(r0,f0));let g0=n0.sequence;g0!==void 0&&(Ej(r0,104),mj(r0,nj(g0)));let E0=n0.sid;E0!==void 0&&(Ej(r0,114),uj(r0,E0));let _0=n0.timestamp;_0!==void 0&&(Ej(r0,120),mj(r0,_0));let y0=n0.uid;y0!==void 0&&(Ej(r0,128),Ej(r0,y0));let b0=n0.vid;b0!==void 0&&(Ej(r0,136),Ej(r0,b0));let S0=n0.width;S0!==void 0&&(Ej(r0,144),mj(r0,nj(S0)));let w0=n0.service;w0!==void 0&&(Ej(r0,152),Ej(r0,w0));let I0=n0.callbackData;I0!==void 0&&(Ej(r0,162),Ej(r0,I0.length),dj(r0,I0));let L0=n0.ticket;L0!==void 0&&(Ej(r0,170),uj(r0,L0));let M0=n0.vendorConfigs;M0!==void 0&&(Ej(r0,178),uj(r0,M0))}(t0,e0),function(n0){let r0=n0.bytes,i0=n0.limit;return r0.length===i0?r0:r0.subarray(0,i0)}(e0)}function tj(t0){return function(n0){let r0={};t:for(;!sj(n0);){let i0=_j(n0);switch(i0>>>3){case 0:break t;case 1:r0.code=_j(n0);break;case 2:r0.msg=lj(n0,_j(n0));break;case 3:r0.requestId=lj(n0,_j(n0));break;case 4:r0.timestamp=fj(n0,!1);break;default:ij(n0,7&i0)}}return r0}({bytes:e0=t0,offset:0,limit:e0.length});var e0}function ij(t0,e0){switch(e0){case 0:for(;128&hj(t0););break;case 2:oj(t0,_j(t0));break;case 5:oj(t0,4);break;case 1:oj(t0,8);break;default:throw new Error("Unimplemented type: "+e0)}}function nj(t0){return{low:t0|=0,high:t0>>31,unsigned:t0>=0}}let rj=[];function oj(t0,e0){if(t0.offset+e0>t0.limit)throw new Error("Skip past limit");t0.offset+=e0}function sj(t0){return t0.offset>=t0.limit}function aj(t0,e0){let n0=t0.bytes,r0=t0.offset,i0=t0.limit,o0=r0+e0;if(o0>n0.length){let s0=new Uint8Array(2*o0);s0.set(n0),t0.bytes=s0}return t0.offset=o0,o0>i0&&(t0.limit=o0),r0}function cj(t0,e0){let n0=t0.offset;if(n0+e0>t0.limit)throw new Error("Read past limit");return t0.offset+=e0,n0}function dj(t0,e0){let n0=aj(t0,e0.length);t0.bytes.set(e0,n0)}function lj(t0,e0){let n0=cj(t0,e0),r0=String.fromCharCode,i0=t0.bytes,o0="",s0="";for(let a0=0;a0<e0;a0++){let c0,u0,l0,d0,h0=i0[a0+n0];128&h0?(224&h0)==192?a0+1>=e0?s0+=o0:(c0=i0[a0+n0+1],(192&c0)!=128?s0+=o0:(d0=(31&h0)<<6|63&c0,d0<128?s0+=o0:(s0+=r0(d0),a0++))):(240&h0)==224?a0+2>=e0?s0+=o0:(c0=i0[a0+n0+1],u0=i0[a0+n0+2],(49344&(c0|u0<<8))!=32896?s0+=o0:(d0=(15&h0)<<12|(63&c0)<<6|63&u0,d0<2048||d0>=55296&&d0<=57343?s0+=o0:(s0+=r0(d0),a0+=2))):(248&h0)==240?a0+3>=e0?s0+=o0:(c0=i0[a0+n0+1],u0=i0[a0+n0+2],l0=i0[a0+n0+3],(12632256&(c0|u0<<8|l0<<16))!=8421504?s0+=o0:(d0=(7&h0)<<18|(63&c0)<<12|(63&u0)<<6|63&l0,d0<65536||d0>1114111?s0+=o0:(d0-=65536,s0+=r0(55296+(d0>>10),56320+(1023&d0)),a0+=3))):s0+=o0:s0+=r0(h0)}return s0}function uj(t0,e0){let n0=e0.length,r0=0;for(let s0=0;s0<n0;s0++){let a0=e0.charCodeAt(s0);a0>=55296&&a0<=56319&&s0+1<n0&&(a0=(a0<<10)+e0.charCodeAt(++s0)-56613888),r0+=a0<128?1:a0<2048?2:a0<65536?3:4}Ej(t0,r0);let i0=aj(t0,r0),o0=t0.bytes;for(let s0=0;s0<n0;s0++){let a0=e0.charCodeAt(s0);a0>=55296&&a0<=56319&&s0+1<n0&&(a0=(a0<<10)+e0.charCodeAt(++s0)-56613888),a0<128?o0[i0++]=a0:(a0<2048?o0[i0++]=a0>>6&31|192:(a0<65536?o0[i0++]=a0>>12&15|224:(o0[i0++]=a0>>18&7|240,o0[i0++]=a0>>12&63|128),o0[i0++]=a0>>6&63|128),o0[i0++]=63&a0|128)}}function hj(t0){return t0.bytes[cj(t0,1)]}function pj(t0,e0){let n0=aj(t0,1);t0.bytes[n0]=e0}function _j(t0){let e0,n0=0,r0=0;do e0=hj(t0),n0<32&&(r0|=(127&e0)<<n0),n0+=7;while(128&e0);return r0}function Ej(t0,e0){for(e0>>>=0;e0>=128;)pj(t0,127&e0|128),e0>>>=7;pj(t0,e0)}function fj(t0,e0){let n0,r0=0,i0=0,o0=0;return n0=hj(t0),r0=127&n0,128&n0&&(n0=hj(t0),r0|=(127&n0)<<7,128&n0&&(n0=hj(t0),r0|=(127&n0)<<14,128&n0&&(n0=hj(t0),r0|=(127&n0)<<21,128&n0&&(n0=hj(t0),i0=127&n0,128&n0&&(n0=hj(t0),i0|=(127&n0)<<7,128&n0&&(n0=hj(t0),i0|=(127&n0)<<14,128&n0&&(n0=hj(t0),i0|=(127&n0)<<21,128&n0&&(n0=hj(t0),o0=127&n0,128&n0&&(n0=hj(t0),o0|=(127&n0)<<7))))))))),{low:r0|i0<<28,high:i0>>>4|o0<<24,unsigned:e0}}function mj(t0,e0){let n0=e0.low>>>0,r0=(e0.low>>>28|e0.high<<4)>>>0,i0=e0.high>>>24,o0=i0===0?r0===0?n0<16384?n0<128?1:2:n0<1<<21?3:4:r0<16384?r0<128?5:6:r0<1<<21?7:8:i0<128?9:10,s0=aj(t0,o0),a0=t0.bytes;switch(o0){case 10:a0[s0+9]=i0>>>7&1;case 9:a0[s0+8]=o0!==9?128|i0:127&i0;case 8:a0[s0+7]=o0!==8?r0>>>21|128:r0>>>21&127;case 7:a0[s0+6]=o0!==7?r0>>>14|128:r0>>>14&127;case 6:a0[s0+5]=o0!==6?r0>>>7|128:r0>>>7&127;case 5:a0[s0+4]=o0!==5?128|r0:127&r0;case 4:a0[s0+3]=o0!==4?n0>>>21|128:n0>>>21&127;case 3:a0[s0+2]=o0!==3?n0>>>14|128:n0>>>14&127;case 2:a0[s0+1]=o0!==2?n0>>>7|128:n0>>>7&127;case 1:a0[s0]=o0!==1?128|n0:127&n0}}const Tj={},Sj={},gj=4294967296,Rj=gj*gj,Cj=Rj/2,Ij=wj(0,!0),vj=wj(0),yj=Oj(0,-2147483648,!1),Aj=Oj(-1,2147483647,!1),bj=Oj(-1,-1,!0);function wj(t0,e0){let n0,r0,i0;return e0?(i0=0<=(t0>>>=0)&&t0<256)&&(r0=Sj[t0],r0)?r0:(n0=Oj(t0,0,!0),i0&&(Sj[t0]=n0),n0):(i0=-128<=(t0|=0)&&t0<128)&&(r0=Tj[t0],r0)?r0:(n0=Oj(t0,t0<0?-1:0,!1),i0&&(Tj[t0]=n0),n0)}function Oj(t0,e0,n0){return{low:0|t0,high:0|e0,unsigned:!!n0}}function Nj(t0,e0){if(isNaN(t0))return e0?Ij:vj;if(e0){if(t0<0)return Ij;if(t0>=Rj)return bj}else{if(t0<=-Cj)return yj;if(t0+1>=Cj)return Aj}return t0<0?e0?Ij:vj:Oj(t0%gj|0,t0/gj|0,e0)}function Dj(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}class Pj extends xy{get connectionState(){return this._connectionState}set connectionState(e0){if(this._connectionState===e0)return;const n0=this._connectionState;this._connectionState=e0,this.emit(RO.CONNECTION_STATE_CHANGE,e0,n0)}get quality(){return this._quality}set quality(e0){this._quality=e0>1?1:e0<.1?.1:e0,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e0){var n0;super(),Fg(this,"name","AgoraRTCImageModeration"),Fg(this,"_connectionState",gO.CONNECTING),Fg(this,"_sequence",0),Fg(this,"_moderationStartTime",void 0),Fg(this,"_workerConnection",void 0),Fg(this,"_workerMessageLengthLimit",void 0),Fg(this,"_qualityRatio",void 0),Fg(this,"_connectInfo",void 0),Fg(this,"_cancelTokenSource",Lv.CancelToken.source()),Fg(this,"_retryConfig",void 0),Fg(this,"_moderationInterval",void 0),Fg(this,"_moderationTimer",null),Fg(this,"_moderationMode",1),Fg(this,"_quality",1),Fg(this,"_qualityTimer",null),Fg(this,"_ticket",void 0),Fg(this,"_moderationIntervalMinimum",void 0),Fg(this,"_uploadFailedNum",0),Fg(this,"_uploadNum",0),Fg(this,"_uploadTimer",null),Fg(this,"_extraInfo",void 0),Fg(this,"_vendor",""),Fg(this,"_encoder",new TextEncoder),Fg(this,"_moderationId",void 0),Fg(this,"inspectImage",()=>{if(this.connectionState!==gO.CONNECTED)throw new yb(Ry.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===gO.CONNECTED?this.requestToInspectImage():fb.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=TA(5,"image-moderation-"),this._workerMessageLengthLimit=XA("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=XA("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n0=e0.interval)!==null&&n0!==void 0?n0:1e3,e0.extraInfo&&(this._extraInfo=this._encoder.encode(e0.extraInfo)),e0.vendor&&(this._vendor=e0.vendor),this._qualityRatio=XA("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new HO("worker-"+this._moderationId,PA),this.on(RO.STATE_CHANGE,(r0,i0)=>{fb.debug("[".concat(this._moderationId,"] Moderation operation :").concat(CO[r0]," ").concat(i0||""))}),this.handleWorkerEvents()}async init(e0,n0){this.emit(RO.STATE_CHANGE,CO.CONNECT_AP),this._connectInfo=e0;const r0=this._cancelTokenSource.token;return this._retryConfig=n0,new Gh((i0,o0)=>{this.on(RO.CONNECTION_STATE_CHANGE,(s0,a0)=>{s0===gO.CONNECTED&&i0()}),this.requestAP(e0,r0,n0).then(s0=>{this.connectWorker(s0)}).catch(s0=>{o0(s0)})})}updateConfig(e0){var n0;this._moderationInterval=(n0=e0.interval)!==null&&n0!==void 0?n0:1e3,e0.extraInfo&&(this._extraInfo=this._encoder.encode(e0.extraInfo)),e0.vendor&&(this._vendor=e0.vendor),fb.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e0))),this.connectionState===gO.CONNECTED&&this.inspectImage()}async requestAP(e0,n0,r0){const i0=XA("WEBCS_DOMAIN").map(c0=>"https://".concat(c0,"/api/v1")),o0=await function(c0,u0,l0,d0){let{appId:h0,areaCode:p0,cname:m0,sid:f0,token:g0,uid:E0}=u0;Bx++;const _0="moderation_plugin",y0={service_name:_0,json_body:JSON.stringify({appId:h0,areaCode:p0,cname:m0,command:"allocateEdge",requestId:Bx,seq:Bx,sid:f0,appToken:g0,ts:Date.now(),uid:E0+""})};let b0,S0,w0=c0[0];return kA(async()=>{b0=Date.now();const I0=await Tx(w0,{data:y0,cancelToken:l0,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(S0=Date.now()-b0,I0.code!==0){const C0=new yb(Ry.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+I0.code,{retry:!0,responseTime:S0});throw fb.error(C0.toString()),C0}const L0=JSON.parse(I0.json_body);if(L0.code!==200){const C0=new yb(Ry.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(L0.code,", reason: ").concat(L0.reason),{code:L0.code,responseTime:S0});throw fb.error(C0.toString()),C0}if(!L0.servers||!Array.isArray(L0.servers)||L0.servers.length===0){const C0=new yb(Ry.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:L0.code,responseTime:S0});throw fb.error(C0.toString()),C0}if(!L0.servers.some(C0=>!!C0.wss)){const C0=new yb(Ry.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:L0.code,responseTime:S0});throw fb.error(C0.toString()),C0}const M0=XA("IMAGE_MODERATION_WORKER_HOST");return{addressList:L0.servers.map(C0=>{let{address:U0,wss:x0}=C0;if(U0&&x0)return"wss://".concat(U0.replace(/\./g,"-"),".").concat(M0,":").concat(x0,"/moderation")}).filter(C0=>!!C0),workerToken:L0.workerToken,vid:L0.vid,ticket:L0.appTicket,responseTime:S0}},(I0,L0)=>(vb.apworkerEvent(f0,{success:!0,sc:200,serviceName:_0,responseDetail:JSON.stringify(I0.addressList),firstSuccess:L0===0,responseTime:S0,serverIp:c0[L0%c0.length]}),!1),(I0,L0)=>(vb.apworkerEvent(f0,{success:!1,sc:I0.data&&I0.data.code||200,serviceName:_0,responseTime:S0,serverIp:c0[L0%c0.length]}),!!(I0.code!==Ry.OPERATION_ABORTED&&I0.code!==Ry.UNEXPECTED_RESPONSE||I0.data&&I0.data.retry)&&(w0=c0[(L0+1)%c0.length],!0)),d0)}(i0,e0,n0,r0);this.emit(RO.STATE_CHANGE,CO.AP_CONNECTED);const{addressList:s0,ticket:a0}=o0;return this._ticket=a0,s0}async connectWorker(e0){this.emit(RO.STATE_CHANGE,CO.CONNECT_WORKER),await this._workerConnection.init(e0,1e4)}handleWorkerEvents(){this._workerConnection.on(Uw.CONNECTED,async()=>{this.emit(RO.STATE_CHANGE,CO.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=gO.CONNECTED}),this._workerConnection.on(Uw.CLOSED,()=>{this.connectionState=gO.CLOSED}),this._workerConnection.on(Uw.FAILED,()=>{this.connectionState=gO.CLOSED}),this._workerConnection.on(Uw.RECONNECTING,()=>{this.connectionState=this.connectionState===gO.CONNECTED?gO.RECONNECTING:gO.CONNECTING}),this._workerConnection.on(Uw.ON_MESSAGE,async e0=>{if(e0.data instanceof ArrayBuffer){const n0=tj(new Uint8Array(e0.data));XA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&fb.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n0)),this._uploadNum++,n0.code===void 0||n0.code===0||(this._uploadFailedNum++,fb.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n0.code,", msg is ").concat(n0.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{vb.reportApiInvoke(this._connectInfo.sid||null,{name:By.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n0.code],tag:jy.TRACER}).onError(new yb(Ry.IMAGE_MODERATION_UPLOAD_FAILED,n0.msg)),this._uploadTimer=null},XA("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else fb.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Uw.WILL_RECONNECT,(e0,n0,r0)=>{e0==="recover"&&r0(e0),r0("tryNext")}),this._workerConnection.on(Uw.REQUEST_NEW_URLS,(e0,n0)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e0).catch(n0)})}static intToLong(e0){return{low:e0|=0,high:e0>>31,unsigned:e0>=0}}async requestToInspectImage(){const e0=eA(this,RO.CLIENT_LOCAL_VIDEO_TRACK),n0={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e0){if(!e0.isPlaying)return void(XA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&fb.debug("Only the track being played can be inspected"));this._sequence++;const r0=await this.generateRequestData(e0,n0);this._workerConnection.sendMessage(r0,!0,!0)}else XA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&fb.debug("Only the track being published can be inspected")}async generateRequestData(e0,n0){let{appId:r0,cname:i0,cid:o0,vid:s0,sid:a0,uid:c0}=n0;const u0=Date.now(),l0=await e0.getCurrentFrameImage("image/jpeg",this.quality),d0=await Ok(l0,r0,i0),h0=this._sequence+"-"+o0+"-"+c0+"-"+u0+"-"+TA(12,""),p0={appId:r0,cid:o0,cname:i0,deviceId:"",elapse:Pj.intToLong(Number(u0-this._moderationStartTime)),fileSize:l0.buffer.byteLength,height:l0.height,width:l0.width,jpg:d0,networkType:6,osType:7,requestId:h0,sdkVersion:"4.22.1",sequence:this._sequence,sid:a0,timestamp:Nj(u0),uid:c0,vid:s0,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete p0.callbackData;const m0=ej(p0);if(m0.byteLength<this._workerMessageLengthLimit){if(XA("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const f0=function(g0){for(var E0=1;E0<arguments.length;E0++){var _0=arguments[E0]!=null?arguments[E0]:{};E0%2?Dj(Object(_0),!0).forEach(function(y0){Fg(g0,y0,_0[y0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g0,Object.getOwnPropertyDescriptors(_0)):Dj(Object(_0)).forEach(function(y0){Object.defineProperty(g0,y0,Object.getOwnPropertyDescriptor(_0,y0))})}return g0}({},p0);delete f0.jpg,fb.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(f0))}return m0}{const f0=this.quality*this._qualityRatio;return this.quality=f0,await this.generateRequestData(e0,{appId:r0,cname:i0,cid:o0,vid:s0,sid:a0,uid:c0})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Lv.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=gO.CLOSED,this.emit(RO.STATE_CHANGE,CO.CLOSED)}}function Lj(t0){if(yy(t0.interval,"interval",1e3,1/0),t0&&t0.extraInfo&&t0.extraInfo.length>1024)throw new yb(Ry.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t0&&t0.vendor&&t0.vendor.length>1024)throw new yb(Ry.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const kj={name:"ImageModeration",create:function(t0){let{config:e0}=t0;return Lj(e0),new Pj(e0)}};var Mj,Uj,xj,Vj,Fj,Bj,jj,Gj,Wj,Hj,Kj,Yj,qj,zj,Jj,Xj,Qj,Zj,$j,eG,tG,iG,nG,rG,oG,sG,aG,cG,dG,lG,uG,hG,pG,_G,EG,fG,mG,TG,SG,gG,RG;function CG(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function IG(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?CG(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):CG(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}NA.setLogger(fb);let vG=(Mj=Ib(),Uj=Ib({argsMap:(t0,e0)=>{if(!Array.isArray(e0)){if(!(e0 instanceof HL))return[e0];e0=[e0]}return e0.map(n0=>n0?Object(n0).toString():"null")}}),xj=Ib({argsMap:(t0,e0)=>(e0||(e0=[]),Array.isArray(e0)||e0.trackMediaType!==vL.DATA?(Array.isArray(e0)||(e0=[e0]),e0.map(n0=>n0.getTrackId())):[e0.getChannelId()])}),Vj=Ib({argsMap:(t0,e0,n0,r0)=>[typeof e0=="object"?e0.uid:e0,n0,r0]}),Fj=Ib({argsMap:(t0,e0,n0)=>[e0,n0]}),Bj=Ib({argsMap:(t0,e0)=>e0.map(n0=>{let{user:r0,mediaType:i0}=n0;return[r0==null?void 0:r0.uid,i0]})}),jj=Ib({argsMap:(t0,e0,n0,r0)=>[typeof e0=="object"?e0.uid:e0,n0,r0]}),Gj=Ib({argsMap:(t0,e0)=>e0.map(n0=>{let{user:r0,mediaType:i0}=n0;return{uid:r0==null?void 0:r0.uid,mediaType:i0}})}),Wj=Ib(),Hj=Ib(),Kj=Ib(),Yj=Ib(),qj=Ib(),zj=Ib(),Jj=Ib(),Xj=Ib(),Qj=Ib(),Zj=Ib(),$j=Ib(),eG=Ib(),tG=Ib(),iG=Ib(),nG=Ib({argsMap:(t0,e0)=>[e0]}),rG=Ib(),oG=Ib(),sG=Ib(),aG=Ib(),cG=Ib(),dG=Ib(),lG=Ib(),uG=Ib(),hG=Ib({argsMap:(t0,e0)=>(Array.isArray(e0)||(e0=[e0]),[JSON.stringify(e0)])}),pG=Ib(),_G=Ib(),EG=Ib(),fG=Ib(),mG=Ib(),TG=Ib(),SG=Ib({reportResult:!0}),gG=Ib(),RG=class extends xy{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t0;return((t0=this._config)===null||t0===void 0?void 0:t0.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t0){let e0;if(super(),Fg(this,"store",void 0),Fg(this,"_uid",void 0),Fg(this,"_channelName",void 0),Fg(this,"_uintUid",void 0),Fg(this,"_users",[]),Fg(this,"_config",void 0),Fg(this,"_clientId",void 0),Fg(this,"_appId",void 0),Fg(this,"_sessionId",null),Fg(this,"_key",void 0),Fg(this,"_rtmConfig",{}),Fg(this,"_joinInfo",void 0),Fg(this,"_gateway",void 0),Fg(this,"_statsCollector",void 0),Fg(this,"_configDistribute",void 0),Fg(this,"_leaveMutex",new NA("client-leave")),Fg(this,"_publishMutex",new NA("client-publish")),Fg(this,"_renewTokenMutex",new NA("client-renewtoken")),Fg(this,"_subscribeMutex",new NA("client-subscribe")),Fg(this,"_encryptionMode","none"),Fg(this,"_encryptionSecret",null),Fg(this,"_encryptionSalt",null),Fg(this,"_encryptDataStream",!1),Fg(this,"_encryptDataStreamKey",null),Fg(this,"_encryptDataStreamIv",null),Fg(this,"_proxyServer",void 0),Fg(this,"_turnServer",{servers:[],mode:"auto"}),Fg(this,"_cloudProxyServerMode","disabled"),Fg(this,"_isDualStreamEnabled",!1),Fg(this,"_defaultStreamFallbackType",void 0),Fg(this,"_lowStreamParameter",void 0),Fg(this,"_streamFallbackTypeCacheMap",new Map),Fg(this,"_remoteStreamTypeCacheMap",new Map),Fg(this,"_axiosCancelSource",Lv.CancelToken.source()),Fg(this,"_audioVolumeIndicationInterval",void 0),Fg(this,"_networkQualityInterval",void 0),Fg(this,"_userOfflineTimeout",void 0),Fg(this,"_streamRemovedTimeout",void 0),Fg(this,"_liveTranscodeStreamingClient",void 0),Fg(this,"_liveRawStreamingClient",void 0),Fg(this,"_channelMediaRelayClient",void 0),Fg(this,"_networkQualitySensitivity","normal"),Fg(this,"_p2pChannel",void 0),Fg(this,"_useLocalAccessPoint",!1),Fg(this,"_setLocalAPVersion",void 0),Fg(this,"_joinAndNotLeaveYet",!1),Fg(this,"_numberOfJoinCount",0),Fg(this,"_remoteDefaultVideoStreamType",void 0),Fg(this,"_inspect",void 0),Fg(this,"_moderation",void 0),Fg(this,"_license",void 0),Fg(this,"_pendingPublishedUsers",[]),Fg(this,"ntpAlignErrorCount",0),Fg(this,"remoteInboundOffset",0),Fg(this,"_handleLocalTrackEnable",(n0,r0,i0)=>{this.publish(n0,!1).then(r0).catch(i0)}),Fg(this,"_handleLocalTrackDisable",(n0,r0,i0)=>{this.unpublish(n0).then(r0).catch(i0)}),Fg(this,"_handleUserOnline",n0=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(n0.uid,this.channelName))return void fb.debug("[".concat(n0.uid,"] will be ignored in local"));this.isStringUID&&typeof n0.uid!="string"&&fb.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const r0=this._users.find(i0=>i0.uid===n0.uid);if(r0)r0._trust_in_room_=!0,r0._is_pre_created&&(r0._is_pre_created=!1,this.safeEmit(zy.USER_JOINED,r0));else{const i0=new cF(n0.uid,n0.uint_id||n0.uid);this._users.push(i0),fb.debug("[".concat(this._clientId,"] user online"),n0.uid),this.safeEmit(zy.USER_JOINED,i0)}}),Fg(this,"_handleUserOffline",n0=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(n0.uid,this.channelName))return;const r0=this._users.find(i0=>i0.uid===n0.uid);r0&&(this._handleRemoveStream(n0),this._handleRemoveDataChannels(n0),r0._audio_pre_subscribed||r0._video_pre_subscribed?r0._is_pre_created=!0:nA(this._users,r0),this._remoteStreamTypeCacheMap.delete(r0.uid),this._streamFallbackTypeCacheMap.delete(r0.uid),fb.debug("[".concat(this._clientId,"] user offline"),n0.uid,"reason:",n0.reason),this.safeEmit(zy.USER_LEAVED,r0,n0.reason))}),Fg(this,"_handleAddAudioOrVideoStream",(n0,r0,i0,o0,s0,a0,c0)=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(r0,this.channelName))return;const u0=this._users.find(d0=>d0.uid===r0);if(!u0)return void fb.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));fb.debug("[".concat(this._clientId,"] stream added with uid ").concat(r0,", type ").concat(n0)),this.store.subscribe(u0.uid,n0,void 0,void 0,void 0,Date.now());const l0=n0==="audio"?u0.hasAudio:u0.hasVideo;u0._uintid||(u0._uintid=s0||r0),n0==="audio"?u0._trust_audio_stream_added_state_=!0:u0._trust_video_stream_added_state_=!0,n0==="audio"?(u0._audio_added_=!0,i0!==void 0&&(u0._audioSSRC=i0),o0!==void 0&&(u0._cname=o0),a0&&(u0._audioOrtc=a0)):(u0._video_added_=!0,i0!==void 0&&(u0._videoSSRC=i0),o0!==void 0&&(u0._cname=o0),c0!==void 0&&(u0._rtxSsrcId=c0),a0&&(u0._videoOrtc=a0)),(n0==="audio"?u0.hasAudio:u0.hasVideo)&&!l0&&(fb.info("[".concat(this._clientId,"] remote user ").concat(u0.uid," published ").concat(n0)),this.safeEmit(zy.USER_PUBLISHED,u0,n0)),n0==="video"?vb.onGatewayStream(this._sessionId,gb.ON_ADD_VIDEO_STREAM,Rb.ON_ADD_VIDEO_STREAM,{peer:s0||r0,ssrc:u0._videoSSRC}):vb.onGatewayStream(this._sessionId,gb.ON_ADD_AUDIO_STREAM,Rb.ON_ADD_AUDIO_STREAM,{peer:s0||r0,ssrc:u0._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(u0,n0,i0).then(d0=>{if(d0&&(fb.debug("[".concat(this._clientId,"] resubscribe ").concat(n0," for user ").concat(u0.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof fB))return this._p2pChannel.unsubscribe(u0,n0,!0).then(()=>this._subscribe(u0,n0,!0).catch(h0=>{fb.error("[".concat(this._clientId,"] resubscribe error"),h0.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(u0,n0)&&(fb.debug("[".concat(this._clientId,"] resubscribe ").concat(n0," for user ").concat(u0.uid," after reconnect.")),this._subscribe(u0,n0,!0).catch(d0=>{fb.error("[".concat(this._clientId,"] resubscribe error"),d0.toString())}))}),Fg(this,"_handleRemoveStream",n0=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(n0.uid,this.channelName))return;const r0=this._users.find(o0=>o0.uid===n0.uid);if(!r0)return void fb.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));fb.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n0.uid));let i0=()=>{};r0.hasAudio&&r0.hasVideo?i0=()=>{fb.info("[".concat(this._clientId,"] remote user ").concat(r0.uid," unpublished audio track")),this.safeEmit(zy.USER_UNPUBLISHED,r0,"audio"),fb.info("[".concat(this._clientId,"] remote user ").concat(r0.uid," unpublished video track")),this.safeEmit(zy.USER_UNPUBLISHED,r0,"video")}:r0.hasVideo?i0=()=>{fb.info("[".concat(this._clientId,"] remote user ").concat(r0.uid," unpublished video track")),this.safeEmit(zy.USER_UNPUBLISHED,r0,"video")}:r0.hasAudio&&(i0=()=>{fb.info("[".concat(this._clientId,"] remote user ").concat(r0.uid," unpublished audio track")),this.safeEmit(zy.USER_UNPUBLISHED,r0,"audio")}),r0._video_pre_subscribed||r0._audio_pre_subscribed||(r0._trust_audio_stream_added_state_=!0,r0._trust_video_stream_added_state_=!0,r0._audio_added_=!1,r0._video_added_=!1,this._p2pChannel instanceof fB&&this._p2pChannel.unsubscribe(r0).then(o0=>{if(o0)return this._gateway.unsubscribe(o0,r0.uid)}),r0._audioSSRC=void 0,r0._videoSSRC=void 0,r0._audioOrtc=void 0,r0._videoOrtc=void 0,r0._rtxSsrcId=void 0),vb.onGatewayStream(this._sessionId,gb.ON_REMOVE_STREAM,Rb.ON_REMOVE_STREAM,{peer:n0.uint_id||n0.uid}),i0()}),Fg(this,"_handleSetStreamLocalEnable",(n0,r0,i0)=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(r0,this.channelName))return;const o0=this._users.find(c0=>c0.uid===r0);if(!o0)return void fb.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));fb.debug("[".concat(this._clientId,"] local ").concat(n0," ").concat(i0?"enabled":"disabled"," with uid ").concat(r0));const s0=n0==="audio"?o0.hasAudio:o0.hasVideo;if(n0==="audio"){o0._trust_audio_enabled_state_=!0;const c0=o0._audio_enabled_;if(o0._audio_enabled_=i0,o0._audio_enabled_===c0)return;{const u0=o0._audio_enabled_?"enable-local-audio":"disable-local-audio";fb.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r0,", msg: ").concat(u0)),this.safeEmit(zy.USER_INFO_UPDATED,r0,u0)}}else{o0._trust_video_enabled_state_=!0;const c0=o0._video_enabled_;if(o0._video_enabled_=i0,o0._video_enabled_===c0)return;{const u0=o0._video_enabled_?"enable-local-video":"disable-local-video";fb.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r0,", msg: ").concat(u0)),this.safeEmit(zy.USER_INFO_UPDATED,r0,u0)}}const a0=n0==="audio"?o0.hasAudio:o0.hasVideo;return s0!==a0?!s0&&a0?(fb.info("[".concat(this._clientId,"] remote user ").concat(r0," published ").concat(n0)),void this.safeEmit(zy.USER_PUBLISHED,o0,n0)):(n0==="video"&&o0._videoTrack&&o0._videoTrack._destroy(),n0==="audio"&&o0._audioTrack,this._p2pChannel.muteRemote(o0,n0),fb.info("[".concat(this._clientId,"] remote user ").concat(r0," unpublished ").concat(n0)),void this.safeEmit(zy.USER_UNPUBLISHED,o0,n0)):void 0}),Fg(this,"_handleMuteStream",(n0,r0,i0)=>{if(XA("BLOCK_LOCAL_CLIENT")&&Ob(n0,this.channelName))return;fb.debug("[".concat(this._clientId,"] receive mute message"),n0,r0,i0);const o0=this._users.find(c0=>c0.uid===n0);if(!o0)return void fb.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n0));const s0=r0==="audio"?o0.hasAudio:o0.hasVideo;if(r0==="audio"){o0._trust_audio_mute_state_=!0;const c0=o0._audio_muted_;if(o0._audio_muted_=i0,o0._audio_muted_===c0)return;{const u0=o0._audio_muted_?"mute-audio":"unmute-audio";fb.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n0,", msg: ").concat(u0)),this.safeEmit(zy.USER_INFO_UPDATED,n0,u0)}}else{o0._trust_video_mute_state_=!0;const c0=o0._video_muted_;if(o0._video_muted_=i0,o0._video_muted_===c0)return;{const u0=o0._video_muted_?"mute-video":"unmute-video";fb.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n0,", msg: ").concat(u0)),this.safeEmit(zy.USER_INFO_UPDATED,n0,u0)}}const a0=r0==="audio"?o0.hasAudio:o0.hasVideo;if(s0!==a0){if(!s0&&a0)return(r0==="audio"?o0._audioSSRC:o0._videoSSRC)?(fb.info("[".concat(this._clientId,"] remote user ").concat(n0," published ").concat(r0)),void this.safeEmit(zy.USER_PUBLISHED,o0,r0)):void fb.warning("[".concat(this._clientId,"] remote user ").concat(n0," receive ").concat(r0," unmute message  before add stream message, ").concat(r0," SSRC doesn't exist yet."));r0==="video"&&o0._videoTrack&&!o0._video_pre_subscribed&&o0._videoTrack._destroy(),r0==="audio"&&o0._audioTrack,this._p2pChannel.muteRemote(o0,r0),fb.info("[".concat(this._clientId,"] remote user ").concat(n0," unpublished ").concat(r0)),this.safeEmit(zy.USER_UNPUBLISHED,o0,r0)}}),Fg(this,"_handleP2PLost",async n0=>{fb.debug("[".concat(this._clientId,"] receive p2p lost"),n0),parseInt(n0.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():fb.warning("[".concat(this._clientId,"] P2PLost stream not found"),n0)}),Fg(this,"_handleTokenWillExpire",()=>{fb.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(zy.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Fg(this,"_handleBeforeUnload",n0=>{n0.type==="beforeunload"&&n0.returnValue!==void 0&&n0.returnValue!==""||(this.leave(),fb.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Fg(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(zy.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n0={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n0.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n0.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(zy.NETWORK_QUALITY,n0)}),Fg(this,"_handleP2PAddAudioOrVideoStream",(n0,r0,i0,o0)=>{const s0=this._users.find(c0=>c0.uid===r0);if(!s0)return void fb.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));fb.debug("[".concat(this._clientId,"] stream added with uid ").concat(r0,", type ").concat(n0)),this.store.subscribe(s0.uid,n0,void 0,void 0,void 0,Date.now());const a0=n0==="audio"?s0.hasAudio:s0.hasVideo;n0==="audio"?s0._trust_audio_stream_added_state_=!0:s0._trust_video_stream_added_state_=!0,n0==="audio"?(s0._audio_added_=!0,i0!==void 0&&(s0._audioSSRC=i0),o0!==void 0&&(s0._audioMid=o0)):(s0._video_added_=!0,i0!==void 0&&(s0._videoSSRC=i0),o0!==void 0&&(s0._videoMid=o0)),(n0==="audio"?s0.hasAudio:s0.hasVideo)&&!a0&&(fb.info("[".concat(this._clientId,"] remote user ").concat(s0.uid," published ").concat(n0)),this.safeEmit(zy.USER_PUBLISHED,s0,n0)),this._p2pChannel.hasPendingRemoteMedia(s0,n0)&&(fb.debug("[".concat(this._clientId,"] resubscribe ").concat(n0," for user ").concat(s0.uid," after reconnect.")),this._subscribe(s0,n0,!0).catch(c0=>{fb.error("[".concat(this._clientId,"] resubscribe error"),c0.toString())}))}),this._config=t0,this._clientId=TA(5,"client-"),this.store=new $A(t0.codec,t0.audioCodec,t0.mode,this._clientId),this.store.clientCreated(),t0.proxyServer&&this.setProxyServer(t0.proxyServer,!0),t0.turnServer&&this.setTurnServer(t0.turnServer,!0),fb.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(GA," build: ").concat(qA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t0.clientRoleOptions)try{qy(t0.clientRoleOptions),e0=Object.assign({},t0.clientRoleOptions)}catch(n0){fb.warning("[".concat(this._clientId,"] ").concat(n0.toString()))}this._statsCollector=new DF(this.store),this._statsCollector.onStatsException=(n0,r0,i0)=>{fb.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n0,", msg: ").concat(r0,", uid: ").concat(i0)),this.safeEmit(zy.EXCEPTION,{code:n0,msg:r0,uid:i0})},this._statsCollector.onUploadPublishDuration=(n0,r0,i0,o0)=>{const s0=this._users.find(a0=>a0.uid===n0);s0&&vb.peerPublishStatus(this._sessionId,{subscribeElapse:o0,audioPublishDuration:r0,videoPublishDuration:i0,peer:s0._uintid})},this.store.useP2P=t0.mode==="p2p",this._gateway=new Ex(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t0.websocketRetryConfig||PA,httpRetryConfig:t0.httpRetryConfig||PA,forceWaitGatewayResponse:t0.forceWaitGatewayResponse===void 0||t0.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t0.role,clientRoleOptions:e0}),this._configDistribute=new tV,this.store.useP2P?(this._p2pChannel=new bF(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new fB(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t0,e0,n0,r0,i0){let o0=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],s0=arguments.length>6&&arguments[6]!==void 0&&arguments[6];JA("JOIN_GATEWAY_USE_443PORT_ONLY",o0),JA("JOIN_GATEWAY_USE_DUAL_DOMAIN",s0);const a0=this._gateway.signal.websocket;return a0 instanceof WO&&(a0.use443PortOnly=o0,a0.tryDoubleDomain=s0),async function(c0,u0,l0){Uv.get(c0)||Uv.set(c0,[]),xv.get(c0)||xv.set(c0,u0),Vv.get(c0)||Vv.set(c0,0);const d0=Uv.get(c0),h0=xv.get(c0);if(!d0||!h0)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Vv.get(c0)===h0){const E0=Mv();d0.push(E0),await E0.promise}Vv.set(c0,Vv.get(c0)+1);for(var p0=arguments.length,m0=new Array(p0>3?p0-3:0),f0=3;f0<p0;f0++)m0[f0-3]=arguments[f0];const g0=await l0(...m0);return Vv.set(c0,Vv.get(c0)-1),Vv.get(c0)===h0-1&&d0.length>0&&(d0[0].resolve(),d0.shift()),Vv.get(c0)===0&&(Uv.set(c0,[]),xv.set(c0,0),Vv.set(c0,0)),g0}("client.join",XA("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t0,e0,n0,r0,i0)}async join(t0,e0,n0,r0,i0){const o0=++this._numberOfJoinCount;this.store.joinStart(),r0&&(this.store.uid=r0);const s0=(UA||UA||(UA=(window.location.protocol.split(":")[0]||"").toUpperCase(),UA))==="HTTPS",a0=jA()?window.isSecureContext:"Browser Not Support";(!jA()&&!s0||!window.isSecureContext)&&fb.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),fb.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),vb.setAppId(t0);try{if(!n0&&n0!==null)throw new yb(Ry.INVALID_PARAMS,"Invalid token: ".concat(n0,". If you don not use token, set it to null"));n0&&by(n0,"token",1,2047),by(t0,"appid",1,2047),xw(e0),r0&&Vw(r0),i0&&by(i0,"optionalInfo",1,2047)}catch(f0){throw vb.reportApiInvoke(SA(),{name:By.JOIN,options:[t0,e0,n0,r0],states:{isHttps:s0,isSecureContext:a0},tag:jy.TRACER}).onError(f0),f0}if(this._leaveMutex.isLocked&&(fb.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),fb.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const f0=new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw vb.reportApiInvoke(SA(),{name:By.JOIN,options:[t0,e0,n0,r0],states:{isHttps:s0,isSecureContext:a0},tag:jy.TRACER}).onError(f0),f0}this._gateway.state="CONNECTING";const c0=await YB({appId:t0,cname:e0,uid:r0,stringUid:typeof r0=="string"?r0:void 0,token:n0||t0,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const u0=(c0==null?void 0:c0.sid)||SA();fb.info("[".concat(this._clientId,"] start join channel ").concat(e0,", join number: ").concat(o0)),this._sessionId||(this._sessionId=u0,this.store.sessionId=this._sessionId);const l0=vb.reportApiInvoke(u0,{name:By.JOIN,options:[t0,e0,n0,r0],states:{isHttps:s0,isSecureContext:a0},tag:jy.TRACER}),d0=IG(IG(IG({},this._rtmConfig),{},{clientId:this._clientId,appId:t0,sid:this._sessionId,cname:e0,uid:typeof r0!="string"?r0:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n0||t0,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i0,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c0},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:XA("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(d0.setLocalAPVersion=this._setLocalAPVersion),typeof r0=="string"&&(d0.stringUid=r0,this._uintUid?(d0.uid=this._uintUid,this._uintUid=void 0):d0.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(d0.aesmode=this._encryptionMode,d0.aespassword=await(async f0=>{const g0=function(b0){const S0=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),w0=new Uint8Array(new ArrayBuffer(S0.length));for(let I0=0;I0<S0.length;I0+=1)w0[I0]=S0.charCodeAt(I0);return w0}(),E0=await window.crypto.subtle.importKey("spki",g0,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),_0=ky(f0),y0=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},E0,_0);return function(b0){let S0="";for(let w0=0;w0<b0.length;w0+=1)S0+=String.fromCharCode(b0[w0]);return window.btoa(S0)}(new Uint8Array(y0))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(d0.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const f0=new TextEncoder,g0=XA("USE_PURE_ENCRYPTION_MASTER_KEY")?f0.encode(d0.appId+this._encryptionSecret+this._encryptionSecret):f0.encode(d0.appId+d0.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(E0,_0,y0){const b0=await window.crypto.subtle.importKey("raw",_0,"PBKDF2",!1,["deriveBits","deriveKey"]),S0=E0==="aes-128-gcm2"?128:256,w0=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:nb,hash:"SHA-256",salt:y0},b0,S0+ib);return new Uint8Array(w0).subarray(S0/8)}(this._encryptionMode,g0,lA(this._encryptionSalt)),this._encryptDataStreamKey=await async function(E0,_0,y0){const b0=await window.crypto.subtle.importKey("raw",_0,"PBKDF2",!1,["deriveBits","deriveKey"]),S0=E0==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:nb,hash:"SHA-256",salt:y0},b0,{name:"AES-GCM",length:S0},!0,["encrypt","decrypt"])}(this._encryptionMode,g0,lA(this._encryptionSalt))}else a0?fb.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):fb.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,fb.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e0,appId:t0,stringUid:d0.stringUid});const h0=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&h0===this._sessionId&&vb.joinChannelTimeout(this._sessionId,5)},5e3);try{var p0;let f0;const g0=d0.cloudProxyServer;if(Dn(p0=["proxy3","proxy4","proxy5"]).call(p0,g0)){const S0=XA("PROXY_SERVER_TYPE3");Array.isArray(S0)?d0.proxyServer=S0[0]:d0.proxyServer=S0}if(vb.setProxyServer(d0.proxyServer),fb.setProxyServer(d0.proxyServer),this.store.requestAPStart(),c0){if(fb.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(d0.stringUid?", ".concat(d0.stringUid," => ").concat(c0.intUid):""," ")),d0.stringUid&&!d0.uid&&(d0.uid=c0.intUid),f0={gatewayInfo:c0.ap.gatewayInfo},XA("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&d0.turnServer.mode==="auto")if(c0.ap.proxyInfo.addresses.length===0)fb.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const S0=(await tN(c0.ap.proxyInfo,c0.ap.gatewayInfo.uid)).map(w0=>({turnServerURL:w0.address,tcpport:w0.tcpport||KA.tcpport,udpport:w0.udpport||KA.udpport,username:w0.username||KA.username,password:w0.password||KA.password,forceturn:!1,security:!0}));d0.turnServer={mode:"manual",servers:S0}}XB(c0,d0.stringUid)}else{if(d0.stringUid&&!d0.uid){let S0;[S0,f0]=await Gh.all([Yx(d0.stringUid,d0,this._axiosCancelSource.token,this._config.httpRetryConfig||PA,this.store),Kx(d0,this._axiosCancelSource.token,this._config.httpRetryConfig||PA,!0,this.store)]),fb.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(d0.stringUid," => ").concat(S0)),d0.uid=S0,f0.gatewayInfo.uid=S0,f0.gatewayInfo.res.uid=S0}else f0=await Kx(d0,this._axiosCancelSource.token,this._config.httpRetryConfig||PA,!0,this.store);if(!this._joinAndNotLeaveYet)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(d0,this._axiosCancelSource.token),this._configDistribute.on(sO.UPDATE_BITRATE_LIMIT,S0=>{this._p2pChannel.updateBitrateLimit(S0)})},0),this._key=n0||t0;const E0=f0.gatewayInfo,_0=d0.uid?d0.uid:E0.uid;this._joinInfo=IG(IG({},d0),{},{cid:E0.cid,uid:_0,vid:E0.vid,apResponse:E0.res,apGatewayAddress:E0.apGatewayAddress,uni_lbs_ip:E0.uni_lbs_ip,gatewayAddrs:E0.gatewayAddrs}),this.store.intUid=_0;const y0=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l0.onSuccess(y0),this._appId=t0,this._channelName=d0.cname,this._uid=y0,this.store.uid=y0,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Xv()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const b0=d0.stringUid?"string uid: ".concat(d0.stringUid,",uid: ").concat(d0.uid):"uid: ".concat(this._uid);return fb.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e0,",").concat(b0)),setTimeout(()=>{fb.startUpload()},5e3),this.store.joinEnd(),m0=this,Dn(wb).call(wb,m0)||wb.push(m0),this._cloudProxyServerMode==="disabled"&&ZP().supportWebCrypto&&XA("ENABLE_PRELOAD")&&zB(this._joinInfo),y0}catch(f0){const g0=Array.isArray(f0)?f0[0]:f0;throw g0&&g0.code===Ry.OPERATION_ABORTED?fb.warning("[".concat(this._clientId,"] join number: ").concat(o0,", Joining channel failed, rollback"),g0):fb.error("[".concat(this._clientId,"] join number: ").concat(o0,", Joining channel failed, rollback"),g0),g0.code!==Ry.OPERATION_ABORTED&&this._numberOfJoinCount===o0&&(this._gateway.state="DISCONNECTED",this._reset()),l0.onError(g0),g0}var m0}_joinGateway(){if(!this._joinInfo||!this._key)throw new yb(Ry.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!XA("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){fb.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Xv()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e0){const n0=wb.indexOf(e0);n0!==-1&&wb.splice(n0,1)}(this),this._statsCollector.stopUpdateStats();const t0=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return fb.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t0();await this._gateway.leave(this.connectionState!=="CONNECTED"),fb.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t0()}async publish(t0){let e0=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t0)){if(!(t0 instanceof HL))return this._publishDataChannel(t0);t0=[t0]}if(t0.length===0)throw new yb(Ry.INVALID_PARAMS,"param list is empty");const n0=t0;if(this._gateway.role==="audience")throw new yb(Ry.INVALID_OPERATION,"audience can not publish stream");for(const i0 of n0){if(!(i0 instanceof HL))throw new yb(Ry.INVALID_PARAMS,"parameter is not local track");if(!i0._enabled&&e0)throw new yb(Ry.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i0.getTrackId()))}fb.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n0.map(i0=>"".concat(i0.getTrackId()," "))));const r0=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e0&&n0.forEach(i0=>{const o0=this._configDistribute.getBitrateLimit();i0 instanceof aU&&o0&&i0.setBitrateLimit(o0.uplink)});try{await this._publishHighStream(n0),fb.info("[".concat(this._clientId,"] Publish success, id ").concat(n0.map(i0=>"".concat(i0.getTrackId()," "))))}catch(i0){throw fb.error("[".concat(this._clientId,"] publish error"),i0.toString()),i0}finally{r0()}}async _publishDataChannel(t0){yy(t0.id,"id",0,65535,!0),Iy(t0.ordered,"ordered"),by(t0.metadata,"metadata",0,512),fb.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t0.id));const e0=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i0=>i0.id===t0.id)!==-1)throw new yb(Ry.INVALID_PARAMS,"Invalid id: ".concat(t0.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new yb(Ry.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&XA("FORCE_TURN")&&!XA("TURN_ENABLE_TCP")&&!XA("TURN_ENABLE_UDP"))throw new yb(Ry.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n0=function(i0){return RB(i0,!1)}(t0),r0=await this._p2pChannel.publishDataChannel([n0]);if(r0.length>0){if(typeof n0._originDataChannelId!="number")throw fb.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new yb(Ry.CREATE_DATACHANNEL_ERROR);try{await Gh.all(r0.map(i0=>this._uid&&this._gateway.publishDataChannel(this._uid,i0,!0))),await n0._waitTillOpen()}catch(i0){if(i0.code!==Ry.DISCONNECT_P2P)throw i0}}return fb.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n0.id)),n0}catch(n0){throw fb.error("[".concat(this._clientId,"] publish datachannels error"),n0.toString()),n0}finally{e0()}}async unpublish(t0){if(!this._joinInfo||this._uid===void 0)throw new yb(Ry.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e0=[];if(t0)if(Array.isArray(t0))e0=t0;else{if(!(t0 instanceof HL))return this._unpublishDataChannel([t0]);e0=[t0]}else this.store.useP2P||await this._unpublishDataChannel(),e0=this._p2pChannel.getAllTracks(!0);fb.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e0.map(r0=>"".concat(r0.getTrackId()," "))," "));const n0=await this._publishMutex.lock();try{if(this._p2pChannel instanceof bF){const r0=await this._p2pChannel.unpublish(e0);r0&&await this._gateway.sendExtensionMessage(IO.UNPUBLISH,{unpubMsg:r0},!0)}else{const r0=await this._p2pChannel.unpublish(e0);r0&&await this._gateway.unpublish(r0,this._uid),fb.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e0.map(i0=>"".concat(i0.getTrackId()))))}}catch(r0){throw fb.error("[".concat(this._clientId,"] unpublish error"),r0.toString()),r0}finally{n0&&n0()}}async _unpublishDataChannel(t0){t0!==void 0&&t0.length!==0||(t0=this._p2pChannel.getAllDataChannels()),fb.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t0.map(n0=>"".concat(n0.id," "))," "));const e0=await this._publishMutex.lock();try{const n0=await this._p2pChannel.unpublishDataChannel(t0);n0&&await this._gateway.unpublishDataChannel(n0),fb.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t0.map(r0=>"".concat(r0.id))))}catch(n0){throw fb.error("[".concat(this._clientId,"] unpublish dataChannel error"),n0.toString()),n0}finally{e0&&e0()}}async subscribe(t0,e0,n0){if(!(t0 instanceof cF)){const r0=this.remoteUsers.find(i0=>i0.uid===t0);if(!r0)throw new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");t0=r0}return e0==="datachannel"?this._subscribeDataChannel(t0,n0):this._subscribe(t0,e0)}async presubscribe(t0,e0){if(vy(e0,"mediaType",["audio","video"]),this._p2pChannel instanceof bF)throw new yb(Ry.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n0=e0===dO.AUDIO,r0=e0===dO.VIDEO,i0=await this._subscribeMutex.lock();try{const{ssrcId:o0,ortc:s0,rtxSsrcId:a0,cname:c0,uint_id:u0}=await this._gateway.presubscribe(t0,e0,!0);if(o0==null)throw new yb(Ry.UNEXPECTED_RESPONSE,"no ssrc id");let l0=this._users.find(h0=>h0.uid===t0);l0||(l0=new cF(t0,u0||t0),l0._is_pre_created=!0,this._users.push(l0)),c0&&(l0._cname=c0),l0._uintid||(l0._uintid=u0||t0),n0&&(l0._audioSSRC=o0,l0._audio_pre_subscribed=!0,s0&&(l0._audioOrtc=s0)),r0&&(l0._videoSSRC=o0,l0._video_pre_subscribed=!0,s0&&(l0._videoOrtc=s0),a0!=null&&(l0._rtxSsrcId=a0)),fb.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o0)),await this._p2pChannel.subscribe(l0,e0,o0,a0,s0);const d0=n0?l0._audioTrack:l0._videoTrack;if(!d0)throw new yb(Ry.UNEXPECTED_ERROR,"can not find remote track in user");return n0&&(l0._trust_audio_stream_added_state_=!0,l0._audio_added_=!0),r0&&(l0._trust_video_stream_added_state_=!0,l0._video_added_=!0),d0}catch(o0){throw fb.error("[".concat(this._clientId,"] presub user ").concat(t0," error"),o0),o0}finally{i0()}}async _subscribeDataChannel(t0,e0){var n0;if(yy(e0,"channelId",0,65535,!0),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(a0=>a0===t0))throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(t0.uid,", this user is not in the channel")),new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");if(!t0.hasAudio&&!t0.hasVideo&&t0._dataChannels.length===0)throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(t0.uid,", user is not published")),new yb(Ry.INVALID_REMOTE_USER,"user is not published");const i0=(n0=t0._dataChannels)===null||n0===void 0?void 0:n0.find(a0=>a0.id===e0);if(!i0)throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(t0.uid," with mediaType datachannel, remote datachannel is not published")),new yb(Ry.REMOTE_USER_IS_NOT_PUBLISHED);const o0=await this._subscribeMutex.lock();fb.info("[".concat(this._clientId,"] subscribe user ").concat(t0.uid,", mediaType: datachannel"));try{const a0=await this._p2pChannel.subscribeDataChannel(t0,[i0]);if(a0&&Dn(a0).call(a0,i0.id))try{var s0;if(typeof i0._originDataChannelId!="number")throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(t0.uid," with mediaType datachannel, cannot get RTCDatachannel")),new yb(Ry.CREATE_DATACHANNEL_ERROR);const c0={id:i0.id,datachannelId:i0._originDataChannelId,ordered:i0.ordered,maxRetransmits:i0.maxRetransmits,metadata:(s0=i0.metadata)!==null&&s0!==void 0?s0:""};await this._gateway.subscribeDataChannel(t0.uid,c0,!0),await i0._waitTillOpen()}catch(c0){if((c0==null?void 0:c0.code)!==Ry.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t0,[i0]),c0;await this._p2pChannel.unsubscribeDataChannel(t0,[i0]),this._p2pChannel.setPendingRemoteDataChannel(t0,i0.id)}return fb.info("[".concat(this._clientId,"] subscribe success user ").concat(t0.uid,", mediaType: datachannel")),i0}finally{o0()}}async _p2pSubscribe(t0,e0,n0){if(vy(e0,"mediaType",["audio","video"]),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(o0=>o0===t0)){const o0=new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(t0.uid,", this user is not in the channel")),o0}if(!t0.hasAudio&&!t0.hasVideo){const o0=new yb(Ry.INVALID_REMOTE_USER,"user is not published");throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(t0.uid,", user is not published")),o0}if(!n0&&(e0==="audio"&&!t0.hasAudio||e0==="video"&&!t0.hasVideo)){const o0=new yb(Ry.REMOTE_USER_IS_NOT_PUBLISHED);throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(t0.uid," with mediaType ").concat(e0,", remote track is not published")),o0}const i0=await this._subscribeMutex.lock();fb.info("[".concat(this._clientId,"] subscribe user ").concat(t0.uid,", mediaType: ").concat(e0));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t0,e0))await this._p2pChannel.unmuteRemote(t0,e0);else try{const s0=e0==="audio"?t0._audioSSRC:t0._videoSSRC,a0=e0==="audio"?t0._audioMid:t0._videoMid;this.store.subscribe(t0.uid,e0,Date.now()),this._p2pChannel instanceof bF&&await this._p2pChannel.subscribe(t0,e0,s0,a0)}catch(s0){throw s0}fb.info("[".concat(this._clientId,"] subscribe success user ").concat(t0.uid,", mediaType: ").concat(e0)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t0.uid,this._defaultStreamFallbackType).catch(s0=>{fb.warning("[".concat(this._clientId,"] auto set fallback failed"),s0)});const o0=e0==="audio"?t0._audioTrack:t0._videoTrack;if(!o0)throw new yb(Ry.UNEXPECTED_ERROR,"can not find remote track in user object");return o0}catch(o0){throw fb.error("[".concat(this._clientId,"] subscribe user ").concat(t0.uid," error"),o0),o0}finally{i0()}}async _subscribe(t0,e0,n0){if(this._p2pChannel instanceof bF)return this._p2pSubscribe(t0,e0);if(vy(e0,"mediaType",["audio","video"]),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u0=>u0===t0)){const u0=new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(t0.uid,", this user is not in the channel")),u0}if(!t0.hasAudio&&!t0.hasVideo){const u0=new yb(Ry.INVALID_REMOTE_USER,"user is not published");throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(t0.uid,", user is not published")),u0}if(!(n0||(e0!=="audio"||t0.hasAudio&&t0._audioSSRC!==void 0)&&(e0!=="video"||t0.hasVideo&&t0._videoSSRC!==void 0))){const u0=new yb(Ry.REMOTE_USER_IS_NOT_PUBLISHED);throw fb.error("[".concat(this._clientId,"] can not subscribe ").concat(t0.uid," with mediaType ").concat(e0,", remote track is not published")),u0}let i0=e0==="audio"?t0._audioSSRC:t0._videoSSRC,o0=e0==="audio"?t0._audioOrtc:t0._videoOrtc,s0=e0==="video"?t0._rtxSsrcId:void 0,a0={stream_type:e0==="audio"?dO.AUDIO:dO.VIDEO,ssrcId:i0};const c0=await this._subscribeMutex.lock();fb.info("[".concat(this._clientId,"] subscribe user ").concat(t0.uid,", mediaType: ").concat(e0));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t0,e0))await this._p2pChannel.unmuteRemote(t0,e0);else try{const l0=e0==="audio"?t0._audioSSRC:t0._videoSSRC;l0!==void 0&&l0!==i0&&(i0=l0,o0=e0==="audio"?t0._audioOrtc:t0._videoOrtc,s0=e0==="video"?t0._rtxSsrcId:void 0,a0={stream_type:e0==="audio"?dO.AUDIO:dO.VIDEO,ssrcId:i0}),rV.markSubscribeStart(this.store.clientId,i0),this.store.subscribe(t0.uid,e0,Date.now()),await this._p2pChannel.subscribe(t0,e0,i0,s0,o0);try{this._p2pChannel.isPreSubScribe(i0)||await this._gateway.subscribe(t0.uid,a0,!0)}catch(d0){if((d0==null?void 0:d0.code)!==Ry.WS_ABORT)throw await this._p2pChannel.unsubscribe(t0,e0),d0;await this._p2pChannel.unsubscribe(t0,e0,!0),this._p2pChannel.setPendingRemoteMedia(t0,e0)}this.store.subscribe(t0.uid,e0,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t0,e0)}catch(l0){throw this._p2pChannel.reportSubscribeEvent(!1,l0==null?void 0:l0.code,t0,e0),l0}fb.info("[".concat(this._clientId,"] subscribe success user ").concat(t0.uid,", mediaType: ").concat(e0)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t0.uid,this._defaultStreamFallbackType).catch(l0=>{fb.warning("[".concat(this._clientId,"] auto set fallback failed"),l0)});const u0=e0==="audio"?t0._audioTrack:t0._videoTrack;if(!u0)throw new yb(Ry.UNEXPECTED_ERROR,"can not find remote track in user object");return u0}catch(u0){throw fb.error("[".concat(this._clientId,"] subscribe user ").concat(t0.uid," error"),u0),u0}finally{c0()}}async massSubscribe(t0){if(wy(t0,"subscribeList"),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e0=Date.now(),n0=new Map,r0=await this._subscribeMutex.lock();fb.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t0.map(a0=>{let{user:c0,mediaType:u0}=a0;return"user: ".concat(c0==null?void 0:c0.uid,", mediaType: ").concat(u0)}).join("; ")));const i0=(t0=[...t0]).map(a0=>{let{user:c0,mediaType:u0}=a0;return{user:c0,mediaType:u0}}),o0=await this._p2pChannel.globalLock();try{var s0;for(let c0=t0.length-1;c0>=0;c0--){const u0=t0[c0],{user:l0,mediaType:d0}=u0;if(vy(d0,"mediaType",["audio","video"]),!l0){const f0=new yb(Ry.INVALID_PARAMS,"user property does not exist in subscribeList item");throw fb.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),f0}if(!this._users.find(f0=>f0===l0)){const f0=new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");fb.error("[".concat(this._clientId,"] can not massSubscribe ").concat(l0.uid,", this user is not in the channel")),i0[c0].error=f0,t0.splice(c0,1);continue}if(d0==="audio"&&(!l0.hasAudio||l0._audioSSRC===void 0)||d0==="video"&&(!l0.hasVideo||l0._videoSSRC===void 0)){const f0=new yb(Ry.REMOTE_USER_IS_NOT_PUBLISHED);fb.error("[".concat(this._clientId,"] can not subscribe ").concat(l0.uid," with mediaType ").concat(d0,", remote user is not published")),i0[c0].error=f0,t0.splice(c0,1);continue}const p0=tO.Video|tO.LwoVideo,m0=n0.get(l0);if(m0){if(d0==="video"?m0&p0:m0&tO.Audio){t0.splice(c0,1),fb.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(l0.uid,", mediaType:").concat(d0," twice"));continue}n0.set(l0,m0|(d0==="video"?p0:tO.Audio))}else n0.set(l0,d0==="video"?p0:tO.Audio)}for(let c0=t0.length-1;c0>=0;c0--){const u0=t0[c0],{user:l0,mediaType:d0}=u0,h0=tO.Video|tO.LwoVideo;if(this._p2pChannel.hasRemoteMedia(l0,d0)){await this._p2pChannel.unmuteRemoteNoLock(l0,d0);const p0=n0.get(l0);n0.set(l0,d0==="video"?p0^h0:p0^tO.Audio),t0.splice(c0,1)}}this.store.massSubscribe(t0.map(c0=>({userId:c0.user.uid,type:c0.mediaType})),e0);let a0=Jn(s0=Array.from(n0.entries())).call(s0,(c0,u0)=>{let[l0,d0]=u0;if(d0===0)return c0;const h0={stream_id:l0.uid,stream_type:d0};return d0&tO.Audio&&(h0.audio_ssrc=l0._audioSSRC),d0&tO.Video&&(h0.video_ssrc=l0._videoSSRC),c0.push(h0),c0},[]);try{t0.length>0&&await this._p2pChannel.massSubscribeNoLock(t0.map(u0=>{let{user:l0,mediaType:d0}=u0;return{user:l0,mediaType:d0,ssrcId:d0===dO.VIDEO?l0._videoSSRC:l0._audioSSRC,rtxSsrcId:d0===dO.VIDEO?l0._rtxSsrcId:void 0}}));const c0=new Map;if(a0=a0.filter(u0=>u0.video_ssrc&&!this._p2pChannel.isPreSubScribe(u0.video_ssrc)||u0.audio_ssrc&&!this._p2pChannel.isPreSubScribe(u0.audio_ssrc)||!u0.video_ssrc&&!u0.audio_ssrc),a0.length>0){const u0=await this._gateway.subscribeAll(a0,!0);((u0==null?void 0:u0.users)||[]).forEach(l0=>{let{stream_id:d0,video_error_code:h0,audio_error_code:p0,error_code:m0}=l0;(h0||p0||m0)&&c0.set(d0,{video_error_code:h0,audio_error_code:p0,error_code:m0})})}if(Array.from(c0.entries()).length>0){const u0=[];Array.from(c0.entries()).forEach(l0=>{let[d0,h0]=l0;const p0=this.remoteUsers.find(m0=>m0.uid===d0);if(p0){let m0;h0.error_code||h0.video_error_code&&h0.audio_error_code?m0=void 0:h0.video_error_code?m0=dO.VIDEO:h0.audio_error_code&&(m0=dO.AUDIO),u0.push({user:p0,mediaType:m0})}}),u0.length>0&&await this._p2pChannel.massUnsubscribeNoLock(u0)}for(const u0 of i0){const l0=c0.get(u0.user.uid);if(l0){const d0=l0.error_code||u0.mediaType==="audio"&&l0.audio_error_code||u0.mediaType==="video"&&l0.video_error_code;if(d0){const h0=NO(d0);fb.error("user:".concat(u0.user.uid," mediaType:").concat(u0.mediaType," has massSubscribe error ").concat(h0.desc)),u0.error=new yb(Ry.SUBSCRIBE_FAILED,"code ".concat(d0,": ").concat(h0.desc))}}u0.error||(u0.mediaType==="video"?u0.track=u0.user.videoTrack:u0.track=u0.user.audioTrack)}return this.store.massSubscribe(i0.filter(u0=>!u0.error).map(u0=>({userId:u0.user.uid,type:u0.mediaType})),void 0,Date.now()),i0.forEach(u0=>{var l0;vb.subscribe(this.store.sessionId,{succ:!!u0.error,ec:((l0=u0.error)===null||l0===void 0?void 0:l0.code)||null,video:u0.mediaType===dO.VIDEO,audio:u0.mediaType===dO.AUDIO,peerid:u0.user.uid,subscribeRequestid:u0.mediaType===dO.VIDEO?u0.user._videoSSRC:u0.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e0),preSsrc:this._p2pChannel.isPreSubScribe(u0.user._videoSSRC)},!0)}),fb.info("[".concat(this._clientId,"] massSubscribe success ").concat(t0.map(u0=>{let{user:l0,mediaType:d0}=u0;return"user: ".concat(l0==null?void 0:l0.uid,", mediaType: ").concat(d0)}).join("; "))),i0}catch(c0){throw await this._p2pChannel.massUnsubscribeNoLock(t0),c0}}finally{o0(),r0()}}async unsubscribe(t0,e0,n0){if(!(t0 instanceof cF)){const o0=this.remoteUsers.find(s0=>s0.uid===t0);if(!o0)throw new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");t0=o0}if(e0||this.store.useP2P){if(e0==="datachannel")return this._unsubscribeDataChannel(t0,n0)}else await this._unsubscribeDataChannel(t0,n0);if(e0&&vy(e0,"mediaType",["audio","video"]),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(o0=>o0===t0)){const o0=new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");throw fb.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t0.uid,", user is not in the channel")),o0}fb.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t0.uid,", mediaType: ").concat(e0));const i0=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof bF)await this._p2pChannel.unsubscribe(t0,e0);else{const o0=await this._p2pChannel.unsubscribe(t0,e0);o0&&await this._gateway.unsubscribe(o0,t0.uid),e0&&e0!=="audio"||(t0._audio_pre_subscribed=!1),e0&&e0!=="video"||(t0._video_pre_subscribed=!1),t0._is_pre_created&&nA(this._users,t0),fb.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t0.uid,", mediaType: ").concat(e0))}}catch(o0){if(o0.code===Ry.DISCONNECT_P2P)return void fb.warning("disconnecting p2p, abort unsubscribe request.");throw fb.error("[".concat(this._clientId,"] unsubscribe user ").concat(t0.uid," error"),o0.toString()),o0}finally{i0()}}async _unsubscribeDataChannel(t0,e0){if(e0&&yy(e0,"id",0,65535,!0),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i0=>i0===t0)){const i0=new yb(Ry.INVALID_REMOTE_USER,"user is not in the channel");throw fb.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t0.uid,", user is not in the channel")),i0}let r0;if(typeof e0=="number"){const i0=t0._dataChannels.find(o0=>o0.id===e0);i0&&(r0=[i0])}else r0=t0._dataChannels;if(r0===void 0){const i0=new yb(Ry.REMOTE_USER_IS_NOT_PUBLISHED);throw fb.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t0.uid," with channelId ").concat(e0,", remote datachannel is not published")),i0}fb.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t0.uid,", mediaType: datachannel, ids: ").concat(r0.map(i0=>i0.id)));try{const i0=await this._p2pChannel.unsubscribeDataChannel(t0,r0);i0&&await this._gateway.unsubscribeDataChannel(i0,t0.uid),fb.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t0.uid,", mediaType: datachannel, ids: ").concat(i0))}catch(i0){if(i0.code===Ry.DISCONNECT_P2P)return void fb.warning("disconnecting p2p, abort unsubscribe request.");throw fb.error("[".concat(this._clientId,"] unsubscribe user ").concat(t0.uid," error"),i0.toString()),i0}}async massUnsubscribe(t0){if(wy(t0,"unsubscribeList"),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");fb.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t0.map(n0=>{let{user:r0,mediaType:i0}=n0;return"user: ".concat(r0==null?void 0:r0.uid,", mediaType: ").concat(i0,";")}).join())),t0=[...t0];const e0=new Map;for(let n0=t0.length-1;n0>=0;n0--){const{user:r0,mediaType:i0}=t0[n0];if(!r0){const a0=new yb(Ry.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw fb.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),a0}if(vy(i0,"mediaType",["video","audio",void 0]),!this._users.find(a0=>a0===r0)){fb.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r0.uid,", user is not in the channel")),t0.splice(n0,1);continue}const s0=tO.Video|tO.LwoVideo;if(e0.has(r0)){const a0=e0.get(r0);let c0;switch(i0){case"video":c0=a0&s0;break;case"audio":c0=a0&tO.Audio;break;default:c0=a0&(tO.Audio|s0)}if(c0){fb.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r0.uid,",mediaType:").concat(i0," twice.")),t0.splice(n0,1);continue}i0?i0==="audio"?e0.set(r0,a0|tO.Audio):i0==="video"&&e0.set(r0,a0|s0):e0.set(r0,a0|tO.Audio|s0)}else i0?i0==="audio"?e0.set(r0,tO.Audio):i0==="video"&&e0.set(r0,s0):e0.set(r0,tO.Audio|s0)}try{const n0=await this._p2pChannel.massUnsubscribe(t0);n0&&await this._gateway.massUnsubscribe(n0),fb.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t0.map(r0=>{let{user:i0,mediaType:o0}=r0;return"user: ".concat(i0==null?void 0:i0.uid,", mediaType: ").concat(o0,";")}).join()))}catch(n0){if(n0.code===Ry.DISCONNECT_P2P)return void fb.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw fb.error("[".concat(this._clientId,"] massUnsubscribe error"),n0.toString()),n0}}async setLowStreamParameter(t0){(function(n0){if(!n0)throw new Cy(Ry.INVALID_PARAMS);Oy(n0.width)||Ay(n0.width,"streamParameter.width"),Oy(n0.height)||Ay(n0.height,"streamParameter.height"),Oy(n0.framerate)||Ay(n0.framerate,"streamParameter.framerate"),Oy(n0.bitrate)||yy(n0.bitrate,"streamParameter.bitrate")})(t0),(!t0.width&&t0.height||t0.width&&!t0.height)&&fb.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),fb.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t0));const e0=this._configDistribute.getLowStreamConfigDistribute();if(e0&&e0.bitrate&&t0.bitrate&&e0.bitrate<t0.bitrate&&(t0.bitrate=e0.bitrate),this._lowStreamParameter=t0,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t0,hO.LocalVideoLowTrack)}async enableDualStream(){if(!ZP().supportDualStream)throw vb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new yb(Ry.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new yb(Ry.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t0){throw vb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t0}this._isDualStreamEnabled=!0,vb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),fb.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(hO.LocalVideoLowTrack))try{const t0=await this._p2pChannel.unpublishLowStream();t0&&await this._gateway.unpublish(t0,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t0){throw vb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t0}this._isDualStreamEnabled=!1,vb.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),fb.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t0,e0){if(function(n0){vy(n0,"role",["audience","host"])}(t0),e0&&qy(e0),this.mode==="rtc"||this.mode==="p2p")throw fb.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new yb(Ry.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e0&&e0.level&&t0==="host")throw new yb(Ry.INVALID_OPERATION,"host mode can not set audience latency level");if(t0==="audience"&&this._p2pChannel.hasLocalMedia())throw new yb(Ry.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(t0,e0),this._config.role=t0,fb.info("[".concat(this._clientId,"] set client role to ").concat(t0,", level: ").concat(e0&&e0.level))}getRemoteInboundOffset(){var t0;const e0=(t0=this._p2pChannel.getStats())===null||t0===void 0?void 0:t0.audioSend[0];if(!e0||!e0.timestamp)return 0;const n0=e0.timestamp-Date.now();return Math.abs(n0)>1e3+e0.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n0:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t0,e0){if(by(t0,"proxyServer"),!e0){if(this.connectionState!=="DISCONNECTED")throw new yb(Ry.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new yb(Ry.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t0,vb.setProxyServer(this._proxyServer),fb.setProxyServer(this._proxyServer),fb.info("[".concat(this._clientId,"] Set proxy server ").concat(e0?"by initialize call":""," success."))}setTurnServer(t0,e0){if(Array.isArray(t0)||(t0=[t0]),!e0){if(this.connectionState!=="DISCONNECTED")throw new yb(Ry.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new yb(Ry.INVALID_OPERATION,"You have already set the proxy")}if(Ky(t0))return this._turnServer={servers:t0,mode:"original-manual"},void fb.info("[".concat(this._clientId,"] Set original turnserver ").concat(e0?"by initialize call":""," success: ").concat(t0.map(n0=>n0.urls).join(","),"."));t0.forEach(n0=>Yy(n0)),this._turnServer={servers:t0,mode:"manual"},fb.info("[".concat(this._clientId,"] Set turnserver ").concat(e0?"by initialize call":""," success."))}setLicense(t0){if(this.connectionState!=="DISCONNECTED")throw new yb(Ry.INVALID_OPERATION,"you should set license before join channel");if(by(t0,"license",32,32),!/^[A-Za-z\d]+$/.test(t0))throw new yb(Ry.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t0,fb.info("[".concat(this._clientId,"] set license success"),t0)}startProxyServer(t0){if(this.connectionState!=="DISCONNECTED")throw new yb(Ry.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new yb(Ry.INVALID_OPERATION,"You have already set the proxy");const e0=[3,4,5];let n0;switch(t0===void 0&&(t0=3),t0){case 1:case 2:throw new yb(Ry.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n0="proxy3";break;case 4:n0="proxy4";break;case 5:n0="proxy5";break;default:throw new yb(Ry.INVALID_PARAMS,"proxy server mode must be ".concat(e0.join("|")))}this._cloudProxyServerMode=n0,this.store.cloudProxyServerMode=n0,fb.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new yb(Ry.INVALID_OPERATION,"Stop proxy server after leave channel");vb.setProxyServer(),fb.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",fb.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t0){if(!t0.accessPoints)throw new yb(Ry.INVALID_PARAMS,"accessPoints is required.");wy(t0.accessPoints.serverList,"accessPoints.serverList"),by(t0.accessPoints.domain,"accessPoints.domain");const e0=(h0,p0)=>{yy(h0,p0,0,65535,!0)};let n0=443;if(t0.accessPoints.port&&(e0(t0.accessPoints.port,"accessPoints.port"),n0=t0.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new yb(Ry.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");XA("CLOSE_AFB_FOR_LOCAL_AP")&&(JA("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),JA("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r0=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i0=t0.accessPoints.domain,o0=t0.accessPoints.serverList.map(h0=>r0.test(h0)?"".concat(h0.replace(/\./g,"-"),".").concat(i0):h0),s0=o0.map(h0=>"".concat(h0,":").concat(n0));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,JA("WEBCS_DOMAIN",s0),JA("WEBCS_DOMAIN_BACKUP_LIST",s0),JA("GATEWAY_DOMAINS",[i0]),t0.report&&t0.report.hostname&&Array.isArray(t0.report.hostname)&&t0.report.hostname.length?(wy(t0.report.hostname,"report.hostname"),JA("EVENT_REPORT_DOMAIN",t0.report.hostname[0]),JA("EVENT_REPORT_BACKUP_DOMAIN",t0.report.hostname[1]||t0.report.hostname[0])):(JA("EVENT_REPORT_DOMAIN",o0[0]),JA("EVENT_REPORT_BACKUP_DOMAIN",o0[1]||o0[0]));let a0=6443;t0.report&&t0.report.port&&(e0(t0.report.port,"report.port"),a0=t0.report.port),JA("STATS_COLLECTOR_PORT",a0),t0.report?JA("ENABLE_EVENT_REPORT",!0):JA("ENABLE_EVENT_REPORT",!1);let c0="";t0.log&&t0.log.hostname&&Array.isArray(t0.log.hostname)&&t0.log.hostname.length?(wy(t0.log.hostname,"log.hostname"),c0=t0.log.hostname[0]):c0=o0[0];let u0=6444;t0.log&&t0.log.port&&(e0(t0.log.port,"log.port"),u0=t0.log.port),JA("LOG_UPLOAD_SERVER","".concat(c0,":").concat(u0));let l0=[];t0.cds&&t0.cds.hostname&&Array.isArray(t0.cds.hostname)&&t0.cds.hostname.length?(wy(t0.cds.hostname,"cds.hostname"),l0=t0.cds.hostname):l0=o0;let d0=443;t0.cds&&t0.cds.port&&(e0(t0.cds.port,"cds.port"),d0=t0.cds.port),JA("CDS_AP",l0.map(h0=>"".concat(h0,":").concat(d0))),t0.cds?JA("ENABLE_CONFIG_DISTRIBUTE",!0):JA("ENABLE_CONFIG_DISTRIBUTE",!1),fb.info("set local access point v2 success")}setLocalAccessPoints(t0,e0){if(wy(t0,"serverList"),by(e0,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new yb(Ry.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n0=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t0=t0.map(r0=>n0.test(r0)?"".concat(r0.replace(/\./g,"-"),".").concat(e0):r0),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,JA("WEBCS_DOMAIN",t0),JA("WEBCS_DOMAIN_BACKUP_LIST",t0),JA("GATEWAY_DOMAINS",[e0]),JA("EVENT_REPORT_DOMAIN",t0[0]),JA("EVENT_REPORT_BACKUP_DOMAIN",t0[1]||t0[0]),JA("LOG_UPLOAD_SERVER","".concat(t0[0],":6444")),fb.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t0){if(vy(t0,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t0,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t0),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e0){throw fb.error("[".concat(this._clientId,"] set default remote video stream type error"),e0.toString()),e0}else fb.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t0))}async setRemoteVideoStreamType(t0,e0){vy(e0,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t0,e0),setTimeout(()=>{const n0=this._users.find(r0=>r0.uid===t0);n0&&n0.videoTrack&&n0.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n0){throw fb.error("[".concat(this._clientId,"] set remote video stream type error"),n0.toString()),n0}fb.info("[".concat(this._clientId,"] set remote ").concat(t0," video stream type to ").concat(e0)),this._remoteStreamTypeCacheMap.set(t0,e0)}async setStreamFallbackOption(t0,e0){vy(e0,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t0,e0)}catch(n0){throw fb.error("[".concat(this._clientId,"] set stream fallback option"),n0.toString()),n0}fb.info("[".concat(this._clientId,"] set remote ").concat(t0," stream fallback type to ").concat(e0)),this._streamFallbackTypeCacheMap.set(t0,e0)}setEncryptionConfig(t0,e0,n0,r0){(function(o0){vy(o0,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t0),by(e0,"secret");const i0=["aes-128-gcm2","aes-256-gcm2"];if(Dn(i0).call(i0,t0)){if(!n0||!(n0 instanceof Uint8Array&&n0.length===32))throw new yb(Ry.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n0)throw new yb(Ry.INVALID_PARAMS,"current encrypt mode does not need salt");if(r0){if(Iy(r0,"encryptDataStream"),!Dn(i0).call(i0,t0))throw new yb(Ry.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e0)||fb.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t0,this._encryptionSecret=e0,n0&&(this._encryptionSalt=uA(n0))}async renewToken(t0){if(by(t0,"token",1,2047),!this._key||!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"renewToken should not be called before user join");const e0=this._key;this._key=t0,this._joinInfo&&(this._joinInfo.token=t0);const n0=await this._renewTokenMutex.lock();try{if(XA("USE_NEW_TOKEN")){fb.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r0=await Zx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||PA);fb.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t0,ticket:r0})}else fb.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t0});fb.debug("[".concat(this._clientId,"] renewToken success"))}catch(r0){throw this._key=e0,this._joinInfo.token=e0,fb.error("[".concat(this._clientId,"] renewToken failed"),r0.toString()),r0}finally{n0()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?fb.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t0=this._p2pChannel.getAudioLevels();this.safeEmit(zy.VOLUME_INDICATOR,t0)},XA("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t0=this._statsCollector.getRTCStats(),e0=this._gateway.getInChannelInfo();return t0.Duration=Math.round(e0.duration/1e3),t0}async startLiveStreaming(t0,e0){if(!e0){if(this.codec!=="h264")throw new yb(Ry.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new yb(Ry.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t0)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t0))throw new yb(Ry.LIVE_STREAMING_TASK_CONFLICT);const n0=e0?Fw.TRANSCODE:Fw.RAW;return this._createLiveStreamingClient(n0).startLiveStreamingTask(t0,n0)}setLiveTranscoding(t0){return this._createLiveStreamingClient(Fw.TRANSCODE).setTranscodingConfig(t0)}async stopLiveStreaming(t0){const e0=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n0=>n0&&n0.hasUrl(t0));if(!e0.length)throw new yb(Ry.INVALID_PARAMS,"can not find live streaming url to stop");await Gh.all(e0.map(n0=>n0&&n0.stopLiveStreamingTask(t0)))}async startChannelMediaRelay(t0){LF(t0),await this._createChannelMediaRelayClient().startChannelMediaRelay(t0)}async updateChannelMediaRelay(t0){LF(t0),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t0)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(t0){var e0;let n0=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t0=="string"||t0 instanceof Uint8Array)&&(t0={payload:t0}),typeof t0.payload=="string"){const i0=new TextEncoder;t0.payload=i0.encode(t0.payload)}let r0=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dn(e0=["aes-128-gcm2","aes-256-gcm2"]).call(e0,this._encryptionMode)&&(r0=!0,t0.payload=await async function(i0,o0,s0){var a0;const c0=Jn(a0=Array.from(s0)).call(a0,(f0,g0)=>f0+g0,0),u0={serverTs:0,seq:ob++,length:s0.length,checkSum:c0},l0=new Uint8Array(yA(c0,2)),d0=new ArrayBuffer(rb),h0=new DataView(d0);h0.setUint32(0,u0.serverTs),h0.setUint16(4,u0.seq),h0.setUint16(6,u0.length),h0.setUint16(8,u0.checkSum);const p0=16-s0.length%16;s0=pA(s0,new Uint8Array(p0));const m0=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i0,tagLength:tb,additionalData:l0},o0,s0);return pA(new Uint8Array(d0),new Uint8Array(m0))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t0.payload)),new Blob([t0.payload]).size>1024)throw new yb(Ry.INVALID_PARAMS,r0?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Pw.DATA_STREAM,{payload:uA(t0.payload),syncWithAudio:t0.syncWithAudio,sendTs:Date.now()-vB},!n0)}sendMetadata(t0){if(!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t0]).size>1024)throw new yb(Ry.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Pw.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:uA(t0)})}async sendCustomReportMessage(t0){if(Array.isArray(t0)||(t0=[t0]),t0.forEach(Tb),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"can not send custom report, not joined");await vb.sendCustomReportMessage(this._joinInfo.sid,t0)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t0,e0){vy(e0.spatialLayer,"spatialLayer",[0,1,2,3]),vy(e0.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t0,e0)}catch(n0){throw fb.error("[".concat(this._clientId,"] pick SVC layer failed"),n0.toString()),n0}}async setRTMConfig(t0){const{apRTM:e0=!1,rtmFlag:n0}=t0;if(Iy(e0,"apRTM"),yy(n0,"rtmFlag",0),this._rtmConfig.apRTM=e0,this._rtmConfig.rtmFlag=n0,fb.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t0)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e0,this._joinInfo.rtmFlag=n0,this._gateway.setRTM2Flag(n0)}_reset(){if(fb.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Lv.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&JB(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&vb.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t0=>{t0._audioTrack&&t0._audioTrack._destroy(),t0._videoTrack&&t0._videoTrack._destroy(),t0._dataChannels&&(t0._dataChannels.forEach(e0=>e0._close()),t0._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new NA("client-publish"),this._subscribeMutex=new NA("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t0,e0){var n0;const r0=t0||SA();t0?fb.debug("[".concat(this._clientId,"] new Session ").concat(r0)):fb.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r0));const i0=t0?"":this._sessionId||"";this._sessionId=r0,this.store.sessionId=r0,vb.addSid(r0);const o0={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:(e0==null?void 0:e0.stringUid)||((n0=this._joinInfo)===null||n0===void 0?void 0:n0.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i0,clientRole:this.role==="audience"?2:1};vb.sessionInit(this._sessionId,IG({cname:e0.channel,appid:e0.appId},o0)),this._joinInfo&&(this._joinInfo.sid=r0),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r0)}async _publishHighStream(t0){if(!this._joinInfo||this._uid===void 0)throw new yb(Ry.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&XA("FORCE_TURN")&&!XA("TURN_ENABLE_TCP")&&!XA("TURN_ENABLE_UDP"))throw new yb(Ry.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");fb.debug("[".concat(this._clientId,"] publish high stream"));try{const n0=await this._p2pChannel.publish(t0,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof bF){const r0=(await n0.next()).value;if(r0){try{await this._gateway.sendExtensionMessage(IO.PUBLISH,r0,!0)}catch(i0){throw n0.throw(i0),i0}await n0.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r0=(await n0.next()).value;if(r0){var e0;let i0;try{i0=await this._gateway.publish(this._uid,r0,!0)}catch(o0){if(o0.code!==Ry.DISCONNECT_P2P)throw n0.throw(o0),o0}await n0.next(((e0=i0)===null||e0===void 0?void 0:e0.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i0 of t0)i0 instanceof aU&&i0._encoderConfig&&this._gateway.setVideoProfile(i0._encoderConfig),!i0.muted&&i0.enabled||await this._p2pChannel.muteLocalTrack(i0)}}catch(n0){if(this._p2pChannel.reportPublishEvent(!1,n0==null?void 0:n0.code,t0),(n0==null?void 0:n0.code)===Ry.WS_ABORT)return;throw n0}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new yb(Ry.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new yb(Ry.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));fb.debug("[".concat(this._clientId,"] publish low stream"));const t0=this._configDistribute.getLowStreamConfigDistribute();t0&&t0.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t0.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t0.bitrate));try{const n0=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r0=(await n0.next()).value;if(r0){var e0;let i0;try{i0=await this._gateway.publish(this._uid,r0,!0)}catch(o0){if(o0.code!==Ry.DISCONNECT_P2P)throw n0.throw(o0),o0}n0.next(((e0=i0)===null||e0===void 0?void 0:e0.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n0){if(this._p2pChannel.reportPublishEvent(!1,n0==null?void 0:n0.code,void 0,!0),(n0==null?void 0:n0.code)===Ry.WS_ABORT)return;throw n0}}_createLiveStreamingClient(t0){const e0=()=>{if(!this._joinInfo||!this._appId)return new yb(Ry.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n0=(r0={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},gB("LiveStreaming").create(r0));var r0;return n0.onLiveStreamError=(i0,o0)=>{vb.reportApiInvoke(this._sessionId,{name:By.ON_LIVE_STREAM_ERROR,options:[i0,o0],tag:jy.TRACER}).onSuccess(),this.safeEmit(zy.LIVE_STREAMING_ERROR,i0,o0)},n0.onLiveStreamWarning=(i0,o0)=>{vb.reportApiInvoke(this._sessionId,{name:By.ON_LIVE_STREAM_WARNING,options:[i0,o0],tag:jy.TRACER}).onSuccess(),this.safeEmit(zy.LIVE_STREAMING_WARNING,i0,o0)},n0.on(Kw.REQUEST_WORKER_MANAGER_LIST,(i0,o0,s0)=>{if(!this._joinInfo)return s0(new yb(Ry.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(a0,c0,u0,l0){const d0=XA("UAP_AP").slice(0,XA("AJAX_REQUEST_CONCURRENT")).map(h0=>c0.proxyServer?"https://".concat(c0.proxyServer,"/ap/?url=").concat(h0+"/api/v1?action=uap"):"https://".concat(h0,"/api/v1?action=uap"));return await Dx(d0,a0,c0,u0,l0)})(i0,this._joinInfo,this._axiosCancelSource.token,PA).then(o0).catch(s0)}),n0};return t0===Fw.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e0(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e0(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new yb(Ry.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e0,sendResolutionHeight:n0}=this.getLocalVideoStats(),r0=(t0={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e0,height:n0}},gB("ChannelMediaRelay").create(t0));r0.on("state",i0=>{i0===Xw.RELAY_STATE_FAILURE&&r0&&r0.dispose(),this.safeEmit(zy.CHANNEL_MEDIA_RELAY_STATE,i0)}),r0.on("event",i0=>{this.safeEmit(zy.CHANNEL_MEDIA_RELAY_EVENT,i0)}),this._channelMediaRelayClient=r0,this._statsCollector.onStatsChanged=(i0,o0)=>{var s0;i0==="resolution"&&((s0=this._channelMediaRelayClient)===null||s0===void 0||s0.setVideoProfile(o0))}}var t0;return this._channelMediaRelayClient}_handleUpdateDataChannel(t0,e0){const{added:n0,deleted:r0}=t0,i0=[];if(e0){const o0=[];this._users.forEach(s0=>{s0._dataChannels.forEach(a0=>{n0.every(c0=>c0.uid!==s0._uintid||c0.stream_id!==a0.id)&&o0.push({uid:s0._uintid,stream_id:a0.id,ordered:a0.ordered,max_retrans_times:a0.maxRetransmits,metadata:a0.metadata})})}),o0.length>0&&this._handleUpdateDataChannel({added:[],deleted:o0})}Array.isArray(n0)&&n0.length>0&&n0.forEach(o0=>{const{uid:s0,stream_id:a0,ordered:c0,max_retrans_times:u0,metadata:l0}=o0,d0=this._users.find(h0=>h0._uintid===s0);if(!d0)return void fb.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(fb.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(s0)),Dn(i0).call(i0,d0)||i0.push(d0),d0._uintid||(d0._uintid=s0),d0._dataChannels.findIndex(h0=>h0.id===o0.stream_id)===-1){const h0={id:a0,ordered:!!c0,maxRetransmits:u0,metadata:l0},p0=function(m0){return RB(m0,!0)}(h0);d0._dataChannels.push(p0),fb.info("[".concat(this._clientId,"] remote user ").concat(d0.uid," published datachannel")),e0||this.safeEmit(zy.USER_PUBLISHED,d0,"datachannel",h0)}this._p2pChannel.hasPendingRemoteDataChannel(d0,o0.stream_id)&&(fb.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(d0.uid," after reconnect.")),this._subscribeDataChannel(d0,o0.stream_id).catch(h0=>{fb.error("[".concat(this._clientId,"] resubscribe datachannel error"),h0.toString())}))}),e0&&(this.safeEmit(zy.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r0)&&r0.length>0&&r0.forEach(o0=>{const{uid:s0,stream_id:a0}=o0,c0=this._users.find(l0=>l0._uintid===s0);if(!c0)return void fb.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const u0=c0._dataChannels.find(l0=>l0.id===o0.stream_id);u0&&(fb.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(s0)),this._p2pChannel.unsubscribeDataChannel(c0,[u0]).then(l0=>{if(c0._dataChannels=c0._dataChannels.filter(d0=>d0!==u0),l0)return this._gateway.unsubscribeDataChannel(l0,c0.uid)}),fb.info("[".concat(this._clientId,"] remote user ").concat(s0," unpublished datachannel ,id:").concat(u0.id)),this.safeEmit(zy.USER_UNPUBLISHED,c0,"datachannel",u0._config))})}_handleRemoveDataChannels(t0){const e0=this._users.find(n0=>n0.uid===t0.uid);if(e0){if(e0._dataChannels!==void 0&&e0._dataChannels.length>0){fb.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t0.uid));const n0=()=>{fb.info("[".concat(this._clientId,"] remote user ").concat(e0.uid," unpublished datachannel")),e0._dataChannels.forEach(r0=>{this.safeEmit(zy.USER_UNPUBLISHED,e0,"datachannel",r0._config)})};this._p2pChannel.unsubscribeDataChannel(e0,e0._dataChannels).then(r0=>{if(r0)return this._gateway.unsubscribeDataChannel(r0,e0.uid)}),n0()}}else fb.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on($w.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on($w.CONNECTION_STATE_CHANGE,(t0,e0,n0)=>{var r0;if(n0===Hy.FALLBACK)return;const i0=()=>{this.safeEmit(zy.CONNECTION_STATE_CHANGE,t0,e0,n0)};if(vb.reportApiInvoke(this._sessionId||((r0=this._gateway.joinInfo)===null||r0===void 0?void 0:r0.sid)||null,{name:By.CONNECTION_STATE_CHANGE,options:[t0,e0,n0],tag:jy.TRACER}).onSuccess(JSON.stringify({cur:t0,prev:e0,reason:n0})),fb.info("[".concat(this._clientId,"] connection state change: ").concat(e0," -> ").concat(t0)),t0==="DISCONNECTED")return this._reset(),void i0();if(t0==="RECONNECTING")this._users.forEach(s0=>{s0._trust_in_room_=!1,s0._trust_audio_enabled_state_=!1,s0._trust_video_enabled_state_=!1,s0._trust_audio_mute_state_=!1,s0._trust_video_mute_state_=!1,s0._trust_audio_stream_added_state_=!1,s0._trust_video_stream_added_state_=!1,s0._is_pre_created||(s0._audio_pre_subscribed||(s0._audioSSRC=void 0,s0._audioOrtc=void 0),s0._video_pre_subscribed||(s0._videoSSRC=void 0,s0._videoOrtc=void 0,s0._rtxSsrcId=void 0),s0._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t0==="CONNECTED"){var o0;this._streamFallbackTypeCacheMap.forEach((s0,a0)=>{this._gateway.setStreamFallbackOption(a0,s0).catch(c0=>{fb.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),c0)})}),this._remoteStreamTypeCacheMap.forEach((s0,a0)=>{this._gateway.setRemoteVideoStreamType(a0,s0).catch(c0=>{fb.warning("[".concat(this._clientId,"] auto set remote stream type failed"),c0)})}),this._remoteDefaultVideoStreamType!==void 0&&((o0=this._joinInfo)===null||o0===void 0?void 0:o0.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{fb.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(s0=>{fb.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(s0))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(s0=>!s0._trust_in_room_).forEach(s0=>{fb.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(s0.uid)),this._handleUserOffline({uid:s0.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(s0=>{s0._trust_audio_mute_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(s0.uid)),this._handleMuteStream(s0.uid,dO.AUDIO,!1)),s0._trust_video_mute_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(s0.uid)),this._handleMuteStream(s0.uid,dO.VIDEO,!1)),s0._trust_audio_enabled_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(s0.uid)),this._handleSetStreamLocalEnable("audio",s0.uid,!0)),s0._trust_video_enabled_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(s0.uid)),this._handleSetStreamLocalEnable("video",s0.uid,!0)),s0._trust_video_stream_added_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(s0.uid)),this._handleResetAddStream(s0,"video")),s0._trust_audio_stream_added_state_||(fb.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(s0.uid)),this._handleResetAddStream(s0,"audio")),s0._video_added_||s0._audio_added_||(fb.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(s0.uid)),this._handleRemoveStream({uid:s0.uid,uint_id:s0._uintid}))}))},1e3))}i0()}),this._gateway.on($w.REQUEST_NEW_GATEWAY_LIST,async(t0,e0)=>{if(!this._joinInfo)return e0(new yb(Ry.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n0;const r0=await YB(IG(IG({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r0?(n0=r0.ap,XB(r0),this._joinInfo.preload=!0):(n0=await Hx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||PA,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n0.gatewayInfo.res,this._joinInfo.gatewayAddrs=n0.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n0.gatewayInfo.uni_lbs_ip);const i0=[];n0.gatewayInfo.gatewayAddrs.forEach(o0=>{let{address:s0}=o0;const[a0,c0]=s0.split(":");this._joinInfo&&this._joinInfo.proxyServer?i0.push({proxy:this._joinInfo.proxyServer,host:a0,port:c0}):i0.push({host:a0,port:c0})}),t0(i0)}catch(n0){e0(n0)}}),this._gateway.on($w.NETWORK_QUALITY,t0=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(zy.NETWORK_QUALITY,t0)}),this._gateway.on($w.STREAM_TYPE_CHANGE,(t0,e0)=>{this.safeEmit(zy.STREAM_TYPE_CHANGED,t0,e0),vb.reportApiInvoke(this._sessionId,{name:By.STREAM_TYPE_CHANGE,options:[t0,e0],tag:jy.TRACER}).onSuccess(JSON.stringify({uid:t0,streamType:e0}))}),this._gateway.on($w.IS_P2P_DISCONNECTED,t0=>{this._p2pChannel.isP2PDisconnected()?t0(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t0(!1):t0(!0)}),this._gateway.on($w.REQUEST_P2P_CONNECTION_PARAMS,async(t0,e0,n0)=>{try{let r0=await this._p2pChannel.getEstablishParams();XA("ENABLE_PREALLOC_PC")&&r0||(r0=await this._p2pChannel.startP2PConnection(t0)),e0(r0)}catch(r0){n0(r0)}}),this._gateway.on($w.JOIN_RESPONSE,(t0,e0)=>{if(this.store.useP2P)return;const n0=YU(t0.ortc,e0,t0.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(n0)}),this._gateway.on($w.PRE_CONNECT_PC,async t0=>{const{candidates:e0,fingerprint:n0}=t0;if(this._joinInfo&&e0.length>0&&!this._p2pChannel.isPlanB){var r0;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:i0,cid:o0}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o0,"_").concat(i0),icePwd:"".concat(o0,"_").concat(i0)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r0=XA("FINGERPRINT"))!==null&&r0!==void 0?r0:n0}]},candidates:e0,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(kw.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(kw.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(kw.ON_ADD_AUDIO_STREAM,t0=>this._handleAddAudioOrVideoStream("audio",t0.uid,t0.ssrcId,t0.cname,t0.uint_id,t0.ortc)),this._gateway.signal.on(kw.ON_ADD_VIDEO_STREAM,t0=>this._handleAddAudioOrVideoStream("video",t0.uid,t0.ssrcId,t0.cname,t0.uint_id,t0.ortc,t0.rtxSsrcId)),this._gateway.signal.on(kw.ON_REMOTE_DATASTREAM_UPDATE,t0=>{this._handleUpdateDataChannel(t0)}),this._gateway.signal.on(kw.ON_REMOTE_FULL_DATASTREAM_INFO,t0=>{this._handleUpdateDataChannel({added:t0.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(kw.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(kw.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(kw.MUTE_AUDIO,t0=>this._handleMuteStream(t0.uid,dO.AUDIO,!0)),this._gateway.signal.on(kw.UNMUTE_AUDIO,t0=>this._handleMuteStream(t0.uid,dO.AUDIO,!1)),this._gateway.signal.on(kw.MUTE_VIDEO,t0=>this._handleMuteStream(t0.uid,dO.VIDEO,!0)),this._gateway.signal.on(kw.UNMUTE_VIDEO,t0=>this._handleMuteStream(t0.uid,dO.VIDEO,!1)),this._gateway.signal.on(kw.RECEIVE_METADATA,t0=>{const e0=lA(t0.metadata);this.safeEmit(zy.RECEIVE_METADATA,t0.uid,e0)}),this._gateway.signal.on(kw.ON_DATA_STREAM,async t0=>{var e0;if(!t0)return;let n0=lA(t0.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Dn(e0=["aes-128-gcm2","aes-256-gcm2"]).call(e0,this._encryptionMode)){if(t0.payload.length<rb)throw new yb(Ry.UNEXPECTED_RESPONSE,"payload length ".concat(t0.payload.length," is less than header length ").concat(rb));n0=await async function(o0,s0,a0){const c0=a0.subarray(0,rb),u0=c0.slice(8,rb),l0=(u0[0]<<8)+u0[1],d0=(c0[6]<<8)+c0[7],h0=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o0,tagLength:tb,additionalData:new Uint8Array(yA(l0,2))},s0,a0.subarray(rb));return new Uint8Array(h0).subarray(0,d0)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n0)}let r0=0;if(t0.ordered||t0.syncWithAudio){const i0=this._p2pChannel.getStats(),o0=this.remoteUsers.find(a0=>a0.uid===t0.uid),s0=i0==null?void 0:i0.audioRecv.find(a0=>a0.ssrc===(o0==null?void 0:o0._audioSSRC));r0=s0==null?void 0:s0.jitterBufferMs}r0==null&&(r0=0),NB(IG(IG({},t0),{},{payload:n0}),r0,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(kw.ON_CRYPT_ERROR,()=>{dA(()=>{fb.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(zy.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(kw.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(kw.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{fb.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Hy.TOKEN_EXPIRE),this.safeEmit(zy.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(kw.ON_STREAM_FALLBACK_UPDATE,t0=>{fb.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t0.stream_id,", attr: ").concat(t0.stream_type)),this.safeEmit(zy.STREAM_FALLBACK,t0.stream_id,t0.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(kw.ON_PUBLISH_STREAM,t0=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t0.proxy})),fb.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t0))))}),this._gateway.signal.on(kw.ENABLE_LOCAL_VIDEO,t0=>{this._handleSetStreamLocalEnable("video",t0.uid,!0)}),this._gateway.signal.on(kw.DISABLE_LOCAL_VIDEO,t0=>{this._handleSetStreamLocalEnable("video",t0.uid,!1)}),this._gateway.signal.on(Dw.REQUEST_TIMEOUT,(t0,e0)=>{if(this._joinInfo)switch(t0){case Pw.PUBLISH:{if(!e0)return;const i0=e0.ortc;if(i0){var n0,r0;const o0=i0.some(c0=>{let{stream_type:u0}=c0;return u0===Zw.Audio}),s0=i0.some(c0=>{let{stream_type:u0}=c0;return u0!==Zw.Audio}),a0=i0.some(c0=>{let{stream_type:u0}=c0;return u0===Zw.Screen||u0===Zw.ScreenLow});e0.state==="offer"&&vb.publish(this._joinInfo.sid,{eventElapse:rV.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Ry.TIMEOUT,audio:o0,video:s0,p2pid:e0.p2p_id,publishRequestid:this.store.pubId,screenshare:a0,audioName:o0?(n0=i0.find(c0=>{let{stream_type:u0}=c0;return u0===Zw.Audio}))===null||n0===void 0||(n0=n0.ssrcs[0])===null||n0===void 0?void 0:n0.ssrcId.toString():void 0,videoName:s0?(r0=i0.find(c0=>{let{stream_type:u0}=c0;return u0!==Zw.Audio}))===null||r0===void 0||(r0=r0.ssrcs[0])===null||r0===void 0?void 0:r0.ssrcId.toString():void 0})}break}case Pw.SUBSCRIBE:e0&&vb.subscribe(this._joinInfo.sid,{succ:!1,ec:Ry.TIMEOUT,audio:e0.stream_type===dO.AUDIO,video:e0.stream_type===dO.VIDEO,peerid:e0.stream_id,subscribeRequestid:e0.ssrcId,p2pid:this.store.p2pId,eventElapse:rV.measureFromSubscribeStart(this.store.clientId,e0.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e0.ssrcId)})}}),this._gateway.signal.on(kw.ON_P2P_OK,t0=>{this.uid,this._uid}),this._gateway.signal.on(kw.ON_PUBLISHED_USER_LIST,t0=>{if(t0==null||!t0.users)return;XA("BLOCK_LOCAL_CLIENT")&&(t0.users=t0.users.filter(r0=>!Ob(r0.string_id||r0.stream_id,this.channelName)));const e0=[],n0=[];for(const r0 of t0.users){let i0=this._users.find(l0=>l0._uintid===r0.stream_id);i0?i0._trust_in_room_=!0:(i0=new cF(r0.string_id||r0.stream_id,r0.stream_id),this._users.push(i0),this.getListeners(zy.PUBLISHED_USER_LIST).length===0&&(fb.debug("[".concat(this._clientId,"] user online"),r0.stream_id),this.safeEmit(zy.USER_JOINED,i0)));const o0=tO.Audio&r0.stream_type,s0=(tO.Video|tO.LwoVideo)&r0.stream_type,a0=(65280&r0.stream_type)!=0,c0=o0&&i0.hasAudio,u0=s0&&i0.hasVideo;s0&&(i0._trust_video_stream_added_state_=!0,i0._video_added_=!0,i0._videoSSRC=r0.video_ssrc,i0._rtxSsrcId=r0.video_rtx),o0&&(i0._trust_audio_stream_added_state_=!0,i0._audio_added_=!0,i0._audioSSRC=r0.audio_ssrc),o0&&!c0&&this.getListeners(zy.PUBLISHED_USER_LIST).length===0&&(fb.info("[".concat(this._clientId,"] remote user ").concat(i0.uid," published audio")),this.safeEmit(zy.USER_PUBLISHED,i0,"audio")),s0&&!u0&&this.getListeners(zy.PUBLISHED_USER_LIST).length===0&&(fb.info("[".concat(this._clientId,"] remote user ").concat(i0.uid," published video")),this.safeEmit(zy.USER_PUBLISHED,i0,"video")),(o0&&!c0||s0&&!u0||a0)&&e0.push(i0),s0&&this._p2pChannel.hasPendingRemoteMedia(i0,"video")&&n0.push({user:i0,mediaType:"video"}),o0&&this._p2pChannel.hasPendingRemoteMedia(i0,"audio")&&n0.push({user:i0,mediaType:"audio"})}n0.length>0&&(fb.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n0.map(r0=>"user: ".concat(r0.user.uid,", mediaType: ").concat(r0.mediaType)).join("; ")," ")),this.massSubscribe(n0).catch(r0=>{fb.error("[".concat(this._clientId,"] mass resubscribe error"),r0.toString())})),this.getListeners(zy.PUBLISHED_USER_LIST).length>0?XA("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e0:(fb.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e0.map(r0=>r0.uid).join(", "))),this.safeEmit(zy.PUBLISHED_USER_LIST,e0)):fb.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e0.map(r0=>r0.uid).join(", ")))}),this._gateway.signal.on(kw.ON_RTP_CAPABILITY_CHANGE,t0=>{const{video_codec:e0}=t0;this._p2pChannel instanceof fB&&this._p2pChannel.updateRemoteRTPCapabilities(e0.map(n0=>n0.toLowerCase()).filter(n0=>{var r0;return Dn(r0=Object.keys(eb)).call(r0,n0)}))})}_handleP2PEvents(){this._gateway.signal.on(kw.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(IO.PUBLISH,(t0,e0,n0)=>{const{uid:r0}=t0;t0.forEach(i0=>{const{kind:o0,ssrcs:s0,mid:a0,isMuted:c0}=i0;this._handleP2PAddAudioOrVideoStream(o0,r0,s0[0].ssrcId,a0);const u0=this._users.find(l0=>l0.uid===r0);return u0&&this._p2pChannel instanceof bF?this._p2pChannel.mockSubscribe(u0,o0,s0[0].ssrcId,a0).then(()=>{e0()}).catch(n0):e0(),this._handleMuteStream(r0,o0,!!c0)})}),this._gateway.signal.on(IO.CALL,async(t0,e0,n0)=>{if(this._p2pChannel instanceof bF)try{var r0;e0(await this._p2pChannel.startP2P({turnServer:(r0=this._joinInfo)===null||r0===void 0?void 0:r0.turnServer},t0))}catch(i0){n0(i0)}}),this._gateway.signal.on(Dw.P2P_CONNECTION,async t0=>{this._p2pChannel instanceof bF&&await this._p2pChannel.p2pConnect(t0)}),this._gateway.signal.on(IO.UNPUBLISH,async(t0,e0,n0)=>{if(this._p2pChannel instanceof bF){const{unpubMsg:r0,uid:i0}=t0,o0=this._users.find(s0=>s0.uid===i0);if(!o0)return fb.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i0)),void e0();try{r0.forEach(async s0=>{let{stream_type:a0}=s0;const c0=a0===Zw.Audio?dO.AUDIO:dO.VIDEO;await this._p2pChannel.unsubscribe(o0,c0),this._handleMuteStream(i0,c0,!0)}),e0()}catch(s0){n0(s0)}}}),this._gateway.signal.on(IO.CONTROL,async(t0,e0)=>{const{action:n0}=t0;switch(n0){case yO.MUTE_LOCAL_VIDEO:this._handleMuteStream(e0,dO.VIDEO,!0);break;case yO.MUTE_LOCAL_AUDIO:this._handleMuteStream(e0,dO.AUDIO,!0);break;case yO.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e0),this._handleMuteStream(e0,dO.VIDEO,!1);break;case yO.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e0),this._handleMuteStream(e0,dO.AUDIO,!1)}}),this._gateway.signal.on(IO.RESTART_ICE,async(t0,e0,n0)=>{if(this._p2pChannel instanceof bF)try{const{direction:r0,iceParameter:i0}=t0;r0!==Mw.SEND_ONLY||i0?e0(await this._p2pChannel.restartICE(r0,i0)):(this._p2pChannel.handleDisconnect(r0),e0())}catch(r0){n0(r0)}}),this._gateway.signal.on(IO.CANDIDATE,t0=>{if(this._p2pChannel instanceof bF){const{candidate:e0,direction:n0}=t0;this._p2pChannel.addRemoteCandidate(e0,n0)}}),this._p2pChannel.on(_O.RequestP2PRestartICE,async(t0,e0,n0)=>{try{const{direction:r0}=t0;e0(await this._gateway.sendExtensionMessage(IO.RESTART_ICE,t0,r0===Mw.SEND_ONLY))}catch(r0){n0(r0)}}),this._p2pChannel.on(_O.LocalCandidate,t0=>{this._gateway.sendExtensionMessage(IO.CANDIDATE,JSON.stringify(t0),!0)}),this._p2pChannel.on(_O.RequestP2PMuteLocal,async(t0,e0,n0)=>{try{await this._gateway.sendExtensionMessage(IO.CONTROL,t0,!0),e0()}catch(r0){n0(r0)}}),this._p2pChannel.on(_O.RequestP2PUnmuteRemote,async(t0,e0,n0)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t0,this._joinInfo.stringUid||this._joinInfo.uid),e0()}catch(r0){r0.code===Ry.DISCONNECT_P2P?e0():n0(r0)}else e0()}),this._p2pChannel.on(_O.RequestP2PMuteRemote,async(t0,e0,n0)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t0,this._joinInfo.stringUid||this._joinInfo.uid),e0()}catch(r0){r0.code===Ry.DISCONNECT_P2P?e0():n0(r0)}else e0()}),this._p2pChannel.on(_O.StateChange,(t0,e0)=>{e0===pO.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(_O.RequestMuteLocal,async(t0,e0,n0)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t0,this._joinInfo.stringUid||this._joinInfo.uid),e0()}catch(r0){r0.code===Ry.DISCONNECT_P2P?e0():n0(r0)}else e0()}),this._p2pChannel.on(_O.RequestUnmuteLocal,async(t0,e0,n0)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t0,this._joinInfo.stringUid||this._joinInfo.uid),e0()}catch(r0){r0.code===Ry.DISCONNECT_P2P?e0():n0(r0)}else e0()}),this._p2pChannel.on(_O.RequestRePublish,(t0,e0,n0)=>{this.publish(t0,!1).then(e0).catch(n0)}),this._p2pChannel.on(_O.RequestRePublishDataChannel,(t0,e0,n0)=>{Gh.all(t0.map(async r0=>{const i0=await this._p2pChannel.publishDataChannel([r0]);try{i0.forEach(o0=>{this._uid&&this._gateway.publishDataChannel(this._uid,o0,!0)})}catch(o0){if(o0.code!==Ry.DISCONNECT_P2P)throw o0}})).then(e0).catch(n0)}),this._p2pChannel.on(_O.RequestReSubscribe,async(t0,e0,n0)=>{try{for(const{user:r0,kind:i0}of t0)i0===dO.VIDEO?await this.subscribe(r0,"video"):await this.subscribe(r0,"audio");e0()}catch(r0){n0(r0)}}),this._p2pChannel.on(_O.RequestUpload,(t0,e0)=>{this._gateway.upload(t0,e0)}),this._p2pChannel.on(_O.RequestUploadStats,t0=>{this._gateway.uploadWRTCStats(t0)}),this._p2pChannel.on(_O.MediaReconnectStart,t0=>{this.safeEmit(zy.MEDIA_RECONNECT_START,t0)}),this._p2pChannel.on(_O.MediaReconnectEnd,t0=>{this.safeEmit(zy.MEDIA_RECONNECT_END,t0)}),this._p2pChannel.on(_O.NeedSignalRTT,t0=>{t0(this._gateway.getSignalRTT())}),this._p2pChannel.on(_O.RequestRestartICE,async t0=>{if(this._p2pChannel instanceof bF)return;const e0=await this._p2pChannel.restartICE(t0),n0=await e0.next();if(n0.done)return;const r0=n0.value;let i0;try{i0=await this._gateway.restartICE({iceParameters:r0})}catch(s0){return void e0.throw(s0)}const{iceParameters:o0}=function(s0){const a0=s0.iceParameters;return{iceParameters:{iceUfrag:a0.iceUfrag,icePwd:a0.icePwd}}}(i0);await e0.next({remoteIceParameters:o0})}),this._p2pChannel.on(_O.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(_O.RequestReconnectPC,async()=>{var t0;const{iceParameters:e0,dtlsParameters:n0,rtpCapabilities:r0}=await this._p2pChannel.startP2PConnection({turnServer:(t0=this._joinInfo)===null||t0===void 0?void 0:t0.turnServer}),{gatewayEstablishParams:i0,gatewayAddress:o0}=await this._gateway.reconnectPC({iceParameters:e0,dtlsParameters:n0,rtpCapabilities:r0}),s0=YU(i0,o0);await this._p2pChannel.connect(s0),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(_O.RequestUnpublishForReconnectPC,async(t0,e0,n0)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t0,this._uid),e0()):n0()}),this._p2pChannel.on(_O.P2PLost,()=>{this.safeEmit(zy.P2P_LOST,this.store.uid)}),this._p2pChannel.on(_O.UpdateVideoEncoder,t0=>{t0._encoderConfig&&this._gateway.setVideoProfile(t0._encoderConfig)}),this._p2pChannel.on(_O.ConnectionTypeChange,t0=>{this.safeEmit(zy.IS_USING_CLOUD_PROXY,t0)}),this._p2pChannel.on(_O.RequestLowStreamParameter,t0=>{t0(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(_O.QueryClientConnectionState,t0=>{t0(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t0){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n0=(e0={config:t0},gB("ContentInspect").create(e0));this._inspect=n0,this.handleVideoInspectEvents(n0);const{appId:r0,cname:i0,sid:o0,token:s0,uid:a0,cid:c0,vid:u0}=this._joinInfo;await n0.init({appId:r0,areaCode:"",cname:i0,sid:o0,token:s0,uid:a0,cid:c0,vid:u0?Number(u0):0},PA)}catch(n0){throw Array.isArray(n0)?n0[0]:n0}var e0}handleVideoInspectEvents(t0){t0.on(mO.CONNECTION_STATE_CHANGE,(e0,n0)=>{if(this.safeEmit(zy.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e0,n0),n0===EO.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(zy.CONTENT_INSPECT_ERROR,new yb(Ry.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t0.inspectImage()}}),t0.on(mO.INSPECT_RESULT,(e0,n0)=>{var r0;if((n0==null?void 0:n0.code)===Ry.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return fb.debug("Stop inspect content because that has left channel"),this==null||(r0=this._inspect)===null||r0===void 0||r0.close(),void(this._inspect=void 0);this.safeEmit(zy.CONTENT_INSPECT_RESULT,e0,n0)}),t0.on(mO.CLIENT_LOCAL_VIDEO_TRACK,e0=>{e0(this.localTracks.filter(n0=>n0.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t0){throw Array.isArray(t0)?t0[0]:t0}}async setImageModeration(t0,e0){if(Iy(t0,"enabled"),t0){if(!e0)throw new yb(Ry.INVALID_PARAMS,"config is required");if(Lj(e0),!this._joinInfo)throw new yb(Ry.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e0);else{const r0=(n0={config:e0},gB("ImageModeration").create(n0));this._moderation=r0,this.handleImageModerationEvents(r0);const{appId:i0,cname:o0,sid:s0,token:a0,uid:c0,cid:u0,vid:l0}=this._joinInfo;await r0.init({appId:i0,areaCode:"",cname:o0,sid:s0,token:a0,uid:c0,cid:u0,vid:l0?Number(l0):0},PA)}}catch(r0){throw Array.isArray(r0)?r0[0]:r0}}else{var n0;if(!this._moderation)throw new yb(Ry.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r0){throw Array.isArray(r0)?r0[0]:r0}}}handleImageModerationEvents(t0){t0.on(RO.CONNECTION_STATE_CHANGE,(e0,n0)=>{if(this.safeEmit(zy.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e0,n0),e0===gO.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new yb(Ry.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t0.inspectImage()}}),t0.on(RO.CLIENT_LOCAL_VIDEO_TRACK,e0=>{e0(this.localTracks.filter(n0=>n0.trackMediaType==="video")[0])})}setP2PTransport(t0){if(function(e0){vy(e0,"transport",["default","auto","relay","sd-rtn"])}(t0),this.mode!=="p2p")throw new yb(Ry.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t0,fb.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t0))}getJoinChannelServiceRecords(){return fb.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t0){Iy(t0,"enabled"),JA("ENABLE_PUBLISH_AUDIO_FILTER",t0),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t0)}_handleResetAddStream(t0,e0){switch(e0){case"audio":t0._audio_added_=!1,t0._trust_audio_stream_added_state_=!0;break;case"video":t0._video_added_=!1,t0._trust_video_stream_added_state_=!0}}},Cw(RG.prototype,"leave",[Mj],Object.getOwnPropertyDescriptor(RG.prototype,"leave"),RG.prototype),Cw(RG.prototype,"publish",[Uj],Object.getOwnPropertyDescriptor(RG.prototype,"publish"),RG.prototype),Cw(RG.prototype,"unpublish",[xj],Object.getOwnPropertyDescriptor(RG.prototype,"unpublish"),RG.prototype),Cw(RG.prototype,"subscribe",[Vj],Object.getOwnPropertyDescriptor(RG.prototype,"subscribe"),RG.prototype),Cw(RG.prototype,"presubscribe",[Fj],Object.getOwnPropertyDescriptor(RG.prototype,"presubscribe"),RG.prototype),Cw(RG.prototype,"massSubscribe",[Bj],Object.getOwnPropertyDescriptor(RG.prototype,"massSubscribe"),RG.prototype),Cw(RG.prototype,"unsubscribe",[jj],Object.getOwnPropertyDescriptor(RG.prototype,"unsubscribe"),RG.prototype),Cw(RG.prototype,"massUnsubscribe",[Gj],Object.getOwnPropertyDescriptor(RG.prototype,"massUnsubscribe"),RG.prototype),Cw(RG.prototype,"setLowStreamParameter",[Wj],Object.getOwnPropertyDescriptor(RG.prototype,"setLowStreamParameter"),RG.prototype),Cw(RG.prototype,"enableDualStream",[Hj],Object.getOwnPropertyDescriptor(RG.prototype,"enableDualStream"),RG.prototype),Cw(RG.prototype,"disableDualStream",[Kj],Object.getOwnPropertyDescriptor(RG.prototype,"disableDualStream"),RG.prototype),Cw(RG.prototype,"setClientRole",[Yj],Object.getOwnPropertyDescriptor(RG.prototype,"setClientRole"),RG.prototype),Cw(RG.prototype,"setProxyServer",[qj],Object.getOwnPropertyDescriptor(RG.prototype,"setProxyServer"),RG.prototype),Cw(RG.prototype,"setTurnServer",[zj],Object.getOwnPropertyDescriptor(RG.prototype,"setTurnServer"),RG.prototype),Cw(RG.prototype,"setLicense",[Jj],Object.getOwnPropertyDescriptor(RG.prototype,"setLicense"),RG.prototype),Cw(RG.prototype,"startProxyServer",[Xj],Object.getOwnPropertyDescriptor(RG.prototype,"startProxyServer"),RG.prototype),Cw(RG.prototype,"stopProxyServer",[Qj],Object.getOwnPropertyDescriptor(RG.prototype,"stopProxyServer"),RG.prototype),Cw(RG.prototype,"setLocalAccessPointsV2",[Zj],Object.getOwnPropertyDescriptor(RG.prototype,"setLocalAccessPointsV2"),RG.prototype),Cw(RG.prototype,"setLocalAccessPoints",[$j],Object.getOwnPropertyDescriptor(RG.prototype,"setLocalAccessPoints"),RG.prototype),Cw(RG.prototype,"setRemoteDefaultVideoStreamType",[eG],Object.getOwnPropertyDescriptor(RG.prototype,"setRemoteDefaultVideoStreamType"),RG.prototype),Cw(RG.prototype,"setRemoteVideoStreamType",[tG],Object.getOwnPropertyDescriptor(RG.prototype,"setRemoteVideoStreamType"),RG.prototype),Cw(RG.prototype,"setStreamFallbackOption",[iG],Object.getOwnPropertyDescriptor(RG.prototype,"setStreamFallbackOption"),RG.prototype),Cw(RG.prototype,"setEncryptionConfig",[nG],Object.getOwnPropertyDescriptor(RG.prototype,"setEncryptionConfig"),RG.prototype),Cw(RG.prototype,"renewToken",[rG],Object.getOwnPropertyDescriptor(RG.prototype,"renewToken"),RG.prototype),Cw(RG.prototype,"enableAudioVolumeIndicator",[oG],Object.getOwnPropertyDescriptor(RG.prototype,"enableAudioVolumeIndicator"),RG.prototype),Cw(RG.prototype,"startLiveStreaming",[sG],Object.getOwnPropertyDescriptor(RG.prototype,"startLiveStreaming"),RG.prototype),Cw(RG.prototype,"setLiveTranscoding",[aG],Object.getOwnPropertyDescriptor(RG.prototype,"setLiveTranscoding"),RG.prototype),Cw(RG.prototype,"stopLiveStreaming",[cG],Object.getOwnPropertyDescriptor(RG.prototype,"stopLiveStreaming"),RG.prototype),Cw(RG.prototype,"startChannelMediaRelay",[dG],Object.getOwnPropertyDescriptor(RG.prototype,"startChannelMediaRelay"),RG.prototype),Cw(RG.prototype,"updateChannelMediaRelay",[lG],Object.getOwnPropertyDescriptor(RG.prototype,"updateChannelMediaRelay"),RG.prototype),Cw(RG.prototype,"stopChannelMediaRelay",[uG],Object.getOwnPropertyDescriptor(RG.prototype,"stopChannelMediaRelay"),RG.prototype),Cw(RG.prototype,"sendCustomReportMessage",[hG],Object.getOwnPropertyDescriptor(RG.prototype,"sendCustomReportMessage"),RG.prototype),Cw(RG.prototype,"pickSVCLayer",[pG],Object.getOwnPropertyDescriptor(RG.prototype,"pickSVCLayer"),RG.prototype),Cw(RG.prototype,"setRTMConfig",[_G],Object.getOwnPropertyDescriptor(RG.prototype,"setRTMConfig"),RG.prototype),Cw(RG.prototype,"enableContentInspect",[EG],Object.getOwnPropertyDescriptor(RG.prototype,"enableContentInspect"),RG.prototype),Cw(RG.prototype,"disableContentInspect",[fG],Object.getOwnPropertyDescriptor(RG.prototype,"disableContentInspect"),RG.prototype),Cw(RG.prototype,"setImageModeration",[mG],Object.getOwnPropertyDescriptor(RG.prototype,"setImageModeration"),RG.prototype),Cw(RG.prototype,"setP2PTransport",[TG],Object.getOwnPropertyDescriptor(RG.prototype,"setP2PTransport"),RG.prototype),Cw(RG.prototype,"getJoinChannelServiceRecords",[SG],Object.getOwnPropertyDescriptor(RG.prototype,"getJoinChannelServiceRecords"),RG.prototype),Cw(RG.prototype,"setPublishAudioFilterEnabled",[gG],Object.getOwnPropertyDescriptor(RG.prototype,"setPublishAudioFilterEnabled"),RG.prototype),RG);class yG{constructor(e0,n0){Fg(this,"id",0),Fg(this,"element",void 0),Fg(this,"peerPair",void 0),Fg(this,"context",void 0),Fg(this,"audioPlayerElement",void 0),Fg(this,"audioTrack",void 0),yG.count+=1,this.id=yG.count,this.element=e0,this.context=n0}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e0=>{const n0=document.createElement("audio");n0.srcObject=new MediaStream([e0.track]),n0.play(),this.audioPlayerElement=n0}}async switchSdp(){if(!this.peerPair)return;const e0=async(r0,i0)=>{const o0=i0==="offer"?await r0.createOffer():await r0.createAnswer();return await r0.setLocalDescription(o0),r0.iceGatheringState==="complete"?r0.localDescription:new Gh(s0=>{r0.onicegatheringstatechange=()=>{r0.iceGatheringState==="complete"&&s0(r0.localDescription)}})},n0=async(r0,i0)=>await r0.setRemoteDescription(i0);try{const r0=await e0(this.peerPair[0],"offer");await n0(this.peerPair[1],r0);const i0=await e0(this.peerPair[1],"answer");await n0(this.peerPair[0],i0)}catch(r0){throw new yb(Ry.LOCAL_AEC_ERROR,r0.toString()).print()}}async getTracksFromMediaElement(e0){if(this.audioTrack)return this.audioTrack;let n0;try{e0 instanceof HTMLVideoElement&&(e0.captureStream?e0.captureStream():e0.mozCaptureStream()),n0=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e0).connect(n0)}catch(i0){throw new yb(Ry.LOCAL_AEC_ERROR,i0.toString()).print()}if(!n0)throw new yb(Ry.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r0=n0.stream.getAudioTracks()[0];return this.audioTrack=r0,r0}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e0=this.element,n0=await this.getTracksFromMediaElement(e0);this.peerPair&&this.peerPair[0].addTrack(n0),await this.switchSdp()}close(){fb.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e0=>{e0.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var AG,bG;Fg(yG,"count",0);const wG=window.AudioContext||window.webkitAudioContext,OG=new(AG=Ib({report:vb}),Cw((bG=class{constructor(){Fg(this,"units",[]),Fg(this,"context",void 0)}processExternalMediaAEC(t0){if(!this._doesEnvironmentNeedAEC())return fb.debug("the system does not need to process local aec"),-1;this.context||(this.context=new wG);let e0=this.units.find(n0=>n0&&n0.getElement()===t0);return e0||(e0=new yG(t0,this.context),this.units.push(e0)),e0.startEchoCancellation(),fb.debug("start processing local audio echo cancellation, id is",e0.id),e0.id}_doesEnvironmentNeedAEC(){return Hv().name!==Bv.SAFARI}}).prototype,"processExternalMediaAEC",[AG],Object.getOwnPropertyDescriptor(bG.prototype,"processExternalMediaAEC"),bG.prototype),bG);function NG(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function DG(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?NG(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):NG(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}const PG=window||document;function LG(t0){let e0=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!PG)return;const n0=nq._cspEventHandlerPointer;if(n0&&e0)return void console.error(n0,e0);const r0=i0=>{if(!(i0&&i0.blockedURI&&(nq.onSecurityPolicyViolation||nq.getListeners(SO.SECURITY_POLICY_VIOLATION).length>0)))return;const o0=i0.blockedURI;XA("CSP_DETECTED_HOSTNAME_LIST").some(s0=>Dn(o0).call(o0,s0))&&(nq.onSecurityPolicyViolation&&typeof nq.onSecurityPolicyViolation=="function"&&nq.onSecurityPolicyViolation(i0),nq.getListeners(SO.SECURITY_POLICY_VIOLATION).length>0&&nq.safeEmit(SO.SECURITY_POLICY_VIOLATION,i0))};n0&&PG.removeEventListener("securitypolicyviolation",n0),(e0||t0&&typeof t0=="function"||nq.getListeners(SO.SECURITY_POLICY_VIOLATION).length>0)&&PG.addEventListener("securitypolicyviolation",r0),nq._cspEventHandlerPointer=r0}var kG=l,MG=RC,UG=RegExp.prototype,xG=function(t0){return t0===UG||kG(UG,t0)?MG(t0):t0.flags},VG=i(xG);function FG(t0){let e0=t0.length;for(;--e0>=0;)t0[e0]=0}const BG=256,jG=286,GG=30,WG=15,HG=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),KG=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),YG=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),qG=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zG=new Array(576);FG(zG);const JG=new Array(60);FG(JG);const XG=new Array(512);FG(XG);const QG=new Array(256);FG(QG);const ZG=new Array(29);FG(ZG);const $G=new Array(GG);function eW(t0,e0,n0,r0,i0){this.static_tree=t0,this.extra_bits=e0,this.extra_base=n0,this.elems=r0,this.max_length=i0,this.has_stree=t0&&t0.length}let tW,iW,nW;function rW(t0,e0){this.dyn_tree=t0,this.max_code=0,this.stat_desc=e0}FG($G);const oW=t0=>t0<256?XG[t0]:XG[256+(t0>>>7)],sW=(t0,e0)=>{t0.pending_buf[t0.pending++]=255&e0,t0.pending_buf[t0.pending++]=e0>>>8&255},aW=(t0,e0,n0)=>{t0.bi_valid>16-n0?(t0.bi_buf|=e0<<t0.bi_valid&65535,sW(t0,t0.bi_buf),t0.bi_buf=e0>>16-t0.bi_valid,t0.bi_valid+=n0-16):(t0.bi_buf|=e0<<t0.bi_valid&65535,t0.bi_valid+=n0)},cW=(t0,e0,n0)=>{aW(t0,n0[2*e0],n0[2*e0+1])},dW=(t0,e0)=>{let n0=0;do n0|=1&t0,t0>>>=1,n0<<=1;while(--e0>0);return n0>>>1},lW=(t0,e0,n0)=>{const r0=new Array(16);let i0,o0,s0=0;for(i0=1;i0<=WG;i0++)s0=s0+n0[i0-1]<<1,r0[i0]=s0;for(o0=0;o0<=e0;o0++){let a0=t0[2*o0+1];a0!==0&&(t0[2*o0]=dW(r0[a0]++,a0))}},uW=t0=>{let e0;for(e0=0;e0<jG;e0++)t0.dyn_ltree[2*e0]=0;for(e0=0;e0<GG;e0++)t0.dyn_dtree[2*e0]=0;for(e0=0;e0<19;e0++)t0.bl_tree[2*e0]=0;t0.dyn_ltree[512]=1,t0.opt_len=t0.static_len=0,t0.sym_next=t0.matches=0},hW=t0=>{t0.bi_valid>8?sW(t0,t0.bi_buf):t0.bi_valid>0&&(t0.pending_buf[t0.pending++]=t0.bi_buf),t0.bi_buf=0,t0.bi_valid=0},pW=(t0,e0,n0,r0)=>{const i0=2*e0,o0=2*n0;return t0[i0]<t0[o0]||t0[i0]===t0[o0]&&r0[e0]<=r0[n0]},_W=(t0,e0,n0)=>{const r0=t0.heap[n0];let i0=n0<<1;for(;i0<=t0.heap_len&&(i0<t0.heap_len&&pW(e0,t0.heap[i0+1],t0.heap[i0],t0.depth)&&i0++,!pW(e0,r0,t0.heap[i0],t0.depth));)t0.heap[n0]=t0.heap[i0],n0=i0,i0<<=1;t0.heap[n0]=r0},EW=(t0,e0,n0)=>{let r0,i0,o0,s0,a0=0;if(t0.sym_next!==0)do r0=255&t0.pending_buf[t0.sym_buf+a0++],r0+=(255&t0.pending_buf[t0.sym_buf+a0++])<<8,i0=t0.pending_buf[t0.sym_buf+a0++],r0===0?cW(t0,i0,e0):(o0=QG[i0],cW(t0,o0+BG+1,e0),s0=HG[o0],s0!==0&&(i0-=ZG[o0],aW(t0,i0,s0)),r0--,o0=oW(r0),cW(t0,o0,n0),s0=KG[o0],s0!==0&&(r0-=$G[o0],aW(t0,r0,s0)));while(a0<t0.sym_next);cW(t0,256,e0)},fW=(t0,e0)=>{const n0=e0.dyn_tree,r0=e0.stat_desc.static_tree,i0=e0.stat_desc.has_stree,o0=e0.stat_desc.elems;let s0,a0,c0,u0=-1;for(t0.heap_len=0,t0.heap_max=573,s0=0;s0<o0;s0++)n0[2*s0]!==0?(t0.heap[++t0.heap_len]=u0=s0,t0.depth[s0]=0):n0[2*s0+1]=0;for(;t0.heap_len<2;)c0=t0.heap[++t0.heap_len]=u0<2?++u0:0,n0[2*c0]=1,t0.depth[c0]=0,t0.opt_len--,i0&&(t0.static_len-=r0[2*c0+1]);for(e0.max_code=u0,s0=t0.heap_len>>1;s0>=1;s0--)_W(t0,n0,s0);c0=o0;do s0=t0.heap[1],t0.heap[1]=t0.heap[t0.heap_len--],_W(t0,n0,1),a0=t0.heap[1],t0.heap[--t0.heap_max]=s0,t0.heap[--t0.heap_max]=a0,n0[2*c0]=n0[2*s0]+n0[2*a0],t0.depth[c0]=(t0.depth[s0]>=t0.depth[a0]?t0.depth[s0]:t0.depth[a0])+1,n0[2*s0+1]=n0[2*a0+1]=c0,t0.heap[1]=c0++,_W(t0,n0,1);while(t0.heap_len>=2);t0.heap[--t0.heap_max]=t0.heap[1],((l0,d0)=>{const h0=d0.dyn_tree,p0=d0.max_code,m0=d0.stat_desc.static_tree,f0=d0.stat_desc.has_stree,g0=d0.stat_desc.extra_bits,E0=d0.stat_desc.extra_base,_0=d0.stat_desc.max_length;let y0,b0,S0,w0,I0,L0,M0=0;for(w0=0;w0<=WG;w0++)l0.bl_count[w0]=0;for(h0[2*l0.heap[l0.heap_max]+1]=0,y0=l0.heap_max+1;y0<573;y0++)b0=l0.heap[y0],w0=h0[2*h0[2*b0+1]+1]+1,w0>_0&&(w0=_0,M0++),h0[2*b0+1]=w0,b0>p0||(l0.bl_count[w0]++,I0=0,b0>=E0&&(I0=g0[b0-E0]),L0=h0[2*b0],l0.opt_len+=L0*(w0+I0),f0&&(l0.static_len+=L0*(m0[2*b0+1]+I0)));if(M0!==0){do{for(w0=_0-1;l0.bl_count[w0]===0;)w0--;l0.bl_count[w0]--,l0.bl_count[w0+1]+=2,l0.bl_count[_0]--,M0-=2}while(M0>0);for(w0=_0;w0!==0;w0--)for(b0=l0.bl_count[w0];b0!==0;)S0=l0.heap[--y0],S0>p0||(h0[2*S0+1]!==w0&&(l0.opt_len+=(w0-h0[2*S0+1])*h0[2*S0],h0[2*S0+1]=w0),b0--)}})(t0,e0),lW(n0,u0,t0.bl_count)},mW=(t0,e0,n0)=>{let r0,i0,o0=-1,s0=e0[1],a0=0,c0=7,u0=4;for(s0===0&&(c0=138,u0=3),e0[2*(n0+1)+1]=65535,r0=0;r0<=n0;r0++)i0=s0,s0=e0[2*(r0+1)+1],++a0<c0&&i0===s0||(a0<u0?t0.bl_tree[2*i0]+=a0:i0!==0?(i0!==o0&&t0.bl_tree[2*i0]++,t0.bl_tree[32]++):a0<=10?t0.bl_tree[34]++:t0.bl_tree[36]++,a0=0,o0=i0,s0===0?(c0=138,u0=3):i0===s0?(c0=6,u0=3):(c0=7,u0=4))},TW=(t0,e0,n0)=>{let r0,i0,o0=-1,s0=e0[1],a0=0,c0=7,u0=4;for(s0===0&&(c0=138,u0=3),r0=0;r0<=n0;r0++)if(i0=s0,s0=e0[2*(r0+1)+1],!(++a0<c0&&i0===s0)){if(a0<u0)do cW(t0,i0,t0.bl_tree);while(--a0!=0);else i0!==0?(i0!==o0&&(cW(t0,i0,t0.bl_tree),a0--),cW(t0,16,t0.bl_tree),aW(t0,a0-3,2)):a0<=10?(cW(t0,17,t0.bl_tree),aW(t0,a0-3,3)):(cW(t0,18,t0.bl_tree),aW(t0,a0-11,7));a0=0,o0=i0,s0===0?(c0=138,u0=3):i0===s0?(c0=6,u0=3):(c0=7,u0=4)}};let SW=!1;const gW=(t0,e0,n0,r0)=>{aW(t0,0+(r0?1:0),3),hW(t0),sW(t0,n0),sW(t0,~n0),n0&&t0.pending_buf.set(t0.window.subarray(e0,e0+n0),t0.pending),t0.pending+=n0};var RW=t0=>{SW||((()=>{let e0,n0,r0,i0,o0;const s0=new Array(16);for(r0=0,i0=0;i0<28;i0++)for(ZG[i0]=r0,e0=0;e0<1<<HG[i0];e0++)QG[r0++]=i0;for(QG[r0-1]=i0,o0=0,i0=0;i0<16;i0++)for($G[i0]=o0,e0=0;e0<1<<KG[i0];e0++)XG[o0++]=i0;for(o0>>=7;i0<GG;i0++)for($G[i0]=o0<<7,e0=0;e0<1<<KG[i0]-7;e0++)XG[256+o0++]=i0;for(n0=0;n0<=WG;n0++)s0[n0]=0;for(e0=0;e0<=143;)zG[2*e0+1]=8,e0++,s0[8]++;for(;e0<=255;)zG[2*e0+1]=9,e0++,s0[9]++;for(;e0<=279;)zG[2*e0+1]=7,e0++,s0[7]++;for(;e0<=287;)zG[2*e0+1]=8,e0++,s0[8]++;for(lW(zG,287,s0),e0=0;e0<GG;e0++)JG[2*e0+1]=5,JG[2*e0]=dW(e0,5);tW=new eW(zG,HG,257,jG,WG),iW=new eW(JG,KG,0,GG,WG),nW=new eW(new Array(0),YG,0,19,7)})(),SW=!0),t0.l_desc=new rW(t0.dyn_ltree,tW),t0.d_desc=new rW(t0.dyn_dtree,iW),t0.bl_desc=new rW(t0.bl_tree,nW),t0.bi_buf=0,t0.bi_valid=0,uW(t0)},CW=(t0,e0,n0,r0)=>{let i0,o0,s0=0;t0.level>0?(t0.strm.data_type===2&&(t0.strm.data_type=(a0=>{let c0,u0=4093624447;for(c0=0;c0<=31;c0++,u0>>>=1)if(1&u0&&a0.dyn_ltree[2*c0]!==0)return 0;if(a0.dyn_ltree[18]!==0||a0.dyn_ltree[20]!==0||a0.dyn_ltree[26]!==0)return 1;for(c0=32;c0<BG;c0++)if(a0.dyn_ltree[2*c0]!==0)return 1;return 0})(t0)),fW(t0,t0.l_desc),fW(t0,t0.d_desc),s0=(a0=>{let c0;for(mW(a0,a0.dyn_ltree,a0.l_desc.max_code),mW(a0,a0.dyn_dtree,a0.d_desc.max_code),fW(a0,a0.bl_desc),c0=18;c0>=3&&a0.bl_tree[2*qG[c0]+1]===0;c0--);return a0.opt_len+=3*(c0+1)+5+5+4,c0})(t0),i0=t0.opt_len+3+7>>>3,o0=t0.static_len+3+7>>>3,o0<=i0&&(i0=o0)):i0=o0=n0+5,n0+4<=i0&&e0!==-1?gW(t0,e0,n0,r0):t0.strategy===4||o0===i0?(aW(t0,2+(r0?1:0),3),EW(t0,zG,JG)):(aW(t0,4+(r0?1:0),3),((a0,c0,u0,l0)=>{let d0;for(aW(a0,c0-257,5),aW(a0,u0-1,5),aW(a0,l0-4,4),d0=0;d0<l0;d0++)aW(a0,a0.bl_tree[2*qG[d0]+1],3);TW(a0,a0.dyn_ltree,c0-1),TW(a0,a0.dyn_dtree,u0-1)})(t0,t0.l_desc.max_code+1,t0.d_desc.max_code+1,s0+1),EW(t0,t0.dyn_ltree,t0.dyn_dtree)),uW(t0),r0&&hW(t0)},IW=(t0,e0,n0)=>(t0.pending_buf[t0.sym_buf+t0.sym_next++]=e0,t0.pending_buf[t0.sym_buf+t0.sym_next++]=e0>>8,t0.pending_buf[t0.sym_buf+t0.sym_next++]=n0,e0===0?t0.dyn_ltree[2*n0]++:(t0.matches++,e0--,t0.dyn_ltree[2*(QG[n0]+BG+1)]++,t0.dyn_dtree[2*oW(e0)]++),t0.sym_next===t0.sym_end),vW=t0=>{aW(t0,2,3),cW(t0,256,zG),(e0=>{e0.bi_valid===16?(sW(e0,e0.bi_buf),e0.bi_buf=0,e0.bi_valid=0):e0.bi_valid>=8&&(e0.pending_buf[e0.pending++]=255&e0.bi_buf,e0.bi_buf>>=8,e0.bi_valid-=8)})(t0)},yW={_tr_init:RW,_tr_stored_block:gW,_tr_flush_block:CW,_tr_tally:IW,_tr_align:vW},AW=(t0,e0,n0,r0)=>{let i0=65535&t0|0,o0=t0>>>16&65535|0,s0=0;for(;n0!==0;){s0=n0>2e3?2e3:n0,n0-=s0;do i0=i0+e0[r0++]|0,o0=o0+i0|0;while(--s0);i0%=65521,o0%=65521}return i0|o0<<16|0};const bW=new Uint32Array((()=>{let t0,e0=[];for(var n0=0;n0<256;n0++){t0=n0;for(var r0=0;r0<8;r0++)t0=1&t0?3988292384^t0>>>1:t0>>>1;e0[n0]=t0}return e0})());var wW=(t0,e0,n0,r0)=>{const i0=bW,o0=r0+n0;t0^=-1;for(let s0=r0;s0<o0;s0++)t0=t0>>>8^i0[255&(t0^e0[s0])];return-1^t0},OW={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},NW={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:DW,_tr_stored_block:PW,_tr_flush_block:LW,_tr_tally:kW,_tr_align:MW}=yW,{Z_NO_FLUSH:UW,Z_PARTIAL_FLUSH:xW,Z_FULL_FLUSH:VW,Z_FINISH:FW,Z_BLOCK:BW,Z_OK:jW,Z_STREAM_END:GW,Z_STREAM_ERROR:WW,Z_DATA_ERROR:HW,Z_BUF_ERROR:KW,Z_DEFAULT_COMPRESSION:YW,Z_FILTERED:qW,Z_HUFFMAN_ONLY:zW,Z_RLE:JW,Z_FIXED:XW,Z_DEFAULT_STRATEGY:QW,Z_UNKNOWN:ZW,Z_DEFLATED:$W}=NW,eH=286,tH=30,iH=19,nH=2*eH+1,rH=15,oH=258,sH=262,aH=42,cH=113,dH=666,lH=(t0,e0)=>(t0.msg=OW[e0],e0),uH=t0=>2*t0-(t0>4?9:0),hH=t0=>{let e0=t0.length;for(;--e0>=0;)t0[e0]=0},pH=t0=>{let e0,n0,r0,i0=t0.w_size;e0=t0.hash_size,r0=e0;do n0=t0.head[--r0],t0.head[r0]=n0>=i0?n0-i0:0;while(--e0);e0=i0,r0=e0;do n0=t0.prev[--r0],t0.prev[r0]=n0>=i0?n0-i0:0;while(--e0)};let _H=(t0,e0,n0)=>(e0<<t0.hash_shift^n0)&t0.hash_mask;const EH=t0=>{const e0=t0.state;let n0=e0.pending;n0>t0.avail_out&&(n0=t0.avail_out),n0!==0&&(t0.output.set(e0.pending_buf.subarray(e0.pending_out,e0.pending_out+n0),t0.next_out),t0.next_out+=n0,e0.pending_out+=n0,t0.total_out+=n0,t0.avail_out-=n0,e0.pending-=n0,e0.pending===0&&(e0.pending_out=0))},fH=(t0,e0)=>{LW(t0,t0.block_start>=0?t0.block_start:-1,t0.strstart-t0.block_start,e0),t0.block_start=t0.strstart,EH(t0.strm)},mH=(t0,e0)=>{t0.pending_buf[t0.pending++]=e0},TH=(t0,e0)=>{t0.pending_buf[t0.pending++]=e0>>>8&255,t0.pending_buf[t0.pending++]=255&e0},SH=(t0,e0,n0,r0)=>{let i0=t0.avail_in;return i0>r0&&(i0=r0),i0===0?0:(t0.avail_in-=i0,e0.set(t0.input.subarray(t0.next_in,t0.next_in+i0),n0),t0.state.wrap===1?t0.adler=AW(t0.adler,e0,i0,n0):t0.state.wrap===2&&(t0.adler=wW(t0.adler,e0,i0,n0)),t0.next_in+=i0,t0.total_in+=i0,i0)},gH=(t0,e0)=>{let n0,r0,i0=t0.max_chain_length,o0=t0.strstart,s0=t0.prev_length,a0=t0.nice_match;const c0=t0.strstart>t0.w_size-sH?t0.strstart-(t0.w_size-sH):0,u0=t0.window,l0=t0.w_mask,d0=t0.prev,h0=t0.strstart+oH;let p0=u0[o0+s0-1],m0=u0[o0+s0];t0.prev_length>=t0.good_match&&(i0>>=2),a0>t0.lookahead&&(a0=t0.lookahead);do if(n0=e0,u0[n0+s0]===m0&&u0[n0+s0-1]===p0&&u0[n0]===u0[o0]&&u0[++n0]===u0[o0+1]){o0+=2,n0++;do;while(u0[++o0]===u0[++n0]&&u0[++o0]===u0[++n0]&&u0[++o0]===u0[++n0]&&u0[++o0]===u0[++n0]&&u0[++o0]===u0[++n0]&&u0[++o0]===u0[++n0]&&u0[++o0]===u0[++n0]&&u0[++o0]===u0[++n0]&&o0<h0);if(r0=oH-(h0-o0),o0=h0-oH,r0>s0){if(t0.match_start=e0,s0=r0,r0>=a0)break;p0=u0[o0+s0-1],m0=u0[o0+s0]}}while((e0=d0[e0&l0])>c0&&--i0!=0);return s0<=t0.lookahead?s0:t0.lookahead},RH=t0=>{const e0=t0.w_size;let n0,r0,i0;do{if(r0=t0.window_size-t0.lookahead-t0.strstart,t0.strstart>=e0+(e0-sH)&&(t0.window.set(t0.window.subarray(e0,e0+e0-r0),0),t0.match_start-=e0,t0.strstart-=e0,t0.block_start-=e0,t0.insert>t0.strstart&&(t0.insert=t0.strstart),pH(t0),r0+=e0),t0.strm.avail_in===0)break;if(n0=SH(t0.strm,t0.window,t0.strstart+t0.lookahead,r0),t0.lookahead+=n0,t0.lookahead+t0.insert>=3)for(i0=t0.strstart-t0.insert,t0.ins_h=t0.window[i0],t0.ins_h=_H(t0,t0.ins_h,t0.window[i0+1]);t0.insert&&(t0.ins_h=_H(t0,t0.ins_h,t0.window[i0+3-1]),t0.prev[i0&t0.w_mask]=t0.head[t0.ins_h],t0.head[t0.ins_h]=i0,i0++,t0.insert--,!(t0.lookahead+t0.insert<3)););}while(t0.lookahead<sH&&t0.strm.avail_in!==0)},CH=(t0,e0)=>{let n0,r0,i0,o0=t0.pending_buf_size-5>t0.w_size?t0.w_size:t0.pending_buf_size-5,s0=0,a0=t0.strm.avail_in;do{if(n0=65535,i0=t0.bi_valid+42>>3,t0.strm.avail_out<i0||(i0=t0.strm.avail_out-i0,r0=t0.strstart-t0.block_start,n0>r0+t0.strm.avail_in&&(n0=r0+t0.strm.avail_in),n0>i0&&(n0=i0),n0<o0&&(n0===0&&e0!==FW||e0===UW||n0!==r0+t0.strm.avail_in)))break;s0=e0===FW&&n0===r0+t0.strm.avail_in?1:0,PW(t0,0,0,s0),t0.pending_buf[t0.pending-4]=n0,t0.pending_buf[t0.pending-3]=n0>>8,t0.pending_buf[t0.pending-2]=~n0,t0.pending_buf[t0.pending-1]=~n0>>8,EH(t0.strm),r0&&(r0>n0&&(r0=n0),t0.strm.output.set(t0.window.subarray(t0.block_start,t0.block_start+r0),t0.strm.next_out),t0.strm.next_out+=r0,t0.strm.avail_out-=r0,t0.strm.total_out+=r0,t0.block_start+=r0,n0-=r0),n0&&(SH(t0.strm,t0.strm.output,t0.strm.next_out,n0),t0.strm.next_out+=n0,t0.strm.avail_out-=n0,t0.strm.total_out+=n0)}while(s0===0);return a0-=t0.strm.avail_in,a0&&(a0>=t0.w_size?(t0.matches=2,t0.window.set(t0.strm.input.subarray(t0.strm.next_in-t0.w_size,t0.strm.next_in),0),t0.strstart=t0.w_size,t0.insert=t0.strstart):(t0.window_size-t0.strstart<=a0&&(t0.strstart-=t0.w_size,t0.window.set(t0.window.subarray(t0.w_size,t0.w_size+t0.strstart),0),t0.matches<2&&t0.matches++,t0.insert>t0.strstart&&(t0.insert=t0.strstart)),t0.window.set(t0.strm.input.subarray(t0.strm.next_in-a0,t0.strm.next_in),t0.strstart),t0.strstart+=a0,t0.insert+=a0>t0.w_size-t0.insert?t0.w_size-t0.insert:a0),t0.block_start=t0.strstart),t0.high_water<t0.strstart&&(t0.high_water=t0.strstart),s0?4:e0!==UW&&e0!==FW&&t0.strm.avail_in===0&&t0.strstart===t0.block_start?2:(i0=t0.window_size-t0.strstart,t0.strm.avail_in>i0&&t0.block_start>=t0.w_size&&(t0.block_start-=t0.w_size,t0.strstart-=t0.w_size,t0.window.set(t0.window.subarray(t0.w_size,t0.w_size+t0.strstart),0),t0.matches<2&&t0.matches++,i0+=t0.w_size,t0.insert>t0.strstart&&(t0.insert=t0.strstart)),i0>t0.strm.avail_in&&(i0=t0.strm.avail_in),i0&&(SH(t0.strm,t0.window,t0.strstart,i0),t0.strstart+=i0,t0.insert+=i0>t0.w_size-t0.insert?t0.w_size-t0.insert:i0),t0.high_water<t0.strstart&&(t0.high_water=t0.strstart),i0=t0.bi_valid+42>>3,i0=t0.pending_buf_size-i0>65535?65535:t0.pending_buf_size-i0,o0=i0>t0.w_size?t0.w_size:i0,r0=t0.strstart-t0.block_start,(r0>=o0||(r0||e0===FW)&&e0!==UW&&t0.strm.avail_in===0&&r0<=i0)&&(n0=r0>i0?i0:r0,s0=e0===FW&&t0.strm.avail_in===0&&n0===r0?1:0,PW(t0,t0.block_start,n0,s0),t0.block_start+=n0,EH(t0.strm)),s0?3:1)},IH=(t0,e0)=>{let n0,r0;for(;;){if(t0.lookahead<sH){if(RH(t0),t0.lookahead<sH&&e0===UW)return 1;if(t0.lookahead===0)break}if(n0=0,t0.lookahead>=3&&(t0.ins_h=_H(t0,t0.ins_h,t0.window[t0.strstart+3-1]),n0=t0.prev[t0.strstart&t0.w_mask]=t0.head[t0.ins_h],t0.head[t0.ins_h]=t0.strstart),n0!==0&&t0.strstart-n0<=t0.w_size-sH&&(t0.match_length=gH(t0,n0)),t0.match_length>=3)if(r0=kW(t0,t0.strstart-t0.match_start,t0.match_length-3),t0.lookahead-=t0.match_length,t0.match_length<=t0.max_lazy_match&&t0.lookahead>=3){t0.match_length--;do t0.strstart++,t0.ins_h=_H(t0,t0.ins_h,t0.window[t0.strstart+3-1]),n0=t0.prev[t0.strstart&t0.w_mask]=t0.head[t0.ins_h],t0.head[t0.ins_h]=t0.strstart;while(--t0.match_length!=0);t0.strstart++}else t0.strstart+=t0.match_length,t0.match_length=0,t0.ins_h=t0.window[t0.strstart],t0.ins_h=_H(t0,t0.ins_h,t0.window[t0.strstart+1]);else r0=kW(t0,0,t0.window[t0.strstart]),t0.lookahead--,t0.strstart++;if(r0&&(fH(t0,!1),t0.strm.avail_out===0))return 1}return t0.insert=t0.strstart<2?t0.strstart:2,e0===FW?(fH(t0,!0),t0.strm.avail_out===0?3:4):t0.sym_next&&(fH(t0,!1),t0.strm.avail_out===0)?1:2},vH=(t0,e0)=>{let n0,r0,i0;for(;;){if(t0.lookahead<sH){if(RH(t0),t0.lookahead<sH&&e0===UW)return 1;if(t0.lookahead===0)break}if(n0=0,t0.lookahead>=3&&(t0.ins_h=_H(t0,t0.ins_h,t0.window[t0.strstart+3-1]),n0=t0.prev[t0.strstart&t0.w_mask]=t0.head[t0.ins_h],t0.head[t0.ins_h]=t0.strstart),t0.prev_length=t0.match_length,t0.prev_match=t0.match_start,t0.match_length=2,n0!==0&&t0.prev_length<t0.max_lazy_match&&t0.strstart-n0<=t0.w_size-sH&&(t0.match_length=gH(t0,n0),t0.match_length<=5&&(t0.strategy===qW||t0.match_length===3&&t0.strstart-t0.match_start>4096)&&(t0.match_length=2)),t0.prev_length>=3&&t0.match_length<=t0.prev_length){i0=t0.strstart+t0.lookahead-3,r0=kW(t0,t0.strstart-1-t0.prev_match,t0.prev_length-3),t0.lookahead-=t0.prev_length-1,t0.prev_length-=2;do++t0.strstart<=i0&&(t0.ins_h=_H(t0,t0.ins_h,t0.window[t0.strstart+3-1]),n0=t0.prev[t0.strstart&t0.w_mask]=t0.head[t0.ins_h],t0.head[t0.ins_h]=t0.strstart);while(--t0.prev_length!=0);if(t0.match_available=0,t0.match_length=2,t0.strstart++,r0&&(fH(t0,!1),t0.strm.avail_out===0))return 1}else if(t0.match_available){if(r0=kW(t0,0,t0.window[t0.strstart-1]),r0&&fH(t0,!1),t0.strstart++,t0.lookahead--,t0.strm.avail_out===0)return 1}else t0.match_available=1,t0.strstart++,t0.lookahead--}return t0.match_available&&(r0=kW(t0,0,t0.window[t0.strstart-1]),t0.match_available=0),t0.insert=t0.strstart<2?t0.strstart:2,e0===FW?(fH(t0,!0),t0.strm.avail_out===0?3:4):t0.sym_next&&(fH(t0,!1),t0.strm.avail_out===0)?1:2};function yH(t0,e0,n0,r0,i0){this.good_length=t0,this.max_lazy=e0,this.nice_length=n0,this.max_chain=r0,this.func=i0}const AH=[new yH(0,0,0,0,CH),new yH(4,4,8,4,IH),new yH(4,5,16,8,IH),new yH(4,6,32,32,IH),new yH(4,4,16,16,vH),new yH(8,16,32,32,vH),new yH(8,16,128,128,vH),new yH(8,32,128,256,vH),new yH(32,128,258,1024,vH),new yH(32,258,258,4096,vH)];function bH(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$W,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*nH),this.dyn_dtree=new Uint16Array(2*(2*tH+1)),this.bl_tree=new Uint16Array(2*(2*iH+1)),hH(this.dyn_ltree),hH(this.dyn_dtree),hH(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(rH+1),this.heap=new Uint16Array(2*eH+1),hH(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*eH+1),hH(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const wH=t0=>{if(!t0)return 1;const e0=t0.state;return!e0||e0.strm!==t0||e0.status!==aH&&e0.status!==57&&e0.status!==69&&e0.status!==73&&e0.status!==91&&e0.status!==103&&e0.status!==cH&&e0.status!==dH?1:0},OH=t0=>{if(wH(t0))return lH(t0,WW);t0.total_in=t0.total_out=0,t0.data_type=ZW;const e0=t0.state;return e0.pending=0,e0.pending_out=0,e0.wrap<0&&(e0.wrap=-e0.wrap),e0.status=e0.wrap===2?57:e0.wrap?aH:cH,t0.adler=e0.wrap===2?0:1,e0.last_flush=-2,DW(e0),jW},NH=t0=>{const e0=OH(t0);return e0===jW&&(n0=>{n0.window_size=2*n0.w_size,hH(n0.head),n0.max_lazy_match=AH[n0.level].max_lazy,n0.good_match=AH[n0.level].good_length,n0.nice_match=AH[n0.level].nice_length,n0.max_chain_length=AH[n0.level].max_chain,n0.strstart=0,n0.block_start=0,n0.lookahead=0,n0.insert=0,n0.match_length=n0.prev_length=2,n0.match_available=0,n0.ins_h=0})(t0.state),e0},DH=(t0,e0,n0,r0,i0,o0)=>{if(!t0)return WW;let s0=1;if(e0===YW&&(e0=6),r0<0?(s0=0,r0=-r0):r0>15&&(s0=2,r0-=16),i0<1||i0>9||n0!==$W||r0<8||r0>15||e0<0||e0>9||o0<0||o0>XW||r0===8&&s0!==1)return lH(t0,WW);r0===8&&(r0=9);const a0=new bH;return t0.state=a0,a0.strm=t0,a0.status=aH,a0.wrap=s0,a0.gzhead=null,a0.w_bits=r0,a0.w_size=1<<a0.w_bits,a0.w_mask=a0.w_size-1,a0.hash_bits=i0+7,a0.hash_size=1<<a0.hash_bits,a0.hash_mask=a0.hash_size-1,a0.hash_shift=~~((a0.hash_bits+3-1)/3),a0.window=new Uint8Array(2*a0.w_size),a0.head=new Uint16Array(a0.hash_size),a0.prev=new Uint16Array(a0.w_size),a0.lit_bufsize=1<<i0+6,a0.pending_buf_size=4*a0.lit_bufsize,a0.pending_buf=new Uint8Array(a0.pending_buf_size),a0.sym_buf=a0.lit_bufsize,a0.sym_end=3*(a0.lit_bufsize-1),a0.level=e0,a0.strategy=o0,a0.method=n0,NH(t0)};var PH=(t0,e0)=>{if(wH(t0)||e0>BW||e0<0)return t0?lH(t0,WW):WW;const n0=t0.state;if(!t0.output||t0.avail_in!==0&&!t0.input||n0.status===dH&&e0!==FW)return lH(t0,t0.avail_out===0?KW:WW);const r0=n0.last_flush;if(n0.last_flush=e0,n0.pending!==0){if(EH(t0),t0.avail_out===0)return n0.last_flush=-1,jW}else if(t0.avail_in===0&&uH(e0)<=uH(r0)&&e0!==FW)return lH(t0,KW);if(n0.status===dH&&t0.avail_in!==0)return lH(t0,KW);if(n0.status===aH&&n0.wrap===0&&(n0.status=cH),n0.status===aH){let i0=$W+(n0.w_bits-8<<4)<<8,o0=-1;if(o0=n0.strategy>=zW||n0.level<2?0:n0.level<6?1:n0.level===6?2:3,i0|=o0<<6,n0.strstart!==0&&(i0|=32),i0+=31-i0%31,TH(n0,i0),n0.strstart!==0&&(TH(n0,t0.adler>>>16),TH(n0,65535&t0.adler)),t0.adler=1,n0.status=cH,EH(t0),n0.pending!==0)return n0.last_flush=-1,jW}if(n0.status===57){if(t0.adler=0,mH(n0,31),mH(n0,139),mH(n0,8),n0.gzhead)mH(n0,(n0.gzhead.text?1:0)+(n0.gzhead.hcrc?2:0)+(n0.gzhead.extra?4:0)+(n0.gzhead.name?8:0)+(n0.gzhead.comment?16:0)),mH(n0,255&n0.gzhead.time),mH(n0,n0.gzhead.time>>8&255),mH(n0,n0.gzhead.time>>16&255),mH(n0,n0.gzhead.time>>24&255),mH(n0,n0.level===9?2:n0.strategy>=zW||n0.level<2?4:0),mH(n0,255&n0.gzhead.os),n0.gzhead.extra&&n0.gzhead.extra.length&&(mH(n0,255&n0.gzhead.extra.length),mH(n0,n0.gzhead.extra.length>>8&255)),n0.gzhead.hcrc&&(t0.adler=wW(t0.adler,n0.pending_buf,n0.pending,0)),n0.gzindex=0,n0.status=69;else if(mH(n0,0),mH(n0,0),mH(n0,0),mH(n0,0),mH(n0,0),mH(n0,n0.level===9?2:n0.strategy>=zW||n0.level<2?4:0),mH(n0,3),n0.status=cH,EH(t0),n0.pending!==0)return n0.last_flush=-1,jW}if(n0.status===69){if(n0.gzhead.extra){let i0=n0.pending,o0=(65535&n0.gzhead.extra.length)-n0.gzindex;for(;n0.pending+o0>n0.pending_buf_size;){let a0=n0.pending_buf_size-n0.pending;if(n0.pending_buf.set(n0.gzhead.extra.subarray(n0.gzindex,n0.gzindex+a0),n0.pending),n0.pending=n0.pending_buf_size,n0.gzhead.hcrc&&n0.pending>i0&&(t0.adler=wW(t0.adler,n0.pending_buf,n0.pending-i0,i0)),n0.gzindex+=a0,EH(t0),n0.pending!==0)return n0.last_flush=-1,jW;i0=0,o0-=a0}let s0=new Uint8Array(n0.gzhead.extra);n0.pending_buf.set(s0.subarray(n0.gzindex,n0.gzindex+o0),n0.pending),n0.pending+=o0,n0.gzhead.hcrc&&n0.pending>i0&&(t0.adler=wW(t0.adler,n0.pending_buf,n0.pending-i0,i0)),n0.gzindex=0}n0.status=73}if(n0.status===73){if(n0.gzhead.name){let i0,o0=n0.pending;do{if(n0.pending===n0.pending_buf_size){if(n0.gzhead.hcrc&&n0.pending>o0&&(t0.adler=wW(t0.adler,n0.pending_buf,n0.pending-o0,o0)),EH(t0),n0.pending!==0)return n0.last_flush=-1,jW;o0=0}i0=n0.gzindex<n0.gzhead.name.length?255&n0.gzhead.name.charCodeAt(n0.gzindex++):0,mH(n0,i0)}while(i0!==0);n0.gzhead.hcrc&&n0.pending>o0&&(t0.adler=wW(t0.adler,n0.pending_buf,n0.pending-o0,o0)),n0.gzindex=0}n0.status=91}if(n0.status===91){if(n0.gzhead.comment){let i0,o0=n0.pending;do{if(n0.pending===n0.pending_buf_size){if(n0.gzhead.hcrc&&n0.pending>o0&&(t0.adler=wW(t0.adler,n0.pending_buf,n0.pending-o0,o0)),EH(t0),n0.pending!==0)return n0.last_flush=-1,jW;o0=0}i0=n0.gzindex<n0.gzhead.comment.length?255&n0.gzhead.comment.charCodeAt(n0.gzindex++):0,mH(n0,i0)}while(i0!==0);n0.gzhead.hcrc&&n0.pending>o0&&(t0.adler=wW(t0.adler,n0.pending_buf,n0.pending-o0,o0))}n0.status=103}if(n0.status===103){if(n0.gzhead.hcrc){if(n0.pending+2>n0.pending_buf_size&&(EH(t0),n0.pending!==0))return n0.last_flush=-1,jW;mH(n0,255&t0.adler),mH(n0,t0.adler>>8&255),t0.adler=0}if(n0.status=cH,EH(t0),n0.pending!==0)return n0.last_flush=-1,jW}if(t0.avail_in!==0||n0.lookahead!==0||e0!==UW&&n0.status!==dH){let i0=n0.level===0?CH(n0,e0):n0.strategy===zW?((o0,s0)=>{let a0;for(;;){if(o0.lookahead===0&&(RH(o0),o0.lookahead===0)){if(s0===UW)return 1;break}if(o0.match_length=0,a0=kW(o0,0,o0.window[o0.strstart]),o0.lookahead--,o0.strstart++,a0&&(fH(o0,!1),o0.strm.avail_out===0))return 1}return o0.insert=0,s0===FW?(fH(o0,!0),o0.strm.avail_out===0?3:4):o0.sym_next&&(fH(o0,!1),o0.strm.avail_out===0)?1:2})(n0,e0):n0.strategy===JW?((o0,s0)=>{let a0,c0,u0,l0;const d0=o0.window;for(;;){if(o0.lookahead<=oH){if(RH(o0),o0.lookahead<=oH&&s0===UW)return 1;if(o0.lookahead===0)break}if(o0.match_length=0,o0.lookahead>=3&&o0.strstart>0&&(u0=o0.strstart-1,c0=d0[u0],c0===d0[++u0]&&c0===d0[++u0]&&c0===d0[++u0])){l0=o0.strstart+oH;do;while(c0===d0[++u0]&&c0===d0[++u0]&&c0===d0[++u0]&&c0===d0[++u0]&&c0===d0[++u0]&&c0===d0[++u0]&&c0===d0[++u0]&&c0===d0[++u0]&&u0<l0);o0.match_length=oH-(l0-u0),o0.match_length>o0.lookahead&&(o0.match_length=o0.lookahead)}if(o0.match_length>=3?(a0=kW(o0,1,o0.match_length-3),o0.lookahead-=o0.match_length,o0.strstart+=o0.match_length,o0.match_length=0):(a0=kW(o0,0,o0.window[o0.strstart]),o0.lookahead--,o0.strstart++),a0&&(fH(o0,!1),o0.strm.avail_out===0))return 1}return o0.insert=0,s0===FW?(fH(o0,!0),o0.strm.avail_out===0?3:4):o0.sym_next&&(fH(o0,!1),o0.strm.avail_out===0)?1:2})(n0,e0):AH[n0.level].func(n0,e0);if(i0!==3&&i0!==4||(n0.status=dH),i0===1||i0===3)return t0.avail_out===0&&(n0.last_flush=-1),jW;if(i0===2&&(e0===xW?MW(n0):e0!==BW&&(PW(n0,0,0,!1),e0===VW&&(hH(n0.head),n0.lookahead===0&&(n0.strstart=0,n0.block_start=0,n0.insert=0))),EH(t0),t0.avail_out===0))return n0.last_flush=-1,jW}return e0!==FW?jW:n0.wrap<=0?GW:(n0.wrap===2?(mH(n0,255&t0.adler),mH(n0,t0.adler>>8&255),mH(n0,t0.adler>>16&255),mH(n0,t0.adler>>24&255),mH(n0,255&t0.total_in),mH(n0,t0.total_in>>8&255),mH(n0,t0.total_in>>16&255),mH(n0,t0.total_in>>24&255)):(TH(n0,t0.adler>>>16),TH(n0,65535&t0.adler)),EH(t0),n0.wrap>0&&(n0.wrap=-n0.wrap),n0.pending!==0?jW:GW)},LH=(t0,e0)=>{let n0=e0.length;if(wH(t0))return WW;const r0=t0.state,i0=r0.wrap;if(i0===2||i0===1&&r0.status!==aH||r0.lookahead)return WW;if(i0===1&&(t0.adler=AW(t0.adler,e0,n0,0)),r0.wrap=0,n0>=r0.w_size){i0===0&&(hH(r0.head),r0.strstart=0,r0.block_start=0,r0.insert=0);let c0=new Uint8Array(r0.w_size);c0.set(e0.subarray(n0-r0.w_size,n0),0),e0=c0,n0=r0.w_size}const o0=t0.avail_in,s0=t0.next_in,a0=t0.input;for(t0.avail_in=n0,t0.next_in=0,t0.input=e0,RH(r0);r0.lookahead>=3;){let c0=r0.strstart,u0=r0.lookahead-2;do r0.ins_h=_H(r0,r0.ins_h,r0.window[c0+3-1]),r0.prev[c0&r0.w_mask]=r0.head[r0.ins_h],r0.head[r0.ins_h]=c0,c0++;while(--u0);r0.strstart=c0,r0.lookahead=2,RH(r0)}return r0.strstart+=r0.lookahead,r0.block_start=r0.strstart,r0.insert=r0.lookahead,r0.lookahead=0,r0.match_length=r0.prev_length=2,r0.match_available=0,t0.next_in=s0,t0.input=a0,t0.avail_in=o0,r0.wrap=i0,jW},kH={deflateInit:(t0,e0)=>DH(t0,e0,$W,15,8,QW),deflateInit2:DH,deflateReset:NH,deflateResetKeep:OH,deflateSetHeader:(t0,e0)=>wH(t0)||t0.state.wrap!==2?WW:(t0.state.gzhead=e0,jW),deflate:PH,deflateEnd:t0=>{if(wH(t0))return WW;const e0=t0.state.status;return t0.state=null,e0===cH?lH(t0,HW):jW},deflateSetDictionary:LH,deflateInfo:"pako deflate (from Nodeca project)"};const MH=(t0,e0)=>Object.prototype.hasOwnProperty.call(t0,e0);var UH={assign:function(t0){const e0=Array.prototype.slice.call(arguments,1);for(;e0.length;){const n0=e0.shift();if(n0){if(typeof n0!="object")throw new TypeError(n0+"must be non-object");for(const r0 in n0)MH(n0,r0)&&(t0[r0]=n0[r0])}}return t0},flattenChunks:t0=>{let e0=0;for(let r0=0,i0=t0.length;r0<i0;r0++)e0+=t0[r0].length;const n0=new Uint8Array(e0);for(let r0=0,i0=0,o0=t0.length;r0<o0;r0++){let s0=t0[r0];n0.set(s0,i0),i0+=s0.length}return n0}};let xH=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{xH=!1}const VH=new Uint8Array(256);for(let t0=0;t0<256;t0++)VH[t0]=t0>=252?6:t0>=248?5:t0>=240?4:t0>=224?3:t0>=192?2:1;VH[254]=VH[254]=1;var FH={string2buf:t0=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t0);let e0,n0,r0,i0,o0,s0=t0.length,a0=0;for(i0=0;i0<s0;i0++)n0=t0.charCodeAt(i0),(64512&n0)==55296&&i0+1<s0&&(r0=t0.charCodeAt(i0+1),(64512&r0)==56320&&(n0=65536+(n0-55296<<10)+(r0-56320),i0++)),a0+=n0<128?1:n0<2048?2:n0<65536?3:4;for(e0=new Uint8Array(a0),o0=0,i0=0;o0<a0;i0++)n0=t0.charCodeAt(i0),(64512&n0)==55296&&i0+1<s0&&(r0=t0.charCodeAt(i0+1),(64512&r0)==56320&&(n0=65536+(n0-55296<<10)+(r0-56320),i0++)),n0<128?e0[o0++]=n0:n0<2048?(e0[o0++]=192|n0>>>6,e0[o0++]=128|63&n0):n0<65536?(e0[o0++]=224|n0>>>12,e0[o0++]=128|n0>>>6&63,e0[o0++]=128|63&n0):(e0[o0++]=240|n0>>>18,e0[o0++]=128|n0>>>12&63,e0[o0++]=128|n0>>>6&63,e0[o0++]=128|63&n0);return e0},buf2string:(t0,e0)=>{const n0=e0||t0.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t0.subarray(0,e0));let r0,i0;const o0=new Array(2*n0);for(i0=0,r0=0;r0<n0;){let s0=t0[r0++];if(s0<128){o0[i0++]=s0;continue}let a0=VH[s0];if(a0>4)o0[i0++]=65533,r0+=a0-1;else{for(s0&=a0===2?31:a0===3?15:7;a0>1&&r0<n0;)s0=s0<<6|63&t0[r0++],a0--;a0>1?o0[i0++]=65533:s0<65536?o0[i0++]=s0:(s0-=65536,o0[i0++]=55296|s0>>10&1023,o0[i0++]=56320|1023&s0)}}return((s0,a0)=>{if(a0<65534&&s0.subarray&&xH)return String.fromCharCode.apply(null,s0.length===a0?s0:s0.subarray(0,a0));let c0="";for(let u0=0;u0<a0;u0++)c0+=String.fromCharCode(s0[u0]);return c0})(o0,i0)},utf8border:(t0,e0)=>{(e0=e0||t0.length)>t0.length&&(e0=t0.length);let n0=e0-1;for(;n0>=0&&(192&t0[n0])==128;)n0--;return n0<0||n0===0?e0:n0+VH[t0[n0]]>e0?n0:e0}},BH=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const jH=Object.prototype.toString,{Z_NO_FLUSH:GH,Z_SYNC_FLUSH:WH,Z_FULL_FLUSH:HH,Z_FINISH:KH,Z_OK:YH,Z_STREAM_END:qH,Z_DEFAULT_COMPRESSION:zH,Z_DEFAULT_STRATEGY:JH,Z_DEFLATED:XH}=NW;function QH(t0){this.options=UH.assign({level:zH,method:XH,chunkSize:16384,windowBits:15,memLevel:8,strategy:JH},t0||{});let e0=this.options;e0.raw&&e0.windowBits>0?e0.windowBits=-e0.windowBits:e0.gzip&&e0.windowBits>0&&e0.windowBits<16&&(e0.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BH,this.strm.avail_out=0;let n0=kH.deflateInit2(this.strm,e0.level,e0.method,e0.windowBits,e0.memLevel,e0.strategy);if(n0!==YH)throw new Error(OW[n0]);if(e0.header&&kH.deflateSetHeader(this.strm,e0.header),e0.dictionary){let r0;if(r0=typeof e0.dictionary=="string"?FH.string2buf(e0.dictionary):jH.call(e0.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e0.dictionary):e0.dictionary,n0=kH.deflateSetDictionary(this.strm,r0),n0!==YH)throw new Error(OW[n0]);this._dict_set=!0}}function ZH(t0,e0){const n0=new QH(e0);if(n0.push(t0,!0),n0.err)throw n0.msg||OW[n0.err];return n0.result}QH.prototype.push=function(t0,e0){const n0=this.strm,r0=this.options.chunkSize;let i0,o0;if(this.ended)return!1;for(o0=e0===~~e0?e0:e0===!0?KH:GH,typeof t0=="string"?n0.input=FH.string2buf(t0):jH.call(t0)==="[object ArrayBuffer]"?n0.input=new Uint8Array(t0):n0.input=t0,n0.next_in=0,n0.avail_in=n0.input.length;;)if(n0.avail_out===0&&(n0.output=new Uint8Array(r0),n0.next_out=0,n0.avail_out=r0),(o0===WH||o0===HH)&&n0.avail_out<=6)this.onData(n0.output.subarray(0,n0.next_out)),n0.avail_out=0;else{if(i0=kH.deflate(n0,o0),i0===qH)return n0.next_out>0&&this.onData(n0.output.subarray(0,n0.next_out)),i0=kH.deflateEnd(this.strm),this.onEnd(i0),this.ended=!0,i0===YH;if(n0.avail_out!==0){if(o0>0&&n0.next_out>0)this.onData(n0.output.subarray(0,n0.next_out)),n0.avail_out=0;else if(n0.avail_in===0)break}else this.onData(n0.output)}return!0},QH.prototype.onData=function(t0){this.chunks.push(t0)},QH.prototype.onEnd=function(t0){t0===YH&&(this.result=UH.flattenChunks(this.chunks)),this.chunks=[],this.err=t0,this.msg=this.strm.msg};var $H={Deflate:QH,deflate:ZH,deflateRaw:function(t0,e0){return(e0=e0||{}).raw=!0,ZH(t0,e0)},gzip:function(t0,e0){return(e0=e0||{}).gzip=!0,ZH(t0,e0)},constants:NW};const eK=16209;var tK=function(t0,e0){let n0,r0,i0,o0,s0,a0,c0,u0,l0,d0,h0,p0,m0,f0,g0,E0,_0,y0,b0,S0,w0,I0,L0,M0;const C0=t0.state;n0=t0.next_in,L0=t0.input,r0=n0+(t0.avail_in-5),i0=t0.next_out,M0=t0.output,o0=i0-(e0-t0.avail_out),s0=i0+(t0.avail_out-257),a0=C0.dmax,c0=C0.wsize,u0=C0.whave,l0=C0.wnext,d0=C0.window,h0=C0.hold,p0=C0.bits,m0=C0.lencode,f0=C0.distcode,g0=(1<<C0.lenbits)-1,E0=(1<<C0.distbits)-1;t:do{p0<15&&(h0+=L0[n0++]<<p0,p0+=8,h0+=L0[n0++]<<p0,p0+=8),_0=m0[h0&g0];e:for(;;){if(y0=_0>>>24,h0>>>=y0,p0-=y0,y0=_0>>>16&255,y0===0)M0[i0++]=65535&_0;else{if(!(16&y0)){if(!(64&y0)){_0=m0[(65535&_0)+(h0&(1<<y0)-1)];continue e}if(32&y0){C0.mode=16191;break t}t0.msg="invalid literal/length code",C0.mode=eK;break t}b0=65535&_0,y0&=15,y0&&(p0<y0&&(h0+=L0[n0++]<<p0,p0+=8),b0+=h0&(1<<y0)-1,h0>>>=y0,p0-=y0),p0<15&&(h0+=L0[n0++]<<p0,p0+=8,h0+=L0[n0++]<<p0,p0+=8),_0=f0[h0&E0];n:for(;;){if(y0=_0>>>24,h0>>>=y0,p0-=y0,y0=_0>>>16&255,!(16&y0)){if(!(64&y0)){_0=f0[(65535&_0)+(h0&(1<<y0)-1)];continue n}t0.msg="invalid distance code",C0.mode=eK;break t}if(S0=65535&_0,y0&=15,p0<y0&&(h0+=L0[n0++]<<p0,p0+=8,p0<y0&&(h0+=L0[n0++]<<p0,p0+=8)),S0+=h0&(1<<y0)-1,S0>a0){t0.msg="invalid distance too far back",C0.mode=eK;break t}if(h0>>>=y0,p0-=y0,y0=i0-o0,S0>y0){if(y0=S0-y0,y0>u0&&C0.sane){t0.msg="invalid distance too far back",C0.mode=eK;break t}if(w0=0,I0=d0,l0===0){if(w0+=c0-y0,y0<b0){b0-=y0;do M0[i0++]=d0[w0++];while(--y0);w0=i0-S0,I0=M0}}else if(l0<y0){if(w0+=c0+l0-y0,y0-=l0,y0<b0){b0-=y0;do M0[i0++]=d0[w0++];while(--y0);if(w0=0,l0<b0){y0=l0,b0-=y0;do M0[i0++]=d0[w0++];while(--y0);w0=i0-S0,I0=M0}}}else if(w0+=l0-y0,y0<b0){b0-=y0;do M0[i0++]=d0[w0++];while(--y0);w0=i0-S0,I0=M0}for(;b0>2;)M0[i0++]=I0[w0++],M0[i0++]=I0[w0++],M0[i0++]=I0[w0++],b0-=3;b0&&(M0[i0++]=I0[w0++],b0>1&&(M0[i0++]=I0[w0++]))}else{w0=i0-S0;do M0[i0++]=M0[w0++],M0[i0++]=M0[w0++],M0[i0++]=M0[w0++],b0-=3;while(b0>2);b0&&(M0[i0++]=M0[w0++],b0>1&&(M0[i0++]=M0[w0++]))}break}}break}}while(n0<r0&&i0<s0);b0=p0>>3,n0-=b0,p0-=b0<<3,h0&=(1<<p0)-1,t0.next_in=n0,t0.next_out=i0,t0.avail_in=n0<r0?r0-n0+5:5-(n0-r0),t0.avail_out=i0<s0?s0-i0+257:257-(i0-s0),C0.hold=h0,C0.bits=p0};const iK=15,nK=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),rK=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),oK=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),sK=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var aK=(t0,e0,n0,r0,i0,o0,s0,a0)=>{const c0=a0.bits;let u0,l0,d0,h0,p0,m0,f0=0,g0=0,E0=0,_0=0,y0=0,b0=0,S0=0,w0=0,I0=0,L0=0,M0=null;const C0=new Uint16Array(16),U0=new Uint16Array(16);let x0,j0,k0,D0=null;for(f0=0;f0<=iK;f0++)C0[f0]=0;for(g0=0;g0<r0;g0++)C0[e0[n0+g0]]++;for(y0=c0,_0=iK;_0>=1&&C0[_0]===0;_0--);if(y0>_0&&(y0=_0),_0===0)return i0[o0++]=20971520,i0[o0++]=20971520,a0.bits=1,0;for(E0=1;E0<_0&&C0[E0]===0;E0++);for(y0<E0&&(y0=E0),w0=1,f0=1;f0<=iK;f0++)if(w0<<=1,w0-=C0[f0],w0<0)return-1;if(w0>0&&(t0===0||_0!==1))return-1;for(U0[1]=0,f0=1;f0<iK;f0++)U0[f0+1]=U0[f0]+C0[f0];for(g0=0;g0<r0;g0++)e0[n0+g0]!==0&&(s0[U0[e0[n0+g0]]++]=g0);if(t0===0?(M0=D0=s0,m0=20):t0===1?(M0=nK,D0=rK,m0=257):(M0=oK,D0=sK,m0=0),L0=0,g0=0,f0=E0,p0=o0,b0=y0,S0=0,d0=-1,I0=1<<y0,h0=I0-1,t0===1&&I0>852||t0===2&&I0>592)return 1;for(;;){x0=f0-S0,s0[g0]+1<m0?(j0=0,k0=s0[g0]):s0[g0]>=m0?(j0=D0[s0[g0]-m0],k0=M0[s0[g0]-m0]):(j0=96,k0=0),u0=1<<f0-S0,l0=1<<b0,E0=l0;do l0-=u0,i0[p0+(L0>>S0)+l0]=x0<<24|j0<<16|k0|0;while(l0!==0);for(u0=1<<f0-1;L0&u0;)u0>>=1;if(u0!==0?(L0&=u0-1,L0+=u0):L0=0,g0++,--C0[f0]==0){if(f0===_0)break;f0=e0[n0+s0[g0]]}if(f0>y0&&(L0&h0)!==d0){for(S0===0&&(S0=y0),p0+=E0,b0=f0-S0,w0=1<<b0;b0+S0<_0&&(w0-=C0[b0+S0],!(w0<=0));)b0++,w0<<=1;if(I0+=1<<b0,t0===1&&I0>852||t0===2&&I0>592)return 1;d0=L0&h0,i0[d0]=y0<<24|b0<<16|p0-o0|0}}return L0!==0&&(i0[p0+L0]=f0-S0<<24|64<<16|0),a0.bits=y0,0};const{Z_FINISH:cK,Z_BLOCK:dK,Z_TREES:lK,Z_OK:uK,Z_STREAM_END:hK,Z_NEED_DICT:pK,Z_STREAM_ERROR:_K,Z_DATA_ERROR:EK,Z_MEM_ERROR:fK,Z_BUF_ERROR:mK,Z_DEFLATED:TK}=NW,SK=16180,gK=16190,RK=16191,CK=16192,IK=16194,vK=16199,yK=16200,AK=16206,bK=16209,wK=t0=>(t0>>>24&255)+(t0>>>8&65280)+((65280&t0)<<8)+((255&t0)<<24);function OK(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const NK=t0=>{if(!t0)return 1;const e0=t0.state;return!e0||e0.strm!==t0||e0.mode<SK||e0.mode>16211?1:0},DK=t0=>{if(NK(t0))return _K;const e0=t0.state;return t0.total_in=t0.total_out=e0.total=0,t0.msg="",e0.wrap&&(t0.adler=1&e0.wrap),e0.mode=SK,e0.last=0,e0.havedict=0,e0.flags=-1,e0.dmax=32768,e0.head=null,e0.hold=0,e0.bits=0,e0.lencode=e0.lendyn=new Int32Array(852),e0.distcode=e0.distdyn=new Int32Array(592),e0.sane=1,e0.back=-1,uK},PK=t0=>{if(NK(t0))return _K;const e0=t0.state;return e0.wsize=0,e0.whave=0,e0.wnext=0,DK(t0)},LK=(t0,e0)=>{let n0;if(NK(t0))return _K;const r0=t0.state;return e0<0?(n0=0,e0=-e0):(n0=5+(e0>>4),e0<48&&(e0&=15)),e0&&(e0<8||e0>15)?_K:(r0.window!==null&&r0.wbits!==e0&&(r0.window=null),r0.wrap=n0,r0.wbits=e0,PK(t0))},kK=(t0,e0)=>{if(!t0)return _K;const n0=new OK;t0.state=n0,n0.strm=t0,n0.window=null,n0.mode=SK;const r0=LK(t0,e0);return r0!==uK&&(t0.state=null),r0};let MK,UK,xK=!0;const VK=t0=>{if(xK){MK=new Int32Array(512),UK=new Int32Array(32);let e0=0;for(;e0<144;)t0.lens[e0++]=8;for(;e0<256;)t0.lens[e0++]=9;for(;e0<280;)t0.lens[e0++]=7;for(;e0<288;)t0.lens[e0++]=8;for(aK(1,t0.lens,0,288,MK,0,t0.work,{bits:9}),e0=0;e0<32;)t0.lens[e0++]=5;aK(2,t0.lens,0,32,UK,0,t0.work,{bits:5}),xK=!1}t0.lencode=MK,t0.lenbits=9,t0.distcode=UK,t0.distbits=5},FK=(t0,e0,n0,r0)=>{let i0;const o0=t0.state;return o0.window===null&&(o0.wsize=1<<o0.wbits,o0.wnext=0,o0.whave=0,o0.window=new Uint8Array(o0.wsize)),r0>=o0.wsize?(o0.window.set(e0.subarray(n0-o0.wsize,n0),0),o0.wnext=0,o0.whave=o0.wsize):(i0=o0.wsize-o0.wnext,i0>r0&&(i0=r0),o0.window.set(e0.subarray(n0-r0,n0-r0+i0),o0.wnext),(r0-=i0)?(o0.window.set(e0.subarray(n0-r0,n0),0),o0.wnext=r0,o0.whave=o0.wsize):(o0.wnext+=i0,o0.wnext===o0.wsize&&(o0.wnext=0),o0.whave<o0.wsize&&(o0.whave+=i0))),0};var BK=(t0,e0)=>{let n0,r0,i0,o0,s0,a0,c0,u0,l0,d0,h0,p0,m0,f0,g0,E0,_0,y0,b0,S0,w0,I0,L0=0;const M0=new Uint8Array(4);let C0,U0;const x0=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(NK(t0)||!t0.output||!t0.input&&t0.avail_in!==0)return _K;n0=t0.state,n0.mode===RK&&(n0.mode=CK),s0=t0.next_out,i0=t0.output,c0=t0.avail_out,o0=t0.next_in,r0=t0.input,a0=t0.avail_in,u0=n0.hold,l0=n0.bits,d0=a0,h0=c0,I0=uK;t:for(;;)switch(n0.mode){case SK:if(n0.wrap===0){n0.mode=CK;break}for(;l0<16;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}if(2&n0.wrap&&u0===35615){n0.wbits===0&&(n0.wbits=15),n0.check=0,M0[0]=255&u0,M0[1]=u0>>>8&255,n0.check=wW(n0.check,M0,2,0),u0=0,l0=0,n0.mode=16181;break}if(n0.head&&(n0.head.done=!1),!(1&n0.wrap)||(((255&u0)<<8)+(u0>>8))%31){t0.msg="incorrect header check",n0.mode=bK;break}if((15&u0)!==TK){t0.msg="unknown compression method",n0.mode=bK;break}if(u0>>>=4,l0-=4,w0=8+(15&u0),n0.wbits===0&&(n0.wbits=w0),w0>15||w0>n0.wbits){t0.msg="invalid window size",n0.mode=bK;break}n0.dmax=1<<n0.wbits,n0.flags=0,t0.adler=n0.check=1,n0.mode=512&u0?16189:RK,u0=0,l0=0;break;case 16181:for(;l0<16;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}if(n0.flags=u0,(255&VG(n0))!==TK){t0.msg="unknown compression method",n0.mode=bK;break}if(57344&VG(n0)){t0.msg="unknown header flags set",n0.mode=bK;break}n0.head&&(n0.head.text=u0>>8&1),512&VG(n0)&&4&n0.wrap&&(M0[0]=255&u0,M0[1]=u0>>>8&255,n0.check=wW(n0.check,M0,2,0)),u0=0,l0=0,n0.mode=16182;case 16182:for(;l0<32;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}n0.head&&(n0.head.time=u0),512&VG(n0)&&4&n0.wrap&&(M0[0]=255&u0,M0[1]=u0>>>8&255,M0[2]=u0>>>16&255,M0[3]=u0>>>24&255,n0.check=wW(n0.check,M0,4,0)),u0=0,l0=0,n0.mode=16183;case 16183:for(;l0<16;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}n0.head&&(n0.head.xflags=255&u0,n0.head.os=u0>>8),512&VG(n0)&&4&n0.wrap&&(M0[0]=255&u0,M0[1]=u0>>>8&255,n0.check=wW(n0.check,M0,2,0)),u0=0,l0=0,n0.mode=16184;case 16184:if(1024&VG(n0)){for(;l0<16;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}n0.length=u0,n0.head&&(n0.head.extra_len=u0),512&VG(n0)&&4&n0.wrap&&(M0[0]=255&u0,M0[1]=u0>>>8&255,n0.check=wW(n0.check,M0,2,0)),u0=0,l0=0}else n0.head&&(n0.head.extra=null);n0.mode=16185;case 16185:if(1024&VG(n0)&&(p0=n0.length,p0>a0&&(p0=a0),p0&&(n0.head&&(w0=n0.head.extra_len-n0.length,n0.head.extra||(n0.head.extra=new Uint8Array(n0.head.extra_len)),n0.head.extra.set(r0.subarray(o0,o0+p0),w0)),512&VG(n0)&&4&n0.wrap&&(n0.check=wW(n0.check,r0,p0,o0)),a0-=p0,o0+=p0,n0.length-=p0),n0.length))break t;n0.length=0,n0.mode=16186;case 16186:if(2048&VG(n0)){if(a0===0)break t;p0=0;do w0=r0[o0+p0++],n0.head&&w0&&n0.length<65536&&(n0.head.name+=String.fromCharCode(w0));while(w0&&p0<a0);if(512&VG(n0)&&4&n0.wrap&&(n0.check=wW(n0.check,r0,p0,o0)),a0-=p0,o0+=p0,w0)break t}else n0.head&&(n0.head.name=null);n0.length=0,n0.mode=16187;case 16187:if(4096&VG(n0)){if(a0===0)break t;p0=0;do w0=r0[o0+p0++],n0.head&&w0&&n0.length<65536&&(n0.head.comment+=String.fromCharCode(w0));while(w0&&p0<a0);if(512&VG(n0)&&4&n0.wrap&&(n0.check=wW(n0.check,r0,p0,o0)),a0-=p0,o0+=p0,w0)break t}else n0.head&&(n0.head.comment=null);n0.mode=16188;case 16188:if(512&VG(n0)){for(;l0<16;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}if(4&n0.wrap&&u0!==(65535&n0.check)){t0.msg="header crc mismatch",n0.mode=bK;break}u0=0,l0=0}n0.head&&(n0.head.hcrc=VG(n0)>>9&1,n0.head.done=!0),t0.adler=n0.check=0,n0.mode=RK;break;case 16189:for(;l0<32;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}t0.adler=n0.check=wK(u0),u0=0,l0=0,n0.mode=gK;case gK:if(n0.havedict===0)return t0.next_out=s0,t0.avail_out=c0,t0.next_in=o0,t0.avail_in=a0,n0.hold=u0,n0.bits=l0,pK;t0.adler=n0.check=1,n0.mode=RK;case RK:if(e0===dK||e0===lK)break t;case CK:if(n0.last){u0>>>=7&l0,l0-=7&l0,n0.mode=AK;break}for(;l0<3;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}switch(n0.last=1&u0,u0>>>=1,l0-=1,3&u0){case 0:n0.mode=16193;break;case 1:if(VK(n0),n0.mode=vK,e0===lK){u0>>>=2,l0-=2;break t}break;case 2:n0.mode=16196;break;case 3:t0.msg="invalid block type",n0.mode=bK}u0>>>=2,l0-=2;break;case 16193:for(u0>>>=7&l0,l0-=7&l0;l0<32;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}if((65535&u0)!=(u0>>>16^65535)){t0.msg="invalid stored block lengths",n0.mode=bK;break}if(n0.length=65535&u0,u0=0,l0=0,n0.mode=IK,e0===lK)break t;case IK:n0.mode=16195;case 16195:if(p0=n0.length,p0){if(p0>a0&&(p0=a0),p0>c0&&(p0=c0),p0===0)break t;i0.set(r0.subarray(o0,o0+p0),s0),a0-=p0,o0+=p0,c0-=p0,s0+=p0,n0.length-=p0;break}n0.mode=RK;break;case 16196:for(;l0<14;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}if(n0.nlen=257+(31&u0),u0>>>=5,l0-=5,n0.ndist=1+(31&u0),u0>>>=5,l0-=5,n0.ncode=4+(15&u0),u0>>>=4,l0-=4,n0.nlen>286||n0.ndist>30){t0.msg="too many length or distance symbols",n0.mode=bK;break}n0.have=0,n0.mode=16197;case 16197:for(;n0.have<n0.ncode;){for(;l0<3;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}n0.lens[x0[n0.have++]]=7&u0,u0>>>=3,l0-=3}for(;n0.have<19;)n0.lens[x0[n0.have++]]=0;if(n0.lencode=n0.lendyn,n0.lenbits=7,C0={bits:n0.lenbits},I0=aK(0,n0.lens,0,19,n0.lencode,0,n0.work,C0),n0.lenbits=C0.bits,I0){t0.msg="invalid code lengths set",n0.mode=bK;break}n0.have=0,n0.mode=16198;case 16198:for(;n0.have<n0.nlen+n0.ndist;){for(;L0=n0.lencode[u0&(1<<n0.lenbits)-1],g0=L0>>>24,E0=L0>>>16&255,_0=65535&L0,!(g0<=l0);){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}if(_0<16)u0>>>=g0,l0-=g0,n0.lens[n0.have++]=_0;else{if(_0===16){for(U0=g0+2;l0<U0;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}if(u0>>>=g0,l0-=g0,n0.have===0){t0.msg="invalid bit length repeat",n0.mode=bK;break}w0=n0.lens[n0.have-1],p0=3+(3&u0),u0>>>=2,l0-=2}else if(_0===17){for(U0=g0+3;l0<U0;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}u0>>>=g0,l0-=g0,w0=0,p0=3+(7&u0),u0>>>=3,l0-=3}else{for(U0=g0+7;l0<U0;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}u0>>>=g0,l0-=g0,w0=0,p0=11+(127&u0),u0>>>=7,l0-=7}if(n0.have+p0>n0.nlen+n0.ndist){t0.msg="invalid bit length repeat",n0.mode=bK;break}for(;p0--;)n0.lens[n0.have++]=w0}}if(n0.mode===bK)break;if(n0.lens[256]===0){t0.msg="invalid code -- missing end-of-block",n0.mode=bK;break}if(n0.lenbits=9,C0={bits:n0.lenbits},I0=aK(1,n0.lens,0,n0.nlen,n0.lencode,0,n0.work,C0),n0.lenbits=C0.bits,I0){t0.msg="invalid literal/lengths set",n0.mode=bK;break}if(n0.distbits=6,n0.distcode=n0.distdyn,C0={bits:n0.distbits},I0=aK(2,n0.lens,n0.nlen,n0.ndist,n0.distcode,0,n0.work,C0),n0.distbits=C0.bits,I0){t0.msg="invalid distances set",n0.mode=bK;break}if(n0.mode=vK,e0===lK)break t;case vK:n0.mode=yK;case yK:if(a0>=6&&c0>=258){t0.next_out=s0,t0.avail_out=c0,t0.next_in=o0,t0.avail_in=a0,n0.hold=u0,n0.bits=l0,tK(t0,h0),s0=t0.next_out,i0=t0.output,c0=t0.avail_out,o0=t0.next_in,r0=t0.input,a0=t0.avail_in,u0=n0.hold,l0=n0.bits,n0.mode===RK&&(n0.back=-1);break}for(n0.back=0;L0=n0.lencode[u0&(1<<n0.lenbits)-1],g0=L0>>>24,E0=L0>>>16&255,_0=65535&L0,!(g0<=l0);){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}if(E0&&!(240&E0)){for(y0=g0,b0=E0,S0=_0;L0=n0.lencode[S0+((u0&(1<<y0+b0)-1)>>y0)],g0=L0>>>24,E0=L0>>>16&255,_0=65535&L0,!(y0+g0<=l0);){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}u0>>>=y0,l0-=y0,n0.back+=y0}if(u0>>>=g0,l0-=g0,n0.back+=g0,n0.length=_0,E0===0){n0.mode=16205;break}if(32&E0){n0.back=-1,n0.mode=RK;break}if(64&E0){t0.msg="invalid literal/length code",n0.mode=bK;break}n0.extra=15&E0,n0.mode=16201;case 16201:if(n0.extra){for(U0=n0.extra;l0<U0;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}n0.length+=u0&(1<<n0.extra)-1,u0>>>=n0.extra,l0-=n0.extra,n0.back+=n0.extra}n0.was=n0.length,n0.mode=16202;case 16202:for(;L0=n0.distcode[u0&(1<<n0.distbits)-1],g0=L0>>>24,E0=L0>>>16&255,_0=65535&L0,!(g0<=l0);){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}if(!(240&E0)){for(y0=g0,b0=E0,S0=_0;L0=n0.distcode[S0+((u0&(1<<y0+b0)-1)>>y0)],g0=L0>>>24,E0=L0>>>16&255,_0=65535&L0,!(y0+g0<=l0);){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}u0>>>=y0,l0-=y0,n0.back+=y0}if(u0>>>=g0,l0-=g0,n0.back+=g0,64&E0){t0.msg="invalid distance code",n0.mode=bK;break}n0.offset=_0,n0.extra=15&E0,n0.mode=16203;case 16203:if(n0.extra){for(U0=n0.extra;l0<U0;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}n0.offset+=u0&(1<<n0.extra)-1,u0>>>=n0.extra,l0-=n0.extra,n0.back+=n0.extra}if(n0.offset>n0.dmax){t0.msg="invalid distance too far back",n0.mode=bK;break}n0.mode=16204;case 16204:if(c0===0)break t;if(p0=h0-c0,n0.offset>p0){if(p0=n0.offset-p0,p0>n0.whave&&n0.sane){t0.msg="invalid distance too far back",n0.mode=bK;break}p0>n0.wnext?(p0-=n0.wnext,m0=n0.wsize-p0):m0=n0.wnext-p0,p0>n0.length&&(p0=n0.length),f0=n0.window}else f0=i0,m0=s0-n0.offset,p0=n0.length;p0>c0&&(p0=c0),c0-=p0,n0.length-=p0;do i0[s0++]=f0[m0++];while(--p0);n0.length===0&&(n0.mode=yK);break;case 16205:if(c0===0)break t;i0[s0++]=n0.length,c0--,n0.mode=yK;break;case AK:if(n0.wrap){for(;l0<32;){if(a0===0)break t;a0--,u0|=r0[o0++]<<l0,l0+=8}if(h0-=c0,t0.total_out+=h0,n0.total+=h0,4&n0.wrap&&h0&&(t0.adler=n0.check=VG(n0)?wW(n0.check,i0,h0,s0-h0):AW(n0.check,i0,h0,s0-h0)),h0=c0,4&n0.wrap&&(VG(n0)?u0:wK(u0))!==n0.check){t0.msg="incorrect data check",n0.mode=bK;break}u0=0,l0=0}n0.mode=16207;case 16207:if(n0.wrap&&VG(n0)){for(;l0<32;){if(a0===0)break t;a0--,u0+=r0[o0++]<<l0,l0+=8}if(4&n0.wrap&&u0!==(4294967295&n0.total)){t0.msg="incorrect length check",n0.mode=bK;break}u0=0,l0=0}n0.mode=16208;case 16208:I0=hK;break t;case bK:I0=EK;break t;case 16210:return fK;default:return _K}return t0.next_out=s0,t0.avail_out=c0,t0.next_in=o0,t0.avail_in=a0,n0.hold=u0,n0.bits=l0,(n0.wsize||h0!==t0.avail_out&&n0.mode<bK&&(n0.mode<AK||e0!==cK))&&FK(t0,t0.output,t0.next_out,h0-t0.avail_out),d0-=t0.avail_in,h0-=t0.avail_out,t0.total_in+=d0,t0.total_out+=h0,n0.total+=h0,4&n0.wrap&&h0&&(t0.adler=n0.check=VG(n0)?wW(n0.check,i0,h0,t0.next_out-h0):AW(n0.check,i0,h0,t0.next_out-h0)),t0.data_type=n0.bits+(n0.last?64:0)+(n0.mode===RK?128:0)+(n0.mode===vK||n0.mode===IK?256:0),(d0===0&&h0===0||e0===cK)&&I0===uK&&(I0=mK),I0},jK={inflateReset:PK,inflateReset2:LK,inflateResetKeep:DK,inflateInit:t0=>kK(t0,15),inflateInit2:kK,inflate:BK,inflateEnd:t0=>{if(NK(t0))return _K;let e0=t0.state;return e0.window&&(e0.window=null),t0.state=null,uK},inflateGetHeader:(t0,e0)=>{if(NK(t0))return _K;const n0=t0.state;return 2&n0.wrap?(n0.head=e0,e0.done=!1,uK):_K},inflateSetDictionary:(t0,e0)=>{const n0=e0.length;let r0,i0,o0;return NK(t0)?_K:(r0=t0.state,r0.wrap!==0&&r0.mode!==gK?_K:r0.mode===gK&&(i0=1,i0=AW(i0,e0,n0,0),i0!==r0.check)?EK:(o0=FK(t0,e0,n0,n0),o0?(r0.mode=16210,fK):(r0.havedict=1,uK)))},inflateInfo:"pako inflate (from Nodeca project)"},GK=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const WK=Object.prototype.toString,{Z_NO_FLUSH:HK,Z_FINISH:KK,Z_OK:YK,Z_STREAM_END:qK,Z_NEED_DICT:zK,Z_STREAM_ERROR:JK,Z_DATA_ERROR:XK,Z_MEM_ERROR:QK}=NW;function ZK(t0){this.options=UH.assign({chunkSize:65536,windowBits:15,to:""},t0||{});const e0=this.options;e0.raw&&e0.windowBits>=0&&e0.windowBits<16&&(e0.windowBits=-e0.windowBits,e0.windowBits===0&&(e0.windowBits=-15)),!(e0.windowBits>=0&&e0.windowBits<16)||t0&&t0.windowBits||(e0.windowBits+=32),e0.windowBits>15&&e0.windowBits<48&&!(15&e0.windowBits)&&(e0.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new BH,this.strm.avail_out=0;let n0=jK.inflateInit2(this.strm,e0.windowBits);if(n0!==YK)throw new Error(OW[n0]);if(this.header=new GK,jK.inflateGetHeader(this.strm,this.header),e0.dictionary&&(typeof e0.dictionary=="string"?e0.dictionary=FH.string2buf(e0.dictionary):WK.call(e0.dictionary)==="[object ArrayBuffer]"&&(e0.dictionary=new Uint8Array(e0.dictionary)),e0.raw&&(n0=jK.inflateSetDictionary(this.strm,e0.dictionary),n0!==YK)))throw new Error(OW[n0])}function $K(t0,e0){const n0=new ZK(e0);if(n0.push(t0),n0.err)throw n0.msg||OW[n0.err];return n0.result}ZK.prototype.push=function(t0,e0){const n0=this.strm,r0=this.options.chunkSize,i0=this.options.dictionary;let o0,s0,a0;if(this.ended)return!1;for(s0=e0===~~e0?e0:e0===!0?KK:HK,WK.call(t0)==="[object ArrayBuffer]"?n0.input=new Uint8Array(t0):n0.input=t0,n0.next_in=0,n0.avail_in=n0.input.length;;){for(n0.avail_out===0&&(n0.output=new Uint8Array(r0),n0.next_out=0,n0.avail_out=r0),o0=jK.inflate(n0,s0),o0===zK&&i0&&(o0=jK.inflateSetDictionary(n0,i0),o0===YK?o0=jK.inflate(n0,s0):o0===XK&&(o0=zK));n0.avail_in>0&&o0===qK&&n0.state.wrap>0&&t0[n0.next_in]!==0;)jK.inflateReset(n0),o0=jK.inflate(n0,s0);switch(o0){case JK:case XK:case zK:case QK:return this.onEnd(o0),this.ended=!0,!1}if(a0=n0.avail_out,n0.next_out&&(n0.avail_out===0||o0===qK))if(this.options.to==="string"){let c0=FH.utf8border(n0.output,n0.next_out),u0=n0.next_out-c0,l0=FH.buf2string(n0.output,c0);n0.next_out=u0,n0.avail_out=r0-u0,u0&&n0.output.set(n0.output.subarray(c0,c0+u0),0),this.onData(l0)}else this.onData(n0.output.length===n0.next_out?n0.output:n0.output.subarray(0,n0.next_out));if(o0!==YK||a0!==0){if(o0===qK)return o0=jK.inflateEnd(this.strm),this.onEnd(o0),this.ended=!0,!0;if(n0.avail_in===0)break}}return!0},ZK.prototype.onData=function(t0){this.chunks.push(t0)},ZK.prototype.onEnd=function(t0){t0===YK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=UH.flattenChunks(this.chunks)),this.chunks=[],this.err=t0,this.msg=this.strm.msg};var eY={Inflate:ZK,inflate:$K,inflateRaw:function(t0,e0){return(e0=e0||{}).raw=!0,$K(t0,e0)},ungzip:$K,constants:NW};const{Deflate:tY,deflate:iY,deflateRaw:nY,gzip:rY}=$H,{Inflate:oY,inflate:sY,inflateRaw:aY,ungzip:cY}=eY;var dY=iY,lY=sY,uY=function(t0){return t0[t0.ONE_BYTE=0]="ONE_BYTE",t0[t0.TWO_BYTE=1]="TWO_BYTE",t0}(uY||{});class hY{constructor(){Fg(this,"_sequence",0),Fg(this,"_startTime",Date.now()),Fg(this,"isUseOneByte",!0)}get startTime(){const e0=Date.now()-this._startTime;return e0<Math.pow(2,16)?e0:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e0){const n0={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e0};if(e0.byteLength>128){const a0=new Uint8Array(4);a0.set([1,0,0,0]);const c0={id:0,length:4,data:a0.buffer},u0={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[c0]};n0.commonPacketHeader.extension=1,n0.extension=u0,n0.payload=this.compress(e0),n0.commonPacketHeader.length=8+(n0.extension.length+2)+n0.payload.byteLength}else n0.commonPacketHeader.length=8+n0.payload.byteLength;XA("SHOW_DATASTREAM2_LOG")&&fb.debug("send data header: ".concat(JSON.stringify(n0.commonPacketHeader)));const r0=new ArrayBuffer(n0.commonPacketHeader.length),i0=new Uint8Array(r0),o0=new DataView(r0);let s0=0;if(o0.setUint16(s0,n0.commonPacketHeader.extension<<15|n0.commonPacketHeader.reserved<<14|n0.commonPacketHeader.length,!0),s0+=2,o0.setUint32(s0,n0.commonPacketHeader.sequence,!0),s0+=4,o0.setUint16(s0,n0.commonStreamHeader,!0),s0+=2,n0.extension){const a0=this.serializeExtension(n0.extension);i0.set(new Uint8Array(a0),s0),s0+=a0.byteLength}if(i0.set(new Uint8Array(n0.payload),s0),s0+=n0.payload.byteLength,s0!==n0.commonPacketHeader.length)throw Error("serialize error!");return r0}deserialize(e0){if(e0.byteLength<4)return new ArrayBuffer(0);const n0=new DataView(e0);let r0=0;const i0=n0.getUint16(r0,!0);r0+=2;const o0={length:16383&i0,reserved:(16384&i0)>>14,extension:(32768&i0)>>15,sequence:n0.getUint16(r0+2,!0)<<16|n0.getUint16(r0,!0)};let s0,a0;if(r0+=4,XA("SHOW_DATASTREAM2_LOG")&&fb.debug("receive data header: ".concat(JSON.stringify(o0))),n0.getUint16(r0,!0),r0+=2,o0.extension){a0=this.deserializeExtension(e0.slice(r0)),r0+=2+a0.length,s0=e0.slice(r0);let c0=!1;if(a0.datas.length>0){const u0=a0.datas.find(l0=>l0.id===0);u0&&(c0=(1&new DataView(u0.data).getUint32(0,!0))==1)}s0=c0?this.decompress(s0):s0}else s0=e0.slice(8);return s0}serializeExtension(e0){const{profile:n0,length:r0,datas:i0}=e0,o0=new ArrayBuffer(r0+2),s0=new Uint8Array(o0),a0=new DataView(o0);let c0=0;if(a0.setUint8(c0++,n0),a0.setUint8(c0++,r0),i0.forEach(u0=>{n0?(a0.setUint8(c0++,u0.id),a0.setUint8(c0++,u0.length),s0.set(new Uint8Array(u0.data),c0),c0+=u0.data.byteLength):(a0.setUint8(c0++,u0.id|u0.length<<4),s0.set(new Uint8Array(u0.data),c0),c0+=u0.data.byteLength)}),c0!==r0+2)throw Error("serialize extension error, is ".concat(c0,"!==").concat(r0+2));return o0}deserializeExtension(e0){const n0=new DataView(e0);let r0=0;const i0=n0.getUint8(r0);r0++;const o0=n0.getUint8(r0);r0++;const s0=i0===uY.TWO_BYTE,a0=[],c0=new DataView(e0,2);let u0=0;for(;u0<o0;){let l0=0,d0=0,h0=new ArrayBuffer(0);s0?(l0=c0.getUint8(u0),u0++,d0=c0.getUint8(u0),u0++):(l0=15&c0.getUint8(u0),d0=c0.getUint8(u0)>>4,u0++),d0>0&&(h0=c0.buffer.slice(u0+2,u0+2+d0),u0+=h0.byteLength),a0.push({id:l0,length:d0,data:h0})}if(u0!==o0)throw Error("parse error");return{profile:i0,length:o0,datas:a0}}decompress(e0){return lY(new Uint8Array(e0))}compress(e0){return dY(new Uint8Array(e0))}}const pY={name:"DataStream",create:(t0,e0)=>{const n0=e0?new bU(t0):new wU(t0);return n0.useDataStream(new hY),n0}};class _Y extends xy{constructor(e0,n0,r0){super(),Fg(this,"ws",void 0),Fg(this,"requestId",1),Fg(this,"heartBeatTimer",void 0),Fg(this,"joinInfo",void 0),Fg(this,"clientId",void 0),Fg(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Fg(this,"onClose",i0=>{this.emit("close"),this.dispose()}),Fg(this,"onMessage",i0=>{const o0=JSON.parse(i0.data);if(!o0||o0.command!=="serverResponse"||!o0.requestId)return o0&&o0.command==="serverStatus"&&o0.serverStatus&&o0.serverStatus.command?(this.emit("status",o0.serverStatus),void this.emit(o0.serverStatus.command,o0.serverStatus)):void 0;this.emit("req_".concat(o0.requestId),o0)}),this.joinInfo=e0,this.clientId=n0,this.ws=new HO("cross-channel-".concat(this.clientId),r0),this.ws.on(Uw.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Uw.CONNECTED,this.onOpen),this.ws.on(Uw.ON_MESSAGE,this.onMessage),this.ws.on(Uw.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e0){const n0=this.requestId++;return e0.requestId=n0,e0.seq=n0,this.ws.sendMessage(e0),n0}waitStatus(e0){return new Gh((n0,r0)=>{const i0=window.setTimeout(()=>{r0(new yb(Ry.TIMEOUT,"wait status timeout, status: ".concat(e0)))},5e3);this.once(e0,o0=>{window.clearTimeout(i0),o0.state&&o0.state!==0?r0(new yb(Ry.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e0))):n0(void 0)}),this.once("dispose",()=>{window.clearTimeout(i0),r0(new yb(Ry.WS_ABORT))})})}async request(e0){if(this.ws.state==="closed")throw new yb(Ry.WS_DISCONNECT);const n0=()=>new Gh((s0,a0)=>{this.ws.once(Uw.CLOSED,()=>a0(new yb(Ry.WS_ABORT))),this.ws.once(Uw.CONNECTED,s0)});this.ws.state!=="connected"&&await n0();const r0=this.sendMessage(e0),i0=new Gh((s0,a0)=>{const c0=()=>{a0(new yb(Ry.WS_ABORT))};this.ws.once(Uw.RECONNECTING,c0),this.ws.once(Uw.CLOSED,c0),this.once("req_".concat(r0),s0),mA(3e3).then(()=>{this.removeAllListeners("req_".concat(r0)),this.ws.off(Uw.RECONNECTING,c0),this.ws.off(Uw.CLOSED,c0),a0(new yb(Ry.TIMEOUT,"cross channel ws request timeout"))})}),o0=await i0;if(!o0||o0.code!==200)throw new yb(Ry.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(o0)));return o0}async connect(e0){this.ws.removeAllListeners(Uw.REQUEST_NEW_URLS),this.ws.on(Uw.REQUEST_NEW_URLS,n0=>{n0(e0)}),await this.ws.init(e0)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e0){const n0=this.requestId++;return e0.requestId=n0,this.ws.sendMessage(e0),n0}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class EY extends xy{set state(e0){e0!==this._state&&(e0!==Xw.RELAY_STATE_FAILURE&&(this.errorCode=Qw.RELAY_OK),this.emit("state",e0,this.errorCode),this._state=e0)}get state(){return this._state}constructor(e0,n0,r0,i0,o0){super(),Fg(this,"joinInfo",void 0),Fg(this,"sid",void 0),Fg(this,"clientId",void 0),Fg(this,"cancelToken",Lv.CancelToken.source()),Fg(this,"workerToken",void 0),Fg(this,"requestId",0),Fg(this,"signal",void 0),Fg(this,"prevChannelMediaConfig",void 0),Fg(this,"httpRetryConfig",void 0),Fg(this,"_resolution",void 0),Fg(this,"_state",Xw.RELAY_STATE_IDLE),Fg(this,"errorCode",Qw.RELAY_OK),Fg(this,"onStatus",s0=>{fb.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(s0))),s0&&s0.command&&(s0.command==="onAudioPacketReceived"&&this.emit("event",Jw.PACKET_RECEIVED_AUDIO_FROM_SRC),s0.command==="onVideoPacketReceived"&&this.emit("event",Jw.PACKET_RECEIVED_VIDEO_FROM_SRC),s0.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Qw.SRC_TOKEN_EXPIRED,this.state=Xw.RELAY_STATE_FAILURE),s0.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Qw.DEST_TOKEN_EXPIRED,this.state=Xw.RELAY_STATE_FAILURE))}),Fg(this,"onReconnect",async()=>{fb.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Jw.NETWORK_DISCONNECTED),this.state=Xw.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(s0=>{this.state!==Xw.RELAY_STATE_IDLE&&(fb.error("auto restart channel media relay failed",s0.toString()),this.errorCode=Qw.SERVER_CONNECTION_LOST,this.state=Xw.RELAY_STATE_FAILURE)})}),this.joinInfo=e0,this.clientId=n0,this.sid=SA(),this.signal=new _Y(this.joinInfo,this.clientId,r0),this.httpRetryConfig=i0,this._resolution=o0}async startChannelMediaRelay(e0){if(this.state!==Xw.RELAY_STATE_IDLE)throw new yb(Ry.INVALID_OPERATION);this.state=Xw.RELAY_STATE_CONNECTING,await this.connect(),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e0)}catch(n0){throw n0.data&&n0.data.serverResponse&&n0.data.serverResponse.command==="SetSourceChannel"?new yb(Ry.CROSS_CHANNEL_FAILED_JOIN_SRC):n0.data&&n0.data.serverResponse&&n0.serverResponse.command==="SetDestChannelStatus"?new yb(Ry.CROSS_CHANNEL_FAILED_JOIN_DEST):n0.data&&n0.data.serverResponse&&n0.serverResponse.command==="StartPacketTransfer"?new yb(Ry.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n0}this.prevChannelMediaConfig=e0}async updateChannelMediaRelay(e0){if(this.state!==Xw.RELAY_STATE_RUNNING)throw new yb(Ry.INVALID_OPERATION);await this.sendUpdateMessage(e0),this.prevChannelMediaConfig=e0}async setVideoProfile(e0){if(this._resolution=e0,this.state!==Xw.RELAY_STATE_RUNNING)throw new yb(Ry.INVALID_OPERATION);const n0=this.genMessage(zw.SetVideoProfile);await this.signal.request(n0),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),fb.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Xw.RELAY_STATE_IDLE,this.dispose()}dispose(){fb.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Lv.CancelToken.source(),this.state=Xw.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e0=await Qx(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e0.workerToken,await this.signal.connect(e0.addressList),this.emit("event",Jw.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e0){const n0=this.genMessage(zw.StopPacketTransfer);await this.signal.request(n0),await this.signal.waitStatus("Normal Quit"),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r0=this.genMessage(zw.SetSdkProfile,e0);await this.signal.request(r0),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i0=this.genMessage(zw.SetSourceChannel,e0);await this.signal.request(i0),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Jw.PACKET_JOINED_SRC_CHANNEL),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const o0=this.genMessage(zw.SetSourceUserId,e0);await this.signal.request(o0),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const s0=this.genMessage(zw.SetDestChannel,e0);await this.signal.request(s0),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Jw.PACKET_JOINED_DEST_CHANNEL),fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a0=this.genMessage(zw.StartPacketTransfer,e0);await this.signal.request(a0),this.emit("event",Jw.PACKET_SENT_TO_DEST_CHANNEL),this.state=Xw.RELAY_STATE_RUNNING,fb.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e0){const n0=this.genMessage(zw.UpdateDestChannel,e0);await this.signal.request(n0),this.emit("event",Jw.PACKET_UPDATE_DEST_CHANNEL),fb.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e0=this.genMessage(zw.StopPacketTransfer);await this.signal.request(e0),fb.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e0,n0){const r0=[],i0=[],o0=[];this.requestId+=1;const s0={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:GA,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};s0.sdkVersion==="4.22.1"&&(s0.sdkVersion="0.0.1");let a0=null,c0=null;switch(e0){case zw.SetSdkProfile:return s0.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s0;case zw.SetSourceChannel:if(c0=n0&&n0.getSrcChannelMediaInfo(),!c0)throw new yb(Ry.UNEXPECTED_ERROR,"can not find source config");return s0.clientRequest={command:"SetSourceChannel",uid:"0",channelName:c0.channelName,token:c0.token||this.joinInfo.appId},s0;case zw.SetSourceUserId:if(c0=n0&&n0.getSrcChannelMediaInfo(),!c0)throw new yb(Ry.UNEXPECTED_ERROR,"can not find source config");return s0.clientRequest={command:"SetSourceUserId",uid:c0.uid+""},s0;case zw.SetDestChannel:if(a0=n0&&n0.getDestChannelMediaInfo(),!a0)throw new yb(Ry.UNEXPECTED_ERROR,"can not find dest config");return a0.forEach(u0=>{r0.push(u0.channelName),i0.push(u0.uid+""),o0.push(u0.token||this.joinInfo.appId)}),s0.clientRequest={command:"SetDestChannel",channelName:r0,uid:i0,token:o0},s0;case zw.StartPacketTransfer:return s0.clientRequest={command:"StartPacketTransfer"},s0;case zw.Reconnect:return s0.clientRequest={command:"Reconnect"},s0;case zw.StopPacketTransfer:return s0.clientRequest={command:"StopPacketTransfer"},s0;case zw.UpdateDestChannel:if(a0=n0&&n0.getDestChannelMediaInfo(),!a0)throw new yb(Ry.UNEXPECTED_ERROR,"can not find dest config");return a0.forEach(u0=>{r0.push(u0.channelName),i0.push(u0.uid+""),o0.push(u0.token||this.joinInfo.appId)}),s0.clientRequest={command:"UpdateDestChannel",channelName:r0,uid:i0,token:o0},s0;case zw.SetVideoProfile:s0.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return s0}}const fY={name:"ChannelMediaRelay",create:function(t0){return new EY(t0.joinInfo,t0.clientId,t0.websocketRetryConfig||PA,t0.httpRetryConfig||PA,t0.resolution)}};function mY(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function TY(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?mY(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):mY(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}class SY extends xy{constructor(e0,n0,r0,i0){super(),Fg(this,"spec",void 0),Fg(this,"token",void 0),Fg(this,"websocket",void 0),Fg(this,"pingpongTimer",void 0),Fg(this,"reconnectMode","retry"),Fg(this,"serviceMode",void 0),Fg(this,"reqId",0),Fg(this,"commandReqId",0),Fg(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Fg(this,"handleWebSocketMessage",o0=>{if(!o0.data)return;const s0=JSON.parse(o0.data);s0.requestId?this.emit("@".concat(s0.requestId,"-").concat(s0.sid),s0):(vb.workerEvent(this.spec.sid,{actionType:"status",serverCode:s0.code,workerType:this.serviceMode===Fw.TRANSCODE?1:2}),this.emit(Hw.PUBLISH_STREAM_STATUS,s0))}),this.spec=n0,this.token=e0,this.serviceMode=i0,this.websocket=new HO("live-streaming",r0),this.websocket.on(Uw.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Uw.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Uw.REQUEST_NEW_URLS,(o0,s0)=>{Zy(this,Hw.REQUEST_NEW_ADDRESS).then(o0).catch(s0)}),this.websocket.on(Uw.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e0){return this.websocket.init(e0)}async request(e0,n0,r0,i0){this.reqId+=1,e0==="request"&&(this.commandReqId+=1);const o0=this.commandReqId,s0=this.reqId;if(!s0||!this.websocket)throw new yb(Ry.UNEXPECTED_ERROR);const a0=TY({command:e0,sdkVersion:GA==="4.22.1"?"0.0.1":GA,seq:s0,requestId:s0,allocate:r0,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n0);if(this.websocket.state==="closed")throw new yb(Ry.WS_DISCONNECT);const c0=()=>new Gh((h0,p0)=>{this.websocket.once(Uw.CLOSED,()=>p0(new yb(Ry.WS_ABORT))),this.websocket.once(Uw.CONNECTED,h0)});this.websocket.state!=="connected"&&await c0(),a0.clientRequest&&(a0.clientRequest.workerToken=this.token);const u0=new Gh((h0,p0)=>{const m0=()=>{p0(new yb(Ry.WS_ABORT))};this.websocket.once(Uw.RECONNECTING,m0),this.websocket.once(Uw.CLOSED,m0),this.once("@".concat(s0,"-").concat(this.spec.sid),f0=>{h0(f0)})});i0&&vb.workerEvent(this.spec.sid,TY(TY({},i0),{},{requestId:o0,actionType:"request",payload:JSON.stringify(n0.clientRequest),serverCode:0,code:0}));const l0=Date.now();this.websocket.sendMessage(a0);let d0=null;try{d0=await u0}catch(h0){if(this.websocket.state==="closed")throw h0;return await c0(),await this.request(e0,n0,r0)}return i0&&vb.workerEvent(this.spec.sid,TY(TY({},i0),{},{requestId:o0,actionType:"response",payload:JSON.stringify(d0.serverResponse),serverCode:d0.code,success:d0.code===200,responseTime:Date.now()-l0})),d0.code!==200&&this.handleResponseError(d0),d0}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e0=GA==="4.22.1"?"0.0.1":GA;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e0,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e0){switch(e0.code){case Yw.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void fb.warning("live stream response already exists stream");case Yw.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Yw.LIVE_STREAM_RESPONSE_BAD_STREAM:case Yw.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new yb(Ry.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e0.code}).throw();case Yw.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e0.serverResponse.command==="UnpublishStream")return;throw new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Yw.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new yb(Ry.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e0.code}).throw();case Yw.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n0=new yb(Ry.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Hw.WARNING,n0,e0.serverResponse.url)}case Yw.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n0=new yb(Ry.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Hw.WARNING,n0,e0.serverResponse.url)}case Yw.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Yw.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new yb(Ry.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e0.code}).throw();case Yw.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n0=new yb(Ry.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Hw.WARNING,n0,e0.serverResponse.url)}case Yw.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e0.code}).throw();case Yw.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Yw.LIVE_STREAM_RESPONSE_WORKER_LOST:case Yw.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e0.serverResponse.command==="UnpublishStream")return;throw new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Yw.ERROR_FAIL_SEND_MESSAGE:if(e0.serverResponse.command==="UnpublishStream")return;if(e0.serverResponse.command==="UpdateTranscoding"||e0.serverResponse.command==="ControlStream")return new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e0.code}).throw();throw new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Yw.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new yb(Ry.LIVE_STREAMING_CDN_ERROR,"",{code:e0.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(gA)},6e3)}}function gY(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function RY(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?gY(Object(n0),!0).forEach(function(r0){Fg(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):gY(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}class CY extends xy{constructor(e0){let n0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:PA,r0=arguments.length>2&&arguments[2]!==void 0?arguments[2]:PA;super(),Fg(this,"onLiveStreamWarning",void 0),Fg(this,"onLiveStreamError",void 0),Fg(this,"spec",void 0),Fg(this,"retryTimeout",1e4),Fg(this,"connection",void 0),Fg(this,"httpRetryConfig",void 0),Fg(this,"wsRetryConfig",void 0),Fg(this,"streamingTasks",new Map),Fg(this,"isStartingStreamingTask",!1),Fg(this,"taskMutex",new NA("live-streaming")),Fg(this,"cancelToken",Lv.CancelToken.source()),Fg(this,"transcodingConfig",void 0),Fg(this,"uapResponse",void 0),Fg(this,"lastTaskId",1),Fg(this,"statusError",new Map),this.spec=e0,this.httpRetryConfig=r0,this.wsRetryConfig=n0}async setTranscodingConfig(e0){const n0=RY(RY({},Ww),e0);n0.videoCodecProfile!==66&&n0.videoCodecProfile!==77&&n0.videoCodecProfile!==100&&(fb.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n0.videoCodecProfile," -> 100")),n0.videoCodecProfile=100),n0.transcodingUsers||(n0.transcodingUsers=n0.userConfigs),n0.transcodingUsers&&(n0.transcodingUsers=n0.transcodingUsers.map(s0=>RY(RY(RY({},Bw),s0),{},{zOrder:s0.zOrder?s0.zOrder+1:1}))),function(s0){Oy(s0.width)||yy(s0.width,"config.width",0,1e4),Oy(s0.height)||yy(s0.height,"config.height",0,1e4),Oy(s0.videoBitrate)||yy(s0.videoBitrate,"config.videoBitrate",1,1e6),Oy(s0.videoFrameRate)||yy(s0.videoFrameRate,"config.videoFrameRate"),Oy(s0.lowLatency)||Iy(s0.lowLatency,"config.lowLatency"),Oy(s0.audioSampleRate)||vy(s0.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Oy(s0.audioBitrate)||yy(s0.audioBitrate,"config.audioBitrate",1,128),Oy(s0.audioChannels)||vy(s0.audioChannels,"config.audioChannels",[1,2,3,4,5]),Oy(s0.videoGop)||yy(s0.videoGop,"config.videoGop"),Oy(s0.videoCodecProfile)||vy(s0.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Oy(s0.userCount)||yy(s0.userCount,"config.userCount",0,17),Oy(s0.backgroundColor)||yy(s0.backgroundColor,"config.backgroundColor",0,16777215),Oy(s0.userConfigExtraInfo)||by(s0.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),s0.transcodingUsers&&!Oy(s0.transcodingUsers)&&(wy(s0.transcodingUsers,"config.transcodingUsers"),s0.transcodingUsers.forEach((a0,c0)=>{Vw(a0.uid),Oy(a0.x)||yy(a0.x,"transcodingUser[".concat(c0,"].x"),0,1e4),Oy(a0.y)||yy(a0.y,"transcodingUser[".concat(c0,"].y"),0,1e4),Oy(a0.width)||yy(a0.width,"transcodingUser[".concat(c0,"].width"),0,1e4),Oy(a0.height)||yy(a0.height,"transcodingUser[".concat(c0,"].height"),0,1e4),Oy(a0.zOrder)||yy(a0.zOrder-1,"transcodingUser[".concat(c0,"].zOrder"),0,100),Oy(a0.alpha)||yy(a0.alpha,"transcodingUser[".concat(c0,"].alpha"),0,1,!1)})),Oy(s0.watermark)||Gw(s0.watermark,"watermark"),Oy(s0.backgroundImage)||Gw(s0.backgroundImage,"backgroundImage"),s0.images&&!Oy(s0.images)&&(wy(s0.images,"config.images"),s0.images.forEach((a0,c0)=>{Gw(a0,"images[".concat(c0,"]"))}))}(n0);const r0=[];n0.images&&r0.push(...n0.images.map(s0=>RY(RY(RY({},jw),s0),{},{zOrder:255}))),n0.backgroundImage&&(r0.push(RY(RY(RY({},jw),n0.backgroundImage),{},{zOrder:0})),delete n0.backgroundImage),n0.watermark&&(r0.push(RY(RY(RY({},jw),n0.watermark),{},{zOrder:255})),delete n0.watermark),n0.images=r0,n0.transcodingUsers&&(n0.userConfigs=n0.transcodingUsers.map(s0=>RY({},s0)),n0.userCount=n0.transcodingUsers.length,delete n0.transcodingUsers);const i0=(n0.userConfigs||[]).map(s0=>typeof s0.uid=="number"?Gh.resolve(s0.uid):Yx(s0.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Gh.all(i0)).forEach((s0,a0)=>{n0.userConfigs&&n0.userConfigs[a0]&&(n0.userConfigs[a0].uid=s0)}),this.transcodingConfig=n0,this.connection)try{var o0;const s0=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(_N(o0=this.streamingTasks).call(o0)).map(a0=>a0.taskId).join("#")});fb.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(s0.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(s0){if(!s0.data||!s0.data.retry)throw s0;s0.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(a0=>{fb.warning("[".concat(this.spec.clientId,"] live streaming receive error"),s0.toString(),"try to republish",a0.url),this.startLiveStreamingTask(a0.url,a0.mode,s0).then(()=>{fb.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(a0.url," success"))}).catch(c0=>{fb.error("[".concat(this.spec.clientId,"] live streaming republish failed"),a0.url,c0.toString()),this.onLiveStreamError&&this.onLiveStreamError(a0.url,c0)})})}}async startLiveStreamingTask(e0,n0,r0){if(!this.transcodingConfig&&n0===Fw.TRANSCODE)throw new yb(Ry.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i0={command:"PublishStream",ts:Date.now(),url:e0,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};fb.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e0,", mode: ").concat(n0));const o0=await this.taskMutex.lock();if(!this.connection&&r0)return void o0();if(this.streamingTasks.get(e0)&&!r0)return o0(),new yb(Ry.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n0))}catch(a0){throw o0(),a0}switch(n0){case Fw.TRANSCODE:i0.transcodingConfig=RY({},this.transcodingConfig);case Fw.RAW:}this.uapResponse&&this.uapResponse.vid&&(i0.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const s0=this.lastTaskId++;try{const a0=new Gh((u0,l0)=>{mA(this.retryTimeout).then(()=>{if(r0)return l0(r0);const d0=this.statusError.get(e0);return d0?(this.statusError.delete(e0),l0(d0)):void 0})}),c0=await Gh.race([this.connection.request("request",{clientRequest:i0},!0,{url:e0,command:"PublishStream",workerType:n0===Fw.TRANSCODE?1:2,requestByUser:!r0,tid:s0.toString()}),a0]);this.isStartingStreamingTask=!1,fb.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(c0.code)),this.streamingTasks.set(e0,{clientRequest:i0,mode:n0,url:e0,taskId:s0}),o0()}catch(a0){if(o0(),this.isStartingStreamingTask=!1,!a0.data||!a0.data.retry||r0)throw a0;return a0.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e0,n0,a0)):await this.startLiveStreamingTask(e0,n0,a0)}}stopLiveStreamingTask(e0){return new Gh((n0,r0)=>{const i0=this.streamingTasks.get(e0);if(!i0||!this.connection)return new yb(Ry.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const o0=i0.mode;i0.abortTask=()=>{fb.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e0),n0()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i0.url}},!1,{url:e0,command:"UnPublishStream",workerType:o0===Fw.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(s0=>{fb.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(s0.code)),this.streamingTasks.delete(e0),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n0()}).catch(r0)})}resetAllTask(){var e0;const n0=Array.from(_N(e0=this.streamingTasks).call(e0));this.terminate();for(const r0 of n0)this.startLiveStreamingTask(r0.url,r0.mode).catch(i0=>{this.onLiveStreamError&&this.onLiveStreamError(r0.url,i0)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Lv.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e0){if(this.connection)throw new yb(Ry.UNEXPECTED_ERROR,"live streaming connection has already connected");const n0=await Zy(this,Kw.REQUEST_WORKER_MANAGER_LIST,e0);return this.uapResponse=n0,this.connection=new SY(n0.workerToken,this.spec,this.wsRetryConfig,e0),this.connection.on(Hw.WARNING,(r0,i0)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i0,r0)),this.connection.on(Hw.PUBLISH_STREAM_STATUS,r0=>this.handlePublishStreamServer(r0)),this.connection.on(Hw.REQUEST_NEW_ADDRESS,(r0,i0)=>{if(!this.connection)return i0(new yb(Ry.UNEXPECTED_ERROR,"can not get new live streaming address list"));Zy(this,Kw.REQUEST_WORKER_MANAGER_LIST,e0).then(o0=>{this.uapResponse=o0,r0(o0.addressList)}).catch(i0)}),await this.connection.init(n0.addressList),this.connection}handlePublishStreamServer(e0){const n0=e0.serverStatus&&e0.serverStatus.url||"empty_url",r0=this.streamingTasks.get(n0),i0=e0.reason;switch(e0.code){case Yw.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Yw.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const s0=new yb(Ry.LIVE_STREAMING_CDN_ERROR,"",{code:e0.code});if(r0)return fb.error(s0.toString()),this.onLiveStreamError&&this.onLiveStreamError(n0,s0);if(!this.isStartingStreamingTask)return;this.statusError.set(n0,s0)}case Yw.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s0=new yb(Ry.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i0);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n0,s0)}case Yw.LIVE_STREAM_RESPONSE_WORKER_LOST:case Yw.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var o0;if(!this.connection)return;this.connection.tryNextAddress();const s0=Array.from(_N(o0=this.streamingTasks).call(o0));for(const a0 of s0)a0.abortTask?a0.abortTask():(fb.warning("[".concat(this.spec.clientId,"] publish stream status code"),e0.code,"try to republish",a0.url),this.startLiveStreamingTask(a0.url,a0.mode,new yb(Ry.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e0.code})).then(()=>{fb.debug("[".concat(this.spec.clientId,"] republish live stream success"),a0.url)}).catch(c0=>{fb.error(c0.toString()),this.onLiveStreamError&&this.onLiveStreamError(a0.url,c0)}));return}}}hasUrl(e0){return this.streamingTasks.has(e0)}}const IY={name:"LiveStreaming",create:function(t0){return new CY(t0.joinInfo,t0.websocketRetryConfig||PA,t0.httpRetryConfig||PA)}};function vY(t0){let e0=MY();return function(n0,r0){let i0=n0.appId;i0!==void 0&&(JY(r0,10),GY(r0,i0));let o0=n0.cid;o0!==void 0&&(JY(r0,16),JY(r0,o0));let s0=n0.cname;s0!==void 0&&(JY(r0,26),GY(r0,s0));let a0=n0.deviceId;a0!==void 0&&(JY(r0,34),GY(r0,a0));let c0=n0.elapse;c0!==void 0&&(JY(r0,40),XY(r0,c0));let u0=n0.fileSize;u0!==void 0&&(JY(r0,48),XY(r0,LY(u0)));let l0=n0.height;l0!==void 0&&(JY(r0,56),XY(r0,LY(l0)));let d0=n0.jpg;d0!==void 0&&(JY(r0,66),JY(r0,d0.length),function($0,N0){let A0=FY($0,N0.length);$0.bytes.set(N0,A0)}(r0,d0));let h0=n0.networkType;h0!==void 0&&(JY(r0,72),XY(r0,LY(h0)));let p0=n0.osType;p0!==void 0&&(JY(r0,80),XY(r0,LY(p0)));let m0=n0.requestId;m0!==void 0&&(JY(r0,90),GY(r0,m0));let f0=n0.sdkVersion;f0!==void 0&&(JY(r0,98),GY(r0,f0));let g0=n0.sequence;g0!==void 0&&(JY(r0,104),XY(r0,LY(g0)));let E0=n0.sid;E0!==void 0&&(JY(r0,114),GY(r0,E0));let _0=n0.timestamp;_0!==void 0&&(JY(r0,120),XY(r0,_0));let y0=n0.uid;y0!==void 0&&(JY(r0,128),JY(r0,y0));let b0=n0.vid;b0!==void 0&&(JY(r0,136),JY(r0,b0));let S0=n0.width;S0!==void 0&&(JY(r0,144),XY(r0,LY(S0)));let w0=n0.service;w0!==void 0&&(JY(r0,152),JY(r0,w0));let I0=n0.callbackData;I0!==void 0&&(JY(r0,162),GY(r0,I0));let L0=n0.jpgEncryption;L0!==void 0&&(JY(r0,168),JY(r0,L0));let M0=n0.requestType;M0!==void 0&&(JY(r0,176),JY(r0,M0));let C0=n0.scorePorn;C0!==void 0&&(JY(r0,185),qY(r0,C0));let U0=n0.scoreSexy;U0!==void 0&&(JY(r0,193),qY(r0,U0));let x0=n0.scoreNeutral;x0!==void 0&&(JY(r0,201),qY(r0,x0));let j0=n0.scene;j0!==void 0&&(JY(r0,208),JY(r0,j0));let k0=n0.ossFilePrefix;k0!==void 0&&(JY(r0,218),GY(r0,k0));let D0=n0.serviceVendor;if(D0!==void 0)for(let $0 of D0){JY(r0,226);let N0=MY();bY($0,N0),JY(r0,N0.limit),WY(r0,N0),UY(N0)}}(t0,e0),function(n0){let r0=n0.bytes,i0=n0.limit;return r0.length===i0?r0:r0.subarray(0,i0)}(e0)}function yY(t0){return function(n0){let r0={};t:for(;!VY(n0);){let i0=zY(n0);switch(i0>>>3){case 0:break t;case 1:r0.code=zY(n0);break;case 2:r0.msg=jY(n0,zY(n0));break;case 3:{let o0=wY(n0);r0.data=AY(n0),n0.limit=o0;break}default:OY(n0,7&i0)}}return r0}({bytes:e0=t0,offset:0,limit:e0.length});var e0}function AY(t0){let e0={};t:for(;!VY(t0);){let n0=zY(t0);switch(n0>>>3){case 0:break t;case 1:e0.requestId=jY(t0,zY(t0));break;case 2:e0.requestType=zY(t0)>>>0;break;case 3:e0.scorePorn=YY(t0);break;case 4:e0.scoreSexy=YY(t0);break;case 5:e0.scoreNeutral=YY(t0);break;case 6:e0.requestScene=zY(t0)>>>0;break;case 7:e0.scene=zY(t0)>>>0;break;default:OY(t0,7&n0)}}return e0}function bY(t0,e0){let n0=t0.service;n0!==void 0&&(JY(e0,8),JY(e0,n0));let r0=t0.vendor;r0!==void 0&&(JY(e0,16),JY(e0,r0));let i0=t0.token;i0!==void 0&&(JY(e0,26),GY(e0,i0));let o0=t0.callbackUrl;o0!==void 0&&(JY(e0,34),GY(e0,o0))}function wY(t0){let e0=zY(t0),n0=t0.limit;return t0.limit=t0.offset+e0,n0}function OY(t0,e0){switch(e0){case 0:for(;128&HY(t0););break;case 2:xY(t0,zY(t0));break;case 5:xY(t0,4);break;case 1:xY(t0,8);break;default:throw new Error("Unimplemented type: "+e0)}}let NY=new Float32Array(1);new Uint8Array(NY.buffer);let DY=new Float64Array(1),PY=new Uint8Array(DY.buffer);function LY(t0){return{low:t0|=0,high:t0>>31,unsigned:t0>=0}}let kY=[];function MY(){const t0=kY.pop();return t0?(t0.offset=t0.limit=0,t0):{bytes:new Uint8Array(64),offset:0,limit:0}}function UY(t0){kY.push(t0)}function xY(t0,e0){if(t0.offset+e0>t0.limit)throw new Error("Skip past limit");t0.offset+=e0}function VY(t0){return t0.offset>=t0.limit}function FY(t0,e0){let n0=t0.bytes,r0=t0.offset,i0=t0.limit,o0=r0+e0;if(o0>n0.length){let s0=new Uint8Array(2*o0);s0.set(n0),t0.bytes=s0}return t0.offset=o0,o0>i0&&(t0.limit=o0),r0}function BY(t0,e0){let n0=t0.offset;if(n0+e0>t0.limit)throw new Error("Read past limit");return t0.offset+=e0,n0}function jY(t0,e0){let n0=BY(t0,e0),r0=String.fromCharCode,i0=t0.bytes,o0="",s0="";for(let a0=0;a0<e0;a0++){let c0,u0,l0,d0,h0=i0[a0+n0];128&h0?(224&h0)==192?a0+1>=e0?s0+=o0:(c0=i0[a0+n0+1],(192&c0)!=128?s0+=o0:(d0=(31&h0)<<6|63&c0,d0<128?s0+=o0:(s0+=r0(d0),a0++))):(240&h0)==224?a0+2>=e0?s0+=o0:(c0=i0[a0+n0+1],u0=i0[a0+n0+2],(49344&(c0|u0<<8))!=32896?s0+=o0:(d0=(15&h0)<<12|(63&c0)<<6|63&u0,d0<2048||d0>=55296&&d0<=57343?s0+=o0:(s0+=r0(d0),a0+=2))):(248&h0)==240?a0+3>=e0?s0+=o0:(c0=i0[a0+n0+1],u0=i0[a0+n0+2],l0=i0[a0+n0+3],(12632256&(c0|u0<<8|l0<<16))!=8421504?s0+=o0:(d0=(7&h0)<<18|(63&c0)<<12|(63&u0)<<6|63&l0,d0<65536||d0>1114111?s0+=o0:(d0-=65536,s0+=r0(55296+(d0>>10),56320+(1023&d0)),a0+=3))):s0+=o0:s0+=r0(h0)}return s0}function GY(t0,e0){let n0=e0.length,r0=0;for(let s0=0;s0<n0;s0++){let a0=e0.charCodeAt(s0);a0>=55296&&a0<=56319&&s0+1<n0&&(a0=(a0<<10)+e0.charCodeAt(++s0)-56613888),r0+=a0<128?1:a0<2048?2:a0<65536?3:4}JY(t0,r0);let i0=FY(t0,r0),o0=t0.bytes;for(let s0=0;s0<n0;s0++){let a0=e0.charCodeAt(s0);a0>=55296&&a0<=56319&&s0+1<n0&&(a0=(a0<<10)+e0.charCodeAt(++s0)-56613888),a0<128?o0[i0++]=a0:(a0<2048?o0[i0++]=a0>>6&31|192:(a0<65536?o0[i0++]=a0>>12&15|224:(o0[i0++]=a0>>18&7|240,o0[i0++]=a0>>12&63|128),o0[i0++]=a0>>6&63|128),o0[i0++]=63&a0|128)}}function WY(t0,e0){let n0=FY(t0,e0.limit),r0=t0.bytes,i0=e0.bytes;for(let o0=0,s0=e0.limit;o0<s0;o0++)r0[o0+n0]=i0[o0]}function HY(t0){return t0.bytes[BY(t0,1)]}function KY(t0,e0){let n0=FY(t0,1);t0.bytes[n0]=e0}function YY(t0){let e0=BY(t0,8),n0=t0.bytes;return PY[0]=n0[e0++],PY[1]=n0[e0++],PY[2]=n0[e0++],PY[3]=n0[e0++],PY[4]=n0[e0++],PY[5]=n0[e0++],PY[6]=n0[e0++],PY[7]=n0[e0++],DY[0]}function qY(t0,e0){let n0=FY(t0,8),r0=t0.bytes;DY[0]=e0,r0[n0++]=PY[0],r0[n0++]=PY[1],r0[n0++]=PY[2],r0[n0++]=PY[3],r0[n0++]=PY[4],r0[n0++]=PY[5],r0[n0++]=PY[6],r0[n0++]=PY[7]}function zY(t0){let e0,n0=0,r0=0;do e0=HY(t0),n0<32&&(r0|=(127&e0)<<n0),n0+=7;while(128&e0);return r0}function JY(t0,e0){for(e0>>>=0;e0>=128;)KY(t0,127&e0|128),e0>>>=7;KY(t0,e0)}function XY(t0,e0){let n0=e0.low>>>0,r0=(e0.low>>>28|e0.high<<4)>>>0,i0=e0.high>>>24,o0=i0===0?r0===0?n0<16384?n0<128?1:2:n0<1<<21?3:4:r0<16384?r0<128?5:6:r0<1<<21?7:8:i0<128?9:10,s0=FY(t0,o0),a0=t0.bytes;switch(o0){case 10:a0[s0+9]=i0>>>7&1;case 9:a0[s0+8]=o0!==9?128|i0:127&i0;case 8:a0[s0+7]=o0!==8?r0>>>21|128:r0>>>21&127;case 7:a0[s0+6]=o0!==7?r0>>>14|128:r0>>>14&127;case 6:a0[s0+5]=o0!==6?r0>>>7|128:r0>>>7&127;case 5:a0[s0+4]=o0!==5?128|r0:127&r0;case 4:a0[s0+3]=o0!==4?n0>>>21|128:n0>>>21&127;case 3:a0[s0+2]=o0!==3?n0>>>14|128:n0>>>14&127;case 2:a0[s0+1]=o0!==2?n0>>>7|128:n0>>>7&127;case 1:a0[s0]=o0!==1?128|n0:127&n0}}function QY(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}const ZY=new Map([["moderation",1],["supervise",2]]);function $Y(t0){return{low:t0|=0,high:t0>>31,unsigned:t0>=0}}class eq extends xy{get connectionState(){return this._connectionState}set connectionState(e0){if(this._connectionState===e0)return;const n0=this._connectionState;this._connectionState=e0,this.emit(mO.CONNECTION_STATE_CHANGE,n0,e0)}get inspectType(){return this._inspectType}set inspectType(e0){var n0;this._inspectMode=Jn(n0=e0.map(r0=>ZY.get(r0)||0)).call(n0,(r0,i0)=>r0+i0),this._inspectType=e0}get quality(){return this._quality}set quality(e0){this._quality=e0>1?1:e0<.1?.1:e0,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e0){super(),Fg(this,"name","AgoraRTCVideoContentInspect"),Fg(this,"_connectionState",EO.CONNECTING),Fg(this,"_innerConnectionState",void 0),Fg(this,"sequence",0),Fg(this,"inspectStartTime",void 0),Fg(this,"workerManagerConnection",void 0),Fg(this,"workerConnection",void 0),Fg(this,"workerMessageLengthLimit",void 0),Fg(this,"inspectIntervalMinimum",void 0),Fg(this,"qualityRatio",void 0),Fg(this,"_connectInfo",void 0),Fg(this,"_cancelTokenSource",Lv.CancelToken.source()),Fg(this,"_retryConfig",void 0),Fg(this,"wmSequence",0),Fg(this,"inspectInterval",void 0),Fg(this,"inspectTimer",null),Fg(this,"ossFilePrefix",void 0),Fg(this,"extraInfo",void 0),Fg(this,"_inspectType",void 0),Fg(this,"_inspectMode",void 0),Fg(this,"_quality",1),Fg(this,"qualityTimer",null),Fg(this,"_inspectId",void 0),Fg(this,"_needWorkUrlOnly",!1),Fg(this,"inspectImage",()=>{if(this.connectionState!==EO.CONNECTED)throw new yb(Ry.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===EO.CONNECTED?this.requestToInspectImage():fb.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=TA(5,"inspect-"),this.workerMessageLengthLimit=XA("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=XA("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=XA("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e0.interval,this.ossFilePrefix=e0.ossFilePrefix,this.extraInfo=e0.extraInfo,this.inspectType=e0.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new HO("worker-manager-"+this._inspectId,PA),this.on(mO.STATE_CHANGE,(n0,r0)=>{this._innerConnectionState=n0,fb.debug("[".concat(this._inspectId,"] Inspect operation :").concat(fO[n0]," ").concat(r0||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new HO("worker-"+this._inspectId,PA),this.handleWorkerEvents()}async init(e0,n0){this.emit(mO.STATE_CHANGE,fO.CONNECT_AP),this._connectInfo=e0;const r0=this._cancelTokenSource.token;return this._retryConfig=n0,new Gh((i0,o0)=>{this.on(mO.CONNECTION_STATE_CHANGE,(s0,a0)=>{a0===EO.CONNECTED&&i0()}),this.requestAP(e0,r0,n0).then(s0=>{this.connectWorkerManager(s0)}).catch(s0=>{o0(s0)})})}async requestAP(e0,n0,r0){const i0=XA("WEBCS_DOMAIN").map(a0=>"https://".concat(a0,"/api/v1")),o0=await function(a0,c0,u0,l0){let{appId:d0,areaCode:h0,cname:p0,sid:m0,token:f0,uid:g0}=c0;Bx++;const E0="image_moderation_api",_0={service_name:E0,json_body:JSON.stringify({appId:d0,areaCode:h0,cname:p0,command:"allocateEdge",requestId:Bx,seq:Bx,sid:m0,token:f0,ts:Date.now(),uid:g0+""})};let y0,b0,S0=a0[0];return kA(async()=>{y0=Date.now();const w0=await Tx(S0,{data:_0,cancelToken:u0,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(b0=Date.now()-y0,w0.code!==0){const C0=new yb(Ry.UNEXPECTED_RESPONSE,"image inspect ap error, code"+w0.code,{retry:!0,responseTime:b0});throw fb.error(C0.toString()),C0}const I0=JSON.parse(w0.json_body);if(I0.code!==200){const C0=new yb(Ry.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(I0.code,", reason: ").concat(I0.reason),{code:I0.code,responseTime:b0});throw fb.error(C0.toString()),C0}if(!I0.servers||!Array.isArray(I0.servers)||I0.servers.length===0){const C0=new yb(Ry.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:I0.code,responseTime:b0});throw fb.error(C0.toString()),C0}const L0=XA("VIDEO_INSPECT_WORKER_MANAGER_HOST"),M0=XA("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:I0.servers.map(C0=>{let{address:U0,wss:x0}=C0;if(U0&&x0)return"wss://".concat(U0.replace(/\./g,"-"),".").concat(L0,":").concat(M0||x0)}).filter(C0=>!!C0),workerToken:I0.workerToken,vid:I0.vid,responseTime:b0}},(w0,I0)=>(vb.apworkerEvent(m0,{success:!0,sc:200,serviceName:E0,responseDetail:JSON.stringify(w0.addressList),firstSuccess:I0===0,responseTime:b0,serverIp:a0[I0%a0.length]}),!1),(w0,I0)=>(vb.apworkerEvent(m0,{success:!1,sc:w0.data&&w0.data.code||200,serviceName:E0,responseTime:b0,serverIp:a0[I0%a0.length]}),!!(w0.code!==Ry.OPERATION_ABORTED&&w0.code!==Ry.UNEXPECTED_RESPONSE||w0.data&&w0.data.retry)&&(S0=a0[(I0+1)%a0.length],!0)),l0)}(i0,e0,n0,r0);this.emit(mO.STATE_CHANGE,fO.AP_CONNECTED);const{addressList:s0}=o0;return this.wmSequence++,s0}async connectWorkerManager(e0){let n0=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n0,this.emit(mO.STATE_CHANGE,fO.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e0,1e4)}async connectWorker(e0){await this.workerConnection.init([e0])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Uw.CONNECTED,async()=>{this.emit(mO.STATE_CHANGE,fO.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Uw.CLOSED,()=>{this._innerConnectionState<fO.GET_WORKER_MANAGER_RESPONSE&&fb.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Uw.FAILED,()=>{this._innerConnectionState<fO.GET_WORKER_MANAGER_RESPONSE&&fb.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Uw.RECONNECTING,()=>{this._innerConnectionState<fO.GET_WORKER_MANAGER_RESPONSE&&fb.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Uw.ON_MESSAGE,async e0=>{this.emit(mO.STATE_CHANGE,fO.GET_WORKER_MANAGER_RESPONSE);const n0=this.workerManagerConnection.url;this.workerManagerConnection.close();const r0=JSON.parse(e0.data);if(r0.code!==200)throw fb.error("[".concat(this._inspectId,"] Unexpected code ").concat(r0.code," from worker manager")),new yb(Ry.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r0);if(!(r0.serverResponse&&r0.serverResponse.portWss&&n0))throw fb.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r0))),new yb(Ry.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r0);{const i0=XA("VIDEO_INSPECT_WORKER_PORT")||r0.serverResponse.portWss,o0=n0.replace(/:\d+\/?$/,":".concat(i0));this.emit(mO.STATE_CHANGE,fO.CONNECT_WORKER,o0),this._needWorkUrlOnly?this.emit(mO.REQUEST_NEW_WORKER_URL,o0):await this.connectWorker(o0)}}),this.workerManagerConnection.on(Uw.WILL_RECONNECT,(e0,n0,r0)=>{r0(e0)}),this.workerManagerConnection.on(Uw.REQUEST_NEW_URLS,(e0,n0)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e0).catch(n0)})}handleWorkerEvents(){this.workerConnection.on(Uw.CONNECTED,async()=>{this.emit(mO.STATE_CHANGE,fO.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=EO.CONNECTED}),this.workerConnection.on(Uw.ON_MESSAGE,async e0=>{if(e0.data instanceof ArrayBuffer){const r0=yY(new Uint8Array(e0.data));if(XA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&fb.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r0)),r0.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(mO.INSPECT_RESULT,void 0,void 0);if(r0.data&&r0.data.scorePorn&&r0.data.scoreSexy&&r0.data.scoreNeutral){var n0;const i0={porn:r0.data.scorePorn,sexy:r0.data.scoreSexy,neutral:r0.data.scoreNeutral},o0=Jn(n0=Object.keys(i0)).call(n0,(a0,c0)=>i0[a0]>i0[c0]?a0:c0,"porn"),s0=Object.keys(i0).find(a0=>a0===o0);this.emit(mO.INSPECT_RESULT,s0)}else this.emit(mO.INSPECT_RESULT,void 0,new yb(Ry.UNEXPECTED_RESPONSE,r0.code+"","There is an unexpected data on message"))}else this.emit(mO.INSPECT_RESULT,void 0,new yb(Ry.UNEXPECTED_RESPONSE,r0.code+"",r0.msg))}else fb.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(mO.INSPECT_RESULT,void 0,new yb(Ry.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Uw.CLOSED,()=>{this.connectionState=EO.CLOSED}),this.workerConnection.on(Uw.FAILED,()=>{this.connectionState=EO.CLOSED}),this.workerConnection.on(Uw.RECONNECTING,()=>{this.connectionState=this.connectionState===EO.CONNECTED?EO.RECONNECTING:EO.CONNECTING}),this.workerConnection.on(Uw.WILL_RECONNECT,(e0,n0,r0)=>{e0==="recover"&&r0(e0),r0("tryNext")}),this.workerConnection.on(Uw.REQUEST_NEW_URLS,(e0,n0)=>{this.workerManagerConnection.close(),this.once(mO.REQUEST_NEW_WORKER_URL,r0=>{e0([r0])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r0=>{this.connectWorkerManager(r0,!0)}).catch(r0=>{n0(r0)})})}async requestToInspectImage(){this.sequence++;const e0=eA(this,mO.CLIENT_LOCAL_VIDEO_TRACK),n0={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e0){if(!e0.isPlaying)return void this.emit(mO.INSPECT_RESULT,void 0,new yb(Ry.INVALID_OPERATION,"Only the track being played can be inspected"));const r0=await this.generateRequestData(e0,n0);this.workerConnection.sendMessage(r0,!0,!0)}else this.emit(mO.INSPECT_RESULT,void 0,new yb(Ry.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e0,n0){let{appId:r0,cname:i0,cid:o0,vid:s0,sid:a0,uid:c0}=n0;const u0=Date.now(),l0=await e0.getCurrentFrameImage("image/jpeg",this.quality),d0=await Ok(l0,r0,i0),h0=this.sequence+"-"+o0+"-"+c0+"-"+u0+"-"+TA(12,""),p0={appId:r0,cid:o0,cname:i0,deviceId:"",elapse:$Y(Number(u0-this.inspectStartTime)),fileSize:d0.byteLength,jpgEncryption:2,height:l0.height,width:l0.width,jpg:d0,networkType:6,osType:7,requestId:h0,sdkVersion:"4.22.1",sequence:this.sequence,sid:a0,timestamp:$Y(u0),uid:c0,vid:s0,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete p0.callbackData,this.ossFilePrefix===void 0&&delete p0.ossFilePrefix;const m0=vY(p0);if(m0.byteLength<this.workerMessageLengthLimit){if(XA("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const f0=function(g0){for(var E0=1;E0<arguments.length;E0++){var _0=arguments[E0]!=null?arguments[E0]:{};E0%2?QY(Object(_0),!0).forEach(function(y0){Fg(g0,y0,_0[y0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g0,Object.getOwnPropertyDescriptors(_0)):QY(Object(_0)).forEach(function(y0){Object.defineProperty(g0,y0,Object.getOwnPropertyDescriptor(_0,y0))})}return g0}({},p0);delete f0.jpg,fb.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(f0))}return m0}{const f0=this.quality*this.qualityRatio;return this.quality=f0,await this.generateRequestData(e0,{appId:r0,cname:i0,cid:o0,vid:s0,sid:a0,uid:c0})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Lv.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=EO.CLOSED,this.emit(mO.STATE_CHANGE,fO.CLOSED)}}const tq={name:"ContentInspect",create:function(t0){let{config:e0}=t0;return function(n0){if(!n0)throw new yb(Ry.INVALID_PARAMS,"inspectConfig is necessary.");if(!n0.inspectType||!Array.isArray(n0.inspectType))throw new yb(Ry.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r0=[...new Set(n0.inspectType)];r0.forEach(i0=>{var o0;if(!Dn(o0=["supervise","moderation"]).call(o0,i0))throw new yb(Ry.INVALID_PARAMS,"".concat(i0," is not a valid inspect type."))}),n0.inspectType=r0}if(n0&&n0.extraInfo&&n0.extraInfo.length>1024)throw new yb(Ry.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e0),new eq(e0)}};JA("PROCESS_ID","process-".concat(TA(8,""),"-").concat(TA(4,""),"-").concat(TA(4,""),"-").concat(TA(4,""),"-").concat(TA(12,""))),function(){let t0;try{t0=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e0){return void fb.error("Error loading sdk config",e0.message)}if(t0)try{const e0=JSON.parse(window.atob(t0)),n0=Date.now();fb.debug("Loading global parameters from cache",e0),Object.keys(e0).forEach(r0=>{if(Object.prototype.hasOwnProperty.call(zA,r0)){const{value:i0,expires:o0}=e0[r0];if(o0&&o0<=n0)return;QA[r0]=i0,zA[r0]=i0}})}catch(e0){fb.error("Error loading mutableParamsCache: ".concat(t0),e0.message)}}(),Array.isArray(QA.AREAS)&&QA.AREAS.length>0&&bx(QA.AREAS,!0);const iq=(t0,e0,n0)=>{fb.debug("setParameter key:".concat(t0,", value:").concat(JSON.stringify(e0))),JA(t0,e0,n0)};SB(fY,!1),SB(IY,!1),SB(kj,!1),SB(tq,!1),SB(pY,!1);const nq=function(t0){const e0=new xy,n0=t0,r0={getListeners:e0.getListeners.bind(e0),on:(i0,o0)=>(function(s0,a0){s0===SO.SECURITY_POLICY_VIOLATION&&LG(a0,!0)}(i0,o0),e0.on.bind(e0)(i0,o0)),addListener:e0.addListener.bind(e0),once:e0.once.bind(e0),off:e0.off.bind(e0),removeAllListeners:e0.removeAllListeners.bind(e0),emit:e0.emit.bind(e0),safeEmit:e0.safeEmit.bind(e0)};return DG(DG({},n0),r0)}({__TRACK_LIST__:_L,VERSION:GA,BUILD:qA,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:iq,getParameter:XA,getSupportedCodec:async function(){let t0={audio:[],video:[]};try{let e0=new RTCPeerConnection;const n0=await async function(r0){let i0;return ZP().supportUnifiedPlan?(r0.addTransceiver("video",{direction:"recvonly"}),r0.addTransceiver("audio",{direction:"recvonly"}),i0=(await r0.createOffer()).sdp):i0=(await r0.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i0}(e0);if(!n0)return t0;e0.close(),e0=null,t0=function(r0){const i0={video:[],audio:[]};return r0.match(/ VP8/i)&&i0.video.push("VP8"),r0.match(/ VP9/i)&&i0.video.push("VP9"),r0.match(/ AV1/i)&&i0.video.push("AV1"),r0.match(/ H264/i)&&i0.video.push("H264"),r0.match(/ H265/i)&&i0.video.push("H265"),r0.match(/ opus/i)&&i0.audio.push("OPUS"),r0.match(/ PCMU/i)&&i0.audio.push("PCMU"),r0.match(/ PCMA/i)&&i0.audio.push("PCMA"),r0.match(/ G722/i)&&i0.audio.push("G722"),i0}(n0)}catch(e0){throw new yb(Ry.CREATE_OFFER_FAILED,e0.toString&&e0.toString()).print()}return t0},checkSystemRequirements:function(){const t0=vb.reportApiInvoke(null,{name:By.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:jy.TRACER});let e0=!1;try{const o0=window.RTCPeerConnection,s0=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,a0=window.WebSocket;e0=!!(o0&&s0&&a0),e0&&_y()&&ty(75)&&new o0().close()}catch(o0){return fb.error("check system requirement failed: ",o0),!1}let n0=!1;const r0=Hv();r0.name===Bv.CHROME&&Number(r0.version)>=58&&(Gv.engine.name!=="WebKit"||function(){const o0=Hv();if(zv()){if(o0.os===Fv.MAC_OS)return!0;if(o0.os===Fv.IOS){const s0=Gv.os.version&&Gv.os.version.split(".");if(s0&&Number(s0[0])===14&&s0[1]&&Number(s0[1])>=3||s0&&Number(s0[0])>14)return!0}}return!1}())&&(n0=!0),(r0.name===Bv.FIREFOX&&Number(r0.version)>=56||r0.name===Bv.OPERA&&Number(r0.version)>=45||r0.name===Bv.SAFARI&&Number(r0.version)>=11||r0.name==="WebKit"&&($v()||uy())&&r0.osVersion&&Number(r0.osVersion.split(".")[0])>=11||hy()||Hv().name===Bv.QQ)&&(n0=!0),fb.debug("checkSystemRequirements, api:",e0,"browser",n0);const i0=e0&&n0;return t0.onSuccess(i0),i0},getDevices:function(t0){return uk.enumerateDevices(!0,!0,t0)},getMicrophones:function(t0){return uk.getRecordingDevices(t0)},getCameras:function(t0){return uk.getCamerasDevices(t0)},getElectronScreenSources:nk,getPlaybackDevices:function(t0){return uk.getSpeakers(t0)},createClient:function(){var t0;let e0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n0=vb.reportApiInvoke(null,{name:By.CREATE_CLIENT,options:[e0],tag:jy.TRACER});try{(function(r0){vy(r0.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),vy(r0.mode,"config.mode",["rtc","live","p2p"]),r0.audioCodec!==void 0&&vy(r0.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r0.proxyServer!==void 0&&by(r0.proxyServer,"config.proxyServer",1,1e4),r0.turnServer!==void 0&&Yy(r0.turnServer),r0.httpRetryConfig!==void 0&&Gy(r0.httpRetryConfig),r0.websocketRetryConfig!==void 0&&Gy(r0.websocketRetryConfig)})(e0)}catch(r0){throw n0.onError(r0),r0}return(ry(16,0,!0)||oy(16,0,!0))&&(e0.codec==="vp9"&&(e0.codec="vp8",fb.debug("browser not support vp9, force use vp8")),JA("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e0.audioCodec===void 0&&(e0.audioCodec="opus"),n0.onSuccess(),new vG(IG(IG({forceWaitGatewayResponse:!0},e0),{},{role:Dn(t0=["rtc","p2p"]).call(t0,e0.mode)?"host":e0.role||"audience"}))},createCameraVideoTrack:async function(){let t0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e0=XA("CAMERA_CAPTURE_CONFIG"),n0=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_CAM_VIDEO_TRACK,options:[GL({},t0),e0]});e0&&(t0.encoderConfig=e0);const r0=Ak(t0),i0=TA(8,"track-cam-");let o0=null;fb.info("start create camera video track with config",JSON.stringify(t0),"trackId",i0);try{o0=(await ak({video:r0},i0)).getVideoTracks()[0]||null}catch(a0){throw n0.onError(a0),a0}if(!o0){const a0=new Cy(Ry.UNEXPECTED_ERROR,"can not find track in media stream");return n0.onError(a0),a0.throw(fb)}t0.optimizationMode&&dU(i0,o0,t0,dL(t0.encoderConfig));const s0=new cU(o0,t0,r0,t0.scalabiltyMode?uL(t0.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t0.optimizationMode,i0);return n0.onSuccess(s0.getTrackId()),fb.info("create camera video success, trackId:",i0),s0},createCustomVideoTrack:function(t0){const e0=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_CUSTOM_VIDEO_TRACK,options:[t0]}),n0=new aU(t0.mediaStreamTrack,{width:t0.width,height:t0.height,frameRate:t0.frameRate,bitrateMax:t0.bitrateMax,bitrateMin:t0.bitrateMin},t0.scalabiltyMode?uL(t0.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t0.optimizationMode,TA(8,"track-cus-"),[mL.CUSTOM_TRACK]);return e0.onSuccess(n0.getTrackId()),fb.info("create custom video track success with config",t0,"trackId",n0.getTrackId()),n0},createScreenVideoTrack:async function(){let t0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n0=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_SCREEN_VIDEO_TRACK,options:[GL({},t0),e0]});t0.encoderConfig?typeof t0.encoderConfig=="string"||t0.encoderConfig.width&&t0.encoderConfig.height||(t0.encoderConfig.width={max:1920},t0.encoderConfig.height={max:1080}):t0.encoderConfig="1080p_2";const r0=function(l0){const d0={};l0.screenSourceType&&(d0.mediaSource=l0.screenSourceType),l0.extensionId&&Jv()&&(d0.extensionId=l0.extensionId);const{displaySurface:h0,selfBrowserSurface:p0,surfaceSwitching:m0,systemAudio:f0}=l0;(ey(107)||iy(107)||sy(93))&&(h0&&(vy(h0,"displaySurface",["browser","window","monitor"]),d0.displaySurface=h0),p0?(vy(p0,"selfBrowserSurface",["exclude","include"]),d0.selfBrowserSurface=p0):d0.selfBrowserSurface="include",m0&&(vy(m0,"surfaceSwitching",["exclude","include"]),d0.surfaceSwitching=m0)),(ey(105)||iy(105)||sy(91))&&f0&&(vy(f0,"systemAudio",["exclude","include"]),d0.systemAudio=f0),l0.electronScreenSourceId&&(d0.sourceId=l0.electronScreenSourceId);const g0=l0.encoderConfig?lL(l0.encoderConfig):null;return d0.mandatory={chromeMediaSource:"desktop",maxWidth:g0?g0.width:void 0,maxHeight:g0?g0.height:void 0},g0&&(g0.frameRate&&(typeof g0.frameRate=="number"?(d0.mandatory.maxFrameRate=g0.frameRate,d0.mandatory.minFrameRate=g0.frameRate):(d0.mandatory.maxFrameRate=g0.frameRate.max||g0.frameRate.ideal||g0.frameRate.exact||void 0,d0.mandatory.minFrameRate=g0.frameRate.min||g0.frameRate.ideal||g0.frameRate.exact||void 0),d0.frameRate=g0.frameRate),g0.width&&(d0.width=g0.width),g0.height&&(d0.height=g0.height)),d0}(t0),i0=TA(8,"track-scr-v-");let o0=null,s0=null;const a0=ZP();if(!a0.supportShareAudio&&e0==="enable"){const l0=new Cy(Ry.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n0.onError(l0),l0.throw(fb)}fb.info("start create screen video track with config",t0,"withAudio",e0,"trackId",i0);try{const l0=await ak({screen:r0,screenAudio:e0==="auto"?a0.supportShareAudio:e0==="enable"},i0);o0=l0.getVideoTracks()[0]||null,s0=l0.getAudioTracks()[0]||null}catch(l0){throw n0.onError(l0),l0}if(!o0){const l0=new Cy(Ry.UNEXPECTED_ERROR,"can not find track in media stream");return n0.onError(l0),l0.throw(fb)}if(!s0&&e0==="enable"){o0&&o0.stop();const l0=new Cy(Ry.SHARE_AUDIO_NOT_ALLOWED);return n0.onError(l0),l0.throw(fb)}t0.optimizationMode||(t0.optimizationMode="detail"),t0.optimizationMode&&(dU(i0,o0,t0,t0.encoderConfig&&lL(t0.encoderConfig)||void 0),t0.encoderConfig&&typeof t0.encoderConfig!="string"&&(t0.encoderConfig.bitrateMin=t0.encoderConfig.bitrateMax));const c0=new aU(o0,t0.encoderConfig?lL(t0.encoderConfig):{},t0.scalabiltyMode?uL(t0.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t0.optimizationMode,i0,[mL.SCREEN_TRACK]);if(!s0)return n0.onSuccess(c0.getTrackId()),fb.info("create screen video track success","video:",c0.getTrackId()),c0;const u0=new TM(s0,void 0,TA(8,"track-scr-a-"),!1);return n0.onSuccess([c0.getTrackId(),u0.getTrackId()]),fb.info("create screen video track success","video:",c0.getTrackId(),"audio:",u0.getTrackId()),[c0,u0]},createMicrophoneAndCameraTracks:async function(){let t0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n0=XA("CAMERA_CAPTURE_CONFIG"),r0=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_MIC_AND_CAM_TRACKS,options:[t0,e0,n0]});n0&&(e0.encoderConfig=n0);const i0=Ak(e0),o0=bk(t0),s0=TA(8,"track-mic-"),a0=TA(8,"track-cam-");let c0=null,u0=null;fb.info("start create camera video track(".concat(a0,") and microphone audio track(").concat(s0,") with config, audio: ").concat(JSON.stringify(t0),", video: ").concat(JSON.stringify(e0)));try{const h0=await ak({audio:o0,video:i0},"".concat(s0,"-").concat(a0));c0=h0.getAudioTracks()[0],u0=h0.getVideoTracks()[0]}catch(h0){throw r0.onError(h0),h0}if(!c0||!u0){const h0=new Cy(Ry.UNEXPECTED_ERROR,"can not find tracks in media stream");return r0.onError(h0),h0.throw(fb)}e0.optimizationMode&&dU(a0,u0,e0,dL(e0.encoderConfig));const l0=new SM(c0,t0,o0,s0),d0=new cU(u0,e0,i0,e0.scalabiltyMode?uL(e0.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e0.optimizationMode,a0);return r0.onSuccess([l0.getTrackId(),d0.getTrackId()]),fb.info("create camera video track(".concat(a0,") and microphone audio track(").concat(s0,") success")),[l0,d0]},createMicrophoneAudioTrack:async function(){let t0=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e0=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_MIC_AUDIO_TRACK,options:[t0]}),n0=bk(t0),r0=TA(8,"track-mic-");let i0=null;fb.info("start create microphone audio track with config",JSON.stringify(t0),"trackId",r0);try{i0=(await ak({audio:n0},r0)).getAudioTracks()[0]||null}catch(s0){throw e0.onError(s0),s0}if(!i0){const s0=new Cy(Ry.UNEXPECTED_ERROR,"can not find track in media stream");return e0.onError(s0),s0.throw(fb)}const o0=new SM(i0,t0,n0,r0);return e0.onSuccess(o0.getTrackId()),fb.info("create microphone audio track success, trackId:",r0),o0},createCustomAudioTrack:function(t0){const e0=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_CUSTOM_AUDIO_TRACK,options:[t0]}),n0=new TM(t0.mediaStreamTrack,t0.encoderConfig?pL(t0.encoderConfig):{},TA(8,"track-cus-"),!1);return fb.info("create custom audio track success with config",t0,"trackId",n0.getTrackId()),e0.onSuccess(n0.getTrackId()),n0},createBufferSourceAudioTrack:async function(t0){var e0;const{cacheOnlineFile:n0,encoderConfig:r0}=t0;let{source:i0}=t0;const o0={source:i0 instanceof AudioBuffer?"AudioBuffer":i0 instanceof File?(e0=File.name)!==null&&e0!==void 0?e0:"File":i0,cacheOnlineFile:n0,encoderConfig:r0},s0=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CREATE_BUFFER_AUDIO_TRACK,options:[o0]});if(XA("DISABLE_WEBAUDIO"))throw new Cy(Ry.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const a0=TA(8,"track-buf-");fb.info("start create buffer source audio track with config",JSON.stringify(o0),"trackId",a0);const c0=i0;if(!(i0 instanceof AudioBuffer))try{i0=await async function(d0,h0){let p0=null;if(typeof d0=="string"){const f0=IM.get(d0);if(f0)return fb.debug("use cached audio resource: ",d0),f0;try{p0=(await kA(()=>Lv.get(d0,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(g0){throw new Cy(Ry.FETCH_AUDIO_FILE_FAILED,g0.toString())}}else p0=await new Gh((g0,E0)=>{const _0=new FileReader;_0.onload=y0=>{y0.target?g0(y0.target.result):E0(new Cy(Ry.READ_LOCAL_AUDIO_FILE_ERROR))},_0.onerror=()=>{E0(new Cy(Ry.READ_LOCAL_AUDIO_FILE_ERROR))},_0.readAsArrayBuffer(d0)});const m0=await function(f0){const g0=zL();return new Gh((E0,_0)=>{g0.decodeAudioData(f0,y0=>{E0(y0)},y0=>{_0(new Cy(Ry.DECODE_AUDIO_FILE_FAILED,y0.toString()))})})}(p0);return typeof d0=="string"&&h0&&IM.set(d0,m0),m0}(i0,n0)}catch(d0){return s0.onError(d0),d0.throw(fb)}const u0=new CM(i0),l0=new gM(c0,u0,r0?pL(r0):{},a0);return fb.info("create buffer source audio track success, trackId:",a0),s0.onSuccess(l0.getTrackId()),l0},setAppType:function(t0){if(fb.debug("setAppType: ".concat(t0)),!(Number.isInteger(t0)&&t0>=0))throw fb.debug("Invalid appType"),new yb(Ry.INVALID_PARAMS,"invalid app type",t0);JA("APP_TYPE",Math.floor(t0))},setLogLevel:function(t0){fb.setLogLevel(t0)},enableLogUpload:function(){XA("USE_NEW_LOG")?JA("UPLOAD_LOG",!0):fb.enableLogUpload()},disableLogUpload:function(){XA("USE_NEW_LOG")?JA("UPLOAD_LOG",!1):fb.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new PF},checkAudioTrackIsActive:async function(t0){let e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n0=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e0]});if(!(t0 instanceof TM||t0 instanceof vU)){const c0=new yb(Ry.INVALID_TRACK,"the parameter is not a audio track");return n0.onError(c0),c0.throw()}e0&&e0<1e3&&(e0=1e3);const r0=t0 instanceof TM?t0.getTrackLabel():"remote_track",i0=t0.getVolumeLevel();let o0=i0,s0=i0;const a0=Date.now();return new Gh(c0=>{const u0=setInterval(()=>{const l0=t0.getVolumeLevel();o0=l0>o0?l0:o0,s0=l0<s0?l0:s0;const d0=o0-s0>1e-4,h0=Date.now()-a0;if(d0||h0>e0){clearInterval(u0);const p0=d0,m0={duration:h0,deviceLabel:r0,maxVolumeLevel:o0,result:p0};fb.info("[track-".concat(t0.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(m0))),n0.onSuccess(m0),c0(p0)}},200)})},checkVideoTrackIsActive:async function(t0){let e0=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n0=vb.reportApiInvoke(null,{tag:jy.TRACER,name:By.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e0]});if(!(t0 instanceof aU||t0 instanceof IU)){const d0=new yb(Ry.INVALID_TRACK,"the parameter is not a video track");return n0.onError(d0),d0.throw()}e0&&e0<1e3&&(e0=1e3);const r0=t0 instanceof aU?t0.getTrackLabel():"remote_track",i0=t0.getMediaStreamTrack(!0),o0=document.createElement("video");o0.style.width="1px",o0.style.height="1px",o0.setAttribute("muted",""),o0.muted=!0,o0.setAttribute("playsinline",""),o0.controls=!1,(Xv()||zv())&&(o0.style.opacity="0.01",o0.style.position="fixed",o0.style.left="0",o0.style.top="0",document.body.appendChild(o0)),o0.srcObject=new MediaStream([i0]),o0.play();const s0=document.createElement("canvas");s0.width=160,s0.height=120;let a0=0,c0=0;try{const d0=Date.now();a0=await function(h0,p0,m0,f0){let g0,E0=0,_0=null;return new Gh((y0,b0)=>{function S0(){E0>f0&&g0&&(g0(),y0(E0));const w0=m0.getContext("2d");if(!w0){const M0=new yb(Ry.UNEXPECTED_ERROR,"can not get canvas 2d context.");return fb.error(M0.toString()),void b0(M0)}w0.drawImage(h0,0,0,160,120);const I0=w0.getImageData(0,0,m0.width,m0.height),L0=Math.floor(I0.data.length/3);if(_0){for(let M0=0;M0<L0;M0+=3)if(I0.data[M0]!==_0[M0])return E0+=1,void(_0=I0.data);_0=I0.data}else _0=I0.data}setTimeout(()=>{g0&&(g0(),y0(E0))},p0),g0=QL(()=>{S0()},30)})}(o0,e0,s0,4),c0=Date.now()-d0}catch(d0){throw n0.onError(d0),d0}DB===Bv.SAFARI&&(o0.pause(),o0.remove()),o0.srcObject=null;const u0=a0>4,l0={duration:c0,changedPicNum:a0,deviceLabel:r0,result:u0};return fb.info("[track-".concat(t0.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(l0))),n0.onSuccess(l0),u0},setArea:bx,audioElementPlayCenter:mk,resumeAudioContext:function(){mk.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t0){OG.processExternalMediaAEC(t0)},registerExtensions:function(t0){const e0=XA("PLUGIN_INFO")||[];t0.forEach(n0=>{"name"in n0&&!Dn(e0).call(e0,n0.name)&&e0.push(n0.name);const r0=n0;r0.__registered__=!0,r0.logger.hookLog=fb.extLog,r0.reporter.hookApiInvoke=vb.extApiInvoke,r0.parameters&&Object.keys(r0.parameters).forEach(i0=>{r0.parameters[i0]=XA(i0)})}),iq("PLUGIN_INFO",e0)},ChannelMediaRelayError:Qw,ChannelMediaRelayEvent:Jw,ChannelMediaRelayState:Xw,RemoteStreamFallbackType:gL,RemoteStreamType:SL,ConnectionDisconnectedReason:Hy,AudienceLatencyLevelType:Wy,AREAS:iO,preload:async function(t0,e0,n0,r0){return KB(t0,e0,n0,r0)}});Object.defineProperties(nq,{onAudioAutoplayFailed:{get:()=>pk.onAudioAutoplayFailed,set:t0=>{pk.onAudioAutoplayFailed=t0}},onAutoplayFailed:{get:()=>pk.onAutoplayFailed,set:t0=>{pk.onAutoplayFailed=t0}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>nq._onSecurityPolicyViolation,set(t0){nq._onSecurityPolicyViolation=t0,LG(t0)}},__CLIENT_LIST__:{get:()=>XA("SHOW_GLOBAL_CLIENT_LIST")?wb:[]}}),uk.on(kL.CAMERA_DEVICE_CHANGED,t0=>{fb.info("camera device changed",JSON.stringify(t0)),nq.onCameraChanged&&nq.onCameraChanged(t0),nq.safeEmit(SO.CAMERA_CHANGED,t0)}),uk.on(kL.RECORDING_DEVICE_CHANGED,t0=>{fb.info("microphone device changed",JSON.stringify(t0)),nq.onMicrophoneChanged&&nq.onMicrophoneChanged(t0),nq.safeEmit(SO.MICROPHONE_CHANGED,t0)}),uk.on(kL.PLAYOUT_DEVICE_CHANGED,t0=>{fb.debug("playout device changed",JSON.stringify(t0)),nq.onPlaybackDeviceChanged&&nq.onPlaybackDeviceChanged(t0),nq.safeEmit(SO.PLAYBACK_DEVICE_CHANGED,t0)}),mk.onAutoplayFailed=()=>{fb.info("detect audio element autoplay failed"),pk.onAudioAutoplayFailed&&pk.onAudioAutoplayFailed()},qL.on("autoplay-failed",()=>{fb.info("detect webaudio autoplay failed"),pk.onAudioAutoplayFailed&&pk.onAudioAutoplayFailed(),nq.safeEmit(SO.AUTOPLAY_FAILED)}),qL.on(tL.STATE_CHANGE,(t0,e0)=>{fb.info("audio context state changed: ".concat(e0," => ").concat(t0)),nq.onAudioContextStateChanged&&nq.onAudioContextStateChanged(t0,e0),nq.safeEmit(SO.AUDIO_CONTEXT_STATE_CHANGED,t0,e0)}),iA.on(Qy.NETWORK_STATE_CHANGE,(t0,e0)=>{fb.info("[network-indicator] network state changed, ".concat(e0," => ").concat(t0))}),window&&(window.__ARTC__=nq);function _objectWithoutPropertiesLoose(t0,e0){if(t0==null)return{};var n0={},r0=Object.keys(t0),i0,o0;for(o0=0;o0<r0.length;o0++)i0=r0[o0],!(e0.indexOf(i0)>=0)&&(n0[i0]=t0[i0]);return n0}var AgoraRTCErrorCode;(function(t0){t0.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t0.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t0.TIMEOUT="TIMEOUT",t0.INVALID_PARAMS="INVALID_PARAMS",t0.NOT_SUPPORTED="NOT_SUPPORTED",t0.INVALID_OPERATION="INVALID_OPERATION",t0.OPERATION_ABORTED="OPERATION_ABORTED",t0.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t0.NETWORK_ERROR="NETWORK_ERROR",t0.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t0.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t0.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t0.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t0.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t0.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t0.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t0.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t0.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t0.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t0.PERMISSION_DENIED="PERMISSION_DENIED",t0.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t0.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t0.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t0.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t0.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t0.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t0.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t0.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t0.UID_CONFLICT="UID_CONFLICT",t0.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t0.INVALID_TRACK="INVALID_TRACK",t0.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t0.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t0.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t0.ICE_FAILED="ICE_FAILED",t0.PC_CLOSED="PC_CLOSED",t0.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t0.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t0.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t0.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t0.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t0.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t0.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t0.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t0.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t0.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t0.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t0.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t0.WS_ABORT="WS_ABORT",t0.WS_DISCONNECT="WS_DISCONNECT",t0.WS_ERR="WS_ERR",t0.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t0.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t0.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t0.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t0.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t0.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t0.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t0.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t0.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t0.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t0.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t0.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t0.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t0.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t0.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t0.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t0.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t0.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"})(AgoraRTCErrorCode||(AgoraRTCErrorCode={}));var createClient$1=function(e0){var n0;function r0(){return n0||(n0=nq.createClient(e0)),n0}return function(){return r0()}};function createMicrophoneAndCameraTracks(t0,e0){var n0=function(){try{return Promise.resolve(nq.createMicrophoneAndCameraTracks(t0,e0)).then(function(o0){return r0=o0,r0})}catch(o0){return Promise.reject(o0)}},r0=null;return function(){var o0=reactExports.useState(!1),s0=o0[0],a0=o0[1],c0=reactExports.useState(null),u0=c0[0],l0=c0[1],d0=reactExports.useRef(r0);return reactExports.useEffect(function(){return d0.current===null?n0().then(function(h0){d0.current=h0,a0(!0)},function(h0){l0(h0)}):a0(!0),function(){r0=null}},[]),{ready:s0,tracks:d0.current,error:u0}}}function createBufferSourceAudioTrack(t0){var e0=function(){try{return Promise.resolve(nq.createBufferSourceAudioTrack(t0)).then(function(i0){return n0=i0,n0})}catch(i0){return Promise.reject(i0)}},n0=null;return function(){var i0=reactExports.useState(!1),o0=i0[0],s0=i0[1],a0=reactExports.useState(null),c0=a0[0],u0=a0[1],l0=reactExports.useRef(n0);return reactExports.useEffect(function(){return l0.current===null?e0().then(function(d0){l0.current=d0,s0(!0)},function(d0){u0(d0)}):s0(!0),function(){n0=null}},[]),{ready:o0,track:l0.current,error:c0}}}function createCameraVideoTrack(t0){var e0=function(){try{return Promise.resolve(nq.createCameraVideoTrack(t0)).then(function(i0){return n0=i0,n0})}catch(i0){return Promise.reject(i0)}},n0=null;return function(){var i0=reactExports.useState(!1),o0=i0[0],s0=i0[1],a0=reactExports.useState(null),c0=a0[0],u0=a0[1],l0=reactExports.useRef(n0);return reactExports.useEffect(function(){return l0.current===null?e0().then(function(d0){l0.current=d0,s0(!0)},function(d0){u0(d0)}):s0(!0),function(){n0=null}},[]),{ready:o0,track:l0.current,error:c0}}}function createCustomAudioTrack(t0){var e0=function(){try{return Promise.resolve(nq.createCustomAudioTrack(t0)).then(function(i0){return n0=i0,n0})}catch(i0){return Promise.reject(i0)}},n0=null;return function(){var i0=reactExports.useState(!1),o0=i0[0],s0=i0[1],a0=reactExports.useState(null),c0=a0[0],u0=a0[1],l0=reactExports.useRef(n0);return reactExports.useEffect(function(){return l0.current===null?e0().then(function(d0){l0.current=d0,s0(!0)},function(d0){u0(d0)}):s0(!0),function(){n0=null}},[]),{ready:o0,track:l0.current,error:c0}}}function createCustomVideoTrack(t0){var e0=function(){try{return Promise.resolve(nq.createCustomVideoTrack(t0)).then(function(i0){return n0=i0,n0})}catch(i0){return Promise.reject(i0)}},n0=null;return function(){var i0=reactExports.useState(!1),o0=i0[0],s0=i0[1],a0=reactExports.useState(null),c0=a0[0],u0=a0[1],l0=reactExports.useRef(n0);return reactExports.useEffect(function(){return l0.current===null?e0().then(function(d0){l0.current=d0,s0(!0)},function(d0){u0(d0)}):s0(!0),function(){n0=null}},[]),{ready:o0,track:l0.current,error:c0}}}function createMicrophoneAudioTrack(t0){var e0=function(){try{return Promise.resolve(nq.createMicrophoneAudioTrack(t0)).then(function(i0){return n0=i0,n0})}catch(i0){return Promise.reject(i0)}},n0=null;return function(){var i0=reactExports.useState(!1),o0=i0[0],s0=i0[1],a0=reactExports.useState(null),c0=a0[0],u0=a0[1],l0=reactExports.useRef(n0);return reactExports.useEffect(function(){return l0.current===null?e0().then(function(d0){l0.current=d0,s0(!0)},function(d0){u0(d0)}):s0(!0),function(){n0=null}},[]),{ready:o0,track:l0.current,error:c0}}}function createScreenVideoTrack(t0,e0){var n0=function(){try{return Promise.resolve(nq.createScreenVideoTrack(t0,e0)).then(function(o0){return r0=o0,r0})}catch(o0){return Promise.reject(o0)}},r0;return function(){var o0=reactExports.useState(!1),s0=o0[0],a0=o0[1],c0=reactExports.useState(null),u0=c0[0],l0=c0[1],d0=reactExports.useRef(r0);return reactExports.useEffect(function(){d0.current===void 0?n0().then(function(h0){d0.current=h0,a0(!0)},function(h0){l0(h0)}):a0(!0)},[]),{ready:s0,tracks:d0.current,error:u0}}}var AgoraVideoPlayer=function(e0){var n0=reactExports.useRef(null),r0=e0.videoTrack,i0=e0.config,o0=_objectWithoutPropertiesLoose(e0,["videoTrack","config"]);return reactExports.useLayoutEffect(function(){return n0.current!==null&&r0.play(n0.current,i0),function(){r0.stop()}},[r0]),React.createElement("div",Object.assign({},o0,{ref:n0}))},agoraRtmSdk$1={exports:{}},agoraRtmSdk=agoraRtmSdk$1.exports;(function(module,exports){"use strict";var define_process_env_default={};/*
 @preserve
 AgoraRTM Web SDK 1.4.3-203 - commit: v1.4.3-17-g1e27aa38
 Copyright (C) 2018-2021 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/(function(t0,e0){module.exports=e0()})(commonjsGlobal,function(){function be(t0,e0){var n0=Object.keys(t0);if(Object.getOwnPropertySymbols){var r0=Object.getOwnPropertySymbols(t0);e0&&(r0=r0.filter(function(i0){return Object.getOwnPropertyDescriptor(t0,i0).enumerable})),n0.push.apply(n0,r0)}return n0}function ua(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0]!=null?arguments[e0]:{};e0%2?be(Object(n0),!0).forEach(function(r0){m(t0,r0,n0[r0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t0,Object.getOwnPropertyDescriptors(n0)):be(Object(n0)).forEach(function(r0){Object.defineProperty(t0,r0,Object.getOwnPropertyDescriptor(n0,r0))})}return t0}function X(t0){return(X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e0){return typeof e0}:function(e0){return e0&&typeof Symbol=="function"&&e0.constructor===Symbol&&e0!==Symbol.prototype?"symbol":typeof e0})(t0)}function sl(t0,e0,n0,r0,i0,o0,s0){try{var a0=t0[o0](s0),c0=a0.value}catch(u0){return void n0(u0)}a0.done?e0(c0):Promise.resolve(c0).then(r0,i0)}function J(t0){return function(){var e0=this,n0=arguments;return new Promise(function(r0,i0){function o0(c0){sl(a0,r0,i0,o0,s0,"next",c0)}function s0(c0){sl(a0,r0,i0,o0,s0,"throw",c0)}var a0=t0.apply(e0,n0);o0(void 0)})}}function W(t0,e0){if(!(t0 instanceof e0))throw new TypeError("Cannot call a class as a function")}function tl(t0,e0){for(var n0=0;n0<e0.length;n0++){var r0=e0[n0];r0.enumerable=r0.enumerable||!1,r0.configurable=!0,"value"in r0&&(r0.writable=!0),Object.defineProperty(t0,r0.key,r0)}}function Ha(t0,e0,n0){return e0&&tl(t0.prototype,e0),n0&&tl(t0,n0),t0}function m(t0,e0,n0){return e0 in t0?Object.defineProperty(t0,e0,{value:n0,enumerable:!0,configurable:!0,writable:!0}):t0[e0]=n0,t0}function la(t0,e0){if(typeof e0!="function"&&e0!==null)throw new TypeError("Super expression must either be null or a function");t0.prototype=Object.create(e0&&e0.prototype,{constructor:{value:t0,writable:!0,configurable:!0}}),e0&&df(t0,e0)}function wd(t0){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(e0){return e0.__proto__||Object.getPrototypeOf(e0)})(t0)}function df(t0,e0){return(df=Object.setPrototypeOf||function(n0,r0){return n0.__proto__=r0,n0})(t0,e0)}function ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Sh(t0,e0,n0){return(Sh=ul()?Reflect.construct:function(r0,i0,o0){var s0=[null];return s0.push.apply(s0,i0),r0=new(Function.bind.apply(r0,s0)),o0&&df(r0,o0.prototype),r0}).apply(null,arguments)}function ef(t0){var e0=typeof Map=="function"?new Map:void 0;return(ef=function(n0){function r0(){return Sh(n0,arguments,wd(this).constructor)}if(n0===null||Function.toString.call(n0).indexOf("[native code]")===-1)return n0;if(typeof n0!="function")throw new TypeError("Super expression must either be null or a function");if(e0!==void 0){if(e0.has(n0))return e0.get(n0);e0.set(n0,r0)}return r0.prototype=Object.create(n0.prototype,{constructor:{value:r0,enumerable:!1,writable:!0,configurable:!0}}),df(r0,n0)})(t0)}function ff(t0,e0){if(t0==null)return{};if(t0==null)var n0={};else{n0={};var r0,i0=Object.keys(t0);for(r0=0;r0<i0.length;r0++){var o0=i0[r0];0<=e0.indexOf(o0)||(n0[o0]=t0[o0])}}if(Object.getOwnPropertySymbols)for(r0=Object.getOwnPropertySymbols(t0),o0=0;o0<r0.length;o0++)i0=r0[o0],0<=e0.indexOf(i0)||Object.prototype.propertyIsEnumerable.call(t0,i0)&&(n0[i0]=t0[i0]);return n0}function n(t0){if(t0===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t0}function ma(t0){var e0=ul();return function(){var n0=wd(t0);if(e0){var r0=wd(this).constructor;n0=Reflect.construct(n0,arguments,r0)}else n0=n0.apply(this,arguments);return n0=!n0||typeof n0!="object"&&typeof n0!="function"?n(this):n0}}function Th(t0,e0,n0){return(Th=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(r0,i0,o0){for(;!Object.prototype.hasOwnProperty.call(r0,i0)&&(r0=wd(r0))!==null;);if(r0)return(i0=Object.getOwnPropertyDescriptor(r0,i0)).get?i0.get.call(o0):i0.value})(t0,e0,n0||t0)}function ra(t0,e0){var n0=Array.isArray(t0)?t0:void 0;if(!n0)if((n0=t0&&(typeof Symbol<"u"&&t0[Symbol.iterator]||t0["@@iterator"]))==null)n0=void 0;else{var r0,i0=[],o0=!0,s0=!1;try{for(n0=n0.call(t0);!(o0=(r0=n0.next()).done)&&(i0.push(r0.value),!e0||i0.length!==e0);o0=!0);}catch(c0){s0=!0;var a0=c0}finally{try{o0||n0.return==null||n0.return()}finally{if(s0)throw a0}}n0=i0}if(!(t0=n0||vl(t0,e0)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return t0}function G(t0){var e0=Array.isArray(t0)?Uh(t0):void 0;if(e0||(e0=typeof Symbol<"u"&&t0[Symbol.iterator]!=null||t0["@@iterator"]!=null?Array.from(t0):void 0),!(t0=e0||vl(t0)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return t0}function vl(t0,e0){if(t0){if(typeof t0=="string")return Uh(t0,e0);var n0=Object.prototype.toString.call(t0).slice(8,-1);if(n0==="Object"&&t0.constructor&&(n0=t0.constructor.name),n0==="Map"||n0==="Set")return Array.from(t0);if(n0==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n0))return Uh(t0,e0)}}function Uh(t0,e0){(e0==null||e0>t0.length)&&(e0=t0.length);for(var n0=0,r0=Array(e0);n0<e0;n0++)r0[n0]=t0[n0];return r0}function fa(t0,e0,n0,r0,i0){var o0={};return Object.keys(r0).forEach(function(s0){o0[s0]=r0[s0]}),o0.enumerable=!!o0.enumerable,o0.configurable=!!o0.configurable,("value"in o0||o0.initializer)&&(o0.writable=!0),o0=n0.slice().reverse().reduce(function(s0,a0){return a0(t0,e0,s0)||s0},o0),i0&&o0.initializer!==void 0&&(o0.value=o0.initializer?o0.initializer.call(i0):void 0,o0.initializer=void 0),o0.initializer===void 0&&(Object.defineProperty(t0,e0,o0),o0=null),o0}function $a(t0){var e0={exports:{}};return t0(e0,e0.exports),e0.exports}function wl(t0,e0){var n0,r0=3>arguments.length?t0:arguments[2];return va(t0)===r0?t0[e0]:(n0=Fb.f(t0,e0))?Q(n0,"value")?n0.value:n0.get===void 0?void 0:n0.get.call(r0):ha(n0=Vb(t0))?wl(n0,e0,r0):void 0}function rs(t0){var e0=t0.charCodeAt(0)<<24,n0=0|ss(~e0),r0=0,i0=0|t0.length,o0="";if(5>n0&&i0>=n0){for(e0=e0<<n0>>>24+n0,r0=1;r0<n0;r0=r0+1|0)e0=e0<<6|63&t0.charCodeAt(r0);65535>=e0?o0+=xd(e0):1114111>=e0?o0+=xd(55296+((e0=e0-65536|0)>>10)|0,56320+(1023&e0)|0):r0=0}for(;r0<i0;r0=r0+1|0)o0+="";return o0}function xl(){}function ts(t0){var e0=0|t0.charCodeAt(0);if(55296<=e0&&56319>=e0){var n0=0|t0.charCodeAt(1);if(!(n0==n0&&56320<=n0&&57343>=n0))return xd(239,191,189);if(65535<(e0=(e0-55296<<10)+n0-56320+65536|0))return xd(240|e0>>>18,128|e0>>>12&63,128|e0>>>6&63,128|63&e0)}return 127>=e0?t0:2047>=e0?xd(192|e0>>>6,128|63&e0):xd(224|e0>>>12,128|e0>>>6&63,128|63&e0)}function yl(){}function ea(){ea.init.call(this)}function ng(t0){if(typeof t0!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+X(t0))}function zl(t0,e0,n0,r0){ng(n0);var i0=t0._events;if(i0===void 0)i0=t0._events=Object.create(null),t0._eventsCount=0;else{i0.newListener!==void 0&&(t0.emit("newListener",e0,n0.listener?n0.listener:n0),i0=t0._events);var o0=i0[e0]}return o0===void 0?(i0[e0]=n0,++t0._eventsCount):(typeof o0=="function"?o0=i0[e0]=r0?[n0,o0]:[o0,n0]:r0?o0.unshift(n0):o0.push(n0),0<(n0=t0._maxListeners===void 0?ea.defaultMaxListeners:t0._maxListeners)&&o0.length>n0&&!o0.warned&&(o0.warned=!0,(n0=Error("Possible EventEmitter memory leak detected. "+o0.length+" "+String(e0)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n0.emitter=t0,n0.type=e0,n0.count=o0.length,console&&console.warn&&console.warn(n0))),t0}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(t0,e0,n0){return t0={fired:!1,wrapFn:void 0,target:t0,type:e0,listener:n0},(e0=us.bind(t0)).listener=n0,t0.wrapFn=e0}function Bl(t0,e0,n0){if((t0=t0._events)===void 0)return[];if((e0=t0[e0])===void 0)return[];if(typeof e0=="function")return n0?[e0.listener||e0]:[e0];if(n0)for(n0=Array(e0.length),t0=0;t0<n0.length;++t0)n0[t0]=e0[t0].listener||e0[t0];else n0=Cl(e0,e0.length);return n0}function Dl(t0){var e0=this._events;if(e0!==void 0){if(typeof(t0=e0[t0])=="function")return 1;if(t0!==void 0)return t0.length}return 0}function Cl(t0,e0){for(var n0=Array(e0),r0=0;r0<e0;++r0)n0[r0]=t0[r0];return n0}function vs(t0,e0,n0){typeof t0.on=="function"&&El(t0,"error",e0,n0)}function El(t0,e0,n0,r0){if(typeof t0.on=="function")r0.once?t0.once(e0,n0):t0.on(e0,n0);else{if(typeof t0.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(t0));t0.addEventListener(e0,function i0(o0){r0.once&&t0.removeEventListener(e0,i0),n0(o0)})}}function ws(t0){return t0?G(t0):xs(function(){return[]},function(e0,n0){return e0.push(n0),e0})}function Fl(t0,e0){var n0,r0,i0,o0;return w.wrap(function(s0){for(;;)switch(s0.prev=s0.next){case 0:n0=Gl(t0)([Hl,Hl,function(a0,c0){return c0}])[2],r0=0;case 2:if(!(r0<e0.length)){s0.next=17;break}if(i0=e0[r0],!((o0=n0(Vh,i0))instanceof og)){s0.next=11;break}if((o0=Wh(o0.deref()))===Vh){s0.next=10;break}return s0.next=10,o0;case 10:return s0.abrupt("return");case 11:if(o0===Vh){s0.next=14;break}return s0.next=14,o0;case 14:r0++,s0.next=2;break;case 17:case"end":return s0.stop()}},ys)}function pg(t0,e0){return e0!=null&&typeof e0[Symbol.iterator]=="function"?Fl(pg(t0),e0):function(n0){var r0=n0[2];return zs(n0,function(i0,o0){return r0(i0,t0(o0))})}}function Ac(t0){return Object.prototype.toString.call(t0).slice(8,-1)}function yd(t0){return Ac(t0)==="Object"&&t0.constructor===Object&&Object.getPrototypeOf(t0)===Object.prototype}function Il(t0){var e0;return(e0=Ac(t0)==="Boolean"||Ac(t0)==="Null"||Ac(t0)==="Undefined")||(e0=Ac(t0)==="Number"&&!isNaN(t0)),e0||Ac(t0)==="String"||Ac(t0)==="Symbol"}function zd(t0){var e0=-1,n0=t0==null?0:t0.length;for(this.clear();++e0<n0;){var r0=t0[e0];this.set(r0[0],r0[1])}}function ce(t0){var e0=-1,n0=t0==null?0:t0.length;for(this.clear();++e0<n0;){var r0=t0[e0];this.set(r0[0],r0[1])}}function de(t0){var e0=-1,n0=t0==null?0:t0.length;for(this.clear();++e0<n0;){var r0=t0[e0];this.set(r0[0],r0[1])}}function gf(t0){var e0=-1,n0=t0==null?0:t0.length;for(this.__data__=new qg;++e0<n0;)this.add(t0[e0])}function ee(t0){this.size=(this.__data__=new rg(t0)).size}function fe(t0,e0,n0,r0,i0,o0){var s0,a0=1&e0,c0=2&e0,u0=4&e0;if(n0&&(s0=i0?n0(t0,r0,i0,o0):n0(t0)),s0!==void 0)return s0;if(!lb(t0))return t0;if(r0=Va(t0)){if(s0=As(t0),!a0)return Xh(t0,s0)}else{var l0=hf(t0),d0=l0=="[object Function]"||l0=="[object GeneratorFunction]";if(jf(t0))return Jl(t0,a0);if(l0=="[object Object]"||l0=="[object Arguments]"||d0&&!i0){if(s0=c0||d0?{}:Kl(t0),!a0)return c0?Bs(t0,Cs(s0,t0)):Ds(t0,Es(s0,t0))}else{if(!wa[l0])return i0?t0:{};s0=Fs(t0,l0,a0)}}if(o0||(o0=new ge),i0=o0.get(t0))return i0;o0.set(t0,s0),Gs(t0)?t0.forEach(function(p0){s0.add(fe(p0,e0,n0,p0,t0,o0))}):Hs(t0)&&t0.forEach(function(p0,m0){s0.set(m0,fe(p0,e0,n0,m0,t0,o0))}),c0=u0?c0?Ll:Yh:c0?kf:Ad;var h0=r0?void 0:c0(t0);return Is(h0||t0,function(p0,m0){h0&&(p0=t0[m0=p0]),Ml(s0,m0,fe(p0,e0,n0,m0,t0,o0))}),s0}function Zh(t0,e0){if(typeof t0!="function"||e0!=null&&typeof e0!="function")throw new TypeError("Expected a function");var n0=function r0(){var i0=arguments,o0=e0?e0.apply(this,i0):i0[0],s0=r0.cache;return s0.has(o0)?s0.get(o0):(i0=t0.apply(this,i0),r0.cache=s0.set(o0,i0)||s0,i0)};return n0.cache=new(Zh.Cache||qg),n0}function Nl(t0){if(typeof t0=="string")return t0;if(Va(t0))return he(t0,Nl)+"";if(ie(t0))return Ol?Ol.call(t0):"";var e0=t0+"";return e0=="0"&&1/t0==-Js?"-0":e0}function $h(t0,e0,n0,r0,i0){var o0=-1,s0=t0.length;for(n0||(n0=Ks),i0||(i0=[]);++o0<s0;){var a0=t0[o0];0<e0&&n0(a0)?1<e0?$h(a0,e0-1,n0,r0,i0):ai(i0,a0):r0||(i0[i0.length]=a0)}return i0}function je(t0,e0,n0,r0,i0){if(t0===e0)e0=!0;else if(t0==null||e0==null||!gc(t0)&&!gc(e0))e0=t0!=t0&&e0!=e0;else t:{var o0=Va(t0),s0=Va(e0),a0=o0?"[object Array]":hf(t0),c0=s0?"[object Array]":hf(e0),u0=(a0=a0=="[object Arguments]"?"[object Object]":a0)=="[object Object]";if(s0=(c0=c0=="[object Arguments]"?"[object Object]":c0)=="[object Object]",(c0=a0==c0)&&jf(t0)){if(!jf(e0)){e0=!1;break t}o0=!0,u0=!1}if(c0&&!u0)i0||(i0=new ge),e0=o0||bi(t0)?Pl(t0,e0,n0,r0,je,i0):Ls(t0,e0,a0,n0,r0,je,i0);else{if(!(1&n0)&&(o0=u0&&Ql.call(t0,"__wrapped__"),a0=s0&&Ql.call(e0,"__wrapped__"),o0||a0)){t0=o0?t0.value():t0,e0=a0?e0.value():e0,i0||(i0=new ge),e0=je(t0,e0,n0,r0,i0);break t}if(c0)e:if(i0||(i0=new ge),o0=1&n0,a0=Yh(t0),s0=a0.length,c0=Yh(e0).length,s0==c0||o0){for(c0=s0;c0--;){var l0=a0[c0];if(!(o0?l0 in e0:Ms.call(e0,l0))){e0=!1;break e}}if(u0=i0.get(t0),l0=i0.get(e0),u0&&l0)e0=u0==e0&&l0==t0;else{u0=!0,i0.set(t0,e0),i0.set(e0,t0);for(var d0=o0;++c0<s0;){var h0=t0[l0=a0[c0]],p0=e0[l0];if(r0)var m0=o0?r0(p0,h0,l0,e0,t0,i0):r0(h0,p0,l0,t0,e0,i0);if(m0===void 0?h0!==p0&&!je(h0,p0,n0,r0,i0):!m0){u0=!1;break}d0||(d0=l0=="constructor")}u0&&!d0&&(n0=t0.constructor)!=(r0=e0.constructor)&&"constructor"in t0&&"constructor"in e0&&!(typeof n0=="function"&&n0 instanceof n0&&typeof r0=="function"&&r0 instanceof r0)&&(u0=!1),i0.delete(t0),i0.delete(e0),e0=u0}}else e0=!1;else e0=!1}}return e0}function xa(t0,e0,n0){this.low=0|t0,this.high=0|e0,this.unsigned=!!n0}function mb(t0){return(t0&&t0.__isLong__)===!0}function Bd(t0,e0){var n0;if(e0){if((e0=0<=(t0>>>=0)&&256>t0)&&(n0=Rl[t0]))return n0;n0=ya(t0,0>(0|t0)?-1:0,!0),e0&&(Rl[t0]=n0)}else{if((e0=-128<=(t0|=0)&&128>t0)&&(n0=Sl[t0]))return n0;n0=ya(t0,0>t0?-1:0,!1),e0&&(Sl[t0]=n0)}return n0}function Gb(t0,e0){if(isNaN(t0))return e0?Cd:Hb;if(e0){if(0>t0)return Cd;if(t0>=Tl)return Ul}else{if(t0<=-Vl)return nb;if(t0+1>=Vl)return Wl}return 0>t0?Gb(-t0,e0).neg():ya(t0%ke|0,t0/ke|0,e0)}function ya(t0,e0,n0){return new xa(t0,e0,n0)}function ci(t0,e0,n0){if(t0.length===0)throw Error("empty string");if(t0==="NaN"||t0==="Infinity"||t0==="+Infinity"||t0==="-Infinity")return Hb;if(typeof e0=="number"?(n0=e0,e0=!1):e0=!!e0,2>(n0=n0||10)||36<n0)throw RangeError("radix");var r0;if(0<(r0=t0.indexOf("-")))throw Error("interior hyphen");if(r0===0)return ci(t0.substring(1),e0,n0).neg();r0=Gb(sg(n0,8));for(var i0=Hb,o0=0;o0<t0.length;o0+=8){var s0=Math.min(8,t0.length-o0),a0=parseInt(t0.substring(o0,o0+s0),n0);8>s0?(s0=Gb(sg(n0,s0)),i0=i0.mul(s0).add(Gb(a0))):i0=(i0=i0.mul(r0)).add(Gb(a0))}return i0.unsigned=e0,i0}function Wb(t0,e0){return typeof t0=="number"?Gb(t0,e0):typeof t0=="string"?ci(t0,e0):ya(t0.low,t0.high,typeof e0=="boolean"?e0:t0.unsigned)}function O(t0,e0){function n0(){this.constructor=t0}di(t0,e0),t0.prototype=e0===null?Object.create(e0):(n0.prototype=e0.prototype,new n0)}function le(t0){return typeof t0=="function"}function me(t0){setTimeout(function(){throw t0},0)}function ei(t0){return t0!==null&&X(t0)==="object"}function Xl(t0){return t0.reduce(function(e0,n0){return e0.concat(n0 instanceof lf?n0.errors:n0)},[])}function fi(t0){for(;t0;){var e0=t0.destination,n0=t0.isStopped;if(t0.closed||n0)return!1;t0=e0&&e0 instanceof ia?e0:null}return!0}function Yc(t0){return t0}function gi(){for(var t0=[],e0=0;e0<arguments.length;e0++)t0[e0]=arguments[e0];return Yl(t0)}function Yl(t0){return t0.length===0?Yc:t0.length===1?t0[0]:function(e0){return t0.reduce(function(n0,r0){return r0(n0)},e0)}}function Zl(t0){if(t0||(t0=Ib.Promise||Promise),!t0)throw Error("no Promise impl found");return t0}function $l(){return function(t0){return t0.lift(new Ns(t0))}}function mf(t0){return t0?Os(t0):vb}function Os(t0){return new Y(function(e0){return t0.schedule(function(){return e0.complete()})})}function Zc(t0){return t0&&typeof t0.schedule=="function"}function hi(t0,e0){return new Y(function(n0){var r0=new Oa,i0=0;return r0.add(e0.schedule(function(){i0===t0.length?n0.complete():(n0.next(t0[i0++]),n0.closed||r0.add(this.schedule()))})),r0})}function nf(t0,e0){return e0?hi(t0,e0):new Y(am(t0))}function bb(){for(var t0=[],e0=0;e0<arguments.length;e0++)t0[e0]=arguments[e0];return Zc(e0=t0[t0.length-1])?(t0.pop(),hi(t0,e0)):nf(t0)}function Z(t0,e0){return new Y(e0?function(n0){return e0.schedule(Ps,0,{error:t0,subscriber:n0})}:function(n0){return n0.error(t0)})}function Ps(t0){t0.subscriber.error(t0.error)}function Qs(t0,e0){return e0===void 0&&(e0=0),function(n0){return n0.lift(new Rs(t0,e0))}}function bm(t0){return t0 in ii&&(delete ii[t0],!0)}function hc(){}function ba(t0,e0){return function(n0){if(typeof t0!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n0.lift(new Ss(t0,e0))}}function cm(t0,e0,n0){if(e0){if(!Zc(e0))return function(){for(var r0=[],i0=0;i0<arguments.length;i0++)r0[i0]=arguments[i0];return cm(t0,n0).apply(void 0,r0).pipe(ba(function(o0){return Jb(o0)?e0.apply(void 0,o0):e0(o0)}))};n0=e0}return function(){for(var r0=[],i0=0;i0<arguments.length;i0++)r0[i0]=arguments[i0];var o0,s0=this,a0={context:s0,subject:o0,callbackFunc:t0,scheduler:n0};return new Y(function(c0){if(n0)return n0.schedule(Ts,0,{args:r0,subscriber:c0,params:a0});if(!o0){o0=new of;try{t0.apply(s0,r0.concat([function(){for(var u0=[],l0=0;l0<arguments.length;l0++)u0[l0]=arguments[l0];o0.next(1>=u0.length?u0[0]:u0),o0.complete()}]))}catch(u0){fi(o0)?o0.error(u0):console.warn(u0)}}return o0.subscribe(c0)})}}function Ts(t0){var e0=this,n0=t0.args,r0=t0.subscriber,i0=t0.params;t0=i0.callbackFunc;var o0=i0.context,s0=i0.scheduler,a0=i0.subject;if(!a0){a0=i0.subject=new of,i0=function(){for(var c0=[],u0=0;u0<arguments.length;u0++)c0[u0]=arguments[u0];e0.add(s0.schedule(Us,0,{value:1>=c0.length?c0[0]:c0,subject:a0}))};try{t0.apply(o0,n0.concat([i0]))}catch(c0){a0.error(c0)}}this.add(a0.subscribe(r0))}function Us(t0){var e0=t0.subject;e0.next(t0.value),e0.complete()}function dm(t0,e0,n0){if(e0){if(!Zc(e0))return function(){for(var r0=[],i0=0;i0<arguments.length;i0++)r0[i0]=arguments[i0];return dm(t0,n0).apply(void 0,r0).pipe(ba(function(o0){return Jb(o0)?e0.apply(void 0,o0):e0(o0)}))};n0=e0}return function(){for(var r0=[],i0=0;i0<arguments.length;i0++)r0[i0]=arguments[i0];var o0={subject:void 0,args:r0,callbackFunc:t0,scheduler:n0,context:this};return new Y(function(s0){var a0=o0.context,c0=o0.subject;if(n0)return n0.schedule(Vs,0,{params:o0,subscriber:s0,context:a0});if(!c0){c0=o0.subject=new of;try{t0.apply(a0,r0.concat([function(){for(var u0=[],l0=0;l0<arguments.length;l0++)u0[l0]=arguments[l0];(l0=u0.shift())?c0.error(l0):(c0.next(1>=u0.length?u0[0]:u0),c0.complete())}]))}catch(u0){fi(c0)?c0.error(u0):console.warn(u0)}}return c0.subscribe(s0)})}}function Vs(t0){var e0=this,n0=t0.params,r0=t0.subscriber;t0=t0.context;var i0=n0.callbackFunc,o0=n0.args,s0=n0.scheduler,a0=n0.subject;if(!a0){a0=n0.subject=new of,n0=function(){for(var c0=[],u0=0;u0<arguments.length;u0++)c0[u0]=arguments[u0];(u0=c0.shift())?e0.add(s0.schedule(em,0,{err:u0,subject:a0})):e0.add(s0.schedule(Ws,0,{value:1>=c0.length?c0[0]:c0,subject:a0}))};try{i0.apply(t0,o0.concat([n0]))}catch(c0){this.add(s0.schedule(em,0,{err:c0,subject:a0}))}}this.add(a0.subscribe(r0))}function Ws(t0){var e0=t0.subject;e0.next(t0.value),e0.complete()}function em(t0){t0.subject.error(t0.err)}function fm(t0){return!!t0&&typeof t0.subscribe!="function"&&typeof t0.then=="function"}function ji(t0,e0,n0,r0,i0){if(i0===void 0&&(i0=new Xs(t0,n0,r0)),!i0.closed)return e0 instanceof Y?e0.subscribe(i0):pf(e0)(i0)}function Ys(t0,e0){return new Y(function(n0){var r0=new Oa;return r0.add(e0.schedule(function(){var i0=t0[ne]();r0.add(i0.subscribe({next:function(o0){r0.add(e0.schedule(function(){return n0.next(o0)}))},error:function(o0){r0.add(e0.schedule(function(){return n0.error(o0)}))},complete:function(){r0.add(e0.schedule(function(){return n0.complete()}))}}))})),r0})}function Zs(t0,e0){return new Y(function(n0){var r0=new Oa;return r0.add(e0.schedule(function(){return t0.then(function(i0){r0.add(e0.schedule(function(){n0.next(i0),r0.add(e0.schedule(function(){return n0.complete()}))}))},function(i0){r0.add(e0.schedule(function(){return n0.error(i0)}))})})),r0})}function $s(t0,e0){if(!t0)throw Error("Iterable cannot be null");return new Y(function(n0){var r0,i0=new Oa;return i0.add(function(){r0&&typeof r0.return=="function"&&r0.return()}),i0.add(e0.schedule(function(){r0=t0[$c](),i0.add(e0.schedule(function(){if(!n0.closed){try{var o0=r0.next(),s0=o0.value,a0=o0.done}catch(c0){return void n0.error(c0)}a0?n0.complete():(n0.next(s0),this.schedule())}}))})),i0})}function gm(t0,e0){if(t0!=null){if(t0&&typeof t0[ne]=="function")return Ys(t0,e0);if(fm(t0))return Zs(t0,e0);if(hm(t0))return hi(t0,e0);if(t0&&typeof t0[$c]=="function"||typeof t0=="string")return $s(t0,e0)}throw new TypeError((t0!==null&&X(t0)||t0)+" is not observable")}function Kb(t0,e0){return e0?gm(t0,e0):t0 instanceof Y?t0:new Y(pf(t0))}function ic(t0,e0){if(!e0.closed){if(t0 instanceof Y)return t0.subscribe(e0);try{var n0=pf(t0)(e0)}catch(r0){e0.error(r0)}return n0}}function cb(t0,e0,n0){return n0===void 0&&(n0=Number.POSITIVE_INFINITY),typeof e0=="function"?function(r0){return r0.pipe(cb(function(i0,o0){return Kb(t0(i0,o0)).pipe(ba(function(s0,a0){return e0(i0,s0,o0,a0)}))},n0))}:(typeof e0=="number"&&(n0=e0),function(r0){return r0.lift(new at(t0,n0))})}function tg(t0){return t0===void 0&&(t0=Number.POSITIVE_INFINITY),cb(Yc,t0)}function im(){for(var t0=[],e0=0;e0<arguments.length;e0++)t0[e0]=arguments[e0];return tg(1)(bb.apply(void 0,t0))}function ad(t0){return new Y(function(e0){try{var n0=t0()}catch(r0){return void e0.error(r0)}return(n0?Kb(n0):mf()).subscribe(e0)})}function jm(){for(var t0=[],e0=0;e0<arguments.length;e0++)t0[e0]=arguments[e0];if(t0.length===1){var n0=t0[0];if(Jb(n0))return ug(n0,null);if(ei(n0)&&Object.getPrototypeOf(n0)===Object.prototype)return ug((t0=Object.keys(n0)).map(function(i0){return n0[i0]}),t0)}if(typeof t0[t0.length-1]=="function"){var r0=t0.pop();return ug(t0=t0.length===1&&Jb(t0[0])?t0[0]:t0,null).pipe(ba(function(i0){return r0.apply(void 0,i0)}))}return ug(t0,null)}function ug(t0,e0){return new Y(function(n0){var r0=t0.length;if(r0===0)n0.complete();else for(var i0=Array(r0),o0=0,s0=0,a0=function(u0){var l0=Kb(t0[u0]),d0=!1;n0.add(l0.subscribe({next:function(h0){d0||(d0=!0,s0++),i0[u0]=h0},error:function(h0){return n0.error(h0)},complete:function(){++o0!==r0&&d0||(s0===r0&&n0.next(e0?e0.reduce(function(h0,p0,m0){return h0[p0]=i0[m0],h0},{}):i0),n0.complete())}}))},c0=0;c0<r0;c0++)a0(c0)})}function gb(t0,e0,n0,r0){return le(n0)&&(r0=n0,n0=void 0),r0?gb(t0,e0,n0).pipe(ba(function(i0){return Jb(i0)?r0.apply(void 0,i0):r0(i0)})):new Y(function(i0){km(t0,e0,function(o0){1<arguments.length?i0.next(Array.prototype.slice.call(arguments)):i0.next(o0)},i0,n0)})}function km(t0,e0,n0,r0,i0){if(t0&&typeof t0.addEventListener=="function"&&typeof t0.removeEventListener=="function"){t0.addEventListener(e0,n0,i0);var o0=function(){return t0.removeEventListener(e0,n0,i0)}}else if(t0&&typeof t0.on=="function"&&typeof t0.off=="function")t0.on(e0,n0),o0=function(){return t0.off(e0,n0)};else if(t0&&typeof t0.addListener=="function"&&typeof t0.removeListener=="function")t0.addListener(e0,n0),o0=function(){return t0.removeListener(e0,n0)};else{if(!t0||!t0.length)throw new TypeError("Invalid event target");for(var s0=0,a0=t0.length;s0<a0;s0++)km(t0[s0],e0,n0,r0,i0)}r0.add(o0)}function lm(t0,e0,n0){return n0?lm(t0,e0).pipe(ba(function(r0){return Jb(r0)?n0.apply(void 0,r0):n0(r0)})):new Y(function(r0){var i0=function(){for(var s0=[],a0=0;a0<arguments.length;a0++)s0[a0]=arguments[a0];return r0.next(s0.length===1?s0[0]:s0)};try{var o0=t0(i0)}catch(s0){return void r0.error(s0)}if(le(e0))return function(){return e0(i0,o0)}})}function bt(t0){var e0=t0.subscriber,n0=t0.condition;if(!e0.closed){if(t0.needIterate)try{t0.state=t0.iterate(t0.state)}catch(o0){return void e0.error(o0)}else t0.needIterate=!0;if(n0){var r0=void 0;try{r0=n0(t0.state)}catch(o0){return void e0.error(o0)}if(!r0)return void e0.complete();if(e0.closed)return}try{var i0=t0.resultSelector(t0.state)}catch(o0){return void e0.error(o0)}if(!e0.closed&&(e0.next(i0),!e0.closed))return this.schedule(t0)}}function ki(t0){return!Jb(t0)&&0<=t0-parseFloat(t0)+1}function mm(t0,e0){return t0===void 0&&(t0=0),e0===void 0&&(e0=bd),(!ki(t0)||0>t0)&&(t0=0),e0&&typeof e0.schedule=="function"||(e0=bd),new Y(function(n0){return n0.add(e0.schedule(ct,t0,{subscriber:n0,counter:0,period:t0})),n0})}function ct(t0){var e0=t0.subscriber,n0=t0.counter;t0=t0.period,e0.next(n0),this.schedule({subscriber:e0,counter:n0+1,period:t0},t0)}function Xb(){for(var t0=[],e0=0;e0<arguments.length;e0++)t0[e0]=arguments[e0];e0=Number.POSITIVE_INFINITY;var n0=null,r0=t0[t0.length-1];return Zc(r0)?(n0=t0.pop(),1<t0.length&&typeof t0[t0.length-1]=="number"&&(e0=t0.pop())):typeof r0=="number"&&(e0=t0.pop()),n0===null&&t0.length===1&&t0[0]instanceof Y?t0[0]:tg(e0)(nf(t0,n0))}function li(){for(var t0=[],e0=0;e0<arguments.length;e0++)t0[e0]=arguments[e0];if(t0.length===0)return vb;var n0=t0[0],r0=t0.slice(1);return t0.length===1&&Jb(n0)?li.apply(void 0,n0):new Y(function(i0){var o0=function(){return i0.add(li.apply(void 0,r0).subscribe(i0))};return Kb(n0).subscribe({next:function(s0){i0.next(s0)},error:o0,complete:o0})})}function dt(t0){var e0=t0.keys,n0=t0.index,r0=t0.subscriber,i0=t0.subscription;if(t0=t0.obj,!r0.closed)if(n0<e0.length){var o0=e0[n0];r0.next([o0,t0[o0]]),i0.add(this.schedule({keys:e0,index:n0+1,subscriber:r0,subscription:i0,obj:t0}))}else r0.complete()}function et(t0,e0){function n0(){return!n0.pred.apply(n0.thisArg,arguments)}return n0.pred=t0,n0.thisArg=e0,n0}function wb(t0,e0){return function(n0){return n0.lift(new ft(t0,e0))}}function Ca(){for(var t0=[],e0=0;e0<arguments.length;e0++)t0[e0]=arguments[e0];if(t0.length===1){if(!Jb(t0[0]))return t0[0];t0=t0[0]}return nf(t0,void 0).lift(new gt)}function ht(t0){var e0=t0.start,n0=t0.index,r0=t0.subscriber;n0>=t0.count?r0.complete():(r0.next(e0),r0.closed||(t0.index=n0+1,t0.start=e0+1,this.schedule(t0)))}function Bc(t0,e0,n0){t0===void 0&&(t0=0);var r0=-1;return ki(e0)?r0=1>Number(e0)?1:Number(e0):Zc(e0)&&(n0=e0),Zc(n0)||(n0=bd),new Y(function(i0){var o0=ki(t0)?t0:+t0-n0.now();return n0.schedule(it,o0,{index:0,period:r0,subscriber:i0})})}function it(t0){var e0=t0.index,n0=t0.period,r0=t0.subscriber;if(r0.next(e0),!r0.closed){if(n0===-1)return r0.complete();t0.index=e0+1,this.schedule(t0,n0)}}function mi(){for(var t0=[],e0=0;e0<arguments.length;e0++)t0[e0]=arguments[e0];return typeof(e0=t0[t0.length-1])=="function"&&t0.pop(),nf(t0,void 0).lift(new jt(e0))}function Ga(t0){return function(e0){var n0=new kt(t0);return e0=e0.lift(n0),n0.caught=e0}}function ni(t0,e0){return cb(t0,e0,1)}function nm(t0){return t0===void 0&&(t0=null),function(e0){return e0.lift(new lt(t0))}}function cd(t0,e0){e0===void 0&&(e0=bd);var n0=t0 instanceof Date&&!isNaN(+t0)?+t0-e0.now():Math.abs(t0);return function(r0){return r0.lift(new mt(n0,e0))}}function om(t0,e0){return function(n0){return n0.lift(new nt(t0,e0))}}function Dd(t0){return t0===void 0&&(t0=ot),function(e0){return e0.lift(new pt(t0))}}function ot(){return new vg}function Ka(t0){return function(e0){return t0===0?mf():e0.lift(new qt(t0))}}function pm(t0,e0){return e0?function(n0){return n0.pipe(pm(function(r0,i0){return Kb(t0(r0,i0)).pipe(ba(function(o0,s0){return e0(r0,o0,i0,s0)}))}))}:function(n0){return n0.lift(new rt(t0))}}function wg(t0){return function(e0){return e0.lift(new st(t0))}}function aa(t0,e0){var n0=2<=arguments.length;return function(r0){return r0.pipe(t0?wb(function(i0,o0){return t0(i0,o0,r0)}):Yc,Ka(1),n0?nm(e0):Dd(function(){return new vg}))}}function tt(){return function(t0){return t0.lift(new ut)}}function qm(t0){return function(e0){return t0===0?mf():e0.lift(new vt(t0))}}function qf(t0){return function(e0){return e0.lift(new wt(t0))}}function xg(t0,e0){var n0=!1;return 2<=arguments.length&&(n0=!0),function(r0){return r0.lift(new xt(t0,e0,n0))}}function rm(t0,e0){return 2<=arguments.length?function(n0){return gi(xg(t0,e0),qm(1),nm(e0))(n0)}:function(n0){return gi(xg(function(r0,i0,o0){return t0(r0,i0,o0+1)}),qm(1))(n0)}}function yt(t0,e0){return function(n0){var r0=typeof t0=="function"?t0:function(){return t0};if(typeof e0=="function")return n0.lift(new zt(r0,e0));var i0=Object.create(n0,At);return i0.source=n0,i0.subjectFactory=r0,i0}}function oe(t0){return function(e0){return e0.lift(new Bt(t0,e0))}}function Ct(){return new Pa}function pe(){return function(t0){return $l()(yt(Ct)(t0))}}function sm(t0,e0,n0){var r0=t0&&X(t0)==="object"?t0:{bufferSize:t0,windowTime:e0,refCount:!1,scheduler:n0};return function(i0){return i0.lift(Dt(r0))}}function Dt(t0){var e0,n0,r0=t0.bufferSize,i0=r0===void 0?Number.POSITIVE_INFINITY:r0,o0=(r0=t0.windowTime)===void 0?Number.POSITIVE_INFINITY:r0,s0=t0.refCount,a0=t0.scheduler,c0=0,u0=!1,l0=!1;return function(d0){if(c0++,!e0||u0){u0=!1;var h0=(e0=new qe(i0,o0,a0)).subscribe(this);n0=d0.subscribe({next:function(p0){e0.next(p0)},error:function(p0){u0=!0,e0.error(p0)},complete:function(){l0=!0,n0=void 0,e0.complete()}}),l0&&(n0=void 0)}else h0=e0.subscribe(this);this.add(function(){c0--,h0.unsubscribe(),h0=void 0,n0&&!l0&&s0&&c0===0&&(n0.unsubscribe(),e0=n0=void 0)})}}function Cc(t0,e0){return typeof e0=="function"?function(n0){return n0.pipe(Cc(function(r0,i0){return Kb(t0(r0,i0)).pipe(ba(function(o0,s0){return e0(r0,o0,i0,s0)}))}))}:function(n0){return n0.lift(new Et(t0))}}function ob(t0){return function(e0){return e0.lift(new Ft(t0))}}function Gt(t0,e0){return e0===void 0&&(e0=!1),function(n0){return n0.lift(new Ht(t0,e0))}}function ca(t0,e0,n0){return function(r0){return r0.lift(new It(t0,e0,n0))}}function Jt(t0,e0,n0){return e0===void 0&&(e0=bd),n0===void 0&&(n0=Kt),function(r0){return r0.lift(new Lt(t0,e0,n0.leading,n0.trailing))}}function Mt(t0){t0.subscriber.clearThrottle()}function Nt(t0,e0,n0){return n0===void 0&&(n0=bd),function(r0){var i0=t0 instanceof Date&&!isNaN(+t0),o0=i0?+t0-n0.now():Math.abs(t0);return r0.lift(new Ot(o0,i0,e0,n0))}}function hb(t0,e0){return e0===void 0&&(e0=bd),Nt(t0,Z(new pb),e0)}function Pt(){for(var t0=[],e0=0;e0<arguments.length;e0++)t0[e0]=arguments[e0];return function(n0){var r0;return typeof t0[t0.length-1]=="function"&&(r0=t0.pop()),n0.lift(new Qt(t0,r0))}}function tm(t0,e0,n0,r0,i0){t0!==e0&&um(e0,function(o0,s0){if(i0||(i0=new ge),lb(o0)){o0=i0;var a0=oi(t0,s0),c0=oi(e0,s0),u0=o0.get(c0);if(u0)pi(t0,s0,u0);else{var l0=(u0=r0?r0(a0,c0,s0+"",t0,e0,o0):void 0)===void 0;if(l0){var d0=Va(c0),h0=!d0&&jf(c0),p0=!d0&&!h0&&bi(c0);u0=c0,d0||h0||p0?Va(a0)?u0=a0:gc(a0)&&Ed(a0)?u0=Xh(a0):h0?(l0=!1,u0=Jl(c0,!0)):p0?(l0=!1,u0=vm(c0,!0)):u0=[]:wm(c0)||rf(c0)?(u0=a0,rf(a0)?u0=re(a0,kf(a0)):lb(a0)&&!qi(a0)||(u0=Kl(c0))):l0=!1}l0&&(o0.set(c0,u0),tm(u0,c0,n0,r0,o0),o0.delete(c0)),pi(t0,s0,u0)}}else(a0=r0?r0(oi(t0,s0),o0,s0+"",t0,e0,i0):void 0)===void 0&&(a0=o0),pi(t0,s0,a0)},kf)}function Rt(t0){var e0=1,n0=ri;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?e0=1>=arguments.length?void 0:arguments[1]:n0=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(e0=1>=arguments.length?void 0:arguments[1],n0=2>=arguments.length?void 0:arguments[2]);var r0=e0||1;return function(i0){return i0.pipe(xg(function(o0,s0){var a0=n0.now(),c0=a0-t0;if((o0=o0.filter(function(d0){return d0.until>c0})).length>=r0){var u0=o0[o0.length-1],l0=o0[0].until+t0*Math.floor(o0.length/r0);o0.push({delay:u0.until<a0?l0-a0:l0-u0.until,until:l0,value:s0})}else o0.push({delay:0,until:a0,value:s0});return o0},[]),ba(function(o0){return o0[o0.length-1]}),ni(function(o0){var s0=bb(o0.value);return o0.delay?s0.pipe(cd(o0.delay,n0)):s0}))}}function St(t0,e0){var n0=(e0=e0===void 0?{protocols:xm,makeWebSocket:ym}:e0).protocols,r0=n0===void 0?xm:n0,i0=(e0=e0.makeWebSocket)===void 0?ym:e0;return new Y(function(o0){var s0,a0=new Pa,c0=i0(t0,r0),u0=!1,l0=!1,d0=function(h0){if(s0)throw u0=!0,h0=Error("Web socket message factory function called more than once"),o0.error(h0),h0;return s0=h0.subscribe(function(p0){c0.send(p0)}),a0};return c0.onopen=function(){l0?(u0=!0,c0.close()):o0.next(d0)},c0.onmessage=function(h0){a0.next(h0.data)},c0.onerror=function(h0){u0=!0,o0.error(Error(h0.message))},c0.onclose=function(h0){u0||(u0=!0,l0?(o0.complete(),a0.complete()):o0.error(Error(h0.code===1e3?"Normal closure":h0.reason)))},function(){l0=!0,s0&&s0.unsubscribe(),u0||(u0=!0,c0.close())}})}function yg(){this._listeners={}}function zm(t0){return typeof Float32Array<"u"?function(){function e0(c0,u0,l0){o0[0]=c0,u0[l0]=s0[0],u0[l0+1]=s0[1],u0[l0+2]=s0[2],u0[l0+3]=s0[3]}function n0(c0,u0,l0){o0[0]=c0,u0[l0]=s0[3],u0[l0+1]=s0[2],u0[l0+2]=s0[1],u0[l0+3]=s0[0]}function r0(c0,u0){return s0[0]=c0[u0],s0[1]=c0[u0+1],s0[2]=c0[u0+2],s0[3]=c0[u0+3],o0[0]}function i0(c0,u0){return s0[3]=c0[u0],s0[2]=c0[u0+1],s0[1]=c0[u0+2],s0[0]=c0[u0+3],o0[0]}var o0=new Float32Array([-0]),s0=new Uint8Array(o0.buffer),a0=s0[3]===128;t0.writeFloatLE=a0?e0:n0,t0.writeFloatBE=a0?n0:e0,t0.readFloatLE=a0?r0:i0,t0.readFloatBE=a0?i0:r0}():function(){function e0(r0,i0,o0,s0){var a0=0>i0?1:0;if(a0&&(i0=-i0),i0===0)r0(0<1/i0?0:2147483648,o0,s0);else if(isNaN(i0))r0(2143289344,o0,s0);else if(34028234663852886e22<i0)r0((a0<<31|2139095040)>>>0,o0,s0);else if(11754943508222875e-54>i0)r0((a0<<31|Math.round(i0/1401298464324817e-60))>>>0,o0,s0);else{var c0=Math.floor(Math.log(i0)/Math.LN2);r0((a0<<31|c0+127<<23|8388607&Math.round(i0*Math.pow(2,-c0)*8388608))>>>0,o0,s0)}}function n0(r0,i0,o0){return o0=r0(i0,o0),r0=2*(o0>>31)+1,i0=o0>>>23&255,o0&=8388607,i0===255?o0?NaN:1/0*r0:i0===0?1401298464324817e-60*r0*o0:r0*Math.pow(2,i0-150)*(o0+8388608)}t0.writeFloatLE=e0.bind(null,Am),t0.writeFloatBE=e0.bind(null,Bm),t0.readFloatLE=n0.bind(null,Cm),t0.readFloatBE=n0.bind(null,Dm)}(),typeof Float64Array<"u"?function(){function e0(c0,u0,l0){o0[0]=c0,u0[l0]=s0[0],u0[l0+1]=s0[1],u0[l0+2]=s0[2],u0[l0+3]=s0[3],u0[l0+4]=s0[4],u0[l0+5]=s0[5],u0[l0+6]=s0[6],u0[l0+7]=s0[7]}function n0(c0,u0,l0){o0[0]=c0,u0[l0]=s0[7],u0[l0+1]=s0[6],u0[l0+2]=s0[5],u0[l0+3]=s0[4],u0[l0+4]=s0[3],u0[l0+5]=s0[2],u0[l0+6]=s0[1],u0[l0+7]=s0[0]}function r0(c0,u0){return s0[0]=c0[u0],s0[1]=c0[u0+1],s0[2]=c0[u0+2],s0[3]=c0[u0+3],s0[4]=c0[u0+4],s0[5]=c0[u0+5],s0[6]=c0[u0+6],s0[7]=c0[u0+7],o0[0]}function i0(c0,u0){return s0[7]=c0[u0],s0[6]=c0[u0+1],s0[5]=c0[u0+2],s0[4]=c0[u0+3],s0[3]=c0[u0+4],s0[2]=c0[u0+5],s0[1]=c0[u0+6],s0[0]=c0[u0+7],o0[0]}var o0=new Float64Array([-0]),s0=new Uint8Array(o0.buffer),a0=s0[7]===128;t0.writeDoubleLE=a0?e0:n0,t0.writeDoubleBE=a0?n0:e0,t0.readDoubleLE=a0?r0:i0,t0.readDoubleBE=a0?i0:r0}():function(){function e0(r0,i0,o0,s0,a0,c0){var u0=0>s0?1:0;if(u0&&(s0=-s0),s0===0)r0(0,a0,c0+i0),r0(0<1/s0?0:2147483648,a0,c0+o0);else if(isNaN(s0))r0(0,a0,c0+i0),r0(2146959360,a0,c0+o0);else if(17976931348623157e292<s0)r0(0,a0,c0+i0),r0((u0<<31|2146435072)>>>0,a0,c0+o0);else if(22250738585072014e-324>s0)r0((s0/=5e-324)>>>0,a0,c0+i0),r0((u0<<31|s0/4294967296)>>>0,a0,c0+o0);else{var l0=Math.floor(Math.log(s0)/Math.LN2);l0===1024&&(l0=1023),r0(4503599627370496*(s0*=Math.pow(2,-l0))>>>0,a0,c0+i0),r0((u0<<31|l0+1023<<20|1048576*s0&1048575)>>>0,a0,c0+o0)}}function n0(r0,i0,o0,s0,a0){return i0=r0(s0,a0+i0),s0=r0(s0,a0+o0),r0=2*(s0>>31)+1,i0=4294967296*(1048575&s0)+i0,(o0=s0>>>20&2047)===2047?i0?NaN:1/0*r0:o0===0?5e-324*r0*i0:r0*Math.pow(2,o0-1075)*(i0+4503599627370496)}t0.writeDoubleLE=e0.bind(null,Am,0,4),t0.writeDoubleBE=e0.bind(null,Bm,4,0),t0.readDoubleLE=n0.bind(null,Cm,0,4),t0.readDoubleBE=n0.bind(null,Dm,4,0)}(),t0}function Am(t0,e0,n0){e0[n0]=255&t0,e0[n0+1]=t0>>>8&255,e0[n0+2]=t0>>>16&255,e0[n0+3]=t0>>>24}function Bm(t0,e0,n0){e0[n0]=t0>>>24,e0[n0+1]=t0>>>16&255,e0[n0+2]=t0>>>8&255,e0[n0+3]=255&t0}function Cm(t0,e0){return(t0[e0]|t0[e0+1]<<8|t0[e0+2]<<16|t0[e0+3]<<24)>>>0}function Dm(t0,e0){return(t0[e0]<<24|t0[e0+1]<<16|t0[e0+2]<<8|t0[e0+3])>>>0}function Wa(t0,e0){this.lo=t0>>>0,this.hi=e0>>>0}function sf(t0,e0,n0){this.fn=t0,this.len=e0,this.next=void 0,this.val=n0}function si(){}function Tt(t0){this.head=t0.head,this.tail=t0.tail,this.len=t0.len,this.next=t0.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(t0,e0,n0){e0[n0]=255&t0}function ui(t0,e0){this.len=t0,this.next=void 0,this.val=e0}function vi(t0,e0,n0){for(;t0.hi;)e0[n0++]=127&t0.lo|128,t0.lo=(t0.lo>>>7|t0.hi<<25)>>>0,t0.hi>>>=7;for(;127<t0.lo;)e0[n0++]=127&t0.lo|128,t0.lo>>>=7;e0[n0++]=t0.lo}function wi(t0,e0,n0){e0[n0]=255&t0,e0[n0+1]=t0>>>8&255,e0[n0+2]=t0>>>16&255,e0[n0+3]=t0>>>24}function jc(){xi.call(this)}function Ut(t0,e0,n0){40>t0.length?V.utf8.write(t0,e0,n0):e0.utf8Write?e0.utf8Write(t0,n0):e0.write(t0,n0)}function Yb(t0,e0){return RangeError("index out of range: "+t0.pos+" + "+(e0||1)+" > "+t0.len)}function La(t0){this.buf=t0,this.pos=0,this.len=t0.length}function yi(){var t0=new Em(0,0),e0=0;if(!(4<this.len-this.pos)){for(;3>e0;++e0){if(this.pos>=this.len)throw Yb(this);if(t0.lo=(t0.lo|(127&this.buf[this.pos])<<7*e0)>>>0,128>this.buf[this.pos++])return t0}return t0.lo=(t0.lo|(127&this.buf[this.pos++])<<7*e0)>>>0,t0}for(;4>e0;++e0)if(t0.lo=(t0.lo|(127&this.buf[this.pos])<<7*e0)>>>0,128>this.buf[this.pos++])return t0;if(t0.lo=(t0.lo|(127&this.buf[this.pos])<<28)>>>0,t0.hi=(t0.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return t0;if(e0=0,4<this.len-this.pos){for(;5>e0;++e0)if(t0.hi=(t0.hi|(127&this.buf[this.pos])<<7*e0+3)>>>0,128>this.buf[this.pos++])return t0}else for(;5>e0;++e0){if(this.pos>=this.len)throw Yb(this);if(t0.hi=(t0.hi|(127&this.buf[this.pos])<<7*e0+3)>>>0,128>this.buf[this.pos++])return t0}throw Error("invalid varint encoding")}function zg(t0,e0){return(t0[e0-4]|t0[e0-3]<<8|t0[e0-2]<<16|t0[e0-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(t0){zi.call(this,t0)}function tf(t0,e0,n0){if(typeof t0!="function")throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=t0,this.requestDelimited=!!e0,this.responseDelimited=!!n0}function za(t0){return typeof t0=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(t0)&&t0!=="null"}function Gm(t0){try{var e0=t0.split(".").map(function(r0){return Number(r0)})}catch{return!1}if(e0.length!==4||e0[0]===0)return!1;for(t0=0;t0<e0.length;t0++){var n0=e0[t0];if(!Number.isInteger(n0)||0>n0||255<n0)return!1}return!0}function Hm(t0,e0){if(!Array.isArray(e0)||e0.length===0||32<e0.length||e0.some(function(n0){return n0.length===0||32<n0.length}))throw new I("arguments is not valid",Ja);if(!za(t0))throw new I("ID is invalid",Ja)}function uf(t0){var e0=t0.attributes,n0=t0.attrSizeMap,r0=t0.maxAttrsCount,i0=t0.maxAttrValueSize;if(t0=t0.maxTotalSize,!yd(e0))throw new I("attributes must be an object",Ja);if(Object.keys(e0).length>r0)throw new ib("Exceed the limit of ".concat(r0," attributes"),se);if(Object.keys(e0).length===0)throw new I("The attributes is an empty object",Ja);var o0=0,s0=0;for(e0=Object.entries(e0);s0<e0.length;s0++){var a0=ra(e0[s0],2),c0=a0[1];a0=new Blob([a0[0]]).size;var u0=new Blob([c0]).size;if(a0===0||32<a0)throw new I("Invalid attribute key",Ja);if(u0>i0)throw new ib("Invalid attribute value, over the limit of ".concat(i0," bytes"),se);if(typeof c0!="string"||c0.length===0)throw new I("Invalid attribute value",Ja);o0+=a0,o0+=u0}if(o0>t0)throw new ib("The attributes size overflow",se);if(n0!==void 0){if(Object.keys(n0).length>r0)throw new ib("Exceed the limit of ".concat(r0," attributes"),se);for(o0=r0=0,n0=Object.entries(n0);o0<n0.length;o0++){if(s0=(e0=ra(n0[o0],2))[1],(e0=new Blob([e0[0]]).size)===0)throw new I("Invalid attribute key",Ja);if(s0>i0)throw new ib("Invalid attribute value, over the limit of ".concat(i0," bytes"),se);r0+=e0,r0+=s0}if(r0>t0)throw new ib("The attributes size overflow",se)}}function Ag(t0,e0){return Math.floor(Math.random()*(Math.floor(e0)-Math.ceil(t0)+1))+t0}function Bg(){var t0=Ag(0,4294967295),e0=Ag(1,4294967295);return new U(t0,e0,!0)}function Xa(t0){return t0.toString().padEnd(32,"0")}function Im(t0,e0){return new TypeError("Unexpected ".concat(t0,": ").concat(e0))}function Jm(t0,e0){return t0=t0.split(".").map(function(n0){return Number(n0)}),e0=e0.split(".").map(function(n0){return Number(n0)}),Math.sqrt(1e3*Math.pow(t0[0]-e0[0],2)+100*Math.pow(t0[1]-e0[1],2)+10*Math.pow(t0[2]-e0[2],2)+1*Math.pow(t0[3]-e0[3],2))}function Km(t0){return t0.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?t0.toNumber():t0.toString()}function Ai(t0,e0){e0="".concat(t0).concat(e0||"");var n0=Lm.get(e0)||1;return Lm.set(e0,n0+1),"".concat(t0).concat(n0)}function Mm(t0,e0){var n0=typeof e0=="number"?e0:e0!==void 0&&typeof e0!="string"?e0.code:void 0;return e0=typeof e0!="number"&&typeof e0!="string"&&e0!==void 0&&e0.serverCode!==void 0?e0.serverCode:void 0,n0="".concat(n0!==void 0?" Error Code ".concat(n0):"").concat(e0!==void 0?", server Code ".concat(e0):""),t0=typeof t0=="string"&&t0?Cg(t0):Array.isArray(t0)&&typeof t0[0]=="string"&&t0[0]?Cg(Nm.apply(void 0,[t0[0]].concat(G(t0.slice(1))))):"","".concat(n0===""?"":"".concat(n0," - ")).concat(t0)}function Om(t0){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark(function t0(e0){return w.wrap(function(n0){for(;;)switch(n0.prev=n0.next){case 0:return n0.abrupt("return",new Promise(function(r0){setTimeout(function(){r0()},e0)}));case 1:case"end":return n0.stop()}},t0)}))).apply(this,arguments)}function Pm(t0){return t0 instanceof Blob||Object.prototype.toString.call(t0)==="[object Blob]"}function Dg(t0){var e0=255&t0,n0=t0>>8&255,r0=t0>>16&255;return"".concat(t0>>24&255,".").concat(r0,".").concat(n0,".").concat(e0)}function te(t0,e0,n0){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark(function t0(e0,n0,r0){var i0,o0,s0,a0,c0,u0,l0,d0,h0,p0,m0,f0,g0,E0,_0,y0,b0,S0,w0,I0,L0,M0,C0,U0,x0,j0;return w.wrap(function(k0){for(;;)switch(k0.prev=k0.next){case 0:if(i0=n0.body,o0=n0.headers,s0=o0===void 0?{}:o0,a0=n0.timeout,c0=a0===void 0?1e4:a0,u0=n0.signal,l0=n0.withCredentials,d0=l0!==void 0&&l0,h0=(r0||{}).useBinaryResponse,p0=h0!==void 0&&h0,(m0=new XMLHttpRequest).open("POST",e0,!0),m0.responseType=p0?"arraybuffer":"text",m0.withCredentials=d0,m0.timeout=c0,f0=i0 instanceof FormData,g0=i0 instanceof Uint8Array,!(1<(E0=Object.keys(s0).filter(function(D0){return D0.toLowerCase()==="content-type"})).length)){k0.next=14;break}throw new RangeError("multiple content-type");case 14:E0.length===0&&(g0?s0["Content-Type"]="application/octet-stream":f0||(s0["Content-Type"]="application/json"));case 15:if("setRequestHeader"in m0){k0.next=46;break}return m0.abort(),k0.next=19,fetch(e0,{body:f0||g0?i0:JSON.stringify(i0),cache:"no-cache",credentials:d0?"include":"same-origin",headers:s0,method:"POST",mode:"cors",referrer:"no-referrer",signal:u0});case 19:if(_0=k0.sent,!(200<=(y0=_0.status)&&300>y0||y0===304)){k0.next=31;break}if(!p0){k0.next=27;break}return k0.next=25,_0.arrayBuffer();case 25:return b0=k0.sent,k0.abrupt("return",{status:y0,responseData:b0});case 27:return k0.next=29,_0.text();case 29:return S0=k0.sent,k0.abrupt("return",{status:y0,responseText:S0});case 31:return w0=new da(["Post XHR failure, status %d",y0]),k0.prev=32,k0.next=35,_0.text();case 35:throw I0=k0.sent,w0.statusCode=y0,w0.message=I0||"Request failed, status ".concat(y0),w0;case 41:throw k0.prev=41,k0.t0=k0.catch(32),w0.statusCode=y0,w0.message="Request failed, status ".concat(y0),w0;case 46:if(Object.keys(s0).length!==0)for(L0=0,M0=Object.entries(s0);L0<M0.length;L0++)C0=ra(M0[L0],2),U0=C0[0],x0=C0[1],m0.setRequestHeader(U0,x0);return u0!==void 0&&(j0=function D0(){m0.abort(),u0.removeEventListener("abort",D0)},u0.addEventListener("abort",j0)),f0||g0?m0.send(i0):m0.send(JSON.stringify(i0)),k0.abrupt("return",new Promise(function(D0,$0){m0.onload=function(){var N0=m0.status;if(200<=N0&&300>N0||N0===304)D0(p0?{status:N0,responseData:m0.response}:{status:N0,responseText:m0.responseText});else{var A0=new da(["Post XHR failure, status %d",N0]);A0.statusCode=N0,A0.message=m0.response||"Request failed, status ".concat(m0.status),$0(A0)}},m0.ontimeout=function(N0){$0(new db(["XHR request timed out after %d ms",c0],{originalError:N0}))},m0.onerror=function(){var N0=new da(["Post XHR failure, status %d",m0.status]);N0.statusCode=m0.status,N0.message=m0.response||"Request failed, status ".concat(m0.status),$0(N0)},m0.onabort=function(){try{$0(new DOMException("The request aborted.","AbortError"))}catch{var N0=Error("The request aborted.");N0.name="AbortError",$0(N0)}}}));case 50:case"end":return k0.stop()}},t0,null,[[32,41]])}))).apply(this,arguments)}function Rm(t0){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark(function t0(e0){var n0;return w.wrap(function(r0){for(;;)switch(r0.prev=r0.next){case 0:return(n0=new Image).src=e0,r0.abrupt("return",new Promise(function(i0,o0){n0.onload=function(){i0({width:n0.width,height:n0.height})},n0.onerror=o0}));case 3:case"end":return r0.stop()}},t0)}))).apply(this,arguments)}function Xt(t0,e0){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark(function t0(e0,n0){var r0,i0,o0,s0,a0,c0,u0,l0,d0,h0;return w.wrap(function(p0){for(;;)switch(p0.prev=p0.next){case 0:if(r0=e0.thumbnailHeight,i0=r0===void 0?0:r0,o0=e0.thumbnailWidth,s0=o0===void 0?0:o0,a0=e0.width,c0=a0===void 0?0:a0,u0=e0.height,l0=u0===void 0?0:u0,d0=e0.thumbnail,h0=[],typeof i0=="number"&&typeof s0=="number"&&typeof c0=="number"&&typeof l0=="number"){p0.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=c0&&0>=l0&&h0.push(Rm(Sm(n0)).then(function(m0){c0=m0.width,l0=m0.height})),0>=s0&&0>=i0&&d0!==void 0&&h0.push(Ji(d0).then(function(){var m0=J(w.mark(function f0(g0){var E0;return w.wrap(function(_0){for(;;)switch(_0.prev=_0.next){case 0:return _0.next=2,Rm(Sm(g0));case 2:E0=_0.sent,s0=E0.width,i0=E0.height;case 5:case"end":return _0.stop()}},f0)}));return function(f0){return m0.apply(this,arguments)}}())),p0.next=9,Promise.all(h0).catch(function(){});case 9:return p0.abrupt("return",{width:c0,height:l0,thumbnailWidth:s0,thumbnailHeight:i0});case 10:case"end":return p0.stop()}},t0)}))).apply(this,arguments)}function Tm(t0,e0){if(!yd(t0))throw new I("message object is not a plain object",e0);if(t0.messageType===void 0)if(t0.rawMessage instanceof Uint8Array){if(t0.messageType="RAW",t0.text!==void 0)throw new I("Raw messages cannot have text property. Use description instead",e0)}else{if(typeof t0.text!="string")throw new I("messageType is undefined",e0);if(t0.messageType="TEXT",t0.rawMessage!==void 0)throw new I("Text messages cannot have rawMessage property",e0)}}function Gg(t0){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark(function t0(e0){var n0,r0,i0,o0,s0,a0,c0,u0,l0,d0,h0,p0,m0,f0,g0,E0,_0,y0,b0,S0,w0;return w.wrap(function(I0){for(;;)switch(I0.prev=I0.next){case 0:if(n0=e0.message,r0=e0.peerId,i0=e0.toPeer,o0=e0.session,s0=e0.errorCodes,a0=e0.diff,c0=e0.logger,u0=e0.options,o0!==void 0){I0.next=3;break}throw new K("The client is not logged in. Cannot do the operation",s0.NOT_LOGGED_IN);case 3:if(l0=!1,n0.messageType!=="TEXT"||!n0.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!i0){I0.next=11;break}if(d0=n0.text.split("_"),h0=ra(d0,3),p0=h0[0],m0=h0[1],h0[2]!==void 0&&za(m0)&&p0==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){I0.next=10;break}throw new I("Message is not valid",ve);case 10:l0=!0;case 11:if(f0=Date.now(),g0=o0.messageSentTimes.length-1,!((E0=o0.messageSentTimes[g0])&&E0+3e3<f0)){I0.next=18;break}o0.messageSentTimes=[f0],I0.next=29;break;case 18:_0=g0;case 19:if(!(0<=_0)){I0.next=28;break}if(!(o0.messageSentTimes[_0]+3e3<f0)){I0.next=23;break}return o0.messageSentTimes=o0.messageSentTimes.slice(_0+1,g0+1),I0.abrupt("break",28);case 23:if(!(180<=g0-_0+1)){I0.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",s0.TOO_OFTEN);case 25:_0--,I0.next=19;break;case 28:o0.messageSentTimes.push(f0);case 29:I0.t0=n0.messageType,I0.next=I0.t0==="TEXT"?32:I0.t0==="RAW"?37:I0.t0==="FILE"||I0.t0==="IMAGE"?39:40;break;case 32:if(!l0){I0.next=36;break}return y0=n0.text.split("_"),b0=ra(y0,3),S0=b0[1],w0=b0[2],c0.info("[rtm-API] EndCall message send api is called"),I0.abrupt("return",o0.sendInvitationMessage({peerId:r0,type:"CallCancel",extra:w0,channelId:S0,callId:"0"}));case 36:return I0.abrupt("return",o0.sendTextMessage(n0.text,r0,i0,u0,1e4-a0));case 37:return n0.description===void 0&&(n0.description=""),I0.abrupt("return",o0.sendRawMessage(n0.rawMessage,n0.description,r0,i0,u0,1e4-a0));case 39:return I0.abrupt("return",o0.sendMediaMessage(n0.messageType,n0,r0,i0,u0,1e4-a0));case 40:throw new I("Invalid message type",ve);case 41:case"end":return I0.stop()}},t0)}))).apply(this,arguments)}function Yt(t0){var e0=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],n0=t0.replace(/(https?:\/\/)?(www.)?/i,"");return e0||(n0=n0.split(".").slice(t0.length-2).join(".")),n0.indexOf("/")!==-1?n0.split("/")[0]:n0}function oa(t0){if(typeof t0!="string")return"[Sensitive Info]";var e0=Math.floor(.7*t0.length),n0=t0.length;return Um(t0,e0,n0,"*".repeat(n0-e0))}function Vm(t0,e0,n0){function r0(i0){if(t0===void 0)return t0;if(Il(i0))return i0;if(Array.isArray(i0))return i0.map(r0);var o0={},s0=0;for(i0=Hg(i0);s0<i0.length;s0++){var a0=ra(i0[s0],2),c0=a0[0];if(typeof(a0=a0[1])=="string"&&n0.includes(c0)){o0[c0]=typeof a0=="string"?oa(a0):"[Sensitive Info]";break}e0.includes(c0)?o0[c0]="[Hidden Info]":o0[c0]=a0==null?a0:n0.includes(c0)?"[Sensitive Info]":r0(a0)}return o0}return Array.isArray(t0)?t0.map(r0):r0(t0)}function Wm(t0){return Object.getOwnPropertyNames(t0).forEach(function(e0){X(e0=t0[e0])=="object"&&e0!==null&&Wm(e0)}),Object.freeze(t0)}function pa(t0){return new TextDecoder("utf-8").decode(t0.buffer.slice(t0.byteOffset,t0.byteOffset+t0.byteLength))}function Ig(t0){return new TextEncoder().encode(t0).length}function Xm(){for(var t0=0,e0=arguments.length,n0=Array(e0),r0=0;r0<e0;r0++)n0[r0]=arguments[r0];for(e0=0;e0<n0.length;e0++)t0+=n0[e0].length;for(t0=new Uint8Array(t0),r0=e0=0;r0<n0.length;r0++){var i0=n0[r0];t0.set(i0,e0),e0+=i0.length}return t0}function we(t0,e0,n0){var r0=t0.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(t0=r0==null?void 0:r0[1],r0=r0==null?void 0:r0[2]){var i0;for(r0=r0.substr(1).split("&"),i0=0;i0<r0.length;i0++)if(r0[i0].split("=")[0]==e0){r0[i0]=e0+"="+encodeURIComponent(n0);break}return i0==r0.length&&r0.push(e0+"="+encodeURIComponent(n0)),t0+"?"+r0.join("&")}return t0+"?"+e0+"="+encodeURIComponent(n0)}function Ji(t0){return new Promise(function(e0,n0){var r0=new FileReader;r0.onloadend=function(){var i0=r0.result||new ArrayBuffer(0);e0(i0)},r0.onerror=n0,r0.readAsArrayBuffer(t0)})}function Zt(t0,e0){t0=t0=[t0],typeof(e0=e0||{})=="string"&&(e0={type:e0});try{var n0=new Blob(t0,e0)}catch(i0){if(i0.name!=="TypeError")throw i0;n0=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder);for(var r0=0;r0<t0.length;r0+=1)n0.append(t0[r0]);n0=n0.getBlob(e0.type)}return n0}function Um(t0,e0,n0,r0){return typeof t0!="string"?"[Sensitive Info]":t0.substring(0,e0)+r0+t0.substring(n0)}function Ym(t0){var e0=[];return function n0(r0){if(r0===null||X(r0)!=="object")return r0;if(e0.indexOf(r0)!==-1)return"[Circular]";if(e0.push(r0),typeof r0.toJSON=="function")try{var i0=n0(r0.toJSON());return e0.pop(),i0}catch(o0){return"[Throws: "+(o0?o0.message:"?")+"]"}return Array.isArray(r0)?(i0=r0.map(n0),e0.pop(),i0):(i0=Object.keys(r0).reduce(function(o0,s0){t:{if($t.call(r0,s0))try{var a0=r0[s0];break t}catch(c0){a0="[Throws: "+(c0?c0.message:"?")+"]";break t}a0=r0[s0]}return o0[s0]=n0(a0),o0},{}),e0.pop(),i0)}(t0)}function au(t0){if(!(100<(t0=String(t0)).length)&&(t0=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t0))){var e0=parseFloat(t0[1]);switch((t0[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*e0;case"weeks":case"week":case"w":return 6048e5*e0;case"days":case"day":case"d":return 864e5*e0;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e0;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e0;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e0;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e0}}}function Jg(t0,e0,n0,r0){return Math.round(t0/n0)+" "+r0+(e0>=1.5*n0?"s":"")}function bu(t0){var e0=t0.areas,n0=t0.excludedArea;if(e0.length===1&&e0[0]===F.GLOBAL&&n0===F.CHINA)return xe([F.OVERSEA]);if(e0.includes(F.GLOBAL)){if(t0=xf(Kg).filter(function(o0){return o0!==F.GLOBAL&&o0!==F.OVERSEA}),n0 in yf){e0=yf[n0];var r0=[].concat(G(e0??[]),[n0]);return xe(t0.filter(function(o0){return!r0.includes(o0)}))}if(Zm(n0)){var i0=cu(n0);return xe(t0.filter(function(o0){return o0!==n0&&o0!==i0}))}}if(Zm(n0)||n0 in yf)return xe(e0);throw new I("Invalid excludedArea area config")}function Ma(t0,e0,n0){n0===void 0&&(n0=Object.getOwnPropertyDescriptor(t0,e0));var r0=n0.value;return n0.value=function(){for(var i0=this,o0=arguments.length,s0=Array(o0),a0=0;a0<o0;a0++)s0[a0]=arguments[a0];this.invokeTracker.apply(this,["%s: ".concat(0<s0.length?"%s with args: ".concat(s0.map(function(){return"%o"})):"%s"),this.name,e0].concat(G(s0.map(ye))));try{var c0=r0.apply(this,s0)}catch(l0){throw this.logError.apply(this,["".concat(l0.code!==void 0?"Error Code ".concat(l0.code,": "):"","%s failed").concat(0<s0.length?" with args: ".concat(s0.map(function(){return"%o"})):""),e0].concat(G(s0.map(ye)))),l0.originalError&&this.logError(l0.originalError),this.errorTracker(l0),l0}var u0=Date.now();return J(w.mark(function l0(){var d0,h0;return w.wrap(function(p0){for(;;)switch(p0.prev=p0.next){case 0:return p0.prev=0,p0.next=3,c0;case 3:d0=p0.sent,p0.next=12;break;case 6:return p0.prev=6,p0.t0=p0.catch(0),i0.logError.apply(i0,["".concat(p0.t0.code!==void 0?"Error Code ".concat(p0.t0.code,": "):"","%s failed").concat(0<s0.length?" with args: ".concat(s0.map(function(){return"%o"})):""),e0].concat(G(s0.map(ye)))),p0.t0.originalError&&i0.logError(p0.t0.originalError),i0.errorTracker(p0.t0),p0.abrupt("return");case 12:d0!==c0?d0===void 0?i0.resultTracker("%s promise resolves after %dms",e0,Date.now()-u0):i0.resultTracker("%s promise resolves after %dms, result is %o",e0,Date.now()-u0,ye(d0)):Ac(d0)!=="Object"||yd(d0)?i0.resultTracker("%s result is %o",e0,ye(d0)):i0.resultTracker("%s result is %s",e0,d0.name||((h0=d0.constructor)===null||h0===void 0?void 0:h0.name));case 13:case"end":return p0.stop()}},l0,null,[[0,6]])}))(),c0},n0}function Nb(t0,e0,n0){n0===void 0&&(n0=Object.getOwnPropertyDescriptor(t0,e0));var r0=n0.value;return n0.value=function(){for(var i0=this,o0=arguments.length,s0=Array(o0),a0=0;a0<o0;a0++)s0[a0]=arguments[a0];this.invokeTracker.apply(this,["%s: ".concat(0<s0.length?"%s with args: ".concat(s0.map(function(){return"%o"})):"%s"),this.name,e0].concat(s0));try{var c0=r0.apply(this,s0)}catch(l0){throw this.logError.apply(this,["".concat(l0.code!==void 0?"Error Code ".concat(l0.code,": "):"","%s failed").concat(0<s0.length?" with args: ".concat(s0.map(function(){return"%o"})):""),e0].concat(s0)),l0.originalError&&this.logError(l0.originalError),this.errorTracker(l0),l0}var u0=Date.now();return J(w.mark(function l0(){var d0,h0;return w.wrap(function(p0){for(;;)switch(p0.prev=p0.next){case 0:return p0.prev=0,p0.next=3,c0;case 3:d0=p0.sent,p0.next=12;break;case 6:return p0.prev=6,p0.t0=p0.catch(0),i0.logError.apply(i0,["".concat(p0.t0.code!==void 0?"Error Code ".concat(p0.t0.code,": "):"","%s failed").concat(0<s0.length?" with args: ".concat(s0.map(function(){return"%o"})):""),e0].concat(s0)),p0.t0.originalError&&i0.logError(p0.t0.originalError),i0.errorTracker(p0.t0),p0.abrupt("return");case 12:d0!==c0?d0===void 0?i0.resultTracker("%s promise resolves after %dms",e0,Date.now()-u0):i0.resultTracker("%s promise resolves after %dms, result is %o",e0,Date.now()-u0,d0):Ac(d0)!=="Object"||yd(d0)?i0.resultTracker("%s result is %o",e0,d0):i0.resultTracker("%s result is %s",e0,d0.name||((h0=d0.constructor)===null||h0===void 0?void 0:h0.name));case 13:case"end":return p0.stop()}},l0,null,[[0,6]])}))(),c0},n0}function du(t0,e0){var n0="".concat(t0,"Uri");if(typeof(n0=Li[n0])!="number"||n0===0)throw new TypeError("Got Unknown URI Name");return e0=new(t0=$m[t0])(e0),e0=t0.encode(e0).finish(),new eu({uri:n0,data:e0})}function an(t0,e0){return"".concat(t0.split(".").join("-"),".edge.").concat(e0?"sd-rtn.com":"agora.io")}function eb(t0,e0,n0){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark(function t0(e0,n0,r0){var i0,o0;return w.wrap(function(s0){for(;;)switch(s0.prev=s0.next){case 0:s0.next=2;break;case 2:return i0=fu[e0].encode(n0).finish(),o0=function(){var a0=J(w.mark(function c0(u0){var l0,d0,h0,p0=arguments;return w.wrap(function(m0){for(;;)switch(m0.prev=m0.next){case 0:if(!(3<(d0=1<p0.length&&p0[1]!==void 0?p0[1]:0))){m0.next=3;break}return m0.abrupt("return");case 3:return h0=we(h0=r0?"https://".concat((l0=M==null?void 0:M.PROXY_NGINX[0])!==null&&l0!==void 0?l0:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(u0,"&p=6443&d=events/proto-raw"):"https://".concat(u0,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),h0=we(h0,"id",gu[e0].toString()),m0.next=8,te(h0,{body:i0,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(f0){return o0(u0,d0+1)});case 8:case"end":return m0.stop()}},c0)}));return function(c0){return a0.apply(this,arguments)}}(),s0.prev=4,s0.next=7,o0((M==null?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:s0.next=13;break;case 9:return s0.prev=9,s0.t0=s0.catch(4),s0.next=13,o0(M&&bn(1<(M==null?void 0:M.EVENT_REPORT_DOMAIN.length)?M==null?void 0:M.EVENT_REPORT_DOMAIN.slice(1):M==null?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return s0.stop()}},t0,null,[[4,9]])}))).apply(this,arguments)}function fb(t0){return t0===void 0?U.fromNumber(0):U.fromNumber(Date.now()-t0)}function hu(t0){return btoa(String.fromCharCode.apply({},t0.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map(function(e0){return parseInt(e0,16)}))).replace(/={1,2}$/,"")}function Lg(t0,e0){return U.fromValue(t0).eq(e0)}function Mg(t0,e0){var n0=e0===void 0?t0.val:e0,r0=t0.isBoolean;e0=t0.isNumber;var i0=t0.oneof,o0=t0.len;if([r0,e0,i0].filter(function(s0){return!s0}).length!==2)throw new TypeError("invalid field type");if(n0!==void 0&&(t0=!1,i0!==void 0&&(i0=Ni(i0),iu(i0,Lg).length===i0.length&&ju(i0,function(s0){return Lg(n0,s0)})!==void 0&&(t0=!0)),r0=r0!==void 0&&(n0===0||n0===1)&&o0===1,e0=e0!==void 0&&n0.toString(2).length<=o0,!(t0||r0||e0)))throw Error("invalid field value")}function cn(t0){return function(){var e0=t0();if(!e0)throw new K("Client is not logged in. Cannot do the operation");return e0}}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},Ng=function(t0){return t0&&t0.Math==Math&&t0},y=Ng(typeof globalThis=="object"&&globalThis)||Ng(typeof window=="object"&&window)||Ng(typeof self=="object"&&self)||Ng(typeof Ya=="object"&&Ya)||function(){return this}()||Function("return this")(),R=function(t0){try{return!!t0()}catch{return!0}},ka=!R(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(t0){return!!(t0=en(this,t0))&&t0.enumerable}:dn,dd=function(t0,e0){return{enumerable:!(1&t0),configurable:!(2&t0),writable:!(4&t0),value:e0}},ku={}.toString,Zb=function(t0){return ku.call(t0).slice(8,-1)},lu="".split,Af=R(function(){return!Object("z").propertyIsEnumerable(0)})?function(t0){return Zb(t0)=="String"?lu.call(t0,""):Object(t0)}:Object,jb=function(t0){if(t0==null)throw TypeError("Can't call method on "+t0);return t0},qb=function(t0){return Af(jb(t0))},ha=function(t0){return typeof t0=="object"?t0!==null:typeof t0=="function"},lc=function(t0,e0){if(!ha(t0))return t0;var n0,r0;if(e0&&typeof(n0=t0.toString)=="function"&&!ha(r0=n0.call(t0))||typeof(n0=t0.valueOf)=="function"&&!ha(r0=n0.call(t0))||!e0&&typeof(n0=t0.toString)=="function"&&!ha(r0=n0.call(t0)))return r0;throw TypeError("Can't convert object to primitive value")},Qa=function(t0){return Object(jb(t0))},mu={}.hasOwnProperty,Q=function(t0,e0){return mu.call(Qa(t0),e0)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R(function(){return Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(t0,e0){if(t0=qb(t0),e0=lc(e0,!0),fn)try{return gn(t0,e0)}catch{}if(Q(t0,e0))return dd(!zf.call(t0,e0),t0[e0])}},va=function(t0){if(!ha(t0))throw TypeError(String(t0)+" is not an object");return t0},hn=Object.defineProperty,Ra={f:ka?hn:function(t0,e0,n0){if(va(t0),e0=lc(e0,!0),va(n0),fn)try{return hn(t0,e0,n0)}catch{}if("get"in n0||"set"in n0)throw TypeError("Accessors not supported");return"value"in n0&&(t0[e0]=n0.value),t0}},Na=ka?function(t0,e0,n0){return Ra.f(t0,e0,dd(1,n0))}:function(t0,e0,n0){return t0[e0]=n0,t0},Oi=function(t0,e0){try{Na(y,t0,e0)}catch{y[t0]=e0}return e0},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;typeof ed.inspectSource!="function"&&(ed.inspectSource=function(t0){return nu.call(t0)});var Pi=ed.inspectSource,jn=y.WeakMap,ou=typeof jn=="function"&&/native code/.test(Pi(jn)),fd=$a(function(t0){(t0.exports=function(e0,n0){return ed[e0]||(ed[e0]=n0!==void 0?n0:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:" 2021 Denis Pushkarev (zloirock.ru)"})}),pu=0,qu=Math.random(),Ae=function(t0){return"Symbol("+String(t0===void 0?"":t0)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(t0){return kn[t0]||(kn[t0]=Ae(t0))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(t0,e0){if(ln.call(Gd,t0))throw new TypeError("Object already initialized");return e0.facade=t0,tu.call(Gd,t0,e0),e0},Qg=function(t0){return su.call(Gd,t0)||{}},Ri=function(t0){return ln.call(Gd,t0)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(t0,e0){if(Q(t0,Ce))throw new TypeError("Object already initialized");return e0.facade=t0,Na(t0,Ce,e0),e0},Qg=function(t0){return Q(t0,Ce)?t0[Ce]:{}},Ri=function(t0){return Q(t0,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(t0){return Ri(t0)?Qg(t0):Qi(t0,{})},getterFor:function(t0){return function(e0){var n0;if(!ha(e0)||(n0=Qg(e0)).type!==t0)throw TypeError("Incompatible receiver, "+t0+" required");return n0}}},Ta=$a(function(t0){var e0=Za.get,n0=Za.enforce,r0=String(String).split("String");(t0.exports=function(i0,o0,s0,a0){var c0=!!a0&&!!a0.unsafe,u0=!!a0&&!!a0.enumerable;if(a0=!!a0&&!!a0.noTargetGet,typeof s0=="function"){typeof o0!="string"||Q(s0,"name")||Na(s0,"name",o0);var l0=n0(s0);l0.source||(l0.source=r0.join(typeof o0=="string"?o0:""))}i0===y?u0?i0[o0]=s0:Oi(o0,s0):(c0?!a0&&i0[o0]&&(u0=!0):delete i0[o0],u0?i0[o0]=s0:Na(i0,o0,s0))})(Function.prototype,"toString",function(){return typeof this=="function"&&e0(this).source||Pi(this)})}),mn=function(t0){return typeof t0=="function"?t0:void 0},mc=function(t0,e0){return 2>arguments.length?mn(y[t0])||mn(y[t0]):y[t0]&&y[t0][e0]||y[t0]&&y[t0][e0]},uu=Math.ceil,vu=Math.floor,$b=function(t0){return isNaN(t0=+t0)?0:(0<t0?vu:uu)(t0)},wu=Math.min,ta=function(t0){return 0<t0?wu($b(t0),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(t0,e0){return 0>(t0=$b(t0))?xu(t0+e0,0):yu(t0,e0)},nn=function(t0){return function(e0,n0,r0){e0=qb(e0);var i0=ta(e0.length);if(r0=xb(r0,i0),t0&&n0!=n0){for(;i0>r0;)if((n0=e0[r0++])!=n0)return!0}else for(;i0>r0;r0++)if((t0||r0 in e0)&&e0[r0]===n0)return t0||r0||0;return!t0&&-1}},on=nn(!0),Si=nn(!1),pn=function(t0,e0){t0=qb(t0);var n0,r0=0,i0=[];for(n0 in t0)!Q(Be,n0)&&Q(t0,n0)&&i0.push(n0);for(;e0.length>r0;)Q(t0,n0=e0[r0++])&&(~Si(i0,n0)||i0.push(n0));return i0},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(t0){return pn(t0,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(t0){var e0=Hd.f(va(t0)),n0=Bf.f;return n0?e0.concat(n0(t0)):e0},rn=function(t0,e0){for(var n0=qn(e0),r0=Ra.f,i0=Fb.f,o0=0;o0<n0.length;o0++){var s0=n0[o0];Q(t0,s0)||r0(t0,s0,i0(e0,s0))}},Au=/#|\.prototype\./,nc=function(t0,e0){return(t0=Bu[Cu(t0)])==Du||t0!=Eu&&(typeof e0=="function"?R(e0):!!e0)},Cu=nc.normalize=function(t0){return String(t0).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(t0,e0){var n0,r0,i0,o0=t0.target,s0=t0.global,a0=t0.stat;if(r0=s0?y:a0?y[o0]||Oi(o0,{}):(y[o0]||{}).prototype)for(i0 in e0){var c0=e0[i0],u0=t0.noTargetGet?(n0=Fu(r0,i0))&&n0.value:r0[i0];if(!(n0=nc(s0?i0:o0+(a0?".":"#")+i0,t0.forced))&&u0!==void 0){if(typeof c0==typeof u0)continue;rn(c0,u0)}(t0.sham||u0&&u0.sham)&&Na(c0,"sham",!0);try{Ta(r0,i0,c0,t0)}catch{}}},yb=function(t0){if(typeof t0!="function")throw TypeError(String(t0)+" is not a function");return t0},Id=function(t0,e0,n0){if(yb(t0),e0===void 0)return t0;switch(n0){case 0:return function(){return t0.call(e0)};case 1:return function(r0){return t0.call(e0,r0)};case 2:return function(r0,i0){return t0.call(e0,r0,i0)};case 3:return function(r0,i0,o0){return t0.call(e0,r0,i0,o0)}}return function(){return t0.apply(e0,arguments)}},gd=Array.isArray||function(t0){return Zb(t0)=="Array"},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R(function(){return!String(Symbol())||!Symbol.sham&&id&&41>id}),vn=oc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(t0){return Q(Cf,t0)&&(oc||typeof Cf[t0]=="string")||(oc&&Q(Df,t0)?Cf[t0]=Df[t0]:Cf[t0]=Gu("Symbol."+t0)),Cf[t0]},Hu=qa("species"),Sg=function(t0,e0){if(gd(t0)){var n0=t0.constructor;typeof n0!="function"||n0!==Array&&!gd(n0.prototype)?ha(n0)&&(n0=n0[Hu])===null&&(n0=void 0):n0=void 0}return new(n0===void 0?Array:n0)(e0===0?0:e0)},wn=[].push,jd=function(t0){var e0=t0==1,n0=t0==2,r0=t0==3,i0=t0==4,o0=t0==6,s0=t0==7,a0=t0==5||o0;return function(c0,u0,l0,d0){var h0=Qa(c0),p0=Af(h0);u0=Id(u0,l0,3),l0=ta(p0.length);var m0,f0=0;for(d0=d0||Sg,c0=e0?d0(c0,l0):n0||s0?d0(c0,0):void 0;l0>f0;f0++)if((a0||f0 in p0)&&(m0=u0(d0=p0[f0],f0,h0),t0))if(e0)c0[f0]=m0;else if(m0)switch(t0){case 3:return!0;case 5:return d0;case 6:return f0;case 2:wn.call(c0,d0)}else switch(t0){case 4:return!1;case 7:wn.call(c0,d0)}return o0?-1:r0||i0?i0:c0}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6);jd(7);var Ku=qa("species"),Ef=function(t0){return 51<=id||!R(function(){var e0=[];return(e0.constructor={})[Ku]=function(){return{foo:1}},e0[t0](Boolean).foo!==1})},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(t0){return yn(this,t0,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(t0){return pn(t0,Rg)},Mu=R(function(){Dc(1)});N({target:"Object",stat:!0,forced:Mu},{keys:function(t0){return Dc(Qa(t0))}});var Ee=function(t0,e0){var n0=[][t0];return!!n0&&R(function(){n0.call(null,e0||function(){throw 1},1)})},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(t0){return Nu.call(qb(this),t0===void 0?",":t0)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(t0){return xn(this,t0,1<arguments.length?arguments[1]:void 0)}});var Ui=function(t0){var e0=t0.return;if(e0!==void 0)return va(e0.call(t0)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(t0){return t0!==void 0&&(Fe.Array===t0||Su[Ru]===t0)},Ge=function(t0,e0,n0){(e0=lc(e0))in t0?Ra.f(t0,e0,dd(0,n0)):t0[e0]=n0},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi=String(Bn)==="[object z]",Uu=qa("toStringTag"),Vu=Zb(function(){return arguments}())=="Arguments",Ff=Wi?Zb:function(t0){var e0;if(t0===void 0)var n0="Undefined";else{if(t0===null)var r0="Null";else{t:{var i0=t0=Object(t0);try{r0=i0[Uu];break t}catch{}r0=void 0}r0=typeof(n0=r0)=="string"?n0:Vu?Zb(t0):(e0=Zb(t0))=="Object"&&typeof t0.callee=="function"?"Arguments":e0}n0=r0}return n0},Wu=qa("iterator"),Xi=function(t0){if(t0!=null)return t0[Wu]||t0["@@iterator"]||Fe[Ff(t0)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,function(){throw 2})}catch(t0){}var Tg=function(t0,e0){if(!e0&&!Dn)return!1;var n0=!1;try{(e0={})[Cn]=function(){return{next:function(){return{done:n0=!0}}}},t0(e0)}catch{}return n0},Yu=!Tg(function(t0){Array.from(t0)});N({target:"Array",stat:!0,forced:Yu},{from:function(t0){var e0,n0=Qa(t0),r0=typeof this=="function"?this:Array,i0=arguments.length,o0=1<i0?arguments[1]:void 0,s0=o0!==void 0,a0=Xi(n0),c0=0;if(s0&&(o0=Id(o0,2<i0?arguments[2]:void 0,2)),a0==null||r0==Array&&Vi(a0)){var u0=ta(n0.length);for(r0=new r0(u0);u0>c0;c0++)a0=s0?o0(n0[c0],c0):n0[c0],Ge(r0,c0,a0)}else for(i0=(n0=a0.call(n0)).next,r0=new r0;!(e0=i0.call(n0)).done;c0++){if(s0){a0=n0;var l0=o0;e0=[e0.value,c0];try{u0=l0(va(e0)[0],e0[1])}catch(d0){throw Ui(a0),d0}}else u0=e0.value;Ge(r0,c0,a0=u0)}return r0.length=c0,r0}});var Fn=function(t0){return function(e0,n0){e0=String(jb(e0)),n0=$b(n0);var r0,i0=e0.length;if(0>n0||n0>=i0)return t0?"":void 0;var o0=e0.charCodeAt(n0);return 55296>o0||56319<o0||n0+1===i0||56320>(r0=e0.charCodeAt(n0+1))||57343<r0?t0?e0.charAt(n0):o0:t0?e0.slice(n0,n0+2):r0-56320+(o0-55296<<10)+65536}};Fn(!1);var Gn=Fn(!0),Hn=!R(function(){function t0(){}return t0.prototype.constructor=null,Object.getPrototypeOf(new t0)!==t0.prototype}),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(t0){return t0=Qa(t0),Q(t0,In)?t0[In]:typeof t0.constructor=="function"&&t0 instanceof t0.constructor?t0.constructor.prototype:t0 instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(Kd==null||R(function(){var t0={};return Kd[Yi].call(t0)!==t0}))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(t0,e0){va(t0);for(var n0,r0=Dc(e0),i0=r0.length,o0=0;i0>o0;)Ra.f(t0,n0=r0[o0++],e0[n0]);return t0},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch{}if(aj){var t0=aj;t0.write("<script><\/script>"),t0.close(),t0=t0.parentWindow.Object}else(t0=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(t0),t0.src="javascript:",(t0=t0.contentWindow.document).open(),t0.write("<script>document.F=Object<\/script>"),t0.close(),t0=t0.F;for(Wg=t0,t0=Rg.length;t0--;)delete Wg.prototype[Rg[t0]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(t0,e0){if(t0!==null){$i.prototype=va(t0);var n0=new $i;$i.prototype=null,n0[Mn]=t0}else n0=Wg();return e0===void 0?n0:av(n0,e0)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(t0,e0,n0){t0&&!Q(t0=n0?t0:t0.prototype,Nn)&&bv(t0,Nn,{configurable:!0,value:e0})},cv=function(){return this},dv=function(t0,e0,n0){return e0+=" Iterator",t0.prototype=ac(Ug,{next:dd(1,n0)}),Ec(t0,e0,!1),Fe[e0]=cv,t0},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var t0=!1,e0={};try{var n0=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;n0.call(e0,[]),t0=e0 instanceof Array}catch{}return function(r0,i0){if(va(r0),!ha(i0)&&i0!==null)throw TypeError("Can't set "+String(i0)+" as a prototype");return t0?n0.call(r0,i0):r0.__proto__=i0,r0}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(t0,e0,n0,r0,i0,o0,s0){dv(n0,e0,r0),r0=function(f0){if(f0===i0&&h0)return h0;if(!Vg&&f0 in l0)return l0[f0];switch(f0){case"keys":case"values":case"entries":return function(){return new n0(this,f0)}}return function(){return new n0(this)}};var a0,c0=e0+" Iterator",u0=!1,l0=t0.prototype,d0=l0[Gf]||l0["@@iterator"]||i0&&l0[i0],h0=!Vg&&d0||r0(i0),p0=e0=="Array"&&l0.entries||d0;if(p0&&(t0=Vb(p0.call(new t0)),Ug!==Object.prototype&&t0.next&&(Vb(t0)!==Ug&&(Ua?Ua(t0,Ug):typeof t0[Gf]!="function"&&Na(t0,Gf,ev)),Ec(t0,c0,!0))),i0=="values"&&d0&&d0.name!=="values"&&(u0=!0,h0=function(){return d0.call(this)}),l0[Gf]!==h0&&Na(l0,Gf,h0),Fe[e0]=h0,i0){var m0={values:r0("values"),keys:o0?h0:r0("keys"),entries:r0("entries")};if(s0)for(a0 in m0)!Vg&&!u0&&a0 in l0||Ta(l0,a0,m0[a0]);else N({target:e0,proto:!0,forced:Vg||u0},m0)}return m0},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",function(t0){fv(this,{type:"String Iterator",string:String(t0),index:0})},function(){var t0=gv(this),e0=t0.string,n0=t0.index;return n0>=e0.length?{value:void 0,done:!0}:(e0=Gn(e0,n0),t0.index+=e0.length,{value:e0,done:!1})});var cj=qa("unscopables"),dj=Array.prototype;dj[cj]==null&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(t0){dj[cj][t0]=!0},On=!0;"find"in[]&&Array(1).find(function(){On=!1}),N({target:"Array",proto:!0,forced:On},{find:function(t0){return zn(this,t0,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(t0){var e0=String(jb(this)),n0="";if(0>(t0=$b(t0))||t0==1/0)throw RangeError("Wrong number of repetitions");for(;0<t0;(t0>>>=1)&&(e0+=e0))1&t0&&(n0+=e0);return n0};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(t0){return t0!=t0}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(t0,e0,n0){for(var r0 in e0)Ta(t0,r0,e0[r0],n0);return t0},Qn=qa("species"),If=function(t0){t0=mc(t0);var e0=Ra.f;ka&&t0&&!t0[Qn]&&e0(t0,Qn,{configurable:!0,get:function(){return this}})},Gc=function(t0,e0,n0){if(!(t0 instanceof e0))throw TypeError("Incorrect "+(n0?n0+" ":"")+"invocation");return t0},Jf=function(t0,e0){this.stopped=t0,this.result=e0},Xg=function(t0,e0,n0){var r0,i0=!(!n0||!n0.AS_ENTRIES),o0=!(!n0||!n0.IS_ITERATOR),s0=!(!n0||!n0.INTERRUPTED),a0=Id(e0,n0&&n0.that,1+i0+s0),c0=function(l0){return u0&&Ui(u0),new Jf(!0,l0)};if(e0=function(l0){return i0?(va(l0),s0?a0(l0[0],l0[1],c0):a0(l0[0],l0[1])):s0?a0(l0,c0):a0(l0)},o0)var u0=t0;else{if(typeof(o0=Xi(t0))!="function")throw TypeError("Target is not iterable");if(Vi(o0)){for(o0=0,n0=ta(t0.length);n0>o0;o0++)if((r0=e0(t0[o0]))&&r0 instanceof Jf)return r0;return new Jf(!1)}u0=o0.call(t0)}for(t0=u0.next;!(o0=t0.call(u0)).done;){try{r0=e0(o0.value)}catch(l0){throw Ui(u0),l0}if(typeof r0=="object"&&r0&&r0 instanceof Jf)return r0}return new Jf(!1)},iv=qa("species"),kd=function(t0,e0){var n0;return(t0=va(t0).constructor)===void 0||(n0=va(t0)[iv])==null?e0:yb(n0)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc=Zb(y.process)=="process",Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(t0){if(Kf.hasOwnProperty(t0)){var e0=Kf[t0];delete Kf[t0],e0()}},ij=function(t0){return function(){hj(t0)}},Un=function(t0){hj(t0.data)},Vn=function(t0){y.postMessage(t0+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(t0){for(var e0=[],n0=1;arguments.length>n0;)e0.push(arguments[n0++]);return Kf[++gj]=function(){(typeof t0=="function"?t0:Function(t0)).apply(void 0,e0)},Lf(gj),gj},Sn=function(t0){delete Kf[t0]},Hc)var Lf=function(t0){jv.nextTick(ij(t0))};else if(fj&&fj.now)Lf=function(t0){fj.now(ij(t0))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&typeof postMessage=="function"&&!y.importScripts&&Yg&&Yg.protocol!=="file:"&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(t0){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(t0)}}:function(t0){setTimeout(ij(t0),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var t0;for(Hc&&(t0=$n.domain)&&t0.exit();Md;){var e0=Md.fn;Md=Md.next;try{e0()}catch(n0){throw Md?$g():Mf=void 0,n0}}Mf=void 0,t0&&t0.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(t0){t0={fn:t0,next:void 0},Mf&&(Mf.next=t0),Md||(Md=t0,$g()),Mf=t0},nv=function(t0){var e0,n0;this.promise=new t0(function(r0,i0){if(e0!==void 0||n0!==void 0)throw TypeError("Bad Promise constructor");e0=r0,n0=i0}),this.resolve=yb(e0),this.reject=yb(n0)},lj={f:function(t0){return new nv(t0)}},mj=function(t0,e0){return va(t0),ha(e0)&&e0.constructor===t0?e0:((0,(t0=lj.f(t0)).resolve)(e0),t0.promise)},ov=function(t0,e0){var n0=y.console;n0&&n0.error&&(arguments.length===1?n0.error(t0):n0.error(t0,e0))},nj=function(t0){try{return{error:!1,value:t0()}}catch(e0){return{error:!0,value:e0}}},pv=typeof window=="object",qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io=typeof PromiseRejectionEvent=="function",jo=!1,Nf=nc("Promise",function(){var t0=Pi(zb)!==String(zb);if(!t0&&id===66)return!0;if(51<=id&&/native code/.test(zb))return!1;var e0=new zb(function(r0){r0(1)}),n0=function(r0){r0(function(){},function(){})};return(e0.constructor={})[qv]=n0,!(jo=e0.then(function(){})instanceof n0)||!t0&&pv&&!io}),vv=Nf||!Tg(function(t0){zb.all(t0).catch(function(){})}),ko=function(t0){var e0;return!(!ha(t0)||typeof(e0=t0.then)!="function")&&e0},qj=function(t0,e0){if(!t0.notified){t0.notified=!0;var n0=t0.reactions;fo(function(){for(var r0=t0.value,i0=t0.state==1,o0=0;n0.length>o0;){var s0,a0=n0[o0++],c0=i0?a0.ok:a0.fail,u0=a0.resolve,l0=a0.reject,d0=a0.domain;try{if(c0){if(i0||(t0.rejection===2&&wv(t0),t0.rejection=1),c0===!0)var h0=r0;else if(d0&&d0.enter(),h0=c0(r0),d0){d0.exit();var p0=!0}h0===a0.promise?l0(ho("Promise-chain cycle")):(s0=ko(h0))?s0.call(h0,u0,l0):u0(h0)}else l0(r0)}catch(m0){d0&&!p0&&d0.exit(),l0(m0)}}t0.reactions=[],t0.notified=!1,e0&&!t0.rejection&&xv(t0)})}},lo=function(t0,e0,n0){var r0;if(uv){var i0=oj.createEvent("Event");i0.promise=e0,i0.reason=n0,i0.initEvent(t0,!1,!0),y.dispatchEvent(i0)}else i0={promise:e0,reason:n0};!io&&(r0=y["on"+t0])?r0(i0):t0==="unhandledrejection"&&ov("Unhandled promise rejection",n0)},xv=function(t0){jj.call(y,function(){var e0=t0.facade,n0=t0.value;if(t0.rejection!==1&&!t0.parent){var r0=nj(function(){Hc?pj.emit("unhandledRejection",n0,e0):lo("unhandledrejection",e0,n0)});if(t0.rejection=Hc||t0.rejection!==1&&!t0.parent?2:1,r0.error)throw r0.value}})},wv=function(t0){jj.call(y,function(){var e0=t0.facade;Hc?pj.emit("rejectionHandled",e0):lo("rejectionhandled",e0,t0.value)})},Ie=function(t0,e0,n0){return function(r0){t0(e0,r0,n0)}},Je=function(t0,e0,n0){t0.done||(t0.done=!0,n0&&(t0=n0),t0.value=e0,t0.state=2,qj(t0,!0))},rj=function(t0,e0,n0){if(!t0.done){t0.done=!0,n0&&(t0=n0);try{if(t0.facade===e0)throw ho("Promise can't be resolved itself");var r0=ko(e0);r0?fo(function(){var i0={done:!1};try{r0.call(e0,Ie(rj,i0,t0),Ie(Je,i0,t0))}catch(o0){Je(i0,o0,t0)}}):(t0.value=e0,t0.state=1,qj(t0,!1))}catch(i0){Je({done:!1},i0,t0)}}};if(Nf){zb=function(t0){Gc(this,zb,"Promise"),yb(t0),sj.call(this);var e0=go(this);try{t0(Ie(rj,e0),Ie(Je,e0))}catch(n0){Je(e0,n0)}},bh=zb.prototype;var sj=function(t0){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(t0,e0){var n0=sv(this),r0=He(kd(this,zb));return r0.ok=typeof t0!="function"||t0,r0.fail=typeof e0=="function"&&e0,r0.domain=Hc?pj.domain:void 0,n0.parent=!0,n0.reactions.push(r0),n0.state!=0&&qj(n0,!1),r0.promise},catch:function(t0){return this.then(void 0,t0)}});var yv=function(){var t0=new sj,e0=go(t0);this.promise=t0,this.resolve=Ie(rj,e0),this.reject=Ie(Je,e0)};if(lj.f=He=function(t0){return t0===zb||t0===zv?new yv(t0):tv(t0)},typeof Fc=="function"&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",function(t0,e0){var n0=this;return new zb(function(r0,i0){Av.call(n0,r0,i0)}).then(t0,e0)},{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch{}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(t0){var e0=He(this);return e0.reject.call(void 0,t0),e0.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(t0){return mj(this,t0)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(t0){var e0=this,n0=He(e0),r0=n0.resolve,i0=n0.reject,o0=nj(function(){var s0=yb(e0.resolve),a0=[],c0=0,u0=1;Xg(t0,function(l0){var d0=c0++,h0=!1;a0.push(void 0),u0++,s0.call(e0,l0).then(function(p0){h0||(h0=!0,a0[d0]=p0,--u0||r0(a0))},i0)}),--u0||r0(a0)});return o0.error&&i0(o0.value),n0.promise},race:function(t0){var e0=this,n0=He(e0),r0=n0.reject,i0=nj(function(){var o0=yb(e0.resolve);Xg(t0,function(s0){o0.call(e0,s0).then(n0.resolve,r0)})});return i0.error&&r0(i0.value),n0.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(t0){return no?mo.apply(this,arguments)||0:Si(this,t0,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var t0=va(this),e0="";return t0.global&&(e0+="g"),t0.ignoreCase&&(e0+="i"),t0.multiline&&(e0+="m"),t0.dotAll&&(e0+="s"),t0.unicode&&(e0+="u"),t0.sticky&&(e0+="y"),e0},pc=R(function(){var t0=RegExp("a","y");return t0.lastIndex=2,t0.exec("abcd")!=null}),Cv=R(function(){var t0=RegExp("^r","gy");return t0.lastIndex=2,t0.exec("str")!=null}),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),c.lastIndex!==0||a.lastIndex!==0),po=pc||Cv,vj=/()??/.exec("")[1]!==void 0,c,a;(uj||vj||po)&&(oo=function(t0){var e0,n0=po&&this.sticky,r0=tj.call(this),i0=this.source,o0=0,s0=t0;if(n0){(r0=r0.replace("y","")).indexOf("g")===-1&&(r0+="g"),s0=String(t0).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&t0[this.lastIndex-1]!==`
`)&&(i0="(?: "+i0+")",s0=" "+s0,o0++);var a0=new RegExp("^(?:"+i0+")",r0)}if(vj&&(a0=new RegExp("^"+i0+"$(?!\\s)",r0)),uj)var c0=this.lastIndex;var u0=ch.call(n0?a0:this,s0);return n0?u0?(u0.input=u0.input.slice(o0),u0[0]=u0[0].slice(o0),u0.index=this.lastIndex,this.lastIndex+=u0[0].length):this.lastIndex=0:uj&&u0&&(this.lastIndex=this.global?u0.index+u0[0].length:c0),vj&&u0&&1<u0.length&&Dv.call(u0[0],a0,function(){for(e0=1;e0<arguments.length-2;e0++)arguments[e0]===void 0&&(u0[e0]=void 0)}),u0});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R(function(){var t0=/./;return t0.exec=function(){var e0=[];return e0.groups={a:"7"},e0},"".replace(t0,"$<a>")!=="7"}),qo="a".replace(/./,"$0")==="$0",ro=qa("replace"),so=!!/./[ro]&&/./[ro]("a","$0")==="",Gv=!R(function(){var t0=/(?:)/,e0=t0.exec;return t0.exec=function(){return e0.apply(this,arguments)},(t0="ab".split(t0)).length!==2||t0[0]!=="a"||t0[1]!=="b"}),dh=function(t0,e0,n0,r0){var i0=qa(t0),o0=!R(function(){var u0={};return u0[i0]=function(){return 7},""[t0](u0)!=7}),s0=o0&&!R(function(){var u0=!1,l0=/a/;return t0==="split"&&((l0={constructor:{}}).constructor[Ev]=function(){return l0},l0.flags="",l0[i0]=/./[i0]),l0.exec=function(){return u0=!0,null},l0[i0](""),!u0});if(!o0||!s0||t0==="replace"&&(!Fv||!qo||so)||t0==="split"&&!Gv){var a0=/./[i0],c0=(n0=n0(i0,""[t0],function(u0,l0,d0,h0,p0){var m0=l0.exec;return m0===Of||m0===wj.exec?o0&&!p0?{done:!0,value:a0.call(l0,d0,h0)}:{done:!0,value:u0.call(d0,l0,h0)}:{done:!1}},{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,t0,n0[0]),Ta(wj,i0,e0==2?function(u0,l0){return c0.call(u0,this,l0)}:function(u0){return c0.call(u0,this)})}r0&&Na(wj[i0],"sham",!0)},xj=function(t0,e0,n0){return e0+(n0?Gn(t0,e0).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(t0,e0,n0,r0,i0,o0){var s0=n0+t0.length,a0=r0.length,c0=Kv;return i0!==void 0&&(i0=Qa(i0),c0=Jv),Iv.call(o0,c0,function(u0,l0){switch(l0.charAt(0)){case"$":return"$";case"&":return t0;case"`":return e0.slice(0,n0);case"'":return e0.slice(s0);case"<":u0=i0[l0.slice(1,-1)];break;default:var d0=+l0;if(d0===0)return u0;if(d0>a0)return(d0=Hv(d0/10))===0?u0:d0<=a0?r0[d0-1]===void 0?l0.charAt(1):r0[d0-1]+l0.charAt(1):u0;u0=r0[d0-1]}return u0===void 0?"":u0})},Ke=function(t0,e0){var n0=t0.exec;if(typeof n0=="function"){if(typeof(t0=n0.call(t0,e0))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return t0}if(Zb(t0)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(t0,e0)},Mv=Math.max,Nv=Math.min,Ov=function(t0){return t0===void 0?t0:String(t0)};dh("replace",2,function(t0,e0,n0,r0){var i0=r0.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o0=r0.REPLACE_KEEPS_$0,s0=i0?"$":"$0";return[function(a0,c0){var u0=jb(this),l0=a0==null?void 0:a0[t0];return l0!==void 0?l0.call(a0,u0,c0):e0.call(String(u0),a0,c0)},function(a0,c0){if(!i0&&o0||typeof c0=="string"&&c0.indexOf(s0)===-1){var u0=n0(e0,a0,this,c0);if(u0.done)return u0.value}var l0=va(a0);a0=String(this),(u0=typeof c0=="function")||(c0=String(c0));var d0=l0.global;if(d0){var h0=l0.unicode;l0.lastIndex=0}for(var p0=[];;){var m0=Ke(l0,a0);if(m0===null||(p0.push(m0),!d0))break;String(m0[0])===""&&(l0.lastIndex=xj(a0,ta(l0.lastIndex),h0))}for(h0="",d0=l0=0;d0<p0.length;d0++){m0=p0[d0];for(var f0=String(m0[0]),g0=Mv(Nv($b(m0.index),a0.length),0),E0=[],_0=1;_0<m0.length;_0++)E0.push(Ov(m0[_0]));m0=m0.groups,u0?(E0=[f0].concat(E0,g0,a0),m0!==void 0&&E0.push(m0),m0=String(c0.apply(void 0,E0))):m0=Lv(f0,a0,g0,E0,m0,c0),g0>=l0&&(h0+=a0.slice(l0,g0)+m0,l0=g0+f0.length)}return h0+a0.slice(l0)}]});var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(t0,e0){var n0=qb(this),r0=ta(n0.length);if(t0=xb(t0,r0),e0=xb(e0===void 0?r0:e0,r0),gd(n0)){var i0=n0.constructor;if(typeof i0!="function"||i0!==Array&&!gd(i0.prototype)?ha(i0)&&(i0=i0[Qv])===null&&(i0=void 0):i0=void 0,i0===Array||i0===void 0)return Rv.call(n0,t0,e0)}for(i0=new(i0===void 0?Array:i0)(Sv(e0-t0,0)),r0=0;t0<e0;t0++,r0++)t0 in n0&&Ge(i0,r0,n0[t0]);return i0.length=r0,i0}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",function(t0,e0){Tv(this,{type:"Array Iterator",target:qb(t0),index:0,kind:e0})},function(){var t0=Uv(this),e0=t0.target,n0=t0.kind,r0=t0.index++;return!e0||r0>=e0.length?(t0.target=void 0,{value:void 0,done:!0}):n0=="keys"?{value:r0,done:!1}:n0=="values"?{value:e0[r0],done:!1}:{value:[r0,e0[r0]],done:!1}},"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to=typeof ArrayBuffer<"u"&&typeof DataView<"u",Le=function(t0){if(t0===void 0)return 0;t0=$b(t0);var e0=ta(t0);if(t0!==e0)throw RangeError("Wrong length or index");return e0},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(t0){var e0=Qa(this),n0=ta(e0.length),r0=arguments.length,i0=xb(1<r0?arguments[1]:void 0,n0);for(n0=(r0=2<r0?arguments[2]:void 0)===void 0?n0:xb(r0,n0);n0>i0;)e0[i0++]=t0;return e0},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(t0,e0,n0){var r0,i0=Array(n0),o0=(1<<(n0=8*n0-e0-1))-1,s0=o0>>1,a0=e0===23?Ic(2,-24)-Ic(2,-77):0,c0=0>t0||t0===0&&0>1/t0?1:0,u0=0;if((t0=Vv(t0))!=t0||t0===1/0){t0=t0!=t0?1:0;var l0=o0}else l0=Wv(Xv(t0)/Yv),1>t0*(r0=Ic(2,-l0))&&(l0--,r0*=2),2<=(t0=1<=l0+s0?t0+a0/r0:t0+a0*Ic(2,1-s0))*r0&&(l0++,r0/=2),l0+s0>=o0?(t0=0,l0=o0):1<=l0+s0?(t0=(t0*r0-1)*Ic(2,e0),l0+=s0):(t0=t0*Ic(2,s0-1)*Ic(2,e0),l0=0);for(;8<=e0;i0[u0++]=255&t0,t0/=256,e0-=8);for(l0=l0<<e0|t0,n0+=e0;0<n0;i0[u0++]=255&l0,l0/=256,n0-=8);return i0[--u0]|=128*c0,i0},xo=function(t0,e0){var n0=t0.length,r0=8*n0-e0-1,i0=(1<<r0)-1,o0=i0>>1;r0-=7,--n0;var s0=t0[n0--],a0=127&s0;for(s0>>=7;0<r0;a0=256*a0+t0[n0],n0--,r0-=8);var c0=a0&(1<<-r0)-1;for(a0>>=-r0,r0+=e0;0<r0;c0=256*c0+t0[n0],n0--,r0-=8);if(a0===0)a0=1-o0;else{if(a0===i0)return c0?NaN:s0?-1/0:1/0;c0+=Ic(2,e0),a0-=o0}return(s0?-1:1)*c0*Ic(2,a0-e0)},yo=function(t0){return[255&t0]},zo=function(t0){return[255&t0,t0>>8&255]},Ao=function(t0){return[255&t0,t0>>8&255,t0>>16&255,t0>>24&255]},Bo=function(t0){return t0[3]<<24|t0[2]<<16|t0[1]<<8|t0[0]},aw=function(t0){return wo(t0,23,4)},bw=function(t0){return wo(t0,52,8)},gh=function(t0,e0){$v(t0.prototype,e0,{get:function(){return Me(this)[e0]}})},md=function(t0,e0,n0,r0){n0=Le(n0);var i0=Me(t0);if(n0+e0>i0.byteLength)throw fh("Wrong index");return t0=Me(i0.buffer).bytes,n0+=i0.byteOffset,e0=t0.slice(n0,n0+e0),r0?e0:e0.reverse()},nd=function(t0,e0,n0,r0,i0,o0){n0=Le(n0);var s0=Me(t0);if(n0+e0>s0.byteLength)throw fh("Wrong index");for(t0=Me(s0.buffer).bytes,n0+=s0.byteOffset,r0=r0(+i0),i0=0;i0<e0;i0++)t0[n0+i0]=r0[o0?i0:e0-i0-1]};if(to){if(!R(function(){bc(1)})||!R(function(){new bc(-1)})||R(function(){return new bc,new bc(1.5),new bc(NaN),bc.name!="ArrayBuffer"})){Ab=function(t0){return Gc(this,Ab),new bc(Le(t0))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(t0,e0){Eo.call(this,t0,e0<<24>>24)},setUint8:function(t0,e0){Eo.call(this,t0,e0<<24>>24)}},{unsafe:!0})}else Ab=function(t0){Gc(this,Ab,"ArrayBuffer"),t0=Le(t0),uo(this,{bytes:yj.call(Array(t0),0),byteLength:t0}),ka||(this.byteLength=t0)},cc=function(t0,e0,n0){Gc(this,cc,"DataView"),Gc(t0,Ab,"DataView");var r0=Me(t0).byteLength;if(0>(e0=$b(e0))||e0>r0)throw fh("Wrong offset");if(e0+(n0=n0===void 0?r0-e0:ta(n0))>r0)throw fh("Wrong length");uo(this,{buffer:t0,byteLength:n0,byteOffset:e0}),ka||(this.buffer=t0,this.byteLength=n0,this.byteOffset=e0)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(t0){return md(this,1,t0)[0]<<24>>24},getUint8:function(t0){return md(this,1,t0)[0]},getInt16:function(t0){var e0=md(this,2,t0,1<arguments.length?arguments[1]:void 0);return(e0[1]<<8|e0[0])<<16>>16},getUint16:function(t0){var e0=md(this,2,t0,1<arguments.length?arguments[1]:void 0);return e0[1]<<8|e0[0]},getInt32:function(t0){return Bo(md(this,4,t0,1<arguments.length?arguments[1]:void 0))},getUint32:function(t0){return Bo(md(this,4,t0,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(t0){return xo(md(this,4,t0,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(t0){return xo(md(this,8,t0,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(t0,e0){nd(this,1,t0,yo,e0)},setUint8:function(t0,e0){nd(this,1,t0,yo,e0)},setInt16:function(t0,e0){nd(this,2,t0,zo,e0,2<arguments.length?arguments[2]:void 0)},setUint16:function(t0,e0){nd(this,2,t0,zo,e0,2<arguments.length?arguments[2]:void 0)},setInt32:function(t0,e0){nd(this,4,t0,Ao,e0,2<arguments.length?arguments[2]:void 0)},setUint32:function(t0,e0){nd(this,4,t0,Ao,e0,2<arguments.length?arguments[2]:void 0)},setFloat32:function(t0,e0){nd(this,4,t0,aw,e0,2<arguments.length?arguments[2]:void 0)},setFloat64:function(t0,e0){nd(this,8,t0,bw,e0,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R(function(){return!new Aj(2).slice(1,void 0).byteLength});N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(t0,e0){if(Go!==void 0&&e0===void 0)return Go.call(va(this),t0);var n0=va(this).byteLength;t0=xb(t0,n0),e0=xb(e0===void 0?n0:e0,n0),n0=new(kd(this,Aj))(ta(e0-t0));for(var r0=new Fo(this),i0=new Fo(n0),o0=0;t0<e0;)i0.setUint8(o0++,r0.getUint8(t0++));return n0}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&Ff(y.opera)!=="Opera",Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(t0){return!!ha(t0)&&(t0=Ff(t0),Q(rc,t0)||Q(fw,t0))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||typeof qc!="function"||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(t0){if(jh(t0))return t0;throw TypeError("Target is not a typed array")},Ne=function(t0){if(Ua){if(Ko.call(qc,t0))return t0}else for(var e0 in rc)if(Q(rc,Bb)){var n0=y[e0];if(n0&&(t0===n0||Ko.call(n0,t0)))return t0}throw TypeError("Target is not a typed array constructor")},Aa=function(t0,e0,n0){if(ka){if(n0)for(var r0 in rc){var i0=y[r0];if(i0&&Q(i0.prototype,t0))try{delete i0.prototype[t0]}catch{}}dc[t0]&&!n0||Ta(dc,t0,n0?e0:Jc&&Bj[t0]||e0)}},Oo=function(t0,e0,n0){var r0,i0;if(ka){if(Ua){if(n0){for(r0 in rc)if((i0=y[r0])&&Q(i0,t0))try{delete i0[t0]}catch{}}if(qc[t0]&&!n0)return;try{return Ta(qc,t0,n0?e0:Jc&&qc[t0]||e0)}catch{}}for(r0 in rc)!(i0=y[r0])||i0[t0]&&!n0||Ta(i0,t0,e0)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R(function(){Od(1)})||!R(function(){new Od(-1)})||!Tg(function(t0){new Od,new Od(null),new Od(1.5),new Od(t0)},!0)||R(function(){return new Od(new gw(2),1,void 0).length!==1}),kh=function(t0,e0){if(0>(t0=$b(t0)))throw RangeError("The argument can't be less than 0");if(t0%e0)throw RangeError("Wrong offset");return t0},Ej=function(t0){var e0=Qa(t0),n0=arguments.length,r0=1<n0?arguments[1]:void 0,i0=r0!==void 0,o0=Xi(e0);if(o0!=null&&!Vi(o0)){var s0=o0.call(e0),a0=s0.next;for(e0=[];!(o0=a0.call(s0)).done;)e0.push(o0.value)}for(i0&&2<n0&&(r0=Id(r0,arguments[2],2)),o0=ta(e0.length),s0=new(Ne(this))(o0),n0=0;o0>n0;n0++)s0[n0]=i0?r0(e0[n0],n0):e0[n0];return s0},lh=function(t0,e0,n0){var r0,i0;return Ua&&typeof(r0=e0.constructor)=="function"&&r0!==n0&&ha(i0=r0.prototype)&&i0!==n0.prototype&&Ua(t0,i0),t0},Sf=$a(function(t0){var e0=Hd.f,n0=Za.get,r0=Za.set,i0=Ra.f,o0=Fb.f,s0=Math.round,a0=y.RangeError,c0=Pf.ArrayBuffer,u0=Pf.DataView,l0=function(g0,E0){var _0=0,y0=E0.length;for(g0=new(Ne(g0))(y0);y0>_0;)g0[_0]=E0[_0++];return g0},d0=function(g0,E0){i0(g0,E0,{get:function(){return n0(this)[E0]}})},h0=function(g0){var E0;return g0 instanceof c0||(E0=Ff(g0))=="ArrayBuffer"||E0=="SharedArrayBuffer"},p0=function(g0,E0){return jh(g0)&&typeof E0!="symbol"&&E0 in g0&&String(+E0)==String(E0)},m0=function(g0,E0){return p0(g0,E0=lc(E0,!0))?dd(2,g0[E0]):o0(g0,E0)},f0=function(g0,E0,_0){return!(p0(g0,E0=lc(E0,!0))&&ha(_0)&&Q(_0,"value"))||Q(_0,"get")||Q(_0,"set")||_0.configurable||Q(_0,"writable")&&!_0.writable||Q(_0,"enumerable")&&!_0.enumerable?i0(g0,E0,_0):(g0[E0]=_0.value,g0)};ka?(Qf||(Fb.f=m0,Ra.f=f0,d0(Rf,"buffer"),d0(Rf,"byteOffset"),d0(Rf,"byteLength"),d0(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:m0,defineProperty:f0}),t0.exports=function(g0,E0,_0){var y0=g0.match(/\d+$/)[0]/8,b0=g0+(_0?"Clamped":"")+"Array",S0="get"+g0,w0="set"+g0,I0=y[b0],L0=I0;g0=L0&&L0.prototype;var M0={},C0=function(U0,x0){i0(U0,x0,{get:function(){var j0=n0(this);return j0.view[S0](x0*y0+j0.byteOffset,!0)},set:function(j0){var k0=n0(this);_0&&(j0=0>(j0=s0(j0))?0:255<j0?255:255&j0),k0.view[w0](x0*y0+k0.byteOffset,j0,!0)},enumerable:!0})};Qf?Dj&&(L0=E0(function(U0,x0,j0,k0){return Gc(U0,L0,b0),lh(ha(x0)?h0(x0)?k0!==void 0?new I0(x0,kh(j0,y0),k0):j0!==void 0?new I0(x0,kh(j0,y0)):new I0(x0):jh(x0)?l0(L0,x0):Ej.call(L0,x0):new I0(Le(x0)),U0,L0)}),Ua&&Ua(L0,Po),Jd(e0(I0),function(U0){U0 in L0||Na(L0,U0,I0[U0])}),L0.prototype=g0):(L0=E0(function(U0,x0,j0,k0){Gc(U0,L0,b0);var D0=0,$0=0;if(ha(x0)){if(!h0(x0))return jh(x0)?l0(L0,x0):Ej.call(L0,x0);var N0=x0;if($0=kh(j0,y0),x0=x0.byteLength,k0===void 0){if(x0%y0||0>(k0=x0-$0))throw a0("Wrong length")}else if((k0=ta(k0)*y0)+$0>x0)throw a0("Wrong length");x0=k0/y0}else x0=Le(x0),N0=new c0(k0=x0*y0);for(r0(U0,{buffer:N0,byteOffset:$0,byteLength:k0,length:x0,view:new u0(N0)});D0<x0;)C0(U0,D0++)}),Ua&&Ua(L0,Po),g0=L0.prototype=ac(Rf)),g0.constructor!==L0&&Na(g0,"constructor",L0),No&&Na(g0,No,b0),M0[b0]=L0,N({global:!0,forced:L0!=I0,sham:!Qf},M0),"BYTES_PER_ELEMENT"in L0||Na(L0,"BYTES_PER_ELEMENT",y0),"BYTES_PER_ELEMENT"in g0||Na(g0,"BYTES_PER_ELEMENT",y0),If(b0)}):t0.exports=function(){}});Sf("Uint8",function(t0){return function(e0,n0,r0){return t0(this,e0,n0,r0)}});var hw=Math.min,iw=[].copyWithin||function(t0,e0){var n0=Qa(this),r0=ta(n0.length),i0=xb(t0,r0),o0=xb(e0,r0),s0=2<arguments.length?arguments[2]:void 0;for(r0=hw((s0===void 0?r0:xb(s0,r0))-o0,r0-i0),s0=1,o0<i0&&i0<o0+r0&&(s0=-1,o0+=r0-1,i0+=r0-1);0<r0--;)o0 in n0?n0[i0]=n0[o0]:delete n0[i0],i0+=s0,o0+=s0;return n0};Aa("copyWithin",function(t0,e0){return iw.call(Da(this),t0,e0,2<arguments.length?arguments[2]:void 0)}),Aa("every",function(t0){return Ju(Da(this),t0,1<arguments.length?arguments[1]:void 0)}),Aa("fill",function(t0){return yj.apply(Da(this),arguments)}),Aa("filter",function(t0){var e0=yn(Da(this),t0,1<arguments.length?arguments[1]:void 0),n0=kd(this,this.constructor),r0=0,i0=e0.length;for(n0=new(Ne(n0))(i0);i0>r0;)n0[r0]=e0[r0++];return n0}),Aa("find",function(t0){return zn(Da(this),t0,1<arguments.length?arguments[1]:void 0)}),Aa("findIndex",function(t0){return An(Da(this),t0,1<arguments.length?arguments[1]:void 0)}),Aa("forEach",function(t0){Jd(Da(this),t0,1<arguments.length?arguments[1]:void 0)}),Aa("includes",function(t0){return on(Da(this),t0,1<arguments.length?arguments[1]:void 0)}),Aa("indexOf",function(t0){return Si(Da(this),t0,1<arguments.length?arguments[1]:void 0)});var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&(Fj.name=="values"||Fj.name==null),To=function(){return jw.call(Da(this))};Aa("entries",function(){return lw.call(Da(this))}),Aa("keys",function(){return kw.call(Da(this))}),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",function(t0){return mw.apply(Da(this),arguments)});var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(t0){if(Uo)return Gj.apply(this,arguments)||0;var e0=qb(this),n0=ta(e0.length),r0=n0-1;for(1<arguments.length&&(r0=nw(r0,$b(arguments[1]))),0>r0&&(r0=n0+r0);0<=r0;r0--)if(r0 in e0&&e0[r0]===t0)return r0||0;return-1}:Gj;Aa("lastIndexOf",function(t0){return pw.apply(Da(this),arguments)}),Aa("map",function(t0){return xn(Da(this),t0,1<arguments.length?arguments[1]:void 0,function(e0,n0){return new(Ne(kd(e0,e0.constructor)))(n0)})});var Vo=function(t0){return function(e0,n0,r0,i0){yb(n0),e0=Qa(e0);var o0=Af(e0),s0=ta(e0.length),a0=t0?s0-1:0,c0=t0?-1:1;if(2>r0)for(;;){if(a0 in o0){i0=o0[a0],a0+=c0;break}if(a0+=c0,t0?0>a0:s0<=a0)throw TypeError("Reduce of empty array with no initial value")}for(;t0?0<=a0:s0>a0;a0+=c0)a0 in o0&&(i0=n0(i0,o0[a0],a0,e0));return i0}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",function(t0){return Wo(Da(this),t0,arguments.length,1<arguments.length?arguments[1]:void 0)}),Aa("reduceRight",function(t0){return qw(Da(this),t0,arguments.length,1<arguments.length?arguments[1]:void 0)});var rw=Math.floor;Aa("reverse",function(){for(var t0,e0=Da(this).length,n0=rw(e0/2),r0=0;r0<n0;)t0=this[r0],this[r0++]=this[--e0],this[e0]=t0;return this});var sw=R(function(){new Int8Array(1).set({})});Aa("set",function(t0){Da(this);var e0=kh(1<arguments.length?arguments[1]:void 0,1),n0=this.length,r0=Qa(t0),i0=ta(r0.length),o0=0;if(i0+e0>n0)throw RangeError("Wrong length");for(;o0<i0;)this[e0+o0]=r0[o0++]},sw);var tw=[].slice,uw=R(function(){new Int8Array(1).slice()});Aa("slice",function(t0,e0){t0=tw.call(Da(this),t0,e0);var n0=kd(this,this.constructor);e0=0;var r0=t0.length;for(n0=new(Ne(n0))(r0);r0>e0;)n0[e0]=t0[e0++];return n0},uw),Aa("some",function(t0){return Iu(Da(this),t0,1<arguments.length?arguments[1]:void 0)});var vw=[].sort;Aa("sort",function(t0){return vw.call(Da(this),t0)}),Aa("subarray",function(t0,e0){var n0=Da(this),r0=n0.length;return t0=xb(t0,r0),new(kd(n0,n0.constructor))(n0.buffer,n0.byteOffset+t0*n0.BYTES_PER_ELEMENT,ta((e0===void 0?r0:xb(e0,r0))-t0))});var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R(function(){Xo.call(new mh(1))}),yw=R(function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()})||!R(function(){mh.prototype.toLocaleString.call([1,2])});Aa("toLocaleString",function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)},yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R(function(){nh.call({})})&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch{return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R(function(){return ap.call({source:"a",flags:"b"})!="/a/b"}),Fw=ap.name!="toString";(Ew||Fw)&&Ta(RegExp.prototype,"toString",function(){var t0=va(this),e0=String(t0.source),n0=t0.flags;return"/"+e0+"/"+(t0=String(n0===void 0&&t0 instanceof RegExp&&!("flags"in $o)?tj.call(t0):n0))},{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(t0,e0){var n0,r0,i0=Qa(this),o0=ta(i0.length),s0=xb(t0,o0),a0=arguments.length;if(a0===0?a0=n0=0:a0===1?(a0=0,n0=o0-s0):(a0-=2,n0=Iw(Hw($b(e0),0),o0-s0)),9007199254740991<o0+a0-n0)throw TypeError("Maximum allowed length exceeded");var c0=Sg(i0,n0);for(r0=0;r0<n0;r0++){var u0=s0+r0;u0 in i0&&Ge(c0,r0,i0[u0])}if(c0.length=n0,a0<n0){for(r0=s0;r0<o0-n0;r0++){var l0=r0+a0;(u0=r0+n0)in i0?i0[l0]=i0[u0]:delete i0[l0]}for(r0=o0;r0>o0-n0+a0;r0--)delete i0[r0-1]}else if(a0>n0)for(r0=o0-n0;r0>s0;r0--)l0=r0+a0-1,(u0=r0+n0-1)in i0?i0[l0]=i0[u0]:delete i0[l0];for(r0=0;r0<a0;r0++)i0[r0+s0]=arguments[r0+2];return i0.length=o0-n0+a0,c0}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch{Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh]){for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch{Kc[Oe]=ld[Oe]}}}}var dp=Object.is||function(t0,e0){return t0===e0?t0!==0||1/t0==1/e0:t0!=t0&&e0!=e0};dh("search",1,function(t0,e0,n0){return[function(r0){var i0=jb(this),o0=r0==null?void 0:r0[t0];return o0!==void 0?o0.call(r0,i0):new RegExp(r0)[t0](String(i0))},function(r0){var i0=n0(e0,r0,this);if(i0.done)return i0.value;r0=va(r0);var o0=String(this);return i0=r0.lastIndex,dp(i0,0)||(r0.lastIndex=0),o0=Ke(r0,o0),dp(r0.lastIndex,i0)||(r0.lastIndex=i0),o0===null?-1:o0.index}]}),$a(function(t0){(function(e0,n0){t0.exports?t0.exports=n0(e0):n0(e0)})(typeof self<"u"?self:Ya,function(e0){function n0(C0){return btoa(C0).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function r0(C0){return C0=(C0+="===").slice(0,-C0.length%4),atob(C0.replace(/-/g,"+").replace(/_/g,"/"))}function i0(C0){for(var U0=new Uint8Array(C0.length),x0=0;x0<C0.length;x0++)U0[x0]=C0.charCodeAt(x0);return U0}function o0(C0){return C0 instanceof ArrayBuffer&&(C0=new Uint8Array(C0)),String.fromCharCode.apply(String,C0)}function s0(C0){var U0={name:(C0.name||C0||"").toUpperCase().replace("V","v")};switch(U0.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":C0.length&&(U0.length=C0.length);break;case"HMAC":C0.hash&&(U0.hash=s0(C0.hash)),C0.length&&(U0.length=C0.length);break;case"RSAES-PKCS1-v1_5":C0.publicExponent&&(U0.publicExponent=new Uint8Array(C0.publicExponent)),C0.modulusLength&&(U0.modulusLength=C0.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":C0.hash&&(U0.hash=s0(C0.hash)),C0.publicExponent&&(U0.publicExponent=new Uint8Array(C0.publicExponent)),C0.modulusLength&&(U0.modulusLength=C0.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return U0}function a0(C0){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[C0.name][(C0.hash||{}).name||C0.length||""]}function c0(C0){(C0 instanceof ArrayBuffer||C0 instanceof Uint8Array)&&(C0=JSON.parse(decodeURIComponent(escape(o0(C0)))));var U0={kty:C0.kty,alg:C0.alg,ext:C0.ext||C0.extractable};switch(U0.kty){case"oct":U0.k=C0.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(x0){x0 in C0&&(U0[x0]=C0[x0])});break;default:throw new TypeError("Unsupported key type")}return U0}function u0(C0){return C0=c0(C0),S0&&(C0.extractable=C0.ext,delete C0.ext),i0(unescape(encodeURIComponent(JSON.stringify(C0)))).buffer}function l0(C0){var U0=d0(C0),x0=!1;switch(2<U0.length&&(x0=!0,U0.shift()),C0={ext:!0},U0[0][0]){case"1.2.840.113549.1.1.1":var j0="n e d p q dp dq qi".split(" ");for(U0=d0(U0[1]),x0&&U0.shift(),x0=0;x0<U0.length;x0++)U0[x0][0]||(U0[x0]=U0[x0].subarray(1)),C0[j0[x0]]=n0(o0(U0[x0]));C0.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return C0}function d0(C0,U0){if(C0 instanceof ArrayBuffer&&(C0=new Uint8Array(C0)),U0||(U0={pos:0,end:C0.length}),2>U0.end-U0.pos||U0.end>C0.length)throw new RangeError("Malformed DER");var x0=C0[U0.pos++],j0=C0[U0.pos++];if(128<=j0){if(j0&=127,U0.end-U0.pos<j0)throw new RangeError("Malformed DER");for(var k0=0;j0--;)k0<<=8,k0|=C0[U0.pos++];j0=k0}if(U0.end-U0.pos<j0)throw new RangeError("Malformed DER");switch(x0){case 2:x0=C0.subarray(U0.pos,U0.pos+=j0);break;case 3:if(C0[U0.pos++])throw Error("Unsupported bit string");j0--;case 4:x0=new Uint8Array(C0.subarray(U0.pos,U0.pos+=j0)).buffer;break;case 5:x0=null;break;case 6:if(!((C0=btoa(o0(C0.subarray(U0.pos,U0.pos+=j0))))in I0))throw Error("Unsupported OBJECT ID "+C0);x0=I0[C0];break;case 48:for(x0=[],j0=U0.pos+j0;U0.pos<j0;)x0.push(d0(C0,U0));break;default:throw Error("Unsupported DER tag 0x"+x0.toString(16))}return x0}function h0(C0,U0){U0||(U0=[]);var x0=U0.length+2;if(U0.push(0,0),C0 instanceof Uint8Array)for(var j0=2,k0=C0.length,D0=0;D0<k0;D0++)U0.push(C0[D0]);else if(C0 instanceof ArrayBuffer)for(j0=4,k0=C0.byteLength,C0=new Uint8Array(C0),D0=0;D0<k0;D0++)U0.push(C0[D0]);else if(C0===null)j0=5,k0=0;else if(typeof C0=="string"&&C0 in L0)for(j0=6,k0=(C0=i0(atob(L0[C0]))).length,D0=0;D0<k0;D0++)U0.push(C0[D0]);else if(C0 instanceof Array){for(D0=0;D0<C0.length;D0++)h0(C0[D0],U0);j0=48,k0=U0.length-x0}else{if(!(X(C0)==="object"&&C0.tag===3&&C0.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+C0);for(j0=3,k0=(C0=new Uint8Array(C0.value)).byteLength,U0.push(0),D0=0;D0<k0;D0++)U0.push(C0[D0]);k0++}if(128<=k0){for(D0=k0,k0=4,U0.splice(x0,0,D0>>24&255,D0>>16&255,D0>>8&255,255&D0);1<k0&&!(D0>>24);)D0<<=8,k0--;4>k0&&U0.splice(x0,4-k0),k0|=128}return U0.splice(x0-2,2,j0,k0),U0}function p0(C0,U0,x0,j0){Object.defineProperties(this,{_key:{value:C0},type:{value:C0.type,enumerable:!0},extractable:{value:x0===void 0?C0.extractable:x0,enumerable:!0},algorithm:{value:U0===void 0?C0.algorithm:U0,enumerable:!0},usages:{value:j0===void 0?C0.usages:j0,enumerable:!0}})}function m0(C0){return C0==="verify"||C0==="encrypt"||C0==="wrapKey"}function f0(C0){return C0==="sign"||C0==="decrypt"||C0==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var g0=e0.crypto||e0.msCrypto;if(g0){var E0=g0.subtle||g0.webkitSubtle;if(E0){var _0=e0.Crypto||g0.constructor||Object,y0=e0.SubtleCrypto||E0.constructor||Object;e0.CryptoKey||e0.Key;var b0=-1<e0.navigator.userAgent.indexOf("Edge/"),S0=!!e0.msCrypto&&!b0,w0=!g0.subtle&&!!g0.webkitSubtle;if(S0||w0){var I0={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},L0={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(C0){var U0=E0[C0];E0[C0]=function(x0,j0,k0){var D0=[].slice.call(arguments);switch(C0){case"generateKey":var $0=s0(x0),N0=j0,A0=k0;break;case"importKey":$0=s0(k0),N0=D0[3],A0=D0[4],x0==="jwk"&&((j0=c0(j0)).alg||(j0.alg=a0($0)),j0.key_ops||(j0.key_ops=j0.kty!=="oct"?"d"in j0?A0.filter(f0):A0.filter(m0):A0.slice()),D0[1]=u0(j0));break;case"unwrapKey":$0=D0[4],N0=D0[5],A0=D0[6],D0[2]=k0._key}if(C0==="generateKey"&&$0.name==="HMAC"&&$0.hash)return $0.length=$0.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[$0.hash.name],E0.importKey("raw",g0.getRandomValues(new Uint8Array($0.length+7>>3)),$0,N0,A0);if(w0&&C0==="generateKey"&&$0.name==="RSASSA-PKCS1-v1_5"&&(!$0.modulusLength||2048<=$0.modulusLength))return(x0=s0(x0)).name="RSAES-PKCS1-v1_5",delete x0.hash,E0.generateKey(x0,!0,["encrypt","decrypt"]).then(function(O0){return Promise.all([E0.exportKey("jwk",O0.publicKey),E0.exportKey("jwk",O0.privateKey)])}).then(function(O0){return O0[0].alg=O0[1].alg=a0($0),O0[0].key_ops=A0.filter(m0),O0[1].key_ops=A0.filter(f0),Promise.all([E0.importKey("jwk",O0[0],$0,!0,O0[0].key_ops),E0.importKey("jwk",O0[1],$0,N0,O0[1].key_ops)])}).then(function(O0){return{publicKey:O0[0],privateKey:O0[1]}});if((w0||S0&&($0.hash||{}).name==="SHA-1")&&C0==="importKey"&&x0==="jwk"&&$0.name==="HMAC"&&j0.kty==="oct")return E0.importKey("raw",i0(r0(j0.k)),k0,D0[3],D0[4]);if(w0&&C0==="importKey"&&(x0==="spki"||x0==="pkcs8"))return E0.importKey("jwk",l0(j0),k0,D0[3],D0[4]);if(S0&&C0==="unwrapKey")return E0.decrypt(D0[3],k0,j0).then(function(O0){return E0.importKey(x0,O0,D0[4],D0[5],D0[6])});try{var P0=U0.apply(E0,D0)}catch(O0){return Promise.reject(O0)}return S0&&(P0=new Promise(function(O0,v0){P0.onabort=P0.onerror=function(R0){v0(R0)},P0.oncomplete=function(R0){O0(R0.target.result)}})),P0=P0.then(function(O0){return $0.name!=="HMAC"||$0.length||($0.length=8*O0.algorithm.length),$0.name.search("RSA")==0&&($0.modulusLength||($0.modulusLength=(O0.publicKey||O0).algorithm.modulusLength),$0.publicExponent||($0.publicExponent=(O0.publicKey||O0).algorithm.publicExponent)),O0.publicKey&&O0.privateKey?{publicKey:new p0(O0.publicKey,$0,N0,A0.filter(m0)),privateKey:new p0(O0.privateKey,$0,N0,A0.filter(f0))}:new p0(O0,$0,N0,A0)})}}),["exportKey","wrapKey"].forEach(function(C0){var U0=E0[C0];E0[C0]=function(x0,j0,k0){var D0=[].slice.call(arguments);switch(C0){case"exportKey":D0[1]=j0._key;break;case"wrapKey":D0[1]=j0._key,D0[2]=k0._key}if((w0||S0&&(j0.algorithm.hash||{}).name==="SHA-1")&&C0==="exportKey"&&x0==="jwk"&&j0.algorithm.name==="HMAC"&&(D0[0]="raw"),!w0||C0!=="exportKey"||x0!=="spki"&&x0!=="pkcs8"||(D0[0]="jwk"),S0&&C0==="wrapKey")return E0.exportKey(x0,j0).then(function(N0){return x0==="jwk"&&(N0=i0(unescape(encodeURIComponent(JSON.stringify(c0(N0)))))),E0.encrypt(D0[3],k0,N0)});try{var $0=U0.apply(E0,D0)}catch(N0){return Promise.reject(N0)}return S0&&($0=new Promise(function(N0,A0){$0.onabort=$0.onerror=function(P0){A0(P0)},$0.oncomplete=function(P0){N0(P0.target.result)}})),C0==="exportKey"&&x0==="jwk"&&($0=$0.then(function(N0){return(w0||S0&&(j0.algorithm.hash||{}).name==="SHA-1")&&j0.algorithm.name==="HMAC"?{kty:"oct",alg:a0(j0.algorithm),key_ops:j0.usages.slice(),ext:!0,k:n0(o0(N0))}:((N0=c0(N0)).alg||(N0.alg=a0(j0.algorithm)),N0.key_ops||(N0.key_ops=j0.type==="public"?j0.usages.filter(m0):j0.type==="private"?j0.usages.filter(f0):j0.usages.slice()),N0)})),!w0||C0!=="exportKey"||x0!=="spki"&&x0!=="pkcs8"||($0=$0.then(function(N0){var A0=[["",null]],P0=!1;switch((N0=c0(N0)).kty){case"RSA":for(var O0="n e d p q dp dq qi".split(" "),v0=[],R0=0;R0<O0.length&&O0[R0]in N0;R0++){var T0=v0[R0]=i0(r0(N0[O0[R0]]));128&T0[0]&&(v0[R0]=new Uint8Array(T0.length+1),v0[R0].set(T0,1))}2<v0.length&&(P0=!0,v0.unshift(new Uint8Array([0]))),A0[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return A0.push(new Uint8Array(h0(v0)).buffer),P0?A0.unshift(new Uint8Array([0])):A0[1]={tag:3,value:A0[1]},new Uint8Array(h0(A0)).buffer})),$0}}),["encrypt","decrypt","sign","verify"].forEach(function(C0){var U0=E0[C0];E0[C0]=function(x0,j0,k0,D0){if(S0&&(!k0.byteLength||D0&&!D0.byteLength))throw Error("Empty input is not allowed");var $0=[].slice.call(arguments),N0=s0(x0);if(!S0||C0!=="sign"&&C0!=="verify"||x0!=="RSASSA-PKCS1-v1_5"&&x0!=="HMAC"||($0[0]={name:x0}),S0&&j0.algorithm.hash&&($0[0].hash=$0[0].hash||j0.algorithm.hash),S0&&C0==="decrypt"&&N0.name==="AES-GCM"){var A0=x0.tagLength>>3;$0[2]=(k0.buffer||k0).slice(0,k0.byteLength-A0),x0.tag=(k0.buffer||k0).slice(k0.byteLength-A0)}S0&&N0.name==="AES-GCM"&&$0[0].tagLength===void 0&&($0[0].tagLength=128),$0[1]=j0._key;try{var P0=U0.apply(E0,$0)}catch(O0){return Promise.reject(O0)}return S0&&(P0=new Promise(function(O0,v0){P0.onabort=P0.onerror=function(R0){v0(R0)},P0.oncomplete=function(R0){if(R0=R0.target.result,C0==="encrypt"&&R0 instanceof AesGcmEncryptResult){var T0=R0.ciphertext,F0=R0.tag;(R0=new Uint8Array(T0.byteLength+F0.byteLength)).set(new Uint8Array(T0),0),R0.set(new Uint8Array(F0),T0.byteLength),R0=R0.buffer}O0(R0)}})),P0}}),S0){var M0=E0.digest;E0.digest=function(C0,U0){if(!U0.byteLength)throw Error("Empty input is not allowed");try{var x0=M0.call(E0,C0,U0)}catch(j0){return Promise.reject(j0)}return x0=new Promise(function(j0,k0){x0.onabort=x0.onerror=function(D0){k0(D0)},x0.oncomplete=function(D0){j0(D0.target.result)}})},e0.crypto=Object.create(g0,{getRandomValues:{value:function(C0){return g0.getRandomValues(C0)}},subtle:{value:E0}}),e0.CryptoKey=p0}w0&&(g0.subtle=E0,e0.Crypto=_0,e0.SubtleCrypto=y0,e0.CryptoKey=p0)}}}})});var Jw=qa("match"),Lj=function(t0){var e0;return ha(t0)&&((e0=t0[Jw])!==void 0?!!e0:Zb(t0)=="RegExp")},Kw=[].push,Lw=Math.min;dh("split",2,function(t0,e0,n0){var r0="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(i0,o0){var s0=String(jb(this));if((o0=o0===void 0?4294967295:o0>>>0)===0)return[];if(i0===void 0)return[s0];if(!Lj(i0))return e0.call(s0,i0,o0);var a0,c0,u0,l0=[],d0=0;for(i0=new RegExp(i0.source,(i0.ignoreCase?"i":"")+(i0.multiline?"m":"")+(i0.unicode?"u":"")+(i0.sticky?"y":"")+"g");(a0=Of.call(i0,s0))&&!((c0=i0.lastIndex)>d0&&(l0.push(s0.slice(d0,a0.index)),1<a0.length&&a0.index<s0.length&&Kw.apply(l0,a0.slice(1)),u0=a0[0].length,d0=c0,l0.length>=o0));)i0.lastIndex===a0.index&&i0.lastIndex++;return d0===s0.length?(u0||!i0.test(""))&&l0.push(""):l0.push(s0.slice(d0)),l0.length>o0?l0.slice(0,o0):l0}:"0".split(void 0,0).length?function(i0,o0){return i0===void 0&&o0===0?[]:e0.call(this,i0,o0)}:e0;return[function(i0,o0){var s0=jb(this),a0=i0==null?void 0:i0[t0];return a0!==void 0?a0.call(i0,s0,o0):r0.call(String(s0),i0,o0)},function(i0,o0){var s0=n0(r0,i0,this,o0,r0!==e0);if(s0.done)return s0.value;var a0=va(i0);i0=String(this);var c0=kd(a0,RegExp);if(s0=a0.unicode,a0=new c0(pc?"^(?:"+a0.source+")":a0,(a0.ignoreCase?"i":"")+(a0.multiline?"m":"")+(a0.unicode?"u":"")+(pc?"g":"y")),(o0=o0===void 0?4294967295:o0>>>0)===0)return[];if(i0.length===0)return Ke(a0,i0)===null?[i0]:[];var u0=0,l0=0;for(c0=[];l0<i0.length;){a0.lastIndex=pc?0:l0;var d0,h0=Ke(a0,pc?i0.slice(l0):i0);if(h0===null||(d0=Lw(ta(a0.lastIndex+(pc?l0:0)),i0.length))===u0)l0=xj(i0,l0,s0);else{if(c0.push(i0.slice(u0,l0)),c0.length===o0)return c0;for(u0=1;u0<=h0.length-1;u0++)if(c0.push(h0[u0]),c0.length===o0)return c0;l0=u0=d0}}return c0.push(i0.slice(u0)),c0}]},pc),function(t0){t0.console||(t0.console={}),t0=t0.console;for(var e0,n0=function(){},r0=["memory"],i0="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");e0=r0.pop();)t0[e0]||(t0[e0]={});for(;e0=i0.pop();)t0[e0]||(t0[e0]=n0)}(typeof window>"u"?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R(function(){Vb(1)});N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(t0){return Vb(Qa(t0))}});var ep=[].slice,Mj={},Nw=Function.bind||function(t0){var e0=yb(this),n0=ep.call(arguments,1),r0=function(){var i0=n0.concat(ep.call(arguments));if(this instanceof r0){var o0=i0.length;if(!(o0 in Mj)){for(var s0=[],a0=0;a0<o0;a0++)s0[a0]="a["+a0+"]";Mj[o0]=Function("C,a","return new C("+s0.join(",")+")")}i0=Mj[o0](e0,i0)}else i0=e0.apply(t0,i0);return i0};return ha(e0.prototype)&&(r0.prototype=e0.prototype),r0},Nj=mc("Reflect","construct"),fp=R(function(){function t0(){}return!(Nj(function(){},[],t0)instanceof t0)}),gp=!R(function(){Nj(function(){})}),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(t0,e0){yb(t0),va(e0);var n0=3>arguments.length?t0:yb(arguments[2]);if(gp&&!fp)return Nj(t0,e0,n0);if(t0==n0){switch(e0.length){case 0:return new t0;case 1:return new t0(e0[0]);case 2:return new t0(e0[0],e0[1]);case 3:return new t0(e0[0],e0[1],e0[2]);case 4:return new t0(e0[0],e0[1],e0[2],e0[3])}return(n0=[null]).push.apply(n0,e0),new(Nw.apply(t0,n0))}n0=n0.prototype,n0=ac(ha(n0)?n0:Object.prototype);var r0=Function.apply.call(t0,n0,e0);return ha(r0)?r0:n0}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R(function(){ip(1)});N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(t0,e0){return ip(qb(t0),e0)}});var jp=Hd.f,Pw={}.toString,kp=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(t0){if(kp&&Pw.call(t0)=="[object Window]")try{var e0=jp(t0)}catch{e0=kp.slice()}else e0=jp(qb(t0));return e0},lp={f:qa},Qw=Ra.f,ph=function(t0){var e0=y.Symbol||(y.Symbol={});Q(e0,t0)||Qw(e0,t0,{value:lp.f(t0)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R(function(){return ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a!=7})?function(t0,e0,n0){var r0=op(Ob,e0);r0&&delete Ob[e0],od(t0,e0,n0),r0&&t0!==Ob&&od(Ob,e0,r0)}:od,Uj=function(t0,e0){var n0=Lc[t0]=ac(sb.prototype);return Rw(n0,{type:"Symbol",tag:t0,description:e0}),ka||(n0.description=e0),n0},Vj=vn?function(t0){return typeof t0=="symbol"}:function(t0){return Object(t0)instanceof sb},qh=function(t0,e0,n0){return t0===Ob&&qh(Uf,e0,n0),va(t0),e0=lc(e0,!0),va(n0),Q(Lc,e0)?(n0.enumerable?(Q(t0,rb)&&t0[rb][e0]&&(t0[rb][e0]=!1),n0=ac(n0,{enumerable:dd(0,!1)})):(Q(t0,rb)||od(t0,rb,dd(1,{})),t0[rb][e0]=!0),Tj(t0,e0,n0)):od(t0,e0,n0)},qp=function(t0,e0){va(t0);var n0=qb(e0);return e0=Dc(n0).concat(Wj(n0)),Jd(e0,function(r0){ka&&!Xj.call(n0,r0)||qh(t0,r0,n0[r0])}),t0},Xj=function(t0){t0=lc(t0,!0);var e0=Sw.call(this,t0);return!(this===Ob&&Q(Lc,t0)&&!Q(Uf,t0))&&(!(e0||!Q(this,t0)||!Q(Lc,t0)||Q(this,rb)&&this[rb][t0])||e0)},rp=function(t0,e0){if(t0=qb(t0),e0=lc(e0,!0),t0!==Ob||!Q(Lc,e0)||Q(Uf,e0)){var n0=op(t0,e0);return!n0||!Q(Lc,e0)||Q(t0,rb)&&t0[rb][e0]||(n0.enumerable=!0),n0}},sp=function(t0){t0=pp(qb(t0));var e0=[];return Jd(t0,function(n0){Q(Lc,n0)||Q(Be,n0)||e0.push(n0)}),e0},Wj=function(t0){var e0=t0===Ob;t0=pp(e0?Uf:qb(t0));var n0=[];return Jd(t0,function(r0){!Q(Lc,r0)||e0&&!Q(Ob,r0)||n0.push(Lc[r0])}),n0};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var t0=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,e0=Ae(t0),n0=function(r0){this===Ob&&n0.call(Uf,r0),Q(this,rb)&&Q(this[rb],e0)&&(this[rb][e0]=!1),Tj(this,e0,dd(1,r0))};return ka&&Sj&&Tj(Ob,e0,{configurable:!0,set:n0}),Uj(e0,t0)},Ta(sb.prototype,"toString",function(){return np(this).tag}),Ta(sb,"withoutSetter",function(t0){return Uj(Ae(t0),t0)}),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(t0){return Uj(qa(t0),t0)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),function(t0){ph(t0)}),N({target:"Symbol",stat:!0,forced:!oc},{for:function(t0){if(t0=String(t0),Q(Pj,t0))return Pj[t0];var e0=sb(t0);return Pj[t0]=e0,Qj[e0]=t0,e0},keyFor:function(t0){if(!Vj(t0))throw TypeError(t0+" is not a symbol");if(Q(Qj,t0))return Qj[t0]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(t0,e0){return e0===void 0?ac(t0):qp(ac(t0),e0)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R(function(){Bf.f(1)})},{getOwnPropertySymbols:function(t0){return Bf.f(Qa(t0))}}),Tf){var Uw=!oc||R(function(){var t0=sb();return Tf([t0])!="[null]"||Tf({a:t0})!="{}"||Tf(Object(t0))!="{}"});N({target:"JSON",stat:!0,forced:Uw},{stringify:function(t0,e0,n0){for(var r0,i0=[t0],o0=1;arguments.length>o0;)i0.push(arguments[o0++]);if(r0=e0,(ha(e0)||t0!==void 0)&&!Vj(t0))return gd(e0)||(e0=function(s0,a0){if(typeof r0=="function"&&(a0=r0.call(this,s0,a0)),!Vj(a0))return a0}),i0[1]=e0,Tf.apply(null,i0)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&typeof Mc=="function"&&(!("description"in Mc.prototype)||Mc().description!==void 0)){var tp={},Vf=function(){var t0=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),e0=this instanceof Vf?new Mc(t0):t0===void 0?Mc():Mc(t0);return t0===""&&(tp[e0]=!0),e0};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw=String(Mc("test"))=="Symbol(test)",Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var t0=ha(this)?this.valueOf():this,e0=Ww.call(t0);return Q(tp,t0)?"":(t0=Xw?e0.slice(7,-1):e0.replace(Yw,"$1"))===""?void 0:t0}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function t0(h0,p0){if(!(h0 instanceof p0))throw new TypeError("Cannot call a class as a function")}function e0(h0,p0){for(var m0=0;m0<p0.length;m0++){var f0=p0[m0];f0.enumerable=f0.enumerable||!1,f0.configurable=!0,"value"in f0&&(f0.writable=!0),Object.defineProperty(h0,f0.key,f0)}}function n0(h0,p0,m0){return p0&&e0(h0.prototype,p0),m0&&e0(h0,m0),h0}function r0(h0,p0){if(typeof p0!="function"&&p0!==null)throw new TypeError("Super expression must either be null or a function");h0.prototype=Object.create(p0&&p0.prototype,{constructor:{value:h0,writable:!0,configurable:!0}}),p0&&o0(h0,p0)}function i0(h0){return(i0=Object.setPrototypeOf?Object.getPrototypeOf:function(p0){return p0.__proto__||Object.getPrototypeOf(p0)})(h0)}function o0(h0,p0){return(o0=Object.setPrototypeOf||function(m0,f0){return m0.__proto__=f0,m0})(h0,p0)}function s0(h0){if(h0===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h0}function a0(h0){var p0=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var m0=i0(h0);if(p0){var f0=i0(this).constructor;m0=Reflect.construct(m0,arguments,f0)}else m0=m0.apply(this,arguments);return m0=!m0||X(m0)!=="object"&&typeof m0!="function"?s0(this):m0}}function c0(h0,p0,m0){return(c0=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(f0,g0,E0){for(;!Object.prototype.hasOwnProperty.call(f0,g0)&&(f0=i0(f0))!==null;);if(f0)return(g0=Object.getOwnPropertyDescriptor(f0,g0)).get?g0.get.call(E0):g0.value})(h0,p0,m0||h0)}var u0=function(){function h0(){t0(this,h0),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n0(h0,[{key:"addEventListener",value:function(p0,m0,f0){p0 in this.listeners||(this.listeners[p0]=[]),this.listeners[p0].push({callback:m0,options:f0})}},{key:"removeEventListener",value:function(p0,m0){if(p0 in this.listeners){for(var f0=0,g0=(p0=this.listeners[p0]).length;f0<g0;f0++)if(p0[f0].callback===m0){p0.splice(f0,1);break}}}},{key:"dispatchEvent",value:function(p0){if(p0.type in this.listeners){for(var m0=this.listeners[p0.type].slice(),f0=0,g0=m0.length;f0<g0;f0++){var E0=m0[f0];try{E0.callback.call(this,p0)}catch(_0){Promise.resolve().then(function(){throw _0})}E0.options&&E0.options.once&&this.removeEventListener(p0.type,E0.callback)}return!p0.defaultPrevented}}}]),h0}(),l0=function(h0){function p0(){t0(this,p0);var f0=m0.call(this);return f0.listeners||u0.call(s0(f0)),Object.defineProperty(s0(f0),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(s0(f0),"onabort",{value:null,writable:!0,configurable:!0}),f0}r0(p0,h0);var m0=a0(p0);return n0(p0,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(f0){f0.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,f0)),c0(i0(p0.prototype),"dispatchEvent",this).call(this,f0)}}]),p0}(u0),d0=function(){function h0(){t0(this,h0),Object.defineProperty(this,"signal",{value:new l0,writable:!0,configurable:!0})}return n0(h0,[{key:"abort",value:function(){try{var p0=new Event("abort")}catch{typeof document<"u"?document.createEvent?(p0=document.createEvent("Event")).initEvent("abort",!1,!1):(p0=document.createEventObject()).type="abort":p0={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(p0)}},{key:"toString",value:function(){return"[object AbortController]"}}]),h0}();typeof Symbol<"u"&&Symbol.toStringTag&&(d0.prototype[Symbol.toStringTag]="AbortController",l0.prototype[Symbol.toStringTag]="AbortSignal"),function(h0){if(h0.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var p0=!0}else p0=typeof h0.Request=="function"&&!h0.Request.prototype.hasOwnProperty("signal")||!h0.AbortController;p0&&(h0.AbortController=d0,h0.AbortSignal=l0)}(typeof self<"u"?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(t0){return(t0>>>=0)?31-Zw($w(t0+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(t0){return 31-bx(t0>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(t0){if(t0=t0&&t0.buffer||t0,up.call(t0)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var e0="",n0=0,r0=0|(t0=Zj?new ak(t0):t0).length;n0<r0;n0=n0+32768|0)e0+=xd.apply(0,t0[Zj?"slice":"subarray"](n0,n0+32768|0));return e0.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(t0){for(var e0=0|(t0=t0===void 0?"":(""+t0).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,n0=new ak(e0),r0=0;r0<e0;r0=r0+1|0)n0[r0]=t0.charCodeAt(r0);return n0},window.TextEncoder||(window.TextEncoder=yl),function(t0){var e0,n0,r0,i0,o0,s0,a0,c0,u0,l0,d0;(function(h0){h0.LOGIN="LOGIN",h0.LOGIN_SUCCESS="LOGIN_SUCCESS",h0.LOGIN_FAILURE="LOGIN_FAILURE",h0.LOGIN_TIMEOUT="LOGIN_TIMEOUT",h0.INTERRUPTED="INTERRUPTED",h0.LOGOUT="LOGOUT",h0.BANNED_BY_SERVER="BANNED_BY_SERVER",h0.REMOTE_LOGIN="REMOTE_LOGIN"})(e0||(e0={})),t0.ConnectionChangeReason=e0,function(h0){h0.DISCONNECTED="DISCONNECTED",h0.CONNECTING="CONNECTING",h0.CONNECTED="CONNECTED",h0.RECONNECTING="RECONNECTING",h0.ABORTED="ABORTED"}(n0||(n0={})),t0.ConnectionState=n0,function(h0){h0.IDLE="IDLE",h0.SENT_TO_REMOTE="SENT_TO_REMOTE",h0.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",h0.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",h0.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",h0.CANCELED="CANCELED",h0.FAILURE="FAILURE"}(r0||(r0={})),t0.LocalInvitationState=r0,function(h0){h0.INVITATION_RECEIVED="INVITATION_RECEIVED",h0.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",h0.REFUSED="REFUSED",h0.ACCEPTED="ACCEPTED",h0.CANCELED="CANCELED",h0.FAILURE="FAILURE"}(i0||(i0={})),t0.RemoteInvitationState=i0,function(h0){h0.UNKNOWN="UNKNOWN",h0.PEER_NO_RESPONSE="PEER_NO_RESPONSE",h0.INVITATION_EXPIRE="INVITATION_EXPIRE",h0.PEER_OFFLINE="PEER_OFFLINE",h0.NOT_LOGGEDIN="NOT_LOGGEDIN"}(o0||(o0={})),t0.LocalInvitationFailureReason=o0,function(h0){h0.UNKNOWN="UNKNOWN",h0.PEER_OFFLINE="PEER_OFFLINE",h0.ACCEPT_FAILURE="ACCEPT_FAILURE",h0.INVITATION_EXPIRE="INVITATION_EXPIRE"}(s0||(s0={})),t0.RemoteInvitationFailureReason=s0,function(h0){h0.ONLINE="ONLINE",h0.UNREACHABLE="UNREACHABLE",h0.OFFLINE="OFFLINE"}(a0||(a0={})),t0.PeerOnlineState=a0,(c0||(c0={})).ONLINE_STATUS="ONLINE_STATUS",t0.PeerSubscriptionOption=c0,function(h0){h0.TEXT="TEXT",h0.RAW="RAW",h0.IMAGE="IMAGE",h0.FILE="FILE"}(u0||(u0={})),t0.MessageType=u0,function(h0){h0.CN="CN",h0.NA="NA",h0.EU="EU",h0.AS="AS",h0.JP="JP",h0.IN="IN",h0.GLOB="GLOB",h0.OC="OC",h0.SA="SA",h0.AF="AF",h0.OVS="OVS"}(l0||(l0={})),t0.LegacyAreaCode=l0,function(h0){h0.GLOBAL="GLOBAL",h0.INDIA="INDIA",h0.JAPAN="JAPAN",h0.ASIA="ASIA",h0.EUROPE="EUROPE",h0.CHINA="CHINA",h0.NORTH_AMERICA="NORTH_AMERICA"}(d0||(d0={})),t0.AreaCode=d0}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(t0){return on(this,t0,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(t0){if(Lj(t0))throw TypeError("The method doesn't accept regular expressions");return t0},ex=qa("match"),dk=function(t0){var e0=/./;try{"/./"[t0](e0)}catch{try{return e0[ex]=!1,"/./"[t0](e0)}catch{}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(t0){return!!~String(jb(this)).indexOf(ck(t0),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(t0){return Jd(this,t0,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch{rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a(function(t0){t0=function(e0){function n0(k0,D0,$0){return Object.defineProperty(k0,D0,{value:$0,enumerable:!0,configurable:!0,writable:!0}),k0[D0]}function r0(k0,D0,$0,N0){return D0=Object.create((D0&&D0.prototype instanceof o0?D0:o0).prototype),N0=new p0(N0||[]),D0._invoke=function(A0,P0,O0){var v0=I0;return function(R0,T0){if(v0===M0)throw Error("Generator is already running");if(v0===C0){if(R0==="throw")throw T0;return f0()}for(O0.method=R0,O0.arg=T0;;){if((R0=O0.delegate)&&(R0=l0(R0,O0))){if(R0===U0)continue;return R0}if(O0.method==="next")O0.sent=O0._sent=O0.arg;else if(O0.method==="throw"){if(v0===I0)throw v0=C0,O0.arg;O0.dispatchException(O0.arg)}else O0.method==="return"&&O0.abrupt("return",O0.arg);if(v0=M0,(R0=i0(A0,P0,O0)).type==="normal"){if(v0=O0.done?C0:L0,R0.arg===U0)continue;return{value:R0.arg,done:O0.done}}R0.type==="throw"&&(v0=C0,O0.method="throw",O0.arg=R0.arg)}}}(k0,$0,N0),D0}function i0(k0,D0,$0){try{return{type:"normal",arg:k0.call(D0,$0)}}catch(N0){return{type:"throw",arg:N0}}}function o0(){}function s0(){}function a0(){}function c0(k0){["next","throw","return"].forEach(function(D0){n0(k0,D0,function($0){return this._invoke(D0,$0)})})}function u0(k0,D0){function $0(A0,P0,O0,v0){if((A0=i0(k0[A0],k0,P0)).type!=="throw"){var R0=A0.arg;return(A0=R0.value)&&X(A0)==="object"&&_0.call(A0,"__await")?D0.resolve(A0.__await).then(function(T0){$0("next",T0,O0,v0)},function(T0){$0("throw",T0,O0,v0)}):D0.resolve(A0).then(function(T0){R0.value=T0,O0(R0)},function(T0){return $0("throw",T0,O0,v0)})}v0(A0.arg)}var N0;this._invoke=function(A0,P0){function O0(){return new D0(function(v0,R0){$0(A0,P0,v0,R0)})}return N0=N0?N0.then(O0,O0):O0()}}function l0(k0,D0){var $0=k0.iterator[D0.method];if($0===g0){if(D0.delegate=null,D0.method==="throw"){if(k0.iterator.return&&(D0.method="return",D0.arg=g0,l0(k0,D0),D0.method==="throw"))return U0;D0.method="throw",D0.arg=new TypeError("The iterator does not provide a 'throw' method")}return U0}return($0=i0($0,k0.iterator,D0.arg)).type==="throw"?(D0.method="throw",D0.arg=$0.arg,D0.delegate=null,U0):($0=$0.arg)?$0.done?(D0[k0.resultName]=$0.value,D0.next=k0.nextLoc,D0.method!=="return"&&(D0.method="next",D0.arg=g0),D0.delegate=null,U0):$0:(D0.method="throw",D0.arg=new TypeError("iterator result is not an object"),D0.delegate=null,U0)}function d0(k0){var D0={tryLoc:k0[0]};1 in k0&&(D0.catchLoc=k0[1]),2 in k0&&(D0.finallyLoc=k0[2],D0.afterLoc=k0[3]),this.tryEntries.push(D0)}function h0(k0){var D0=k0.completion||{};D0.type="normal",delete D0.arg,k0.completion=D0}function p0(k0){this.tryEntries=[{tryLoc:"root"}],k0.forEach(d0,this),this.reset(!0)}function m0(k0){if(k0){var D0=k0[b0];if(D0)return D0.call(k0);if(typeof k0.next=="function")return k0;if(!isNaN(k0.length)){var $0=-1;return(D0=function N0(){for(;++$0<k0.length;)if(_0.call(k0,$0))return N0.value=k0[$0],N0.done=!1,N0;return N0.value=g0,N0.done=!0,N0}).next=D0}}return{next:f0}}function f0(){return{value:g0,done:!0}}var g0,E0=Object.prototype,_0=E0.hasOwnProperty,y0=typeof Symbol=="function"?Symbol:{},b0=y0.iterator||"@@iterator",S0=y0.asyncIterator||"@@asyncIterator",w0=y0.toStringTag||"@@toStringTag";try{n0({},"")}catch{n0=function(D0,$0,N0){return D0[$0]=N0}}e0.wrap=r0;var I0="suspendedStart",L0="suspendedYield",M0="executing",C0="completed",U0={};n0(y0={},b0,function(){return this});var x0=Object.getPrototypeOf;(x0=x0&&x0(x0(m0([]))))&&x0!==E0&&_0.call(x0,b0)&&(y0=x0);var j0=a0.prototype=o0.prototype=Object.create(y0);return s0.prototype=a0,n0(j0,"constructor",a0),n0(a0,"constructor",s0),s0.displayName=n0(a0,w0,"GeneratorFunction"),e0.isGeneratorFunction=function(k0){return!!(k0=typeof k0=="function"&&k0.constructor)&&(k0===s0||(k0.displayName||k0.name)==="GeneratorFunction")},e0.mark=function(k0){return Object.setPrototypeOf?Object.setPrototypeOf(k0,a0):(k0.__proto__=a0,n0(k0,w0,"GeneratorFunction")),k0.prototype=Object.create(j0),k0},e0.awrap=function(k0){return{__await:k0}},c0(u0.prototype),n0(u0.prototype,S0,function(){return this}),e0.AsyncIterator=u0,e0.async=function(k0,D0,$0,N0,A0){A0===void 0&&(A0=Promise);var P0=new u0(r0(k0,D0,$0,N0),A0);return e0.isGeneratorFunction(D0)?P0:P0.next().then(function(O0){return O0.done?O0.value:P0.next()})},c0(j0),n0(j0,w0,"Generator"),n0(j0,b0,function(){return this}),n0(j0,"toString",function(){return"[object Generator]"}),e0.keys=function(k0){var D0,$0=[];for(D0 in k0)$0.push(D0);return $0.reverse(),function N0(){for(;$0.length;){var A0=$0.pop();if(A0 in k0)return N0.value=A0,N0.done=!1,N0}return N0.done=!0,N0}},e0.values=m0,p0.prototype={constructor:p0,reset:function(k0){if(this.next=this.prev=0,this.sent=this._sent=g0,this.done=!1,this.delegate=null,this.method="next",this.arg=g0,this.tryEntries.forEach(h0),!k0)for(var D0 in this)D0.charAt(0)==="t"&&_0.call(this,D0)&&!isNaN(+D0.slice(1))&&(this[D0]=g0)},stop:function(){this.done=!0;var k0=this.tryEntries[0].completion;if(k0.type==="throw")throw k0.arg;return this.rval},dispatchException:function(k0){function D0(R0,T0){return P0.type="throw",P0.arg=k0,$0.next=R0,T0&&($0.method="next",$0.arg=g0),!!T0}if(this.done)throw k0;for(var $0=this,N0=this.tryEntries.length-1;0<=N0;--N0){var A0=this.tryEntries[N0],P0=A0.completion;if(A0.tryLoc==="root")return D0("end");if(A0.tryLoc<=this.prev){var O0=_0.call(A0,"catchLoc"),v0=_0.call(A0,"finallyLoc");if(O0&&v0){if(this.prev<A0.catchLoc)return D0(A0.catchLoc,!0);if(this.prev<A0.finallyLoc)return D0(A0.finallyLoc)}else if(O0){if(this.prev<A0.catchLoc)return D0(A0.catchLoc,!0)}else{if(!v0)throw Error("try statement without catch or finally");if(this.prev<A0.finallyLoc)return D0(A0.finallyLoc)}}}},abrupt:function(k0,D0){for(var $0=this.tryEntries.length-1;0<=$0;--$0){var N0=this.tryEntries[$0];if(N0.tryLoc<=this.prev&&_0.call(N0,"finallyLoc")&&this.prev<N0.finallyLoc){var A0=N0;break}}return A0&&(k0==="break"||k0==="continue")&&A0.tryLoc<=D0&&D0<=A0.finallyLoc&&(A0=null),($0=A0?A0.completion:{}).type=k0,$0.arg=D0,A0?(this.method="next",this.next=A0.finallyLoc,U0):this.complete($0)},complete:function(k0,D0){if(k0.type==="throw")throw k0.arg;return k0.type==="break"||k0.type==="continue"?this.next=k0.arg:k0.type==="return"?(this.rval=this.arg=k0.arg,this.method="return",this.next="end"):k0.type==="normal"&&D0&&(this.next=D0),U0},finish:function(k0){for(var D0=this.tryEntries.length-1;0<=D0;--D0){var $0=this.tryEntries[D0];if($0.finallyLoc===k0)return this.complete($0.completion,$0.afterLoc),h0($0),U0}},catch:function(k0){for(var D0=this.tryEntries.length-1;0<=D0;--D0){var $0=this.tryEntries[D0];if($0.tryLoc===k0){if((k0=$0.completion).type==="throw"){var N0=k0.arg;h0($0)}return N0}}throw Error("illegal catch attempt")},delegateYield:function(k0,D0,$0){return this.delegate={iterator:m0(k0),resultName:D0,nextLoc:$0},this.method==="next"&&(this.arg=g0),U0}},e0}(t0.exports);try{regeneratorRuntime=t0}catch{(typeof globalThis>"u"?"undefined":X(globalThis))==="object"?globalThis.regeneratorRuntime=t0:Function("r","regeneratorRuntime = r")(t0)}}),yp=!R(function(){return Object.isExtensible(Object.preventExtensions({}))}),fk=$a(function(t0){var e0=Ra.f,n0=Ae("meta"),r0=0,i0=Object.isExtensible||function(){return!0},o0=function(a0){e0(a0,n0,{value:{objectID:"O"+ ++r0,weakData:{}}})},s0=t0.exports={REQUIRED:!1,fastKey:function(a0,c0){if(!ha(a0))return typeof a0=="symbol"?a0:(typeof a0=="string"?"S":"P")+a0;if(!Q(a0,n0)){if(!i0(a0))return"F";if(!c0)return"E";o0(a0)}return a0[n0].objectID},getWeakData:function(a0,c0){if(!Q(a0,n0)){if(!i0(a0))return!0;if(!c0)return!1;o0(a0)}return a0[n0].weakData},onFreeze:function(a0){return yp&&s0.REQUIRED&&i0(a0)&&!Q(a0,n0)&&o0(a0),a0}};Be[n0]=!0}),zp=function(t0,e0,n0){var r0=t0.indexOf("Map")!==-1,i0=t0.indexOf("Weak")!==-1,o0=r0?"set":"add",s0=y[t0],a0=s0&&s0.prototype,c0=s0,u0={},l0=function(g0){var E0=a0[g0];Ta(a0,g0,g0=="add"?function(_0){return E0.call(this,_0===0?0:_0),this}:g0=="delete"?function(_0){return!(i0&&!ha(_0))&&E0.call(this,_0===0?0:_0)}:g0=="get"?function(_0){return i0&&!ha(_0)?void 0:E0.call(this,_0===0?0:_0)}:g0=="has"?function(_0){return!(i0&&!ha(_0))&&E0.call(this,_0===0?0:_0)}:function(_0,y0){return E0.call(this,_0===0?0:_0,y0),this})};if(nc(t0,typeof s0!="function"||!(i0||a0.forEach&&!R(function(){new s0().entries().next()}))))c0=n0.getConstructor(e0,t0,r0,o0),fk.REQUIRED=!0;else if(nc(t0,!0)){var d0=new c0,h0=d0[o0](i0?{}:-0,1)!=d0,p0=R(function(){d0.has(1)}),m0=Tg(function(g0){new s0(g0)}),f0=!i0&&R(function(){for(var g0=new s0,E0=5;E0--;)g0[o0](E0,E0);return!g0.has(-0)});m0||((c0=e0(function(g0,E0){return Gc(g0,c0,t0),g0=lh(new s0,g0,c0),E0!=null&&Xg(E0,g0[o0],{that:g0,AS_ENTRIES:r0}),g0})).prototype=a0,a0.constructor=c0),(p0||f0)&&(l0("delete"),l0("has"),r0&&l0("get")),(f0||h0)&&l0(o0),i0&&a0.clear&&delete a0.clear}return u0[t0]=c0,N({global:!0,forced:c0!=s0},u0),Ec(c0,t0),i0||n0.setStrong(c0,t0,r0),c0},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(t0,e0,n0,r0){var i0=t0(function(c0,u0){Gc(c0,i0,e0),Bp(c0,{type:e0,index:ac(null),first:void 0,last:void 0,size:0}),ka||(c0.size=0),u0!=null&&Xg(u0,c0[r0],{that:c0,AS_ENTRIES:n0})}),o0=gk(e0),s0=function(c0,u0,l0){var d0,h0=o0(c0),p0=a0(c0,u0);return p0?p0.value=l0:(h0.last=p0={index:d0=Ap(u0,!0),key:u0,value:l0,previous:u0=h0.last,next:void 0,removed:!1},h0.first||(h0.first=p0),u0&&(u0.next=p0),ka?h0.size++:c0.size++,d0!=="F"&&(h0.index[d0]=p0)),c0},a0=function(c0,u0){c0=o0(c0);var l0=Ap(u0);if(l0!=="F")return c0.index[l0];for(c0=c0.first;c0;c0=c0.next)if(c0.key==u0)return c0};return Hf(i0.prototype,{clear:function(){for(var c0=o0(this),u0=c0.index,l0=c0.first;l0;)l0.removed=!0,l0.previous&&(l0.previous=l0.previous.next=void 0),delete u0[l0.index],l0=l0.next;c0.first=c0.last=void 0,ka?c0.size=0:this.size=0},delete:function(c0){var u0=o0(this);if(c0=a0(this,c0)){var l0=c0.next,d0=c0.previous;delete u0.index[c0.index],c0.removed=!0,d0&&(d0.next=l0),l0&&(l0.previous=d0),u0.first==c0&&(u0.first=l0),u0.last==c0&&(u0.last=d0),ka?u0.size--:this.size--}return!!c0},forEach:function(c0){for(var u0,l0=o0(this),d0=Id(c0,1<arguments.length?arguments[1]:void 0,3);u0=u0?u0.next:l0.first;)for(d0(u0.value,u0.key,this);u0&&u0.removed;)u0=u0.previous},has:function(c0){return!!a0(this,c0)}}),Hf(i0.prototype,n0?{get:function(c0){return(c0=a0(this,c0))&&c0.value},set:function(c0,u0){return s0(this,c0===0?0:c0,u0)}}:{add:function(c0){return s0(this,c0=c0===0?0:c0,c0)}}),ka&&gx(i0.prototype,"size",{get:function(){return o0(this).size}}),i0},setStrong:function(t0,e0,n0){var r0=e0+" Iterator",i0=gk(e0),o0=gk(r0);bj(t0,e0,function(s0,a0){Bp(this,{type:r0,target:s0,state:i0(s0),kind:a0,last:void 0})},function(){for(var s0=o0(this),a0=s0.kind,c0=s0.last;c0&&c0.removed;)c0=c0.previous;return s0.target&&(s0.last=c0=c0?c0.next:s0.state.first)?a0=="keys"?{value:c0.key,done:!1}:a0=="values"?{value:c0.value,done:!1}:{value:[c0.key,c0.value],done:!1}:(s0.target=void 0,{value:void 0,done:!0})},n0?"entries":"values",!n0,!0),If(e0)}};zp("Set",function(t0){return function(){return t0(this,arguments.length?arguments[0]:void 0)}},Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(t0){return function(e0){return e0=String(jb(e0)),1&t0&&(e0=e0.replace(hx,"")),2&t0&&(e0=e0.replace(ix,"")),e0}};hk(1),hk(2);var ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=sh(`	
\v\f\r \u2028\u2029\uFEFF08`)!==8||sh(`	
\v\f\r \u2028\u2029\uFEFF0x16`)!==22?function(t0,e0){return t0=ik(String(t0)),sh(t0,e0>>>0||(jx.test(t0)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx=Zb(ac(th))=="Number",Ep=function(t0){var e0,n0=lc(t0,!1);if(typeof n0=="string"&&2<n0.length){if((t0=(n0=ik(n0)).charCodeAt(0))===43||t0===45){if((t0=n0.charCodeAt(2))===88||t0===120)return NaN}else if(t0===48){switch(n0.charCodeAt(1)){case 66:case 98:t0=2;var r0=49;break;case 79:case 111:t0=8,r0=55;break;default:return+n0}var i0=(n0=n0.slice(2)).length;for(e0=0;e0<i0;e0++){var o0=n0.charCodeAt(e0);if(48>o0||o0>r0)return NaN}return parseInt(n0,t0)}}return+n0};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(t0){var e0=1>arguments.length?0:t0,n0=this;return n0 instanceof Pd&&(nx?R(function(){th.valueOf.call(n0)}):Zb(n0)!="Number")?lh(new pd(Ep(e0)),n0,Pd):Ep(e0)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R(function(){var t0=[];return t0[Gp]=!1,t0.concat()[0]!==t0}),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(t0){var e0,n0=Qa(this),r0=Sg(n0,0),i0=0,o0=-1;for(e0=arguments.length;o0<e0;o0++){var s0=o0===-1?n0:arguments[o0],a0=s0;if(ha(a0)){var c0=a0[Gp];a0=c0!==void 0?!!c0:gd(a0)}else a0=!1;if(a0){if(9007199254740991<i0+(c0=ta(s0.length)))throw TypeError("Maximum allowed index exceeded");for(a0=0;a0<c0;a0++,i0++)a0 in s0&&Ge(r0,i0,s0[a0])}else{if(9007199254740991<=i0)throw TypeError("Maximum allowed index exceeded");Ge(r0,i0++,s0)}}return r0.length=i0,r0}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R(function(){kk(function(){})});N({target:"Reflect",stat:!0,forced:rx},{apply:function(t0,e0,n0){return yb(t0),va(n0),kk?kk(t0,e0,n0):qx.call(t0,e0,n0)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R(function(){return!Object.getOwnPropertyNames(1)});N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe=(typeof Reflect>"u"?"undefined":X(Reflect))==="object"?Reflect:null,Hp=Pe&&typeof Pe.apply=="function"?Pe.apply:function(t0,e0,n0){return Function.prototype.apply.call(t0,e0,n0)},ux=Pe&&typeof Pe.ownKeys=="function"?Pe.ownKeys:Object.getOwnPropertySymbols?function(t0){return Object.getOwnPropertyNames(t0).concat(Object.getOwnPropertySymbols(t0))}:function(t0){return Object.getOwnPropertyNames(t0)},Ip=Number.isNaN||function(t0){return t0!=t0};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(t0){if(typeof t0!="number"||0>t0||Ip(t0))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t0+".");Jp=t0}}),ea.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(t0){if(typeof t0!="number"||0>t0||Ip(t0))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t0+".");return this._maxListeners=t0,this},ea.prototype.getMaxListeners=function(){return this._maxListeners===void 0?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(t0){for(var e0=[],n0=1;n0<arguments.length;n0++)e0.push(arguments[n0]);n0=t0==="error";var r0=this._events;if(r0!==void 0)n0=n0&&r0.error===void 0;else if(!n0)return!1;if(n0){var i0;throw 0<e0.length&&(i0=e0[0]),i0 instanceof Error?i0:((e0=Error("Unhandled error."+(i0?" ("+i0.message+")":""))).context=i0,e0)}if((n0=r0[t0])===void 0)return!1;if(typeof n0=="function")Hp(n0,this,e0);else for(r0=Cl(n0,i0=n0.length),n0=0;n0<i0;++n0)Hp(r0[n0],this,e0);return!0},ea.prototype.addListener=function(t0,e0){return zl(this,t0,e0,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(t0,e0){return zl(this,t0,e0,!0)},ea.prototype.once=function(t0,e0){return ng(e0),this.on(t0,Al(this,t0,e0)),this},ea.prototype.prependOnceListener=function(t0,e0){return ng(e0),this.prependListener(t0,Al(this,t0,e0)),this},ea.prototype.removeListener=function(t0,e0){var n0;ng(e0);var r0=this._events;if(r0===void 0)return this;var i0=r0[t0];if(i0===void 0)return this;if(i0===e0||i0.listener===e0)--this._eventsCount==0?this._events=Object.create(null):(delete r0[t0],r0.removeListener&&this.emit("removeListener",t0,i0.listener||e0));else if(typeof i0!="function"){var o0=-1;for(n0=i0.length-1;0<=n0;n0--)if(i0[n0]===e0||i0[n0].listener===e0){var s0=i0[n0].listener;o0=n0;break}if(0>o0)return this;if(o0===0)i0.shift();else{for(;o0+1<i0.length;o0++)i0[o0]=i0[o0+1];i0.pop()}i0.length===1&&(r0[t0]=i0[0]),r0.removeListener!==void 0&&this.emit("removeListener",t0,s0||e0)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(t0){var e0=this._events;if(e0===void 0)return this;if(e0.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):e0[t0]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete e0[t0]),this;if(arguments.length===0){var n0=Object.keys(e0);for(e0=0;e0<n0.length;++e0){var r0=n0[e0];r0!=="removeListener"&&this.removeAllListeners(r0)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(n0=e0[t0])=="function")this.removeListener(t0,n0);else if(n0!==void 0)for(e0=n0.length-1;0<=e0;e0--)this.removeListener(t0,n0[e0]);return this},ea.prototype.listeners=function(t0){return Bl(this,t0,!0)},ea.prototype.rawListeners=function(t0){return Bl(this,t0,!1)},ea.listenerCount=function(t0,e0){return typeof t0.listenerCount=="function"?t0.listenerCount(e0):Dl.call(t0,e0)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(t0,e0){return new Promise(function(n0,r0){function i0(s0){t0.removeListener(e0,o0),r0(s0)}function o0(){typeof t0.removeListener=="function"&&t0.removeListener("error",i0),n0([].slice.call(arguments))}El(t0,e0,o0,{once:!0}),e0!=="error"&&vs(t0,i0,{once:!0})})};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R(function(){if(ka&&Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t0={},e0={},n0=Symbol();return t0[n0]=7,"abcdefghijklmnopqrst".split("").forEach(function(r0){e0[r0]=r0}),Qe({},t0)[n0]!=7||Dc(Qe({},e0)).join("")!="abcdefghijklmnopqrst"})?function(t0,e0){for(var n0=Qa(t0),r0=arguments.length,i0=1,o0=Bf.f,s0=zf;r0>i0;)for(var a0,c0=Af(arguments[i0++]),u0=o0?Dc(c0).concat(o0(c0)):Dc(c0),l0=u0.length,d0=0;l0>d0;)a0=u0[d0++],(!ka||s0.call(c0,a0))&&(n0[a0]=c0[a0]);return n0}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",function(t0){return function(){return t0(this,arguments.length?arguments[0]:void 0)}},Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(t0){return vx(t0)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R(function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||sc(Wf,"i")!="/a/i"}))){for(var Oc=function(t0,e0){var n0,r0=this instanceof Oc,i0=Lj(t0),o0=e0===void 0;return!r0&&i0&&t0.constructor===Oc&&o0||(nk?i0&&!o0&&(t0=t0.source):t0 instanceof Oc&&(o0&&(e0=tj.call(t0)),t0=t0.source),pc&&(n0=!!e0&&-1<e0.indexOf("y"))&&(e0=e0.replace(/y/g,"")),t0=lh(nk?new sc(t0,e0):sc(t0,e0),r0?this:lk,Oc),pc&&n0&&(zx(t0).sticky=!0)),t0},Bx=function(t0){t0 in Oc||xx(Oc,t0,{configurable:!0,get:function(){return sc[t0]},set:function(e0){sc[t0]=e0}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",function(t0){return function(e0,n0,r0){return t0(this,e0,n0,r0)}}),Sf("Float64",function(t0){return function(e0,n0,r0){return t0(this,e0,n0,r0)}}),Sf("Uint32",function(t0){return function(e0,n0,r0){return t0(this,e0,n0,r0)}}),Sf("Uint16",function(t0){return function(e0,n0,r0){return t0(this,e0,n0,r0)}});var ok=function(t0,e0){return t0===e0?0:t0==null?e0==null?0:-1:e0==null?t0==null?0:1:typeof t0.compare=="function"?t0.compare(e0):typeof e0.compare=="function"?-e0.compare(t0):t0<e0?-1:t0>e0?1:0},pk=[],Op=pk.sort,Cx=R(function(){pk.sort(void 0)}),Dx=R(function(){pk.sort(null)}),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(t0){return t0===void 0?Op.call(Qa(this)):Op.call(Qa(this),yb(t0))}});var Pp=Object.getPrototypeOf({}),Xf=function(t0,e0){var n0;return t0===e0||(t0==null?t0==e0:X(t0.equiv)==="function"?t0.equiv(e0):e0==null?t0==e0:X(e0.equiv)==="function"?e0.equiv(t0):X(t0)!=="string"&&X(e0)!=="string"&&((n0=Object.getPrototypeOf(t0))!=null&&n0!==Pp||(n0=Object.getPrototypeOf(e0))!=null&&n0!==Pp?X(t0)!=="function"&&t0.length!==void 0&&X(e0)!=="function"&&e0.length!==void 0?Gx(t0,e0):t0 instanceof Set&&e0 instanceof Set?Hx(t0,e0):t0 instanceof Map&&e0 instanceof Map?Ix(t0,e0):t0 instanceof Date&&e0 instanceof Date?t0.getTime()===e0.getTime():t0 instanceof RegExp&&e0 instanceof RegExp?t0.toString()===e0.toString():t0!=t0&&e0!=e0:Fx(t0,e0)))},Gx=function(t0,e0){var n0=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf,r0=t0.length;if(r0===e0.length)for(;0<=--r0&&n0(t0[r0],e0[r0]););return 0>r0},Hx=function(t0,e0){var n0=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return t0.size===e0.size&&n0(G(t0.keys()).sort(),G(e0.keys()).sort())},Ix=function(t0,e0){var n0=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return t0.size===e0.size&&n0(G(t0).sort(),G(e0).sort())},Fx=function(t0,e0){var n0=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;if(Object.keys(t0).length!==Object.keys(e0).length)return!1;for(var r0 in t0)if(!e0.hasOwnProperty(r0)||!n0(t0[r0],e0[r0]))return!1;return!0},Qp=function(t0){var e0=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(n0){return n0!==void 0?": "+n0:""};return function(n0){function r0(o0){return W(this,r0),i0.call(this,t0(o0)+e0(o0))}la(r0,n0);var i0=ma(r0);return r0}(ef(Error))},Jx=Qp(function(){return"illegal argument(s)"}),vh=function(t0){throw new Jx(t0)},qk=Qp(function(){return"index out of bounds"}),Rp=1/4294967295,Kx=function(){function t0(){W(this,t0)}return Ha(t0,[{key:"float",value:function(){var e0=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*Rp*e0}},{key:"norm",value:function(){var e0=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*Rp-.5)*e0}},{key:"minmax",value:function(e0,n0){return this.float()*(n0-e0)+e0}}]),t0}(),rk=Math.random,Lx=new(function(t0){function e0(){return W(this,e0),n0.apply(this,arguments)}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var r0=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return rk()*r0}},{key:"norm",value:function(){var r0=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(rk()-.5)*r0}}]),e0}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R(function(){sk(1)});N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(t0){return sk&&ha(t0)?sk(Mx(t0)):t0}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(t0){return Wo(this,t0,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(t0){return t0!=null&&typeof t0.xform=="function"?t0.xform():t0},og=function(){function t0(e0){W(this,t0),this.value=e0}return Ha(t0,[{key:"deref",value:function(){return this.value}}]),t0}(),Wh=function(t0){return t0 instanceof og?t0.deref():t0},xs=function(t0,e0){return[t0,function(n0){return n0},e0]},Qx=w.mark(function(t0,e0){var n0,r0,i0,o0,s0,a0;return w.wrap(function(c0){for(;;)switch(c0.prev=c0.next){case 0:n0=Gl(t0)(ws()),r0=n0[1],i0=n0[2],o0=0;case 4:if(!(o0<e0.length)){c0.next=15;break}if(s0=e0[o0],!((a0=i0([],s0))instanceof og)){c0.next=10;break}return c0.delegateYield(Wh(r0(a0.deref())),"t0",9);case 9:return c0.abrupt("return");case 10:if(!a0.length){c0.next=12;break}return c0.delegateYield(a0,"t1",12);case 12:o0++,c0.next=4;break;case 15:return c0.delegateYield(Wh(r0([])),"t2",16);case 16:case"end":return c0.stop()}},Qx)}),ys=w.mark(Fl),zs=function(t0,e0){return[t0[0],t0[1],e0]},Sp=!0;"findIndex"in[]&&Array(1).findIndex(function(){Sp=!1}),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(t0){return An(this,t0,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function t0(e0){W(this,t0),this._length=0,e0&&this.into(e0)}return Ha(t0,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new t0(this)}},{key:"empty",value:function(){return new t0}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var e0,n0=this.head;n0;)e0=n0.next,delete n0.value,delete n0.prev,delete n0.next,n0=e0;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(e0){var n0=this._length;if(n0<e0._length)return-1;if(n0>e0._length)return 1;if(n0===0)return 0;n0=this.head,e0=e0.head;for(var r0=0;n0&&r0==0;)r0=ok(n0.value,e0.value),n0=n0.next,e0=e0.next;return r0}},{key:"equiv",value:function(e0){if(!(e0 instanceof t0||e0!=null&&typeof e0!="function"&&e0.length!==void 0)||this._length!==e0.length)return!1;if(!this._length||this===e0)return!0;for(var n0=this.head,r0=0;r0<e0.length;r0++){if(!Xf(n0.value,e0[r0]))return!1;n0=n0.next}return!0}},{key:Symbol.iterator,value:w.mark(function e0(){var n0;return w.wrap(function(r0){for(;;)switch(r0.prev=r0.next){case 0:n0=this.head;case 1:if(!n0){r0.next=7;break}return r0.next=4,n0.value;case 4:n0=n0.next,r0.next=1;break;case 7:case"end":return r0.stop()}},e0,this)})},{key:"seq",value:function(){var e0=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,n0=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(e0>=n0||0>e0)){e0=this.nthCell(e0);var r0=this.nthCell(n0-1);return n0=function i0(o0){return{first:function(){return o0.value},next:function(){return o0!==r0&&o0.next?i0(o0.next):void 0}}},e0?n0(e0):void 0}}},{key:"cycle",value:w.mark(function e0(){return w.wrap(function(n0){for(;;)switch(n0.prev=n0.next){case 0:return n0.delegateYield(this,"t0",2);case 2:n0.next=0;break;case 4:case"end":return n0.stop()}},e0,this)})},{key:"$reduce",value:function(e0,n0){for(var r0=this.head;r0&&!(n0 instanceof og);)n0=e0(n0,r0.value),r0=r0.next;return n0}},{key:"drop",value:function(){var e0=this.head;if(e0)return(this.head=e0.next)?delete this.head.prev:delete this.tail,this._length--,e0.value}},{key:"cons",value:function(e0){return e0={value:e0,next:this.head},this.head?this.head.prev=e0:this.tail=e0,this.head=e0,this._length++,this}},{key:"insertBefore",value:function(e0,n0){return e0||vh("cell is undefined"),n0={value:n0,next:e0,prev:e0.prev},e0.prev?e0.prev.next=n0:this.head=n0,e0.prev=n0,this._length++,this}},{key:"insertAfter",value:function(e0,n0){return e0||vh("cell is undefined"),n0={value:n0,next:e0.next,prev:e0},e0.next?e0.next.prev=n0:this.tail=n0,e0.next=n0,this._length++,this}},{key:"insertBeforeNth",value:function(e0,n0){if(0>e0&&(e0+=this._length),0>=e0)return this.cons(n0);if(0>e0||e0>=this._length)throw new qk(e0);return this.insertBefore(this.nthCellUnsafe(e0),n0)}},{key:"insertAfterNth",value:function(e0,n0){if(0>e0&&(e0+=this._length),e0>=this._length-1)return this.push(n0);if(0>e0||e0>=this._length)throw new qk(e0);return this.insertAfter(this.nthCellUnsafe(e0),n0)}},{key:"insertSorted",value:function(e0,n0){n0=n0||ok;for(var r0=this.head;r0;){if(0>=n0(e0,r0.value))return this.insertBefore(r0,e0);r0=r0.next}return this.push(e0)}},{key:"find",value:function(e0){for(var n0=this.head;n0;){if(n0.value===e0)return n0;n0=n0.next}}},{key:"findWith",value:function(e0){for(var n0=this.head;n0;){if(e0(n0.value))return n0;n0=n0.next}}},{key:"concat",value:function(){for(var e0=this.copy(),n0=arguments.length,r0=Array(n0),i0=0;i0<n0;i0++)r0[i0]=arguments[i0];for(n0=0;n0<r0.length;n0++)e0.into(r0[n0]);return e0}},{key:"into",value:function(e0){for(var n0=0;n0<e0.length;n0++)this.push(e0[n0])}},{key:"slice",value:function(){var e0=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,n0=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;e0=0>e0?e0+this._length:e0,n0=0>n0?n0+this._length:n0,(0>e0||0>n0)&&vh("invalid indices: ${from} / ${to}");for(var r0=new t0,i0=this.nthCell(e0);i0&&++e0<=n0;)r0.push(i0.value),i0=i0.next;return r0}},{key:"splice",value:function(e0){var n0=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,r0=2<arguments.length?arguments[2]:void 0;if(typeof e0=="number"){if(0>e0&&(e0+=this._length),0>e0||e0>=this._length)throw new qk(e0);var i0=this.nthCellUnsafe(e0)}else i0=e0;var o0=new t0;if(0<n0)for(;i0&&0<n0--;)this.remove(i0),o0.push(i0.value),i0=i0.next;else i0&&(i0=i0.next);if(r0)if(i0)for(n0=0;n0<r0.length;n0++)this.insertBefore(i0,r0[n0]);else for(i0=0;i0<r0.length;i0++)this.push(r0[i0]);return o0}},{key:"remove",value:function(e0){return e0.prev?e0.prev.next=e0.next:this.head=e0.next,e0.next?e0.next.prev=e0.prev:this.tail=e0.prev,this._length--,this}},{key:"swap",value:function(e0,n0){if(e0!==n0){var r0=e0.value;e0.value=n0.value,n0.value=r0}return this}},{key:"push",value:function(e0){return this.tail?(e0={value:e0,prev:this.tail},this.tail=this.tail.next=e0,this._length++,this):this.cons(e0)}},{key:"pop",value:function(){var e0=this.tail;if(e0)return(this.tail=e0.prev)?delete this.tail.next:delete this.head,this._length--,e0.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(e0){return this.head?(this.head.value=e0,this):this.cons(e0)}},{key:"setTail",value:function(e0){return this.tail?(this.tail.value=e0,this):this.push(e0)}},{key:"setNth",value:function(e0,n0){var r0=this.nthCell(e0);return!r0&&vh("index out of bounds: ".concat(e0)),r0.value=n0,this}},{key:"nth",value:function(e0,n0){return(e0=this.nthCell(e0))?e0.value:n0}},{key:"nthCell",value:function(e0){if(0>e0&&(e0+=this._length),!(0>e0||e0>=this._length))return this.nthCellUnsafe(e0)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var e0=this.peek();return this.pop(),this.cons(e0)}}},{key:"map",value:function(e0){for(var n0=new t0,r0=this.head;r0;)n0.push(e0(r0.value)),r0=r0.next;return n0}},{key:"filter",value:function(e0){for(var n0=new t0,r0=this.head;r0;)e0(r0.value)&&n0.push(r0.value),r0=r0.next;return n0}},{key:"reduce",value:function(e0,n0){for(var r0=this.head;r0;)n0=e0(n0,r0.value),r0=r0.next;return n0}},{key:"shuffle",value:function(e0){var n0=1<arguments.length&&arguments[1]!==void 0?arguments[1]:Lx;if(2>this._length)return this;for(e0=e0??Math.ceil(1.5*Math.log2(this._length));0<e0;e0--)for(var r0=this.head;r0;){var i0=r0.next;.5>n0.float()?this.asHead(r0):this.asTail(r0),r0=i0}return this}},{key:"sort",value:function(){var e0=0<arguments.length&&arguments[0]!==void 0?arguments[0]:ok;if(!this._length)return this;for(var n0=1;;){var r0=this.head;this.tail=this.head=void 0;for(var i0=0;r0;){i0++;for(var o0=r0,s0=0,a0=0;a0<n0&&(s0++,o0=o0.next);a0++);for(a0=n0;0<s0||0<a0&&o0;){if(s0===0){var c0=o0;o0=o0.next,a0--}else o0&&a0!==0?0>=e0(r0.value,o0.value)?(c0=r0,r0=r0.next,s0--):(c0=o0,o0=o0.next,a0--):(c0=r0,r0=r0.next,s0--);this.tail?this.tail.next=c0:this.head=c0,c0.prev=this.tail,this.tail=c0}r0=o0}if(this.tail.next=void 0,1>=i0)return this;n0*=2}}},{key:"reverse",value:function(){for(var e0=this.head,n0=this.tail,r0=(this._length>>>1)+(1&this._length);e0&&n0&&0<r0;){var i0=e0.value;e0.value=n0.value,n0.value=i0,e0=e0.next,n0=n0.prev,r0--}return this}},{key:"asHead",value:function(e0){return e0===this.head||(this.remove(e0),this.head.prev=e0,e0.next=this.head,e0.prev=void 0,this.head=e0,this._length++),this}},{key:"asTail",value:function(e0){return e0===this.tail||(this.remove(e0),this.tail.next=e0,e0.prev=this.tail,e0.next=void 0,this.tail=e0,this._length++),this}},{key:"toString",value:function(){for(var e0=[],n0=this.head;n0;)e0.push(String(n0.value)),n0=n0.next;return e0.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(e0){if(e0<=this._length>>1)var n0=this.head,r0="next";else n0=this.tail,r0="prev",e0=this._length-e0-1;for(;0<e0--&&n0;)n0=n0[r0];return n0}}]),t0}(),tc=function(){function t0(e0,n0){W(this,t0),n0=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},n0),this.map=n0.map(),this.items=new Rx,this._size=0,this.opts=n0,e0&&this.into(e0)}return Ha(t0,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg(function(e0){return[e0.k,e0]},this.items)}},{key:"keys",value:function(){return pg(function(e0){return e0.k},this.items)}},{key:"values",value:function(){return pg(function(e0){return e0.v},this.items)}},{key:"copy",value:function(){var e0=this.empty();e0.items=this.items.copy();for(var n0=e0.items.head;n0;)e0.map.set(n0.value.k,n0),n0=n0.next;return e0}},{key:"empty",value:function(){return new t0(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var e0=this.opts.release;if(e0){for(var n0;n0=this.items.drop();)e0(n0.k,n0.v);return!0}return this.items.release()}},{key:"has",value:function(e0){return this.map.has(e0)}},{key:"get",value:function(e0,n0){return(e0=this.map.get(e0))?this.resetEntry(e0):n0}},{key:"set",value:function(e0,n0){var r0=this.opts.ksize(e0)+this.opts.vsize(n0),i0=this.map.get(e0);return this._size+=Math.max(0,r0-(i0?i0.value.s:0)),this.ensureSize()&&this.doSetEntry(i0,e0,n0,r0),n0}},{key:"into",value:function(e0){for(var n0=0;n0<e0.length;n0++){var r0=e0[n0];this.set(r0[0],r0[1])}return this}},{key:"getSet",value:function(e0,n0){var r0=this,i0=this.map.get(e0);return i0?Promise.resolve(this.resetEntry(i0)):n0().then(function(o0){return r0.set(e0,o0)})}},{key:"delete",value:function(e0){return!!(e0=this.map.get(e0))&&(this.removeEntry(e0),!0)}},{key:"resetEntry",value:function(e0){return this.items.asTail(e0),e0.value.v}},{key:"ensureSize",value:function(){for(var e0=this.opts.release,n0=this.opts.maxsize,r0=this.opts.maxlen;this._size>n0||this.length>=r0;){var i0=this.items.drop();if(!i0)return!1;this.map.delete(i0.k),e0&&e0(i0.k,i0.v),this._size-=i0.s}return!0}},{key:"removeEntry",value:function(e0){var n0=e0.value;this.map.delete(n0.k),this.items.remove(e0),this.opts.release&&this.opts.release(n0.k,n0.v),this._size-=n0.s}},{key:"doSetEntry",value:function(e0,n0,r0,i0){e0?(e0.value.v=r0,e0.value.s=i0,this.items.asTail(e0)):(this.items.push({k:n0,v:r0,s:i0}),this.map.set(n0,this.items.tail))}}]),t0}(),Sx=function(t0){function e0(r0,i0){return W(this,e0),i0=Object.assign({ttl:36e5},i0),n0.call(this,r0,i0)}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"empty",value:function(){return new e0(null,this.opts)}},{key:"has",value:function(r0){return this.get(r0)!==void 0}},{key:"get",value:function(r0,i0){if(r0=this.map.get(r0)){if(r0.value.t>=Date.now())return this.resetEntry(r0);this.removeEntry(r0)}return i0}},{key:"set",value:function(r0,i0){var o0=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,s0=this.opts.ksize(r0)+this.opts.vsize(i0),a0=this.map.get(r0);return this._size+=Math.max(0,s0-(a0?a0.value.s:0)),this.ensureSize()&&(o0=Date.now()+o0,a0?(a0.value.v=i0,a0.value.s=s0,a0.value.t=o0,this.items.asTail(a0)):(this.items.push({k:r0,v:i0,s:s0,t:o0}),this.map.set(r0,this.items.tail))),i0}},{key:"getSet",value:function(r0,i0){var o0=this,s0=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,a0=this.get(r0);return a0?Promise.resolve(a0):i0().then(function(c0){return o0.set(r0,c0,s0)})}},{key:"prune",value:function(){for(var r0=Date.now(),i0=this.items.head;i0;)i0.value.t<r0&&this.removeEntry(i0),i0=i0.next}},{key:"ensureSize",value:function(){for(var r0=this.opts.maxsize,i0=this.opts.maxlen,o0=Date.now(),s0=this.items.head;s0&&(this._size>r0||this.length>=i0);)s0.value.t<o0&&this.removeEntry(s0),s0=s0.next;return Th(wd(e0.prototype),"ensureSize",this).call(this)}}]),e0}(tc),Tp=X(Ya)=="object"&&Ya&&Ya.Object===Object&&Ya,Tx=(typeof self>"u"?"undefined":X(self))=="object"&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(t0){if(t0==null)t0=t0===void 0?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(t0)){var e0=Ux.call(t0,Yf),n0=t0[Yf];try{t0[Yf]=void 0;var r0=!0}catch{}var i0=Vx.call(t0);r0&&(e0?t0[Yf]=n0:delete t0[Yf]),t0=i0}else t0=Wx.call(t0);return t0},lb=function(t0){var e0=X(t0);return t0!=null&&(e0=="object"||e0=="function")},qi=function(t0){return!!lb(t0)&&((t0=Qd(t0))=="[object Function]"||t0=="[object GeneratorFunction]"||t0=="[object AsyncFunction]"||t0=="[object Proxy]")},tk=Cb["__core-js_shared__"],Wp=function(){var t0=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return t0?"Symbol(src)_1."+t0:""}(),Xx=Function.prototype.toString,Rd=function(t0){if(t0!=null){try{return Xx.call(t0)}catch{}return t0+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(t0,e0){return t0=t0==null?void 0:t0[e0],!lb(t0)||Wp&&Wp in t0||!(qi(t0)?Zx:Yx).test(Rd(t0))?void 0:t0},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(t0){return t0=this.has(t0)&&delete this.__data__[t0],this.size-=t0?1:0,t0},zd.prototype.get=function(t0){var e0=this.__data__;return Zf?(t0=e0[t0])==="__lodash_hash_undefined__"?void 0:t0:$x.call(e0,t0)?e0[t0]:void 0},zd.prototype.has=function(t0){var e0=this.__data__;return Zf?e0[t0]!==void 0:ay.call(e0,t0)},zd.prototype.set=function(t0,e0){var n0=this.__data__;return this.size+=this.has(t0)?0:1,n0[t0]=Zf&&e0===void 0?"__lodash_hash_undefined__":e0,this};var $f=function(t0,e0){return t0===e0||t0!=t0&&e0!=e0},wh=function(t0,e0){for(var n0=t0.length;n0--;)if($f(t0[n0][0],e0))return n0;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(t0){var e0=this.__data__;return!(0>(t0=wh(e0,t0)))&&(t0==e0.length-1?e0.pop():by.call(e0,t0,1),--this.size,!0)},ce.prototype.get=function(t0){var e0=this.__data__;return 0>(t0=wh(e0,t0))?void 0:e0[t0][1]},ce.prototype.has=function(t0){return-1<wh(this.__data__,t0)},ce.prototype.set=function(t0,e0){var n0=this.__data__,r0=wh(n0,t0);return 0>r0?(++this.size,n0.push([t0,e0])):n0[r0][1]=e0,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(t0,e0){t0=t0.__data__;var n0=X(e0);return(n0=="string"||n0=="number"||n0=="symbol"||n0=="boolean"?e0!=="__proto__":e0===null)?t0[typeof e0=="string"?"string":"hash"]:t0.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(t0){return t0=xh(this,t0).delete(t0),this.size-=t0?1:0,t0},de.prototype.get=function(t0){return xh(this,t0).get(t0)},de.prototype.has=function(t0){return xh(this,t0).has(t0)},de.prototype.set=function(t0,e0){var n0=xh(this,t0),r0=n0.size;return n0.set(t0,e0),this.size+=n0.size==r0?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(t0){return this.__data__.set(t0,"__lodash_hash_undefined__"),this},gf.prototype.has=function(t0){return this.__data__.has(t0)};var Xp=function(t0,e0,n0,r0){var i0=t0.length;for(n0+=r0?1:-1;r0?n0--:++n0<i0;)if(e0(t0[n0],n0,t0))return n0;return-1},cy=function(t0){return t0!=t0},dy=function(t0,e0){var n0;if(n0=!(t0==null||!t0.length)){if(e0==e0)t:{n0=-1;for(var r0=t0.length;++n0<r0;)if(t0[n0]===e0){t0=n0;break t}t0=-1}else t0=Xp(t0,cy,0);n0=-1<t0}return n0},ey=function(t0,e0,n0){for(var r0=-1,i0=t0==null?0:t0.length;++r0<i0;)if(n0(e0,t0[r0]))return!0;return!1},fy=function(t0,e0){return t0.has(e0)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(t0){var e0=-1,n0=Array(t0.size);return t0.forEach(function(r0){n0[++e0]=r0}),n0},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(t0){return new Re(t0)}:gy,vk=function(t0,e0,n0){var r0=-1,i0=dy,o0=t0.length,s0=!0,a0=[],c0=a0;if(n0)s0=!1,i0=ey;else if(200<=o0){if(i0=e0?null:iy(t0))return uk(i0);s0=!1,i0=fy,c0=new gf}else c0=e0?[]:a0;t:for(;++r0<o0;){var u0=t0[r0],l0=e0?e0(u0):u0;if(u0=n0||u0!==0?u0:0,s0&&l0==l0){for(var d0=c0.length;d0--;)if(c0[d0]===l0)continue t;e0&&c0.push(l0),a0.push(u0)}else i0(c0,l0,n0)||(c0!==a0&&c0.push(l0),a0.push(u0))}return a0},Yp=function(t0){for(var e0=-1,n0=t0==null?0:t0.length,r0={};++e0<n0;){var i0=t0[e0];r0[i0[0]]=i0[1]}return r0},he=function(t0,e0){for(var n0=-1,r0=t0==null?0:t0.length,i0=Array(r0);++n0<r0;)i0[n0]=e0(t0[n0],n0,t0);return i0};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(t0){var e0=this.__data__;return t0=e0.delete(t0),this.size=e0.size,t0},ee.prototype.get=function(t0){return this.__data__.get(t0)},ee.prototype.has=function(t0){return this.__data__.has(t0)},ee.prototype.set=function(t0,e0){var n0=this.__data__;if(n0 instanceof rg){var r0=n0.__data__;if(!ag||199>r0.length)return r0.push([t0,e0]),this.size=++n0.size,this;n0=this.__data__=new qg(r0)}return n0.set(t0,e0),this.size=n0.size,this};var ge=ee,Is=function(t0,e0){for(var n0=-1,r0=t0==null?0:t0.length;++n0<r0&&e0(t0[n0],n0,t0)!==!1;);return t0},yh=function(){try{var t0=Sd(Object,"defineProperty");return t0({},"",{}),t0}catch{}}(),bg=function(t0,e0,n0){e0=="__proto__"&&yh?yh(t0,e0,{configurable:!0,enumerable:!0,value:n0,writable:!0}):t0[e0]=n0},jy=Object.prototype.hasOwnProperty,Ml=function(t0,e0,n0){var r0=t0[e0];jy.call(t0,e0)&&$f(r0,n0)&&(n0!==void 0||e0 in t0)||bg(t0,e0,n0)},re=function(t0,e0,n0,r0){var i0=!n0;n0||(n0={});for(var o0=-1,s0=e0.length;++o0<s0;){var a0=e0[o0],c0=r0?r0(n0[a0],t0[a0],a0,n0,t0):void 0;c0===void 0&&(c0=t0[a0]),i0?bg(n0,a0,c0):Ml(n0,a0,c0)}return n0},gc=function(t0){return t0!=null&&X(t0)=="object"},Zp=function(t0){return gc(t0)&&Qd(t0)=="[object Arguments]"},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(t0){return gc(t0)&&ky.call(t0,"callee")&&!ly.call(t0,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a(function(t0,e0){var n0=(e0=e0&&!e0.nodeType&&e0)&&t0&&!t0.nodeType&&t0;e0=n0&&n0.exports===e0?Cb.Buffer:void 0,t0.exports=(e0?e0.isBuffer:void 0)||my}),ny=/^(?:0|[1-9]\d*)$/,wk=function(t0,e0){var n0=X(t0);return!!(e0=e0??9007199254740991)&&(n0=="number"||n0!="symbol"&&ny.test(t0))&&-1<t0&&t0%1==0&&t0<e0},xk=function(t0){return typeof t0=="number"&&-1<t0&&t0%1==0&&9007199254740991>=t0},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(t0){return gc(t0)&&xk(t0.length)&&!!Ea[Qd(t0)]},zh=function(t0){return function(e0){return t0(e0)}},Se=$a(function(t0,e0){var n0=e0&&!e0.nodeType&&e0;n0=(e0=n0&&t0&&!t0.nodeType&&t0)&&e0.exports===n0&&Tp.process;t:{try{var r0=e0&&e0.require&&e0.require("util").types;if(r0){var i0=r0;break t}i0=n0&&n0.binding&&n0.binding("util");break t}catch{}i0=void 0}t0.exports=i0}),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(t0,e0){var n0=Va(t0),r0=!n0&&rf(t0),i0=!n0&&!r0&&jf(t0),o0=!n0&&!r0&&!i0&&bi(t0);if(n0=n0||r0||i0||o0){r0=t0.length;for(var s0=String,a0=-1,c0=Array(r0);++a0<r0;)c0[a0]=s0(a0);r0=c0}else r0=[];for(var u0 in s0=r0.length,t0)!e0&&!py.call(t0,u0)||n0&&(u0=="length"||i0&&(u0=="offset"||u0=="parent")||o0&&(u0=="buffer"||u0=="byteLength"||u0=="byteOffset")||wk(u0,s0))||r0.push(u0);return r0},qy=Object.prototype,yk=function(t0){var e0=t0&&t0.constructor;return t0===(typeof e0=="function"&&e0.prototype||qy)},cq=function(t0,e0){return function(n0){return t0(e0(n0))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(t0){return t0!=null&&xk(t0.length)&&!qi(t0)},Ad=function(t0){if(Ed(t0))t0=bq(t0);else if(yk(t0)){var e0,n0=[];for(e0 in Object(t0))sy.call(t0,e0)&&e0!="constructor"&&n0.push(e0);t0=n0}else t0=ry(t0);return t0},Es=function(t0,e0){return t0&&re(e0,Ad(e0),t0)},ty=Object.prototype.hasOwnProperty,kf=function(t0){if(Ed(t0))t0=bq(t0,!0);else if(lb(t0)){var e0=yk(t0),n0=[];for(r0 in t0)(r0!="constructor"||!e0&&ty.call(t0,r0))&&n0.push(r0);t0=n0}else{var r0=[];if(t0!=null)for(e0 in Object(t0))r0.push(e0);t0=r0}return t0},Cs=function(t0,e0){return t0&&re(e0,kf(e0),t0)},Jl=$a(function(t0,e0){var n0=(e0=e0&&!e0.nodeType&&e0)&&t0&&!t0.nodeType&&t0,r0=(e0=n0&&n0.exports===e0?Cb.Buffer:void 0)?e0.allocUnsafe:void 0;t0.exports=function(i0,o0){return o0?i0.slice():(o0=i0.length,o0=r0?r0(o0):new i0.constructor(o0),i0.copy(o0),o0)}}),Xh=function(t0,e0){var n0=-1,r0=t0.length;for(e0||(e0=Array(r0));++n0<r0;)e0[n0]=t0[n0];return e0},uy=function(t0,e0){for(var n0=-1,r0=t0==null?0:t0.length,i0=0,o0=[];++n0<r0;){var s0=t0[n0];e0(s0,n0,t0)&&(o0[i0++]=s0)}return o0},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(t0){return t0==null?[]:(t0=Object(t0),uy(eq(t0),function(e0){return vy.call(t0,e0)}))}:dq,Ds=function(t0,e0){return re(t0,zk(t0),e0)},ai=function(t0,e0){for(var n0=-1,r0=e0.length,i0=t0.length;++n0<r0;)t0[i0+n0]=e0[n0];return t0},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(t0){for(var e0=[];t0;)ai(e0,zk(t0)),t0=Ak(t0);return e0}:dq,Bs=function(t0,e0){return re(t0,fq(t0),e0)},gq=function(t0,e0,n0){return e0=e0(t0),Va(t0)?e0:ai(e0,n0(t0))},Yh=function(t0){return gq(t0,Ad,zk)},Ll=function(t0){return gq(t0,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&Td(new Bk(new ArrayBuffer(1)))!="[object DataView]"||ag&&Td(new ag)!="[object Map]"||Ck&&Td(Ck.resolve())!="[object Promise]"||Re&&Td(new Re)!="[object Set]"||Dk&&Td(new Dk)!="[object WeakMap]")&&(Td=function(t0){var e0=Qd(t0);if(t0=(t0=e0=="[object Object]"?t0.constructor:void 0)?Rd(t0):"")switch(t0){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return e0});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(t0){var e0=t0.length,n0=new t0.constructor(e0);return e0&&typeof t0[0]=="string"&&By.call(t0,"index")&&(n0.index=t0.index,n0.input=t0.input),n0},Ah=Cb.Uint8Array,Ek=function(t0){var e0=new t0.constructor(t0.byteLength);return new Ah(e0).set(new Ah(t0)),e0},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(t0,e0){return e0=e0?Ek(t0.buffer):t0.buffer,new t0.constructor(e0,t0.byteOffset,t0.length)},Fs=function(t0,e0,n0){var r0=t0.constructor;switch(e0){case"[object ArrayBuffer]":return Ek(t0);case"[object Boolean]":case"[object Date]":return new r0(+t0);case"[object DataView]":return e0=n0?Ek(t0.buffer):t0.buffer,new t0.constructor(e0,t0.byteOffset,t0.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(t0,n0);case"[object Map]":return new r0;case"[object Number]":case"[object String]":return new r0(t0);case"[object RegExp]":return(e0=new t0.constructor(t0.source,Cy.exec(t0))).lastIndex=t0.lastIndex,e0;case"[object Set]":return new r0;case"[object Symbol]":return iq?Object(iq.call(t0)):{}}},jq=Object.create,Dy=function(){function t0(){}return function(e0){return lb(e0)?jq?jq(e0):(t0.prototype=e0,e0=new t0,t0.prototype=void 0,e0):{}}}(),Kl=function(t0){return typeof t0.constructor!="function"||yk(t0)?{}:Dy(Ak(t0))},Ey=function(t0){return gc(t0)&&hf(t0)=="[object Map]"},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(t0){return gc(t0)&&hf(t0)=="[object Set]"},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(t0){return X(t0)=="symbol"||gc(t0)&&Qd(t0)=="[object Symbol]"},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(t0,e0){if(Va(t0))return!1;var n0=X(t0);return!(n0!="number"&&n0!="symbol"&&n0!="boolean"&&t0!=null&&!ie(t0))||Hy.test(t0)||!Gy.test(t0)||e0!=null&&t0 in Object(e0)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(t0){var e0=(t0=Zh(t0,function(n0){return e0.size===500&&e0.clear(),n0})).cache;return t0}(function(t0){var e0=[];return t0.charCodeAt(0)===46&&e0.push(""),t0.replace(Iy,function(n0,r0,i0,o0){e0.push(i0?o0.replace(Jy,"$1"):r0||n0)}),e0}),Js=1/0,mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(t0,e0){return Va(t0)?t0:Fk(t0,e0)?[t0]:Ky(t0==null?"":Nl(t0))},Ly=1/0,cg=function(t0){if(typeof t0=="string"||ie(t0))return t0;var e0=t0+"";return e0=="0"&&1/t0==-Ly?"-0":e0},Ch=function(t0,e0){for(var n0=0,r0=(e0=Bh(e0,t0)).length;t0!=null&&n0<r0;)t0=t0[cg(e0[n0++])];return n0&&n0==r0?t0:void 0},My=function(t0,e0){if(!(2>(e0=Bh(e0,t0)).length)){var n0=e0,r0=0,i0=-1,o0=-1,s0=n0.length;for(0>r0&&(r0=-r0>s0?0:s0+r0),0>(i0=i0>s0?s0:i0)&&(i0+=s0),s0=r0>i0?0:i0-r0>>>0,r0>>>=0,i0=Array(s0);++o0<s0;)i0[o0]=n0[o0+r0];t0=Ch(t0,i0)}return(n0=t0==null)||(n0=e0==null?0:e0.length,n0=delete t0[cg(n0?e0[n0-1]:void 0)]),n0},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(t0){return!(!gc(t0)||Qd(t0)!="[object Object]")&&((t0=Ak(t0))===null||typeof(t0=Ny.call(t0,"constructor")&&t0.constructor)=="function"&&t0 instanceof t0&&nq.call(t0)==Oy)},Py=function(t0){return wm(t0)?void 0:t0},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(t0){return Va(t0)||rf(t0)||!!(oq&&t0&&t0[oq])},Qy=function(t0){return t0!=null&&t0.length?$h(t0,1):[]},Ry=function(t0,e0,n0){switch(n0.length){case 0:return t0.call(e0);case 1:return t0.call(e0,n0[0]);case 2:return t0.call(e0,n0[0],n0[1]);case 3:return t0.call(e0,n0[0],n0[1],n0[2])}return t0.apply(e0,n0)},pq=Math.max,qq=function(t0,e0,n0){return e0=pq(e0===void 0?t0.length-1:e0,0),function(){for(var r0=arguments,i0=-1,o0=pq(r0.length-e0,0),s0=Array(o0);++i0<o0;)s0[i0]=r0[e0+i0];for(i0=-1,o0=Array(e0+1);++i0<e0;)o0[i0]=r0[i0];return o0[e0]=n0(s0),Ry(t0,this,o0)}},Sy=function(t0){return function(){return t0}},Dh=function(t0){return t0},Ty=Date.now,rq=function(t0){var e0=0,n0=0;return function(){var r0=Ty(),i0=16-(r0-n0);if(n0=r0,0<i0){if(800<=++e0)return arguments[0]}else e0=0;return t0.apply(void 0,arguments)}}(yh?function(t0,e0){return yh(t0,"toString",{configurable:!0,enumerable:!1,value:Sy(e0),writable:!0})}:Dh),Gk=function(t0){return rq(qq(t0,void 0,Qy),t0+"")}(function(t0,e0){var n0={};if(t0==null)return n0;var r0=!1;e0=he(e0,function(o0){return o0=Bh(o0,t0),r0||(r0=1<o0.length),o0}),re(t0,Ll(t0),n0),r0&&(n0=fe(n0,7,Py));for(var i0=e0.length;i0--;)My(n0,e0[i0]);return n0}),Uy=function(t0,e0,n0,r0){for(var i0=-1,o0=t0==null?0:t0.length;++i0<o0;){var s0=t0[i0];e0(r0,s0,n0(s0),t0)}return r0},um=function(t0,e0,n0){for(var r0=-1,i0=Object(t0),o0=(n0=n0(t0)).length;o0--;){var s0=n0[++r0];if(e0(i0[s0],s0,i0)===!1)break}return t0},sq=function(t0,e0){return t0&&um(t0,e0,Ad)},Hk=function(t0,e0){return function(n0,r0){if(n0==null)return n0;if(!Ed(n0))return t0(n0,r0);for(var i0=n0.length,o0=-1,s0=Object(n0);++o0<i0&&r0(s0[o0],o0,s0)!==!1;);return n0}}(sq),Vy=function(t0,e0,n0,r0){return Hk(t0,function(i0,o0,s0){e0(r0,i0,n0(i0),s0)}),r0},tq=function(t0,e0){for(var n0=-1,r0=t0==null?0:t0.length;++n0<r0;)if(e0(t0[n0],n0,t0))return!0;return!1},Pl=function(t0,e0,n0,r0,i0,o0){var s0=1&n0,a0=t0.length,c0=e0.length;if(a0!=c0&&!(s0&&c0>a0))return!1;c0=o0.get(t0);var u0=o0.get(e0);if(c0&&u0)return c0==e0&&u0==t0;c0=-1,u0=!0;var l0=2&n0?new gf:void 0;for(o0.set(t0,e0),o0.set(e0,t0);++c0<a0;){var d0=t0[c0],h0=e0[c0];if(r0)var p0=s0?r0(h0,d0,c0,e0,t0,o0):r0(d0,h0,c0,t0,e0,o0);if(p0!==void 0){if(p0)continue;u0=!1;break}if(l0){if(!tq(e0,function(m0,f0){if(!l0.has(f0)&&(d0===m0||i0(d0,m0,n0,r0,o0)))return l0.push(f0)})){u0=!1;break}}else if(d0!==h0&&!i0(d0,h0,n0,r0,o0)){u0=!1;break}}return o0.delete(t0),o0.delete(e0),u0},Wy=function(t0){var e0=-1,n0=Array(t0.size);return t0.forEach(function(r0,i0){n0[++e0]=[i0,r0]}),n0},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(t0,e0,n0,r0,i0,o0,s0){switch(n0){case"[object DataView]":if(t0.byteLength!=e0.byteLength||t0.byteOffset!=e0.byteOffset)break;t0=t0.buffer,e0=e0.buffer;case"[object ArrayBuffer]":if(t0.byteLength!=e0.byteLength||!o0(new Ah(t0),new Ah(e0)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+t0,+e0);case"[object Error]":return t0.name==e0.name&&t0.message==e0.message;case"[object RegExp]":case"[object String]":return t0==e0+"";case"[object Map]":var a0=Wy;case"[object Set]":if(a0||(a0=uk),t0.size!=e0.size&&!(1&r0))break;return(n0=s0.get(t0))?n0==e0:(r0|=2,s0.set(t0,e0),e0=Pl(a0(t0),a0(e0),r0,i0,o0,s0),s0.delete(t0),e0);case"[object Symbol]":if(Ik)return Ik.call(t0)==Ik.call(e0)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(t0,e0,n0,r0){var i0=n0.length,o0=i0,s0=!r0;if(t0==null)return!o0;for(t0=Object(t0);i0--;){var a0=n0[i0];if(s0&&a0[2]?a0[1]!==t0[a0[0]]:!(a0[0]in t0))return!1}for(;++i0<o0;){var c0=(a0=n0[i0])[0],u0=t0[c0],l0=a0[1];if(s0&&a0[2]){if(u0===void 0&&!(c0 in t0))return!1}else{if(a0=new ge,r0)var d0=r0(u0,l0,c0,t0,e0,a0);if(d0===void 0?!je(l0,u0,3,r0,a0):!d0)return!1}}return!0},Yy=function(t0){for(var e0=Ad(t0),n0=e0.length;n0--;){var r0=e0[n0],i0=t0[r0];e0[n0]=[r0,i0,i0==i0&&!lb(i0)]}return e0},vq=function(t0,e0){return function(n0){return n0!=null&&n0[t0]===e0&&(e0!==void 0||t0 in Object(n0))}},Zy=function(t0){var e0=Yy(t0);return e0.length==1&&e0[0][2]?vq(e0[0][0],e0[0][1]):function(n0){return n0===t0||Xy(n0,t0,e0)}},$y=function(t0,e0){return Fk(t0)&&e0==e0&&!lb(e0)?vq(cg(t0),e0):function(n0){var r0=n0==null?void 0:Ch(n0,t0);if((r0=r0===void 0?void 0:r0)===void 0&&r0===e0){if(r0=n0!=null){for(var i0=-1,o0=(r0=Bh(r0=t0,n0)).length,s0=!1;++i0<o0;){var a0=cg(r0[i0]);if(!(s0=n0!=null&&n0!=null&&a0 in Object(n0)))break;n0=n0[a0]}s0||++i0!=o0?r0=s0:r0=!!(o0=n0==null?0:n0.length)&&xk(o0)&&wk(a0,o0)&&(Va(n0)||rf(n0))}a0=r0}else a0=je(e0,r0,3);return a0}},az=function(t0){return function(e0){return e0==null?void 0:e0[t0]}},bz=function(t0){return function(e0){return Ch(e0,t0)}},Te=function(t0){return typeof t0=="function"?t0:t0==null?Dh:X(t0)=="object"?Va(t0)?$y(t0[0],t0[1]):Zy(t0):Fk(t0)?az(cg(t0)):bz(t0)},Jk=function(t0,e0){return function(n0,r0){var i0={};return(Va(n0)?Uy:Vy)(n0,t0,Te(r0),i0)}}(function(t0,e0,n0){bg(t0,n0,e0)}),uc=function(t0,e0){var n0={};return e0=Te(e0),sq(t0,function(r0,i0,o0){bg(n0,i0,e0(r0,i0,o0))}),n0};N({target:"String",proto:!0,forced:R(function(){var t0="".sub('"');return t0!==t0.toLowerCase()||3<t0.split('"').length})},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t0){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(t0){if(2>(t0=t0||10)||36<t0)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var e0=Gb(t0),n0=this.div(e0);return e0=n0.mul(e0).sub(this),n0.toString(t0)+e0.toInt().toString(t0)}return"-"+this.neg().toString(t0)}n0=Gb(sg(t0,6),this.unsigned),e0=this;for(var r0="";;){var i0=e0.div(n0),o0=(e0.sub(i0.mul(n0)).toInt()>>>0).toString(t0);if((e0=i0).isZero())return o0+r0;for(;6>o0.length;)o0="0"+o0;r0=""+o0+r0}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var t0=this.high!=0?this.high:this.low,e0=31;0<e0&&!(t0&1<<e0);e0--);return this.high!=0?e0+33:e0+1},D.isZero=function(){return this.high===0&&this.low===0},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return(1&this.low)==1},D.isEven=function(){return(1&this.low)==0},D.equals=function(t0){return mb(t0)||(t0=Wb(t0)),(this.unsigned===t0.unsigned||this.high>>>31!=1||t0.high>>>31!=1)&&this.high===t0.high&&this.low===t0.low},D.eq=D.equals,D.notEquals=function(t0){return!this.eq(t0)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(t0){return 0>this.comp(t0)},D.lt=D.lessThan,D.lessThanOrEqual=function(t0){return 0>=this.comp(t0)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(t0){return 0<this.comp(t0)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(t0){return 0<=this.comp(t0)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(t0){if(mb(t0)||(t0=Wb(t0)),this.eq(t0))return 0;var e0=this.isNegative(),n0=t0.isNegative();return e0&&!n0?-1:!e0&&n0?1:this.unsigned?t0.high>>>0>this.high>>>0||t0.high===this.high&&t0.low>>>0>this.low>>>0?-1:1:this.sub(t0).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(t0){mb(t0)||(t0=Wb(t0));var e0=this.high>>>16,n0=65535&this.high,r0=this.low>>>16,i0=t0.high>>>16,o0=65535&t0.high,s0=t0.low>>>16;return r0=(s0=((t0=(65535&this.low)+(65535&t0.low))>>>16)+(r0+s0))>>>16,ya((65535&s0)<<16|65535&t0,(e0=((r0+=n0+o0)>>>16)+(e0+i0)&65535)<<16|65535&r0,this.unsigned)},D.subtract=function(t0){return mb(t0)||(t0=Wb(t0)),this.add(t0.neg())},D.sub=D.subtract,D.multiply=function(t0){if(this.isZero())return Hb;if(mb(t0)||(t0=Wb(t0)),Qb){var e0=Qb.mul(this.low,this.high,t0.low,t0.high);return ya(e0,Qb.get_high(),this.unsigned)}if(t0.isZero())return Hb;if(this.eq(nb))return t0.isOdd()?nb:Hb;if(t0.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return t0.isNegative()?this.neg().mul(t0.neg()):this.neg().mul(t0).neg();if(t0.isNegative())return this.mul(t0.neg()).neg();if(this.lt(wq)&&t0.lt(wq))return Gb(this.toNumber()*t0.toNumber(),this.unsigned);e0=this.high>>>16;var n0=65535&this.high,r0=this.low>>>16,i0=65535&this.low,o0=t0.high>>>16,s0=65535&t0.high,a0=t0.low>>>16,c0=i0*(t0=65535&t0.low),u0=(c0>>>16)+r0*t0,l0=u0>>>16;l0+=(u0=(65535&u0)+i0*a0)>>>16;var d0=(l0+=n0*t0)>>>16;return ya((65535&u0)<<16|65535&c0,(d0=(d0+=(l0=(65535&l0)+r0*a0)>>>16)+((l0=(65535&l0)+i0*s0)>>>16)+(e0*t0+n0*a0+r0*s0+i0*o0)&65535)<<16|65535&l0,this.unsigned)},D.mul=D.multiply,D.divide=function(t0){if(mb(t0)||(t0=Wb(t0)),t0.isZero())throw Error("division by zero");if(Qb)return this.unsigned||this.high!==-2147483648||t0.low!==-1||t0.high!==-1?ya(t0=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,t0.low,t0.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(t0.unsigned||(t0=t0.toUnsigned()),t0.gt(this))return Cd;if(t0.gt(this.shru(1)))return xq;var e0=Cd}else{if(this.eq(nb)){if(t0.eq(Ue)||t0.eq(Kk))return nb;if(t0.eq(nb))return Ue;var n0=this.shr(1).div(t0).shl(1);if(n0.eq(Hb))return t0.isNegative()?Ue:Kk;var r0=this.sub(t0.mul(n0));return n0.add(r0.div(t0))}if(t0.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return t0.isNegative()?this.neg().div(t0.neg()):this.neg().div(t0).neg();if(t0.isNegative())return this.div(t0.neg()).neg();e0=Hb}for(r0=this;r0.gte(t0);){n0=Math.max(1,Math.floor(r0.toNumber()/t0.toNumber()));var i0=Math.ceil(Math.log(n0)/Math.LN2);i0=48>=i0?1:sg(2,i0-48);for(var o0=Gb(n0),s0=o0.mul(t0);s0.isNegative()||s0.gt(r0);)s0=(o0=Gb(n0-=i0,this.unsigned)).mul(t0);o0.isZero()&&(o0=Ue),e0=e0.add(o0),r0=r0.sub(s0)}return e0},D.div=D.divide,D.modulo=function(t0){return mb(t0)||(t0=Wb(t0)),Qb?ya(t0=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,t0.low,t0.high),Qb.get_high(),this.unsigned):this.sub(this.div(t0).mul(t0))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(t0){return mb(t0)||(t0=Wb(t0)),ya(this.low&t0.low,this.high&t0.high,this.unsigned)},D.or=function(t0){return mb(t0)||(t0=Wb(t0)),ya(this.low|t0.low,this.high|t0.high,this.unsigned)},D.xor=function(t0){return mb(t0)||(t0=Wb(t0)),ya(this.low^t0.low,this.high^t0.high,this.unsigned)},D.shiftLeft=function(t0){return mb(t0)&&(t0=t0.toInt()),(t0&=63)==0?this:32>t0?ya(this.low<<t0,this.high<<t0|this.low>>>32-t0,this.unsigned):ya(0,this.low<<t0-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(t0){return mb(t0)&&(t0=t0.toInt()),(t0&=63)==0?this:32>t0?ya(this.low>>>t0|this.high<<32-t0,this.high>>t0,this.unsigned):ya(this.high>>t0-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(t0){if(mb(t0)&&(t0=t0.toInt()),(t0&=63)===0)return this;var e0=this.high;return 32>t0?ya(this.low>>>t0|e0<<32-t0,e0>>>t0,this.unsigned):ya(t0===32?e0:e0>>>t0-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(t0){return t0?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var t0=this.high,e0=this.low;return[255&e0,e0>>>8&255,e0>>>16&255,e0>>>24,255&t0,t0>>>8&255,t0>>>16&255,t0>>>24]},D.toBytesBE=function(){var t0=this.high,e0=this.low;return[t0>>>24,t0>>>16&255,t0>>>8&255,255&t0,e0>>>24,e0>>>16&255,e0>>>8&255,255&e0]},xa.fromBytes=function(t0,e0,n0){return n0?xa.fromBytesLE(t0,e0):xa.fromBytesBE(t0,e0)},xa.fromBytesLE=function(t0,e0){return new xa(t0[0]|t0[1]<<8|t0[2]<<16|t0[3]<<24,t0[4]|t0[5]<<8|t0[6]<<16|t0[7]<<24,e0)},xa.fromBytesBE=function(t0,e0){return new xa(t0[4]<<24|t0[5]<<16|t0[6]<<8|t0[7],t0[0]<<24|t0[1]<<16|t0[2]<<8|t0[3],e0)};var di=function(t0,e0){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n0,r0){n0.__proto__=r0}||function(n0,r0){for(var i0 in r0)r0.hasOwnProperty(i0)&&(n0[i0]=r0[i0])})(t0,e0)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t0){t0?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=t0},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(t0){},error:function(t0){if(Ib.useDeprecatedSynchronousErrorHandling)throw t0;me(t0)},complete:function(){}},Jb=Array.isArray||function(t0){return t0&&typeof t0.length=="number"},lf=function(){function t0(e0){return Error.call(this),this.message=e0?e0.length+` errors occurred during unsubscription:
`+e0.map(function(n0,r0){return r0+1+") "+n0.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e0,this}return t0.prototype=Object.create(Error.prototype),t0}(),Oa=function(){function t0(e0){this.closed=!1,this._subscriptions=this._parentOrParents=null,e0&&(this._ctorUnsubscribe=!0,this._unsubscribe=e0)}return t0.prototype.unsubscribe=function(){if(!this.closed){var e0=this._parentOrParents,n0=this._ctorUnsubscribe,r0=this._unsubscribe,i0=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,e0 instanceof t0)e0.remove(this);else if(e0!==null)for(var o0=0;o0<e0.length;++o0)e0[o0].remove(this);if(le(r0)){n0&&(this._unsubscribe=void 0);try{r0.call(this)}catch(a0){var s0=a0 instanceof lf?Xl(a0.errors):[a0]}}if(Jb(i0)){for(o0=-1,e0=i0.length;++o0<e0;)if(ei(n0=i0[o0]))try{n0.unsubscribe()}catch(a0){s0=s0||[],a0 instanceof lf?s0=s0.concat(Xl(a0.errors)):s0.push(a0)}}if(s0)throw new lf(s0)}},t0.prototype.add=function(e0){var n0=e0;if(!e0)return t0.EMPTY;switch(X(e0)){case"function":n0=new t0(e0);case"object":if(n0===this||n0.closed||typeof n0.unsubscribe!="function")return n0;if(this.closed)return n0.unsubscribe(),n0;n0 instanceof t0||(e0=n0,(n0=new t0)._subscriptions=[e0]);break;default:throw Error("unrecognized teardown "+e0+" added to Subscription.")}if((e0=n0._parentOrParents)===null)n0._parentOrParents=this;else if(e0 instanceof t0){if(e0===this)return n0;n0._parentOrParents=[e0,this]}else{if(e0.indexOf(this)!==-1)return n0;e0.push(this)}return(e0=this._subscriptions)===null?this._subscriptions=[n0]:e0.push(n0),n0},t0.prototype.remove=function(e0){var n0=this._subscriptions;n0&&(e0=n0.indexOf(e0))!==-1&&n0.splice(e0,1)},t0.EMPTY=function(e0){return e0.closed=!0,e0}(new t0),t0}(),Fh=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(t0){function e0(n0,r0,i0){var o0=t0.call(this)||this;switch(o0.syncErrorValue=null,o0.syncErrorThrown=!1,o0.syncErrorThrowable=!1,o0.isStopped=!1,arguments.length){case 0:o0.destination=Eh;break;case 1:if(!n0){o0.destination=Eh;break}if(X(n0)==="object"){n0 instanceof e0?(o0.syncErrorThrowable=n0.syncErrorThrowable,o0.destination=n0,n0.add(o0)):(o0.syncErrorThrowable=!0,o0.destination=new yq(o0,n0));break}default:o0.syncErrorThrowable=!0,o0.destination=new yq(o0,n0,r0,i0)}return o0}return O(e0,t0),e0.prototype[Fh]=function(){return this},e0.create=function(n0,r0,i0){return(n0=new e0(n0,r0,i0)).syncErrorThrowable=!1,n0},e0.prototype.next=function(n0){this.isStopped||this._next(n0)},e0.prototype.error=function(n0){this.isStopped||(this.isStopped=!0,this._error(n0))},e0.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e0.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t0.prototype.unsubscribe.call(this))},e0.prototype._next=function(n0){this.destination.next(n0)},e0.prototype._error=function(n0){this.destination.error(n0),this.unsubscribe()},e0.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e0.prototype._unsubscribeAndRecycle=function(){var n0=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=n0,this},e0}(Oa),yq=function(t0){function e0(n0,r0,i0,o0){var s0=t0.call(this)||this;if(s0._parentSubscriber=n0,n0=s0,le(r0))var a0=r0;else r0&&(a0=r0.next,i0=r0.error,o0=r0.complete,r0!==Eh&&(le((n0=Object.create(r0)).unsubscribe)&&s0.add(n0.unsubscribe.bind(n0)),n0.unsubscribe=s0.unsubscribe.bind(s0)));return s0._context=n0,s0._next=a0,s0._error=i0,s0._complete=o0,s0}return O(e0,t0),e0.prototype.next=function(n0){if(!this.isStopped&&this._next){var r0=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&r0.syncErrorThrowable?this.__tryOrSetError(r0,this._next,n0)&&this.unsubscribe():this.__tryOrUnsub(this._next,n0)}},e0.prototype.error=function(n0){if(!this.isStopped){var r0=this._parentSubscriber,i0=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)i0&&r0.syncErrorThrowable?this.__tryOrSetError(r0,this._error,n0):this.__tryOrUnsub(this._error,n0),this.unsubscribe();else if(r0.syncErrorThrowable)i0?(r0.syncErrorValue=n0,r0.syncErrorThrown=!0):me(n0),this.unsubscribe();else{if(this.unsubscribe(),i0)throw n0;me(n0)}}},e0.prototype.complete=function(){var n0=this;if(!this.isStopped){var r0=this._parentSubscriber;if(this._complete){var i0=function(){return n0._complete.call(n0._context)};Ib.useDeprecatedSynchronousErrorHandling&&r0.syncErrorThrowable?this.__tryOrSetError(r0,i0):this.__tryOrUnsub(i0)}this.unsubscribe()}},e0.prototype.__tryOrUnsub=function(n0,r0){try{n0.call(this._context,r0)}catch(i0){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw i0;me(i0)}},e0.prototype.__tryOrSetError=function(n0,r0,i0){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{r0.call(this._context,i0)}catch(o0){return Ib.useDeprecatedSynchronousErrorHandling?(n0.syncErrorValue=o0,n0.syncErrorThrown=!0):me(o0),!0}return!1},e0.prototype._unsubscribe=function(){var n0=this._parentSubscriber;this._parentSubscriber=this._context=null,n0.unsubscribe()},e0}(ia),ne=typeof Symbol=="function"&&Symbol.observable||"@@observable",Y=function(){function t0(e0){this._isScalar=!1,e0&&(this._subscribe=e0)}return t0.prototype.lift=function(e0){var n0=new t0;return n0.source=this,n0.operator=e0,n0},t0.prototype.subscribe=function(e0,n0,r0){var i0=this.operator;t:{if(e0){if(e0 instanceof ia)break t;if(e0[Fh]){e0=e0[Fh]();break t}}e0=e0||n0||r0?new ia(e0,n0,r0):new ia(Eh)}if(i0?e0.add(i0.call(e0,this.source)):e0.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!e0.syncErrorThrowable?this._subscribe(e0):this._trySubscribe(e0)),Ib.useDeprecatedSynchronousErrorHandling&&e0.syncErrorThrowable&&(e0.syncErrorThrowable=!1,e0.syncErrorThrown))throw e0.syncErrorValue;return e0},t0.prototype._trySubscribe=function(e0){try{return this._subscribe(e0)}catch(n0){Ib.useDeprecatedSynchronousErrorHandling&&(e0.syncErrorThrown=!0,e0.syncErrorValue=n0),fi(e0)?e0.error(n0):console.warn(n0)}},t0.prototype.forEach=function(e0,n0){var r0=this;return new(n0=Zl(n0))(function(i0,o0){var s0=r0.subscribe(function(a0){try{e0(a0)}catch(c0){o0(c0),s0&&s0.unsubscribe()}},o0,i0)})},t0.prototype._subscribe=function(e0){var n0=this.source;return n0&&n0.subscribe(e0)},t0.prototype[ne]=function(){return this},t0.prototype.pipe=function(){for(var e0=[],n0=0;n0<arguments.length;n0++)e0[n0]=arguments[n0];return e0.length===0?this:Yl(e0)(this)},t0.prototype.toPromise=function(e0){var n0=this;return new(e0=Zl(e0))(function(r0,i0){var o0;n0.subscribe(function(s0){return o0=s0},function(s0){return i0(s0)},function(){return r0(o0)})})},t0.create=function(e0){return new t0(e0)},t0}(),qd=function(){function t0(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t0.prototype=Object.create(Error.prototype),t0}(),zq=function(t0){function e0(n0,r0){var i0=t0.call(this)||this;return i0.subject=n0,i0.subscriber=r0,i0.closed=!1,i0}return O(e0,t0),e0.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var n0=this.subject,r0=n0.observers;this.subject=null,!r0||r0.length===0||n0.isStopped||n0.closed||(n0=r0.indexOf(this.subscriber))!==-1&&r0.splice(n0,1)}},e0}(Oa),Aq=function(t0){function e0(n0){var r0=t0.call(this,n0)||this;return r0.destination=n0,r0}return O(e0,t0),e0}(ia),Pa=function(t0){function e0(){var n0=t0.call(this)||this;return n0.observers=[],n0.closed=!1,n0.isStopped=!1,n0.hasError=!1,n0.thrownError=null,n0}return O(e0,t0),e0.prototype[Fh]=function(){return new Aq(this)},e0.prototype.lift=function(n0){var r0=new Bq(this,this);return r0.operator=n0,r0},e0.prototype.next=function(n0){if(this.closed)throw new qd;if(!this.isStopped){var r0=this.observers,i0=r0.length;r0=r0.slice();for(var o0=0;o0<i0;o0++)r0[o0].next(n0)}},e0.prototype.error=function(n0){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=n0,this.isStopped=!0;var r0=this.observers,i0=r0.length;r0=r0.slice();for(var o0=0;o0<i0;o0++)r0[o0].error(n0);this.observers.length=0},e0.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var n0=this.observers,r0=n0.length;n0=n0.slice();for(var i0=0;i0<r0;i0++)n0[i0].complete();this.observers.length=0},e0.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},e0.prototype._trySubscribe=function(n0){if(this.closed)throw new qd;return t0.prototype._trySubscribe.call(this,n0)},e0.prototype._subscribe=function(n0){if(this.closed)throw new qd;return this.hasError?(n0.error(this.thrownError),Oa.EMPTY):this.isStopped?(n0.complete(),Oa.EMPTY):(this.observers.push(n0),new zq(this,n0))},e0.prototype.asObservable=function(){var n0=new Y;return n0.source=this,n0},e0.create=function(n0,r0){return new Bq(n0,r0)},e0}(Y),Bq=function(t0){function e0(n0,r0){var i0=t0.call(this)||this;return i0.destination=n0,i0.source=r0,i0}return O(e0,t0),e0.prototype.next=function(n0){var r0=this.destination;r0&&r0.next&&r0.next(n0)},e0.prototype.error=function(n0){var r0=this.destination;r0&&r0.error&&this.destination.error(n0)},e0.prototype.complete=function(){var n0=this.destination;n0&&n0.complete&&this.destination.complete()},e0.prototype._subscribe=function(n0){return this.source?this.source.subscribe(n0):Oa.EMPTY},e0}(Pa),Ns=function(){function t0(e0){this.connectable=e0}return t0.prototype.call=function(e0,n0){var r0=this.connectable;return r0._refCount++,e0=new cz(e0,r0),n0=n0.subscribe(e0),e0.closed||(e0.connection=r0.connect()),n0},t0}(),cz=function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).connectable=r0,n0}return O(e0,t0),e0.prototype._unsubscribe=function(){var n0=this.connectable;if(n0){this.connectable=null;var r0=n0._refCount;0>=r0?this.connection=null:(n0._refCount=r0-1,1<r0?this.connection=null:(r0=this.connection,n0=n0._connection,this.connection=null,!n0||r0&&n0!==r0||n0.unsubscribe()))}else this.connection=null},e0}(ia),Cq=function(t0){function e0(n0,r0){var i0=t0.call(this)||this;return i0.source=n0,i0.subjectFactory=r0,i0._refCount=0,i0._isComplete=!1,i0}return O(e0,t0),e0.prototype._subscribe=function(n0){return this.getSubject().subscribe(n0)},e0.prototype.getSubject=function(){var n0=this._subject;return n0&&!n0.isStopped||(this._subject=this.subjectFactory()),this._subject},e0.prototype.connect=function(){var n0=this._connection;return n0||(this._isComplete=!1,(n0=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),n0.closed&&(this._connection=null,n0=Oa.EMPTY)),n0},e0.prototype.refCount=function(){return $l()(this)},e0}(Y),At=function(){var t0=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t0._subscribe},_isComplete:{value:t0._isComplete,writable:!0},getSubject:{value:t0.getSubject},connect:{value:t0.connect},refCount:{value:t0.refCount}}}(),dz=function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).connectable=r0,n0}return O(e0,t0),e0.prototype._error=function(n0){this._unsubscribe(),t0.prototype._error.call(this,n0)},e0.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t0.prototype._complete.call(this)},e0.prototype._unsubscribe=function(){var n0=this.connectable;if(n0){this.connectable=null;var r0=n0._connection;n0._refCount=0,n0._subject=null,n0._connection=null,r0&&r0.unsubscribe()}},e0}(Aq);(function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).connectable=r0,n0}O(e0,t0),e0.prototype._unsubscribe=function(){var n0=this.connectable;if(n0){this.connectable=null;var r0=n0._refCount;0>=r0?this.connection=null:(n0._refCount=r0-1,1<r0?this.connection=null:(r0=this.connection,n0=n0._connection,this.connection=null,!n0||r0&&n0!==r0||n0.unsubscribe()))}else this.connection=null}})(ia),function(t0){function e0(n0,r0,i0,o0,s0){return(n0=t0.call(this,n0)||this).keySelector=r0,n0.elementSelector=i0,n0.durationSelector=o0,n0.subjectSelector=s0,n0.groups=null,n0.attemptedToUnsubscribe=!1,n0.count=0,n0}O(e0,t0),e0.prototype._next=function(n0){try{var r0=this.keySelector(n0)}catch(i0){return void this.error(i0)}this._group(n0,r0)},e0.prototype._group=function(n0,r0){var i0=this.groups;i0||(i0=this.groups=new Map);var o0=i0.get(r0);if(this.elementSelector)try{var s0=this.elementSelector(n0)}catch(a0){this.error(a0)}else s0=n0;if(!o0&&(o0=this.subjectSelector?this.subjectSelector():new Pa,i0.set(r0,o0),n0=new Mk(r0,o0,this),this.destination.next(n0),this.durationSelector)){n0=void 0;try{n0=this.durationSelector(new Mk(r0,o0))}catch(a0){return void this.error(a0)}this.add(n0.subscribe(new ez(r0,o0,this)))}o0.closed||o0.next(s0)},e0.prototype._error=function(n0){var r0=this.groups;r0&&(r0.forEach(function(i0,o0){i0.error(n0)}),r0.clear()),this.destination.error(n0)},e0.prototype._complete=function(){var n0=this.groups;n0&&(n0.forEach(function(r0,i0){r0.complete()}),n0.clear()),this.destination.complete()},e0.prototype.removeGroup=function(n0){this.groups.delete(n0)},e0.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&t0.prototype.unsubscribe.call(this))}}(ia);var ez=function(t0){function e0(n0,r0,i0){var o0=t0.call(this,r0)||this;return o0.key=n0,o0.group=r0,o0.parent=i0,o0}return O(e0,t0),e0.prototype._next=function(n0){this.complete()},e0.prototype._unsubscribe=function(){var n0=this.parent,r0=this.key;this.key=this.parent=null,n0&&n0.removeGroup(r0)},e0}(ia),Mk=function(t0){function e0(n0,r0,i0){var o0=t0.call(this)||this;return o0.key=n0,o0.groupSubject=r0,o0.refCountSubscription=i0,o0}return O(e0,t0),e0.prototype._subscribe=function(n0){var r0=new Oa,i0=this.refCountSubscription,o0=this.groupSubject;return i0&&!i0.closed&&r0.add(new fz(i0)),r0.add(o0.subscribe(n0)),r0},e0}(Y),fz=function(t0){function e0(n0){var r0=t0.call(this)||this;return r0.parent=n0,n0.count++,r0}return O(e0,t0),e0.prototype.unsubscribe=function(){var n0=this.parent;n0.closed||this.closed||(t0.prototype.unsubscribe.call(this),--n0.count,n0.count===0&&n0.attemptedToUnsubscribe&&n0.unsubscribe())},e0}(Oa),gz=function(t0){function e0(n0){var r0=t0.call(this)||this;return r0._value=n0,r0}return O(e0,t0),Object.defineProperty(e0.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e0.prototype._subscribe=function(n0){var r0=t0.prototype._subscribe.call(this,n0);return r0&&!r0.closed&&n0.next(this._value),r0},e0.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},e0.prototype.next=function(n0){t0.prototype.next.call(this,this._value=n0)},e0}(Pa),dg=function(t0){function e0(n0,r0){var i0=t0.call(this,n0,r0)||this;return i0.scheduler=n0,i0.work=r0,i0.pending=!1,i0}return O(e0,t0),e0.prototype.schedule=function(n0,r0){if(r0===void 0&&(r0=0),this.closed)return this;this.state=n0,n0=this.id;var i0=this.scheduler;return n0!=null&&(this.id=this.recycleAsyncId(i0,n0,r0)),this.pending=!0,this.delay=r0,this.id=this.id||this.requestAsyncId(i0,this.id,r0),this},e0.prototype.requestAsyncId=function(n0,r0,i0){return i0===void 0&&(i0=0),setInterval(n0.flush.bind(n0,this),i0)},e0.prototype.recycleAsyncId=function(n0,r0,i0){if(i0===void 0&&(i0=0),i0!==null&&this.delay===i0&&this.pending===!1)return r0;clearInterval(r0)},e0.prototype.execute=function(n0,r0){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(n0=this._execute(n0,r0))?n0:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},e0.prototype._execute=function(n0,r0){r0=!1;var i0=void 0;try{this.work(n0)}catch(o0){r0=!0,i0=!!o0&&o0||Error(o0)}if(r0)return this.unsubscribe(),i0},e0.prototype._unsubscribe=function(){var n0=this.id,r0=this.scheduler,i0=r0.actions,o0=i0.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,o0!==-1&&i0.splice(o0,1),n0!=null&&(this.id=this.recycleAsyncId(r0,n0,null)),this.delay=null},e0}(function(t0){function e0(n0,r0){return t0.call(this)||this}return O(e0,t0),e0.prototype.schedule=function(n0,r0){return this},e0}(Oa)),hz=function(t0){function e0(n0,r0){var i0=t0.call(this,n0,r0)||this;return i0.scheduler=n0,i0.work=r0,i0}return O(e0,t0),e0.prototype.schedule=function(n0,r0){return r0===void 0&&(r0=0),0<r0?t0.prototype.schedule.call(this,n0,r0):(this.delay=r0,this.state=n0,this.scheduler.flush(this),this)},e0.prototype.execute=function(n0,r0){return 0<r0||this.closed?t0.prototype.execute.call(this,n0,r0):this._execute(n0,r0)},e0.prototype.requestAsyncId=function(n0,r0,i0){return i0===void 0&&(i0=0),i0!==null&&0<i0||i0===null&&0<this.delay?t0.prototype.requestAsyncId.call(this,n0,r0,i0):n0.flush(this)},e0}(dg),Nk=function(){function t0(e0,n0){n0===void 0&&(n0=t0.now),this.SchedulerAction=e0,this.now=n0}return t0.prototype.schedule=function(e0,n0,r0){return n0===void 0&&(n0=0),new this.SchedulerAction(this,e0).schedule(r0,n0)},t0.now=function(){return Date.now()},t0}(),eg=function(t0){function e0(n0,r0){r0===void 0&&(r0=Nk.now);var i0=t0.call(this,n0,function(){return e0.delegate&&e0.delegate!==i0?e0.delegate.now():r0()})||this;return i0.actions=[],i0.active=!1,i0.scheduled=void 0,i0}return O(e0,t0),e0.prototype.schedule=function(n0,r0,i0){return r0===void 0&&(r0=0),e0.delegate&&e0.delegate!==this?e0.delegate.schedule(n0,r0,i0):t0.prototype.schedule.call(this,n0,r0,i0)},e0.prototype.flush=function(n0){var r0=this.actions;if(this.active)r0.push(n0);else{var i0;this.active=!0;do if(i0=n0.execute(n0.state,n0.delay))break;while(n0=r0.shift());if(this.active=!1,i0){for(;n0=r0.shift();)n0.unsubscribe();throw i0}}},e0}(Nk),fg=new(function(t0){function e0(){return t0!==null&&t0.apply(this,arguments)||this}return O(e0,t0),e0}(eg))(hz),vb=new Y(function(t0){return t0.complete()}),am=function(t0){return function(e0){for(var n0=0,r0=t0.length;n0<r0&&!e0.closed;n0++)e0.next(t0[n0]);e0.complete()}},Ok;(function(t0){t0.NEXT="N",t0.ERROR="E",t0.COMPLETE="C"})(Ok||(Ok={}));var Ve=function(){function t0(e0,n0,r0){this.kind=e0,this.value=n0,this.error=r0,this.hasValue=e0==="N"}return t0.prototype.observe=function(e0){switch(this.kind){case"N":return e0.next&&e0.next(this.value);case"E":return e0.error&&e0.error(this.error);case"C":return e0.complete&&e0.complete()}},t0.prototype.do=function(e0,n0,r0){switch(this.kind){case"N":return e0&&e0(this.value);case"E":return n0&&n0(this.error);case"C":return r0&&r0()}},t0.prototype.accept=function(e0,n0,r0){return e0&&typeof e0.next=="function"?this.observe(e0):this.do(e0,n0,r0)},t0.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},t0.createNext=function(e0){return e0!==void 0?new t0("N",e0):t0.undefinedValueNotification},t0.createError=function(e0){return new t0("E",void 0,e0)},t0.createComplete=function(){return t0.completeNotification},t0.completeNotification=new t0("C"),t0.undefinedValueNotification=new t0("N",void 0),t0}(),Rs=function(){function t0(e0,n0){n0===void 0&&(n0=0),this.scheduler=e0,this.delay=n0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Dq(e0,this.scheduler,this.delay))},t0}(),Dq=function(t0){function e0(n0,r0,i0){return i0===void 0&&(i0=0),(n0=t0.call(this,n0)||this).scheduler=r0,n0.delay=i0,n0}return O(e0,t0),e0.dispatch=function(n0){n0.notification.observe(n0.destination),this.unsubscribe()},e0.prototype.scheduleMessage=function(n0){this.destination.add(this.scheduler.schedule(e0.dispatch,this.delay,new iz(n0,this.destination)))},e0.prototype._next=function(n0){this.scheduleMessage(Ve.createNext(n0))},e0.prototype._error=function(n0){this.scheduleMessage(Ve.createError(n0)),this.unsubscribe()},e0.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},e0}(ia),iz=function(t0,e0){this.notification=t0,this.destination=e0},qe=function(t0){function e0(n0,r0,i0){n0===void 0&&(n0=Number.POSITIVE_INFINITY),r0===void 0&&(r0=Number.POSITIVE_INFINITY);var o0=t0.call(this)||this;return o0.scheduler=i0,o0._events=[],o0._infiniteTimeWindow=!1,o0._bufferSize=1>n0?1:n0,o0._windowTime=1>r0?1:r0,r0===Number.POSITIVE_INFINITY?(o0._infiniteTimeWindow=!0,o0.next=o0.nextInfiniteTimeWindow):o0.next=o0.nextTimeWindow,o0}return O(e0,t0),e0.prototype.nextInfiniteTimeWindow=function(n0){if(!this.isStopped){var r0=this._events;r0.push(n0),r0.length>this._bufferSize&&r0.shift()}t0.prototype.next.call(this,n0)},e0.prototype.nextTimeWindow=function(n0){this.isStopped||(this._events.push(new jz(this._getNow(),n0)),this._trimBufferThenGetEvents()),t0.prototype.next.call(this,n0)},e0.prototype._subscribe=function(n0){var r0=this._infiniteTimeWindow,i0=r0?this._events:this._trimBufferThenGetEvents(),o0=this.scheduler,s0=i0.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var a0=Oa.EMPTY;else this.observers.push(n0),a0=new zq(this,n0);if(o0&&n0.add(n0=new Dq(n0,o0)),r0)for(r0=0;r0<s0&&!n0.closed;r0++)n0.next(i0[r0]);else for(r0=0;r0<s0&&!n0.closed;r0++)n0.next(i0[r0].value);return this.hasError?n0.error(this.thrownError):this.isStopped&&n0.complete(),a0},e0.prototype._getNow=function(){return(this.scheduler||fg).now()},e0.prototype._trimBufferThenGetEvents=function(){for(var n0=this._getNow(),r0=this._bufferSize,i0=this._windowTime,o0=this._events,s0=o0.length,a0=0;a0<s0&&!(n0-o0[a0].time<i0);)a0++;return s0>r0&&(a0=Math.max(a0,s0-r0)),0<a0&&o0.splice(0,a0),o0},e0}(Pa),jz=function(t0,e0){this.time=t0,this.value=e0},of=function(t0){function e0(){var n0=t0!==null&&t0.apply(this,arguments)||this;return n0.value=null,n0.hasNext=!1,n0.hasCompleted=!1,n0}return O(e0,t0),e0.prototype._subscribe=function(n0){return this.hasError?(n0.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(n0.next(this.value),n0.complete(),Oa.EMPTY):t0.prototype._subscribe.call(this,n0)},e0.prototype.next=function(n0){this.hasCompleted||(this.value=n0,this.hasNext=!0)},e0.prototype.error=function(n0){this.hasCompleted||t0.prototype.error.call(this,n0)},e0.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&t0.prototype.next.call(this,this.value),t0.prototype.complete.call(this)},e0}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(t0){var e0=kz++;return ii[e0]=!0,lz.then(function(){return bm(e0)&&t0()}),e0},clearImmediate:function(t0){bm(t0)}},mz=function(t0){function e0(n0,r0){var i0=t0.call(this,n0,r0)||this;return i0.scheduler=n0,i0.work=r0,i0}return O(e0,t0),e0.prototype.requestAsyncId=function(n0,r0,i0){return i0===void 0&&(i0=0),i0!==null&&0<i0?t0.prototype.requestAsyncId.call(this,n0,r0,i0):(n0.actions.push(this),n0.scheduled||(n0.scheduled=Eq.setImmediate(n0.flush.bind(n0,null))))},e0.prototype.recycleAsyncId=function(n0,r0,i0){if(i0===void 0&&(i0=0),i0!==null&&0<i0||i0===null&&0<this.delay)return t0.prototype.recycleAsyncId.call(this,n0,r0,i0);n0.actions.length===0&&(Eq.clearImmediate(r0),n0.scheduled=void 0)},e0}(dg),ri=new(function(t0){function e0(){return t0!==null&&t0.apply(this,arguments)||this}return O(e0,t0),e0.prototype.flush=function(n0){this.active=!0,this.scheduled=void 0;var r0,i0=this.actions,o0=-1,s0=i0.length;n0=n0||i0.shift();do if(r0=n0.execute(n0.state,n0.delay))break;while(++o0<s0&&(n0=i0.shift()));if(this.active=!1,r0){for(;++o0<s0&&(n0=i0.shift());)n0.unsubscribe();throw r0}},e0}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(t0){function e0(n0,r0){var i0=t0.call(this,n0,r0)||this;return i0.scheduler=n0,i0.work=r0,i0}return O(e0,t0),e0.prototype.requestAsyncId=function(n0,r0,i0){return i0===void 0&&(i0=0),i0!==null&&0<i0?t0.prototype.requestAsyncId.call(this,n0,r0,i0):(n0.actions.push(this),n0.scheduled||(n0.scheduled=requestAnimationFrame(function(){return n0.flush(null)})))},e0.prototype.recycleAsyncId=function(n0,r0,i0){if(i0===void 0&&(i0=0),i0!==null&&0<i0||i0===null&&0<this.delay)return t0.prototype.recycleAsyncId.call(this,n0,r0,i0);n0.actions.length===0&&(cancelAnimationFrame(r0),n0.scheduled=void 0)},e0}(dg),Fq=new(function(t0){function e0(){return t0!==null&&t0.apply(this,arguments)||this}return O(e0,t0),e0.prototype.flush=function(n0){this.active=!0,this.scheduled=void 0;var r0,i0=this.actions,o0=-1,s0=i0.length;n0=n0||i0.shift();do if(r0=n0.execute(n0.state,n0.delay))break;while(++o0<s0&&(n0=i0.shift()));if(this.active=!1,r0){for(;++o0<s0&&(n0=i0.shift());)n0.unsubscribe();throw r0}},e0}(eg))(oz),pz=function(t0){function e0(n0,r0){n0===void 0&&(n0=Gq),r0===void 0&&(r0=Number.POSITIVE_INFINITY);var i0=t0.call(this,n0,function(){return i0.frame})||this;return i0.maxFrames=r0,i0.frame=0,i0.index=-1,i0}return O(e0,t0),e0.prototype.flush=function(){for(var n0,r0,i0=this.actions,o0=this.maxFrames;(r0=i0[0])&&r0.delay<=o0&&(i0.shift(),this.frame=r0.delay,!(n0=r0.execute(r0.state,r0.delay))););if(n0){for(;r0=i0.shift();)r0.unsubscribe();throw n0}},e0.frameTimeFactor=10,e0}(eg),Gq=function(t0){function e0(n0,r0,i0){i0===void 0&&(i0=n0.index+=1);var o0=t0.call(this,n0,r0)||this;return o0.scheduler=n0,o0.work=r0,o0.index=i0,o0.active=!0,o0.index=n0.index=i0,o0}return O(e0,t0),e0.prototype.schedule=function(n0,r0){if(r0===void 0&&(r0=0),!this.id)return t0.prototype.schedule.call(this,n0,r0);this.active=!1;var i0=new e0(this.scheduler,this.work);return this.add(i0),i0.schedule(n0,r0)},e0.prototype.requestAsyncId=function(n0,r0,i0){return i0===void 0&&(i0=0),this.delay=n0.frame+i0,(n0=n0.actions).push(this),n0.sort(e0.sortActions),!0},e0.prototype.recycleAsyncId=function(n0,r0,i0){},e0.prototype._execute=function(n0,r0){if(this.active===!0)return t0.prototype._execute.call(this,n0,r0)},e0.sortActions=function(n0,r0){return n0.delay===r0.delay?n0.index===r0.index?0:n0.index>r0.index?1:-1:n0.delay>r0.delay?1:-1},e0}(dg),Qk=function(){function t0(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t0.prototype=Object.create(Error.prototype),t0}(),vg=function(){function t0(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t0.prototype=Object.create(Error.prototype),t0}(),pb=function(){function t0(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return t0.prototype=Object.create(Error.prototype),t0}(),Ss=function(){function t0(e0,n0){this.project=e0,this.thisArg=n0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new qz(e0,this.project,this.thisArg))},t0}(),qz=function(t0){function e0(n0,r0,i0){return(n0=t0.call(this,n0)||this).project=r0,n0.count=0,n0.thisArg=i0||n0,n0}return O(e0,t0),e0.prototype._next=function(n0){try{var r0=this.project.call(this.thisArg,n0,this.count++)}catch(i0){return void this.destination.error(i0)}this.destination.next(r0)},e0}(ia),Rk=function(t0){function e0(){return t0!==null&&t0.apply(this,arguments)||this}return O(e0,t0),e0.prototype.notifyNext=function(n0,r0,i0,o0,s0){this.destination.next(r0)},e0.prototype.notifyError=function(n0,r0){this.destination.error(n0)},e0.prototype.notifyComplete=function(n0){this.destination.complete()},e0}(ia),Xs=function(t0){function e0(n0,r0,i0){var o0=t0.call(this)||this;return o0.parent=n0,o0.outerValue=r0,o0.outerIndex=i0,o0.index=0,o0}return O(e0,t0),e0.prototype._next=function(n0){this.parent.notifyNext(this.outerValue,n0,this.outerIndex,this.index++,this)},e0.prototype._error=function(n0){this.parent.notifyError(n0,this),this.unsubscribe()},e0.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e0}(ia),rz=function(t0){return function(e0){return t0.then(function(n0){e0.closed||(e0.next(n0),e0.complete())},function(n0){return e0.error(n0)}).then(null,me),e0}},$c=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(t0){return function(e0){for(var n0=t0[$c]();;){var r0=void 0;try{r0=n0.next()}catch(i0){return e0.error(i0),e0}if(r0.done){e0.complete();break}if(e0.next(r0.value),e0.closed)break}return typeof n0.return=="function"&&e0.add(function(){n0.return&&n0.return()}),e0}},tz=function(t0){return function(e0){var n0=t0[ne]();if(typeof n0.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return n0.subscribe(e0)}},hm=function(t0){return t0&&typeof t0.length=="number"&&typeof t0!="function"},pf=function(t0){if(t0&&typeof t0[ne]=="function")return tz(t0);if(hm(t0))return am(t0);if(fm(t0))return rz(t0);if(t0&&typeof t0[$c]=="function")return sz(t0);throw t0=ei(t0)?"an invalid object":"'"+t0+"'",new TypeError("You provided "+t0+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function t0(e0){this.resultSelector=e0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new uz(e0,this.resultSelector))},t0}(),uz=function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).resultSelector=r0,n0.active=0,n0.values=[],n0.observables=[],n0}return O(e0,t0),e0.prototype._next=function(n0){this.values.push(Hq),this.observables.push(n0)},e0.prototype._complete=function(){var n0=this.observables,r0=n0.length;if(r0===0)this.destination.complete();else{this.toRespond=this.active=r0;for(var i0=0;i0<r0;i0++)this.add(ji(this,n0[i0],void 0,i0))}},e0.prototype.notifyComplete=function(n0){--this.active==0&&this.destination.complete()},e0.prototype.notifyNext=function(n0,r0,i0){var o0=(n0=this.values)[i0];o0=this.toRespond?o0===Hq?--this.toRespond:this.toRespond:0,n0[i0]=r0,o0===0&&(this.resultSelector?this._tryResultSelector(n0):this.destination.next(n0.slice()))},e0.prototype._tryResultSelector=function(n0){try{var r0=this.resultSelector.apply(this,n0)}catch(i0){return void this.destination.error(i0)}this.destination.next(r0)},e0}(Rk),vc=function(t0){function e0(n0){var r0=t0.call(this)||this;return r0.parent=n0,r0}return O(e0,t0),e0.prototype._next=function(n0){this.parent.notifyNext(n0)},e0.prototype._error=function(n0){this.parent.notifyError(n0),this.unsubscribe()},e0.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e0}(ia);(function(t0){function e0(n0,r0,i0){var o0=t0.call(this)||this;return o0.parent=n0,o0.outerValue=r0,o0.outerIndex=i0,o0}O(e0,t0),e0.prototype._next=function(n0){this.parent.notifyNext(this.outerValue,n0,this.outerIndex,this)},e0.prototype._error=function(n0){this.parent.notifyError(n0),this.unsubscribe()},e0.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(ia);var wc=function(t0){function e0(){return t0!==null&&t0.apply(this,arguments)||this}return O(e0,t0),e0.prototype.notifyNext=function(n0){this.destination.next(n0)},e0.prototype.notifyError=function(n0){this.destination.error(n0)},e0.prototype.notifyComplete=function(){this.destination.complete()},e0}(ia);(function(t0){function e0(){return t0!==null&&t0.apply(this,arguments)||this}O(e0,t0),e0.prototype.notifyNext=function(n0,r0,i0,o0){this.destination.next(r0)},e0.prototype.notifyError=function(n0){this.destination.error(n0)},e0.prototype.notifyComplete=function(n0){this.destination.complete()}})(ia);var at=function(){function t0(e0,n0){n0===void 0&&(n0=Number.POSITIVE_INFINITY),this.project=e0,this.concurrent=n0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new wz(e0,this.project,this.concurrent))},t0}(),wz=function(t0){function e0(n0,r0,i0){return i0===void 0&&(i0=Number.POSITIVE_INFINITY),(n0=t0.call(this,n0)||this).project=r0,n0.concurrent=i0,n0.hasCompleted=!1,n0.buffer=[],n0.active=0,n0.index=0,n0}return O(e0,t0),e0.prototype._next=function(n0){this.active<this.concurrent?this._tryNext(n0):this.buffer.push(n0)},e0.prototype._tryNext=function(n0){var r0=this.index++;try{var i0=this.project(n0,r0)}catch(o0){return void this.destination.error(o0)}this.active++,this._innerSub(i0)},e0.prototype._innerSub=function(n0){var r0=new vc(this),i0=this.destination;i0.add(r0),(n0=ic(n0,r0))!==r0&&i0.add(n0)},e0.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},e0.prototype.notifyNext=function(n0){this.destination.next(n0)},e0.prototype.notifyComplete=function(){var n0=this.buffer;this.active--,0<n0.length?this._next(n0.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},e0}(wc),Sk=y.parseFloat,Iq=1/Sk(`	
\v\f\r \u2028\u2029\uFEFF-0`)!=-1/0?function(t0){t0=ik(String(t0));var e0=Sk(t0);return e0===0&&t0.charAt(0)=="-"?-0:e0}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function t0(e0,n0){this.predicate=e0,this.thisArg=n0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new xz(e0,this.predicate,this.thisArg))},t0}(),xz=function(t0){function e0(n0,r0,i0){return(n0=t0.call(this,n0)||this).predicate=r0,n0.thisArg=i0,n0.count=0,n0}return O(e0,t0),e0.prototype._next=function(n0){try{var r0=this.predicate.call(this.thisArg,n0,this.count++)}catch(i0){return void this.destination.error(i0)}r0&&this.destination.next(n0)},e0}(ia),gt=function(){function t0(){}return t0.prototype.call=function(e0,n0){return n0.subscribe(new yz(e0))},t0}(),yz=function(t0){function e0(n0){return(n0=t0.call(this,n0)||this).hasFirst=!1,n0.observables=[],n0.subscriptions=[],n0}return O(e0,t0),e0.prototype._next=function(n0){this.observables.push(n0)},e0.prototype._complete=function(){var n0=this.observables,r0=n0.length;if(r0===0)this.destination.complete();else{for(var i0=0;i0<r0&&!this.hasFirst;i0++){var o0=ji(this,n0[i0],void 0,i0);this.subscriptions&&this.subscriptions.push(o0),this.add(o0)}this.observables=null}},e0.prototype.notifyNext=function(n0,r0,i0){if(!this.hasFirst){for(this.hasFirst=!0,n0=0;n0<this.subscriptions.length;n0++)if(n0!==i0){var o0=this.subscriptions[n0];o0.unsubscribe(),this.remove(o0)}this.subscriptions=null}this.destination.next(r0)},e0}(Rk),jt=function(){function t0(e0){this.resultSelector=e0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new zz(e0,this.resultSelector))},t0}(),zz=function(t0){function e0(n0,r0,i0){return(n0=t0.call(this,n0)||this).resultSelector=r0,n0.iterators=[],n0.active=0,n0.resultSelector=typeof r0=="function"?r0:void 0,n0}return O(e0,t0),e0.prototype._next=function(n0){var r0=this.iterators;Jb(n0)?r0.push(new Az(n0)):typeof n0[$c]=="function"?r0.push(new Bz(n0[$c]())):r0.push(new Cz(this.destination,this,n0))},e0.prototype._complete=function(){var n0=this.iterators,r0=n0.length;if(this.unsubscribe(),r0===0)this.destination.complete();else{this.active=r0;for(var i0=0;i0<r0;i0++){var o0=n0[i0];o0.stillUnsubscribed?this.destination.add(o0.subscribe()):this.active--}}},e0.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},e0.prototype.checkIterators=function(){for(var n0=this.iterators,r0=n0.length,i0=this.destination,o0=0;o0<r0;o0++){var s0=n0[o0];if(typeof s0.hasValue=="function"&&!s0.hasValue())return}var a0=!1,c0=[];for(o0=0;o0<r0;o0++){var u0=(s0=n0[o0]).next();if(s0.hasCompleted()&&(a0=!0),u0.done)return void i0.complete();c0.push(u0.value)}this.resultSelector?this._tryresultSelector(c0):i0.next(c0),a0&&i0.complete()},e0.prototype._tryresultSelector=function(n0){try{var r0=this.resultSelector.apply(this,n0)}catch(i0){return void this.destination.error(i0)}this.destination.next(r0)},e0}(ia),Bz=function(){function t0(e0){this.iterator=e0,this.nextResult=e0.next()}return t0.prototype.hasValue=function(){return!0},t0.prototype.next=function(){var e0=this.nextResult;return this.nextResult=this.iterator.next(),e0},t0.prototype.hasCompleted=function(){var e0=this.nextResult;return!(!e0||!e0.done)},t0}(),Az=function(){function t0(e0){this.array=e0,this.length=this.index=0,this.length=e0.length}return t0.prototype[$c]=function(){return this},t0.prototype.next=function(e0){e0=this.index++;var n0=this.array;return e0<this.length?{value:n0[e0],done:!1}:{value:null,done:!0}},t0.prototype.hasValue=function(){return this.array.length>this.index},t0.prototype.hasCompleted=function(){return this.array.length===this.index},t0}(),Cz=function(t0){function e0(n0,r0,i0){return(n0=t0.call(this,n0)||this).parent=r0,n0.observable=i0,n0.stillUnsubscribed=!0,n0.buffer=[],n0.isComplete=!1,n0}return O(e0,t0),e0.prototype[$c]=function(){return this},e0.prototype.next=function(){var n0=this.buffer;return n0.length===0&&this.isComplete?{value:null,done:!0}:{value:n0.shift(),done:!1}},e0.prototype.hasValue=function(){return 0<this.buffer.length},e0.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},e0.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e0.prototype.notifyNext=function(n0){this.buffer.push(n0),this.parent.checkIterators()},e0.prototype.subscribe=function(){return ic(this.observable,new vc(this))},e0}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(t0){return!!t0&&(t0 instanceof Y||typeof t0.lift=="function"&&typeof t0.subscribe=="function")},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var t0=[],e0=0;e0<arguments.length;e0++)t0[e0]=arguments[e0];var n0=e0=void 0;return Zc(t0[t0.length-1])&&(n0=t0.pop()),typeof t0[t0.length-1]=="function"&&(e0=t0.pop()),t0.length===1&&Jb(t0[0])&&(t0=t0[0]),nf(t0,n0).lift(new vz(e0))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(t0,e0,n0,r0,i0){if(arguments.length==1){var o0=t0.initialState;e0=t0.condition,n0=t0.iterate;var s0=t0.resultSelector||Yc;i0=t0.scheduler}else r0===void 0||Zc(r0)?(o0=t0,s0=Yc,i0=r0):(o0=t0,s0=r0);return new Y(function(a0){var c0=o0;if(i0)return i0.schedule(bt,0,{subscriber:a0,iterate:n0,condition:e0,resultSelector:s0,state:c0});for(;;){if(e0){var u0=void 0;try{u0=e0(c0)}catch(l0){a0.error(l0);break}if(!u0){a0.complete();break}}u0=void 0;try{u0=s0(c0)}catch(l0){a0.error(l0);break}if(a0.next(u0),a0.closed)break;try{c0=n0(c0)}catch(l0){a0.error(l0);break}}})},iif:function(t0,e0,n0){return e0===void 0&&(e0=vb),n0===void 0&&(n0=vb),ad(function(){return t0()?e0:n0})},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(t0,e0){return new Y(e0?function(n0){var r0=Object.keys(t0),i0=new Oa;return i0.add(e0.schedule(dt,0,{keys:r0,index:0,subscriber:n0,subscription:i0,obj:t0})),i0}:function(n0){for(var r0=Object.keys(t0),i0=0;i0<r0.length&&!n0.closed;i0++){var o0=r0[i0];t0.hasOwnProperty(o0)&&n0.next([o0,t0[o0]])}n0.complete()})},partition:function(t0,e0,n0){return[wb(e0,n0)(new Y(pf(t0))),wb(et(e0,n0))(new Y(pf(t0)))]},race:Ca,range:function(t0,e0,n0){return t0===void 0&&(t0=0),new Y(function(r0){e0===void 0&&(e0=t0,t0=0);var i0=0,o0=t0;if(n0)return n0.schedule(ht,0,{index:i0,count:e0,start:t0,subscriber:r0});for(;;){if(i0++>=e0){r0.complete();break}if(r0.next(o0++),r0.closed)break}})},throwError:Z,timer:Bc,using:function(t0,e0){return new Y(function(n0){try{var r0=t0()}catch(s0){return void n0.error(s0)}try{var i0=e0(r0)}catch(s0){return void n0.error(s0)}var o0=(i0?Kb(i0):vb).subscribe(n0);return function(){o0.unsubscribe(),r0&&r0.unsubscribe()}})},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function t0(e0){this.selector=e0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Ez(e0,this.selector,this.caught))},t0}(),Ez=function(t0){function e0(n0,r0,i0){return(n0=t0.call(this,n0)||this).selector=r0,n0.caught=i0,n0}return O(e0,t0),e0.prototype.error=function(n0){if(!this.isStopped){var r0=void 0;try{r0=this.selector(n0,this.caught)}catch(i0){return void t0.prototype.error.call(this,i0)}this._unsubscribeAndRecycle(),n0=new vc(this),this.add(n0),(r0=ic(r0,n0))!==n0&&this.add(r0)}},e0}(wc),lt=function(){function t0(e0){this.defaultValue=e0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Fz(e0,this.defaultValue))},t0}(),Fz=function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).defaultValue=r0,n0.isEmpty=!0,n0}return O(e0,t0),e0.prototype._next=function(n0){this.isEmpty=!1,this.destination.next(n0)},e0.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e0}(ia),mt=function(){function t0(e0,n0){this.delay=e0,this.scheduler=n0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Gz(e0,this.delay,this.scheduler))},t0}(),Gz=function(t0){function e0(n0,r0,i0){return(n0=t0.call(this,n0)||this).delay=r0,n0.scheduler=i0,n0.queue=[],n0.active=!1,n0.errored=!1,n0}return O(e0,t0),e0.dispatch=function(n0){for(var r0=n0.source,i0=r0.queue,o0=n0.scheduler,s0=n0.destination;0<i0.length&&0>=i0[0].time-o0.now();)i0.shift().notification.observe(s0);0<i0.length?(r0=Math.max(0,i0[0].time-o0.now()),this.schedule(n0,r0)):(this.unsubscribe(),r0.active=!1)},e0.prototype._schedule=function(n0){this.active=!0,this.destination.add(n0.schedule(e0.dispatch,this.delay,{source:this,destination:this.destination,scheduler:n0}))},e0.prototype.scheduleNotification=function(n0){if(this.errored!==!0){var r0=this.scheduler;n0=new Hz(r0.now()+this.delay,n0),this.queue.push(n0),this.active===!1&&this._schedule(r0)}},e0.prototype._next=function(n0){this.scheduleNotification(Ve.createNext(n0))},e0.prototype._error=function(n0){this.errored=!0,this.queue=[],this.destination.error(n0),this.unsubscribe()},e0.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},e0}(ia),Hz=function(t0,e0){this.time=t0,this.notification=e0},nt=function(){function t0(e0,n0){this.keySelector=e0,this.flushes=n0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Iz(e0,this.keySelector,this.flushes))},t0}(),Iz=function(t0){function e0(n0,r0,i0){return(n0=t0.call(this,n0)||this).keySelector=r0,n0.values=new Set,i0&&n0.add(ic(i0,new vc(n0))),n0}return O(e0,t0),e0.prototype.notifyNext=function(){this.values.clear()},e0.prototype.notifyError=function(n0){this._error(n0)},e0.prototype._next=function(n0){this.keySelector?this._useKeySelector(n0):this._finalizeNext(n0,n0)},e0.prototype._useKeySelector=function(n0){var r0=this.destination;try{var i0=this.keySelector(n0)}catch(o0){return void r0.error(o0)}this._finalizeNext(i0,n0)},e0.prototype._finalizeNext=function(n0,r0){var i0=this.values;i0.has(n0)||(i0.add(n0),this.destination.next(r0))},e0}(wc),pt=function(){function t0(e0){this.errorFactory=e0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Jz(e0,this.errorFactory))},t0}(),Jz=function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).errorFactory=r0,n0.hasValue=!1,n0}return O(e0,t0),e0.prototype._next=function(n0){this.hasValue=!0,this.destination.next(n0)},e0.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var n0=void 0;try{n0=this.errorFactory()}catch(r0){n0=r0}this.destination.error(n0)},e0}(ia),qt=function(){function t0(e0){if(this.total=e0,0>this.total)throw new Qk}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Kz(e0,this.total))},t0}(),Kz=function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).total=r0,n0.count=0,n0}return O(e0,t0),e0.prototype._next=function(n0){var r0=this.total,i0=++this.count;i0<=r0&&(this.destination.next(n0),i0===r0&&(this.destination.complete(),this.unsubscribe()))},e0}(ia),rt=function(){function t0(e0){this.project=e0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Lz(e0,this.project))},t0}(),Lz=function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).project=r0,n0.hasSubscription=!1,n0.hasCompleted=!1,n0.index=0,n0}return O(e0,t0),e0.prototype._next=function(n0){this.hasSubscription||this.tryNext(n0)},e0.prototype.tryNext=function(n0){var r0=this.index++;try{var i0=this.project(n0,r0)}catch(o0){return void this.destination.error(o0)}this.hasSubscription=!0,this._innerSub(i0)},e0.prototype._innerSub=function(n0){var r0=new vc(this),i0=this.destination;i0.add(r0),(n0=ic(n0,r0))!==r0&&i0.add(n0)},e0.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},e0.prototype.notifyNext=function(n0){this.destination.next(n0)},e0.prototype.notifyError=function(n0){this.destination.error(n0)},e0.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e0}(wc),st=function(){function t0(e0){this.callback=e0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Mz(e0,this.callback))},t0}(),Mz=function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).add(new Oa(r0)),n0}return O(e0,t0),e0}(ia),ut=function(){function t0(){}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Nz(e0))},t0}(),Nz=function(t0){function e0(){return t0!==null&&t0.apply(this,arguments)||this}return O(e0,t0),e0.prototype._next=function(n0){},e0}(ia),vt=function(){function t0(e0){if(this.total=e0,0>this.total)throw new Qk}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Oz(e0,this.total))},t0}(),Oz=function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).total=r0,n0.ring=[],n0.count=0,n0}return O(e0,t0),e0.prototype._next=function(n0){var r0=this.ring,i0=this.total,o0=this.count++;r0.length<i0?r0.push(n0):r0[o0%i0]=n0},e0.prototype._complete=function(){var n0=this.destination,r0=this.count;if(0<r0)for(var i0=this.count>=this.total?this.total:this.count,o0=this.ring,s0=0;s0<i0;s0++){var a0=r0++%i0;n0.next(o0[a0])}n0.complete()},e0}(ia),wt=function(){function t0(e0){this.value=e0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Pz(e0,this.value))},t0}(),Pz=function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).value=r0,n0}return O(e0,t0),e0.prototype._next=function(n0){this.destination.next(this.value)},e0}(ia),xt=function(){function t0(e0,n0,r0){r0===void 0&&(r0=!1),this.accumulator=e0,this.seed=n0,this.hasSeed=r0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Qz(e0,this.accumulator,this.seed,this.hasSeed))},t0}(),Qz=function(t0){function e0(n0,r0,i0,o0){return(n0=t0.call(this,n0)||this).accumulator=r0,n0._seed=i0,n0.hasSeed=o0,n0.index=0,n0}return O(e0,t0),Object.defineProperty(e0.prototype,"seed",{get:function(){return this._seed},set:function(n0){this.hasSeed=!0,this._seed=n0},enumerable:!0,configurable:!0}),e0.prototype._next=function(n0){if(this.hasSeed)return this._tryNext(n0);this.seed=n0,this.destination.next(n0)},e0.prototype._tryNext=function(n0){var r0=this.index++;try{var i0=this.accumulator(this.seed,n0,r0)}catch(o0){this.destination.error(o0)}this.seed=i0,this.destination.next(i0)},e0}(ia),zt=function(){function t0(e0,n0){this.subjectFactory=e0,this.selector=n0}return t0.prototype.call=function(e0,n0){var r0=this.selector,i0=this.subjectFactory();return(e0=r0(i0).subscribe(e0)).add(n0.subscribe(i0)),e0},t0}(),Bt=function(){function t0(e0,n0){this.notifier=e0,this.source=n0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Rz(e0,this.notifier,this.source))},t0}(),Rz=function(t0){function e0(n0,r0,i0){return(n0=t0.call(this,n0)||this).notifier=r0,n0.source=i0,n0}return O(e0,t0),e0.prototype.error=function(n0){if(!this.isStopped){var r0=this.errors,i0=this.retries,o0=this.retriesSubscription;if(i0)this.retriesSubscription=this.errors=void 0;else{r0=new Pa;try{i0=(0,this.notifier)(r0)}catch(s0){return t0.prototype.error.call(this,s0)}o0=ic(i0,new vc(this))}this._unsubscribeAndRecycle(),this.errors=r0,this.retries=i0,this.retriesSubscription=o0,r0.next(n0)}},e0.prototype._unsubscribe=function(){var n0=this.errors,r0=this.retriesSubscription;n0&&(n0.unsubscribe(),this.errors=void 0),r0&&(r0.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e0.prototype.notifyNext=function(){var n0=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=n0,this.source.subscribe(this)},e0}(wc),Et=function(){function t0(e0){this.project=e0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Sz(e0,this.project))},t0}(),Sz=function(t0){function e0(n0,r0){return(n0=t0.call(this,n0)||this).project=r0,n0.index=0,n0}return O(e0,t0),e0.prototype._next=function(n0){var r0=this.index++;try{var i0=this.project(n0,r0)}catch(o0){return void this.destination.error(o0)}this._innerSub(i0)},e0.prototype._innerSub=function(n0){var r0=this.innerSubscription;r0&&r0.unsubscribe(),r0=new vc(this);var i0=this.destination;i0.add(r0),this.innerSubscription=ic(n0,r0),this.innerSubscription!==r0&&i0.add(this.innerSubscription)},e0.prototype._complete=function(){var n0=this.innerSubscription;n0&&!n0.closed||t0.prototype._complete.call(this),this.unsubscribe()},e0.prototype._unsubscribe=function(){this.innerSubscription=void 0},e0.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t0.prototype._complete.call(this)},e0.prototype.notifyNext=function(n0){this.destination.next(n0)},e0}(wc),Ft=function(){function t0(e0){this.notifier=e0}return t0.prototype.call=function(e0,n0){e0=new Tz(e0);var r0=ic(this.notifier,new vc(e0));return r0&&!e0.seenValue?(e0.add(r0),n0.subscribe(e0)):e0},t0}(),Tz=function(t0){function e0(n0){return(n0=t0.call(this,n0)||this).seenValue=!1,n0}return O(e0,t0),e0.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},e0.prototype.notifyComplete=function(){},e0}(wc),Ht=function(){function t0(e0,n0){this.predicate=e0,this.inclusive=n0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Uz(e0,this.predicate,this.inclusive))},t0}(),Uz=function(t0){function e0(n0,r0,i0){return(n0=t0.call(this,n0)||this).predicate=r0,n0.inclusive=i0,n0.index=0,n0}return O(e0,t0),e0.prototype._next=function(n0){var r0=this.destination;try{var i0=this.predicate(n0,this.index++)}catch(o0){return void r0.error(o0)}this.nextOrComplete(n0,i0)},e0.prototype.nextOrComplete=function(n0,r0){var i0=this.destination;r0?i0.next(n0):(this.inclusive&&i0.next(n0),i0.complete())},e0}(ia),It=function(){function t0(e0,n0,r0){this.nextOrObserver=e0,this.error=n0,this.complete=r0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Vz(e0,this.nextOrObserver,this.error,this.complete))},t0}(),Vz=function(t0){function e0(n0,r0,i0,o0){return(n0=t0.call(this,n0)||this)._tapNext=hc,n0._tapError=hc,n0._tapComplete=hc,n0._tapError=i0||hc,n0._tapComplete=o0||hc,le(r0)?(n0._context=n0,n0._tapNext=r0):r0&&(n0._context=r0,n0._tapNext=r0.next||hc,n0._tapError=r0.error||hc,n0._tapComplete=r0.complete||hc),n0}return O(e0,t0),e0.prototype._next=function(n0){try{this._tapNext.call(this._context,n0)}catch(r0){return void this.destination.error(r0)}this.destination.next(n0)},e0.prototype._error=function(n0){try{this._tapError.call(this._context,n0)}catch(r0){return void this.destination.error(r0)}this.destination.error(n0)},e0.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(n0){return void this.destination.error(n0)}return this.destination.complete()},e0}(ia),Kt={leading:!0,trailing:!1};(function(t0){function e0(n0,r0,i0,o0){var s0=t0.call(this,n0)||this;return s0.destination=n0,s0.durationSelector=r0,s0._leading=i0,s0._trailing=o0,s0._hasValue=!1,s0}O(e0,t0),e0.prototype._next=function(n0){this._hasValue=!0,this._sendValue=n0,this._throttled||(this._leading?this.send():this.throttle(n0))},e0.prototype.send=function(){var n0=this._sendValue;this._hasValue&&(this.destination.next(n0),this.throttle(n0)),this._hasValue=!1,this._sendValue=void 0},e0.prototype.throttle=function(n0){(n0=this.tryDurationSelector(n0))&&this.add(this._throttled=ic(n0,new vc(this)))},e0.prototype.tryDurationSelector=function(n0){try{return this.durationSelector(n0)}catch(r0){return this.destination.error(r0),null}},e0.prototype.throttlingDone=function(){var n0=this._throttled,r0=this._trailing;n0&&n0.unsubscribe(),this._throttled=void 0,r0&&this.send()},e0.prototype.notifyNext=function(){this.throttlingDone()},e0.prototype.notifyComplete=function(){this.throttlingDone()}})(wc);for(var Lt=function(){function t0(e0,n0,r0,i0){this.duration=e0,this.scheduler=n0,this.leading=r0,this.trailing=i0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Wz(e0,this.duration,this.scheduler,this.leading,this.trailing))},t0}(),Wz=function(t0){function e0(n0,r0,i0,o0,s0){return(n0=t0.call(this,n0)||this).duration=r0,n0.scheduler=i0,n0.leading=o0,n0.trailing=s0,n0._hasTrailingValue=!1,n0._trailingValue=null,n0}return O(e0,t0),e0.prototype._next=function(n0){this.throttled?this.trailing&&(this._trailingValue=n0,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(n0):this.trailing&&(this._trailingValue=n0,this._hasTrailingValue=!0))},e0.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},e0.prototype.clearThrottle=function(){var n0=this.throttled;n0&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),n0.unsubscribe(),this.remove(n0),this.throttled=null)},e0}(ia),Ot=function(){function t0(e0,n0,r0,i0){this.waitFor=e0,this.absoluteTimeout=n0,this.withObservable=r0,this.scheduler=i0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Xz(e0,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t0}(),Xz=function(t0){function e0(n0,r0,i0,o0,s0){return(n0=t0.call(this,n0)||this).absoluteTimeout=r0,n0.waitFor=i0,n0.withObservable=o0,n0.scheduler=s0,n0.scheduleTimeout(),n0}return O(e0,t0),e0.dispatchTimeout=function(n0){var r0=n0.withObservable;n0._unsubscribeAndRecycle(),n0.add(ic(r0,new vc(n0)))},e0.prototype.scheduleTimeout=function(){var n0=this.action;n0?this.action=n0.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e0.dispatchTimeout,this.waitFor,this))},e0.prototype._next=function(n0){this.absoluteTimeout||this.scheduleTimeout(),t0.prototype._next.call(this,n0)},e0.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},e0}(wc),Qt=function(){function t0(e0,n0){this.observables=e0,this.project=n0}return t0.prototype.call=function(e0,n0){return n0.subscribe(new Yz(e0,this.observables,this.project))},t0}(),Yz=function(t0){function e0(n0,r0,i0){(n0=t0.call(this,n0)||this).observables=r0,n0.project=i0,n0.toRespond=[],i0=r0.length,n0.values=Array(i0);for(var o0=0;o0<i0;o0++)n0.toRespond.push(o0);for(o0=0;o0<i0;o0++)n0.add(ji(n0,r0[o0],void 0,o0));return n0}return O(e0,t0),e0.prototype.notifyNext=function(n0,r0,i0){this.values[i0]=r0,0<(n0=this.toRespond).length&&(i0=n0.indexOf(i0))!==-1&&n0.splice(i0,1)},e0.prototype.notifyComplete=function(){},e0.prototype._next=function(n0){this.toRespond.length===0&&(n0=[n0].concat(this.values),this.project?this._tryProject(n0):this.destination.next(n0))},e0.prototype._tryProject=function(n0){try{var r0=this.project.apply(this,n0)}catch(i0){return void this.destination.error(i0)}this.destination.next(r0)},e0}(Rk),Jq=$a(function(t0){var e0=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(e0){var n0=new Uint8Array(16);t0.exports=function(){return e0(n0),n0}}else{var r0=Array(16);t0.exports=function(){for(var i0,o0=0;16>o0;o0++)!(3&o0)&&(i0=4294967296*Math.random()),r0[o0]=i0>>>((3&o0)<<3)&255;return r0}}}),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(t0,e0){return e0=e0||0,[ab[t0[e0++]],ab[t0[e0++]],ab[t0[e0++]],ab[t0[e0++]],"-",ab[t0[e0++]],ab[t0[e0++]],"-",ab[t0[e0++]],ab[t0[e0++]],"-",ab[t0[e0++]],ab[t0[e0++]],"-",ab[t0[e0++]],ab[t0[e0++]],ab[t0[e0++]],ab[t0[e0++]],ab[t0[e0++]],ab[t0[e0++]]].join("")},Ud=function(t0,e0,n0){if(n0=e0&&n0||0,typeof t0=="string"&&(e0=t0==="binary"?Array(16):null,t0=null),(t0=(t0=t0||{}).random||(t0.rng||Jq)())[6]=15&t0[6]|64,t0[8]=63&t0[8]|128,e0)for(var r0=0;16>r0;++r0)e0[n0+r0]=t0[r0];return e0||Kq(t0)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;(function(t0){t0[t0.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",t0[t0.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",t0[t0.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",t0[t0.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",t0[t0.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",t0[t0.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",t0[t0.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(Pc||(Pc={})),function(t0){t0[t0.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",t0[t0.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",t0[t0.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",t0[t0.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",t0[t0.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",t0[t0.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(t0){t0[t0.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(t0){t0[t0.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(t0){t0[t0.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",t0[t0.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",t0[t0.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",t0[t0.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",t0[t0.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",t0[t0.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(t0){t0[t0.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",t0[t0.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",t0[t0.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",t0[t0.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",t0[t0.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(t0){t0[t0.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",t0[t0.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",t0[t0.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",t0[t0.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",t0[t0.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",t0[t0.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",t0[t0.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",t0[t0.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",t0[t0.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",t0[t0.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",t0[t0.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(t0){t0[t0.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",t0[t0.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",t0[t0.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",t0[t0.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(t0){t0[t0.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",t0[t0.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",t0[t0.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",t0[t0.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",t0[t0.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",t0[t0.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",t0[t0.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",t0[t0.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",t0[t0.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",t0[t0.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",t0[t0.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(t0){t0[t0.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(t0){t0[t0.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",t0[t0.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",t0[t0.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",t0[t0.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",t0[t0.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",t0[t0.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",t0[t0.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(t0){t0[t0.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",t0[t0.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",t0[t0.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",t0[t0.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",t0[t0.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(t0){t0[t0.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",t0[t0.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",t0[t0.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",t0[t0.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",t0[t0.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",t0[t0.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",t0[t0.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",t0[t0.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(t0){t0[t0.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",t0[t0.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",t0[t0.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",t0[t0.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",t0[t0.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",t0[t0.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",t0[t0.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(t0){t0[t0.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",t0[t0.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",t0[t0.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",t0[t0.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",t0[t0.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",t0[t0.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",t0[t0.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(t0){t0[t0.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",t0[t0.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",t0[t0.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",t0[t0.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(t0){t0[t0.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",t0[t0.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",t0[t0.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",t0[t0.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",t0[t0.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",t0[t0.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",t0[t0.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(t0){t0[t0.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",t0[t0.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",t0[t0.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",t0[t0.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",t0[t0.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",t0[t0.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",t0[t0.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(t0,e0){var n0;return Hk(t0,function(r0,i0,o0){return!(n0=e0(r0,i0,o0))}),!!n0},Mh=function(t0,e0,n0){if(!lb(n0))return!1;var r0=X(e0);return!!(r0=="number"?Ed(n0)&&wk(e0,n0.length):r0=="string"&&e0 in n0)&&$f(n0[e0],t0)},dl=function(t0,e0,n0){var r0=Va(t0)?tq:DA;return n0&&Mh(t0,e0,n0)&&(e0=void 0),r0(t0,Te(e0))},EA=function(t0,e0){var n0=-1,r0=Ed(t0)?Array(t0.length):[];return Hk(t0,function(i0,o0,s0){r0[++n0]=e0(i0,o0,s0)}),r0},FA=function(t0,e0){var n0=t0.length;for(t0.sort(e0);n0--;)t0[n0]=t0[n0].value;return t0},GA=function(t0,e0,n0){e0=e0.length?he(e0,function(i0){return Va(i0)?function(o0){return Ch(o0,i0.length===1?i0[0]:i0)}:i0}):[Dh];var r0=-1;return e0=he(e0,zh(Te)),t0=EA(t0,function(i0,o0,s0){return{criteria:he(e0,function(a0){return a0(i0)}),index:++r0,value:i0}}),FA(t0,function(i0,o0){t:{for(var s0=-1,a0=i0.criteria,c0=o0.criteria,u0=a0.length,l0=n0.length;++s0<u0;){e:{var d0=a0[s0],h0=c0[s0];if(d0!==h0){var p0=d0!==void 0,m0=d0===null,f0=d0==d0,g0=ie(d0),E0=h0!==void 0,_0=h0===null,y0=h0==h0,b0=ie(h0);if(!_0&&!b0&&!g0&&d0>h0||g0&&E0&&y0&&!_0&&!b0||m0&&E0&&y0||!p0&&y0||!f0){d0=1;break e}if(!m0&&!g0&&!b0&&d0<h0||b0&&p0&&f0&&!m0&&!g0||_0&&p0&&f0||!E0&&f0||!y0){d0=-1;break e}}d0=0}if(d0){i0=s0>=l0?d0:d0*(n0[s0]=="desc"?-1:1);break t}}i0=i0.index-o0.index}return i0})},jr=function(t0,e0){return rq(qq(t0,e0,Dh),t0+"")},kr=jr(function(t0,e0){if(t0==null)return[];var n0=e0.length;return 1<n0&&Mh(t0,e0[0],e0[1])?e0=[]:2<n0&&Mh(e0[0],e0[1],e0[2])&&(e0=[e0[0]]),GA(t0,$h(e0,1),[])}),lr=function(t0){if(t0.__esModule)return t0;var e0=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t0).forEach(function(n0){var r0=Object.getOwnPropertyDescriptor(t0,n0);Object.defineProperty(e0,n0,r0.get?r0:{enumerable:!0,get:function(){return t0[n0]}})}),e0}(Dz),mr=$a(function(t0,e0){Object.defineProperty(e0,"__esModule",{value:!0});var n0=[],r0=function(i0,o0){return new WebSocket(i0,o0)};e0.normalClosureMessage="Normal closure",e0.default=function(i0,o0){var s0=(o0=o0===void 0?{protocols:n0,makeWebSocket:r0}:o0).protocols,a0=s0===void 0?n0:s0,c0=(o0=o0.makeWebSocket)===void 0?r0:o0;return new lr.Observable(function(u0){var l0,d0=new lr.Subject,h0=c0(i0,a0),p0=!1,m0=!1,f0=function(g0){if(l0)throw p0=!0,g0=Error("Web socket message factory function called more than once"),u0.error(g0),g0;return l0=g0.subscribe(function(E0){h0.send(E0)}),d0};return h0.onopen=function(){m0?(p0=!0,h0.close()):u0.next(f0)},h0.onmessage=function(g0){d0.next(g0.data)},h0.onerror=function(g0){p0=!0,u0.error(Error(g0.message))},h0.onclose=function(g0){p0||(p0=!0,m0?(u0.complete(),d0.complete()):u0.error(Error(g0.code===1e3?e0.normalClosureMessage:g0.reason)))},function(){m0=!0,l0&&l0.unsubscribe(),p0||(p0=!0,h0.close())}})}});(function(t0){t0&&t0.__esModule&&Object.prototype.hasOwnProperty.call(t0,"default")&&t0.default})(mr);var pi=function(t0,e0,n0){(n0===void 0||$f(t0[e0],n0))&&(n0!==void 0||e0 in t0)||bg(t0,e0,n0)},oi=function(t0,e0){if((e0!=="constructor"||typeof t0[e0]!="function")&&e0!="__proto__")return t0[e0]},HA=function(t0){return jr(function(e0,n0){var r0=-1,i0=n0.length,o0=1<i0?n0[i0-1]:void 0,s0=2<i0?n0[2]:void 0;for(o0=3<t0.length&&typeof o0=="function"?(i0--,o0):void 0,s0&&Mh(n0[0],n0[1],s0)&&(o0=3>i0?void 0:o0,i0=1),e0=Object(e0);++r0<i0;)(s0=n0[r0])&&t0(e0,s0,r0,o0);return e0})}(function(t0,e0,n0,r0){tm(t0,e0,n0,r0)}),IA=Math.floor,JA=Math.random,nr=function(t0,e0){return t0+IA(JA()*(e0-t0+1))},or=function(t0){var e0=t0.length;return e0?t0[nr(0,e0-1)]:void 0},KA=function(t0,e0){return he(e0,function(n0){return t0[n0]})},Ni=function(t0){return t0==null?[]:KA(t0,Ad(t0))},LA=function(t0){return or(Ni(t0))},bn=function(t0){return(Va(t0)?or:LA)(t0)},xm=[],ym=function(t0,e0){return new WebSocket(t0,e0)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(t0){return!ha(t0)&&isFinite(t0)&&MA(t0)===t0}}),Oo("from",Ej,Dj);var NA=function(t0,e0){for(var n0=Array(arguments.length-1),r0=0,i0=2,o0=!0;i0<arguments.length;)n0[r0++]=arguments[i0++];return new Promise(function(s0,a0){n0[r0]=function(c0){if(o0)if(o0=!1,c0)a0(c0);else{for(var u0=Array(arguments.length-1),l0=0;l0<u0.length;)u0[l0++]=arguments[l0];s0.apply(null,u0)}};try{t0.apply(e0||null,n0)}catch(c0){o0&&(o0=!1,a0(c0))}})},OA=$a(function(t0,e0){e0.length=function(i0){var o0=i0.length;if(!o0)return 0;for(var s0=0;1<--o0%4&&i0.charAt(o0)==="=";)++s0;return Math.ceil(3*i0.length)/4-s0};var n0=Array(64),r0=Array(123);for(t0=0;64>t0;)r0[n0[t0]=26>t0?t0+65:52>t0?t0+71:62>t0?t0-4:t0-59|43]=t0++;e0.encode=function(i0,o0,s0){for(var a0,c0=null,u0=[],l0=0,d0=0;o0<s0;){var h0=i0[o0++];switch(d0){case 0:u0[l0++]=n0[h0>>2],a0=(3&h0)<<4,d0=1;break;case 1:u0[l0++]=n0[a0|h0>>4],a0=(15&h0)<<2,d0=2;break;case 2:u0[l0++]=n0[a0|h0>>6],u0[l0++]=n0[63&h0],d0=0}8191<l0&&((c0||(c0=[])).push(String.fromCharCode.apply(String,u0)),l0=0)}return d0&&(u0[l0++]=n0[a0],u0[l0++]=61,d0===1&&(u0[l0++]=61)),c0?(l0&&c0.push(String.fromCharCode.apply(String,u0.slice(0,l0))),c0.join("")):String.fromCharCode.apply(String,u0.slice(0,l0))},e0.decode=function(i0,o0,s0){for(var a0,c0=s0,u0=0,l0=0;l0<i0.length;){var d0=i0.charCodeAt(l0++);if(d0===61&&1<u0)break;if((d0=r0[d0])===void 0)throw Error("invalid encoding");switch(u0){case 0:a0=d0,u0=1;break;case 1:o0[s0++]=a0<<2|(48&d0)>>4,a0=d0,u0=2;break;case 2:o0[s0++]=(15&a0)<<4|(60&d0)>>2,a0=d0,u0=3;break;case 3:o0[s0++]=(3&a0)<<6|d0,u0=0}}if(u0===1)throw Error("invalid encoding");return s0-c0},e0.test=function(i0){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(i0)}});yg.prototype.on=function(t0,e0,n0){return(this._listeners[t0]||(this._listeners[t0]=[])).push({fn:e0,ctx:n0||this}),this},yg.prototype.off=function(t0,e0){if(t0===void 0)this._listeners={};else if(e0===void 0)this._listeners[t0]=[];else{t0=this._listeners[t0];for(var n0=0;n0<t0.length;)t0[n0].fn===e0?t0.splice(n0,1):++n0}return this},yg.prototype.emit=function(t0){var e0=this._listeners[t0];if(e0){for(var n0=[],r0=1;r0<arguments.length;)n0.push(arguments[r0++]);for(r0=0;r0<e0.length;)e0[r0].fn.apply(e0[r0++].ctx,n0)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(t0){}return null},RA=$a(function(t0,e0){e0.length=function(n0){for(var r0,i0=0,o0=0;o0<n0.length;++o0)128>(r0=n0.charCodeAt(o0))?i0+=1:2048>r0?i0+=2:(64512&r0)==55296&&(64512&n0.charCodeAt(o0+1))==56320?(++o0,i0+=4):i0+=3;return i0},e0.read=function(n0,r0,i0){if(1>i0-r0)return"";for(var o0,s0=null,a0=[],c0=0;r0<i0;)128>(o0=n0[r0++])?a0[c0++]=o0:191<o0&&224>o0?a0[c0++]=(31&o0)<<6|63&n0[r0++]:239<o0&&365>o0?(o0=((7&o0)<<18|(63&n0[r0++])<<12|(63&n0[r0++])<<6|63&n0[r0++])-65536,a0[c0++]=55296+(o0>>10),a0[c0++]=56320+(1023&o0)):a0[c0++]=(15&o0)<<12|(63&n0[r0++])<<6|63&n0[r0++],8191<c0&&((s0||(s0=[])).push(String.fromCharCode.apply(String,a0)),c0=0);return s0?(c0&&s0.push(String.fromCharCode.apply(String,a0.slice(0,c0))),s0.join("")):String.fromCharCode.apply(String,a0.slice(0,c0))},e0.write=function(n0,r0,i0){for(var o0,s0,a0=i0,c0=0;c0<n0.length;++c0)128>(o0=n0.charCodeAt(c0))?r0[i0++]=o0:(2048>o0?r0[i0++]=o0>>6|192:((64512&o0)==55296&&(64512&(s0=n0.charCodeAt(c0+1)))==56320?(o0=65536+((1023&o0)<<10)+(1023&s0),++c0,r0[i0++]=o0>>18|240,r0[i0++]=o0>>12&63|128):r0[i0++]=o0>>12|224,r0[i0++]=o0>>6&63|128),r0[i0++]=63&o0|128);return i0-a0}}),SA=function(t0,e0,n0){var r0=n0||8192,i0=r0>>>1,o0=null,s0=r0;return function(a0){return 1>a0||a0>i0?t0(a0):(s0+a0>r0&&(o0=t0(r0),s0=0),a0=e0.call(o0,s0,s0+=a0),7&s0&&(s0=1+(7|s0)),a0)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(t0){if(t0===0)return Xd;var e0=0>t0;e0&&(t0=-t0);var n0=t0>>>0;return t0=(t0-n0)/4294967296>>>0,e0&&(t0=~t0>>>0,n0=~n0>>>0,4294967295<++n0&&(n0=0,4294967295<++t0&&(t0=0))),new Wa(n0,t0)},Wa.from=function(t0){if(typeof t0=="number")return Wa.fromNumber(t0);if(V.isString(t0)){if(!V.Long)return Wa.fromNumber(parseInt(t0,10));t0=V.Long.fromString(t0)}return t0.low||t0.high?new Wa(t0.low>>>0,t0.high>>>0):Xd},Wa.prototype.toNumber=function(t0){if(!t0&&this.hi>>>31){t0=1+~this.lo>>>0;var e0=~this.hi>>>0;return t0||(e0=e0+1>>>0),-(t0+4294967296*e0)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(t0){return V.Long?new V.Long(0|this.lo,0|this.hi,!!t0):{low:0|this.lo,high:0|this.hi,unsigned:!!t0}};var td=String.prototype.charCodeAt;Wa.fromHash=function(t0){return t0===TA?Xd:new Wa((td.call(t0,0)|td.call(t0,1)<<8|td.call(t0,2)<<16|td.call(t0,3)<<24)>>>0,(td.call(t0,4)|td.call(t0,5)<<8|td.call(t0,6)<<16|td.call(t0,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var t0=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t0)>>>0,this.lo=(this.lo<<1^t0)>>>0,this},Wa.prototype.zzDecode=function(){var t0=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t0)>>>0,this.hi=(this.hi>>>1^t0)>>>0,this},Wa.prototype.length=function(){var t0=this.lo,e0=(this.lo>>>28|this.hi<<4)>>>0,n0=this.hi>>>24;return n0===0?e0===0?16384>t0?128>t0?1:2:2097152>t0?3:4:16384>e0?128>e0?5:6:2097152>e0?7:8:128>n0?9:10};var V=$a(function(t0,e0){function n0(i0,o0,s0){for(var a0=Object.keys(o0),c0=0;c0<a0.length;++c0)i0[a0[c0]]!==void 0&&s0||(i0[a0[c0]]=o0[a0[c0]]);return i0}function r0(i0){function o0(s0,a0){if(!(this instanceof o0))return new o0(s0,a0);Object.defineProperty(this,"message",{get:function(){return s0}}),Error.captureStackTrace?Error.captureStackTrace(this,o0):Object.defineProperty(this,"stack",{value:Error().stack||""}),a0&&n0(this,a0)}return(o0.prototype=Object.create(Error.prototype)).constructor=o0,Object.defineProperty(o0.prototype,"name",{get:function(){return i0}}),o0.prototype.toString=function(){return this.name+": "+this.message},o0}e0.asPromise=NA,e0.base64=OA,e0.EventEmitter=yg,e0.float=PA,e0.inquire=QA,e0.utf8=RA,e0.pool=SA,e0.LongBits=Wa,e0.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),e0.global=e0.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,e0.emptyArray=Object.freeze?Object.freeze([]):[],e0.emptyObject=Object.freeze?Object.freeze({}):{},e0.isInteger=Number.isInteger||function(i0){return typeof i0=="number"&&isFinite(i0)&&Math.floor(i0)===i0},e0.isString=function(i0){return typeof i0=="string"||i0 instanceof String},e0.isObject=function(i0){return i0&&X(i0)==="object"},e0.isset=e0.isSet=function(i0,o0){var s0=i0[o0];return!(s0==null||!i0.hasOwnProperty(o0))&&(X(s0)!=="object"||0<(Array.isArray(s0)?s0.length:Object.keys(s0).length))},e0.Buffer=function(){try{var i0=e0.inquire("buffer").Buffer;return i0.prototype.utf8Write?i0:null}catch{return null}}(),e0._Buffer_from=null,e0._Buffer_allocUnsafe=null,e0.newBuffer=function(i0){return typeof i0=="number"?e0.Buffer?e0._Buffer_allocUnsafe(i0):new e0.Array(i0):e0.Buffer?e0._Buffer_from(i0):typeof Uint8Array>"u"?i0:new Uint8Array(i0)},e0.Array=typeof Uint8Array<"u"?Uint8Array:Array,e0.Long=e0.global.dcodeIO&&e0.global.dcodeIO.Long||e0.global.Long||e0.inquire("long"),e0.key2Re=/^true|false|0|1$/,e0.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e0.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e0.longToHash=function(i0){return i0?e0.LongBits.from(i0).toHash():e0.LongBits.zeroHash},e0.longFromHash=function(i0,o0){return i0=e0.LongBits.fromHash(i0),e0.Long?e0.Long.fromBits(i0.lo,i0.hi,o0):i0.toNumber(!!o0)},e0.merge=n0,e0.lcFirst=function(i0){return i0.charAt(0).toLowerCase()+i0.substring(1)},e0.newError=r0,e0.ProtocolError=r0("ProtocolError"),e0.oneOfGetter=function(i0){for(var o0={},s0=0;s0<i0.length;++s0)o0[i0[s0]]=1;return function(){for(var a0=Object.keys(this),c0=a0.length-1;-1<c0;--c0)if(o0[a0[c0]]===1&&this[a0[c0]]!==void 0&&this[a0[c0]]!==null)return a0[c0]}},e0.oneOfSetter=function(i0){return function(o0){for(var s0=0;s0<i0.length;++s0)i0[s0]!==o0&&delete this[i0[s0]]}},e0.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e0._configure=function(){var i0=e0.Buffer;i0?(e0._Buffer_from=i0.from!==Uint8Array.from&&i0.from||function(o0,s0){return new i0(o0,s0)},e0._Buffer_allocUnsafe=i0.allocUnsafe||function(o0){return new i0(o0)}):e0._Buffer_from=e0._Buffer_allocUnsafe=null}}),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(t0){return new V.Array(t0)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(t0,e0,n0){return this.tail=this.tail.next=new sf(t0,e0,n0),this.len+=e0,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(t0,e0,n0){for(;127<t0;)e0[n0++]=127&t0|128,t0>>>=7;e0[n0]=t0},ja.prototype.uint32=function(t0){return this.len+=(this.tail=this.tail.next=new ui(128>(t0>>>=0)?1:16384>t0?2:2097152>t0?3:268435456>t0?4:5,t0)).len,this},ja.prototype.int32=function(t0){return 0>t0?this._push(vi,10,Nh.fromNumber(t0)):this.uint32(t0)},ja.prototype.sint32=function(t0){return this.uint32((t0<<1^t0>>31)>>>0)},ja.prototype.uint64=function(t0){return t0=Nh.from(t0),this._push(vi,t0.length(),t0)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(t0){return t0=Nh.from(t0).zzEncode(),this._push(vi,t0.length(),t0)},ja.prototype.bool=function(t0){return this._push(ti,1,t0?1:0)},ja.prototype.fixed32=function(t0){return this._push(wi,4,t0>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(t0){return t0=Nh.from(t0),this._push(wi,4,t0.lo)._push(wi,4,t0.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(t0){return this._push(V.float.writeFloatLE,4,t0)},ja.prototype.double=function(t0){return this._push(V.float.writeDoubleLE,8,t0)};var UA=V.Array.prototype.set?function(t0,e0,n0){e0.set(t0,n0)}:function(t0,e0,n0){for(var r0=0;r0<t0.length;++r0)e0[n0+r0]=t0[r0]};ja.prototype.bytes=function(t0){var e0=t0.length>>>0;if(!e0)return this._push(ti,1,0);if(V.isString(t0)){var n0=ja.alloc(e0=pr.length(t0));pr.decode(t0,n0,0),t0=n0}return this.uint32(e0)._push(UA,e0,t0)},ja.prototype.string=function(t0){var e0=qr.length(t0);return e0?this.uint32(e0)._push(qr.write,e0,t0):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var t0=this.head,e0=this.tail,n0=this.len;return this.reset().uint32(n0),n0&&(this.tail.next=t0.next,this.tail=e0,this.len+=n0),this},ja.prototype.finish=function(){for(var t0=this.head.next,e0=this.constructor.alloc(this.len),n0=0;t0;)t0.fn(t0.val,e0,n0),n0+=t0.len,t0=t0.next;return e0},ja._configure=function(t0){el=t0,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&V.Buffer.prototype.set.name==="set"?function(t0,e0,n0){e0.set(t0,n0)}:function(t0,e0,n0){if(t0.copy)t0.copy(e0,n0,0,t0.length);else for(var r0=0;r0<t0.length;)e0[n0++]=t0[r0++]}},jc.prototype.bytes=function(t0){V.isString(t0)&&(t0=V._Buffer_from(t0,"base64"));var e0=t0.length>>>0;return this.uint32(e0),e0&&this._push(jc.writeBytesBuffer,e0,t0),this},jc.prototype.string=function(t0){var e0=V.Buffer.byteLength(t0);return this.uint32(e0),e0&&this._push(Ut,e0,t0),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr=typeof Uint8Array<"u"?function(t0){if(t0 instanceof Uint8Array||Array.isArray(t0))return new La(t0);throw Error("illegal buffer")}:function(t0){if(Array.isArray(t0))return new La(t0);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(t0){return(La.create=function(e0){return V.Buffer.isBuffer(e0)?new fl(e0):sr(e0)})(t0)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var t0=4294967295;return function(){if(t0=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(t0=(t0|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(t0=(t0|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(t0=(t0|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(t0=(t0|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return t0;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return t0}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var t0=this.uint32();return t0>>>1^-(1&t0)|0},La.prototype.bool=function(){return this.uint32()!==0},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var t0=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t0},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var t0=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t0},La.prototype.bytes=function(){var t0=this.uint32(),e0=this.pos,n0=this.pos+t0;if(n0>this.len)throw Yb(this,t0);return this.pos+=t0,Array.isArray(this.buf)?this.buf.slice(e0,n0):e0===n0?new this.buf.constructor(0):this._slice.call(this.buf,e0,n0)},La.prototype.string=function(){var t0=this.bytes();return VA.read(t0,0,t0.length)},La.prototype.skip=function(t0){if(typeof t0=="number"){if(this.pos+t0>this.len)throw Yb(this,t0);this.pos+=t0}else do if(this.pos>=this.len)throw Yb(this);while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(t0){switch(t0){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t0=7&this.uint32())!=4;)this.skipType(t0);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t0+" at offset "+this.pos)}return this},La._configure=function(t0){fl=t0,La.create=tr(),fl._configure();var e0=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[e0](!1)},uint64:function(){return yi.call(this)[e0](!0)},sint64:function(){return yi.call(this).zzDecode()[e0](!1)},fixed64:function(){return Fm.call(this)[e0](!0)},sfixed64:function(){return Fm.call(this)[e0](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var t0=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t0,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t0,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function t0(e0,n0,r0,i0,o0){if(!i0)throw TypeError("request must be specified");var s0=this;if(!o0)return V.asPromise(t0,s0,e0,n0,r0,i0);if(s0.rpcImpl)try{return s0.rpcImpl(e0,n0[s0.requestDelimited?"encodeDelimited":"encode"](i0).finish(),function(a0,c0){if(a0)return s0.emit("error",a0,e0),o0(a0);if(c0!==null){if(!(c0 instanceof r0))try{c0=r0[s0.responseDelimited?"decodeDelimited":"decode"](c0)}catch(u0){return s0.emit("error",u0,e0),o0(u0)}return s0.emit("data",c0,e0),o0(null,c0)}s0.end(!0)})}catch(a0){s0.emit("error",a0,e0),setTimeout(function(){o0(a0)},0)}else setTimeout(function(){o0(Error("already ended"))},0)},tf.prototype.end=function(t0){return this.rpcImpl&&(t0||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a(function(t0,e0){e0.Service=tf}),XA={},fc=$a(function(t0,e0){function n0(){r0.util._configure(),r0.Writer._configure(r0.BufferWriter),r0.Reader._configure(r0.BufferReader)}var r0=e0;r0.build="minimal",r0.Writer=xi,r0.BufferWriter=jc,r0.Reader=zi,r0.BufferReader=Fd,r0.util=V,r0.rpc=WA,r0.roots=XA,r0.configure=n0,n0()});fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var t0={},e0=Object.create(t0);return e0[t0[0]="Unknown"]=0,e0[t0[1]="PingUri"]=1,e0[t0[2]="PongUri"]=2,e0[t0[11]="UserJoinUri"]=11,e0[t0[12]="UserRespUri"]=12,e0[t0[21]="UserQuitUri"]=21,e0[t0[22]="UserDropUri"]=22,e0[t0[31]="GroupEnterUri"]=31,e0[t0[32]="GroupLeaveUri"]=32,e0[t0[33]="GroupReplyUri"]=33,e0[t0[36]="GroupEnterNoticeUri"]=36,e0[t0[37]="GroupLeaveNoticeUri"]=37,e0[t0[38]="GroupEventNoticeUri"]=38,e0[t0[39]="GroupCountNoticeUri"]=39,e0[t0[41]="UserStatusListUri"]=41,e0[t0[42]="UserStatusResultUri"]=42,e0[t0[51]="GroupStatusListUri"]=51,e0[t0[52]="GroupStatusResultUri"]=52,e0[t0[55]="GroupAllUsersListUri"]=55,e0[t0[56]="GroupAllUsersResultUri"]=56,e0[t0[100]="MessageUri"]=100,e0[t0[101]="AckUri"]=101,e0[t0[115]="FileUploadIndexGetUri"]=115,e0[t0[116]="FileUploadIndexRetUri"]=116,e0[t0[117]="FileUploadIndexSetUri"]=117,e0[t0[118]="FileUploadIndexFinUri"]=118,e0[t0[119]="FileUploadIndexErrUri"]=119,e0[t0[125]="FileDownloadIndexGetUri"]=125,e0[t0[126]="FileDownloadIndexRetUri"]=126,e0[t0[127]="FileDownloadIndexErrUri"]=127,e0[t0[201]="UserJoinNoticeUri"]=201,e0[t0[202]="UserQuitNoticeUri"]=202,e0[t0[203]="UserWaitNoticeUri"]=203,e0[t0[301]="UserAttributeGetUri"]=301,e0[t0[302]="UserAttributeRetUri"]=302,e0[t0[303]="UserAttributeSetUri"]=303,e0[t0[304]="UserAttributeModUri"]=304,e0[t0[305]="UserAttributeDelUri"]=305,e0[t0[307]="UserAttributeRspUri"]=307,e0[t0[308]="UserAttributeErrUri"]=308,e0[t0[311]="UserAttributeKeysGetUri"]=311,e0[t0[312]="UserAttributeKeysRetUri"]=312,e0[t0[351]="GroupAttributeGetUri"]=351,e0[t0[352]="GroupAttributeRetUri"]=352,e0[t0[353]="GroupAttributeSetUri"]=353,e0[t0[354]="GroupAttributeModUri"]=354,e0[t0[355]="GroupAttributeDelUri"]=355,e0[t0[356]="GroupAttributeAltUri"]=356,e0[t0[357]="GroupAttributeRspUri"]=357,e0[t0[358]="GroupAttributeErrUri"]=358,e0[t0[361]="GroupAttributeKeysGetUri"]=361,e0[t0[362]="GroupAttributeKeysRetUri"]=362,e0[t0[401]="SubscribeUserStatusUri"]=401,e0[t0[402]="UnsubscribeUserStatusUri"]=402,e0[t0[499]="SubscribeResponseUri"]=499,e0}(),Oh=t.Wrapper=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.uri=0,t0.prototype.data=q.newBuffer([]),t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.uri!=null&&Object.hasOwnProperty.call(e0,"uri")&&n0.uint32(8).int32(e0.uri),e0.data!=null&&Object.hasOwnProperty.call(e0,"data")&&n0.uint32(18).bytes(e0.data),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.Wrapper;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.uri=e0.int32();break;case 2:r0.data=e0.bytes();break;default:e0.skipType(7&i0)}}return r0},t0}(),ZA=t.Ping=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.ms!=null&&Object.hasOwnProperty.call(e0,"ms")&&n0.uint32(16).uint64(e0.ms),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.Ping;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.ms=e0.uint64();break;default:e0.skipType(7&i0)}}return r0},t0}(),$A=t.Pong=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.ms!=null&&Object.hasOwnProperty.call(e0,"ms")&&n0.uint32(16).uint64(e0.ms),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.Pong;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.ms=e0.uint64();break;default:e0.skipType(7&i0)}}return r0},t0}(),aB=t.UserJoin=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.account="",t0.prototype.ticket="",t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.opt!=null&&Object.hasOwnProperty.call(e0,"opt")&&n0.uint32(16).uint64(e0.opt),e0.instance!=null&&Object.hasOwnProperty.call(e0,"instance")&&n0.uint32(24).uint64(e0.instance),e0.account!=null&&Object.hasOwnProperty.call(e0,"account")&&n0.uint32(34).string(e0.account),e0.ticket!=null&&Object.hasOwnProperty.call(e0,"ticket")&&n0.uint32(42).string(e0.ticket),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserJoin;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.opt=e0.uint64();break;case 3:r0.instance=e0.uint64();break;case 4:r0.account=e0.string();break;case 5:r0.ticket=e0.string();break;default:e0.skipType(7&i0)}}return r0},t0}(),bB=t.UserResp=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.account="",t0.prototype.code=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.account!=null&&Object.hasOwnProperty.call(e0,"account")&&n0.uint32(18).string(e0.account),e0.code!=null&&Object.hasOwnProperty.call(e0,"code")&&n0.uint32(24).uint32(e0.code),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserResp;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.account=e0.string();break;case 3:r0.code=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),cB=t.UserQuit=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.encode=function(e0,n0){return n0||(n0=L.create()),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserQuit;e0.pos<n0;){var i0=e0.uint32();e0.skipType(7&i0)}return r0},t0}(),dB=t.UserDrop=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.code=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.code!=null&&Object.hasOwnProperty.call(e0,"code")&&n0.uint32(8).uint32(e0.code),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserDrop;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.code=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),eB=t.GroupEnter=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.account="",t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.account!=null&&Object.hasOwnProperty.call(e0,"account")&&n0.uint32(18).string(e0.account),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupEnter;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.account=e0.string();break;default:e0.skipType(7&i0)}}return r0},t0}(),fB=t.GroupLeave=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.account="",t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.account!=null&&Object.hasOwnProperty.call(e0,"account")&&n0.uint32(10).string(e0.account),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupLeave;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.account=e0.string();break;default:e0.skipType(7&i0)}}return r0},t0}(),gB=t.GroupReply=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.account="",t0.prototype.code=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.account!=null&&Object.hasOwnProperty.call(e0,"account")&&n0.uint32(18).string(e0.account),e0.code!=null&&Object.hasOwnProperty.call(e0,"code")&&n0.uint32(24).uint32(e0.code),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupReply;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.account=e0.string();break;case 3:r0.code=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),ur=t.GroupLeaveNotice=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.user="",t0.prototype.group="",t0.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.size=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.user!=null&&Object.hasOwnProperty.call(e0,"user")&&n0.uint32(18).string(e0.user),e0.group!=null&&Object.hasOwnProperty.call(e0,"group")&&n0.uint32(26).string(e0.group),e0.instance!=null&&Object.hasOwnProperty.call(e0,"instance")&&n0.uint32(32).uint64(e0.instance),e0.size!=null&&Object.hasOwnProperty.call(e0,"size")&&n0.uint32(40).uint32(e0.size),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupLeaveNotice;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.user=e0.string();break;case 3:r0.group=e0.string();break;case 4:r0.instance=e0.uint64();break;case 5:r0.size=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),vr=t.GroupEnterNotice=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.user="",t0.prototype.group="",t0.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.size=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.user!=null&&Object.hasOwnProperty.call(e0,"user")&&n0.uint32(18).string(e0.user),e0.group!=null&&Object.hasOwnProperty.call(e0,"group")&&n0.uint32(26).string(e0.group),e0.instance!=null&&Object.hasOwnProperty.call(e0,"instance")&&n0.uint32(32).uint64(e0.instance),e0.size!=null&&Object.hasOwnProperty.call(e0,"size")&&n0.uint32(40).uint32(e0.size),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupEnterNotice;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.user=e0.string();break;case 3:r0.group=e0.string();break;case 4:r0.instance=e0.uint64();break;case 5:r0.size=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),wr=t.Message=function(){function t0(e0){if(this.MiscMap={},e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.src="",t0.prototype.dst="",t0.prototype.payload=q.newBuffer([]),t0.prototype.MiscMap=q.emptyObject,t0.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.instance!=null&&Object.hasOwnProperty.call(e0,"instance")&&n0.uint32(8).uint64(e0.instance),e0.dialogue!=null&&Object.hasOwnProperty.call(e0,"dialogue")&&n0.uint32(16).uint64(e0.dialogue),e0.sequence!=null&&Object.hasOwnProperty.call(e0,"sequence")&&n0.uint32(24).uint64(e0.sequence),e0.options!=null&&Object.hasOwnProperty.call(e0,"options")&&n0.uint32(32).uint64(e0.options),e0.src!=null&&Object.hasOwnProperty.call(e0,"src")&&n0.uint32(42).string(e0.src),e0.dst!=null&&Object.hasOwnProperty.call(e0,"dst")&&n0.uint32(50).string(e0.dst),e0.payload!=null&&Object.hasOwnProperty.call(e0,"payload")&&n0.uint32(58).bytes(e0.payload),e0.MiscMap!=null&&Object.hasOwnProperty.call(e0,"MiscMap"))for(var r0=Object.keys(e0.MiscMap),i0=0;i0<r0.length;++i0)n0.uint32(66).fork().uint32(10).string(r0[i0]).uint32(18).bytes(e0.MiscMap[r0[i0]]).ldelim();return e0.ms!=null&&Object.hasOwnProperty.call(e0,"ms")&&n0.uint32(72).uint64(e0.ms),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0,i0,o0=new t.Message;e0.pos<n0;)switch(r0=e0.uint32(),r0>>>3){case 1:o0.instance=e0.uint64();break;case 2:o0.dialogue=e0.uint64();break;case 3:o0.sequence=e0.uint64();break;case 4:o0.options=e0.uint64();break;case 5:o0.src=e0.string();break;case 6:o0.dst=e0.string();break;case 7:o0.payload=e0.bytes();break;case 8:o0.MiscMap===q.emptyObject&&(o0.MiscMap={});var s0=e0.uint32()+e0.pos;for(r0="",i0=[];e0.pos<s0;){var a0=e0.uint32();switch(a0>>>3){case 1:r0=e0.string();break;case 2:i0=e0.bytes();break;default:e0.skipType(7&a0)}}o0.MiscMap[r0]=i0;break;case 9:o0.ms=e0.uint64();break;default:e0.skipType(7&r0)}return o0},t0}(),xr=t.Ack=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.code=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.instance!=null&&Object.hasOwnProperty.call(e0,"instance")&&n0.uint32(8).uint64(e0.instance),e0.dialogue!=null&&Object.hasOwnProperty.call(e0,"dialogue")&&n0.uint32(16).uint64(e0.dialogue),e0.sequence!=null&&Object.hasOwnProperty.call(e0,"sequence")&&n0.uint32(24).uint64(e0.sequence),e0.code!=null&&Object.hasOwnProperty.call(e0,"code")&&n0.uint32(32).uint32(e0.code),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.Ack;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.instance=e0.uint64();break;case 2:r0.dialogue=e0.uint64();break;case 3:r0.sequence=e0.uint64();break;case 4:r0.code=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),hB=t.FileUploadIndexGet=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.hash=q.newBuffer([]),t0.prototype.size=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.hash!=null&&Object.hasOwnProperty.call(e0,"hash")&&n0.uint32(18).bytes(e0.hash),e0.size!=null&&Object.hasOwnProperty.call(e0,"size")&&n0.uint32(24).uint32(e0.size),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.FileUploadIndexGet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.hash=e0.bytes();break;case 3:r0.size=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),iB=t.FileUploadIndexRet=function(){function t0(e0){if(this.servers=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.unit=0,t0.prototype.servers=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.unit!=null&&Object.hasOwnProperty.call(e0,"unit")&&n0.uint32(16).uint32(e0.unit),e0.servers!=null&&e0.servers.length){n0.uint32(26).fork();for(var r0=0;r0<e0.servers.length;++r0)n0.uint32(e0.servers[r0]);n0.ldelim()}return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.FileUploadIndexRet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.unit=e0.uint32();break;case 3:if(r0.servers&&r0.servers.length||(r0.servers=[]),(7&i0)==2)for(i0=e0.uint32()+e0.pos;e0.pos<i0;)r0.servers.push(e0.uint32());else r0.servers.push(e0.uint32());break;default:e0.skipType(7&i0)}}return r0},t0}(),jB=t.FileUploadIndexSet=function(){function t0(e0){if(this.servers=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.hash=q.newBuffer([]),t0.prototype.unit=0,t0.prototype.servers=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.hash!=null&&Object.hasOwnProperty.call(e0,"hash")&&n0.uint32(18).bytes(e0.hash),e0.unit!=null&&Object.hasOwnProperty.call(e0,"unit")&&n0.uint32(24).uint32(e0.unit),e0.servers!=null&&e0.servers.length){n0.uint32(34).fork();for(var r0=0;r0<e0.servers.length;++r0)n0.uint32(e0.servers[r0]);n0.ldelim()}return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.FileUploadIndexSet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.hash=e0.bytes();break;case 3:r0.unit=e0.uint32();break;case 4:if(r0.servers&&r0.servers.length||(r0.servers=[]),(7&i0)==2)for(i0=e0.uint32()+e0.pos;e0.pos<i0;)r0.servers.push(e0.uint32());else r0.servers.push(e0.uint32());break;default:e0.skipType(7&i0)}}return r0},t0}(),kB=t.FileUploadIndexFin=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.zone=0,t0.prototype.unit=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.zone!=null&&Object.hasOwnProperty.call(e0,"zone")&&n0.uint32(16).uint32(e0.zone),e0.unit!=null&&Object.hasOwnProperty.call(e0,"unit")&&n0.uint32(24).uint32(e0.unit),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.FileUploadIndexFin;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.zone=e0.uint32();break;case 3:r0.unit=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),lB=t.FileUploadIndexErr=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.code=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.code!=null&&Object.hasOwnProperty.call(e0,"code")&&n0.uint32(16).uint32(e0.code),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.FileUploadIndexErr;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.code=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),mB=t.FileDownloadIndexGet=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.zone=0,t0.prototype.hash=q.newBuffer([]),t0.prototype.size=0,t0.prototype.unit=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.zone!=null&&Object.hasOwnProperty.call(e0,"zone")&&n0.uint32(16).uint32(e0.zone),e0.hash!=null&&Object.hasOwnProperty.call(e0,"hash")&&n0.uint32(26).bytes(e0.hash),e0.size!=null&&Object.hasOwnProperty.call(e0,"size")&&n0.uint32(32).uint32(e0.size),e0.unit!=null&&Object.hasOwnProperty.call(e0,"unit")&&n0.uint32(40).uint32(e0.unit),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.FileDownloadIndexGet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.zone=e0.uint32();break;case 3:r0.hash=e0.bytes();break;case 4:r0.size=e0.uint32();break;case 5:r0.unit=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),nB=t.FileDownloadIndexRet=function(){function t0(e0){if(this.servers=[],this.backups=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.unit=0,t0.prototype.zone=0,t0.prototype.servers=q.emptyArray,t0.prototype.backups=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.unit!=null&&Object.hasOwnProperty.call(e0,"unit")&&n0.uint32(16).uint32(e0.unit),e0.zone!=null&&Object.hasOwnProperty.call(e0,"zone")&&n0.uint32(24).uint32(e0.zone),e0.servers!=null&&e0.servers.length){n0.uint32(34).fork();for(var r0=0;r0<e0.servers.length;++r0)n0.uint32(e0.servers[r0]);n0.ldelim()}if(e0.backups!=null&&e0.backups.length){for(n0.uint32(42).fork(),r0=0;r0<e0.backups.length;++r0)n0.uint32(e0.backups[r0]);n0.ldelim()}return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.FileDownloadIndexRet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.unit=e0.uint32();break;case 3:r0.zone=e0.uint32();break;case 4:if(r0.servers&&r0.servers.length||(r0.servers=[]),(7&i0)==2)for(i0=e0.uint32()+e0.pos;e0.pos<i0;)r0.servers.push(e0.uint32());else r0.servers.push(e0.uint32());break;case 5:if(r0.backups&&r0.backups.length||(r0.backups=[]),(7&i0)==2)for(i0=e0.uint32()+e0.pos;e0.pos<i0;)r0.backups.push(e0.uint32());else r0.backups.push(e0.uint32());break;default:e0.skipType(7&i0)}}return r0},t0}(),oB=t.FileDownloadIndexErr=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.code=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.code!=null&&Object.hasOwnProperty.call(e0,"code")&&n0.uint32(16).uint32(e0.code),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.FileDownloadIndexErr;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.code=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),pB=t.GroupAllUsersList=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.group="",t0.prototype.pageSize=0,t0.prototype.pageNumber=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.group!=null&&Object.hasOwnProperty.call(e0,"group")&&n0.uint32(18).string(e0.group),e0.pageSize!=null&&Object.hasOwnProperty.call(e0,"pageSize")&&n0.uint32(24).uint32(e0.pageSize),e0.pageNumber!=null&&Object.hasOwnProperty.call(e0,"pageNumber")&&n0.uint32(32).uint32(e0.pageNumber),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAllUsersList;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.group=e0.string();break;case 3:r0.pageSize=e0.uint32();break;case 4:r0.pageNumber=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),qB=t.GroupAllUsersResult=function(){function t0(e0){if(this.memberInfos=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.group="",t0.prototype.totalSize=0,t0.prototype.pageSize=0,t0.prototype.pageNumber=0,t0.prototype.memberInfos=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.group!=null&&Object.hasOwnProperty.call(e0,"group")&&n0.uint32(18).string(e0.group),e0.totalSize!=null&&Object.hasOwnProperty.call(e0,"totalSize")&&n0.uint32(24).uint32(e0.totalSize),e0.pageSize!=null&&Object.hasOwnProperty.call(e0,"pageSize")&&n0.uint32(32).uint32(e0.pageSize),e0.pageNumber!=null&&Object.hasOwnProperty.call(e0,"pageNumber")&&n0.uint32(40).uint32(e0.pageNumber),e0.memberInfos!=null&&e0.memberInfos.length)for(var r0=0;r0<e0.memberInfos.length;++r0)t.GroupAllUsersResult.MemberInfo.encode(e0.memberInfos[r0],n0.uint32(50).fork()).ldelim();return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAllUsersResult;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.group=e0.string();break;case 3:r0.totalSize=e0.uint32();break;case 4:r0.pageSize=e0.uint32();break;case 5:r0.pageNumber=e0.uint32();break;case 6:r0.memberInfos&&r0.memberInfos.length||(r0.memberInfos=[]),r0.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(e0,e0.uint32()));break;default:e0.skipType(7&i0)}}return r0},t0.MemberInfo=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.account="",e0.prototype.ts=0,e0.encode=function(n0,r0){return r0||(r0=L.create()),n0.account!=null&&Object.hasOwnProperty.call(n0,"account")&&r0.uint32(10).string(n0.account),n0.ts!=null&&Object.hasOwnProperty.call(n0,"ts")&&r0.uint32(16).uint32(n0.ts),r0},e0.decode=function(n0,r0){n0 instanceof u||(n0=u.create(n0)),r0=r0===void 0?n0.len:n0.pos+r0;for(var i0=new t.GroupAllUsersResult.MemberInfo;n0.pos<r0;){var o0=n0.uint32();switch(o0>>>3){case 1:i0.account=n0.string();break;case 2:i0.ts=n0.uint32();break;default:n0.skipType(7&o0)}}return i0},e0}(),t0}(),rB=t.UserStatusList=function(){function t0(e0){if(this.users=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.users=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.users!=null&&e0.users.length)for(var r0=0;r0<e0.users.length;++r0)n0.uint32(18).string(e0.users[r0]);return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserStatusList;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.users&&r0.users.length||(r0.users=[]),r0.users.push(e0.string());break;default:e0.skipType(7&i0)}}return r0},t0}(),sB=t.UserStatusResult=function(){function t0(e0){if(this.userInfos=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.userInfos=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.userInfos!=null&&e0.userInfos.length)for(var r0=0;r0<e0.userInfos.length;++r0)t.UserStatusResult.UserStatusInfo.encode(e0.userInfos[r0],n0.uint32(18).fork()).ldelim();return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserStatusResult;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.userInfos&&r0.userInfos.length||(r0.userInfos=[]),r0.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(e0,e0.uint32()));break;default:e0.skipType(7&i0)}}return r0},t0.UserStatusInfo=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.account="",e0.prototype.ts=0,e0.encode=function(n0,r0){return r0||(r0=L.create()),n0.account!=null&&Object.hasOwnProperty.call(n0,"account")&&r0.uint32(10).string(n0.account),n0.ts!=null&&Object.hasOwnProperty.call(n0,"ts")&&r0.uint32(16).uint32(n0.ts),r0},e0.decode=function(n0,r0){n0 instanceof u||(n0=u.create(n0)),r0=r0===void 0?n0.len:n0.pos+r0;for(var i0=new t.UserStatusResult.UserStatusInfo;n0.pos<r0;){var o0=n0.uint32();switch(o0>>>3){case 1:i0.account=n0.string();break;case 2:i0.ts=n0.uint32();break;default:n0.skipType(7&o0)}}return i0},e0}(),t0}(),tB=t.UserAttributeGet=function(){function t0(e0){if(this.attributes=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.account="",t0.prototype.attributes=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.account!=null&&Object.hasOwnProperty.call(e0,"account")&&n0.uint32(18).string(e0.account),e0.attributes!=null&&e0.attributes.length)for(var r0=0;r0<e0.attributes.length;++r0)n0.uint32(26).string(e0.attributes[r0]);return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserAttributeGet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.account=e0.string();break;case 3:r0.attributes&&r0.attributes.length||(r0.attributes=[]),r0.attributes.push(e0.string());break;default:e0.skipType(7&i0)}}return r0},t0}(),uB=t.UserAttributeRet=function(){function t0(e0){if(this.attributeInfos=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.attributeInfos=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.attributeInfos!=null&&e0.attributeInfos.length)for(var r0=0;r0<e0.attributeInfos.length;++r0)t.UserAttributeRet.AttributeInfo.encode(e0.attributeInfos[r0],n0.uint32(18).fork()).ldelim();return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserAttributeRet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.attributeInfos&&r0.attributeInfos.length||(r0.attributeInfos=[]),r0.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(e0,e0.uint32()));break;default:e0.skipType(7&i0)}}return r0},t0.AttributeInfo=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.key="",e0.prototype.value="",e0.encode=function(n0,r0){return r0||(r0=L.create()),n0.key!=null&&Object.hasOwnProperty.call(n0,"key")&&r0.uint32(10).string(n0.key),n0.value!=null&&Object.hasOwnProperty.call(n0,"value")&&r0.uint32(18).string(n0.value),r0},e0.decode=function(n0,r0){n0 instanceof u||(n0=u.create(n0)),r0=r0===void 0?n0.len:n0.pos+r0;for(var i0=new t.UserAttributeRet.AttributeInfo;n0.pos<r0;){var o0=n0.uint32();switch(o0>>>3){case 1:i0.key=n0.string();break;case 2:i0.value=n0.string();break;default:n0.skipType(7&o0)}}return i0},e0}(),t0}(),vB=t.UserAttributeSet=function(){function t0(e0){if(this.attributeInfos=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.account="",t0.prototype.attributeInfos=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.account!=null&&Object.hasOwnProperty.call(e0,"account")&&n0.uint32(18).string(e0.account),e0.attributeInfos!=null&&e0.attributeInfos.length)for(var r0=0;r0<e0.attributeInfos.length;++r0)t.UserAttributeSet.AttributeInfo.encode(e0.attributeInfos[r0],n0.uint32(26).fork()).ldelim();return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserAttributeSet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.account=e0.string();break;case 3:r0.attributeInfos&&r0.attributeInfos.length||(r0.attributeInfos=[]),r0.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(e0,e0.uint32()));break;default:e0.skipType(7&i0)}}return r0},t0.AttributeInfo=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.key="",e0.prototype.value="",e0.encode=function(n0,r0){return r0||(r0=L.create()),n0.key!=null&&Object.hasOwnProperty.call(n0,"key")&&r0.uint32(10).string(n0.key),n0.value!=null&&Object.hasOwnProperty.call(n0,"value")&&r0.uint32(18).string(n0.value),r0},e0.decode=function(n0,r0){n0 instanceof u||(n0=u.create(n0)),r0=r0===void 0?n0.len:n0.pos+r0;for(var i0=new t.UserAttributeSet.AttributeInfo;n0.pos<r0;){var o0=n0.uint32();switch(o0>>>3){case 1:i0.key=n0.string();break;case 2:i0.value=n0.string();break;default:n0.skipType(7&o0)}}return i0},e0}(),t0}(),wB=t.UserAttributeMod=function(){function t0(e0){if(this.attributeInfos=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.account="",t0.prototype.attributeInfos=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.account!=null&&Object.hasOwnProperty.call(e0,"account")&&n0.uint32(18).string(e0.account),e0.attributeInfos!=null&&e0.attributeInfos.length)for(var r0=0;r0<e0.attributeInfos.length;++r0)t.UserAttributeMod.AttributeInfo.encode(e0.attributeInfos[r0],n0.uint32(26).fork()).ldelim();return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserAttributeMod;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.account=e0.string();break;case 3:r0.attributeInfos&&r0.attributeInfos.length||(r0.attributeInfos=[]),r0.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(e0,e0.uint32()));break;default:e0.skipType(7&i0)}}return r0},t0.AttributeInfo=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.key="",e0.prototype.value="",e0.encode=function(n0,r0){return r0||(r0=L.create()),n0.key!=null&&Object.hasOwnProperty.call(n0,"key")&&r0.uint32(10).string(n0.key),n0.value!=null&&Object.hasOwnProperty.call(n0,"value")&&r0.uint32(18).string(n0.value),r0},e0.decode=function(n0,r0){n0 instanceof u||(n0=u.create(n0)),r0=r0===void 0?n0.len:n0.pos+r0;for(var i0=new t.UserAttributeMod.AttributeInfo;n0.pos<r0;){var o0=n0.uint32();switch(o0>>>3){case 1:i0.key=n0.string();break;case 2:i0.value=n0.string();break;default:n0.skipType(7&o0)}}return i0},e0}(),t0}(),xB=t.UserAttributeDel=function(){function t0(e0){if(this.attributes=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.account="",t0.prototype.attributes=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.account!=null&&Object.hasOwnProperty.call(e0,"account")&&n0.uint32(18).string(e0.account),e0.attributes!=null&&e0.attributes.length)for(var r0=0;r0<e0.attributes.length;++r0)n0.uint32(26).string(e0.attributes[r0]);return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserAttributeDel;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.account=e0.string();break;case 3:r0.attributes&&r0.attributes.length||(r0.attributes=[]),r0.attributes.push(e0.string());break;default:e0.skipType(7&i0)}}return r0},t0}(),yB=t.UserAttributeErr=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.code=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.code!=null&&Object.hasOwnProperty.call(e0,"code")&&n0.uint32(16).uint32(e0.code),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserAttributeErr;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.code=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),zB=t.UserAttributeKeysGet=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.account="",t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.account!=null&&Object.hasOwnProperty.call(e0,"account")&&n0.uint32(18).string(e0.account),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserAttributeKeysGet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.account=e0.string();break;default:e0.skipType(7&i0)}}return r0},t0}(),AB=t.UserAttributeKeysRet=function(){function t0(e0){if(this.keys=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.keys=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.keys!=null&&e0.keys.length)for(var r0=0;r0<e0.keys.length;++r0)n0.uint32(18).string(e0.keys[r0]);return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserAttributeKeysRet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.keys&&r0.keys.length||(r0.keys=[]),r0.keys.push(e0.string());break;default:e0.skipType(7&i0)}}return r0},t0}(),BB=t.UserAttributeRsp=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserAttributeRsp;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;default:e0.skipType(7&i0)}}return r0},t0}(),CB=t.GroupStatusList=function(){function t0(e0){if(this.groups=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.groups=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.groups!=null&&e0.groups.length)for(var r0=0;r0<e0.groups.length;++r0)n0.uint32(18).string(e0.groups[r0]);return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupStatusList;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.groups&&r0.groups.length||(r0.groups=[]),r0.groups.push(e0.string());break;default:e0.skipType(7&i0)}}return r0},t0}(),DB=t.GroupStatusResult=function(){function t0(e0){if(this.groupInfos=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.groupInfos=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.groupInfos!=null&&e0.groupInfos.length)for(var r0=0;r0<e0.groupInfos.length;++r0)t.GroupStatusResult.GroupInfo.encode(e0.groupInfos[r0],n0.uint32(18).fork()).ldelim();return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupStatusResult;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.groupInfos&&r0.groupInfos.length||(r0.groupInfos=[]),r0.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(e0,e0.uint32()));break;default:e0.skipType(7&i0)}}return r0},t0.GroupInfo=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.group="",e0.prototype.memberCount=0,e0.encode=function(n0,r0){return r0||(r0=L.create()),n0.group!=null&&Object.hasOwnProperty.call(n0,"group")&&r0.uint32(10).string(n0.group),n0.memberCount!=null&&Object.hasOwnProperty.call(n0,"memberCount")&&r0.uint32(16).uint32(n0.memberCount),r0},e0.decode=function(n0,r0){n0 instanceof u||(n0=u.create(n0)),r0=r0===void 0?n0.len:n0.pos+r0;for(var i0=new t.GroupStatusResult.GroupInfo;n0.pos<r0;){var o0=n0.uint32();switch(o0>>>3){case 1:i0.group=n0.string();break;case 2:i0.memberCount=n0.uint32();break;default:n0.skipType(7&o0)}}return i0},e0}(),t0}(),EB=t.GroupCountNotice=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.group="",t0.prototype.size=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.instance!=null&&Object.hasOwnProperty.call(e0,"instance")&&n0.uint32(8).uint64(e0.instance),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(16).uint64(e0.seq),e0.group!=null&&Object.hasOwnProperty.call(e0,"group")&&n0.uint32(26).string(e0.group),e0.size!=null&&Object.hasOwnProperty.call(e0,"size")&&n0.uint32(32).uint32(e0.size),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupCountNotice;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.instance=e0.uint64();break;case 2:r0.seq=e0.uint64();break;case 3:r0.group=e0.string();break;case 4:r0.size=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),FB=t.GroupAttributeGet=function(){function t0(e0){if(this.attributes=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.group="",t0.prototype.attributes=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.group!=null&&Object.hasOwnProperty.call(e0,"group")&&n0.uint32(18).string(e0.group),e0.attributes!=null&&e0.attributes.length)for(var r0=0;r0<e0.attributes.length;++r0)n0.uint32(26).string(e0.attributes[r0]);return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAttributeGet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.group=e0.string();break;case 3:r0.attributes&&r0.attributes.length||(r0.attributes=[]),r0.attributes.push(e0.string());break;default:e0.skipType(7&i0)}}return r0},t0}(),GB=t.GroupAttributeRet=function(){function t0(e0){if(this.attributeMaps=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.attributeMaps=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.attributeMaps!=null&&e0.attributeMaps.length)for(var r0=0;r0<e0.attributeMaps.length;++r0)t.GroupAttributeRet.AttributeMap.encode(e0.attributeMaps[r0],n0.uint32(18).fork()).ldelim();return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAttributeRet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.attributeMaps&&r0.attributeMaps.length||(r0.attributeMaps=[]),r0.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(e0,e0.uint32()));break;default:e0.skipType(7&i0)}}return r0},t0.AttributeMap=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.key="",e0.prototype.value="",e0.prototype.origin="",e0.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e0.encode=function(n0,r0){return r0||(r0=L.create()),n0.key!=null&&Object.hasOwnProperty.call(n0,"key")&&r0.uint32(10).string(n0.key),n0.value!=null&&Object.hasOwnProperty.call(n0,"value")&&r0.uint32(18).string(n0.value),n0.origin!=null&&Object.hasOwnProperty.call(n0,"origin")&&r0.uint32(26).string(n0.origin),n0.ms!=null&&Object.hasOwnProperty.call(n0,"ms")&&r0.uint32(32).uint64(n0.ms),r0},e0.decode=function(n0,r0){n0 instanceof u||(n0=u.create(n0)),r0=r0===void 0?n0.len:n0.pos+r0;for(var i0=new t.GroupAttributeRet.AttributeMap;n0.pos<r0;){var o0=n0.uint32();switch(o0>>>3){case 1:i0.key=n0.string();break;case 2:i0.value=n0.string();break;case 3:i0.origin=n0.string();break;case 4:i0.ms=n0.uint64();break;default:n0.skipType(7&o0)}}return i0},e0}(),t0}(),HB=t.GroupAttributeSet=function(){function t0(e0){if(this.attributeInfos=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.group="",t0.prototype.broadcast=!1,t0.prototype.attributeInfos=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.group!=null&&Object.hasOwnProperty.call(e0,"group")&&n0.uint32(18).string(e0.group),e0.broadcast!=null&&Object.hasOwnProperty.call(e0,"broadcast")&&n0.uint32(24).bool(e0.broadcast),e0.attributeInfos!=null&&e0.attributeInfos.length)for(var r0=0;r0<e0.attributeInfos.length;++r0)t.GroupAttributeSet.AttributeInfo.encode(e0.attributeInfos[r0],n0.uint32(34).fork()).ldelim();return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAttributeSet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.group=e0.string();break;case 3:r0.broadcast=e0.bool();break;case 4:r0.attributeInfos&&r0.attributeInfos.length||(r0.attributeInfos=[]),r0.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(e0,e0.uint32()));break;default:e0.skipType(7&i0)}}return r0},t0.AttributeInfo=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.key="",e0.prototype.value="",e0.encode=function(n0,r0){return r0||(r0=L.create()),n0.key!=null&&Object.hasOwnProperty.call(n0,"key")&&r0.uint32(10).string(n0.key),n0.value!=null&&Object.hasOwnProperty.call(n0,"value")&&r0.uint32(18).string(n0.value),r0},e0.decode=function(n0,r0){n0 instanceof u||(n0=u.create(n0)),r0=r0===void 0?n0.len:n0.pos+r0;for(var i0=new t.GroupAttributeSet.AttributeInfo;n0.pos<r0;){var o0=n0.uint32();switch(o0>>>3){case 1:i0.key=n0.string();break;case 2:i0.value=n0.string();break;default:n0.skipType(7&o0)}}return i0},e0}(),t0}(),IB=t.GroupAttributeMod=function(){function t0(e0){if(this.attributeInfos=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.group="",t0.prototype.broadcast=!1,t0.prototype.attributeInfos=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.group!=null&&Object.hasOwnProperty.call(e0,"group")&&n0.uint32(18).string(e0.group),e0.broadcast!=null&&Object.hasOwnProperty.call(e0,"broadcast")&&n0.uint32(24).bool(e0.broadcast),e0.attributeInfos!=null&&e0.attributeInfos.length)for(var r0=0;r0<e0.attributeInfos.length;++r0)t.GroupAttributeMod.AttributeInfo.encode(e0.attributeInfos[r0],n0.uint32(34).fork()).ldelim();return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAttributeMod;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.group=e0.string();break;case 3:r0.broadcast=e0.bool();break;case 4:r0.attributeInfos&&r0.attributeInfos.length||(r0.attributeInfos=[]),r0.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(e0,e0.uint32()));break;default:e0.skipType(7&i0)}}return r0},t0.AttributeInfo=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.key="",e0.prototype.value="",e0.encode=function(n0,r0){return r0||(r0=L.create()),n0.key!=null&&Object.hasOwnProperty.call(n0,"key")&&r0.uint32(10).string(n0.key),n0.value!=null&&Object.hasOwnProperty.call(n0,"value")&&r0.uint32(18).string(n0.value),r0},e0.decode=function(n0,r0){n0 instanceof u||(n0=u.create(n0)),r0=r0===void 0?n0.len:n0.pos+r0;for(var i0=new t.GroupAttributeMod.AttributeInfo;n0.pos<r0;){var o0=n0.uint32();switch(o0>>>3){case 1:i0.key=n0.string();break;case 2:i0.value=n0.string();break;default:n0.skipType(7&o0)}}return i0},e0}(),t0}(),JB=t.GroupAttributeDel=function(){function t0(e0){if(this.attributes=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.group="",t0.prototype.broadcast=!1,t0.prototype.attributes=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.group!=null&&Object.hasOwnProperty.call(e0,"group")&&n0.uint32(18).string(e0.group),e0.broadcast!=null&&Object.hasOwnProperty.call(e0,"broadcast")&&n0.uint32(24).bool(e0.broadcast),e0.attributes!=null&&e0.attributes.length)for(var r0=0;r0<e0.attributes.length;++r0)n0.uint32(34).string(e0.attributes[r0]);return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAttributeDel;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.group=e0.string();break;case 3:r0.broadcast=e0.bool();break;case 4:r0.attributes&&r0.attributes.length||(r0.attributes=[]),r0.attributes.push(e0.string());break;default:e0.skipType(7&i0)}}return r0},t0}(),KB=t.GroupAttributeAlt=function(){function t0(e0){if(this.attributeMaps=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.group="",t0.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.attributeMaps=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.group!=null&&Object.hasOwnProperty.call(e0,"group")&&n0.uint32(18).string(e0.group),e0.instance!=null&&Object.hasOwnProperty.call(e0,"instance")&&n0.uint32(24).uint64(e0.instance),e0.attributeMaps!=null&&e0.attributeMaps.length)for(var r0=0;r0<e0.attributeMaps.length;++r0)t.GroupAttributeAlt.AttributeMap.encode(e0.attributeMaps[r0],n0.uint32(34).fork()).ldelim();return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAttributeAlt;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.group=e0.string();break;case 3:r0.instance=e0.uint64();break;case 4:r0.attributeMaps&&r0.attributeMaps.length||(r0.attributeMaps=[]),r0.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(e0,e0.uint32()));break;default:e0.skipType(7&i0)}}return r0},t0.AttributeMap=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.key="",e0.prototype.value="",e0.prototype.origin="",e0.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e0.encode=function(n0,r0){return r0||(r0=L.create()),n0.key!=null&&Object.hasOwnProperty.call(n0,"key")&&r0.uint32(10).string(n0.key),n0.value!=null&&Object.hasOwnProperty.call(n0,"value")&&r0.uint32(18).string(n0.value),n0.origin!=null&&Object.hasOwnProperty.call(n0,"origin")&&r0.uint32(26).string(n0.origin),n0.ms!=null&&Object.hasOwnProperty.call(n0,"ms")&&r0.uint32(32).uint64(n0.ms),r0},e0.decode=function(n0,r0){n0 instanceof u||(n0=u.create(n0)),r0=r0===void 0?n0.len:n0.pos+r0;for(var i0=new t.GroupAttributeAlt.AttributeMap;n0.pos<r0;){var o0=n0.uint32();switch(o0>>>3){case 1:i0.key=n0.string();break;case 2:i0.value=n0.string();break;case 3:i0.origin=n0.string();break;case 4:i0.ms=n0.uint64();break;default:n0.skipType(7&o0)}}return i0},e0}(),t0}(),LB=t.GroupAttributeRsp=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAttributeRsp;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;default:e0.skipType(7&i0)}}return r0},t0}(),MB=t.GroupAttributeErr=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.code=0,t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.code!=null&&Object.hasOwnProperty.call(e0,"code")&&n0.uint32(16).uint32(e0.code),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAttributeErr;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.code=e0.uint32();break;default:e0.skipType(7&i0)}}return r0},t0}(),NB=t.GroupAttributeKeysGet=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.group="",t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.group!=null&&Object.hasOwnProperty.call(e0,"group")&&n0.uint32(18).string(e0.group),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAttributeKeysGet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.group=e0.string();break;default:e0.skipType(7&i0)}}return r0},t0}(),OB=t.GroupAttributeKeysRet=function(){function t0(e0){if(this.keys=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.keys=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.keys!=null&&e0.keys.length)for(var r0=0;r0<e0.keys.length;++r0)n0.uint32(18).string(e0.keys[r0]);return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.GroupAttributeKeysRet;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.keys&&r0.keys.length||(r0.keys=[]),r0.keys.push(e0.string());break;default:e0.skipType(7&i0)}}return r0},t0}(),PB=t.SubscribeUserStatus=function(){function t0(e0){if(this.users=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.users=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.users!=null&&e0.users.length)for(var r0=0;r0<e0.users.length;++r0)n0.uint32(18).string(e0.users[r0]);return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.SubscribeUserStatus;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.users&&r0.users.length||(r0.users=[]),r0.users.push(e0.string());break;default:e0.skipType(7&i0)}}return r0},t0}(),QB=t.UnsubscribeUserStatus=function(){function t0(e0){if(this.users=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.users=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.users!=null&&e0.users.length)for(var r0=0;r0<e0.users.length;++r0)n0.uint32(18).string(e0.users[r0]);return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UnsubscribeUserStatus;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.users&&r0.users.length||(r0.users=[]),r0.users.push(e0.string());break;default:e0.skipType(7&i0)}}return r0},t0}(),RB=t.UserJoinNotice=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.user="",t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.instance!=null&&Object.hasOwnProperty.call(e0,"instance")&&n0.uint32(8).uint64(e0.instance),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(16).uint64(e0.seq),e0.user!=null&&Object.hasOwnProperty.call(e0,"user")&&n0.uint32(26).string(e0.user),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserJoinNotice;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.instance=e0.uint64();break;case 2:r0.seq=e0.uint64();break;case 3:r0.user=e0.string();break;default:e0.skipType(7&i0)}}return r0},t0}(),SB=t.UserQuitNotice=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.user="",t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.instance!=null&&Object.hasOwnProperty.call(e0,"instance")&&n0.uint32(8).uint64(e0.instance),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(16).uint64(e0.seq),e0.user!=null&&Object.hasOwnProperty.call(e0,"user")&&n0.uint32(26).string(e0.user),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserQuitNotice;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.instance=e0.uint64();break;case 2:r0.seq=e0.uint64();break;case 3:r0.user=e0.string();break;default:e0.skipType(7&i0)}}return r0},t0}(),TB=t.UserWaitNotice=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.user="",t0.encode=function(e0,n0){return n0||(n0=L.create()),e0.instance!=null&&Object.hasOwnProperty.call(e0,"instance")&&n0.uint32(8).uint64(e0.instance),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(16).uint64(e0.seq),e0.user!=null&&Object.hasOwnProperty.call(e0,"user")&&n0.uint32(26).string(e0.user),n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.UserWaitNotice;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.instance=e0.uint64();break;case 2:r0.seq=e0.uint64();break;case 3:r0.user=e0.string();break;default:e0.skipType(7&i0)}}return r0},t0}(),UB=t.SubscribeResponse=function(){function t0(e0){if(this.errors=[],e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,t0.prototype.errors=q.emptyArray,t0.encode=function(e0,n0){if(n0||(n0=L.create()),e0.seq!=null&&Object.hasOwnProperty.call(e0,"seq")&&n0.uint32(8).uint64(e0.seq),e0.errors!=null&&e0.errors.length)for(var r0=0;r0<e0.errors.length;++r0)t.SubscribeResponse.SubscribeErrorsType.encode(e0.errors[r0],n0.uint32(18).fork()).ldelim();return n0},t0.decode=function(e0,n0){e0 instanceof u||(e0=u.create(e0)),n0=n0===void 0?e0.len:e0.pos+n0;for(var r0=new t.SubscribeResponse;e0.pos<n0;){var i0=e0.uint32();switch(i0>>>3){case 1:r0.seq=e0.uint64();break;case 2:r0.errors&&r0.errors.length||(r0.errors=[]),r0.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(e0,e0.uint32()));break;default:e0.skipType(7&i0)}}return r0},t0.SubscribeErrorsType=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.account="",e0.prototype.code=0,e0.encode=function(n0,r0){return r0||(r0=L.create()),n0.account!=null&&Object.hasOwnProperty.call(n0,"account")&&r0.uint32(10).string(n0.account),n0.code!=null&&Object.hasOwnProperty.call(n0,"code")&&r0.uint32(16).uint32(n0.code),r0},e0.decode=function(n0,r0){n0 instanceof u||(n0=u.create(n0)),r0=r0===void 0?n0.len:n0.pos+r0;for(var i0=new t.SubscribeResponse.SubscribeErrorsType;n0.pos<r0;){var o0=n0.uint32();switch(o0>>>3){case 1:i0.account=n0.string();break;case 2:i0.code=n0.uint32();break;default:n0.skipType(7&o0)}}return i0},e0}(),t0}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(t0){return function(e0,n0,r0){var i0=(e0=String(jb(e0))).length;return r0=r0===void 0?" ":String(r0),(n0=ta(n0))<=i0||r0==""?e0:(n0-=i0,(i0=Pn.call(r0,WB(n0/r0.length))).length>n0&&(i0=i0.slice(0,n0)),t0?e0+i0:i0+e0)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(t0){return YB(this,t0,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(t0){return function(e0){e0=qb(e0);for(var n0,r0=Dc(e0),i0=r0.length,o0=0,s0=[];i0>o0;)n0=r0[o0++],ka&&!ZB.call(e0,n0)||s0.push(t0?[n0,e0[n0]]:e0[n0]);return s0}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(t0){return $B(t0)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var t0=bC(String.prototype,"endsWith");return t0&&!t0.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(t0){var e0=String(jb(this));ck(t0);var n0=1<arguments.length?arguments[1]:void 0,r0=ta(e0.length);return n0=n0===void 0?r0:cC(ta(n0),r0),r0=String(t0),Br?Br.call(e0,r0,n0):e0.slice(n0-r0.length,n0)===r0}}),dh("match",1,function(t0,e0,n0){return[function(r0){var i0=jb(this),o0=r0==null?void 0:r0[t0];return o0!==void 0?o0.call(r0,i0):new RegExp(r0)[t0](String(i0))},function(r0){var i0=n0(e0,r0,this);if(i0.done)return i0.value;if(r0=va(r0),i0=String(this),!r0.global)return Ke(r0,i0);var o0=r0.unicode;r0.lastIndex=0;for(var s0,a0=[],c0=0;(s0=Ke(r0,i0))!==null;)s0=String(s0[0]),a0[c0]=s0,s0===""&&(r0.lastIndex=xj(i0,ta(r0.lastIndex),o0)),c0++;return c0===0?null:a0}]});var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var t0=eC(String.prototype,"startsWith");return t0&&!t0.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(t0){var e0=String(jb(this));ck(t0);var n0=ta(fC(1<arguments.length?arguments[1]:void 0,e0.length)),r0=String(t0);return Dr?Dr.call(e0,r0,n0):e0.slice(n0,n0+r0.length)===r0}});var Nm=function(t0){var e0=/(%?)(%([jds]))/g,n0=Array.prototype.slice.call(arguments,1);return n0.length&&(t0=t0.replace(e0,function(r0,i0,o0,s0){switch(o0=n0.shift(),s0){case"s":o0=""+o0;break;case"d":o0=Number(o0);break;case"j":o0=JSON.stringify(o0)}return i0?(n0.unshift(o0),r0):o0})),n0.length&&(t0+=" "+n0.join(" ")),""+(t0=t0.replace(/%{2,2}/g,"%"))},hC=/\s/,iC=function(t0){for(var e0=t0.length;e0--&&hC.test(t0.charAt(e0)););return e0},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(t0){if(typeof t0=="number")return t0;if(ie(t0))return Fr;if(lb(t0)&&(t0=typeof t0.valueOf=="function"?t0.valueOf():t0,t0=lb(t0)?t0+"":t0),typeof t0!="string")return t0===0?t0:+t0;t0=t0&&t0.slice(0,iC(t0)+1).replace(jC,"");var e0=lC.test(t0);return e0||mC.test(t0)?nC(t0.slice(2),e0?2:8):kC.test(t0)?Fr:+t0},oC=Math.max,pC=Math.min,qC=function(t0,e0,n0){function r0(_0){var y0=c0,b0=u0;return c0=u0=void 0,p0=_0,l0=t0.apply(b0,y0)}function i0(_0){var y0=_0-h0;return _0-=p0,h0===void 0||y0>=e0||0>y0||f0&&_0>=E0}function o0(){var _0=Cb.Date.now();if(i0(_0))return s0(_0);var y0=setTimeout,b0=_0-p0;_0=e0-(_0-h0),b0=f0?pC(_0,E0-b0):_0,d0=y0(o0,b0)}function s0(_0){return d0=void 0,g0&&c0?r0(_0):(c0=u0=void 0,l0)}function a0(){var _0=Cb.Date.now(),y0=i0(_0);if(c0=arguments,u0=this,h0=_0,y0){if(d0===void 0)return p0=_0=h0,d0=setTimeout(o0,e0),m0?r0(_0):l0;if(f0)return clearTimeout(d0),d0=setTimeout(o0,e0),r0(h0)}return d0===void 0&&(d0=setTimeout(o0,e0)),l0}var c0,u0,l0,d0,h0,p0=0,m0=!1,f0=!1,g0=!0;if(typeof t0!="function")throw new TypeError("Expected a function");if(e0=gl(e0)||0,lb(n0)){m0=!!n0.leading;var E0=(f0="maxWait"in n0)?oC(gl(n0.maxWait)||0,e0):E0;g0="trailing"in n0?!!n0.trailing:g0}return a0.cancel=function(){d0!==void 0&&clearTimeout(d0),p0=0,c0=h0=u0=d0=void 0},a0.flush=function(){return d0===void 0?l0:s0(Cb.Date.now())},a0},yc=function(t0){function e0(r0,i0){return W(this,e0),m(n(r0=n0.call(this,Mm(r0,i0))),"originalError",void 0),m(n(r0),"code",void 0),m(n(r0),"serverCode",void 0),typeof i0=="number"?r0.code=i0:typeof i0=="string"?r0.name=i0:i0!==void 0&&(i0.originalError&&(r0.originalError=i0.originalError),i0.code!==void 0&&(r0.code=i0.code),i0.serverCode!==void 0&&(r0.serverCode=i0.serverCode)),r0}la(e0,t0);var n0=ma(e0);return e0}(ef(Error)),Ia=function(t0){function e0(r0,i0){return W(this,e0),m(n(r0=n0.call(this,Mm(r0,i0))),"name","RtmInternalError"),m(n(r0),"code",void 0),r0.code=i0,r0}la(e0,t0);var n0=ma(e0);return e0}(ef(Error)),Ph=function(){return function(t0){function e0(r0){W(this,e0);var i0=Object.keys(r0);return n0.call(this,r0[i0[0]],i0[0])}la(e0,t0);var n0=ma(e0);return e0}(Ia)},Fa=Ph(),db=function(t0){function e0(){W(this,e0);for(var r0=arguments.length,i0=Array(r0),o0=0;o0<r0;o0++)i0[o0]=arguments[o0];return m(n(r0=n0.call.apply(n0,[this].concat(i0))),"name","RtmTimeoutError"),r0}la(e0,t0);var n0=ma(e0);return e0}(yc),I=function(t0){function e0(){W(this,e0);for(var r0=arguments.length,i0=Array(r0),o0=0;o0<r0;o0++)i0[o0]=arguments[o0];return m(n(r0=n0.call.apply(n0,[this].concat(i0))),"name","RtmInvalidArgumentError"),r0}la(e0,t0);var n0=ma(e0);return e0}(yc),K=function(t0){function e0(){W(this,e0);for(var r0=arguments.length,i0=Array(r0),o0=0;o0<r0;o0++)i0[o0]=arguments[o0];return m(n(r0=n0.call.apply(n0,[this].concat(i0))),"name","RtmInvalidStatusError"),r0}la(e0,t0);var n0=ma(e0);return e0}(yc),hl=function(t0){function e0(){W(this,e0);for(var r0=arguments.length,i0=Array(r0),o0=0;o0<r0;o0++)i0[o0]=arguments[o0];return m(n(r0=n0.call.apply(n0,[this].concat(i0))),"name","RtmInterruptedError"),r0}la(e0,t0);var n0=ma(e0);return e0}(yc),ib=function(t0){function e0(){W(this,e0);for(var r0=arguments.length,i0=Array(r0),o0=0;o0<r0;o0++)i0[o0]=arguments[o0];return m(n(r0=n0.call.apply(n0,[this].concat(i0))),"name","RtmLimitExceededError"),r0}la(e0,t0);var n0=ma(e0);return e0}(yc),rC=function(t0){function e0(){W(this,e0);for(var r0=arguments.length,i0=Array(r0),o0=0;o0<r0;o0++)i0[o0]=arguments[o0];return m(n(r0=n0.call.apply(n0,[this].concat(i0))),"name","RtmInvokeTooOftenError"),r0}la(e0,t0);var n0=ma(e0);return e0}(yc),da=function(t0){function e0(){W(this,e0);for(var r0=arguments.length,i0=Array(r0),o0=0;o0<r0;o0++)i0[o0]=arguments[o0];return m(n(r0=n0.call.apply(n0,[this].concat(i0))),"name","RtmUnavailableError"),m(n(r0),"serverCode",void 0),m(n(r0),"statusCode",void 0),r0}la(e0,t0);var n0=ma(e0);return e0}(yc),Ye=function(t0){function e0(){W(this,e0);for(var r0=arguments.length,i0=Array(r0),o0=0;o0<r0;o0++)i0[o0]=arguments[o0];return m(n(r0=n0.call.apply(n0,[this].concat(i0))),"name","RtmUnauthenticatedError"),m(n(r0),"serverCode",void 0),r0}la(e0,t0);var n0=ma(e0);return e0}(yc),Wc=function(t0){function e0(){W(this,e0);for(var r0=arguments.length,i0=Array(r0),o0=0;o0<r0;o0++)i0[o0]=arguments[o0];return m(n(r0=n0.call.apply(n0,[this].concat(i0))),"name","RtmUnknownError"),r0}la(e0,t0);var n0=ma(e0);return e0}(yc),Sa=function(t0){return t0 instanceof db||t0 instanceof pb},sa=function(t0){return t0 instanceof yc},Yd=function(t0,e0,n0){return['Executing "%s.%s" timed out after %ds',t0,e0,n0/1e3]},Lm=new Map,sC=function(){var t0=new Date;return"".concat(t0.toISOString().split("T")[1].replace(/\..+/,""),".").concat(t0.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(t0){return typeof t0=="string"?t0.endsWith(".")?t0:"".concat(t0,"."):t0},Sm=function(t0){for(var e0="",n0=(t0=new Uint8Array(t0)).byteLength,r0=-1;++r0<n0;)e0+=String.fromCharCode(t0[r0]);return e0=btoa(e0),"data:;base64,".concat(e0)},tC=R(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});N({target:"Date",proto:!0,forced:tC},{toJSON:function(t0){t0=Qa(this);var e0=lc(t0);return typeof e0!="number"||isFinite(e0)?t0.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(t0,e0,n0){return JSON.stringify(Ym(t0),e0,n0)};Gr.ensureProperties=Ym;var uC=function(t0,e0){e0=e0||{};var n0=X(t0);if(n0==="string"&&0<t0.length)return au(t0);if(n0==="number"&&isFinite(t0))return e0.long?t0=864e5<=(e0=Math.abs(t0))?Jg(t0,e0,864e5,"day"):36e5<=e0?Jg(t0,e0,36e5,"hour"):6e4<=e0?Jg(t0,e0,6e4,"minute"):1e3<=e0?Jg(t0,e0,1e3,"second"):t0+" ms":t0=864e5<=(e0=Math.abs(t0))?Math.round(t0/864e5)+"d":36e5<=e0?Math.round(t0/36e5)+"h":6e4<=e0?Math.round(t0/6e4)+"m":1e3<=e0?Math.round(t0/1e3)+"s":t0+"ms",t0;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t0))},vC=function(t0){function e0(i0){function o0(){for(var c0=arguments.length,u0=Array(c0),l0=0;l0<c0;l0++)u0[l0]=arguments[l0];if(o0.enabled){c0=Number(new Date),o0.diff=c0-(s0||c0),o0.prev=s0,s0=o0.curr=c0,u0[0]=e0.coerce(u0[0]),typeof u0[0]!="string"&&u0.unshift("%O");var d0=0;u0[0]=u0[0].replace(/%([a-zA-Z%])/g,function(h0,p0){return h0==="%%"?"%":(d0++,typeof(p0=e0.formatters[p0])=="function"&&(h0=p0.call(o0,u0[d0]),u0.splice(d0,1),d0--),h0)}),e0.formatArgs.call(o0,u0),(o0.log||e0.log).apply(o0,u0)}}var s0,a0=null;return o0.namespace=i0,o0.useColors=e0.useColors(),o0.color=e0.selectColor(i0),o0.extend=n0,o0.destroy=e0.destroy,Object.defineProperty(o0,"enabled",{enumerable:!0,configurable:!1,get:function(){return a0===null?e0.enabled(i0):a0},set:function(c0){a0=c0}}),typeof e0.init=="function"&&e0.init(o0),o0}function n0(i0,o0){return(i0=e0(this.namespace+(o0===void 0?":":o0)+i0)).log=this.log,i0}function r0(i0){return i0.toString().substring(2,i0.toString().length-2).replace(/\.\*\?$/,"*")}return e0.debug=e0,e0.default=e0,e0.coerce=function(i0){return i0 instanceof Error?i0.stack||i0.message:i0},e0.disable=function(){var i0=[].concat(G(e0.names.map(r0)),G(e0.skips.map(r0).map(function(o0){return"-"+o0}))).join(",");return e0.enable(""),i0},e0.enable=function(i0){e0.save(i0),e0.names=[],e0.skips=[];var o0,s0=(typeof i0=="string"?i0:"").split(/[\s,]+/),a0=s0.length;for(o0=0;o0<a0;o0++)s0[o0]&&((i0=s0[o0].replace(/\*/g,".*?"))[0]==="-"?e0.skips.push(new RegExp("^"+i0.substr(1)+"$")):e0.names.push(new RegExp("^"+i0+"$")))},e0.enabled=function(i0){if(i0[i0.length-1]==="*")return!0;var o0,s0=0;for(o0=e0.skips.length;s0<o0;s0++)if(e0.skips[s0].test(i0))return!1;for(s0=0,o0=e0.names.length;s0<o0;s0++)if(e0.names[s0].test(i0))return!0;return!1},e0.humanize=uC,e0.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t0).forEach(function(i0){e0[i0]=t0[i0]}),e0.names=[],e0.skips=[],e0.formatters={},e0.selectColor=function(i0){for(var o0=0,s0=0;s0<i0.length;s0++)o0=(o0<<5)-o0+i0.charCodeAt(s0),o0|=0;return e0.colors[Math.abs(o0)%e0.colors.length]},e0.enable(e0.load()),e0},Hr=$a(function(t0,e0){e0.formatArgs=function(r0){if(r0[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r0[0]+(this.useColors?"%c ":" ")+"+"+t0.exports.humanize(this.diff),this.useColors){var i0="color: "+this.color;r0.splice(1,0,i0,"color: inherit");var o0=0,s0=0;r0[0].replace(/%[a-zA-Z%]/g,function(a0){a0!=="%%"&&(o0++,a0==="%c"&&(s0=o0))}),r0.splice(s0,0,i0)}},e0.save=function(r0){try{r0?e0.storage.setItem("debug",r0):e0.storage.removeItem("debug")}catch{}},e0.load=function(){try{var r0=e0.storage.getItem("debug")}catch{}return!r0&&typeof process<"u"&&"env"in process&&(r0=define_process_env_default.DEBUG),r0},e0.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};t:{try{var n0=localStorage;break t}catch{}n0=void 0}e0.storage=n0,e0.destroy=function(){var r0=!1;return function(){r0||(r0=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),e0.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),e0.log=console.debug||console.log||function(){},t0.exports=vC(e0),t0.exports.formatters.j=function(r0){try{return JSON.stringify(r0)}catch(i0){return"[UnexpectedJSONParseError]: "+i0.message}}}),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(t0){t0[t0.Uploading=0]="Uploading",t0[t0.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function t0(e0){W(this,t0),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=e0.processId,this.sdkVersion=e0.sdkVersion,this.rtmConfig=e0.rtmConfig,this.uploadRequest=e0.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(t0,[{key:"upload",value:function(e0){this.LogCache.push(e0),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(e0){var n0=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark(function r0(){var i0,o0,s0;return w.wrap(function(a0){for(;;)switch(a0.prev=a0.next){case 0:return i0={sdk_version:n0.sdkVersion,process_id:n0.processId,payload:JSON.stringify(e0)},a0.prev=1,a0.next=4,n0.uploadRequest(i0,(o0=n0.rtmConfig.enableCloudProxy)!==null&&o0!==void 0&&o0);case 4:if(!Uk){a0.next=6;break}throw Error("RTM is busy");case 6:a0.next=13;break;case 8:return a0.prev=8,a0.t0=a0.catch(1),s0=2>n0.uploadResendCount++?2e3:1e4,setTimeout(function(){return n0.postLog(n0.LogsToPost)},s0),a0.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),n0.LogCache.length!==0){a0.next=17;break}return n0.uploadState=Ze.Free,a0.abrupt("return");case 17:n0.uploadResendCount=0,n0.LogsToPost=40>n0.LogCache.length?n0.LogCache.splice(0,n0.LogCache.length):n0.LogCache.splice(0,40),n0.postLog(n0.LogsToPost);case 20:case"end":return a0.stop()}},r0,null,[[1,8]])})),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),t0}(),Jr=function(t0,e0,n0,r0,i0,o0,s0,a0){var c0=0;for(s0=!!s0&&Id(s0,a0,3);c0<r0;){if(c0 in n0){if(a0=s0?s0(n0[c0],c0,e0):n0[c0],0<o0&&gd(a0))i0=Jr(t0,e0,a0,ta(a0.length),i0,o0-1)-1;else{if(9007199254740991<=i0)throw TypeError("Exceed the acceptable array length");t0[i0]=a0}i0++}c0++}return i0},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var t0=arguments.length?arguments[0]:void 0,e0=Qa(this),n0=ta(e0.length),r0=Sg(e0,0);return r0.length=xC(r0,e0,e0,n0,0,t0===void 0?1:$b(t0)),r0}}),N({target:"Object",stat:!0},{values:function(t0){return aC(t0)}});var yC=["CODE"],Db,ud,F;(function(t0){t0.CHINA="CN",t0.ASIA="AS",t0.NORTH_AMERICA="NA",t0.EUROPE="EU",t0.JAPAN="JP",t0.INDIA="IN",t0.OCEANIA="OC",t0.SOUTH_AMERICA="SA",t0.AFRICA="AF",t0.OVERSEA="OVERSEA",t0.GLOBAL="GLOBAL"})(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(t0){return Object.values(yf).flat().includes(t0)},cu=function(t0){var e0;return(e0=Hg(yf).find(function(n0){return(n0=ra(n0,2))[0],n0[1].includes(t0)}))===null||e0===void 0?void 0:e0[0]},AC=function(t0){return t0.sort(function(e0,n0){return Kr.indexOf(e0)-Kr.indexOf(n0)})},xe=function(t0){var e0=new Set;if((t0=AC(t0).slice(0,3).map(function(n0){var r0=Kg[n0];if(r0===void 0)throw new Ia("invalid area key");return n0=r0.CODE,r0=ff(r0,yC),e0.add(n0),r0})).length===0)throw new Ia("areas cannot be empty");return ua({CODES:e0},t0.reduce(function(n0,r0){for(var i0=0,o0=Hg(n0);i0<o0.length;i0++){var s0=ra(o0[i0],2),a0=s0[0];s0=s0[1],n0[a0]=Array.from(new Set([].concat(G(r0[a0]),G(s0))))}return n0}))},M,Lr=function(){var t0=J(w.mark(function e0(n0,r0){var i0,o0,s0,a0,c0,u0=arguments;return w.wrap(function(l0){for(;;)switch(l0.prev=l0.next){case 0:if(!(2<(o0=2<u0.length&&u0[2]!==void 0?u0[2]:0))){l0.next=3;break}return l0.abrupt("return");case 3:return s0={withCredentials:!0,body:n0,timeout:2e4},a0=0<o0?(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",c0=r0?"https://".concat((i0=M==null?void 0:M.PROXY_NGINX[0])!==null&&i0!==void 0?i0:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(a0,"&p=443&d=upload/v1"):"https://".concat(a0,"/upload/v1"),l0.next=8,te(c0,s0).catch(function(d0){return Lr(n0,r0,o0+1)});case 8:case"end":return l0.stop()}},e0)}));return function(e0,n0){return t0.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(t0){if(typeof t0=="string")return oa(t0);if(Array.isArray(t0)&&t0.every(function(o0){return typeof o0=="string"}))return t0.map(function(o0){return oa(o0)});if(!Il(t0)){for(var e0={},n0=0;n0<Or.length;n0++){var r0=Or[n0];r0 in t0&&(e0[r0]=t0[r0])}if(0<Object.keys(e0).length)return e0;if(5>Object.keys(t0).length){for(n0=0,t0=Object.entries(t0);n0<t0.length;n0++){var i0=ra(t0[n0],2);r0=i0[0],i0=i0[1],il.includes(r0)?e0[r0]="[Hidden Info]":e0[oa(r0)]=typeof i0=="string"?oa(i0):"[Sensitive Info]"}return e0}return"[Sensitive Info]"}return t0},Pr=function(t0){return X(t0)==="object"?yd(t0)?Vm(fe(t0,5),il,Nr):t0.constructor&&t0.constructor.name:t0},Qr=function(t0,e0){return t0 instanceof Error?t0.message:typeof t0!="string"?JSON.stringify(Vm(fe(t0,5),il,Nr)):(e0=e0.map(function(n0){return n0 instanceof Error?n0.message:X(n0)==="object"?Gr(Array.isArray(n0)?n0.map(Pr):Pr(n0)):n0}),Nm.apply(void 0,[t0.replace(/%[%Oo]/g,function(n0){return n0==="%%"?"%":n0==="%o"||n0==="%O"?"%s":n0})].concat(G(e0))))},CC=1,Rr=function(t0,e0,n0){var r0=Hr(t0);return r0.enabled=!0,r0.log=n0,r0.useColors=!1,function(i0){for(var o0=arguments.length,s0=Array(1<o0?o0-1:0),a0=1;a0<o0;a0++)s0[a0-1]=arguments[a0];if(e0.enableLogUpload){o0=Cg(i0);var c0=Qr(o0,s0);Mr.upload({log_item_id:"".concat(CC++),log_level:t0,payload_str:"[".concat(sC(),"] ").concat(t0," - ").concat(256<c0.length?c0.slice(0,256):c0)})}switch(o0=function(u0){var l0=c0||Qr(Cg(i0),s0),d0=Nc.LOG_HANDLER;typeof d0=="function"&&d0({level:u0,message:l0}),r0(l0)},t0){case"RTM:INFO":e0.logFilter.info&&o0("log");break;case"RTM:WARN":e0.logFilter.warn&&o0("warning");break;case"RTM:ERROR":e0.logFilter.error&&o0("error");break;case"RTM:TRACK":e0.logFilter.track&&o0("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":e0.logFilter.debug&&o0("debug");break;case"RTM:DEBUG":e0.logFilter.debug&&o0("debug")}}},jl,Sr=function(t0){return function(e0){var n0=jl===1||t0===void 0?"":"Ins#".concat(t0," ");return"".concat(n0).concat(e0)}},kl=function(t0,e0,n0){var r0=Sr(jl);return Rr("RTM:".concat(e0),n0,function(i0){return t0(r0(i0))})},tb=function(){return function(t0){function e0(r0,i0){var o0=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,e0);var s0=n0.call(this);if(m(n(s0),"logError",void 0),m(n(s0),"invokeTracker",void 0),m(n(s0),"resultTracker",void 0),m(n(s0),"errorTracker",void 0),m(n(s0),"eventTracker",void 0),m(n(s0),"info",void 0),m(n(s0),"warn",void 0),m(n(s0),"log",void 0),m(n(s0),"genLogger",void 0),m(n(s0),"loggerId",void 0),m(n(s0),"logger",void 0),m(n(s0),"name",void 0),s0.logger=r0,s0.name=i0,s0.loggerId=r0.loggerId,s0.info=r0.info,s0.warn=r0.warn,s0.logError=r0.logError,s0.genLogger=r0.genLogger,s0.log=r0.genLogger("RTM:DEBUG","<".concat(i0,"> ")),s0.invokeTracker=r0.genTracker("Invoke"),s0.eventTracker=r0.genTracker("Event"),s0.resultTracker=r0.genTracker("Result"),s0.errorTracker=r0.genTracker("Error"),o0){var a0=s0.emit.bind(n(s0));s0.emit=function(){for(var c0=arguments.length,u0=Array(c0),l0=0;l0<c0;l0++)u0[l0]=arguments[l0];c0=u0[0],l0=u0.slice(1);var d0=BC.includes(c0);s0.eventTracker.apply(s0,["%s: ".concat(0<l0.length?"%s emitted with args: ".concat(l0.map(function(){return"%o"})):"%s emitted"),i0,c0].concat(G(d0?l0.map(ye):l0)));try{a0.apply(void 0,u0)}catch(h0){s0.logError("Caught in the callback function of the event %s",c0,h0)}}}return s0}la(e0,t0);var n0=ma(e0);return e0}(ea)},DC=function(t0){return kl(console.log.bind(console),"INFO",t0)},EC=function(t0){return kl(console.warn.bind(console),"WARN",t0)},FC=function(t0){return kl(console.error.bind(console),"ERROR",t0)},Tr=function(t0,e0){return function(n0){var r0=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",i0=Sr(t0),o0=console.debug.bind(console),s0=Rr(n0,e0,function(a0){return o0(i0(a0))});return function(a0){for(var c0=arguments.length,u0=Array(1<c0?c0-1:0),l0=1;l0<c0;l0++)u0[l0-1]=arguments[l0];return s0.apply(void 0,[r0+a0].concat(u0))}}},GC=function(t0,e0){return function(n0){return Tr(t0,e0)("RTM:TRACK","[".concat(n0,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(t0,e0){var n0=-1,r0=t0.length,i0=r0-1;for(e0=e0===void 0?r0:e0;++n0<e0;){var o0=t0[r0=nr(n0,i0)];t0[r0]=t0[n0],t0[n0]=o0}return t0.length=e0,t0},IC=function(t0){return Ur(Xh(t0))},JC=function(t0){return Ur(Ni(t0))},$e=function(t0){return(Va(t0)?IC:JC)(t0)},af={0:9591,1:9593},$d=function(t0){return"https://".concat(t0,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(t0){function e0(r0,i0,o0,s0,a0,c0){W(this,e0);var u0=n0.call(this,a0,Ai("Socket-",a0.loggerId));if(m(n(u0),"isActiveClose",!1),m(n(u0),"loggedIn",!1),m(n(u0),"useNewDomain",void 0),m(n(u0),"receivedPacket",new Pa),m(n(u0),"open$",void 0),m(n(u0),"input$",new Pa),m(n(u0),"userJoin$",new Pa),m(n(u0),"attemptsSinceLastError",0),m(n(u0),"message$",new Pa),m(n(u0),"socket$",void 0),m(n(u0),"toClose",new Pa),m(n(u0),"toReconnect",new Pa),m(n(u0),"sendLogger",void 0),m(n(u0),"receiveLogger",void 0),m(n(u0),"ip",void 0),m(n(u0),"env",void 0),m(n(u0),"ticket",void 0),m(n(u0),"context",void 0),m(n(u0),"getDomain",function(){return an(u0.ip,u0.useNewDomain)}),m(n(u0),"socketReconnector",function(h0){var p0=function(m0){return u0.attemptsSinceLastError+=1,u0.warn("The %s of Env %d reconnecting %s",u0.name,u0.env,m0.message),Bc(3e3)};return h0.pipe(Ga(function(m0){return u0.log("socket connection closed"),u0.loggedIn=!1,2<=u0.attemptsSinceLastError?(u0.warn("socket connection failure"),u0.emit("connectionFailure"),u0.close(),Z(m0)):u0.isActiveClose?vb:(u0.emit("reconnect"),u0.useNewDomain=!u0.useNewDomain,Z(m0))}),oe(function(m0){return m0.pipe(Cc(p0))}))}),u0.ip=r0,u0.env=i0,u0.ticket=o0,u0.context=s0,u0.useNewDomain=c0??.5<=Math.random(),u0.sendLogger=u0.genLogger("RTM:MSG:SEND"),u0.receiveLogger=u0.genLogger("RTM:MSG:RECV"),i0!==0&&i0!==1)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(r0))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var l0=af[i0];u0.log("Opening websocket address %s for the Env %d",u0.ip,u0.env);var d0=Xb(u0.input$,u0.userJoin$.pipe(Rt(2)),u0.message$).pipe(ba(function(h0){return Oh.encode(h0).finish()}));return r0=Xb(St("",{protocols:[],makeWebSocket:function(){if(u0.context.config.enableCloudProxy){if(u0.context.cloudProxyServers.length===0)throw u0.logError("No cloud proxy server to connect"),new da;var h0="wss://".concat(an(bn(u0.context.cloudProxyServers),!1),"/");h0=we(h0,"sid",u0.context.sid),h0=we(h0,"remote_port",l0.toString()),h0=we(h0,"remote_ip",u0.ip),h0=we(h0,"token",u0.context.key),h0=new WebSocket(h0)}else h0=new WebSocket("wss://".concat(u0.getDomain(),":").concat(l0));return h0.binaryType="arraybuffer",h0}}),u0.toReconnect),u0.socket$=Ca(r0,Tk.pipe(hb(15e3),Ga(function(h0){return Sa(h0)&&u0.warn("socket open timed out"),Z(h0)}))).pipe(ba(function(h0){if(h0 instanceof Error)throw u0.warn("Env_%d: Force reconnect the socket",u0.env),h0;return h0(d0).pipe(ba(function(p0){return Oh.decode(new Uint8Array(p0))}))}),u0.socketReconnector),u0.open$=u0.socket$.pipe(ca(function(h0){u0.log("Websocket opened",u0.name),h0.subscribe(function(p0){var m0=p0.data;p0=Li[p0.uri].slice(0,-3),m0=$m[p0].decode(m0);var f0=HA({},Gk(m0,"toJSON"),function(y0,b0){return b0 instanceof U?Km(b0):b0}),g0=!1;if((m0 instanceof vr||m0 instanceof ur)&&m0.instance.lessThanOrEqual(4294967295)&&(g0=!0),m0 instanceof wr||m0 instanceof xr){var E0=m0.instance,_0=m0.sequence;(m0.dialogue.lessThanOrEqual(4294967295)||E0.lessThanOrEqual(4294967295)||_0.lessThan(1))&&(g0=!0)}g0?u0.warn("Env_%d: Illegal %s, abandoned %o",u0.env,p0,f0):(p0!=="Pong"&&u0.receiveLogger("Env_%d: %s %o",u0.env,p0,f0),u0.receivedPacket.next([p0,m0]))},function(){})}),qf(void 0),ob(u0.toClose),pe()),u0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(r0,i0){if(r0!=="Ping"){var o0=uc(i0,function(s0){return s0 instanceof U?Km(s0):s0});this.sendLogger("Env_%d: %s %o",this.env,r0,o0)}i0=du(r0,i0),r0==="UserJoin"?this.userJoin$.next(i0):r0==="Message"?this.message$.next(i0):this.input$.next(i0)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(r0){var i0=this;return this.receivedPacket.pipe(ca(function(o0){var s0=ra(o0,2);o0=s0[0],s0=s0[1],o0==="UserResp"&&(i0.attemptsSinceLastError=0,i0.loggedIn=!0),o0==="UserDrop"&&i0.emit("socketUserDrop",s0)}),wb(function(o0){return ra(o0,1)[0]===r0}),ba(function(o0){return ra(o0,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),e0}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(t0){return XB(this,t0,1<arguments.length?arguments[1]:void 0)}});var OC=function(t0){var e0=xf(Kg);t0=Yt(t0);for(var n0=0;n0<e0.length;n0++){var r0=Kg[e0[n0]];if(r0!=null&&r0.AP_DOMAINS.includes(t0)||r0!=null&&r0.AP_BACKUP_DOMAINS.includes(t0)||r0!=null&&r0.PROXY_AP.includes(t0))return[r0.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(t0){function e0(r0,i0){var o0=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,e0);var s0=n0.call(this,i0,"AccessPoint");return m(n(s0),"handleUniLbsError",function(a0,c0){var u0=a0;if(4<a0.toString().length){var l0=a0.toString().padStart(8,"0"),d0=parseInt(l0.slice(0,4),10);if(l0=parseInt(l0.slice(4,8),10),d0===201)u0=l0;else if(d0===101&&!QC.includes(l0))return Z(Error("service is currently unavailable"))}if(d0=u0.toString(),!Object.keys(Vr).includes(d0))return(a0=new da(["Login is rejected by the server. The response code is %d",a0],jg)).serverCode=u0,Z(a0);switch(d0=Vr[d0],u0=PC[d0],d0){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(c0=new Ye(u0,$q)).serverCode=a0,Z(c0);case"INVALID_USER_ID":return(c0=new Ye(u0,Jh)).serverCode=a0,Z(c0);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(c0=new Ye(u0,Kh)).serverCode=a0,Z(c0);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(c0=new Ye(u0,ar)).serverCode=a0,Z(c0);case"CANNOT_MEET_AREA_DEMAND":return(c0=OC(c0)).forEach(function(h0){return s0.failedAreas.add(h0)}),s0.failedAreas.size===(M===void 0?2:M.CODES.size)?((c0=new I(u0,jg)).serverCode=a0,Z(c0)):Z(Error("ap ".concat(c0.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(c0=new da(u0,jg)).serverCode=a0,Z(c0);default:return Z(Im("ApResErrType",d0))}}),m(n(s0),"getApEdgeInfo$",void 0),m(n(s0),"getApEdgeInfoEndFirst$",void 0),m(n(s0),"apFinish$",new Pa),m(n(s0),"retryCount",0),m(n(s0),"failedAreas",new Set),m(n(s0),"usedUrl",[]),m(n(s0),"newDomainUsed",!1),m(n(s0),"backupNewDomainUsed",!1),m(n(s0),"genUrl",function(){return M===void 0?mi.apply(void 0,G($e([KC,LC]))).pipe(ni(function(a0){return bb.apply(void 0,G(a0))})):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))}),m(n(s0),"genBackupUrl",function(){return M===void 0?mi.apply(void 0,G($e([MC,NC]))).pipe(ni(function(a0){return bb.apply(void 0,G(a0))})):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))}),m(n(s0),"getApUrl$",function(a0){var c0,u0;return s0.genUrl().pipe(wb(function(l0){return(!s0.newDomainUsed||!l0.includes("sd-rtn.com"))&&(l0.includes("sd-rtn.com")&&(s0.newDomainUsed=!0),!dl(s0.usedUrl,function(d0){var h0;return d0===((h0=l0.match(Qh))===null||h0===void 0?void 0:h0[1])}))}),ca(function(l0){var d0;M===void 0&&typeof(l0=(d0=l0.match(Qh))===null||d0===void 0?void 0:d0[1])=="string"&&s0.usedUrl.push(l0)}),Ka(a0?Math.max(Nc.RECONNECTING_AP_NUM,(c0=M==null?void 0:M.CODES.size)!==null&&c0!==void 0?c0:0):(u0=M==null?void 0:M.CODES.size)!==null&&u0!==void 0?u0:2),Dd(function(){return e0.runOutOfUrlSymbol}),Ga(function(l0,d0){return s0.newDomainUsed=!1,l0===e0.runOutOfUrlSymbol?(s0.usedUrl=[],d0):Z(l0)}))}),m(n(s0),"getBackupApUrl$",function(a0){var c0,u0;return s0.genBackupUrl().pipe(wb(function(l0){return(!s0.backupNewDomainUsed||!l0.includes("sd-rtn.com"))&&(l0.includes("sd-rtn.com")&&(s0.backupNewDomainUsed=!0),!dl(s0.usedUrl,function(d0){var h0;return d0===((h0=l0.match(Qh))===null||h0===void 0?void 0:h0[1])}))}),ca(function(l0){var d0;M===void 0&&typeof(l0=(d0=l0.match(Qh))===null||d0===void 0?void 0:d0[1])=="string"&&s0.usedUrl.push(l0)}),Ka(a0?Math.max(Nc.RECONNECTING_AP_NUM,(c0=M==null?void 0:M.CODES.size)!==null&&c0!==void 0?c0:0):(u0=M==null?void 0:M.CODES.size)!==null&&u0!==void 0?u0:2),Dd(function(){return e0.runOutOfUrlSymbol}),Ga(function(l0,d0){return s0.backupNewDomainUsed=!1,l0===e0.runOutOfUrlSymbol?(s0.usedUrl=[],d0):Z(l0)}))}),m(n(s0),"getProxyApUrl$",function(a0){var c0,u0;return bb.apply(void 0,G(((M==null?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(a0?Math.max(Nc.RECONNECTING_AP_NUM,(c0=M==null?void 0:M.CODES.size)!==null&&c0!==void 0?c0:0):(u0=M==null?void 0:M.CODES.size)!==null&&u0!==void 0?u0:2))}),m(n(s0),"context",void 0),m(n(s0),"fetchCloudProxy",function(a0,c0){var u0=Ai("AP-",s0.loggerId);s0.log("The AccessPoint requests %s(%s)",a0,u0);var l0=new AbortController;return s0.apFinish$.pipe(Ka(1)).subscribe(function(){return l0.abort()}),ad(J(w.mark(function d0(){var h0;return w.wrap(function(p0){for(;;)switch(p0.prev=p0.next){case 0:return h0=Ag(0,Number.MAX_SAFE_INTEGER),s0.log("%s request opid: %d",u0,h0),p0.abrupt("return",te(a0,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:s0.context.sid,opid:h0,appid:s0.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:c0??s0.context.key,cname:s0.context.uid,uid:0,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(m0){return m0===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):m0}).join(",")})}}]},signal:l0.signal}));case 3:case"end":return p0.stop()}},d0)}))).pipe(Ga(function(d0){return d0.name!=="AbortError"&&(s0.logError(d0),s0.warn("The AP server %s request failure",a0,d0)),vb}),cb(function(){var d0=J(w.mark(function h0(p0){var m0,f0,g0,E0,_0,y0,b0,S0,w0,I0,L0,M0,C0,U0,x0,j0,k0,D0,$0;return w.wrap(function(N0){for(;;)switch(N0.prev=N0.next){case 0:if(m0=p0.responseText,f0=JSON.parse(m0),s0.log("The %s response is %o",u0,f0),((g0=f0.response_body)===void 0||g0.length===0||g0.some(function(A0){var P0;return((P0=A0.buffer)===null||P0===void 0?void 0:P0.code)===void 0||A0.uri!==23}))&&Z(new da("cloud proxy response_body not valid",jg)),(E0=g0.filter(function(A0){return A0.buffer.code!==0})).length===0){N0.next=14;break}if((_0=E0.find(function(A0){return A0.buffer.flag===128}))===void 0){N0.next=12;break}return N0.abrupt("return",s0.handleUniLbsError(_0.buffer.code,a0));case 12:return s0.logError("cloud proxy error response"),N0.abrupt("return",s0.handleUniLbsError(E0[0].buffer.code,a0));case 14:for(y0=[],b0=0;b0<g0.length;b0++)if(((I0=g0[b0])==null||(S0=I0.buffer)===null||S0===void 0?void 0:S0.flag)===262144)(L0=I0.buffer)===null||L0===void 0||(M0=L0.edges_services)===null||M0===void 0||(C0=M0.forEach)===null||C0===void 0||C0.call(M0,function(A0){Gm(A0=A0.ip)&&s0.context.cloudProxyServers.indexOf(A0)===-1&&(s0.log("got cloud proxy server: %s",A0),s0.context.cloudProxyServers.push(A0))});else if((I0==null||(w0=I0.buffer)===null||w0===void 0?void 0:w0.flag)===128){for(k0=function(A0,P0){var O0=P0[A0];y0.some(function(v0){return v0.ip===O0.ip})||y0.push({ip:O0.ip,ticket:I0.buffer.cert})},D0=0,$0=I0.buffer.edges_services;D0<$0.length;D0++)k0(D0,$0);s0.context.rtmArea=(U0=(x0=I0.buffer)===null||x0===void 0||(j0=x0.detail)===null||j0===void 0?void 0:j0[9])!==null&&U0!==void 0?U0:""}return N0.abrupt("return",bb.apply(void 0,G(y0).concat([fg])));case 19:case"end":return N0.stop()}},h0)}));return function(h0){return d0.apply(this,arguments)}}()),Ga(function(d0){return sa(d0)?Z(d0):vb}),tg(),wb(function(d0){return d0!==void 0&&typeof d0.ip=="string"&&typeof d0.ticket=="string"}))}),m(n(s0),"fetchAp",function(a0,c0){var u0=Ai("AP-",s0.loggerId);s0.log("The AccessPoint requests %s(%s)",a0,u0);var l0=new AbortController;return s0.apFinish$.pipe(Ka(1)).subscribe(function(){return l0.abort()}),ad(J(w.mark(function d0(){var h0;return w.wrap(function(p0){for(;;)switch(p0.prev=p0.next){case 0:return h0=Ag(0,Number.MAX_SAFE_INTEGER),s0.log("%s request opid: %d",u0,h0),p0.abrupt("return",te(a0,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:h0,key:c0||s0.context.key,cname:s0.context.uid,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(m0){return m0===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):m0}).join(",")}),uid:0,sid:s0.context.sid},signal:l0.signal}));case 3:case"end":return p0.stop()}},d0)}))).pipe(Ga(function(d0){return d0.name!=="AbortError"&&(s0.logError(d0),s0.warn("The AP server %s request failure",a0,d0)),vb}),cb(function(){var d0=J(w.mark(function h0(p0){var m0,f0,g0,E0,_0,y0,b0;return w.wrap(function(S0){for(;;)switch(S0.prev=S0.next){case 0:if(m0=p0.responseText,f0=JSON.parse(m0),s0.log("The %s response is %o",u0,f0),E0=(g0=f0).code,_0=g0.addresses,y0=g0.detail,E0===0){S0.next=6;break}return S0.abrupt("return",s0.handleUniLbsError(E0,a0));case 6:if((b0=_0).length!==0){S0.next=11;break}return S0.abrupt("return",Z(Error("No available edge address to connect")));case 11:return s0.context.rtmArea=y0==null?void 0:y0[9],S0.abrupt("return",bb.apply(void 0,G(b0).concat([fg])));case 13:case"end":return S0.stop()}},h0)}));return function(h0){return d0.apply(this,arguments)}}()),tg(),Ga(function(d0){return sa(d0)?Z(d0):vb}),wb(function(d0){return d0!==void 0&&typeof d0.ip=="string"&&typeof d0.ticket=="string"}))}),s0.context=r0,s0.getApEdgeInfoEndFirst$=function(){var a0=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return Bc(0,a0||o0?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca(function(){s0.retryCount+=1}),cb(function(){return s0.context.config.enableCloudProxy?s0.getProxyApUrl$(a0||o0):(4<=s0.retryCount&&(s0.retryCount=0),3>=s0.retryCount?s0.getApUrl$(a0||o0):s0.getBackupApUrl$(a0||o0))}),cb(function(c0){return s0.context.config.enableCloudProxy?s0.fetchCloudProxy(c0):s0.fetchAp(c0)}),Ga(function(c0){return c0 instanceof pb&&s0.warn("AP request timeout"),Z(c0)}),om(function(c0){return c0.ip}),ob(s0.apFinish$))},s0.getApEdgeInfo$=function(a0){return Bc(0,a0||o0?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca(function(){s0.retryCount+=1}),cb(function(){return s0.context.config.enableCloudProxy?s0.getProxyApUrl$(a0||o0):3>=s0.retryCount?s0.getApUrl$(a0||o0):s0.getBackupApUrl$(a0||o0)}),cb(function(c0){return(s0.context.config.enableCloudProxy?s0.fetchCloudProxy(c0):s0.fetchAp(c0)).pipe()}),Ga(function(c0){return c0 instanceof pb&&s0.warn("AP request timeout"),Z(c0)}),om(function(c0){return c0.ip}),ob(s0.apFinish$))},s0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),e0}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(t0){function e0(r0,i0,o0){W(this,e0);var s0=n0.call(this,i0,"Connection");m(n(s0),"apClient",void 0),m(n(s0),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(s0),"curOpenSockets",[void 0,void 0]),m(n(s0),"ipIterator",0),m(n(s0),"firstEnv",.5<=Math.random()?1:0),m(n(s0),"firstSocketOpener",void 0),m(n(s0),"secondSocketOpener",void 0),m(n(s0),"firstOpenKeeperSubject",new Pa),m(n(s0),"secondOpenKeeperSubject",new Pa),m(n(s0),"edgeInfoReplayed",void 0),m(n(s0),"firstEnvOpenSocket",void 0),m(n(s0),"firstOpenKeeperSub",void 0),m(n(s0),"secondOpenKeeperSub",void 0),m(n(s0),"context",void 0),m(n(s0),"logger",void 0),s0.context=r0,s0.logger=i0,s0.apClient=new Wr(s0.context,i0),s0.apClient.apFinish$.subscribe(function(){s0.log("Ap client fetch finished")});var a0,c0=[];return s0.edgeInfoReplayed=s0.apClient.getApEdgeInfo$(o0).pipe(oe(function(u0){return u0.pipe(ca(function(l0){if(sa(l0))throw l0}),cd(o0?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))}),wb(function(u0){return!dl(c0,u0)}),Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),ca(function(u0){c0.push(u0),s0.log("An edge info got %o",u0)}),ca({error:function(u0){s0.emit("connectionInitFailure",u0)}}),wg(function(){s0.apClient.clearUp()}),sm()),s0.firstEnvOpenSocket=s0.edgeInfoReplayed.pipe(cb(function(u0){if(u0===void 0)return Z(Error("Invalid edge info"));var l0=new ml(u0.ip,s0.firstEnv,u0.ticket,s0.context,i0,a0);return s0.firstEnv=s0.firstEnv===1?0:1,l0.on("connectionFailure",function(){return s0.onSocketConnectionFailure(l0)}),a0=!l0.useNewDomain,l0.open$.pipe(qf(l0))}),ca(function(u0){s0.log("The websocket of ENV_%d opened to %s:%d",u0.env,u0.ip,af[u0.env]),s0.curOpenSockets[u0.env]=u0,s0.lastOpenSockets[u0.env].next(u0),s0.firstEnv=u0.env,s0.openSecondSocket(u0.env,u0.ip,u0.useNewDomain)}),Ka(1),pe()),s0.firstSocketOpener=s0.firstEnvOpenSocket.pipe(cb(function(u0){return u0.open$.pipe(ca(function(){s0.log("The websocket of first ENV_%d re-opened to %s:%d",u0.env,u0.ip,af[u0.env]),s0.curOpenSockets[u0.env]=u0,s0.lastOpenSockets[u0.env].next(u0)}))})),r0=s0.firstOpenKeeperSubject.pipe(Cc(Yc)),s0.firstOpenKeeperSub=r0.subscribe({error:s0.logError}),s0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(r0,i0){if(![0,1].includes(r0))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var o0=r0===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var s0=this.curOpenSockets[r0];this.curOpenSockets[r0]=void 0,s0&&(s0.isActiveClose=!0,setTimeout(function(){s0.close()},i0)),o0!==void 0&&setTimeout(function(){o0==null||o0.unsubscribe()},i0)}},{key:"waitClosing",value:function(r0){var i0=this;return r0.isActiveClose=!0,r0.open$.pipe(tt(),Ga(function(o0){return o0.message===mr.normalClosureMessage?vb:Z(o0)}),hb(5e3),Ga(function(o0){return o0 instanceof pb?(i0.warn("Force closing the ENV_%d connection",r0.env),vb):Z(o0)}))}},{key:"onSocketConnectionFailure",value:function(r0){var i0=[0,1].filter(function(o0){return o0!==r0.env})[0];(i0=this.curOpenSockets[i0])&&i0.loggedIn?this.reopenSocketWithApRequest(r0.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(r0,i0,o0){var s0=this,a0=r0===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm(function(c0,u0){return[].concat(G(c0),[u0])},[]),ba(function(c0){return kr(c0,function(u0){return Jm(i0,u0.ip)}).slice(-1)[0]}),Ka(1),cb(function(c0){if(c0===void 0)return Z(Error("Invalid edge info"));var u0=new ml(c0.ip,a0,c0.ticket,s0.context,s0.logger,o0);return u0.on("connectionFailure",function(){return s0.onSocketConnectionFailure(u0)}),u0.open$.pipe(ca(function(){s0.lastOpenSockets[a0].next(u0),s0.curOpenSockets[a0]=u0}))}),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(r0){var i0=this,o0=[0,1].filter(function(c0){return c0!==r0})[0];if((o0=this.curOpenSockets[o0])!==void 0){var s0,a0=o0.ip;o0=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),oe(function(c0){return c0.pipe(ca(function(u0){if(u0.code===Kh)i0.emit("tokenExpired"),i0.apClient.apFinish$.next(void 0);else if(sa(u0))throw u0}),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))}),ca(function(c0){i0.log("An edge info got %o",c0)}),wg(function(){i0.apClient.clearUp()})).pipe(rm(function(c0,u0){return[].concat(G(c0),[u0])},[]),ba(function(c0){return(c0=kr(c0,function(u0){return Jm(a0,u0.ip)})).length-1>=i0.ipIterator?c0.slice(-i0.ipIterator++-1)[0]:(i0.ipIterator=0,c0.slice(-1)[0])}),Dd(),cb(function(c0){if(c0===void 0)return Z(Error("Invalid edge info"));var u0=new ml(c0.ip,r0,c0.ticket,i0.context,i0.logger,s0);return u0.on("connectionFailure",function(){return i0.onSocketConnectionFailure(u0)}),s0=!u0.useNewDomain,u0.open$.pipe(qf(u0))}),ca(function(c0){i0.log("The websocket of ENV_%d re-opened to %s:%d using ap",c0.env,c0.ip,af[c0.env]),i0.curOpenSockets[r0]=c0,i0.lastOpenSockets[r0].next(c0)}),cb(function(c0){return c0.open$.pipe(ca(function(){i0.log("The websocket of ENV_%d re-opened to %s:%d",c0.env,c0.ip,af[c0.env]),i0.curOpenSockets[r0]=c0,i0.lastOpenSockets[r0].next(c0)}))}),pe()),r0===this.firstEnv?this.firstOpenKeeperSubject.next(o0):this.secondOpenKeeperSubject.next(o0)}}}]),e0}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.sid="",t0.prototype.userId="",t0.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.appId="",t0.prototype.ver="",t0.prototype.buildno=0,t0.prototype.installId="",t0.prototype.os=0,t0.prototype.did="",t0.prototype.index=null,t0.prototype.token="",t0.prototype.version=0,t0.prototype.subVersion=0,t0.encode=function(e0,n0){return n0||(n0=Xc.create()),e0.sid!=null&&Object.hasOwnProperty.call(e0,"sid")&&n0.uint32(10).string(e0.sid),e0.userId!=null&&Object.hasOwnProperty.call(e0,"userId")&&n0.uint32(18).string(e0.userId),e0.lts!=null&&Object.hasOwnProperty.call(e0,"lts")&&n0.uint32(24).int64(e0.lts),e0.elapse!=null&&Object.hasOwnProperty.call(e0,"elapse")&&n0.uint32(32).int64(e0.elapse),e0.appId!=null&&Object.hasOwnProperty.call(e0,"appId")&&n0.uint32(42).string(e0.appId),e0.ver!=null&&Object.hasOwnProperty.call(e0,"ver")&&n0.uint32(50).string(e0.ver),e0.buildno!=null&&Object.hasOwnProperty.call(e0,"buildno")&&n0.uint32(56).int32(e0.buildno),e0.installId!=null&&Object.hasOwnProperty.call(e0,"installId")&&n0.uint32(66).string(e0.installId),e0.os!=null&&Object.hasOwnProperty.call(e0,"os")&&n0.uint32(128).int32(e0.os),e0.did!=null&&Object.hasOwnProperty.call(e0,"did")&&n0.uint32(138).string(e0.did),e0.index!=null&&Object.hasOwnProperty.call(e0,"index")&&zc.Session.CommonIndex.encode(e0.index,n0.uint32(162).fork()).ldelim(),e0.token!=null&&Object.hasOwnProperty.call(e0,"token")&&n0.uint32(170).string(e0.token),e0.version!=null&&Object.hasOwnProperty.call(e0,"version")&&n0.uint32(176).int32(e0.version),e0.subVersion!=null&&Object.hasOwnProperty.call(e0,"subVersion")&&n0.uint32(184).int32(e0.subVersion),n0},t0.CommonIndex=function(){function e0(n0){if(n0)for(var r0=Object.keys(n0),i0=0;i0<r0.length;++i0)n0[r0[i0]]!=null&&(this[r0[i0]]=n0[r0[i0]])}return e0.prototype.index1="",e0.prototype.index2="",e0.prototype.index3="",e0.encode=function(n0,r0){return r0||(r0=Xc.create()),n0.index1!=null&&Object.hasOwnProperty.call(n0,"index1")&&r0.uint32(10).string(n0.index1),n0.index2!=null&&Object.hasOwnProperty.call(n0,"index2")&&r0.uint32(18).string(n0.index2),n0.index3!=null&&Object.hasOwnProperty.call(n0,"index3")&&r0.uint32(26).string(n0.index3),r0},e0}(),t0}(),SC=zc.Link=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.sid="",t0.prototype.userId="",t0.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.ec=0,t0.prototype.sc=0,t0.prototype.destServerIp="",t0.prototype.ackedServerIp="",t0.prototype.responseTime=0,t0.encode=function(e0,n0){return n0||(n0=Xc.create()),e0.sid!=null&&Object.hasOwnProperty.call(e0,"sid")&&n0.uint32(10).string(e0.sid),e0.userId!=null&&Object.hasOwnProperty.call(e0,"userId")&&n0.uint32(18).string(e0.userId),e0.lts!=null&&Object.hasOwnProperty.call(e0,"lts")&&n0.uint32(24).int64(e0.lts),e0.elapse!=null&&Object.hasOwnProperty.call(e0,"elapse")&&n0.uint32(32).int64(e0.elapse),e0.ec!=null&&Object.hasOwnProperty.call(e0,"ec")&&n0.uint32(40).int32(e0.ec),e0.sc!=null&&Object.hasOwnProperty.call(e0,"sc")&&n0.uint32(48).int32(e0.sc),e0.destServerIp!=null&&Object.hasOwnProperty.call(e0,"destServerIp")&&n0.uint32(58).string(e0.destServerIp),e0.ackedServerIp!=null&&Object.hasOwnProperty.call(e0,"ackedServerIp")&&n0.uint32(66).string(e0.ackedServerIp),e0.responseTime!=null&&Object.hasOwnProperty.call(e0,"responseTime")&&n0.uint32(72).int32(e0.responseTime),n0},t0}(),TC=zc.Logout=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.sid="",t0.prototype.userId="",t0.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,t0.encode=function(e0,n0){return n0||(n0=Xc.create()),e0.sid!=null&&Object.hasOwnProperty.call(e0,"sid")&&n0.uint32(10).string(e0.sid),e0.userId!=null&&Object.hasOwnProperty.call(e0,"userId")&&n0.uint32(18).string(e0.userId),e0.lts!=null&&Object.hasOwnProperty.call(e0,"lts")&&n0.uint32(24).int64(e0.lts),e0.elapse!=null&&Object.hasOwnProperty.call(e0,"elapse")&&n0.uint32(32).int64(e0.elapse),n0},t0}(),UC=zc.KickedOff=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.sid="",t0.prototype.userId="",t0.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.linkId=0,t0.prototype.code=0,t0.prototype.server="",t0.prototype.serverCode=0,t0.encode=function(e0,n0){return n0||(n0=Xc.create()),e0.sid!=null&&Object.hasOwnProperty.call(e0,"sid")&&n0.uint32(10).string(e0.sid),e0.userId!=null&&Object.hasOwnProperty.call(e0,"userId")&&n0.uint32(18).string(e0.userId),e0.lts!=null&&Object.hasOwnProperty.call(e0,"lts")&&n0.uint32(24).int64(e0.lts),e0.elapse!=null&&Object.hasOwnProperty.call(e0,"elapse")&&n0.uint32(32).int64(e0.elapse),e0.linkId!=null&&Object.hasOwnProperty.call(e0,"linkId")&&n0.uint32(48).int32(e0.linkId),e0.code!=null&&Object.hasOwnProperty.call(e0,"code")&&n0.uint32(56).int32(e0.code),e0.server!=null&&Object.hasOwnProperty.call(e0,"server")&&n0.uint32(66).string(e0.server),e0.serverCode!=null&&Object.hasOwnProperty.call(e0,"serverCode")&&n0.uint32(72).int32(e0.serverCode),n0},t0}(),VC=zc.ChnJoin=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.sid="",t0.prototype.userId="",t0.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.cname="",t0.prototype.errCode=0,t0.encode=function(e0,n0){return n0||(n0=Xc.create()),e0.sid!=null&&Object.hasOwnProperty.call(e0,"sid")&&n0.uint32(10).string(e0.sid),e0.userId!=null&&Object.hasOwnProperty.call(e0,"userId")&&n0.uint32(18).string(e0.userId),e0.lts!=null&&Object.hasOwnProperty.call(e0,"lts")&&n0.uint32(24).int64(e0.lts),e0.elapse!=null&&Object.hasOwnProperty.call(e0,"elapse")&&n0.uint32(32).int64(e0.elapse),e0.cname!=null&&Object.hasOwnProperty.call(e0,"cname")&&n0.uint32(50).string(e0.cname),e0.errCode!=null&&Object.hasOwnProperty.call(e0,"errCode")&&n0.uint32(56).int32(e0.errCode),n0},t0}(),WC=zc.ChnJoinRes=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.sid="",t0.prototype.userId="",t0.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.cname="",t0.prototype.errCode=0,t0.prototype.serverErrCode=0,t0.encode=function(e0,n0){return n0||(n0=Xc.create()),e0.sid!=null&&Object.hasOwnProperty.call(e0,"sid")&&n0.uint32(10).string(e0.sid),e0.userId!=null&&Object.hasOwnProperty.call(e0,"userId")&&n0.uint32(18).string(e0.userId),e0.lts!=null&&Object.hasOwnProperty.call(e0,"lts")&&n0.uint32(24).int64(e0.lts),e0.elapse!=null&&Object.hasOwnProperty.call(e0,"elapse")&&n0.uint32(32).int64(e0.elapse),e0.cname!=null&&Object.hasOwnProperty.call(e0,"cname")&&n0.uint32(50).string(e0.cname),e0.errCode!=null&&Object.hasOwnProperty.call(e0,"errCode")&&n0.uint32(56).int32(e0.errCode),e0.serverErrCode!=null&&Object.hasOwnProperty.call(e0,"serverErrCode")&&n0.uint32(64).int32(e0.serverErrCode),n0},t0}(),XC=zc.ChnLeave=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.sid="",t0.prototype.userId="",t0.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.cname="",t0.prototype.errCode=0,t0.encode=function(e0,n0){return n0||(n0=Xc.create()),e0.sid!=null&&Object.hasOwnProperty.call(e0,"sid")&&n0.uint32(10).string(e0.sid),e0.userId!=null&&Object.hasOwnProperty.call(e0,"userId")&&n0.uint32(18).string(e0.userId),e0.lts!=null&&Object.hasOwnProperty.call(e0,"lts")&&n0.uint32(24).int64(e0.lts),e0.elapse!=null&&Object.hasOwnProperty.call(e0,"elapse")&&n0.uint32(32).int64(e0.elapse),e0.cname!=null&&Object.hasOwnProperty.call(e0,"cname")&&n0.uint32(50).string(e0.cname),e0.errCode!=null&&Object.hasOwnProperty.call(e0,"errCode")&&n0.uint32(56).int32(e0.errCode),n0},t0}(),YC=zc.ConnectionStateChange=function(){function t0(e0){if(e0)for(var n0=Object.keys(e0),r0=0;r0<n0.length;++r0)e0[n0[r0]]!=null&&(this[n0[r0]]=e0[n0[r0]])}return t0.prototype.sid="",t0.prototype.userId="",t0.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,t0.prototype.oldState=0,t0.prototype.newState=0,t0.prototype.reason=0,t0.prototype.reconnId=0,t0.encode=function(e0,n0){return n0||(n0=Xc.create()),e0.sid!=null&&Object.hasOwnProperty.call(e0,"sid")&&n0.uint32(10).string(e0.sid),e0.userId!=null&&Object.hasOwnProperty.call(e0,"userId")&&n0.uint32(18).string(e0.userId),e0.lts!=null&&Object.hasOwnProperty.call(e0,"lts")&&n0.uint32(24).int64(e0.lts),e0.elapse!=null&&Object.hasOwnProperty.call(e0,"elapse")&&n0.uint32(32).int64(e0.elapse),e0.oldState!=null&&Object.hasOwnProperty.call(e0,"oldState")&&n0.uint32(40).int32(e0.oldState),e0.newState!=null&&Object.hasOwnProperty.call(e0,"newState")&&n0.uint32(48).int32(e0.newState),e0.reason!=null&&Object.hasOwnProperty.call(e0,"reason")&&n0.uint32(56).int32(e0.reason),e0.reconnId!=null&&Object.hasOwnProperty.call(e0,"reconnId")&&n0.uint32(64).int32(e0.reconnId),n0},t0}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(t0){function e0(r0,i0,o0){return W(this,e0),m(n(o0=n0.call(this,o0,"Context")),"_token",void 0),m(n(o0),"config",void 0),m(n(o0),"_uid",void 0),m(n(o0),"_sid",void 0),m(n(o0),"_area","CN"),m(n(o0),"appId",void 0),m(n(o0),"enableCloudProxy",!1),m(n(o0),"cloudProxyServers",[]),o0.appId=r0,o0.config=i0,o0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"token",set:function(r0){this._token=typeof r0=="string"&&r0?r0:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(r0){if(this.log("The user ID is set to %s",oa(r0)),!za(r0))throw new Ia;this._uid=r0}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(r0){if(this.log("sid is set to %s",r0),typeof r0!="string"||!r0)throw new Ia;this._sid=r0}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(r0){this.log("area is set to %s",r0),typeof r0=="string"&&r0?this._area=r0:this.warn("set area failed")}}]),e0}(tb()),$C=!!Fc&&R(function(){Fc.prototype.finally.call({then:function(){}},function(){})});if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(t0){var e0=kd(this,mc("Promise")),n0=typeof t0=="function";return this.then(n0?function(r0){return mj(e0,t0()).then(function(){return r0})}:t0,n0?function(r0){return mj(e0,t0()).then(function(){throw r0})}:t0)}}),typeof Fc=="function"){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var t0=J(w.mark(function e0(n0){return w.wrap(function(r0){for(;;)switch(r0.prev=r0.next){case 0:return r0.t0=Uint8Array,r0.next=3,crypto.subtle.digest("SHA-256",n0);case 3:return r0.t1=r0.sent,r0.abrupt("return",new r0.t0(r0.t1));case 5:case"end":return r0.stop()}},e0)}));return function(e0){return t0.apply(this,arguments)}}(),$r=function(t0){return Array.from(t0).map(function(e0){return e0.toString(16).padStart(2,"0")}).join("")},bD=function(t0){if(typeof t0!="string")throw new TypeError("Expected input to be a string");if(t0.length%2!=0)throw new RangeError("Expected string to be an even number of characters");for(var e0=new Uint8Array(t0.length/2),n0=0;n0<t0.length;n0+=2)e0[n0/2]=parseInt(t0.substring(n0,n0+2),16);return e0},as=function(t0){return btoa(String.fromCharCode.apply(String,G(t0))).replace(/={1,2}$/,"")},bs=function(){var t0=J(w.mark(function e0(n0){var r0;return w.wrap(function(i0){for(;;)switch(i0.prev=i0.next){case 0:return i0.prev=0,i0.next=3,crypto.subtle.digest("SHA-1",n0);case 3:r0=i0.sent,i0.next=9;break;case 6:i0.prev=6,i0.t0=i0.catch(0),r0=sha1.arrayBuffer(n0);case 9:return i0.abrupt("return",as(new Uint8Array(r0)));case 10:case"end":return i0.stop()}},e0,null,[[0,6]])}));return function(e0){return t0.apply(this,arguments)}}(),cs=function(t0,e0,n0,r0){r0[e0]=!0,n0.has(t0)?n0.get(t0).add(e0):n0.set(t0,new Set([e0]))},cD=function(t0){switch(t0){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(t0){function e0(r0,i0,o0,s0){W(this,e0);var a0=n0.call(this,o0,"ChunkDownloadManager");if(m(n(a0),"abortController",new AbortController),m(n(a0),"downloadedSize",0),m(n(a0),"successCount",0),m(n(a0),"timer",void 0),m(n(a0),"chunks",[]),m(n(a0),"retUnit",void 0),m(n(a0),"singleThread",!1),m(n(a0),"initialized",!1),m(n(a0),"ee",void 0),m(n(a0),"chunkCount",void 0),m(n(a0),"aborted",!1),m(n(a0),"serverToIndices",new Map),m(n(a0),"backupToIndices",new Map),m(n(a0),"indexToBackupServers",[]),m(n(a0),"busyBackupServers",new Map),m(n(a0),"downloadingChunks",new Set),m(n(a0),"metaInfo",void 0),m(n(a0),"transHandler",void 0),a0.metaInfo=r0,a0.transHandler=i0,a0.ee=s0===void 0?new ea:s0,o0=r0.size,r0=r0.unit,o0===0)throw new Ia("size cannot be 0");return i0.cancelSignal!==void 0&&i0.cancelSignal.addEventListener("abort",function(){a0.abortController.abort()},{once:!0}),a0.abortController.signal.addEventListener("abort",function(){a0.aborted=!0},{once:!0}),a0.chunkCount=Math.ceil(o0/(32768*r0)),a0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"setInfoByResponse",value:function(r0){var i0=this,o0=r0.serverList,s0=r0.backupList;if(r0=r0.unit,o0.length<this.chunkCount&&s0.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var a0=Array(this.chunkCount).fill(!1);if(o0.forEach(function(c0,u0){return c0.forEach(function(l0){return cs(l0,u0,i0.serverToIndices,a0)})}),s0.forEach(function(c0,u0){return c0.forEach(function(l0){return cs(l0,u0,i0.backupToIndices,a0)})}),a0.some(function(){return!1}))throw new da("Not enough servers to download",mg);this.indexToBackupServers=s0.map(function(c0){return new Set(c0)}),this.retUnit=r0}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):this.serverToIndices.size===1&&Array.from(this.serverToIndices.keys())[0]===0?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(r0){var i0=this,o0=this.downloadedSize+r0;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=o0,this.timer!==void 0&&r0!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&this.successCount!==this.chunkCount&&(this.timer=setTimeout(function(){i0.ee.emit("timedOut"),i0.abortController.abort()},12e4)),this.initialized&&r0===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var r0=0,i0=0,o0=this.chunks;i0<o0.length;i0++)r0+=o0[i0].byteLength;if(r0!==this.metaInfo.size)throw new Ia("invalid chunks total size");r0=new Uint8Array(r0),o0=i0=0;for(var s0=this.chunks;o0<s0.length;o0++){var a0=s0[o0];r0.set(new Uint8Array(a0),i0),i0+=a0.byteLength}return i0=Array.from(r0.subarray(0,4)).map(function(c0){return c0.toString(16)}).join("").toUpperCase(),Zt(r0.buffer,cD(i0))}},{key:"getDownloadUrl",value:function(r0){var i0=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(r0).split(".").join("-"),".edge.").concat(i0,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0=this,c0=arguments;return w.wrap(function(u0){for(;;)switch(u0.prev=u0.next){case 0:return s0=1<c0.length&&c0[1]!==void 0&&c0[1],u0.next=3,Promise.all(Array.from(o0.entries()).map(function(l0){return l0=ra(l0,2),a0.postDownloadRequest(l0[0],Array.from(l0[1]),s0).catch(function(d0){d0.statusCode===404?(a0.ee.emit("notExist"),a0.abortController.abort()):d0.name!=="AbortError"&&(Sa(d0)?a0.singleThread?(a0.abortController.abort(),a0.ee.emit("timedOut")):(a0.warn("%d download timed out after %d, retrying use single thread",d0.index,a0.singleThread?6e4:3e4),a0.abortController.abort(),a0.singleThread=!0,a0.ee.emit("multiTimeOut")):(a0.ee.emit("error",d0),a0.abortController.abort()))})}));case 3:case"end":return u0.stop()}},i0)}));return function(i0){return r0.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var r0=J(w.mark(function i0(o0,s0,a0){var c0,u0,l0,d0,h0,p0,m0,f0,g0,E0=this;return w.wrap(function(_0){for(;;)switch(_0.prev=_0.next){case 0:if(g0=function(){return(g0=J(w.mark(function y0(b0){var S0,w0,I0,L0,M0,C0,U0,x0,j0;return w.wrap(function(k0){for(;;)switch(k0.prev=k0.next){case 0:if(k0.prev=0,b0!==void 0||o0!==0){k0.next=5;break}throw new Ia("Invalid serverIp");case 5:S0=b0===void 0?m0.getDownloadUrl(o0):b0;case 6:return m0.downloadingChunks.add(c0),k0.next=9,p0(S0);case 9:return w0=k0.sent,I0=w0.responseData,m0.downloadingChunks.delete(c0),k0.abrupt("return",I0);case 15:if(k0.prev=15,k0.t0=k0.catch(0),m0.downloadingChunks.delete(c0),s0.unshift(c0),m0.metaInfo.useNewDomain=!1,k0.t0.name!=="AbortError"){k0.next=22;break}throw k0.t0;case 22:if(!Sa(k0.t0)){k0.next=25;break}throw k0.t0.index=c0,k0.t0;case 25:if(L0=d0,d0+=1,!(2>L0)){k0.next=30;break}return k0.t0 instanceof Ia||m0.warn("%o, %d download failed, retrying",k0.t0,c0),k0.abrupt("return",f0());case 30:if(k0.t0.statusCode!==504){k0.next=34;break}throw(M0=new db("download server timed out",{originalError:k0.t0,serverCode:504})).index=c0,M0;case 34:if(!a0||L0!==2||h0[0]===0){k0.next=45;break}return k0.t0 instanceof Ia||m0.warn("%d download failed, using backup: %d, %o",c0,h0[0],k0.t0),k0.next=38,m0.busyBackupServers.get(h0[0]);case 38:return C0=f0(m0.getDownloadUrl(h0[0])),m0.busyBackupServers.set(h0[0],C0),k0.next=42,C0;case 42:return U0=k0.sent,m0.busyBackupServers.delete(h0[0]),k0.abrupt("return",U0);case 45:if(!(a0&&2<L0&&h0[1]!==void 0&&h0[1]!==0)){k0.next=56;break}return m0.warn("%d download failed, using backup 1: %d",c0,h0[1]),k0.next=49,m0.busyBackupServers.get(h0[1]);case 49:return x0=f0(m0.getDownloadUrl(h0[1])),m0.busyBackupServers.set(h0[1],x0),k0.next=53,x0;case 53:return j0=k0.sent,m0.busyBackupServers.delete(h0[1]),k0.abrupt("return",j0);case 56:throw k0.t0.index=c0,k0.t0;case 58:case"end":return k0.stop()}},y0,null,[[0,15]])}))).apply(this,arguments)},f0=function(y0){return g0.apply(this,arguments)},!this.aborted){_0.next=4;break}throw new Ia("download already aborted");case 4:if((c0=s0.shift())!==void 0){_0.next=8;break}return this.log("%s download finished",o0),_0.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){_0.next=10;break}return _0.abrupt("return");case 10:if(!this.downloadingChunks.has(c0)){_0.next=13;break}return this.log("%s already downloading, return",c0),_0.abrupt("return");case 13:if(this.chunks[c0]===void 0){_0.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",c0),_0.next=18,this.postDownloadRequest(o0,s0,a0);case 18:return _0.abrupt("return");case 19:return u0=new FormData,l0={hash:hu(this.metaInfo.hashHexStr),unit:this.retUnit===void 0?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:c0},u0.append("parameter",JSON.stringify(l0)),d0=0,h0=Array.from(this.indexToBackupServers[c0]),p0=function(y0){return te(y0,{body:u0,signal:E0.abortController.signal,timeout:E0.singleThread?12e4:3e4},{useBinaryResponse:!0})},m0=this,_0.next=28,f0().then(function(y0){return E0.chunks[c0]!==void 0?E0.log("chunk %d download duplicated",c0):(E0.chunks[c0]=y0,E0.log("chunk %d downloaded",c0),E0.successCount+=1,E0.updateProgress(E0.chunks[c0].byteLength)),E0.successCount===E0.chunkCount&&(E0.log("chunks all download"),E0.ee.emit("finished")),E0.singleThread?(E0.downloadChunks(),Promise.resolve()):E0.postDownloadRequest(o0,s0,a0)});case 28:case"end":return _0.stop()}},i0,this)}));return function(i0,o0,s0){return r0.apply(this,arguments)}}()}]),e0}(tb()),es=function(t0){function e0(r0,i0,o0,s0){W(this,e0);var a0=n0.call(this,o0,"ChunkUploadManager");if(m(n(a0),"chunkCount",0),m(n(a0),"chunks",[]),m(n(a0),"uploadedChunks",[]),m(n(a0),"totalFailures",0),m(n(a0),"timer",void 0),m(n(a0),"initState","uninitialized"),m(n(a0),"ee",void 0),m(n(a0),"unit",0),m(n(a0),"uploadedSize",0),m(n(a0),"singleThread",!1),m(n(a0),"abortController",new AbortController),m(n(a0),"servers",[]),m(n(a0),"aborted",!1),m(n(a0),"metaInfo",void 0),m(n(a0),"transHandler",void 0),a0.metaInfo=r0,a0.transHandler=i0,a0.ee=s0===void 0?new ea:s0,r0.file.length===0)throw new I("file not found or is empty",wf);return i0.cancelSignal!==void 0&&i0.cancelSignal.addEventListener("abort",function(){a0.abortController.abort()},{once:!0}),a0.abortController.signal.addEventListener("abort",function(){a0.aborted=!0},{once:!0}),a0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"initChunks",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0,d0=this;return w.wrap(function(h0){for(;;)switch(h0.prev=h0.next){case 0:if(this.initState!=="initialized"&&this.initState!=="initializing"){h0.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=o0,s0=this.sliceFile(o0,this.metaInfo.file),this.chunkCount=s0.length,a0=[],c0=function(p0,m0){var f0=(p0=ra(m0[p0],2))[0],g0=p0[1];p0=bs(g0).then(function(E0){d0.chunks[f0]={payload:g0,sha1:E0,uploadedTo:void 0,index:f0,processed:!1}}),a0.push(p0)},u0=0,l0=Array.from(s0.entries());u0<l0.length;u0++)c0(u0,l0);return h0.next=11,Promise.all(a0);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return h0.stop()}},i0,this)}));return function(i0){return r0.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var r0=this;if(!this.aborted){for(var i0=this.chunks.filter(function(a0){return!a0.processed}),o0=function(a0){var c0=i0[a0],u0=r0.servers.filter(function(d0){return!d0.isUploading}).sort(function(d0,h0){return d0.successCount-h0.successCount}).sort(function(d0,h0){return d0.failureCount-h0.failureCount})[0];if(u0===void 0||1<u0.failureCount)return r0.log("Upload server not available, waiting"),r0.ee.emit("serverUsedUp"),Om(1e3).then(function(){r0.totalFailures>2*r0.chunkCount&&r0.ee.emit("error"),r0.totalFailures+=1,u0!==void 0&&(u0.failureCount=0),r0.uploadToServers()}).catch(function(){}),"break";c0.processed=!0,u0.isUploading=!0,r0.log("uploading chunk %d to server %s",c0.index,Dg(u0.ip));var l0=r0.getUploadUrl(u0.ip);return J(w.mark(function d0(){var h0;return w.wrap(function(p0){for(;;)switch(p0.prev=p0.next){case 0:return p0.prev=0,p0.next=3,r0.postChunk(c0.payload,l0,c0.index);case 3:h0=r0.chunks.findIndex(function(m0){return m0===c0}),c0.uploadedTo=u0.ip,r0.chunks.splice(h0,1),r0.uploadedChunks.push(c0),u0.successCount+=1,u0.isUploading=!1,r0.updateProgress(c0.payload.byteLength),r0.log("upload chunk %d successfully",c0.index),p0.next=31;break;case 13:if(p0.prev=13,p0.t0=p0.catch(0),u0.isUploading=!1,c0.processed=!1,p0.t0.statusCode!==504&&!Sa(p0.t0)){p0.next=27;break}if(r0.singleThread){p0.next=24;break}return r0.warn("%d upload timed out after %d, retrying use single thread",c0.index,r0.singleThread?12e4:3e4),r0.abortController.abort(),r0.singleThread=!0,r0.ee.emit("multiTimeOut"),p0.abrupt("return");case 24:return r0.ee.emit("timedOut"),r0.abortController.abort(),p0.abrupt("return");case 27:return r0.metaInfo.useNewDomain=!1,u0.failureCount+=1,p0.next=31,Om(1e3);case 31:r0.uploadedChunks.length===r0.chunkCount?(r0.log("chunks uploaded"),r0.ee.emit("finished")):(r0.singleThread||r0.chunks.filter(function(m0){return!m0.processed}).length===1)&&r0.uploadToServers();case 32:case"end":return p0.stop()}},d0,null,[[0,13]])}))(),r0.singleThread?"break":void 0},s0=0;s0<i0.length&&o0(s0)!=="break";s0++);i0.length===0&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var r0=!0,i0=[],o0=G(this.uploadedChunks).sort(function(c0,u0){return c0.index-u0.index}),s0=0;for(o0=Array.from(o0.values());s0<o0.length;s0++){var a0=o0[s0].uploadedTo;if(a0===void 0){r0=!1;break}i0.push(a0)}if(!r0)throw new Ia("some chunks not uploaded, cannot get upload server ips");return i0}},{key:"addServers",value:function(r0){var i0=this;r0.forEach(function(o0){var s0=i0.servers.findIndex(function(a0){return a0.ip===o0});s0!==-1?i0.servers[s0].failureCount=0:(i0.log("server %s added",Dg(o0)),i0.servers.push({successCount:0,isUploading:!1,ip:o0,failureCount:0}))})}},{key:"updateProgress",value:function(r0){var i0=this,o0=r0!==void 0?this.uploadedSize+r0:this.metaInfo.file.length;o0>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=o0,this.timer!==void 0&&r0!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&r0!==void 0&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout(function(){i0.ee.emit("timedOut"),i0.abortController.abort()},12e4)),this.initState==="initialized"&&r0===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(r0,i0){var o0=0,s0=[],a0=i0.length;for(r0*=32768;o0<a0;)s0.push(i0.slice(o0,o0+r0)),o0+=r0;return this.log("chunks split into %d",s0.length),s0}},{key:"postChunk",value:function(){var r0=J(w.mark(function i0(o0,s0,a0){var c0,u0,l0,d0,h0,p0,m0,f0;return w.wrap(function(g0){for(;;)switch(g0.prev=g0.next){case 0:if(!this.aborted){g0.next=2;break}throw new Ia("upload already aborted");case 2:if(this.unit!==void 0){g0.next=4;break}throw new Ia("unit is undefined");case 4:return c0=this.metaInfo,u0=c0.ticket,l0=c0.instance,d0=c0.loginOpt,h0=c0.hashStr,g0.t0=a0,g0.t1=h0,g0.next=9,bs(o0);case 9:return g0.t2=g0.sent,g0.t3=this.unit,g0.t4=u0,g0.t5=l0,g0.t6=d0,p0={index:g0.t0,hash:g0.t1,sha1:g0.t2,unit:g0.t3,ticket:g0.t4,instance:g0.t5,loginOpt:g0.t6},(m0=new FormData).append("parameter",JSON.stringify(p0)),m0.append("payload",new Blob([o0])),g0.next=20,te(s0,{headers:{Accept:"application/json"},body:m0,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(f0=g0.sent,f0.status===201){g0.next=24;break}throw new da("uploading chunk ".concat(a0," failed"));case 24:case"end":return g0.stop()}},i0,this)}));return function(i0,o0,s0){return r0.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(r0){var i0=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(r0).split(".").join("-"),".edge.").concat(i0,":9601/api/v1/chuck/upload")}}]),e0}(tb()),fs=function(t0){function e0(r0){W(this,e0);var i0=n0.call(this,r0,"MediaTaskManager");return m(n(i0),"isProcessing",!1),m(n(i0),"authInfo",void 0),m(n(i0),"taskFinishers",{}),m(n(i0),"mediaTasks",new Map),m(n(i0),"ongoingTask",void 0),i0.on("connectionStateChanged",function(o0){if(o0===S.ConnectionState.ABORTED||o0===S.ConnectionState.DISCONNECTED){i0.ongoingTask!==void 0&&i0.cancelTask(i0.ongoingTask),o0=0;for(var s0=Array.from(i0.mediaTasks.entries());o0<s0.length;o0++){var a0=ra(s0[o0],2)[1];i0.cancelTask(a0)}i0.mediaTasks.clear(),i0.taskFinishers={}}else o0===S.ConnectionState.RECONNECTING?i0.ongoingTask!==void 0&&i0.ongoingTask.manager.abortController.abort():o0===S.ConnectionState.CONNECTED&&i0.ongoingTask!==void 0&&i0.ongoingTask.manager.ee.emit("reconnected")}),i0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"setAuthInfo",value:function(r0){this.authInfo=r0}},{key:"waitMediaTask",value:function(r0){var i0=this;return new Promise(function(o0,s0){i0.taskFinishers[r0]={resolve:o0,reject:s0},i0.isProcessing||i0.processMediaTask()}).finally(function(){i0.ongoingTask!==void 0&&i0.ongoingTask.manager.timer!==void 0&&clearTimeout(i0.ongoingTask.manager.timer),delete i0.taskFinishers[r0],i0.mediaTasks.size!==0?i0.processMediaTask():i0.isProcessing=!1})}},{key:"addUploadTask",value:function(r0,i0,o0,s0){var a0=r0.file;if(r0=r0.hash,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=e0.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return s0=new es({hashStr:as(r0),file:a0,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},s0,this.logger),a0=Ud(),this.mediaTasks.set(a0,{type:"UPLOAD",manager:s0,hash:r0,setter:o0,fetcher:i0,taskId:a0}),a0}},{key:"addDownloadTask",value:function(r0,i0,o0){var s0=r0.hashHexStr,a0=r0.size,c0=r0.unit;if(r0=r0.zone,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=e0.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return o0=new ds({hashHexStr:s0,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:a0,zone:r0,unit:c0},o0,this.logger),s0=Ud(),this.mediaTasks.set(s0,{type:"DOWNLOAD",manager:o0,fetcher:i0,taskId:s0}),s0}},{key:"doDownloadTaskImpl",value:function(){var r0=J(w.mark(function i0(o0,s0){var a0,c0,u0,l0,d0,h0,p0,m0,f0=this,g0=arguments;return w.wrap(function(E0){for(;;)switch(E0.prev=E0.next){case 0:return a0=2<g0.length&&g0[2]!==void 0&&g0[2],u0=c0=o0.manager,a0&&(c0=new ds(u0.metaInfo,u0.transHandler,this.logger,u0.ee)),l0=o0.fetcher,E0.next=7,l0();case 7:if(d0=E0.sent,h0=d0.serverList,p0=d0.backupList,m0=d0.unit,!a0||m0===u0.retUnit){E0.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:a0&&(o0.manager=c0,c0.downloadedSize=u0.downloadedSize,c0.successCount=u0.successCount,c0.timer=u0.timer,c0.chunks=u0.chunks,c0.initialized=u0.initialized,c0.singleThread=u0.singleThread,c0.updateProgress(0)),c0.ee.once("reconnected",function(){c0.ee.removeAllListeners(),f0.doDownloadTaskImpl(o0,s0,!0).catch(function(_0){s0.reject(_0)})}),c0.ee.once("multiTimeOut",function(){c0.ee.removeAllListeners(),f0.doDownloadTaskImpl(o0,s0,!0).catch(function(_0){s0.reject(_0)})}),c0.ee.once("error",function(_0){c0.ee.removeAllListeners(),s0.reject(new da(["download file file, index %d",_0.index],{code:mg,originalError:_0}))}),c0.ee.once("notExist",function(){c0.abortController.abort(),c0.ee.removeAllListeners(),s0.reject(new da("download file not found",AA))}),c0.ee.once("timedOut",function(){c0.ee.removeAllListeners(),c0.abortController.abort(),s0.reject(new db("download timed out",zA))}),c0.transHandler.cancelSignal!==void 0&&c0.transHandler.cancelSignal.addEventListener("abort",function(){s0.reject(new hl("Downloading canceled",ir))},{once:!0}),c0.ee.once("finished",function(){s0.resolve({type:"DOWNLOAD",payload:c0.getPayload()})}),c0.setInfoByResponse({serverList:h0,backupList:p0,unit:m0}),c0.downloadChunks();case 23:case"end":return E0.stop()}},i0,this)}));return function(i0,o0){return r0.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(r0,i0){var o0=this,s0=2<arguments.length&&arguments[2]!==void 0&&arguments[2],a0=r0.taskId;return s0||(this.mediaTasks.delete(a0),this.ongoingTask=r0),new Promise(function(c0,u0){o0.doDownloadTaskImpl(r0,i0,s0).then(c0).catch(u0)})}},{key:"doUploadTaskImpl",value:function(){var r0=J(w.mark(function i0(o0,s0){var a0,c0,u0,l0,d0,h0,p0,m0,f0,g0=this,E0=arguments;return w.wrap(function(_0){for(;;)switch(_0.prev=_0.next){case 0:return a0=2<E0.length&&E0[2]!==void 0&&E0[2],u0=c0=o0.manager,a0&&(c0=new es(u0.metaInfo,u0.transHandler,this.logger,u0.ee)),l0=o0.fetcher,d0=new Pa,p0=new Promise(function(y0,b0){var S0=l0(),w0=S0.ret,I0=S0.err,L0=S0.timeout;S0.fin.pipe(ob(d0)).subscribe({next:function(M0){s0.resolve({type:"UPLOAD",retUnit:M0.unit,zone:M0.zone})},complete:function(){y0({hasExist:!0}),d0.next(),d0.complete()}}),w0.pipe(ob(d0),cb(function(){var M0=J(w.mark(function C0(U0){var x0,j0;return w.wrap(function(k0){for(;;)switch(k0.prev=k0.next){case 0:if(x0=U0.servers,j0=U0.unit,a0&&u0.unit!==j0?s0.reject(new da("upload unit is different, reject to continue",lg)):a0&&(o0.manager=c0,c0.chunkCount=u0.chunkCount,c0.chunks=u0.chunks,c0.totalFailures=u0.totalFailures,c0.uploadedChunks=u0.uploadedChunks,c0.timer=u0.timer,c0.initState=u0.initState,c0.unit=u0.unit,c0.uploadedSize=u0.uploadedSize,c0.singleThread=u0.singleThread,c0.updateProgress(0)),c0.addServers(x0),c0.initState!=="uninitialized"){k0.next=7;break}return h0=c0.initChunks(j0),k0.next=7,h0;case 7:case"end":return k0.stop()}},C0)}));return function(C0){return M0.apply(this,arguments)}}())).subscribe({complete:function(){return y0({hasExist:!1})},error:b0}),S0=function(M0){c0.initState!=="uninitialized"&&h0?y0(h0.then(function(){return{hasExist:!1}})):b0(M0)},I0.pipe(ob(d0)).subscribe({error:S0}),L0.pipe(ob(d0)).subscribe({error:S0})}),_0.next=9,p0;case 9:if(m0=_0.sent,!m0.hasExist){_0.next=15;break}return c0.updateProgress(),this.log("file already exists, skipping upload"),_0.abrupt("return");case 15:d0.next(),d0.complete(),this.log("chunks initialization promise resolved"),f0=gb(c0.ee,"serverUsedUp").pipe(Gt(function(){return c0.chunkCount!==c0.uploadedChunks.length}),Jt(5e3,void 0,{leading:!1}),pm(function(){return l0().ret})).subscribe(function(y0){c0.addServers(y0.servers)}),c0.ee.once("reconnected",function(){c0.ee.removeAllListeners(),g0.doUploadTask(o0,s0,!0).catch(function(y0){s0.reject(y0)})}),c0.ee.once("multiTimeOut",function(){c0.ee.removeAllListeners(),g0.doUploadTask(o0,s0,!0).catch(function(y0){s0.reject(y0)})}),c0.ee.once("timedOut",function(){f0.unsubscribe(),c0.ee.removeAllListeners(),c0.abortController.abort(),s0.reject(new db("upload timed out",Lh))}),c0.ee.once("error",function(y0){f0.unsubscribe(),c0.ee.removeAllListeners(),c0.abortController.abort(),s0.reject(y0||new da("upload error",lg))}),c0.transHandler.cancelSignal!==void 0&&c0.transHandler.cancelSignal.addEventListener("abort",function(){s0.reject(new hl("Uploading canceled",hr))},{once:!0}),c0.ee.once("finished",J(w.mark(function y0(){var b0,S0,w0;return w.wrap(function(I0){for(;;)switch(I0.prev=I0.next){case 0:return f0.unsubscribe(),I0.next=3,o0.setter(c0.unit,c0.getUploadServerIPs());case 3:b0=I0.sent,S0=b0.zone,w0=b0.unit,c0.ee.removeAllListeners(),s0.resolve({type:"UPLOAD",retUnit:w0,zone:S0});case 8:case"end":return I0.stop()}},y0)}))),c0.uploadToServers();case 26:case"end":return _0.stop()}},i0,this)}));return function(i0,o0){return r0.apply(this,arguments)}}()},{key:"doUploadTask",value:function(r0,i0){var o0=this,s0=2<arguments.length&&arguments[2]!==void 0&&arguments[2],a0=r0.taskId;return s0||(this.mediaTasks.delete(a0),this.ongoingTask=r0),new Promise(function(c0,u0){o0.doUploadTaskImpl(r0,i0,s0).then(c0).catch(u0)})}},{key:"processMediaTask",value:function(){var r0=J(w.mark(function i0(){var o0,s0,a0;return w.wrap(function(c0){for(;;)switch(c0.prev=c0.next){case 0:if(this.mediaTasks.size!==0){c0.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,o0=this.mediaTasks.keys().next().value,(s0=this.taskFinishers[o0])!==void 0){c0.next=7;break}throw Error("top task not found");case 7:if((a0=this.mediaTasks.get(o0))!==void 0){c0.next=10;break}throw new Ia("task invalid");case 10:if(a0.type!=="UPLOAD"){c0.next=15;break}return c0.next=13,this.doUploadTask(a0,s0).catch(function(u0){a0.manager.ee.removeAllListeners(),s0.reject(u0)});case 13:c0.next=18;break;case 15:if(a0.type!=="DOWNLOAD"){c0.next=18;break}return c0.next=18,this.doDownloadTask(a0,s0).catch(function(u0){a0.manager.ee.removeAllListeners(),s0.reject(u0)});case 18:case"end":return c0.stop()}},i0,this)}));return function(){return r0.apply(this,arguments)}}()},{key:"cancelTask",value:function(r0){var i0=r0.type==="DOWNLOAD"?ir:hr;r0.manager.ee.removeAllListeners(),r0.manager.abortController.abort(),this.taskFinishers[r0.taskId]!==void 0&&this.taskFinishers[r0.taskId].reject(new hl("User logged out or kicked off, media task canceled",i0))}}]),e0}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",function(){for(var t0=0,e0=arguments.length,n0=new(Ne(this))(e0);e0>t0;)n0[t0]=arguments[t0++];return n0},Dj);var gs=1/0,dD=Math.max,ju=function(t0,e0,n0){var r0=Object(t0);if(!Ed(t0)){var i0=Te(e0);t0=Ad(t0),e0=function(o0){return i0(r0[o0],o0,r0)}}return-1<(e0=function(o0,s0,a0){var c0=o0==null?0:o0.length;if(!c0)return-1;if(a0==null)a0=0;else{var u0=(a0=a0?(a0=gl(a0))===gs||a0===-gs?17976931348623157e292*(0>a0?-1:1):a0==a0?a0:0:a0===0?a0:0)%1;a0=a0==a0?u0?a0-u0:a0:0}return 0>a0&&(a0=dD(c0+a0,0)),Xp(o0,Te(s0),a0)}(t0,e0,n0))?r0[i0?t0[e0]:e0]:void 0},iu=function(t0,e0){return t0&&t0.length?vk(t0,void 0,typeof e0=="function"?e0:void 0):[]},hs=function(){function t0(){W(this,t0),m(this,"size",0),m(this,"fields",new Map)}return Ha(t0,[{key:"define",value:function(e0,n0,r0){if(this.size+=r0,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(n0={val:0,isNumber:n0==="number",isBoolean:n0==="boolean",oneof:n0==="number"||n0==="boolean"?void 0:n0,len:r0}),this.fields.set(e0,n0)}},{key:"set",value:function(e0,n0){if(!(e0=this.fields.get(e0)))throw Error("field not found");var r0=e0.oneof;if(!U.isLong(n0)&&typeof n0!="number")if(typeof n0=="boolean")n0=n0?1:0;else{if(r0===void 0)throw Error("invalid field type");if((n0=r0[n0])===void 0)throw Error("field type not found")}Mg(e0,n0),e0.val=n0}},{key:"toNumber",value:function(){for(var e0=0,n0=0,r0=0,i0=Array.from(this.fields);r0<i0.length;r0++){var o0=ra(i0[r0],2)[1],s0=o0.len;(o0=o0.val)!==void 0&&(e0+=U.fromValue(o0).shiftLeft(n0).toNumber(),n0+=s0)}return e0}},{key:"toLong",value:function(){for(var e0=U.fromNumber(0,!0),n0=0,r0=0,i0=Array.from(this.fields);r0<i0.length;r0++){var o0=ra(i0[r0],2)[1],s0=o0.len;(o0=o0.val)!==void 0&&(e0=U.fromValue(o0).shiftLeft(n0).add(e0),n0+=s0)}return e0}},{key:"assert",value:function(e0,n0){function r0(s0){if(!U.isLong(s0)&&typeof s0!="number")if(typeof s0=="boolean")s0=s0?1:0;else{if(o0===void 0)throw Error("invalid field type");if((s0=o0[s0])===void 0)throw Error("field type not found")}return Mg(i0,s0),Lg(s0,i0.val)}var i0=this.fields.get(e0);if(!i0)throw Error("field not found");var o0=i0.oneof;if(!Array.isArray(n0))return r0(n0);if(n0.length===1)return r0(n0[0]);if(n0.every(function(s0){return typeof s0=="string"})&&o0!==void 0)return n0.some(function(s0){return r0(s0)});throw Error("invalid valueTypes")}},{key:"from",value:function(e0){e0=U.fromValue(e0);for(var n0=0,r0=0,i0=Array.from(this.fields);r0<i0.length;r0++){var o0=ra(i0[r0],2)[1],s0=o0.len,a0=U.fromNumber(Math.pow(2,s0)-1,!0).shiftLeft(n0);Mg(o0,a0=e0.and(a0).shiftRightUnsigned(n0)),o0.val=a0,n0+=s0}}},{key:"typeOf",value:function(e0){if((e0=this.fields.get(e0))!==void 0){var n0=e0.oneof;if(e0=e0.val,n0!==void 0){var r0=0;for(n0=Object.entries(n0);r0<n0.length;r0++){var i0=ra(n0[r0],2),o0=i0[0];if(Lg(e0,i0[1]))return o0}}}throw new TypeError("can only get type of oneof type")}}]),t0}(),is=function(t0){function e0(r0){W(this,e0);var i0=n0.call(this);return i0.define("Rejoin","boolean",1),i0.define("Unused","number",31),i0.define("Platform","number",8),i0.define("Version","number",12),i0.define("Subversion","number",12),i0.set("Platform",7),i0.set("Version",4),i0.set("Subversion",203),i0.set("Rejoin",r0),i0}la(e0,t0);var n0=ma(e0);return e0}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(t0){function e0(r0){W(this,e0);var i0=n0.call(this);if(i0.define("MessageType",fD,8),i0.define("BroadcastJumps","number",2),i0.define("ToCache","boolean",1),i0.define("FromCache","boolean",1),i0.define("CompressionMethod",gD,2),i0.define("IterationNumber","number",4),i0.define("BufferedMessage","boolean",1),i0.define("ToArchive","boolean",1),i0.define("FromArchive","boolean",1),typeof r0=="number"||U.isLong(r0))i0.from(r0);else if(r0!==void 0){var o0=0;for(r0=Hg(r0);o0<r0.length;o0++){var s0=ra(r0[o0],2);i0.set(s0[0],s0[1])}}return i0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(r0){var i0=this;return r0!==void 0?this.assert("MessageType",r0):xf(js).some(function(o0){return i0.assert("MessageType",o0)})}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),e0}(hs),hD=function(t0){function e0(r0){return W(this,e0),m(n(r0=n0.call(this,r0,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),r0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"getChatInfo",value:function(r0){var i0=this.dialogueLru.get(r0);if(this.dialogueLru.prune(),i0){var o0=i0.dialogue,s0={dialogue:o0,sequence:i0=i0.sequence.add(1)};return this.dialogueLru.set(r0,{dialogue:o0,sequence:i0}),s0}return o0={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(r0,o0),o0}}]),e0}(tb()),v={};X(module)=="object"&&(module.exports=v),v.parse=function(t0,e0){var n0,r0=v.bin.readUshort,i0=v.bin.readUint,o0={};for(n0=(t0=new Uint8Array(t0)).length-4;i0(t0,n0)!=101010256;)n0--;var s0=r0(t0,n0=n0+4+4);r0(t0,n0+=2),i0(t0,n0+=2),n0=i0(t0,n0+=4);for(var a0=0;a0<s0;a0++){i0(t0,n0),n0+=4,n0+=4,n0+=4,i0(t0,n0+=4);var c0=i0(t0,n0+=4),u0=i0(t0,n0+=4),l0=r0(t0,n0+=4),d0=r0(t0,n0+2),h0=r0(t0,n0+4);n0+=6;var p0=i0(t0,n0+=8);n0+=4,n0+=l0+d0+h0,v._readLocal(t0,p0,o0,c0,u0,e0)}return o0},v._readLocal=function(t0,e0,n0,r0,i0,o0){var s0=v.bin.readUshort,a0=v.bin.readUint;a0(t0,e0),s0(t0,e0+=4),s0(t0,e0+=2);var c0=s0(t0,e0+=2);a0(t0,e0+=2),a0(t0,e0+=4),a0=s0(t0,e0=e0+4+8);var u0=s0(t0,e0+=2);if(e0+=2,s0=v.bin.readUTF8(t0,e0,a0),e0=e0+a0+u0,o0)n0[s0]={size:i0,csize:r0};else if(t0=new Uint8Array(t0.buffer,e0),c0==0)n0[s0]=new Uint8Array(t0.buffer.slice(e0,e0+r0));else{if(c0!=8)throw"unknown compression method: "+c0;e0=new Uint8Array(i0),v.inflateRaw(t0,e0),n0[s0]=e0}},v.inflateRaw=function(t0,e0){return v.F.inflate(t0,e0)},v.inflate=function(t0,e0){return t0[0],t0[1],v.inflateRaw(new Uint8Array(t0.buffer,t0.byteOffset+2,t0.length-2),e0)},v.deflate=function(t0,e0){e0==null&&(e0={level:6});var n0=0,r0=new Uint8Array(50+Math.floor(1.1*t0.length));return r0[n0]=120,r0[n0+1]=156,n0=v.F.deflateRaw(t0,r0,n0+2,e0.level),t0=v.adler(t0,0,t0.length),r0[n0+0]=t0>>>24&255,r0[n0+1]=t0>>>16&255,r0[n0+2]=t0>>>8&255,r0[n0+3]=t0>>>0&255,new Uint8Array(r0.buffer,0,n0+4)},v.deflateRaw=function(t0,e0){e0==null&&(e0={level:6});var n0=new Uint8Array(50+Math.floor(1.1*t0.length)),r0=v.F.deflateRaw(t0,n0,r0,e0.level);return new Uint8Array(n0.buffer,0,r0)},v.encode=function(t0,e0){e0==null&&(e0=!1);var n0,r0=0,i0=v.bin.writeUint,o0=v.bin.writeUshort,s0={};for(n0 in t0){var a0=!v._noNeed(n0)&&!e0,c0=t0[n0],u0=v.crc.crc(c0,0,c0.length);s0[n0]={cpr:a0,usize:c0.length,crc:u0,file:a0?v.deflateRaw(c0):c0}}for(n0 in s0)r0+=s0[n0].file.length+30+46+2*v.bin.sizeUTF8(n0);for(n0 in t0=new Uint8Array(r0+22),e0=0,c0=[],s0)u0=s0[n0],c0.push(e0),e0=v._writeHeader(t0,e0,n0,u0,0);for(n0 in r0=0,a0=e0,s0)u0=s0[n0],c0.push(e0),e0=v._writeHeader(t0,e0,n0,u0,1,c0[r0++]);return s0=e0-a0,i0(t0,e0,101010256),o0(t0,e0=e0+4+4,r0),o0(t0,e0+=2,r0),i0(t0,e0+=2,s0),i0(t0,e0+4,a0),t0.buffer},v._noNeed=function(t0){return t0=t0.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(t0)!=-1},v._writeHeader=function(t0,e0,n0,r0,i0,o0){var s0=v.bin.writeUint,a0=v.bin.writeUshort,c0=r0.file;return s0(t0,e0,i0==0?67324752:33639248),e0+=4,i0==1&&(e0+=2),a0(t0,e0,20),a0(t0,e0+=2,0),a0(t0,e0+=2,r0.cpr?8:0),s0(t0,e0+=2,0),s0(t0,e0+=4,r0.crc),s0(t0,e0+=4,c0.length),s0(t0,e0+=4,r0.usize),a0(t0,e0+=4,v.bin.sizeUTF8(n0)),a0(t0,e0+=2,0),e0+=2,i0==1&&(s0(t0,e0=e0+2+2+6,o0),e0+=4),e0+=n0=v.bin.writeUTF8(t0,e0,n0),i0==0&&(t0.set(c0,e0),e0+=c0.length),e0},v.crc={table:function(){for(var t0=new Uint32Array(256),e0=0;256>e0;e0++){for(var n0=e0,r0=0;8>r0;r0++)n0=1&n0?3988292384^n0>>>1:n0>>>1;t0[e0]=n0}return t0}(),update:function(t0,e0,n0,r0){for(var i0=0;i0<r0;i0++)t0=v.crc.table[255&(t0^e0[n0+i0])]^t0>>>8;return t0},crc:function(t0,e0,n0){return 4294967295^v.crc.update(4294967295,t0,e0,n0)}},v.adler=function(t0,e0,n0){var r0=1,i0=0,o0=e0;for(e0+=n0;o0<e0;){for(n0=Math.min(o0+5552,e0);o0<n0;)i0+=r0+=t0[o0++];r0%=65521,i0%=65521}return i0<<16|r0},v.bin={readUshort:function(t0,e0){return t0[e0]|t0[e0+1]<<8},writeUshort:function(t0,e0,n0){t0[e0]=255&n0,t0[e0+1]=n0>>8&255},readUint:function(t0,e0){return 16777216*t0[e0+3]+(t0[e0+2]<<16|t0[e0+1]<<8|t0[e0])},writeUint:function(t0,e0,n0){t0[e0]=255&n0,t0[e0+1]=n0>>8&255,t0[e0+2]=n0>>16&255,t0[e0+3]=n0>>24&255},readASCII:function(t0,e0,n0){for(var r0="",i0=0;i0<n0;i0++)r0+=String.fromCharCode(t0[e0+i0]);return r0},writeASCII:function(t0,e0,n0){for(var r0=0;r0<n0.length;r0++)t0[e0+r0]=n0.charCodeAt(r0)},pad:function(t0){return 2>t0.length?"0"+t0:t0},readUTF8:function(t0,e0,n0){for(var r0,i0="",o0=0;o0<n0;o0++)i0+="%"+v.bin.pad(t0[e0+o0].toString(16));try{r0=decodeURIComponent(i0)}catch{return v.bin.readASCII(t0,e0,n0)}return r0},writeUTF8:function(t0,e0,n0){for(var r0=n0.length,i0=0,o0=0;o0<r0;o0++){var s0=n0.charCodeAt(o0);if(!(4294967168&s0))t0[e0+i0]=s0,i0++;else if(!(4294965248&s0))t0[e0+i0]=192|s0>>6,t0[e0+i0+1]=128|s0>>0&63,i0+=2;else if(!(4294901760&s0))t0[e0+i0]=224|s0>>12,t0[e0+i0+1]=128|s0>>6&63,t0[e0+i0+2]=128|s0>>0&63,i0+=3;else{if(4292870144&s0)throw"e";t0[e0+i0]=240|s0>>18,t0[e0+i0+1]=128|s0>>12&63,t0[e0+i0+2]=128|s0>>6&63,t0[e0+i0+3]=128|s0>>0&63,i0+=4}}return i0},sizeUTF8:function(t0){for(var e0=t0.length,n0=0,r0=0;r0<e0;r0++){var i0=t0.charCodeAt(r0);if(!(4294967168&i0))n0++;else if(!(4294965248&i0))n0+=2;else if(!(4294901760&i0))n0+=3;else{if(4292870144&i0)throw"e";n0+=4}}return n0}},v.F={},v.F.deflateRaw=function(t0,e0,n0,r0){var i0=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][r0],o0=v.F.U,s0=v.F._goodIndex;v.F._hash;var a0=v.F._putsE,c0=0;n0<<=3;var u0=0,l0=t0.length;if(r0==0){for(;c0<l0;){var d0=Math.min(65535,l0-c0);a0(e0,n0,c0+d0==l0?1:0),n0=v.F._copyExact(t0,c0,d0,e0,n0+8),c0+=d0}return n0>>>3}a0=o0.lits,r0=o0.strt;var h0=o0.prev,p0=0,m0=0,f0=0,g0=0,E0=0;for(2<l0&&(r0[E0=v.F._hash(t0,0)]=0),c0=0;c0<l0;c0++){if(d0=E0,c0+1<l0-2){E0=v.F._hash(t0,c0+1);var _0=c0+1&32767;h0[_0]=r0[E0],r0[E0]=_0}if(u0<=c0){if((14e3<p0||26697<m0)&&100<l0-c0&&(u0<c0&&(a0[p0]=c0-u0,p0+=2,u0=c0),n0=v.F._writeBlock(c0==l0-1||u0==l0?1:0,a0,p0,g0,t0,f0,c0-f0,e0,n0),p0=m0=g0=0,f0=c0),_0=0,c0<l0-2&&(_0=v.F._bestMatch(t0,c0,h0,d0,Math.min(i0[2],l0-c0),i0[3])),_0!=0){d0=_0>>>16,_0&=65535;var y0=s0(d0,o0.of0);o0.lhst[257+y0]++;var b0=s0(_0,o0.df0);o0.dhst[b0]++,g0+=o0.exb[y0]+o0.dxb[b0],a0[p0]=d0<<23|c0-u0,a0[p0+1]=_0<<16|y0<<8|b0,p0+=2,u0=c0+d0}else o0.lhst[t0[c0]]++;m0++}}for(f0==c0&&t0.length!=0||(u0<c0&&(a0[p0]=c0-u0,p0+=2),n0=v.F._writeBlock(1,a0,p0,g0,t0,f0,c0-f0,e0,n0));7&n0;)n0++;return n0>>>3},v.F._bestMatch=function(t0,e0,n0,r0,i0,o0){var s0=32767&e0,a0=n0[s0],c0=s0-a0+32768&32767;if(a0==s0||r0!=v.F._hash(t0,e0-c0))return 0;for(var u0=r0=0,l0=Math.min(32767,e0);c0<=l0&&--o0!=0&&a0!=s0;){if((r0==0||t0[e0+r0]==t0[e0+r0-c0])&&(s0=v.F._howLong(t0,e0,c0))>r0){if(u0=c0,(r0=s0)>=i0)break;c0+2<s0&&(s0=c0+2);for(var d0=0,h0=0;h0<s0-2;h0++){var p0=e0-c0+h0+32768&32767,m0=p0-n0[p0]+32768&32767;m0>d0&&(d0=m0,a0=p0)}}c0+=(s0=a0)-(a0=n0[s0])+32768&32767}return r0<<16|u0},v.F._howLong=function(t0,e0,n0){if(t0[e0]!=t0[e0-n0]||t0[e0+1]!=t0[e0+1-n0]||t0[e0+2]!=t0[e0+2-n0])return 0;var r0=e0,i0=Math.min(t0.length,e0+258);for(e0+=3;e0<i0&&t0[e0]==t0[e0-n0];)e0++;return e0-r0},v.F._hash=function(t0,e0){return(t0[e0]<<8|t0[e0+1])+(t0[e0+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(t0,e0,n0,r0,i0,o0,s0,a0,c0){var u0=v.F.U,l0=v.F._putsF,d0=v.F._putsE;u0.lhst[256]++;var h0=v.F.getTrees(),p0=h0[0],m0=h0[1],f0=h0[2],g0=h0[3],E0=h0[4],_0=h0[5],y0=h0[6];h0=h0[7];var b0=32+(c0+3&7?8-(c0+3&7):0)+(s0<<3),S0=r0+v.F.contSize(u0.fltree,u0.lhst)+v.F.contSize(u0.fdtree,u0.dhst);r0=r0+v.F.contSize(u0.ltree,u0.lhst)+v.F.contSize(u0.dtree,u0.dhst),r0+=14+3*_0+v.F.contSize(u0.itree,u0.ihst)+(2*u0.ihst[16]+3*u0.ihst[17]+7*u0.ihst[18]);for(var w0=0;286>w0;w0++)u0.lhst[w0]=0;for(w0=0;30>w0;w0++)u0.dhst[w0]=0;for(w0=0;19>w0;w0++)u0.ihst[w0]=0;if(b0=b0<S0&&b0<r0?0:S0<r0?1:2,l0(a0,c0,t0),l0(a0,c0+1,b0),c0+=3,b0==0){for(;7&c0;)c0++;c0=v.F._copyExact(i0,o0,s0,a0,c0)}else{if(b0==1)var I0=u0.fltree,L0=u0.fdtree;if(b0==2){for(v.F.makeCodes(u0.ltree,p0),v.F.revCodes(u0.ltree,p0),v.F.makeCodes(u0.dtree,m0),v.F.revCodes(u0.dtree,m0),v.F.makeCodes(u0.itree,f0),v.F.revCodes(u0.itree,f0),I0=u0.ltree,L0=u0.dtree,d0(a0,c0,g0-257),d0(a0,c0+=5,E0-1),d0(a0,c0+=5,_0-4),c0+=4,t0=0;t0<_0;t0++)d0(a0,c0+3*t0,u0.itree[1+(u0.ordr[t0]<<1)]);c0=v.F._codeTiny(y0,u0.itree,a0,c0+3*_0),c0=v.F._codeTiny(h0,u0.itree,a0,c0)}for(_0=0;_0<n0;_0+=2){for(y0=(t0=e0[_0])>>>23,t0=o0+(8388607&t0);o0<t0;)c0=v.F._writeLit(i0[o0++],I0,a0,c0);y0!=0&&(t0=(p0=e0[_0+1])>>16,s0=p0>>8&255,p0&=255,d0(a0,c0=v.F._writeLit(257+s0,I0,a0,c0),y0-u0.of0[s0]),c0+=u0.exb[s0],l0(a0,c0=v.F._writeLit(p0,L0,a0,c0),t0-u0.df0[p0]),c0+=u0.dxb[p0],o0+=y0)}c0=v.F._writeLit(256,I0,a0,c0)}return c0},v.F._copyExact=function(t0,e0,n0,r0,i0){var o0=i0>>>3;return r0[o0]=n0,r0[o0+1]=n0>>>8,r0[o0+2]=255-r0[o0],r0[o0+3]=255-r0[o0+1],o0+=4,r0.set(new Uint8Array(t0.buffer,e0,n0),o0),i0+(n0+4<<3)},v.F.getTrees=function(){for(var t0=v.F.U,e0=v.F._hufTree(t0.lhst,t0.ltree,15),n0=v.F._hufTree(t0.dhst,t0.dtree,15),r0=[],i0=v.F._lenCodes(t0.ltree,r0),o0=[],s0=v.F._lenCodes(t0.dtree,o0),a0=0;a0<r0.length;a0+=2)t0.ihst[r0[a0]]++;for(a0=0;a0<o0.length;a0+=2)t0.ihst[o0[a0]]++;a0=v.F._hufTree(t0.ihst,t0.itree,7);for(var c0=19;4<c0&&t0.itree[1+(t0.ordr[c0-1]<<1)]==0;)c0--;return[e0,n0,a0,i0,s0,c0,r0,o0]},v.F.getSecond=function(t0){for(var e0=[],n0=0;n0<t0.length;n0+=2)e0.push(t0[n0+1]);return e0},v.F.nonZero=function(t0){for(var e0="",n0=0;n0<t0.length;n0+=2)t0[n0+1]!=0&&(e0+=(n0>>1)+",");return e0},v.F.contSize=function(t0,e0){for(var n0=0,r0=0;r0<e0.length;r0++)n0+=e0[r0]*t0[1+(r0<<1)];return n0},v.F._codeTiny=function(t0,e0,n0,r0){for(var i0=0;i0<t0.length;i0+=2){var o0=t0[i0],s0=t0[i0+1];r0=v.F._writeLit(o0,e0,n0,r0);var a0=o0==16?2:o0==17?3:7;15<o0&&(v.F._putsE(n0,r0,s0,a0),r0+=a0)}return r0},v.F._lenCodes=function(t0,e0){for(var n0=t0.length;n0!=2&&t0[n0-1]==0;)n0-=2;for(var r0=0;r0<n0;r0+=2){var i0=t0[r0+1],o0=r0+3<n0?t0[r0+3]:-1,s0=r0+5<n0?t0[r0+5]:-1,a0=r0==0?-1:t0[r0-1];if(i0==0&&o0==i0&&s0==i0){for(o0=r0+5;o0+2<n0&&t0[o0+2]==i0;)o0+=2;11>(i0=Math.min(o0+1-r0>>>1,138))?e0.push(17,i0-3):e0.push(18,i0-11),r0+=2*i0-2}else if(i0==a0&&o0==i0&&s0==i0){for(o0=r0+5;o0+2<n0&&t0[o0+2]==i0;)o0+=2;i0=Math.min(o0+1-r0>>>1,6),e0.push(16,i0-3),r0+=2*i0-2}else e0.push(i0,0)}return n0>>>1},v.F._hufTree=function(t0,e0,n0){var r0=[],i0=t0.length,o0=e0.length,s0=0;for(s0=0;s0<o0;s0+=2)e0[s0]=0,e0[s0+1]=0;for(s0=0;s0<i0;s0++)t0[s0]!=0&&r0.push({lit:s0,f:t0[s0]});if(t0=r0.length,i0=r0.slice(0),t0==0)return 0;if(t0==1)return e0[1+((n0=r0[0].lit)<<1)]=1,e0[1+((n0==0?1:0)<<1)]=1;r0.sort(function(l0,d0){return l0.f-d0.f}),s0=r0[0],o0=r0[1];var a0=0,c0=1,u0=2;for(r0[0]={lit:-1,f:s0.f+o0.f,l:s0,r:o0,d:0};c0!=t0-1;)s0=a0!=c0&&(u0==t0||r0[a0].f<r0[u0].f)?r0[a0++]:r0[u0++],o0=a0!=c0&&(u0==t0||r0[a0].f<r0[u0].f)?r0[a0++]:r0[u0++],r0[c0++]={lit:-1,f:s0.f+o0.f,l:s0,r:o0};for((r0=v.F.setDepth(r0[c0-1],0))>n0&&(v.F.restrictDepth(i0,n0,r0),r0=n0),s0=0;s0<t0;s0++)e0[1+(i0[s0].lit<<1)]=i0[s0].d;return r0},v.F.setDepth=function(t0,e0){return t0.lit!=-1?t0.d=e0:Math.max(v.F.setDepth(t0.l,e0+1),v.F.setDepth(t0.r,e0+1))},v.F.restrictDepth=function(t0,e0,n0){var r0=0,i0=1<<n0-e0,o0=0;for(t0.sort(function(a0,c0){return c0.d==a0.d?a0.f-c0.f:c0.d-a0.d}),r0=0;r0<t0.length&&t0[r0].d>e0;r0++){var s0=t0[r0].d;t0[r0].d=e0,o0+=i0-(1<<n0-s0)}for(o0>>>=n0-e0;0<o0;)(s0=t0[r0].d)<e0?(t0[r0].d++,o0-=1<<e0-s0-1):r0++;for(;0<=r0;r0--)t0[r0].d==e0&&0>o0&&(t0[r0].d--,o0++);o0!=0&&console.log("debt left")},v.F._goodIndex=function(t0,e0){var n0=0;return e0[16|n0]<=t0&&(n0|=16),e0[8|n0]<=t0&&(n0|=8),e0[4|n0]<=t0&&(n0|=4),e0[2|n0]<=t0&&(n0|=2),e0[1|n0]<=t0&&(n0|=1),n0},v.F._writeLit=function(t0,e0,n0,r0){return v.F._putsF(n0,r0,e0[t0<<1]),r0+e0[1+(t0<<1)]},v.F.inflate=function(t0,e0){var n0=Uint8Array;if(t0[0]==3&&t0[1]==0)return e0||new n0(0);var r0=v.F,i0=r0._bitsF,o0=r0._bitsE,s0=r0._decodeTiny,a0=r0.makeCodes,c0=r0.codes2map,u0=r0._get17,l0=r0.U,d0=e0==null;d0&&(e0=new n0(t0.length>>>2<<3));for(var h0,p0,m0,f0,g0=0,E0=0,_0=p0=0,y0=0;g0==0;)if(g0=i0(t0,y0,1),h0=i0(t0,y0+1,2),y0+=3,h0==0)7&y0&&(y0+=8-(7&y0)),h0=t0[(y0=4+(y0>>>3))-4]|t0[y0-3]<<8,d0&&(e0=v.F._check(e0,_0+h0)),e0.set(new n0(t0.buffer,t0.byteOffset+y0,h0),_0),y0=y0+h0<<3,_0+=h0;else{if(d0&&(e0=v.F._check(e0,_0+131072)),h0==1&&(m0=l0.flmap,f0=l0.fdmap,E0=511,p0=31),h0==2){for(p0=o0(t0,y0,5)+257,h0=o0(t0,y0+5,5)+1,m0=o0(t0,y0+10,4)+4,y0+=14,f0=0;38>f0;f0+=2)l0.itree[f0]=0,l0.itree[f0+1]=0;for(E0=1,f0=0;f0<m0;f0++){var b0=o0(t0,y0+3*f0,3);l0.itree[1+(l0.ordr[f0]<<1)]=b0,b0>E0&&(E0=b0)}y0+=3*m0,a0(l0.itree,E0),c0(l0.itree,E0,l0.imap),m0=l0.lmap,f0=l0.dmap,y0=s0(l0.imap,(1<<E0)-1,p0+h0,t0,y0,l0.ttree),E0=(1<<(b0=r0._copyOut(l0.ttree,0,p0,l0.ltree)))-1,p0=(1<<(h0=r0._copyOut(l0.ttree,p0,h0,l0.dtree)))-1,a0(l0.ltree,b0),c0(l0.ltree,b0,m0),a0(l0.dtree,h0),c0(l0.dtree,h0,f0)}for(;;)if(y0+=15&(h0=m0[u0(t0,y0)&E0]),(b0=h0>>>4)>>>8==0)e0[_0++]=b0;else{if(b0==256)break;h0=_0+b0-254,264<b0&&(h0=_0+((b0=l0.ldef[b0-257])>>>3)+o0(t0,y0,7&b0),y0+=7&b0),y0+=15&(b0=f0[u0(t0,y0)&p0]);var S0=((b0=l0.ddef[b0>>>4])>>>4)+i0(t0,y0,15&b0);for(y0+=15&b0,d0&&(e0=v.F._check(e0,_0+131072));_0<h0;)e0[_0]=e0[_0++-S0],e0[_0]=e0[_0++-S0],e0[_0]=e0[_0++-S0],e0[_0]=e0[_0++-S0];_0=h0}}return e0.length==_0?e0:e0.slice(0,_0)},v.F._check=function(t0,e0){var n0=t0.length;return e0<=n0?t0:((e0=new Uint8Array(Math.max(n0<<1,e0))).set(t0,0),e0)},v.F._decodeTiny=function(t0,e0,n0,r0,i0,o0){for(var s0=v.F._bitsE,a0=v.F._get17,c0=0;c0<n0;){var u0=t0[a0(r0,i0)&e0];i0+=15&u0;var l0=u0>>>4;if(15>=l0)o0[c0]=l0,c0++;else{var d0=u0=0;for(l0==16?(d0=3+s0(r0,i0,2),i0+=2,u0=o0[c0-1]):l0==17?(d0=3+s0(r0,i0,3),i0+=3):l0==18&&(d0=11+s0(r0,i0,7),i0+=7),l0=c0+d0;c0<l0;)o0[c0]=u0,c0++}}return i0},v.F._copyOut=function(t0,e0,n0,r0){for(var i0=0,o0=0,s0=r0.length>>>1;o0<n0;){var a0=t0[o0+e0];r0[o0<<1]=0,r0[1+(o0<<1)]=a0,a0>i0&&(i0=a0),o0++}for(;o0<s0;)r0[o0<<1]=0,r0[1+(o0<<1)]=0,o0++;return i0},v.F.makeCodes=function(t0,e0){var n0,r0,i0=v.F.U,o0=t0.length,s0=i0.bl_count;for(n0=0;n0<=e0;n0++)s0[n0]=0;for(n0=1;n0<o0;n0+=2)s0[t0[n0]]++;for(i0=i0.next_code,n0=0,s0[0]=0,r0=1;r0<=e0;r0++)n0=n0+s0[r0-1]<<1,i0[r0]=n0;for(e0=0;e0<o0;e0+=2)(s0=t0[e0+1])!=0&&(t0[e0]=i0[s0],i0[s0]++)},v.F.codes2map=function(t0,e0,n0){for(var r0=t0.length,i0=v.F.U.rev15,o0=0;o0<r0;o0+=2)if(t0[o0+1]!=0){var s0=t0[o0+1],a0=o0>>1<<4|s0,c0=e0-s0;for(c0=(s0=t0[o0]<<c0)+(1<<c0);s0!=c0;)n0[i0[s0]>>>15-e0]=a0,s0++}},v.F.revCodes=function(t0,e0){for(var n0=v.F.U.rev15,r0=15-e0,i0=0;i0<t0.length;i0+=2)t0[i0]=n0[t0[i0]<<e0-t0[i0+1]]>>>r0},v.F._putsE=function(t0,e0,n0){n0<<=7&e0,t0[e0>>>=3]|=n0,t0[e0+1]|=n0>>>8},v.F._putsF=function(t0,e0,n0){n0<<=7&e0,t0[e0>>>=3]|=n0,t0[e0+1]|=n0>>>8,t0[e0+2]|=n0>>>16},v.F._bitsE=function(t0,e0,n0){return(t0[e0>>>3]|t0[1+(e0>>>3)]<<8)>>>(7&e0)&(1<<n0)-1},v.F._bitsF=function(t0,e0,n0){return(t0[e0>>>3]|t0[1+(e0>>>3)]<<8|t0[2+(e0>>>3)]<<16)>>>(7&e0)&(1<<n0)-1},v.F._get17=function(t0,e0){return(t0[e0>>>3]|t0[1+(e0>>>3)]<<8|t0[2+(e0>>>3)]<<16)>>>(7&e0)},v.F._get25=function(t0,e0){return(t0[e0>>>3]|t0[1+(e0>>>3)]<<8|t0[2+(e0>>>3)]<<16|t0[3+(e0>>>3)]<<24)>>>(7&e0)},v.F.U=function(){var t0=Uint16Array,e0=Uint32Array;return{next_code:new t0(16),bl_count:new t0(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t0(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e0(32),flmap:new t0(512),fltree:[],fdmap:new t0(32),fdtree:[],lmap:new t0(32768),ltree:[],ttree:[],dmap:new t0(32768),dtree:[],imap:new t0(512),itree:[],rev15:new t0(32768),lhst:new e0(286),dhst:new e0(30),ihst:new e0(19),lits:new e0(15e3),strt:new t0(65536),prev:new t0(32768)}}(),function(){function t0(i0,o0,s0){for(;o0--!=0;)i0.push(0,s0)}for(var e0=v.F.U,n0=0;32768>n0;n0++){var r0=n0;r0=(4278255360&(r0=(4042322160&(r0=(3435973836&(r0=(2863311530&r0)>>>1|(1431655765&r0)<<1))>>>2|(858993459&r0)<<2))>>>4|(252645135&r0)<<4))>>>8|(16711935&r0)<<8,e0.rev15[n0]=(r0>>>16|r0<<16)>>>17}for(n0=0;32>n0;n0++)e0.ldef[n0]=e0.of0[n0]<<3|e0.exb[n0],e0.ddef[n0]=e0.df0[n0]<<4|e0.dxb[n0];t0(e0.fltree,144,8),t0(e0.fltree,112,9),t0(e0.fltree,24,7),t0(e0.fltree,8,8),v.F.makeCodes(e0.fltree,9),v.F.codes2map(e0.fltree,9,e0.flmap),v.F.revCodes(e0.fltree,9),t0(e0.fdtree,32,5),v.F.makeCodes(e0.fdtree,5),v.F.codes2map(e0.fdtree,5,e0.fdmap),v.F.revCodes(e0.fdtree,5),t0(e0.itree,19,0),t0(e0.ltree,286,0),t0(e0.dtree,30,0),t0(e0.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(t0){function e0(r0,i0,o0,s0){W(this,e0);var a0=n0.call(this,s0,"Session");return m(n(a0),"chatManager",void 0),m(n(a0),"joinedChannels",new Set),m(n(a0),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(a0),"startTime",Date.now()),m(n(a0),"seq",U.fromNumber(1,!0)),m(n(a0),"userJoinOptions",new is(!1)),m(n(a0),"seqSentStatuses",[!1,!1]),m(n(a0),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(a0),"loggedOut",!1),m(n(a0),"messageSentTimes",[]),m(n(a0),"curLoginSockets",[void 0,void 0]),m(n(a0),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(a0),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(a0),"dialPendingMsgSubjectMap",new Map),m(n(a0),"context",void 0),m(n(a0),"connection",void 0),m(n(a0),"instanceId",void 0),m(n(a0),"registerSocketsFailureListener",function(){a0.connection.once("socketsFailure",function(){a0.log("socketsFailure, creating a new connection"),ad(function(){return a0.connection.removeAllListeners(),a0.connection=new Yr(a0.context,a0.logger,!0),a0.loginHandler(15e3,!0)}).pipe(oe(function(c0){return c0.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))}),ob(a0.connection.apClient.apFinish$)).subscribe(function(){a0.log("new connection connected")})}),a0.connection.listenerCount("tokenExpired")===0&&a0.connection.on("tokenExpired",function(){a0.emit("tokenExpired")})}),a0.context=r0,a0.connection=i0,a0.instanceId=o0,a0.chatManager=new hD(s0),a0.log("The instanceId is %s",a0.instanceId.toString()),a0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"fetchFileUploadIndexGet",value:function(r0){var i0=r0.hash,o0=r0.size;if((r0=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var s0=this.incGetSeq();return r0.forEach(function(a0){a0.sendPacket("FileUploadIndexGet",{seq:s0,hash:i0,size:o0})}),{ret:Ca.apply(void 0,G(r0.map(function(a0){return a0.fromReceived("FileUploadIndexRet").pipe(aa(function(c0){return s0.eq(c0.seq)}))}))),fin:Ca.apply(void 0,G(r0.map(function(a0){return a0.fromReceived("FileUploadIndexFin").pipe(aa(function(c0){return s0.eq(c0.seq)}))}))),err:Xb.apply(void 0,G(r0.map(function(a0){return a0.fromReceived("FileUploadIndexErr").pipe(aa(function(c0){return s0.eq(c0.seq)}),ba(function(c0){throw new da(["The media message upload failure, code %d",c0.code],lg)}))}))),timeout:e0.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(r0){var i0=r0.hash,o0=r0.unit,s0=r0.servers;if((r0=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var a0=this.incGetSeq();return r0.forEach(function(c0){c0.sendPacket("FileUploadIndexSet",{seq:a0,servers:s0,hash:i0,unit:o0})}),Ca.apply(void 0,[e0.genTimeoutError(Lh)].concat(G(r0.map(function(c0){return c0.fromReceived("FileUploadIndexErr").pipe(aa(function(u0){return a0.eq(u0.seq)}),ba(function(u0){throw new da(["FileUploadIndexSet failure, code %d",u0.code],lg)}))})),G(r0.map(function(c0){return c0.fromReceived("FileUploadIndexFin").pipe(aa(function(u0){return a0.eq(u0.seq)}))}))))}},{key:"requestFileDownloadIndexGet",value:function(r0){var i0=r0.size,o0=r0.zone,s0=r0.unit,a0=r0.hash,c0=this.getLoginSockets();if(c0.length===0)throw new K("Client is not logged in");var u0=this.incGetSeq();return c0.forEach(function(l0){l0.sendPacket("FileDownloadIndexGet",{seq:u0,size:i0,zone:o0,unit:s0,hash:a0})}),r0=Ca.apply(void 0,G(c0.map(function(l0){return l0.fromReceived("FileDownloadIndexRet").pipe(aa(function(d0){return u0.eq(d0.seq)}))}))).pipe(ba(function(l0){var d0=l0.backups,h0=l0.servers;return l0=ff(l0,iD),ua({backupList:d0.map(function(p0){return[p0]}),serverList:h0.map(function(p0){return[p0]})},l0)}),cd(500)),c0=jm(c0.map(function(l0){return l0.fromReceived("FileDownloadIndexRet").pipe(aa(function(d0){return u0.eq(d0.seq)}))})),Ca(r0,c0.pipe(ba(function(l0){return l0.reduce(function(d0,h0){var p0=d0.backupList,m0=d0.serverList;d0=h0.backups;var f0=h0.servers;return h0=ff(h0,jD),ua({backupList:d0.map(function(g0,E0){return[g0].concat(G(p0!==void 0&&Array.isArray(p0[E0])?p0[E0]:[]))}),serverList:f0.map(function(g0,E0){return[g0].concat(G(p0!==void 0&&Array.isArray(m0[E0])?m0[E0]:[]))})},h0)},{})})),e0.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var r0=this,i0=0<arguments.length&&arguments[0]!==void 0?arguments[0]:2e4,o0=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&o0)throw new K("Already logged out, request ignored");o0&&this.registerSocketsFailureListener(),this.connection.initConnection();var s0=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),a0=Date.now();return s0.forEach(function(c0,u0){var l0=r0.loginSocketSubs[u0].login;l0!==void 0&&l0.unsubscribe(),r0.loginSocketSubs[u0].login=c0.pipe(ca(function(d0){var h0;r0.curLoginSockets[u0]=d0;var p0=Date.now();eb("Link",{ackedServerIp:d0.address,destServerIp:d0.ip,ec:0,sc:0,elapse:fb(r0.startTime),lts:U.fromNumber(p0),responseTime:a0-p0,sid:Xa(r0.instanceId),userId:r0.context.uid},(h0=r0.context.config.enableCloudProxy)!==null&&h0!==void 0&&h0),r0.emit("userJoined",d0.env),o0&&r0.connection.apClient.apFinish$.next(void 0)})).subscribe(r0.lastLoginSockets[u0])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(s0).concat([gb(this.connection,"connectionInitFailure").pipe(ca(function(c0){throw sa(c0)||Sa(c0)?c0:new da("Login failure",{code:Zq,originalError:c0})}))])).pipe(Ka(1),hb(i0),Ga(function(c0){return c0 instanceof pb&&r0.warn("Client login timeout"),c0&&c0.code===Kh&&(r0.connection.emit("tokenExpired"),r0.connection.apClient.apFinish$.next(void 0)),r0.clearSockets(0,o0),Z(c0)}),ca(function(){o0||r0.registerSocketsFailureListener()}),wg(function(){o0||r0.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:function(){var r0=J(w.mark(function i0(){var o0,s0,a0,c0=this;return w.wrap(function(u0){for(;;)switch(u0.prev=u0.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),o0=this.getLoginSockets(),s0=o0.map(function(l0){return l0.sendPacket("UserQuit",{}),c0.connection.waitClosing(l0)}),this.clearSockets(5e3),a0=o0.map(function(l0){return l0.env}),[0,1].filter(function(l0){return!a0.includes(l0)}).forEach(function(l0){c0.connection.closeSocket(l0,0)}),u0.abrupt("return",Xb.apply(void 0,G(s0)).toPromise());case 9:case"end":return u0.stop()}},i0,this)}));return function(){return r0.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var r0=J(w.mark(function i0(o0,s0){var a0,c0,u0,l0=this;return w.wrap(function(d0){for(;;)switch(d0.prev=d0.next){case 0:if(this.getLoginSockets().length!==0){d0.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return a0=gb(this,"channelLeft").pipe(wb(function(h0){return h0===o0}),Ka(1)),c0=this.incGetSeq(),(u0=this.lastLoginSockets.map(function(h0){return h0.pipe(Cc(function(p0,m0){m0!==0&&l0.incSeqIfNeeded(p0.env);var f0=m0===0?c0:l0.seq;return p0.sendPacket("GroupEnter",{account:s0,seq:f0}),p0.fromReceived("GroupReply").pipe(aa(function(g0){return f0.eq(g0.seq)}),ca(function(g0){if((g0=g0.code)!==0)throw new da(["Channel join failure. The response code is %d",g0],Rq)}))}),ob(a0),pe())})).forEach(function(h0,p0){var m0=function(){return l0.loginSocketSubs[p0].channels.delete(o0.channelId)};l0.loginSocketSubs[p0].channels.set(o0.channelId,h0.subscribe({error:m0,complete:m0}))}),d0.next=8,Xb.apply(void 0,G(u0)).pipe(Ka(1),hb(1e4),Ga(function(h0){return h0 instanceof pb&&l0.warn("Channel join timeout"),Z(h0)})).toPromise();case 8:this.joinedChannels.add(o0);case 9:case"end":return d0.stop()}},i0,this)}));return function(i0,o0){return r0.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(r0,i0){this.emit("channelLeft",r0),this.joinedChannels.delete(r0),this.getLoginSockets().forEach(function(o0){o0.sendPacket("GroupLeave",{account:i0})})}},{key:"requestChannelMemberList",value:function(r0){var i0=this.getLoginSockets();if(i0.length===0)throw new K("Client is not logged in. Cannot get the channel members",cA);var o0=this.incGetSeq();return i0.forEach(function(s0){s0.sendPacket("GroupAllUsersList",{group:r0,pageNumber:0,pageSize:200,seq:o0})}),Ca.apply(void 0,[e0.genTimeoutError(Pq)].concat(G(i0.map(function(s0){return s0.fromReceived("GroupAllUsersResult").pipe(aa(function(a0){var c0=a0.seq;return a0.group===r0&&o0.eq(c0)}))}))))}},{key:"requestPeersOnlineStatus",value:function(r0){var i0=this.getLoginSockets();if(i0.length===0)throw new K("Client is not logged in");var o0=this.incGetSeq();return i0.forEach(function(s0){s0.sendPacket("UserStatusList",{users:r0,seq:o0})}),Ca.apply(void 0,[e0.genTimeoutError(oA)].concat(G(i0.map(function(s0){return s0.fromReceived("UserStatusResult").pipe(aa(function(a0){return o0.eq(a0.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(r0,i0){var o0=this,s0=this.getLoginSockets();if(s0.length===0)throw new K("Client is not logged in");var a0=this.incGetSeq();return s0.forEach(function(c0,u0){i0!==void 0&&u0!==i0||c0.sendPacket("UserAttributeSet",{account:o0.context.uid,attributeInfos:Object.entries(r0).map(function(l0){return{key:(l0=ra(l0,2))[0],value:l0[1]}}),seq:a0})}),Ca.apply(void 0,G(s0.map(function(c0){return c0.fromReceived("UserAttributeErr").pipe(aa(function(u0){return a0.eq(u0.seq)}),ba(function(u0){throw new da(["The user attributes set failure, code %d",u0.code],Sb)}))})).concat([e0.genTimeoutError(Tb)],G(s0.map(function(c0){return c0.fromReceived("UserAttributeRsp").pipe(aa(function(u0){return a0.eq(u0.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(r0,i0,o0){var s0=this.getLoginSockets();if(s0.length===0)throw new K("Client is not logged in");var a0=this.incGetSeq();return s0.forEach(function(c0){c0.sendPacket("GroupAttributeSet",{broadcast:o0,group:r0,attributeInfos:Object.entries(i0).map(function(u0){return{key:(u0=ra(u0,2))[0],value:u0[1]}}),seq:a0})}),Ca.apply(void 0,G(s0.map(function(c0){return c0.fromReceived("GroupAttributeErr").pipe(aa(function(u0){return a0.eq(u0.seq)}),ba(function(u0){throw new da(["The group attributes set failure, code %d",u0.code],Sb)}))})).concat([e0.genTimeoutError(Tb)],G(s0.map(function(c0){return c0.fromReceived("GroupAttributeRsp").pipe(aa(function(u0){return a0.eq(u0.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(r0){var i0=this,o0=this.getLoginSockets();if(o0.length===0)throw new K("Client is not logged in");var s0=this.incGetSeq();return o0.forEach(function(a0){a0.sendPacket("UserAttributeMod",{account:i0.context.uid,attributeInfos:Object.entries(r0).map(function(c0){return{key:(c0=ra(c0,2))[0],value:c0[1]}}),seq:s0})}),Ca.apply(void 0,G(o0.map(function(a0){return a0.fromReceived("UserAttributeErr").pipe(aa(function(c0){return s0.eq(c0.seq)}),ba(function(c0){throw new da(["The user attributes add or update failure, code %d",c0.code],Sb)}))})).concat([e0.genTimeoutError(Tb)],G(o0.map(function(a0){return a0.fromReceived("UserAttributeRsp").pipe(aa(function(c0){return s0.eq(c0.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(r0,i0,o0){var s0=this.getLoginSockets();if(s0.length===0)throw new K("Client is not logged in");var a0=this.incGetSeq();return s0.forEach(function(c0){c0.sendPacket("GroupAttributeMod",{broadcast:o0,group:r0,attributeInfos:Object.entries(i0).map(function(u0){return{key:(u0=ra(u0,2))[0],value:u0[1]}}),seq:a0})}),Ca.apply(void 0,G(s0.map(function(c0){return c0.fromReceived("GroupAttributeErr").pipe(aa(function(u0){return a0.eq(u0.seq)}),ba(function(u0){throw new da(["The group attributes add or update failure, code %d",u0.code],Sb)}))})).concat([e0.genTimeoutError(Tb)],G(s0.map(function(c0){return c0.fromReceived("GroupAttributeRsp").pipe(aa(function(u0){return a0.eq(u0.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(r0){var i0=this,o0=this.getLoginSockets();if(o0.length===0)throw new K("Client is not logged in");var s0=this.incGetSeq();return o0.forEach(function(a0){a0.sendPacket("UserAttributeDel",{account:i0.context.uid,attributes:r0,seq:s0})}),Ca.apply(void 0,G(o0.map(function(a0){return a0.fromReceived("UserAttributeErr").pipe(aa(function(c0){return s0.eq(c0.seq)}),ba(function(c0){throw new da(["The user attributes delete failure, code %d",c0.code],Sb)}))})).concat([e0.genTimeoutError(Tb)],G(o0.map(function(a0){return a0.fromReceived("UserAttributeRsp").pipe(aa(function(c0){return s0.eq(c0.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(r0,i0,o0){var s0=this.getLoginSockets();if(s0.length===0)throw new K("Client is not logged in");var a0=this.incGetSeq();return s0.forEach(function(c0){c0.sendPacket("GroupAttributeDel",{group:r0,broadcast:o0,attributes:i0,seq:a0})}),Ca.apply(void 0,G(s0.map(function(c0){return c0.fromReceived("GroupAttributeErr").pipe(aa(function(u0){return a0.eq(u0.seq)}),ba(function(u0){throw new da(["The channel attributes delete failure, code %d",u0.code],Sb)}))})).concat([e0.genTimeoutError(Tb)],G(s0.map(function(c0){return c0.fromReceived("GroupAttributeRsp").pipe(aa(function(u0){return a0.eq(u0.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var r0=this,i0=this.getLoginSockets();if(i0.length===0)throw new K("Client is not logged in");var o0=this.incGetSeq();return i0.forEach(function(s0){s0.sendPacket("UserAttributeSet",{account:r0.context.uid,seq:o0,attributeInfos:[]})}),Ca.apply(void 0,G(i0.map(function(s0){return s0.fromReceived("UserAttributeErr").pipe(aa(function(a0){return o0.eq(a0.seq)}),ba(function(a0){throw new da(["The user attributes clear failure, code %d",a0.code],Sb)}))})).concat([e0.genTimeoutError(Tb)],G(i0.map(function(s0){return s0.fromReceived("UserAttributeRsp").pipe(aa(function(a0){return o0.eq(a0.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(r0,i0){var o0=this.getLoginSockets();if(o0.length===0)throw new K("Client is not logged in");var s0=this.incGetSeq();return o0.forEach(function(a0){a0.sendPacket("GroupAttributeSet",{group:r0,seq:s0,attributeInfos:[],broadcast:i0})}),Ca.apply(void 0,G(o0.map(function(a0){return a0.fromReceived("GroupAttributeErr").pipe(aa(function(c0){return s0.eq(c0.seq)}),ba(function(c0){throw new da(["The channel attributes clear failure, code %d",c0.code],Sb)}))})).concat([e0.genTimeoutError(Tb)],G(o0.map(function(a0){return a0.fromReceived("GroupAttributeRsp").pipe(aa(function(c0){return s0.eq(c0.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(r0,i0){var o0=this.getLoginSockets();if(o0.length===0)throw new K("Client is not logged in");var s0=this.incGetSeq();return o0.forEach(function(a0){a0.sendPacket("UserAttributeGet",{account:r0,seq:s0,attributes:i0})}),Ca.apply(void 0,[e0.genTimeoutError(Tb)].concat(G(o0.map(function(a0){return a0.fromReceived("UserAttributeErr").pipe(aa(function(c0){return s0.eq(c0.seq)}),ba(function(c0){throw(c0=c0.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",c0],Sb)}))})),G(o0.map(function(a0){return a0.fromReceived("UserAttributeRet").pipe(aa(function(c0){return s0.eq(c0.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(r0,i0){var o0=this.getLoginSockets();if(o0.length===0)throw new K("Client is not logged in");var s0=this.incGetSeq();return o0.forEach(function(a0){a0.sendPacket("GroupAttributeGet",{group:r0,seq:s0,attributes:i0})}),Ca.apply(void 0,[e0.genTimeoutError(Tb)].concat(G(o0.map(function(a0){return a0.fromReceived("GroupAttributeErr").pipe(aa(function(c0){return s0.eq(c0.seq)}),ba(function(c0){throw new da(["The channel attributes get failure, code %d",c0.code],Sb)}))})),G(o0.map(function(a0){return a0.fromReceived("GroupAttributeRet").pipe(aa(function(c0){return s0.eq(c0.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(r0){var i0=this.getLoginSockets();if(i0.length===0)throw new K("Client is not logged in");var o0=this.incGetSeq();return i0.forEach(function(s0){s0.sendPacket("UserAttributeKeysGet",{account:r0,seq:o0})}),Ca.apply(void 0,[e0.genTimeoutError(Tb)].concat(G(i0.map(function(s0){return s0.fromReceived("UserAttributeErr").pipe(aa(function(a0){return o0.eq(a0.seq)}),ba(function(a0){throw(a0=a0.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",a0],Sb)}))})),G(i0.map(function(s0){return s0.fromReceived("UserAttributeKeysRet").pipe(aa(function(a0){return o0.eq(a0.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(r0){var i0=this.getLoginSockets();if(i0.length===0)throw new K("Client is not logged in");var o0=this.incGetSeq();return i0.forEach(function(s0){s0.sendPacket("GroupAttributeKeysGet",{group:r0,seq:o0})}),Ca.apply(void 0,[e0.genTimeoutError(Tb)].concat(G(i0.map(function(s0){return s0.fromReceived("GroupAttributeErr").pipe(aa(function(a0){return o0.eq(a0.seq)}),ba(function(a0){throw new Wc(["Channel attribute operation unknown error code: %d",a0.code],Sb)}))})),G(i0.map(function(s0){return s0.fromReceived("GroupAttributeKeysRet").pipe(aa(function(a0){return o0.eq(a0.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(r0){var i0=this.getLoginSockets();if(i0.length===0)throw new K("Client is not logged in");var o0=this.incGetSeq();return i0.forEach(function(s0){s0.sendPacket("GroupStatusList",{groups:r0,seq:o0})}),Ca.apply(void 0,[e0.genTimeoutError(Pq)].concat(G(i0.map(function(s0){return s0.fromReceived("GroupStatusResult").pipe(aa(function(a0){return o0.eq(a0.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(r0){var i0=this.getLoginSockets();if(i0.length===0)throw new K("Client is not logged in");var o0=this.incGetSeq();return i0.forEach(function(s0){s0.sendPacket("SubscribeUserStatus",{seq:o0,users:r0})}),Ca.apply(void 0,[e0.genTimeoutError(vA)].concat(G(i0.map(function(s0){return s0.fromReceived("SubscribeResponse").pipe(aa(function(a0){return o0.eq(a0.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(r0){var i0=this.getLoginSockets();if(i0.length===0)throw new K("Client is not logged in");var o0=this.incGetSeq();i0.forEach(function(s0){s0.sendPacket("UnsubscribeUserStatus",{seq:o0,users:r0})})}},{key:"sendInvitationMessage",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0,d0,h0,p0,m0,f0,g0,E0,_0=this;return w.wrap(function(y0){for(;;)switch(y0.prev=y0.next){case 0:if(s0=o0.peerId,a0=o0.callId,c0=o0.extra,u0=o0.isAcceptAck,l0=o0.channelId,d0=o0.type,h0={callId:a0},u0===void 0){y0.next=6;break}if(d0==="CallAccept"){y0.next=5;break}throw Error("invalid invitation type");case 5:h0.type=u0?"ack":"request";case 6:return h0.channel=l0,(d0==="CallInvite"||d0==="CallCancel"||d0==="CallReject"||d0==="CallAccept"&&u0===!1)&&c0!==void 0&&(h0.extra=c0),p0=Bg(),this.log("The sent invitation body is %o",h0),m0=function(b0){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:p0,instance:_0.instanceId,dst:s0,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:b0,MessageType:d0}).toLong(),payload:new TextEncoder().encode(JSON.stringify(h0)),src:_0.context.uid}},y0.next=14,Kb(this.sendMessageToRetry(m0,!0)).pipe(hb(1e4),Ga(function(b0){return b0 instanceof pb&&_0.warn("Send invitation timeout"),Z(b0)})).toPromise();case 14:return f0=y0.sent,g0=f0.code,E0=f0.retryTimes,y0.abrupt("return",{hasPeerReceived:g0===0,hasReSent:E0!==0});case 18:case"end":return y0.stop()}},i0,this)}));return function(i0){return r0.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var r0=J(w.mark(function i0(o0,s0,a0,c0,u0,l0){var d0,h0,p0,m0,f0,g0,E0,_0,y0,b0,S0,w0,I0,L0,M0,C0,U0,x0,j0,k0,D0,$0,N0,A0,P0,O0,v0,R0,T0,F0=this;return w.wrap(function(V0){for(;;)switch(V0.prev=V0.next){case 0:if(h0=s0.width,p0=h0===void 0?0:h0,m0=s0.height,f0=m0===void 0?0:m0,g0=s0.fileName,E0=g0===void 0?"":g0,_0=s0.description,y0=_0===void 0?"":_0,b0=s0.thumbnail,S0=b0===void 0?new Blob:b0,w0=s0.thumbnailHeight,I0=w0===void 0?0:w0,L0=s0.thumbnailWidth,M0=L0===void 0?0:L0,C0=s0.size,U0=C0===void 0?0:C0,x0=s0.mediaId,j0=u0.enableOfflineMessaging,k0=u0.enableHistoricalMessaging,za(a0)){V0.next=4;break}throw new I("The send message arguments are not valid",c0?$k:hg);case 4:if(!(32768<new Blob([E0,S0,y0]).size)){V0.next=6;break}throw new I("The size of message overflowed ",c0?ve:Hh);case 6:return D0=this.chatManager.getChatInfo(a0),$0=D0.dialogue,N0=D0.sequence,A0=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(A0,"-").concat($0,"#").concat(N0,'"'),c0?" peer":" channel",oa(a0)),m(d0={},"media_description",y0),m(d0,"media_width",p0),m(d0,"media_height",f0),m(d0,"media_thumbnailwidth",M0),m(d0,"media_thumbnailheight",I0),m(d0,"media_size",U0),m(d0,"media_id",x0),m(d0,"media_filename",E0),P0=uc(d0,function(H0){return new TextEncoder().encode(H0.toString())}),V0.t0=Uint8Array,V0.next=14,Ji(S0);case 14:return V0.t1=V0.sent,P0.media_thumbnail=new V0.t0(V0.t1),O0=c0&&o0==="IMAGE"?"PeerImageMessage":c0&&o0==="FILE"?"PeerFileMessage":c0||o0!=="IMAGE"?"ChannelFileMessage":"ChannelImageMessage",v0=function(H0){return{MiscMap:P0,sequence:N0,dialogue:$0,instance:A0,dst:a0,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:H0,CompressionMethod:"Uncompressed",MessageType:O0,ToCache:j0,ToArchive:k0}).toLong(),payload:new Uint8Array,src:F0.context.uid}},V0.next=20,Kb(this.sendMessageToRetry(v0,!0)).pipe(hb(l0===void 0?1e4:l0),Ga(function(H0){return H0 instanceof pb&&F0.warn("Send message timeout"),Z(H0)})).toPromise();case 20:if(R0=V0.sent,(T0=R0.code)!==2){V0.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return V0.abrupt("return",{hasPeerReceived:T0===0});case 25:case"end":return V0.stop()}},i0,this)}));return function(i0,o0,s0,a0,c0,u0){return r0.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var r0=J(w.mark(function i0(o0,s0,a0,c0,u0,l0){var d0,h0,p0,m0,f0,g0,E0,_0,y0,b0,S0=this;return w.wrap(function(w0){for(;;)switch(w0.prev=w0.next){case 0:if(d0=u0.enableOfflineMessaging,h0=u0.enableHistoricalMessaging,za(a0)&&o0 instanceof Uint8Array&&typeof s0=="string"){w0.next=3;break}throw new I("The send message arguments are not valid",c0?$k:hg);case 3:if(!(32768<o0.byteLength+new Blob([s0]).size)){w0.next=5;break}throw new ib("The message size is over the 32KB limit",c0?ve:Hh);case 5:return p0=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=o0.byteLength,m0=this.chatManager.getChatInfo(a0),f0=m0.dialogue,g0=m0.sequence,E0=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(E0,"-").concat(f0,"#").concat(g0,'"'),p0?" compressed":"",c0?"peer":"channel",oa(a0)),_0=function(I0){return{MiscMap:{description:new TextEncoder().encode(s0)},sequence:g0,dialogue:f0,instance:E0,dst:a0,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:I0,CompressionMethod:p0?"Zlib":"Uncompressed",MessageType:c0?"PeerRawMessage":"ChannelRawMessage",ToCache:d0,ToArchive:h0}).toLong(),payload:p0?ks(o0):o0,src:S0.context.uid}},w0.next=12,Kb(this.sendMessageToRetry(_0,!0)).pipe(hb(l0===void 0?1e4:l0),Ga(function(I0){return I0 instanceof pb&&S0.warn("Send message timeout"),Z(I0)})).toPromise();case 12:return y0=w0.sent,b0=y0.code,w0.abrupt("return",{hasPeerReceived:b0===0});case 15:case"end":return w0.stop()}},i0,this)}));return function(i0,o0,s0,a0,c0,u0){return r0.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var r0=J(w.mark(function i0(o0,s0,a0,c0,u0){var l0,d0,h0,p0,m0,f0,g0,E0,_0,y0,b0,S0=this;return w.wrap(function(w0){for(;;)switch(w0.prev=w0.next){case 0:if(l0=c0.enableOfflineMessaging,d0=c0.enableHistoricalMessaging,za(s0)){w0.next=3;break}throw new I("The send message arguments are not valid",a0?$k:hg);case 3:if(!(32768<new Blob([o0]).size)){w0.next=5;break}throw new ib("The message size is over the 32KB limit",a0?ve:Hh);case 5:return h0=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([o0]).size,p0=this.chatManager.getChatInfo(s0),m0=p0.dialogue,f0=p0.sequence,g0=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(g0,"-").concat(m0,"#").concat(f0,'"'),h0?" compressed":"",a0?"peer":"channel",oa(s0)),E0=new TextEncoder().encode(o0),_0=function(I0){return{MiscMap:{},sequence:f0,dialogue:m0,instance:g0,dst:s0,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:I0,CompressionMethod:h0?"Zlib":"Uncompressed",MessageType:a0?"PeerTextMessage":"ChannelTextMessage",ToCache:l0,ToArchive:d0}).toLong(),payload:h0?ks(E0):E0,src:S0.context.uid}},w0.next=13,Kb(this.sendMessageToRetry(_0,!0)).pipe(hb(u0===void 0?1e4:u0),Ga(function(I0){return I0 instanceof pb&&S0.warn("Send message timeout"),Z(I0)})).toPromise();case 13:return y0=w0.sent,b0=y0.code,w0.abrupt("return",{hasPeerReceived:b0===0});case 16:case"end":return w0.stop()}},i0,this)}));return function(i0,o0,s0,a0,c0){return r0.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(r0,i0){Object.entries(this.loginSocketSubs[r0]).forEach(function(o0){var s0=(o0=ra(o0,2))[1];o0[0]==="channels"&&i0||(Array.isArray(s0)||s0 instanceof Map?s0.forEach(function(a0){return a0.unsubscribe()}):s0&&s0.unsubscribe())}),this.loginSocketSubs[r0]={channels:i0?this.loginSocketSubs[r0].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var r0=J(w.mark(function i0(o0,s0){var a0,c0,u0,l0,d0,h0,p0,m0,f0,g0=this,E0=arguments;return w.wrap(function(_0){for(;;)switch(_0.prev=_0.next){case 0:if(a0=2<E0.length&&E0[2]!==void 0?E0[2]:0,this.log("Attempt to send the message ".concat(s0?" with retrying, %o":"without retrying"),{retryTimes:a0}),(c0=this.getLoginSockets()).length!==0){_0.next=5;break}throw Error("no logged-in sockets");case 5:return u0=o0(a0),c0.forEach(function(y0){y0.sendPacket("Message",u0)}),l0=u0.dialogue,d0=u0.sequence,h0=u0.instance,p0=c0.map(function(y0){return y0.fromReceived("Ack").pipe(wb(function(b0){return l0.eq(b0.dialogue)&&d0.eq(b0.sequence)&&h0.eq(b0.instance)}))}),_0.prev=9,_0.next=12,Xb.apply(void 0,G(p0)).pipe(hb(6e3),Ga(function(y0){return Sa(y0)&&g0.warn("Message send timeout, retry times %d",a0),Z(y0)}),Ka(1)).toPromise();case 12:return m0=_0.sent,f0=m0.code,this.log("The message has been acked, %o",{code:f0}),_0.abrupt("return",{code:f0,retryTimes:a0});case 18:if(_0.prev=18,_0.t0=_0.catch(9),!(_0.t0 instanceof pb&&s0)){_0.next=22;break}return _0.abrupt("return",this.sendMessageToRetry(o0,!1,a0+1));case 22:throw _0.t0;case 23:case"end":return _0.stop()}},i0,this,[[9,18]])}));return function(i0,o0){return r0.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var r0=this;this.lastLoginSockets.map(function(i0){return i0.pipe(Cc(function(o0){return Bc(0,2750).pipe(ca(function(){r0.incSeqIfNeeded(o0.env),o0.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:r0.seq})}))}))}).forEach(function(i0,o0){var s0=r0.loginSocketSubs[o0].keepAlive;s0!==void 0&&s0.unsubscribe(),r0.loginSocketSubs[o0].keepAlive=i0.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var r0=this;this.lastLoginSockets.map(function(i0){return i0.pipe(Cc(function(o0){var s0,a0=!1,c0=o0.userJoin$.pipe(ca(function(){a0=!0})),u0=o0.input$.pipe(ca(function(l0){Li[l0.uri].slice(0,-3)!=="Ping"&&(a0=!1)}));return Xb(Bc(15e3,1e4).pipe(Pt(o0.receivedPacket),ca(function(l0){l0=ra(l0,2),l0=ra(l0[1],2)[1],s0!==l0||a0||o0.forceReconnect(),s0=l0})),c0,u0)}))}).forEach(function(i0,o0){var s0=r0.loginSocketSubs[o0].keepAliveReconnector;s0!==void 0&&s0.unsubscribe(),r0.loginSocketSubs[o0].keepAliveReconnector=i0.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var r0=this;this.lastLoginSockets.map(function(i0){return i0.pipe(Cc(function(o0){return Xb(gb(o0,"reconnect").pipe(ca(r0.onSocketReconnect(o0))),o0.fromReceived("Message").pipe(ca(r0.onMessage(o0))),o0.fromReceived("GroupEnterNotice").pipe(ca(r0.onGroupEnterNotice())),o0.fromReceived("GroupLeaveNotice").pipe(ca(r0.onGroupLeaveNotice())),o0.fromReceived("GroupCountNotice").pipe(ca(r0.onGroupCountNotice())),o0.fromReceived("GroupAttributeAlt").pipe(ca(r0.onGroupAttributeAlt())),o0.fromReceived("UserJoinNotice").pipe(ca(r0.onUserNotice(S.PeerOnlineState.ONLINE))),o0.fromReceived("UserQuitNotice").pipe(ca(r0.onUserNotice(S.PeerOnlineState.OFFLINE))),o0.fromReceived("UserWaitNotice").pipe(ca(r0.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))}))}).forEach(function(i0,o0){r0.loginSocketSubs[o0].receivers.push(i0.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(r0,i0,o0){var s0=this;return im(ad(function(){s0.userJoinOptions=new is(i0),r0.sendPacket("UserJoin",{account:s0.context.uid,instance:s0.instanceId,opt:s0.userJoinOptions.toLong(),seq:o0,ticket:r0.ticket})}),r0.fromReceived("UserResp").pipe(aa(function(a0){return o0.eq(a0.seq)}),ca(function(a0){if((a0=a0.code)!==0)throw s0.clearSockets(),s0.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",a0],jg);s0.log("ENV_%d logged in",r0.env)}),qf(r0),hb(15e3))).pipe(wb(function(a0){return a0!==void 0}),Ga(function(a0){return a0 instanceof pb&&s0.warn("Login response timeout, rejoin: %s",i0),Z(a0)}))}},{key:"getSocketLoginObservables",value:function(r0,i0){var o0=this;return r0.map(function(s0){return s0.pipe(ca(function(a0){a0.listenerCount("socketUserDrop")===0&&a0.on("socketUserDrop",function(c0){return o0.onUserDrop(c0,a0)})}),Cc(function(a0,c0){return o0.incSeqIfNeeded(a0.env),o0.requestSocketLogin(a0,c0!==0,c0===0?i0:o0.seq)}),pe())})}},{key:"incSeqIfNeeded",value:function(r0){if(![0,1].includes(r0))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[r0]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[r0]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var r0=this.curLoginSockets,i0=-1,o0=r0==null?0:r0.length,s0=0,a0=[];++i0<o0;){var c0=r0[i0];c0&&(a0[s0++]=c0)}return a0}},{key:"emitMessage",value:function(r0,i0){var o0=r0.options,s0=r0.payload,a0=r0.src,c0=r0.dst,u0=r0.instance,l0=r0.dialogue,d0=r0.sequence,h0=r0.ms,p0=r0.MiscMap;this.dialogueSequenceLru.set(l0.toString(),d0),u0="".concat(u0,"-").concat(l0,"#").concat(d0),this.msgDedupLru.has(u0)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",i0,u0):(this.msgDedupLru.set(u0,void 0),i0=new ae(o0),this.lastLoginSockets.forEach(function(){var m0=J(w.mark(function f0(g0){var E0;return w.wrap(function(_0){for(;;)switch(_0.prev=_0.next){case 0:return _0.next=2,g0.pipe(Ka(1)).toPromise();case 2:E0=_0.sent,e0.sendMessageAck(r0,E0);case 4:case"end":return _0.stop()}},f0)}));return function(f0){return m0.apply(this,arguments)}}()),o0=i0.isZlibCompressed(),i0.isInvitation()?(c0=pa(o0?nl(Xm(s0,Uint8Array.of(0,0,0,0))):s0),c0=JSON.parse(c0),this.log("The received invitation body is %o",c0),this.emit("invitationMessage",{body:c0,type:i0.getInvitationType(),peerId:a0,serverReceivedTs:h0.toNumber()})):i0.isTextMessage()?(p0=i0.isPeerTextMessage(),s0=pa(o0?nl(Xm(s0,Uint8Array.of(0,0,0,0))):s0),this.info("Received a %s %s text message from %s to %s, %s",o0?" compressed":"",p0?"peer":"channel",oa(a0),oa(c0),u0),p0?(a0={text:s0,peerId:a0,properties:{serverReceivedTs:h0.toNumber(),isOfflineMessage:i0.isFromCache()}},this.emit("peerTextMessage",a0)):this.emit("channelTextMessage",{channelId:c0,memberId:a0,text:s0,properties:{serverReceivedTs:h0.toNumber(),isOfflineMessage:!1}})):i0.isRawMessage()?(l0=i0.isRawPeerMessage(),p0=(p0=p0.description)===void 0?"":pa(p0),s0=o0?nl(s0):s0,this.info("Received a %s %s raw message from %s to %s, %s",o0?" compressed":"",l0?"peer":"channel",oa(a0),oa(c0),u0),l0?(a0={desc:p0,raw:s0,peerId:a0,properties:{serverReceivedTs:h0.toNumber(),isOfflineMessage:i0.isFromCache()}},this.emit("peerRawMessage",a0)):this.emit("channelRawMessage",{desc:p0,raw:s0,channelId:c0,memberId:a0,properties:{serverReceivedTs:h0.toNumber(),isOfflineMessage:!1}})):(i0.isImageMessage()||i0.isFileMessage())&&(s0=i0.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",s0?"peer":"channel",oa(a0),oa(c0),u0),s0?this.emit("peerMediaMessage",{messageType:i0.isImageMessage()?"IMAGE":"FILE",details:p0,peerId:a0,properties:{serverReceivedTs:h0.toNumber(),isOfflineMessage:i0.isFromCache()}}):this.emit("channelMediaMessage",{messageType:i0.isImageMessage()?"IMAGE":"FILE",details:p0,memberId:a0,channelId:c0,properties:{serverReceivedTs:h0.toNumber(),isOfflineMessage:i0.isFromCache()}})))}},{key:"onSocketReconnect",value:function(r0){var i0=this;return function(){var o0=[0,1].filter(function(s0){return s0!==r0.env})[0];(o0=i0.connection.curOpenSockets[o0])&&!o0.loggedIn&&i0.emit("connectionLost")}}},{key:"onUserDrop",value:function(r0,i0){var o0;r0=r0.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(i0.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:i0.address,serverCode:r0,sid:Xa(this.instanceId),userId:this.context.uid},(o0=this.context.config.enableCloudProxy)!==null&&o0!==void 0&&o0),r0===10006||r0===10001?this.warn("Login too often and kicked off, reconnect and login"):r0===10009?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(r0)&&(this.emit("userDrop",r0),this.clearSockets())}},{key:"clearSockets",value:function(){var r0=this,i0=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,o0=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(s0){r0.cleanLoginSubs(s0,o0),r0.connection.closeSocket(s0,i0)})}},{key:"onMessage",value:function(r0){var i0=this;return function(o0){var s0=o0.dialogue,a0=o0.instance,c0=o0.sequence,u0=o0.options;if(o0.src===i0.context.uid)i0.log("The message is from the local account, ignored");else{var l0=s0.toString(),d0=i0.dialPendingMsgSubjectMap.get(l0);if(s0="".concat(a0,"-").concat(s0,"#").concat(c0),d0)d0.next(o0),i0.log("Env_%d: The dialogue has pending messages, next: %s",r0.env,s0);else{var h0=i0.dialogueSequenceLru.get(l0);if(d0=!h0&&c0.eq(1),a0=h0!==void 0&&c0.sub(h0).eq(1),d0||a0)i0.emitMessage(o0,r0.env);else{if(h0){if(c0.lte(h0))return;i0.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",r0.env,s0)}else i0.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",r0.env,s0);c0=new Pa,i0.dialPendingMsgSubjectMap.set(l0,c0);var p0=c0.pipe(Qs(Pk),xg(function(m0,f0){return[].concat(G(m0),[f0])},[]),ba(function(m0){return G(m0).sort(function(f0,g0){return f0=f0.sequence,g0=g0.sequence,f0.eq(g0)?0:f0.gt(g0)?1:-1})}),sm(1));u0=!(u0=new ae(u0)).isFromCache()&&!u0.isBufferedMessage(),p0.pipe(ob(Bc(u0?750:1500)),aa(function(m0){if(2>m0.length)return!1;for(var f0=h0===void 0?U.fromNumber(1,!0):h0.add(1),g0=0;g0<m0.length;f0=f0.add(1),g0++)if(!m0[g0].sequence.eq(f0))return!1;return!0}),wg(function(){i0.dialPendingMsgSubjectMap.delete(l0)})).subscribe(function(m0){m0.forEach(function(f0){i0.emitMessage(f0,r0.env),i0.log("Env_%d: The message queue has fully ordered, emitting: %s",r0.env,"".concat(f0.instance,"-").concat(f0.dialogue,"#").concat(f0.sequence))})},function(m0){m0 instanceof vg&&p0.pipe(Ka(1)).subscribe(function(f0){return f0.forEach(function(g0){i0.log("Env_%d: The message pending queue expired, emitting: %s",r0.env,"".concat(g0.instance,"-").concat(g0.dialogue,"#").concat(g0.sequence)),i0.emitMessage(g0,r0.env)})})}),c0.next(o0)}}}}}},{key:"onGroupEnterNotice",value:function(){var r0=this;return function(i0){r0.emit("memberNotice",{channelId:i0.group,seq:i0.seq,instance:i0.instance,memberId:i0.user,type:"MemberJoined",size:i0.size})}}},{key:"onGroupLeaveNotice",value:function(){var r0=this;return function(i0){r0.emit("memberNotice",{channelId:i0.group,seq:i0.seq,instance:i0.instance,memberId:i0.user,type:"MemberLeft",size:i0.size})}}},{key:"onGroupCountNotice",value:function(){var r0=this;return function(i0){r0.emit("memberNotice",{channelId:i0.group,seq:i0.seq,instance:i0.instance,type:"MemberCountUpdated",size:i0.size})}}},{key:"onGroupAttributeAlt",value:function(){var r0=this;return function(i0){var o0=i0.group;i0=ff(i0,kD),r0.emit("channelAttributesUpdated",ua({channelId:o0},i0))}}},{key:"onUserNotice",value:function(r0){var i0=this;return function(o0){i0.emit("peerOnlineStatusChanged",{peerId:o0.user,instance:o0.instance,seq:o0.seq,state:r0})}}}],[{key:"sendMessageAck",value:function(r0,i0){var o0=new ae(r0.options);(o0.isInvitation()||o0.isPeerMessage())&&i0.sendPacket("Ack",{code:0,dialogue:r0.dialogue,instance:r0.instance,sequence:r0.sequence})}}]),e0}(tb());m(ls,"genTimeoutError",function(t0,e0){return bb(void 0).pipe(cd(e0===void 0?1e4:e0),ba(function(){throw new db(["Request timed out after %ds",e0===void 0?1e4:e0],t0)}))});var ms,ol,pl=0,ql=0;Ud.v1=function(t0,e0,n0){n0=e0&&n0||0;var r0=e0||[],i0=(t0=t0||{}).node||ms,o0=t0.clockseq!==void 0?t0.clockseq:ol;if(i0==null||o0==null){var s0=Jq();i0==null&&(i0=ms=[1|s0[0],s0[1],s0[2],s0[3],s0[4],s0[5]]),o0==null&&(o0=ol=16383&(s0[6]<<8|s0[7]))}s0=t0.msecs!==void 0?t0.msecs:new Date().getTime();var a0=t0.nsecs!==void 0?t0.nsecs:ql+1,c0=s0-pl+(a0-ql)/1e4;if(0>c0&&t0.clockseq===void 0&&(o0=o0+1&16383),(0>c0||s0>pl)&&t0.nsecs===void 0&&(a0=0),1e4<=a0)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=s0,ql=a0,ol=o0,t0=(1e4*(268435455&(s0+=122192928e5))+a0)%4294967296,r0[n0++]=t0>>>24&255,r0[n0++]=t0>>>16&255,r0[n0++]=t0>>>8&255,r0[n0++]=255&t0,t0=s0/4294967296*1e4&268435455,r0[n0++]=t0>>>8&255,r0[n0++]=255&t0,r0[n0++]=t0>>>24&15|16,r0[n0++]=t0>>>16&255,r0[n0++]=o0>>>8|128,r0[n0++]=255&o0,o0=0;6>o0;++o0)r0[n0+o0]=i0[o0];return e0||Kq(r0)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(t0){function e0(r0,i0,o0){W(this,e0);var s0=n0.call(this,o0,"RtmLocalInvitation",!0);return m(n(s0),"state",Ba.IDLE),m(n(s0),"localInvitationEnd$",Ca(gb(n(s0),"LocalInvitationAccepted"),gb(n(s0),"LocalInvitationRefused"),gb(n(s0),"LocalInvitationFailure"),gb(n(s0),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(s0),"callId",Ud.v4()),m(n(s0),"_content",""),m(n(s0),"_channelId",""),m(n(s0),"_response",""),m(n(s0),"calleeId",void 0),m(n(s0),"logger",void 0),m(n(s0),"getSession",void 0),s0.calleeId=r0,s0.getSession=i0,s0.logger=o0,s0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"channelId",get:function(){return this._channelId},set:function(r0){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=r0)}},{key:"content",get:function(){return this._content},set:function(r0){this.log("set content for %s",this.callId),this._content=r0}},{key:"response",get:function(){return this._response},set:function(r0){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var r0,i0=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark(function o0(){var s0,a0,c0;return w.wrap(function(u0){for(;;)switch(u0.prev=u0.next){case 0:return u0.next=2,i0.getSession().sendInvitationMessage({peerId:i0.calleeId,callId:i0.callId,extra:i0._content,type:"CallInvite",channelId:i0._channelId});case 2:if(s0=u0.sent,a0=s0.hasPeerReceived,c0=s0.hasReSent,!i0.isLocalInvitationEnd()){u0.next=7;break}throw new db("send invitation timeout");case 7:if(i0.log("The local invitation has sent to the callee"),a0||c0){u0.next=11;break}throw r0=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(a0){u0.next=14;break}throw r0=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return u0.stop()}},o0)}))).pipe(oe(function(o0){return o0.pipe(ca(function(s0){if(!(s0 instanceof rl))throw s0}),cd(2e3))}),hb(3e4),Ga(function(o0){return Sa(o0)&&i0.warn("local invitation ack timed out"),Z(o0)}),ob(this.localInvitationEnd$)).subscribe({next:function(){i0.state===Ba.RECEIVED_BY_REMOTE?i0.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):i0.state!==Ba.SENT_TO_REMOTE?i0.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(i0.info("The peer received the local invitation %s.",i0.callId),i0.state=Ba.RECEIVED_BY_REMOTE,i0.emit("LocalInvitationReceivedByPeer"),i0.localInvitationEnd$.pipe(hb(6e4),Ga(function(o0){return Sa(o0)&&i0.warn("local invitation expired"),Z(o0)})).subscribe({error:function(){i0.state=Ba.FAILURE,i0.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(o0){i0.isLocalInvitationEnd()?i0.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(i0.state=Ba.FAILURE,Sa(o0)&&r0?r0.code==="PEER_NOT_ONLINE"?i0.emit("LocalInvitationFailure",bf.PEER_OFFLINE):r0.code==="RESENT_AND_OFFLINE"&&i0.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(o0)?i0.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):o0.name==="RtmInvalidStatusError"?i0.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):i0.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(r0){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=r0,this.emit("LocalInvitationAccepted",r0))}}},{key:"onRefuseReceived",value:function(r0){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=r0,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",r0)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),e0}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(t0){function e0(r0){var i0=r0.invitationChannel,o0=r0.extraContent,s0=r0.callId,a0=r0.callerId,c0=r0.logger;r0=r0.getSession,W(this,e0);var u0=n0.call(this,c0,"RtmRemoteInvitation",!0);return m(n(u0),"state",kb.INVITATION_RECEIVED),m(n(u0),"remoteInvitationEnd$",Ca(gb(n(u0),"RemoteInvitationCanceled"),gb(n(u0),"RemoteInvitationRefused"),gb(n(u0),"RemoteInvitationAccepted"),gb(n(u0),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(u0),"callerId",void 0),m(n(u0),"callId",void 0),m(n(u0),"_getSession",void 0),m(n(u0),"logger",void 0),m(n(u0),"_content",void 0),m(n(u0),"_channelId",void 0),m(n(u0),"_response",""),u0._channelId=i0,u0._content=o0,u0.callId=s0,u0.callerId=a0,u0._getSession=r0,u0.logger=c0,u0.remoteInvitationEnd$.pipe(hb(6e4),Ga(function(l0){return Sa(l0)&&u0.warn("Remote invitation expired"),Z(l0)})).subscribe({error:function(){u0.state=kb.FAILURE,u0.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),u0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"channelId",get:function(){return this._channelId},set:function(r0){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(r0){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(r0){this._response=r0}},{key:"accept",value:function(){var r0,i0=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb(function(){return ad(J(w.mark(function o0(){return w.wrap(function(s0){for(;;)switch(s0.prev=s0.next){case 0:return s0.abrupt("return",i0._getSession().sendInvitationMessage({peerId:i0.callerId,callId:i0.callId,extra:i0.response,type:"CallAccept",isAcceptAck:!1,channelId:i0.channelId}));case 1:case"end":return s0.stop()}},o0)})))}),wb(function(o0){return r0=o0.hasPeerReceived}),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(o0){if(i0.logError(o0),i0.state=kb.FAILURE,Sa(o0))switch(r0){case void 0:case!0:return void i0.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void i0.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}i0.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(r0){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=r0,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",r0))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),e0}(tb()),nD=function(t0){function e0(r0,i0){W(this,e0);var o0=n0.call(this,i0,"InvitationManager");return m(n(o0),"getSession",void 0),m(n(o0),"invitationDispatcher",new ea.EventEmitter),m(n(o0),"outgoingLocalInvitations",new Map),m(n(o0),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(o0),"logger",void 0),o0.getSession=cn(r0),o0.logger=i0,o0.invitationDispatcher.on("remoteInvitationToManager",function(s0){var a0=s0.callId,c0=s0.extra,u0=s0.callerId;s0=s0.channelId,o0.receivedRemoteInvitations.has(a0)||((c0=new mD({callerId:u0,callId:a0,getSession:o0.getSession,logger:i0,extraContent:c0,invitationChannel:s0})).remoteInvitationEnd$.subscribe(function(){o0.receivedRemoteInvitations.delete(a0)}),o0.receivedRemoteInvitations.set(a0,c0),o0.emit("remoteInvitationInstance",c0))}),o0.invitationDispatcher.on("acceptAckToRemoteInvitation",function(s0){(s0=o0.receivedRemoteInvitations.get(s0.callId))&&s0.onAcceptAckReceived()}),o0.invitationDispatcher.on("cancelToRemoteInvitation",function(s0){var a0=s0.extra;(s0=o0.receivedRemoteInvitations.get(s0.callId))&&s0.onCancelReceived(a0)}),o0.invitationDispatcher.on("acceptToLocalInvitation",function(s0){var a0=s0.extra;(s0=o0.outgoingLocalInvitations.get(s0.callId))&&s0.onAcceptReceived(a0)}),o0.invitationDispatcher.on("refuseToLocalInvitation",function(s0){var a0=s0.extra;(s0=o0.outgoingLocalInvitations.get(s0.callId))&&s0.onRefuseReceived(a0)}),o0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"invitationMessageHandler",value:function(r0){var i0=r0.body,o0=i0.callId,s0=i0.extra;s0=s0===void 0?"":s0;var a0=i0.type,c0=(i0=i0.channel)===void 0?"":i0,u0=r0.type;switch(i0=r0.peerId,r0=r0.serverReceivedTs,u0){case"CallAccept":a0==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:o0}):a0==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:o0,extra:s0});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:o0,callerId:i0,extra:s0,channelId:c0});break;case"CallCancel":if(o0==="0"){o0="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(c0,"_").concat(s0),this.getSession().emit("peerTextMessage",{peerId:i0,properties:{serverReceivedTs:r0,isOfflineMessage:!1},text:o0});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:o0,extra:s0});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:o0,extra:s0});break;default:throw Im("invitationType",u0)}}},{key:"genLocalInvitation",value:function(r0){var i0=this,o0=new lD(r0,this.getSession,this.logger);return o0.localInvitationEnd$.subscribe(function(){i0.outgoingLocalInvitations.delete(o0.callId)}),this.outgoingLocalInvitations.set(o0.callId,o0),o0}}]),e0}(tb()),oD=function(t0,e0,n0){var r0=!0,i0=!0;if(typeof t0!="function")throw new TypeError("Expected a function");return lb(n0)&&(r0="leading"in n0?!!n0.leading:r0,i0="trailing"in n0?!!n0.trailing:i0),qC(t0,e0,{leading:r0,maxWait:e0,trailing:i0})},ub,cf;(function(t0){t0[t0.JOINED=0]="JOINED",t0[t0.LEFT=1]="LEFT"})(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(t0){function e0(r0,i0,o0,s0){W(this,e0);var a0=n0.call(this,s0,"RtmChannel",!0);return m(n(a0),"onMemberCountUpdated",oD(function(c0){c0!==a0.memberCount&&(a0.memberCount=c0,a0.emit("MemberCountUpdated",c0))},1e3)),m(n(a0),"getSession",void 0),m(n(a0),"memberCount",0),m(n(a0),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(a0),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(a0),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(a0),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(a0),"channelId",void 0),m(n(a0),"client",void 0),m(n(a0),"onAttributesUpdated",function(c0){var u0=c0.channelId,l0=c0.attributeMaps,d0=c0.seq;c0=c0.instance.toString();var h0=a0.attributesSeqLru.get(c0);if((!h0||d0.greaterThan(h0))&&(a0.attributesSeqLru.set(c0,d0),u0===a0.channelId)){for(u0={},d0=0;d0<l0.length;d0++){var p0=l0[d0];c0=p0.key,h0=p0.ms;var m0=p0.value;if(p0=p0.origin,typeof c0!="string"||!U.isLong(h0)||typeof m0!="string"||!za(p0))break;u0[c0]={value:m0,lastUpdateUserId:p0,lastUpdateTs:h0.toNumber()}}a0.emit("AttributesUpdated",u0)}}),m(n(a0),"onChannelTextMessage",function(c0){var u0=c0.memberId,l0=c0.text,d0=c0.properties;c0.channelId===a0.channelId&&a0.emit("ChannelMessage",{text:l0,messageType:S.MessageType.TEXT},u0,d0)}),m(n(a0),"onChannelMediaMessage",function(c0){var u0=c0.memberId,l0=c0.properties,d0=c0.details,h0=c0.messageType;c0.channelId===a0.channelId&&(h0==="FILE"?a0.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(d0.media_size),10),description:pa(d0.media_description),fileName:pa(d0.media_filename),mediaId:pa(d0.media_id),thumbnail:new Blob([d0.media_thumbnail])},u0,l0):h0==="IMAGE"&&a0.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(d0.media_size),10),description:pa(d0.media_description),fileName:pa(d0.media_filename),mediaId:pa(d0.media_id),thumbnail:new Blob([d0.media_thumbnail]),height:parseInt(pa(d0.media_height),10),width:parseInt(pa(d0.media_width),10),thumbnailHeight:parseInt(pa(d0.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(d0.media_thumbnailwidth),10)},u0,l0))}),m(n(a0),"onChannelRawMessage",function(c0){var u0=c0.desc,l0=c0.raw,d0=c0.memberId,h0=c0.properties;c0.channelId===a0.channelId&&a0.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:l0,description:u0},d0,h0)}),m(n(a0),"onMemberNotice",function(c0){var u0=c0.memberId,l0=c0.type,d0=c0.size;if(c0.channelId===a0.channelId){var h0=c0.instance.toString();c0=c0.seq.toString();var p0={MemberLeft:a0.memberLeftLru,MemberJoined:a0.memberJoinedLru,MemberCountUpdated:void 0}[l0];if(p0){if(p0.has(h0+c0))return void a0.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",l0,c0,oa(a0.channelId),oa(u0||""));if(p0.set(h0+c0,void 0),typeof u0!="string")return;if(u0!==a0.getSession().context.uid&&((h0=a0.memberJoinStateLru.get(u0))===cf.JOINED&&l0==="MemberJoined"||h0===cf.LEFT&&l0==="MemberLeft"))return void a0.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",l0,c0,oa(a0.channelId),oa(u0||""));a0.memberJoinStateLru.set(u0,l0==="MemberJoined"?cf.JOINED:cf.LEFT)}a0.info("Channel %s - %s, memberId: %s",l0,oa(a0.channelId),l0==="MemberCountUpdated"?"[unknown]":oa(u0||"")),h0=u0===a0.getSession().context.uid,l0==="MemberLeft"&&za(u0)||l0==="MemberJoined"&&za(u0)?(h0||a0.emit(l0,u0),a0.onMemberCountUpdated(d0)):l0==="MemberCountUpdated"&&typeof d0=="number"&&a0.onMemberCountUpdated(d0)}}),a0.getSession=cn(i0),a0.channelId=r0,a0.client=o0,a0.info("A channel created, id %s",oa(r0)),a0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"join",value:function(){var r0=J(w.mark(function i0(){var o0,s0,a0,c0,u0,l0,d0;return w.wrap(function(h0){for(;;)switch(h0.prev=h0.next){case 0:if(za(this.channelId)){h0.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:h0.prev=2,o0=this.getSession(),h0.next=9;break;case 6:throw h0.prev=6,h0.t0=h0.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!o0.joinedChannels.has(this)){h0.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:o0.context.uid,elapse:fb(o0.startTime),errCode:Uq,sid:Xa(o0.instanceId)},(s0=this.client.context.config.enableCloudProxy)!==null&&s0!==void 0&&s0),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(h0.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){h0.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:o0.context.uid,elapse:fb(o0.startTime),errCode:Wq,sid:Xa(o0.instanceId)},(u0=this.client.context.config.enableCloudProxy)!==null&&u0!==void 0&&u0),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(o0.joinedChannels.size!==20){h0.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:o0.context.uid,elapse:fb(o0.startTime),errCode:Tq,sid:Xa(o0.instanceId)},(l0=this.client.context.config.enableCloudProxy)!==null&&l0!==void 0&&l0),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:o0.context.uid,elapse:fb(o0.startTime),errCode:0,sid:Xa(o0.instanceId)},(a0=this.client.context.config.enableCloudProxy)!==null&&a0!==void 0&&a0),h0.next=23,o0.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(o0.startTime),errCode:0,sid:Xa(o0.instanceId),serverErrCode:0,userId:o0.context.uid},(c0=this.client.context.config.enableCloudProxy)!==null&&c0!==void 0&&c0),this.info("The channel %s joined successfully",oa(this.channelId)),o0.on("channelTextMessage",this.onChannelTextMessage),o0.on("channelRawMessage",this.onChannelRawMessage),o0.on("channelMediaMessage",this.onChannelMediaMessage),o0.on("memberNotice",this.onMemberNotice),o0.on("channelAttributesUpdated",this.onAttributesUpdated),h0.next=41;break;case 32:if(h0.prev=32,h0.t1=h0.catch(12),this.logError(h0.t1),!sa(h0.t1)){h0.next=37;break}throw h0.t1;case 37:if(!Sa(h0.t1)){h0.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(o0.startTime),errCode:Sq,sid:Xa(o0.instanceId),serverErrCode:0,userId:o0.context.uid},(d0=this.client.context.config.enableCloudProxy)!==null&&d0!==void 0&&d0),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:h0.t1});case 41:case"end":return h0.stop()}},i0,this,[[2,6],[12,32]])}));return function(){return r0.apply(this,arguments)}}()},{key:"leave",value:function(){var r0=J(w.mark(function i0(){var o0,s0,a0,c0;return w.wrap(function(u0){for(;;)switch(u0.prev=u0.next){case 0:u0.prev=0,s0=this.getSession(),u0.next=7;break;case 4:throw u0.prev=4,u0.t0=u0.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(s0.joinedChannels.has(this)){u0.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:u0.prev=9,s0.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,s0.removeListener("channelTextMessage",this.onChannelTextMessage),s0.removeListener("channelRawMessage",this.onChannelRawMessage),s0.removeListener("channelMediaMessage",this.onChannelMediaMessage),s0.removeListener("memberNotice",this.onMemberNotice),s0.removeListener("channelAttributesUpdated",this.onAttributesUpdated),u0.next=32;break;case 23:if(u0.prev=23,u0.t1=u0.catch(9),this.logError(u0.t1),!sa(u0.t1)){u0.next=30;break}throw u0.t1.code===void 0&&(u0.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(s0.startTime),errCode:Yq,sid:Xa(s0.instanceId),userId:s0.context.uid},(c0=this.client.context.config.enableCloudProxy)!==null&&c0!==void 0&&c0),u0.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(s0.startTime),errCode:Xq,sid:Xa(s0.instanceId),userId:s0.context.uid},(a0=this.client.context.config.enableCloudProxy)!==null&&a0!==void 0&&a0),new Wc("The channel leave failure",{code:Xq,originalError:u0.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(s0.startTime),errCode:0,sid:Xa(s0.instanceId),userId:s0.context.uid},(o0=this.client.context.config.enableCloudProxy)!==null&&o0!==void 0&&o0);case 33:case"end":return u0.stop()}},i0,this,[[0,4],[9,23]])}));return function(){return r0.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0,d0=this,h0=arguments;return w.wrap(function(p0){for(;;)switch(p0.prev=p0.next){case 0:s0=1<h0.length&&h0[1]!==void 0?h0[1]:{},a0=s0.enableHistoricalMessaging,c0=a0!==void 0&&a0,Tm(o0,Hh),p0.prev=2,u0=this.getSession(),p0.next=9;break;case 6:throw p0.prev=6,p0.t0=p0.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(u0.joinedChannels.has(this)){p0.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){p0.next=16;break}return l0=Date.now(),p0.next=15,new Promise(function(m0,f0){var g0=function(){var _0=J(w.mark(function y0(){var b0;return w.wrap(function(S0){for(;;)switch(S0.prev=S0.next){case 0:return b0=Date.now()-l0,S0.prev=1,S0.next=4,Gg({message:o0,peerId:d0.channelId,toPeer:!1,session:d0.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:b0,logger:d0.logger,options:{enableHistoricalMessaging:c0,enableOfflineMessaging:!1}});case 4:m0(),S0.next=12;break;case 7:S0.prev=7,S0.t0=S0.catch(1),Sa(S0.t0)&&f0(new db(Yd(d0.name,"sendMessageToPeer",1e4),Yk)),sa(S0.t0)&&f0(S0.t0),f0(new da("Channel message send failure",{code:hg,originalError:S0.t0}));case 12:return S0.prev=12,clearTimeout(E0),S0.finish(12);case 15:case"end":return S0.stop()}},y0,null,[[1,7,12,15]])}));return function(){return _0.apply(this,arguments)}}();d0.client.internalEmitter.once("RECONNECTED",g0);var E0=setTimeout(function(){d0.client.internalEmitter.off("RECONNECTED",g0),f0(new db(Yd(d0.name,"sendMessageToPeer",1e4),Yk))},9e3)});case 15:return p0.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){p0.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return p0.prev=18,p0.next=21,Gg({message:o0,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:c0,enableOfflineMessaging:!1}});case 21:p0.next=31;break;case 23:if(p0.prev=23,p0.t1=p0.catch(18),!Sa(p0.t1)){p0.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(p0.t1)){p0.next=30;break}throw this.logError(p0.t1),p0.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return p0.stop()}},i0,this,[[2,6],[18,23]])}));return function(i0){return r0.apply(this,arguments)}}()},{key:"getMembers",value:function(){var r0=J(w.mark(function i0(){var o0,s0,a0;return w.wrap(function(c0){for(;;)switch(c0.prev=c0.next){case 0:c0.prev=0,c0.prev=1,o0=this.getSession(),c0.next=8;break;case 5:throw c0.prev=5,c0.t0=c0.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(o0.joinedChannels.has(this)){c0.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return s0=this.getSession().requestChannelMemberList(this.channelId),c0.next=13,s0.pipe(ba(function(u0){return u0.memberInfos.map(function(l0){return l0.account})})).toPromise();case 13:return a0=c0.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),a0.map(oa)),c0.abrupt("return",a0);case 18:if(c0.prev=18,c0.t1=c0.catch(0),!sa(c0.t1)){c0.next=23;break}throw this.logError(c0.t1),c0.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return c0.stop()}},i0,this,[[0,18],[1,5]])}));return function(){return r0.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var r0=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some(function(i0){return i0.channelId===r0.channelId})}}]),e0}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(t0){function e0(r0,i0,o0,s0){W(this,e0);var a0=n0.call(this,i0,"RtmClient",!0);return m(n(a0),"connectionState",T.DISCONNECTED),m(n(a0),"internalEmitter",new ea),m(n(a0),"context",void 0),m(n(a0),"attributes",{}),m(n(a0),"loginPromise",void 0),m(n(a0),"attributeDrafts",new Set),m(n(a0),"session",void 0),m(n(a0),"lastLoginTime",void 0),m(n(a0),"reconnId",0),m(n(a0),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(a0),"invitationManager",void 0),m(n(a0),"subscribedPeerStatusCache",{}),m(n(a0),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(a0),"peerUnreachableTimers",{}),m(n(a0),"mediaTaskManager",void 0),m(n(a0),"setParameters",void 0),m(n(a0),"updateConfig",void 0),m(n(a0),"userDropHandler",function(c0){if(a0.connectionState!==T.ABORTED)switch(c0){case 11:a0.logError("Kicked off by remote session"),a0.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:a0.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[c0])),a0.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:a0.logError("User kicked off for unknown code: ".concat(c0)),a0.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}}),a0.context=new ZC(r0,o0,i0),a0.mediaTaskManager=new fs(i0),a0.context.config=o0,a0.internalEmitter.setMaxListeners(512),a0.setParameters=s0.bind(n(a0)),a0.updateConfig=s0.bind(n(a0)),a0.invitationManager=new nD(function(){return a0.session},i0),a0.invitationManager.on("remoteInvitationInstance",function(c0){a0.emit("RemoteInvitationReceived",c0)}),a0}la(e0,t0);var n0=ma(e0);return Ha(e0,[{key:"renewToken",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0=this;return w.wrap(function(l0){for(;;)switch(l0.prev=l0.next){case 0:if(typeof o0=="string"&&o0.length!==0){l0.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){l0.next=5;break}return l0.next=5,new Promise(function(){});case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){l0.next=7;break}throw new K("The client is not logged in",uA);case 7:if(this.session!==void 0){l0.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return l0.prev=9,s0=this.context.token,this.context.token=o0,l0.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd(function(){return Error("No available edge address to connect")}),oe(function(d0){return d0.pipe(ca(function(h0){if(sa(h0))throw h0}),cd(2500),Ka(4))}),Ka(1),hb(2e4),Ga(function(d0){return Sa(d0)&&u0.warn("renewToken timed out"),Z(d0)})).toPromise();case 14:a0=l0.sent,c0=a0.ticket,l0.next=27;break;case 18:if(l0.prev=18,l0.t0=l0.catch(9),this.context.token=s0,l0.t0.code!==$q&&l0.t0.code!==ar){l0.next=23;break}throw new Ye("Invalid token",tA);case 23:if(l0.t0.code!==Kh){l0.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(l0.t0)){l0.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter(function(d0){return d0!==void 0}).forEach(function(d0){return d0.ticket=c0});case 28:case"end":return l0.stop()}},i0,this,[[9,18]])}));return function(i0){return r0.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0=this;return w.wrap(function(u0){for(;;)switch(u0.prev=u0.next){case 0:if(this.connectionState===T.CONNECTED){u0.next=2;break}throw new K("The client is not logged in",pA);case 2:if(this.session!==void 0){u0.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(o0)||o0.length===0||o0.some(function(l0){return!za(l0)})||256<o0.length)){u0.next=6;break}throw new I("invalid arguments",er);case 6:return u0.next=8,this.session.requestPeersOnlineStatus(o0).toPromise();case 8:return s0=u0.sent,a0=uc(Jk(s0.userInfos,"account"),function(l0){return!!l0.ts}),Object.keys(a0).forEach(function(l0){if(l0 in c0.subscribedPeerStatusCache&&c0.subscribedPeerStatusCache[l0]!==S.PeerOnlineState.UNREACHABLE){var d0=a0[l0]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;c0.emit("PeersOnlineStatusChanged",m({},l0,d0)),c0.subscribedPeerStatusCache[l0]=d0}}),u0.abrupt("return",a0);case 12:case"end":return u0.stop()}},i0,this)}));return function(i0){return r0.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0,d0,h0,p0=this;return w.wrap(function(m0){for(;;)switch(m0.prev=m0.next){case 0:if(this.connectionState===T.CONNECTED){m0.next=2;break}throw new K("The client is not logged in",aA);case 2:if(this.session!==void 0){m0.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(o0)&&o0.every(function(f0){return typeof f0=="string"})&&o0.length!==0){m0.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<o0.length)){m0.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:s0=0;case 9:if(!(s0<o0.length)){m0.next=16;break}if(za(a0=o0[s0])){m0.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",a0],Oq);case 13:s0++,m0.next=9;break;case 16:return m0.next=18,this.session.requestGetChannelMemberCount(o0).toPromise();case 18:for(c0=m0.sent,u0=c0.groupInfos,l0={},d0=function(f0){var g0=(f0=u0[f0]).group,E0=f0.memberCount;za(g0)&&typeof E0=="number"&&(p0.session.joinedChannels.forEach(function(_0){_0.channelId===g0&&_0.onMemberCountUpdated(E0)}),l0[g0]=E0)},h0=0;h0<u0.length;h0++)d0(h0);return m0.abrupt("return",l0);case 24:case"end":return m0.stop()}},i0,this)}));return function(i0){return r0.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0;return w.wrap(function(c0){for(;;)switch(c0.prev=c0.next){case 0:if(uf({attributes:o0,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){c0.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){c0.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return s0=this.session.requestSetLocalUserAttributes(o0).toPromise(),a0={attribute:o0,promise:s0},this.attributeDrafts.add(a0),c0.prev=8,c0.next=11,s0;case 11:this.attributes=o0,c0.next=19;break;case 14:if(c0.prev=14,c0.t0=c0.catch(8),!sa(c0.t0)){c0.next=18;break}throw c0.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return c0.prev=19,this.attributeDrafts.delete(a0),c0.finish(19);case 22:case"end":return c0.stop()}},i0,this,[[8,14,19,22]])}));return function(i0){return r0.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var r0=J(w.mark(function i0(o0,s0){var a0,c0,u0,l0,d0,h0=arguments;return w.wrap(function(p0){for(;;)switch(p0.prev=p0.next){case 0:if(a0=2<h0.length&&h0[2]!==void 0?h0[2]:{},c0=a0.enableNotificationToChannelMembers,u0=c0!==void 0&&c0,uf({attributes:s0,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){p0.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){p0.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return l0=this.session.requestSetChannelAttributes(o0,s0,u0).toPromise(),p0.prev=7,p0.next=10,l0;case 10:d0=uc(s0,function(m0){return new Blob([m0]).size}),this.channelAttributesCacheLru.set(o0,d0),p0.next=19;break;case 14:if(p0.prev=14,p0.t0=p0.catch(7),!sa(p0.t0)){p0.next=18;break}throw p0.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return p0.stop()}},i0,this,[[7,14]])}));return function(i0,o0){return r0.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0;return w.wrap(function(u0){for(;;)switch(u0.prev=u0.next){case 0:if(s0=ua(ua({},this.attributes),o0),uf({attributes:o0,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:s0,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){u0.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){u0.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return a0=this.session.requestAddOrUpdateLocalUserAttributes(o0).toPromise(),c0={attribute:s0,promise:a0},this.attributeDrafts.add(c0),u0.prev=10,u0.next=13,a0;case 13:this.attributes=s0,u0.next=21;break;case 16:if(u0.prev=16,u0.t0=u0.catch(10),!sa(u0.t0)){u0.next=20;break}throw u0.t0;case 20:throw new I("arguments is not valid",er);case 21:return u0.prev=21,this.attributeDrafts.delete(c0),u0.finish(21);case 24:case"end":return u0.stop()}},i0,this,[[10,16,21,24]])}));return function(i0){return r0.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var r0=J(w.mark(function i0(o0,s0){var a0,c0,u0,l0,d0,h0,p0,m0=arguments;return w.wrap(function(f0){for(;;)switch(f0.prev=f0.next){case 0:if(a0=2<m0.length&&m0[2]!==void 0?m0[2]:{},c0=a0.enableNotificationToChannelMembers,u0=c0!==void 0&&c0,l0=this.channelAttributesCacheLru.get(o0,{}),d0=uc(s0,function(g0){return new Blob([g0]).size}),h0=ua(ua({},l0),d0),uf({attributes:s0,attrSizeMap:h0,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){f0.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(this.session!==void 0){f0.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return p0=this.session.requestAddOrUpdateChannelAttributes(o0,s0,u0).toPromise(),f0.prev=10,f0.next=13,p0;case 13:this.channelAttributesCacheLru.set(o0,h0),f0.next=21;break;case 16:if(f0.prev=16,f0.t0=f0.catch(10),!sa(f0.t0)){f0.next=20;break}throw f0.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return f0.stop()}},i0,this,[[10,16]])}));return function(i0,o0){return r0.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0;return w.wrap(function(l0){for(;;)switch(l0.prev=l0.next){case 0:if(Array.isArray(o0)&&o0.length!==0&&!o0.some(function(d0){return d0.length===0})){l0.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){l0.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){l0.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return s0=this.session.requestDeleteLocalUserAttributesByKeys(o0).toPromise(),a0={attribute:Gk(this.attributes,o0),promise:s0},this.attributeDrafts.add(a0),l0.prev=9,l0.next=12,s0;case 12:for(c0=0;c0<o0.length;c0++)u0=o0[c0],delete this.attributes[u0];l0.next=20;break;case 15:if(l0.prev=15,l0.t0=l0.catch(9),!sa(l0.t0)){l0.next=19;break}throw l0.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return l0.prev=20,this.attributeDrafts.delete(a0),l0.finish(20);case 23:case"end":return l0.stop()}},i0,this,[[9,15,20,23]])}));return function(i0){return r0.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var r0=J(w.mark(function i0(o0,s0){var a0,c0,u0,l0,d0,h0,p0,m0=arguments;return w.wrap(function(f0){for(;;)switch(f0.prev=f0.next){case 0:if(a0=2<m0.length&&m0[2]!==void 0?m0[2]:{},c0=a0.enableNotificationToChannelMembers,u0=c0!==void 0&&c0,Array.isArray(s0)&&s0.length!==0&&za(o0)&&!s0.some(function(g0){return g0.length===0||512<g0.length})){f0.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){f0.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){f0.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return l0=this.session.requestDeleteChannelAttributesByKeys(o0,s0,u0).toPromise(),f0.prev=8,f0.next=11,l0;case 11:if(d0=this.channelAttributesCacheLru.get(o0))for(h0=0;h0<s0.length;h0++)p0=s0[h0],delete d0[p0];f0.next=20;break;case 15:if(f0.prev=15,f0.t0=f0.catch(8),!sa(f0.t0)){f0.next=19;break}throw f0.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return f0.stop()}},i0,this,[[8,15]])}));return function(i0,o0){return r0.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var r0=J(w.mark(function i0(){var o0,s0;return w.wrap(function(a0){for(;;)switch(a0.prev=a0.next){case 0:if(this.connectionState===T.CONNECTED){a0.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){a0.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return o0=this.session.requestClearLocalUserAttributes().toPromise(),s0={attribute:{},promise:o0},this.attributeDrafts.add(s0),a0.prev=7,a0.next=10,o0;case 10:this.attributes={},a0.next=18;break;case 13:if(a0.prev=13,a0.t0=a0.catch(7),!sa(a0.t0)){a0.next=17;break}throw a0.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return a0.prev=18,this.attributeDrafts.delete(s0),a0.finish(18);case 21:case"end":return a0.stop()}},i0,this,[[7,13,18,21]])}));return function(){return r0.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0=arguments;return w.wrap(function(d0){for(;;)switch(d0.prev=d0.next){case 0:if(s0=1<l0.length&&l0[1]!==void 0?l0[1]:{},a0=s0.enableNotificationToChannelMembers,c0=a0!==void 0&&a0,this.connectionState===T.CONNECTED){d0.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){d0.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return u0=this.session.requestClearChannelAttributes(o0,c0).toPromise(),d0.prev=6,d0.next=9,u0;case 9:this.channelAttributesCacheLru.delete(o0),d0.next=17;break;case 12:if(d0.prev=12,d0.t0=d0.catch(6),!sa(d0.t0)){d0.next=16;break}throw d0.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return d0.stop()}},i0,this,[[6,12]])}));return function(i0){return r0.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0;return w.wrap(function(u0){for(;;)switch(u0.prev=u0.next){case 0:if(za(o0)){u0.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){u0.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){u0.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return u0.prev=6,u0.next=9,this.session.requestGetUserAttributeKeys(o0).toPromise();case 9:return s0=u0.sent,a0=s0.keys,u0.next=13,this.session.requestGetUserAttributesByKeys(o0,a0.slice(0,512)).toPromise();case 13:c0=u0.sent,u0.next=21;break;case 16:if(u0.prev=16,u0.t0=u0.catch(6),!sa(u0.t0)){u0.next=20;break}throw u0.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return u0.abrupt("return",Yp(c0.attributeInfos.map(function(l0){return[l0.key,l0.value]})));case 22:case"end":return u0.stop()}},i0,this,[[6,16]])}));return function(i0){return r0.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0,d0,h0,p0,m0,f0,g0;return w.wrap(function(E0){for(;;)switch(E0.prev=E0.next){case 0:if(za(o0)){E0.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){E0.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){E0.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return E0.prev=6,E0.next=9,this.session.requestGetChannelAttributesKeys(o0).toPromise();case 9:return s0=E0.sent,a0=s0.keys,E0.next=13,this.session.requestGetChannelAttributesByKeys(o0,a0).toPromise();case 13:c0=E0.sent,u0=c0.attributeMaps,E0.next=22;break;case 17:if(E0.prev=17,E0.t0=E0.catch(6),!sa(E0.t0)){E0.next=21;break}throw E0.t0;case 21:throw new I("arguments is not valid",Ja);case 22:l0={},d0=0;case 24:if(!(d0<u0.length)){E0.next=32;break}if(h0=u0[d0],p0=h0.key,m0=h0.ms,f0=h0.value,g0=h0.origin,typeof p0=="string"&&U.isLong(m0)&&typeof f0=="string"&&za(g0)){E0.next=28;break}return E0.abrupt("break",32);case 28:l0[p0]={value:f0,lastUpdateUserId:g0,lastUpdateTs:m0.toNumber()};case 29:d0++,E0.next=24;break;case 32:return this.channelAttributesCacheLru.set(o0,uc(l0,function(_0){return new Blob([_0.value]).size})),E0.abrupt("return",l0);case 34:case"end":return E0.stop()}},i0,this,[[6,17]])}));return function(i0){return r0.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var r0=J(w.mark(function i0(o0,s0){var a0,c0,u0,l0,d0,h0,p0,m0,f0,g0;return w.wrap(function(E0){for(;;)switch(E0.prev=E0.next){case 0:if(this.connectionState===T.CONNECTED){E0.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){E0.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(o0,s0),E0.prev=5,E0.next=8,this.session.requestGetChannelAttributesByKeys(o0,s0).toPromise();case 8:a0=E0.sent,c0=a0.attributeMaps,E0.next=17;break;case 12:if(E0.prev=12,E0.t0=E0.catch(5),!sa(E0.t0)){E0.next=16;break}throw E0.t0;case 16:throw new I("arguments is not valid",Ja);case 17:u0={},l0=this.channelAttributesCacheLru.get(o0,{}),d0=0;case 20:if(!(d0<c0.length)){E0.next=29;break}if(h0=c0[d0],p0=h0.key,m0=h0.ms,f0=h0.value,g0=h0.origin,typeof p0=="string"&&U.isLong(m0)&&typeof f0=="string"&&za(g0)){E0.next=24;break}return E0.abrupt("break",29);case 24:l0[p0]=new Blob([f0]).size,u0[p0]={value:f0,lastUpdateUserId:g0,lastUpdateTs:m0.toNumber()};case 26:d0++,E0.next=20;break;case 29:return this.channelAttributesCacheLru.set(o0,l0),E0.abrupt("return",u0);case 31:case"end":return E0.stop()}},i0,this,[[5,12]])}));return function(i0,o0){return r0.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var r0=J(w.mark(function i0(o0,s0){var a0;return w.wrap(function(c0){for(;;)switch(c0.prev=c0.next){case 0:if(this.connectionState===T.CONNECTED){c0.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){c0.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(o0,s0),c0.prev=5,c0.next=8,this.session.requestGetUserAttributesByKeys(o0,s0).toPromise();case 8:a0=c0.sent,c0.next=16;break;case 11:if(c0.prev=11,c0.t0=c0.catch(5),!sa(c0.t0)){c0.next=15;break}throw c0.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return c0.abrupt("return",Yp(a0.attributeInfos.map(function(u0){return[u0.key,u0.value]})));case 17:case"end":return c0.stop()}},i0,this,[[5,11]])}));return function(i0,o0){return r0.apply(this,arguments)}}()},{key:"login",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0=this;return w.wrap(function(d0){for(;;)switch(d0.prev=d0.next){case 0:if(Uk=!0,s0=Bg(),a0=o0.token,o0.token===this.context.appId&&(a0=void 0),setTimeout(function(){var h0;eb("Session",{appId:l0.context.appId,did:navigator.userAgent,elapse:fb(l0.session&&l0.session.startTime),index:{index1:o0.uid,index2:l0.context.appId,index3:"enableLogUpload=".concat(l0.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(s0),token:a0||"",userId:o0.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},(h0=l0.context.config.enableCloudProxy)!==null&&h0!==void 0&&h0)},1e4),yd(o0)&&za(o0.uid)){d0.next=7;break}throw new I("not a valid user id",Jh);case 7:if(typeof a0!="string"||!a0){d0.next=11;break}this.context.token=a0,d0.next=13;break;case 11:if(typeof a0=="string"||a0==null){d0.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return c0=Date.now(),this.context.sid=Xa(s0),this.loginPromise=this.loginImpl({uid:o0.uid,instanceId:s0}),this.info("RTM Client logging in as ".concat(oa(o0.uid))),d0.prev=17,d0.next=20,this.loginPromise;case 20:d0.next=27;break;case 22:throw d0.prev=22,d0.t0=d0.catch(17),sa(d0.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:d0.t0.code||1,sc:d0.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-c0,sid:Xa(s0),userId:o0.uid},(u0=this.context.config.enableCloudProxy)!==null&&u0!==void 0&&u0),this.context.token=void 0,d0.t0;case 27:return d0.prev=27,this.loginPromise=void 0,d0.finish(27);case 30:Uk=!1;case 31:case"end":return d0.stop()}},i0,this,[[17,22,27,30]])}));return function(i0){return r0.apply(this,arguments)}}()},{key:"logout",value:function(){var r0=J(w.mark(function i0(){var o0;return w.wrap(function(s0){for(;;)switch(s0.prev=s0.next){case 0:if(!this.loginPromise){s0.next=3;break}return s0.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){s0.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){s0.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),s0.abrupt("return");case 10:if(this.session!==void 0){s0.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),s0.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(o0=this.context.config.enableCloudProxy)!==null&&o0!==void 0&&o0),s0.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return s0.stop()}},i0,this)}));return function(){return r0.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var r0,i0=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(r0=this.context.config.enableCloudProxy)!==null&&r0!==void 0&&r0),this.session.logoutHandler().then(function(){i0.log("Log out success")})),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var r0=J(w.mark(function i0(o0,s0){var a0,c0,u0,l0,d0,h0,p0=this,m0=arguments;return w.wrap(function(f0){for(;;)switch(f0.prev=f0.next){case 0:if(a0=2<m0.length&&m0[2]!==void 0?m0[2]:{},c0=a0.enableOfflineMessaging,u0=c0!==void 0&&c0,l0=a0.enableHistoricalMessaging,d0=l0!==void 0&&l0,Tm(o0,ve),this.connectionState!==T.RECONNECTING){f0.next=5;break}return h0=Date.now(),f0.abrupt("return",new Promise(function(g0,E0){var _0=function(){var b0=J(w.mark(function S0(){var w0;return w.wrap(function(I0){for(;;)switch(I0.prev=I0.next){case 0:if(p0.session!==void 0){I0.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return w0=Date.now()-h0,I0.prev=3,I0.t0=g0,I0.next=7,Gg({message:o0,peerId:s0,toPeer:!0,session:p0.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:w0,logger:p0.logger,options:{enableHistoricalMessaging:d0,enableOfflineMessaging:u0}});case 7:I0.t1=I0.sent,(0,I0.t0)(I0.t1),I0.next=16;break;case 11:I0.prev=11,I0.t2=I0.catch(3),Sa(I0.t2)&&E0(new db(Yd(p0.name,"sendMessageToPeer",1e4),Zk)),sa(I0.t2)&&E0(I0.t2),E0(new da("Peer-to-peer message send failure",{code:cr,originalError:I0.t2}));case 16:return I0.prev=16,clearTimeout(y0),I0.finish(16);case 19:case"end":return I0.stop()}},S0,null,[[3,11,16,19]])}));return function(){return b0.apply(this,arguments)}}();p0.internalEmitter.once("RECONNECTED",_0);var y0=setTimeout(function(){p0.internalEmitter.off("RECONNECTED",_0),E0(new db(Yd(p0.name,"sendMessageToPeer",1e4),Zk))},9e3)}));case 5:if(this.connectionState===T.CONNECTED){f0.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(this.session!==void 0){f0.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return f0.prev=9,f0.next=12,Gg({message:o0,peerId:s0,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:d0,enableOfflineMessaging:u0}});case 12:return f0.abrupt("return",f0.sent);case 15:if(f0.prev=15,f0.t0=f0.catch(9),!Sa(f0.t0)){f0.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(f0.t0)){f0.next=21;break}throw f0.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:f0.t0});case 22:case"end":return f0.stop()}},i0,this,[[9,15]])}));return function(i0,o0){return r0.apply(this,arguments)}}()},{key:"createChannel",value:function(r0){var i0=this;if(!za(r0))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:r0})[0]],Zz);return new pD(r0,function(){return i0.session},this,this.logger)}},{key:"createLocalInvitation",value:function(r0){if(!za(r0))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:r0})[0]],xc);return this.invitationManager.genLocalInvitation(r0)}},{key:"subscribePeersOnlineStatus",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0,d0,h0,p0,m0,f0,g0,E0,_0,y0=this;return w.wrap(function(b0){for(;;)switch(b0.prev=b0.next){case 0:if(this.connectionState===T.CONNECTED){b0.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){b0.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(o0)&&o0.length!==0){b0.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:s0=0;case 7:if(!(s0<o0.length)){b0.next=14;break}if(za(a0=o0[s0])){b0.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",a0],kg);case 11:s0++,b0.next=7;break;case 14:if(!(512<(c0=o0&&o0.length?vk(o0):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){b0.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return b0.next=19,this.session.requestSubscribePeersOnlineStatus(c0).toPromise();case 19:u0=b0.sent,l0=u0.errors,d0=[],h0=[],p0=0;case 24:if(!(p0<l0.length)){b0.next=32;break}if(m0=l0[p0],f0=m0.code,typeof(g0=m0.account)=="string"){b0.next=28;break}throw new da("Returned account is invalid",fr);case 28:f0!==0&&d0.push(g0);case 29:p0++,b0.next=24;break;case 32:for(E0=0;E0<c0.length;E0++)_0=c0[E0],d0.includes(_0)||(h0.push(_0),this.subscribedPeerStatusCache[_0]=void 0);if(this.session.requestPeersOnlineStatus(h0).pipe(ba(function(S0){return uc(Jk(S0.userInfos,"account"),function(w0){return!!w0.ts})})).subscribe(function(S0){S0=uc(S0,function(w0,I0){return w0=w0?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,y0.subscribedPeerStatusCache[I0]=w0}),y0.emit("PeersOnlineStatusChanged",S0)}),d0.length===0){b0.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return b0.stop()}},i0,this)}));return function(i0){return r0.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0;return w.wrap(function(d0){for(;;)switch(d0.prev=d0.next){case 0:if(this.connectionState===T.CONNECTED){d0.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){d0.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(o0)&&o0.length!==0){d0.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:s0=0;case 7:if(!(s0<o0.length)){d0.next=14;break}if(za(a0=o0[s0])){d0.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",a0],kg);case 11:s0++,d0.next=7;break;case 14:if(!(512<o0.length)){d0.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(c0=o0&&o0.length?vk(o0):[],this.session.requestUnsubscribePeersOnlineStatus(c0),u0=0;u0<c0.length;u0++)l0=c0[u0],delete this.subscribedPeerStatusCache[l0];case 19:case"end":return d0.stop()}},i0,this)}));return function(i0){return r0.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var r0=J(w.mark(function i0(o0){return w.wrap(function(s0){for(;;)switch(s0.prev=s0.next){case 0:if(this.connectionState===T.CONNECTED){s0.next=2;break}throw new K("The client is not logged in",bl);case 2:if(o0!==S.PeerSubscriptionOption.ONLINE_STATUS){s0.next=4;break}return s0.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return s0.stop()}},i0,this)}));return function(i0){return r0.apply(this,arguments)}}()},{key:"createMessage",value:function(r0){return r0.messageType==="IMAGE"?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},r0):r0.messageType==="FILE"?ua({fileName:"",description:"",thumbnail:new Blob,size:0},r0):r0}},{key:"downloadMedia",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0,d0,h0,p0,m0,f0,g0,E0,_0,y0,b0=this,S0=arguments;return w.wrap(function(w0){for(;;)switch(w0.prev=w0.next){case 0:if(s0=1<S0.length&&S0[1]!==void 0?S0[1]:{},typeof o0=="string"){w0.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(w0.prev=3,a0=o0.split("z"),c0=ra(a0,3),u0=c0[0],l0=c0[1],d0=c0[2],h0=u0.slice(1,65),p0=bD(h0),m0=parseInt(u0.slice(65),10),f0=parseInt(l0,10),g0=parseInt(d0,10),!(Number.isNaN(m0)||Number.isNaN(f0)||Number.isNaN(g0))){w0.next=12;break}throw new I("Invalid mediaId content",cl);case 12:w0.next=19;break;case 14:if(w0.prev=14,w0.t0=w0.catch(3),!sa(w0.t0)){w0.next=18;break}throw w0.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:w0.t0});case 19:if(this.connectionState===T.CONNECTED){w0.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(this.session!==void 0){w0.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return E0=this.mediaTaskManager.addDownloadTask({unit:f0,zone:m0,hashHexStr:h0,size:g0},function(){if(b0.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return b0.session.requestFileDownloadIndexGet({hash:p0,zone:m0,unit:f0,size:g0}).toPromise()},s0),w0.next=26,this.mediaTaskManager.waitMediaTask(E0);case 26:return _0=w0.sent,y0=_0.payload,w0.abrupt("return",y0);case 29:case"end":return w0.stop()}},i0,this,[[3,14]])}));return function(i0){return r0.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0,d0,h0,p0,m0,f0,g0,E0,_0,y0,b0,S0,w0,I0,L0,M0,C0,U0,x0,j0,k0=this,D0=arguments;return w.wrap(function($0){for(;;)switch($0.prev=$0.next){case 0:if(s0=1<D0.length&&D0[1]!==void 0?D0[1]:{},a0=2<D0.length&&D0[2]!==void 0?D0[2]:{},yd(s0)){$0.next=4;break}throw new I("Invalid params",wf);case 4:if(c0="thumbnailWidth"in s0||"thumbnailHeight"in s0||"width"in s0||"height"in s0,u0=s0.messageType,l0=u0===void 0?c0?"IMAGE":"FILE":u0,d0=s0.description,h0=d0===void 0?"":d0,p0=s0.fileName,m0=p0===void 0?"":p0,f0=s0.thumbnail,typeof s0.messageType=="string"&&typeof h0=="string"&&typeof m0=="string"&&(Pm(f0)||f0===void 0)&&Pm(o0)){$0.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!c0||l0!=="FILE"){$0.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(g0=o0.size))){$0.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return $0.next=15,Ji(o0);case 15:return E0=$0.sent,$0.next=18,aD(E0);case 18:if(_0=$0.sent,this.connectionState===T.CONNECTED){$0.next=21;break}throw new K("The client is not logged in",yA);case 21:if(l0!=="IMAGE"){$0.next=29;break}return $0.next=24,Xt(s0,E0);case 24:y0=$0.sent,b0=y0.height,S0=y0.width,w0=y0.thumbnailWidth,I0=y0.thumbnailHeight;case 29:return L0=this.mediaTaskManager.addUploadTask({file:new Uint8Array(E0),hash:_0},function(){if(k0.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return k0.session.fetchFileUploadIndexGet({hash:_0,size:g0})},function(N0,A0){if(k0.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return k0.session.requestFileUploadIndexSet({hash:_0,unit:N0,servers:A0}).toPromise()},a0),$0.next=32,this.mediaTaskManager.waitMediaTask(L0);case 32:if(M0=$0.sent,C0=M0.zone,U0=M0.retUnit,l0!=="IMAGE"){$0.next=38;break}return x0={height:b0,width:S0,fileName:m0,size:g0,description:h0,thumbnail:f0,messageType:l0,thumbnailWidth:w0,thumbnailHeight:I0,mediaId:"0".concat($r(_0)).concat(C0,"z").concat(U0,"z").concat(g0,"z").concat(b0,"z").concat(S0)},$0.abrupt("return",x0);case 38:return j0={fileName:m0,size:g0,description:h0,mediaId:"0".concat($r(_0)).concat(C0,"z").concat(U0,"z").concat(g0),thumbnail:f0,messageType:l0},$0.abrupt("return",j0);case 40:case"end":return $0.stop()}},i0,this)}));return function(i0){return r0.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var r0=J(w.mark(function i0(o0){var s0,a0,c0,u0,l0=this;return w.wrap(function(d0){for(;;)switch(d0.prev=d0.next){case 0:if(s0=o0.uid,a0=o0.instanceId,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){d0.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){d0.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:d0.prev=6,this.context.uid=s0,d0.next=13;break;case 10:throw d0.prev=10,d0.t0=d0.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:s0})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=c0=new ls(this.context,new Yr(this.context,this.logger,!1),a0,this.logger),u0=function(){l0.connectionState===T.CONNECTED&&(l0.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),l0.session)&&l0.session.once("userJoined",function(){l0.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)})},c0.on("connectionLost",u0),c0.on("tokenExpired",function(){l0.emit("TokenExpired")}),c0.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(h0){l0.emit("MessageFromPeer",{text:h0.text,messageType:S.MessageType.TEXT},h0.peerId,h0.properties)}),this.session.on("peerMediaMessage",function(h0){var p0=h0.peerId,m0=h0.properties,f0=h0.messageType;h0=h0.details,f0==="FILE"?l0.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(h0.media_size),10),description:pa(h0.media_description),fileName:pa(h0.media_filename),mediaId:pa(h0.media_id),thumbnail:new Blob([h0.media_thumbnail])},p0,m0):f0==="IMAGE"&&l0.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(h0.media_size),10),description:pa(h0.media_description),fileName:pa(h0.media_filename),mediaId:pa(h0.media_id),thumbnail:new Blob([h0.media_thumbnail]),height:parseInt(pa(h0.media_height),10),width:parseInt(pa(h0.media_width),10),thumbnailHeight:parseInt(pa(h0.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(h0.media_thumbnailwidth),10)},p0,m0)}),this.session.on("peerRawMessage",function(h0){l0.emit("MessageFromPeer",{rawMessage:h0.raw,description:h0.desc,messageType:S.MessageType.RAW},h0.peerId,h0.properties)}),c0.on("instanceChanged",function(h0){return a0=h0}),c0.on("peerOnlineStatusChanged",function(h0){var p0=h0.instance.toString()+h0.state,m0=l0.peerStatusSeqLru.get(p0);!m0||h0.seq.greaterThan(m0)?(l0.peerStatusSeqLru.set(p0,h0.seq),h0.state!==l0.subscribedPeerStatusCache[h0.peerId]&&l0.emit("PeersOnlineStatusChanged",m({},h0.peerId,h0.state)),l0.subscribedPeerStatusCache[h0.peerId]=h0.state,clearTimeout(l0.peerUnreachableTimers[p0]),h0.state===S.PeerOnlineState.UNREACHABLE&&(l0.peerUnreachableTimers[p0]=setTimeout(function(){l0.subscribedPeerStatusCache[h0.peerId]===S.PeerOnlineState.UNREACHABLE&&(l0.subscribedPeerStatusCache[h0.peerId]=S.PeerOnlineState.ONLINE,l0.emit("PeersOnlineStatusChanged",m({},h0.peerId,S.PeerOnlineState.ONLINE)))},3e4))):l0.log("peerOnlineStatusChanged dedup for %s, %d",p0,h0.seq.toNumber())}),c0.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),c0.on("channelAttributesUpdated",function(h0){var p0=h0.channelId;h0=h0.attributeMaps;for(var m0={},f0=0;f0<h0.length;f0++){var g0=h0[f0],E0=g0.key,_0=g0.ms,y0=g0.value;if(g0=g0.origin,typeof E0!="string"||!U.isLong(_0)||typeof y0!="string"||!za(g0))break;m0[E0]=new Blob([y0]).size}l0.channelAttributesCacheLru.set(p0,m0)}),c0.on("userJoined",function(h0){if(Object.keys(l0.attributes).length!==0){if(l0.session===void 0)return;l0.session.requestSetLocalUserAttributes(l0.attributes,h0).toPromise()}if(l0.attributeDrafts.size!==0)for(var p0=function(g0,E0){var _0=(g0=E0[g0]).attribute;g0.promise.then(function(){l0.session!==void 0&&l0.session.requestSetLocalUserAttributes(_0,h0).toPromise()})},m0=0,f0=Array.from(l0.attributeDrafts);m0<f0.length;m0++)p0(m0,f0);Object.keys(l0.subscribedPeerStatusCache).length!==0&&c0.requestSubscribePeersOnlineStatus(Object.keys(l0.subscribedPeerStatusCache))}),this.lastLoginTime=Date.now(),d0.prev=29,d0.next=32,c0.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:c0.connection.curOpenSockets.filter(function(h0){return h0!==void 0})[0].ticket,instance:c0.instanceId,useNewDomain:.5<=Math.random(),loginOpt:c0.userJoinOptions.toLong()}),d0.next=44;break;case 35:if(d0.prev=35,d0.t1=d0.catch(29),!Sa(d0.t1)){d0.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(d0.t1)){d0.next=43;break}throw d0.t1;case 43:throw new da("Login failure",{code:Zq,originalError:d0.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return d0.stop()}},i0,this,[[6,10],[29,35]])}));return function(i0){return r0.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(r0,i0){var o0,s0=this;r0===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[r0],oldState:os[this.connectionState],reason:qD[i0],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(o0=this.context.config.enableCloudProxy)!==null&&o0!==void 0&&o0),this.connectionState===T.RECONNECTING&&r0===T.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba(function(a0){return uc(Jk(a0.userInfos,"account"),function(c0){return!!c0.ts})})).subscribe(function(a0){a0=uc(a0,function(c0,u0){return c0=c0?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,s0.subscribedPeerStatusCache[u0]=c0}),s0.emit("PeersOnlineStatusChanged",a0)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=r0,r0!==T.ABORTED&&r0!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",r0),this.emit("ConnectionStateChanged",r0,i0)}}]),e0}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(t0){var e0=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},n0=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(t0))throw new I(["The %s in the arguments is invalid",Object.keys({appId:t0})[0]],Nq);var r0=Object.keys(e0).filter(function(l0){return!(l0 in qs)});if(r0.length!==0)throw new I("Invalid RTM config: ".concat(r0.join(", ")),Nq);var i0=ua(ua({},qs),e0);if(n0!==void 0&&(!Array.isArray(n0)||n0.length===0))throw new I("Invalid area config");if(n0!=null){if(!n0.every(function(l0){return l0 in S.LegacyAreaCode}))throw new I("Invalid area codes: ".concat(n0.filter(function(l0){return!(l0 in S)}).join(", ")));M=xe(n0.map(function(l0){return zC[l0]}))}n0=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var o0=DC(i0);r0=EC(i0);var s0=FC(i0),a0=GC(n0,i0),c0=Tr(n0,i0),u0=c0("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=i0,o0("The Agora RTM Web SDK version is %s","1.4.3-203"),e0.enableCloudProxy&&o0("RTM cloud proxy enabled"),e0.enableLogUpload&&o0("Log upload enabled"),M&&u0("Area is set to %s",Array.from(M.CODES).map(function(l0){return xf(F).find(function(d0){return F[d0]===l0})}).join(", ")),u0("Creating an RtmClient instance"),u0('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),u0("The App ID is %s",Um(t0,4,10,"*".repeat(6))),o0("The process ID is %s",gg),u0("The build is %s","v1.4.3-17-g1e27aa38"),u0("NODE_ENV is %s","production"),new rD(t0,{genLogger:c0,genTracker:a0,info:o0,warn:r0,logError:s0,loggerId:n0},i0,function(l0){for(var d0=0,h0=xf(l0);d0<h0.length;d0++){var p0=h0[d0];try{var m0=l0[p0];m0!=null&&(l0.enableCloudProxy&&o0("RTM cloud proxy enabled"),l0.enableLogUpload&&o0("Log upload enabled"),i0[p0]=m0)}catch{throw new I(["The %s in the arguments is invalid",p0],void 0)}}})},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(t0,e0){Object.keys(Nc).includes(t0)&&(Nc[t0]=e0)},getParameter:function(t0){return Nc[t0]},setArea:function(t0){var e0=t0.areaCodes;if(t0=t0.excludedArea,!Array.isArray(e0)||e0.length===0||!e0.every(function(n0){return n0 in S.AreaCode}))throw new I("Invalid area config");if(t0!==void 0&&t0===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(t0===void 0)M=xe(e0.map(function(n0){return F[n0]}));else{if(e0.includes(t0))throw new I("Excluded area cannot be in areaCodes");if(!(t0 in F))throw new I("Invalid excludedArea:",t0);M=bu({areas:e0.map(function(n0){return F[n0]}),excludedArea:F[t0]})}}});return Zd})})(agoraRtmSdk$1,agoraRtmSdk$1.exports);var agoraRtmSdkExports=agoraRtmSdk$1.exports;const AgoraRTM__default=getDefaultExportFromCjs(agoraRtmSdkExports);var createClient=function t0(e0,n0,r0){var i0;function o0(){return i0||(i0=AgoraRTM__default.createInstance(e0,n0,r0)),i0}return function(){return o0()}},createChannel=function t0(e0){var n0;function r0(i0){return n0||(n0=i0.createChannel(e0)),n0}return function(i0){return r0(i0)}},createLazyClient=function t0(){var e0;function n0(r0,i0,o0){return e0||(e0=AgoraRTM__default.createInstance(r0,i0,o0)),e0}return function(r0,i0,o0){return n0(r0,i0,o0)}},createLazyChannel=function t0(){var e0;function n0(r0,i0){return e0||(e0=r0.createChannel(i0)),e0}return function(r0,i0){return n0(r0,i0)}},AreaCode;(function(t0){t0.GLOBAL="GLOBAL",t0.INDIA="INDIA",t0.JAPAN="JAPAN",t0.ASIA="ASIA",t0.EUROPE="EUROPE",t0.CHINA="CHINA",t0.NORTH_AMERICA="NORTH_AMERICA"})(AreaCode||(AreaCode={}));function _extends(){return _extends=Object.assign||function(t0){for(var e0=1;e0<arguments.length;e0++){var n0=arguments[e0];for(var r0 in n0)Object.prototype.hasOwnProperty.call(n0,r0)&&(t0[r0]=n0[r0])}return t0},_extends.apply(this,arguments)}const _iteratorSymbol=typeof Symbol<"u"?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator",_asyncIteratorSymbol=typeof Symbol<"u"?Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")):"@@asyncIterator";function _catch(t0,e0){try{var n0=t0()}catch(r0){return e0(r0)}return n0&&n0.then?n0.then(void 0,e0):n0}var RtcContext=React.createContext({}),RtcProvider=RtcContext.Provider,RtcConsumer=RtcContext.Consumer,remoteTrackState;(function(t0){t0[t0.yes=0]="yes",t0[t0.subbed=1]="subbed",t0[t0.no=2]="no"})(remoteTrackState||(remoteTrackState={}));var layout;(function(t0){t0[t0.grid=0]="grid",t0[t0.pin=1]="pin"})(layout||(layout={}));var ToggleState;(function(t0){t0[t0.disabled=0]="disabled",t0[t0.enabled=1]="enabled",t0[t0.disabling=2]="disabling",t0[t0.enabling=3]="enabling"})(ToggleState||(ToggleState={}));var initialValue={rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}},PropsContext=React.createContext(initialValue),PropsProvider=PropsContext.Provider,MaxUidContext=React.createContext([]),MaxUidProvider=MaxUidContext.Provider,MaxUidConsumer=MaxUidContext.Consumer,MinUidContext=React.createContext([]),MinUidProvider=MinUidContext.Provider,MinUidConsumer=MinUidContext.Consumer,TracksContext=React.createContext({}),TracksProvider=TracksContext.Provider,initState={max:[{uid:0,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}],min:[],isScreensharing:!1},reducer=function t0(e0,n0){var r0=initState,i0=[].concat(e0.max,e0.min).map(function(u0){return u0.uid});switch(n0.type){case"Screensharing":r0=_extends({},e0,{isScreensharing:n0.value[0]}),console.log("!Screensharingstate",e0,r0);break;case"update-user-video":r0={min:e0.min.map(function(u0){return u0.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:u0}),max:e0.max.map(function(u0){return u0.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:u0}),isScreensharing:e0.isScreensharing};break;case"user-joined":if(i0.indexOf(n0.value[0].uid)===-1){var o0=[].concat(e0.min,[{uid:n0.value[0].uid,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}]);o0.length===1&&e0.max[0].uid===0?r0={max:o0,min:e0.max,isScreensharing:e0.isScreensharing}:r0={min:o0,max:e0.max,isScreensharing:e0.isScreensharing}}break;case"user-unpublished":if(e0.max[0].uid===n0.value[0].uid)r0={max:[{uid:n0.value[0].uid,hasAudio:n0.value[1]==="audio"?remoteTrackState.no:e0.max[0].hasAudio,hasVideo:n0.value[1]==="video"?remoteTrackState.no:e0.max[0].hasVideo}],min:e0.min,isScreensharing:e0.isScreensharing};else{var s0=e0.min.find(function(u0){return u0.uid===n0.value[0].uid});if(s0){var a0=[].concat(e0.min.filter(function(u0){return u0.uid!==n0.value[0].uid}),[{uid:n0.value[0].uid,hasAudio:n0.value[1]==="audio"?remoteTrackState.no:s0.hasAudio,hasVideo:n0.value[1]==="video"?remoteTrackState.no:s0.hasVideo}]);r0={min:a0,max:e0.max,isScreensharing:e0.isScreensharing}}}break;case"user-published":e0.max[0].uid===n0.value[0].uid?r0={max:[{uid:n0.value[0].uid,hasAudio:n0.value[1]==="audio"?remoteTrackState.subbed:e0.max[0].hasAudio,hasVideo:n0.value[1]==="video"?remoteTrackState.subbed:e0.max[0].hasVideo}],min:e0.min,isScreensharing:e0.isScreensharing}:r0={min:e0.min.map(function(u0){return u0.uid!==n0.value[0].uid?u0:{uid:u0.uid,hasAudio:n0.value[1]==="audio"?remoteTrackState.subbed:u0.hasAudio,hasVideo:n0.value[1]==="video"?remoteTrackState.subbed:u0.hasVideo}}),max:e0.max,isScreensharing:e0.isScreensharing};break;case"user-left":if(e0.max[0].uid===n0.value[0].uid){var c0=[].concat(e0.min);r0={max:[c0.pop()],min:c0,isScreensharing:e0.isScreensharing}}else r0={min:e0.min.filter(function(u0){return u0.uid!==n0.value[0].uid}),max:e0.max,isScreensharing:e0.isScreensharing};break;case"user-swap":e0.max[0].uid===n0.value[0].uid||(r0={max:[n0.value[0]],min:[].concat(e0.min.filter(function(u0){return u0.uid!==n0.value[0].uid}),[e0.max[0]]),isScreensharing:e0.isScreensharing});break;case"local-user-mute-video":r0={min:e0.min.map(function(u0){return u0.uid===0?{uid:0,hasAudio:u0.hasAudio,hasVideo:n0.value[0]}:u0}),max:e0.max.map(function(u0){return u0.uid===0?{uid:0,hasAudio:u0.hasAudio,hasVideo:n0.value[0]}:u0}),isScreensharing:e0.isScreensharing};break;case"local-user-mute-audio":r0={min:e0.min.map(function(u0){return u0.uid===0?{uid:0,hasAudio:n0.value[0],hasVideo:u0.hasVideo}:u0}),max:e0.max.map(function(u0){return u0.uid===0?{uid:0,hasAudio:n0.value[0],hasVideo:u0.hasVideo}:u0}),isScreensharing:e0.isScreensharing};break;case"remote-user-mute-video":r0={min:e0.min.map(function(u0){return u0.uid===n0.value[0].uid?{uid:u0.uid,hasVideo:n0.value[1],hasAudio:u0.hasAudio}:u0}),max:e0.max.map(function(u0){return u0.uid===n0.value[0].uid?{uid:u0.uid,hasVideo:n0.value[1],hasAudio:u0.hasAudio}:u0}),isScreensharing:e0.isScreensharing};break;case"remote-user-mute-audio":r0={min:e0.min.map(function(u0){return u0.uid===n0.value[0].uid?{uid:u0.uid,hasAudio:n0.value[1],hasVideo:u0.hasVideo}:u0}),max:e0.max.map(function(u0){return u0.uid===n0.value[0].uid?{uid:u0.uid,hasAudio:n0.value[1],hasVideo:u0.hasVideo}:u0}),isScreensharing:e0.isScreensharing};break;case"leave-channel":r0=initState;break;case"ActiveSpeaker":e0.max[0].uid===n0.value[0]?r0=_extends({},e0):r0={max:[e0.min.find(function(u0){return u0.uid===n0.value[0]})],min:[].concat(e0.min.filter(function(u0){return u0.uid!==n0.value[0]}),[e0.max[0]]),isScreensharing:e0.isScreensharing};break}return console.log("!state-update",_extends({},e0,r0),r0),_extends({},e0,r0)},startScreenshare=function t0(e0,n0,r0,i0,o0,s0,a0){try{var c0=function(){try{try{console.log(d0),s0&&(d0.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(s0+"/rtc/"+n0+"/publisher/uid/"+p0+"/")).then(function(E0){return Promise.resolve(E0.json()).then(function(_0){var y0=_0.rtcToken;d0.renewToken(y0)})})}catch(E0){return Promise.reject(E0)}}),d0.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(s0+"/rtc/"+n0+"/publisher/uid/"+p0+"/")).then(function(E0){return Promise.resolve(E0.json()).then(function(_0){var y0=_0.rtcToken;d0.renewToken(y0)})})}catch(E0){return Promise.reject(E0)}})),r0.on("track-ended",function(){d0.leave(),d0.removeAllListeners()})}catch(E0){console.log(E0)}return Promise.resolve()}catch(E0){return Promise.reject(E0)}},u0=function(){try{d0.setClientRole("host");var E0=function(){if(s0){var _0=_catch(function(){return Promise.resolve(fetch(s0+"/rtc/"+n0+"/publisher/uid/"+p0+"/")).then(function(y0){return Promise.resolve(y0.json()).then(function(b0){var S0=b0.rtcToken;return Promise.resolve(d0.join(e0,n0,S0,p0)).then(function(w0){h0=w0})})})},function(y0){console.log(y0)});if(_0&&_0.then)return _0.then(function(){})}else return Promise.resolve(d0.join(e0,n0,i0||null,p0||0)).then(function(y0){h0=y0})}();return Promise.resolve(E0&&E0.then?E0.then(function(){}):void 0)}catch(_0){return Promise.reject(_0)}},l0=function(){try{var E0=function(){var b0=function(){if(r0.enabled){var S0=function(){if(!m0)return Promise.resolve(d0.publish([r0]).then(function(){m0=!0})).then(function(){})}();if(S0&&S0.then)return S0.then(function(){})}}();if(b0&&b0.then)return b0.then(function(){})},_0=function(){if(a0)return Promise.resolve(d0.enableDualStream()).then(function(){})}();return Promise.resolve(_0&&_0.then?_0.then(E0):E0(_0))}catch(y0){return Promise.reject(y0)}},d0=nq.createClient({mode:"live",role:"host",codec:"vp8"}),h0=0,p0=o0||1,m0=!1,f0=function(){try{var E0=_catch(function(){return r0.close(),Promise.resolve(d0.leave()).then(function(){d0.removeAllListeners()})},function(_0){console.log(_0)});return Promise.resolve(E0&&E0.then?E0.then(function(){}):void 0)}catch(_0){return Promise.reject(_0)}};return stopScreenshare=f0,Promise.resolve(c0()).then(function(){return Promise.resolve(u0()).then(function(){return Promise.resolve(l0()).then(function(){h0&&console.log(h0)})})})}catch(g0){return Promise.reject(g0)}},stopScreenshare=function t0(){},useClient=createClient$1({codec:"vp8",mode:"live"}),RtcConfigure=function t0(e0){var n0=reactExports.useRef(),r0=reactExports.useRef(),i0=reactExports.useRef(!1),o0=reactExports.useContext(TracksContext),s0=o0.localVideoTrack,a0=o0.localAudioTrack,c0=reactExports.useContext(PropsContext),u0=c0.callbacks,l0=c0.rtcProps,d0=reactExports.useState(!1),h0=d0[0],p0=d0[1],m0=reactExports.useState(!1),f0=m0[0],g0=m0[1],E0=null,_0=reactExports.useRef(new Promise(function(x0,j0){E0=x0,console.log(j0)})),y0=useClient();l0.customRtcClient&&(y0.removeAllListeners(),y0=l0.customRtcClient);var b0=!1,S0=!1,w0=reactExports.useRef({}),I0=e0.callActive;I0===void 0&&(I0=!0);var L0=reactExports.useReducer(reducer,initState),M0=L0[0],C0=L0[1];reactExports.useEffect(function(){var x0=function(){try{try{if(console.log(y0),y0.on("user-joined",function(){try{for(var A0=arguments.length,P0=new Array(A0),O0=0;O0<A0;O0++)P0[O0]=arguments[O0];var v0=P0[0];return v0.uid===e0.screenshareUid&&i0.current||v0.uid===1&&i0.current||(w0.current[v0.uid]={}),C0({type:"user-joined",value:P0}),Promise.resolve()}catch(R0){return Promise.reject(R0)}}),y0.on("user-published",function(){for(var A0=arguments.length,P0=new Array(A0),O0=0;O0<A0;O0++)P0[O0]=arguments[O0];try{var v0=P0[0],R0=P0[1];return console.log("user-published",v0.uid),v0.uid===e0.screenshareUid&&i0.current||v0.uid===1&&i0.current?C0({type:"user-published",value:P0}):y0.subscribe(v0,R0).then(function(T0){if(w0.current[v0.uid][R0+"Track"]=v0[R0+"Track"],R0==="audio"){var F0;(F0=v0.audioTrack)===null||F0===void 0||F0.play()}else l0.enableDualStream&&l0.dualStreamMode&&y0.setStreamFallbackOption(v0.uid,l0.dualStreamMode);C0({type:"user-published",value:P0})}).catch(function(T0){return console.log(T0)}),Promise.resolve()}catch(T0){return Promise.reject(T0)}}),y0.on("user-unpublished",function(){try{for(var A0=arguments.length,P0=new Array(A0),O0=0;O0<A0;O0++)P0[O0]=arguments[O0];var v0=P0[0],R0=P0[1];if(console.log("user-unpublished",v0.uid),R0==="audio"){var T0;(T0=v0.audioTrack)===null||T0===void 0||T0.stop()}return C0({type:"user-unpublished",value:P0}),Promise.resolve()}catch(F0){return Promise.reject(F0)}}),y0.on("connection-state-change",function(){try{for(var A0=arguments.length,P0=new Array(A0),O0=0;O0<A0;O0++)P0[O0]=arguments[O0];var v0=P0[0],R0=P0[1],T0=P0[2];if(console.log("connection",R0,v0,T0),v0==="CONNECTED")g0(!0);else if(v0==="DISCONNECTED"){try{stopScreenshare(),i0.current=!1}catch(F0){console.log("stopscreenshare",F0)}C0({type:"leave-channel",value:null})}else g0(!1);return Promise.resolve()}catch(F0){return Promise.reject(F0)}}),y0.on("user-left",function(){for(var A0=arguments.length,P0=new Array(A0),O0=0;O0<A0;O0++)P0[O0]=arguments[O0];C0({type:"user-left",value:P0})}),l0.tokenUrl){var k0=l0.tokenUrl,D0=l0.channel,$0=l0.uid;y0.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(k0+"/rtc/"+D0+"/publisher/uid/"+($0||0)+"/")).then(function(A0){return Promise.resolve(A0.json()).then(function(P0){var O0=P0.rtcToken;y0.renewToken(O0)})})}catch(A0){return Promise.reject(A0)}}),y0.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(k0+"/rtc/"+D0+"/publisher/uid/"+($0||0)+"/")).then(function(A0){return Promise.resolve(A0.json()).then(function(P0){var O0=P0.rtcToken;y0.renewToken(O0)})})}catch(A0){return Promise.reject(A0)}})}if(u0){var N0=Object.keys(u0);N0.map(function(A0){try{y0.on(A0,function(){for(var P0=arguments.length,O0=new Array(P0),v0=0;v0<P0;v0++)O0[v0]=arguments[v0];u0[A0].apply(null,O0)})}catch(P0){console.log(P0)}})}E0(!0),p0(!0)}catch(A0){console.log("!!!",A0)}return Promise.resolve()}catch(A0){return Promise.reject(A0)}};return E0?(x0(),function(){try{y0.removeAllListeners()}catch(j0){console.log(j0)}}):function(){}},[l0.appId]),reactExports.useEffect(function(){var x0=function(){try{return Promise.resolve(_0.current).then(function(){var D0=l0.tokenUrl,$0=l0.channel,N0=l0.uid,A0=l0.appId,P0=l0.token,O0=function(){if(y0&&!j0){l0.role==="audience"?y0.setClientRole(l0.role):y0.setClientRole("host");var v0=function(){if(D0){var R0=_catch(function(){return Promise.resolve(fetch(D0+"/rtc/"+$0+"/publisher/uid/"+(N0||0)+"/")).then(function(T0){return Promise.resolve(T0.json()).then(function(F0){var V0=F0.rtcToken;return Promise.resolve(y0.join(A0,$0,V0,N0||0)).then(function(H0){n0.current=H0})})})},function(T0){console.log(T0)});if(R0&&R0.then)return R0.then(function(){})}else return Promise.resolve(y0.join(A0,$0,P0||null,N0||0)).then(function(T0){n0.current=T0})}();if(v0&&v0.then)return v0.then(function(){})}else console.error("trying to join before RTC Engine was initialized")}();if(O0&&O0.then)return O0.then(function(){})})}catch(D0){return Promise.reject(D0)}},j0=!1;return I0?(x0(),console.log("Attempted join: ",l0.channel)):console.log("In precall - waiting to join"),function(){if(j0=!0,I0){console.log("Leaving channel");try{stopScreenshare(),i0.current=!1}catch(k0){console.log(k0)}_0.current=y0.leave().catch(function(k0){return console.log(k0)})}}},[l0.channel,l0.uid,I0,l0.tokenUrl]),reactExports.useEffect(function(){var x0=function(){try{var k0=function(){function N0(){var P0=function(){if(s0!=null&&s0.enabled&&f0){var O0=function(){if(!b0)return Promise.resolve(y0.publish([s0]).then(function(){b0=!0})).then(function(){})}();if(O0&&O0.then)return O0.then(function(){})}}();if(P0&&P0.then)return P0.then(function(){})}var A0=function(){if(a0!=null&&a0.enabled&&f0){var P0=function(){if(!S0)return Promise.resolve(y0.publish([a0]).then(function(){S0=!0})).then(function(){})}();if(P0&&P0.then)return P0.then(function(){})}}();return A0&&A0.then?A0.then(N0):N0(A0)},D0=function(){if(l0.enableDualStream)return Promise.resolve(y0.enableDualStream()).then(function(){})}();return Promise.resolve(D0&&D0.then?D0.then(k0):k0(D0))}catch($0){return Promise.reject($0)}};console.log("Publish",s0,a0,I0),I0&&x0()},[I0,s0==null?void 0:s0.enabled,a0==null?void 0:a0.enabled,f0]),reactExports.useEffect(function(){s0&&a0!==null&&(w0.current[0]={audioTrack:a0,videoTrack:s0},C0({type:"update-user-video",value:[a0,s0]}))},[l0.channel,f0]),reactExports.useEffect(function(){f0&&l0.token&&y0.renewToken(l0.token).then(function(x0){return console.log("renewed token",x0)})},[l0.token,f0]),reactExports.useEffect(function(){l0.role&&y0.setClientRole(l0.role).then(function(x0){return console.log("changed role",x0)})},[l0.role,f0]),reactExports.useEffect(function(){var x0=function(){try{var k0=function(){if(l0.activeSpeaker&&l0.layout!==layout.grid)return y0.on("volume-indicator",function(D0){var $0=D0.reduce(function(P0,O0){return P0===null||O0.level>P0.level?O0:P0},null),N0=$0?$0.uid:void 0,A0=N0===n0.current?0:N0;N0!==void 0&&C0({type:"ActiveSpeaker",value:[A0]})}),Promise.resolve(y0.enableAudioVolumeIndicator()).then(function(){})}();return Promise.resolve(k0&&k0.then?k0.then(function(){}):void 0)}catch(D0){return Promise.reject(D0)}};return I0&&x0(),function(){y0.removeAllListeners("volume-indicator")}},[l0.activeSpeaker,l0.layout]);var U0=function(){try{var j0=function(){try{return C0({type:"Screensharing",value:[!0]}),Promise.resolve(nq.createScreenVideoTrack({},"disable")).then(function($0){r0.current=$0;var N0=l0.screenshareUid||1;return w0.current[N0]={videoTrack:r0.current},r0.current.on("track-ended",function(){i0.current=!1,C0({type:"Screensharing",value:[!1]})}),i0.current=!0,Promise.resolve(startScreenshare(l0.appId,l0.channel,r0.current,l0.screenshareToken,l0.screenshareUid,l0.tokenUrl,l0.enableDualStream)).then(function(){})})}catch($0){return Promise.reject($0)}},k0=function(){stopScreenshare(),i0.current=!1};return i0.current?k0():j0(),Promise.resolve()}catch(D0){return Promise.reject(D0)}};return React.createElement(RtcProvider,{value:{client:y0,mediaStore:w0.current,localVideoTrack:s0,localAudioTrack:a0,dispatch:C0,localUid:n0,channelJoined:f0,toggleScreensharing:U0,isScreensharing:i0.current}},React.createElement(MaxUidProvider,{value:M0.max},React.createElement(MinUidProvider,{value:M0.min},h0?e0.children:null)))},icons={videocam:React.createElement(React.Fragment,null,React.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),React.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),videocamOff:React.createElement(React.Fragment,null,React.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),remoteSwap:React.createElement(React.Fragment,null,React.createElement("polyline",{points:"15 3 21 3 21 9"}),React.createElement("polyline",{points:"9 21 3 21 3 15"}),React.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),React.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),callEnd:React.createElement(React.Fragment,null,React.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),React.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),mic:React.createElement(React.Fragment,null,React.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),React.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),micOff:React.createElement(React.Fragment,null,React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),React.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),React.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),screen:React.createElement(React.Fragment,null,React.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),React.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),React.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),stop:React.createElement(React.Fragment,null,React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},BtnTemplate=function t0(e0){var n0=e0.onClick,r0=e0.name,i0=e0.disabled,o0=e0.style,s0=reactExports.useContext(PropsContext),a0=s0.styleProps,c0=a0||{},u0=c0.theme,l0=c0.BtnTemplateStyles,d0=c0.iconSize,h0=c0.customIcon;return React.createElement("div",{style:_extends({},{width:35,height:35,borderRadius:"100%",borderWidth:2,borderStyle:"solid",borderColor:"#fff",backgroundColor:"rgba(0,80,180,0.2)",alignItems:"center",justifyContent:"center",display:"flex",cursor:i0?"auto":"pointer",margin:4},l0,o0),onClick:n0},h0?React.createElement("img",{src:h0[r0],alt:r0}):React.createElement("svg",{style:{width:d0||24,height:d0||24},xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",opacity:i0?"0.5":"1",stroke:u0||"#fff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},icons[r0]))};function EndCall(){var t0=reactExports.useContext(PropsContext),e0=t0.styleProps,n0=t0.callbacks,r0=e0||{},i0=r0.localBtnStyles,o0=i0||{},s0=o0.endCall;return React.createElement(BtnTemplate,{style:s0||{backgroundColor:"#ef5588",borderColor:"#f00"},name:"callEnd",onClick:function(){return(n0==null?void 0:n0.EndCall)&&n0.EndCall()}})}var LocalContext=reactExports.createContext({}),LocalUserContext=function t0(e0){var n0=reactExports.useContext(MaxUidContext),r0=reactExports.useContext(MinUidContext),i0;return n0[0].uid===0?i0=n0[0]:i0=r0.find(function(o0){return o0.uid===0}),React.createElement(LocalContext.Provider,{value:i0},e0.children)},muteAudio=function(t0,e0,n0,r0){try{var i0=function(){if(t0.uid===0){var o0=t0.hasAudio,s0=function(){if(o0===ToggleState.enabled||o0===ToggleState.disabled){var a0=o0===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;e0({type:"local-user-mute-audio",value:[a0]}),r0&&r0["local-user-mute-audio"]&&r0["local-user-mute-audio"](a0);var c0=_catch(function(){return Promise.resolve(n0==null?void 0:n0.setEnabled(o0!==ToggleState.enabled)).then(function(){a0=o0===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,r0&&r0["local-user-mute-audio"]&&r0["local-user-mute-audio"](a0),e0({type:"local-user-mute-audio",value:[o0===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled]})})},function(){e0({type:"local-user-mute-audio",value:[o0]})});if(c0&&c0.then)return c0.then(function(){})}}();if(s0&&s0.then)return s0.then(function(){})}}();return Promise.resolve(i0&&i0.then?i0.then(function(){}):void 0)}catch(o0){return Promise.reject(o0)}};function LocalAudioMute(){var t0=reactExports.useContext(PropsContext),e0=t0.styleProps,n0=t0.callbacks,r0=e0||{},i0=r0.localBtnStyles,o0=i0||{},s0=o0.muteLocalAudio,a0=reactExports.useContext(RtcContext),c0=a0.dispatch,u0=a0.localAudioTrack,l0=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:s0,name:l0.hasAudio===ToggleState.enabled?"mic":"micOff",onClick:function(){return u0&&muteAudio(l0,c0,u0,n0)}}))}function Screenshare(){var t0=reactExports.useContext(PropsContext),e0=t0.styleProps,n0=e0||{},r0=n0.localBtnStyles,i0=r0||{},o0=i0.screenshare,s0=reactExports.useContext(RtcContext),a0=s0.toggleScreensharing,c0=s0.isScreensharing;return React.createElement("div",null,React.createElement(BtnTemplate,{style:o0,name:c0?"stop":"screen",onClick:function(){return a0()}}))}var muteVideo=function(t0,e0,n0,r0){try{var i0=function(){if(t0.uid===0){var o0=t0.hasVideo,s0=function(){if(o0===ToggleState.enabled||o0===ToggleState.disabled){var a0=o0===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;e0({type:"local-user-mute-video",value:[a0]}),r0&&r0["local-user-mute-video"]&&r0["local-user-mute-video"](a0);var c0=_catch(function(){return Promise.resolve(n0==null?void 0:n0.setEnabled(o0!==ToggleState.enabled)).then(function(){a0=o0===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,r0&&r0["local-user-mute-video"]&&r0["local-user-mute-video"](a0),e0({type:"local-user-mute-video",value:[a0]})})},function(){e0({type:"local-user-mute-video",value:[o0]})});if(c0&&c0.then)return c0.then(function(){})}}();if(s0&&s0.then)return s0.then(function(){})}}();return Promise.resolve(i0&&i0.then?i0.then(function(){}):void 0)}catch(o0){return Promise.reject(o0)}};function LocalVideoMute(){var t0=reactExports.useContext(PropsContext),e0=t0.styleProps,n0=t0.callbacks,r0=e0||{},i0=r0.localBtnStyles,o0=i0||{},s0=o0.muteLocalVideo,a0=reactExports.useContext(RtcContext),c0=a0.dispatch,u0=a0.localVideoTrack,l0=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:s0,name:l0.hasVideo===ToggleState.enabled?"videocam":"videocamOff",onClick:function(){return u0&&muteVideo(l0,c0,u0,n0)}}))}function LocalControls(){var t0=reactExports.useContext(PropsContext),e0=t0.styleProps,n0=t0.rtcProps,r0=e0||{},i0=r0.localBtnContainer;return React.createElement("div",{style:_extends({},{backgroundColor:"#007bff",width:"100%",height:70,zIndex:10,display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center"},i0)},n0.role!=="audience"&&React.createElement(LocalVideoMute,null),n0.role!=="audience"&&React.createElement(LocalAudioMute,null),n0.role!=="audience"&&n0.enableScreensharing&&React.createElement(Screenshare,null),React.createElement(EndCall,null))}var rtmStatusEnum;(function(t0){t0[t0.initFailed=0]="initFailed",t0[t0.offline=1]="offline",t0[t0.initialising=2]="initialising",t0[t0.loggingIn=3]="loggingIn",t0[t0.loggedIn=4]="loggedIn",t0[t0.connected=5]="connected",t0[t0.loginFailed=6]="loginFailed"})(rtmStatusEnum||(rtmStatusEnum={}));var clientRoleRaw;(function(t0){t0[t0.broadcaster=0]="broadcaster",t0[t0.audience=1]="audience"})(clientRoleRaw||(clientRoleRaw={}));var mutingDevice;(function(t0){t0[t0.camera=0]="camera",t0[t0.microphone=1]="microphone"})(mutingDevice||(mutingDevice={}));var popUpStateEnum;(function(t0){t0[t0.closed=0]="closed",t0[t0.muteMic=1]="muteMic",t0[t0.muteCamera=2]="muteCamera",t0[t0.unmuteMic=3]="unmuteMic",t0[t0.unmuteCamera=4]="unmuteCamera"})(popUpStateEnum||(popUpStateEnum={}));var RtmContext=reactExports.createContext(null),RtmProvider=RtmContext.Provider,RtmConsumer=RtmContext.Consumer;function RemoteVideoMute(t0){var e0=reactExports.useContext(PropsContext),n0=e0.styleProps,r0=reactExports.useContext(RtmContext),i0=r0.sendMuteRequest,o0=r0.uidMap,s0=n0||{},a0=s0.remoteBtnStyles,c0=a0||{},u0=c0.muteRemoteVideo,l0=t0.UIKitUser,d0=l0.hasVideo===remoteTrackState.no;return l0.uid!==0&&o0[l0.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{name:l0.hasVideo===remoteTrackState.subbed?"videocam":"videocamOff",style:u0,onClick:function(){return i0(mutingDevice.camera,l0.uid,!d0)}})):null}function RemoteAudioMute(t0){var e0=reactExports.useContext(PropsContext),n0=e0.styleProps,r0=n0||{},i0=r0.remoteBtnStyles,o0=reactExports.useContext(RtmContext),s0=o0.sendMuteRequest,a0=o0.uidMap,c0=i0||{},u0=c0.muteRemoteAudio,l0=t0.UIKitUser,d0=l0.hasAudio===remoteTrackState.no;return l0.uid!==0&&a0[l0.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{style:u0,name:l0.hasAudio===remoteTrackState.subbed?"mic":"micOff",onClick:function(){return s0(mutingDevice.microphone,l0.uid,!d0)}})):null}function SwapUser(t0){var e0=reactExports.useContext(RtcContext),n0=e0.dispatch,r0=t0.UIKitUser;return React.createElement("div",null,React.createElement(BtnTemplate,{name:"remoteSwap",onClick:function(){return n0({type:"user-swap",value:[r0]})}}))}var VideoPlaceholder=function t0(e0){var n0=reactExports.useContext(PropsContext),r0=n0.styleProps,i0=n0.rtcProps,o0=r0||{},s0=o0.maxViewStyles,a0=o0.maxViewOverlayContainer,c0=e0.user,u0=i0.CustomVideoPlaceholder;return u0?u0&&u0(_extends({},e0),null):React.createElement("div",{key:c0.uid,style:_extends({},style.max,s0)},React.createElement("div",{style:style.imgContainer},React.createElement("img",{style:style.img,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg=="})),e0.isShown&&React.createElement("div",{style:_extends({},style.btnContainer,a0)},e0.showButtons&&React.createElement(React.Fragment,null,!i0.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:c0}),!i0.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:c0}),e0.showSwap&&React.createElement(SwapUser,{UIKitUser:c0}))))},style={max:{flex:1,display:"flex",backgroundColor:"#007bff33",flexDirection:"row",position:"relative"},imgContainer:{flex:10,display:"flex",justifyContent:"center"},img:{width:100,height:100,position:"absolute",alignSelf:"center",justifySelf:"center",margin:"auto",display:"flex"},btnContainer:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},Username=function t0(e0){var n0=reactExports.useContext(RtmContext),r0=n0.usernames,i0=reactExports.useContext(PropsContext),o0=i0.rtmProps,s0=i0.styleProps,a0=e0.user;return o0!=null&&o0.displayUsername?React.createElement("p",{style:_extends({},styles.username,s0==null?void 0:s0.usernameText)},a0.uid===1?"Screenshare":r0[a0.uid]):React.createElement(React.Fragment,null)},styles={username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MaxVideoView=function t0(e0){var n0=reactExports.useContext(RtcContext),r0=n0.mediaStore,i0=reactExports.useContext(PropsContext),o0=i0.styleProps,s0=i0.rtcProps,a0=o0||{},c0=a0.maxViewStyles,u0=a0.videoMode,l0=a0.maxViewOverlayContainer,d0=u0==null?void 0:u0.max,h0=reactExports.useState(!1),p0=h0[0],m0=h0[1],f0=e0.user;return React.createElement("div",{style:_extends({},styles$1.container,e0.style,c0),onMouseEnter:function(){return m0(!0)},onMouseLeave:function(){return m0(!1)}},f0.hasVideo===1?React.createElement("div",{style:styles$1.videoContainer},!s0.disableRtm&&React.createElement(Username,{user:f0}),React.createElement(AgoraVideoPlayer,{style:styles$1.videoplayer,config:{fit:d0||"cover"},videoTrack:r0[f0.uid].videoTrack}),p0&&React.createElement("div",{style:_extends({},styles$1.overlay,l0)},!s0.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:f0}),!s0.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:f0}))):React.createElement("div",{style:styles$1.videoContainer},!s0.disableRtm&&React.createElement(Username,{user:f0}),React.createElement(VideoPlaceholder,{user:f0,isShown:p0,showButtons:!0})))},styles$1={container:{display:"flex",flex:1},videoContainer:{display:"flex",flex:1,position:"relative"},videoplayer:{width:"100%",display:"flex",flex:1},overlay:{position:"absolute",margin:5,flexDirection:"column",display:"flex"},username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MinVideoView=function t0(e0){var n0=reactExports.useContext(RtcContext),r0=n0.mediaStore,i0=reactExports.useContext(PropsContext),o0=i0.styleProps,s0=i0.rtcProps,a0=o0||{},c0=a0.minViewStyles,u0=a0.videoMode,l0=a0.minViewOverlayContainer,d0=u0==null?void 0:u0.min,h0=reactExports.useState(!1),p0=h0[0],m0=h0[1],f0=e0.user;return React.createElement("div",{style:_extends({},{display:"flex",flex:1},c0),onMouseEnter:function(){return m0(!0)},onMouseLeave:function(){return m0(!1)}},f0.hasVideo===1?React.createElement("div",{style:_extends({},{display:"flex",flex:1,position:"relative"})},React.createElement(AgoraVideoPlayer,{style:{flex:10,display:"flex"},config:{fit:d0!==void 0?d0:"cover"},videoTrack:r0[f0.uid].videoTrack}),p0&&React.createElement("div",{style:_extends({},{margin:4,position:"absolute",flex:1,display:"flex",flexDirection:"column"},l0)},!s0.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:f0}),!s0.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:f0}),React.createElement(SwapUser,{UIKitUser:f0}))):React.createElement(VideoPlaceholder,{user:f0,isShown:p0,showButtons:!0,showSwap:!0}))},styles$2={test:"_3ybTi",scrollbar:"_3Sxu7"},PinnedVideo=function t0(){var e0=reactExports.useContext(PropsContext),n0=e0.styleProps,r0=e0.rtcProps,i0=n0||{},o0=i0.minViewContainer,s0=i0.pinnedVideoContainer,a0=i0.maxViewContainer,c0=i0.scrollViewContainer,u0=reactExports.useRef(null),l0=reactExports.useState(0),d0=l0[0],h0=l0[1],p0=reactExports.useState(0),m0=p0[0],f0=p0[1],g0=d0>m0;return reactExports.useEffect(function(){var E0=function(){u0.current&&(h0(u0.current.offsetWidth),f0(u0.current.offsetHeight))};return window.addEventListener("resize",E0),u0.current&&(h0(u0.current.offsetWidth),f0(u0.current.offsetHeight)),function(){window.removeEventListener("resize",E0)}},[]),React.createElement("div",{ref:u0,style:_extends({},{display:"flex",flex:1,flexDirection:g0?"row":"column-reverse",overflow:"hidden"},s0)},React.createElement("div",{style:_extends({},{display:"flex",flex:g0?5:4},a0)},React.createElement(MaxUidConsumer,null,function(E0){return r0.role==="audience"&&E0[0].uid===0?null:React.createElement(MaxVideoView,{user:E0[0]})})),React.createElement("div",{className:styles$2.scrollbar,style:_extends({},{overflowY:g0?"scroll":"hidden",overflowX:g0?"hidden":"scroll",display:"flex",flex:1,flexDirection:g0?"column":"row"},c0)},React.createElement(MinUidConsumer,null,function(E0){return E0.map(function(_0){return r0.role==="audience"&&_0.uid===0?null:React.createElement("div",{style:_extends({},{minHeight:g0?"35vh":"99%",minWidth:g0?"99%":"40vw",margin:2,display:"flex"},o0),key:_0.uid},React.createElement(MinVideoView,{user:_0}))})})))},GridVideo=function t0(){var e0=reactExports.useContext(PropsContext),n0=e0.styleProps,r0=e0.rtcProps,i0=n0||{},o0=i0.gridVideoCells,s0=i0.gridVideoContainer,a0=reactExports.useContext(MaxUidContext),c0=reactExports.useContext(MinUidContext),u0=r0.role==="audience"?[].concat(a0,c0).filter(function(y0){return y0.uid!==0}):[].concat(a0,c0),l0=reactExports.useRef(null),d0=reactExports.useState(window.innerWidth),h0=d0[0],p0=d0[1],m0=reactExports.useState(window.innerHeight),f0=m0[0],g0=m0[1],E0=h0>f0,_0="minmax(0, 1fr) ";return reactExports.useEffect(function(){var y0=function(){l0.current&&(p0(l0.current.offsetWidth),g0(l0.current.offsetHeight))};return window.addEventListener("resize",y0),l0.current&&(p0(l0.current.offsetWidth),g0(l0.current.offsetHeight)),function(){window.removeEventListener("resize",y0)}},[]),React.createElement("div",{ref:l0,style:_extends({},{width:"100%",height:"100%",display:"grid",gridTemplateColumns:E0?u0.length>9?_0.repeat(4):u0.length>4?_0.repeat(3):u0.length>1?_0.repeat(2):_0:u0.length>8?_0.repeat(3):u0.length>2?_0.repeat(2):_0},s0)},u0.map(function(y0){return React.createElement(MaxVideoView,{user:y0,style:_extends({},{height:"100%",width:"100%"},o0),key:y0.uid})}))},useTracks=createMicrophoneAndCameraTracks({encoderConfig:{}},{encoderConfig:{}}),TracksConfigure=function t0(e0){var n0=reactExports.useState(!1),r0=n0[0],i0=n0[1],o0=reactExports.useState(null),s0=o0[0],a0=o0[1],c0=reactExports.useState(null),u0=c0[0],l0=c0[1],d0=useTracks(),h0=d0.ready,p0=d0.tracks,m0=d0.error,f0=reactExports.useRef({});return reactExports.useEffect(function(){return p0!==null?(l0(p0[0]),a0(p0[1]),f0.current[0]={audioTrack:p0[0],videoTrack:p0[1]},i0(!0)):m0&&(console.error(m0),i0(!1)),function(){if(p0){var g0,E0;(g0=p0[0])===null||g0===void 0||g0.close(),(E0=p0[1])===null||E0===void 0||E0.close()}}},[h0,m0]),React.createElement(TracksProvider,{value:{localVideoTrack:s0,localAudioTrack:u0}},r0?e0.children:null)},timeNow=function t0(){return new Date().getTime()},useChannel=createLazyChannel(),useClient$1=createLazyClient(),RtmConfigure=function t0(e0){var n0=reactExports.useContext(PropsContext),r0=n0.rtcProps,i0=n0.rtmProps,o0=reactExports.useState(!1),s0=o0[0],a0=o0[1],c0=useClient$1(r0.appId),u0=useChannel(c0,r0.channel),l0=reactExports.useRef(""),d0=reactExports.useRef(5),h0=reactExports.useContext(LocalContext),p0=reactExports.useContext(PropsContext),m0=p0.rtmCallbacks,f0=reactExports.useState({}),g0=f0[0],E0=f0[1],_0=reactExports.useState({}),y0=_0[0],b0=_0[1],S0=reactExports.useState({}),w0=S0[0],I0=S0[1],L0=reactExports.useState(popUpStateEnum.closed),M0=L0[0],C0=L0[1],U0=reactExports.useState(rtmStatusEnum.offline),x0=U0[0],j0=U0[1],k0=reactExports.useContext(RtcContext),D0=k0.localUid,$0=k0.localAudioTrack,N0=k0.localVideoTrack,A0=k0.dispatch,P0=k0.channelJoined,O0=function J0(){try{var K0=r0.tokenUrl,q0=function(){if(K0){var B0=_catch(function(){return Promise.resolve(fetch(K0+"/rtm/"+((i0==null?void 0:i0.uid)||l0.current))).then(function(z0){return Promise.resolve(z0.json()).then(function(Q0){var Y0=Q0.rtmToken;return Promise.resolve(c0.login({uid:(i0==null?void 0:i0.uid)||l0.current,token:Y0})).then(function(){d0.current=5})})})},function(){setTimeout(function(){try{return d0.current=d0.current+d0.current,J0(),Promise.resolve()}catch(z0){return Promise.reject(z0)}},d0.current*1e3)});if(B0&&B0.then)return B0.then(function(){})}else{var G0=_catch(function(){return Promise.resolve(c0.login({uid:(i0==null?void 0:i0.uid)||l0.current,token:(i0==null?void 0:i0.token)||void 0})).then(function(){d0.current=5})},function(){setTimeout(function(){try{return d0.current=d0.current+d0.current,J0(),Promise.resolve()}catch(z0){return Promise.reject(z0)}},d0.current*1e3)});if(G0&&G0.then)return G0.then(function(){})}}();return Promise.resolve(q0&&q0.then?q0.then(function(){}):void 0)}catch(B0){return Promise.reject(B0)}},v0=function J0(){try{var K0=_catch(function(){return Promise.resolve(u0.join()).then(function(){d0.current=5})},function(){setTimeout(function(){try{return d0.current=d0.current+d0.current,J0(),Promise.resolve()}catch(q0){return Promise.reject(q0)}},d0.current*1e3)});return Promise.resolve(K0&&K0.then?K0.then(function(){}):void 0)}catch(q0){return Promise.reject(q0)}},R0=function(){try{if(j0(rtmStatusEnum.initialising),r0.uid?l0.current=String(r0.uid):l0.current=String(timeNow()),c0.on("ConnectionStateChanged",function(B0,G0){console.log(B0,G0)}),c0.on("TokenExpired",function(){try{var B0=r0.tokenUrl;console.log("token expired - renewing");var G0=function(){if(B0){var z0=_catch(function(){return Promise.resolve(fetch(B0+"/rtm/"+((i0==null?void 0:i0.uid)||l0.current))).then(function(Q0){return Promise.resolve(Q0.json()).then(function(Y0){var W0=Y0.rtmToken;return Promise.resolve(c0.renewToken(W0)).then(function(){d0.current=5})})})},function(Q0){console.error("TokenExpiredError",Q0)});if(z0&&z0.then)return z0.then(function(){})}}();return Promise.resolve(G0&&G0.then?G0.then(function(){}):void 0)}catch(z0){return Promise.reject(z0)}}),c0.on("MessageFromPeer",function(B0,G0){V0(B0,G0)}),u0.on("ChannelMessage",function(B0,G0){V0(B0,G0)}),u0.on("MemberJoined",function(B0){try{return Promise.resolve(i1(T0(),B0)).then(function(){})}catch(G0){return Promise.reject(G0)}}),u0.on("MemberCountUpdated",function(B0){try{return console.log("RTM-MemberCountUpdated: ",B0),Promise.resolve()}catch(G0){return Promise.reject(G0)}}),m0!=null&&m0.channel?Object.keys(m0.channel).map(function(B0){m0.channel&&u0.on(B0,m0.channel[B0])}):m0!=null&&m0.client&&Object.keys(m0.client).map(function(B0){m0.client&&c0.on(B0,m0.client[B0])}),r0.tokenUrl){var K0=r0.tokenUrl,q0=r0.uid;c0.on("TokenExpired",function(){try{return console.log("token expired"),Promise.resolve(fetch(K0+"/rtm/"+(q0||0)+"/")).then(function(B0){return Promise.resolve(B0.json()).then(function(G0){var z0=G0.rtmToken;c0.renewToken(z0)})})}catch(B0){return Promise.reject(B0)}})}return j0(rtmStatusEnum.loggingIn),Promise.resolve(O0()).then(function(){return j0(rtmStatusEnum.loggedIn),Promise.resolve(v0()).then(function(){j0(rtmStatusEnum.connected),b0(function(B0){return _extends({},B0,{0:i0==null?void 0:i0.username})}),s1(T0())})})}catch(B0){return Promise.reject(B0)}},T0=function(){return{messageType:"UserData",rtmId:(i0==null?void 0:i0.uid)||l0.current,rtcId:D0.current,username:i0==null?void 0:i0.username,role:r0.role==="audience"?1:0,uikit:{platform:"web",framework:"react",version:"1.2.0"},agora:{rtm:AgoraRTM__default.VERSION,rtc:nq.VERSION}}},F0=function(K0,q0,B0){var G0=(i0==null?void 0:i0.showPopUpBeforeRemoteMute)===!1,z0={messageType:"MuteRequest",device:K0,rtcId:q0,mute:B0,isForceful:G0},Q0=g0[q0];G0&&!B0?console.log("cannot send force unmute request"):Q0?i1(z0,Q0):console.log("peer not found")},V0=function(K0,q0){var B0;if(K0.messageType==="RAW"?B0=parsePayload(K0.rawMessage):K0.messageType==="TEXT"&&(B0=JSON.parse(K0.text)),console.log(B0,q0),B0)switch(B0.messageType){case"UserData":H0(B0);break;case"MuteRequest":X0(B0);break;case"RtmDataRequest":switch(B0.type){case"ping":Z0(q0);break;case"userData":n1(q0);break;default:console.log(q0)}break;default:console.log("unknown message content")}else console.log("unknown rtm message type")},H0=function(K0){E0(function(q0){var B0;return _extends({},q0,(B0={},B0[K0.rtcId]=K0.rtmId,B0))}),b0(function(q0){var B0;return _extends({},q0,(B0={},B0[K0.rtcId]=K0.username,B0))}),I0(function(q0){var B0;return _extends({},q0,(B0={},B0[K0.rtmId]=K0,B0))})},X0=function(K0){D0.current===K0.rtcId&&(K0.isForceful?K0.mute?K0.device===mutingDevice.microphone?$0&&muteAudio(h0,A0,$0):K0.device===mutingDevice.camera&&N0&&muteVideo(h0,A0,N0):console.error("cannot force unmute"):K0.device===mutingDevice.microphone?K0.mute?C0(popUpStateEnum.muteMic):C0(popUpStateEnum.unmuteMic):K0.device===mutingDevice.camera&&(K0.mute?C0(popUpStateEnum.muteCamera):C0(popUpStateEnum.unmuteCamera)))},Z0=function(K0){i1({messageType:"RtmDataRequest",type:"pong"},K0)},n1=function(K0){i1(T0(),K0)},s1=function(K0){try{var q0=c0.createMessage({text:JSON.stringify(K0),messageType:AgoraRTM__default.MessageType.TEXT}),B0=_catch(function(){return Promise.resolve(u0.sendMessage(q0)).then(function(){})},function(G0){console.error(G0)});return Promise.resolve(B0&&B0.then?B0.then(function(){}):void 0)}catch(G0){return Promise.reject(G0)}},i1=function(K0,q0){try{var B0=c0.createMessage({text:JSON.stringify(K0),messageType:AgoraRTM__default.MessageType.TEXT}),G0=_catch(function(){return Promise.resolve(c0.sendMessageToPeer(B0,String(q0))).then(function(){})},function(z0){console.error(z0)});return Promise.resolve(G0&&G0.then?G0.then(function(){}):void 0)}catch(z0){return Promise.reject(z0)}},e1=function(){try{return Promise.resolve(c0.logout()).then(function(){return Promise.resolve(c0.removeAllListeners()).then(function(){})})}catch(K0){return Promise.reject(K0)}};return reactExports.useEffect(function(){return P0&&(R0(),a0(!0)),function(){P0&&e1()}},[r0.channel,r0.appId,P0]),React.createElement(RtmProvider,{value:{rtmStatus:x0,sendPeerMessage:i1,sendChannelMessage:s1,sendMuteRequest:F0,rtmClient:c0,uidMap:g0,usernames:y0,userDataMap:w0,popUpState:M0,setPopUpState:C0}},s0?e0.children:React.createElement(React.Fragment,null))},enc=new TextEncoder,dec=new TextDecoder,createRawMessage=function t0(e0){return enc.encode(JSON.stringify(e0))},parsePayload=function t0(e0){return JSON.parse(dec.decode(e0))};function PopUp(){var t0=reactExports.useContext(PropsContext),e0=t0.styleProps,n0=reactExports.useContext(RtmContext),r0=n0.popUpState,i0=n0.setPopUpState,o0=e0||{},s0=o0.popUpContainer,a0=reactExports.useContext(RtcContext),c0=a0.dispatch,u0=a0.localVideoTrack,l0=a0.localAudioTrack,d0=reactExports.useContext(LocalContext);return r0!==popUpStateEnum.closed?React.createElement("div",{style:_extends({},styles$3.container,s0)},React.createElement("div",{style:{color:"#fff",fontSize:18,fontWeight:700}},r0===popUpStateEnum.muteCamera||r0===popUpStateEnum.muteMic?"Mute ":"Unmute ",r0===popUpStateEnum.muteCamera||r0===popUpStateEnum.unmuteCamera?"Camera":"Mic","?"),React.createElement("div",{style:{flexDirection:"row",display:"flex",width:"100%",justifyContent:"space-around"}},React.createElement("div",{onClick:function(){switch(r0){case popUpStateEnum.muteCamera:d0.hasVideo&&u0&&muteVideo(d0,c0,u0);break;case popUpStateEnum.muteMic:d0.hasAudio&&l0&&muteAudio(d0,c0,l0);break;case popUpStateEnum.unmuteCamera:!d0.hasVideo&&u0&&muteVideo(d0,c0,u0);break;case popUpStateEnum.unmuteMic:!d0.hasAudio&&l0&&muteAudio(d0,c0,l0);break}i0(popUpStateEnum.closed)},style:styles$3.button},"Confirm"),React.createElement("div",{style:styles$3.buttonClose,onClick:function(){return i0(popUpStateEnum.closed)}},"Close"))):null}var styles$3={button:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},buttonClose:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},container:{backgroundColor:"#007bffaa",position:"absolute",width:240,height:80,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},AgoraUIKit=function t0(e0){var n0=e0.styleProps,r0=e0.rtcProps,i0=n0||{},o0=i0.UIKitContainer;return React.createElement(PropsProvider,{value:e0},React.createElement("div",{style:_extends({},style$1,o0)},r0.role==="audience"?React.createElement(VideocallUI,null):React.createElement(TracksConfigure,null,React.createElement(VideocallUI,null))))},VideocallUI=function t0(){var e0=reactExports.useContext(PropsContext),n0=e0.rtcProps;return React.createElement(RtcConfigure,{callActive:n0.callActive},React.createElement(LocalUserContext,null,n0.disableRtm?React.createElement(React.Fragment,null,(n0==null?void 0:n0.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null)):React.createElement(RtmConfigure,null,React.createElement(PopUp,null),(n0==null?void 0:n0.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null))))},style$1={display:"flex",flex:1,minHeight:0,flexDirection:"column"};const VIEWPORT_ID="agora-root";function getViewport(){const t0=document.getElementById(VIEWPORT_ID);if(t0)return t0;const e0=document.createElement("div");return e0.setAttribute("id",VIEWPORT_ID),e0.style.width="100vw",e0.style.height="100vh",e0.style.position="fixed",e0.style.top="0",e0.style.left="0",e0.style.zIndex="50",document.body.appendChild(e0),e0}function destroyViewport(){const t0=document.getElementById(VIEWPORT_ID);t0&&t0.remove()}const agoraUIKit={start:function(t0){this.end();const e0=t0.viewport||getViewport();this.options=t0;const n0={rtcProps:{appId:t0.appId,channel:t0.channel,token:t0.token,layout:typeof t0.layout>"u"?layout.grid:t0.layout,enableScreensharing:!0,uid:t0.uid,enableAudio:typeof t0.enableAudio>"u"?!0:t0.enableAudio,enableVideo:typeof t0.enableVideo>"u"?!0:t0.enableVideo},callbacks:{EndCall:()=>{this.end()},"user-joined":()=>{t0.onUserJoin&&t0.onUserJoin()},"user-left":()=>{t0.onUserLeft&&t0.onUserLeft()}}},r0={width:"100%",height:"100%",display:"flex",flex:1},i0=()=>{const[o0,s0]=reactExports.useState(!0);return this.unmount=()=>{s0(!1)},jsxRuntimeExports.jsx("div",{style:r0,children:o0?jsxRuntimeExports.jsx(AgoraUIKit,{...n0}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{})})};createRoot(e0).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(i0,{})}))},end:async function(){var t0;this.unmount&&(this.unmount(),this.unmount=void 0,await new Promise(e0=>{setTimeout(e0,50)})),!((t0=this.options)!=null&&t0.viewport)&&destroyViewport()}};window.AgoraUIKit=agoraUIKit;
